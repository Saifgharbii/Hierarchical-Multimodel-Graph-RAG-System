{
    "document_name": "23700-85-i00.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Report has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, certain modal verbs have the following meanings:\nshall\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nNOTE 1:\tThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions, and do not appear in Technical Reports.\nNOTE 2:\tThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible, and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\tindicates permission to do something\nneed not\tindicates permission not to do something\nNOTE 3:\tThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\tindicates that something is possible\ncannot\tindicates that something is impossible\nNOTE 4:\tThe constructions \"can\" and \"cannot\" shall not to be used as substitutes for \"may\" and \"need not\".\nwill\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nNOTE 5:\tThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "This study focuses on key issue description, solution and conclusion on the enhancement of 5G UE Policy aspect by covering following objectives:\n-\tURSP rule provisioning and updating procedures for home-routed and LBO roaming scenario, while keeping the existing framework of policy control based on HPLMN.\n-\tInvestigate whether and how the network can be made aware when the UE enforces URSP rule and investigate whether and what actions the 5G network can perform.\n-\tInvestigate if enhancements are needed for provisioning UE with consistent URSP across 5GC and EPC, and study the mechanism if needed.\n-\tInvestigate how to support standardized and operator-specific traffic categories in the traffic descriptor of URSP.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[3]\t3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".\n[4]\t3GPP TS 23.503: \"Policy and charging control framework for the 5G System (5GS); Stage 2\".\n[5]\t3GPP TS 23.548: \"5G System Enhancements for Edge Computing; Stage 2\".\n[6]\t3GPP TS 23.434: \"Service Enabler Architecture Layer for Verticals (SEAL); Functional architecture and information flows\".\n[7]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[8]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[9]\t3GPP TS 29.525: \"5G System; UE Policy Control Service; Stage 3\".\n[10]\t3GPP TS 24.526: \"User Equipment (UE) policies for 5G System (5GS); Stage 3\".\n[11]\t3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".\n[12]\t3GPP TS 23.304: \"Proximity based Service (ProSe) in the 5G System (5GS); Stage 2\".\n[13]\t3GPP TS 32.421: \"Telecommunication Management; Subscriber and equipment trace; Trace concepts and requirements\".\n[14]\t3GPP TS 29.244: \"Interface between the Control Plane and the User Plane nodes\".\n[15]\t3GPP TS 29.519: \"5G System; Usage of the Unified Data Repository Service for Policy Data, Application Data and Structured Data for Exposure; Stage 3\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions of terms and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tTerms",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tArchitectural Assumptions and Principles",
            "description": "Editor's note:\tThis clause will document any architectural assumptions and principles.\nRel-15, Rel-16 and Rel-17 specified UE Policy mechanism in TS 23.501 [2], TS 23.502 [3] and TS 23.503 [4] will be used as baseline for this study.\nNo new interface in EPC will be defined to solve the issue of consistent URSP provisioning.\nFor the objective to investigate if enhancements are needed for provisioning UE with consistent URSP across 5GC and EPC, and study the mechanism if needed, the following applies:\n-\tSolutions using the ePCO to transfer URSP Rules via EPC assumes that the UE is registered in an MME supporting 5GS interworking, and as such transferring of ePCO in the PDN Connection signalling is supported by the MME and SGW. It is also assumed that the SMF+PGW-C selected for a PDN Connection established to a specific APN supports UE policy delivery service (i.e. SMF+PGW-C supports sending and receiving of a UE Policy Container to/from the UE).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "5\tKey Issues",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tKey Issue #1: URSP in VPLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.1.1\tDescription",
                            "text_content": "This Key Issue will study URSP rule provisioning and updating procedures in roaming scenario, while keeping backward compatibility with the existing framework of policy control based on HPLMN. In particular:\n-\tWhether the HPLMN needs any information from the VPLMN to generate URSP Rules in roaming. If so, which information and how to provide it.\n-\tHow to provide URSP Rules in roaming to the UE. In particular, how the HPLMN and VPLMN are involved in such procedure.\n-\tWhether and how to support URSP enhancements to support routing of the application traffic with different URSP rules in different PLMNs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.2\tKey Issue #2: 5GC awareness of URSP enforcement",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tDescription",
                            "text_content": "This key issue address WT#4: whether and how the network can be made aware when the UE enforces URSP rule for a traffic and investigate whether and what actions the 5G network can perform.\nThe following aspects will be studied:\n-\tWhether and how the 5GC can be made aware whether or when the UE enforces a URSP rule to route an application traffic to a PDU Session based on the URSP rule provisioned by 5GC.\n-\tWhether there are any actions the 5GS can take after 5GC is aware whether the UE enforces a URSP rule for specific application traffic or not. If any, what action 5GC should take?\nNOTE:\tUser privacy needs to be considered when defining solution (e.g. 5GC will know if a user started/stopped \"any\" application).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3\tKey Issue #3: Provision consistent URSP to UE across 5GS and EPS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tDescription",
                            "text_content": "The UE may use the route selection component (e.g. DNN) in a URSP rule in EPS, but when the URSP rule is updated at network side, there is no way to provision the URSP rule to UE in EPS based on current design. The different scenarios of provisioning the UE with URSP in EPS will be defined, according to the existing Rel-17 TS 23.501 [2], TS 23.502 [3] and TS 23.503 [4] TSs and considered in order to configure the UE with consistent URSP across EPS and 5GS. This key issue is to study how to support provisioning of URSP to a UE that is consistent across 5GC and EPC, including:\n-\tIdentify the use cases and scenarios where the UE may need URSP that is consistent across 5GC and EPC.\n-\tStudy whether there are any issues and gaps in the existing URSP mapping mechanism described in clause 5.17.1.2 of TS 23.501 [2], if so, identify them and propose solutions.\n-\tWhether, when and how to provision the URSP to UE when served by the EPC and ANDSF is not deployed in the network. For the Rel-15 UEs not supporting the URSP mapping in EPS, whether the URSP updating/provisioning to such UEs in EPS should be supported.\nNOTE:\tNo new interface will be defined in EPC to solve this key issue.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.4\tKey Issue #4: Support standardized and operator-specific traffic categories in URSP",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.4.1\tDescription",
                            "text_content": "Based on GSMA requirement (LS in S2-2105356), SA WG2 will investigate how to support traffic categories in the traffic descriptor of URSP. Following aspects will be considered:\n-\tDefinition of Traffic Category use cases and how to support both standardized traffic categories and MNO-specific traffic categories. If standardized values for traffic categories are defined, what are the various traffic categories that need to be standardized.\n-\tWhether the existing URSP design can be used to support the traffic category. If not, how to support traffic category in the traffic descriptor of a URSP rule.\nNOTE 1:\tTraffic categories should support mechanisms that enable the UE to uniquely identify and categorize the traffic generated by any active application in a consistent manner across UE implementations.\nNOTE 2:\t3GPP will coordinate with GSMA for the definition of traffic category, its use cases and the traffic categories GSMA may want to standardize.\nIt is assumed to have following standardised traffic categories considering the requirement from GSMA:\n-\tIMS traffic category; voice, video and SMS over IMS, as well as RCS, are included in this traffic category.\n-\tInternet traffic category.\n-\tIoT and machine to machine type of traffic.\n-\tOn demand downlink streaming.\n-\tOn demand uplink streaming.\n-\tVehicular communications, including vehicle-to-infrastructure, vehicle-to-network, vehicle-to-vehicle, vehicle-to-pedestrian, vehicle-to-device and vehicle-to-grid.\n-\tReal time interactive traffic.\n-\tUnified communications traffic; instant messaging, VoIP and video collaboration are included in this category.\n-\tBackground traffic; comprising processes for e.g. firmware/software updates over the air.\n-\tLocation-based traffic.\n-\tCritical Communications.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.X\tKey Issue #X: <Key Issue Title>",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.X.1\tDescription",
                            "text_content": "Editor's note:\tThis clause provides a description of the key issue.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tSolutions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.0\tMapping of Solutions to Key Issues",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 6.0-1: Mapping of Solutions to Key Issues\n\n",
                    "tables": [
                        {
                            "description": "Table 6.0-1: Mapping of Solutions to Key Issues",
                            "table number": 3,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.1\tSolution #1: Usage of application guidance for URSP rules determination mechanisms",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tDescription",
                            "text_content": "Currently when a UE is served by a network other than its home operator (i.e. VPLMN) the serving network cannot influence the determination of URSP. It would be useful for the serving network to be able to influence the determination of URSP for example in LBO case where the VPLMN may support dedicated DNN(s) for Edge applications.\nA solution is to leverage, clause 6.6 of TS 23.548 [5] \"Support of AF Guidance to PCF Determination of Proper URSP Rules\" and clause 4.15.6.10 of TS 23.502 [3] \"Application guidance for URSP rules determination mechanisms\" as defined for Rel-17.\nAn AF from the VPLMN provides the VPLMN specific URSP information (e.g. DNN and S-NSSAI to be used for an application traffic etc.) (according to clause 6.6 of TS 23.548 [5] and clause 4.15.6.10 of TS 23.502 [3]); this indication can be leveraged by the PCF of the HPLMN to (if authorized by HPLMN) provide dedicated URSP rules applicable to relevant users of the HPLMN when they are roaming in that VPLMN. These URSP may have a validity condition (e.g. Time Window and/or Location Criteria) corresponding to the VPLMN. The location validity condition may be provided by the AF from VPLMN that contains the list of TA(s) or Cell Id(s) of the VPLMN.\nNOTE 1:\tThe PLMN ID in the Policy Section identified by the Policy Section Identifier (PSI) is used to determine which PLMN owns the policy section. A PCF can provide UE policies for policy sections that are associated with the PLMN that the PCF belongs to i.e. a PCF from HPLMN cannot provide UE policies for a Policy Section list that belongs to a VPLMN.\nThe H-PCF may, based on local policies, determine whether to always send the URSP rules immediately to the UE or to send these rules only when the UE is served by the corresponding serving PLMN, e.g. waiting to be triggered from a V-PCF of that PLMN in step 3 of clause 4.6.11 of TS 23.502 [3].\nThe PCF of the HPLMN when it sends such URSP update to a UE, needs, as for Rel-17, to ensure that the DNN, S-NSSAI provided in the URSP rules sent to the UE is allowed in UDM subscription even when the UE is roaming in that VPLMN.\nNOTE 2:\tThis solution could also apply in FS_EDGE_Ph2.\nNOTE 3:\tThis solution is applicable only when HPLMN supports dynamic PCC and application guidance for URSP rules determination mechanisms.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.2\tProcedures",
                            "text_content": "The solution reuses existing procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.3\tImpacts on Existing Nodes and Functionality",
                            "text_content": "-\tThe VPLMN and the HPLMN as part of the roaming agreement need to ensure that the VPLMN AF can reach the NEF of the HPLMN to use the API defined in clause 4.15.6.10 of TS 23.502 [3] \"Application guidance for URSP rules determination mechanisms\"\n-\tUDM to include the DNN, S-NSSAI of the VPLMN in the list of Subscribed S-NSSAIs and to allow the DNN, S-NSSAI to work in LBO mode in the user subscription.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.2\tSolution #2: VPLMN influencing URSP rules in an HPLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tDescription",
                            "text_content": "Editor's note:\tThis clause will describe the solution principles and architecture assumptions for corresponding key issue(s) which should be explicitly stated. (Sub) clause(s) may be added to capture details.\nTo support the objectives of KI#1 it is proposed to re-use the procedure defined in Release-17 on application guidance for URSP rule creation with the additional enhancement on allowing an Application Function in a VPLMN to influence URSP rules creation at an HPLMN. The AF in the visited PLMN provides the service information re-using the service specific information provisioning procedure described in TS 23.502 [3] with the following addition:\n-\tThe AF includes an indication to apply this rule only when UEs register to a specific PLMN.\nThe trigger for the AF request could be due to:\n-\tAF service provider of a VPLMN wishes to use specific DNN/S-NSSAI handling for roaming UEs\n-\tA trigger by the Network Slices Capability Enablement Server defined in TS 23.434 [6]. The NSCE server may be located in an AF. The NSCE server may receive from an NSCE client (located in a UE) a network/slice notification remapping for an application based on configuration provided by the NSCE server to the NSCE client in the UE.\nThe NEF stores the AF request information in the UDR in the \"Application Data\" field within the Service Specific Information Data Subset together with the assigned Transaction Reference ID (provided by the AF).\nWhen the PCF receives the updated subscription information from the UDR the PCF derives updated URSP rules for a UE (or any UE) including in the URSP rule information indicating to the UEs to apply this URSP rules only when routing traffic via a specific PLMN. This is supported by enhancing the Route Selection Descriptor of the URSP rule including a PLMN identity. There are several options on how the RSD component can be enhanced:\n-\tOption 1: New validation criteria in RSD.\n-\tOption 2: Use existing validation criteria i.e. the location criteria, where the location could be set to e.g. 3GPP location\"={PLMN,location}.\n-\tOption 3: Include a new RSD parameter (i.e. not validation criteria) to identify the PLMN.\nIf the UE determines an applicable URSP rule for detected application traffic then the UE considers the Route Selection Descriptor valid if the PLMN identity of the validity condition matches the PLMN identity of the registered PLMN. The new RSD component that include PLMN identity are set by the PCF as higher priority so that the UE evaluates the first.\nAlternatively, the PCF filters the Service Specific Information Data Subset provided by UDR, e.g. using the PLMN as Data Subkey, then includes only URSP Rules applicable for the Serving PLMN. The PCF removes the URSP Rules applicable for the Serving PLMN when the UE Policy association with the V-PCF in the Serving PLMN is terminated or when the UE moves to a different Serving PLMN and a change of PLMN PCRT is reported via V-PCF. The H-PCF provides a list of PSIs identified by the HPLMN ID, the location validity conditions in the URSP Rule contains a list of TAI(s) or Cell ID(s), if included.\nAn example of provisioning URSP rules that contains RSDs for a VPLMN is as follows. In order to let UE give preference to evaluate the VPLMN specific URSP rules, the UE receives the provisioning as follows:\n-\tVPLMN specific URSP rules only contains the RSDs for VPLMN;\n-\tHPLMN specific URSP rules can be used for both VPLMN and HPLMN;\n-\tVPLMN specific rules has higher priority than HPLMN specific URSP rules, so that UE can firstly evaluate VPLMN specific URSP rules/RSDs in roaming case.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2\tProcedures",
                            "text_content": "A call flow of the procedure is shown below.\nFigure 6.2.2.1-1 illustrates the procedure to influence Universal Roaming Service Procedure (URSP) rules for a different Public Land Mobile Network (PLMN). The figure outlines the steps involved in modifying the URSP rules for a specific PLMN, including the necessary procedures and signaling exchanges. Key components include the Network Switching Center (NSC), Home Location Register (HLR), and Serving Domestic Roaming Center (SDRC). The figure emphasizes the importance of accurate and efficient roaming management for seamless connectivity across different PLMNs.\nFigure 6.2.2.1-1: Procedure to influence URSP rules for a different PLMN\nSteps are as follows:\n1.\tAF in VPLMN is triggered to request to the home PLMN of a UE a specific handling of routing traffic to the VPLMN.\n2.\tThe AF invokes a service operation with the NEF including in the request updated service information as described in clause 4.15.6.10 of TS 23.502 [3]. The updated information includes a validity conditions to apply a URSP rule in a specific PLMN (or a list of PLMN). The request is applicable for any UE or the AF may include external identifiers of the UE.\n2a-2c\tThe NEF may authorize the request with the UDM according to TS 23.502 [3].\n3a\tWhen the authorization is successful the NEF updates the data in the UDR including within Application Data the updated service information. The NEF invokes an Nudr_DM_Create (or Update) service request requested the UDR to store the service information in the \"Application Data\" Data Set within the Service Specific Information Data Subset identifier. The NEF may also include a Data Key the target UEs or Group of UEs.\n3b.\tThe UDR acknowledges the NEF request.\n3c.\tThe NEF acknowledges the AF request.\n4a.\tIf the PCF has subscribed to Service Specific Information the UDR notifies the PCF of the updated service information.\n4b.\tWhen a UE registers to the H-PLMN (or VPLMN) the UE includes a list of PSIs. The AMF (in HPLMN) or V-PCF (in VPLMN) initiates a UE Policy Association Create request with the PCF including in the request the list of PSIs associated to the HPLMN.\n4c.\tThe PCF may retrieve Application Data subscription information from the UDR.\n5.\tThe PCF creates updated URSP rules including URSP rules with validity conditions on per PLMN basis according to the information stored in the UDR.\n6.\tThe PCF provides updated URSP rules to the UE by initiating a UE Configuration Update for transparent policy delivery (via the V-PCF if the UE is roaming) to deliver updated URSP rule to a UE.\n6b.\tThe UE acknowledges successful installation of rules.\n7.\tIf the AF has subscribed to notification of successful policy delivery the PCF notifies the UDR.\n8a-8b\tThe UDR informs the NEF of successful policy delivery.\n9a-9b.\tThe NEF informs the AF of successful policy delivery.\nThe UE upon reception of URSP rules including a PLMN validity conditions within Route Selection Descriptors enforces the URSP rules as follows:\n-\tWhen the UE finds that application traffic matches traffic descriptor of a URSP rules the UE checks the list of Route Selection Descriptors of the matched URSP rule.\n-\tIf an RSD in the list of RSDs contains PLMN validity conditions the UE checks if the PLMN identity within the validity conditions matches the PLMN identity of the registered PLMN or an equivalent PLMN of the registered PLMN.\n-\tIf there is match the UE considers the RSD valid and routes the application traffic according to the contents of the route selection descriptor.\n-\tIf there is no match the UE considers the RSD as invalid and continues to process a second RSD in the list of RSD of the matched URSP rules if available.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3\tImpacts on services, entities and interfaces",
                            "text_content": "Editor's note:\tThis clause captures impacts on existing 3GPP nodes and functional elements.\nURSP rule is enhanced with a PLMN identity validity condition within Route Selection Descriptors. The UE checks if the PLMN identity within the validity conditions matches the PLMN identity of the registered PLMN or an equivalent PLMN of the registered PLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.3\tSolution #3: URSP provisioning and updating in roaming",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3.1\tDescription",
                            "text_content": "This is a solution related to the Key Issue #1 URSP in VPLMN.\nFlexible scenarios deployed in VPLMN, e.g. flexible LADN deployment or MEC deployment, requires the URSP generation and updating to have the consideration of the policy information (including LADN DNN or AF located in VPLMN) in VPLMN dynamically. Furthermore, as it needs to keep the backward compatibility with the existing framework of policy control based on HPLMN, the aforementioned policy information in VPLMN needs to be provided to the HPLMN by VPLMN for UPSP generation and updating in roaming case. In this solution, it is proposed that the V-PCF provides the UE policy assistant information of VPLMN to the H-PCF and take the UE Policy Association Establishment/modification procedure as specified in clause 4.16.11 of TS 23.502 [3] as basis for URSP provisioning and updating.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.2\tUE Policy Association Establishment with VPLMN assistant information",
                            "text_content": "Figure 6 illustrates the process of User Equipment (UE) Policy Association Establishment with VPLMN Assistant Information. The figure depicts the interaction between the UE and the VPLMN Assistant, which is responsible for managing policy association and providing necessary information. The process begins with the UE sending a request to the VPLMN Assistant, initiating the policy association establishment. The VPLMN Assistant then responds with relevant information, which the UE uses to complete the association process. This figure is crucial in understanding the complex interactions between network entities and the policies that govern their behavior.\nFigure 6.3.2-1: UE Policy Association Establishment with VPLMN assistant information\nThis procedure takes the UE Policy Association Establishment procedure in roaming case as specified in clause 4.16.11 of TS 23.502 [3] as basis.\n1.\tThe AMF establishes UE Policy Association with the V-PCF same as step 1 in clause 4.16.11 of TS 23.502 [3].\n2.\tThe AMF sends a Npcf_UEPolicyControl Create Request to V-PCF same as step 2 in clause 4.16.11 of TS 23.502 [3].\n3.\tAfter receiving the Npcf_UEPolicyControl Create Request from the AMF, the V-PCF gets the VPLMN assistant UE policy information based on local policy or get it from the V-UDR by using the Nudr_DM_Query service. The VPLMN assistant UE policy information is used for HPLMN to generate the UE policy taking the VPLMN requirement into account.\n4.\tThe V-PCF forwards the information received from AMF in step 2 and the VPLMN assistant UE policy information got in step 3 to the H-PCF. The VPLMN assistant UE policy information may include the following information:\n-\tThe mapping from traffic descriptor to DNN, NSSAI, SSC mode, PLMN ID, etc. in VPLMN.\n5-6.\tSteps 5~6 same as steps 4~5 are performed.\n7.\tSimilar to step 6 in clause 4.16.11 of TS 23.502 [3], the H-PCF gets policy subscription related information and the latest list of PSIs from the UDR using Nudr_DM_Query service operation. The H-PCF creates the UE policy based on the policy information from UDR and the VPLMN assistant UE policy information if any in step 4, then provides the UE policy container in the Npcf_UEPolicyControl UpdateNotify Request to V-PCF.\n8~11.\tThe steps 8~11 are same as the steps 7~10.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.3\tUE Policy Association modification with VPLMN assistant information",
                            "text_content": "Figure 6 illustrates the process of UE Policy Association modification with VPLMN assistant information in a telecommunication network. The figure depicts the interaction between the User Equipment (UE) and the VPLMN Assistant, which is responsible for managing the association process. The figure shows how the UE requests a modification to its Policy Association, and the VPLMN Assistant processes this request, updating the association details accordingly. The figure highlights the importance of accurate and efficient policy management in maintaining seamless connectivity and optimal resource allocation in a telecommunication network.\nFigure 6.3.3-1: UE Policy Association modification with VPLMN assistant information\nThis procedure takes the UE Policy Association Modification initiated by the PCF procedure in roaming case as specified in clause 4.16.12.2 of TS 23.502 [3] as a basis.\n1.\tIf (V-)PCF subscribed to notification of VPLMN assistant information change and a change is detected, the V-UDR notifies V-PCF of that the VPLMN assistant information has been changed. Before performing this step, the V-PCF needs to subscribe the notification of VPLMN assistant information change from the V-UDR.\n2.\tIf the VPLMN assistant information changed according the step 1 or based on local policy in V-PCF, the V-PCF forwards the VPLMN assistant information to the H-PCF via the Npcf_UEPolicyControl_Update request.\n3.\tH-PCF responds to V-PCF.\n4.\tThe H-PCF may update the UE policy based on the VPLMN assistant UE policy information from V-PCF in step 4, and send it to the V-PCF via the Npcf_UEpolicyControl_UpdateNotify request similar to the step 3 of figure 4.16.12.2-1 of TS 23.502 [3].\n5.\tThe V-PCF sends a response to H-PCF using Npcf_UEPolicyControl UpdateNotify Response.\n6.\tThe step 6 is same to the steps 5-9 of figure 4.16.12.2-1 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.4\tSupport routing of the same application traffic with different URSP rules in different PLMNs",
                            "text_content": "For support routing of the same application traffic with different URSP rules in different PLMNs, a potential way is to enhance the existing structure of URSP as specified in clause 6.6.2 of TS 23.503 [4]. The Traffic descriptor in URSP can be enhanced to include:\n-\ta new component \"PLMN ID\".\nWhen to perform the URSP evaluation, for every newly detected application, the UE additionally enter a PLMN ID with the application data. This means that PLMN ID is also involved in URSP evaluation. The PLMN ID is the PLMN ID of its serving PLMN.\nFor support routing of the same application traffic with different URSP rules in different PLMNs, if there is the VPLMN assistant UE policy information received from the V-PCF as specified in step 4 of clause 6.3.2 or step 2 of clause 6.3.3, the H-PCF provides the URSP only applied to this VPLMN to the UE. When the UE moves to a different VPLMN, the H-PCF will generate or update the URSP Rule to the UE for this different and to be served VPLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.5\tImpacts on Existing Nodes and Functionality",
                            "text_content": "The solution has impacts on the following entities:\nV-PCF:\n-\tIs able to request the VPLMN assistant UE policy information from the V-UDR.\n-\tSupports the subscription of VPLMN assistant UE policy information change notification from the V-UDR.\nUDR:\n-\tSupports the notification of VPLMN assistant UE policy information change.\n-\tSupport to provide the VPLMN assistant UE policy information to V-PVF.\nH-PCF:\n-\tSupport to create/update the UE policy combined with the VPLMN assistant UE policy information from the V-PCF.\n-\tProvides the URSP only dedicated to the VPLMN to the UE if VPLMN assistant UE policy information is received.\nUE:\n-\tEvaluates the URSP with the consideration of matching PLMN ID in TD with current serving PLMN ID.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.4\tSolution #4: URSP decision with V-PCF involvement",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.4.1\tDescription",
                            "text_content": "The Solution addresses Key Issue #1 on URSP in VPLMN. This solution assumes the following:\n-\tIt is assumed that there are some applications which may be deployed in both VPLMN and HPLMN, or VPLMN only. In either scenario, the VPLMN may request to transport the corresponding application traffic with some specific DNN(s) and/or S-NSSAI(s).\n-\tDuring the lifetime of UE Policy Association, the V-PCF is capable of generating URSP rules from VPLMN perspective, based on operator configuration or input from the AF. For example, the AF (e.g. gyms, museums) in VPLMN may request to distribute URSP rules to the UEs within a specific area, including the roaming UEs, thus the application traffic can be routed with corresponding DNN and/or S-NSSAI in the URSP rules.\n-\tTo avoid breaking the current framework of URSP decision by HPLMN, the V-PCF provides the generated URSP rules to the H-PCF for final decision, which contains the Route Selection Descriptor and Validation Criteria which indicates that the RSD is only applicable in the current VPLMN and its equivalent PLMN(s).\nThe enhancement is to add a new criteria as Applicable PLMN to the Route Selection Validation Criteria in the Route Selection Descriptor, as defined in the Table 6.6.2.1-3 of the TS 23.503 [4].\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.4.2\tProcedure",
                            "text_content": "Figure 6.4.2-1 illustrates the Universal Resource Sharing Protocol (URSP) decision-making process involving Virtualized Packet Core Function (V-PCF). The figure showcases the interaction between the URSP and V-PCF, highlighting how they collaborate to allocate network resources efficiently. The diagram emphasizes the role of the URSP in managing resource requests and the V-PCF's involvement in processing and forwarding these requests. The figure also highlights the importance of virtualization in modern network architectures, enabling dynamic resource allocation and improved network performance.\nFigure 6.4.2-1: URSP decision with V-PCF involvement\n0.\tUE registers to the 5GC via the VPLMN.\n1.\tThe V-PCF determines to generate URSP rules applicable to the UE based on local policies and/or AF/V-UDR interaction, to allow the UE access to the application using the values indicated by specific DNN, and/or S-NSSAI. Besides, the Route Selection Validation Criteria of the RSD contains the PLMN(s) in which the RSD is applicable, e.g. the VPLMN, the PLMN(s) equivalent to the VPLMN.\nNOTE 1:\tThe S-NSSAI within the NSSP provided by the V-PCF is for the HPLMN, which is determined by the V-PCF based on local configuration or based on the mapping of VPLMN S-NSSAIs to HPLMN S-NSSAIs received from the AMF.\nNOTE 2:\tThe equivalent PLMN(s) of the VPLMN can be configured in the V-PCF or received from the AMF.\n2.\tThe V-PCF provides the generated URSP rule(s) to the H-PCF for final decision via Npcf_UEPolicyControl_Update request message.\n3.\tBased on the subscription data and/or local policies, the H-PCF checks whether the received URSP rule(s) can be authorized for the UE, e.g. whether the S-NSSAI in the NSSP is allowed by the subscription NSSAI.\nNOTE 3:\tIt is up to the H-PCF implementation to determine the precedence of the URSP rules originated by the V-PCF.\n4.\tThe H-PCF provides the authorized URSP rules to the V-PCF via Npcf_UEPolicyControl Update response message.\n5.\tThe V-PCF triggers the UE policy delivery via UE configuration Update procedure.\nAfter this procedure, the UE can associate the corresponding application to appropriate PDU Session based on the received URSP rules.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.3\tImpacts on services, entities and interfaces",
                            "text_content": "The solution has impacts in the following entities:\nUE:\n-\tNeeds to support the validation of Applicable PLMN list in RSD Validation Criteria.\nV-PCF:\n-\tNeeds to support the generation of URSP rules applicable to VPLMN only and further provide the generated URSP rules to H-PCF for final decision.\nH-PCF:\n-\tNeeds to perform final decision taking the generated URSP rules from V-PCF into account.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.5\tSolution #5: URSP determination based on service parameter obtained from VPLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.5.1\tDescription",
                            "text_content": "This is a solution for key issue #1 \"URSP in VPLMN\".\nCurrently, URSP is only controlled and determined by HPLMN. Therefore, to give influence on URSP determination, e.g. application guidance for URSP determination specified in clause 4.15.6.10 of TS 23.502 [3], the AF needs to provide inputs to HPLMN. The application guidance for URSP determination may be for Edge services or for location-based services which means there may be the case that the URSP rules determined based on the application guidance can be applied and valid only when the UEs are in any specific VPLMN in roaming case. Anyhow, in this case, the AF may need to provide application guidance for URSP determination to all PLMNs whose subscribers will be probably roaming into the VPLMN, and the AF has service level agreements with. In addition, if the AF includes a geographical area as spatial validity condition in the application guidance for URSP determination, the NEF may need to transform this information into 3GPP identifiers (e.g. TAI(s)). For this, the NEF needs to have knowledge on VPLMN's 3GPP identifiers (e.g. TAI(s)).\nIn this solution, the AF provides application guidance for URSP determination to the PLMN (i.e. to UDR via NEF of this PLMN) where the related services are provided or the related traffic is routed. H-PCF of the roaming UE obtains the application guidance for URSP determination from VPLMN by requesting V-PCF to subscribe to V-UDR to be notified about the data creation/modification for the UE. V-PCF subscribes to V-UDR on behalf of H-PCF, by adding a new PCRT that request notification when Service Parameters are available for a UE Policy Association. If the AF provides inputs to V-UDR via V-NEF, V-PCF provides the data notified by V-UDR to H-PCF.\nThe AF can include the PLMN ID(s) when provisioning application guidance for URSP determination for all HPLMNs whose subscribers may roam into the VPLMN, in order to indicate that the provisioned information is for roamers from that PLMN ID(s). The Application data in UDR is extended to provide PLMN ID as Data Key. Table 6.5.1-1 shows \"PLMN ID\" as an additional Data Key and NOTE 5 describing the \"PLMN ID\" on top of data keys for Application data specified in Table 5.2.12.2.1-1: Data keys in TS 23.502 [3].\nTable 6.5.1-1: Data keys\n\nThis solution reuses the existing Npcf_UEPolicyControl Service for the H-PCF to subscribe to reception of new/updated Service Parameters for the UE, using a new PCRT and for the V-PCF to notify to the H-PCF and provide the Service Parameters for the UE to the H-PCF.\nThe H-PCF generates a new URSP Rule or updates an existing URSP Rule with the same traffic descriptor as provided in the Service Parameters, if the S-NSSAI subscription information indicates that this DNN, S-NSSAI is subscribed, and LBO roaming is allowed.\nThe H-PCF sends the URSP Rule to the UE using existing procedures. In addition, the H-PCF subscribes to \"change of PLMN\", then when the UE moves to a different PLMN, the H-PCF removes or updates the URSP Rule sent to the UE to remove the RSD that routed the traffic thought the VPLMN were the UE was registered. The H-PCF also removes or updates the URSP Rule sent to remove the RSD that routed the traffic though the VPLMN when the V-PCF requests to terminate the UE Policy Association.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.5.1-1: Data keys",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.5.2\tProcedures",
                            "text_content": "Figure 6.5.2.1-1 shows the procedure for URSP determination based on service parameter obtained from VPLMN.\nFigure 6.5.2.1-1 illustrates the procedure for Universal Roaming Service Parameter (URSP) determination based on service parameters obtained from the Visitor Location Register (VPLMN). The figure outlines the steps involved in identifying the appropriate URSP for a roaming subscriber, which is crucial for seamless service continuity during a call. The process begins with the VPLMN providing the service parameters to the Home Location Register (HLR). These parameters include the Home Location Register Identifier (HLRI), Home Location Register Type (HLRType), and the Home Location Register Address (HLRAddress). The HLR then sends these details to the Visitor Location Register (VLR), which is responsible for managing the subscriber's location and service information during the roaming period. The VLR then uses the service parameters to determine the appropriate URSP for the roaming subscriber. This is a critical step in ensuring that the subscriber receives the correct service parameters for their location, enabling them to make and receive calls without interruption. The figure also shows the interaction between the HLR, VLR, and URSP, highlighting the importance of coordination between these components in maintaining a smooth and efficient roaming experience.\nFigure 6.5.2.1-1: Procedure for URSP determination based on service parameter obtained from VPLMN\n1.\tThe UE is registered to 5GC and the UE Policy Association is performed between the AMF and the H-PCF via V-PCF. In addition, the H-PCF may subscribe using a new PCRT \"Service Parameters received\" to the V-PCF. The V-PCF provides the Service Parameters if available.\n2.\tBased on the reception of a new PCRT from the H-PCF, the V-PCF may subscribes to the reception of Service Parameters from the AF for the determination of URSP Rules for any UE of that HPLMN registered in this VPLMN, if not subscribes to V-UDR when the UE Policy Association is created for subscribers of that HPLMN. The V-PCF includes VPLMN DNN and S-NSSAI in the subscription request to the UDR given that the AF provides Application guidance for URSP determination to the VPLMN.\n3.\tTo provide Application guidance for URSP determination as specified in clause 4.15.6.10 of TS 23.502 [3], the AF creates a new request.\n4-6.\tAs specified in steps 2 to 4 in clause 4.15.6.7 of TS 23.502 [3], the AF sends its request to the NEF, and the NEF stores the AF request information in the UDR and responds to the AF. In this figure, the NEF is V-NEF and the UDR is V-UDR.\nThe AF request is targeting any UE (all UEs) of a HPLMN that are registered in this VPLMN. Therefore, the V-NEF authorizes the request based on local policy based on service level agreements between the AF and the VPLMN (e.g. based on AF Id) without requesting for any service specific authorization from UDM as specified in clause 4.15.6.10 of TS 23.502 [3].\nNOTE:\tThe AF request targeting a specific UE or a group of UE(s) does not apply to this solution because Service Specific Authorization for an individual UE or group of UEs by NEF to UDM has to be performed for the AF request as specified in clause 4.15.6.10 of TS 23.502 [3].\n7.\tThe V-PCF receives a Nudr_DM_Notify notification of data change from the V-UDR.\n8.\tThe V-PCF sends the notification of data change from the V-UDR invoking Npcf_UEPolicyControl_Update including the Service Parameters that have been received from the UDR to the H-PCF. The V-PCF also provides the mapping of the VPLMN S-NSSAI to HPLMN S-NSSAI and the mapping of the VPLMN DNN to HPLMN DNN to the H-PCF.\n9.\tThe H-PCF determines the URSP rules that is to be sent to the UE based on the Service Parameters received from the V-PCF and the S-NSSAI subscription information for this SUPI, DNN, S-NSSAI retrieved from the UE context policy control subscription information from the UDR The H-PCF generates a new URSP Rule or update an existing URSP Rule that was sent to the UE for the same traffic descriptor to include a new RSD with the DNN, S-NSSAI provided by the V-PCF then sets the RSD precedence and validity conditions taking the information provided by the V-PCF into account.\nThat is, the H-PCF replaces any URSP rules related to Route Selection Descriptor(s) including the DNN and S-NSSAI.\n10.\tThe H-PCF provisions the URSP rules to the UE via the V-PCF by using the UE Configuration Update procedure for transparent UE Policy delivery as specified in clause 4.2.4.3 of TS 23.502 [3]. The H-PCF provides S-NSSAI and DNN values of the VPLMN to the UE in the RSD component of the URSP rule.\n11.\tThe UE needs to send traffic, e.g. destined to an Edge service. Therefore, the UE determines a URSP rule applicable for the traffic. For URSP Rules applicable in the VPLMN the UE considers a RSD valid if the S-NSSAI value is in the Allowed NSSAI instead of the Mapping Of Allowed NSSAI.\n12.\tIf there is no PDU Session that matches all components in the selected RSD within the URSP rule, the UE establishes a PDU Session. The UE provides both the S-NSSAI of the VPLMN, i.e., the S-NSSAI in the URSP Rule, and the S-NSSAI of the HPLMN obtained from the mapping of the Allowed NSSAI to HPLMN S-NSSAI as described in clause 5.15.5.3 of TS 23.501 [2]. The UE includes the DNN of the VPLMN, i.e., the DNN in the URSP Rule if provided as UE Requested DNN, as described in clause 6.6.2.1 of TS 23.503 [4]. If the UE Requested DNN is supported but not subscribed, then the AMF checks if there is a mapping to the HPLMN DNN configured, then uses it for subscription check. The AMF uses the UE Requested DNN as Selected DNN, then performs SMF selections. The AMF sends both the Selected DNN (i.e. UE Requested DNN) and the DNN value of the HPLMN to SMF. The SMF uses the DNN value of the HPLMN and the S-NSSAI value of the HPLMN for subscription check as described in clause 4.3.2.2.1 of TS 23.502 [3].\n13.\tThe UE communicates with the Application Server, e.g. Edge Application Server.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.3\tImpacts on services, entities and interfaces",
                            "text_content": "H-PCF:\n-\tSubscribes to a new PCRT \"Service Parameters received\".\n-\tReception of Service Parameters for a UE Policy Control Association established with the V-PCF.\n-\tDetermines URSP rules based on the data provided by AF and received via V-UDR and V-PCF, taking S-NSSAI subscription information into account.\n-\tS-NSSAI subscription information extended to include if LBO is allowed.\nV-PCF:\n-\tSubscribes to V-UDR to be notified about the Service Parameters creation/modification for roaming UEs if the H-PCF provided a PCRT.\n-\tProvides the Service Parameters notified by V-UDR to H-PCF.\nH-UDR:\n-\tS-NSSAI Subscription information needs to include an indication of whether LBO roaming is allowed for a DNN, S-NSSAI.\nUE:\n-\tFor URSP Rules applicable in the VPLMN the UE considers the RSD valid if the S-NSSAI value is in the Allowed NSSAI instead of the Mapping Of Allowed NSSAI.\nAMF:\n-\tAt PDU Session Establishment uses the UE requested DNN as Selected DNN, for subscription check the AMF maps the UE Requested DNN to HPLMN DNN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.6\tSolution #6: Solution for URSP in VPLMN with PLMN domain indication",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.6.1\tGeneral",
                            "text_content": "As specified in TS 23.503 [4], the URSP is only to be provided by the HPLMN. However, there are cases where different VPLMNs have different preference on the PDU session parameters for the same application. To support such differentiated URSP handling in different PLMNs, following enhancements are required:\n-\tEnhance the URSP provision so that the URSP rules are provided with PLMN ID(s) associated.\n-\tAllowing the UE to utilize the URSP rules associated with the serving PLMN fist, and if no match is found, utilize the URSP of the HPLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.2\tFunctional descriptions",
                            "text_content": "The VPLMN provides the URSP applicable to the UE to HPLMN. This may be triggered by the UE's registration in the VPLMN or happen before UE roam into the VPLMN. AF in VPLMN may use the service specific parameter procedure to influence HPLMN generating the URSP for VPLMN.\nFor how the UE identify VPLMN’s URSP rules, there are two options as below.\nOption-1: The HPLMN constructs the URSP for the UE, with different list of PSIs associated with the different VPLMN IDs which are outside of PSI, then sends the mapping table to UE together with UE Policy Sections containing the URSP. Some examples are shown in below:\n<VPLMN #1 ID, list of PSIs>;\n<VPLMN #2 ID, list of PSIs>;\n. . .\n<VPLMN #n ID, list of PSIs>.\nThe HPLMN ensures that the URSP rules associated with the VPLMN IDs only apply to the PDU session that supports LBO. This solution maintains the Rel-17 principle that the HPLMN ID is always part of the PSI when the policy section carries a URSP rule, thus there will continue to be no conflict between VPLMN allocated PSI's (which do not carry URSP rules) and HPLMN allocated PSIs.\nThe UE is provisioned with the URSP rules following the existing procedure as defined in TS 24.501 [7]. The UE stores the list of PSIs associated with PLMN IDs.\nWhen UE registered in the VPLMN, it locates the list of PSIs associated with the VPLMN-ID and the list of PSIs associated with HPLMN-ID.\nUE applies the URSP rules associated with the VPLMN ID first, if any. If there is a match, the UE follows the URSP rule to establish the PDU session.\nIf the UE does not find a match using the URSP rules associated with the VPLMN ID, it uses the URSP rules associated with the equivalent VPLMN ID, if any. If there is no URSP rules associated with the equivalent VPLMN ID, the UE uses the URSP rules associated with the HPLMN ID.\nThe UE does not use other URSP rules than those associated with the VPLMN ID, equivalent VPLMN ID or HPLMN IDs.\nOption-2: alternatively, if the new mapping table is not used, the (H-)PCF provides URSP Rules that are identified by the HPLMN ID as defined in TS 23.503 [4]. The PCF removes the URSP Rules applicable for the Serving PLMN when the UE Policy association with the V-PCF in the Serving PLMN is terminated or when the UE moves to a different Serving PLMN and a change of PLMN PCRT is reported via V-PCF. The H-PCF provides a list of PSIs identified by the HPLMN ID, the location validity conditions in the URSP Rule may contain a list of TAI(s) or Cell ID(s). The URSP policy can be used to the registered VPLMN and its equivalent VPLMN, however cannot be used for other PLMNs. In order to avoid using a wrong URSP rules, the UE may remove all URSP rules when it moves to a different PLMN except the equivalent PLMN. This option-2 reduces the number of URSP Rules that are sent to the UE and the number of URSP Rules that needs to be evaluated by the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.3\tProcedures",
                            "text_content": "The existing procedures as defined in TS 24.501 [7] for UE Policy provisioning can be reused, besides the above enhancements.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.4\tImpacts on services, entities, and interfaces",
                            "text_content": "For Option-1 (provisioning mapping table along with URSP rules), the impacts on existing entities:\n-\tUE needs to utilize URSP rules associated with the VPLMN or Equivalent PLMN if no VPLMN URSP rules, before applying URSP rules associated with HPLMN.\n-\tA mapping between VPLMN ID and PSI sets need to be provisioned to UE along with the Policy Sections containing URSP rules.\nFor Option-2 (provisioning new URSP rules when PLMN changes), the impact on existing entities:\n-\tThe UE may remove all URSP rules when it moves to a different PLMN except an equivalent VPLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.7\tSolution #7: URSP Compliance Verification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.7.1\tDescription",
                            "text_content": "This solution addresses the following technical issues of the KI#2:\n-\tWhether and how the 5GC can be made aware whether or when the UE enforces a URSP rule to route an application traffic to a PDU Session based on the URSP rule provisioned by 5GC.\n-\tWhether there are any actions the 5GS can take after 5GC is aware whether the UE enforces a URSP rule for specific application traffic or not. If any, what action 5GC should take?\nIn the current 5GC, there is no way to check whether the application traffic from the UE is compliant with the URSP.\nThe URSP is composed of Traffic Descriptor and Route Selection Component. The UE can associate application with the existing PDU Session or request a new PDU Session if no PDU Session matches the URSP rules when the application is detected. In this solution, we focus on the case when the UE requests a new PDU Session and discuss how the 5GC can know whether the requested PDU Session is compliant with the URSP.\nIn order to check whether the PDU Session Establishment request is compliant with URSP rule, the 5GC needs to identify the request is caused by which URSP rule. The PDU Session Establishment request can include RSC of the URSP rules, however, there is no information which URSP rule (i.e. Traffic Descriptor) matches.\nTherefore, we introduce an identifier for the URSP Rule so that the PCF can identify which URSP rule causes the request of the PDU Session. If the UE includes the matched URSP Rule Identifier in the PDU Session Establishment request, the 5GC can be aware of the association between the URSP rules and the PDU Session so that 5GC can verify whether the UE is compliant with the URSP rules.\n1.\tWhen constructing a URSP rule, URSP Rule Identifier (URID) is added to identify the URSP rule.\n2.\tUE reports the URSP Rule Identifier associated with URSP rules causing a new PDU Session Establishment request by including the URID in the same request based on the PCF demand.\nWhen the SMF is reported for the associated URID, it should be reported to the PCF responsible for the URSP (i.e. UE-PCF). Since the multiple SM-PCFs can be used for one UE, we assume UE-PCF and SM-PCF may not be the same and the UE-PCF is responsible for URSP compliance verification.\nSince SMF may not have a direct interface to the UE-PCF, we use the reporting path from the SMF to the UE-PCF via SM-PCF in order for the SMF to report the URID and its received PDU Session Parameters (PSP).\nIf the 5GC identifies that the UE is not compliant to the URSP rule, the 5GC does not allow the UE to establish a new PDU Session based on its policy.\nThe abstract of this solution is depicted in the Figure 6.7.1-1.\nFigure 6.7.1-1 illustrates the authorization process for a User Equipment (UE) Session Data Unit (PDU) Session, where the User-to-Network Signaling Protocol (URSP) is verified. The figure depicts the interaction between the Base Transceiver Station (BTS), the Home Location Register (HLR), and the Authentication, Authorization and Accounting (AAA) server. The UE reports its URSP rule identifier, which is then authenticated and authorized by the AAA server. The process ensures secure and controlled access to network resources for the UE.\nFigure 6.7.1-1: Authorization of URSP verified PDU Session with the UE reported URSP rule identifier\nThe UE-PCF is responsible for URSP compliance verification. The UE-PCF sends URSP Authorization Request Indication (UARI) to the AMF when the UE Policy Association is established or notified with the update.\nIf AMF receives UARI and PCF binding info, it stores the information and sends them to the SMF during the PDU Session Establishment procedure.\nNOTE:\tThis solution uses the existing feature that the AMF stores the PCF ID so that the SM-PCF can use it to contact the UE-PCF.\nWhen the SMF establishes the SM Policy Association, the SMF forwards the UARI and Received PDU Session Parameters (R-PSPs) to the SM-PCF. If the SM-PCF receives the UARI request, it performs the URSP Authorization procedure with UE-PCF with the R-PSPs received from the SMF through SM-PCF and URID received from the UE.\nThe UE-PCF can request the UE to assist the URSP compliance by sending URSP Compliance Request (UCR) together with URSP rules with the UE Policy Container. The UCR indicates the UE to report the URSP Rule Identifier (URID) associated URSP rule that causes the establishment of the PDU Session. If the UE receives the UCR, the UE includes the URID in the PDU Session Establishment request when initiating a PDU Session caused by the URSP rule.\nWhen the SMF is requested for UARI and receives the PDU Session Establishment Request, the SMF requests the authorization of the PDU Session from the UE-PCF through SM-PCF. The UE-PCF checks the R-PSP requested by the UE and the URID to verify whether the PDU Session Establishment request is compliant with the URSP rule.\nThe UE-PCF can take other actions later instead of immediate authorization of the PDU Session. In this scenario, the UE-PCF can receive the reporting of the established PDU Session from the SM-PCF. The UE-PCF requests the PDU Session Parameters Reporting (PSPR) instead of UARI. The abstract procedure of this alternative is described in the Figure 6.7.1-2. When the PSPR is requested from the UE-PCF, the SM-PCF notifies the PDU Session Parameters to the UE-PCF.\nFigure 6.7.1-2 illustrates the process of PDU Session Parameter Reporting with the UE reported URSP rule identifier. The figure depicts the interaction between the User Equipment (UE) and the Policy and Charging Rules Function (PCRF), which is responsible for managing and charging for network services. The PCRF receives the User-Specific Reference Signalling (URSP) from the UE, which contains information about the session parameters. The PCRF then processes this information and sends a response back to the UE, which includes the rule identifier for the session. This process ensures that the correct rules are applied to the session, allowing for efficient and accurate management of network resources.\nFigure 6.7.1-2: PDU Session Parameter Reporting with the UE reported URSP rule identifier\nDue to various reasons, the UE-PCF does use the URSP rule identifier reporting. The UE-PCF performs the authorization of the URSP verified PDU Session without UE reporting as depicted in the Figure 6.7.1-3. In this scenario, the procedure is similar to the Figure 6.7.1-1 except the following differences:\n-\tThe UE-PCF provides the URSP rules without URSP rule identifier and does not command URSP Compliance Request to the UE.\n-\tThe UE does not report the URSP rule identifier when establishing the PDU Session.\nFigure 6.7.1-3 illustrates the authorization process for a PDU Session without the involvement of the User Equipment (UE). The figure depicts the steps taken by the Universal Resource Sharing Point (URSP) to verify the PDU Session and grant access. The process begins with the URSP receiving a request from the PDU Session, which is then authenticated and authorized. The figure shows the interaction between the URSP, the PDU Session, and the Network Elements involved in the process. The authorization is depicted as a successful interaction, with the URSP granting access to the PDU Session, ensuring secure and efficient network operations.\nFigure 6.7.1-3: Authorization of URSP verified PDU Session without UE reporting\nSimilarly, the UE-PCF does use the URSP rule identifier reporting. The UE-PCF requests the PDU Session Parameter Reporting. The abstract procedure is described in Figure 6.7.1-4.\nFigure 6.7.1-4 illustrates the authorization process for a PDU Session without the involvement of the User Equipment (UE). The figure depicts the various steps taken by the Universal Radio Service Procedure (URSP) to verify the PDU Session, ensuring secure and authorized communication. The process involves the Radio Access Network (RAN) and the Core Network, with the RAN responsible for authentication and the Core Network handling authorization. The figure highlights the importance of secure communication in telecommunication networks, emphasizing the need for robust authentication and authorization procedures.\nFigure 6.7.1-4: Authorization of URSP verified PDU Session without UE reporting\nConsideration on Requested PDU Session Parameters\nFor the PCF for the UE to verify the appropriate RSD provided by the UE in the PDU Session Establishment request, the SMF should be able to delivery the RSD parameters that it receives from the UE to the SM-PCF.\nAmong the Route selection components in URSP rules, the PDU Session Parameters such as DNN, S-NSSAI, PDU Session Type, Access Type that the UE sent to the SMF can be delivered to the PCF.\nHowever, the SSC Mode, PDU Session Pair ID, RSN are required to be sent to the PCF so that the PCF can validate parameters.\nNOTE:\tNon-seamless Offline indication and ProSe Layer-3 UE-to-Network Relay Offload indication is not subject to be verified in the serving network.\nTable 6.7.1.1: Comparison between URSP RCS and the parameters in SMPolicyControl service operation\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.7.1.1: Comparison between URSP RCS and the parameters in SMPolicyControl service operation",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.7.2\tProcedures",
                            "text_content": "This procedure describes the provisioning of URSP Compliance Verification procedure during the UE registration procedure. With this procedure, the UE-PCF performs the following:\n1)\tUE-PCF indicates the UE to report the URSP Rule Identifier associated with URSP rules causing a new PDU Session Establishment request by including the URID in the same request.\n2)\tUE-PCF provides PDU Session Parameter Reporting (PSPR) or URSP Authorization Request Indication (UARI) with PCF binding information to the AMF so that the AMF sends them to the SMF during the PDU Session Establishment procedure.\nFigure 6.7.2 .1 -1 illustrates the provisioning of URSP compliance verification during the registration procedure, showcasing the interaction between the network elements and the compliance verification process. The figure highlights the role of the service provider (SP) and the user equipment (UE) in ensuring that the user's radio access network (RAN) complies with the Universal Radio Access Network (URAN) standards. The figure also emphasizes the importance of accurate and timely compliance verification, which is crucial for maintaining network quality and ensuring seamless communication between the SP and the UE.\nFigure 6.7.2.1-1: Provisioning of URSP Compliance Verification during Registration procedure\n1.\tThe UE, that is compliant with URSP and supports the reporting URSP identifier, sends URSP Compliance Capability Indicator (UCCI) within the UE Policy Container during the registration procedure.\n2.\tThe UE-PCF determines whether to perform the URSP compliance verification procedure (e.g. URSP compliant PDU Session Authorization or PDU Session Parameter Reporting).\n3.\tThe UE-PCF sends PSPR (PDU Session Parameter Reporting Request) or URSP Authorization Required Indication (UARI) to the AMF. The AMF records the PCF binding info (PCF ID)\n4-5.\tThe UE-PCF provides the URSP Compliance Reporting (UCR) and the URSP rules in UE Policy Container. When the UE-PCF constructing a URSP rule, URSP Rule Identifier (URID) is added to identify the URSP rule. The UE-PCF provides the URSP rules within which each URSP rule is identified by the URSP identifier.\n5.\tWhen the UE receives the UE Policy Container, the UE stores the URSP rules with URID and UCR.\n6.\tThe UE sends the acknowledgement of UCR with the URID that the UE is compliant with them.\n7.\tThe UE-PCF receives the UCR acknowledgement.\nThis procedure describes the URSP Compliance Verification during the PDU Session Establishment procedure:\n1)\tAuthorization of URSP compliant PDU Session Establishment with (or without) UE reporting URSP rule identifier. (UARI).\n2)\tReporting of PDU Session Parameters with (or without UE) UE reporting URSP rule identifier (PSPR).\nFigure 6.7.2.2-1 illustrates the process of URSP compliance verification during PDU session establishment. The figure depicts the interaction between the P-CSCF (Proximity Call Session Control Function) and the S-CSCF (Serving Call Session Control Function) in a network. The P-CSCF initiates the session and ensures that the user's device complies with the URSP (User-Related Session Parameters) requirements. The S-CSCF then verifies the compliance and proceeds with the session establishment. The figure highlights the importance of accurate URSP configuration for a successful PDU session, emphasizing the role of the P-CSCF and S-CSCF in maintaining network integrity and user experience.\nFigure 6.7.2.2-1: URSP Compliance Verification during PDU Session Establishment\n1.\tAfter the UE evaluates URSP rules, the UE detects an application that matches the URSP rule and determines to establishment a new PDU Session based on the URSP. If the UE receives the URSP Compliance Request (UCR) in the provisioning of URSP compliance verification during registration procedure (see the step 5 of Figure 6.7.2.1-1), the UE sends the PDU Session Establishment request including the URSP Rule Identifier (URID) associated with URSP rule causing the establishment of this PDU session.\nNOTE 1:\tNo new privacy issue is caused by this solution.\n2.\tThe AMF forwards the PDU Session Establishment to the SMF. If the PSPR or UARI is requested from the UE-PCF, the AMF forwards the request to the SMF together with PCF binding info.\n3.\tUARI mode: The SMF sends Requested PDU Session Parameters (R-PSPs). The R-PSPs include the DNN, S-NSSAI, PDU Session Type, Access Type, which already appear in Npcf_SMPolicyControl_Create request. In addition, the R-PSPs include the SSC Mode, PDU Session Pair ID, RSN if the UE sent in the PDU Session Establishment request so that the PCF can validate the parameters.\n4.\tIf the UE-PCF has requested UARI (as in the step 3 of Figure 6.7.2.1-1), the SM-PCF sends the URSP Compliance Authorization Request to the UE-PCF.\n5.\tThe UE-PCF verify whether the UE is compliant with the URSP rules by checking the requested PDU Session parameters with the URSP rules (RSDs) and authorises the UE requested PDU Session. The UE-PCF is able to reject the PDU Session if the UE-PCF determines that the request is not compliant with URSP rules.\nOnce the UE-PCF authorises the URSP compliance, the UE-PCF sends URSP Compliance Authorization Response including the URSP compliance result.\nNOTE 2:\tWhen UE-PCF and SM-PCF is deployed in the same entity, the step 4~5 and 11 are not exposed.\n6.\tIf URSP compliance result is successful, the SM-PCF sends the authorized policy information to the SMF. The SMF forwards the URSP compliance result.\n7.\tIf the SMF is requested with UARI and the URSP Compliance Authorization Result is not successful, the SMF reject the PDU Session Establishment.\n8.\tThe AMF forwards the PDU Session Establishment Accept/Reject to the UE.\n9.\tThe AMF updates the SM context.\n10.\tAfter the successful establishment of the PDU Session, if the SMF is indicated with the PSPR, the SMF reports the A-PSPs to the SM-PCF.\nNOTE 3:\tThe UE-PCF can stores the established PDU Session Parameters and later it can use them to verify whether the UE is compliant with selecting the PDU Session for the corresponding application or application traffic by using application detection feature.\n11.\tIf the SM-PCF is requested with PSPR to the UE-PCF, the SM-PCF notifies the UE-PCF of the PDU Session Status, PDU Session ID and URID, A-PSP. The UE-PCF records A-PSP, PDU Session ID associated with the URSP Rule Identifier for verification of the URSP compliance.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.7.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE:\n-\tThe UE should understand the URSP Rule Identifier referring URSP Rules and be able to identify the URSP rule when initiating a PDU Session.\n-\tThe UE should be able to report the URSP Rule Identifier in the PDU Session Establishment Request.\n-\tThe UE should be able to report the complied URSP Rule Identifiers back to the UE-PCF.\nNOTE:\tDue to UE design philosophy, some of UE implementation may not support some of Traffic Descriptors in the URSP Rule. For those URSP rules, the UE may reply to the UE-PCF with sending the compiled URSP Rule Identifiers with UE policy delivery result.\nAMF:\n-\tThe AMF should be able to receive the request (i.e. either URSP Compliance Authorization or PDU Session Parameter Reporting) and its related parameters from the UE-PCF during UE Policy Association procedure.\n-\tWhen receiving PDU Session Establishment request from the UE, the AMF should forward the request from the UE-PCF to the SMF.\nSMF:\n-\tFor URSP Compliance Authorization, the SMF should authorize the UE requested PDU Session based on the response from the SM-PCF after the UE-PCF authorizes the request via SM-PCF.\n-\tFor PDU Session Parameter Reporting, the SMF should report the requested and accepted PDU Session Parameters to the SM-PCF so that SM-PCF can report those to the UE-PCF.\nSM-PCF:\n-\tFor USSP Compliance Authorization, during the SM Policy Association procedure caused by the PDU Session Establishment, the SM-PCF performs the URSP compliance authorization with UE-PCF.\n-\tFor PDU Session Parameter Reporting, after the PDU Session Establishment procedure, the SM-PCF reports the UE requested and accepted PDU Session Parameters to the UE-PCF.\nUE-PCF:\n-\tThe UE-PCF is responsible for URSP compliance verification. The UE-PCF should be able to support 1) URSP Compliance Reporting 2) URSP Compliance Authorization 3) PDU Session Parameter Reporting.\n-\tFor URSP Compliance Reporting (UCR request) to the UE, the UE-PCF generates the URSP rules with URSP Rule Identifier and request the UE to report the URSP Rule Identifier.\n-\tFor URSP Compliance Authorization (UARI), the UE-PCF should be able to authorize the UE-requested PDU Session by checking whether the PDU Session Parameters of the request is compliant to the RSD's of URSP rules.\n-\tFor PDU Session Parameter Reporting (PSPR), the UE-PCF should be able to request the SMF to report the PDU Session Parameters of the request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.8\tSolution #8: URSP Rule Precedence reporting for awareness of URSP enforcement",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.8.1\tDescription",
                            "text_content": "This solution aims to address the Key Issue#2: 5GC awareness of URSP enforcement.\nIt is proposed to use the parameter of URSP Rule Precedence to identify a specific URSP rule.\nThe UE can indicate to the network the URSP rule it is trying to enforce by reporting the URSP Rule Precedence. When an existing PDU session matches the RSD of selected URSP, or when the UE tries to establish a new PDU Session using the values specified by the selected RSD, the URSP enforcement reporting process can be done during a session management procedures such as PDU Session Establishment procedure or PDU Session Modification procedure.\nTo protect user privacy, the URSP enforcement reporting process shall be subject to user consent. The user consent is obtained by the ASP and provided to the MNO. The information of user consent for URSP enforcement reporting is included per URSP rules and provisioned to the UE. The UE reports the URSP Rule Precedence of the URSP rule it is trying to enforce only when the user consent part of the URSP rule is \"YES\".\nNOTE:\tThe procedures to obtain user consent need to be studied by SA3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.8.2\tProcedures",
                            "text_content": "As described in TS 23.503 [4], for every newly detected application the UE evaluates the URSP rules in the order of Rule Precedence and determines if the application is matching the Traffic descriptor of any URSP rule. When a valid Route Selection Descriptor is found, the UE determines if there is an existing PDU Session that matches all components in the selected Route Selection Descriptor.\nIf one or more matching PDU Session(s) exist(s), the UE associates the application to one existing PDU Session and initiates PDU Session Modification procedure for URSP enforcement reporting as described in clause 4.3.3.2 of TS 23.502 [3]. Following impacts are applicable:\n-\tStep 1a: The UE includes UE Policy Container (URSP Rule Precedence corresponding to the URSP rule enforced by the UE, and the operating system identifier) in PDU Session Modification Request message. The AMF transfers the message transparently to the SMF via Nsmf_PDUSession_UpdateSMContext message.\n-\tStep 2: After receiving UE Policy Container in the PDU Session Modification Request message, the SMF forwards the PCF the UE Policy Container reported by the UE using Npcf_SMPolicyControl_Update service operation. The PCF returns the URSP rule indicated by the URSP Rule Precedence to the SMF.\nThe SMF compares the RSD of the URSP rule received from the PCF with the PDU session attributes (e.g. DNN, S-NSSAI, etc) of the PDU session the UE trying to associate to. If it is not matched, the SMF rejects the PDU Session Modification request with a proper cause value.\n-\tStep 2a/2b: The SMF generates N4 rules (PDR, URR) based on the Traffic Descriptor of the URSP rule received from the PCF and provisions the rules to the UPF using N4 Session Modification procedure. The SMF indicates the UPF to report the event when incorrect application traffic is detected for the QoS Flow indicated in the PDR.\nWhen incorrect application traffic is detected, the UPF should send a report to the SMF. The SMF should further inform to the PCF that the URSP rule is wrongly enforced by the UE. The PCF can decide whether to update the URSP rules to the UE based on local configuration and operator policies (e.g. update the URSP via UCU procedure by excluding the wrongly enforced URSP rule).\nNOTE 1:\tIt is assumed that same PCF is selected by the SMF and the AMF.\nNOTE 2:\tThe PDR sent from the SMF to the UPF indicates the QFI and a Packet Filter Set, any traffic in the QoS Flow identified by the QFI does not match the Packet Filter Set deemed as incorrect application traffic.\nIf none of the existing PDU Sessions matches the selected Route Selection Descriptor, the UE tries to establish a new PDU Session as described in clause 4.3.2.2.1 TS 23.502 [3] using the values specified by the selected RSD. Following impacts are applicable for URSP enforcement reporting:\n-\tStep 1: The UE includes UE Policy Container (URSP Rule Precedence corresponding to the URSP enforced by the UE, and the operating system identifier) in PDU Session Establishment Request message.\n-\tStep 3: The AMF transfers the PDU Session Establishment Request (UE Policy Container (URSP Rule Precedence corresponding to the URSP rule enforced by the UE, and the operating system identifier)) to the SMF by Nsmf_PDUSession_CreateSMContext Request message.\n-\tStep 7b: After receiving UE Policy Container in the PDU Session Establishment Request message, the SMF forwards to the PCF the UE Policy Container reported by the UE using Npcf_SMPolicyControl_Create service operation. The PCF returns the URSP rule indicated by the URSP Rule Precedence to the SMF.\nThe SMF compares the RSD of the URSP rule received from the PCF with the PDU session attributes (e.g. DNN, S-NSSAI, etc) of the PDU session the UE trying to establish. If it is not matched, the SMF rejects the PDU Session Establishment request with a proper cause value.\n-\tStep 10a/10b: The SMF generates N4 rules (PDR, URR) based on the Traffic Descriptor of the URSP rule received from the PCF and provisions the rules to the UPF using N4 Session Establishment procedure. The SMF indicates the UPF to report the event when incorrect application traffic is detected for the QoS Flow indicated in the PDR.\nWhen incorrect application traffic is detected, the UPF should send a report to the SMF. The SMF should further inform to the PCF that the URSP rule is wrongly enforced by the UE. The PCF can decide whether to update the URSP rules to the UE based on local configuration and operator policies (e.g. update the URSP via UCU procedure by excluding the wrongly enforced URSP rule).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.8.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE:\n-\tInitiates PDU Session Modification procedure when matching PDU Session is found for a URSP rule, and includes UE Policy Container (URSP Rule Precedence corresponding to the URSP enforced by the UE, and the operating system identifier) in PDU Session Modification Request message.\n-\tDuring the new PDU Session Establishment procedure when none of the existing PDU Sessions matches the selected Route Selection Descriptor, includes UE Policy Container (URSP Rule Precedence corresponding to the URSP enforced by the UE, and the operating system identifier) in PDU Session Establishment Request message.\nSMF:\n-\tForwards the UE Policy Container reported by the UE to the PCF.\n-\tCompares the RSD of the URSP rule received from the PCF with the attributes of the PDU session the UE trying to establish or associate to.\n-\tGenerates N4 rules (PDR, URR) based on the Traffic Descriptor of the URSP rule received from the PCF.\n-\tIndicates the UPF to report the event when incorrect application traffic is detected for the QoS Flow indicated in the PDR.\n-\tForwards the incorrect application traffic detection report received from UPF to the PCF.\nPCF:\n-\tBased on the UE Policy Container received from the SMF, provides corresponding URSP rule to the SMF.\n-\tDecides whether to update the URSP to the UE by the UCU procedure when incorrect application traffic detection report is received from the SMF.\nUPF:\n-\tDetects application traffic and reports to the SMF when incorrect application traffic is detected.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.9\tSolution #9: Per-PDU session awareness of URSP enforcement",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.9.1\tDescription",
                            "text_content": "Editor's note:\tThis clause will describe the solution principles and architecture assumptions for corresponding key issue(s) which should be explicitly stated. Clause(s) may be added to capture details.\nThe main use case of this solution is to support a network operator to determine if a UE routes application traffic to an established PDU session of a specific DNN/S-NSSAI according to a URSP rule. For example, when the UE establishes a PDU session to an S-NSSAI/DNN that is used for enterprise services, based on a specific URSP rule, the network operator verifies that the UE does not route application traffic that is not intended for enterprise services.\nThe solution relies on the PCF to identify if a UE routes traffic correctly when the UE establishes a PDU session for an S-NSSAI/DNN/RAT type that matches a Route Selection Descriptor of a URSP rule that was provisioned to the UE.\nThe PCF determines to identify if the UE routes traffic correctly to the UE requested PDU session based on local configuration or based on information provided by the UDR. In such scenario, the PCF determines the applicable URSP rule that triggered the UE to request establishment of a PDU session to a specific S-NSSAI/DNN by obtaining the list of PSIs containing the provisioned URSP rules to the UE from the UDR. The PCF then identifies the traffic allowed to the requested S-NSSAI/DNN by identifying URSP rule(s) that have within a Route Selection Descriptor, components that matches the requested S-NSSAI/DNN and then evaluating the Traffic Descriptor of such URSP rule(s). For example, if the Traffic Descriptor includes a Destination Address IP 3 tuple then the PCF considers allowed traffic any traffic sent to or received via the Destination Address.\nWhen the PCF is triggered to identify if the UE routes traffic to an S-NSSAI/DNN according to a provisioned URSP rule the PCF provides rules to the SMF to report traffic that is not intended to be routed via the PDU session. Further details are provided below.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.9.2\tProcedures",
                            "text_content": "Editor's note:\tThis clause describes high-level procedures and information flows for the solution.\nThe procedure is shown below:\nFigure 6.9.2-1 illustrates the process of PCF (Policy and Charging Framework) requests to identify from an UPF (User Plane Function) if a UE (User Equipment) enforces URSP (User-Related Service Profile) rules correctly. The figure depicts the interaction between the PCF and UPF, highlighting the role of the PCF in policy enforcement and the UPF's responsibility in ensuring that the UE adheres to the specified rules. The diagram emphasizes the importance of accurate rule enforcement for maintaining network security and resource management.\nFigure 6.9.2-1: PCF requests to identify from UPF if UE enforces URSP rules correctly\nThe procedure is as follows:\n0.\tAn application in the UE sends traffic or request a network connection.\n1.\tThe UE detects new application traffic and determines that application traffic needs to be routed via a PDU session of a specific DNN, S-NSSAI, RAT type. The determination may be based due to a configured URSP rule, local configuration or application request.\n2.\tThe UE requests establishment of a PDU session using specific S-NSSAI, DNN, SSC mode. Optionally, provided that there is user consent, if the determination in step 1 was made due to a URSP rule the UE may include a URSP indication in the PDU session establishment request provided that there is user consent. The indication may include an identifier of the URSP rule that triggered the UE to request establishment of a PDU session or may include the Policy Section Identifier of the policy section that contained the URSP rule that triggered the PDU session establishment.\n3.\tThe SMF selects a PCF and requests policies by establishing an SM Policy Association. The SMF sends an Npcf_SM_PolicyControl_Create including the SUPI, PDU session ID, DNN, S-NSSAI requested and RAT type of the access that the UE requested establishment of a PDU session.\n4.\tThe PCF determines to check for the UE requested PDU session if the UE routes traffic according to a provisioned URSP rule.\nThe PCF may be pre-configured or configured from the UDR with the allowed traffic when a UE establishes a PDU session to a specific S-NSSAI/DNN. Alternatively steps 5 takes place.\n5.\tThe PCF determines the potential URSP rule and the corresponding Traffic Descriptor of the URSP rule that triggered the UE to request establishment of a PDU session to a specific S-NSSAI/DNN.\n5a.\tThe PCF obtains the URSP rule by interfacing with the UDR to obtain the policy sections of URSP rules provisioned to the UE. The PCF may include the PSI identifier or URSP rule id if included by the UE in step 2.\n5b.\tThe UDR provides the policy sections of the URSP rule.\n6.\tThe PCF makes policy decisions according to UE subscription.\n7.\tThe PCF provides PDU session related information rules and PCC rules in an Npcf_SMPolicyCreate_Response. The PCF also includes rules to the SMF to report non-matching traffic (i.e. traffic different to the allowed traffic) via the S-NSSAI, DNN. The PCF includes the Allowed Traffic that can be routed via the PDU session.\nNOTE:\tThe PCF may provide rule at a later stage by invoking an Npcf_SMPolicyModication request.\n8.\tSMF based on the PCC rules installs N4 rules at the UPF. SMF includes rules to the UPF to report non-matching traffic via the S-NSSAI, DNN and includes also the allowed traffic.\n9.\tWhen the UPF detects non-matching traffic the UPF reports the traffic to the SMF. The UPF includes the service data flow information of the non-matching traffic detected.\n10.\tThe SMF reports the detected information to the PCF.\n11.\tThe PCF determines if the traffic reported should be sent via a different S-NSSAI or whether traffic should be blocked. The PCF may install rules to the SMF to block such traffic or determine new URSP rules to route traffic via a different S-NSSAI.\n12.\tThe PCF provides updated URSP rules to the UE using the UE Configuration Update for transparent policy delivery.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.9.3\tImpacts on services, entities and interfaces",
                            "text_content": "Editor's note:\tThis clause captures impacts on existing 3GPP nodes and functional elements.\n-\tUPF report SDFs that do not match to allowed traffic.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.10\tSolution #10: Network based URSP rules enforcement feedback",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.10.1\tDescription",
                            "text_content": "The UE uses URSP rules to apply the application traffic to PDU sessions in UE. But, for some of the situation, the 5GC wants to aware of the enforcement of URSP rules in UE.\nOne of the solutions is, according to the URSP rules, the UPF sets the PDR in specific UE's PDU session. If the specific application packets are detected by PDR, it means the application traffic is applied to this PDU session, and the parameters of this PDU session can be used to reverse to determine the RSD. Which RSDs contains the PDU session parameters, is the real URSP rules that used in UE for this application traffic.\nIf PCF wants to monitor some of the enforcement of the RSD in specific Traffic Descriptor, the PCF provides the Traffic Descriptor which describes the traffic feature to SMF to construct the PDR.\nIn PDR, the packet filter set is the main parameters for UPF to detect. And in the Traffic Descriptor in URSP rules, the IP descriptor can be directly used for the construction of PDR, that the IP descriptor describes the destination IP address. But for other kinds of Traffic Descriptor, for example, the Application Descriptor, DNN, Domain Descriptor or Connection Capabilities, that these parameters can't be directly used for construction of PDR.\nAlthough some of the Traffic Descriptor in URSP rules doesn't provide the 5-IP-tuple, but finally, the application traffic should be routed to a specific application server which is represented as IP address and port number. So, it means the Traffic Descriptor in UE only has the function of applying application traffic to specific PDU session, but there still has a mapping table between Traffic Descriptor and destination IP address.\nSo, after applying the application traffic to a PDU session, the SMF should set the destination IP address of this application traffic in UPF. The SMF should maintain a mapping table between non-IP related Traffic Descriptor and 3-IP-tuple.\nFor example:\n-\tIf the application traffic is applied to a PDU session by Traffic Descriptor = ABC.com (FQDN), the SMF should have a mapping table between ABC.com and the destination IP address of this application traffic, for example, ABC.com (FQDN) is equal to 100.1.1.1;\n-\tIf the application traffic is applied to a PDU session by Traffic Descriptor = APP1 (Application Descriptor), the SMF should have a mapping table between APP1 and the destination IP address of this application traffic, for example, APP1 is equal to 192.168.1.1\nWithout UE's assistance, the network sides should have the packet detection in every of the UE's PDU session. In order to reduce the burden of network, some of the information should be reported by UE. For example, when UE enforces the URSP rules to apply the application traffic to a PDU session, the UE can report the PDU session ID that the application traffic applied to, and report the URSP rules the UE uses. With the help of UE, there are three level of URSP rules verification:\n-\tThe stage 1 verification: When UE uses the URSP rules (one of the Traffic descriptor and RSD) to apply the application traffic to a PDU session (both existing PDU session or trigger to establish a new PDU session), the UE notifies the AM-PCF via NAS messages which URSP rules is used and which PDU session the application traffic applied to (indicated by PDU session ID). The AM-PCF can check the URSP rules that UE notifies. The URSP rule reported by the UE is inconsistent with the rule delivered by the network, the AM-PCF determines that the UE doesn't use the URSP rules correctly.\n-\tThe stage 2 verification: Although the UE notifies the URSP rules it used and the PDU session that the application traffic applied to, the AM-PCF should trigger the SMF to check whether the parameters of the PDU session (for example, the SSC mode, PDU session type and etc) are the same as in RSD. If in the PDU session ID which PDU session refers to and the application traffic applied to, the PDU session parameters are not the same as the parameter indicated in RSD, the AM-PCF can decide that the UE doesn't use the URSP rules correctly. Because the real PDU session parameters are not the same as the parameters in RSD that UE notifies.\n-\tThe stage 3 verification: Based on the previous two level of verification, the AM-PCF can decide that UE reports the same URSP rules as network distributed and the PDU session parameters are the same as in RSD that UE reports. But, whether the application traffic exists in the PDU session is unknown. So, the last stage of verification is, the 5GC should use the traffic detection mechanism in the PDU session, to detect whether the application traffic exists. The SMF develops the PDR according to the traffic descriptor and applies the PDR to PDU sessions. If no packet is detected, the SMF notifies the AM-PCF the results and the AM-PCF decides the UE doesn't use the URSP rules correctly.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.10.2\tProcedure",
                            "text_content": "The details of the procedure of network based URSP rules enforcement feedback is in Figure 6.10.2-1.\nFigure 6.10.2-1 illustrates the process of network-based user-specific routing policy enforcement feedback, showcasing the interaction between the network elements and the feedback loop. The figure depicts the network infrastructure, including the core network, access network, and user equipment. The key components are the policy enforcement point (PEP), which enforces the user-specific routing policy, and the feedback loop, which provides real-time information on policy execution. The figure emphasizes the importance of accurate policy enforcement and efficient feedback mechanisms in maintaining the integrity of network services.\nFigure 6.10.2-1: Network based URSP rules enforcement feedback\n1.\tThe PCF determines to monitor the URSP rules enforcement in UE.\n2.\tThe PCF finds the SMF serving the UE for this SUPI using Nudm_UECM_Get_Request including SUPI, type of requested information set to SMF Registration Info and the S-NSSAI and DNN, as defined in clause 5.3.2.5.7 of TS 29.503 [11].\n3.\tThe UDM provides the SMF id and the corresponding PDU Session id, S-NSSAI, DNN using\n4.\tThe PCF subscribes the service in SMF for packet detection. The PCF provides the monitored Traffic Descriptor to SMF via Nsmf_EventExposure_Subscribe. The PCF will be notified with the PDU session parameters that the application traffic applied to.\nNOTE:\tThe PCF is AM-PCF, and the subscription procedure can be routed to SMF via SM-PCF. The details are described in the Figure 6.10.2-2.\n5.\tThe SMF receives the parameters of Traffic Descriptor from PCF and generate the PDR. And the SMF should derive the IP descriptor which the Traffic Descriptor corresponds to.\nAnd in the Traffic Descriptor, the IP descriptor can be directly used for the construction of PDR, that the IP descriptor describes the destination IP address. If for other kinds of Traffic Descriptor, for example, the Application Descriptor, DNN, Domain Descriptor or Connection Capabilities, the SMF derives the 3-IP-tuple which the Application Descriptor, DNN, Domain Descriptor or Connection Capabilities corresponds to by the maintained mapping table between non-IP related Traffic Descriptor and 3-IP-tuple.\n6.\tThe SMF applies the PDR to the UPF that serves the UE via N4 session procedure.\n7.\tIn UE, an application traffic is mapped to a PDU session by the monitored URSP rules.\n8.\tThe UPF detects the application traffic by PDR in a PDU session.\n9.\tThe UPF reports the PDU session information, which the application traffic applied to, to SMF, including the PDU session information, including PDU session id, SSC mode, DNN, access type, S-NSSAI and etc, by N4 reporting procedure. The PDU session information is used to verify the which RSDs are enforced in the Traffic Descriptor in URSP rules.\n10.\tThe SMF reports the PDU session information, which the application traffic applied to, to PCF, including the PDU session id, SSC mode, DNN, access type, S-NSSAI and etc by Nsmf_EventExposure_Notify.\n11.\tThe PCF verify which RSDs are enforced in the Traffic Descriptor in URSP rules according to PDU session information. And PCF determines the enforcement of UE's URSP rules at this step. If no RSDs are matched to the PDU session information, it means the UE doesn't use the URSP rules correctly.\nThe PCF should re-evaluate the URSP rules to this UE and update the URSP rules in UE, if the URSP rules are not enforced correctly. For example, adjust the precedence of Traffic Descriptor or RSD, update the RSDs in Traffic Descriptor, add or remove the Traffic Descriptor and RSDs, etc.\n12.\tThe PCF updates the re-evaluated URSP rules to UE, according to the step from step 5 to step 9 described in clause 4.16.12.2 of TS 23.502 [3].\nFigure 6.10.2-2 illustrates the process of network-based URSP (User Equipment Registration and Service Provisioning) rules enforcement with UE (User Equipment) assistance. The figure showcases the interaction between the network elements, including the network server, the UE, and the service provider. The network server is responsible for managing and enforcing the rules, while the UE assists in the process by providing feedback to the network server. The figure highlights the importance of collaboration between the network and the UE to ensure efficient and accurate rule enforcement, ultimately improving the overall service quality for the end-users.\nFigure 6.10.2-2: Network based URSP rules enforcement feedback with UE assistance\n1.\tUE performs the URSP rules to apply application traffic to a PDU session, including newly establish a PDU session or apply the application traffic to existing PDU session.\n2.\tThe UE delivers the URSP rules enforcement results to AM-PCF via AMF by UL NAS messages, including the used URSP rules (represented by Traffic Descriptor precedence or RSD precedence, or, represented by details of Traffic Descriptor or RSD), PDU session ID that the application traffic applied to.\n3.\tThe AMF delivers the URSP rules enforcement results to AM-PCF by Npcf_UEPolicyControl_Update request, including the used URSP rules (represented by Traffic Descriptor precedence or RSD precedence, or, represented by details of Traffic Descriptor or RSD), PDU session ID that the application traffic applied to.\n4.\tThe AM-PCF responses to AMF.\n5.\tThe AM-PCF performs the stage 1 verification. The AM-PCF can check the URSP rules that UE notifies with the URSP rules AM-PCF delivers to UE. If the URSP rule reported by the UE is inconsistent with the rule delivered by the network, the AM-PCF determines that the UE doesn't use the URSP rules correctly.\nIf the AM-PCF determines the UE doesn't use the URSP rules correctly, the step from step 6 to step 19 are skipped.\nNOTE 1:\tFor example, the UE reports the URSP rules is: TD = \"FQDN = ABC.com\", RSD 1 = \"SSC mode 2, DNN = DNN1\", but the AM-PCF checks that the real URSP rules delivered to UE is: TD = \"FQDN = ABC.com\", RSD 1 = \"SSC mode 3, DNN = DNN1\". So the AM-PCF determines that the UE doesn't use the URSP rules correctly\n6-7.\tThe AM-PCF recovers the SMF ID, SM-PCF ID from UDM, with Key = SUPI, Subkey = S-NSSAI or DNN.\n8.\tThe AM-PCF triggers the procedure Npcf_PolicyAuthorization Subscribe to subscribe the packet detection results in certain PDU session. In the subscription, the AM-PCF provides SMF ID, used URSP rules (represented by Traffic Descriptor precedence or RSD precedence, or, represented by details of Traffic Descriptor or RSD), PDU session ID to SM-PCF.\n9.\tThe SM-PCF subscribes the service in SMF for packet detection. The PCF provides the monitored Traffic Descriptor to SMF via Nsmf_EventExposure_Subscribe. The PCF will be notified with the PDU session parameters that the application traffic applied to.\n10.\tThe SMF recovers the PDU session parameters according to PDU session ID, for example, SSC mode, DNN, S-NSSAI, PDU session type and etc. The SMF can have two options to perform stage 2 verification:\n-\tOption 1: The SMF can compare the PDU session parameters with the parameters in RSD. If either one of the parameters is not the same, the SMF notifies the SM-PCF by Nsmf_EventExposure Notify in step 11, and SM-PCF notifies AM-PCF by Npcf_PolicyAuthorization_Notify with the failure results. And the AM-PCF determines that the UE doesn't use the URSP rules correctly. From step 13 to step 19 are skipped.\n-\tOption 2: The SMF only delivers the recovered PDU session parameters to AM-PCF, via SM-PCF in step 11 and step 12. The AM-PCF compares the PDU session parameters with the parameters in RSD. If either one of the parameters is not the same, the AM-PCF determines that the UE doesn't use the URSP rules correctly. From step 13 to step 19 are skipped.\n11.\t(optional) After the SMF compares the PDU session parameters with the parameters in RSD, if either one of the parameters is not the same, the SMF notifies the SM-PCF by Nsmf_EventExposure Notify with the stage 2 verification failure.\n12.\t(optional) The SM-PCF notifies AM-PCF by Npcf_PolicyAuthorization_Notify with the stage 2 verification failure results.\n13.\tThe SMF receives the parameters of Traffic Descriptor from SM-PCF and generate the PDR. And the SMF should derive the IP descriptor which the Traffic Descriptor corresponds to.\nAnd in the Traffic Descriptor, the IP descriptor can be directly used for the construction of PDR, that the IP descriptor describes the destination IP address. If for other kinds of Traffic Descriptor, for example, the Application Descriptor, DNN, Domain Descriptor or Connection Capabilities, the SMF derives the 3-IP-tuple which the Application Descriptor, DNN, Domain Descriptor or Connection Capabilities corresponds to by the maintained mapping table between non-IP related Traffic Descriptor and 3-IP-tuple.\n14.\tThe SMF determines the UPF or PSA that serves the PDU session which indicated by PDU session ID.\nNOTE 2:\tThe SMF triggers the packet detection procedure only after the UE report that a URSP rule have been applied or enforced.\n15.\tThe SMF applies the PDR to the UPF that serves the UE via N4 session procedure.\n16.\tThe UPF detects the application traffic by PDR in a PDU session in the certain time range. The results can be either successfully detected or not detected.\n17.\tThe UPF reports the packet detection results to SMF, either successfully detected or not detected in the certain time range.\n18.\tThe SMF reports the packet detection results to SM-PCF by Nsmf_EventExposure_Notify. This packet detection results are used for stage 3 verification.\n19.\tThe SM-PCF notifies AM-PCF by Npcf_PolicyAuthorization_Notify with packet detection results.\n20.\tThe AM-PCF performs stage 2 verification and stage 3 verification:\nStage 2 verification: The AM-PCF compares the PDU session parameters with the parameters in RSD. If either one of the parameters is not the same, the AM-PCF determines that the UE doesn't use the URSP rules correctly.\nStage 3: The AM-PCF receives the packet detection results from SMF via SM-PCF. If no packets are detected from the PDU session which indicated by the PDU session ID that UE reports, it means that the real application traffic doesn't exist in the PDU session, and the UE doesn't use the URSP rules correctly. If the packets are detected from the PDU session, the UE uses the URSP rules correctly.\n21.\tThe PCF updates the re-evaluated URSP rules to UE, according to the step from step 5 to step 9 described in clause 4.16.12.2 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.10.3\tImpacts on services, entities and interfaces",
                            "text_content": "Editor's note:\tThis clause lists impacts to services and interfaces.\nPCF (AM-PCF or SM-PCF):\n-\tDecides the monitored URSP rules, and provides the parameters in Traffic Descriptor to SMF to generate PDR.\n-\tSubscribe the packet detection results from SMF to verify the URSP rules enforcement in UE.\n-\tRe-evaluates the URSP rules to the UE and update the URSP rules in UE, if the URSP rules are not enforced correctly according to the notification from SMF.\nSMF:\n-\tTransition of the Application Descriptor, DNN, Domain Descriptor or Connection Capabilities in Traffic Descriptor to IP descriptor to construct 3-IP-tuple in PDR.\n-\tReceives the monitored Traffic Descriptor which is included in the monitored URSP rules from PCF.\n-\tProvide the traffic detection results to PCF.\nUE:\n-\tReports the enforced URSP rules and PDU session ID that the application traffic applied to, to AM-PCF by UL NAS messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.11\tSolution #11: 5GC awareness of URSP recognition by UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.11.1\tDescription",
                            "text_content": "This solution is proposed to address KI#2 to assist 5GC awareness of URSP enforcement. It is beneficial for both the UE and the 5GC to ensure that the URSP rules provisioned to the UE are enforceable. With enforceable URSP rules, the mechanisms that allow 5GC to determine when the UE enforces the URSP rules can be followed efficiently.\nCurrently the UCU procedure is used to provision UE policy (including URSP policy) to UE. However, the result in the UCU Response message only indicates whether the UE supports the type of UE policy per Policy Section.\nMeanwhile, if UE supports URSP but does not recognize a URSP rule (e.g. due to not recognize the TD parameter in a URSP rule), the UE will ignore(skip) the URSP rule without any notification to the network side. This implicit ignoring will result in the inefficiency for the UE to perform URSP rules evaluation and enforcement and for the 5GC to configure enforceable URSP rules at the UE for routing specific application traffic to a specific route, e.g. expected slice as described in an RSD of a URSP rule.\nTherefore, it is proposed to enhance the UCU procedure so that the UE can indicate in the UL NAS Transport message if and which TD type(s) of the URSP rule are not recognized by UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.11.2\tProcedures",
                            "text_content": "\nFigure 6.11.2-1 illustrates the result of the delivery of UE policies, indicating whether and which Universal Resource Identifier (URI) Scheme Parameter (URSP) rule is supported by the User Equipment (UE). The figure shows a network architecture with multiple nodes, each representing a different entity involved in the delivery process. The nodes are connected by lines, indicating the flow of information and the relationships between them. The figure highlights the importance of accurate policy delivery in ensuring seamless communication and efficient resource management within the network.\nFigure 6.11.2-1: Result of the delivery of UE policies indicate if and which URSP rule is supported by UE\nThe procedure above is extended from the UCU procedure in clause 4.2.4.3 of TS 23.502 [3]:\n-\tIn step 3, the PCF indicates to the UE via AMF to obtain information from the UE for URSP policy in the UE policy container.\n-\tWhen receiving the indication, the UE will evaluate each URSP rule in the UE policy container received in step 3, and identify which component(s) of the URSP rule (i.e. TD types) are not recognized by UE.\n-\tThe UE indicates corresponding status information of the UE for URSP policy in step 6a.\nBased on the feedback from UE, the PCF may update the parameters (e.g. if some parameters in TD are wrongly configured) and provision the updated URSP to UE again. Whether and how to determine the URSP Rules to be sent to UE based on the feedback received is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.11.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE:\n-\tReceive the indication and check the URSP rules when it is provisioned in \"Delivery of UE policies\" message for reporting unrecognized URSP rules; and\n-\tProvide feedback about which TD type(s) that cannot be recognized in the URSP rule in NAS Transport message.\nPCF:\n-\tStore TD types that are not recognized by the UE, use them for URSP Rule generation.\n-\tBe configured with local policies to enable checking if the UE recognizes TD types.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.12\tSolution #12: URSP rule enforcement validation via gating control",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.12.1\tDescription",
                            "text_content": "This solution addresses Key Issue #2 on validation of URSP rule enforcement.\nFor newly detected application, the UE is required to evaluate the URSP rules and associate the application to a specific PDU Session, by initiating PDU Session Establishment procedure or PDU Session Modification procedure, depending on whether existing PDU session can be reused or not.\nWhile, the core network is not aware of which URSP rule is matched in the UE, not to mention what the detected application is. As the URSP rule is only known to the core network at PSI granularity.\nTo resolve the validation of URSP rule enforcement, URSP rule ID is introduced to uniquely identify the URSP rule sent to a UE. When the PCF provides URSP rules to the UE, a rule ID is allocated for each URSP rule and sent to the UE together with the URSP rules, apart from the PSI. When the UE initiates a PDU Session Establishment/Modification request, the UE indicates the URSP rule ID it uses for the request to the network, the network is able to know which URSP rule is enforced by the UE for the request. Further the PCF for the PDU Session when receiving the URSP rule ID transferred by the SMF can retrieve the content of the URSP rule identified by the rule ID from the PCF for the UE or the UDR, and then check if the requested S-NSSAI and DNN requested by the UE matches with the components of the Route Selection Descriptors of the URSP rule, and generate the policy for the session management e.g. allow the application traffic identified by the corresponding Traffic descriptor of the URSP rule, to be transferred via the PDU Session.\nThe enhancement is to add a Rule Identifier to URSP rule as defined in the Table 6.6.2.1-2 of the TS 23.503 [4].\n\n\nWhen detecting there is an unmatched application in the PDU Session, the PCF for the PDU Session may notify the PCF for the UE and the PCF for the UE may decide to update the URSP in the UE.\nNOTE:\tThe UE may use wrong URSP since the URSP in UE is not updated in time.\nEditor's note:\tIt is FFS whether the URSP rule identifier is mandatory.\nEditor's note:\tUser consent is needed for URSP rule ID reporting and the detailed descriptions and procedures of user consent is FFS.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.12.2\tProcedure",
                            "text_content": "When the UE triggers the PDU Session Establishment procedure or PDU Session Modification Procedure, the rule identifier of the matched URSP rule will be provided to the SMF, and then further provided by the SMF to the PCF for validation of the enforcement of the corresponding URSP rule and generate corresponding policy for the session management.\nFigure 6.12.2-1 illustrates the process of PDU session establishment and modification for URSP enforcement validation. The figure outlines the steps involved in establishing and modifying a PDU session, including the use of a User Datagram Protocol (UDP) port for communication. The figure also highlights the role of the Universal Resource Identifier (URI) in the process, which is used to identify the PDU session. Additionally, the figure shows the use of the User Datagram Protocol (UDP) port for communication, which is a key aspect of the process. The figure is a valuable resource for understanding the technical details of PDU session establishment and modification for URSP enforcement validation.\nFigure 6.12.2-1: PDU Session Establishment/Modification Procedure for URSP enforcement validation\n1.\tDuring the PDU Session Establishment/Modification procedure, the URSP rule ID related to the application which triggers the procedure is contained within the SM NAS request message by the UE.\n2.\tThe SMF sends Npcf_SMPolicyControl_Create/Update request message to the PCF, which includes the URSP rule ID received from the UE.\n3.\tUpon receiving the URSP rule ID, the PCF for the PDU Session can retrieve the content of the corresponding URSP rule by either interacting with PCF for the UE via Npcf_EventExposure_Subscribe service operation or with the UDR via Nudr_DM_Query service operation (e.g. Policy Set Entry).\n4.\tBased on the received URSP rule, the PCF for the PDU Session first checks whether the PDU Session is associated correctly, e.g. whether the DNN/S-NSSAI or the SSC mode matches with the components of the RSD(s) of the URSP rule. If the PDU Session is associated correctly, the PCF can make policy decision by generating PCC rule(s) corresponding to the application traffic identified by the Traffic descriptor. If the PDU Session is associated incorrectly, the PCF may reject the request message from the SMF.\n5.\tThe PCF provides the generated PCC rule(s) based on the URSP received in step 3 to the SMF. In addition, the PCF may set \"unmatched application\" PCR trigger to the SMF, and the SMF shall report to the PCF for the PDU Session when it determines the application transferred in the PDU Session does not match the URSP rule.\n6.\tThe SMF enforces the received PCC rule(s) by providing corresponding N4 rule(s) to the UPF, thus the application traffic of the Traffic descriptor can be transferred via this PDU Session.\n7.\tThe SMF responds to the UE with PDU Session Establishment/Modification Accept message, which may contain QoS rule(s) corresponding to the received PCC rule(s).\nAfter this procedure, upon receiving the service packets, if the UPF determines that the service packets are not aligned with the instruction in N4 rules received from SMF, the UPF will drop the packet and report the unmatched application event (i.e. there is an unmatched packet) to the SMF, then the SMF notifies the PCF for the PDU Session. The PCF for the UE updates the URSP in the UE when receiving the event notification of unmatched application from the PCF for the PDU Session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.12.3\tImpacts on existing Functions",
                            "text_content": "The solution has impacts on the following entities:\nUE:\n-\tSupports the reporting of URSP rule ID in PDU Session establishment/modification request.\nSMF:\n-\tSupports procedures for transferring of URSP rule ID to the PCF.\n-\tReports to the PCF about whether there is an unmatched application event.\nUPF:\n-\tReports to the SMF about whether there is an unmatched application event.\nPCF:\n-\tSupports procedures for querying the content of the URSP rule from the PCF for the UE.\n-\tGenerates the policy for the session management based on the URSP rule.\n-\tRejects the transmission of application traffic not matching the Traffic descriptor of the URSP.\n-\tSubscribes to PCF for the PDU Session and SMF for notification about whether there is an unmatched application event.\n-\ttriggers URSP update based on the unmatched application event.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.13\tSolution #13: URSP enforcement via PDU Session authorization/authentication when UE associating with application",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.13.1\tDescription",
                            "text_content": "This solution addresses Key Issue #2 5GC awareness of URSP enforcement.\nCurrently for every newly detected application, the UE evaluates the URSP rules to select a Route Selection Descriptor. UE determines to reuse an existing PDU Session or establish a new PDU Session to associate the application, depending on whether an existing PDU Session matches all components in the selected Route Selection Descriptor or not.\nHowever, 5GC is not aware of which URSP rule the UE matches, and what application the UE detects. To resolve the key issue, a PDU Session authorization/authentication when UE detecting and associating with application is introduced to verify whether the UE should route the specific application traffic to the PDU session or not.\nAfter UE evaluates the URSP rules to select a Route Selection Descriptor for newly detected application, if UE determines to initiates a PDU Session Establishment, the UE indicates the Rule Precedence of URSP rule it uses for the request to the network, and the application identity.\nNOTE 1:\tThe DN-AAA server may belong to the 5GC or to the DN.\nIf the UE provides authentication/authorization information corresponding to an application identity during the Establishment of the PDU Session, and the SMF determines that Secondary authentication/authorization of the PDU Session Establishment is required based on the SMF policy associated with the DN, the SMF triggers a PDU Session Establishment authentication/authorization procedure with the DN-AAA Server without involving the UPF if the DN-AAA Server is located in the 5GC and reachable directly. If the SMF determines that authentication/authorization of the PDU Session Establishment is required but the UE has not provided an application identity as part of the PDU Session Establishment request, the SMF requests the UE to indicate an application identity using EAP procedures. If the authentication/authorization of the PDU Session Establishment fails, the SMF rejects the PDU Session Establishment.\nBefore the UE reports application identity in PDU Session Establishment request or NAS Authentication Message, the UE shall first obtain user consent.\nNOTE 2:\tThe scenario where to get user intention and consent for UE to report the application identity, which involves UI interaction or message exchanges between UE and user, is not in scope.\nEditor's note:\tThe procedures to obtain user consent need to be studied by SA WG3.\nIf UE determines to reuse the existing PDU Session for the newly detected application, UE shall initiate a PDU Session Establishment Request and includes the Rule Precedence of URSP rule and application identity. The SMF may trigger the PDU Session establishment authentication/authorization procedure with the DN-AAA Server. DN-AAA Server based on the SMF policy associated with the DN confirms the successful authentication/authorization of the PDU Session for the specific application. The SMF shall reuse the existing PDU Session and accept the PDU Session Establishment, without establish a new PDU session.\nNOTE 3:\tApplication identity is the subscription identity of Network Slice Customer (NSC), and able to map to the DN-AAA server.\nFurther, the PCF for SM policy control, when receiving the Rule Precedence of URSP rule transferred by the SMF, can retrieve the content of the URSP rule identified by the Rule Precedence from the PCF for AM policy control, and then check if the requested S-NSSAI and DNN requested by the UE matches with the components of the Route Selection Descriptors of the URSP rule, and generate the policy for the session management e.g. allow the application traffic identified by the corresponding Traffic descriptor of the URSP rule.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.13.2\tProcedures",
                            "text_content": "Figure 6.13.2-1 illustrates the process of PDU session establishment for URSP enforcement in a telecommunication network. The figure depicts the interaction between the PDU, the network element, and the user equipment (UE) in a series of steps. The PDU initiates the procedure by sending a request to the network element, which then responds with a confirmation. The UE plays a crucial role in this process, as it interacts with both the PDU and the network element to ensure secure and reliable communication. The figure highlights the importance of URSP enforcement in maintaining network security and performance.\nFigure 6.13.2-1: PDU Session Establishment Procedure for URSP enforcement\n1.\tDuring the PDU Session Establishment procedure, UE includes Rule Precedence of URSP rule and application identity in SM NAS request message.\n2.\tSMF triggers the PDU Session establishment authentication/authorization directly with DN-AAA Server based on the SMF policy associated with the DN.\n3.\tDN-AAA Server sends an Authentication/Authorization message towards UE including application identity.\n4.\tTransfer of DN Request Container information received from UE towards the DN-AAA.\n5.\tThe DN-AAA Server confirms the successful authentication/authorization of the PDU Session associating with the application.\n6.\tWithin the Npcf_SMPolicyControl_Create/Update request message, SMF provide the Rule Precedence to the PCF.\n7.\tUpon receiving the Rule Precedence of URSP rule, the PCF can retrieve the content of the corresponding URSP rule directly or from the UDR. Based on the received URSP rule, the PCF checks whether the UE associated the correct PDU Session according to the Route Selection Descriptor of the URSP rule. If the PDU Session is associated correctly, the PCF can make policy decision by generating PCC rule(s). If the PDU Session is associated incorrectly, the PCF may reject the request message from SMF.\n8.\tThe PCF provides the generated PCC rule(s) to the SMF.\n9.\tThe SMF enforces the received PCC rule(s) by providing corresponding N4 rule(s) to the UPF, thus the traffic can be transferred via this PDU Session.\n10.\tThe SMF responds to the UE with PDU Session Establishment Accept message, which may contain QoS rule(s) corresponding to the received PCC rule(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.13.3\tImpacts on services, entities and interfaces",
                            "text_content": "The solution has impacts in the following entities:\nUE:\n-\tNeeds to support the reporting of Rule Precedence and application identity in PDU Session Establishment request.\n-\tNeeds to support secondary Authentication/Authorization based on the application identity.\n-\tNeeds to support to initiate a PDU session Establishment request if UE determines to reuse the existing PDU Session for the newly detected application after UE evaluates the URSP rules to select a Route Selection Descriptor.\nSMF:\n-\tNeeds to support procedures for transferring of Rule Precedence to the PCF.\n-\tNeeds to support procedures for transferring of application identity to the DN-AAA Server in Authentication/Authorization Request in PDU session establishment procedure.\nPCF:\n-\tNeeds to support procedures for querying the content of the URSP rule based on received Rule Precedence of URSP rule.\n-\tNeeds to generate the policy for the session management based on the URSP rule, and reject the transmission of application traffic if not matching with the Traffic descriptor of the URSP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.14\tSolution #14: 5GC awareness of URSP rule evaluation and verification of network slice usage",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.14.1\tDescription",
                            "text_content": "This solution addresses Key Issue #2: \"5GC awareness of URSP enforcement\".\nThis solution is intended to be used when a specific network slice has been deployed for the exclusive usage of an application service provider. Business agreements between the MNO and the application service provider guarantee that the network slice only carries traffic from the applications of the application service provider.\nURSP rules are enhanced with an optional indication that a URSP rule is subject to application registration along with the address of an Application Function. When receiving a URSP rule with this indication, the UE verifies that the user consents to application registration (e.g. based on pre-configuration by the user or interaction with the user); if not, then the UE rejects this URSP rule and discards it.\nWhen the evaluation of a URSP rule subject to application registration triggers the establishment of a new PDU Session, the UE first performs application registration with the indicated AF (unless this has been done previously for the application requesting data transmission), and then initiates PDU Session Establishment, including in the PDU Session Establishment Request the Traffic Descriptor of the matched URSP rule, and the application identity obtained during application registration. The SMF may verify that the indicated application identity is trusted and that the S-NSSAI is allowed for this application identity according to operator policy. If this verification fails, the SMF rejects the PDU Session Establishment Request with a proper cause value and the UE evaluates remaining URSP rules for routing the user data from this application.\nWhen the evaluation of a URSP rule subject to application registration leads to routing the user data from a new application in an already established PDU Session, the same as above applies except that PDU Session Modification is used instead of PDU Session Establishment.\nApplication registration takes place between the UE and the AF, and the UE provides to the AF and identifier recognized by the AF, that is linked with the business agreement between the MNO and the application service provider, and known to the application running in the UE, but that does not need to reveal the exact application used as multiple applications involved with the application service provider may use the same identifier with the AF. Then, the AF provides the UE with the application identity that the UE will present to the SMF at PDU Establishment Request.\nNOTE:\tA mechanism for verification of the application identity needs to be defined by SA WG3.\nEditor's note:\tThe SMF verification of the application identity based on local policies needs to be detailed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.14.2\tProcedures",
                            "text_content": "Figure 6 illustrates the process of 5GC (5G Core) awareness of URSP (User-to-Network Service Profile) rule evaluation and verification of network slice usage. The figure showcases the interaction between the 5GC, URSP, and network slice, emphasizing the importance of accurate rule enforcement and slice usage monitoring for efficient network management and resource allocation. The diagram highlights the role of the 5GC in validating the compliance of network slices with defined policies, ensuring smooth and secure communication across the network.\nFigure 6.14.2.1-1: 5GC awareness of URSP rule evaluation and verification of network slice usage\n1.\tUE Policies are delivered to the UE using the current, existing mechanism of UE Configuration Update procedure for transparent UE Policy delivery, see clause 4.2.4.3 of TS 23.502 [3]. One or more URSP Rule contains an indication that it is subject to application registration along with the address of an AF. The UE may, based on local privacy settings and/or interaction with the user, reject URSP rules containing an indication that it is subject to application registration; in this case the UE indicates to the AMF the URSP rule(s) that it rejects due to not allowing application registration for this URSP rule.\n2.\tThe evaluation of a URSP rule subject to application registration triggers the establishment of a new PDU Session (case a) or leads to routing the user data from a new application in an already established PDU Session (case b).\n3.\tIf the UE had previously performed application registration for the application requesting data transmission and for this URSP rule, the procedure continues with step 4. Otherwise, the UE performs application registration (see clause 6.14.2.2) with the AF which address was indicated in the URSP rule.\n4.\tThe UE sends a PDU Session establishment request (case a) or a PDU Session Modification request (case b), including the Traffic Descriptor of the matched URSP rule, and the application identity obtained during application registration.\n5.\tThe SMF verifies that the indicated application identity is valid and that the S-NSSAI is allowed for this application identity according to operator policy.\n6.\tDepending on the outcome of step 5, the PDU Session establishment or modification is accepted or rejected with a cause value indicating that the S-NSSAI is not allowed for this application identity; in the latter case, the UE evaluates remaining URSP rules for routing the user data from this application.\nThis call flow depicts an expanded view of step 3 in clause 6.14.2.1.\nEditor's note:\tWhether this procedure uses CP or UP is FFS.\nFigure 6.14.2.2-1 illustrates the process of application registration in a telecommunication system. The figure depicts the interaction between the application, service, and network layers, highlighting the role of the service-based network (SBN) in managing application registrations. The SBN is responsible for coordinating the registration of applications with the appropriate service and network resources. The figure shows how applications send registration requests to the SBN, which then processes these requests and assigns them to the appropriate service and network resources. The figure also shows how the SBN manages the lifecycle of these registrations, including the activation and deactivation of services and resources. Overall, the figure provides a clear overview of the application registration process in a telecommunication system, emphasizing the role of the SBN in managing and coordinating these processes.\nFigure 6.14.2.2-1: Application registration\n1.\tThe UE sends an application registration request to the AF, including an identifier recognized by the AF (which need not be the AppID used in the UE's OS). User identity is not included.\n2.\tThe AF authenticates and authorizes the request. This may involve one or more additional messages between the UE and the AF.\n3.\tThe AF sends a registration response to the UE, including an application identifier that can be used at step 4 of clause 6.14.2.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.14.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE:\n-\tSupport URSP rules subject to application registration and related procedures.\nPCF:\n-\tSupport URSP rules subject to with application registration.\n-\tNsmf_PDUSession_UpdateSMContext and Nsmf_PDUSession_CreateSMContext: support application identity verification.\nAF:\n-\tNew service if CP is used for application registration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.15\tSolution #15: UE URSP enforcement validation by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.15.1\tDescription",
                            "text_content": "This solution addresses the bellow requirements from Key Issue #2: 5GC awareness of URSP enforcement.\n-\tWhether and how the 5GC can be made aware whether or when the UE enforces a URSP rule to route an application traffic to a PDU Session based on the URSP rule provisioned by 5GC.\n-\tWhether there are any actions the 5GS can take after 5GC is aware whether the UE enforces a URSP rule for specific application traffic or not. If any, what action 5GC should take?\nThe solution allows for UE enforcement to follow correctly the URSP rules for traffic matching. It introduces Application identity parameter provisioned to the PCF by the UE during PDU Session Establishment procedure. The PCF performs URSP validity check in order to validate whether the UE correctly enforces the traffic matching rules in the URSP for the Application requiring the service. If the PCF finds out that the URSP rules are not correctly followed by the UE, the PDU Session is rejected with a new cause to indicate that the URSP rules in general or a specific URSP rules are not followed. Also, the PCF may optionally trigger UE Policy Update procedure to refresh the URSP rules in the UE with the latest version of the URSP rules.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.15.2\tProcedures",
                            "text_content": "Figure 6.15.2-1 illustrates the process of a User Equipment's (UE) Universal Resource Identifier (URSP) enforcement validation by the network. The figure depicts the UE sending a request to the network, which then checks the UE's URSP against its database. If the URSP is valid, the network grants the request, otherwise, it denies it. This process ensures that only authorized devices can access network resources, enhancing security and network integrity.\nFigure 6.15.2-1: UE's URSP enforcement validation by the network\n1.\tAn Application in the UE requires service. The UE initiates PDU Session Establishment Request message in which the UE includes the UE_ID, the PDU_Session_ID, the S-NSSAI and the DNN. The UE selects the S-NSSAI and the DNN based on the URSP rules applicable for the Application requiring service. The UE also includes the App_ID of the Application in the PDU Session Establishment Request message.\nNOTE:\tThe UE obtains the App_ID when the Application is registered with the AF (Service provider) and it is not in the scope of this study. The link between the App_ID and the Application on the UE itself is only known to the Service provider.\n2.\tSMF selection by the AMF.\n3.\tThe AMF invokes either Nsmf_PDUSession_CreateSMContext_Request message to the SMF if there is no association with it or Nsmf_PDUSession_UpdateSMContext_Request message if the AMF is already associated with a SMF. Along with the UE_ID, the S-NSSAI, the DNN and the User location parameters, the AMF also forwards to the SMF the App_ID received by the UE.\n4.\tContinue with PDU Session Establishment procedure according to steps 4 to 7a of clause 4.3.2.2.1 of TS 23.502 [3].\n5.\tThe SMF initiates the SM Policy Association Establishment procedure and the SMF sends the Npcf_SMPpolicy_Control_Create message to the PCF in which the SMF includes the UE_ID, the S-NSSAI, the DNN, the User location and the App_ID parameters.\n6.\tThe PCF performs URSP validity check for the UE. The PCF retrieves the stored latest version of the URSP rules for the UE and the PCF verifies whether the UE is following correctly the S-NSSAI selection rules, the DNN selector rules, the Time window criteria and the Location criteria.\n7.\tIf the result from the URSP validity check by the PCF is that one or more of the traffic matching rules in the latest version of the URSP are not correctly followed by the UE, the PCF returns Failure parameter in the Npcf_SMPpolicy_Control_Create response to the SMF. The PCF may also include the cause for the failure, e.g. URSP rules not followed or a more specific reject cause identifying the specific URSP rule that is not followed by the UE.\n8.\tThe SMF forwards the reject cause to the AMF in the Nsmf_PDUSession_CreateSMContext_Response message.\n9.\tThe AMF rejects the PDU Session Establishment Request from the UE and the AMF includes a rejection cause URSP rules not followed or a more specific reject cause pointing to which URSP rules are not followed (e.g. S-NSSAI selection rules not followed or DNN selection rules not followed or Time windows criteria not followed or Location criteria not followed).\n10.\tIf at step 6 the URSP validity check by the PCF fails, the PCF may assume the UE may not have the latest URSP rules so, the PCF may trigger UE Policy update procedure according to clause 4.2.4.3 of TS 23.502 [3] to refresh the UE with the latest URSP rules.\n11.\tUE Policy update according to clause 4.2.4.3 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.15.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE, AMF, SMF:\n-\tNew App_ID parameter and a new PDU Session Establishment reject cause.\nPCF:\n-\tNew App_ID parameter and URSP validity check functionality.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.16\tSolution #16: URSPs into PCO for EPC",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.16.1\tDescription",
                            "text_content": "The solution address KI#3. In this solution, two different aspects are covered:\n-\tProvide the use case examples and scenarios where the UE may need URSP when in EPS.\n-\tHow to provision the URSP to UE when served by the EPS.\nWhen a UE attaches initially in EPC or when the UE handovers from 5GC to EPC, PCF may need to update the URSPs in the UE:\n-\tDuring Initial attach procedure in EPS due to for example:\n-\tNew AF guidance on URSP request applicable to the UE was sent by an AF while the UE is deregistered and prior to the EPC attach procedure, so the corresponding URSP rules were not delivered yet to the UE.\n-\tOperator policies configured with time, location or any other condition are met when the UE attaches to EPC, implying new or updated URSP rules apply under those conditions.\n-\tOperator policies for determining URSPs were updated by the operator while the UE is deregistered and prior to the EPC attach procedure, so the corresponding URSP rules were not delivered yet to the UE.\n-\tAt any time a URSP is changed while the UE is registered in EPC (coming from EPC initial attachment or after handover from 5GC) due to for example:\n-\tNew AF guidance on URSP request applicable to the UE is sent by an AF.\n-\tDue to time, location change or other network condition the PCF determines that an operator policy configured for the operator for URSP determination applies in the new network conditions, implying new or updated URSP rules apply to the UE.\nIn 5GC URSP updates are delivered from the PCF to the UEs following the procedure defined in clause 6.1.2.2.2 of TS 23.503 [4] for the distribution of the policies to UE. The distribution of UE policies is based on a protocol defined between the UE and the PCF described in TS 24.501 [7] and called UPDP protocol (UE Policy Delivery Protocol) and summarized in the figure below. The UPDP messages are then encapsulated into N1 Policy Containers and transferred transparently by the AMF from/to the UEs.\nFigure 6.16.1.2-1 illustrates the process of Universal Resource Sharing Provisioning (URSP) to a User Equipment (UE) in a 5G network. The figure depicts the interaction between the Network Equipment Sub-system (NES) and the User Equipment Sub-system (UEs), highlighting the role of the Network Service Function (NSF) in managing resource allocation. The diagram showcases the dynamic nature of 5G networks, where resources are efficiently shared and managed to ensure optimal performance and coverage. Key components include the Network Slice Manager (NSM), which orchestrates the creation and management of network slices, and the Resource Control Function (RCF), responsible for resource allocation and accounting. The figure emphasizes the importance of network slicing in 5G, enabling flexible and scalable services for diverse use cases.\nFigure 6.16.1.2-1: URSP provisioning to a UE in 5GS\nThe operation UE STATE INDICATION is used by the UE to provide to the PCF the list of stored PSIs which identify the Policy Sections stored in the UE.\nThe Network-requested UE Policy management procedure is used by the PCF to delivery an update of UE Policies to the UE. First the PCF sends the operation MANAGE UE POLICY COMMAND including the update of UE policies to the UE. Then the UE answer to the PCF with MANAGE UE POLICY COMPLETE or MANAGE UE POLICY COMMAND REJECT.\nThis solution proposes a mechanism that allows the network to update the URSPs for a UE in EPC, by encapsulating UPDP messages into a new ePCO parameter (from now on UE Policy Container ePCO) and transfer them to the UE via PDN connection.\nIn this clause, the PCF refers to a deployment where the PCF serving the UE and the PCF serving each of the PDU Sessions for this UE are the same PCF.\nThe solution assumes the same protocol (UPDP protocol) for URSP delivery between the PCF and the UE than in 5GC, although the final decision on this is up to stage 3.\nThe mechanism reuses the existing capability of the EPC network for sending ePCO from the UE to the SMF+PGW-C (and vice versa) and in addition it proposes a way to transport the UE Policy Container from the SMF+PGW-C to the PCF (and vice versa) based on reusing existing PDU session procedures.\nFor the delivery of URSPs to UEs in EPC, this solution assumes the standard solution for interworking architecture between EPC and 5GC as described in TS 23.501 [2].\nWhen the PCF needs to send a UE Policy update towards the UE in EPC, it invokes a SM Policy Association Modification including the corresponding UPDP message into a new IE (UE Policy Container) in the N7 interface. When the SMF+PGW-C receives this new IE the SMF+PGW-C encapsulates it into UE Policy Container ePCO and transfers them to the UE by using existing procedure of PDN GW initiated bearer modification without bearer QoS update as defined in clause 5.4.3 of TS 23.401 [8].\nWhen the UE in EPC needs to send a UPDP message towards the PCF in relation to UE Policy handling the UE first encapsulates the UPDP message into a UE Policy Container ePCO and then transfers it towards the SMF+PGW-C by reusing existing mechanisms. When the SMF+PGW-C receives such UE Policy Container ePCO from the UE, just forwards transparently the UE Policy Container towards the PCF by reusing SMF initiated SM Policy Association procedure (establishment or modification).\nThe solution also proposes that the UE has to be able to handle the reception of such UPDP messages received over EPC NAS signalling in a similar way than when received over 5GC NAS signalling in 5GC.\nIn addition, for those events happening in PCF which may trigger the sending of a URSP update for a UE (as described in clause 6.16.1.1), the PCF will check if the UE is currently in EPC, and if so will use one of these PDU sessions to trigger the delivery of the URSP updates, by invoking PCF initiated SM Policy Association modification procedure including the proper UE Policy Container.\nClause 6.16.1.4 describes the solution for deployments where the PCF for the UE (PCF-UE from now on) and the PCF for the PDU Session (PCF-SM from now on) are different PCFs and there are multiple PCFs for the PDU session.\nThe solution utilizes the establishment of a UE Policy Association between the PCF-SM and the PCF-UE for the purpose of the delivery and handling of URSP updates for a UE in EPC. Therefore, the PCF-SM is responsible to transfer UE Policy Containers received from the UE over N7 towards PCF-UE and also to receive those UE Policy Containers from the PCF-UE and to transfer them towards the UE via SMF+PGW-C over N7 procedures.\nThe PCF-SM is a new consumer of the Npcf_UEPolicyControl service for the purpose of providing URSP updates to the UE in EPC. The communication between the PCF-SM and the SMF+PGW-C for the sending and reception of UE Policy Containers from/to the UE is according to the existing proposal for deployments where the PCF serving the UE and the PCF serving each of the PDU Sessions of this UE are the same PCF as described in clause 6.16.1.3.\nFor the initial attach of a UE in EPC it is proposed the PCF-SM triggers the establishment of a UE Policy Association towards PCF-UE upon a PDU session establishment is requested by SMF+PGW-C including a UE Policy Container.\nFor the case where the UE moves from 5GS to EPC it is proposed the PCF-SM triggers the establishment of a UE Policy Association towards the PCF-UE upon the SMF+PGW-C notifies the PCF-SM about the UE is moved to EPC.\nFor the case where the UE moves from EPC to 5GS the proposal is that the PCF-SM terminates any ongoing UE Policy Association established towards the PCF-UE when it is notified from the SMF+PGW-C.\nOnce the UE Policy Association is established between the PCF-SM and the PCF-UE, the PCF-UE may decide at any time to send an update of URSPs to the UE in EPC, e.g. triggered by an AF guidance on URSP request. In addition, the PCF-UE is also able to provide an URSP update at UE Policy Association from PCF-SM when the UE initially attaches in EPC or when the UE moves from 5GS to EPC.\nFor the case where the UE moves from 5GS to EPC the following is proposed in relation with the establishment of a UE Policy Association from the PCF-SM:\n-\tIt is proposed to add an extension of the UE Policy Container which the UE sends at 5GS initial registration, so the UE may include an indication about whether the UE supports URSP delivery when in EPC. Then the PCF-UE stores that indication in UDR for the UE during 5GS initial registration as part of UE context policy control subscription information. When the UE moves to EPC, the PCF-SM determines whether the UE supports URSP delivery in EPC by checking UE context policy control subscription information in UDR and uses such indication to decide whether to establish a UE Policy Association towards the PCF-UE.\n-\tIf there are multiple ongoing PDU sessions for the UE handled in the same PCF-SM (e.g. in a deployment where the same PCF-SM handles all the PDU sessions for an S-NSSAI), the PCF-SM controls that only one UE Policy Association is established and maintained for the same UE. That is, the PCF-SM will establish the UE Policy Association only for the first PDU session which reports the change to EPC. In addition, the PCF-SM will terminate the UE Policy Association at the time the last PDU session for this UE is terminated.\nThe PCF-UE is able to send a URSP update to a UE which has moved from 5GS to EPC if there is at least one ongoing PDU session for the UE in the PCF-SM, no matter if some PDU sessions have been terminated after the UE moves to EPC.\n-\tFor the case where there are multiple PCF-SMs handling PDU sessions for the UE it is proposed to extend the operation Npcf_UEPolicyControl_Create with an indication (e.g. \"Handover5GtoEPC\") about whether the scenario triggering the establishment of the UE Policy Association is due to a handover from 5GS to EPC.\nWith such indication the PCF-UE is able to correlate all these UE Policy Associations from different PCF-SMs and avoid the re-sending of URSP updates for each of the UE Policy associations. At the time the PCF-UE determines an update of URSP is needed for a UE, the PCF-UE will first select one of the UE Policy Associations for this UE including the new indication and use it for the URSP update delivery.\nWith this proposal the PCF-UE is able to send a URSP update to a UE which has moved from 5GS to EPC if there is at least one ongoing PDU session for the UE in at least one PCF-SM, no matter if some PDU sessions have been terminated in some PCF-SMs after the UE moves to EPC.\n-\tUpon the reception of UE Policy Association establishment from PCF-SM including an empty UE Policy Container (the PCF-SM doesn't receive the UE Policy Container from the UE at 5GS to EPC) and the new indication (i.e. \"Handover5GtoEPC\"), the PCF-UE gets the information about the PSIs stored in the UE (and other info that the UE includes in the UE Policy Container in Initial Registration in 5GS) from the former UE Policy Association for this UE which was established when the UE was in 5GS.\nFor scenarios with N26, according to clause 4.11.1.2.1 of TS 23.502 [3], the AMF deletes the UE Policy Association when the UE moves to EPC and it is not clear whether this deletion happens after or before the SMF+PGW-UE notifies the PCF-SM about the change to EPC. So, it is unknown whether the PCF-UE deletes the ongoing UE Policy Association (from 5GS) before the new one from PCF-SM (from EPC) is established.\nIn order to avoid that the information included in the former UE Policy association from 5GS is deleted in PCF-UE before the new one from PCF-SM is established, it is proposed to extend the operation for deletion of the UE Policy Association (Npcf_UEPolicyControl_Delete) with a new indication (e.g. \"Handover5GtoEPC\") about whether the scenario triggering the deletion of the UE Policy Association is due to a handover from 5GS to EPC. When the AMF initiates the deletion because a handover from 5GS to EPC, the AMF includes such indication so the PCF-UE may delay the removal of the associated information for the ongoing UE Policy Association during a while, to wait for the establishment of the new UE Policy Associations from the PCF-SM.\nIn addition, when the PCF-UE delays the removal of the UE Policy Association, the PCF-UE delays other additional actions related with the removal of the association as the unbinding from the BSF or un-subscription to receive notifications from UDR, therefore unnecessary signalling due to the unbinding and immediate binding from BSF and un-subscription and immediate subscription to UDR again is avoided.\n-\tWhen the PCF-SM needs to establish a UE Policy Association triggered by a 5GS to EPC handover, the PCF-SM first discovers the address of the PCF-UE by querying the BSF. This together with the one in previous bullet (i.e. \"Handover5GtoEPC\"), makes possible that the PCF-SM selects the same PCF-UE handling the UE Policy Association in 5GS, therefore the PCF-UE that receives the new UE Policy Association from the PCF-SM is able to get the list of PSIs stored in the UE from the former UE Policy Association in 5GS.\nIn the case of different PCF-SMs are handling PDU sessions for the same UE, the PCF-UE selected by all of them will be the same PCF-UE. For the case of EPC initial attach the PCF-SM selects the PCF-UE based on the information retrieved from NRF query.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.16.2\tProcedures",
                            "text_content": "For the initial attachment of a UE in EPC, the procedure follows the one defined in clause 5.3.2.1 of TS 23.401 [8] with the following additions summarized in the figure below for the support of URSP deliveries to the UE:\nFigure 6.16.2-1 illustrates the initial attach procedure in an Evolved Packet Core (EPC) network. The figure depicts the process of attaching a new user equipment (UE) to the network, starting from the home subscriber station (HSS) and proceeding through the network elements such as the home location register (HLR), mobility management entity (MME), and the packet data network (P-GW). The figure highlights the role of the authentication and authorization server (A&A) in validating the UE and the role of the charging and settlement plan (CSP) in managing the UE's data usage. The figure also shows the interaction between the EPC and the home network, including the home subscriber network (H-SN) and the home network gateway (H-GW). The figure is a valuable resource for understanding the complex process of attaching a new user to an EPC network.\nFigure 6.16.2-1: Initial Attach procedure in EPC\n1.\tThe UE generates UE STATE INDICATION UPDP message (including the list of PSIs stored in the UE) in the same way that it is done for the registration in 5GC. Then the UE includes this UE STATE INDICATION UPDP message into UE Policy Container ePCO in PDN Connectivity Request encapsulated in Attach Request.\nNOTE 1:\tFor those cases where the UE attaches to EPC but doesn't request the establishment of a default bearer the procedure just follows the steps defined in clause 5.3.2.1 of TS 23.401 [8] and there is no PCF interaction. However, for those cases, the UE will include UE STATE INDICATION within a UE Policy Container ePCO during the first request for PDN connectivity. Then the PCF will be able to update the URSPs to the UE only after the establishment of the first PDU session establishment for the UE.\n2-4.\tThese steps follow the existing procedure as defined in TS 23.401 [8], so the UE Policy Container ePCO is sent towards the SMF+PGW-C.\n5.\tThe SMF+PGW-C forwards transparently the UE Policy Container ePCO to the PCF as a new IE in the PDU Session Establishment (Npcf_SMPolicyControl_Create Request).\nNOTE 2:\tUpon the reception of this UE Policy Container ePCO, the SMF+PGW-C shall establish the corresponding SM Policy Association even in case the network configuration for the APN of the PDN connection does not require PCF involvement.\n6.\tThe PCF answers to the SMF with Npcf_SMPolicyControl_Create Response.\n7.\tThe procedure for initial attach continues as defined in clause 5.3.2.1 of TS 23.401 [8].\n8.\tthe PCF gets the content of the UE STATE INDICATION included in new IE and processes it in a similar way than it does when it is received in 5GC during the UE Policy Association establishment, i.e. uses the list of UPSIs included in the UE STATE INDICATION to determine if an update of UE policies is required for this UE. If no update is determined the procedure finishes here. If an update is needed, then the PCF generates the corresponding UPDP message MANAGE UE POLICY COMMAND in a similar way than it is done in 5GC and then includes the message into a UPDP Container ePCO.\nNOTE 3:\tThe interactions toward UDR in relation with the retrieving and storage of UPSIs into UDR are not shown in the diagram.\n-\tThe flow follows the steps 2-14 defined in clause 6.16.2.2 for URSP update initiated by PCF.\nFor the procedure for URSP update initiated by the PCF when the UE is in EPC, the procedure follows the steps described in the figure below:\nFigure 6.16.2.2-1 illustrates the process of a PCF (Passive Component Filter) initiated Update Request Procedure (URSP) in a telecommunication network. The figure depicts the sequence of events and components involved in the procedure, including the PCF, the Central Office (CO), and the Remote Central Office (RCO). The URSP is initiated by the PCF, which sends a request to the CO for an update. The CO then sends a response back to the PCF, which updates its local database. This process ensures that the PCF has the most up-to-date information about the network, allowing for efficient and accurate routing of traffic.\nFigure 6.16.2.2-1: PCF initiated URSP update procedure\n1.\tAn event as described in clause 6.16.1.1 happens in PCF. The PCF triggers the re-evaluation of applicable URSPs for the UE and determines an update of URSP is needed for the UE. The PCF selects one of the PDN connection/PDU sessions associated to EPC for the delivery of the URSP update. Then the PCF generates the corresponding UPDP message MANAGE UE POLICY COMMAND in a similar way than it is done in 5GC and then includes the message into a new IE for sending it to the SMF over N7.\n2.\tThe UPDP message is then provided to the SMF+PGW-C by invoking Npcf_SMPolicyControl_UpdateNotify request.\n3.\tThe PCF starts timer T3501 to monitor the reception of an answer for UPDP MANAGE UE POLICY COMMAND.\n4.\tThe SMF+PGW-C, upon reception of the new IE with UPDP message, answers the PCF with Npcf_SMPolicyControl_UpdateNotify response and initiates a bearer modification procedure without bearer QoS update (as defined in clause 5.4.3 of TS 23.401 [8]) to provide the UE Policy Container ePCO towards the UE.\n5-7.\tThese steps follow the existing procedure for bearer modification procedure without bearer QoS\n8.\tWhen the UE gets the UE Policy Container ePCO including a MANAGE UE POLICY COMMAND UPDP message, the UE processes that message in a similar way than when it is received in 5GC, i.e. stores the URSP updates, optionally re-evaluates the mapping of applications into PDN connections according to the mapping of URSP values into EPC, and generates UPDP message MANAGE UE POLICY COMMAND COMPLETE with the result to the PCF.\n9.\tThe UE then generates a UE Policy Container UPDP including the MANAGE UE POLICY COMMAND COMPLETE, and include it in the EPS Bearer Context Response sent to the MME.\n10-11.\tThese steps follow the existing procedure defined for Update Bearer Response\n12.\tUpon reception of UE Policy Container ePCO in Update Bearer Response, the SMF+PGW-C then invokes Npcf_SMPolicyControl_Update Request including the content of the UE Policy Container ePCO.\n13.\tThe PCF processes the MANAGE UE POLICY COMMAND COMPLETE in a similar way than in 5GC as defined in TS 29.525 [9] and stops timer T3501.\n14.\tThe PCF sends Npcf_SMPolicyControl_Update Response.\nThis clause extends the procedure in clause 6.16.2.1 when the PCF for a PDU session is different than the PCF for a UE.\nFigure 6.16.2.3.1-1 illustrates a telecommunication network's signal flow, showcasing the interaction between various nodes and protocols. The figure depicts the signal starting at the source, passing through multiple nodes such as the access network, aggregation network, and core network, before reaching the destination. The nodes are interconnected through a series of links, each with different capacities and functionalities. The figure also highlights the role of protocols like MPLS (Multi-Protocol Label Switching) and SDN (Software-Defined Networking) in managing and controlling the flow of data. The overall layout emphasizes the complexity and interconnectedness of modern telecommunication networks.\nFigure 6.16.2.3.1-1\n1-7.\tThey are the same than the ones described for deployments with a collocated PCF in clause 6.16.2.1, with the difference that in step 5 the SMF+PGW-C selects a PCF for a PDU session (PCF-SM)\n2.\tThe PCF-SM checks that the SMF+PGW-C provided a UE Policy Container in step 1 and then request the establishment of a UE Policy Association towards PCF-UE providing the UE Policy Container received from the SMF+PGW-C.\n3.\tThe PCF-UE follows standard procedure to handle the UE Policy establishment as defined in clause 4.16.11 of TS 23.502 [3] for the roaming case. It determines whether an update of URSP is needed and in such a case generates a UE Policy Container including the URSP update (UPDP message MANAGE UE POLICY COMMAND).\n4.\tThe PCF-UE answers the UE Policy Association establishment request.\n5.\tIf a UE Policy Container is provided to the PCF-SM in step 4, the flow continues with steps 2-14 from procedure defined in clause 6.16.2.2 for deployments with a collocated PCF and the PCF-SM forwards the UE Policy Container to the UE via SMF+PGW-C.\nThis clause extends the procedure in 6.16.2.2 for URSP updates initiated by the PCF when the PCF for a PDU session is different than the PCF for a UE.\nFigure 6.16.2.3.2-1 illustrates a telecommunication network's signal flow, showcasing the interaction between various nodes and protocols. The figure depicts the signal starting at the source, passing through multiple nodes such as the access network, aggregation network, and core network, before reaching the destination. The nodes are interconnected through a series of links, each with different capacities and characteristics. The figure also highlights the role of protocols like MPLS (Multi-Protocol Label Switching) and SDN (Software-Defined Networking) in managing and controlling the flow of data. The overall layout emphasizes the complexity and interconnectedness of modern telecommunication networks.\nFigure 6.16.2.3.2-1\n0:\tAn event as described in clause 6.16.1.1 happens in the PCF-UE. The PCF-UE triggers the re-evaluation of applicable URSPs for the UE and determines an update of URSP is needed for the UE.\n1.\tIf several ongoing UE Policy Associations with new indication \"5GS to EPC handover\" exists in the PCF-UE this selects one of them for the delivery of the URSP update.\n2.\tThe PCF-UE generates the corresponding UE Policy Container (UPDP message MANAGE UE POLICY COMMAND) in a similar way than it is done in 5GC (according to clause 4.16.12.2 of TS 23.502 [3]) and then invokes Npcf_UEPolicyControl_UpdateNotify including the UE Policy Container.\n3.\tPCF-SM answers Npcf_UEPolicyControl_UpdateNotify.\n4.\tIt follows the steps 2-14 from clause 6.16.2.2 for a deployment with a collocated PCF.\n5.\tThe PCF-SM sends Npcf_UEPolicyControl_Update to provide the received UE Policy Container (including MANAGE UE POLICY COMMAND COMPLETE UPDP message from the UE) to the PCF-UE.\n6.\tThe PCF-UE processes the MANAGE UE POLICY COMMAND COMPLETE in a similar way than in 5GC as defined in TS 29.525 [9] and answers Npcf_UEPolicyControl_Update.\nThis clause shows the impact in the procedure for 5GS to EPC handover when the PCF for a PDU session is different than the PCF for a UE.\nFigure 6.16.2.3.3-1 illustrates a telecommunication network's signal flow, showcasing the interaction between various nodes and protocols. The figure depicts a network with multiple layers, including the physical, data link, network, transport, and application layers. Each layer is represented by distinct icons and lines, illustrating the flow of data and signaling between devices. The physical layer, represented by the green icon, deals with the transmission of raw bits over the network. The data link layer, depicted by the blue icon, handles the framing and error detection of the data. The network layer, shown by the orange icon, is responsible for routing the data packets to their destination. The transport layer, represented by the red icon, ensures the reliable transmission of data. Finally, the application layer, shown by the purple icon, is responsible for the communication between the network and the user. The figure also includes various protocols, such as TCP and UDP, which are used to ensure the reliable transmission of data over the network. Overall, the figure provides a comprehensive overview of the telecommunication network's signal flow and the various protocols and layers involved in its operation.\nFigure 6.16.2.3.3-1\n1.\tIt follows standard procedure for 5GS to EPC handover as described in clause 4.11.1.2.1 of TS 23.502 [3] (similar for handover with idle mobility).\n2.\tFor the scenarios with N26 the AMF invokes the deletion of UE Policy Association including a new indication \"5GS handover to EPC\".\n3-4.\tBased on the new indication (\"5GS handover to EPC\") the PCF-UE, after the PCF-UE answers the AMF, the PCF-UE decides to maintain the UE Policy association for a configurable period (e.g. 20s), until the new UE Policy Association from the PCF-SM is received. In addition, during this period, no other actions associated to the removal of the UE Policy Association (e.g. unbinding from BSF or un-subscription from UDR notifications for this UE) are executed.\nNOTE 1:\tIf step 2 happens after step 8 the PCF-UE may remove directly the former UE Policy Association.\n5.\tSMF+PGW-C notifies PCF-SM about the handover to EPC invoking Npcf_SMPolicyControl_Update Request.\nThis step happens for every ongoing PDU session handled by the PCF-SM.\n6.\tPCF-SM answers SMF+PGW-C as in standard procedure.\n7.\tThe PCF-SM determines whether the UE supports URSP delivery in EPC by checking UE context policy control subscription information in UDR and based on that decides to establish a UE Policy Association towards the PCF-UE.\nNOTE 2:\tFor those deployments where the solution is restricted to a specific combination of S-NSSAI/DNN the PCF-SM also checks if the PDU session being notified by SMF+PGW-C is established towards the specific S-NSSAI/DNN. In other case the PCF-SM controls that only one UE Policy Association Establishment is established and maintained for the same UE. In case the same PCF-SM maintains several PDU sessions for the same UE the PCF-SM will establish the UE Policy Association only for the first PDU session establishment which reports the change of RAT-Type.\n8.\tThe PCF-SM discovers the address of the PCF-UE handling the UE by querying BSF.\n9.\tThe PCF-SM establishes a UE Policy Association towards the PCF-UE including an empty UE Policy Container, i.e. no information about PSI list in the UE is provided to the PCF-UE and an indication about the trigger for the UE Policy association establishment (\"5GS to EPC handover\").\nNOTE 3:\tIf the removal of associated information for the former UE Policy Association was delayed, the PCF-UE can now delete it. Since additional UE Policy Associations are still ongoing for this UE (the one from PCF-SM) the PCF-UE doesn't execute other additional actions associated to the removal of the UE Policy Association (e.g. unbinding from BSF or un-subscription from UDR notifications for this UE).\n10.\tBased on the indication received in step 9, the PCF-UE recovers the information about the PSI list in the UE and the subscribed PCRTs in 5GS from former UE Policy Association for the UE.\nNOTE 4:\tIf the removal of associated information for the former UE Policy Association was delayed, the PCF-UE can now delete it. Since additional UE Policy Associations are still ongoing for this UE (the one from PCF-SM) the PCF-UE does not execute other additional actions associated to the removal of the UE Policy Association (e.g. unbinding from BSF or un-subscription from UDR notifications for this UE).\n11.\tThe PCF-UE follows standard procedure to handle the UE Policy establishment as defined in clause 4.16.11 of TS 23.502 [3] for the roaming case. It determines whether an update of URSP is needed and in such a case generates a UE Policy Container including the URSP update (UPDP message MANAGE UE POLICY COMMAND).\n12.\tThe PCF-UE sends Npcf_UEPolicyControl create answer including a UE Policy Container with the URSP updates if needed and the list of PCRTs, obtained from the former UE Policy Association for the UE in 5GS.\nNOTE 5:\tNote that only the list of supported PCRTs over N7 will be supported for the UE Policy Association (e.g. Connectivity State changes event trigger is not supported over N7).\n13.\tFollows steps 2-14 of the procedure described in clause 6.16.2.2.1 for URSPs update initiated by PCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.16.3\tImpacts",
                            "text_content": "Impact on interface:\nN7:\n-\tIntroduce additional IE for the transfer of UE Policy Container between SMF+PGW-C and PCF.\nNAS, S11, S5/S8(?):\n-\tIntroduce new parameter UE Policy Container in ePCO.\nImpact on PCF:\n-\tHandling of UE Policy Container within SM Policy Association procedures.\n-\tFor those cases where PCF initiates the sending of URSP update for a UE in EPC, the triggering of SM Policy Association modification including the new IE with MANAGE UE POLICY COMMAND UPDP message.\n-\tPCF-SM establishes UE Policy Association towards PCF-UE upon EPC initial attach and 5GS to EPC handover.\n-\tPCF-UE handles new indication in UE Policy association deletion so it may delay the removal of UE Policy Association in PCF-UE during a short configured period, waiting for the new one established from PCF-SM.\n-\tPCF-UE handles new indication in UE Policy Association establishment from PCF-SM at handover to EPC, so it may get the list of PSIs stored in the UE from former UE Policy Association from 5GS.\nImpact on SMF+PGW-C:\n-\tUpon reception of UE Policy Container ePCO in Create Session Request, the SMF+PGW-C forwards the UE Policy Container to the PCF at SM Policy Association establishment. Use the reception of UPDP Container as an additional reason to establish the SM Policy Association, even in case the network configuration for the APN of the PDN connection does not require PCF involvement.\n-\tUpon reception of UE Policy Container from PCF during SM Policy Association initiated by PCF, SMF+PGW-C performs a Bearer Modification Procedure without bearer QoS update including the UE Policy Container ePCO.\n-\tUpon reception of Update Bearer Response from MME including UE Policy Container ePCO, the SMF+PGW-C forwards the received UE Policy Container to PCF.\nImpact on UE:\n-\tDuring initial attach in EPC, the UE includes UE STATE INDICATION UPDP message into UE Policy Container ePCO in PDN Connectivity Request encapsulated in Attach Request.\n-\tThe UE receives MANAGE UE POLICY COMMAND in UE Policy Container ePCO during EPS Bearer Context Request and process it as in 5GC. The UE generates MANAGE UE POLICY COMPLETE UPDP message and send it to the MME encapsulated into a UE Policy Container ePCO in EPS Bearer Context Response.\n-\tThe UE includes additional parameter in UE Policy Container at 5GS initial registration about whether it supports URSP provisioning via EPC.\nImpact on AMF:\n-\tFor deployments with N26 the AMF includes a new indication when the UE Policy Association is deleted due to a 5GS to EPC handover.\n-\tImpact on UDR:\n-\tThe information in UE context policy control subscription information is extended with a new attribute which indicates whether the UE supports URSP delivery in EPC.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.17\tSolution #17: Indication of applicability of URSP to UE in EPS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.17.1\tDescription",
                            "text_content": "Support of URSPs in EPS was introduced in 3GPP Rel-16. A Rel-16 UE can use URSPs while in EPS (S1 mode) by translating the various parameters in the Traffic Descriptors and Route Selection Descriptors to corresponding EPS parameters as defined in clause 4.4.2 of TS 24.526 [10]. URSPs are still provisioned via 5GC. Whereas for the Traffic Descriptors (TD) a 1-to-1 mapping can be derived, certain 5GS parameters of a Route Selection Descriptor (RSD) do not have an exact equivalent in EPS e.g. SSC mode selection, Network Slice selection, DNN selection, Time Window, Location criteria etc. For this purpose, a static mapping of 5GS parameters to EPS was specified in the Table 4.4.2.2 of TS 24.526 [10], with certain parameters marked as not applicable in EPS. A UE in EPS currently ignores an RSD if it contains any such parameter that are marked as not applicable in Table 4.4.2.2 of TS 24.526 [10].\nAlthough this static mapping enables the use of certain URSPs in EPS, i.e. the ones that do not contain any of the non-applicable parameters, this static mapping of what is applicable in EPS is very limiting. Essentially, a network operator, to ensure that the UEs in EPS behave as desired, has to design and provision EPS-specific RSDs that avoid any non-applicable parameter. This results to unnecessary signalling, storage and processing overheads at both UE and network sides, and network management overheads.\nAdditionally, with this static mapping none of those parameters can be used by a UE while in EPS. However, for certain features like edge computing, \"Time Window\" and \"Location Criteria\" are spatial and temporal criteria which could be used to determine the validity of URSP rules.\nIn this solution, it is proposed to introduce a new optional parameter \"EPS applicability\" in the Route Selection Descriptor component of a URSP rule. The new parameter, if present in the RSD, will provide an indication to the UE, whether the RSD parameter is applicable in EPS.\nIn order to ensure backwards compatibility and avoid any unnecessary signalling, at registration the UE shall indicate whether it supports this new feature. If the UE includes the \"EPS RSD support indication\" during registration, the PCF may then include the additional parameter \"EPS applicability\" in the RSD component to indicate how the UE should use each RSD parameter in EPS. This design ensures that the optional applicability indication can be used only if needed, and supported by both the UE and the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.17.2\tProcedures",
                            "text_content": "Figure 6.16.2.1-1 explains the procedure for URSP provisioning with EPS applicability indication.\nFigure 6.17.2.1-1 illustrates the process of Universal Resource Identifier (URI) provisioning with the European Public Safety (EPS) applicability indication. The figure showcases the various stages of URSP provisioning, starting from the initial request to the final configuration. Key elements include the Public Safety Answering Point (PSAP), the Emergency Services Network (ESN), and the core network elements responsible for handling the provisioning process. The figure highlights the importance of accurate and efficient URSP provisioning for public safety communications, ensuring seamless connectivity and effective response during emergencies.\nFigure 6.17.2.1-1: URSP provisioning with EPS applicability indication\n1.\tAt registration the UE indicates support of the feature by including the \"EPS RSD support indication\".\n2.\tIf the UE has indicated support for \"EPS RSD support indication\" then the PCF generates the URSP rules including the applicability of certain parameters to EPS. For each Route Selection Descriptor component, the PCF shall include the new optional parameter \"EPS applicability\".\n3.\tUE indicates the success or failure of update.\nThe Route Selection Descriptor component is extended as shown in Table 6.17.2.1-1 below to support the \"EPS applicability\" indication.\nEditor's note:\tIt is FFS whether the EPS applicability indication is included to all components or only to the ones for which the handling over the static mapping of \"4.4.2 Use of URSP in EPS\" of TS 24.526 [10] as per Rel-16 is to be overridden.\nTable 6.17.2.1-1: Route Selection Descriptor component\n\nWhen the UE is in S1 mode, during URSP evaluation the UE shall:\n-\tignore the complete RSD if any RSD component has EPS applicability parameter set to \"Not applicable\".\n-\tonly ignore the specific RSD component (i.e. not the whole RSD) when the EPS applicability parameter is set to \"To be ignored in EPS\".\n-\tconsider the RSD component in EPS also if the EPS applicability parameter in the RSD component is set to \"Applicable to EPS\".\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.17.2.1-1: Route Selection Descriptor component",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.17.3\tImpacts on services, entities and interfaces",
                            "text_content": "The solution has the following impacts:\nPCF:\n-\tPCF shall support the additional parameter (EPS applicability indication) in RSD component of URSP rule as explained in clause 6.16.2.1.\n-\tPCF shall include the \"EPS applicability indication\" in RSD component only if UE has provided \"EPS RSD support indication\" during registration.\nUE:\n-\tUE shall include \"EPS RSD support indication\" during registration.\n-\tUE shall support evaluation of the URSP rules as described in clause 6.16.2.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.18\tSolution #18: Provisioning consistent URSP to UE across 5GS and EPS for Collocated PCF Deployment",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.18.1\tDescription",
                            "text_content": "This solution addresses KI#3 and assumes a collocated PCF deployment where the PCF serving the UE and PCF serving each of the PDU Sessions of the UE are the same. The solution aims to solve the issue when ANDSF is not deployed in EPS.\nWith regard to the scenarios and gaps (first two bullets in the KI#3), if a UE has used the Route Selection component (e.g. DNN) in a URSP rule in EPS and the Route Selection component (e.g. DNN) has been changed when the UE stays in EPS, the updated URSP rule needs to be provisioned to UE in EPS, otherwise the UE in EPS may use outdated DNN to establish PDN connection in EPS. In 5GS the UE may be provisioned with URSP rules for both 5GS and EPS by the PCF of the HPLMN. Only the rules provisioned by the PCF are used by the UE, if both URSP rules provisioned by the PCF and pre-configured URSP rules are present. The URSP rules are provisioned in UE using NAS messages. The AMF transparently transfers the UE Policy container (UE policy information) received from the PCF to the UE (using DL NAS TRANSPORT message). The UE Policy container includes the list of Policy Sections as described in TS 23.503 [4]. Similar mechanism can be used to provision URSP rules in EPS.\nSince the URSP usage is not supported by a Rel-15 UE supporting interworking between EPS and 5GS, it's not necessary to provision/update the URSP to such UE, which will cause additional signalling overload. Thus, the EPS needs to be aware whether a 4G interworking UE supports the URSP usage or not.\nTo realize provisioning of consistent URSP rules in UE, this solution follows the below two principles:\n1)\tThe same set of URSP is provisioned to UE regardless of UE attaching to EPS or registering to 5GS.\n2)\tThe UE in EPS uses the components in RSD of a URSP rule according to Rel-16 specification defined in clause 5.17.1.2 of TS 23.501 [2].\nThe EPS and 5GS interworking architecture defined in TS 23.501 [2] is reused, the solution addresses the collocated PCF deployment scenario where the SM-PCF and UE-PCF are collocated, N7 interface is reused to provision URSP from PCF to PGW-C and no new interface is introduced. The solution proposes a mechanism for the network to provision and update the URSP for a UE in EPS by encapsulating UE Policy Container in ePCO via one of the PDN connections. The UE Policy Container is transparently forwarded via SMF+PGW-C. The communication between SMF+PGW-C and PCF reuses the SM Policy Association procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.18.2\tProcedures",
                            "text_content": "1.\tThe UE sends the UE Policy Container including URSP Support indication in EPS which is indicating whether a UE supports URSP usage or not in EPS (defined in TS 23.501 [2] clause 5.17.1.2) and the PSIs (Policy Set Identifier) in ePCO (extended PCO) to SMF+PGW-C during Initial Attach procedure (in the Attach Request) as described in clause 5.3.2.1 of TS 23.401 [8] and the UE requested PDN connectivity procedure (PDN Connectivity Request) as described in clause 5.10.2 of TS 23.401 [8].\n2.\tThe SMF+PGW-C transparently forwards the UE Policy Container in ePCO to the PCF as a new IE in the PDU Session Establishment (Npcf_SMPolicyControl_Create Request).\nNOTE:\tIf the PCF involvement for a PDN connection is not required, the SMF+PGW-C should still establish SM Policy Association with PCF and forward the UE Policy Container to PCF based on local configuration.\n3.\tThe PCF gets policy subscription related information and the updated list of PSIs from the UDR. The PCF creates the UE policy container including UE policy information as defined in clause 6.6 of TS 23.503 [4]. Then it sends the latest UE policy information in the UE Policy Container to SMF+PGW-C.\n4.\tThe SMF+PGW-C sends the UE Policy Container in ePCO to UE in Activate Default EPS Bearer Context message which may be encapsulated in Attach Accept message.\n5.\tThe UE sends a response to SMF+PGW-C by acknowledging the reception of the UE Policy reusing existing messages (e.g. Attach Complete, Modify Bearer Request) as defined in clause 5.3.2 of TS 23.401 [8].\n6.\tThe SMF+PGW-C forwards the acknowledgement of UE reception of the UE Policy to PCF using Npcf_SMPolicyControl_Update request.\n1.\tWhen the PCF is notified by UDR that the URSP is updated, it triggers the UE Policy update procedure towards the SMF+PGW-C using Npcf_SMPolicyControl_UpdateNotify request. The PCF selects one of the PDN connections for the UE in EPS for the delivery of the updated URSP rules.\n2.\tThe SMF+PGW-C transparently forwards the updated URSP rules to UE in UE Policy Container via ePCO, which can be achieved by reusing existing messages (e.g. Update Bearer Request, Downlink NAS Transport) as defined in clause 5.4.3 of TS 23.401 [8].\n3.\tWhen the UE receives the updated URSP rules, it updates the URSP rules and sends a response to SMF+PGW-C by acknowledging the reception of the UE Policy reusing existing messages (e.g. Uplink NAS Transport, Update Bearer Response,) as defined in clause 5.4.3 of TS 23.401 [8].\n4.\tThe SMF+PGW-C forwards the acknowledgement of UE reception of the UE Policy to PCF using Npcf_SMPolicyControl_Update request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.18.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE:\n-\tSend the UE Policy Container including UE capability to support URSP Support indication in EPS and PSIs to PGW-C via ePCO.\n-\tReceive the URSP rules in the UE Policy Container from PGW-C via ePCO.\n-\tSends an acknowledgement of UE Policy reception.\nSMF+PGW-C:\n-\tTransparently forward the UE Policy Container in ePCO to PCF.\n-\tTransparently forward the UE Policy Container in ePCO to UE.\nPCF:\n-\tReceive the UE Policy Container from SMF+PGW-C.\n-\tInitiates transfer of URSP rules in UE Policy Container to UE via SMF+PGW-C.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.19\tSolution #19: Provision of URSP to UE when the UE attaches in the EPS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.19.1\tIntroduction",
                            "text_content": "This solution addresses key issue#3 'Provision consistent URSP to UE across 5GS and EPS'.\nWhen the UE is attaching to the EPS system, the PGW-C+SMF node requests the PCF to provide the URSP information. The PCF provides the URSP information after interacting with the UDR.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.19.2\tProcedures",
                            "text_content": "Figure 6.19.2-1 illustrates the transfer of the Universal Resource Identifier (URSP) procedure when a User Equipment (UE) is registering to the Evolved Packet System (EPS) system. The figure depicts the interaction between the UE, the Home Location Register (HLR), and the Serving Gateway (S-GW) in the context of the Universal Mobile Telecommunications System (UMTS). The process begins with the UE sending a registration request to the HLR, which then forwards the request to the S-GW. The S-GW processes the request and sends a confirmation back to the UE. This figure is significant as it outlines the steps involved in establishing a connection between the UE and the network, ensuring seamless communication and service delivery.\nFigure 6.19.2-1: Transfer of URSP procedure when the UE is registering to the EPS system\nThe detailed steps of the procedure are defined below:\n1.\tThe UE initiates attach procedure to a PLMN by sending an attach request message to the MME. The UE includes the UE policy list, UE policy classmark and UE OS ID Information Element (IE) either in a PDN connectivity request message or in the attach request message. The UE policy list, the UE policy classmark and the UE OS ID Information Element (IE) may be set in the PCO parameter in the attach request message.\nNOTE 1:\tUE policy list, the UE policy classmark and the UE OS ID are defined in TS 24.501 [7].\n2.\tUpon reception of the attach request message, the MME sends a create session request message containing PCO, UE status and the UE policy list, the UE policy classmark and the UE OS ID Information Element (IE) to the S-GW. The UE status may be added to the create session request message by the MME. The UE status may include following information:\n-\tCN type: It indicates a CN type, core network type, that the UE is being or has attached. E.g. EPC or 5GC.\n-\tAccess Type: It indicates an access that the UE is accessing. E.g. 3GPP access or Non-3GPP access.\n-\tRAT type: It indicates a Radio Access Technology that the UE is accessing. E.g. EUTRAN, EUTRAN-NB-IoT, LTE-M, or NR.\n-\tServing Network (PLMN ID, or PLMN ID and NID).\nIn this solution, the MME may determine the UE status based on local information regarding the UE in the MME or received information regarding the UE from other network node(s).\n3.\tUpon reception of the create session request message the S-GWsends the create session request message containing the PCO, the UE status and the UE policy list, the UE policy classmark and the UE OS ID Information Element (IE) to the PGW-C+SMF.\n4.\tUpon reception of the create session request message the PGW-C+SMF sends Npcf_get_UEpolicy Request message containing Policy type, S1 mode supported, N1 mode supported, the UE policy list, the UE policy classmark, the UE OS ID IE and the UE status. The Policy type indicates a type of UE policy that the PGW-C+SMF wants to fetch for the UE. If the UE policy list, the UE policy classmark and the UE OS ID Information Element (IE) are encapsulated in the PCO, the PGW-C+SMF extracts the UE policy list, the UE policy classmark and the UE OS ID Information Element (IE) from the PCO.\nIf policy list is not contained in the create session request message, the PGW-C+SMF includes Policy type information element. In this solution, the PGW-C+SMF may determine the Policy type information element based on the UE policy list. In this solution, the PGW-C+SMF may determine the Policy type information element based on a local configuration in the PGW-C+SMF or stored information regarding policy list of the UE.\nThe PGW-C+SMF may obtain the \"S1 mode supported\" and the \"N1 mode supported\" based on information regarding the UE stored in the PGW-C+SMF or received information regarding the UE from other network node(s).\nNOTE 2:\tThe PGW-C+SMF can discover and select the UE PCF according to clause 6.3.7.1 of TS 23.501 [2]. The UE PCF can be colocated with SMF PCF or can be a separate PCF than the SMF PCF.\n5.\tUpon reception of the message from the PGW-C+SMF, the PCF sends Nudr_get_UEpolicy Request message containing the Policy type, the S1 mode supported, the N1 mode supported, the UE policy list, the UE policy classmark, the UE OS ID and the UE status to the UDR.\n6.\tUpon reception of the message from the PCF, the UDR transfers the UE policy to the PCF in the Nudr_get_UEpolicy Response message.\n7.\tUpon reception of the UE policy in the response message from the UDR, the PCF sends Npcf_get_UE policy response message to the PGW-C+SMF.\n8.\tUpon reception of the UE policy in the response message from the PCF, the PGW-C+SMF sends a Create session response message containing the UE policy to the S-GW. The UE policy may be stored in the PCO. The UE policy may be stored in the PCO of the Create session response message.\n9.\tUpon reception of the Create session response message, the S-GW sends a Create session response message containing PCO and the UE policy to the MME.\nUpon reception of the Create session response message the MME takes either step 10a or step 10b.\n10a.\tThe MME sends an attach accept message containing the PCO and Activate Default EPS Bearer Context Request message which contains the UE policy. If the UE policy is encapsulated in the PCO, the UE extracts the UE policy from the PCO.\n10b.\tThe MME sends an attach accept message containing the PCO and the UE policy and an Activate Default EPS Bearer Context Request message.\n11.\tThe UE upon reception of the UE policy applies the UE policy when the UE is registered in the EPS or when the UE registers to the 5GS as defined in TS 24.526 [10].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.20\tSolution #20: URSP delivery for the UE in EPS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.20.1\tDescription",
                            "text_content": "According to clause 5.2.1 of TS 23.503 [4], the SM-PCF does not support N15 reference point while the UE-PCF does not support N7 reference point. In this solution, for URSP delivery from UE-PCF in 5GC to the UE in EPS, the UE Policy Association establishment between SM-PCF and UE-PCF is proposed. The URSP can be transparently delivered to the UE via SM-PCF, SMF+PGW-C, SGW, and MME. The architecture is shown in Figure 6.20.1-1.\nFigure 6.20.1-1 illustrates the non-roaming architecture for Universal Resource Sharing Protocol (URSP) delivery to the User Equipment (UE) in Evolved Packet System (EPS). The figure depicts the various components involved, including the Home Location Register (HLR), Serving Gateway (S-GW), and the User Equipment (UE). The non-roaming architecture ensures efficient resource sharing and management, enabling seamless communication between the network and the UE. The figure highlights the role of the S-GW in forwarding packets and managing connections, while the HLR stores essential information about the UE, such as its identity and location. The UE, as the end-user device, plays a crucial role in consuming the resources provided by the network. Overall, the non-roaming architecture depicted in the figure is essential for delivering high-quality services to the UE in EPS networks.\nFigure 6.20.1-1: Non-roaming architecture for URSP delivery to the UE in EPS\nAs depicted in Figure 6.20.1-1, an interface (Nx) needs to be specified between SM-PCF and UE-PCF for establish an UE Policy Association. N15 interface can be reused as Nx.\nWhen the UE sends Attach Request in EPS (e.g. Initial Attach procedure, 5GS to EPS Mobility procedure without N26), the UE sends UE Policy Container including list of PSIs and URSP delivery over EPS Indication in PCO to UE-PCF. The detail procedure is introduced in clause 6.20.2.1.\nWhen the UE policy has been updated in PCF while UE is in EPS, the UE-PCF sends UE Policy Container to SMF+PGW-C. The SMF+PGW-C sends PCO including UE Policy Container to the UE. The detail procedure is introduced in clause 6.20.2.2.\nWhen the UE sends Registration Request in 5GS, UE Policy Container including list of PSIs and URSP delivery over EPS Indication to UE-PCF. The detail procedure is introduced in clause 6.20.2.3.\nIn 5GS to EPS Handover/Idle mode mobility using N26, the UE Policy Association established in 5GS can be maintained in EPS. The detail procedures are introduced in clauses 6.20.2.4, 6.20.2.5, 6.20.2.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.20.2\tProcedures",
                            "text_content": "Figure 6.20.2-1 illustrates the procedure initiated by the User Equipment (UE) in the Evolved Packet System (EPS) for policy delivery. The figure depicts the interaction between the UE, the Home Node B (H-Node B), and the Serving Node (S-Node) in the event of a policy delivery request. The UE sends a Policy Delivery Request (PDR) to the S-Node, which then forwards the request to the Home Location Register (HLR) for policy decision. The H-Node B plays a crucial role in relaying the PDR to the S-Node and ensuring the proper delivery of the requested policy. The figure emphasizes the importance of efficient communication between the UE, H-Node B, and S-Node in maintaining a smooth and secure communication process.\nFigure 6.20.2-1: UE Policy delivery procedure initiated by the UE in EPS\n1.\tUE sends UE Policy Container including the list of PSIs and URSP delivery over EPS Indication SMF+PGW-C. The PCO can be included in Attach Request and Create Session Request as described in Figure 5.3.2.1-1 of TS 23.401 [8].\n2.\tThe SMF+PGW-C invokes Npcf_SMPolicyControl_Update Request to the SM-PCF to forwards the UE Policy Container to the SM-PCF. The SMF+PGW-C provides SUPI, UE Policy Container and UE-PCF ID to the SM-PCF. The SM-PCF can notice that the UE-PCF Association Establishment with UE-PCF is allowed in this network by the presence of UE Policy Container in PCO and UE-PCF ID.\nNOTE:\tThe SMF+PGW-C discovers and selects the UE-PCF as described in clause 6.3.7.1 of TS 23.501 [2].\n3.\tThe SM-PCF establishes the UE-PCF Association with the UE-PCF which is identified UE-PCF ID received from the SMF+PGW-C, and forwards the UE Policy Container to the UE-PCF.\n4.\tThe UE-PCF sends to SM-PCF the UE-PCF Association Establishment Response with result of UE-PCF Association establishment result.\n5.\tThe UE-PCF gets policy subscription related information and the latest list of PSIs from the UDR using Nudr_DM_Query service operation. The UE-PCF creates the UE policy container including UE policy information as defined in clause 6.6 of TS 23.503 [4] (step 6 of Figure 4.16.11-1 of TS 23.502 [3] can be reused).\n6.\tWhen the UE-PCF decides to provide the UE policy to the UE, the UE-PCF sends to SM-PCF the UE Policy Container.\n7.\tThe SM-PCF forwards the UE Policy Container to the SMF+PGW-C by Npcf_SMPolicyControl_Update Response.\n8.\tThe Initial Attach procedure is continued as described in Figure 5.3.2.1-1 of TS 23.401 [8]. The SMF+PGW-C sends the PCO which is including the UE Policy Container to the UE. The PCO can be included in Attach Accept. The UE sends the acknowledgement on successful reception of the UE Policy to the SMF+PGW-C, this acknowledgement can be included in the Attach Complete and Modify Bearer Request.\n9.\tThe SMF+PGW-C forwards the UE's acknowledgement by invoking Npcf_SMPolicyControl_Update Request to the SM-PCF.\n10.\tThe SM-PCF forwards the UE's acknowledgement to the UE-PCF.\nFigure 6.20.2-2 illustrates the UE Policy Delivery Procedure initiated by the Policy and Charging Control Function (PCF). The figure depicts the interaction between the PCF and the User Equipment (UE) in a network, highlighting the process of policy delivery and enforcement. The PCF is responsible for managing and delivering policies to the UE, ensuring that the correct services and charges are applied. The figure shows the flow of information between the PCF and the UE, with various components involved in the process, such as the Policy Decision Point (PDP), Policy and Charging Rules Function (PCRF), and Charging System (CS). The figure emphasizes the importance of accurate policy delivery and enforcement in maintaining the integrity of the network and ensuring proper billing and service management.\nFigure 6.20.2-2: UE Policy delivery procedure initiated by the PCF\n1.\tThe UE-PCF is notified from the UDR that the URSP is updated.\n2.\tThe UE-PCF sends to SM-PCF the UE Policy Container which includes the updated URSP.\n3.\tThe SM-PCF forwards the UE Policy Container to the SMF+PGW-C by Npcf_SMPolicyControl_UpdateNotify Request.\n4.\tThe SMF+PGW-C sends the PCO which is including the UE Policy Container to the UE. The step 2 to 5 described in Figure 5.4.3-1 of TS 23.401 [8] is used. The PCO can be included in Update Bearer Request, Downlink NAS Transport, and Direct Transfer. The UE sends the acknowledgement on successful reception of the UE Policy to the SMF+PGW-C, this acknowledgement can be included in Direct Transfer, Uplink NAS Transport, and Update Bearer Response.\n5.\tThe SMF+PGW-C forwards the UE's acknowledgement by invoking Npcf_SMPolicyControl_Update Request to the SM-PCF.\n6.\tThe SM-PCF forwards the UE's acknowledgement to the UE-PCF.\nDuring Registration procedure in 5GS, the UE sends UE Policy Container including the list of PSIs and URSP delivery over EPS Indication to AMF in Registration request as described in clause 4.2.2 of TS 23.502 [3].\nAMF transparently forwards UE Policy Container to UE-PCF during UE Policy Association Establishment as described in clause 4.16.11. UE-PCF stores URSP delivery over EPS Indication. The UE-PCF determines whether the UE Policy Association established in 5GS can be maintained in EPS based on this indication as described in clauses 6.20.2.4 and 6.20.2.5.\nFigure 6.20.2-3 illustrates the handover process from 5G New Radio (NR) to Evolved Packet System (EPS) in single-registration mode with N26 interface. The figure depicts the signaling between the 5G NR eNB and the EPS bearer, showing the exchange of messages for authentication, authorization, and accounting (AAA) procedures. The diagram highlights the role of the Network Slice Identifier (NSI) and the Network Slice Identifier (NSI) in facilitating seamless handover between the two networks. The figure is a valuable resource for understanding the technical details of 5G NR to EPS handover, particularly in the context of single-registration mode with N26 interface.\nFigure 6.20.2-3: (Figure 4.11.1.2.1-1 of TS 23.502 [3]) 5GS to EPS handover for single-registration mode with N26 interface\nStep 18 includes the deregistration of the old AMF for 3GPP access from the HSS+UDM as specified in clause 4.11.1.5.3 in TS 23.502 [3]. The registered AMF for 3GPP access initiates UE Policy Association Termination procedure as defined in clause 4.16.13.1 in TS 23.502 [3]. The UE-PCF determines whether to terminate the UE Policy Association based on URSP delivery over EPS Indication received from UE (as described in clause 6.20.2.1 and 6.20.2.3). The UE-PCF rejects the Npcf_UEPolicyControl_Delete request from the AMF and informs to the AMF that the UE Policy Association can be maintained in EPS. In this case, the AMF initiates the procedure to move the UE Policy Association established between the AMF and UE-PCF to between SM-PCF and UE-PCF as described in clause 6.20.2.6.\nFigure 6.20.2-4 illustrates the transition from 5GS to EPS Idle mode mobility using the N26 interface. The figure depicts the process of a 5G New Radio (NR) user equipment (UE) moving from the 5GS to the EPS Idle mode, which is a crucial step in maintaining seamless connectivity during handovers. The figure showcases the interaction between the 5GS and the Evolved Packet System (EPS) Idle mode, highlighting the role of the N26 interface in managing the UE's mobility. The figure is a valuable resource for understanding the intricate details of 5G network management and the importance of maintaining a smooth transition between different network modes for optimal performance.\nFigure 6.20.2-4: (Figure 4.11.1.3.2-1 in TS 23.502 [3]) 5GS to EPS Idle mode mobility using N26 interface\nIn step 15, The UE-PCF determines whether to terminate the UE Policy Association based on URSP delivery over EPS Indication received from UE (as described in clause 6.20.2.1 and 6.20.2.3). The UE-PCF rejects the Npcf_UEPolicyControl_Delete request from the AMF and informs to the AMF that the UE Policy Association can be maintained in EPS. In this case, the AMF initiates the procedure to move the UE Policy Association established between the AMF and UE-PCF to between SM-PCF and UE-PCF as described in clause 6.20.2.6.\nFigure 6.20.2-5 illustrates the process of relocating an established User Equipment (UE) Policy Association (PA) to the Session Management and Policy Control Function (SM-PCF). The figure depicts the initial state with the UE PA in the Policy and Charging Rules Function (PCRF), which is then transitioned to the SM-PCF. The figure highlights the role of the Policy and Charging Rules Function (PCRF) in managing the UE PA, and the Session Management and Policy Control Function (SM-PCF) in handling the subsequent session management. The figure emphasizes the importance of a smooth transition to ensure the continuity of service for the UE.\nFigure 6.20.2-5: Relocation of an established UE Policy Association to SM-PCF\n1.\tAs described in clauses 6.20.2.4 and 6.20.2.5, the AMF requests to UE-PCF to terminate the UE Policy Association, when the UE moves from 5GS to EPS.\n2.\tThe UE-PCF determines whether to terminate the UE Policy Association based on URSP delivery over EPS Indication received from UE (as described in clauses 6.20.2.1 and 6.20.2.3). The UE-PCF rejects the Npcf_UEPolicyControl_Delete request from the AMF and informs to the AMF that the UE Policy Association can be maintained in EPS.\n3.\tWhen the AMF is informed that the UE Policy Association can be reused in EPS, the AMF determines which Policy Control Request Triggers can be supported in SMF (e.g. Location change, PLMN change) among the PCRTs of the UE Policy Association.\n4.\tThe AMF sends UE-PCF ID, UE Policy Association ID, Policy Control Request Triggers for UE Policy Association (determined in step 3), and Information on the UE policy related Policy Control Request Trigger condition that can be met in Nsmf_PDUSession_UpdateSMContext Request to SMF+PGW-C.\n5.\tThe SMF+PGW-C transfers UE Policy Association information received from the AMF in step 4 to SM-PCF by Npcf_SMPolicyControl_Update Request.\n6.\tThe SM-PCF notices the UE Policy Association established in 5GS is moved from the AMF to the SM-PCF when SM-PCF receives UE-PCF ID and UE Policy Association ID from SMF+PGW-C. The SM-PCF sends UE Policy Association ID and Information on the UE policy related Policy Control Request Trigger condition that can be met in Npcf_UEPolicyControl_Update Request to UE-PCF. The UE-PCF updates the stored information provided by the AMF with the information provided by the SM-PCF.\n7.\tThe UE-PCF updates the policy decision based on the information provided by SM-PCF. Step 4 in clause 4.16.2.1.2 of TS 23.502 [3] can be reused. The UE-PCF updates Policy Control Request Trigger parameters for UE Policy Association to be supported in SMF+PGW-C (e.g. remove PCRTs that cannot be supported in SMF+PGW-C).\n8.\tThe UE-PCF sends UE Policy Container, Policy Control Request Triggers of UE Policy Association in Npcf_UEPolicyControl_Update Response to SM-PCF. SM-PCF stores the updated Policy Control Request Triggers of UE Policy Association. The UE Policy Container is delivered to the UE (as described in clause 6.20.2) after TAU procedure.\n9.\tThe SMF+PGW-C updates the PCRTs of UE Policy Association received from the AMF (in step 4) with the PCRTs of UE Policy Association received from the SM-PCF (in step 8). After this step, when a PCRT of UE Policy Association condition is met, the SMF+PGW-C sends Information on the UE policy related Policy Control Request Trigger condition that can be met to the SM-PCF and the SM-PCF reports it to the UE-PCF.\n10.\tThe SMF+PGW-C sends Nsmf_PDUSession_UpdateSMContext Response to AMF. The AMF notices the UE Policy Association is successfully moved to SM-PCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.20.3\tImpacts on services, entities and interfaces",
                            "text_content": "SMF+PGW-C:\n-\tShall be able to include the UE Policy Container received from the PCF into the PCO, and forward to the UE via SGW and MME transparently.\n-\tShall be able to forward the UE Policy Container from the UE to the UE-PCF.\n-\tShall be able to provide the UE-PCF ID to SM-PCF.\n-\tShall be able to forward the acknowledgement of UE reception of the UE Policy to the PCF.\n-\tShall be able to provide Information on the UE policy related Policy Control Request Trigger condition that can be met to SM-PCF when the condition is met.\nSM-PCF:\n-\tShall be able to handle UE Policy Association with UE-PCF.\n-\tShall be able to provide to SMF+PGW-C, the UE Policy Container which includes the UE Policy for the UE in EPS.\n-\tShall be able to relocate the UE Policy Association established in 5GS from AMF to SM-PCF.\nUE-PCF:\n-\tShall be able to handle UE Policy Association with SM-PCF.\n-\tShall be able to handle UE Policy Association for the UE in EPS based on the URSP delivery over EPS Indication provided by the UE.\nAMF:\n-\tShall be able to relocate the UE Policy Association established in 5GS from AMF to SM-PCF.\nMME:\n-\tNo impact.\nUE:\n-\tShall be able to store the URSP received over EPS entities.\n-\tShall be able to send the acknowledgement of UE reception of the UE Policy to the PCF over EPS entities.\n-\tShall be able to send the list of PSIs stored in the UE to the PCF by encapsulating in UE Policy Container, and by including the UE Policy Container into PCO over EPS entities.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.21\tSolution #21: Traffic Category with existing mechanism",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.21.1\tDescription",
                            "text_content": "It is proposed to reuse the current Traffic Descriptor (TD) type to represent Traffic Category.\nOption 1:\nIntroduce new special DNN in the TD to represent Traffic Category. DNN is composed of Network Identifier and optionally Operator Identifier. Network Identifier has a maximum length of 63 octets. It is enough to have standardized traffic categories. If it is an operator specific traffic category, Operator Identifier is involved.\nThe applications that shares the same traffic category should be mapped to the same DNN in the TD.\nIt is proposed to have DNNs considering the requirement from GSMA as described in clause 5.4.\nSome more DNN containing multiple bullets of GSMA requirement as described in clause 5.4 can also be introduced.\nNOTE 1:\tThe DNN in corresponding Route Selection (RSD) could be different if the real DNN of the application is not the same as the one in TD as described in clause 6.6.2.1, TS 23.503 [4].\nNOTE 2:\tIt is assumed that the operator will allocate proper DNN to an application with considering its traffic category. How to allocate DNN to an application is based on current mechanism. It is assumed the operator will have agreement with the Application Service Providers to generate the URSP.\nNOTE 3:\tTo cover the case that an application may share different traffic categories, DNN could be combination of different categories.\nOption 2:\nIntroduce new standardized Application descriptor. A new OS Id value which means \"Traffic Category\" Type should be defined. the maximum length of OS App Id is 256 octets. It is enough to have standardized traffic categories and operator specific Traffic Categories.\nIt is proposed to have following application descriptors considering the requirement from GSMA as described in clause 5.4.\nNOTE 4:\tMore than one application descriptors can be provided in TD as described in clause 6.6.2.1, TS 23.503 [4]. Thus no need to introduce new application descriptors as combination of different categories.\nNOTE 5:\tIt is assumed the operator will have agreement with the Application Service Providers to generate the URSP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.21.2\tProcedures",
                            "text_content": "No new procedure will be introduced. The PCF will transfer the URSP to the UE via UE Configuration Update procedure as defined in clause 4.2.4.3 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.21.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE/PCF:\n-\tNeed to support the new standardized value of DNN/Application Descriptor in the Traffic descriptor.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.22\tSolution #22: UE provisioned/configured with a mapping of application traffic to traffic categories",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.22.1\tDescription",
                            "text_content": "A general description of the solution is as follows:\n-\tA UE is provisioned/configured with a mapping of Application Traffic to a Traffic Category (or one or more traffic categories). The UE may be configured with such mapping from an Application Function or from the PCF or based on pre-configuration. If provisioned by the PCF this mapping information is sent outside of a URSP rule, i.e. a new rule within UE policy information (ATC rule):\n-\tWhen the UE receives such mapping, when the UE detects new Application Traffic the UE associates the application to the corresponding traffic category:\n-\tThe existing traffic descriptors defined in URSP rules can be used to map Application Traffic to one or more Traffic Categories. For example:\n-\tAn application with Application Descriptor (com.android.app1) is mapped to Traffic Category: \"Gaming\".\n-\tAn application sending traffic to a specific destination IP 3 tuple mapped to Traffic Category: \"Streaming\".\n-\tDomain Descriptors (e.g. FQDN requested) mapped to one or more traffic categories:\n-\tIn such case the UE associates the destination IP addresses received in a DNS response to a traffic category.\n-\tNon-IP descriptors mapped to one or more traffic categories.\n-\tAn application requesting DNN \"IMS\" is mapped to Traffic Category \"Voice\".\n-\tAn Application requesting connection capability for MMS is mapped to Traffic Category \"Media\".\n-\tThe URSP rule is enhanced with a Traffic Category Traffic Descriptor:\n-\tWhen the UE receives URSP rules with Traffic Categories traffic descriptor then the UE uses the configuration received from the AF/PCF to associate detected application traffic to a traffic category and consider the URSP rule matched when the Traffic Category of the URSP rule matches the traffic category of the application.\nThe solution can support both MNO specific and standardised traffic categories. The encoding of the Traffic Category can be defined in stage 3. For example, standardised traffic category can be encoded as a bit map as follows:\n-\tBitmap: 00000001\t-->\tGaming (Standardised).\n-\tBitmap: 00000002\t-->\tVoice (Standardised).\n-\tBitmap: 00000003\t-->\tReserved for operators (MNO specific).\nThe solution has the advantage that the rules to associate an application (or application traffic) are provided by the MNO and does not rely on the application in the UE or the OS layer in the UE to indicate a traffic category for an application traffic.\nThe procedures are shown in the next clause.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.22.2\tProcedures",
                            "text_content": "The UE associates application traffic to a traffic category based on \"Application to Traffic Category\" (ATC) rules received from the AF or the PCF. The rules provide information on how Application Traffic is mapped to a traffic category.\nThe PCF can provide ATC rules to the UE using the UE configuration update for transparent policy deliver. The ATC rules are sent outside of URSP rule as a new type of rule within UE policies provisioned by the PCF. The UE can include ATC rules within a specific Policy Section identified by a Policy Section Identifier. The PCF may determine the ATC rules the UE requires based on the operating system supported by the UE. The procedure is shown in the figure below.\nFigure 6.22.2.1-1 illustrates the process of provisioning a PCF (Policy and Charging Framework) application to traffic categories rules. The figure shows the various steps involved in configuring the application to manage and charge for different types of traffic. The process begins with the input of traffic categories, which are then processed by the application to determine appropriate policies and charges. The figure also depicts the interaction between the application and the underlying network infrastructure, highlighting the importance of accurate and efficient traffic management in modern telecommunications networks.\nFigure 6.22.2.1-1: PCF provisioning Application to Traffic Categories Rules\n0.\tUE registers to the PLMN as per TS 23.502 [3]. The UE may include OSId of its operating system and a list of Policy Sections (identified by a PSI) installed at the UE. During registration the AMF selects a PCF for AM and SM policies.\n1.\tThe PCF determines that ATC rules are needed to be provided to the UE. The PCF determines based on:\n-\tA Policy Section identified by a PSI is not installed at the UE or the Policy Section Identifier provided by the UE that includes ATC rules requires updating.\n-\tA trigger from the UDM/UDR.\n2.\tThe PCF sends ATC rules to the AMF via an Namf_Communication_N1N2Message transfer service operation based on the UE Configuration Update for transparent policy delivery.\n3.\tThe AMF transparently sends the ATC rules to the UE. If the UE is in IDLE the AMF triggers a network triggered service request.\n4.\tThe ATC rules are sent to the UE via a NAS Downlink transport message\n5.\tThe UE installs the rules and provides the result to the AMF via a NAS Uplink transport message.\n6.\tThe AMF forwards the ack to the PCF.\n7.\tThe UE associates applications to a traffic category based on the ATC rules.\nAn Application Function may also provide ATC rules to the UE as shown in the figure below.\nFigure 6.22.2.1-2 illustrates the process of AF (Automatic Frequency) provisioning ATC (Access and Tunnel Control) rules to a UE (User Equipment). The figure depicts the interaction between the network elements, including the AF controller, UE, and various network functions, such as the AMF (Access and Mobility Management Function), SMF (Serving Mobility Management Function), and UPF (User Plane Function). The figure highlights the flow of control messages and data packets, emphasizing the synchronization and coordination required for seamless connectivity and resource allocation.\nFigure 6.22.2.1-2: AF provisioning ATC rules to a UE\n1.\tThe UE registers with the PLMN network as per TS 23.502 [3].\n2.\tThe PCF subscribes from the UDR to be notified of change/update of ATC rules.\n3.\tThe AF decides to update ATC rules for a UE.\n4.\tThe AF sends an Nnef_ServiceParameterCreate request including parameters for ATC rules determination.\n5.\tThe NEF authorizes the request and stores the ATC rules in the UDR. The NEF stores the AF request information in the UDR as the \"Application Data\" (Data Subset setting to \"Service specific information\") together with the assigned Transaction Reference ID.\n6.\tThe UDR determines that the PCF needs to be notified.\n7.\tThe UDR notifies the PCF in a Nudr_DM_Notify service operation.\n8.\tThe PCF sends update ATC rules using the UE Configuration Update procedure for transparent policy delivery (as per steps 2-6 of Figure 2.3).\n9.\tThe UE associates application to an application category based on the ATC rules.\nAlternatively (instead of steps 2-7), the UPF may also be configured to perform traffic classification and report back to the PCF (via the SMF) the traffic category mapping. In this case, during the SM Policy Association Establishment procedure, the PCF may provide Usage Reporting Rules that include one or more traffic classification triggers to the UPF. The attributes in the \"Usage Report\" as defined in Table 5.8.2.11.7-1 of TS 23.501 [2] are extended to support traffic classification and the \"traffic category\" is reported by the UPF in a new attribute in the report.\nThe URSP rule is enhanced to include a Traffic Category Traffic Descriptor. How the Traffic Category Traffic Descriptor is encoded is up to stage 3 design.\nWhen the UE is provisioned with a URSP rule containing a Traffic Category traffic descriptor then for every detected application traffic the UE considers this URSP rule applicable when the Traffic Category of the application detected matches the Traffic Category of the Traffic Descriptor in the URSP rule.\nIf the UE has received URSP rules with Traffic Category traffic descriptors but the UE did not receive ATC rules or cannot identify the traffic category of the application traffic detected (i.e. the ATC rules do not provide any association for the application traffic detected) the UE considers the rule not applicable and moves to the next URSP rule in the order of precedence.\nAn example implementation is shown in the figure below.\nFigure 6.22.2.2-1 illustrates an example implementation for traffic classification and matching a user-space routing protocol (URSP) rule based on traffic category. The figure depicts a network architecture with various components, including the network element, the network element manager, and the user-space routing protocol. The network element is responsible for collecting and analyzing traffic data, while the network element manager is responsible for managing the network elements. The user-space routing protocol is responsible for routing traffic between network elements. The figure shows how traffic is classified based on its category and how a URSP rule is applied to match the traffic and route it appropriately. The figure also shows how traffic is aggregated and forwarded to the next network element. Overall, the figure provides a detailed overview of how traffic is classified, matched, and routed in a network.\nFigure 6.22.2.2-1: Example implementation for Traffic Classification and matching a URSP rule based on Traffic Category\n1.\tAn application in a UE requests a network connection from the operating system in the UE.\n2.\tThe mobile operating system requests a network connection including the AppID of the application.\n3.\tThe UE determines that URSP rules include Traffic Categories Traffic Descriptor and determines a Traffic Category.\n4.\tThe UE finds the traffic category based on the ATC rules.\n5-6.\tThe UE finds a matching URSP rules based on the Traffic Category ID.\n7-8.\tA PDU session is established based on the RSD of the matched URSP rule.\n9.\tThe Mobile OS notifies the application that a connection is established.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.22.3\tImpacts on services, entities and interfaces",
                            "text_content": "Editor's note:\tThis clause captures impacts on existing 3GPP nodes and functional elements.\n-\tURSP rule is enhanced with a new Traffic Descriptor for supporting Traffic Category.\n-\tNew Policy Section is defined to include ATC rules.\nPCF:\n-\tDetermine and provision updated UE Policy (ATC rules) based on detected traffic category.\nSMF:\n-\tInstall URR (Usage Reporting Rules) that include traffic classification trigger on the UPF.\n-\tIndicate the traffic category information based on Usage Reports to PCF.\nUPF:\n-\tDetermine the Traffic category based on URR and provide Usage Reports including the traffic category mapping to the SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.23\tSolution #23: Support standardized and operator-specific traffic categories in URSP",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.23.1\tDescription",
                            "text_content": "As per the LS received from GSMA, the traffic generated by a UE could be grouped into various traffic categories, enabling each traffic category to be handled differently, e.g. mapped to a different slice. Some example traffic categories are as below:\nEnterprise:\tTraffic from one or more applications related to an Enterprise service.\nGaming:\tTraffic from one or more applications related to Gaming service, e.g. with low latency requirement.\nVideo Streaming:\tTraffic from one or more applications related to Video Streaming, e.g. HD video streaming, 4K video streaming.\nA new component \"traffic category\" is introduced in the traffic descriptor part of the URSP rule. The \"traffic category\" shall support standardized values specified by 3GPP and values that are reserved for operator specific traffic categories. For example, the Traffic category can be encoded as below (this is a stage 3 decision):\nBits\n8 7 6 5 4 3 2 1\n0 0 0 0 0 0 0 1\tEnterprise\n0 0 0 0 0 0 1 0\tGaming\n0 0 0 0 0 0 1 1\tVideo Streaming\n0 0 0 0 0 1 0 0\nto\n0 1 1 1 1 1 1 1\tSpare for standardized traffic categories\n1 0 0 0 0 0 0 0\nto\n1 1 1 1 1 1 1 1\tReserved for Operator specific traffic categories\n\n\nEditor's note:\tIt is FFS whether a new TD component \"traffic category\" is introduced or to re-use/extend an existing TD component e.g. Connection capabilities to support the new standardized and operator defined traffic categories.\nAn application can indicate a traffic category in its request which the UE then matches with the traffic category component in the Traffic Descriptor of the URSP rule. Only one traffic category can be included in a single request. However, a single application may indicate different traffic category in different requests, for example, an application may indicate one traffic category in the traffic descriptor for IM or chat session while it may indicate a different traffic category in the traffic descriptor for live video or streaming etc. A given traffic category can be simultaneously used by multiple applications.\nAn application may request any traffic category from the traffic category values standardized by 3GPP or from the operator specific traffic category values.\nEditor's note:\tIt is FFS whether and how the UE or the Network verifies that an application is requesting for the correct traffic category.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.23.2\tProcedures",
                            "text_content": "When an application starts, or at a later time, it may request for a specific traffic category. The traffic categories are defined by the 3GPP and are independent of the Operating System used in the UE. The traffic category requested by an application may be either a traffic category standardized by the 3GPP or a value that is specified by the MNO. The application requests a traffic category in a way similar to existing traffic descriptors, which is then pushed to the URSP layer transparently through the OS layer. Traffic categories shall be transparent to the OS layer to allow MNOs to define operator-specific traffic categories and still enable the application to request for such traffic categories.\nNOTE 1:\tThe implementation details of how the application indicates the requested traffic category are outside the scope of 3GPP.\nA UE of a previous release that does not support \"Traffic Category\" shall ignore the URSP rules with \"Traffic Category\" according to clause 4.2.3 of TS 24.526 [10] \"Unknown or unexpected URSP rules\".\nNOTE 2:\tBased on UE implementation, if the UE does not support \"Traffic category\" TD request for \"Traffic category\" by an application can be disabled.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.23.3\tImpacts on services, entities and interfaces",
                            "text_content": "The solution has the following impacts:\nPCF:\n-\tPCF shall support the new parameter \"traffic category\" in traffic descriptor part of the URSP rule.\nUE:\n-\tUE shall support receiving \"traffic category\" from the application and match it with the \"traffic category\" component in the Traffic Descriptor provided as part of the URSP rule.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.24\tSolution #24: Introduction of Traffic Category into URSP rules",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.24.1\tDescription",
                            "text_content": "In order to have no impact or further work to application layer, a new mapping rules can be introduced to UE of traffic category.\nThe application on UE still use the original parameters in Traffic Descriptor to describe the features of application traffic, for example, the FQDN, DNN or IP-5-tuple. But the Traffic Category in TD, can be the set the combination of multiple traffic characteristic identification filter to identify the traffic from different application. And before the UE maps the application traffic to specific PDU session that RSDs corresponds to, the UE can map the application traffic to a specific traffic category in TD.\nFor example, according to the FQDNs, the UE can identify this traffic to a specific traffic category for video or music. Another example, according to the destination IP address and DNN of application traffic, the UE can identify the traffic category as enterprise because the IP address located in the IP range that the enterprise served and the DNN is a local DN.\nAccording to this design, one of the examples of introducing traffic category are listed below:\nTable 6.24.1-1: Example of URSP rules contains traffic category\n\nNOTE 1:\tIt is up to operator's configuration that how to design the combination of traffic characteristic identification filter in a certain Traffic Category. The original Traffic Descriptor can be co-existed with newly introduced Traffic category in TD.\nNOTE 2:\tAs the example above, the operators can set the different precedence of TD, including the Traffic Category. For example, if the traffic from an application can both satisfy the original TD and Traffic Category, which has the higher precedence will be performed first.\nNOTE 3:\tThe Traffic Category can be the combination of multiple traffic characteristic identification filter. It is also possible that the application traffic can meet one of the Traffic characteristics in the Traffic Category.\nNOTE 4:\tFor a certain application traffic, it is possible to be classified as different traffic category. The final result of traffic category depends on the design of TD, for example, the precedence of TD, and the UE implementation.\nAnd after mapping to specific traffic category, how to apply the application traffic to RSDs are reuse the mechanism in current URSP rules.\nAlso, one application traffic can be mapped to multiple Traffic category. For example, one application traffic which has the feature of Application descriptor, can be mapped to Traffic Category = Enterprise or Traffic Category = Game at the same time.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.24.1-1: Example of URSP rules contains traffic category",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.24.2\tProcedure",
                            "text_content": "After UE receives the URSP rules from PCF, the UE should do the following steps:\n1.\tMapping the application traffic to Traffic Descriptor, as the existing URSP rules mechanism.\n2.\tAccording to the Traffic Descriptor that the application mapping to, the UE has the two selection according to the URSP rules delivered by PCF:\n-\t(Existing mechanism in URSP rules) The application traffic is matched to a certain Traffic Descriptor;\n-\tThe application traffic is matched to a certain Traffic Descriptor, and there exists the Traffic Category in this Traffic Descriptor. But for the Traffic Category, it can be the combination of multiple traffic characteristic identification filter. It is up to operator's configuration that how to design the combination of traffic characteristic identification filter in a certain Traffic Category.\n3.\tAfter determination of the Traffic Descriptor, the UE applies the application traffic to specific PDU sessions according to the RSDs. This is the same procedure as defined in URSP rules.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.24.3\tImpacts on services, entities and interfaces",
                            "text_content": "Editor's note:\tThis clause lists impacts to services and interfaces.\nPCF:\n-\tIntroduce Traffic Category into URSP rules. The Traffic Category in TD, can be the set the combination of multiple traffic characteristic identification filter to identify the traffic from different application into the same traffic category. It is also ok that the application traffic can meet one of the Traffic characteristics in the Traffic Category.\nUE:\n-\tMapping the application traffic which belongs to the specific Traffic Category in Traffic Descriptor according to the traffic characteristic identification filter in Traffic Category.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.25\tSolution #25: Support standardized and operator-specific traffic categories in URSP",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.25.1\tDescription",
                            "text_content": "In the current specification, application descriptors (short for 'APP ID') is defined as one TD in URSP rules. Application descriptors is used to identify the Application(s) that is(are) running on the UE's OS as specified in clause 6.6.2 of TS 23.503 [4] \"UE Route Selection Policy information\".\nTo resolve the KI#4, application descriptors as one TD in URSP rules is to leverage for supporting standardized and operator-specific traffic categories in URSP. The special value of application descriptors can be defined or used for standardized and operator-specific traffic categories, and other value of application descriptor can be used for non-special application(s).\nFor example:\n-\tAssuming that there are standardized and operator-specific traffic categories like \"video\", \"games\", \"streaming\" and \"enterprise\";\n-\tSo the following application descriptors value can be defined or used for standardized and operator-specific traffic categories:\nTable 6.25.1-1\n\nSo the solution to reuse the application descriptors as one TD in URSP rules to define special value for standardized and operator-specific traffic categories in URSP has meet the Key issue#4.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.25.1-1",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.25.2\tProcedures",
                            "text_content": "The solution reuses existing procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.25.3\tImpacts on Existing Nodes and Functionality",
                            "text_content": "None.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.26\tSolution #26: Traffic categories based on 5G QoS characteristics",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.26.1\tDescription",
                            "text_content": "The 5G QoS characteristics describe the edge-to-edge packet treatment received by a QoS flow between the UE and UPF as described in clause 5.7.3 of TS 23.501 [2] in terms of various performance characteristics. These performance characteristics include Resource type (GBR, non-GBR), Priority level, Packet delay budget, Packet error rate, Averaging window, Maximum data burst volume, etc. Standardized 5QI values are specified for services that are frequently used and the one-to-one mapping between standardized 5QI values and the 5G QoS performance characteristics is specified in table 5.7.4-1 of TS 23.501 [2].\nA new component \"traffic category\" is introduced in the traffic descriptor part of the URSP rules to support standardized values specified by 3GPP and values that are reserved for operator specific traffic categories. The encoding of these traffic categories can be specified in stage 3 in TS 24.526 [10].\nTraffic categories can be defined based on type of service handled by an application. As an example, enterprise class applications could include traffic categories for email, browsing, chat, conferencing, voice, etc. Similarly gaming applications could include real-time gaming, interactive gaming and other games which could include XR type of traffic as well. Similarly, video streaming class of applications could also include live or buffered streaming, HD streaming, 4K streaming traffic, etc. For each of these service types, the traffic categories can then be mapped to specific 5G QoS performance characteristics as specified in table 5.7.4-1 of TS 23.501 [2]. In addition to different well-known services, traffic categories can also be operator specific or even have specific QoS attributes or parameters that may not map to a well-known service.\nThe traffic category values depend on the intended granularity of the categorization. They can be either defined based on different high level application classes or service types such as Enterprise, Gaming, Streaming, Operator specific, etc. or they can be defined with finer granularities, e.g. voice, conferencing, real-time gaming, interactive gaming, live streaming, buffered streaming, etc. These finer granular values may belong to one or more high level application classes or service types and can better assist in mapping specific application traffic or flows to appropriate slices.\nThe values of 5G QoS performance characteristics are reproduced below from table 5.7.4-1 of TS 23.501 [2] for easy reference.\nTable 6.26.1.1-1: Traffic categories based on Service type of different applications\n\nNOTE:\tThe above traffic categories are just illustrative examples, other traffic categories may be added as needed.\nTraffic categories can also be defined directly based on traffic characteristics and the specific QoS attributes could have a relative priority level. As an example, for a certain class of traffic, there could be relative priority among the QoS attributes latency and bandwidth (e.g. low latency and high bandwidth with latency as higher priority). Priority can be given to single or multiple QoS attributes (e.g. prioritize latency and packet error rate over bandwidth for voice traffic, prioritize latency and bandwidth over packet error rate for gaming or video streaming traffic, etc.).\nThe traffic categories could be defined as follows based on different traffic characteristics.\nTable 6.26.1.2-1: Traffic categories based on Traffic characteristics of different applications\n\nNOTE:\tThe above traffic categories are just illustrative examples, other traffic categories may be added as needed.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.26.1.1-1: Traffic categories based on Service type of different applications",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.26.1.2-1: Traffic categories based on Traffic characteristics of different applications",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.26.2\tProcedures",
                            "text_content": "Different applications know the kind of traffic they can generate, and they can classify the traffic based on the above defined traffic categories. An application may request for a specific traffic category from the execution environment (OS). Such a request triggers the UE to determine whether this new application traffic can be associated to an established PDU session, or the UE needs to establish a new PDU session based on URSP rules including the matching traffic category in the traffic descriptor. The requested traffic category by the application may be either a standardized value specified by 3GPP or an operator specific value. Traffic categories are transparent to the execution environment (OS) to allow operators to define operator specific traffic categories.\nNOTE:\tThe implementation details of how the application indicates the requested traffic category to the execution environment (OS) are outside the scope of 3GPP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.26.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE:\n-\tAble to process application requested traffic category and match it with the traffic category component of the traffic descriptor provided as part of the URSP rule.\nPCF:\n-\tIntroduce traffic category into URSP rules and design the mapping rules of traffic categories.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.27\tSolution #27: URSP provisioning and updating in roaming",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.27.1\tDescription",
                            "text_content": "This is a solution related to the Key Issue #1 URSP in VPLMN, that aims to address the following aspects:\n-\tHow to provide URSP Rules in roaming to the UE. How the HPLMN and VPLMN are involved in such procedure.\n-\tWhether and how to support URSP enhancements to support routing of the application traffic with different URSP rules in different PLMNs.\nIn addition, backward compatibility with the existing framework of policy control based on HPLMN will be maintained as stated in the KI description.\nThis solution proposes that when the UE is roaming, the HPLMN may provide URSP Rules to the UE as in the existing baseline, in addition the VPLMN can provide URSP Rules. For the handling at the UE, a similar behaviour as for ANDSP Rules is proposed: When the UE is roaming, and the UE has valid URSP rules from both HPLMN and VPLMN the UE gives priority to the valid URSP rules from the VPLMN.\nThe VPLMN provides URSP Rules to UE that contain RSD components that comply with the S-NSSAI subscription information defined in Table 6.2-1 in TS 23.503, then extended with the indication of LBO allowed as follows:\nTable 6.27.1-1: UE context policy control subscription information\n\nThe S-NSSAI subscription information is stored at the UDR at the HPLMN, provided to the H-PCF. The H-PCF sends the S-NSSAI subscription information to the VPLMN based on local policies that states whether VPLMN can provide URSP Rules to the UE and whether the LBO roaming is allowed. The H-PCF only provides S-NSSAI subscription information for this DNNs or (S-NSSAI and DNN) combinations that has LBO roaming allowed set. The V-PCF maps the DNN,S-NSSAI value in the VPLMN to the DNN,S-NSSAI values in the HPLMN either retrieving this from NSSF or from AMF.\nThe V-PCF generates URSP Rules for traffic that will be offloaded at the VPLMN, either due to AF providing Application guidance for URSP rules determination defined in clause 6.6 of TS 23.548 [5] or due to local policies at the V-PCF. The V-PCF may decide to offload application traffic to a certain DNN, S-NSSAI in the VPLMN based on e.g. load in the network that can be derived from analytics at certain time of day. The V-PCF provides the list of PSIs including the VPLMN ID to identify them at the UE.\nThe H-PCF can instruct the UE not to accept URSP Rules from the VPLMN, The H-PLMN provides this indication to the UE when the UE Policy Authorization is established.\nThese are some of the characteristics of this solution that aims to motivate the advantages to allow the VPLMN to provide URSP Rules to roamers.\n1-\tEnables the VPLMN to have better control on how to route traffic in their network while complying with the HPLMN S-NSSAI subscription information and the Application guidance, if provided.\n2-\tReduces the amount of configuration information that is needed at the HPLMN, e.g. a NEF or at the H-PCF to map the validity conditions on location to the TAIs or Cell IDs at the VPLMN.\n3-\tReduces the amount of signalling to report subscribed PCRTs to the HPLMN, in the most efficient way the HPLMN requires no PCRTs.\n4-\tIt is backward compatible with the existing policy framework given that the HPLMN provides URSP Rules for its subscribers as in the design base, then enhanced to the possibility for the VPLMN to provide URSP Rules for those subscribers that have LBO roaming allowed in their HPLMN subscription.\nSome scenarios:\n-\tCertain corporate application reachable via a DNN, S-NSSAI only in some locations, some of these locations are at the VPLMN. A HPLMN may decide to allow LBO roaming for this DNN, S-NSSAI for the corporate users, then the VPLMN provide URSP Rules to route application traffic to a DNN, S-NSSAI when the UE is at that location. In this scenario the AF can provide guidance for URSP and the location where the corporate network is accessible will be mapped by NEF at the VPLMN to the list of TAIs and Cell Ids in the access network.\n-\tA HPLMN may decide not to allow the VPLMN to provide URSP Rules, then the S-NSSAI subscription information is not sent to the V-PCF. If no S-NSSAI subscription data is received or if received but the LBO roaming allowed indication is set to \"not allowed\", then the V-PCF generates no URSP Rules.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.27.1-1: UE context policy control subscription information",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.27.2\tProcedure for UE Policy Association Establishment with VPLMN provided URSP Rules",
                            "text_content": "Figure 6.27.2-1 illustrates the process of UE Policy Association Establishment when roaming, with the VPLMN providing the Universal Roaming Service Profile (URSP) rules. The figure depicts the interaction between the User Equipment (UE) and the Serving GNodeB (gNB) during the establishment of a policy association. The process begins with the UE sending a Policy and Charging Rules Function (PCRF) request to the gNB, which then forwards the request to the Home Network (H-N) PCRF. The H-N PCRF evaluates the request and sends a Policy and Charging Rules Function (PCRF) response back to the gNB. The gNB then sends a Policy and Charging Rules Function (PCRF) response to the UE, which includes the policy information and the Charging Data Unit (CDU). The CDU is then sent to the UE, which uses the policy information to establish the policy association. The figure also shows the role of the Home Network (H-N) PCRF in the process, as it is responsible for evaluating the policy request and sending the PCRF response to the gNB.\nFigure 6.27.2-1: UE Policy Association Establishment when roaming (VPLMN provides URSP Rules)\nThis procedure takes the UE Policy Association Establishment procedure in roaming case as specified in clause 4.16.11 of TS 23.502 [3] as basis:\n1,2, 3.\tSame as steps 1, 2 and 3 in clause 4.16.11 of TS 23.502 [3].\n4.\tSame as step 4 in in clause 4.16.11 of TS 23.502 [3], in addition the H-PCF may include the S-NSSAI subscription information defined in Table 6.27.1-1.\n5.\tSame as step 5 in in clause 4.16.11 of TS 23.502 [3], in addition the V-PCF stores the S-NSSAI subscription information as part of the UE Context and may provide additional PCRTs to the AMF.\n6a,7,8.\tThe (H-)PCF may create a UE Policy Container to be sent to the UE as defined in steps 7 and 8 in clause 4.16.11 of TS 23.502 [3].\n6b.\tThe (V-)PCF may create a UE Policy Container to be delivered to the UE.\nNOTE:\tIf step 6b happens it takes place at any time after step 5.\n9.\tThe (V-)PCF triggers UE Configuration Update Procedure to send the UE policy container as defined in step 8 in clause 4.5.11 of TS 23.502 [3].\n10.\tThe V-PCF checks if the notification response is treated it locally or is to be sent to the H-PCF, if so step 9 in clause 4.5.11 of TS 23.502 [3] occurs.\n11.\tSame as step 10 in H-PCF clause 4.5.11 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.27.3\tPDU Session establishment for LBO",
                            "text_content": "The procedure for PDU Session establishment for LBO specified in clause in TS 23.502 [3] remains unchanged with the following clarifications:\nThe UE checks the validity of the RSD in the URSP Rule for VPLMN provided URSP Rules as follows:\n-\tIf any S-NSSAI(s) is present, the S-NSSAI(s) is in the Allowed NSSAI.\nThe UE checks the validity of the RSD in the URSP Rule for HPLMN provided URSP Rules as follows:\n-\tIf any S-NSSAI(s) is present, the mapping of the Allowed NSSAI to HPLMN S-NSSAI(s) for the roaming case.\nIn both cases the UE provides both the S-NSSAIs of the Home PLMN and Visited PLMN at PDU Session establishment as described in clause 5.15.5.3 of TS 23.501 [2]. The UE provides the PDU Session parameters as provided in the selected RSD of the URSP Rule, i.e. for VPLMN provided URSP Rules the PDU Session parameters are related to the VPLMN.\nFor those URSP Rules provided by the VPLMN, the V-PCF subscribes to DNN replacement PCRT to the AMF. Then, the AMF sends the DNN to the PCF to replace the DNN of the serving PLMN to the DNN of the HPLMN. The AMF sends both the serving PLMN DNN if provided and the DNN of the HPLMN to the SMF then SMF checks the SMF subscription data retrieved from UDM.\nNOTE:\tIt is assumed that a serving S-NSSAI maps to only one HPLMN S-NSSAI. It is assumed that a serving DNN maps to only one PLMN S-NSSAI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.27.4\tAF guidance for URSP determination",
                            "text_content": "Figure 6.27.4-1 illustrates the AF guidance for URSP determination, which is a crucial aspect of telecommunication network planning. The figure presents a detailed block diagram of a telecommunication network, highlighting the various components involved in the process. These components include the Access Network Unit (ANU), the Radio Access Network (RAN), the Universal Radio Service Planning (URSP), and the Access Network Planning (ANP). The figure also shows the relationship between these components, with the ANU and RAN being the primary focus. The ANU is responsible for providing access to the network, while the RAN is responsible for providing radio access to the network. The URSP is responsible for determining the optimal configuration of the network, while the ANP is responsible for planning the network. The figure also shows the various factors that are considered when determining the URSP, such as the number of users, the type of service, and the network capacity. Overall, the figure provides a comprehensive overview of the AF guidance for URSP determination, which is essential for effective telecommunication network planning.\nFigure 6.27.4-1: AF guidance for URSP determination\nThis procedure takes the Service Parameter provisioning as specified in clause 4.16.12.2 of TS 23.502 [3] as a basis. The difference is that the AF checks the PLMNs that has an agreement with, then provide AF guidance to all these PLMNs, in this case the VPLMN where the UE is roaming. The AF sends the Service Parameter containing AF guidance on URSP Rule determination for any UE at the VPLMN. Then the HPLMN has set LBO roaming allowed flag for those users that are allowed to offload their application traffic to certain DNN, S-NSSAI used to access the AF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.27.5\tImpacts on Existing Nodes and Functionality",
                            "text_content": "The solution has impacts on the following entities:\nV-PCF:\n-\tto store S-NSSAI subscription information from the HPLMN.\n-\tto subscribe to notification from the V-UDR on Service Parameters.\n-\tto generate URSP Rules with RSD components that contain VPLMN DNN, S-NSSAIs.\n-\tto subscribe to DNN replacement for those UE Policy associations for UEs that has VPLMN provided URSP Rules.\nH.PCF:\n-\tto provide S-NSSAI subscription information for a SUPI, per DNN and S-NSSAI that has LBO roaming allowed set.\nUDR:\n-\tUE Policy subscription data includes the S-NSSAI subscription information includes the LBO roaming information, i.e. Indicates whether LBO roaming is allowed per DNN, or per (S-NSSAI, subscribed DNN).\nUE:\n-\tCheck PLMN ID in the list of PSIs, for those including the VPLMN ID the UE checks the validity of the RSD as for non-roaming case, i.e. the S-NSSAI is in the list of Allowed S-NSSAIs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.28\tSolution #28: Provisioning VPLMN URSP",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.28.1\tDescription",
                            "text_content": "This solution is proposed to address technical issues for supporting URSP delivery in VPLMN have been identified in Key Issue #1 particularly on \"How to provide URSP Rules in roaming to the UE. In particular, how the HPLMN and VPLMN are involved in such procedure\".\nThis solution identifies three scenarios from the perspective of which operator generate the URSP. For each scenario, how H-PCF and V-PCF behave is described as follows:\nScenario A. HPLMN URSP Generation:\n-\tThe H-PCF in HPLMN generates the URSP rules for the UE on VPLMN request. The V-PCF in VPLMN requests the H-PCF to generate URSP rules for VPLMN with appropriate parameters.\n-\tWhen V-PCF requests H-PCF to generate URSP rules for VPLMN, the V-PCF use LBO information (DNN/S-NSSAI and SSC mode) received from UDM of the HPLMN via AMF to provide the parameters for H-PCF to generate the URSP rules.\nScenario B. VPLMN URSP Generation with HPLMN permission:\n-\tIn this scenario, the V-PCF generates the VPLMN URSP rules with HPLMN permission.\n-\tWhen V-PCF generates the VPLMN URSP rules, the V-PCF uses the LBO information via AMF from UDM in HPLMN so that the V-PCF can derive the Route Selection Descriptors for URSP rules. V-PCF also use VPLMN precedence range provided by H-PCF to avoid the conflict URSP from PLMN and HPLMN.\nWith this solution, the H-PCF can assign the precedence range that HPLMN provides to VPLMN during the establishing the UE policy association between V-PCF and H-PCF in order to avoid the conflict to avoid the conflict between the HPLMN generated URSP rules and VPLMN URSP rules. The V-PCF can map the pre-assigned precedence values to the HPLMN assigned precedence values.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.28.2\tProcedures",
                            "text_content": "With this procedure, the solution provides three different scenarios for provisioning the VPLMN URSP rules to the UE.\n1)\tHPLMN generation of URSP for VPLMN request.\nThis solution supports the HPLMN generation of VPLMN URSP rules based on the V-PCF request as depicted in the Figure 6.28.2-1. During the UE registration, the UDM in HPLMN provides the LBO information along with HPLMN URSP Generation indication. The LBO information includes HPLMN's subscription information such as DNN/S-NSSAI and SSC mode to be used for generation of the Route Selection Components within the URSP rules. The AMF sends LBO information to the V-PCF so that V-PCF can request for HPLMN generation of the VPLMN URSP rules with the requested parameters.\nFigure 6 illustrates the process of HPLMN generating an Ultimate Radio Service (URSP) for a request from a Visitor Public Land Mobile Network (VPLMN). The figure depicts the interaction between the Home Public Land Mobile Network (HPLMN) and the Visitor Public Land Mobile Network (VPLMN), showing the exchange of information and signaling required to establish a connection. Key components include the Home Location Register (HLR), Visitor Location Register (VLR), and Serving Gateway (S-GW). The figure highlights the importance of accurate and efficient communication between HPLMN and VPLMN for seamless roaming services.\nFigure 6.28.2.1-1: HPLMN generation of URSP for VPLMN request\nH-PCF may authorize whether the parameters requested by the V-PCF by checking UDR. The H-PCF generates the VPLMN URSP in H-PCF with the authorized Route Selection Components. H-PCF takes the relative precedence values sent by V-PCF when generating the VPLMN URSP rules.\n2)\tVPLMN generation of VPLMN URSP based on HPLMN permission.\nThis solution supports the VPLMN generation of VPLMN URSP rules based on the HPLMN's permission as depicted in the Figure 6.28.2.1-2. During the UE registration, the UDM in HPLMN provides the VPLMN URSP generation allowed indication to the AMF in VPLMN. The UDM also sends the LBO information such as DNN/S-NSSAI and SSC mode to be used for the generation of the Route Selection Components within the URSP rules. The AMF sends LBO information to the V-PCF so that V-PCF can generate VPLMN URSP rules.\nFigure 6 illustrates the process of VPLMN (Visitor Public Land Mobile Network) generation of VPLMN Universal Roaming Subscriber Profile (URSP) based on the permission of Home Public Land Mobile Network (HPLMN). The figure depicts the interaction between the VPLMN and the HPLMN, showing how the VPLMN requests permission to generate an URSP for roaming purposes. The figure highlights the importance of HPLMN's role in granting or denying such requests, ensuring the proper functioning of the roaming system. Key components include the VPLMN, HPLMN, and the roaming request process, which are essential for maintaining seamless connectivity for mobile subscribers.\nFigure 6.28.2.1-2: VPLMN generation of VPLMN URSP based on HPLMN permission\nTo avoid the conflict between URSP rules from HPLMN and VPLMN, H-PCF provides the VPLMN precedence range to the V-PCF. The H-PCF assigns the range of the precedence of URSP rules for VPLMN URSP rules and provides the range to the V-PCF. The V-PCF maps the pre-defined VPLMN URSP's precedence values to the VPLMN range provided by the H-PCF.\nWith an example is as in the Table 6.28.2.1-1, the H-PCF in HPLMN can assigns the VPLMN precedence range to 5~6 for the V-PCF to use. HPLMN can use the high priority values precedence for the application in the HPLMN's URSP rules so that HPLMN can control those applications in high order. For example, HPLMN's rule#1 for the App#1 is higher priority than VPLMN's rule #6 for the same application. On the other hands, HPLMN can give more control for HPLMN rule #3, #4, #5 to VPLMN. VPLMN can take those precedence provided by HPLMN to use them for App#1 and abc.com. Rule #6 for App#1 is lower precedence of Rule#1 of HPLMN, however, Rule#7 for the abc.com of VPLMN can have higher priority than rule #4 of HPLMN. With this solution, HPLMN can take a control of URSP rules that they care and also give a flexibility for VPLMN to use those within the range.\nTable 6.28.2.1-1: Example usage of URSP rule precedence\n\nHow the H-PCF provides VPLMN precedence range to the V-PLMN is described in the step 6 and 7 of Figure 6.28.2.1-4: Procedure of provisioning VPLMN URSP rules for roaming scenario.\nThe procedure of provisioning VPLMN URSP rules for roaming scenario is described in Figure 6.28.2.1-3. The procedure consolidates the all scenarios described in the description.\nFigure 6 illustrates the step-by-step procedure for provisioning VPLMN URSP rules for a roaming scenario, detailing the interaction between the home and visited networks. The figure showcases the process of rule creation, synchronization, and activation, emphasizing the importance of accurate and efficient rule management for seamless roaming experiences. Key components include the home network, visited network, and the Universal Roaming Service Platform (URSP), which facilitates the rule provisioning and management. The figure highlights the coordination between the home and visited networks, ensuring that roaming subscribers receive consistent service quality and coverage across different networks.\nFigure 6.28.2.1-3: Procedure of provisioning VPLMN URSP rules for roaming scenario\nFrom step 1 to 4 describes the procedure for the UE to register the serving PLMN (i.e. VPLMN) in roaming scenario.\n1.\tDuring the registration procedure, the UE sends registration request to the AMF in VPLMN. The UE sends in the UE Policy Container the Policy Section Identifiers that are stored in the UE.\n2.\tThe AMF identifies the HPLMN of the UE with SUCI and requests the subscription information from UDM in HPLMN.\n3.\tThe UDM in HPLMN sends the URSP generation information such as HPLMN URSP Generation indication or VPLMN URSP Generation allowed indication to the AMF. The AMF also receives the LBO information that includes DNN/S-NSSAI and SSC mode from the UDM.\nTable 6.28.2.1-2\n\n4.\tThe AMF sends the Registration Accept to the UE.\n5.\tThe AMF sends the UEPolicyControl_Create request to the V-PCF with the UE Policy Container received from the UE. The AMF sends HPLMN URSP Generation or VPLMN URSP Generation allowed indication along with the LBO information (e.g. DNN/S-NSSAI and SSC mode) the V-PCF either to request to HPLMN URSP generation or to generate VPLMN URSP rules by V-PCF itself.\n6.\tThe V-PCF either requests HPLMN to generate URSP for VPLMN or generates VPLMN URSP by itself based on the HPLMN URSP Generation or VPLMN URSP Generation allowed indication received from the AMF respectively.\nIf HPLMN URSP Generation is indicated, the V-PCF sends the parameters to request H-PCF to generate URSP rules for VPLMN. The parameters includes the information for H-PCF to generate URSP rules for VPLMN such as traffic descriptor and Route Selection Descriptors. If there are multiple rules, the information also includes relative precedence values.\nIf VPLMN URSP Generation allowed is indicated, the V-PCF sends the request for H-PCF to allow the V-PCF to generate URSP rules for VPLMN. It requests implicitly the precedence value ranges for the V-PCF to generate the URSP rules.\nAfter identifying the parameters, the V-PCF sends the Npcf_UEPolicyControl_Create request to the H-PCF.\nNOTE:\tIn a scenario where no UE-PCF is deployed in HPLMN as depicted in Figure 6.28.2.1-3, the steps 6, 7, 8, 9, 11, 12, 18, 19 are not performed.\nIf V-PCF requests H-PCF to generate URSP for VPLMN with its parameters, the H-PCF authorizes the requested parameters to be used as Route Selection Components of the URSP rules by checking the subscription information by accessing the UDR.\nIf V-PCF requests H-PCF to allow the V-PCF to generate the VPLMN URSP, the H-PCF authorizes the request by checking the subscription information by accessing the UDR.\n7.\tThe H-PCF sends the authorization result to the V-PCF by sending Npcf_UEPolicyControl_Create response.\nIf H-PCF receives the VPLMN URSP generation request, the H-PCF also assigns the VPLMN precedence range and sends it to the V-PCF so that the V-PCF uses the VPLMN precedence range when generating URSP rules in order to avoid the conflict between the HPLMN generated URSP rules and VPLMN URSP rules.\n8.\tThe V-PCF responds to the AMF with sending Npcf_UEPolicyControl_Create response.\n9.\tIf V-PCF requested HPLMN URSP generation for the VPLMN, the H-PCF generates both the URSP rules of HPLMN and URSP rules for VPLMN using the parameters provided by the V-PCF. If V-PCF requests to allow V-PCF to generate VPLMN URSP rules, the H-PCF generates only URSP rules of HPLMN.\nThe H-PCF invokes the UEPolicyControl_UpdateNotify to send the generated URSP rule to the V-PCF.\n10.\tThe V-PCF acknowledges the UEPolicyControl_UpdateNotify.\n11.\tThe V-PCF generates the VPLMN URSP rules by itself and sends both HPLMN URSP rules and VPLMN URSL rules to the AMF. When generating VPLMN URSP rules, V-PCF uses the LBO information (such as DNN/S-NSSAI and SSC mode) received from the AMF to derive Route Selection Descriptors. If the V-PCF receives the VPLMN precedence range from the H-PCF at the step 7, the V-PCF assigns the precedence values of VPLMN URSP rules within the received range.\n12-14.\tThe AMF sends the UE policy container to the UE using the UE configuration update procedure.\n15.\tThe AMF reports the UE policy delivery result to the V-PCF.\n16.\tThe V-PCF sends the Npcf_UEPolicyControl_UpdateNotify to the H-PCF to inform the UE policy delivery result.\n17.\tThe H-PCF acknowledges the Npcf_UEPolicyControl_UpdateNotify.\nWith this procedure, the solution provides three different scenarios for AF in VPLMN to provide application guidance for URSP determination. Similar to clause 6.28.2.1, three different scenarios for VPLMN URSP generation are described.\n1)\tHPLMN generation of URSP for VPLMN request (Figure 6.28.2.2-1)\nWhen the AF requests the application guidance for URSP determination, NEF stores the service parameters in V-UDR. The V-UDR notify the V-PCF. Since the V-PCF has received LBO information from the AMF during the UE registration procedure as in step 5 of Figure 6.28.2.1-3, the V-PCF is aware of available home subscription values for the UE. The V-PCF sends the parameters to request the H-PCF to generate the URSP rules for VPLMN. The rest of steps are similar to the procedures of Figure 6.28.2.1-4.\nFigure 6 illustrates the process of HPLMN (Home Public Land Mobile Network) generating an Ultimate Radio Signal Point (URSP) for a VPLMN (Visitor Public Land Mobile Network) request. The figure depicts the interaction between the HPLMN and the VPLMN, showing the exchange of signaling messages and the establishment of a connection. Key components include the HPLMN, VPLMN, and the signaling network elements that facilitate the communication between them. The figure highlights the importance of accurate signal generation and routing in maintaining seamless connectivity for mobile users across different networks.\nFigure 6.28.2.2-1: HPLMN Generation of URSP for VPLMN request\n2)\tVPLMN generation of URSP rules (Figure 6.28.2.2-2)\nWhen the AF requests the application guidance for URSP determination, NEF stores the service parameters in V-UDR. The V-UDR notify the V-PCF. Since the V-PCF has received LBO information from the AMF during the UE registration procedure as in step 5 of Figure 6.28.2.1-4, the V-PCF is aware of available home subscription values for the UE.\nFigure 6 illustrates the process of VPLMN (Visitor Personal Location Management) generating an URSP (User Registration and Status Profile) for a 2G network. The figure showcases the interaction between the VPLMN, serving network, and the visited network, emphasizing the role of the VPLMN in managing the user's location and status. Key elements include the VPLMN, serving network, visited network, and the generated URSP, which is crucial for seamless roaming and communication between networks.\nFigure 6.28.2.2-2: VPLMN Generation of URSP\nThe procedure of application guidance for URSP determination in VPLMN for roaming scenario is described in Figure 6.28.2.2-4. The procedure consolidates the all three scenarios described above.\nFigure 6 illustrates the step-by-step procedure for application guidance in determining the Universal Resource Identifier (URI) for User Plane Control (UPC) in a Very Large Scale Network (VPLMN). The figure outlines the process of URSP determination, starting with the application guidance request from the User Equipment (UE) to the Serving Gateway (SGW). The SGW then forwards the request to the Home Location Register (HLR), which queries the Universal Mobile Telecommunications System (UMTS) for the appropriate URI. The process concludes with the HLR sending the URSP back to the SGW, which relays it to the UE. The figure emphasizes the importance of accurate URSP determination for efficient network management and seamless user experience.\nFigure 6.28.2.2-4: Procedure of application guidance for URSP determination in VPLMN\n0.\tUE performs the registration procedure with the AMF in VPLMN. The AMF retrieves HPLMN URSP Generation indication or VPLMN URSP Generation allowed indication and the LBO information in UDM and provides them to the V-PCF during creation of UE Policy Association.\n1.\tThe AF in VPLMN creates an AF request for application guidance for URSP determination in VPLMN\n2.\tThe AF sends the AF request to the NEF.\n3.\tThe NEF stores the service parameters to the UDR in VPLMN.\n4.\tNEF acknowledges the AF request. The parameters of AF request is checked in the step 6.\n5.\tThe V-UDR notifies V-PCF of DM information.\n6.\tBased on the HPLMN URSP Generation indication or VPLMN URSP Generation allowed indication received from the AMF when creating the UE Policy association, the V-PCF either requests HPLMN to generate URSP for VPLMN or generates VPLMN URSP by sending Npcf_UEPolicyControl_Create to the H-PCF.\nIf the VPLMN URSP Generation is allowed, the V-PCF checks the parameters of AF request to URSP rules with LBO roaming subscription data received from the UDM.\nIf HPLMN URSP Generation is indicated, the V-PCF sends the parameters to request H-PCF to generate URSP rules for VPLMN. The parameters includes the information for H-PCF to generate URSP rules for VPLMN such as traffic descriptor and Route Selection Descriptors. If there are multiple rules, the information also includes relative precedence values.\nNOTE:\tFor the scenarios as depicted in Figure 6.28.2.2-2, the steps 6, 7, 8, 9, 11, 12, 18, 19 are not performed.\n7.\tH-PCF sends the response to the V-PCF.\n8-12.\tThe steps are the same as the step 11 to step 19 of the Figure 6.28.2.1-4.\n13.\tThe V-PCF notifies the outcome of UE policy delivery result to the NEF.\n14.\tThe NEF notifies the outcome of UE policy delivery result to the AF.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.28.2.1-1: Example usage of URSP rule precedence",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.28.2.1-2",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.28.3\tImpacts on services, entities and interfaces",
                            "text_content": "AMF:\n-\tThe AMF is required to support HPLMN URSP Generation and VPLMN URSP Generation indication and forward LBO information (e.g. DNN/S-NSSAI and SSC mode) to the V-PCF.\nV-PCF:\n-\tThe V-PCF is required to provide the parameters for H-PCF to generate URSP, generate VPLMN URSP triggered by UE registration and support the AF request for application guidance of URSP determination in VPLMN.\nH-PCF:\n-\tThe H-PCF is required to support the generation of URSP for VPLMN request. The H-PCF is required to assign the VPLMN precedence range if the V-PCF requests VPLMN generation of URSP rules.\nUDM:\n-\tThe UDM is required to provide the HPLMN URSP generation indication or VPLMN URSP generation allowed indication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.29\tSolution #29: Using Location Criteria to Control Routing of Application Traffic",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.29.1\tDescription",
                            "text_content": "This solution addresses the following aspect of Key Issue #1:\n-\tWhether and how to support URSP enhancements to support routing of the application traffic with different URSP rules in different PLMNs.\nOther Key Issue #1 solutions in this TR explain what might trigger the PCF to send URSP rules to the UE. This solution does not address this aspect of Key Issue #1. Rather, this solution proposes how to use Location Criteria to support routing of the application traffic with different URSP rules in different PLMNs. In this solution the RSDs can be VPLMN dependent and can be sent to the UE by the HPLMN before the UE registers to the VPLMN. An indication in the RSD is used by the UE to help detect when URSP re-evaluation should be considered. In other words, this solution does not require that new URSP Rules be sent to the UE each time the UE registers in a different PLMN.\nThe principles of this solution are:\n-\tIn Rel-17, a URSP rule can already be configured with Location Criteria that indicates to the UE that the route (i.e. PDU Session) should only be established, or used, when the UE served by certain cell(s), RAN node(s), or TAIs. This feature can be used to cause the UE to select a DNN/S-NSSAI combination that is appropriate for the PLMN where the UE is registered (e.g. an LBO Session). Location criteria is defined in TS 24.526 [10] and may be a list of cell(s), RAN node(s), or TAI(s). This solution proposes that Location Criteria can also include PLMN ID(s).\nNOTE 1:\tWhether PLMN ID(s) can be encoded as part of Location Criteria or encoded as a new validation criteria information element is left to stage 3.\n-\tWhen a route includes Location Criteria, a \"Revaluation Suggested\" indication can be added to the RSD. A \"Revaluation Suggested\" indication in the RSD indicates to the UE that the UE should re-evaluate URSP rules for traffic that uses the PDU Session if the Location Criteria becomes invalid and release the PDU Session if no traffic is using the PDU Session after re-evaluation. In other words, the PDU Session may be released when the UE leaves the PLMN, cell(s), RAN node(s), or TAI(s) where the location criteria is valid and all traffic is moved to a different PDU Session (e.g. an LBO PDU Session).\nTriggering re-evaluation will cause the UE to select a new route. The new route may include location criteria for the UE's new location and a PDU Session will be established with a DNN/S-NSSAI combination that is better suited for the UE's new location (e.g. for the PLMN where the UE is now registered).\nNOTE 2:\tIt is a UE implementation decision when to re-evaluate URSP Rules. The indication is used to by the UE to help determine if it should re-evaluate.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.29.2\tProcedures",
                            "text_content": "The UE receives URSP rules. Some URSP rules may have Traffic Descriptors that are associated with traffic that should preferably use a certain DNN/S-NSSAI combination when the UE is in a certain PLMN. The RSDs of these URSP rules may include Location Criteria. By including Location Criteria, the URSP rule can be configured such that the UE will select a DNN/S-NSSAI combination for PDU Session Establishment based on the UE's cell, RAN Node, TAI or PLMN ID. Thus, the UE will use a DNN/S-NSSAI combination based on the PLMN that the UE is registered with. For example, the route will only be considered valid if the PLMN ID in the Location Criteria matches the PLMN ID of the PLMN where the UE is currently registered or if the PLMN ID in the Location Criteria is an equivalent PLMN of the PLMN where the UE is currently registered.\nExisting Rel-17 behaviour is that when the UE leaves the cell, RAN Node, or tracking area, the UE will continue to use the PDU Session until URSP Rules are re-evaluated. However, the UE is not required to re-evaluate URSP rules for the traffic.\nThis solution proposes that the RSD(s) also include a \"Revaluation Suggested\" indication. When a change of cell, RAN node, TAI, or PLMN occurs, the existing PDU Session will be released if no longer needed and the UE will re-evaluate URSP rules. URSP re-evaluation will cause the UE to choose a new RSD for the traffic. The location criteria in the new RSD will cause the UE to select a DNN/S-NSSAI that is associated with the PLMN where the UE is currently registered.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.29.3\tImpacts on services, entities and interfaces",
                            "text_content": "PCF:\n-\tcan include the \"Revaluation Suggested\" indication with location criteria in RSDs;\n-\tcan include a PLMN ID(s) in location criteria.\nUE:\n-\tcan receive the \"Revaluation Suggested\" indication with location criteria in RSDs;\n-\tcan use the \"Revaluation Suggested\" indication to decide when to trigger URSP Re-evaluation;\n-\tcan receive a PLMN ID(s) in location criteria.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.30\tSolution #30: Leveraging NWDAF to determine UEs that enforce URSP rules incorrectly.",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.30.1\tDescription",
                            "text_content": "This solution is related with KI#6 of the eNA study and also KI#2 of FS_eUEPO on how the 5GC can be aware that the UE enforces a URSP rules correctly.\nThe solution proposes to leverage the NWDAF to identify cases where a UE routes traffic to a PDU session (of a specific S-NSSAI/DNN) that is not according to the routing policies configured to the UE based on a provisioned URSP rule.\nThe consumer ( i.e.) PCF is aware of the correct application traffic that needs to be routed over a specific S-NSSAI/DNN by inspecting the URSP rule that needs to be determined if it is enforced correctly by UEs. The Traffic Descriptor of the URSP rule will identify the application traffic and the Route Selection Descriptor component will denote the correct S-NSSAI/DNN to route the application traffic.\nThe PCF determines to request analytics to identify if UEs enforce URSP rules correctly to a PDU session of a specific S-NSSAI/DNN based on local configuration.\nThe request to the NWDAF to provide analytics to detect UEs that do not enforce URSP correctly include the following:\n-\tAn analytic ID denoting a request for URSP enforcement analytics.\n-\tAnalytic Filters:\n-\tThe S-NSSAI/DNN of the PDU session established by a UE.\n-\tThe Allowed application traffic towards the PDU session according to the URSP rule. Allowed application traffic may include the Traffic Descriptor of the URSP rule (e.g. Application ID, FQDN) or may include allowed service data flows (i.e. the PCF may determine the allowed service data flows based on the Traffic Descriptor).\n-\tArea of interest.\n-\tAny UE or list of UEs.\nThe NWDAF subscribes to the UPF using a new Nupf event based subscription to report \"non-matching traffic\" for a PDU session established to a specific S-NSSAI/DNN. The Nupf_EventExposure_Subscribe requests includes the following:\n-\tA new event ID: e.g. \"Non-matching traffic\";\n-\tTraffic Filters indicating the allowed traffic. This can be a 5-tuple or an application id;\n-\tS-NSSAI or DNN of the PDU session to be inspected;\n-\tTarget of Event Reporting (e.g. a single UE, a group of UE or any UE);\n-\tNotification Target Address (+ Notification Correlation ID); and\n-\tEvent Reporting Information defined in Table 4.15.1-1 of TS 23.502 [3].\nThe NWDAF determines the UPF that support the requested S-NSSAI/DNN either by interfacing with the NRF or the UDM (if the request includes a list of UE(s).\nWhen the UPF detect non-matching traffic the UPF reports to the NWDAF, traffic filters indicating the traffic detected and a UE identifier (UE ID or UE IP address) of the UE that routed non-matching traffic to a PDU session established to a specific S-NSSAI/DNN.\nNOTE 1:\tThe UPF can use the usage reporting capabilities as described in clause 5.4.6 of TS 29.244 [14] to determine and report non-matching traffic.\nNOTE 2:\tIt is assumed that the UPF has received S-NSSAI/DNN information from the SMF when the SMF establishes an N4 session for a requested PDU session.\nNOTE 3:\tTo control the signalling load of the UPF the UPF can be configured to report usage periodically to the NWDAF by re-using the event reporting information defined in Table 4.15.1-1 of TS 23.502 [3].\nBased on the information collected the NWDAF reports to the PCF a list of UEs that route traffic incorrectly and application traffic that is routed incorrectly over the S-NSSAI/DNN. The PCF uses the information to determine if such UEs require updated URSP rules (e.g. route specific application traffic over a default DNN) (if the consumer is the UE PCF) or block traffic by providing updated PCC rules for the established PDU session (if the consumer is the SM PCF).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.30.2\tInput Data",
                            "text_content": "The following input data are required by the NWDAF to identify UEs that enforce URSP rules incorrectly.\nTable 6.30.2-1: Input data for URSP enforcement analytics\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.30.2-1: Input data for URSP enforcement analytics",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.30.3\tOutput Analytics",
                            "text_content": "The NWDAF only provides to the PCF statistics on UEs that do not enforce URSP correctly as shown in the table below. For this scenario the NWDAF does not provide any predictions.\nTable 6.30.3-1: \"URSP enforcement\" statistics\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.30.3-1: \"URSP enforcement\" statistics",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.30.4\tProcedures",
                            "text_content": "The procedure is shown in the figure below.\nFigure 6.30.4-1 illustrates the Network Data Analytics Function (NWDAF) in action, analyzing User-to-Network Data Association (URSP) rules to enforce network policies. The figure showcases the NWDAF's role in processing traffic flows, identifying and prioritizing data packets based on defined rules. The visual representation emphasizes the importance of real-time analytics in ensuring network efficiency and security.\nFigure 6.30.4-1: NWDAF providing analytics for URSP rules enforcement\nThe procedure is as follows:\n1.\tThe consumer (i.e. PCF) needs to identify if a URSP rule is enforced correctly by UEs. The PCF is locally configured to determine which URSP rule needs to be checked if enforced correctly by UEs.\n2.\tThe consumer request analytics for URSP enforcement by the NWDAF. The consumer includes a specific Analytic ID (that is associated to the URSP enforcement analytics) and includes as analytics filters the following information:\n-\tAn analytic ID denoting a request for URSP enforcement analytics.\n-\tAnalytic Filters:\n-\tThe S-NSSAI/DNN of the PDU session established by a UE.\n-\tThe Allowed application traffic towards the PDU session according to the URSP rule. Allowed application traffic may include the Traffic Descriptor of the URSP rule (e.g. Application ID, FQDN) or may include allowed service data flows (i.e. the consumer may determine the allowed service data flows based on the Traffic Descriptor).\n-\tArea of interest.\n-\tAny UE or list of UEs.\n3.\nIf the request includes Αny UE:\n-\tThe NWDAF subscribes from all SMFs supporting the S-NSSAI/DNN requested, to be notified when a UE establishes a PDU session to the S-NSSAI/DNN requested in step 2. The SMF provides the UE ID and UE IP address to the NWDAF.\nIf the request includes a list of UEs\n-\tThe NWDAF finds the UPF serving the UE for the requested S-NSSAI/DNN by querying the UDM to identify SMF serving UE for the S-NSSAI/DNN and then querying the SMF to identify the UPF serving the UE.\n-\tAlternatively the NWDAF may query the UDM to find the UPF serving the UE for an S-NSSAI/DNN\n4.\tThe NWDAF subscribes from the UPF to report non-matching traffic. The NWDAF subscribes to the UPF using a new Nupf event based subscription to report \"non-matching traffic\" for a PDU session established to a specific S-NSSAI/DNN. The Nupf_EventExposure_Subscribe requests includes the following:\n-\tA new event ID: e.g. \"Non-matching traffic\";\n-\tTraffic Filters indicating the allowed traffic. This can be a 5-tuple or an application id;\n-\tS-NSSAI or DNN of the PDU session to be inspected;\n-\tTarget of Event Reporting (e.g. a single UE, a group of UE or any UE);\n-\tNotification Target Address (+ Notification Correlation ID); and\n-\tEvent Reporting Information defined in Table 4.15.1-1 of TS 23.502 [3].\n5.\tA UE determines to request a PDU session based on application traffic matching a URSP rule.\n6.\tThe UE requests establishment of a PDU session to the SMF according to TS 23.502 [3].\n7.\tWhen the UPF receives traffic (either in downlink or uplink) for a UE the UPF reports non-matching traffic and includes the service data flows of the traffic detected.\n8.\tThe NWDAF compiles a list of UEs where application traffic is sent to the wrong S-NSSAI/DNN.\n9.\tThe NWDAF provides a list of UE IDs and a list of non-matching traffic that is wrongly sent to this S-NSSAI/DNN.\n10.\tThe PCF may construct a new URSP rule to route traffic detected via a different S-NSSAI/DNN, e.g. via a default DNN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.30.5\tImpacts on services, entities and interfaces",
                            "text_content": "Editor's note:\tThis clause captures impacts on existing 3GPP nodes and functional elements.\n-\tNWDAF supporting new analytic id to identify UEs that do not enforce URSP rule correctly.\n-\tUPF reporting to NWDAF application traffic that is not matched against allowed traffic to a specific S-NSSAI/DNN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.31\tSolution #31: New URSP Notification Component",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.31.1\tDescription",
                            "text_content": "This solution describes an extension to the Route Selection Descriptors listed in clause 6.6.2 of TS 23.503 [4] with a new category: URSP Notification component. The solution allows the 5GC to be made aware of whether a URSP rule is enforced and considers as well user privacy by allowing the UE/user to reject URSP rules with a notification component and notify the 5GC of the rejection.\nExamples are provided in clause 6.31.2.4 of how this solution can enable action from the 5GS to be taken after the 5GC is aware whether the UE enforces a URSP rule for specific application traffic or not. However, the focus of the solution is on making the 5GC aware of URSP rule enforcement.\nA URSP Notification component instructs the URSP rule to, under certain trigger conditions, generate a notification towards the core network. If the component is not included in the URSP rule, it is not required by the network to generate notifications towards the core network (i.e. URSP functionality as it is now).\nSimilarly to how SBI notifications contain a subscription identifier, URSP Notification component contain an identifier, which is included in notifications and are used by the core network to map the notification to a URSP rule and trigger.\nIn order not to overload existing identifiers (e.g. PSI, precedence), the identifier introduced in this solution is coupled to the notification component. This also allows that more than one notification trigger can be linked to a given URSP rule.\nThe table below, based on Table 6.6.2.1-3 of TS 23.503 [4] includes the current Route Selection Descriptor and the new URSP Rule Notification Descriptor. Existing URSP descriptors are shown greyed-out, new URSP Notification Component highlighted.\n\n\nThe URSP Notification Component indicates the UE that, under certain conditions, the UE is to notify the PCF. URSP Notifications are sent towards the PCF responsible for the UE indirectly via the AMF via a UL NAS TRANSPORT message carrying a UE Policy Container (URSP Notification) to the AMF. The UL NAS TRANSPORT mechanism used to reach the PCF uses the same mechanics as the Procedure for UE triggered ProSe Policy provisioning described in clause 6.2.4 of TS 23.304 [12].\nNOTE 1:\tURSP Notification component(s) are not used with match-all rules.\nThe AMF at the receiving end maps the PCF responsible for the UE and forwards the Notification towards the PCF. The PCF at the receiving end will be able to map the generating UE, URSP rule and trigger based on the URSP Notification Component ID without the information having to be explicitly signalled.\nSo that the 5GC can be made aware whether or when the UE enforces a URSP rule to route an application traffic to a PDU Session based on the URSP rule provisioned by 5GC, the following trigger conditions are considered as part of a URSP Notification Component:\na)\tFirst use of the URSP rule.\nb)\tData sent over given period of time (i.e. periodic reporting).\nc)\tIf a certain amount of data has been sent over a specific period of time (i.e. Bandwidth threshold).\nExamples of possible applications of the above-mentioned triggers would be (a) first activation of a service, (b) the network ascertaining if the URSP rule is still in use (i.e. a sort of \"service Up/Down\" indicator) or (c) for some services (e.g. video) a bandwidth threshold could be setup so that signalling (e.g. HTTP requests to the web itself, not the video) do not trigger a \"used\" indication, but rather only if a bandwidth-intensive usage is seen.\nNote that the 5GC specifies how to detect the data sent and received over a given period, using usage monitoring reporting and can provide bandwidth parameters to limit the amount of data sent over a period, using the QoS framework defined in 23.501, and the MBR parameter.\nFor the use of the URSP Rule, this is a solution while other solutions exist to this KI#2 that enables detection of the URSP Rule in use (first or subsequent use) either at the SMF or PCF.\nUser privacy is considered by allowing the UE to reject URSP policies including notifications based on UE security policies. However, if a UE accepts a URSP rule, it is expected to apply it fully, including URSP Notification Component(s).\nProcedures are shown for the following cases:\n-\tURSP rule delivery, URSP Notification sent to 5GC.\n-\tDetail of UE policy delivery and user content.\n-\tApplicability to (pre-)configured URSP rules and changes in privacy settings.\nNOTE 2:\tHow the preconfigured URSP Rules are used and for what purpose is detailed in clause 6.31.2.3.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.31.2\tProcedures",
                            "text_content": "A call flow of the procedure is shown below.\nFigure 6 illustrates the step-by-step process of the URSP Notification procedure in a telecommunication network. The figure begins with the Network Element (NE) sending a notification to the Network Management System (NMS) through the Network Element Manager (NEM). The NMS then forwards the notification to the Network Element Manager (NEM) for further processing. The figure also shows the interaction between the Network Element (NE) and the Network Element Manager (NEM) through the use of arrows and lines, indicating the flow of information and communication between the two entities. The figure is a valuable resource for understanding the complex process of URSP Notification in a telecommunication network.\nFigure 6.31.2.1-1: URSP Notification procedure flow\n\n1.\tAs part of the UE policy association establishment, as per TS 23.502 [3], clause 4.16.11, the PCF is assumed to register to the BSF as the PCF serving this UE. The PCF is subscribed to be notified of the reception of the UE Policy container then the AMF forwards the response of the UE to the PCF using Namf_Communication_N1MessageNotify.\nNOTE 1:\tAccording to clause 6.3.7.1 of TS 23.501 [2], the same PCF instance is assumed for AM policy association and UE policy association.\n2.\tUE Policies are delivered to the UE using the current, existing mechanism of UE Configuration Update procedure for transparent UE Policy delivery, see clause 4.2.4.3 of TS 23.502 [3]. URSP Rule(s) contain one or more Route Selection Notification Components. The UE can, based on local security/privacy settings, reject URSP rules containing URSP notification component(s). Each Route Selection Notification Components contains:\n-\tIdentifier: Similarly to how a SBI subscription has a subscription identifier, a Notification component contains an identifier to be included in subsequent notifications. The identifier is used by the PCF to map the notification to a UE, URSP rule and trigger.\n-\tTrigger condition: Following trigger conditions are considered:\n-\tFirst use of the URSP rule.\n-\tData sent over given period of time (i.e. periodic reporting).\n-\tIf a certain amount of data has been sent over a specific period of time (i.e. Bandwidth threshold).\nNOTE 2:\tDetails of the UE policy delivery including privacy-related aspects and user consent are detailed in the next call flow in clause 6.31.2.1.\n3.\tTrigger condition for a notification (Notification Component A) is set\n4.\tThe UE sends the URSP notification via a UL NAS TRANSPORT message. The included UE Policy Container is of type URSP Notification and contains:\n-\tIdentifier of Notification Component A.\n-\tNotification information (depending on trigger condition).\n5.\tThe AMF sends Namf_Communication_N1MessageNotify request to the PCF including the UE Policy Container received from UE as described in step 2 of clause 6.2.4 of TS 23.304 [12].\n6.\tThe PCF uses the URSP Notification Component ID to map the incoming notification information to a UE, URSP rule (if the URSP rule is known) and trigger condition.\nThis call flow depicts an expanded view of step 2. The flow is based on clause 4.2.4.3 of TS 23.502 [3].\nFigure 6.31.2.2-1 illustrates the UE Configuration Update procedure for transparent UE Policy delivery, including the URSP Notification component and privacy aspects. The figure depicts the process flow, starting with the network operator configuring the UE policy, followed by the UE receiving the policy update. The figure emphasizes the importance of privacy aspects, such as pseudonymization, in handling user data. The diagram also highlights the role of the URSP Notification component in ensuring that the user is informed about the policy changes.\nFigure 6.31.2.2-1: UE Configuration Update procedure for transparent UE Policy delivery including URSP Notification component and privacy aspects\n0-2.\tSame as in clause 4.2.4.3 of TS 23.502 [3].\n3.\tDelivery of the UE policy content described in clause 6.31.2.1, step 2. The UE policy content is delivered as for step 3 in clause 4.2.4.3 of TS 23.502 [3].\n4.\tFor URSP rules containing a URSP Notification component, the UE can be configured to allow said reporting. Examples of security/privacy configuration:\n-\tUser is to be prompted whether a given URSP rule including a notification component should be allowed when the URSP rule is received.\n-\tCertain applications are allowed to use URSP notification components (e.g. UE configuration, configured by user).\nIf the Notification component is not allowed, the URSP rule is rejected and not stored in the UE.\nNOTE 1:\tIf the URSP rule is rejected, as a result, certain traffic will not be able to use enhanced functionality. Thus, the user has the option to allow enhanced routing for certain application with the knowledge that traffic reports may be send or disallow such reporting and use other routing (e.g. default slice/PDU session).\n5.\tSame as step 4 in clause 4.2.4.3 of TS 23.502 [3], with the addition that in case the URSP rule was rejected due to one or more URSP Notification component(s) not being allowed. The UE includes this information in the result.\nNOTE 2:\tFor the case when an already-accepted URSP rule is rejected after being accepted (e.g. privacy/security settings were changed), see clause 6.31.2.3.\n6.\tSame as step 5 in clause 4.2.4.3 of TS 23.502 [3].\nIf a URSP rule is rejected by the UE, the PCF can use the returned URSP rejection reason to produce an alternative set of URSP rule(s). The logic how the PCF can produce an alternative set of URSP rule(s) or whether no alternative URSP rule is produced is not in scope of this solution.\nPre-configured URSP rules are covered by the current specification. As stated in TS 23.503 [4], clause 6.1.2.2, \"ANDSP and URSP may be pre-configured in the UE or may be provisioned to UE from PCF\".\nIf the solution does not consider user privacy for the case of pre-configured URSP rules (e.g. a UE pre-configured for use of a certain slice), it would be possible by design to circumvent the functionality in clause 6.31.2.2 simply by means of pre-configuring URSP rules. Pre-configuration of URSP rules would either result in the UE not having a chance of rejecting the URSP rule (the rejection mechanism described in clause 6.31.2.2 is based on \"Result of the delivery of UE policies\") or the UE not applying the given URSP rule while the network is not aware that the URSP rule has been rejected.\nWhile it is possible that a pre-configured URSP rule is not known to the PCF, it is assumed that it, as well as any associated URSP notification identifier, is known to the operator. As such, this solution does not propose that the UE-PCF performs any action based on this (not known) URSP rule besides forwarding it to a 3rd party (e.g. see clause 6.31.2.4.2).\nAdditionally, a similar case occurs if, after the UE accepted a URSP rule (see clause 6.31.2.2), UE configuration is changed (e.g. if security/privacy settings are changed so that a given URSP rule should now be rejected by the UE).\nFor pre-configured URSP rules or already-accepted URSP rules, there is no possibility for the UE to respond with a \"Result of the delivery of UE policies\". In this case, the UE's URSP security/privacy policy is configured with a URSP rule to be used for rejected URSP rules (e.g. the default URSP rule). The UE notifies the PCF via UL NAS TRANSPORT:\n-\tIdentifier of Notification Component.\n-\tNotification information indicating that the pre-configured URSP rule does not conform to the security/privacy policy and as such it is rejected.\nFigure 6 illustrates the process of rule rejection for existing URSP (User-to-User Communication) rules within a telecommunication network. The figure depicts a hierarchical structure of network elements, including the AS (Autonomous System), ASBR (Border Gateway Protocol Router), and the AS path. The rule rejection process is depicted through a series of arrows, indicating the flow of traffic and the application of rules at each stage. The figure emphasizes the importance of efficient rule management in maintaining the integrity and performance of the network.\nFigure 6.31.2.1-1: URSP rule rejection for existing URSP rules\n0.\tThe initial assumption is a URSP rule (URSP rule A) provisioned in the UE containing a URSP notification component (URSP Notification X), e.g. a pre-configured URSP rule or a URSP rule that has been signalled by the PCF and accepted (see 6.31.2.2). Privacy/security settings from the UE do not allow URSP Notification X1.\tTraffic matches URSP rule A. URSP rule A is not applied due to the privacy/security settings, e.g. first use of a pre-configured URSP rule, change of security/privacy settings since the URSP rule was received from UE-PCF and accepted by the UE.\n2.\tThe UE sends the a URSP Notification via a UL NAS TRANSPORT message. The included UE Policy Container is of type URSP Notification and contains:\n-\tURSP rule A rejection.\n-\tReason for rejection: URSP Notification Component A not allowed.\n3.\tThe AMF sends Namf_Communication_N1MessageNotify request to the PCF including the UE Policy Container received from UE as described in TS 23.304 [12], clause 6.2.4, step 2.\n4.\tThe PCF uses the URSP Notification Component ID to map the incoming notification information to a UE, URSP rule (if the URSP rule is known) and trigger condition.\nNOTE:\tThe UE can report that a URSP Rule provided in the UE Configuration Update for UE Policies was not installed, this procedure could also be enhanced to allow the UE to report that a URSP Rule was removed to the network.\nThis clause lists some examples of actions the PCF could take on reception of URSP notifications. While the solution focuses on asserting the URSP usage by the UE, the examples shown in this clause show possible uses of this information and that the solution is compatible with the current 5GC architecture and design principles.\nThe examples focus on how SM-PCF, AF and/or NEF can be notified of URSP Notifications received by the UE-PCF. The mapping of a URSP notification to a URSP rule by the UE-PCF is only considered for URSP rules known to the UE-PCF.\nThis solution focuses on how the 5GC can be made aware of URSP rule enforcement, but following actions are possible based on reception of URSP Notifications:\n-\tSending an alternative URSP rule to the UE (or removing an existing one) without notification capability and/or modifying the applied SM policy.\n-\tRejecting the UE (e.g. the service requires a specific SLA and part of the SLA can only be fulfilled if the URSP rule is applied)\n-\tNotifying the application owner, when the URSP Rule was generated based on Service Parameters provided by the AF.\nRelated to possible triggers, an example use case for sending an alternative URSP rule to the UE (or removing an existing one) would be a combination with transmission of a certain amount of data, whereas only a certain amount of data would be using a specific slice (e.g. with resource reservation), whereas after that the URSP rule could be remove by the UE-PCF.\nIn this example, the PCF receiving the URSP Notification performs storage of the received notification on the UDR linked to the triggered UE (e.g. via Nudr_DR/policy-data/ues/{ueId}/) and, if available, to the generating URSP rule. Pre-configured URSP rules may not be known to the PCF but known to the operator.\nNOTE:\tThere is already a procedure for the PCF to report to the AF via UDR, per current procedures, the UDR is a repository not handling reporting of events but rather PCF or AMF can do it directly. This example could alternatively (and with less need for changes) be realized in such a way.\nBased on the received information, the UDR can generate notifications towards SM-PCF(s) subscribed to notifications related to a given URSP policy rule. With the information that a given application linked to a the URSP is active, the SM-PCF can steer the session policy to e.g., increase the QoS associated to a PDU session.\nSpecific (example) use cases related to this example would be a PDU session used by an application (e.g. slice offering GBR services) where a second application is now first used (and so signalled by the UE). The existing PDU session's GBR could now be updated so that it can also accommodate the additional application. Similarly, if it is detected that the second application is not used anymore (e.g. via periodic reporting), the GBR could be adjusted down.\nFor the realization of this example, it is considered that the UDR contains a mapping between the URSP rules (accessed via /policy-data/ues/{ueId}/am-data) and SM policy data (accessed via /policy-data/ues/{ueId}/sm-data). In this way, a SM-PCF can subscribe to events related to its SM policies without requiring any explicit knowledge of what URSP rules are related to its SM policies.\nFor URSP Notifications where the associated URSP rule is not known by the UE-PCF (e.g. possible in the case of a UE with pre-configured URSP rules), a subscription based on the URSP Notification identifier can be realized.\nFigure 6.31.2.4.1-1 illustrates an example flow for the storage of received notifications on the User Data Repository (UDR) linked to a triggered User Equipment (UE) and notification to the Service Management (SM) Policy and Charging Function (PCF) based on Service Management (SM) policies. The flow begins with the UDR receiving a notification from the UE, which is then stored. Subsequently, the notification is forwarded to the Service Management Policy and Charging Function (SM-PCF) for processing based on the defined SM policies. This process ensures the proper handling and management of notifications within the network, maintaining efficient and accurate service delivery.\nFigure 6.31.2.4.1-1: Example flow for Storage of received notification on the UDR linked to the triggered UE and notification to SM-PCF based on SM policy\nFigure 6.31.2.4.1-2 illustrates an example flow for the storage of received notifications on the User Data Repository (UDR) linked to a triggered User Equipment (UE) for a Universal Resource Identifier (URI) Resource Provisioning (URSP) rule that is not known to the UE. The flow begins with the reception of a notification from the network, which is then stored in the UDR. The notification is then forwarded to the Access and Mobility Management (AMM) Function (AF) and Network Exposure Function (NEF) based on the notification ID. This process ensures that the network can effectively manage and provision resources for the UE, even when the UE is not aware of the specific URSP rule that has been triggered.\nFigure 6.31.2.4.1-2: Example flow for Storage of received notification on the UDR linked to the triggered UE for URSP rule not known to UE-PCF and notification to AF/NEF based on URSP notification ID\nImpacts related to this example:\nPCF:\n-\tUE-PCF: Add received URSP notification to UDR.\n-\tSM-PCF: Subscribe to UDR for URSP notifications related to a SM policy.\nAF/NEF:\n-\tSubscribe to UDR for URSP notifications related to a given application ID and/or notification ID.\nUDR:\n-\tStorage of URSP notification data in UDR\n-\tAdd link in UDR between the existing /policy-data/ues/{ueId}/am-data and /policy-data/ues/{ueId}/sm-data so that a SM-PCF can subscribe to events related to SM policies without having to refer to UE policy-related data\n-\tMap received URSP notification data to a SM policy\n-\tProbably add subscription procedure for insertion of URSP Notifications to UE policy data for a given SM policy, URSP notification ID and/or application ID. Current subs-to-notify information contained in PolicyDataSubscription is geared towards changes in elements, not insertion of related elements\nIn this example, the PCF receiving the URSP Notification generates a notification via Event exposure to other NFs (e.g. NWDAF for analytics, anomaly detection, SM-PCF to steer policies applied to PDU sessions) or AF.\nNOTE:\tIt is assumed the subscriber (e.g. SM-PCF, AF, NEF) can locate the UE-PCF, e.g. via the BSF and that UE-PCF and subscriber have connectivity.\nFigure 6.31.2.4.2-1 illustrates an example flow for notification via event exposure to Service Management (SM) Policy and Charging Function (PCF) based on User-Requested Service Provisioning (URSP) rule ID. The figure showcases the interaction between the Service Management (SM) and Policy and Charging Function (PCF) components, highlighting the process of event exposure and rule-based service provisioning. The diagram emphasizes the importance of URSP rule IDs in managing and controlling service access and usage within the network.\nFigure 6.31.2.4.2-1: Example flow for Notification via Event exposure to SM-PCF based on URSP rule ID\nFigure 6.31.2.4.2-1 illustrates an example flow for Notification via Event exposure to AF/NEF based on URSP Notification ID. The figure depicts the process of how a notification is sent through the AF/NEF (Application Function/Network Exposure Function) when an event is detected. The notification is based on a unique URSP (User-Related Service Provisioning) Notification ID, which is used to identify and track the notification throughout its lifecycle. The figure shows the various components involved in the process, including the URSP, AF/NEF, and the underlying network infrastructure. The flow is designed to ensure that notifications are delivered efficiently and accurately, while also maintaining the security and privacy of the data being transmitted.\nFigure 6.31.2.4.2-1: Example flow for Notification via Event exposure to AF/NEF based on URSP Notification ID\nImpacts related to this example:\nPCF:\n-\tUE-PCF: Addition of EventExposure to Npcf_UEPolicyControl to send received URSP notification to subscribed NFs based on URSP rule identifier\n-\tSM-PCF: Subscribe to UE-PCF for URSP notifications related to a SM policy rule\n-\tSM-PCF: Identify UE-PCF for a given UE\nAF/NEF:\n-\tSubscribe to UDR for URSP notifications related to a given application ID and/or notification ID\n-\tIdentify UE-PCF for a given UE\nUDR:\n-\tAdd link in UDR between the existing /policy-data/ues/{ueId}/am-data and /policy-data/ues/{ueId}/sm-data so that a SM-PCF can subscribe to events related to SM policies without having to know UE policy-related data\nBased on the examples shown in clauses 6.31.2.4.1 and 6.31.2.4.2, the awareness of whether a UE enforces a URSP rule for specific application traffic can be used to convey information to the application owner. While an application owner can be aware whether its application is running, it may be interested to know via notifications from the 5GC whether a URSP rule associated with the application is active (e.g. as a relevant KPI part of an SLA).\nFigure 6.31.2.4.2-1 illustrates an example flow for notifying an application owner via the Network Element Function (NEF). The figure depicts the process in three main steps: \n\n1. The application initiates a request to the NEF, which is the central point of communication in the network.\n2. The NEF then sends a notification to the application owner, ensuring they are aware of the request and its status.\n3. The application owner can then respond to the NEF, either approving or rejecting the request, which is then relayed back to the application.\n\nThis flow is crucial for maintaining efficient communication between applications and the network, ensuring that requests are processed in a timely and effective manner.\nFigure 6.31.2.4.2-1: Example flow for Notification of Application owner via NEF\nImpacts related to this example additionally to those in clauses 6.31.2.4.1 or 6.31.2.4.2:\nNEF:\n-\tSubscription from application owner to URSP usage by a given application or URSP notification ID (e.g. for pre-configured URSP rules), subscription to UDR or UE-PCF to URSP notifications related to a given application\nPCF or UDR:\n-\tAllow subscription to URSP notifications related to a given Application ID\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.31.3\tImpacts on Existing Nodes and Functionality",
                            "text_content": "UE:\n-\tSupport for additional URSP Notification Component in received UE policy container via UE Configuration Update.\n-\tSupport for acceptance/rejection of URSP rules containing URSP Notification component(s) based on URSP security/privacy.\n-\tSupport for triggering of URSP notifications sent via UL NAS TRANSPORT and a new UE Policy Container of type URSP Notification.\nAMF:\n-\tForward URSP rule notifications to PCF received via UL NAS TRANSPORT.\nPCF:\n-\tSupport for URSP rule notifications forwarded from AMF via Namf_Communication_N1MessageNotify.\nNOTE:\tImpacts regarding the different examples of PCF actions on receiving URSP notifications are not necessary to realize the solution and are informatively included in each corresponding example clause.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.32\tSolution #32: Application Detection using Domain Descriptor",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.32.1\tDescription",
                            "text_content": "This solution addresses the following technical issues of the KI#2:\n-\tWhether and how the 5GC can be made aware whether or when the UE enforces a URSP rule to route an application traffic to a PDU Session based on the URSP rule provisioned by 5GC.\nThis solution provides a part of solution to address the above key issue only for the case where the Domain Descriptor is used in the URSP rule. This solution can be used with other application detection solution.\nAmong various traffic descriptors are listed in URSP rules, the domain descriptor is one of useful descriptors to identify the application traffic.\nToday, UPF-based mechanism to detect the FQDN-based application traffic can be used, however, it has the following limitations:\n-\tIt may not work if DNS over TLS or DNS over HTTPS is used.\n-\tIt may not guarantee the same IP address is resolved since the EAS IP address may be different based on EDNS Client Subnet option is used. Since the specifications do not specify how the UPF detect the domain name, based on the UPF implementations, the different IP address for the same FQDN can be resolved.\nTherefore, the current mechanism is not enough to check whether the application traffic from the UE is compliant with the URSP if the domain traffic descriptor is used.\nThis solution provides a mechanism for the UE-PCF to detect application traffic detection using domain descriptor to check whether the UE is compliant with the traffic descriptor for the case when the EASDF is used for edge computing. This solution assumes that the EASDF for edge computing is deployed and SMF can be notified when the EASDF detects the DNS messages.\nThe UE-PCF is notified the PDU Session establishment of the target UE to be checked for the URSP compliance. The UE-PCF subscribes SM-PCF for the reporting of application traffic detection for FQDN based the flow descriptor. The SM-PCF updates the PCC rules with FQDN-based flow descriptor for the SMF to report if DNS message exchanges are detected or DNS resolved traffic identified by the FQDN is detected.\nFigure 6.32.1-1 shows an abstract operation of 5GC for DNS message detection and reporting. The UE-PCF subscribes the application detection indicating DNS message detection and reporting with FQDN to the SM-PCF. The SM-PCF updates the PCC rules indicating the DNS message reporting with FQDN-based SDF template.\nIn addition to the existing IP-based or Ethernet-based service data flow filters and in a PCC rule or an application identifier, it is proposed to define additional service data flow filter which identifies a FQDN or FQDN range with regular expression. In this solution, it is also called as a FQDN-based SDF template.\nThe SMF updates DNS message handling rule with EASDF. When the UE, EASDF and the DNS server exchanges the DNS message, the EASDF detects and reports the DNS message to the SMF. The SMF notifies the detected application information to the SM-PCF. SM-PCF forwards the information to the UE-PCF.\nFigure 6.32.1-1 illustrates the process of FQDN-based application detection through DNS message detection and reporting. The figure depicts the interaction between the client, DNS resolver, and authoritative DNS server. The client sends a DNS query to the DNS resolver, which then forwards the query to the authoritative DNS server. The authoritative DNS server responds with a DNS response, which includes information about the IP address of the server hosting the requested domain. The DNS resolver then relays this information back to the client, completing the process. This method of application detection is crucial for identifying and mitigating threats, as it allows for the detection of malicious activity by monitoring DNS traffic.\nFigure 6.32.1-1. FQDN based Application Detection (DNS message detection and reporting)\nThe Figure 6.32.1-1 shows an abstract operation of 5GC for DNS resolved traffic detection and reporting. The UE-PCF subscribes the application detection indicating DNS resolved traffic detection and reporting with FQDN to the SM-PCF. The SM-PCF updates the PCC rules indicating the DNS resolved traffic detection and reporting with FQDN-based SDF template. The SMF updates DNS message handling rule with EASDF. When the UE, EASDF and the DNS server exchanges the DNS message, the EASDF detects and reports the DNS message to the SMF. The SMF updates N4 rule (e.g. PDU and URR) to the UPF. When the UPF detects the application traffic, it notifies the SMF of the detected traffic. The SMF notifies the detected application information to the SM-PCF. SM-PCF forwards the information to the UE-PCF.\nFigure 6.32.1-2 illustrates the process of FQDN-based application detection, which involves DNS-resolved traffic detection and reporting. The figure depicts the flow of traffic from the user's device to the DNS server, where the domain name is resolved into an IP address. The IP address is then passed to the application detection system, which identifies the specific application associated with the traffic. This information is then reported back to the user's device and the network administrator, allowing for better monitoring and management of network traffic. The figure highlights the importance of DNS-based application detection in today's complex network environments, where identifying and managing application traffic is crucial for maintaining network performance and security.\nFigure 6.32.1-2. FQDN based Application Detection (DNS resolved traffic detection and reporting)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.32.2\tProcedures",
                            "text_content": "This procedure describes the FQDN-based application detection\nFigure 6.32.2-1 illustrates the process of FQDN-based application detection, which involves analyzing the Fully Qualified Domain Name (FQDN) of a web request to identify the specific application that the request is intended for. The figure shows the various components involved in this process, including the client device, the network infrastructure, and the application server. The client device sends a request to the network infrastructure, which then forwards the request to the application server. The application server analyzes the FQDN of the request and determines which application it is intended for. This information is then used to route the request to the appropriate application server, ensuring that the request is processed efficiently and effectively. The figure also shows how this process can be used to detect and prevent malicious activities, such as DDoS attacks, by identifying and blocking requests from unauthorized sources.\nFigure 6.32.2-1: FQDN-based Application Detection\n1.\tUE-PCF subscribes the reporting of application detection to the SM-PCF. The message includes the FQDN-based SDF template to identify the application traffic matching the domain descriptor of the target UE. The subscription request may also request either DNS reporting indication or DNS resolved traffic detection if FQDN-based service data flow template is used.\n2.\tSM-PCF updates the PCC rules with FQDN-based SDF template for the SMF to report the detected application. The FQDN-based SDF template can represent one or more FQDN such as abc.asp1.com, abcd.asp1.com or FQDN range in regular expression such as *.asp1.com. The PCC rules indicates either 1) DNS message reporting or 2) DNS resolved traffic detection.\n3.\tThe SMF generates DNS message handling rules using FQDN-based SDF template.\n4.\tThe SMF sends the DNS message handling rule for the EASDF to report the DNS message when the EASDF detects the DNS messages.\n5-7.\tThe UE exchanges the DNS Query and DNS Response with the DNS server via EASDF.\n8.\tWhen detecting the DNS Response, the EASDF notifies the FQDN and resolved address for the FQDN to the SMF.\n9.\tIf the PCC rules indicates DNS resolved traffic detection, the SMF generates the corresponding N4 rules, e.g. PDR and URR in order for the UPF to report the traffic identified by IP address.\n10-11.\tThe SMF updates the N4 rules to the UPF.\n12.\tIf the PCC rule indicates DNS message reporting and the SMF is notified DNS message detection from the EASDF, the SMF notifies the detected FQDN and its IP address to the SM-PCF.\n13.\tThe SM-PCF notifies the notification address of the UE-PCF of the DNS message detection received from the SMF.\n14.\tThe EASDF forwards the DNS Response message to the UE.\n15.\tAfter resolving the IP address of the application, the UE and the application server exchanges the application traffic (e.g. TCP SYN or HTTP transactions).\n16.\tThe UPF detects the traffic matching PDR and reports it to the SMF.\n17.\tIf the PCC rule indicates DNS resolved traffic detection and the SMF is notified the packet detection associated with the FQDN-based template from the UPF, the SMF notifies the DNS resolved traffic detection to the SM-PCF.\n18.\tThe SM-PCF notifies the notification address of the UE-PCF of the DNS resolved traffic detection received from the SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.32.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE-PCF (The PCF for the UE):\n-\tThe UE-PCF is able to utilize the SM-PCF service for FQDN-based application detection.\nSM-PCF (The PCF for the Session):\n-\tThe SM-PCF is required to support the notification and PCC rules for FQDN-based application detection.\n-\tThe SM-PCF is required to understand the proposed FQDN-based service data flow filter with DNS reporting indication and DNS resolved traffic detection options.\nSMF:\n-\tThe SMF is required to support the PCC rules indicating FQDN-based application detection identified FQDN-based SDF template.\n-\tThe SMF is required to understand the proposed FQDN-based service data flow filter with DNS reporting indication and DNS resolved traffic detection options.\n-\tThe SMF is required to generate and update the DNS message handling rule using FQDN-based service data flow template.\n-\tThe SMF is required to report the DNS message reporting to the SM-PCF if the DNS reporting option is indicated in the PCC rules.\n-\tThe SMF is required to update N4 rules with the UPF based on the reporting from the EASDF and report the DNS resolved traffic detection to the SM-PCF if DNS resolved traffic detection option is indicated in the PCC rules.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.33\tSolution #33: Consistent URSP Provisioning across 5GS and EPS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.33.1\tDescription",
                            "text_content": "This solution addresses KI#3.\nWith regard to the scenarios and gaps (first two bullets in the KI#3), if a UE has used the Route Selection component (e.g. DNN) in a URSP rule in EPS and the Route Selection component (e.g. DNN) has been changed when the UE stays in EPS, the updated URSP rule needs to be provisioned to UE in EPS, otherwise the UE in EPS may use outdated DNN to establish PDN connection in EPS. In 5GS the UE may be provisioned with URSP rules for both 5GS and EPS by the PCF of the HPLMN. Only the rules provisioned by the PCF are used by the UE, if both URSP rules provisioned by the PCF and pre-configured URSP rules are present. The URSP rules are provisioned in UE using NAS messages. The AMF transparently transfers the UE Policy container (UE policy information) received from the PCF to the UE (using DL NAS TRANSPORT message). The UE Policy container includes the list of Policy Sections as described in TS 23.503 [4]. Similar mechanism can be used to provision URSP rules in EPS.\nFor the pre-Rel-18 UE, when it's attached to EPC, even if the UE-PCF provisions/updates the URSP rule to it, it will silently discard the URSP rule in the ePCO since the new ePCO cannot be recognized by the pre-Rel-18 UE. In order to avoid unnecessary signalling overload for URSP provisioning/updating for pre-Rel-18 UE,UE-PCF needs to be aware whether a UE supports the URSP Provisioning in EPS or not.\nTo realize provisioning of consistent URSP rules in UE, this solution follows the below two principles:\n1)\tThe same set of URSP is provisioned to UE regardless of UE attaching to EPS or registering to 5GS.\n2)\tThe UE in EPS uses the components in RSD of a URSP rule according to Rel-16 specification defined in clause 5.17.1.2 of TS 23.501 [2].\nThe EPS and 5GS interworking architecture defined in TS 23.501 [2] is reused, the solution addresses both the collocated and separate SM-PCF and UE-PCF deployment scenario, N7 interface is reused to provision URSP from SM-PCF to SMF+PGW-C and no new interface is introduced. The solution proposes a mechanism for the network to provision and update the URSP for a UE in EPS by encapsulating UE Policy Container in ePCO via one of the PDN connections. The UE Policy Container is transparently forwarded via SMF+PGW-C. The communication between SMF+PGW-C and SM-PCF reuses the SM Policy Association procedures.\nWhen a UE attaches initially in EPC or when the UE handovers from 5GC to EPC, UE-PCF may need to update the URSPs in the UE:\n-\tDuring Initial attach procedure in EPS due to for example:\n-\tNew AF guidance on URSP request applicable to the UE was sent by an AF while the UE is deregistered and prior to the EPC attach procedure, so the corresponding URSP rules were not delivered yet to the UE.\n-\tOperator policies configured with time, location or any other condition are met when the UE attaches to EPC, implying new or updated URSP rules apply under those conditions.\n-\tOperator policies for determining URSPs were updated by the operator while the UE is deregistered and prior to the EPC attach procedure, so the corresponding URSP rules were not delivered yet to the UE.\n-\tAt any time a URSP is changed while the UE is registered in EPC (coming from EPC initial attachment or after handover from 5GC) due to for example:\n-\tNew AF guidance on URSP request applicable to the UE is sent by an AF.\n-\tDue to time, location change or other network condition the PCF determines that an operator policy configured for the operator for URSP determination applies in the new network conditions, implying new or updated URSP rules apply to the UE.\nThe solution in this paper proposes a mechanism that allows the network to update the URSPs for a UE in EPC, by encapsulating UPDP messages into a new ePCO parameter (from now on UE Policy Container ePCO) and transfer them to the UE via PDN connection.\nThe solution assumes the same protocol (UPDP protocol) for URSP Provisioning between the PCF and the UE than in 5GC, although the final decision on this is up to stage 3.\nThe mechanism reuses the existing capability of the EPC network for sending ePCO from the UE to the SMF+PGW-C (and vice versa) and in addition it proposes a way to transport the UE Policy Container from the SMF+PGW-C to the PCF (and vice versa) based on reusing existing PDU session procedures.\nFor the delivery of URSPs to UEs in EPC, this solution assumes the standard solution for interworking architecture between EPC and 5GC as described in TS 23.501 [2].\nWhen the PCF needs to send a UE Policy update towards the UE in EPC, it invokes a SM Policy Association Modification including the corresponding UPDP message into a new IE (UE Policy Container) in the N7 interface. When the SMF+PGW-C receives this new IE the SMF+PGW-C encapsulates it into UE Policy Container ePCO and transfers them to the UE by using existing procedure of PDN GW initiated bearer modification without bearer QoS update as defined in clause 5.4.3 of TS 23.401 [8].\nWhen the UE in EPC needs to send a UPDP message towards the UE-PCF in relation to UE Policy handling the UE first encapsulates the UPDP message into a UE Policy Container ePCO and then transfers it towards the SMF+PGW-C by reusing existing mechanisms. When the SMF+PGW-C receives such UE Policy Container ePCO from the UE, just forwards transparently the UE Policy Container towards the PCF by reusing SMF initiated SM Policy Association procedure (establishment or modification).\nThe solution also proposes that the UE has to be able to handle the reception of such UPDP messages received over EPC NAS signalling in a similar way than when received over 5GC NAS signalling in 5GC.\nIn addition, for those events happening in PCF which may trigger the sending of a URSP update for a UE (as described in clause 6.33.1.1), the PCF will check if the UE is currently in EPC, and if so will use one of these PDU sessions to trigger the delivery of the URSP updates, by invoking PCF initiated SM Policy Association modification procedure including the proper UE Policy Container.\nDuring initial Registration procedure, the UE needs to indicate its URSP Provisioning Support Indication in EPS in the 5GMM Capability to AMF.\nIf the AMF knows that the UE supports URSP Provisioning in EPS and target EPC supports URSP provisioning to UE, the AMF doesn't terminate the UE Policy Association with UE-PCF and sends the UE Policy Association information for EPS (i.e. URSP Provisioning Support Indication in EPS, UE-PCF ID in 5GS, PCRTs) to MME during mobility (i.e. Handover, Idle mode mobility) from 5GS to EPS with N26.\nThe PCRTs (Policy Control Request Trigger) for UE Policy include Location change (tracking area), Change of UE presence in Presence Reporting Area, Connectivity stage changes. The MME enforces the received PCRTs for UE Policy.\nWhen the MME receives the URSP Provisioning Support Indication in EPS, it creates a UE Policy Container for the UE including only the indication of MME Created UE Policy Container for 5GS to EPS Mobility and selects one of the PDN Connections serving the UE to establish the UE Policy association between SM-PCF and UE-PCF. The UE Policy Container and UE-PCF ID are included in the Modify bearer Request message sent to SGW and SMF+PGW-C.\nWhen the SMF receives the UE Policy Container, it initiates SM Policy Association Modification procedure by sending Npcf_SMPolicyControl_Update request to SM-PCF including UE-PCF ID and UE Policy Container.\nBased on the received UE-PCF ID, the SM-PCF knows it's a request for updating the UE Policy Association with UE-PCF identified by UE-PCF ID. The SM-PCF sends a Npcf_UEPolicyControl_Update request including the UE Policy Container to UE-PCF to modify the UE Policy Association for the UE.\nBased on the indication of MME Created UE Policy Container, the UE-PCF knows it's an MME initiated UE Policy Association update procedure after mobility from 5GS to EPS and updates the UE Policy Association with SM-PCF. For any subsequent URSP update, the UE-PCF contacts with SM-PCF.\nThe UE-PCF may notify the AMF of the removal of the UE Policy Association via Npcf_UEPolicyControl_UpdateNotify service operation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.33.2\tProcedures",
                            "text_content": "For all pre-Rel-18 UEs, it would be impossible to provision/update the URSP to them since the new ePCO cannot be recognized by pre-Rel-18 UEs attached to EPC. Provisioning/updating URSP to pre-Rel-18 UEs in EPC will cause unnecessary signalling overload. Thus, the UE-PCF needs to be aware whether a UE supports the URSP Provisioning in EPS or not.\nFor the cases that PDN Connectivity Request is sent by UE (i.e. Initial Attach procedure, UE requested PDN connectivity procedure, 5GS to EPS Mobility procedure without N26), the UE reports the UE Policy Container including URSP Provisioning Support indication in EPS in ePCO.\nFigure 6.33.2.1-1 illustrates the UE Policy provisioning procedure with explicit URSP Provisioning Support Indication in EPS. The figure depicts the process of policy provisioning, starting with the UE sending a Policy Request to the Network Server. The Network Server then checks the policy database and sends an Indication of Policy Provisioning Result back to the UE. This process ensures that the UE is correctly provisioned with the appropriate policies, such as data rates and access types, based on its requirements and the network's capabilities. The figure highlights the importance of accurate policy provisioning for efficient network management and optimal user experience.\nFigure 6.33.2.1-1: UE Policy provisioning procedure with explicit URSP Provisioning Support Indication in EPS\n1.\tThe UE sends the UE Policy Container including URSP Provisioning Support indication in EPS which is indicating whether a UE supports URSP Provisioning or not in EPS (defined in clause 5.17.1.2 of TS 23.501 [2]) and the PSIs (Policy Set Identifier) in ePCO (extended PCO) to SMF+PGW-C during Initial Attach procedure (in the Attach Request) as described in clause 5.3.2.1 of TS 23.401 [8] or the UE requested PDN connectivity procedure (PDN Connectivity Request) as described in clause 5.10.2 of TS 23.401 [8].\n2.\tThe SMF+PGW-C transparently forwards the UE Policy Container in ePCO to the SM-PCF as a new IE in the PDU Session Establishment (Npcf_SMPolicyControl_Create Request).\nNOTE 1:\tIf the PCF involvement for a PDN connection is not required, the SMF+PGW-C should still establish SM Policy Association with SM-PCF and forward the UE Policy Container to SM-PCF based on local configuration.\n3.\tThe SM-PCF establishes the UE Policy Association with UE-PCF when a UE Policy Container is received from the UE and forwards the UE Policy Container to UE-PCF in Npcf_UEPolicyControl_Create Request. When a UE Policy Container is received at initial registration, the UE-PCF stores the URSP Provisioning Support indication in EPS in the UDR using Nudr_DM_Create including DataSet \"Policy Data\" and Data Subset \"UE context policy control data\".\nNOTE 2:\tUE-PCF is discovered and selected according to clause 6.3.7.1 of TS 23.501 [2].\n4.\tThe UE-PCF gets policy subscription related information and the updated list of PSIs from the UDR. The UE-PCF creates the UE policy container including UE policy information as defined in clause 6.6 of TS 23.503 [4]. Then it sends the latest UE policy information in the UE Policy Container to SM-PCF in Npcf_UEPolicyControl_Create Response.\n5.\tThe SM-PCF forwards the UE Policy Container to the SMF+PGW-C in Npcf_SMPolicyControl_Create Response.\n6.\tThe SMF+PGW-C sends the UE Policy Container in ePCO to UE in Activate Default EPS Bearer Context message which may be encapsulated in Attach Accept message.\n7.\tThe UE sends a response to SMF+PGW-C by acknowledging the reception of the UE Policy reusing existing messages (e.g. Attach Complete, Modify Bearer Request) as defined in clause 5.3.2 of TS 23.401 [8].\n8.\tThe SMF+PGW-C forwards the acknowledgement of UE reception of the UE Policy to SM-PCF using Npcf_SMPolicyControl_Update request.\n9.\tThe SM-PCF forwards the acknowledgement of UE reception of the UE Policy to UE-PCF using Npcf_UEPolicyControl_Update request.\nFor the cases that PDN Connectivity Request is not sent by UE in EPS (i.e. 5GS to EPS handover using N26 interface, 5GS to EPS Idle mode mobility using N26 interface), UE reported URSP Provisioning Support indication in EPS during 5GS Registration procedure can be used by UE-PCF to determine whether to provision URSP to UE in EPS. This requires the UE to include the URSP Provisioning Support indication in EPS in the UE Policy Container in the initial Registration Request message.\nFigure 6.33.2.1-2 illustrates the initial registration process in a 5G network, focusing on the interaction between the network equipment and the user equipment (UE). The figure depicts the process of UE discovery, where the UE scans for available networks and selects the most suitable one based on factors such as signal strength and network capacity. Once the UE has been successfully registered, it is assigned an IP address and can begin communicating with other devices on the network. The figure also shows the role of the network equipment, including the base station (gNB) and the home subscriber station (HSS), in facilitating this process.\nFigure 6.33.2.1-2: Initial Registration in 5GS\n1.\tIn the Registration Request message, the UE reports the URSP Support indication in EPS in the UE Policy Container to AMF.\nIn order to allow the AMF to be aware of UE’s Capability of URSP Provisioning Support in EPS, the UE needs to include the URSP Provisioning Support indication in EPS in the 5GMM Capability in the Registration Request message. This indication will be used by AMF to determine whether to terminate the UE Policy Association for the UE and whether to send the UE Policy Association information to MME during 5GS to EPS mobility with N26. The AMF stores the URSP Provisioning Support indication in EPS as part of the MM Context.\n2.\tAMF establishes UE Policy Association with UE-PCF and forwards the UE Policy Container to UE-PCF. The UE-PCF stores the URSP Provisioning Support indication in EPS in the UDR using Nudr_DM_Create including DataSet \"Policy Data\" and Data Subset \"UE context policy control data\".\n3.\tThe UE Configuration Update procedure for transparent UE Policy delivery as defined in clause 4.2.4.3 of TS 23.502 [3].\nFor the procedure for URSP update initiated by the PCF when the UE is in EPC, the procedure follows the steps described in the figure below:\nFigure 6.33.2.2-1 illustrates the process of provisioning User-Rate Signaling Procedure (URSP) in Packet-Mode Control Function (PCF) triggered by an external event. The figure depicts the sequence of events and interactions between different components, including the PCF, External Control Function (ECF), and the underlying network infrastructure. The process begins with the ECF initiating the URSP provisioning request, which is then received by the PCF. The PCF processes the request and sends a response back to the ECF. The figure also shows the role of the underlying network infrastructure in supporting the provisioning process, including the use of signaling protocols and the management of network resources. Overall, the figure provides a clear and detailed overview of the PCF-triggered URSP provisioning procedure, highlighting the key components and interactions involved in the process.\nFigure 6.33.2.2-1: PCF triggered URSP provisioning procedure\n1:\tAn event as described in clause 6.33.1.1 happens in UE-PCF. The UE-PCF triggers the re-evaluation of applicable URSPs for the UE and determines an update of URSP is needed for the UE.\n2:\tThe UE-PCF generates the URSP and send it to SM-PCF in the UE Policy Container via Npcf_UEPolicyControl_UpdateNotify Request.\nNOTE 1:\tIt is assumed the UE Policy Association has been established and is maintained between the SM-PCF and UE-PCF after initial attach or 5GS to EPS mobility.\n3:\tThe UE Policy Container is then provided to the SMF+PGW-C by invoking Npcf_SMPolicyControl_UpdateNotify request.\nNOTE 2:\tIt is assumed the SM Policy Association has been established and is maintained between SMF and SM-PCF after initial attach or 5GS to EPS mobility.\n4, 5, 6:\tThe SMF+PGW-C initiates a bearer modification procedure without bearer QoS update (as defined in clause 5.4.3 of TS 23.401 [8]) to provide the UE Policy Container in ePCO towards the UE.\n7:\tWhen the UE gets the UE Policy Container in ePCO, the UE processes that message in a similar way as it is received in 5GC, i.e. stores the URSP updates, optionally re-evaluates the mapping of applications into PDN connections according to the mapping of URSP values into EPC, and achknowledges the delivery result in UE Policy Container to the MME.\n8, 9:\tThese steps follow the existing procedure defined for Update Bearer Response.\n10:\tUpon reception of UE Policy Container in ePCO in Update Bearer Response, the SMF+PGW-C then invokes Npcf_SMPolicyControl_Update Request including the content of the UE Policy Container in ePCO.\n11:\tThe SM-PCF forwards the UE Policy Container to UE-PCF via Npcf_UEPolicyControl_Update request.\nFigure 6.33.2.3-1 illustrates the 5GS to EPS handover process in single-registration mode with N26 interface, as defined in clause 4.11.1.2.1 of TS 23.502 [3]. The figure depicts the seamless transition of a 5G user's connection from the 5GS network to the Evolved Packet System (EPS) network, ensuring uninterrupted service. The diagram highlights the role of the Network Switching Subsystem (NSS) and the Network Exposure Subsystem (NES) in managing the handover process, ensuring a smooth and efficient transition for the user.\nFigure 6.33.2.3-1: 5GS to EPS handover for single-registration mode with N26 interface defined in clause 4.11.1.2.1 of TS 23.502 [3]\nIn the Relocation Request message of step 3, the AMF includes the UE Policy Association information (i.e. URSP Provisioning Support Indication in EPS, UE-PCF ID selected in 5GS, PCRTs). MME stores this information.\nNOTE:\tThe PCRTs (Policy Control Request Trigger) include Location change (tracking area), Change of UE presence in Presence Reporting Area, Connectivity state changes.\nIn step 13 and 14a, MME selects one of the PDN Connections serving the UE to establish the UE Policy association between SM-PCF and UE-PCF. The MME creates and includes a UE Policy Container for UE including only the indication of MME Created UE Policy Container for 5GS to EPS Mobility in the Modify bearer Request. UE-PCF ID is also included in Modify bearer Request message.\nFigure 6.33.2.4-1 illustrates the process of 5GS transitioning to EPS Idle mode using the N26 interface, as defined in clause 4.11.1.3.2 of 23.502 [3]. The figure depicts the various stages of the mobility process, including the initial connection setup, the handover to a new network, and the final idle state. Key components include the 5GS, EPS, and N26 interface, which work together to ensure seamless and efficient mobile communication. The figure highlights the importance of precise timing and coordination between these elements to maintain a high level of service quality and reliability.\nFigure 6.33.2.4-1: 5GS to EPS Idle mode mobility using N26 interface defined in clause 4.11.1.3.2 of 23.502 [3]\nIn the Context Ack message of step 8, the AMF includes the UE Policy Association information (i.e. URSP Provisioning Support Indication in EPS, UE-PCF ID selected in 5GS, PCRTs for UE Policy). MME stores the UE Policy Association information.\nIn step 9 and 10, MME selects one of the PDN Connections serving the UE to establish the UE Policy association between SM-PCF and UE-PCF. The MME creates and includes a UE Policy Container for UE including only the indication of MME Created UE Policy Container for 5GS to EPS Mobility in the Modify bearer Request. UE-PCF ID is also included in Modify bearer Request message.\nFigure 6.33.2.5-1 illustrates the process of SM (Serving Mobility Management) Policy and UE (User Equipment) Policy Association updates after 5GS (5th Generation System) to EPS (Evolved Packet System) mobility. The figure showcases the interaction between the SM and UE policies, highlighting the role of the SM-EPS Bearer in managing the association between the user equipment and the network. The figure emphasizes the importance of seamless handover and efficient resource allocation in maintaining high-quality communication services during user mobility.\nFigure 6.33.2.5-1: SM Policy and UE Policy Association update after 5GS to EPS mobility\n1.\tWhen the SMF receives the UE Policy Container or URSP Provisioning Support Indication in EPS, it initiates SM Policy Association Modification procedure by sending Npcf_SMPolicyControl_Update request to SM-PCF including UE-PCF ID, the UE Policy Container.\n2.\tBased on the UE-PCF ID, the SM-PCF knows it's a request for establishing UE Policy Association with UE-PCF. The SM-PCF sends a Npcf_UEPolicyControl_Update request to UE-PCF including the UE Policy Container to modify the UE Policy Association for the UE.\n3.\tFrom the Indication of MME Created UE Policy Container, the UE-PCF knows it's an MME initiated UE Policy Association update procedure after mobility from 5GS to EPS and updates the UE Policy Association with SM-PCF. For any subsequent URSP update, the UE-PCF contacts with SM-PCF. The UE-PCF responds to SM-PCF with Npcf_UEPolicyControl_Update Response.\n4.\tThe SM-PCF responds to SMF with Npcf_SMPolicyControl_Update Response.\nWhen the UE moves from EPS to 5GS, UE Policy Association Establishment procedure will be initiated. When UE-PCF detects that a UE Policy Association for the UE exists in EPS, the UE-PCF will initiate the UE Policy Association Termination procedure to terminate the UE Policy Association in EPS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.33.3\tImpacts on services, entities and interfaces",
                            "text_content": "N7: Introduce additional IE for the transfer of UE Policy Container between SMF+PGW-C and SM-PCF.\nNAS, S11, S5/S8: Introduce new parameter UE Policy Container in ePCO.\nImpact on SM-PCF:\n-\tHandling of UE Policy Container within SM Policy Association and UE Policy Association procedures.\n-\tFor those cases where PCF initiates the sending of URSP update for a UE in EPC, the triggering of SM Policy Association modification including the new IE with MANAGE UE POLICY COMMAND UPDP message.\nImpact on UE-PCF:\n-\tHanding the URSP Provisioning Support indication in EPS and stores it into UDR.\n-\tBased on the URSP Provisioning Support indication in EPS, determines whether to provision UE with URSP when the UE is in EPS.\n-\tFor those cases where PCF initiates the sending of URSP update for a UE in EPC, the triggering of UE Policy Association modification with SM-PCF.\nImpact on SMF+PGW-C:\n-\tUpon reception of UE Policy Container ePCO in Create Session Request, the SMF+PGW-C forwards the UE Policy Container to the PCF at SM Policy Association establishment. Use the reception of UPDP Container as an additional reason to establish the SM Policy Association, even in case the network configuration for the APN of the PDN connection does not require PCF involvement.\n-\tUpon reception of UE Policy Container from SM-PCF during SM Policy Association initiated by UE-PCF, SMF+PGW-C performs a Bearer Modification Procedure without bearer QoS update including the UE Policy Container ePCO.\n-\tUpon reception of Update Bearer Response from MME including UE Policy Container ePCO, the SMF+PGW-C forwards the received UE Policy Container to PCF.\nImpact on UE:\n-\tDuring initial attach in EPS, the UE includes UE STATE INDICATION UPDP message into UE Policy Container ePCO in PDN Connectivity Request encapsulated in Attach Request.\n-\tThe UE receives MANAGE UE POLICY COMMAND in UE Policy Container ePCO during EPS Bearer Context Request and process it as in 5GC. The UE generates MANAGE UE POLICY COMPLETE UPDP message and send it to the MME encapsulated into a UE Policy Container ePCOin EPS Bearer Context Response.\n-\tThe UE also needs to include the URSP Provisioning Support indication in EPS in the UE Policy Container.\n-\tDuring initial Registration in 5GS, the UE includes the URSP Provisioning Support indication in EPS in both 5GMM Capability and the UE Policy Container.\nImpact on AMF:\n-\tReceives and stores the URSP Provisioning Support indication in EPS as part of the MM Context;\n-\tSends the UE Policy Association information to MME.\nImpact on MME:\n-\tReceives and stores the UE Policy Association information (i.e. URSP Provisioning Support Indication in EPS, UE-PCF ID selected in 5GS, PCRTs for UE Policy) from AMF;\n-\tCreates a UE Policy Container for UE including only the indication of MME Created UE Policy Container for 5GS to EPS Mobility.\n-\tIncludes the UE Policy Container and UE-PCF ID in Modify bearer Request message sent to SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.34\tSolution #34: Provisioning UE policy in EPS via N3IWF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.34.1\tDescription",
                            "text_content": "This solution addresses the Key Issue#3 'Provision consistent URSP to UE across 5GS and EPS'.\nWhen the UE is in EPS, the UE may use the route selection component (e.g. DNN) in a URSP rule to derive EPS parameters for PDN connection. Note that:\na)\tIf UE keeps connectivity with 5GS, then the UE Policy can be updated via 5GS; and\nb)\tIf UE does not need to use URSP in EPS, there is no need for UE to update the policy.\nThus, the UE updates UE policy in EPS only when it is going to use URSP to derive EPS parameters.\nA solution (i.e. access 5GS via N3IWF) is proposed in this paper, which follows the two principles:\na)\tminimize the impact on network and UE, reuse the existing mechanism only if the non-3GPP access is supported; and\nb)\tno restriction for whether UE has registered in 5GS or not.\nGiven that if UE has not registered to 5GS, then the UE does not have any serving NF (e.g. AMF, UDM). In this case, if the 5GS wants to updates UE policy for UE in EPS, 5GS needs to temporarily establish 5G connections for UE to update UE policies. On the other hand, if there is no 5GS access, in order to support deliver the URSP rules to the UE in EPS, it has a huge impact to the current design of 5GS.\nBesides, even if the UE has registered in 5GS, whether AMF or UE-PCF would keep the UE context is not ensured. The AMF can implicitly detach the UE upon reachability time-out.\nThe registration via untrusted non-3GPP access as described in clause 4.12.2.2 of TS 23.502 [3] and procedure for UE Policy Association Establishment or Modification procedure as described in clauses 4.16.11 or 4.16.12 of TS 23.502 [3] is reused for provisioning UE policy to UE via N3IWF. No extra new signalling or interface is required in this solution.\nThis solution relies on the scenario that the operator deploys the N3IWF and the UE can register to N3IWF via non-3GPP access.\nEditor's note:\tIt is FFS on how to update the URSP from AM-PCF to UE in case the UE has URSP and doesn't register to 5GS via N3WIF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.34.2\tProcedures",
                            "text_content": "Figure 6.34.2-1 illustrates the procedure initiated by the User Equipment (UE) in the Evolved Packet System (EPS) for policy delivery. The figure depicts the process flow from the UE to the Policy and Charging Rules Function (PCRF), which evaluates the policy against the UE context. The PCRF then forwards the policy to the Home Location Register (HLR) for further processing. The HLR communicates with the Policy and Charging Rules Function (PCRF) Gateway (PCRFGW) to ensure accurate policy application. This process ensures that the correct policies are applied to the UE, facilitating efficient resource management and accurate billing in the network.\nFigure 6.34.2-1: UE Policy delivery procedure initiated by the UE in EPS\nThe detailed steps of the procedure are defined below:\n1:\tThe UE needs to use URSP in EPS to derive EPS parameters. This may happen when UE is performing an initial attach procedure as described in clause 5.3.2.1 of TS 23.401 [8], interworking procedures from 5GS to EPS as described in clause 4.11 of TS 23.502 [3], or when UE is going to use URSP to derive EPS parameters (e.g. when UE performs the requested PDN connectivity) or when UE is expected to receive the updated URSP rules.\nThe UE shall indicate its N1 mode capability, and provides a native 4G-GUTI or a 4G-GUTI mapped from 5G GUTI (indicated as native GUTI), if available, otherwise the IMSI in Attach Request message in its initial attach procedure.\nThe HSS selects one of the SMF+PGW-C FQDN for one APN based on operator's policy. The MME may indicate HSS to select a SMF+PGW-C FQDN based on the UE identity (e.g. a 4G-GUTI mapped from 5G GUTI).\n2:\tSMF+PGW-C may send N3IWF selection info to the UE in ePCO during step 1 in using existing messages (e.g. Activate Default EPS Bearer Context message, DOWNLINK NAS TRANSPORT message). The N3IWF selection info contains the following info:\n1)\tN3IWF identifier configuration (either FQDN or IP address); and\n2)\tAccess node selection information consists of a prioritized list of PLMNs for N3IWF selection and an indication that the selection of an N3IWF in a PLMN should be based on Tracking Area Identity FQDN or on Operator Identifier FQDN.\n3:\tWhen the default PDN connection is established, the UE performs Registration via untrusted non-3GPP access as described in clause 4.12.2.2 of TS 23.502 [3]. If PCF determines to update UE policy, it will trigger a UE Policy Association Establishment procedure as described in clause 4.16.11 of TS 23.502 [3] during step 3.\n4:\tAny time PCF needs to update the UE policy, it triggers a UE Policy Association Modification as described in clause 4.16.12 of TS 23.502 [3] via N3IWF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.34.3\tImpacts on services, entities and interfaces",
                            "text_content": "UE:\n-\treceive the N3IWF selection info via ePCO.\n-\tUE needs to simultaneously register to 5GS via non-3GPP access through N3IWF and attach to EPS.\nSMF+PGW-C:\n-\tsend the N3IWF selection info via ePCO.\nMME:\n-\tindicate UDM to select a collocated SMF+PGW-C node.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.35\tSolution #35: Support standardized and operator-specific traffic categories using existing URSP traffic descriptors",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.35.1\tDescription",
                            "text_content": "3GPP CT1 has agreed operator specific values for the Connection Capabilities traffic descriptor, with a specific meaning and association to slices only within the MNO domain.\nAt the same time, the LS received from GSMA, S2-220365, indicates that the traffic categories agreed are accommodating connectivity requirements that are shared by different applications traffic, being those categories the following:\n-\tIMS traffic.\n-\tInternet.\n-\tIoT and machine to machine type of traffic.\n-\tOn demand downlink streaming.\n-\tOn demand uplink streaming.\n-\tVehicular communications.\n-\tReal time interactive traffic.\n-\tUnified communications traffic.\n-\tBackground traffic.\n-\tLocation-based traffic.\n-\tCritical Communications.\nThis solution makes use of Connection Capabilities traffic descriptor to support the list of GSMA agreed categories, so that both standard and operator specific categories are dealt with in the same descriptor.\nAlthough encoding of the Connection Capabilities is a stage 3 decision, the following is an example how to code it:\nBits\n8 7 6 5 4 3 2 1\n0 0 0 0 0 0 0 1\tIMS\n0 0 0 0 0 0 1 0\tMMS\n0 0 0 0 0 0 1 1\tSUPL\n0 0 0 0 0 1 0 0\tInternet\n0 0 0 0 0 1 0 1\tIoT and M2M traffic\n0 0 0 0 0 1 1 0\tOn demand downlink streaming\n0 0 0 0 0 1 1 1\tOn demand uplink streaming\n0 0 0 0 1 0 0 0\tVehicular communications\n0 0 0 0 1 0 0 1\tReal time interactive traffic\n0 0 0 0 1 0 1 0\tUnified communications traffic\n0 0 0 0 1 0 1 1\tBackground traffic\n0 0 0 0 1 1 0 0\tLocation-based traffic\n0 0 0 0 1 1 0 1\tCritical communications\n0 0 0 0 1 1 1 0\nTo\t\tAvailable for further standard capabilities\n0 0 0 1 1 1 1 1\n0 0 1 0 0 0 0 0\nTo\t\tOperator specific connection capabilities\n0 0 1 1 1 1 1 1\n1 0 0 0 0 0 0 0\nTo\t\tSpare values\n1 1 1 1 1 1 1 1\n\n\nAn application can indicate it belonging to a specific category in its request, or for some application implementations the OS may know the application category without explicit signalling from the application. The URSP layer then matches this with the Connection Capability Traffic Descriptor of the URSP rule.\nA single application may indicate different categories in different requests, for example, an application may indicate real time interactive traffic for a gaming session while it may indicate an operator specific capability for a different session.\nAny URSP rule can contain a Connection Capabilities TD (to be matched with the traffic category) together with any other descriptor; e.g. it may include an AppID in addition to the category, or a DNN and a category, or any other descriptor together with the category. The UE shall then need to match all the Traffic Descriptors of the URSP rule.\nA given traffic category can be simultaneously used by multiple applications.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.35.2\tProcedures",
                            "text_content": "When an application attempts to initiate a session, it may indicate it belongs to a specific traffic category. The traffic category requested by an application may be either a traffic category as agreed by GSMA or a value that is specified by the MNO.\nThe URSP layer then uses the application indication of a traffic category, either as the only indication, or accompanied by other information like AppID, DNN, etc, depending on the URSP rules.\nNOTE 1:\tA traffic category for an application can be accompanied by other indication in scenarios where the operator has agreements with the Application Service Providers to generate the URSP.\nNOTE 2:\tThe use of traffic categories does not preclude that other traffic descriptors are used alone to be matched with a given URSP rule.\nThe URSP layer shall then scan the URSP rules configured by the MNO to find the matching rule containing the Connection Capabilities traffic descriptor matching the traffic category indicated by the application/OS layer. If the URSP rules contain a Connection Capability Traffic Descriptor together with another descriptor, the URSP layer shall then need to find the matching rule containing a traffic descriptor listing the same components.\nOperator-specific traffic categories can be supported by defining MNO specific values within the Connection Capabilities Traffic Descriptor. It is assumed that the application and/or OS layer in the UE supports providing MNO specific traffic categories to the URSP layer. The type of MNO traffic category is transparent to the OS layer\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.35.3\tImpacts on services, entities and interfaces",
                            "text_content": "The solution has the following impacts:\nPCF:\n-\tPCF shall support the new values for the Connection Capabilities traffic descriptor in the URSP rules.\nUE:\n-\tUE shall support indications of traffic category from the application and match it with the Connection Capabilities component in the Traffic Descriptor provided as part of the URSP rule.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.X\tSolution #X: <Solution Title>",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.X.1\tDescription",
                            "text_content": "Editor's note:\tThis clause will describe the solution principles and architecture assumptions for corresponding key issue(s) which should be explicitly stated. (Sub) clause(s) may be added to capture details.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.X.2\tProcedures",
                            "text_content": "Editor's note:\tThis clause describes high-level procedures and information flows for the solution.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.X.3\tImpacts on services, entities and interfaces",
                            "text_content": "Editor's note:\tThis clause captures impacts on existing 3GPP nodes and functional elements.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tOverall Evaluation",
            "description": "Editor's note:\tThis clause will provide evaluation of different solutions.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tEvaluation of solutions to KI#1",
                    "description": "",
                    "summary": "",
                    "text_content": "The KI description listed the following issues to be resolved:\n-\tWhether and how to support URSP enhancements to support routing of the application traffic with different URSP rules in different PLMNs.\n-\tWhether the HPLMN needs any information from the VPLMN to generate URSP Rules in roaming. If so, which information and how to provide it.\n-\tHow to provide URSP Rules in roaming to the UE. How the HPLMN and VPLMN are involved in such procedure.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.1.1\tHow to identify PLMN specific URSP Rules",
                            "text_content": "This is related to the following description in KI#1: \"Whether and how to support URSP enhancements to support routing of the application traffic with different URSP rules in different PLMNs.\"\nThere are different solutions:\na)\tThe RSD is extended to include the PLMN ID(s) as validation criteria, a URSP Rule can contain RSD for different PLMN ID(s). (Solution#2, #4 and #29).\nb)\tThe Traffic Descriptor in the URSP Rule is extended to include the PLMN ID.(Solution#3).\nc)\tThe PCF provides a list of PSIs associated to the HPLMN and a list of PSIs associated to each of the VPLMN with roaming agreements. (Solution#6).\nd)\tNo extensions to the RSD or URSP rule. The PCF provides the URSP Rules and RSD components that are applicable in the VPLMN where the UE is registered and removes them when the UE deregisters. (Solution#1, #2, #3 and 5).\nTable 7.1-1: Evaluation of solutions on how to identify VPLMN specific URSP Rules evaluates solutions listing the benefits and drawback, any open issue that makes the solution complete and the system impact.\nTable 7.1-1: Evaluation of solutions on how to identify VPLMN specific URSP Rules\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.1-1: Evaluation of solutions on how to identify VPLMN specific URSP Rules",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.1.2\tWhich PLMN determines the VPLMN specific URSP Rules",
                            "text_content": "-\tWhether the HPLMN needs any information from the VPLMN to generate URSP Rules in roaming. If so, which information and how to provide it.\n-\tHow to provide URSP Rules in roaming to the UE. In particular, how the HPLMN and VPLMN are involved in such procedure.\nThis is related to the following description in KI#1: \"How to provide URSP Rules in roaming to the UE. In particular, how the HPLMN and VPLMN are involved in such procedure\" and \"Whether the HPLMN needs any information from the VPLMN to generate URSP Rules in roaming. If so, which information and how to provide it\".\nTable 7.1-2: Evaluation of solutions on how to identify VPLMN specific URSP Rules evaluates solutions listing the benefits and drawback, any open issue that makes the solution complete and the system impact.\nTable 7.1.2-1: Evaluation of solutions on which PLMN determines the VPLMN specific URSP Rules\n\nTable 7.1.2-2\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.1.2-1: Evaluation of solutions on which PLMN determines the VPLMN specific URSP Rules",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2-2",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "7.2\tEvaluation on Solutions for KI#2",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 7.2-1: Summary of solutions for KI#2\n\nSome of the solutions, Sol#12, #13, #31 states that the network ensures that the application traffic sent by the UE in a PDU Session established according to the URSP Rule is treated according to the SLA, e.g. ensuring that the application traffic is routed over a slice for GBR services. For that the PCF provisions PCC Rule to the SMF to provide Session Management policies for the Traffic Descriptors sent in the URSP Rule.  This process is applicable to preconfigured URSP Rules and those URSP Rules signalled by the UE as proposed in Sol#31.\nObservation 1: There is a need to describe how to ensure that the application traffic sent by the UE is routed over a PDU Session according to SLAs, this will be done using PCC Rules.\nMost of the solution proposes that the UE provides the URSP ID or the URSP Precedence or includes the Application ID in the PDU Session Est. or Modification or in NAS signalling from UE to PCF. This may help the PCF to determine the RSD component that the UE used, potentially validate it and then provide PCC Rules with Session Management policies for the Traffic Descriptors. However, the PCF can also do this determination based on internal logic, such as checking the PDU Session Parameters provided at SM Policy Association Est./Mod. to identify the URSP Rule that the UE enforced.\nObservation 2: The PCF can determine the URSP Rule used by the UE analysing the PDU Session parameters to find the candidate RSD(s) and the Traffic Descriptors. If the UE sends the URSP Rule ID, this will also be used in the process to identify the URSP Rule.\nThere is a mismatch between the SDF template and the Traffic Descriptor, and then some solutions, such as Sol#10 or Sol#32, proposes to configure the SMF with the mapping of a DNN, Connection Capabilities, Domain descriptor to IP descriptors. This can be a solution for some specific DNNs that the operator knows the Application server IP addresses, however if the DNN allows for multiple applications, the list of IP addresses to configure can be quite dynamic and difficult to configure in the SMF. For the Connection Capabilities, given that this identifies the traffic category, it is also difficult to know all the IP address of possible servers that belong to traffic category.\nObservation 3: The PCC Rules include the Application ID or the IP/non-IP descriptor in a SDF template.\nThere are solutions that aim to identify the traffic that was routed not following the URSP Rule to the UE, in order to prevent that Sol#11 proposes that the UE reports to the PCF unsupported values, then the PCF provides URSP Rules with only supported values, this will reduce unnecessary signalling and prevent storing in the UE URSP Rules that are not used or even reject it. A solution using NWDAF to try to identify this traffic and possible ask the UE to send it over a different PDU Session is also proposed in Sol#30.\nObservation 4: NWDAF can be used to identify the unknown traffic, this is also addressed in eNA_Ph2.\nObservation 5: The UE reports unsupported values to the PCF at the time the URSP Rules are provisioned.\n",
                    "tables": [
                        {
                            "description": "Table 7.2-1: Summary of solutions for KI#2",
                            "table number": 22,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.3\tEvaluation on Solutions for KI#3",
                    "description": "",
                    "summary": "",
                    "text_content": "The Key Issue #3 includes three aspects:\n-\t#1: Identify the use cases and scenarios where the UE may need URSP that is consistent across 5GC and EPC.\n-\t#2: Study whether there are any issues and gaps in the existing URSP mapping mechanism described in clause 5.17.1.2 of TS 23.501 [2], if so, identify them and propose solutions.\n-\t#3: Whether, when and how to provision the URSP to UE when served by the EPC and ANDSF is not deployed in the network. For the Rel-15 UEs not supporting the URSP mapping in EPS, whether the URSP updating/provisioning to such UEs in EPS should be supported.\nFor bullet #2, there is only one solution (Solution#17) on the table. For this solution, there is very restricted applicability for the dynamic mapping. EPS only supports SSC mode 1; APN is always equivalent to DNN; The mapping to PDN connection need to follow what 5GS has; and S-NSSAI is not applicable in EPS. For Multi-Access preference, Time window, Location criteria, they are already setting as \"not applicable in EPS\". The only two parameters that may have different mapping settings are Access Type preference and Non-seamless Offload indication. However, there was no identified scenario that requiring setting a value dynamically and differently from the 5G URSP RSD.\nThe advantages in adopting Sol#17 are that there are certain aspects in the URSP that are currently only applicable to 5GS due to the static mapping make the URSPs (RSDs) invalid in EPS. For example: a rule that has an S-NSSAI in its RSD will simply be considered invalid in EPS by the UE as S-NSSAI is not applicable in EPS. With Sol#17 S-NSSAI parameter of the RDS can be simply set as \"to be ignored in EPS\" and hence the rule will be applied identically to EPS. This will ensure URSP rule consistency.\nThe additional advantage of adopting Sol #17 is that we can enable support of certain parameters that currently are not supported in EPS. For example, in FS_eIMS5G2 it is discussed that S-NSSAI may be used in EPS to indicate the IMS slice to be used.\nFor bullet #1 and #3, there are 6 solutions (Solution#16, #18, #19, #20, #33, #34) in total, but solution #18, #19 and #20 have been covered in the consolidated solution #33 (for PCRT handling, #20 is covered by #16), so only three solutions (Sol#16, #33, #34) should be evaluated.\nSolution #34 proposes to provision the URSP to UE in EPS by registering the UE to 5GC via E-UTRAN with N3IWF, which relies on the deployment of N3IWF in 5GC and UE triggering the registration. There are some aspects unclear for this solution:\n-\tIf the URSP update happens before the UE triggers the URSP provisioning request, how does UE-PCF update the URSP rule to UE?\n-\tAccessing to 5GC via N3IWF was defined to use non-3GPP access, while this proposal uses the 3GPP access (E-UTRAN), which was never studied in early releases and may have significant architecture change.\n-\tThe design requires the UE to do dual registration to both EPS and 5GS, it's very questionable in real deployment.\nHowever, Sol #34 has many advantages over Sol#16, #33 and the rest of the solutions that are proposing similar mechanisms. Sol #34 has minimum impact on the network as network operators need to only deploy N3IWF (if not already deployed). There is also minimal impact on the UE to support registering to 5GC via N3IWF using a PDN connection in the EPC as underlay.\nBased on above analysis, it's proposed not to proceed with Solution#34.\nFor Solution#16 and #33, the major parts of the two solutions are same (i.e. using ePCO for URSP Delivery in EPS, relying on UE-PCF to terminate the UE Policy Association during 5GS to EPS mobility, UE indicating the URSP Delivery Support indication in UE Policy Container in Registration Request in 5GS) but with following difference:\n-\tSol#33 requires UE to indicate URSP Support Indication in EPS in the ePCO carried in PDN Connectivity Request message. During mobility from 5GS to EPS with N26,\n-\tSol#33 doesn't require AMF to initiate to terminate the UE Policy Association with UE-PCF, the UE Policy Association can be terminated by UE-PCF after the UE Policy Association is updated by SM-PCF in EPS for the UE, while this solution would require the AMF to be able to differentiate the UE supporting URSP delivery in EPS or not, which means the UE needs to report its capability of URSP Delivery Support Indication in EPS in the MM Capability in Registration Request. Sol#16 doesn't require AMF to initiate to terminate the UE Policy Association with UE-PCF either, but it further proposes the AMF to indicate to UE-PCF to delay the UE Policy Association termination for a configured period, the UE-PCF will remove the UE Policy Association either after the configured period or after receiving the UE Policy Association establishment request from SM-PCF for this UE.\n-\tIn Sol#16, AMF doesn't provide any new information to MME and let SM-PCF determine whether the UE supports URSP delivery in EPC by checking UE context policy control subscription information in UDR. In solution#33, by providing the UE Policy Association information (i.e. URSP Provisioning Support Indication in EPS, UE-PCF ID in 5GS, PCRTs) to MME by AMF, the MME can determine to create a UE Policy Container only including the indication of MME Created UE Policy Container for 5GS to EPS Mobility, based on this indication, the UE-PCF knows it's an MME initiated UE Policy Association update procedure and updates the UE Policy Association with SM-PCF and terminates the UE Policy Association with AMF for this UE. Based on the UE-PCF ID, the SM-PCF knows to select the same UE-PCF serving the UE in 5GS. In order to avoid impact to MME, Sol #16 proposed mechanism can be used as a way forward.\nFor Solution#16 and #33, however there are many drawbacks and technically unclear. For example:\n-\n-\tIt is also not clear what happens if the UE is Dual registered e.g. with a N3IWF and thus already having an UE PCF.\nBased on above analysis on Sol #16 and Sol #33, both solutions work from technical viewpoint to address bullet #1 and #3 for KI #3.\nConclusion Proposal #1: The ePCO based URSP delivery to UE in EPS is selected as baseline mechanism for normative work.\nConclusion Proposal #2: In order to avoid unnecessary signalling overload for the purpose of delivery URSP to pre-Rel-18 UEs in EPS, the UE needs to indicate the URSP Delivery Support Indication in EPS in the UE Policy Container to UE-PCF in EPS and 5GS.\nConclusion Proposal #3: During 5GS to EPS mobility with N26, the AMF doesn't initiate the UE Policy Association termination procedure, instead the AMF will request the UE-PCF to delay the termination of UE Policy Association for a configured period. The UE-PCF can initiate the UE Policy Association Termination procedure either after it receives the UE Policy Association Establishment from SM-PCF or after the configured period.\nConclusion Proposal #4: AMF doesn't provide any new information to MME during 5GS to EPS mobility with N26, the SM-PCF determines whether the UE supports URSP delivery in EPS by checking UE context policy control subscription information in UDR. The SM-PCF discovers the address of UE-PCF serving the UE by querying BSF. The UE-PCF recovers the information about the PSI list in the UE and the subscribed PCRTs in 5GS from former UE Policy Association for the UE after receiving the UE Policy Association Establishment request including a UE Policy Container only including an indication about the trigger for the UE Policy Association Establishment (\"5GS to EPS handover\").\nConclusion Proposal #5: When the UE is attached to EPS, the SM-PCF can retrieve the PCRTs for UE Policy from UE-PCF and subscribe to the applicable PCRTs in EPC to SMF+PGW-C.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.4\tEvaluation on Solutions for KI#4",
                    "description": "",
                    "summary": "",
                    "text_content": "Solutions for Key issue #4 address different approaches to support traffic categories in the traffic descriptor of URSP.\nThe investigations were to consider several main aspects:\n1.\tDefinition of traffic categories\n2.\tHow to support standard and operator specific traffic categories,\n3.\tWhether the current URSP design can be used to support the standard and operator specific traffic categories. If not, how to support traffic category in the traffic descriptor of a URSP rule.\nThe first aspect has been addressed basically by the GSMA, by defining categories considering application traffic characteristics and based on latency, unidirectional or bidirectional bandwidth requirements, availability requirements and particular priorities over specific QoS components (e.g. loss, jitter..).The following table summarises the evaluation of each solution considering how those address the support of traffic category in the current URSP design, or support traffic category in the traffic descriptor of a URSP rule. It also adds advantages and disadvantages seen relevant for the conclusion phase.\nTable 7.4-1\n\n",
                    "tables": [
                        {
                            "description": "Table 7.4-1",
                            "table number": 23,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "8\tConclusions",
            "description": "Editor's note:\tThis clause will list conclusions that have been agreed during the course of the study item activities.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tConclusions on KI#1",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.1.1\tGeneral",
                            "text_content": "The following definitions will be included as part of the normative work on URSP Rules in roaming:\nVPLMN specific URSP Rules: A VPLMN specific URSP Rule is applicable when the UE is registered in the VPLMN or its equivalent VPLMN only. VPLMN specific URSP rules are provided from the HPLMN and contains, based on agreements with VPLMN, HPLMN values for Network Slice Selection Policies and DNN Selection Policies. When provided, the Time and Location criteria in each of the RSD contain VPLMN values.. It is provided to the UE to route traffic on a PDU Session to a SMF and UPF in the VPLMN.\nVPLMN configuration is used to ensure that the local VPLMN values are used when a PDU Session is established for a roaming UE.\nWhen the UE sends a PDU Session Establishment the HPLMN values that are included in the S-NSSAI and DNN may need to be translated to VPLMN values to be able to select a SMF at the VPLMN. This means that the AMF may select a local DNN that is used to select a SMF in the VPLMN. How the AMF selects a local DNN is to be decided during normative phase. The AMF also sends the local DNN, if decided, as \"Selected DNN\" to the SMF, while the DNN requested by the UE is sent as \"Requested DNN\".\nThe VPLMN provides the service parameters to HPLMN for HPLMN to generate the VPLMN specific URSP rules. The H-PCF creates VPLMN specific URSP rules corresponding to different VPLMN. The H-PCF may provide the VPLMN specific URSP rules to the UE. This can be triggered by the UE's registration in the VPLMN or it can happen before UE roams into the VPLMN. The URSP Rules received by UE in VPLMN are only applicable when the UE is registered in that VPLMN or its equivalent VPLMNs. If the UE does not find a match using the URSP rules associated with the VPLMN ID or equivalent VPLMN ID, it uses the URSP rules associated with the HPLMN.\nNOTE:\tThe PCF may provide VPLMN specific URSP rules based on existing PCRT report from PCF such as PLMN Change or other triggers.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.1.2\tConclusions on the how to identify PLMN specific URSP Rules",
                            "text_content": "To enable the PCF to provide and the UE to identify the PLMN specific URSP Rules, the following conclusion principles apply:\n-\tVPLMN ID is provided to UE along with the URSP.\n-\tThe PCF provides to UE a list of PSIs associated to the HPLMN ID and a list of PSIs associated to each VPLMN ID with roaming agreements (following the principles of Solution #6).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.1.3\tConclusions on which PLMN determines the VPLMN specific URSP Rules",
                            "text_content": "The scenario where the network provides the UE with URSP rules applicable in the VPLMN It is proposed to adopt the following interim conclusion principles:\n-\tThe H-PCF provides VPLMN specific URSP Rules to the UE.\n-\tThe H-PCF generates VPLMN specific URSP rules by taking Service Parameters from V-PCF or the V-AF into account.\n-\tThe Service Parameters provided by the V-AF are either provided to:\n-\tV-NEF and stored in V-UDR so that the V-PCF can obtain the Service Parameters from V-UDR.\n-\tH-NEF and stored in the H-UDR. H-PCF retrieves the service parameters directly from the H-UDR.\n-\tThe Service Parameters are AF guidance for URSP Rule determination for subscribers of a certain PLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.1.4\tConclusions on Re-evaluation Triggers",
                            "text_content": "Upon PLMN change, the UE (re-)evaluates URSP rules.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "8.2\tConclusion on KI#2",
                    "description": "",
                    "summary": "",
                    "text_content": "New Analytics ID will be discussed to be supported by the NWDAF to monitor the traffic in one or multiple PDU Session for statistics of URSP enforcement, The analytics request includes the expected traffic according to provisioned URSP rules via the S-NSSAI/DNN. Consumer of new analytic ID can be a PCF. A PCF that provisions URSP rule for a UE may use the NWDAF output to determine updated URSP rules for UE(s).\nNOTE:\tFurther details on the new analytic ID will be determined during the normative phase.\nThe process to generate URSP Rules to the UE and corresponding PCC rules for the traffic matching the Traffic Description in the URSP Rule does not require the UE to send the URSP ID or the App ID. The PCF for the UE can derive the candidate RSD components using the PDU Session parameters sent by the UE, if no URSP Rule ID or App ID is sent as defined in Sol#9.\nDuring UE registration procedure, the UE should indicate the capability of reporting URSP rule enforcement based on UE configuration to network and the 5GC indicates to the UE to report URSP rule enforcement to network, and if the UE URSP rule includes Connection Capabilities contained in the TD (see clause 6.6.2.1 of TS 23.503 [4]), when newly-appeared application traffic is matched to the TD during URSP evaluation, the UE reports the Connection Capabilities contained in the TD, which will be included in the PDU Session Establishment or Modification (i.e. when the URSP rule is matched), then to the PCF for the PDU Session and to PCF for the UE. The UE does not report information to the 5GC when a \"match-all\" URSP rule is enforced. No service degradation for legacy UEs shall result from this functionality in Rel-18.\nNOTE 2:\tTraffic categories will be further discussed during the normative phase.\nNOTE 3:\tBy including Connection capabilities, the network indicates to the UE for which URSP rule enforcement in UE should be reported. It will waste UE resource to report all of the URSP rule enforcement to network side including the uninterested URSP rule enforcement.\nNOTE 4:\tUE reporting the enforced URSP rule information in PDU Session Establishment/Modification can significantly increase the amount of signalling in the network. Limiting the signalling impact of usage of using PDU Session Modification while keeping functionality is a matter of operational trade-off, e.g. UE reporting can be limited to specific application traffic on specific UEs. The mentioned aspects in this NOTE requiring normative work will be limited to minor modifications of existing solutions.\nNOTE 5:\tPDU Session Modification Accept/Reject, PDU Session Establishment Accept/Reject messages will not be impacted.\nNOTE 6:\tIf SA WG3 feedbacks that it sees an issue with privacy and that it cannot be solved, work on UE assistance won't proceed. Feedback has been asked from SA WG3 and will be included regarding the following aspects:\n-\tWhether SA WG3 sees an issue with privacy regarding the UE sending information to the 5GC via NAS to identify an enforced URSP rule\n-\tWhether SA WG3 see an issue with user consent regarding the UE sending information to the 5GC via NAS to identify an enforced URSP rule that SA2 would need to consider and if yes, whether SA WG2 is correct to assume that details regarding user consent would fall under the scope of SA WG3 (e.g. FS_UC3S_Ph2)\nThe PCF for the UE knows the list of URSP Rules sent to the UE and its RSDs, this allows the PCF for the UE to check the PDU Session parameters and request the PCF for the PDU Session to generate PCC Rules to apply policies for a PDU Session established with preconfigured URSP Rules. This is defined in Sol#32.\nThe PCF for the PDU Session provisions PCC rules to the SMF that includes in the SDF template based on the Application identifier, or the IP/non-IP Flow descriptions as defined in the TD of the URSP Rule. For example, the mapping of other TD such as DNN, Connection Capabilities and Domain Descriptors can be done for certain cases such as specific DNNs using local configuration in the SMF, and the Connection Capability that contains a traffic category can be mapped in some cases into the Application Identifier (e.g. Connection Capability=IMS assumes IMS application identifier).\nAlready existing mechanisms, which do not require additional normative work, can be used and are not precluded, e.g. so that the PCF can provide SDF Templates in PCC rules which correspond to traffic that is not expected to occur in a PDU session, so that if the UPF detects such traffic, the PCF for a PDU Session gets notified from the SMF and can then notify the PCF for a UE about the detected traffic and the relevant parameters of the PDU Session. Based on this information, the PCF for a UE can adjust the URSP rules.\nNOTE 7:\tExposure of UPF events towards NWDAF is part of UPEAS.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.3\tConclusion on KI#3:",
                    "description": "",
                    "summary": "",
                    "text_content": "-\tThe ePCO based URSP delivery to UE in EPS is selected as baseline mechanism for normative work.\n-\tIn order to avoid unnecessary signalling overload for the purpose of delivery URSP to pre-Rel-18 UEs in EPS, the UE needs to indicate the URSP Provisioning Support Indication in EPS in the UE Policy Container to UE-PCF in 5GS.\n-\tDuring 5GS to EPS mobility with N26, the AMF doesn't initiate the UE Policy Association termination procedure, instead the AMF will request the UE-PCF to delay the termination of UE Policy Association for a configured period. The UE-PCF can initiate the UE Policy Association Termination procedure either after it receives the UE Policy Association Establishment from SM-PCF or after the configured period. The mobility procedure from 5GS to EPC described in clause 6.16.2.3.3 is selected as the baseline procedure for 5GS to EPS mobility with N26.\n-\tAMF doesn't provide any new information to MME during 5GS to EPS mobility with N26, the SM-PCF determines whether the UE supports URSP delivery in EPS by checking UE context policy control subscription information in UDR. The SM-PCF discovers the address of UE-PCF serving the UE by querying BSF. The UE-PCF recovers the information about the PSI list in the UE and the subscribed PCRTs in 5GS from former UE Policy Association for the UE after receiving the UE Policy Association Establishment request including a UE Policy Container only including an indication about the trigger for the UE Policy Association Establishment (\"5GS to EPS handover\").\n-\tWhen the UE is attached to EPS, the SM-PCF can retrieve the PCRTs for UE Policy from UE-PCF and subscribe to the applicable PCRTs in EPC to SMF+PGW-C.\n-\tWhen the UE returns from EPS to 5GS, the old UE policy association in EPS should be terminated after the new UE policy association established in 5GS.\n-\tWhen the UE does Initial Attach to EPC, in the default PDN connection is requested to established, the UE includes the UE Policy Container ePCO in PDN Connectivity Request encapsulated in Attach Request; otherwise, the UE will include the UE Policy Container ePCO in the PDN Connectivity Request during the first request for PDN connectivity as described (i.e. as described in Sol#16). The PDN Connection used by UE and SMF/PGW-C to convey UE Policy Container ePCO shall be kept when the UE is in the CONNECTED mode.\n-\tThe PCF triggers the re-evaluation of applicable URSPs for the UE and determines an update of URSP is needed for the UE when an event as described in clause 6.16.11 happens in PCF. The PCF selects one of the PDN connection/PDU sessions associated to EPC for the delivery of the URSP update. Then the PCF generates the corresponding UPDP message MANAGE UE POLICY COMMAND in a similar way than it is done in 5GC and then includes the message into a new IE for sending it to the SMF over N7, then further to UE as described in clause 6.16.2.2.\nNOTE:\tHow to discover the same PCF for UE Policy serving the UE in both EPS and 5GS will be determined in normative phase.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.4\tConclusion on KI#4",
                    "description": "",
                    "summary": "",
                    "text_content": "The following principles are proposed to be used for conclusion:\na)\tApplication in the UE may select a standardized traffic category and informs the lower layer (e.g., OS layer). MNOs should not be assumed to assign the traffic category used by all the specific applications in a UE:\ni.\tSome implementations may rely on OS to assign the traffic category.\nb)\tFor standardized and operator-specific traffic categories, how this is selected by the application is out of scope of this specification.\nc)\tTraffic categories are independent of the Operating System. This allows operators to define operator-specific traffic categories and permit applications setting and classifying the traffic according to categories.\nd)\tImplementation details on applications indicating a particular traffic category to the OS and/or URSP layer are outside the scope of this work.\ne)\tThe existing traffic descriptors shall not modify their definition or use due to the use of traffic categories.\nf)\tTraffic categories shall be able to be used together with any other traffic descriptor in the same URSP rule, and traffic must match to all TDs (an AND function and not OR function) to trigger the URSP rule processing as described in current TS 23.503 [4].\ng)\tThe existing TD component types should be able to be reused either alone or in combination with other TD component types as a way to implicitly determining the category of an application.\nh)\tThe URSP design should be able to associate traffic categories to slices in such a way that it is possible to address large enough operator-specific categories required by operator scenarios, e.g. the length of the component type to accommodate the traffic category to be 2 or more octets.\n-\tSolution #35 is recommended for normative work to use Connection Capability in order to support standardized and operator-specific traffic categories in URSP. Stage 3 should consider extending the length of the Connection Capabilities component type of the URSP TD so as to secure enough number of traffic categories.\nNOTE:\tBesides the standardized traffic category defined by GSMA, additional traffic categories may be defined by 3GPP. This may be defined/discussed during  stage 3.\nSA WG2 recommends stage-3 normative work to proceed based on the above principles.\n\n\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 24,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}