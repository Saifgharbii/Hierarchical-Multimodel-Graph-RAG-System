{
    "document_name": "24604-i00.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification (TS) was been produced by ETSI Technical Committee Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN) and originally published as ETSI TS 183 004 [19]. It was transferred to the 3rd Generation Partnership Project (3GPP) in January 2008.\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document specifies the stage 3, Protocol Description of the Communications Diversion (CDIV) supplementary services, based on stage one and two of the ISDN Communication diversion supplementary services. It provides the protocol details in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP) and the Session Description Protocol (SDP).\nThe present document is applicable to User Equipment (UE) and Application Servers (AS) which are intended to support the CDIV supplementary service.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TS 22.173: \"Multimedia Telephony Service and supplementary services\".\n[2]\t3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on SIP and SDP\".\n[3]\tIETF RFC 7044: \"An Extension to the Session Initiation Protocol (SIP) for Request History Information\".\n[4]\t3GPP TS 24.623: \"Extensible Markup Language (XML) Configuration Access Protocol (XCAP) over the Ut interface for Manipulating Supplementary Services\".\n[5]\tIETF RFC 4566: \"SDP: Session Description Protocol\".\n[6]\tIETF RFC 3261: \"SIP: Session Initiation Protocol\".\n[7]\tIETF RFC 3966: \"The tel URI for Telephone Numbers\".\n[8]\tIETF RFC 3325: \"Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks\".\n[9]\t3GPP TS 24.611: \"Anonymous Communication Rejection (ACR) and Communication Barring (CB); Protocol specification\".\n[10]\tVoid.\n[11]\t3GPP TS 24.628: \"Common Basic Communication procedures; Protocol specification\".\n[12]\t3GPP TS 23.002: \"Network Architecture\".\n[13]\tVoid.\n[14]\tIETF RFC 4458: \"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)\".\n[15]\tVoid.\n[16]\t3GPP TS 24.629: \"Explicit Communication Transfer (ECT); Protocol specification\".\n[17]\tIETF RFC 3515: \"The Session Initiation Protocol (SIP) Refer Method\".\n[18]\tIETF RFC 4745: \"Common Policy: A Document Format for Expressing Privacy Preferences\".\n[19]\tETSI TS 183 004 V2.4.0: \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); PSTN/ISDN simulation services: Communication Diversion (CDIV); Protocol specification\".\n[20]\tIETF RFC 5627 (October 2009): \"Obtaining and Using Globally Routable User Agent URIs (GRUUs) in the Session Initiation Protocol (SIP)\".\n[21]\tOMA-TS-XDM-Core-V1_1: \"XML Document Management (XDM) Specification\", Version 1.1.\n[22]\t3GPP TS 24.238: \"Session Initiation Protocol (SIP) based user configuration\".\n[23]\tVoid.\n[24]\tIETF RFC 3326: \"The Reason Header Field for the Session Initiation Protocol (SIP)\".\n[25]\t3GPP TS 24.315: \"IMS Operator Determined Barring\".\n[26]\tIETF RFC 3023 (January 2001): \"XML Media Types\".\n[27]\tIETF RFC 4288 (December 2005): \"Media Type Specifications and Registration Procedures\".\n[28]\tIETF RFC 7090 (April 2014): \"Public Safety Answering Point (PSAP) Callback\".\n[29]\tIETF RFC 7647 (September 2015): \"Clarifications for the Use of REFER with RFC6665\".\n[30]\tIETF RFC 4694 (October 2006): \"Number Portability Parameters for the \"tel\" URI\".\n[31]\t3GPP TS 24.196: \"Technical Specification Group Core Network and Terminals; Enhanced Calling Name\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in 3GPP TS 22.173 [1] and the following apply:\nCDIV Session Identifier URI: URI created and inserted by a diverting AS that is routed through the same AS.\nNOTE 1:\tThis is used to solve the service interaction of CDIV and ECT.\nescaped character: see IETF RFC 3261 [6].\ndiverting user: served user of the communication diversion service invoked.\ndiverted-to party: party that the existing communication is forwarded to.\nNOTE 2:\tAfter forwarding the originating user and the diverted-to party are in communication with each other.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following abbreviations apply:\nACM\tAddress Complete Message\nACR\tAnonymous Communication Rejection\nANM\tANswer Message\nAP\tAuthentication Proxy\nAS\tApplication Server\nCB\tCommunication Barring\nCD\tCommunication Deflection\nCDIV\tCommunication DIVersion\nCFB\tCommunication Forwarding Busy\nCFNL\tCommunication Forwarding on Not Logged-in\nCFNR\tCommunication Forwarding No Reply\nCFNRc\tCommunication Forwarding on subscriber Not Reachable\nCFU\tCommunication Forwarding Unconditional\nCONF\tCONFerence\nCPG\tCall ProGress message\nCSCF\tCall Session Control Function\nECT\tExplicit Communication Transfer\nHOLD\tcommunication HOLD\nIAM\tInitial Address Message\nIFC\tInitial Filter Criteria\nIMS\tIP Multimedia Subsystem\nIP\tInternet Protocol\nISDN\tIntegrated Service Data Network\nISUP\tIntegrated Service digital network User Part\nMCID\tMalicious Communication IDentification\nMGCF\tMedia Gateway Control Function\nMiD\tMulti-iDentity\nMuD\tMulti-Device\nOCB\tOutgoing Communication Barring\nODB\tOperator Determined Barring\nOIP\tOriginating Identification Presentation\nOIR\tOriginating Identification Restriction\nP-CSCF\tProxy-Call Session Control Function\nPSAP\tPublic Safety Answering Point\nPSTN\tPublic Switched Telephone Network\nRTP\tReal-Time Transport Protocol\nS-CSCF\tServer-Call Session Control Function\nSDP\tSession Description Protocol\nSIP\tSession Initiation Protocol\nTIP\tTerminating Identification Presentation\nTIR\tTerminating Identification Restriction\nUA\tUser Agent\nUE\tUser Equipment\nURI\tUniversal Resource Identifier\nXCAP\tXML Configuration Access Protocol\nXML\teXtensible Markup Language\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tCommunications Diversion (CDIV)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "The Communications Diversion (CDIV) service enables diverting user, to divert the communications addressed to diverting user to another destination.\nProcedures for the CDIV AS regarding Operator Determined Barring (ODB) are defined in 3GPP TS 24.315 [25].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tDescription",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2.1\tGeneral description",
                            "text_content": "The service description of the following CDIVs ervices CFU, CFB, CFNR and CD is based on the PSTN/ISDN supplementary services, whereas CFNL is a CDIV service based on requirements for IP based networks and CFNRc is based on requirements for mobile networks.\nGenerally, the following requirements are expected to be fulfilled:\n-\tThe service provides for the user or the network to identify an alternative destination for an IP multimedia session or individual media of an IP multimedia session.\n-\tThe service provides for redirection to be initiated at various stages of an IP Multimedia session. For example:\na)\tPrior to the set up of an IP Multimedia session.\nb)\tDuring the initial request for an IP Multimedia session (CFU).\nc)\tDuring the establishment of an IP Multimedia session (CD).\n-\tThe service provides redirection to be applied for all Multimedia sessions unconditionally or it can be caused by any of a set list of events or conditions. Typical causes could be:\na)\tIdentity of the originating user.\nb)\tPresence of the originating or destination party.\nc)\tIf the destination party is already in a session (CFB).\nd)\tIf the destination party is unreachable or unavailable in some other way (CFNL; CFNR, CFNRc).\ne)\tIf the destination party does not respond (CFNR).\nf)\tAfter a specified alerting interval (CFNR).\ng)\tUser's preference on routing for specific IP Multimedia session based on the capabilities of multiple UEs sharing the same IMS service subscription.\nh)\tThe sending party, receiving party or the network on their behalf, may initiate redirection to alternative destinations.\ni)\tThe service provides for the user to subscribe to receive notifications of his/her communications diversions.\nThe following services describe applications based on a subset of the above-mentioned requirements to provide user different possibilities to divert a communication.\nIt should be possible that a user has the option to restrict receiving communications that are forwarded.\nThe CFU service enables a served user to have the network redirect, to another user, communications which are addressed to the served user's address. The CFU service may operate on all communications, or just those associated with specified services. The served user's ability to originate communications is unaffected by the CFU supplementary service. After the CFU service has been activated, communications are forwarded independent of the status of the served user.\nAs a service provider option, a subscription option can be provided to enable the served user to receive a reminder indication that the CFU service has been activated. This indication is provided when the served user originates a communication and if the CFU service has been activated for the served user's address and for the service requested for the communication.\nThe maximum number of diversions permitted for each communication is a service provider option. The service provider defines the upper limit of diversions. When counting the number of diversions, all types of diversion are included.\nThe CFB service enables a served user to have the network redirect, to another user, communications which are addressed to the served user's address and meet busy. The CFB service may operate on all communications, or just those associated with specified services. The served user's ability to originate communications is unaffected by the CFB supplementary service.\nAs a service provider option, a subscription option can be provided to enable the served user to receive a reminder indication that the CFB service has been activated. This indication is provided when the served user originates a communication and if the CFB service has been activated for the served user's address and for the service requested for the communication.\nThe maximum number of diversions permitted for each communication is a service provider option. The service provider defines the upper limit of diversions. When counting the number of diversions, all types of diversion are included.\nFor more information on the procedures for determination of the busy condition see 3GPP TS 24.628 [11].\nThe CFNR service enables a served user to have the network redirect, to another user, communications which are addressed to the served user's address, and for which the connection is not established within a defined period of time. The CFNR service may operate on all communications, or just those associated with specified services. The served user's ability to originate communications is unaffected by the CFNR supplementary service.\nThe CFNR service can only be invoked by the network after the communication has been offered to the served user and an indication that the called user is being informed of the communication has been received.\nAs a service provider option, a subscription option can be provided to enable the served user to receive a reminder indication that the CFNR service has been activated. This indication is provided when the served user originates a communication and if the CFNR service has been activated for the served user's address and for the service requested for the communication.\nThe maximum number of diversions permitted for each communication is a service provider option. The service provider defines the upper limit of diversions. When counting the number of diversions, all types of diversion are included.\nThe CFNRc service enables a user to have the network redirect all incoming communications, when the user is not reachable (e.g. there is no IP connectivity to the user's terminal), to another user. The CFNRc service may operate on all communications, or just those associated with specified services. The user's ability to originate communications is unaffected by the CFNRc supplementary service.\nAs a service provider option, a subscription option can be provided to enable the user to receive an indication that the CFNRc service has been activated. This indication is provided when the user originates a communication if the CFNRc service has been activated for the user and for the service requested for the communication.\nThe maximum number of diversions permitted for each communication is a service provider option. The service provider defines the upper limit of diversions. When counting the number of diversions, all types of diversion are included.\nThe CD service enables the served user to respond to an incoming communication by requesting redirection of that communication to another user. The CD service can only be invoked before the connection is established by the served user, i.e. in response to the offered communication (before ringing), i.e. CD Immediate, or during the period that the served user is being informed of the communication (during ringing). The served user's ability to originate communications is unaffected by the CD supplementary service.\nThe maximum number of diversions permitted for each communication is a network provider option. The network provider defines the upper limit of diversions. When counting the number of diversions, all types of diversion are included.\nThe Communication Forwarding on Not Logged-in (CFNL) service enables a served user to redirect incoming communications which are addressed to the served user's address, to another user (forwarded-to address) in case the served user is not registered (logged-in). The CFNL service may operate on all communications, or just those associated with specified basic services.\nAs a service provider option, a subscription option can be provided to enable the served user to receive a reminder indication that the CFNL service has been activated. This indication is provided when the served user logs out according to procedures described in IETF RFC 3261 [6].\nThe maximum number of diversions permitted for each communication is a service provider option. The service provider defines the upper limit of diversions. When counting the number of diversions, all types of diversion are included.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.3\tOperational requirements",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.3.1\tProvision/withdrawal",
                            "text_content": "The CDIV services (Communication forwarding unconditional, Communication forwarding busy, Communication forwarding no reply, Communication forwarding not logged-in, Communication deflection and Communication Diversion Notification) is provided after prior arrangement with the service provider.\nThe CDIV services are withdrawn at the served user's request or for administrative reasons.\nThe CDIV supplementary services can be offered separately with subscription options. For each subscription option, only one value can be selected. These subscription options are part of the call diversion profile for the served user. The subscription options are shown in table 4.3.1.1.\nTable 4.3.1.1: Subscription options for CDIV services\n\nThe following network provider options are available for the CDIV services:\nTable 4.3.1.2: Network provider options for CDIV services\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.3.1.1: Subscription options for CDIV services",
                                    "table number": 1,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.3.1.2: Network provider options for CDIV services",
                                    "table number": 2,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "4.3.2\tRequirements on the originating network side",
                            "text_content": "No specific requirements are needed in the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.3\tRequirements in the network",
                            "text_content": "No specific requirements are needed in the network.\nBased on the Initial Filter Criteria (IFC) Rules, indicating that the served user is subscribed to the CDIV supplementary services, the communication is forwarded to an AS.\nNOTE:\tAn example of the use of IFC is shown in annex B.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.4\tCoding requirements",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.4.0\tGeneral",
                            "text_content": "3GPP TS 24.229 [2] defines the messages and parameters for this supplementary service. The following messages and parameters are used to support the Communication diversion service due to fulfil the requirements.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.1\tSIP-Messages",
                            "text_content": "Table 4.4.1.1 shows the SIP messages that are used due to the coding rules in 3GPP TS 24.229 [2].\nTable 4.4.1.1: SIP Header information for redirection\n\nMore information on the cause-param URI parameter is given in annex C.\nAn AS that implements the CDIV service shall support the REFER method IETF RFC 3515 [17] and IETF RFC 7647 [29], to be able to handle the interaction with 3GPP TS 24.629 [16].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.4.1.1: SIP Header information for redirection",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "4.4.2\tParameters",
                            "text_content": "The Privacy header is described in 3GPP TS 24.229 [2]. The present document refers for the History-Info header to IETF RFC 7044 [3], for the Privacy header and P-Asserted-Identity to IETF RFC 3325 [8], for GRUU to IETF RFC 5627 [20] and for the cause-param to IETF RFC 4458 [14].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.5\tSignalling requirements",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.5.0\tGeneral",
                            "text_content": "Configuration of supplementary services by the user should:\n-\ttake place over the Ut interface using XCAP as enabling protocol as described in 3GPP TS 24.623 [4]; or\n-\tuse SIP based user configuration as described in 3GPP TS 24.238 [22].\nNOTE:\tOther possibilities for user configuration, such as web-based provisioning or pre-provisioning by the operator are outside the scope of the present document, but are not precluded.\nThe enhancements to the XML schema for use over the Ut interface is described in subclause 4.9.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.1\tActivation/deactivation",
                            "text_content": "The services CFU, CFB, CFNR, CFNL, CFNRc and CD are individually activated at provisioning or at the subscriber’s request.\nThe services CFU, CFB, CFNR, CFNL, CFNRc and CD are individually deactivated at withdrawal or at the subscriber’s request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.1a\tRegistration/erasure",
                            "text_content": "For registration of diversion information for the services CFU, CFB, CFNR, CFNL, CFNRc and CD, the mechanisms specified in subclause 4.5.0 should be used. The diverted-to party address of the services CFU, CFB, CFNR, CFNL, CFNRc and CD can individually be registered at the subscriber’s request by using the mechanisms specified in subclause 4.5.0. The registration of any diverted-to party address that is present in an operator configurable block list that contains forbidden diverted-to identities shall be rejected. Emergency service identities are examples of identities that can be part of the block list.\nFor erasure of diversion information for the services CFU, CFB, CFNR, CFNL, CFNRc and CD, the mechanisms specified in subclause 4.5.0 should be used. The diverted-to party address of the services CFU, CFB, CFNR, CFNL, CFNRc and CD can individually be erased at the subscriber's request by using the mechanisms specified in subclause 4.5.0.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.1b\tInterrogation",
                            "text_content": "For interrogation of the services CFU, CFB, CFNR, CFNL, CFNRc and CD, the mechanisms specified in subclause 4.5.0 should be used.\nFor interrogation of the supported conditions and actions that can be used in the network the Ut interface should be used.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.2\tInvocation and operation",
                            "text_content": "A UE supporting CDIV services shall support origination of requests in the IM CN subsystem (as specified in 3GPP TS 24.229 [2]).\nWhen communication diversion has occurred on the served user side and the subscription option \"Originating user receives notification that his communication has been diverted (forwarded or deflected)\" is set to \"yes\", the originating UA may receive a 181 (Call Is Being Forwarded) response according to the procedures described in 3GPP TS 24.229 [2].\nNOTE 1:\tThe Information given by the History-Info header field could be displayed by the UA if it is a UE.\nNOTE 2:\tThe originating UE will find the diverted-to URI in the last hi-entry of the History-Info header field containing a hi-target-param \"mp\" and a cause-param as specified in IETF RFC 4458 [14]. The originating UE will find the diverting user URI in the hi-entry having a hi-index that match the value of the \"mp\" parameter previously identified. If the \"mp\" header field parameter is not present in the hi-entries within the History-Info header field, the information of the diverted-to URI will be found in the last hi-entry containing a cause-param as specified in IETF RFC 4458 [14] and the diverting user URI in the previous hi-entry.\nIf the session is subject to diversion the AS of the diverting user:\n-\tif modification of the To header is required as specified in the procedures of this subclause, shall operate as an AS providing 3rd party call control, and specifically as a routeing B2BUA, as specified in subclause 5.7.5 of 3GPP TS 24.229 [2];\n-\totherwise, shall operate as either an AS acting as a SIP proxy as specified in subclause 5.7.4 of 3GPP TS 24.229 [2] or an AS providing 3rd party call control, and specifically as a routeing B2BUA, as specified in subclause 5.7.5 of 3GPP TS 24.229 [2].\nNOTE:\tFor the case when the session is not subject to diversion and CDIV, according the requirements in this document, is the only service being applied by the AS, then the AS only needs to act as a SIP proxy. If additional services are applied, then the AS might need to act as a routeing B2BUA.\nThe AS shall based on local policy on how to handle PSAP callbacks suppress diversion when the received initial INVITE request towards the served user is identified as a PSAP callback.\nThe mechanism to identify an initial INVITE request as a PSAP callback depends on local policy and can be based on the PSAP callback indicator specified in IETF RFC 7090 [28].\nThe AS may initiate announcements towards the calling user in accordance with 3GPP TS 24.628 [11].\nIf the Resource-Priority header field was received in the incoming INVITE request, then, if allowed by local policy, the AS shall set the Resource-Priority header field value of the outgoing INVITE request based upon the Resource-Priority header field value in the incoming INVITE request.\nWhen receiving an initial INVITE request and the AS determines that the AS shall divert a communication the AS shall check if diverting the communication exceeds the number of diversions allowed within the network. The AS shall calculate the number of diversions by examination of the History-Info header;\n-\tusing the entries including a cause-param URI parameter with cause values specified in subclause 4.5.2.6.2.2; or\n-\texamine the entries in the Index entries parameter,\nto see if another diversion is allowed due to network provider allowed limit of diversions\nIf the number of diversions exceeds the given limit then:\n-\tif the diverted-to destination is known to be a non-retargeting destination (e.g. Voicemail), then it is based on operator policy to allow the communication diversion to be executed;\n-\tif the network option \"AS behaviour when the maximum number of diversions for a communication is reached\" is set to \"Reject the communication\", then the AS shall send one of the following responses to the originating user:\na)\tif communication diversion forwarding busy a 486 (Busy Here);\nb)\tif communication forwarding no reply, a 480 (Temporarily Unavailable);\nc)\tif communication forwarding unconditional a 480 (Temporarily Unavailable);\nd)\tif communication deflection, a 480 (Temporarily Unavailable);\ne)\tif communication forwarding not logged in, a 480 (Temporarily Unavailable); or\nf)\tif communication forwarding not reachable, a 480 (Temporarily Unavailable); and\ninclude in the response a Warning header field indicating that the communication is released due to the extension of diversion hops (e.g. \"Too many diversions appeared\"); and\n-\tif the network option \"AS behaviour when the maximum number of diversions for a communication is reached\" is set to \"Deliver the communication to the latest diverting party\", then the communication shall be delivered to the latest diverting party.\nAfter checking the limit of diversions the following sets the retargeted initial INVITE request according to the procedures in subclause 4.5.2.6.2.\nIf an AS determines that the AS shall divert a communication and if any of the following conditions apply for the received initial INVITE request:\n-\tno History-Info header received; or\n-\ta History-Info header is received in which the last history-info entry contains no hi-targeted-to-uri element for the served user.\nThe  shall set the following information in the retargeted initial INVITE request:\n-\tthe diverting parties address;\n-\tthe diverted-to party address;\n-\tdiversion information.\nThe AS shall include or modify the following header fields with the specified values:\na)\tThe Request URI - set to the SIP URI where the communication is to be diverted to (see <target> element in subclause 4.9.1.4). In advance of this, if the <target> element contains a tel URI, the AS shall convert the tel URI into a SIP URI as specified in RFC 3261 [6], and include a user parameter set to \"phone\".\nThe AS shall set in the SIP URI the cause-param parameter (redirecting reason and redirecting indicator) also included in the History-Info header field according to the diversion conditions. The mapping between the diversion conditions and the coding of the cause-param parameter is as follows:\n-\tif communication forwarding busy, the cause value \"486\" as defined by RFC 4458 [14];\n-\tif communication forwarding no reply, the cause value \"408\" as defined by RFC 4458 [14];\n-\tif communication forwarding unconditional, the cause value \"302 as defined by RFC 4458 [14];\n-\tif communication deflection (Immediate Response), the cause value \"480\" as defined by RFC 4458 [14];\n-\tif communication forwarding not logged in, the cause value \"404\" as defined by RFC 4458 [14];\n-\tif communication deflection during alerting, the cause value \"487\" as defined by RFC 4458 [14]; and\n-\tif communication forwarding on subscriber not reachable, the cause value \"503\" as defined by RFC 4458 [14];\nb)\tThe History-Info header field - two hist-info entries that shall be generated.\n1)\tThe first entry includes the hi-targeted-to-uri of the served user. The \"rn\" and \"npdi\" tel URI parameters defined by IETF RFC 4694 [30] should be removed from the hi-targeted-to-uri of the served user before creating the first entry.\nThe AS shall include the privacy header \"history\" within the hi-targeted-to-uri in the escaped form, if:\n-\tthe served user wishes privacy (e.g. the served user is subscribed to the OIR Service); or\n-\tthe served user has the subscription option \"Served user allows the presentation of his/her URI to diverted-to user\" set to \"no\".\nOtherwise, if the first entry contains the \"gr\" parameter and the subscription option \"Served user allows the presentation of his/her URI to diverted-to user\" is set to \"not-reveal-as-GRUU\", then the AS shall change the first entry as follows:\n-\treplace the first entry with the public user identity of the served user.\nIf the diversion is based on a SIP response from the served user, a Reason header in escaped form shall be included in accordance with IETF RFC 7044 [3].\nThe \"index\" header field parameter shall be set by using a new level \"1\" according to the rules specified in subclause 10.3 \"Indexing in the History-Info Header Field\" of IETF RFC 7044 [3].\nWhen a Reason header field or a Privacy header field needs to be included in the hi-targeted-to-uri, the hi-targeted-to-uri shall be a SIP URI.\n2)\tThe second entry includes the new Request URI as described under bullet a) as hi-targeted-to-uri.\nThe \"index\" header field parameter shall be set by using a new level \"1\" according to the rules specified in subclause 10.3 \"Indexing in the History-Info Header Field\" of IETF RFC 7044 [3].\nAdd a hi-target-param \"mp\" set to value of the hi-index in the hi-entry with an hi-targeted-to-uri that reflects the Request-URI that was retargeted as described in IETF RFC 7044 [3].\nNOTE:\tIn accordance with RFC 4458 [14], hi-targeted-to-uri will contain a cause-param in non-escaped format.\nc)\tThe To header field:\nIf the served user does not want to reveal its identity to the diverted-to party, then the AS shall change the To header field to the URI where the communication is diverted to. The served user does not want to reveal its identity when one of the following conditions holds true:\n-\tif the served user wishes privacy (e.g. the served user is subscribed to the OIR Service); or\n-\tif the served user has the subscription option \"Served user allows the presentation of his/her URI to diverted-to user\" set to \"no\".\nOtherwise, if the To header contains the \"gr\" parameter and the served user has the subscription option \"Served user allows the presentation of his/her URI to diverted-to user\" set to \"not-reveal-as-GRUU\", then the AS shall change the To header field to a public user identity of the served user.\nIn all other cases the AS shall not change the To header.\nIf an AS determines that the communication shall be diverted the AS shall apply the procedure in the present subclause if the received initial INVITE request includes a History-Info header, which in the last history-info entry includes a hi-targeted-to-uri with an entry for the served user, encoded as in subclause 4.5.2.6.2.2. In this case the AS shall add a new history-info entry to the History-Info header field according to the rules defined in IETF RFC 7044 [3]. The following information is added to the retargeted initial INVITE request:\n-\tthe diverted-to party address;\n-\tdiversion information.\nThe AS shall add or modify the following header fields with the specified values:\na)\tRequest URI - set to the SIP URI where the communication is to be diverted to (see <target> element in subclause 4.9.1.4). In advance of this, if the <target> element contains a tel URI, the AS shall convert the tel URI into a SIP URI as specified in RFC 3261 [6], and include a user parameter set to \"phone\".\nThe AS shall add the cause-param as defined by RFC 4458[14] to the request URI. The mapping between the diversion conditions and the coding of the cause-param parameter shall be as defined under bullet a) in sublause 4.5.2.6.2.2.\nb)\tHistory-Info header field shall be modified in accordance with IETF RFC 7044 [3]. The history entry corresponding to previous request URI can be modified. One history entry is added.\n1)\tThe existing  history entry corresponding to the previous request URI shall be treated as follows: if the Privacy header field does not contain \"history\", the privacy header \"history\" in  escaped format shall be added or modified within the hi-targeted-to-uri, if:\n-\tthe served user wishes privacy (e.g. the served user is subscribed to the OIR Service); or\n-\tthe served user has the subscription option \"Served user allows the presentation of his/her URI to diverted-to user\" set to \"no\".\nIf the history entry representing the served user contains the \"gr\" parameter and the subscription option \"Served user allows the presentation of his/her URI to diverted-to user\" set to \"not-reveal-as-GRUU\", the AS shall change the history entry to a public user identity of the served user.\nIf the diversion is based on a SIP response from the served user, a Reason header in escaped form shall be included in the hi-targeted-to-uri in accordance with IETF RFC 7044 [3].\nWhen a Reason header field or a Privacy header field needs to be included in the existing hi-targeted-to-uri that is a tel URI, the hi-targeted-to-uri shall be first converted to a SIP URI.\n2)\tA history entry shall be added containing the new Request URI as described under bullet a) as hi-targeted-to-uri.\nThe \"index\" header field parameter shall be set by using a new level \"1\" according to the rules specified in subclause 10.3 \"Indexing in the History-Info header field\" of IETF RFC 7044 [3].\nAdd a hi-target-param \"mp\" set to value of the hi-index in the hi-entry with an hi-targeted-to-uri that reflects the Request-URI that was retargeted as described in IETF RFC 7044 [3].\nNOTE:\tIn accordance with RFC 4458 [14], hi-targeted-to-uri will contain a cause-param in non-escaped format.\nc)\tTo header:\nIf the served user does not want to reveal its identity to the diverted-to party, then the To header shall be changed to the URI where the communication is diverted to. The served user does not want to reveal its identity when one of the following conditions holds true:\n-\tif the served user wishes privacy (e.g. the served user is subscribed to the OIR Service); or\n-\tif the served user has the subscription option \"Served user allows the presentation of his/her URI to diverted-to user\" set to \"no\".\nOtherwise, if the To header contains the \"gr\" parameter and the served user has the subscription option \"Served user allows the presentation of his/her URI to diverted-to user\" set to \"not-reveal-as-GRUU\", then the To header shall be changed to a public user identity of the served user.\nIn all other cases the To header shall not be changed.\nFigure 4.5.2.6.2.4 shows the example of a communication path for multiple diversions.\nFigure 4.5.2.6.2.4 illustrates the initial information transfer in a call between two parties, A and B. The diagram shows the process of an INVITE request, where A initiates the call by sending a request to B. The request includes various parameters such as the call-id, a unique identifier for the call, and the media capabilities of the parties involved. The diagram also depicts the signaling protocol used, which is typically the Session Initiation Protocol (SIP). The process is depicted in a layered format, with the signaling layer at the bottom, followed by the media layer, and finally the transport layer at the top. This layered approach ensures that each layer can operate independently, making the system more scalable and efficient.\nFigure 4.5.2.6.2.4: Originally A calls B, information transferred in the initial INVITE request\nTable 4.5.2.6.2.4 shows which parameters and header fields that are added or modified in a diversion AS.\nTable 4.5.2.6.2.4: Parameter information for multiple redirections\n\nThe diverting AS shall continue the communication depending on the service that is causing the diversion:\n1)\tCommunication Forwarding Unconditional or Communication Forwarding Busy under network determined user busy or Communication forwarding on Not Logged in\nThe AS shall continue in the following manner:\n-\tIf the notification procedure of the originating user is supported then the originating user shall be notified as described in the subclause 4.5.2.6.4.\n-\tAn initial INVITE request containing the diverted-to URI shall be sent to the (outgoing) S-CSCF. The initial INVITE request shall include the parameter information as shown in table 4.5.2.6.2.4 and described in subclause 4.5.2.6.2.\n-\tIf the served user has subscribed to the indication of communication diversion to the diverting user, then the served user will be notified of the communication diversion as described in subclause 4.5.2.6.5.\n2)\tCommunication Forwarding No Reply\nAfter receiving the first 180 (Ringing) response the no reply timer (definition see subclause 4.8) shall be started. If forking is provided by the S-CSCF a further received 180 (Ringing) response does not refresh the timer.\nWhen receiving a 480 (Temporarily unavailable) final response including a Reason header field (see RFC 3326 [24]) with the protocol set to \"Q.850\" and the cause set to \"19\" the AS shall not refresh the no reply timer.\nWhen receiving any other final response, the no reply timer shall be terminated.\nWhen the no reply timer defined in subclause 4.8 expires:\n-\tThe dialog(s) to the diverting user shall be terminated e.g. by sending a CANCEL request or BYE request according to the rules and procedures in IETF RFC 3261 [6], including a Reason header field (see RFC 3326 [24]) with the protocol set to \"SIP\" and the cause set to \"408\".\n-\tIf the notification procedure of the originating user is supported then the originating user shall be notified as described in the subclause 4.5.2.6.4.\n-\tAn initial INVITE request is sent to the (outgoing) S-CSCF towards the diverted-to user. The initial INVITE request includes the parameter information as shown in table 4.5.2.6.2.4.\n-\tIf the diverting AS receives a SIP 18x response from the diverted-to user and the SIP 18x response does not contain a P-Early-Media header field, the diverting AS shall:\na)\twhen sending the next SIP message towards the calling party on the existing early dialog, include a P-Early-Media header field with value \"inactive\"; or\nb)\tsend a SIP 199 (Early Dialog Terminated) response towards calling party on the existing early dialog, and forward the SIP 18x response on a new early dialog.\nNOTE:\tA SIP 199 (Early Dialog Terminated) response can only be sent if the calling party has indicated support of it.\n-\tIf the served user has subscribed to the indication of communication diversion to the diverting user, then the served user will be notified of the communication diversion as described in subclause 4.5.2.6.5.\n3)\tCommunication Forwarding No Reply (ringing continues)\nAfter receiving the first 180 (Ringing) response the no reply timer (definition see subclause 4.8) shall be started. If forking is provided by the S-CSCF a further received 180 (Ringing) response does not refresh the timer.\nWhen the no reply timer defined in subclause 4.8 expires, an initial INVITE request is sent to the outgoing S-CSCF towards the diverted to user. The initial INVITE request includes the parameter information as shown in table 4.5.2.6.2.4.\nWhen the diverting AS receives a provisional response or 200 (OK) response to initial INVITE request from diverted-to-user based on operator policy, The dialog(s) to the diverting user shall be terminated e.g. by sending a CANCEL request or a BYE request according to the rules and procedures in IETF RFC 3261 [6], including a Reason header field (see IETF RFC 3326 [24]) with the protocol set to \"SIP\" and the cause set to \"408\", and if the notification procedure of the originating user is supported, the originating user shall be notified as described in subclause 4.5.2.6.4.\nIf the served user has subscribed to the indication of communication diversion to the diverting user, then the served user will be notified of the communication diversion as described in subclause 4.5.2.6.5.\nIf diverting user accepts the communication after sending the initial INVITE request the communication path towards the diverted to user shall be released according to the rules and procedures in RFC 3261 [6].\n4)\tCommunication Forwarding Busy under User Determined User Busy\nWhen the Communication Forwarding Busy under User Determined User Busy is offered to the served user, the AS shall proceed as follows:\n-\tThe received 486 (Busy Here) shall be acknowledged with an ACK request.\n-\tIf the notification procedures of the originating user are supported then the originating user shall be notified as described in the subclause 4.5.2.6.4.\n-\tAn initial INVITE request containing the diverted-to URI is sent to the outgoing S-CSCF. The initial INVITE request includes the parameter information as shown in table 4.5.2.6.2.4.\nIf the served user has subscribed to the indication of communication diversion to the diverting user, then the served user will be notified of the communication diversion as described in subclause 4.5.2.6.5.\n5)\tCommunication Deflection immediate response\nThe Communication Deflection immediate response is offered to the served user.\nA 302 (Moved Temporarily) response is received.\nIf the notification procedures of the originating user are supported then the originating user shall be notified as described in subclause 4.5.2.6.4.\nAn initial INVITE request containing the diverted-to URI is sent to the outgoing S-CSCF. The initial INVITE request includes the parameter information as shown in table 4.5.2.6.2.4.\nIf the served user has subscribed to the indication of communication diversion to the diverting user, then the served user will be notified of the communication diversion as described in subclause 4.5.2.6.5.\n6)\tCommunication Deflection during alerting\nWhen Communication Deflection during alerting is invoked after the AS receives a 180 (Ringing) \"Ringing\" response. then:\n-\tA 302 (Moved Temporarily) response is received; and\n-\tif the notification procedures of the originating user are supported then the originating user shall be notified as described in subclause 4.5.2.6.4; and\n-\tan initial INVITE request containing the URI received in the Contact header of the 302 (Moved Temporarily) response as the diverted-to URI shall be sent as specified in 3GPP TS 24.229 [2]. The diverted-to URI could be restricted by setting the privacy header for the entry of the diverted-to URI to \"history\"; and\n-\tthe initial INVITE request shall include the parameter information as shown in table 4.5.2.6.2.4 \"Parameter information for multiple redirection\".\nIf the served user has subscribed to the indication of communication diversion to the diverting user, then the served user will be notified of the communication diversion as described in subclause 4.5.2.6.5.\n7)\tCommunication Forwarding on Subscriber Not Reachable\nWhen the AS receives a not reachable indication (see subclause 4.5.2.6.6) on the initial INVITE request forwarded to the served user, then the following criteria shall apply before the Communication Forwarding on Subscriber Not Reachable procedure is executed:\n-\tthe served user has an active forwarding rule containing not-reachable condition (see subclause 4.9)\nThe following steps shall be followed to perform Communication Forwarding on Subscriber Not Reachable:\n1)\tIf the notification procedures of the originating user are supported then the originating user shall be notified as described in the subclause 4.5.2.6.4.\n2)\tAn initial INVITE request with the Request-URI set to the diverted-to URI is sent to the outgoing S-CSCF. The initial INVITE request includes the parameter information as shown in table 4.5.2.6.2.4.\nIf the served user has subscribed to the indication of communication diversion to the diverting user, then the served user will be notified of the communication diversion as described in subclause 4.5.2.6.5.\nWhen Communication Diversion occurs and if served user has the subscription option \"Originating user receives notification that his communication has been diverted (forwarded or deflected).\" set to \"yes\" then a 181 (Call Is Being Forwarded) response shall be sent towards the originating user.\nThe following header fields shall be included or modified with the specified values:\na)\tThe P-Asserted-Identity includes the URI of the diverting user.\nb)\tThe Privacy header with the value \"id\" shall be included, if:\n-\tthe served user wishes privacy (e.g. the served user is subscribed to the TIR Service); or\n-\tthe served user has the subscription option \" Served user allows the presentation of his/her URI to originating user in diversion notification.\" set to \"no\".\nc)\tThe following entries shall be added to the History-Info header field:\n1)\tIf this is the first diversion then the first entry shall be populated with the hi-targeted-to-uri of the served user. The Index is set to index = 1 according to the rules specified in IETF RFC 7044 [3].\n2)\tOn the history entry that represents the served user:\nthe privacy header with value \"history\" shall be escaped within the hi-targeted-to-uri, if:\n-\tthe served user wishes privacy (e.g. the served user is subscribed to the TIR Service); or\n-\tthe served user has the subscription option \"Served user allows the presentation of his/her URI to originating user in diversion notification.\" set to \"no\".\nIf the history is already in the escaped form with the correct privacy value no modification is needed.\nIf the history entry representing the served user contains the \"gr\" parameter and the served user has the subscription option \"Served user allows the presentation of his/her URI to originating user in diversion notification\" set to \"not-reveal-as-GRUU\", it shall be changed to the public user identity of the diverting user.\nIn all other cases the history entry representing the served user shall not be changed.\n3)\tA history entry shall be added according to the rules of subclause 4.5.2.6.2.3 item b.2. In addition, for this entry:\n1)\tif the history entry representing the forwarded to URI contains the \"gr\" parameter and the served user has the subscription option \"Served user allows the presentation of diverted to URI to originating user in diversion notification\" set to \"not-reveal-as-GRUU\", it shall be changed to the public user identity of the diverted-to user.\n2)\tthe privacy header with value \"history\" shall be escaped within the hi-targeted-to-uri or the hi-targeted-to-uri shall be set to an anonymous value.\nAdditionally, the AS may initiate an announcement to be included towards the calling user in order to inform about the diversion. Announcements may be played according to procedures as are described in 3GPP TS 24.628 [11].\nIf the subscription option \"Served user receives indication that a communication has been forwarded (indication of communication diversion to the diverting user)\" has been set to \"yes\", then one or a combination of the following procedures are possible:\n-\tWhen the diverting user is registering to the communication system, the AS sends a MESSAGE request including the information where his calls are diverted to if any. As an option; the MESSAGE request may be sent to the user after a period of time according to the timer value CDIV Indication Timer as defined in subclause 4.8.3 that can be provided by the user.\n-\tA diverting user will be informed periodically with a MESSAGE request the information where the call is diverted to.\nNOTE 1:\tA diverting user could be informed via a Voicemail or Message mail system in the communication states described above.\n-\tIf the subscription option \"Served user receives reminder indication on outgoing communication that CDIV is currently activated\" has been set to \"yes\", then a diverting user will be informed with a MESSAGE request after the diverting user has initiated a new outgoing communication. The MESSAGE request includes the information where the call is diverted to.\nNOTE 2:\tA diverting user could be informed via a Voicemail or Message mail system in the communication states described above.\nThe description of information text contained in the MESSAGE request is out of scope of the present document.\nIt is recommended that the AS interprets the reception of one of the following response events as not reachable indication:\n-\t408 (Request timeout) response;\n-\t503 (Service unavailable) response;\n-\t500 (Server Internal Error) response;\nand no provisional response, different than a 100 (Trying) response, has been received on the same dialog.\nNOTE:\tThere can be other means to discover this condition. These other means are out of the scope of the present document.\nIf the 480 (Temporarily unavailable) final response including a Reason header field (see RFC 3326 [24]) with the protocol set to \"Q.850\" and the cause set to \"19\" is used as a no reply indication (for CFNR), the AS shall exclude this specific response from the not reachable condition.\nIf the session is diverted, the AS of the diverted-to user shall operate either as an AS acting as a SIP proxy as specified in subclause 5.7.4 of 3GPP TS 24.229 [2] or an AS providing 3rd party call control, and specifically as a routeing B2BUA, as specified in subclause 5.7.5 of 3GPP TS 24.229 [2].\nNOTE 1:\tFor the case when the session is not subject to diversion and CDIV, according the requirements in this document, is the only service being applied by the AS, then the AS only needs to act as a SIP proxy. If additional services are applied, then the AS might need to act as a routeing B2BUA.\nThe AS shall store the History-Info header of an incoming initial INVITE request.\nIf a 180 (Ringing), 181 (Call Is Being Forwarded) or 200 (OK) response does not contain a History-Info header field, the AS shall include the stored History-Info header field. If diverted-to user is subscribed to the TIR service, in the Privacy header field of all responses the priv-value of the last entry in the History-Info header field shall be set to \"history\".\nNOTE 2:\tA response including no History-Info header field is coming from an untrusted entity or the History-Info header field is not included due to the privacy status within the SIP request.\nA UE supporting CDIV services shall support termination of requests in the IM CN subsystem (as specified in 3GPP TS 24.229 [2]).\nNOTE 1:\tThe Information given by the History-Info header field could be displayed by the UA if it is a UE.\nNOTE 2:\tThe terminating UE will find the diverting URI in the hi-entry of the History-Info header field whose hi-index matches the value of the hi-target-param \"mp\" in the last hi-entry containing a hi-target-param \"mp\" and a cause-param as specified in IETF RFC 4458 [14]. If the \"mp\" header field parameter is not present in the hi-entries within the History-Info header field, the information of the diverting user URI will be found in the hi-entry that precede the hi-entry containing a cause-param as specified in IETF RFC 4458 [14].\nA UE supporting CDIV services (e.g. CFU, CFB, CFNR, CD, CFNRc and CFNL) shall support termination of requests in the IM CN subsystem (as specified in 3GPP TS 24.229 [2]). If the UE is intended to support the user subscription option of \"indication of communication diversion to the diverting user\", this support shall include the receipt of MESSAGE requests (as specified in 3GPP TS 24.229 [2]).\nTo invoke Communication Deflection, the UA shall send a 302 (Moved Temporarily) response to the initial INVITE request including a Contact header field with the address where the communication is diverted to.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.5.2.6.2.4: Parameter information for multiple redirections",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "4.6\tInteraction with other services",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.6.1\tCommunication Hold (HOLD)",
                            "text_content": "No impact, i.e. neither service shall affect the operation of the other service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.2\tTerminating Identification Presentation (TIP)",
                            "text_content": "When a communication has been diverted, in order to provide the originating user with information about the diverted-to identity, the diverting AS shall include a SIP or TEL URI of the diverted-to user into a History-Info header field in a 181 (Call Is Being Forwarded) response message and send it to the originating AS, unless the diverting user has selected the option to suppress the notification of diversion. As it is not known what the diverted-to user's TIR settings are, a privacy header field with a priv-value set to \"history\" needs to be included in escaped form in the hi-entry representing the diverted-to user; or the URI representing the diverted-to user may be set to an anonymous value.\nA P-Asserted-Identity and History-Info header field received in the diverting AS is passed unmodified to the originating entity.\nNOTE:\tThe originating P-CSCF is responsible for the interpretation of the privacy header field as described in 3GPP TS 24.229 [2].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.3\tTerminating Identification Restriction (TIR)",
                            "text_content": "A P-Asserted-Identity and History-Info header field received in the diverting AS is passed unmodified to the originating entity. If TIR applies for the served user, the diverting AS shall add a Privacy header field set to \"id\" and if a Privacy header field set to \"none\" is received the diverting AS shall remove it. If a Privacy header field set to \"id\" is received from the diverted-to user, the diverting AS shall pass it unchanged to the originating user.\nNOTE:\tThe originating P-CSCF is responsible of the interpretation of the privacy header field as described in 3GPP TS 24.229 [2].\nIf the served (diverting) user selects the option that the originating user is notified, but without the diverted-to SIP or TEL URI, then the AS shall send a 181 (Call is Being Forwarded) response and either:\n-\tescape a Privacy header field with a priv-value set to \"history\" in the hi-entry representing the diverted-to user; or\n-\tanonymize the hi-entry representing the diverted-to user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.4\tOriginating Identification Presentation (OIP)",
                            "text_content": "When a communication has been diverted and the diverted-to user has been provided with the OIP service, normal procedures apply in the IMS network serving the diverted-to user. The diverting AS shall pass all received privacy headers unmodified. The diverting AS shall add the identity of the diverting user in the History-Info header field with an embedded Privacy header reflecting the served user's privacy settings.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.5\tOriginating Identification Restriction (OIR)",
                            "text_content": "When the OIR service has been invoked, normal procedures apply in the IMS network serving the diverted-to user. The diverting AS shall pass all received privacy headers unmodified. The diverting AS shall add the identity of the diverting user in the History-Info header field with an embedded Privacy header reflecting the served user's privacy settings.\nNOTE:\tThe P-CSCF executes the related privacy procedures as described in 3GPP TS 24.229 [2].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.6\tConference calling (CONF)",
                            "text_content": "No impact, i.e. neither service shall affect the operation of the other service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.7\tCommunication Diversion Services (CDIV)",
                            "text_content": "CFU, CFNL, and CFB when NDUB is used are all determined immediately when an initial INVITE request is received, and take precedence over CDIV services that are based on a response (CD, CFNRc, CFNR, and CFB when UDUB is used). CFU take precedence over all other CDIV services and the CDIV AS shall evaluate the rule associated with CFU before CFNL and CFB when NDUB is used. As CFNL and CFB cannot occur simultaneously there is no interaction. For CDIV services that are based on a response, the response received first will invoke the associated CDIV service.\nFor the indication of communication diversion to the diverting user service, the provision and activation of at least one redirection service is a pre-requirement to provision and activate the indication of communication diversion to the diverting user service\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.8\tMalicious Communication Identification (MCID)",
                            "text_content": "No impact, i.e. neither service shall affect the operation of the other service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.9\tAnonymous Communication Rejection and Communication Barring (ACR/CB)",
                            "text_content": "If the user where the communication is forwarded to has subscribed to a call barring service \"inhibition of incoming forwarded communication\" the procedures described in 3GPP TS 24.611 [9] shall take precedence.\nIf the OCB service has already been activated, the CDIV AS shall reject a request to activate any CDIV service if the forwarding party's communication to the diverted-to party would be barred by the OCB service.\nIf the CDIV service was activated before the activation of the OCB service, the OCB service can still be activated. When the two services have already been activated, the CDIV AS shall not invoke the CDIV service if the forwarding party's communication to the diverted-to party would be barred by the OCB service at the time of the invocation attempt of the CDIV service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.10\tExplicit Communication Transfer (ECT)",
                            "text_content": "See 3GPP TS 24.629 [16] on the criteria that determine that a REFER request is to be treated as a request for transfer of an existing communication.\nWhen a REFER request is received towards the originating user in the context of a call transfer scenario (see subclause 4.6.10.1.1), the diverting AS shall perform the following steps:\n1)\tCreate a new CDIV Session Identifier URI addressed to this AS. The URI shall be created in such a way that a new dialog set up towards this URI can be easily correlated with the current REFER dialog.\n2)\tThe AS stores the value of the Refer-To header field (transfer target) from the REFER request and links it to the CDIV Session Identifier URI.\n3)\tThe AS Replaces the Refer-To header field with the CDIV Session Identifier URI. (This ensures that the diverting AS remains in the loop when the transferee sets up the communication with the transfer target.).\n4)\tThe AS forwards the REFER request to the transferee using basic communication procedures 3GPP TS 24.229 [2].\nA REFER request received towards the diverted-to user is forwarded using normal procedures.\nWhen an initial INVITE request is received targeted at the CDIV Session Identifier URI created earlier when transfer of the diverted ongoing communication was requested, the AS shall perform the following actions:\n1)\tThe AS replaces the request URI with the stored Refer-To header field value linked to the specific CDIV Session Identifier URI.\nNOTE:\tIf needed the AS can generate charging events to charge for the extra leg.\n2)\tVoid.\n3)\tThe AS forwards the initial INVITE request towards the transfer target using basic communication procedures 3GPP TS 24.229 [2].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.11\tCommunication Waiting (CW)",
                            "text_content": "Communication Forwarding Unconditional (CFU): CW has no impact on CFU. The communication will be forwarded without regard to the terminating party's state. The CFU service can be activated while a call is waiting without changing the state of the waiting call. A forwarded communication can result in the communication waiting service.\nCommunication Forwarding Busy (CFB): No impact, i.e. neither service affects the operation of the other service. A forwarded communication can result in the communication waiting service.\nNOTE 1: If the terminating party is NDUB, the CW service will not be invoked, and the CFB service is invoked if it was activated.\nCommunication Forwarding No Reply (CFNR): If the terminating party has activated the CFNR service, then the CW AS still shall offer a waiting communication. If the CFNR timer expires before an answer is received, then the CFNR service shall be invoked and the CDIV AS shall forward the communication. The CDIV AS cancels the communitication to the served user. A forwarded communication can result in the communication waiting service.\nCommunication Forwarding on Not Logged-in (CFNL): No impact, i.e. neither service affects the operation of the other service.\nNOTE 2:\tIf a party with an active communication waiting logs out, all active and offered communications would be released.\nCommunication Deflection (CD): When receiving the communication waiting indication, terminating party can invoke the CD service. A deflected communication can result in the communication waiting service.\nCommunication Forwarding on Subscriber Not Reachable (CFNRc): No impact, i.e. neither service affects the operation of the other service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.12\tCompletion of Communications to Busy Subscriber (CCBS)",
                            "text_content": "The CC AS shall not divert a CC recall. It shall provide the CC recall to the original originating party.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.13\tAdvice Of Charge (AOC)",
                            "text_content": "No impact, i.e. neither service affects the operation of the other service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.14\tEnhanced Calling Name (eCNAM)",
                            "text_content": "The AS performing the CDIV service shall always send the original INVITE message without eCNAM information when communications diversion occurs. The enhanced CNAM service is described in 3GPP TS 24.196 [31].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.15\tMulti-Device (MuD)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.16\tMulti-Identity (MiD)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.7\tInterworking with other networks",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.7.1\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.8\tParameter values (timers)",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.8.1\tNo reply timer",
                            "text_content": "No reply timer: timer default duration shall be a service provider option. Based on a service provider option the user may set this timer to a value within the range specified in subclause 4.9.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.8.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.8.3\tCDIV Indication Timer",
                            "text_content": "CDIV Indication Timer: 60 sec to 00 sec.\nThe timer is started when the diverting user is registering to the communication system. Based on operator policy the user has the possibility to choose a certain timer value within the defined range.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.9\tService Configuration for redirection services",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.9.1\tStructure of the XML Document",
                            "text_content": "Communication Diversion documents are subtrees of the simservs document specified in 3GPP TS 24.623 [4]. As such, Communication Diversion documents use the XCAP application usage in 3GPP TS 24.623 [4].\nIn addition to the considerations and constraints defined by the simservs document 3GPP TS 24.623 [4], we define the additional constraints and considerations for the Communication Diversion subtree:\nXML schema: Implementations in compliance with the present document shall implement the XML schema that minimally includes the XML Schema defined in subclause 4.9.2 and the simservs XML schema specified in 3GPP TS 24.623 [4].\nData semantics: The semantics of the communication diversion XML configuration document is specified in subclause 4.9.1.\nAn instance of the supplementary services configuration containing a communication diversion configuration document.\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<simservs\nxmlns=\"http://uri.etsi.org/ngn/params/xml/simservs/xcap\"\nxmlns:cp=\"urn:ietf:params:xml:ns:common-policy\"\nxmlns:ocp=\"urn:oma:xml:xdm:common-policy\">\n<communication-diversion active=\"true\">\nrule set\n</communication-diversion>\n</simservs>\n\nThe communication diversion service contains a rule set that specifies how the communication diversion service shall react to external stimuli.\nThe communication diversion configuration contains a noReplyTimer element, a rule set, or a noReplyTimer element followed by a rule set.\nThe rule set reuses the syntax as specified by the common policy draft (see RFC 4745 [18]).\n<communication-diversion active=\"true\">\n<NoReplyTimer>NoReplyTimerValue</NoReplyTimer>\n<cp:ruleset>\nrule1\nrule2\n</cp:ruleset>\n</communication-diversion>\n\nIn general, the following procedure applies:\nWhen the service processes a set of rules it shall start executing the first rule. If:\n-\tthe rule has no <conditions> element;\n-\tthe rule has an empty <conditions> element; or\n-\tconditions are present and they all evaluate to true;\nthen the rule matches and the specified action shall be executed.\nWhen the rule does not match the following rule shall be selected and the same procedure repeated, until a matching rule is found or the set of remaining rules is empty.\nHowever not all rules can be matched at the same moment in the call. Some conditions imply that rules that carry them are checked at specific events in the call, for example the no-answer condition only holds when the called party does not answer after a while. In this case the same procedure shall apply as above with the modification that the set of rules to process contains only the rules applicable for that specific network event.\nIn subclause 4.9.1.3 all allowed conditions are specified, normally rules are evaluated at communication setup time, for conditions where this is not the case this is explicitly indicated.\nThe shown \"active\" attribute is inherited from the simservType from 3GPP TS 24.623 [4], its meaning is also specified in 3GPP TS 24.623 [4].\nNoReplyTimer: An optional element that covers the time to elapse until the communication diversion shall perform, if the served user does not answer when alerted.\nThe Communication Diversion service is configured with an ordered set of forwarding rules. The XML Schema reuses the rule syntax as specified by the common policy draft (see IETF RFC 4745 [18]). The rules take the following form:\n<cp:rule id=\"rule66\">\n<cp:conditions>\ncondition1\ncondition2\n</cp:conditions>\n<cp:actions>\n<forward-to>\n<target>\ntargetAddress1\n</target>\n<notify-caller>true</notify-caller>\n</forward-to>\n</cp:actions>\n</cp:rule>\n\nTo give more guidance, an example of such a rule is shown below:\n<cp:rule id=\"rule66\">\n<cp:conditions>\n<ss:busy/>\n<ss:media>audio</ss:media>\n<cp:identity>\n<cp:one>id=serveduser@domain</cp:one>\n</cp:identity>\n</cp:conditions>\n<cp:actions>\n<forward-to>\n<target>\ntargetAddress1\n</target>\n<notify-caller>true</notify-caller>\n</forward-to>\n</cp:actions>\n</cp:rule>\n\nWhen the service processes a set of rules it shall start executing the first rule. If:\n-\tthe rule has no <conditions> element;\n-\tthe rule has an empty <conditions> element; or\n-\tconditions are present and they all evaluate to true;\nthen the rule matches and the specified action is executed. When a rule matches remaining rules in the rule set shall be discarded. Applied to the fragment above this means that only if the expression (condition1 AND condition2) evaluates to true that then the rule66 matches and the forward-to action is executed.\nWhen the rule does not match the following rule shall be selected and the same procedure repeated, until a matching rule is found or the set of remaining rules is empty.\nThe \"id\" attribute value of a rule shall uniquely identify the rule within a rule set. This can be used in XCAP usage to address one specific rule.\nThe following conditions are allowed by the XML Schema for the communication diversion service:\nbusy: This condition evaluates to true when the called user is busy. In all other cases the condition evaluates to false. Rules with this condition are evaluated when a busy indication is received. Receipt of a SIP 486 (Busy Here) response is a busy indication.\nnot-registered: This condition evaluates to true when the called user is not registered. In all other cases the condition evaluates to false.\npresence-status: This condition evaluates to true when the called user's current presence activity status is equal to the value set for this condition. In all other cases the condition evaluates to false.\ncp:identity: This condition evaluates to true when the calling user's identity matches with the value of the identity element. The interpretation of all the elements of this condition is described in OMA-TS-XDM-Core-V1_1 [21]. In all other cases the condition evaluates to false. The Identity shall be matched against the value taken from the P-Asserted-Identity header field, and in addition as an option matched against the From header field and/or the Referred-By header field, unless both the <identity> element value and the Contact header field value contain a \"gr\" parameter, then the <identity> element value shall be matched against the value taken from the Contact header field.\nanonymous: This condition evaluates to true when the P-Asserted-Identity of the calling user is not provided or privacy restricted.\ncp:sphere: Not applicable in the context of the Communication Diversion service.\ncp:validity: Specifies a period. The condition evaluates to true when the current time is within the validity period expressed by the value of this condition. In all other cases the condition evaluates to false.\nmedia: When the incoming call request for certain media, the forwarding rule can decide to forward the call for this specific media. This condition evaluates to true when the value of this condition matches the media field in one of the \"m=\" lines in the SDP (IETF RFC 4566 [5]) offered in an initial INVITE request (IETF RFC 3261 [6]).\nno-answer: This condition evaluates to true when the called user does not answer. In all other cases the condition evaluates to false. Rules with this condition are evaluated when a no-answer timeout is detected or when a no answer indication is received.\nrule-deactivated: This condition always evaluates to false. This can be used to deactivate a rule, without loosing information. By removing this condition, the rule can be activated again.\nocp:external-list: This condition evaluates to true when the calling users identity is contained in an external resource list to which the value of external-list refers. The exact interpretation of this element is specified in OMA-TS-XDM-Core-V1_1 [21].\nocp:other-identity: Not applicable in the context of communication diversion service.\nnot-reachable: This condition evaluates to true when there is a signalling channel outage during session setup to the served user's UE. Receipt of a 500 (Server Internal Error) response is an indication that the served user's UE is unreachable. In all other cases this condition evaluates to false.\nNOTE 1:\tAs described in IETF RFC 4745 [18] the case of unconditional evaluates to be true in all cases where all other reasons are not applicable. A communication diversion is performed as soon as the served user is the called user. The indication of unconditional is the absence of any reason element in the ss:condition element.\nNOTE 2: The UE being not reachable does not include being not registered.\nThe condition elements that are not taken from the common policy schema (see IETF RFC 4745 [18]) or oma common policy schema (see OMA-TS-XDM-Core-V1_1 [21]) are defined in the simservs document schema specified in 3GPP TS 24.623 [4].\nInformation of which of the above mentioned conditions the user is allowed to use can be obtained from the network by using the schema defined in subclause 4.9.3.\nThe \"serv-cap-media\" element lists the elements that can be used in the \"media\" rule condition.\nThe action supported by the CDIV service is forwarding of calls. For this the forward-to action has been defined. The forward-to action takes the following elements:\ntarget: Specifies the address of the forwarding rule. It should be a SIP URI (IETF RFC 3261 [6]) or tel URI (IETF RFC 3966 [7]). If the address is a tel URI and it is not an international number in E.164 format, the \"phone-context\" tel URI parameter is set in accordance with subclause 7.2A.10 of 3GPP TS 24.229 [2]. An empty target element indicates that the CDIV service is not registered but is provisioned for the user.\nnotify-caller: An optional element that can be used to disable the default behaviour that the caller is notified that the call is being forwarded. (see subscription option \"Originating user receives notification that his communication has been diverted (forwarded or deflected)\" in table 4.3.1.1).\nreveal-served-user-identity-to-caller: An optional element that can be used to disable the default behaviour that the caller, when notified that the call is being forwarded, receives the diverting party's identity information. (see subscription option \"Served user allows the presentation of his/her URI to originating user in diversion notification\" in table 4.3.1.1).\nreveal-identity-to-caller: An optional element that can be used to disable the default behaviour that the caller, when notified that the call is being forwarded, receives some diverted-to party's identity information. (see subscription option \"Served user allows the presentation of diverted to URI to originating user in diversion notification\" in table 4.3.1.1).\nnotify-served-user: An optional element that can be used to enable that the served user is indicated that calls are being forwarded. Default this is switched off. (see subscription option \"Served user receives indication that a communication has been forwarded (indication of communication diversion to the diverting user)\" in table 4.3.1.1).\nnotify-served-user-on-outbound-call: An optional element that can be used to enable that the served user is notified that calls are being forwarded when he makes a call attempt. Default this is switched off. (see subscription option \"Served user receives reminder indication on outgoing communication that CDIV is currently activated\" in table 4.3.1.1).\nreveal-identity-to-target: An optional element that can be used to disable the default behaviour that the diverted-to party receives some identity information of the diverting party. (see subscription option \"Served user allows the presentation of his/her URI to diverted-to user\" in table 4.3.1.1).\nInformation of which of the above mentioned actions the user is allowed to use can be obtained from the network by using the schema defined in subclause 4.9.3. The 'serv-cap-target' element indicates whether the user is allowed to use any URI as target or whether the target needs to correspond to a telephone number, i.e. a SIP URI with a \"user\" URI parameter set to \"phone\" or a tel URI.\nIf a matching rule with an empty <actions> element is inserted, the CDIV AS abandons the rest of the rules and continues with the terminating procedures.\nNOTE:\tThis can be used to avoid that a communication diversion based on multiple media conditions is diverted by a later rule with only one of these media conditions. The UE has no need for including such a rule unless it is provided by the network.\nThe supported actions and conditions for communication diversion are configured with a list of action capability and condition capability elements. These capability elements are read only and indicate which capabilities related to communication diversion the network has provisioned for a user.\nEXAMPLE:\tAn instance of the simulation services configuration containing a service capabilities document for communication diversion is shown in the following example. It is based on operator policy if the restriction of <serv-cap-target> element to <telephony-type> is needed. In this example, the same capabilities as in call diversion in a CS network are supported.\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<simservs\nxmlns=\"http://uri.etsi.org/ngn/params/xml/simservs/xcap\">\n<communication-diversion-serv-cap active=\"true\">\n<serv-cap-conditions>\n<serv-cap-external-list provisioned=\"false\"></serv-cap-external-list>\n<serv-cap-identity provisioned=\"false\"></serv-cap-identity>\n<serv-cap-media>\n<media>audio</media>\n<media>video</media>\n</serv-cap-media>\n<serv-cap-presence-status provisioned=\"false\"></serv-cap-presence-status>\n<serv-cap-validity provisioned=\"false\"></serv-cap-validity>\n<serv-cap-unconditional provisioned=\"true\"></serv-cap-unconditional>\n</serv-cap-conditions>\n<serv-cap-actions>\n<serv-cap-target>\n<telephony-type/>\n</serv-cap-target>\n<serv-cap-notify-served-user-on-outbound-call provisioned=\"false\">\n</serv-cap-notify-served-user-on-outbound-call>\n<serv-cap-reveal-identity-to-caller provisioned=\"false\">\n</serv-cap-cap-reveal-identity-to-caller>\n<serv-cap-reveal-served-user-identity-to-caller provisioned=\"false\">\n</serv-cap-reveal-served-user-identity-to-caller>\n<serv-cap-reveal-identity-to-target provisioned=\"false\">\n</serv-cap-reveal-identity-to-target>\n</serv-cap-actions>\n</communication-diversion-serv-cap>\n</simservs>\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.9.2\tXML Schema",
                            "text_content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nxmlns:ss=\"http://uri.etsi.org/ngn/params/xml/simservs/xcap\"\nxmlns:cp=\"urn:ietf:params:xml:ns:common-policy\"\nxmlns:ocp=\"urn:oma:xml:xdm:common-policy\"\ntargetNamespace=\"http://uri.etsi.org/ngn/params/xml/simservs/xcap\"\nelementFormDefault=\"qualified\"\nattributeFormDefault=\"unqualified\">\n<!-- import common policy definitions -->\n<xs:import namespace=\"urn:ietf:params:xml:ns:common-policy\" schemaLocation=\"common-policy.xsd\"/>\n<!-- import OMA common policy extensions -->\n<xs:import namespace=\"urn:oma:xml:xdm:common-policy\" schemaLocation=\"xdm_commonPolicy-V1_0.xsd\"/>\n<!-- communication diversion specific extensions to IETF common policy conditions. The cp:conditionsType is expanded with the elements: ss:not-registered, ss:busy, ss:no-answer, ss:not-reachable, ss:media as optional elements -->\n<!-- communication diversion rule set based on the common policy rule set.-->\n<xs:element name=\"communication-diversion\" substitutionGroup=\"ss:absService\">\n<xs:annotation>\n<xs:documentation>This is the communication diversion configuration document.</xs:documentation>\n</xs:annotation>\n<xs:complexType>\n<xs:complexContent>\n<xs:extension base=\"ss:simservType\">\n<xs:sequence>\n<!-- add service specific elements here-->\n<xs:element ref=\"ss:NoReplyTimer\" minOccurs=\"0\"/>\n<xs:element ref=\"cp:ruleset\" minOccurs=\"0\"/>\n</xs:sequence>\n</xs:extension>\n<!-- service specific attributes can be defined here -->\n</xs:complexContent>\n</xs:complexType>\n</xs:element>\n\n<!-- communication diversion specific extensions to IETF common policy actions-->\n<xs:element name=\"forward-to\" type=\"ss:forward-to-type\"/>\n<xs:simpleType name=\"reveal-URI-options-type\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"false\"/>\n<xs:enumeration value=\"not-reveal-GRUU\"/>\n<xs:enumeration value=\"true\"/>\n</xs:restriction>\n</xs:simpleType>\n<!-- communication diversion specific type declarations -->\n<xs:complexType name=\"forward-to-type\">\n<xs:sequence>\n<xs:element name=\"target\" type=\"xs:anyURI\" minOccurs=\"1\" maxOccurs=\"1\"/>\n<xs:element name=\"notify-caller\" type=\"xs:boolean\" default=\"true\" minOccurs=\"0\"/>\n<xs:element name=\"reveal-identity-to-caller\" type=\"ss:reveal-URI-options-type\" default=\"true\" minOccurs=\"0\"/>\n<xs:element name=\"reveal-served-user-identity-to-caller\" type=\"ss:reveal-URI-options-type\" default=\"true\" minOccurs=\"0\"/>\n<xs:element name=\"notify-served-user\" type=\"xs:boolean\" default=\"false\" minOccurs=\"0\"/>\n<xs:element name=\"notify-served-user-on-outbound-call\" type=\"xs:boolean\" default=\"false\" minOccurs=\"0\"/>\n<xs:element name=\"reveal-identity-to-target\" type=\"ss:reveal-URI-options-type\" default=\"true\" minOccurs=\"0\"/>\n</xs:sequence>\n</xs:complexType>\n<xs:element name=\"NoReplyTimer\">\n<xs:simpleType>\n<xs:restriction base=\"xs:positiveInteger\">\n<xs:minInclusive value=\"5\"/>\n<xs:maxInclusive value=\"180\"/>\n</xs:restriction>\n</xs:simpleType>\n</xs:element>\n</xs:schema>\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.9.3\tXML schema for indication of supported conditions and actions",
                            "text_content": "?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:ss=\"http://uri.etsi.org/ngn/params/xml/simservs/xcap\"  targetNamespace=\"http://uri.etsi.org/ngn/params/xml/simservs/xcap\" elementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\">\n<xs:annotation>\n<xs:documentation xml:lang=\"en\">\nThis schema defines elements that are used to inform the UE which conditions and actions the\nnetwork support.\n</xs:documentation>\n</xs:annotation>\n<xs:include schemaLocation=\"XCAP.xsd\"/>\n<xs:element name=\"communication-diversion-serv-cap\" substitutionGroup=\"ss:absService\">\n<xs:complexType>\n<xs:complexContent>\n<xs:extension base=\"ss:simservType\">\n<xs:sequence>\n<xs:element name=\"serv-cap-conditions\" minOccurs=\"0\">\n<xs:complexType>\n<xs:sequence>\n<xs:element name=\"serv-cap-anonymous\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-busy\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-external-list\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-identity\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-media\" type=\"ss:supported-media-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-not-registered\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-no-answer\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-not-reachable\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-presence-status\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-rule-deactivated\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-validity\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-unconditional\"\ntype=\"ss:provisioned-type\" minOccurs=\"0\"/>\n</xs:sequence>\n</xs:complexType>\n</xs:element>\n<xs:element name=\"serv-cap-actions\" minOccurs=\"0\">\n<xs:complexType>\n<xs:sequence>\n<xs:element name=\"serv-cap-target\" type=\"ss:provisioned-target-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-notify-caller\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-notify-served-user\" type=\"ss:provisioned-type\"\nminOccurs=\"0\"/>\n<xs:element name=\"serv-cap-notify-served-user-on-outbound-call\"\ntype=\"ss:provisioned-type\" minOccurs=\"0\"/>\n<xs:element name=\"serv-cap-reveal-identity-to-caller\"\ntype=\"ss:provisioned-type\" minOccurs=\"0\"/>\n<xs:element name=\"serv-cap-reveal-served-user-identity-to-caller\"\ntype=\"ss:provisioned-type\" minOccurs=\"0\"/>\n<xs:element name=\"serv-cap-reveal-identity-to-target\"\ntype=\"ss:provisioned-type\" minOccurs=\"0\"/>\n</xs:sequence>\n</xs:complexType>\n</xs:element>\n</xs:sequence>\n</xs:extension>\n</xs:complexContent>\n</xs:complexType>\n</xs:element>\n</xs:schema>\n\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.10\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.1\t cases",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.1.1\tCommunication Forwarding unconditional",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure A.1 shows an example signalling flow for a successful communication forwarding unconditional based on an AS providing the forwarding.\nFigure A.1 illustrates a typical network configuration in a data center, showcasing the arrangement of servers, storage devices, and network switches. The central processing unit (CPU) is depicted at the top, with memory modules and input/output (I/O) devices connected below. The storage devices are shown on the right, with various storage technologies represented, such as solid-state drives (SSDs) and hard disk drives (HDDs). The network switches are positioned at the bottom, facilitating communication between the servers and storage devices. The figure emphasizes the importance of efficient network architecture in ensuring high-speed data transfer and seamless communication within the data center.\nFigure A.1:  based normal case\nUser B has activated the CFU service.\nUser A is sending a communication request towards User B:\n1)\tInitial INVITE request towards User B.  - see example in table A.1.1-1.\nTable A.1.1-1: INVITE request (UE A to P-CSCF)\nINVITE sip:user2_public1@home1.net;gr=2ad8950e-48a5-4a74-8d99-ad76cc7fc74c SIP/2.0\nVia: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7\nMax-Forwards: 70\nRoute: <sip:pcscf1.visited1.net:7531;lr;comp=sigcomp>, <sip:scscf1.home1.net;lr>\nP-Preferred-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nP-Access-Network-Info: 3GPP-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11\nPrivacy: none\nFrom: <sip:user1_public1@home1.net>;tag=171828\nTo: sip:user2_public1@home1.net;gr=2ad8950e-48a5-4a74-8d99-ad76cc7fc74c\nCall-ID: cb03a0s09a2sdfglkj490333\nCseq: 127 INVITE\nRequire: sec-agree\nProxy-Require: sec-agree\nSupported: precondition, 100rel, gruu, 199\nSecurity-Verify: ipsec-3gpp; q=0.1; alg=hmac-sha-1-96; spi-c=98765432; spi-s=87654321; port-c=8642; port-s=7531\nContact: <sip:user1_public1@home1.net;gr=urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6;comp=sigcomp>;+g.3gpp.icsi - ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nAllow: INVITE, ACK, CANCEL, BYE, PRACK, UPDATE, REFER, MESSAGE\nAccept: application/sdp,application/3gpp-ims+xml\nAccept-Contact: *;+g.3gpp.icsi - ref=\"urn%3Aurn-7%3gpp-service.ims.icsi.mmtel\"\nP-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nContent-Type: application/sdp\nContent-Length: (…)\n\nv=0\no=- 2987933615 2987933615 IN IP6 5555::aaa:bbb:ccc:ddd\ns=-\nc=IN IP6 5555::aaa:bbb:ccc:ddd\nt=0 0\nm=video 3400 RTP/AVP 98 99\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:75\na=curr:qos local none\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=inactive\na=rtpmap:98 H263\na=fmtp:98 profile-level-id=0\na=rtpmap:99 MP4V-ES\nm=audio 3456 RTP/AVP 97 96\na=tcap:1 RTP/AVPF\na=pcfg:1 t=1\nb=AS:25.4\na=curr:qos local none\na=curr:qos remote none\na=des:qos mandatory local sendrecv\na=des:qos none remote sendrecv\na=inactive\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; maxframes=2\na=rtpmap:96 telephone-event\n\n2)\tInitial INVITE request towards User B. The URI-B is subscribed to the CFU service.\n3 to 4) Using the IFC the initial INVITE request is forwarded to the AS.\n5)\tProcedures for CFU are executed.\n6 to 8) Depending on the value of subscription option “Originating user receives notification that his communication has been diverted (forwarded or deflected)”, a 181 (Call Is Being Forwarded) response is sent towards the User A indicating that the communication is diverted.\n9)\tAn initial INVITE request including URI-C as destination is sent back to the S-CSCF. Additional the History-Info header is included. - see example in table A.1.1-9.\nTable A.1.1-9: INVITE request (AS to S-CSCF)\nINVITE sip:User-C@example.com;cause=302 SIP/2.0\nVia: SIP/2.0/UDP as.home1.net;branch=z9hG4bK712z34.1,\nSIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1,\nSIP/2.0/UDP pcscf1.home1.net;branch=z9hG4bK240f34.1,\nSIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7\nMax-Forwards: 67\nRecord-Route: <sip:as.home1.net>, <sip:scscf1.home1.net;lr>,<sip:pcscf1.home1.net;lr>\nRoute: <sip:scscf1.home1.net;lr>\nP-Asserted-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nPrivacy:\nFrom: <sip:user1_public1@home1.net>;tag=171828\nTo: sip:user2_public1@home1.net;gr=2ad8950e-48a5-4a74-8d99-ad76cc7fc74c\nCall-ID:\nCseq:\nRequire:\nProxy-Require:\nSupported:\nSecurity-Verify:\nContact:\nAllow:\nAccept:\nAccept-Contact:\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nHistory-Info: <sip:user2_public1@home1.net;gr=2ad8950e-48a5-4a74-8d99-ad76cc7fc74c; >;index=1,<sip:User-C@example.com;cause=302>;index=1.1;mp=1\nContent-Type:\nContent-Length:\n\nv=\no=\ns=\nc=\nt=\nm=\na=\na=\nb=\na=\na=\na=\na=\na=\na=\na=\na=\nm=\na=\na=\nb=\na=\na=\na=\na=\na=\na=\na=\na=\n\n10)\tS-CSCF looks up to the HSS to identify the location of User-C.\n11 to 12) The communication is routed towards User-C.\n13 to 18) The 200 (OK) response is sent back to the User-A.\n19 to 24) The ACK request is send back to User-B.\n25)\tRTP media is established.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.2\tCommunication Deflection",
                    "description": "",
                    "summary": "",
                    "text_content": "Figures A.2a and A.2b describe the Immediate CD feature the only difference compared to a regular CD is that in the regular CD case the \"302 (Moved Temporarily) Moved Temporarily\" is preceded by a \"180 (Ringing) Ringing\".\nFigure A.2a illustrates the utilization of a wavelength-division multiplexing (WDM) system in a telecommunication network. The figure showcases multiple channels of light (wavelengths) being transmitted simultaneously over a single optical fiber, allowing for increased data capacity. The diagram includes a transmitter, which generates the optical signals, and a receiver that decodes the signals. The use of WDM enables the efficient transmission of large amounts of data, which is crucial for the growing demand for high-speed internet services.\nFigure A.2a\nFigure A.2b illustrates the utilization of a wavelength-division multiplexing (WDM) system in a telecommunication network, showcasing multiple channels of light being transmitted simultaneously over a single optical fiber. The diagram highlights the use of different wavelengths, represented by colored bands, to carry data across the network. The central part of the figure shows the optical amplifiers, which are crucial for extending the reach of the network and ensuring signal strength. The inset box on the right side of the figure provides a closer look at the signal processing and modulation techniques employed to transmit data efficiently. The overall layout of the figure emphasizes the high capacity and flexibility offered by WDM systems in modern telecommunication networks.\nFigure A.2b\nUser B has activated the CD service.\nUser A is sending a communication request towards User B:\n1 to 2) Initial INVITE request towards User B. The URI-B is subscribed to the CD service. - see example in table A.1.1-1\n2a to 3) Using IFC the initial INVITE request is forwarded to the AS.\n4 to 7) The initial INVITE request is forwarded to User B due to normal communication procedures.\n8 to 10) A 302 (Moved Temporarily) response with a contact header including the URI of the forwarded to user is sent back to the AS.\n11)\tThe CD logic is executed.\n12 to 14) Depending on the value of subscription option \"Originating user receives notification that his communication has been diverted (forwarded or deflected)\", a 181 (Call Is Being Forwarded) response is sent towards the User A indicating that the communication is diverted.\n15) An initial INVITE request including URI-C as destination is sent back to the S-CSCF. Additional the History-Info header field is included. - see example in table A.1.2-15.\nTable A.1.2-15: INVITE request (AS to S-CSCF)\nINVITE sip:User-C@example.com;cause=480 SIP/2.0\nVia: SIP/2.0/UDP as.home1.net;branch=z9hG4bK712z34.1,\nSIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1,\nSIP/2.0/UDP pcscf1.home1.net;branch=z9hG4bK240f34.1,\nSIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7\nMax-Forwards: 67\nRecord-Route: <sip:as.home1.net>, <sip:scscf1.home1.net;lr>,<sip:pcscf1.home1.net;lr>\nRoute: <sip:scscf1.home1.net;lr>\nP-Asserted-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nP-Access-Network-Info:\nPrivacy:\nFrom: <sip:user1_public1@home1.net>;tag=171828\nTo: sip:user2_public1@home1.net;gr=2ad8950e-48a5-4a74-8d99-ad76cc7fc74c\nCall-ID:\nCseq:\nRequire:\nProxy-Require:\nSupported:\nSecurity-Verify:\nContact:\nAllow:\nAccept:\nAccept-Contact:\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nHistory-Info: <sip:user2_public1@home1.net;gr=2ad8950e-48a5-4a74-8d99-ad76cc7fc74c?Reason=sip%3Bcause=302>;index=1,<sip:User-C@example.com;cause=480>;index=1.1;mp=1\nContent-Type:\nContent-Length:\n\nv=\no=\ns=\nc=\nt=\nm=\na=\na=\nb=\na=\na=\na=\na=\na=\na=\na=\na=\nm=\na=\na=\nb=\na=\na=\na=\na=\na=\na=\na=\na=\n\n16 to 18) An initial INVITE request including URI-C as destination is routed to UE C.\n19 to 24) A 180 (Ringing) response is sent back to the originating user including a History-Info header field as shown above. If no restriction is given the diverted to user will be presented at the UE of user A.\n25 to 30) The 200 (OK) response is sent back to the User-A.\n31 to 36) The ACK request is sent back to User-B.\n37)\tRTP media is established.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.3\tCommunication forwarding on no reply",
                    "description": "",
                    "summary": "",
                    "text_content": "Figures A.3a and A.3b shows an example signalling flow for a successful communication forwarding on no reply based on an AS providing the forwarding as described in bullet 2) of the subclause 4.5.2.6.3.\nFigure A.3a illustrates the utilization of a wavelength-division multiplexing (WDM) system in a telecommunication network. The figure showcases multiple channels of light (wavelengths) being transmitted simultaneously over a single optical fiber, allowing for increased data capacity. The diagram includes a transmitter, which generates the optical signals, and a receiver that decodes the signals. The use of WDM enables the efficient transmission of large amounts of data, which is crucial for the growing demand for high-speed internet services.\nFigure A.3a\nFigure A.3b illustrates the utilization of a wavelength-division multiplexing (WDM) system in a telecommunication network, showcasing multiple channels of light being transmitted simultaneously over a single fiber. The diagram highlights the use of different wavelengths, represented by colored bands, to carry data across the network. The central part of the figure shows the optical amplifiers, which are crucial for signal amplification and maintaining signal strength over long distances. The inset box on the right side of the figure provides a closer look at the wavelength-division multiplexing process, emphasizing the efficient use of fiber resources and the ability to support high-speed data transmission.\nFigure A.3b\nUser B has activated the CFNR service.\nUser A is sending a communication request towards User B:\n1 to 2) Initial INVITE request towards User B. The URI-B is subscribed to the CFU service. - see example in table A.1.1-1\n3)\tUsing the IFC the initial INVITE request is forwarded to the AS.\n4)\tThe initial INVITE request is forwarded to User B due to normal communication procedures.\n5 to 6) The initial INVITE request is forwarded to User B due to normal communication procedures.\n7 to 9) A 180 (Ringing) response is sent back to the AS indicating that the terminating UE is ringing.\n10) The no-reply timer in the AS is started.\n11 to 13) The previous 180 (Ringing) response is sent towards the originating user indicating that the terminating UE is ringing.\n14) The timer expires.\n15 to 17) In this case, the option to not continue ringing the forwarding user applies, therefore to release the communication to User B the AS sends a CANCEL request\n18 to 20) The 200 (OK) response for the CANCEL request is sent back to the AS.\n21 to 23) Depending on the value of subscription option \"Originating user receives notification that his communication has been diverted (forwarded or deflected)\", a 181 (Call Is Being Forwarded) response is sent towards the User A indicating that the communication is diverted.\n24 to 26) A 487 (Request Terminated) response with a ACK request finalize the termination of the dialog between AS and UE:B.\n27 to 29) The ACK for the 487 (Request Terminated) response is sent back to User-B.\n30) An initial INVITE request including URI-C as destination is sent back to the S-CSCF. Additional the History-Info header is included. - see example in table A.1.3-28.\nTable A.1.3-28: INVITE request (AS to S-CSCF)\nINVITE sip:User-C@example.com;target=sip:user2_public1@home1.net%3bgr%362ad8950e-48a5-4a74-8d99-ad76cc7fc74;cause 408 SIP/2.0\nVia: SIP/2.0/UDP as.home1.net;branch=z9hG4bK712z34.1,\nSIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK332b23.1,\nSIP/2.0/UDP pcscf1.home1.net;branch=z9hG4bK240f34.1,\nSIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp;branch=z9hG4bKnashds7\nMax-Forwards: 67\nRecord-Route: <sip:as.home1.net>, <sip:scscf1.home1.net;lr>,<sip:pcscf1.home1.net;lr>\nRoute: <sip:scscf1.home1.net;lr>\nP-Asserted-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nP-Access-Network-Info:\nPrivacy:\nFrom: <sip:user1_public1@home1.net>;tag=171828\nTo: sip:user2_public1@home1.net;gr=2ad8950e-48a5-4a74-8d99-ad76cc7fc74c\nCall-ID:\nCseq:\nRequire:\nProxy-Require:\nSupported:\nSecurity-Verify:\nContact:\nAllow:\nAccept:\nAccept-Contact:\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\nHistory-Info: <sip:user2_public1@home1.net;gr=2ad8950e-48a5-4a74-8d99-ad76cc7fc74c;>;index=1,<sip:User-C@example.com;target=sip:user2_public1@home1.net%3bgr%362ad8950e-48a5-4a74-8d99-ad76cc7fc74;cause=408>;index=1.1;mp=1\nContent-Type:\nContent-Length:\n\nv=\no=\ns=\nc=\nt=\nm=\na=\na=\nb=\na=\na=\na=\na=\na=\na=\na=\na=\nm=\na=\na=\nb=\na=\na=\na=\na=\na=\na=\na=\na=\n\n32 to 34) An initial INVITE request including URI-C as destination is routed to UE C.\n34 to 19) A 180 (Ringing) response is sent back to the originating user including a History-Info header as shown above. If no restriction is given the diverted to user will be presented at the UE of User A.\n40 to 45) The 200 (OK) response from User-C is sent back to the User-A.\n46 to 51) The ACK request is sent back to User-C.\n52)\tRTP media is established.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.4\tCommunication Forwarding on Busy",
                    "description": "",
                    "summary": "",
                    "text_content": "Figures A.4a and A.4b shows an example signalling flow for a successful communication forwarding on busy based on an AS providing the forwarding.\nFigure A.4a illustrates the utilization of multiple antennas in a cellular network to enhance signal reception and transmission. The figure showcases the arrangement of antennas at various heights and positions, including the base station (BS) and user equipment (UE), to optimize coverage and capacity. The figure highlights the importance of antenna diversity and beamforming techniques in improving signal quality and reducing interference in a dense urban environment.\nFigure A.4a\nFigure A.4b illustrates the utilization of a wavelength division multiplexing (WDM) system in a telecommunication network, where multiple wavelengths of light are transmitted over a single optical fiber. The figure showcases the use of different colored lines representing various wavelengths, each carrying its own data stream. The central part of the figure demonstrates the multiplexing process, where the wavelengths are combined and separated at the receiver end, allowing for efficient data transmission. The inset box highlights the importance of signal regeneration and amplification at intermediate nodes, ensuring the continuous flow of data throughout the network. This efficient wavelength management is crucial for high-speed data transmission and the smooth operation of modern telecommunication networks.\nFigure A.4b\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.5\tCommunication Forwarding Not Logged-in (CFNL)",
                    "description": "",
                    "summary": "",
                    "text_content": "Figures A.5 shows an example signalling flow for a successful communication forwarding on not logged-in based on an AS providing the forwarding.\nFigure A.5 illustrates the utilization of advanced modulation techniques in a wireless communication system, showcasing the efficient transmission of data through the use of orthogonal frequency division multiple access (OFDMA) and single-carrier frequency division multiple access (SC-FDMA). The figure demonstrates how these techniques enable simultaneous communication of multiple users on the same frequency band, thereby increasing overall system capacity and reducing interference. The diagram also highlights the role of resource blocks (RB) in dividing the available spectrum into smaller units, which are then allocated to individual users based on their data rates and channel conditions. The figure emphasizes the importance of these advanced modulation techniques in meeting the high-speed data transmission requirements of modern wireless networks.\nFigure A.5\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.6\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.7\tService configuration",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure A.7 illustrates a service configuration example, showcasing the various components involved in the setup. The figure depicts a network topology with multiple service modules, routers, and interfaces. The layout demonstrates how different services are interconnected and how traffic flows are managed. Key elements include the service module, which is responsible for service configuration and management, and the routers, which facilitate communication between different network segments. The interfaces represent the points of connection between the network and external entities, such as clients or other networks. The figure highlights the complexity and interdependence of network services, emphasizing the importance of efficient configuration and management for optimal performance.\nFigure A.7: Service configuration example\n1.\tHTTP GET request (UE to AP) - see example in table A.1.7-1\nThe UE wants to retrieve the supported conditions and actions for communication diversion from the AS.\nTable A.1.7-1: HTTP GET request (UE to AP)\nGET /simservs.ngn.etsi.org/users/sip:user1@home1.net/simservs.xml/~~/simservs/communication-diversion-serv-cap HTTP/1.1\nHost: xcap.mnc012.mcc345.ipxuni.3gppnetwork.org\nDate: Thu, 16 Jun 2011 10:50:33 GMT\nX-3GPP-Intended-Identity: \"sip:user1@home1.net\"\n\n2.\tHTTP 401 (Unathorized) response (AP to UE) - see example in table A.1.7-2\nUpon receiving an unauthorized HTTP GET request the AP authenticates the UE.\nTable A.1.7-2: HTTP 401 (Unathorized) request (AP to UE)\nHTTP/1.1 401 Unauthorized\nDate: Thu, 16 Jun 2011 10:50:34 GMT\nWWW-Authenticate: Digest realm=\"xcap.mnc012.mcc345.ipxuni.3gppnetwork.org\", nonce=\"47364c23432d2e131a5fb210812c\", qop=auth-int\nContent-Length: 0\n\n3.\tHTTP GET request (UE to AP) - see example in table A.1.7-3\nThe UE repeats the HTTP GET request including the Authorization header.\nTable A.1.7-3: HTTP GET request (UE to AP)\nGET /simservs.ngn.etsi.org/users/sip:user1@home1.net/simservs.xml/~~/simservs/communication-diversion-serv-cap HTTP/1.1\nHost: xcap.mnc012.mcc345.ipxuni.3gppnetwork.org\nDate: Thu, 16 Jun 2011 10:50:36 GMT\nAuthorization: Digest realm=\"xcap.mnc012.mcc345.ipxuni.3gppnetwork.org\", nonce=\"47364c23432d2e131a5fb210812c\", username=\"sip:user1@home1.net\", qop=auth-int,\nuri=\"/simservs.ngn.etsi.org/users/sip:user1@home1.net/simservs.xml/~~/simservs/communication-diversion-serv-cap\", response=\"2c8ee200cec7f6e966c932a9242554e4\", cnonce=\"dcd99agsfgfsa8b7102dd2f0e8b1\", nc=00000001\nX-3GPP-Intended-Identity: \"sip:user1@home1.net\"\n\n4.\tHTTP GET request (AP to AS) - see example in table A.1.7-4\nThe AP forwards the HTTP GET request to the AS.\nTable A.1.7-4: HTTP GET request (AP to AS)\nGET /simservs.ngn.etsi.org/users/sip:user1@home1.net/simservs.xml/~~/simservs/communication-diversion-serv-cap HTTP/1.1\nHost: xcap.mnc012.mcc345.ipxuni.3gppnetwork.org\nVia: HTTP/1.1 ap.home1.net\nDate: Thu, 16 Jun 2011 10:50:38 GMT\nX-3GPP-Asserted-Identity: \"sip:user1@home1.net\"\n\n5.\tHTTP 200 (OK) response (AS to AP) - see example in table A.1.7-5\nThe AS returns the supported conditions and actions for communication diversion.\nThe <serv-cap-media> child element of the <serv-cap-conditions> element describes that audio and video media are allowed to be used as Communication Diversion rule conditions. The other child elements of the <serv-cap-conditions> element list the conditions that are not provisioned for the user. If a service capability for a condition is not listed from the list of conditions specified in subclause 4.9.1.3 then the condition is provisioned for the user. The following conditions are provisioned: busy, not-registered, no-answer, not-reachable.\nThe <serv-cap-target> child element of the <serv-cap-actions> element describes that the target needs to correspond to a telephone number. The other child elements of the <serv-cap-actions> element list the actions that are not provisioned for the user. If a service capability for an action is not listed from the list of actions specified in subclause 4.9.1.4 then the action is provisioned for the user. In this example, there are no other actions provisioned.\nTable A.1.7-5: HTTP 200 (OK) response (AS to AP)\nHTTP/1.1 200 OK\nDate: Thu, 16 Jun 2011 10:50:40 GMT\nEtag: \"eti87\"\nContent-Type: application/xcap-el+xml; charset=\"utf-8\"\nContent-Length: (...)\n\n<communication-diversion-serv-cap active=\"true\">\n<serv-cap-conditions>\n<serv-cap-anonymous provisioned=\"false\"></serv-cap-anonymous>\n<serv-cap-external-list provisioned=\"false\"></serv-cap-external-list>\n<serv-cap-identity provisioned=\"false\"></serv-cap-identity>\n<serv-cap-media>\n<media>audio</media>\n<media>video</media>\n</serv-cap-media>\n<serv-cap-presence-status provisioned=\"false\"></serv-cap-presence-status>\n<serv-cap-rule-deactivated provisioned=\"false\"></serv-cap-rule-deactivated>\n<serv-cap-validity provisioned=\"false\"></serv-cap-validity>\n</serv-cap-conditions>\n<serv-cap-actions>\n<serv-cap-target>\n<telephony-type/>\n</serv-cap-target>\n<serv-cap-notify-caller provisioned=\"false\">\n</serv-cap-notify-caller>\n<serv-cap-notify-served-user provisioned=\"false\">\n</serv-cap-notify-served-user>\n<serv-cap-notify-served-user-on-outbound-call provisioned=\"false\">\n</serv-cap-notify-served-user-on-outbound-call>\n<serv-cap-reveal-identity-to-caller provisioned=\"false\">\n</serv-cap-cap-reveal-identity-to-caller>\n<serv-cap-reveal-served-user-identity-to-caller provisioned=\"false\">\n</serv-cap-reveal-served-user-identity-to-caller>\n<serv-cap-reveal-identity-to-target provisioned=\"false\">\n</serv-cap-reveal-identity-to-target>\n</serv-cap-actions>\n</communication-diversion-serv-cap>\n\n6.\tHTTP 200 (OK) response (AP to UE) - see example in table A.1.7-6\nThe AP routes the HTTP 200 (OK) response to the UE.\nTable A.1.7-6: HTTP 200 (OK) response (AP to UE)\nHTTP/1.1 200 OK\nVia: HTTP/1.1 ap.home1.net\nDate: Thu, 16 Jun 2011 10:50:42 GMT\nAuthentication-Info: nextnonce=\"e966c32a924255e42c8ee20ce7f6\"\nEtag: \"eti87\"\nContent-Type: application/simservs+xml; charset=\"utf-8\"\nContent-Length: (...)\n\n(...)\n\n7.\tHTTP PUT request (UE to AP) - see example in table A.1.7-7\nThe UE creates a new rule to activate the CFU service. If a rule with id=\"rule1\" previously existed then the new rule replaces that rule. The rule has an empty <conditions> element.\nTable A.1.7-7: HTTP PUT request (UE to AP)\nPUT /simservs.ngn.etsi.org/users/sip:user1@home1.net/simservs.xml/~~/simservs/communication-diversion/ruleset/rule%5b@id=%22rule1%22%5d HTTP/1.1\nHost: xcap.mnc012.mcc345.ipxuni.3gppnetwork.org\nDate: Thu, 16 Jun 2011 10:52:33 GMT\nAuthorization: Digest realm=\"xcap.mnc012.mcc345.ipxuni.3gppnetwork.org\", nonce=\"e966c32a924255e42c8ee20ce7f6\", username=\"sip:user1@home1.net\", qop=auth-int,\nuri=\"/simservs.ngn.etsi.org/users/sip:user1@home1.net/simservs.xml/~~/simservs/communication-diversion/ruleset\", response=\"adq3283hww88whhjw98822333ddd32\", cnonce=\"wqesatt874873j3gg3kk39944hhhee\", nc=00000001\nX-3GPP-Intended-Identity: sip:user1@home1.net\nContent-Type: application/xcap-el+xml; charset=\"utf-8\"\nContent-Length: (…)\n\n<cp:rule id=\"rule1\">\n<cp:conditions>\n</cp:conditions>\n<cp:actions>\n<forward-to>\n<target>tel:+15556667777</target>\n<notify-caller>true</notify-caller>\n</forward-to>\n</cp:actions>\n</cp:rule>\n\n8.\tHTTP PUT request (AP to AS) - see example in table A.1.7-8\nThe AP forwards the HTTP PUT request to the AS.\nTable A.1.7-8: HTTP PUT request (AP to AS)\nPUT /simservs.ngn.etsi.org/users/sip:user1@home1.net/simservs.xml/~~/simservs/communication-diversion/ruleset/rule%5b@id=%22rule1%22%5d HTTP/1.1\nHost: xcap.mnc012.mcc345.ipxuni.3gppnetwork.org\nVia: HTTP/1.1 ap.home1.net\nDate: Thu, 16 Jun 2011 10:52:35 GMT\nX-3GPP-Asserted-Identity: sip:user1@home1.net\nContent-Type: application/xcap-el+xml; charset=\"utf-8\"\nContent-Length: (...)\n\n(...)\n\n9.\tHTTP 200 (OK) response (AS to AP) - see example in table A.1.7-9\nThe AS acknowledges the addition of the new CFU rule with a HTTP 200 (OK) response.\nTable A.1.7-9: HTTP 200 (OK) response (AS to AP)\nHTTP/1.1 200 OK\nDate: Thu, 16 Jun 2011 10:52:37 GMT\nEtag: \"efefefef\"\nContent-Length: 0\n\n10. \tHTTP 200 (OK) response (AP to UE) - see example in table A.1.7-10\nThe AP routes the HTTP 200 (OK) response to the UE.\nTable A.1.7-10: 200 (OK) response (AP to UE)\nHTTP/1.1 200 OK\nVia: HTTP/1.1 ap.home1.net\nDate: Thu, 16 Jun 2011 10:52:38 GMT\nAuthentication-Info: nextnonce=\"737jkjssj733hjjk3hjk3999ss3kj\"\nEtag: \"efefefef\"\nContent-Length: 0\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.2\tInterworking",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.2.1\tCommunication Forwarding unconditional",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure A.6b shows an example signalling flow for a successful communication forwarding unconditional based on an AS providing the forwarding, with the originating user in the PSTN.\nFigure A.6 b illustrates the process of call forwarding in an unconditional manner, where the call is automatically forwarded to the specified destination number without any user intervention. The figure depicts the call flow, starting from the original call, which is then forwarded to the new number. Key components include the original call, the call forwarding rule, and the destination number. The figure highlights the automatic nature of the forwarding process, ensuring that calls are quickly rerouted to the intended recipient.\nFigure A.6b: Call Forwarding Unconditional\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.2.2\tCommunication Deflection",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure A.7 shows an example signalling flow for a successful communication deflection based on an AS providing the forwarding, with the originating user in the PSTN.\nFigure A.7 illustrates the utilization of advanced modulation techniques in a wireless communication system, showcasing the efficient transmission of data through the use of orthogonal frequency-division multiplexing (OFDM) and channel coding. The figure demonstrates how these methods enhance the system's capacity and reliability, ensuring high-speed data transmission over the air interface. Key components include the transmitter, receiver, and various modulation and coding schemes, which work together to combat interference and ensure error-free communication.\nFigure A.7\nThis annex provides an example of a filter criterion that triggers SIP requests that are subject to initial filter criteria evaluation.\nAn example of an IFC when the CDIV supplementary service is active at the diverting S-CSCF is:\n-\tMethod:\t\tINVITE.\nIf the AS cannot suppress CDIV for a call identified as a PSAP callback, an IFC bypassing the CDIV AS can be used. An example IFC using the PSAP callback indicator specified in IETF RFC 7090 [28] is:\n-\tMethod:\t\t\"INVITE\" and Priority header field not containing a \"psap-callback\" header field value.\nThis annex provides an interpretation of the coding of the cause-param URI parameter specified in RFC 4458 [14]\nThe cause specified in RFC 4458 [14] has the following syntax:\ncause-param       =  \"cause=\" Status-Code\n\nThe Status-Code is originally specified in RFC 3261 [6] as a sequence of 3 digits. It is noted that the Status-Code simply indicates that it is composed of 3 digits, without indicating the list of possible values. In particular, Status-Code is not bound to and must not be confused with the 3 digit numbers defined for SIP responses in RFC 3261 [6]. The Status-Code is used to hold the redirecting reason.\nFor the purpose of legibility, the cause-param specified in RFC 4458 [14] is interpreted according to the following syntax:\ncause-param       =  \"cause=\" Status-Code\n\nStatus-Code       =  \"404\"  ;  Unknown/Not available\n/   \"486\"  ;  User Busy\n/   \"408\"  ;  No Reply\n/   \"302\"  ;  Unconditional\n/   \"487\"  ;  Deflection during alerting\n/   \"480\"  ;  Deflection during immediate response\n/   \"503\"  ;   subscriber not reachable\n\n\n\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 5,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "",
                            "table number": 6,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}