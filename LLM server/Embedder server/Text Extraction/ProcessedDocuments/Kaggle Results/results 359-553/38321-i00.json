{
    "document_name": "38321-i00.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document specifies the NR MAC protocol.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 38.300: \"NR; Overall description; Stage 2\".\n[3]\t3GPP TS 38.322: \"NR; Radio Link Control (RLC) protocol specification\".\n[4]\t3GPP TS 38.323: \"NR; Packet Data Convergence Protocol (PDCP) protocol specification\".\n[5]\t3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol specification\".\n[6]\t3GPP TS 38.213: \"NR; Physical Layer Procedures for control\".\n[7]\t3GPP TS 38.214: \"NR; Physical Layer Procedures for data\".\n[8]\t3GPP TS 38.211: \"NR; Physical channels and modulation\".\n[9]\t3GPP TS 38.212: \"NR; Multiplexing and channel coding\".\n[10]\tVoid.\n[11]\t3GPP TS 38.133: \"NR; Requirements for support of radio resource management\".\n[12]\t3GPP TS 36.133: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Requirements for support of radio resource management\".\n[13]\t3GPP TS 26.114: \"Technical Specification Group Services and System Aspects; IP Multimedia Subsystem (IMS); Multimedia Telephony; Media handling and interaction\".\n[14]\t3GPP TS 38.101-1: \"NR; User Equipment (UE) radio transmission and reception; Part 1: Range 1 Standalone\".\n[15]\t3GPP TS 38.101-2: \"NR; User Equipment (UE) radio transmission and reception; Part 2: Range 2 Standalone\".\n[16]\t3GPP TS 38.101-3: \"NR; User Equipment (UE) radio transmission and reception; Part 3: Range 1 and Range 2 Interworking operation with other radios\".\n[17]\t3GPP TS 36.213: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Physical Layer Procedures\".\n[18]\t3GPP TS 37.213: \"Physical layer procedures for shared spectrum channel access\".\n[19]\t3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to support Vehicle-to-Everything (V2X) services \".\n[20]\t3GPP TS 23.285: \"Architecture enhancements for V2X services\".\n[21]\t3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC); Protocol specification\".\n[22]\t3GPP TS 36.321: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Medium Access Control (MAC); Protocol specification\".\n[23]\t3GPP TS 37.355: \"Evolved Universal Terrestrial Radio Access (E-UTRA); LTE Positioning Protocol (LPP)\".\n[24]\t3GPP TS 38.215: \"NR; Physical layer measurements\".\n[25]\t3GPP TS 38.306: \"NR; User Equipment (UE) radio access capabilities\".\n[26]\t3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System (5GS)\".\n[27]\t3GPP TS 38.473: \"NG-RAN; F1 Application Protocol (F1AP)\".\n[28]\t3GPP TS 24.587: \" Technical Specification Group Core Network and Terminals; Vehicle-to-Everything (V2X) services in 5G System (5GS)\".\n[29]\t3GPP TS 24.554: \"Technical Specification Group Core Network and Terminals; Proximity-services (ProSe) in 5G System (5GS) protocol\".\n[30]\t3GPP TS 23.586: \"Technical Specification Group Services and System Aspects; Architectural Enhancements to support Ranging based services and Sidelink Positioning\".\n[31]\t3GPP TS 23.256: \"Support of Uncrewed Aerial Systems (UAS) connectivity, identification and tracking; Stage 2\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\nA2X communication: A communication to support A2X services leveraging PC5 reference points, as defined in TS 23.256 [31]. A2X services are realized by various types of A2X applications, e.g., BRID or DAA.\nAir to Ground network: An NG-RAN consisting of ground-based gNBs, which provide cell towers that send signals up to an aircraft's antenna(s) of onboard ATG terminal, with typical vertical altitude of around 10,000 m and take-off/landing altitudes down to 3000 m.\nBWP for SRS for positioning Tx frequency hopping: For SRS for positioning Tx frequency hopping, separate BWP configuration outside BWP configuration for data transmission.\nDormant BWP: The dormant BWP is one of downlink BWPs configured by the network via dedicated RRC signaling. In the dormant BWP, the UE stop monitoring PDCCH on/for the SCell, but continues performing CSI measurements, Automatic Gain Control (AGC) and beam management, if configured.\nDRX group: A group of Serving Cells that is configured by RRC and that have the same DRX Active Time.\neRedCap UE: A UE with enhanced reduced capabilities as specified in clause 4.2.22.1 of TS 38.306 [25].\nHARQ information: HARQ information for DL-SCH, for UL-SCH, or for SL-SCH transmissions consists of New Data Indicator (NDI), Transport Block Size (TBS), Redundancy Version (RV), and HARQ process ID.\nIAB-donor: gNB that provides network access to UEs via a network of backhaul and access links.\nIAB-node: RAN node that supports NR access links to UEs and NR backhaul links to parent nodes and child nodes.\nListen Before Talk: A procedure according to which transmissions are not performed if the channel is identified as being occupied, see TS 37.213 [18].\nLTM candidate cell: A candidate cell configured for LTM as defined in TS 38.331 [5].\nMsg3: Message transmitted on UL-SCH containing a C-RNTI MAC CE or CCCH SDU, submitted from upper layer and associated with the UE Contention Resolution Identity, as part of a Random Access procedure.\nMulti-path: Mode of operation of a remote UE in RRC_CONNECTED configured with one direct path on which the UE connects to gNB using NR Uu, and one indirect path on which the UE connects to the same gNB via a relay UE using L2 U2N relay operation or non-3GPP connectivity (N3C).\nMulti-path U2N N3C relay: AS functionality providing both direct path and indirect path via relay UE with non-3GPP connectivity.\nMulti-PUSCH configured grant: A configured grant configuration that includes multiple consecutive configured uplink grants within a single periodicity.\nNCR-Fwd: NCR-node function, which performs amplifying-and-forwarding of UL/DL RF signals between gNB and UE. The behavior of the NCR-Fwd is controlled according to the side control information received by the NCR-MT from a gNB.\nNCR-MT: NCR-node entity which communicates with a gNB via a control link to receive side control information. The control link is based on NR Uu interface.\nNCR-node: RAN node comprising NCR-MT and NCR-Fwd.\nNon-terrestrial network: An NG-RAN consisting of gNBs, which provide non-terrestrial NR access to UEs by means of an NTN payload embarked on an airborne or space-borne NTN vehicle and an NTN Gateway.\nNR backhaul link: NR link used for backhauling between an IAB-node and an IAB-donor, and between IAB-nodes in case of a multi-hop backhauling.\nNR sidelink communication: AS functionality enabling at least V2X Communication as defined in TS 23.287 [19] and ProSe communication (including ProSe non-Relay, UE-to-Network Relay and UE-to-UE Relay communication (including ProSe UE-to-UE Relay communication with integrated discovery)) as defined in TS 23.304 [26], between two or more nearby UEs, using NR technology but not traversing any network node.\nNR sidelink discovery: AS functionality enabling ProSe non-Relay discovery, ProSe UE-to-Network Relay discovery and ProSe UE-to-UE Relay discovery for Proximity based Services as defined in TS 23.304 [26], between two or more nearby UEs, using NR technology but not traversing any network node.\nNR sidelink transmission: Any NR Sidelink-based transmission, including transmission for NR sidelink discovery, transmission for NR sidelink communication, transmission of SL-PRS, and transmission for A2X communication.\nPDCCH occasion: A time duration (i.e. one or a consecutive number of symbols) during which the MAC entity is configured to monitor the PDCCH.\nPositioning SRS Bandwidth Aggregation: Transmission of positioning SRS on multiple carriers in RRC_CONNECTED and RRC_INACTIVE where the positioning SRS resources are linked in RRC configuration as defined in TS 38.331 [5].\nPRS Processing Window: A time window during which UE may perform PRS measurement inside the active DL BWP with the same numerology as the active DL BWP without measurement gap.\nRanging/Sidelink Positioning: AS functionality enabling ranging-based services and sidelink positioning as specified in TS 23.586 [30].\nRB set: A RB set refers to a contiguous set of resource blocks (RBs) on which a channel access procedure is performed in shared spectrum as defined in TS 37.213 [18].\nRedCap UE: A UE with reduced capabilities as specified in clause 4.2.21.1 in TS 38.306 [25].\nServing Cell: A PCell, a PSCell, or an SCell in TS 38.331 [5].\nSidelink transmission information: Sidelink transmission information included in an SCI for an SL-SCH transmission or SL-PRS transmission with or without SL-SCH transmission on SL-PRS shared resource pool as specified in clause 8.3 and 8.4 of TS 38.212 [9] consists of Sidelink HARQ information including NDI, RV, Sidelink process ID, HARQ feedback enabled/disabled indicator, Sidelink identification information including cast type indicator, Source Layer-1 ID and Destination Layer-1 ID, and Sidelink other information including CSI request, SL-PRS request, SL-PRS resource ID, a priority, a communication range requirement and Zone ID.\nSL-PRS delay budget: Delay budget before which the SL-PRS is expected to be transmitted by the Tx UE.\nSL-PRS dedicated resource pool: A sidelink resource pool which can be used for the transmission of SL-PRS and cannot be used for the transmission of PSSCH.\nSL-PRS shared resource pool: A sidelink resource pool which can be used for the transmission of both SL-PRS and PSSCH.\nSL-PRS transmission information on SL-PRS dedicated resource pool: SL-PRS transmission information on SL-PRS dedicated resource pool is included in an SCI for an SL-PRS transmission on SL-PRS dedicated resource pool, as specified in TS 38.212 [9], consisting of\n-\tSL-PRS identification information, including cast type indicator, source ID and destination ID;\n-\tSL-PRS transmission other information, including SL-PRS priority, SL-PRS request, SL-PRS resource ID and resource reservation period.\nSRS for positioning Tx frequency hopping: Transmit frequency hopping of positioning SRS in RRC_INACTIVE and RRC_CONNECTED.\nSRS positioning validity area: An area consisting of a list of cells within which the corresponding positioning SRS configuration is considered as valid.\nSpecial Cell: For Dual Connectivity operation the term Special Cell refers to the PCell of the MCG or the PSCell of the SCG depending on if the MAC entity is associated to the MCG or the SCG, respectively. Otherwise the term Special Cell refers to the PCell. A Special Cell supports PUCCH transmission and contention-based Random Access, and is always activated.\nTiming Advance Group: A group of Serving Cells that is configured by RRC and that, for the cells with a UL configured, using the same timing reference cell and the same Timing Advance value. A Timing Advance Group containing the SpCell of a MAC entity is referred to as Primary Timing Advance Group (PTAG), whereas the term Secondary Timing Advance Group (STAG) refers to other TAGs.\nUE-gNB RTT: For non-terrestrial networks, the sum of the UE's Timing Advance value (see TS 38.211 [8] clause 4.3.1) and kmac.\nV2X sidelink communication: AS functionality enabling V2X Communication as defined in TS 23.285 [20], between nearby UEs, using E-UTRA technology but not traversing any network node.\nNOTE 1:\tA timer is running once it is started, until it is stopped or until it expires; otherwise it is not running. A timer can be started if it is not running or restarted if it is running. A Timer is always started or restarted from its initial value. The duration of a timer is not updated until it is stopped or expires (e.g. due to BWP switching). When the MAC entity applies zero value for a timer, the timer shall be started and immediately expire unless explicitly stated otherwise.\nNOTE 2:\tIn this version of the specification, the SRS in the procedural description includes Positioning SRS except for the Positioning SRS for transmission in RRC_INACTIVE as in clause 5.26. Positioning SRS except for the Positioning SRS for transmission in RRC_INACTIVE is treated the same as SRS by the UE unless explicitly stated otherwise.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\nA2X\tAircraft-to-Everything\nAP\tAperiodic\nBFR\tBeam Failure Recovery\nBRID\tBroadcast Remote Identification\nBSR\tBuffer Status Report\nBWP\tBandwidth Part\nCE\tControl Element\nCG\tCell Group\nCG-SDT\tConfigured Grant-based SDT\nCI-RNTI\tCancellation Indication RNTI\nCSI\tChannel State Information\nCSI-IM\tCSI Interference Measurement\nCSI-RS\tCSI Reference Signal\nCS-RNTI\tConfigured Scheduling RNTI\nDAA\tDetect And Avoid\nDAPS\tDual Active Protocol Stack\nDCP\tDCI with CRC scrambled by PS-RNTI\nDL-PRS\tDownLink-Positioning Reference Signal\nDSR\tDelay Status Report\nDTX\tDiscontinuous Transmission\nG-CS-RNTI\tGroup Configured Scheduling RNTI\nG-RNTI\tGroup RNTI\nIAB\tIntegrated Access and Backhaul\nINT-RNTI\tInterruption RNTI\nLBT\tListen Before Talk\nLCG\tLogical Channel Group\nLCP\tLogical Channel Prioritization\nLTM\tL1/L2 Triggered Mobility\nMBS\tMulticast/Broadcast Services\nMCCH\tMBS Control Channel\nMCCH-RNTI\tMBS Control Channel RNTI\nMCG\tMaster Cell Group\nMO-SDT\tMobile Originated SDT\nMP\tMulti-path\nMPE\tMaximum Permissible Exposure\nMTCH\tMBS Traffic Channel\nMT-SDT\tMobile Terminated SDT\nN3C\tNon-3GPP Connection\nNCD-SSB\tNon Cell Defining SSB\nNCR\tNetwork-Controlled Repeater\nNSAG\tNetwork Slice AS Group\nNUL\tNormal Uplink\nNZP CSI-RS\tNon-Zero Power CSI-RS\nPDB\tPacket Delay Budget\nPEI-RNTI\tPaging Early Indication RNTI\nPHR\tPower Headroom Report\nPQI\tPC5 QoS Identifier\nPS-RNTI\tPower Saving RNTI\nPSI\tPDU Set Importance\nPTAG\tPrimary Timing Advance Group\nPTM\tPoint to Multipoint\nPTP\tPoint to Point\nQCL\tQuasi-colocation\nPPW\tPRS Processing Window\nPRS\tPositioning Reference Signal\nRA-SDT\tRandom Access-based SDT\nRRH\tRemote Radio Head\nRS\tReference Signal\nSCG\tSecondary Cell Group\nSDT\tSmall Data Transmission\nSFI-RNTI\tSlot Format Indication RNTI\nSI\tSystem Information\nSL-PRS-CS-RNTI\tSL-PRS Configured Scheduling RNTI\nSL-PRS-RNTI\tSL-PRS RNTI\nSL-CS-RNTI\tSidelink Configured Scheduling RNTI\nSL-PRS\tSidelink PRS\nSL-RNTI\tSidelink RNTI\nSpCell\tSpecial Cell\nSP\tSemi-Persistent\nSP-CSI-RNTI\tSemi-Persistent CSI RNTI\nSPS\tSemi-Persistent Scheduling\nSR\tScheduling Request\nSRI\tSRS Resource Indicator\nSS\tSynchronization Signals\nSSB\tSynchronization Signal Block\nSTAG\tSecondary Timing Advance Group\nSUL\tSupplementary Uplink\nTAG\tTiming Advance Group\nTCI\tTransmission Configuration Indicator\nTPC-SRS-RNTI\tTransmit Power Control-Sounding Reference Signal-RNTI\nTRIV\tTime Resource Indicator Value\nTRP\tTransmit/Receive Point\nTRS\tCSI-RS for tracking\nU2N\tUE-to-Network\nU2U\tUE-to-UE\nUCI\tUplink Control Information\nUTO-UCI\tUnused Transmission Occasion - UCI\nUTW\tUplink Time Window\nV2X\tVehicle-to-Everything\nZP CSI-RS\tZero Power CSI-RS\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tGeneral",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "The objective of this clause is to describe the MAC architecture and the MAC entity of the UE from a functional point of view.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tMAC architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2.1\tGeneral",
                            "text_content": "This clause describes a model of the MAC i.e. it does not specify or restrict implementations.\nRRC is in control of the MAC configuration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.2\tMAC Entities",
                            "text_content": "The MAC entity of the UE handles the following transport channels:\n-\tBroadcast Channel (BCH);\n-\tDownlink Shared Channel(s) (DL-SCH);\n-\tPaging Channel (PCH);\n-\tUplink Shared Channel(s) (UL-SCH);\n-\tRandom Access Channel(s) (RACH).\nWhen the UE is configured with SCG, two MAC entities are configured to the UE: one for the MCG and one for the SCG.\nWhen the UE is configured with DAPS handover, two MAC entities are used by the UE: one for the source cell (source MAC entity) and one for the target cell (target MAC entity).\nThe functions of the different MAC entities in the UE operate independently unless otherwise specified. The timers and parameters used in each MAC entity are configured independently unless otherwise specified. The Serving Cells, C-RNTI, radio bearers, logical channels, upper and lower layer entities, LCGs, and HARQ entities considered by each MAC entity refer to those mapped to that MAC entity unless otherwise specified.\nIf the MAC entity is configured with one or more SCells, there are multiple DL-SCH and there may be multiple UL-SCH as well as multiple RACH per MAC entity; one DL-SCH, one UL-SCH, and one RACH on the SpCell, one DL-SCH, zero or one UL-SCH and zero or one RACH for each SCell.\nIf the MAC entity is not configured with any SCell, there is one DL-SCH, one UL-SCH, and one RACH per MAC entity.\nIf the UE is configured with LTM candidate cell(s), there may be zero or one RACH for each LTM candidate cell, which shares the same corresponding MAC entity with Serving Cell.\nFigure 4.2.2-1 illustrates one possible structure of the MAC entity when SCG is not configured and for each MAC entity during DAPS handover.\nThe figure depicts a simplified overview of the MAC structure in a 5G network, illustrating the various components and their interconnections. The figure includes a base station (gNB), user equipment (UE), and scatterers, with key components such as the radio interface (RIL), radio resource management (RRM), and radio resource allocation (RRA). The diagram highlights the use of beamforming techniques to mitigate interference, and the presence of redundancy paths ensures failover reliability. The layered design aligns with SDN principles, allowing for efficient network management and control.\nFigure 4.2.2-1: MAC structure overview\nFigure 4.2.2-2 illustrates one possible structure for the MAC entities when MCG and SCG are configured.\nThe figure depicts a simplified overview of the MAC structure in a 5G network, with two MAC entities (Media Access Control) and a MAC header. The figure illustrates the various MAC functions, such as data transmission, error detection, and retransmission, as well as the MAC header, which contains information about the network and the MAC layer. The figure is useful for understanding the structure and functions of the 5G network's MAC layer.\nFigure 4.2.2-2: MAC structure overview with two MAC entities\nIn addition, the MAC entity of the UE handles the following transport channel for sidelink:\n-\tSidelink Shared Channel (SL-SCH);\n-\tSidelink Broadcast Channel (SL-BCH).\nFigure 4.2.2-3 illustrates one possible structure for the MAC entity when sidelink is configured.\nThe figure depicts a simplified overview of the MAC structure for sidelink communication, highlighting the various components and their roles in the network.\nFigure 4.2.2-3: MAC structure overview for sidelink\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.3\tServices",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.3.1\tServices provided to upper layers",
                            "text_content": "The MAC sublayer provides the following services to upper layers:\n-\tdata transfer;\n-\tradio resource allocation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.2\tServices expected from physical layer",
                            "text_content": "The MAC sublayer expects the following services from the physical layer:\n-\tdata transfer services;\n-\tsignalling of HARQ feedback;\n-\tsignalling of Scheduling Request;\n-\tmeasurements (e.g. Channel Quality Indication (CQI)).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.4\tFunctions",
                    "description": "",
                    "summary": "",
                    "text_content": "The MAC sublayer supports the following functions:\n-\tmapping between logical channels and transport channels;\n-\tmultiplexing of MAC SDUs from one or different logical channels onto transport blocks (TB) to be delivered to the physical layer on transport channels;\n-\tdemultiplexing of MAC SDUs to one or different logical channels from transport blocks (TB) delivered from the physical layer on transport channels;\n-\tscheduling information reporting;\n-\terror correction through HARQ;\n-\tlogical channel prioritization;\n-\tpriority handling between overlapping resources of one UE;\n-\tradio resource selection.\nThe relevance of MAC functions for uplink, downlink, and sidelink is indicated in Table 4.4-1.\nTable 4.4-1: The link direction association of MAC functions.\n\n",
                    "tables": [
                        {
                            "description": "Table 4.4-1: The link direction association of MAC functions.",
                            "table number": 1,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.5\tChannel structure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.5.1\tGeneral",
                            "text_content": "The MAC sublayer operates on the channels defined below; transport channels are SAPs between MAC and Layer 1, logical channels are SAPs between MAC and RLC.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.2\tTransport Channels",
                            "text_content": "The MAC sublayer uses the transport channels listed in Table 4.5.2-1 below.\nTable 4.5.2-1: Transport channels used by MAC\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.5.2-1: Transport channels used by MAC",
                                    "table number": 2,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "4.5.3\tLogical Channels",
                            "text_content": "The MAC sublayer provides data transfer services on logical channels. To accommodate different kinds of data transfer services, multiple types of logical channels are defined i.e. each supporting transfer of a particular type of information.\nEach logical channel type is defined by what type of information is transferred.\nThe MAC sublayer provides the control and traffic channels listed in Table 4.5.3-1 below.\nTable 4.5.3-1: Logical channels provided by MAC.\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.5.3-1: Logical channels provided by MAC.",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "4.5.4\tMapping of Transport Channels to Logical Channels",
                            "text_content": "The MAC entity is responsible for mapping logical channels onto transport channels. This mapping depends on the multiplexing that is configured by RRC.\nThe uplink logical channels can be mapped as described in Table 4.5.4.2-1.\nTable 4.5.4.2-1: Uplink channel mapping.\n\nThe downlink logical channels can be mapped as described in Table 4.5.4.3-1.\nTable 4.5.4.3-1: Downlink channel mapping.\n\nThe sidelink logical channels can be mapped as described in Table 4.5.4.4-1.\nTable 4.5.4.4-1: Sidelink channel mapping.\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.5.4.2-1: Uplink channel mapping.",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.5.4.3-1: Downlink channel mapping.",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.5.4.4-1: Sidelink channel mapping.",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "5\tMAC procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tRandom Access procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.1.1\tRandom Access procedure initialization",
                            "text_content": "The Random Access procedure described in this clause is initiated by a PDCCH order, by the MAC entity itself, or by RRC for the events in accordance with TS 38.300 [2]. There is only one Random Access procedure ongoing at any point in time in a MAC entity. The Random Access procedure on an SCell or an LTM candidate cell shall only be initiated by a PDCCH order with ra-PreambleIndex different from 0b000000.\nNOTE 1:\tIf a new Random Access procedure is triggered while another is already ongoing in the MAC entity, it is up to UE implementation whether to continue with the ongoing procedure or start with the new procedure (e.g. for SI request).\nNOTE 2:\tIf there was an ongoing Random Access procedure that is triggered by a PDCCH order while the UE receives another PDCCH order indicating the same Random Access Preamble, PRACH mask index and uplink carrier, the Random Access procedure is considered as the same Random Access procedure as the ongoing one and not initialized again.\nWhen a Random Access procedure is initiated, UE selects a set of Random Access resources as specified in clause 5.1.1b and initialises the following parameters for the Random Access procedure according to the values configured by RRC for the selected set of Random Access resources:\n-\tprach-ConfigurationIndex: the available set of PRACH occasions for the transmission of the Random Access Preamble for Msg1. These are also applicable to the MSGA PRACH if the PRACH occasions are shared between 2-step and 4-step RA types;\n-\tprach-ConfigurationPeriodScaling-IAB: the scaling factor defined in TS 38.211 [8] and applicable to IAB-MTs, extending the periodicity of the PRACH occasions baseline configuration indicated by prach-ConfigurationIndex;\n-\tprach-ConfigurationFrameOffset-IAB: the frame offset defined in TS 38.211 [8] and applicable to IAB-MTs, altering the ROs frame defined in the baseline configuration indicated by prach-ConfigurationIndex;\n-\tprach-ConfigurationSOffset-IAB: the subframe/slot offset defined in TS 38.211 [8] and applicable to IAB-MTs, altering the ROs subframe or slot defined in the baseline configuration indicated by prach-ConfigurationIndex;\n-\tmsgA-PRACH-ConfigurationIndex: the available set of PRACH occasions for the transmission of the Random Access Preamble for MSGA in 2-step RA type;\n-\tpreambleReceivedTargetPower: initial Random Access Preamble power for 4-step RA type;\n-\tmsgA-PreambleReceivedTargetPower: initial Random Access Preamble power for 2-step RA type;\n-\trsrp-ThresholdSSB: an RSRP threshold for the selection of the SSB for 4-step RA type. If the Random Access procedure is initiated for beam failure recovery, rsrp-ThresholdSSB used for the selection of the SSB within candidateBeamRSList refers to rsrp-ThresholdSSB in BeamFailureRecoveryConfig IE;\n-\trsrp-ThresholdCSI-RS: an RSRP threshold for the selection of CSI-RS for 4-step RA type. If the Random Access procedure is initiated for beam failure recovery, rsrp-ThresholdCSI-RS is equal to rsrp-ThresholdSSB in BeamFailureRecoveryConfig IE;\n-\tmsgA-RSRP-ThresholdSSB: an RSRP threshold for the selection of the SSB for 2-step RA type;\n-\trsrp-ThresholdSSB-SUL: an RSRP threshold for the selection between the NUL carrier and the SUL carrier;\n-\tmsgA-RSRP-Threshold: an RSRP threshold for selection between 2-step RA type and 4-step RA type when both 2-step and 4-step RA type Random Access Resources are configured in the UL BWP;\n-\trsrp-ThresholdMsg1-RepetitionNum2: an RSRP threshold for Msg1 repetition with repetition number 2 (see clause 5.1.1b);\n-\trsrp-ThresholdMsg1-RepetitionNum4: an RSRP threshold for Msg1 repetition with repetition number 4 (see clause 5.1.1b);\n-\trsrp-ThresholdMsg1-RepetitionNum8: an RSRP threshold for Msg1 repetition with repetition number 8 (see clause 5.1.1b);\n-\trsrp-ThresholdMsg3: an RSRP threshold for Msg3 repetition (see clause 5.1.1b);\n-\tFeatureCombination: feature or a combination of features associated with a set of Random Access resources;\n-\tfeaturePriorities: priorities for features, such as (e)RedCap, Slicing, etc. (see clause 5.1.1d);\n-\tmsgA-TransMax: The maximum number of MSGA transmissions when both 4-step and 2-step RA type Random Access Resources are configured;\n-\tcandidateBeamRSList: a list of reference signals (CSI-RS and/or SSB) identifying the candidate beams for recovery and the associated Random Access parameters;\n-\trecoverySearchSpaceId: the search space identity for monitoring the response of the beam failure recovery request;\n-\tpowerRampingStep: the power-ramping factor;\n-\tmsgA-PreamblePowerRampingStep: the power ramping factor for MSGA preamble;\n-\tpowerRampingStepHighPriority: the power-ramping factor in case of prioritized Random Access procedure;\n-\tscalingFactorBI: a scaling factor for prioritized Random Access procedure;\n-\tra-PreambleIndex: Random Access Preamble;\n-\tra-ssb-OccasionMaskIndex: defines PRACH occasion(s) associated with an SSB in which the MAC entity may transmit a Random Access Preamble (see clause 7.4);\n-\tmsgA-SSB-SharedRO-MaskIndex: Indicates the subset of 4-step RA type PRACH occasions shared with 2-step RA type PRACH occasions for each SSB. If 2-step RA type PRACH occasions are shared with 4-step RA type PRACH occasions and msgA-SSB-SharedRO-MaskIndex is not configured, then all 4-step RA type PRACH occasions are available for 2-step RA type (see clause 7.4);\n-\tssb-SharedRO-MaskIndex: defines PRACH occasions, on which preambles are allocated for a feature or a combination of features, associated with an SSB in which the MAC entity may transmit a Random Access Preamble (see clause 7.4);\n-\tra-OccasionList: defines PRACH occasion(s) associated with a CSI-RS in which the MAC entity may transmit a Random Access Preamble;\n-\tra-PreambleStartIndex: the starting index of Random Access Preamble(s) for on-demand SI request;\n-\tstartPreambleForThisPartition: the first preamble associated with the set of Random Access Resources applicable to the Random Access procedure;\n-\tpreambleTransMax: the maximum number of Random Access Preamble transmission;\n-\tpreambleTransMax-Msg1-Repetition: the maximum number of Random Access Preamble transmissions with a given Msg1 repetition number before switching to Msg1 repetition with the next available higher Msg1 repetition number;\n-\tssb-perRACH-OccasionAndCB-PreamblesPerSSB: defines the number of SSBs mapped to each PRACH occasion for 4-step RA type and the number of contention-based Random Access Preambles mapped to each SSB;\n-\tmsgA-CB-PreamblesPerSSB-PerSharedRO: defines the number of contention-based Random Access Preambles for 2-step RA type mapped to each SSB when the PRACH occasions are shared between 2-step and 4-step RA types;\n-\tmsgA-SSB-PerRACH-OccasionAndCB-PreamblesPerSSB: defines the number of SSBs mapped to each PRACH occasion for 2-step RA type and the number of contention-based Random Access Preambles mapped to each SSB;\n-\tnumberOfPreamblesPerSSB-ForThisPartition: defines the number of consecutive preambles for a feature or a combination of features mapped to each SSB;\n-\tmsgA-PUSCH-ResourceGroupA: defines MSGA PUSCH resources that the UE shall use when performing MSGA transmission using Random Access Preambles group A;\n-\tmsgA-PUSCH-ResourceGroupB: defines MSGA PUSCH resources that the UE shall use when performing MSGA transmission using Random Access Preambles group B;\n-\tmsgA-PUSCH-Resource-Index: identifies the index of the PUSCH resource used for MSGA in case of contention-free Random Access with 2-step RA type;\n-\tif groupBconfigured is configured, then Random Access Preambles group B is configured for 4-step RA type.\n-\tAmongst the contention-based Random Access Preambles associated with an SSB (as defined in TS 38.213 [6]), the first numberOfRA-PreamblesGroupA included in groupBconfigured Random Access Preambles belong to Random Access Preambles group A. The remaining Random Access Preambles associated with the SSB belong to Random Access Preambles group B (if configured).\n-\tif groupB-ConfiguredTwoStepRA is configured, then Random Access Preambles group B is configured for 2-step RA type.\n-\tAmongst the contention-based Random Access Preambles for 2-step RA type associated with an SSB (as defined in TS 38.213 [6]), the first numberOfRA-PreamblesGroupA included in GroupB-ConfiguredTwoStepRA Random Access Preambles belong to Random Access Preambles group A. The remaining Random Access Preambles associated with the SSB belong to Random Access Preambles group B (if configured).\nNOTE 3:\tIf Random Access Preambles group B is supported by the cell Random Access Preambles group B is included for each SSB.\n-\tif Random Access Preambles group B is configured for 4-step RA type:\n-\tra-Msg3SizeGroupA: the threshold to determine the groups of Random Access Preambles for 4-step RA type;\n-\tmsg3-DeltaPreamble: ∆PREAMBLE_Msg3 in TS 38.213 [6];\n-\tmessagePowerOffsetGroupB: the power offset for preamble selection included in groupBconfigured;\n-\tnumberOfRA-PreamblesGroupA: defines the number of Random Access Preambles in Random Access Preamble group A for each SSB included in groupBconfigured.\n-\tif Random Access Preambles group B is configured for 2-step RA type:\n-\tmsgA-DeltaPreamble: ∆MsgA_PUSCH in TS 38.213 [6];\n-\tmessagePowerOffsetGroupB: the power offset for preamble selection included in GroupB-ConfiguredTwoStepRA;\n-\tnumberOfRA-PreamblesGroupA: defines the number of Random Access Preambles in Random Access Preamble group A for each SSB included in GroupB-ConfiguredTwoStepRA;\n-\tra-MsgA-SizeGroupA: the threshold to determine the groups of Random Access Preambles for 2-step RA type.\n-\tthe set of Random Access Preambles and/or PRACH occasions for SI request, if any;\n-\tthe set of Random Access Preambles and/or PRACH occasions for beam failure recovery request, if any;\n-\tthe set of Random Access Preambles and/or PRACH occasions for reconfiguration with sync, if any;\n-\tra-ResponseWindow: the time window to monitor RA response(s) (SpCell only);\n-\tra-ContentionResolutionTimer: the Contention Resolution Timer (SpCell only);\n-\tmsgB-ResponseWindow: the time window to monitor RA response(s) for 2-step RA type (SpCell only).\nIn addition, the following information for related Serving Cell is assumed to be available for UEs:\n-\tif Random Access Preambles group B is configured:\n-\tif the Serving Cell for the Random Access procedure is configured with supplementary uplink as specified in TS 38.331 [5], and SUL carrier is selected for performing Random Access Procedure:\n-\tPCMAX,f,c of the SUL carrier as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16].\n-\telse:\n-\tPCMAX,f,c of the NUL carrier as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16].\nThe following UE variables are used for the Random Access procedure:\n-\tPREAMBLE_INDEX;\n-\tPREAMBLE_TRANSMISSION_COUNTER;\n-\tPREAMBLE_POWER_RAMPING_COUNTER;\n-\tPREAMBLE_POWER_RAMPING_STEP;\n-\tPREAMBLE_RECEIVED_TARGET_POWER;\n-\tPREAMBLE_BACKOFF;\n-\tPCMAX;\n-\tSCALING_FACTOR_BI;\n-\tTEMPORARY_C-RNTI;\n-\tRA_TYPE;\n-\tPOWER_OFFSET_2STEP_RA;\n-\tMSGA_PREAMBLE_POWER_RAMPING_STEP.\nWhen the Random Access procedure is initiated on a Serving Cell or to an LTM candidate cell, the MAC entity shall:\n1>\tflush the Msg3 buffer;\n1>\tflush the MSGA buffer;\n1>\tset the PREAMBLE_TRANSMISSION_COUNTER to 1;\n1>\tif the Random Access procedure is initiated on a Serving Cell; or\n1>\tif the Random Access procedure is initiated by the PDCCH order to an LTM candidate cell and the PDCCH order indicates preamble initial transmission; or\n1>\tif the Random Access procedure is initiated by the PDCCH order to an LTM candidate cell, which is different from the LTM candidate cell to perform the last Random Access Preamble transmission initiated by the PDCCH order to an LTM candidate cell, and the PDCCH order indicates preamble re-transmission:\n2>\tset the PREAMBLE_POWER_RAMPING_COUNTER to 1;\n1>\tset the PREAMBLE_BACKOFF to 0 ms;\n1>\tset POWER_OFFSET_2STEP_RA to 0 dB;\n1>\tif the carrier to use for the Random Access procedure is explicitly signalled:\n2>\tselect the signalled carrier for performing Random Access procedure;\n2>\tset the PCMAX to PCMAX,f,c of the signalled carrier.\n1>\telse if the carrier to use for the Random Access procedure is not explicitly signalled; and\n1>\tif the Serving Cell for the Random Access procedure is configured with supplementary uplink as specified in TS 38.331 [5]; and\n1>\tif the RSRP of the downlink pathloss reference is less than rsrp-ThresholdSSB-SUL:\n2>\tselect the SUL carrier for performing Random Access procedure;\n2>\tset the PCMAX to PCMAX,f,c of the SUL carrier.\n1>\telse:\n2>\tselect the NUL carrier for performing Random Access procedure;\n2>\tset the PCMAX to PCMAX,f,c of the NUL carrier.\nNOTE 4:\tVoid.\n1>\tperform the BWP operation as specified in clause 5.15, except when the Random Access procedure is initiated by the PDCCH order to an LTM candidate cell;\n1>\tselect the set of Random Access resources applicable to the current Random Access procedure according to clause 5.1.1b;\n1>\tif the Random Access procedure is initiated by PDCCH order and if the ra-PreambleIndex explicitly provided by PDCCH is not 0b000000; or\n1>\tif the Random Access procedure was initiated for SI request (as specified in TS 38.331 [5]) and the Random Access Resources for SI request have been explicitly provided by RRC; or\n1>\tif the Random Access procedure was initiated for SpCell beam failure recovery (as specified in clause 5.17) and if the contention-free Random Access Resources for beam failure recovery request for 4-step RA type have been explicitly provided by RRC for the BWP selected for Random Access procedure; or\n1>\tif the Random Access procedure was initiated for reconfiguration with sync and if the contention-free Random Access Resources for 4-step RA type have been explicitly provided in rach-ConfigDedicated for the BWP selected for Random Access procedure; or\n1>\tif the Random Access procedure was initiated for LTM cell switch and if the contention-free Random Access Resources have been explicitly provided in LTM Cell Switch Command MAC CE:\n2>\tset the RA_TYPE to 4-stepRA.\n1>\telse if the BWP selected for Random Access procedure is configured with both 2-step and 4-step RA type Random Access Resources within the selected set of Random Access resources (as specified in clause 5.1.1b) and the RSRP of the downlink pathloss reference is above msgA-RSRP-Threshold; or\n1>\tif the BWP selected for Random Access procedure is only configured with 2-step RA type Random Access resources within the selected set of Random Access resources according to clause 5.1.1b; or\n1>\tif the Random Access procedure was initiated for reconfiguration with sync and if the contention-free Random Access Resources for 2-step RA type have been explicitly provided in rach-ConfigDedicated for the BWP selected for Random Access procedure:\n2>\tset the RA_TYPE to 2-stepRA.\n1>\telse:\n2>\tset the RA_TYPE to 4-stepRA.\n1>\tperform initialization of variables specific to Random Access type as specified in clause 5.1.1a;\n1>\tif RA_TYPE is set to 2-stepRA:\n2>\tperform the Random Access Resource selection procedure for 2-step RA type (see clause 5.1.2a).\n1>\telse:\n2>\tperform the Random Access Resource selection procedure (see clause 5.1.2).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.1a\tInitialization of variables specific to Random Access type",
                            "text_content": "The MAC entity shall:\n1>\tif RA_TYPE is set to 2-stepRA:\n2>\tset PREAMBLE_POWER_RAMPING_STEP to msgA-PreamblePowerRampingStep;\n2>\tset SCALING_FACTOR_BI to 1;\n2>\tapply preambleTransMax included in the RACH-ConfigGenericTwoStepRA;\n2>\tif the Random Access procedure was initiated for reconfiguration with sync or for SCG activation; and\n2>\tif cfra-TwoStep is configured for the selected carrier:\n3>\tif msgA-TransMax is configured in the cfra-TwoStep:\n4>\tapply msgA-TransMax configured in the cfra-TwoStep.\n2>\telse if msgA-TransMax is included in the RACH-ConfigCommonTwoStepRA:\n3>\tapply msgA-TransMax included in the RACH-ConfigCommonTwoStepRA.\n2>\tif the Random Access procedure was initiated for SpCell beam failure recovery (as specified in clause 5.17); and\n2>\tif beamFailureRecoveryConfig is configured for the active UL BWP of the selected carrier; and\n2>\tif ra-PrioritizationTwoStep is configured in the beamFailureRecoveryConfig:\n3>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority included in the ra-PrioritizationTwoStep in beamFailureRecoveryConfig;\n3>\tif scalingFactorBI is configured in the ra-PrioritizationTwoStep in beamFailureRecoveryConfig:\n4>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\telse if the Random Access procedure was initiated for reconfiguration with sync or for SCG activation; and\n2>\tif rach-ConfigDedicated is configured for the selected carrier; and\n2>\tif ra-PrioritizationTwoStep is configured in the rach-ConfigDedicated:\n3>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority included in the ra-PrioritizationTwoStep in rach-ConfigDedicated;\n3>\tif scalingFactorBI is configured in ra-PrioritizationTwoStep in the rach-ConfigDedicated:\n4>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\telse if both ra-PrioritizationForSlicingTwoStep for a NSAG-ID and ra-PrioritizationForAccessIdentityTwoStep are configured for the selected carrier; and\n2>\tif the MAC entity is provided by upper layers with both this NSAG-ID and Access Identity 1 or 2; and\n2>\tif for at least one of these Access Identities the corresponding bit in the ra-PrioritizationForAI is set to one:\n3>\tif enableRA-PrioritizationForSlicing is set to true:\n4>\tif powerRampingStepHighPriority is configured in the ra-PrioritizationForSlicingTwoStep for this NSAG-ID:\n5>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.\n4>\tif scalingFactorBI is configured in the ra-PrioritizationForSlicingTwoStep for this NSAG-ID:\n5>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n3>\telse if enableRA-PrioritizationForSlicing is set to false:\n4>\tif powerRampingStepHighPriority is configured in the ra-PrioritizationForAccessIdentityTwoStep:\n5>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.\n4>\tif scalingFactorBI is configured in the ra-PrioritizationForAccessIdentityTwoStep:\n5>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\telse if ra-PrioritizationForSlicingTwoStep for a NSAG-ID is configured for the selected carrier; and\n2>\tif the MAC entity is provided by upper layers with this NSAG-ID:\n3>\tif powerRampingStepHighPriority is configured in the ra-PrioritizationForSlicingTwoStep for this NSAG-ID:\n4>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.\n3>\tif scalingFactorBI is configured in the ra-PrioritizationForSlicingTwoStep for this NSAG-ID:\n4>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\telse if ra-PrioritizationForAccessIdentityTwoStep is configured for the selected carrier; and\n2>\tif the MAC entity is provided by upper layers with Access Identity 1 or 2; and\n2>\tif for at least one of these Access Identities the corresponding bit in the ra-PrioritizationForAI is set to one:\n3>\tif powerRampingStepHighPriority is configured in the ra-PrioritizationForAccessIdentityTwoStep:\n4>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.\n3>\tif scalingFactorBI is configured in the ra-PrioritizationForAccessIdentityTwoStep:\n4>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\tset MSGA_PREAMBLE_POWER_RAMPING_STEP to PREAMBLE_POWER_RAMPING_STEP.\n1>\telse (i.e. RA_TYPE is set to 4-stepRA):\n2>\tset PREAMBLE_POWER_RAMPING_STEP to powerRampingStep;\n2>\tset SCALING_FACTOR_BI to 1;\n2>\tset preambleTransMax to preambleTransMax included in the RACH-ConfigGeneric;\n2>\tif the Random Access procedure was initiated for SpCell beam failure recovery (as specified in clause 5.17); and\n2>\tif beamFailureRecoveryConfig is configured for the active UL BWP of the selected carrier:\n3>\tstart the beamFailureRecoveryTimer, if configured;\n3>\tapply the parameters powerRampingStep, preambleReceivedTargetPower, and preambleTransMax configured in the beamFailureRecoveryConfig.\n2>\tif the Random Access procedure was initiated for beam failure recovery (as specified in clause 5.17); and\n2>\tif beamFailureRecoveryConfig is configured for the active UL BWP of the selected carrier; and\n2>\tif ra-Prioritization is configured in the beamFailureRecoveryConfig:\n3>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority included in the ra-Prioritization in beamFailureRecoveryConfig;\n3>\tif scalingFactorBI is configured in ra-Prioritization in the beamFailureRecoveryConfig:\n4>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\telse if the Random Access procedure was initiated for reconfiguration with sync or for SCG activation; and\n2>\tif rach-ConfigDedicated is configured for the selected carrier; and\n2>\tif ra-Prioritization is configured in the rach-ConfigDedicated:\n3>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority included in the ra-Prioritization in rach-ConfigDedicated;\n3>\tif scalingFactorBI is configured in ra-Prioritization in the rach-ConfigDedicated:\n4>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\telse if both ra-PrioritizationForSlicing for a NSAG-ID and ra-PrioritizationForAccessIdentity are configured for the selected carrier; and\n2>\tif the MAC entity is provided by upper layers with both this NSAG-ID and Access Identity 1 or 2; and\n2>\tif for at least one of these Access Identities the corresponding bit in the ra-PrioritizationForAI is set to one:\n3>\tif enableRA-PrioritizationForSlicing is set to true:\n4>\tif powerRampingStepHighPriority is configured in the ra-PrioritizationForSlicing for this NSAG-ID:\n5>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.\n4>\tif scalingFactorBI is configured in the ra-PrioritizationForSlicing for this NSAG-ID:\n5>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n3>\telse if enableRA-PrioritizationForSlicing is set to false:\n4>\tif powerRampingStepHighPriority is configured in the ra-PrioritizationForAccessIdentity:\n5>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.\n4>\tif scalingFactorBI is configured in the ra-PrioritizationForAccessIdentity:\n5>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\telse if ra-PrioritizationForSlicing for a NSAG-ID is configured for the selected carrier; and\n2>\tif the MAC entity is provided by upper layers with this NSAG-ID:\n3>\tif powerRampingStepHighPriority is configured in the ra-PrioritizationForSlicing for this NSAG-ID:\n4>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.\n3>\tif scalingFactorBI is configured in the ra-PrioritizationForSlicing for this NSAG-ID:\n4>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\telse if ra-PrioritizationForAccessIdentity is configured for the selected carrier; and\n2>\tif the MAC entity is provided by upper layers with Access Identity 1 or 2; and\n2>\tif for at least one of these Access Identities the corresponding bit in the ra-PrioritizationForAI is set to one:\n3>\tif powerRampingStepHighPriority is configured in the ra-PrioritizationForAccessIdentity:\n4>\tset PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.\n3>\tif scalingFactorBI is configured in the ra-PrioritizationForAccessIdentity:\n4>\tset SCALING_FACTOR_BI to the scalingFactorBI.\n2>\tif RA_TYPE is switched from 2-stepRA to 4-stepRA during this Random Access procedure:\n3>\tset POWER_OFFSET_2STEP_RA to (PREAMBLE_POWER_RAMPING_COUNTER – 1) × (MSGA_PREAMBLE_POWER_RAMPING_STEP – PREAMBLE_POWER_RAMPING_STEP).\nNOTE:\tIf enableRA-PrioritizationForSlicing is not configured in BWP-UplinkCommon and if both the provided NSAG-ID and the provided Access Identity whose corresponding bit in the ra-PrioritizationForAI is set to one are configured with ra-Prioritization either in RACH-ConfigCommon or RACH-ConfigCommonTwoStepRA, it is up to UE implementation how to determine the values of PREAMBLE_POWER_RAMPING_STEP and SCALING_FACTOR_BI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.1b\tSelection of the set of Random Access resources for the Random Access procedure",
                            "text_content": "The MAC entity shall:\n1>\tif the BWP selected for Random Access procedure is configured with both set(s) of Random Access resources with msg3-Repetitions set to true and set(s) of Random Access resources without msg3-Repetitions set to true and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg3; or\n1>\tif the BWP selected for Random Access procedure is only configured with the set(s) of Random Access resources with msg3-Repetitions set to true:\n2>\tassume Msg3 repetition is applicable for the current Random Access procedure.\n1>\telse:\n2>\tassume Msg3 repetition is not applicable for the current Random Access procedure.\n1>\tif contention-free Random Access Resources have been provided for this Random Access procedure and a Msg1 repetition number is indicated in rach-ConfigDedicated:\n2>\tassume Msg1 repetition is applicable and Msg1 repetition number applicable for the current Random Access procedure is the Msg1 repetition number indicated in rach-ConfigDedicated.\n1>\telse if contention free Random Access Resources have not been provided for this Random Access procedure and the BWP selected for the Random Access procedure is configured with set(s) of Random Access resources with msg1-Repetitions set to true and set(s) of Random Access resources without msg1-Repetitions set to true:\n2>\tif the BWP selected for the Random Access procedure is configured with set(s) of Random Access resources associated with Msg1 repetition number 8 and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum8:\n3>\tassume Msg1 repetition is applicable and Msg1 repetition number applicable for the current Random Access procedure includes 8.\n2>\tif the BWP selected for the Random Access procedure is configured with set(s) of Random Access resources associated with Msg1 repetition number 4 and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum4:\n3>\tassume Msg1 repetition is applicable and Msg1 repetition number applicable for the current Random Access procedure includes 4.\n2>\tif the BWP selected for the Random Access procedure is configured with set(s) of Random Access resources associated with Msg1 repetition number 2 and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum2:\n3>\tassume Msg1 repetition is applicable and Msg1 repetition number applicable for the current Random Access procedure includes 2.\n2>\telse if the RSRP of the downlink pathloss reference is not less than any configured rsrp-ThresholdMsg1-RepetitionNumX:\n3>\tassume Msg1 repetition is not applicable for the current Random Access procedure.\n1>\telse if the BWP selected for Random Access procedure is configured only with Random Access resources with msg1-Repetitions set to true:\n2>\tassume Msg1 repetition is applicable for the current Random Access procedure;\n2>\tif at least one of rsrp-ThresholdMsg1-RepetitionNumX is configured:\n3>\tif rsrp-ThresholdMsg1-RepetitionNum8 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum8;\n4>\tassume Msg1 repetition number applicable for the current Random Access procedure includes 8.\n3>\tif rsrp-ThresholdMsg1-RepetitionNum4 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum4:\n4>\tassume Msg1 repetition number applicable for the current Random Access procedure includes 4.\n3>\tif rsrp-ThresholdMsg1-RepetitionNum2 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum2:\n4>\tassume Msg1 repetition number applicable for the current Random Access procedure includes 2.\n3>\telse if the RSRP of the downlink pathloss reference is not less than any configured rsrp-ThresholdMsg1-RepetitionNumX:\n4>\tassume Msg1 repetition number applicable for the current Random Access procedure is the lowest Msg1 repetition number configured for this BWP.\n2>\telse (none of rsrp-ThresholdMsg1-RepetitionNumX is configured):\n3>\tassume Msg1 repetition number applicable for the current Random Access procedure is the Msg1 repetition number that configured for this BWP.\nNOTE 1:\tVoid.\n1>\tif neither contention-free Random Access Resources nor Random Access Resources for SI request have been provided for this Random Access procedure and one or more of the features including (e)RedCap and/or Slicing and/or SDT and/or MSG3 repetition and/or MSG1 repetition is applicable for this Random Access procedure:\nNOTE 2:\tThe applicability of SDT is determined by MAC entity according to clause 5.27. The applicability of NSAG-ID is determined by upper layers when the Random Access procedure is initiated. The applicability of (e)RedCap is also determined by upper layers when Random Access procedure is initiated and it is applicable to the Random Access procedures initiated by PDCCH orders and any Random Access procedure initiated by the MAC entity.\nNOTE 3:\tSDT is not applicable for the Random Access procedure initiated by upper layers for MT-SDT.\n2>\tif none of the sets of Random Access resources are available for any feature applicable to the current Random Access procedure (as specified in clause 5.1.1c):\n3>\tselect the set(s) of Random Access resources that are not associated with any feature indication (as specified in clause 5.1.1c) for this Random Access procedure.\n2>\telse if there is one set of Random Access resources available which can be used for indicating all features triggering this Random Access procedure:\n3>\tselect this set of Random Access resources for this Random Access procedure.\n2>\telse if there are more than one set of Random Access resources available which can be used for indicating all features triggering this Random Access procedure and Msg1 repetition is applicable for this Random Access procedure:\n3>\tselect the set of Random Access resources that associated with highest repetition number among the sets of Random Access resources.\n2>\telse (i.e. there are one or more sets of Random Access resources available that are configured with indication(s) for a subset of all features triggering this Random Access procedure):\n3>\tselect a set of Random Access resources from the available set(s) of Random Access resources based on the priority order indicated by upper layers as specified in clause 5.1.1d for this Random Access Procedure.\n1>\telse if contention-free Random Access Resources with Msg1 repetition have been provided for this Random Access procedure and Msg1 repetition number is indicated in rach-ConfigDedicated, and RedCap is applicable for the current Random Access procedure:\n2>\tselect the set of Random Access resources that is only configured with RedCap indication and Msg1 repetition indication and associated with the indicated Msg1 repetition number for this Random Access procedure.\n1>\telse if contention-free Random Access Resources have been provided for this Random Access procedure and RedCap is applicable for the current Random Access procedure and there is one set of Random Access resources available that is only configured with RedCap indication; or\n1>\telse if contention-free Random Access Resources have been provided for this Random Access procedure and eRedCap is applicable for the current Random Access procedure and there is one set of Random Access resources available that is only configured with eRedCap indication; or\n1>\telse if contention-free Random Access Resources have been provided for this Random Access procedure and eRedCap is applicable for the current Random Access procedure and there is no set of Random Access resources available that is only configured with eRedCap indication and there is one set of Random Access resources available that is only configured with RedCap indication:\n2>\tselect this set of Random Access resources for this Random Access procedure.\n1>\telse:\n2>\tif the Random Access procedure is initiated by PDCCH order with DCI PRACH association indicator field set to 1 and SSB-MTC-AdditionalPCI is configured by upper layers, as specified in clause 7.3.1.2.1 of TS 38.212 [9]:\n3>\tselect the set of Random Access resources corresponding to the active additionalPCI.\n2>\telse if contention-free Random Access Resources with Msg1 repetition have been provided for this Random Access procedure, and Msg1 repetition number is indicated in rach-ConfigDedicated:\n3>\tselect the set of Random Access resources that is only configured with Msg1 repetition indication and associated with the indicated Msg1 repetition number for this Random Access procedure.\n2>\telse if the Random Access procedure was initiated for SI request and Random Access Resources associated with Msg1 repetition for SI request and Msg1 repetition number have been provided for this Random Access procedure:\n3>\tselect the set of Random Access resources that is only configured with Msg1 repetition indication and associated with the indicated Msg1 repetition number for this Random Access procedure.\n2>\telse:\n3>\tselect the set of Random Access resources that are not associated with any feature indication (as specified in clause 5.1.1c) for the current Random Access procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.1c\tAvailability of the set of Random Access resources",
                            "text_content": "The MAC entity shall for each set of configured Random Access resources for 4-step RA type and for each set of configured Random Access resources for 2-step RA type:\n1>\tif eRedCap is set to true for a set of Random Access resources:\n2>\tconsider the set of Random Access resources as not available for a Random Access procedure for which eRedCap is not applicable.\n1>\tif redCap is set to true for a set of Random Access resources configured for 4-step RA type, but not for 2-step RA type:\n2>\tconsider the set of Random Access resources as not available for a Random Access procedure for which RedCap is not applicable.\n1>\tif redCap is set to true for a set of Random Access resources configured for 2-step RA type regardless of whether it is also configured for 4-step RA type:\n2>\tconsider the set of Random Access resources as not available for a Random Access procedure for which (e)RedCap is not applicable;\n2>\tconsider eRedCap as both eRedCap and RedCap in the following procedure in clause 5.1.1c and 5.1.1d.\n1>\tif smallData is set to true for a set of Random Access resources:\n2>\tconsider the set of Random Access resources as not available for the Random Access procedure which is not triggered for RA-SDT by MO-SDT as specified in TS 38.331 [5].\n1>\tif NSAG-List is configured for a set of Random Access resources:\n2>\tconsider the set of Random Access resources as not available for the Random Access procedure unless it is triggered for any one of the NSAG-ID(s) in the NSAG-List.\n1>\tif msg3-Repetitions is set to true for a set of Random Access resources:\n2>\tconsider the set of Random Access resources as not available for the Random Access procedure if Msg3 repetition is not applicable.\n1>\tif msg1-Repetitions is set to true for a set of Random Access resources:\n2>\tif Msg1 repetition is not applicable to the current Random Access procedure; or\n2>\tif the set of Random Access resources is not associated with any of the Msg1 repetition number that is applicable to the current Random Access procedure:\n3>\tconsider the set of Random Access resources as not available for the Random Access procedure.\n1>\tif a set of Random Access resources is not configured with FeatureCombination:\n2>\tconsider the set of Random Access resources to not associated with any feature.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.1d\tSelection of the set of Random Access resources based on feature prioritization",
                            "text_content": "The MAC entity shall:\n1>\tamong the available sets of Random Access resources for this Random Access procedure (as specified in clause 5.1.1c), identify those configured with a feature which has the highest priority assigned in featurePriorities among all the features applicable to this Random Access procedure as specified in TS 38.331 [5].\n1>\tif a single set of Random Access resources is identified:\n2>\tselect this set of Random Access resources.\n1>\telse if more than one set of Random Access resources is identified:\n2>\tif all the identified sets of Random Access resources are configured with Msg1 repetition indication and the same featureCombination:\n3>\tselect the set of Random Access resources that associated with highest Msg1 repetition number among the identified sets of Random Access resources.\n2>\telse:\n3>\trepeat the procedure taking as an input the identified sets of Random Access resources and the feature applicable to the current Random Access procedure with the highest priority assigned in featurePriorities among all the features applicable to this Random Access procedure, except the features considered already.\n1>\telse (i.e. no set of Random Access resources is identified):\n2>\trepeat the procedure taking as an input the previous identified available sets of Random Access resources and the feature applicable to the current Random Access procedure with the highest priority assigned in featurePriorities among all the features applicable to this Random Access procedure, except the features considered already.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.1e\tSelection of Msg1 repetition for SI request",
                            "text_content": "The MAC entity shall:\n1>\tif si-RequestResourcesRepetitionNum8 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum8:\n2>\tcriteria to apply Msg1 repetition for SI request is considered met and Msg1 repetition number applicable is 8.\n1>\telse if si-RequestResourcesRepetitionNum4 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum4:\n2>\tcriteria to apply Msg1 repetition for SI request is considered met and Msg1 repetition number applicable is 4.\n1>\telse si-RequestResourcesRepetitionNum2 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum2:\n2>\tcriteria to apply Msg1 repetition for SI request is considered met and Msg1 repetition number applicable is 2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2\tRandom Access Resource selection",
                            "text_content": "If the selected RA_TYPE is set to 4-stepRA, the MAC entity shall:\n1>\tif the Random Access procedure was initiated for SpCell beam failure recovery (as specified in clause 5.17); and\n1>\tif the beamFailureRecoveryTimer (in clause 5.17) is either running or not configured; and\n1>\tif the contention-free Random Access Resources for beam failure recovery request associated with any of the SSBs and/or CSI-RSs have been explicitly provided by RRC; and\n1>\tif at least one of the SSBs with SS-RSRP above rsrp-ThresholdSSB amongst the SSBs in candidateBeamRSList or the CSI-RSs with CSI-RSRP above rsrp-ThresholdCSI-RS amongst the CSI-RSs in candidateBeamRSList is available:\n2>\tselect an SSB with SS-RSRP above rsrp-ThresholdSSB amongst the SSBs in candidateBeamRSList or a CSI-RS with CSI-RSRP above rsrp-ThresholdCSI-RS amongst the CSI-RSs in candidateBeamRSList;\n2>\tif CSI-RS is selected, and there is no ra-PreambleIndex associated with the selected CSI-RS:\n3>\tset the PREAMBLE_INDEX to a ra-PreambleIndex corresponding to the SSB in candidateBeamRSList which is quasi-colocated with the selected CSI-RS as specified in TS 38.214 [7].\n2>\telse:\n3>\tset the PREAMBLE_INDEX to a ra-PreambleIndex corresponding to the selected SSB or CSI-RS from the set of Random Access Preambles for beam failure recovery request.\n1>\telse if the ra-PreambleIndex has been explicitly provided by PDCCH; and\n1>\tif the ra-PreambleIndex is not 0b000000:\n2>\tset the PREAMBLE_INDEX to the signalled ra-PreambleIndex;\n2>\tselect the SSB signalled by PDCCH.\n1>\telse if the ra-PreambleIndex has been explicitly provided by an LTM Cell Switch Command MAC CE:\n2>\tset the PREAMBLE_INDEX to the indicated ra-PreambleIndex;\n2>\tselect the SSB signalled by the LTM Cell Switch Command MAC CE.\n1>\telse if the contention-free Random Access Resources associated with SSBs have been explicitly provided in rach-ConfigDedicated and at least one SSB with SS-RSRP above rsrp-ThresholdSSB amongst the associated SSBs is available:\n2>\tselect an SSB with SS-RSRP above rsrp-ThresholdSSB amongst the associated SSBs;\n2>\tset the PREAMBLE_INDEX to a ra-PreambleIndex corresponding to the selected SSB.\n1>\telse if the contention-free Random Access Resources associated with CSI-RSs have been explicitly provided in rach-ConfigDedicated and at least one CSI-RS with CSI-RSRP above rsrp-ThresholdCSI-RS amongst the associated CSI-RSs is available:\n2>\tselect a CSI-RS with CSI-RSRP above rsrp-ThresholdCSI-RS amongst the associated CSI-RSs;\n2>\tset the PREAMBLE_INDEX to a ra-PreambleIndex corresponding to the selected CSI-RS.\n1>\telse if the Random Access procedure was initiated for SI request (as specified in TS 38.331 [5]); and\n1>\tif the Random Access Resources for SI request have been explicitly provided by RRC:\n2>\tif at least one of the SSBs with SS-RSRP above rsrp-ThresholdSSB is available:\n3>\tselect an SSB with SS-RSRP above rsrp-ThresholdSSB.\n2>\telse:\n3>\tselect any SSB.\n2>\tselect a Random Access Preamble corresponding to the selected SSB, from the Random Access Preamble(s) determined according to ra-PreambleStartIndex as specified in TS 38.331 [5];\n2>\tset the PREAMBLE_INDEX to selected Random Access Preamble.\n1>\telse (i.e. for the contention-based Random Access preamble selection):\n2>\tif at least one of the SSBs with SS-RSRP above rsrp-ThresholdSSB is available:\n3>\tselect an SSB with SS-RSRP above rsrp-ThresholdSSB.\n2>\telse:\n3>\tselect any SSB.\n2>\tif the RA_TYPE is switched from 2-stepRA to 4-stepRA:\n3>\tif a Random Access Preambles group was selected during the current Random Access procedure:\n4>\tselect the same group of Random Access Preambles as was selected for the 2-step RA type.\n3>\telse:\n4>\tif Random Access Preambles group B is configured; and\n4>\tif the transport block size of the MSGA payload configured in the rach-ConfigDedicated corresponds to the transport block size of the MSGA payload associated with Random Access Preambles group B:\n5>\tselect the Random Access Preambles group B.\n4>\telse:\n5>\tselect the Random Access Preambles group A.\n2>\telse if Msg3 buffer is empty:\n3>\tif Random Access Preambles group B is configured:\n4>\tif the potential Msg3 size (UL data available for transmission plus MAC subheader(s) and, where required, MAC CEs) is greater than ra-Msg3SizeGroupA and the pathloss is less than PCMAX (of the Serving Cell performing the Random Access Procedure) – preambleReceivedTargetPower – msg3-DeltaPreamble – messagePowerOffsetGroupB; or\n4>\tif the Random Access procedure was initiated for the CCCH logical channel and the CCCH SDU size plus MAC subheader is greater than ra-Msg3SizeGroupA:\n5>\tselect the Random Access Preambles group B.\n4>\telse:\n5>\tselect the Random Access Preambles group A.\n3>\telse:\n4>\tselect the Random Access Preambles group A.\n2>\telse (i.e. Msg3 is being retransmitted):\n3>\tselect the same group of Random Access Preambles as was used for the Random Access Preamble transmission attempt corresponding to the first transmission of Msg3.\n2>\tselect a Random Access Preamble randomly with equal probability from the Random Access Preambles associated with the selected SSB and the selected Random Access Preambles group;\n2>\tset the PREAMBLE_INDEX to the selected Random Access Preamble.\n1>\tif the Random Access procedure was initiated for SI request (as specified in TS 38.331 [5]); and\n1>\tif ra-AssociationPeriodIndex and si-RequestPeriod are configured:\n2>\tdetermine the next available PRACH occasion from the PRACH occasions corresponding to the selected SSB in the association period given by ra-AssociationPeriodIndex in the si-RequestPeriod permitted by the restrictions given by the ra-ssb-OccasionMaskIndex if configured (the MAC entity shall select a PRACH occasion randomly with equal probability amongst the consecutive PRACH occasions according to clause 8.1 of TS 38.213 [6] corresponding to the selected SSB).\n1>\telse if an SSB is selected above:\n2>\tif the set of Random Access resources associated with Msg1 repetition is selected for this Random Access procedure:\n3>\tdetermine the next available set of PRACH occasions (as specified in TS 38.213 [6]) for the Msg1 repetition number applicable for this Random Access procedure corresponding to the selected SSB, permitted by the restrictions given by the ra-ssb-OccasionMaskIndex if configured, or ssb-SharedRO-MaskIndex if configured (the MAC entity shall select a set of PRACH occasions randomly with equal probability amongst the consecutive PRACH occasions according to clause 8.1 of TS 38.213 [6] regardless the FR2 UL gap, corresponding to the selected SSB and selected Msg1 repetition number for this Random Access procedure; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available set of PRACH occasions corresponding to the selected SSB).\n2>\telse:\n3>\tdetermine the next available PRACH occasion from the PRACH occasions corresponding to the selected SSB permitted by the restrictions given by the ra-ssb-OccasionMaskIndex if configured, or ssb-SharedRO-MaskIndex if configured, or indicated by PDCCH, or indicated by the LTM Cell Switch Command MAC CE (the MAC entity shall select a PRACH occasion randomly with equal probability amongst the consecutive PRACH occasions according to clause 8.1 of TS 38.213 [6] regardless the FR2 UL gap, corresponding to the selected SSB; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available PRACH occasion corresponding to the selected SSB).\n1>\telse if a CSI-RS is selected above:\n2>\tif there is no contention-free Random Access Resource associated with the selected CSI-RS:\n3>\tdetermine the next available PRACH occasion from the PRACH occasions, permitted by the restrictions given by the ra-ssb-OccasionMaskIndex if configured, corresponding to the SSB in candidateBeamRSList which is quasi-colocated with the selected CSI-RS as specified in TS 38.214 [7] (the MAC entity shall select a PRACH occasion randomly with equal probability amongst the consecutive PRACH occasions according to clause 8.1 of TS 38.213 [6] regardless the FR2 UL gap, corresponding to the SSB which is quasi-colocated with the selected CSI-RS; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available PRACH occasion corresponding to the SSB which is quasi-colocated with the selected CSI-RS).\n2>\telse:\n3>\tdetermine the next available PRACH occasion from the PRACH occasions in ra-OccasionList corresponding to the selected CSI-RS (the MAC entity shall select a PRACH occasion randomly with equal probability amongst the PRACH occasions occurring simultaneously but on different subcarriers regardless the FR2 UL gap, corresponding to the selected CSI-RS; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available PRACH occasion corresponding to the selected CSI-RS).\n1>\tperform the Random Access Preamble transmission procedure (see clause 5.1.3).\nNOTE 1:\tWhen the UE determines if there is an SSB with SS-RSRP above rsrp-ThresholdSSB or a CSI-RS with CSI-RSRP above rsrp-ThresholdCSI-RS, the UE uses the latest unfiltered L1-RSRP measurement.\nNOTE 2:\tVoid.\nNOTE 3:\tIf an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode is configured with a BWP indicated by initialDownlinkBWP-RedCap which is not associated with any SSB, SS-RSRP measurement is performed based on the SSB associated with the BWP indicated by initialDownlinkBWP. If a RedCap UE in RRC_INACTIVE mode is configured with SDT and with a BWP indicated by initialDownlinkBWP-RedCap which is associated with NCD-SSB, SS-RSRP measurement can also be performed based on this NCD-SSB during SDT.\nNOTE 4:\tIf an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode is configured with a BWP indicated by initialDownlinkBWP-RedCap which is not associated with any SSB for RACH, it is up to the UE implementation to perform a new RSRP measurements before Msg1/MsgA retransmission.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2a\tRandom Access Resource selection for 2-step RA type",
                            "text_content": "If the selected RA_TYPE is set to 2-stepRA, the MAC entity shall:\n1>\tif the contention-free 2-step RA type Resources associated with SSBs have been explicitly provided in rach-ConfigDedicated and at least one SSB with SS-RSRP above msgA-RSRP-ThresholdSSB amongst the associated SSBs is available:\n2>\tselect an SSB with SS-RSRP above msgA-RSRP-ThresholdSSB amongst the associated SSBs;\n2>\tset the PREAMBLE_INDEX to a ra-PreambleIndex corresponding to the selected SSB.\n1>\telse (i.e. for the contention-based Random Access Preamble selection):\n2>\tif at least one of the SSBs with SS-RSRP above msgA-RSRP-ThresholdSSB is available:\n3>\tselect an SSB with SS-RSRP above msgA-RSRP-ThresholdSSB.\n2>\telse:\n3>\tselect any SSB.\n2>\tif contention-free Random Access Resources for 2-step RA type have not been configured and if Random Access Preambles group has not yet been selected during the current Random Access procedure:\n3>\tif Random Access Preambles group B for 2-step RA type is configured:\n4>\tif the potential MSGA payload size (UL data available for transmission plus MAC subheader and, where required, MAC CEs) is greater than the ra-MsgA-SizeGroupA and the pathloss is less than PCMAX (of the Serving Cell performing the Random Access Procedure) – msgA-PreambleReceivedTargetPower – msgA-DeltaPreamble – messagePowerOffsetGroupB; or\n4>\tif the Random Access procedure was initiated for the CCCH logical channel and the CCCH SDU size plus MAC subheader is greater than ra-MsgA-SizeGroupA:\n5>\tselect the Random Access Preambles group B.\n4>\telse:\n5>\tselect the Random Access Preambles group A.\n3>\telse:\n4>\tselect the Random Access Preambles group A.\n2>\telse if contention-free Random Access Resources for 2-step RA type have been configured and if Random Access Preambles group has not yet been selected during the current Random Access procedure:\n3>\tif Random Access Preambles group B for 2-step RA type is configured; and\n3>\tif the transport block size of the MSGA payload configured in the rach-ConfigDedicated corresponds to the transport block size of the MSGA payload associated with Random Access Preambles group B:\n4>\tselect the Random Access Preambles group B.\n3>\telse:\n4>\tselect the Random Access Preambles group A.\n2>\telse (i.e. Random Access preambles group has been selected during the current Random Access procedure):\n3>\tselect the same group of Random Access Preambles as was used for the Random Access Preamble transmission attempt corresponding to the earlier transmission of MSGA.\n2>\tselect a Random Access Preamble randomly with equal probability from the 2-step RA type Random Access Preambles associated with the selected SSB and the selected Random Access Preambles group;\n2>\tset the PREAMBLE_INDEX to the selected Random Access Preamble.\n1>\tdetermine the next available PRACH occasion from the PRACH occasions corresponding to the selected SSB permitted by the restrictions given by the msgA-SSB-SharedRO-MaskIndex if configured, or ra-ssb-OccasionMaskIndex if configured, or ssb-SharedRO-MaskIndex if configured (the MAC entity shall select a PRACH occasion randomly with equal probability among the consecutive PRACH occasions allocated for 2-step RA type according to clause 8.1 of TS 38.213 [6] regardless the FR2 UL gap, corresponding to the selected SSB; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available PRACH occasion corresponding to the selected SSB);\n1>\tif the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble(s):\n2>\tselect a PUSCH occasion from the PUSCH occasions configured in msgA-CFRA-PUSCH corresponding to the PRACH slot of the selected PRACH occasion, according to msgA-PUSCH-Resource-Index corresponding to the selected SSB;\n2>\tdetermine the UL grant and the associated HARQ information for the MSGA payload in the selected PUSCH occasion;\n2>\tdeliver the UL grant and the associated HARQ information to the HARQ entity.\n1>\telse:\n2>\tselect a PUSCH occasion corresponding to the selected preamble and PRACH occasion according to clause 8.1A of TS 38.213 [6];\n2>\tdetermine the UL grant for the MSGA payload according to the PUSCH configuration associated with the selected Random Access Preambles group and determine the associated HARQ information;\n2>\tif the selected preamble and PRACH occasion is mapped to a valid PUSCH occasion as specified in clause 8.1A of TS 38.213 [6]:\n3>\tdeliver the UL grant and the associated HARQ information to the HARQ entity.\n1>\tperform the MSGA transmission procedure (see clause 5.1.3a).\nNOTE 1:\tTo determine if there is an SSB with SS-RSRP above msgA-RSRP-ThresholdSSB, the UE uses the latest unfiltered L1-RSRP measurement.\nNOTE 2:\tIf an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode is configured with a BWP indicated by initialDownlinkBWP-RedCap which is not associated with any SSB, SS-RSRP measurement is performed based on the SSB associated with the BWP indicated by initialDownlinkBWP. If a RedCap UE in RRC_INACTIVE mode is configured with SDT and with a BWP indicated by initialDownlinkBWP-RedCap which is associated with NCD-SSB, SS-RSRP measurement can also be performed based on this NCD-SSB during SDT.\nNOTE 3:\tIf an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode is configured with a BWP indicated by initialDownlinkBWP-RedCap which is not associated with any SSB for RACH, it is up to the UE implementation to perform a new RSRP measurements before Msg1/MsgA retransmission.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.3\tRandom Access Preamble transmission",
                            "text_content": "The MAC entity shall, for each Random Access Preamble:\n1>\tif PREAMBLE_TRANSMISSION_COUNTER is greater than one; and\n1>\tif the notification of suspending power ramping counter has not been received from lower layers; and\n1>\tif LBT failure indication was not received from lower layers for the last Random Access Preamble transmission; and\n1>\tif SSB or CSI-RS selected is not changed from the selection in the last Random Access Preamble transmission; and\n1>\tif the Random Access procedure is not initiated by the PDCCH order for an LTM candidate cell:\n2>\tincrement PREAMBLE_POWER_RAMPING_COUNTER by 1.\n1>\tif the Random Access procedure is initiated by the PDCCH order for an LTM candidate cell as preamble re-transmission; and\n1>\tif the PDCCH order indicates the same LTM candidate cell and the same SSB as the last Random Access Preamble transmission:\n2>\tincrement PREAMBLE_POWER_RAMPING_COUNTER by 1.\n1>\tselect the value of DELTA_PREAMBLE according to clause 7.3;\n1>\tset PREAMBLE_RECEIVED_TARGET_POWER to preambleReceivedTargetPower + DELTA_PREAMBLE + (PREAMBLE_POWER_RAMPING_COUNTER – 1) × PREAMBLE_POWER_RAMPING_STEP + POWER_OFFSET_2STEP_RA;\n1>\texcept for contention-free Random Access Preamble for beam failure recovery request and contention-free  Random Access Preamble triggered by a PDCCH order for an LTM candidate cell, compute the RA-RNTI associated with the PRACH occasion in which the Random Access Preamble is transmitted;\n1>\tinstruct the physical layer to transmit the Random Access Preamble using the selected PRACH occasion, corresponding RA-RNTI (if available), PREAMBLE_INDEX, and PREAMBLE_RECEIVED_TARGET_POWER.\n1>\tif the Random Access Procedure is triggered by a PDCCH order for an LTM candidate cell:\n2>\tconsider this Random Access procedure completed.\n1>\tif LBT failure indication is received from lower layers for this Random Access Preamble transmission:\n2>\tif lbt-FailureRecoveryConfig is configured:\n3>\tperform the Random Access Resource selection procedure (see clause 5.1.2).\n2>\telse:\n3>\tincrement PREAMBLE_TRANSMISSION_COUNTER by 1;\n3>\tif PREAMBLE_TRANSMISSION_COUNTER = preambleTransMax + 1:\n4>\tif the Random Access Preamble is transmitted on the SpCell:\n5>\tindicate a Random Access problem to upper layers;\n5>\tif this Random Access procedure was triggered for SI request:\n6>\tconsider the Random Access procedure unsuccessfully completed.\n4>\telse if the Random Access Preamble is transmitted on an SCell:\n5>\tconsider the Random Access procedure unsuccessfully completed.\n3>\tif the Random Access procedure is not completed:\n4>\tperform the Random Access Resource selection procedure (see clause 5.1.2).\nThe RA-RNTI associated with the PRACH occasion in which the Random Access Preamble is transmitted or the RA-RNTI associated with the last valid PRACH occasion in the set of PRACH occasions (as specified in TS 38.213 [6]) for Msg1 repetition, is computed as:\nRA-RNTI = 1 + s_id + 14 × t_id + 14 × 80 × f_id + 14 × 80 × 8 × ul_carrier_id\nwhere s_id is the index of the first OFDM symbol of the PRACH occasion (0 ≤ s_id < 14), t_id is the index of the first slot of the PRACH occasion in a system frame (0 ≤ t_id < 80), where the subcarrier spacing to determine t_id is based on the value of μ specified in clause 5.3.2 in TS 38.211 [8] for μ = {0, 1, 2, 3}, and for μ = {5, 6}, t_id is the index of the 120 kHz slot in a system frame that contains the PRACH occasion (0 ≤ t_id < 80), f_id is the index of the PRACH occasion in the frequency domain (0 ≤ f_id < 8), and ul_carrier_id is the UL carrier used for Random Access Preamble transmission (0 for NUL carrier, and 1 for SUL carrier).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.3a\tMSGA transmission",
                            "text_content": "The MAC entity shall, for each MSGA:\n1>\tif PREAMBLE_TRANSMISSION_COUNTER is greater than one; and\n1>\tif the notification of suspending power ramping counter has not been received from lower layers; and\n1>\tif LBT failure indication was not received from lower layers for the last MSGA Random Access Preamble transmission; and\n1>\tif SSB selected is not changed from the selection in the last Random Access Preamble transmission:\n2>\tincrement PREAMBLE_POWER_RAMPING_COUNTER by 1.\n1>\tselect the value of DELTA_PREAMBLE according to clause 7.3;\n1>\tset PREAMBLE_RECEIVED_TARGET_POWER to msgA-PreambleReceivedTargetPower + DELTA_PREAMBLE + (PREAMBLE_POWER_RAMPING_COUNTER – 1) × PREAMBLE_POWER_RAMPING_STEP;\n1>\tif this is the first MSGA transmission within this Random Access procedure:\n2>\tif the transmission is not being made for the CCCH logical channel:\n3>\tindicate to the Multiplexing and assembly entity to include a C-RNTI MAC CE in the subsequent uplink transmission.\n2>\tif the Random Access procedure was initiated for SpCell beam failure recovery and spCell-BFR-CBRA with value true is configured:\n3>\tif there is at least one Serving Cell of this MAC entity configured with two BFD-RS sets:\n4>\tindicate to the Multiplexing and assembly entity to include an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the subsequent uplink transmission.\n3>\telse:\n4>\tindicate to the Multiplexing and assembly entity to include a BFR MAC CE or a Truncated BFR MAC CE in the subsequent uplink transmission.\n2>\telse if the Random Access procedure was initiated for beam failure recovery of both BFD-RS sets of SpCell:\n3>\tindicate to the Multiplexing and assembly entity to include an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the subsequent uplink transmission.\n2>\tobtain the MAC PDU to transmit from the Multiplexing and assembly entity according to the HARQ information determined for the MSGA payload (see clause 5.1.2a) and store it in the MSGA buffer.\n1>\tcompute the MSGB-RNTI associated with the PRACH occasion in which the Random Access Preamble is transmitted;\n1>\tinstruct the physical layer to transmit the MSGA using the selected PRACH occasion and the associated PUSCH resource of MSGA (if the selected preamble and PRACH occasion is mapped to a valid PUSCH occasion), using the corresponding RA-RNTI, MSGB-RNTI, PREAMBLE_INDEX, PREAMBLE_RECEIVED_TARGET_POWER, msgA-PreambleReceivedTargetPower, and the amount of power ramping applied to the latest MSGA preamble transmission (i.e. (PREAMBLE_POWER_RAMPING_COUNTER – 1) × PREAMBLE_POWER_RAMPING_STEP);\n1>\tif LBT failure indication is received from lower layers for the transmission of this MSGA Random Access Preamble:\n2>\tinstruct the physical layer to cancel the transmission of the MSGA payload on the associated PUSCH resource;\n2>\tif lbt-FailureRecoveryConfig is configured:\n3>\tperform the Random Access Resource selection procedure for 2-step RA type (see clause 5.1.2a).\n2>\telse:\n3>\tincrement PREAMBLE_TRANSMISSION_COUNTER by 1;\n3>\tif PREAMBLE_TRANSMISSION_COUNTER = preambleTransMax + 1:\n4>\tindicate a Random Access problem to upper layers;\n4>\tif this Random Access procedure was triggered for SI request:\n5>\tconsider this Random Access procedure unsuccessfully completed.\n3>\tif the Random Access procedure is not completed:\n4>\tif msgA-TransMax is applied (see clause 5.1.1a) and PREAMBLE_TRANSMISSION_COUNTER = msgA-TransMax + 1:\n5>\tset the RA_TYPE to 4-stepRA;\n5>\tperform initialization of variables specific to Random Access type as specified in clause 5.1.1a;\n5>\tif the Msg3 buffer is empty:\n6>\tobtain the MAC PDU to transmit from the MSGA buffer and store it in the Msg3 buffer;\n5>\tflush HARQ buffer used for the transmission of MAC PDU in the MSGA buffer;\n5>\tdiscard explicitly signalled contention-free 2-step RA type Random Access Resources, if any;\n5>\tperform the Random Access Resource selection procedure as specified in clause 5.1.2.\n4>\telse:\n5>\tperform the Random Access Resource selection procedure for 2-step RA type (see clause 5.1.2a).\nNOTE:\tThe MSGA transmission includes the transmission of the PRACH Preamble as well as the contents of the MSGA buffer in the PUSCH resource corresponding to the selected PRACH occasion and PREAMBLE_INDEX (see TS 38.213 [6])\nThe MSGB-RNTI associated with the PRACH occasion in which the Random Access Preamble is transmitted, is computed as:\nMSGB-RNTI = 1 + s_id + 14 × t_id + 14 × 80 × f_id + 14 × 80 × 8 × ul_carrier_id + 14 × 80 × 8 × 2\nwhere s_id is the index of the first OFDM symbol of the PRACH occasion (0 ≤ s_id < 14), t_id is the index of the first slot of the PRACH occasion in a system frame (0 ≤ t_id < 80), where the subcarrier spacing to determine t_id is based on the value of μ specified in clause 5.3.2 in TS 38.211 [8] for μ = {0, 1, 2, 3}, and for μ = {5, 6}, t_id is the index of the 120 kHz slot in a system frame that contains the PRACH occasion (0 ≤ t_id < 80), f_id is the index of the PRACH occasion in the frequency domain (0 ≤ f_id < 8), and ul_carrier_id is the UL carrier used for Random Access Preamble transmission (0 for NUL carrier, and 1 for SUL carrier). The RA-RNTI is calculated as specified in clause 5.1.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.4\tRandom Access Response reception",
                            "text_content": "Once the Random Access Preamble is transmitted and regardless of the possible occurrence of a measurement gap, the MAC entity shall:\n1>\tif the contention-free Random Access Preamble for beam failure recovery request was transmitted by the MAC entity:\n2>\tif the contention-free Random Access Preamble for beam failure recovery request was transmitted on a non-terrestrial network:\n3>\tstart the ra-ResponseWindow configured in BeamFailureRecoveryConfig at the PDCCH occasion as specified in TS 38.213 [6].\n2>\telse:\n3>\tstart the ra-ResponseWindow configured in BeamFailureRecoveryConfig at the first PDCCH occasion as specified in TS 38.213 [6] from the end of the Random Access Preamble transmission.\n2>\tmonitor for a PDCCH transmission on the search space indicated by recoverySearchSpaceId of the SpCell identified by the C-RNTI while ra-ResponseWindow is running.\n1>\telse:\n2>\tif the Random Access Preamble was transmitted on a non-terrestrial network:\n3>\tstart the ra-ResponseWindow configured in RACH-ConfigCommon at the PDCCH occasion as specified in TS 38.213 [6].\n2>\telse if the Random Access Preamble is transmitted with repetitions:\n3>\tstart the ra-ResponseWindow configured in RACH-ConfigCommon at the first PDCCH occasion from the end of all repetitions of the Random Access Preamble transmission as specified in TS 38.213 [6].\n2>\telse:\n3>\tstart the ra-ResponseWindow configured in RACH-ConfigCommon at the first PDCCH occasion as specified in TS 38.213 [6] from the end of the Random Access Preamble transmission.\n2>\tmonitor the PDCCH of the SpCell for Random Access Response(s) identified by the RA-RNTI while the ra-ResponseWindow is running.\n1>\tif notification of a reception of a PDCCH transmission on the search space indicated by recoverySearchSpaceId is received from lower layers on the Serving Cell where the preamble was transmitted; and\n1>\tif PDCCH transmission is addressed to the C-RNTI; and\n1>\tif the contention-free Random Access Preamble for beam failure recovery request was transmitted by the MAC entity:\n2>\tconsider the Random Access procedure successfully completed.\n1>\telse if a valid (as specified in TS 38.213 [6]) downlink assignment has been received on the PDCCH for the RA-RNTI and the received TB is successfully decoded:\n2>\tif the Random Access Response contains a MAC subPDU with Backoff Indicator:\n3>\tset the PREAMBLE_BACKOFF to value of the BI field of the MAC subPDU using Table 7.2-1, multiplied with SCALING_FACTOR_BI.\n2>\telse:\n3>\tset the PREAMBLE_BACKOFF to 0 ms.\n2>\tif the Random Access Response contains a MAC subPDU with Random Access Preamble identifier corresponding to the transmitted PREAMBLE_INDEX (see clause 5.1.3):\n3>\tconsider this Random Access Response reception successful.\n2>\tif the Random Access Response reception is considered successful:\n3>\tif the Random Access Response includes a MAC subPDU with RAPID only:\n4>\tconsider this Random Access procedure successfully completed;\n4>\tindicate the reception of an acknowledgement for SI request to upper layers.\n3>\telse:\n4>\tapply the following actions for the Serving Cell where the Random Access Preamble was transmitted:\n5>\tprocess the received Timing Advance Command (see clause 5.2);\n5>\tindicate the preambleReceivedTargetPower and the amount of power ramping applied to the latest Random Access Preamble transmission to lower layers (i.e. (PREAMBLE_POWER_RAMPING_COUNTER – 1) × PREAMBLE_POWER_RAMPING_STEP);\n5>\tif the Random Access procedure for an SCell is performed on uplink carrier where pusch-Config is not configured:\n6>\tignore the received UL grant.\n5>\telse:\n6>\tprocess the received UL grant value and indicate it to the lower layers.\n4>\tif the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble(s):\n5>\tconsider the Random Access procedure successfully completed.\n4>\telse:\n5>\tset the TEMPORARY_C-RNTI to the value received in the Random Access Response;\n5>\tif this is the first successfully received Random Access Response within this Random Access procedure:\n6>\tif the transmission is not being made for the CCCH logical channel:\n7>\tindicate to the Multiplexing and assembly entity to include a C-RNTI MAC CE in the subsequent uplink transmission.\n6>\tif the Random Access procedure was initiated for SpCell beam failure recovery and spCell-BFR-CBRA with value true is configured:\n7>\tif there is at least one Serving Cell of this MAC entity configured with two BFD-RS sets:\n8>\tindicate to the Multiplexing and assembly entity to include an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the subsequent uplink transmission.\n7>\telse:\n8>\tindicate to the Multiplexing and assembly entity to include a BFR MAC CE or a Truncated BFR MAC CE in the subsequent uplink transmission.\n6>\telse if the Random Access procedure was initiated for beam failure recovery of both BFD-RS sets of SpCell:\n7>\tindicate to the Multiplexing and assembly entity to include an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the subsequent uplink transmission.\n6>\tobtain the MAC PDU to transmit from the Multiplexing and assembly entity and store it in the Msg3 buffer.\nNOTE 1:\tIf within a Random Access procedure, an uplink grant provided in the Random Access Response for the same group of contention-based Random Access Preambles has a different size than the first uplink grant allocated during that Random Access procedure, the UE behavior is not defined.\n1>\tif ra-ResponseWindow configured in BeamFailureRecoveryConfig expires and if a PDCCH transmission on the search space indicated by recoverySearchSpaceId addressed to the C-RNTI has not been received on the Serving Cell where the preamble was transmitted; or\n1>\tif ra-ResponseWindow configured in RACH-ConfigCommon expires, and if the Random Access Response containing Random Access Preamble identifiers that matches the transmitted PREAMBLE_INDEX has not been received:\n2>\tconsider the Random Access Response reception not successful;\n2>\tincrement PREAMBLE_TRANSMISSION_COUNTER by 1;\n2>\tif PREAMBLE_TRANSMISSION_COUNTER = preambleTransMax + 1:\n3>\tif the Random Access Preamble is transmitted on the SpCell:\n4>\tindicate a Random Access problem to upper layers;\n4>\tif this Random Access procedure was triggered for SI request:\n5>\tconsider the Random Access procedure unsuccessfully completed.\n3>\telse if the Random Access Preamble is transmitted on an SCell:\n4>\tconsider the Random Access procedure unsuccessfully completed.\n2>\tif the Random Access procedure is not completed:\n3>\tif the Random Access Preamble is transmitted with repetitions and neither contention-free Random Access Resources nor Random Access resources for SI request have been provided for this Random Access procedure:\n4>\tif PREAMBLE_TRANSMISSION_COUNTER = [preambleTransMax-Msg1-Repetition] + 1; or\n4>\tif PREAMBLE_TRANSMISSION_COUNTER = 2 × [preambleTransMax-Msg1-Repetition] + 1:\n5>\tif set of Random Access resources configured with the same prach-ConfigurationIndex and associated with a higher Msg1 repetition number with the same feature or feature combination as the current set of Random Access resources is available:\n6>\tselect the set of Random Access resources associated with the next higher Msg1 repetition number with the same feature or feature combination for this Random Access procedure;\n6>\tinitialize startPreambleForThisPartition, numberOfPreamblesPerSSB-ForThisPartition, ssb-SharedRO-MaskIndex and numberOfRA-PreamblesGroupA parameters for the Random Access procedure according to the values configured by RRC for the selected set of Random Access resources.\n3>\tselect a random backoff time according to a uniform distribution between 0 and the PREAMBLE_BACKOFF;\n3>\tif the criteria (as defined in clause 5.1.2) to select contention-free Random Access Resources is met during the backoff time:\n4>\tperform the Random Access Resource selection procedure (see clause 5.1.2).\n3>\telse if the Random Access procedure for an SCell is performed on uplink carrier where pusch-Config is not configured:\n4>\tdelay the subsequent Random Access transmission until the Random Access Procedure is triggered by a PDCCH order with the same ra-PreambleIndex, ra-ssb-OccasionMaskIndex, and UL/SUL indicator TS 38.212 [9].\n3>\telse:\n4>\tperform the Random Access Resource selection procedure (see clause 5.1.2) after the backoff time.\nThe MAC entity may stop ra-ResponseWindow (and hence monitoring for Random Access Response(s)) after successful reception of a Random Access Response containing Random Access Preamble identifiers that matches the transmitted PREAMBLE_INDEX.\nHARQ operation is not applicable to the Random Access Response reception.\nNOTE 2:\tFor the case that RAR PDSCH bandwidth is larger than the bandwidth the eRedCap UE can receive or process per slot, and the UL grant in RAR indicates that the time is not enough for Msg3 transmission, as specified in TS 38.213 [6], it is up to UE implementation, e.g. either to consider the Random Access Response reception not successful, or transmit Msg3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.4a\tMSGB reception and contention resolution for 2-step RA type",
                            "text_content": "Once the MSGA preamble is transmitted, regardless of the possible occurrence of a measurement gap, the MAC entity shall:\n1>\tstart the msgB-ResponseWindow at the PDCCH occasion as specified in TS 38.213 [6], clause 8.2A;\n1>\tmonitor the PDCCH of the SpCell for a Random Access Response identified by MSGB-RNTI while the msgB-ResponseWindow is running;\n1>\tif C-RNTI MAC CE was included in the MSGA:\n2>\tmonitor the PDCCH of the SpCell for Random Access Response identified by the C-RNTI while the msgB-ResponseWindow is running.\n1>\tif notification of a reception of a PDCCH transmission of the SpCell is received from lower layers:\n2>\tif the C-RNTI MAC CE was included in MSGA:\n3>\tif the Random Access procedure was initiated for SpCell beam failure recovery or for beam failure recovery of both BFD-RS sets of SpCell (as specified in clause 5.17) and the PDCCH transmission is addressed to the C-RNTI:\n4>\tconsider this Random Access Response reception successful;\n4>\tstop the msgB-ResponseWindow;\n4>\tconsider this Random Access procedure successfully completed.\n3>\telse if the timeAlignmentTimer associated with at least one PTAG is running; or\n3>\tif CG-SDT procedure is ongoing and cg-SDT-TimeAlignmentTimer is running:\n4>\tif the PDCCH transmission is addressed to the C-RNTI and contains a UL grant for a new transmission:\n5>\tconsider this Random Access Response reception successful;\n5>\tstop the msgB-ResponseWindow;\n5>\tconsider this Random Access procedure successfully completed.\n3>\telse:\n4>\tif a downlink assignment has been received on the PDCCH for the C-RNTI and the received TB is successfully decoded:\n5>\tif the MAC PDU contains the Absolute Timing Advance Command MAC CE:\n6>\tprocess the received Timing Advance Command (see clause 5.2);\n6>\tconsider this Random Access Response reception successful;\n6>\tstop the msgB-ResponseWindow;\n6>\tconsider this Random Access procedure successfully completed and finish the disassembly and demultiplexing of the MAC PDU.\n2>\tif a valid (as specified in TS 38.213 [6]) downlink assignment has been received on the PDCCH for the MSGB-RNTI and the received TB is successfully decoded:\n3>\tif the MSGB contains a MAC subPDU with Backoff Indicator:\n4>\tset the PREAMBLE_BACKOFF to value of the BI field of the MAC subPDU using Table 7.2-1, multiplied with SCALING_FACTOR_BI.\n3>\telse:\n4>\tset the PREAMBLE_BACKOFF to 0 ms.\n3>\tif the MSGB contains a fallbackRAR MAC subPDU; and\n3>\tif the Random Access Preamble identifier in the MAC subPDU matches the transmitted PREAMBLE_INDEX (see clause 5.1.3a):\n4>\tconsider this Random Access Response reception successful;\n4>\tapply the following actions for the SpCell:\n5>\tprocess the received Timing Advance Command (see clause 5.2);\n5>\tindicate the msgA-PreambleReceivedTargetPower and the amount of power ramping applied to the latest Random Access Preamble transmission to lower layers (i.e. (PREAMBLE_POWER_RAMPING_COUNTER – 1) × PREAMBLE_POWER_RAMPING_STEP);\n5>\tif the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble(s):\n6>\tconsider the Random Access procedure successfully completed;\n6>\tprocess the received UL grant value and indicate it to the lower layers.\n5>\telse:\n6>\tset the TEMPORARY_C-RNTI to the value received in the Random Access Response;\n6>\tif the Msg3 buffer is empty:\n7>\tobtain the MAC PDU to transmit from the MSGA buffer and store it in the Msg3 buffer;\n6>\tprocess the received UL grant value and indicate it to the lower layers and proceed with Msg3 transmission.\nNOTE:\tIf within a 2-step RA type procedure, an uplink grant provided in the fallback RAR has a different size than the MSGA payload, the UE behavior is not defined.\n3>\telse if the MSGB contains a successRAR MAC subPDU; and\n3>\tif the CCCH SDU was included in the MSGA and the UE Contention Resolution Identity in the MAC subPDU matches the CCCH SDU:\n4>\tstop msgB-ResponseWindow;\n4>\tif this Random Access procedure was initiated for SI request:\n5>\tindicate the reception of an acknowledgement for SI request to upper layers.\n4>\telse:\n5>\tset the C-RNTI to the value received in the successRAR;\n5>\tapply the following actions for the SpCell:\n6>\tprocess the received Timing Advance Command (see clause 5.2);\n6>\tindicate the msgA-PreambleReceivedTargetPower and the amount of power ramping applied to the latest Random Access Preamble transmission to lower layers (i.e. (PREAMBLE_POWER_RAMPING_COUNTER – 1) × PREAMBLE_POWER_RAMPING_STEP).\n4>\tdeliver the TPC, PUCCH resource Indicator, ChannelAccess-CPext (if indicated), and HARQ feedback Timing Indicator received in successRAR to lower layers.\n4>\tconsider this Random Access Response reception successful;\n4>\tconsider this Random Access procedure successfully completed;\n4>\tfinish the disassembly and demultiplexing of the MAC PDU.\n1>\tif msgB-ResponseWindow expires, and the Random Access Response Reception has not been considered as successful based on descriptions above:\n2>\tincrement PREAMBLE_TRANSMISSION_COUNTER by 1;\n2>\tif PREAMBLE_TRANSMISSION_COUNTER = preambleTransMax + 1:\n3>\tindicate a Random Access problem to upper layers;\n3>\tif this Random Access procedure was triggered for SI request:\n4>\tconsider this Random Access procedure unsuccessfully completed.\n2>\tif the Random Access procedure is not completed:\n3>\tif msgA-TransMax is applied (see clause 5.1.1a) and PREAMBLE_TRANSMISSION_COUNTER = msgA-TransMax + 1:\n4>\tset the RA_TYPE to 4-stepRA;\n4>\tperform initialization of variables specific to Random Access type as specified in clause 5.1.1a;\n4>\tif the Msg3 buffer is empty:\n5>\tobtain the MAC PDU to transmit from the MSGA buffer and store it in the Msg3 buffer;\n4>\tflush HARQ buffer used for the transmission of MAC PDU in the MSGA buffer;\n4>\tdiscard explicitly signalled contention-free 2-step RA type Random Access Resources, if any;\n4>\tperform the Random Access Resource selection procedure as specified in clause 5.1.2.\n3>\telse:\n4>\tselect a random backoff time according to a uniform distribution between 0 and the PREAMBLE_BACKOFF;\n4>\tif the criteria (as defined in clause 5.1.2a) to select contention-free Random Access Resources is met during the backoff time:\n5>\tperform the Random Access Resource selection procedure for 2-step RA type Random Access (see clause 5.1.2a).\n4>\telse:\n5>\tperform the Random Access Resource selection procedure for 2-step RA type Random Access (see clause 5.1.2a) after the backoff time.\nUpon receiving a fallbackRAR, the MAC entity may stop msgB-ResponseWindow once the Random Access Response reception is considered as successful.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.5\tContention Resolution",
                            "text_content": "Once Msg3 is transmitted the MAC entity shall:\n1>\tif the Msg3 transmission (i.e. initial transmission or HARQ retransmission) is scheduled with PUSCH repetition Type A:\n2>\tif Msg3 is transmitted on a non-terrestrial network:\n3>\tstart or restart the ra-ContentionResolutionTimer in the first symbol after the end of all repetitions of the Msg3 transmission plus the UE-gNB RTT.\n2>\telse:\n3>\tstart or restart the ra-ContentionResolutionTimer in the first symbol after the end of all repetitions of the Msg3 transmission.\n1>\telse if Msg3 transmission (i.e. initial transmission or HARQ retransmission) is transmitted on a non-terrestrial network:\n2>\tstart or restart the ra-ContentionResolutionTimer in the first symbol after the end of the Msg3 transmission plus the UE-gNB RTT.\n1>\telse:\n2>\tstart or restart the ra-ContentionResolutionTimer in the first symbol after the end of the Msg3 transmission.\n1>\tmonitor the PDCCH while the ra-ContentionResolutionTimer is running regardless of the possible occurrence of a measurement gap;\n1>\tif notification of a reception of a PDCCH transmission of the SpCell is received from lower layers:\n2>\tif the C-RNTI MAC CE was included in Msg3:\n3>\tif the Random Access procedure was initiated for SpCell beam failure recovery or for beam failure recovery of both BFD-RS sets of SpCell (as specified in clause 5.17) and the PDCCH transmission is addressed to the C-RNTI; or\n3>\tif the Random Access procedure was initiated by a PDCCH order and the PDCCH transmission is addressed to the C-RNTI; or\n3>\tif the Random Access procedure was initiated by the MAC sublayer itself or by the RRC sublayer and the PDCCH transmission is addressed to the C-RNTI and contains a UL grant for a new transmission:\n4>\tconsider this Contention Resolution successful;\n4>\tstop ra-ContentionResolutionTimer;\n4>\tdiscard the TEMPORARY_C-RNTI;\n4>\tconsider this Random Access procedure successfully completed.\n2>\telse if the CCCH SDU was included in Msg3 and the PDCCH transmission is addressed to its TEMPORARY_C-RNTI:\n3>\tif the MAC PDU is successfully decoded:\n4>\tstop ra-ContentionResolutionTimer;\n4>\tif the MAC PDU contains a UE Contention Resolution Identity MAC CE; and\n4>\tif the UE Contention Resolution Identity in the MAC CE matches the CCCH SDU transmitted in Msg3:\n5>\tconsider this Contention Resolution successful and finish the disassembly and demultiplexing of the MAC PDU;\n5>\tif this Random Access procedure was initiated for SI request:\n6>\tindicate the reception of an acknowledgement for SI request to upper layers.\n5>\telse:\n6>\tset the C-RNTI to the value of the TEMPORARY_C-RNTI;\n5>\tdiscard the TEMPORARY_C-RNTI;\n5>\tconsider this Random Access procedure successfully completed.\n4>\telse:\n5>\tdiscard the TEMPORARY_C-RNTI;\n5>\tconsider this Contention Resolution not successful and discard the successfully decoded MAC PDU.\n3>\telse, for eRedCap UE, if lower layer detects that PDSCH transmission scheduled by PDCCH has a larger bandwidth than UE can receive or process per slot:\n4>\tstop ra-ContentionResolutionTimer;\n4>\tdiscard the TEMPORARY_C-RNTI;\n4>\tconsider this Contention Resolution not successful.\n1>\tif ra-ContentionResolutionTimer expires:\n2>\tif Msg3 transmission was transmitted on a non-terrestrial network:\n3>\tif no PDCCH addressed to TC-RNTI indicating uplink grant for a Msg3 retransmission is received after the start of the ra-ContentionResolutionTimer:\n4>\tdiscard the TEMPORARY_C-RNTI;\n4>\tconsider the Contention Resolution not successful.\n2>\telse:\n3>\tdiscard the TEMPORARY_C-RNTI;\n3>\tconsider the Contention Resolution not successful.\n1>\tif the Contention Resolution is considered not successful:\n2>\tflush the HARQ buffer used for transmission of the MAC PDU in the Msg3 buffer;\n2>\tincrement PREAMBLE_TRANSMISSION_COUNTER by 1;\n2>\tif PREAMBLE_TRANSMISSION_COUNTER = preambleTransMax + 1:\n3>\tindicate a Random Access problem to upper layers.\n3>\tif this Random Access procedure was triggered for SI request:\n4>\tconsider the Random Access procedure unsuccessfully completed.\n2>\tif the Random Access procedure is not completed:\n3>\tif the RA_TYPE is set to 4-stepRA:\n4>\tif the Random Access Preamble is transmitted with repetitions and contention-free Random Access Resources have not been provided for this Random Access procedure:\n5>\tif PREAMBLE_TRANSMISSION_COUNTER = [preambleTransMax-Msg1-Repetition] + 1; or\n5>\tif PREAMBLE_TRANSMISSION_COUNTER = 2 × [preambleTransMax-Msg1-Repetition] + 1:\n6>\tif set of Random Access resources configured with the same prach-ConfigurationIndex and associated with a higher Msg1 repetition number with the same feature or feature combination as the current set of Random Access resources is available:\n7>\tselect the set of Random Access resources associated with the next higher Msg1 repetition number with the same feature or feature combination for this Random Access procedure;\n7>\tinitialize startPreambleForThisPartition, numberOfPreamblesPerSSB-ForThisPartition, ssb-SharedRO-MaskIndex and numberOfRA-PreamblesGroupA parameters for the Random Access procedure according to the values configured by RRC for the selected set of Random Access resources.\n4>\tselect a random backoff time according to a uniform distribution between 0 and the PREAMBLE_BACKOFF;\n4>\tif the criteria (as defined in clause 5.1.2) to select contention-free Random Access Resources is met during the backoff time:\n5>\tperform the Random Access Resource selection procedure (see clause 5.1.2);\n4>\telse:\n5>\tperform the Random Access Resource selection procedure (see clause 5.1.2) after the backoff time.\n3>\telse (i.e. the RA_TYPE is set to 2-stepRA):\n4>\tif msgA-TransMax is applied (see clause 5.1.1a) and PREAMBLE_TRANSMISSION_COUNTER = msgA-TransMax + 1:\n5>\tset the RA_TYPE to 4-stepRA;\n5>\tperform initialization of variables specific to Random Access type as specified in clause 5.1.1a;\n5>\tflush HARQ buffer used for the transmission of MAC PDU in the MSGA buffer;\n5>\tdiscard explicitly signalled contention-free 2-step RA type Random Access Resources, if any;\n5>\tperform the Random Access Resource selection as specified in clause 5.1.2.\n4>\telse:\n5>\tselect a random backoff time according to a uniform distribution between 0 and the PREAMBLE_BACKOFF;\n5>\tif the criteria (as defined in clause 5.1.2a) to select contention-free Random Access Resources is met during the backoff time:\n6>\tperform the Random Access Resource selection procedure for 2-step RA type as specified in clause 5.1.2a.\n5>\telse:\n6>\tperform the Random Access Resource selection for 2-step RA type procedure (see clause 5.1.2a) after the backoff time.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.6\tCompletion of the Random Access procedure",
                            "text_content": "Upon completion of the Random Access procedure, the MAC entity shall:\n1>\tdiscard any explicitly signalled contention-free Random Access Resources for 2-step RA type and 4-step RA type except the 4-step RA type contention-free Random Access Resources for beam failure recovery request, if any;\n1>\tflush the HARQ buffer used for transmission of the MAC PDU in the Msg3 buffer and the MSGA buffer.\nUpon successful completion of the Random Access procedure initiated for DAPS handover, the target MAC entity shall:\n1>\tindicate the successful completion of the Random Access procedure to the upper layers.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.2\tMaintenance of Uplink Time Alignment",
                    "description": "",
                    "summary": "",
                    "text_content": "RRC configures the following parameters for the maintenance of UL time alignment:\n-\ttimeAlignmentTimer (per TAG) which controls how long the MAC entity considers the Serving Cells to the associated TAG to be uplink time aligned for the TAG;\n-\tinactivePosSRS-TimeAlignmentTimer which controls how long the MAC entity considers the Positioning SRS transmission in RRC_INACTIVE in clause 5.26 to be uplink time aligned;\n-\tcg-SDT-TimeAlignmentTimer which controls how long the MAC entity considers the uplink transmission for CG-SDT to be uplink time aligned;\n-\tsrs-ValidityAreaTimeAlignmentTimer which controls how long the MAC entity considers Positioning SRS transmission in RRC_INACTIVE in clause 5.26 to be uplink time aligned when SRS positioning validity area is configured.\nThe MAC entity shall:\n1>\twhen a Timing Advance Command MAC CE is received, and if an NTA (as defined in TS 38.211 [8]) has been maintained with the indicated TAG:\n2>\tapply the Timing Advance Command for the indicated TAG;\n2>\tif there is ongoing Positioning SRS Transmission in RRC_INACTIVE as in clause 5.26:\n3>\tif SRS positioning validity area is configured:\n4>\tstart or restart the srs-ValidityAreaTimeAlignmentTimer associated with the indicated TAG.\n3>\telse:\n4>\tstart or restart the inactivePosSRS-TimeAlignmentTimer associated with the indicated TAG.\n2>\tif CG-SDT procedure triggered as in clause 5.27 is ongoing:\n3>\tstart or restart the cg-SDT-TimeAlignmentTimer associated with the indicated TAG.\n2>\telse:\n3>\tstart or restart the timeAlignmentTimer associated with the indicated TAG.\n1>\twhen a Timing Advance Command is received in a Random Access Response message for a Serving Cell configured with two TAGs or in a MSGB for an SpCell configured with two TAGs:\n2>\tif the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble:\n3>\tapply the Timing Advance Command for the TAG indicated in the received Random Access Response message or MSGB;\n3>\tstart or restart the timeAlignmentTimer associated with TAG indicated in the received Random Access Response message or MSGB.\n2>\telse if the timeAlignmentTimer associated with the TAG indicated in the received Random Access Response message or MSGB is not running:\n3>\tapply the Timing Advance Command for this TAG;\n3>\tstart the timeAlignmentTimer associated with this TAG;\n3>\twhen the Contention Resolution is considered not successful as described in clause 5.1.5:\n4>\tstop the timeAlignmentTimer associated with this TAG.\n2>\telse:\n3>\tignore the received Timing Advance Command.\n1>\twhen a Timing Advance Command is received in a Random Access Response message for a Serving Cell not configured with two TAGs or in a MSGB for an SpCell not configured with two TAGs:\n2>\tif the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble:\n3>\tapply the Timing Advance Command for this TAG;\n3>\tstart or restart the timeAlignmentTimer associated with this TAG.\n2>\telse if the timeAlignmentTimer associated with this TAG is not running:\n3>\tapply the Timing Advance Command for this TAG;\n3>\tstart the timeAlignmentTimer associated with this TAG;\n3>\twhen the Contention Resolution is considered not successful as described in clause 5.1.5; or\n3>\twhen the Contention Resolution is considered successful for SI request as described in clause 5.1.5, after transmitting HARQ feedback for MAC PDU including UE Contention Resolution Identity MAC CE:\n4>\tstop timeAlignmentTimer associated with this TAG.\n3>\twhen the Contention Resolution is considered not successful as described in clause 5.1.5:\n4>\tif CG-SDT procedure triggered as in clause 5.27 is ongoing:\n5>\tset the NTA value to the value before applying the received Timing Advance Command as in TS 38.211 [8].\n3>\twhen the Contention Resolution is considered successful for Random Access procedure while the CG-SDT procedure is ongoing:\n4>\tstop timeAlignmentTimer associated with this TAG;\n4>\tstart or restart the cg-SDT-TimeAlignmentTimer associated with this TAG.\n3>\twhen the Contention Resolution is considered successful for Random Access procedure while SRS transmission in RRC_INACTIVE is ongoing:\n4>\tif SRS positioning validity area is configured:\n5>\tstart or restart the srs-ValidityAreaTimeAlignmentTimer associated with the indicated TAG.\n4>\telse:\n5>\tstart or restart the inactivePosSRS-TimeAlignmentTimer associated with this TAG.\n2>\telse:\n3>\tignore the received Timing Advance Command.\n1>\twhen an Absolute Timing Advance Command is received in response to a MSGA transmission including C-RNTI MAC CE, as specified in clause 5.1.4a, for an SpCell configured with two TAGs:\n2>\tapply the Timing Advance Command for the PTAG indicated in the Absolute Timing Advance Command MAC CE;\n2>\tstart or restart the timeAlignmentTimer associated with this PTAG.\n1>\twhen an Absolute Timing Advance Command is received in response to a MSGA transmission including C-RNTI MAC CE, as specified in clause 5.1.4a, for an SpCell not configured with two TAGs:\n2>\tapply the Timing Advance Command for PTAG;\n2>\tif there is ongoing Positioning SRS Transmission in RRC_INACTIVE as in clause 5.26:\n3>\tif SRS positioning validity area is configured:\n4>\tstart or restart the srs-ValidityAreaTimeAlignmentTimer associated with the indicated TAG.\n3>\telse:\n4>\tstart or restart the inactivePosSRS-TimeAlignmentTimer associated with the indicated TAG.\n2>\tif CG-SDT procedure is ongoing:\n3>\tstart or restart the cg-SDT-TimeAlignmentTimer associated with PTAG.\n2>\telse:\n3>\tstart or restart the timeAlignmentTimer associated with PTAG.\n1>\twhen the MAC entity is configured with rach-LessHO:\n2>\tset the NTA value (as defined in TS 38.211 [8]) to the value indicated by targetNTA in rach-LessHO for PTAG;\n2>\tstart the timeAlignmentTimer associated with PTAG.\n1>\twhen the indication is received from upper layer for stopping the inactivePosSRS-TimeAlignmentTimer:\n2>\tstop the inactivePosSRS-TimeAlignmentTimer.\n1>\twhen the indication is received from upper layer for starting the inactivePosSRS-TimeAlignmentTimer:\n2>\tstart or restart the inactivePosSRS-TimeAlignmentTimer.\n1>\twhen instruction from the upper layer has been received for starting the cg-SDT-TimeAlignmentTimer:\n2>\tstart the cg-SDT-TimeAlignmentTimer.\n1>\twhen instruction from the upper layer has been received for stopping the cg-SDT-TimeAlignmentTimer:\n2>\tconsider the cg-SDT-TimeAlignmentTimer as expired.\n1>\twhen the indication is received from upper layer for starting the srs-ValidityArea-TimerAlignmentTimer:\n2>\tstart or restart the srs-ValidityArea-TimerAlignmentTimer.\n1>\twhen the indication is received from upper layer for stopping the srs-ValidityArea-TimerAlignmentTimer:\n2>\tstop the srs-ValidityArea-TimerAlignmentTimer.\n1>\twhen instruction from the upper layer has been received for starting the TimeAlignmentTimer associated with PTAG:\n2>\tstart the TimeAlignmentTimer associated with PTAG.\n1>\twhen an LTM Cell Switch Command MAC CE including a Timing Advance Command is received:\n2>\tapply the Timing Advance Command for the PTAG;\n2>\tstart or restart the timeAlignmentTimer associated with the PTAG.\n1>\twhen an LTM Cell Switch Command MAC CE is received and the UE has successfully measured the Timing Advance as in clause 5.18.35:\n2>\tapply the measured Timing Advance for the PTAG;\n2>\tstart or restart the timeAlignmentTimer associated with the PTAG.\n1>\twhen a timeAlignmentTimer expires:\n2>\tif the timeAlignmentTimer is associated with a PTAG and the SpCell is not configured with two PTAGs; or\n2>\tif the timeAlignmentTimer is associated with a PTAG, the SpCell is configured with two PTAGs, and the timeAlignmentTimer associated with the other PTAG is not running:\n3>\tflush all HARQ buffers for all Serving Cells;\n3>\tnotify RRC to release PUCCH for all Serving Cells, if configured;\n3>\tnotify RRC to release SRS for all Serving Cells, if configured;\n3>\tclear any configured downlink assignments and configured uplink grants;\n3>\tclear any PUSCH resource for semi-persistent CSI reporting;\n3>\tconsider all running timeAlignmentTimers as expired;\n3>\tmaintain NTA (defined in TS 38.211 [8]) of all TAGs.\n2>\telse if the timeAlignmentTimer is associated with a TAG for an SCell, then for all SCells configured with only this TAG; or\n2>\tif the timeAlignmentTimer is associated with a TAG for an SCell, and if the SCell is configured with two TAGs and the timeAlignmentTimer associated with the other TAG is not running, then for all such SCells:\n3>\tflush all HARQ buffers;\n3>\tnotify RRC to release PUCCH, if configured;\n3>\tnotify RRC to release SRS, if configured;\n3>\tclear any configured downlink assignments and configured uplink grants;\n3>\tclear any PUSCH resource for semi-persistent CSI reporting;\n3>\tmaintain NTA (defined in TS 38.211 [8]) of this TAG.\n2>\telse if the timeAlignmentTimer is associated with a TAG for a Serving Cell configured with two TAGs, and if the timeAlignmentTimer associated with the other TAG is running, then for all such Serving Cells:\n3>\tclear any configured downlink assignment, if the activated TCI state(s) for all PUCCH resources configured for the configured downlink assignment is associated with the TAG of the expired timeAlignmentTimer;\n3>\tclear any configured uplink grant, if the activated TCI state(s) for the configured uplink grant is associated with the TAG of the expired timeAlignmentTimer;\n3>\tclear any PUSCH resource for semi-persistent CSI reporting, if the activated TCI state(s) for the PUSCH resource is associated with the TAG of the expired timeAlignmentTimer;\n3>\tmaintain NTA (defined in TS 38.211 [8]) of this TAG.\n1>\twhen the inactivePosSRS-TimeAlignmentTimer expires:\n2>\tnotify RRC to release Positioning SRS for RRC_INACTIVE configuration(s).\n1>\twhen the cg-SDT-TimeAlignmentTimer expires:\n2>\tclear any configured uplink grants;\n2>\tif a PDCCH addressed to the MAC entity's C-RNTI after initial transmission for the CG-SDT with CCCH message has not been received:\n3>\tconsider ongoing CG-SDT procedure as terminated;\n3>\tindicate the expiry of cg-SDT-TimeAlignmentTimer to the upper layer.\n2>\tflush all HARQ buffers;\n2>\tmaintain NTA (defined in TS 38.211 [8]) of this TAG.\nWhen the MAC entity stops uplink transmissions for an SCell not configured with two TAGs due to the fact that the maximum uplink transmission timing difference between TAGs of the MAC entity or the maximum uplink transmission timing difference between TAGs of any MAC entity of the UE is exceeded, the MAC entity considers the timeAlignmentTimer associated with the SCell as expired.\nWhen the MAC entity stops uplink transmissions associated to a STAG for an SCell configured with two TAGs due to the fact that the maximum uplink transmission timing difference between TAGs of the MAC entity or the maximum uplink transmission timing difference between TAGs of any MAC entity of the UE is exceeded, the MAC entity considers the timeAlignmentTimer associated with the STAG as expired.\nThe MAC entity shall not perform any uplink transmission on a Serving Cell except the Random Access Preamble and MSGA transmission when the timeAlignmentTimer(s) associated with all TAG(s) to which this Serving Cell belongs is not running, CG-SDT procedure is not ongoing and SRS transmission in RRC_INACTIVE as in clause 5.26 is not on-going. Furthermore, when the timeAlignmentTimer(s) associated with all PTAG(s) is not running, CG-SDT procedure is not ongoing and SRS transmission in RRC_INACTIVE as in clause 5.26 is not ongoing, the MAC entity shall not perform any uplink transmission on any Serving Cell except the Random Access Preamble and MSGA transmission on the SpCell. The MAC entity shall not perform any uplink transmission except the Random Access Preamble and MSGA transmission when the cg-SDT-TimeAlignmentTimer is not running during the ongoing CG-SDT procedure as triggered in clause 5.27 and the inactivePosSRS-TimeAlignmentTimer or srs-ValidityAreaTimeAlignmentTimer is not running. The MAC entity shall not perform any uplink transmission except the Random Access Preamble and MSGA transmission on a Serving Cell using TCI state(s) associated with a TAG for which the timeAlignmentTimer is not running.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2a\tMaintenance of UL Synchronization",
                    "description": "",
                    "summary": "",
                    "text_content": "The MAC entity shall for each Serving Cell:\n1>\tif an indication of uplink synchronization has been received from upper layers (see clauses 5.2.2.6 and 5.7.19 of TS 38.331 [5]):\n2>\tif indication of uplink synchronization is received after indication of uplink synchronization loss due to satellite switch with re-synchronization (see clause 5.7.19 of TS 38.331 [5]):\n3>\tset NTA value (as defined in TS 38.211 [8]) to zero for PTAG;\n3>\tindicate to lower layers a Differential Koffset with value zero.\n2>\tallow uplink transmission on the Serving Cell.\n1>\tif an indication of uplink synchronization loss or uplink synchronization loss due to satellite switch with re-synchronization is received from upper layers (see clause 5.2.2.6 and 5.7.19 of TS 38.331 [5]):\n2>\tflush all HARQ buffers;\n2>\tnot perform any uplink transmission on the Serving Cell.\nNOTE:\tThe MAC entity suspends all UL operations (e.g. stop RACH, SR, and UL HARQ operation) after receiving the indication of an uplink synchronization loss and resumes the operation when receiving an indication of uplink synchronization.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.3\tDL-SCH data transfer",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tDL Assignment reception",
                            "text_content": "Downlink assignments received on the PDCCH both indicate that there is a transmission on a DL-SCH for a particular MAC entity and provide the relevant HARQ information.\nWhen the MAC entity has a C-RNTI, Temporary C-RNTI, CS-RNTI, G-RNTI or G-CS-RNTI, the MAC entity shall for each PDCCH occasion during which it monitors PDCCH and for each Serving Cell:\n1>\tif a downlink assignment for this PDCCH occasion and this Serving Cell has been received on the PDCCH for the MAC entity's C-RNTI, or Temporary C-RNTI, or G-RNTI configured for multicast MTCH:\n2>\tif this is the first downlink assignment for this Temporary C-RNTI:\n3>\tconsider the NDI to have been toggled.\n2>\tif the downlink assignment is for the MAC entity's C-RNTI, and if the previous downlink assignment indicated to the HARQ entity of the same HARQ process was either a downlink assignment received for the MAC entity's CS-RNTI or G-CS-RNTI, or a configured downlink assignment for unicast or MBS multicast; or\n2>\tif the downlink assignment is for the MAC entity's G-RNTI configured for multicast MTCH, and if the previous downlink assignment indicated to the HARQ entity of the same HARQ process was either a downlink assignment received for the MAC entity's CS-RNTI or G-CS-RNTI, or other G-RNTI, or C-RNTI, or a configured downlink assignment for unicast or MBS multicast:\n3>\tconsider the NDI to have been toggled regardless of the value of the NDI.\n2>\tstop the cg-SDT-RetransmissionTimer, if it is running, for the corresponding HARQ process for initial transmission with CCCH message;\n2>\tstop the cg-RACH-less-RetransmissionTimer, if it is running, for the corresponding HARQ process for initial transmission of RACH-less handover;\n2>\tstop the cg-LTM-RetransmissionTimer, if it is running, for the corresponding HARQ process for the first PUSCH transmission at LTM cell switch;\n2>\tstop the configuredGrantTimer, if it is running, for the corresponding HARQ process for initial transmission with CCCH message;\n2>\tif there is an ongoing RACH-less handover procedure; and\n2>\tif the downlink assignment has been received on the PDCCH for the MAC entity's C-RNTI after the first PUSCH transmission to the Serving Cell; and\n2>\tif the downlink assignment is for a new transmission:\n3>\tindicate to upper layers the successful completion of RACH-less handover.\n2>\tindicate the presence of a downlink assignment and deliver the associated HARQ information to the HARQ entity.\n2>\tif there is an ongoing RACH-less LTM cell switch; and\n2>\tif the downlink assignment has been received on the PDCCH for the MAC entity's C-RNTI after the first PUSCH transmission to the Serving Cell; and\n2>\tif the downlink assignment is for a new transmission:\n3>\tconsider the LTM cell switch to be successfully completed and indicate it to upper layers.\n1>\telse if a downlink assignment for this PDCCH occasion has been received for this Serving Cell on the PDCCH for the MAC entity's CS-RNTI or G-CS-RNTI:\n2>\tif the NDI in the received HARQ information is 1:\n3>\tconsider the NDI for the corresponding HARQ process not to have been toggled;\n3>\tindicate the presence of a downlink assignment for this Serving Cell and deliver the associated HARQ information to the HARQ entity.\n2>\tif the NDI in the received HARQ information is 0:\n3>\tif PDCCH contents indicate SPS deactivation:\n4>\tclear the configured downlink assignment for this Serving Cell (if any);\n4>\tif the timeAlignmentTimer, associated with the TAG containing the Serving Cell on which the HARQ feedback is to be transmitted, is running, and the Serving Cell is not configured with two TAGs; or\n4>\tif the Serving Cell on which the HARQ feedback is to be transmitted is configured with two TAGs and if the timeAlignmentTimer of the TAG, associated with the TCI state(s) used for transmitting the HARQ feedback, is running:\n5>\tindicate a positive acknowledgement for the SPS deactivation to the physical layer.\n3>\telse if PDCCH content indicates SPS activation:\n4>\tstore the downlink assignment for this Serving Cell and the associated HARQ information as configured downlink assignment;\n4>\tinitialise or re-initialise the configured downlink assignment for this Serving Cell to start in the associated PDSCH duration and to recur according to rules in clause 5.8.1 or in clause 5.8.1a;\nFor each Serving Cell and each configured downlink assignment, if configured and activated, the MAC entity shall:\n1>\tif the PDSCH duration of the configured downlink assignment does not overlap with the PDSCH duration of a downlink assignment received on the PDCCH for this Serving Cell:\n2>\tinstruct the physical layer to receive, in this PDSCH duration, transport block on the DL-SCH according to the configured downlink assignment and to deliver it to the HARQ entity;\n2>\tset the HARQ Process ID to the HARQ Process ID associated with this PDSCH duration;\n2>\tconsider the NDI bit for the corresponding HARQ process to have been toggled;\n2>\tindicate the presence of a configured downlink assignment and deliver the stored HARQ information to the HARQ entity.\nFor configured downlink assignments without harq-ProcID-Offset, the HARQ Process ID associated with the slot where the DL transmission starts is derived from the following equation:\nHARQ Process ID = [floor (CURRENT_slot × 10 / (numberOfSlotsPerFrame × periodicity))]\n\tmodulo nrofHARQ-Processes\nwhere CURRENT_slot = [(SFN × numberOfSlotsPerFrame) + slot number in the frame] and numberOfSlotsPerFrame refers to the number of consecutive slots per frame as specified in TS 38.211 [8].\nFor configured downlink assignments with harq-ProcID-Offset, the HARQ Process ID associated with the slot where the DL transmission starts is derived from the following equation:\nHARQ Process ID = [floor (CURRENT_slot × 10 / (numberOfSlotsPerFrame × periodicity))]\n\tmodulo nrofHARQ-Processes + harq-ProcID-Offset\nwhere CURRENT_slot = [(SFN × numberOfSlotsPerFrame) + slot number in the frame] and numberOfSlotsPerFrame refers to the number of consecutive slots per frame as specified in TS 38.211 [8].\nNOTE 1:\tIn case of unaligned SFN across carriers in a cell group, the SFN of the concerned Serving Cell is used to calculate the HARQ Process ID used for configured downlink assignments.\nNOTE 2:\tCURRENT_slot refers to the slot index of the first transmission occasion of a bundle of configured downlink assignment.\nWhen the MAC entity needs to read BCCH, the MAC entity may, based on the scheduling information from RRC:\n1>\tif a downlink assignment for this PDCCH occasion has been received on the PDCCH for the SI-RNTI;\n2>\tindicate a downlink assignment and redundancy version for the dedicated broadcast HARQ process to the HARQ entity.\nWhen the MAC entity needs to read MCCH, the MAC entity may, based on the scheduling information from RRC:\n1>\tif a downlink assignment for this PDCCH occasion has been received on the PDCCH for the MCCH-RNTI or Multicast MCCH-RNTI:\n2>\tindicate a downlink assignment and redundancy version for the selected HARQ process to the HARQ entity.\nWhen the MAC entity needs to read broadcast MTCH, the MAC entity may, based on the scheduling information from RRC and DCI:\n1>\tif a downlink assignment for this PDCCH occasion has been received on the PDCCH for the G-RNTI configured for broadcast MTCH:\n2>\tindicate the presence of a downlink assignment and deliver the associated HARQ information for the selected HARQ process to the HARQ entity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.2\tHARQ operation",
                            "text_content": "The MAC entity includes a HARQ entity for each Serving Cell, which maintains a number of parallel HARQ processes. Each HARQ process is associated with a HARQ process identifier. The HARQ entity directs HARQ information and associated TBs received on the DL-SCH to the corresponding HARQ processes (see clause 5.3.2.2).\nThe number of parallel DL HARQ processes per HARQ entity is specified in TS 38.214 [7]. The dedicated broadcast HARQ process is used for BCCH.\nThe HARQ process supports one TB when the physical layer is not configured for downlink spatial multiplexing. The HARQ process supports one or two TBs when the physical layer is configured for downlink spatial multiplexing.\nWhen the MAC entity is configured with pdsch-AggregationFactor > 1, the parameter pdsch-AggregationFactor provides the number of transmissions of a TB within a bundle of the downlink assignment. Bundling operation relies on the HARQ entity for invoking the same HARQ process for each transmission that is part of the same bundle. After the initial transmission, pdsch-AggregationFactor – 1 HARQ retransmissions follow within a bundle.\nThe MAC entity shall:\n1>\tif a downlink assignment has been indicated:\n2>\tallocate the TB(s) received from the physical layer and the associated HARQ information to the HARQ process indicated by the associated HARQ information.\n1>\tif a downlink assignment has been indicated for the broadcast HARQ process:\n2>\tallocate the received TB to the broadcast HARQ process.\nNOTE:\tIt is up to UE implementation to allocate the received TB for multicast MCCH or broadcast MCCH or broadcast MTCH to one HARQ process.\nWhen a transmission takes place for the HARQ process, one or two (in case of downlink spatial multiplexing) TBs and the associated HARQ information are received from the HARQ entity.\nFor each received TB and associated HARQ information, the HARQ process shall:\n1>\tif the NDI, when provided, has been toggled compared to the value of the previous received transmission corresponding to this TB; or\n1>\tif the HARQ process is equal to the broadcast process, and this is the first received transmission for the TB according to the system information schedule indicated by RRC; or\n1>\tif the HARQ process is associated with a transmission indicated with a MCCH-RNTI for MBS broadcast, and this is the first received transmission for the TB according to the broadcast MCCH schedule indicated by RRC; or\n1>\tif the HARQ process is associated with a transmission indicated with a Multicast MCCH-RNTI for MBS multicast, and this is the first received transmission for the TB according to the multicast MCCH schedule indicated by RRC; or\n1>\tif the HARQ process is associated with a transmission indicated with a G-RNTI for MBS broadcast, and this is the first received transmission for the TB according to the MTCH schedule indicated by RRC or according to the scheduling indicated by DCI as specified in TS 38.214 [7]; or\n1>\tif this is the very first received transmission for this TB (i.e. there is no previous NDI for this TB):\n2>\tconsider this transmission to be a new transmission.\n1>\telse:\n2>\tconsider this transmission to be a retransmission.\nThe MAC entity then shall:\n1>\tif this is a new transmission:\n2>\tattempt to decode the received data.\n1>\telse if this is a retransmission:\n2>\tif the data for this TB has not yet been successfully decoded:\n3>\tinstruct the physical layer to combine the received data with the data currently in the soft buffer for this TB and attempt to decode the combined data.\n1>\tif the data which the MAC entity attempted to decode was successfully decoded for this TB; or\n1>\tif the data for this TB was successfully decoded before:\n2>\tif the HARQ process is equal to the broadcast process:\n3>\tdeliver the decoded MAC PDU to upper layers.\n2>\telse if this is the first successful decoding of the data for this TB:\n3>\tdeliver the decoded MAC PDU to the disassembly and demultiplexing entity.\n1>\telse:\n2>\tinstruct the physical layer to replace the data in the soft buffer for this TB with the data which the MAC entity attempted to decode.\n1>\tif the HARQ process is associated with a transmission indicated with a Temporary C-RNTI and the Contention Resolution is not yet successful (see clause 5.1.5); or\n1>\tif the HARQ process is associated with a transmission indicated with a MSGB-RNTI and the Random Access procedure is not yet successfully completed (see clause 5.1.4a); or\n1>\tif the HARQ process is equal to the broadcast process; or\n1>\tif the HARQ process is associated with a transmission indicated with a MCCH-RNTI or a G-RNTI for MBS broadcast; or\n1>\tif the HARQ process is associated with a transmission indicated with a Multicast MCCH-RNTI for MBS multicast; or\n1>\tif the HARQ process is associated with a transmission indicated with a G-RNTI or a G-CS-RNTI or a configured downlink assignment for MBS multicast and HARQ feedback is disabled for this G-RNTI or G-CS-RNTI or the corresponding G-CS-RNTI, as specified in clause 18 of TS 38.213 [6]; or\n1>\tif the HARQ process is associated with a transmission indicated with a G-RNTI or a G-CS-RNTI or a configured downlink assignment for MBS multicast and NACK only HARQ feedback is used for this G-RNTI or G-CS-RNTI or the corresponding G-CS-RNTI and the data for this TB is successfully decoded and the transmission is not the first transmission of PDSCH where the configured downlink assignment was (re-)initialised; or\n1>\tif the timeAlignmentTimer, associated with the TAG containing the Serving Cell on which the HARQ feedback is to be transmitted, is stopped or expired, and the Serving Cell is not configured with two TAGs, and if the cg-SDT-TimeAlignmentTimer, if configured, is not running; or\n1>\tif the Serving Cell on which the HARQ feedback is to be transmitted is configured with two TAGs and if the timeAlignmentTimer of the TAG, associated with the TCI state(s) used for transmitting the HARQ feedback, is stopped or expired:\n2>\tnot instruct the physical layer to generate acknowledgement(s) of the data in this TB.\n1>\telse if the HARQ process is configured with disabled HARQ feedback:\n2>\tif harq-FeedbackEnablingforSPSactive is configured with value true and the transmission is the first transmission on the configured downlink assignment after activation of the configured downlink assignment:\n3>\tinstruct the physical layer to generate acknowledgement(s) of the data in this TB.\n2>\telse:\n3>\tnot instruct the physical layer to generate acknowledgement(s) of the data in this TB.\n1>\telse:\n2>\tinstruct the physical layer to generate acknowledgement(s) of the data in this TB.\nThe MAC entity shall ignore NDI received in all downlink assignments on PDCCH for its Temporary C-RNTI when determining if NDI on PDCCH for its C-RNTI has been toggled compared to the value in the previous transmission.\nNOTE:\tIf the MAC entity receives a retransmission with a TB size different from the last TB size signalled for this TB, the UE behavior is left up to UE implementation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.3\tDisassembly and demultiplexing",
                            "text_content": "The MAC entity shall disassemble and demultiplex a MAC PDU as defined in clauses 6.1.2 and 6.1.5a.\nWhen a MAC entity receives a MAC PDU for MAC entity's G-RNTI or G-CS-RNTI, or by the configured downlink assignment for MBS multicast containing an LCID or eLCID which is not configured, the MAC entity shall at least:\n1>\tdiscard the received subPDU.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.4\tUL-SCH data transfer",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.4.1\tUL Grant reception",
                            "text_content": "Uplink grant is either received dynamically on the PDCCH, in a Random Access Response, configured semi-persistently by RRC or determined to be associated with the PUSCH resource of MSGA as specified in clause 5.1.2a. The MAC entity shall have an uplink grant to transmit on the UL-SCH. To perform the requested transmissions, the MAC layer receives HARQ information from lower layers. An uplink grant addressed to CS-RNTI with NDI = 0 is considered as a configured uplink grant. An uplink grant addressed to CS-RNTI with NDI = 1 is considered as a dynamic uplink grant.\nIf the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC entity shall for each PDCCH occasion and for each Serving Cell belonging to a TAG that has a running timeAlignmentTimer or a running cg-SDT-TimeAlignmentTimer and for each grant received for this PDCCH occasion:\n1>\tif an uplink grant for this Serving Cell has been received on the PDCCH for the MAC entity's C-RNTI or Temporary C-RNTI; or\n1>\tif an uplink grant has been received in a Random Access Response:\n2>\tif the uplink grant is for MAC entity's C-RNTI and if the previous uplink grant delivered to the HARQ entity for the same HARQ process was either an uplink grant received for the MAC entity's CS-RNTI or a configured uplink grant:\n3>\tconsider the NDI to have been toggled for the corresponding HARQ process regardless of the value of the NDI.\n2>\tif the uplink grant is for MAC entity's C-RNTI, and the identified HARQ process is configured for a configured uplink grant:\n3>\tstart or restart the configuredGrantTimer for the corresponding HARQ process, if configured;\n3>\tstop the cg-RetransmissionTimer for the corresponding HARQ process, if running.\n2>\tstop the cg-SDT-RetransmissionTimer for the corresponding HARQ process, if running.\n2>\tstop the cg-LTM-RetransmissionTimer for the corresponding HARQ process, if running.\n2>\tstop the cg-RACH-less-RetransmissionTimer for the corresponding HARQ process, if running.\n2>\tif there is an ongoing RACH-less handover procedure; and\n2>\tif the uplink grant has been received on the PDCCH for the MAC entity's C-RNTI after the first PUSCH transmission to the Serving Cell; and\n2>\tif the uplink grant is for a new transmission on the same HARQ process used for the first PUSCH transmission to the Serving Cell:\n3>\tindicate to upper layers the successful completion of RACH-less handover.\n2>\tdeliver the uplink grant and the associated HARQ information to the HARQ entity;\n2>\tif there is an ongoing RACH-less LTM cell switch; and\n2>\tif the uplink grant has been received on the PDCCH for the MAC entity's C-RNTI after the first PUSCH transmission to the Serving Cell; and\n2>\tif the uplink grant is for a new transmission on the same HARQ process used for the first PUSCH transmission to the Serving Cell:\n3>\tconsider the LTM cell switch to be successfully completed and indicate it to upper layers.\n1>\telse if an uplink grant for this PDCCH occasion has been received for this Serving Cell on the PDCCH for the MAC entity's CS-RNTI:\n2>\tif the NDI in the received HARQ information is 1:\n3>\tconsider the NDI for the corresponding HARQ process not to have been toggled;\n3>\tstart or restart the configuredGrantTimer for the corresponding HARQ process, if configured;\n3>\tstop the cg-RetransmissionTimer for the corresponding HARQ process, if running;\n3>\tstop the cg-SDT-RetransmissionTimer for the corresponding HARQ process, if running;\n3>\tstop the cg-LTM-RetransmissionTimer for the corresponding HARQ process, if running;\n3>\tstop the cg-RACH-less-RetransmissionTimer for the corresponding HARQ process, if running;\n3>\tdeliver the uplink grant and the associated HARQ information to the HARQ entity;\n3>\tif a logical channel associated with a DRB configured with survivalTimeStateSupport is multiplexed in the MAC PDU stored in the HARQ buffer for the corresponding HARQ process:\n4>\ttrigger activation of PDCP duplication for all configured RLC entities of the DRB.\n2>\telse if the NDI in the received HARQ information is 0:\n3>\tif PDCCH contents indicate configured grant Type 2 deactivation:\n4>\ttrigger configured uplink grant confirmation.\n3>\telse if PDCCH contents indicate configured grant Type 2 activation:\n4>\ttrigger configured uplink grant confirmation;\n4>\tstore the uplink grant for this Serving Cell and the associated HARQ information as configured uplink grant;\n4>\tinitialise or re-initialise the configured uplink grant for this Serving Cell to start in the associated PUSCH duration and to recur according to rules in clause 5.8.2;\n4>\tstop the configuredGrantTimer for the corresponding HARQ process, if running;\n4>\tstop the cg-RetransmissionTimer for the corresponding HARQ process, if running.\nFor each Serving Cell and each configured uplink grant, if configured and activated and available for use as specified in clause 5.8.2, the MAC entity shall:\n1>\tif the MAC entity is configured with lch-basedPrioritization, and the PUSCH duration of the configured uplink grant does not overlap with the PUSCH duration of an uplink grant received in a Random Access Response or with the PUSCH duration of an uplink grant addressed to Temporary C-RNTI or the PUSCH duration of a MSGA payload for this Serving Cell; or\n1>\tif the MAC entity is not configured with lch-basedPrioritization, and the PUSCH duration of the configured uplink grant does not overlap with the PUSCH duration of an uplink grant received on the PDCCH or in a Random Access Response or the PUSCH duration of a MSGA payload for this Serving Cell:\n2>\tset the HARQ Process ID to the HARQ Process ID associated with this PUSCH duration;\n2>\tif, for the corresponding HARQ process, the configuredGrantTimer is not running and cg-RetransmissionTimer is not configured and cg-SDT-RetransmissionTimer is not configured, and cg-LTM-RetransmissionTimer is not configured, and cg-RACH-less-RetransmissionTimer is not configured (i.e. new transmission):\n3>\tif there is an on-going CG-SDT procedure and PDCCH addressed to the MAC entity's C-RNTI has been received; or\n3>\tif there is an on-going RACH-less LTM cell switch procedure and PDCCH addressed to the MAC entity's C-RNTI has been received; or\n3>\tif there is an on-going RACH-less handover procedure and PDCCH addressed to the MAC entity's C-RNTI has been received; or\n3>\tif there is no on-going CG-SDT nor on-going RACH-less LTM cell switch nor on-going RACH-less handover procedure:\n4>\tconsider the NDI bit for the corresponding HARQ process to have been toggled;\n4>\tdeliver the configured uplink grant and the associated HARQ information to the HARQ entity.\n2>\telse if the cg-RetransmissionTimer for the corresponding HARQ process is configured and not running, then for the corresponding HARQ process:\n3>\tif the configuredGrantTimer is not running, and the HARQ process is not pending (i.e. new transmission):\n4>\tconsider the NDI bit to have been toggled;\n4>\tdeliver the configured uplink grant and the associated HARQ information to the HARQ entity.\n3>\telse if the previous uplink grant delivered to the HARQ entity for the same HARQ process was a configured uplink grant (i.e. retransmission on configured grant):\n4>\tdeliver the configured uplink grant and the associated HARQ information to the HARQ entity.\n2>\telse if the cg-SDT-RetransmissionTimer is configured and not running for the corresponding HARQ process;\n3>\tif the configured uplink grant is for the initial transmission for the CG-SDT with CCCH message (i.e., initial new transmission); or\n3>\tif the configuredGrantTimer is not running or not configured, and PDCCH addressed to the MAC entity's C-RNTI has been received after the initial transmission of the CG-SDT with CCCH message (i.e., subsequent new transmission):\n4>\tconsider the NDI bit to have been toggled;\n4>\tdeliver the configured uplink grant and the associated HARQ information to the HARQ entity.\n3>\telse if the previous uplink grant delivered to the HARQ entity for the same HARQ process was a configured uplink grant for initial transmission of CG-SDT with CCCH message or for its retransmission; and\n3>\tif PDCCH addressed to the MAC entity's C-RNTI has not been received (i.e., retransmission for initial CG-SDT transmission):\n4>\tconsider the NDI bit to have not been toggled;\n4>\tdeliver the configured uplink grant and the associated HARQ information to the HARQ entity.\n2>\telse if the cg-LTM-RetransmissionTimer is configured and not running for the corresponding HARQ process:\n3>\tif the configured uplink grant is for the first PUSCH transmission at LTM cell switch (i.e., initial new transmission):\n4>\tconsider the NDI bit to have been toggled;\n4>\tdeliver the configured uplink grant and the associated HARQ information to the HARQ entity.\n3>\telse if the previous uplink grant delivered to the HARQ entity for the same HARQ process was a configured uplink grant for first PUSCH transmission at LTM cell switch or for its retransmission; and\n3>\tif PDCCH addressed to the MAC entity's C-RNTI has not been received on the same HARQ process used for the first PUSCH transmission to the Serving Cell (i.e., retransmission for initial transmission):\n4>\tconsider the NDI bit to have not been toggled;\n4>\tdeliver the configured uplink grant and the associated HARQ information to the HARQ entity.\n2>\telse if the cg-RACH-less-RetransmissionTimer is configured and not running for the corresponding HARQ process;\n3>\tif the configured uplink grant is for the initial transmission of RACH-less handover (i.e., initial new transmission):\n4>\tconsider the NDI bit to have been toggled;\n4>\tdeliver the configured uplink grant and the associated HARQ information to the HARQ entity.\n3>\telse if the previous uplink grant delivered to the HARQ entity for the same HARQ process was a configured uplink grant for initial transmission of RACH-less handover or for its retransmission; and\n3>\tif PDCCH addressed to the MAC entity's C-RNTI has not been received (i.e., retransmission for initial transmission):\n4>\tconsider the NDI bit to have not been toggled;\n4>\tdeliver the configured uplink grant and the associated HARQ information to the HARQ entity.\nFor configured uplink grants that are not part of a multi-PUSCH configured grant and neither configured with harq-ProcID-Offset2 nor with cg-RetransmissionTimer, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:\nHARQ Process ID = [floor(CURRENT_symbol/periodicity)] modulo nrofHARQ-Processes\nFor configured uplink grants that are not part of a multi-PUSCH configured grant and configured with harq-ProcID-Offset2, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:\nHARQ Process ID = [floor(CURRENT_symbol / periodicity)] modulo nrofHARQ-Processes + harq-ProcID-Offset2\nFor a multi-PUSCH configured grant (as specified in clause 5.8.2) configured with neither harq-ProcID-Offset2 nor cg-RetransmissionTimer, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:\nHARQ Process ID = [nrofSlotsInCG-Period× floor (CURRENT_symbol / periodicity) + ID_OFFSET] modulo nrofHARQ-Processes\nFor a multi-PUSCH configured grant configured with harq-ProcID-Offset2, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:\nHARQ Process ID = [nrofSlotsInCG-Period × floor (CURRENT_symbol / periodicity) + ID_OFFSET] modulo nrofHARQ-Processes + harq-ProcID-Offset2\nwhere CURRENT_symbol if cg-SDT-PeriodicityExt (as defined in TS 38.331 [5]) is not configured = (SFN × numberOfSlotsPerFrame × numberOfSymbolsPerSlot + slot number in the frame × numberOfSymbolsPerSlot + symbol number in the slot), and numberOfSlotsPerFrame and numberOfSymbolsPerSlot refer to the number of consecutive slots per frame and the number of consecutive symbols per slot, respectively as specified in TS 38.211 [8]. For a multi-PUSCH configured grant, ID_OFFSET equals 0 for the first configured uplink grant within a periodicity of the configuration and K for the Kth (1 ≤ K < nrofSlotsInCG-Period) valid configured uplink grant after the first configured uplink grant within the same periodicity. A configured uplink grant in a multi-PUSCH configured grant is not considered valid if it satisfies the conditions specified in clause 6.1 in TS 38.214 [7].\nAlternatively, if cg-SDT-PeriodicityExt (as defined in TS 38.331 [5]) is configured, CURRENT_symbol = ((H-SFN × numberOfSFNperH-SFN + SFN) × numberOfSlotsPerFrame × numberOfSymbolsPerSlot + slot number in the frame × numberOfSymbolsPerSlot + symbol number in the slot), and numberOfSFNperH-SFN, numberOfSlotsPerFrame and numberOfSymbolsPerSlot refer to the number of consecutive frames per H-SFN, the number of consecutive slots per frame and the number of consecutive symbols per slot, respectively as specified in TS 38.211 [8].\nFor configured uplink grants configured with cg-RetransmissionTimer, the UE implementation selects an HARQ Process ID among the HARQ process IDs available for the configured grant configuration. If the MAC entity is configured with intraCG-Prioritization, for HARQ Process ID selection, the UE shall prioritize the HARQ Process ID with the highest priority, where the priority of HARQ process is determined by the highest priority among priorities of the logical channels that are multiplexed (i.e. the MAC PDU to transmit is already stored in the HARQ buffer) or have data available that can be multiplexed (i.e. the MAC PDU to transmit is not stored in the HARQ buffer) in the MAC PDU, according to the mapping restrictions as described in clause 5.4.3.1.2. If the MAC entity is configured with intraCG-Prioritization, for HARQ Process ID selection among initial transmission and retransmission with equal priority, the UE shall prioritize retransmissions before initial transmissions. The priority of a HARQ Process for which no data for logical channels is multiplexed or can be multiplexed in the MAC PDU is lower than the priority of a HARQ Process for which data for any logical channels is multiplexed or can be multiplexed in the MAC PDU. If the MAC entity is not configured with intraCG-Prioritization, for HARQ Process ID selection, the UE shall prioritize retransmissions before initial transmissions. The UE shall toggle the NDI in the CG-UCI for new transmissions and not toggle the NDI in the CG-UCI in retransmissions.\nNOTE 1:\tCURRENT_symbol refers to the symbol index of the first transmission occasion of a bundle of configured uplink grant.\nNOTE 2:\tA HARQ process is configured for a configured uplink grant where neither harq-ProcID-Offset nor harq-ProcID-Offset2 is configured, if the configured uplink grant is activated and the associated HARQ process ID is less than nrofHARQ-Processes. A HARQ process is configured for a configured uplink grant where harq-ProcID-Offset2 is configured, if the configured uplink grant is activated and the associated HARQ process ID is greater than or equal to harq-ProcID-Offset2 and less than sum of harq-ProcID-Offset2 and nrofHARQ-Processes for the configured grant configuration.\nNOTE 3:\tIf the MAC entity receives a grant in a Random Access Response (i.e. MAC RAR or fallbackRAR), or addressed to Temporary C-RNTI or determines a grant as specified in clause 5.1.2a for MSGA payload and if the MAC entity also receives an overlapping grant for its C-RNTI or CS-RNTI, requiring concurrent transmissions on the SpCell, the MAC entity may choose to continue with either the grant for its RA-RNTI/Temporary C-RNTI/MSGB-RNTI/the MSGA payload transmission or the grant for its C-RNTI or CS-RNTI.\nNOTE 4:\tIn case of unaligned SFN across carriers in a cell group, the SFN of the concerned Serving Cell is used to calculate the HARQ Process ID used for configured uplink grants.\nNOTE 5:\tIf cg-RetransmissionTimer is not configured, a HARQ process is not shared between different configured grant configurations in the same BWP.\nFor the MAC entity configured with lch-basedPrioritization, priority of an uplink grant is determined by the highest priority among priorities of the logical channels that are multiplexed (i.e. the MAC PDU to transmit is already stored in the HARQ buffer) or have data available that can be multiplexed (i.e. the MAC PDU to transmit is not stored in the HARQ buffer) in the MAC PDU, according to the mapping restrictions as described in clause 5.4.3.1.2. The priority of an uplink grant for which no data for logical channels is multiplexed or can be multiplexed in the MAC PDU is lower than either the priority of an uplink grant for which data for any logical channels is multiplexed or can be multiplexed in the MAC PDU or the priority of the logical channel triggering an SR.\nFor the MAC entity configured with lch-basedPrioritization, if the corresponding PUSCH transmission of a configured uplink grant is cancelled by CI-RNTI as specified in clause 11.2A of TS 38.213 [6] or cancelled by a high PHY-priority PUCCH transmission as specified in clause 9 of TS 38.213 [6], this configured uplink grant is considered as a de-prioritized uplink grant. If this de-prioritized uplink grant is configured with autonomousTx, the configuredGrantTimer for the corresponding HARQ process of this de-prioritized uplink grant shall be stopped if it is running. If this de-prioritized uplink grant is configured with autonomousTx, the cg-RetransmissionTimer for the corresponding HARQ process of this de-prioritized uplink grant shall be stopped if it is running.\nWhen the MAC entity is configured with lch-basedPrioritization, for each uplink grant delivered to the HARQ entity and whose associated PUSCH can be transmitted by lower layers, the MAC entity shall:\n1>\tif this uplink grant is received in a Random Access Response (i.e. in a MAC RAR or fallback RAR), or addressed to Temporary C-RNTI, or is determined as specified in clause 5.1.2a for the transmission of the MSGA payload:\n2>\tconsider this uplink grant as a prioritized uplink grant.\n1>\telse if this uplink grant is addressed to CS-RNTI with NDI = 1 or C-RNTI:\n2>\tif there is no overlapping PUSCH duration of a configured uplink grant which was not already de-prioritized, in the same BWP, whose priority is higher than the priority of the uplink grant; and\n2>\tif there is no overlapping PUCCH resource with an SR transmission which was not already de-prioritized and the simultaneous transmission of the SR and the uplink grant is not allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups, and the priority of the logical channel that triggered the SR is higher than the priority of the uplink grant:\n3>\tconsider this uplink grant as a prioritized uplink grant;\n3>\tconsider the other overlapping uplink grant(s), if any, as a de-prioritized uplink grant(s);\n3>\tconsider the other overlapping SR transmission(s), if any, as a de-prioritized SR transmission(s), except for the SR transmission(s) whose simultaneous transmission is allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups;\n3>\tif the de-prioritized uplink grant(s) is a configured uplink grant configured with autonomousTx whose PUSCH has already started:\n4>\tstop the configuredGrantTimer for the corresponding HARQ process of the de-prioritized uplink grant(s);\n4>\tstop the cg-RetransmissionTimer for the corresponding HARQ process of the de-prioritized uplink grant(s).\n1>\telse if this uplink grant is a configured uplink grant:\n2>\tif there is no overlapping PUSCH duration of another configured uplink grant which was not already de-prioritized, in the same BWP, whose priority is higher than the priority of the uplink grant; and\n2>\tif there is no overlapping PUSCH duration of an uplink grant addressed to CS-RNTI with NDI = 1 or C-RNTI which was not already de-prioritized, in the same BWP, whose priority is higher than or equal to the priority of the uplink grant; and\n2>\tif there is no overlapping PUCCH resource with an SR transmission which was not already de-prioritized and the simultaneous transmission of the SR and the uplink grant is not allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups, and the priority of the logical channel that triggered the SR is higher than the priority of the uplink grant:\n3>\tconsider this uplink grant as a prioritized uplink grant;\n3>\tconsider the other overlapping uplink grant(s), if any, as a de-prioritized uplink grant(s);\n3>\tif the de-prioritized uplink grant(s) is a configured uplink grant configured with autonomousTx whose PUSCH has already started:\n4>\tstop the configuredGrantTimer for the corresponding HARQ process of the de-prioritized uplink grant(s);\n4>\tstop the cg-RetransmissionTimer for the corresponding HARQ process of the de-prioritized uplink grant(s).\n3>\tconsider the other overlapping SR transmission(s), if any, as a de-prioritized SR transmission(s), except for the SR transmission(s) whose simultaneous transmission is allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups.\nNOTE 6:\tIf the MAC entity is configured with lch-basedPrioritization and if there is overlapping PUSCH duration of at least two configured uplink grants whose priorities are equal, the prioritized uplink grant is determined by UE implementation.\nNOTE 7:\tIf the MAC entity is not configured with lch-basedPrioritization and if there is overlapping PUSCH duration of at least two configured uplink grants, it is up to UE implementation to choose one of the configured uplink grants.\nNOTE 8:\tIf the MAC entity is configured with lch-basedPrioritization, the MAC entity does not take UCI multiplexing according to the procedure specified in TS 38.213 [6] into account when determining whether the PUSCH duration of an uplink grant overlaps with the PUCCH resource for an SR transmission.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.2\tHARQ operation",
                            "text_content": "The MAC entity includes a HARQ entity for each Serving Cell with configured uplink (including the case when it is configured with supplementaryUplink), which maintains a number of parallel HARQ processes.\nThe number of parallel UL HARQ processes per HARQ entity is specified in TS 38.214 [7].\nEach HARQ process supports one TB.\nEach HARQ process is associated with a HARQ process identifier. For UL transmission with UL grant in RA Response or for UL transmission for MSGA payload, HARQ process identifier 0 is used.\nNOTE:\tWhen a single DCI is used to schedule multiple PUSCH, the UE is allowed to map generated TB(s) internally to different HARQ processes in case of LBT failure(s), i.e. UE may transmit a new TB on any HARQ process in the grants that have the same TBS, the same RV and the NDIs indicate new transmission.\nThe maximum number of transmissions of a TB within a bundle of the dynamic grant or configured grant or the uplink grant received in a MAC RAR is given by REPETITION_NUMBER as follows:\n-\tFor a dynamic grant, REPETITION_NUMBER is set to a value provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214 [7];\n-\tFor a configured grant, REPETITION_NUMBER is set to a value provided by lower layers, as specified in clause 6.1.2.3 of TS 38.214 [7];\n-\tFor an uplink grant received in a MAC RAR, REPETITION_NUMBER is set to a value provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214 [7].\nIf REPETITION_NUMBER > 1, after the first transmission within a bundle, at most REPETITION_NUMBER – 1 HARQ retransmissions follow within the bundle. For both dynamic grant and configured uplink grant, and uplink grant received in a MAC RAR bundling operation relies on the HARQ entity for invoking the same HARQ process for each transmission that is part of the same bundle. Within a bundle, HARQ retransmissions are triggered without waiting for feedback from previous transmission according to REPETITION_NUMBER for a dynamic grant or configured uplink grant or uplink grant received in a MAC RAR unless they are terminated as specified in clause 6.1 of TS 38.214 [7]. Each transmission within a bundle is a separate uplink grant delivered to the HARQ entity.\nFor each transmission within a bundle of the dynamic grant or uplink grant received in a MAC RAR, the sequence of redundancy versions is determined according to clause 6.1.2.1 of TS 38.214 [7]. For each transmission within a bundle of the configured uplink grant, the sequence of redundancy versions is determined according to clause 6.1.2.3 of TS 38.214 [7].\nFor each uplink grant, the HARQ entity shall:\n1>\tidentify the HARQ process associated with this grant, and for each identified HARQ process:\n2>\tif the received grant was not addressed to a Temporary C-RNTI on PDCCH, and the NDI provided in the associated HARQ information has been toggled compared to the value in the previous transmission of this TB of this HARQ process; or\n2>\tif the uplink grant was received on PDCCH for the C-RNTI and the HARQ buffer of the identified process is empty; or\n2>\tif the uplink grant was received in a Random Access Response (i.e. in a MAC RAR or a fallback RAR); or\n2>\tif the uplink grant was determined as specified in clause 5.1.2a for the transmission of the MSGA payload; or\n2>\tif the uplink grant was received on PDCCH for the C-RNTI in ra-ResponseWindow and this PDCCH successfully completed the Random Access procedure initiated for beam failure recovery; or\n2>\tif the uplink grant is part of a bundle of the configured uplink grant, and may be used for initial transmission according to clause 6.1.2.3 of TS 38.214 [7], and if no MAC PDU has been obtained for this bundle:\n3>\tif there is a MAC PDU in the MSGA buffer and the uplink grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload was selected; or\n3>\tif there is a MAC PDU in the MSGA buffer and the uplink grant was received in a fallbackRAR and this fallbackRAR successfully completed the Random Access procedure:\n4>\tobtain the MAC PDU to transmit from the MSGA buffer.\n3>\telse if there is a MAC PDU in the Msg3 buffer and the uplink grant was received in a fallbackRAR:\n4>\tobtain the MAC PDU to transmit from the Msg3 buffer.\n3>\telse if there is a MAC PDU in the Msg3 buffer and the uplink grant was received in a MAC RAR; or\n3>\tif there is a MAC PDU in the Msg3 buffer and the uplink grant was received on PDCCH for the C-RNTI in ra-ResponseWindow and this PDCCH successfully completed the Random Access procedure initiated for beam failure recovery:\n4>\tobtain the MAC PDU to transmit from the Msg3 buffer.\n4>\tif the uplink grant size does not match with size of the obtained MAC PDU; and\n4>\tif the Random Access procedure was successfully completed upon receiving the uplink grant:\n5>\tindicate to the Multiplexing and assembly entity to include MAC subPDU(s) carrying MAC SDU from the obtained MAC PDU in the subsequent uplink transmission;\n5>\tobtain the MAC PDU to transmit from the Multiplexing and assembly entity.\n3>\telse if this uplink grant is a configured grant configured with autonomousTx; and\n3>\tif the previous configured uplink grant, in the BWP, for this HARQ process was not prioritized; and\n3>\tif a MAC PDU had already been obtained for this HARQ process; and\n3>\tif the uplink grant size matches with size of the obtained MAC PDU; and\n3>\tif none of PUSCH transmission(s) of the obtained MAC PDU has been completely performed:\n4>\tconsider the MAC PDU has been obtained.\n3>\telse if the MAC entity is not configured with lch-basedPrioritization; or\n3>\tif this uplink grant is a prioritized uplink grant:\n4>\tobtain the MAC PDU to transmit from the Multiplexing and assembly entity, if any;\n3>\tif a MAC PDU to transmit has been obtained:\n4>\tif the uplink grant is not a configured grant configured with autonomousTx; or\n4>\tif the uplink grant is a prioritized uplink grant:\n5>\tdeliver the MAC PDU and the uplink grant and the HARQ information of the TB to the identified HARQ process;\n5>\tinstruct the identified HARQ process to trigger a new transmission;\n5>\tif the uplink grant is a configured uplink grant:\n6>\tstart or restart the configuredGrantTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers;\n6>\tstart or restart the cg-RetransmissionTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers.\n6>\tif the configured uplink grant is for the initial transmission for CG-SDT with CCCH message:\n7>\tstart or restart the cg-SDT-RetransmissionTimer, if configured, for the corresponding HARQ process when the transmission is performed.\n6>\tif the configured uplink grant is for the initial transmission at LTM cell switch:\n7>\tstart or restart the cg-LTM-RetransmissionTimer, if configured, for the corresponding HARQ process when the transmission is performed.\n6>\tif the configured uplink grant is for the initial transmission of RACH-less handover:\n7>\tstart or restart the cg-RACH-less-RetransmissionTimer, if configured, for the corresponding HARQ process when the transmission is performed.\n5>\tif the uplink grant is addressed to C-RNTI, and the identified HARQ process is configured for a configured uplink grant:\n6>\tstart or restart the configuredGrantTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers.\n5>\tif cg-RetransmissionTimer is configured for the identified HARQ process; and\n5>\tif the transmission is performed and LBT failure indication is received from lower layers:\n6>\tconsider the identified HARQ process as pending.\n3>\telse:\n4>\tflush the HARQ buffer of the identified HARQ process.\n2>\telse (i.e. retransmission):\n3>\tif the uplink grant received on PDCCH was addressed to CS-RNTI and if the HARQ buffer of the identified process is empty; or\n3>\tif the uplink grant is part of a bundle and if no MAC PDU has been obtained for this bundle; or\n3>\tif the uplink grant is part of a bundle of the configured uplink grant, and the PUSCH duration of the uplink grant overlaps with an uplink grant received in a Random Access Response (i.e. MAC RAR or fallbackRAR) or an uplink grant determined as specified in clause 5.1.2a for MSGA payload for this Serving Cell; or\n3>\tif the MAC entity is not configured with lch-basedPrioritization and this uplink grant is part of a bundle of the configured uplink grant, and the PUSCH duration of the uplink grant overlaps with a PUSCH duration of another uplink grant received on the PDCCH; or\n3>\tif the MAC entity is configured with lch-basedPrioritization and this uplink grant is not a prioritized uplink grant:\n4>\tignore the uplink grant.\n3>\telse:\n4>\tdeliver the uplink grant and the HARQ information (redundancy version) of the TB to the identified HARQ process;\n4>\tinstruct the identified HARQ process to trigger a retransmission;\n4>\tif the uplink grant is addressed to CS-RNTI; or\n4>\tif the uplink grant is addressed to C-RNTI, and the identified HARQ process is configured for a configured uplink grant:\n5>\tstart or restart the configuredGrantTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers.\n4>\tif the uplink grant is a configured uplink grant:\n5>\tif the identified HARQ process is pending:\n6>\tstart or restart the configuredGrantTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers;\n5>\tstart or restart the cg-RetransmissionTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers.\n5>\tif the configured uplink grant is for the retransmission of the initial transmission of the CG-SDT with CCCH message:\n6>\tstart or restart the cg-SDT-RetransmissionTimer for the corresponding HARQ process when transmission is performed.\n5>\tif the configured uplink grant is for the retransmission of the initial transmission at LTM cell switch:\n6>\tstart or restart the cg-LTM-RetransmissionTimer for the corresponding HARQ process when transmission is performed.\n5>\tif the configured uplink grant is for the retransmission of the initial transmission of RACH-less handover:\n6>\tstart or restart the cg-RACH-less-RetransmissionTimer for the corresponding HARQ process when transmission is performed.\n4>\tif the identified HARQ process is pending and the transmission is performed and LBT failure indication is not received from lower layers:\n5>\tconsider the identified HARQ process as not pending.\nWhen determining if NDI has been toggled compared to the value in the previous transmission the MAC entity shall ignore NDI received in all uplink grants on PDCCH for its Temporary C-RNTI.\nWhen configuredGrantTimer or cg-RetransmissionTimer or cg-SDT-RetransmissionTimer or cg-LTM-RetransmissionTimer or cg-RACH-less-RetransmissionTimer is started or restarted by a PUSCH transmission, it shall be started at the beginning of the first symbol of the PUSCH transmission.\nEach HARQ process is associated with a HARQ buffer.\nNew transmissions are performed on the resource and with the MCS indicated on PDCCH or indicated in the Random Access Response (i.e. MAC RAR or fallbackRAR), or signalled in RRC or determined as specified in clause 5.1.2a for MSGA payload. Retransmissions are performed on the resource and, if provided, with the MCS indicated on PDCCH, or on the same resource and with the same MCS as was used for last made transmission attempt within a bundle, or on stored configured uplink grant resources and stored MCS when cg-RetransmissionTimer or cg-SDT-RetransmissionTimer or cg-LTM-RetransmissionTimer or cg-RACH-less-RetransmissionTimer is configured. If cg-RetransmissionTimer is configured, retransmissions with the same HARQ process may be performed on any configured grant configuration if the configured grant configurations have the same TBS. If cg-SDT-RetransmissionTimer is configured, retransmission for the initial CG-SDT transmission with the same HARQ process may be performed on any configured grant configuration if the configured grant configurations have the same TBS.\nWhen cg-RetransmissionTimer is configured and the HARQ entity obtains a MAC PDU to transmit and LBT failure indication is received from lower layer, the corresponding HARQ process is considered to be pending. For a configured uplink grant, configured with cg-RetransmissionTimer, each associated HARQ process is considered as not pending when:\n-\ta transmission is performed on that HARQ process and LBT failure indication is not received from lower layers; or\n-\tthe configured uplink grant is initialised and this HARQ process is not associated with another active configured uplink grant; or\n-\tthe HARQ buffer for this HARQ process is flushed.\nIf the HARQ entity requests a new transmission for a TB, the HARQ process shall:\n1>\tstore the MAC PDU in the associated HARQ buffer;\n1>\tstore the uplink grant received from the HARQ entity;\n1>\tgenerate a transmission as described below.\nIf the HARQ entity requests a retransmission for a TB, the HARQ process shall:\n1>\tstore the uplink grant received from the HARQ entity;\n1>\tgenerate a transmission as described below.\nTo generate a transmission for a TB, the HARQ process shall:\n1>\tif the MAC PDU was obtained from the Msg3 buffer; or\n1>\tif the MAC PDU was obtained from the MSGA buffer; or\n1>\tif there is no measurement gap at the time of the transmission and, in case of retransmission, the retransmission does not collide with a transmission for a MAC PDU obtained from the Msg3 buffer or the MSGA buffer:\n2>\tif there are neither NR sidelink transmission nor transmission of V2X sidelink communication at the time of the transmission; or\n2>\tif the transmission of the MAC PDU is prioritized over sidelink transmission or can be simultaneously performed with sidelink transmission:\n3>\tinstruct the physical layer to generate a transmission according to the stored uplink grant.\nIf a HARQ process receives downlink feedback information, the HARQ process shall:\n1>\tstop the cg-RetransmissionTimer, if running;\n1>\tif acknowledgement is indicated:\n2>\tstop the configuredGrantTimer, if running.\nIf the configuredGrantTimer expires for a HARQ process, the HARQ process shall:\n1>\tstop the cg-RetransmissionTimer, if running;\n1>\tstop the cg-SDT-RetransmissionTimer, if running.\n1>\tstop the cg-LTM-RetransmissionTimer, if running;\n1>\tstop the cg-RACH-less-RetransmissionTimer, if running;\n1>\tif a PDCCH addressed to the MAC entity's C-RNTI has not been received after initial transmission for the CG-SDT with CCCH message to which the configuredGrantTimer corresponds:\n2>\tindicate failure to perform SDT procedure to the upper layer.\nThe transmission of the MAC PDU is prioritized over sidelink transmission or can be performed simultaneously with sidelink transmission if one of the following conditions is met:\n-\tif there are both a sidelink grant for NR sidelink transmissionand configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and neither the NR sidelink transmission is prioritized as determined in clause 5.22.1.3.1a nor the transmission(s) of V2X sidelink communication is prioritized as determined in clause 5.14.1.2.2 of TS 36.321 [22]; or\n-\tif there are both a sidelink grant NR sidelink transmission and configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and the MAC entity is able to perform this UL transmission simultaneously with the NR sidelink transmission and/or the transmission(s) of V2X sidelink communication; or\n-\tif there is only configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and either none of the transmission(s) of V2X sidelink communication is prioritized as determined in clause 5.14.1.2.2 of TS 36.321 [22] or the MAC entity is able to perform this UL transmission simultaneously with the transmission(s) of V2X sidelink communication; or\n-\tif there is only a sidelink grant for NR sidelink transmission at the time of the transmission, and if the NR sidelink transmission is not prioritized as determined in clause 5.22.1.3.1a, or there is a sidelink grant for NR sidelink transmission at the time of the transmission and the MAC entity is able to perform this UL transmission simultaneously with the NR sidelink transmission; or\n-\tif there are both a sidelink grant for NR sidelink transmission and configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and either only the of NR sidelink transmission is prioritized as determined in clause 5.22.1.3.1a or only the transmission(s) of V2X sidelink communication is prioritized as determined in clause 5.14.1.2.2 of TS 36.321 [22] and the MAC entity is able to perform this UL transmission simultaneously with the prioritized NR sidelink transmission or the transmission of V2X sidelink communication:\nNOTE 1:\tAmong the UL transmissions where the MAC entity is able to perform the transmission of NR sidelink communication prioritized simultaneously, if there are more than one UL transmission which the MAC entity is not able to perform simultaneously, it is up to UE implementation whether this UL transmission is performed.\nNOTE 2:\tAmong the UL transmissions that the MAC entity is able to perform simultaneously with all transmission(s) of V2X sidelink communication prioritized, if there are more than one UL transmission which the MAC entity is not able to perform simultaneously, it is up to UE implementation whether this UL transmission is performed.\nNOTE 3:\tAmong the UL transmissions where the MAC entity is able to perform the NR sidelink transmission prioritized simultaneously with all transmission(s) of V2X sidelink communication prioritized, if there are more than one UL transmission which the MAC entity is not able to perform simultaneously, it is up to UE implementation whether this UL transmission is performed.\nNOTE 4:\tIf there is configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and the MAC entity is not able to perform this UL transmission simultaneously with the transmission(s) of V2X sidelink communication, and prioritization-related information is not available prior to the time of the transmission due to processing time restriction, it is up to UE implementation whether this UL transmission is performed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.3\tMultiplexing and assembly",
                            "text_content": "The Logical Channel Prioritization (LCP) procedure is applied whenever a new transmission is performed.\nRRC controls the scheduling of uplink data by signalling for each logical channel per MAC entity:\n-\tpriority where an increasing priority value indicates a lower priority level;\n-\tprioritisedBitRate which sets the Prioritized Bit Rate (PBR);\n-\tbucketSizeDuration which sets the Bucket Size Duration (BSD).\nRRC additionally controls the LCP procedure by configuring mapping restrictions for each logical channel:\n-\tallowedSCS-List which sets the allowed Subcarrier Spacing(s) for transmission;\n-\tmaxPUSCH-Duration which sets the maximum PUSCH duration allowed for transmission;\n-\tconfiguredGrantType1Allowed which sets whether a configured grant Type 1 can be used for transmission;\n-\tallowedServingCells which sets the allowed cell(s) for transmission;\n-\tallowedCG-List which sets the allowed configured grant(s) for transmission;\n-\tallowedPHY-PriorityIndex which sets the allowed PHY priority index(es) of a dynamic grant for transmission;\n-\tallowedHARQ-mode which sets the allowed UL HARQ mode for transmission.\nThe following UE variable is used for the Logical channel prioritization procedure:\n-\tBj which is maintained for each logical channel j.\nThe MAC entity shall initialize Bj of the logical channel to zero when the logical channel is established.\nFor each logical channel j, the MAC entity shall:\n1>\tincrement Bj by the product PBR × T before every instance of the LCP procedure, where T is the time elapsed since Bj was last incremented;\n1>\tif the value of Bj is greater than the bucket size (i.e. PBR × BSD):\n2>\tset Bj to the bucket size.\nNOTE:\tThe exact moment(s) when the UE updates Bj between LCP procedures is up to UE implementation, as long as Bj is up to date at the time when a grant is processed by LCP.\nThe MAC entity shall, when a new transmission is performed:\n1>\tselect the logical channels for each UL grant that satisfy all the following conditions:\n2>\tthe set of allowed Subcarrier Spacing index values in allowedSCS-List, if configured, includes the Subcarrier Spacing index associated to the UL grant; and\n2>\tmaxPUSCH-Duration, if configured, is larger than or equal to the PUSCH transmission duration associated to the UL grant; and\n2>\tconfiguredGrantType1Allowed, if configured, is set to true in case the UL grant is a Configured Grant Type 1; and\n2>\tallowedServingCells, if configured, includes the Cell information associated to the UL grant. Does not apply to logical channels associated with a DRB configured with PDCP duplication within the same MAC entity (i.e. CA duplication) when CA duplication is deactivated for this DRB in this MAC entity; and\n2>\tallowedCG-List, if configured, includes the configured grant index associated to the UL grant; and\n2>\tallowedPHY-PriorityIndex, if configured, includes the priority index (as specified in clause 9 of TS 38.213 [6]) associated to the dynamic UL grant; and\n2>\tallowedHARQ-mode, if configured, includes the allowed UL HARQ mode for the HARQ process associated to the UL grant.\nNOTE:\tThe Subcarrier Spacing index, PUSCH transmission duration, Cell information, and priority index are included in Uplink transmission information received from lower layers for the corresponding scheduled uplink transmission.\nBefore the successful completion of the Random Access procedure initiated for DAPS handover, the target MAC entity shall not select the logical channel(s) corresponding to non-DAPS DRB(s) for the uplink grant received in a Random Access Response or the uplink grant for the transmission of the MSGA payload. The source MAC entity shall select only the logical channel(s) corresponding to DAPS DRB(s) during DAPS handover.\nThe MAC entity shall, when a new transmission is performed:\n1>\tallocate resources to the logical channels as follows:\n2>\tlogical channels selected in clause 5.4.3.1.2 for the UL grant with Bj > 0 are allocated resources in a decreasing priority order. If the PBR of a logical channel is set to infinity, the MAC entity shall allocate resources for all the data that is available for transmission on the logical channel before meeting the PBR of the lower priority logical channel(s);\n2>\tdecrement Bj by the total size of MAC SDUs served to logical channel j above;\n2>\tif any resources remain, all the logical channels selected in clause 5.4.3.1.2 are served in a strict decreasing priority order (regardless of the value of Bj) until either the data for that logical channel or the UL grant is exhausted, whichever comes first. Logical channels configured with equal priority should be served equally.\nNOTE 1:\tThe value of Bj can be negative.\nIf the MAC entity is requested to simultaneously transmit multiple MAC PDUs, or if the MAC entity receives the multiple UL grants within one or more coinciding PDCCH occasions (i.e. on different Serving Cells), it is up to UE implementation in which order the grants are processed.\nThe UE shall also follow the rules below during the scheduling procedures above:\n-\tthe UE should not segment an RLC SDU (or partially transmitted SDU or retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or retransmitted RLC PDU) fits into the remaining resources of the associated MAC entity;\n-\tif the UE segments an RLC SDU from the logical channel, it shall maximize the size of the segment to fill the grant of the associated MAC entity as much as possible;\n-\tthe UE should maximise the transmission of data;\n-\tif the MAC entity is given a UL grant size that is equal to or larger than 8 bytes (when eLCID is not used) or 10 bytes (when eLCID is used) while having data available and allowed (according to clause 5.4.3.1) for transmission, the MAC entity shall not transmit only padding BSR and/or padding.\nThe MAC entity shall:\n1>\tif the MAC entity is configured with enhancedSkipUplinkTxDynamic with value true and the grant indicated to the HARQ entity was addressed to a C-RNTI, or if the MAC entity is configured with enhancedSkipUplinkTxConfigured with value true and the grant indicated to the HARQ entity is a configured uplink grant:\n2>\tif there is no UCI to be multiplexed on this PUSCH transmission as specified in TS 38.213 [6]; and\n2>\tif there is no aperiodic CSI requested for this PUSCH transmission as specified in TS 38.212 [9]; and\n2>\tif the MAC PDU includes zero MAC SDUs; and\n2>\tif the MAC PDU includes only the periodic BSR and there is no data available for any LCG, or the MAC PDU includes only the padding BSR:\n3>\tnot generate a MAC PDU for the HARQ entity.\n1>\telse if the MAC entity is configured with skipUplinkTxDynamic with value true and the grant indicated to the HARQ entity was addressed to a C-RNTI, or the grant indicated to the HARQ entity is a configured uplink grant:\n2>\tif there is no aperiodic CSI requested for this PUSCH transmission as specified in TS 38.212 [9]; and\n2>\tif the MAC PDU includes zero MAC SDUs; and\n2>\tif the MAC PDU includes only the periodic BSR and there is no data available for any LCG, or the MAC PDU includes only the padding BSR:\n3>\tnot generate a MAC PDU for the HARQ entity.\nLogical channels shall be prioritised in accordance with the following order (highest priority listed first):\n-\tMAC CE for C-RNTI, or data from UL-CCCH;\n-\tMAC CE for (Enhanced) BFR, or MAC CE for Configured Grant Confirmation, or MAC CE for Multiple Entry Configured Grant Confirmation;\n-\tMAC CE for Sidelink Configured Grant Confirmation;\n-\tMAC CE for LBT failure;\n-\tMAC CE for SL LBT failure according to clause 5.31.2;\n-\tMAC CE for Timing Advance Report;\n-\tMAC CE for Delay Status Report;\n-\tMAC CE for SL-BSR prioritized according to clause 5.22.1.6;\n-\tMAC CE for (Extended) BSR, with exception of BSR included for padding;\n-\tMAC CE for (Enhanced) Single Entry PHR, or MAC CE for (Enhanced) Multiple Entry PHR or MAC CE for Single Entry PHR with assumed PUSCH, or MAC CE for Multiple Entry PHR with assumed PUSCH;\n-\tMAC CE for Positioning Measurement Gap Activation/Deactivation Request;\n-\tMAC CE for the number of Desired Guard Symbols;\n-\tMAC CE for Case-6 Timing Request;\n-\tMAC CE for (Extended) Pre-emptive BSR;\n-\tMAC CE for SL-BSR, with exception of SL-BSR prioritized according to clause 5.22.1.6 and SL-BSR included for padding;\n-\tMAC CE for IAB-MT Recommended Beam Indication, or MAC CE for Desired IAB-MT PSD range, or MAC CE for Desired DL Tx Power Adjustment;\n-\tdata from any Logical Channel, except data from UL-CCCH;\n-\tMAC CE for Recommended bit rate query;\n-\tMAC CE for BSR included for padding;\n-\tMAC CE for SL-BSR included for padding.\nNOTE 2:\tPrioritization among MAC CEs of same priority is up to UE implementation.\nThe MAC entity shall prioritize any MAC CE listed in a higher order than 'data from any Logical Channel, except data from UL-CCCH' over NR sidelink transmission.\nThe MAC entity shall multiplex MAC CEs and MAC SDUs in a MAC PDU according to clauses 5.4.3.1 and 6.1.2.\nNOTE:\tContent of a MAC PDU does not change after being built for transmission on a dynamic uplink grant, regardless of LBT outcome.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.4\tScheduling Request",
                            "text_content": "The Scheduling Request (SR) is used for requesting UL-SCH resources for new transmission.\nThe MAC entity may be configured with zero, one, or more SR configurations. An SR configuration consists of a set of PUCCH resources for SR across different BWPs and cells. For a logical channel or for SCell beam failure recovery (see clause 5.17) and for consistent LBT failure recovery (see clause 5.21), at most one PUCCH resource for SR is configured per BWP. For a logical channel serving a radio bearer configured with SDT, PUCCH resource for SR is not configured for SDT. For beam failure recovery of BFD-RS set(s) of Serving Cell, up to two PUCCH resources for SR is configured per BWP. For positioning measurement gap activation/deactivation request, a dedicated SR configuration is configured.\nEach SR configuration corresponds to one or more logical channels and/or to SCell beam failure recovery and/or to consistent LBT failure recovery and/or to beam failure recovery of a BFD-RS set and/or to positioning measurement gap activation/deactivation request. Each logical channel, SCell beam failure recovery, beam failure recovery of a BFD-RS set and consistent LBT failure recovery, may be mapped to zero or one SR configuration, which is configured by RRC. The SR configuration of the logical channel that triggered a BSR (clause 5.4.5) or a DSR (clause 5.4.9) or the SCell beam failure recovery or the beam failure recovery of a BFD-RS set or the consistent LBT failure recovery (clause 5.21) (if such a configuration exists) or positioning measurement gap activation/deactivation request (clause 5.25) is considered as corresponding SR configuration for the triggered SR. Any SR configuration may be used for an SR triggered by Pre-emptive BSR (clause 5.4.7) or Timing Advance reporting (clause 5.4.8).\nRRC configures the following parameters for the scheduling request procedure:\n-\tsr-ProhibitTimer (per SR configuration);\n-\tsr-TransMax (per SR configuration).\nThe following UE variables are used for the scheduling request procedure:\n-\tSR_COUNTER (per SR configuration).\nIf an SR is triggered and there are no other SRs pending corresponding to the same SR configuration, the MAC entity shall set the SR_COUNTER of the corresponding SR configuration to 0.\nWhen an SR is triggered, it shall be considered as pending until it is cancelled.\nAll pending SR(s) for BSR triggered according to the BSR procedure (clause 5.4.5) prior to the MAC PDU assembly shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the MAC PDU is transmitted and this PDU includes a Long, Refined Long or Short BSR MAC CE which contains buffer status up to (and including) the last event that triggered a BSR (see clause 5.4.5) prior to the MAC PDU assembly. All pending SR(s) for BSR triggered according to the BSR procedure (clause 5.4.5) shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the UL grant(s) can accommodate all pending data available for transmission.\nThe MAC entity shall for each pending SR not triggered according to the BSR procedure (clause 5.4.5) for a Serving Cell:\n1>\tif this SR was triggered by Pre-emptive BSR procedure (see clause 5.4.7) prior to the MAC PDU assembly and a MAC PDU containing the relevant Pre-emptive BSR MAC CE is transmitted; or\n1>\tif this SR was triggered by beam failure recovery (see clause 5.17) of an SCell and a MAC PDU is transmitted and this PDU includes a MAC CE for BFR which contains beam failure recovery information for this SCell; or\n1>\tif this SR was triggered by beam failure recovery (see clause 5.17) for a BFD-RS set of a Serving Cell and a MAC PDU is transmitted and this PDU includes an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE which contains beam failure recovery information for this BFD-RS set of the Serving Cell; or\n1>\tif this SR was triggered by beam failure recovery (see clause 5.17) of an SCell and this SCell is deactivated (see clause 5.9); or\n1>\tif this SR was triggered by beam failure recovery (see clause 5.17) for a BFD-RS set of an SCell and this SCell is deactivated (see clause 5.9); or\n1>\tif the SR is triggered by positioning measurement gap activation/deactivation request (see clause 5.25) and the Positioning Measurement Gap Activation/Deactivation Request MAC CE that triggers the SR has already been cancelled; or\n1>\tif this SR was triggered by consistent LBT failure recovery (see clause 5.21) of an SCell and a MAC PDU is transmitted and the MAC PDU includes an LBT failure MAC CE that indicates consistent LBT failure for this SCell; or\n1>\tif this SR was triggered by consistent LBT failure recovery (see clause 5.21) of an SCell and all the triggered consistent LBT failure(s) for this SCell are cancelled; or\n1>\tif this SR was triggered by Timing Advance reporting (see clause 5.4.8) and all the triggered Timing Advance reports are cancelled; or\n1>\tif this SR was triggered by DSR procedure (see clause 5.4.9) and the DSR that triggered the SR has been cancelled:\n2>\tcancel the pending SR and stop the corresponding sr-ProhibitTimer, if running.\nOnly PUCCH resources on a BWP which is active at the time of SR transmission occasion are considered valid.\nAs long as at least one SR is pending, the MAC entity shall for each pending SR:\n1>\tif the MAC entity has no valid PUCCH resource configured for the pending SR; and\n1>\tif there is no ongoing LTM cell switch; and\n1>\tif rach-lessHO is not configured:\n2>\tinitiate a Random Access procedure (see clause 5.1) on the SpCell and cancel the pending SR.\n1>\telse, for the SR configuration corresponding to the pending SR:\n2>\twhen the MAC entity has an SR transmission occasion on the valid PUCCH resource for SR configured; and\n2>\tif sr-ProhibitTimer is not running at the time of the SR transmission occasion; and\n2>\tif the PUCCH resource for the SR transmission occasion does not overlap with a measurement gap:\n3>\tif the PUCCH resource for the SR transmission occasion overlaps with neither a UL-SCH resource whose simultaneous transmission with the SR is not allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups nor an SL-SCH resource; or\n3>\tif the MAC entity is able to perform this SR transmission simultaneously with the transmission of the SL-SCH resource; or\n3>\tif the MAC entity is configured with lch-basedPrioritization, and the PUCCH resource for the SR transmission occasion does not overlap with the PUSCH duration of an uplink grant received in a Random Access Response or with the PUSCH duration of an uplink grant addressed to Temporary C-RNTI or with the PUSCH duration of a MSGA payload, and the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.4.5 overlaps with any other UL-SCH resource(s), and the physical layer can signal the SR on one valid PUCCH resource for SR, and the priority of the logical channel that triggered SR is higher than the priority of the uplink grant(s) for any UL-SCH resource(s) where the uplink grant was not already de-prioritized and its simultaneous transmission with the SR is not allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCHgroups, and the priority of the uplink grant is determined as specified in clause 5.4.1; or\n3>\tif both sl-PrioritizationThres and ul-PrioritizationThres are configured and the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.22.1.5 overlaps with any UL-SCH resource(s) carrying a MAC PDU, and the value of the priority of the triggered SR determined as specified in clause 5.22.1.5 is lower than sl-PrioritizationThres and the value of the highest priority of the logical channel(s) in the MAC PDU is higher than or equal to ul-PrioritizationThres and any MAC CE prioritized as described in clause 5.4.3.1.3 is not included in the MAC PDU and the MAC PDU is not prioritized by upper layer according to TS 23.287 [19]; or\n3>\tif an SL-SCH resource overlaps with the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.4.5, and the MAC entity is not able to perform this SR transmission simultaneously with the transmission of the SL-SCH resource, and either transmission on the SL-SCH resource is not prioritized as described in clause 5.22.1.3.1a or the priority value of the logical channel that triggered SR is lower than ul-PrioritizationThres, if configured; or\n3>\tif an SL-SCH resource overlaps with the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.22.1.5, and the MAC entity is not able to perform this SR transmission simultaneously with the transmission of the SL-SCH resource, and the priority of the triggered SR determined as specified in clause 5.22.1.5 is higher than the priority of the MAC PDU determined as specified in clause 5.22.1.3.1a for the SL-SCH resource; or\n3>\tif an SL-PRS resource overlaps with the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.4.5, and the MAC entity is not able to perform this SR transmission simultaneously with the transmission of the SL-PRS resource, and either transmission on the SL-PRS resource is not prioritized as described in clause 5.22.1.3.1a or 5.22.1.3.1b or the priority value of the logical channel that triggered SR is lower than ul-PrioritizationThres, if configured; or\n3>\tif an SL-PRS resource overlaps with the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.22.1.5, and the MAC entity is not able to perform this SR transmission simultaneously with the transmission of the SL-PRS resource, and the priority of the triggered SR determined as specified in clause 5.22.1.5 is higher than the priority of the MAC PDU and SL-PRS, if available, determined as specified in clause 5.22.1.3.1a for the SL-PRS resource:\n4>\tconsider the SR transmission as a prioritized SR transmission.\n4>\tconsider the other overlapping uplink grant(s), if any, as a de-prioritized uplink grant(s), except for the overlapping uplink grant(s) whose simultaneous transmission is allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups;\n4>\tif the de-prioritized uplink grant(s) is a configured uplink grant configured with autonomousTx whose PUSCH has already started:\n5>\tstop the configuredGrantTimer for the corresponding HARQ process of the de-prioritized uplink grant(s);\n5>\tstop the cg-RetransmissionTimer for the corresponding HARQ process of the de-prioritized uplink grant(s).\n4>\tif SR_COUNTER < sr-TransMax:\n5>\tinstruct the physical layer to signal the SR on one valid PUCCH resource for SR;\n5>\tif LBT failure indication is not received from lower layers:\n6>\tincrement SR_COUNTER by 1;\n6>\tstart the sr-ProhibitTimer.\n5>\telse if lbt-FailureRecoveryConfig is not configured:\n6>\tincrement SR_COUNTER by 1.\n4>\telse:\n5>\tnotify RRC to release PUCCH for all Serving Cells;\n5>\tnotify RRC to release SRS for all Serving Cells;\n5>\tclear any configured downlink assignments and uplink grants;\n5>\tclear any PUSCH resources for semi-persistent CSI reporting;\n5>\tif rach-lessHO is not configured:\n6>\tinitiate a Random Access procedure (see clause 5.1) on the SpCell and cancel all pending SRs.\n3>\telse:\n4>\tconsider the SR transmission as a de-prioritized SR transmission.\nNOTE 1:\tExcept for SR for SCell beam failure recovery, the selection of which valid PUCCH resource for SR to signal SR on when the MAC entity has more than one overlapping valid PUCCH resource for the SR transmission occasion is left to UE implementation.\nNOTE 2:\tIf more than one individual SR triggers an instruction from the MAC entity to the PHY layer to signal the SR on the same valid PUCCH resource, the SR_COUNTER for the relevant SR configuration is incremented only once.\nNOTE 3:\tWhen the MAC entity has pending SR for SCell beam failure recovery and the MAC entity has one or more PUCCH resources (other than PUCCH resources of pending SR for beam failure recovery of a BFD-RS set) overlapping with PUCCH resource for SCell beam failure recovery for the SR transmission occasion, the MAC entity considers only the PUCCH resource for SCell beam failure recovery as valid. When the MAC entity has pending SR for beam failure recovery of a BFD-RS set of Serving Cell and the MAC entity has one or more PUCCH resources (other than PUCCH resources of pending SR for beam failure recovery) overlapping with PUCCH resource for beam failure recovery of that BFD-RS set for the SR transmission occasion, the MAC entity considers only the PUCCH resource for beam failure recovery of that BFD-RS set as valid.\nNOTE 4:\tFor a UE operating in a semi-static channel access mode as described in TS 37.213 [18], PUCCH resources overlapping with the set of consecutive symbols where the UE does not transmit before the start of a next channel occupancy time are not considered valid.\nNOTE 5:\tIf the MAC entity is configured with lch-basedPrioritization, the MAC entity does not take UCI multiplexing according to the procedure specified in TS 38.213 [6] into account when determining whether the valid PUCCH resource for the SR transmission can be signalled by the physical layer and the SR transmission occasion overlaps with the PUSCH duration of an uplink grant of a MSGA payload.\nNOTE 6:\tWhen the MAC entity has PUCCH resource for pending SR for SCell beam failure recovery overlapping with PUCCH resource for pending SR for beam failure recovery of a BFD-RS set for the SR transmission occasion, it's up to UE implementation to select PUCCH resource for SCell beam failure recovery or PUCCH resource for beam failure recovery of a BFD-RS set.\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for BSR, which was initiated by the MAC entity prior to the MAC PDU assembly and which has no valid PUCCH resources configured, if:\n-\ta MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes a BSR MAC CE which contains buffer status up to (and including) the last event that triggered a BSR (see clause 5.4.5) prior to the MAC PDU assembly; or\n-\tthe UL grant(s) can accommodate all pending data available for transmission.\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for SL-BSR, which was initiated by the MAC entity prior to the sidelink MAC PDU assembly and which has no valid PUCCH resources configured, if:\n-\ta MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes an SL-BSR MAC CE which contains buffer status up to (and including) the last event that triggered an SL-BSR (see clause 5.22.1.6) prior to the MAC PDU assembly; or\n-\tthe SL grant(s) can accommodate all pending data available for transmission.\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for SL-CSI reporting, which has no valid PUCCH resources configured, if:\n-\tthe SL grant can accommodate SL-CSI reporting MAC CE for transmission.\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for SL-DRX command indication, which has no valid PUCCH resources configured, if:\n-\tthe SL grant can accommodate SL-DRX command indication for transmission.\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for BFR of an SCell, which has no valid PUCCH resources configured, if:\n-\ta MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU contains a MAC CE for BFR which includes beam failure recovery information of that SCell; or\n-\tthe SCell is deactivated (as specified in clause 5.9) and all triggered BFRs for SCells are cancelled.\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for BFR of a BFD-RS set of a Serving Cell, which has no valid PUCCH resources configured, if:\n-\ta MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU contains an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE which includes beam failure recovery information of that BFD-RS set of the Serving Cell.\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for consistent LBT failure recovery, which has no valid PUCCH resources configured, if:\n-\ta MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes an LBT failure MAC CE that indicates consistent LBT failure for all the SCells that triggered consistent LBT failure; or\n-\tall the SCells that triggered consistent LBT failure recovery are deactivated (see clause 5.9).\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for SL consistent LBT failure recovery, which has no valid PUCCH resources configured, if one of the following conditions is met:\n-\ta MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes an SL LBT failure MAC CE that indicates SL consistent LBT failure; or\n-\tall the triggered SL consistent LBT failure recovery are cancelled (see clause 5.31.2).\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for positioning measurement gap activation/deactivation request, which has no valid PUCCH resources configured, if:\n-\tthe Positioning Measurement Gap Activation/Deactivation Request MAC CE that triggers the SR corresponding to the Random Access procedure has already been cancelled.\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for Timing Advance report, which has no valid PUCCH resources configured, if:\n-\ta MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes a Timing Advance Report MAC CE (see clause 5.4.8).\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for DSR, which has no valid PUCCH resources configured, if:\n-\tthe DSR that triggered the SR has been cancelled (see clause 5.4.9).\nThe MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for SL-PRS Resource Request, which has no valid PUCCH resources configured, if:\n-\ta MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes a SL-PRS Resource Request MAC CE (see clause 5.22.1.12).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.5\tBuffer Status Reporting",
                            "text_content": "The Buffer Status reporting (BSR) procedure is used to provide the serving gNB with information about UL data volume in the MAC entity.\nRRC configures the following parameters to control the BSR:\n-\tperiodicBSR-Timer;\n-\tretxBSR-Timer;\n-\tlogicalChannelSR-DelayTimerApplied;\n-\tlogicalChannelSR-DelayTimer;\n-\tlogicalChannelSR-Mask;\n-\tlogicalChannelGroup, logicalChannelGroupIAB-Ext;\n-\tsdt-LogicalChannelSR-DelayTimer;\n-\tadditionalBSR-TableAllowed.\nEach logical channel may be allocated to an LCG using the logicalChannelGroup. The maximum number of LCGs is eight except for IAB-MTs configured with logicalChannelGroupIAB-Ext, for which the maximum number of LCGs is 256.\nThe MAC entity determines the amount of UL data available for a logical channel according to the data volume calculation procedure in TSs 38.322 [3] and 38.323 [4].\nA BSR shall be triggered if any of the following events occur for activated cell group:\n-\tUL data, for a logical channel which belongs to an LCG, becomes available to the MAC entity; and either\n-\tthis UL data belongs to a logical channel with higher priority than the priority of any logical channel containing available UL data which belong to any LCG; or\n-\tnone of the logical channels which belong to an LCG contains any available UL data.\nin which case the BSR is referred below to as 'Regular BSR';\n-\tUL resources are allocated and number of padding bits is equal to or larger than the size of the Buffer Status Report MAC CE plus its subheader, in which case the BSR is referred below to as 'Padding BSR';\n-\tretxBSR-Timer expires, and at least one of the logical channels which belong to an LCG contains UL data, in which case the BSR is referred below to as 'Regular BSR';\n-\tperiodicBSR-Timer expires, in which case the BSR is referred below to as 'Periodic BSR'.\nNOTE 1:\tWhen Regular BSR triggering events occur for multiple logical channels simultaneously, each logical channel triggers one separate Regular BSR.\nFor Regular BSR, the MAC entity shall:\n1>\tif the BSR is triggered for a logical channel for which logicalChannelSR-DelayTimerApplied with value true is configured by upper layers and SDT procedure is not on-going according to clause 5.27:\n2>\tstart or restart the logicalChannelSR-DelayTimer.\n1>\telse if BSR is triggered for a logical channel for which logicalChannelSR-DelayTimerApplied with value true is configured by upper layers and SDT procedure is on-going according to clause 5.27:\n2>\tstart or restart logicalChannelSR-DelayTimer with the value as configured by the sdt-LogicalChannelSR-DelayTimer.\n1>\telse:\n2>\tif running, stop the logicalChannelSR-DelayTimer.\nFor Regular and Periodic BSR, the MAC entity for which logicalChannelGroupIAB-Ext is not configured by upper layers shall:\n1>\tif for at least one LCG configured with additionalBSR-TableAllowed, the amount of UL data available for transmission is within the buffer sizes specified in Table 6.1.3.1-3:\n2>\treport Refined Long BSR for all LCGs which have data available for transmission;\n1>\telse:\n2>\tif more than one LCG has data available for transmission when the MAC PDU containing the BSR is to be built:\n3>\treport Long BSR for all LCGs which have data available for transmission.\n2>\telse:\n3>\treport Short BSR.\nFor Regular and Periodic BSR, the MAC entity for which logicalChannelGroupIAB-Ext is configured by upper layers shall:\n1>\tif more than one LCG has data available for transmission when the MAC PDU containing the BSR is to be built:\n2>\tif the maximum LCG ID among the configured LCGs is 7 or lower:\n3>\treport Long BSR for all LCGs which have data available for transmission.\n2>\telse:\n3>\treport Extended Long BSR for all LCGs which have data available for transmission.\n1>\telse:\n2>\treport Extended Short BSR.\nFor Padding BSR, the MAC entity for which logicalChannelGroupIAB-Ext is not configured by upper layers shall:\n1>\tif the number of padding bits is equal to or larger than the size of the Short BSR plus its subheader but smaller than the size of the Long BSR plus its subheader:\n2>\tif more than one LCG has data available for transmission when the BSR is to be built:\n3>\tif the number of padding bits is equal to the size of the Short BSR plus its subheader:\n4>\treport Short Truncated BSR of the LCG with the highest priority logical channel with data available for transmission.\n3>\telse:\n4>\treport Long Truncated BSR of the LCG(s) with the logical channels having data available for transmission following a decreasing order of the highest priority logical channel (with or without data available for transmission) in each of these LCG(s), and in case of equal priority, in increasing order of LCGID.\n2>\telse:\n3>\treport Short BSR.\n1>\telse if the number of padding bits is equal to or larger than the size of the Long BSR plus its subheader:\n2>\treport Long BSR for all LCGs which have data available for transmission.\nFor Padding BSR, the MAC entity for which logicalChannelGroupIAB-Ext is configured by upper layers shall:\n1>\tif the number of padding bits is equal to or larger than the size of the Extended Short BSR plus its subheader but smaller than the size of the Extended Long BSR plus its subheader:\n2>\tif more than one LCG has data available for transmission when the BSR is to be built:\n3>\tif the number of padding bits is smaller than the size of the Extended Long Truncated BSR with zero Buffer Size field plus its subheader:\n4>\treport Extended Short Truncated BSR of the LCG with the highest priority logical channel with data available for transmission.\n3>\telse:\n4>\treport Extended Long Truncated BSR of the LCG(s) with the logical channels having data available for transmission following a decreasing order of the highest priority logical channel (with or without data available for transmission) in each of these LCG(s), and in case of equal priority, in increasing order of LCGID.\n2>\telse:\n3>\treport Extended Short BSR.\n1>\telse if the number of padding bits is equal to or larger than the size of the Extended Long BSR plus its subheader:\n2>\treport Extended Long BSR for all LCGs which have data available for transmission.\nFor BSR triggered by retxBSR-Timer expiry, the MAC entity considers that the logical channel that triggered the BSR is the highest priority logical channel that has data available for transmission at the time the BSR is triggered.\nThe MAC entity shall:\n1>\tif the Buffer Status reporting procedure determines that at least one BSR has been triggered and not cancelled:\n2>\tif UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the BSR MAC CE plus its subheader as a result of logical channel prioritization:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the BSR MAC CE(s) as defined in clause 6.1.3.1;\n3>\tstart or restart periodicBSR-Timer except when all the generated BSRs are long or short Truncated or Extended long or short Truncated BSRs;\n3>\tstart or restart retxBSR-Timer.\n2>\tif a Regular BSR has been triggered and logicalChannelSR-DelayTimer is not running:\n3>\tif there is no UL-SCH resource available for a new transmission; or\n3>\tif the MAC entity is configured with configured uplink grant(s) and the Regular BSR was triggered for a logical channel for which logicalChannelSR-Mask is set to false; or\n3>\tif the UL-SCH resources available for a new transmission do not meet the LCP mapping restrictions (see clause 5.4.3.1) configured for the logical channel that triggered the BSR:\n4>\ttrigger a Scheduling Request.\nNOTE 2:\tUL-SCH resources are considered available if the MAC entity has been configured with, receives, or determines an uplink grant. If the MAC entity has determined at a given point in time that UL-SCH resources are available, this need not imply that UL-SCH resources are available for use at that point in time.\nA MAC PDU shall contain at most one BSR MAC CE, even when multiple events have triggered a BSR. The Regular BSR and the Periodic BSR shall have precedence over the padding BSR.\nThe MAC entity shall restart retxBSR-Timer upon reception of a grant for transmission of new data on any UL-SCH.\nAll triggered BSRs may be cancelled when the UL grant(s) can accommodate all pending data available for transmission but is not sufficient to additionally accommodate the BSR MAC CE plus its subheader. All BSRs triggered prior to MAC PDU assembly shall be cancelled when a MAC PDU is transmitted and this PDU includes a Long, Refined Long, Extended Long, Short, or Extended Short BSR MAC CE which contains buffer status up to (and including) the last event that triggered a BSR prior to the MAC PDU assembly.\nNOTE 3:\tMAC PDU assembly can happen at any point in time between uplink grant reception and actual transmission of the corresponding MAC PDU. BSR and SR can be triggered after the assembly of a MAC PDU which contains a BSR MAC CE, but before the transmission of this MAC PDU. In addition, BSR and SR can be triggered during MAC PDU assembly.\nNOTE 4:\tVoid\nNOTE 5:\tIf a HARQ process is configured with cg-RetransmissionTimer and if the BSR is already included in a MAC PDU for transmission on configured grant by this HARQ process, but not yet transmitted by lower layers, it is up to UE implementation how to handle the BSR content.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.6\tPower Headroom Reporting",
                            "text_content": "The Power Headroom reporting procedure is used to provide the serving gNB with the following information:\n-\tType 1 power headroom: the difference between the nominal UE maximum transmit power and the estimated power for UL-SCH transmission per activated Serving Cell;\n-\tType 2 power headroom: the difference between the nominal UE maximum transmit power and the estimated power for UL-SCH and PUCCH transmission on SpCell of the other MAC entity (i.e. E-UTRA MAC entity in EN-DC, NE-DC, and NGEN-DC cases);\n-\tType 3 power headroom: the difference between the nominal UE maximum transmit power and the estimated power for SRS transmission per activated Serving Cell;\n-\tMPE P-MPR: the power backoff to meet the MPE FR2 requirements for a Serving Cell operating on FR2;\n-\tDPC: the adjustment to maximum output power for a given power class for a Serving Cell operating on FR1;\n-\tDPCBC: the adjustment to maximum output power for a given power class for a Band Combination operating on FR1.\nRRC controls Power Headroom reporting by configuring the following parameters:\n-\tdpc-Reporting-FR1;\n-\tphr-AssumedPUSCH-Reporting;\n-\tphr-PeriodicTimer;\n-\tphr-ProhibitTimer;\n-\tphr-Tx-PowerFactorChange;\n-\tphr-Type2OtherCell;\n-\tphr-ModeOtherCG;\n-\tmultiplePHR;\n-\tmpe-Reporting-FR2;\n-\tmpe-ProhibitTimer;\n-\tmpe-Threshold;\n-\tnumberOfN;\n-\tmpe-ResourcePoolToAddModList;\n-\ttwoPHRMode.\nA Power Headroom Report (PHR) shall be triggered if any of the following events occur:\n-\tphr-ProhibitTimer expires or has expired and the path loss has changed more than phr-Tx-PowerFactorChange dB for at least one RS used as pathloss reference for one activated Serving Cell of any MAC entity of which the active DL BWP is not dormant BWP since the last transmission of a PHR in this MAC entity when the MAC entity has UL resources for new transmission;\nNOTE 1:\tThe path loss variation for one cell assessed above is between the pathloss measured at present time on the current pathloss reference and the pathloss measured at the transmission time of the last transmission of PHR on the pathloss reference in use at that time, irrespective of whether the pathloss reference has changed in between. The current pathloss reference for this purpose does not include any pathloss reference configured using pathlossReferenceRS-Pos in TS 38.331 [5].\n-\tphr-PeriodicTimer expires;\n-\tupon configuration or reconfiguration of the power headroom reporting functionality by upper layers, which is not used to disable the function;\n-\tactivation of an SCell of any MAC entity with configured uplink of which firstActiveDownlinkBWP-Id is not set to dormant BWP;\n-\tactivation of an SCG;\n-\taddition of the PSCell except if the SCG is deactivated (i.e. PSCell is newly added or changed);\n-\tphr-ProhibitTimer expires or has expired, when the MAC entity has UL resources for new transmission, and the following is true for any of the activated Serving Cells of any MAC entity with configured uplink:\n-\tthere are UL resources allocated for transmission or there is a PUCCH transmission on this cell, and the required power backoff due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]) for this cell has changed more than phr-Tx-PowerFactorChange dB since the last transmission of a PHR when the MAC entity had UL resources allocated for transmission or PUCCH transmission on this cell.\n-\tUpon switching of activated BWP from dormant BWP to non-dormant DL BWP of an SCell of any MAC entity with configured uplink;\n-\tif dpc-Reporting-FR1 is configured, ΔPPowerClass /ΔPPowerClass, CA/ΔPPowerClass, EN-DC/ΔPPowerClass, NR-DC reporting is triggered upon uplink duty cycle exceedance or upon return to the power class after the duty cycle exceedance, as specified in TS 38.101-1 [14] and TS 38.101-3 [16]).\n-\tif mpe-Reporting-FR2 is configured, and mpe-ProhibitTimer is not running:\n-\tthe measured P-MPR applied to meet FR2 MPE requirements as specified in TS 38.101-2 [15] is equal to or larger than mpe-Threshold for at least one activated FR2 Serving Cell since the last transmission of a PHR in this MAC entity; or\n-\tthe measured P-MPR applied to meet FR2 MPE requirements as specified in TS 38.101-2 [15] has changed more than phr-Tx-PowerFactorChange dB for at least one activated FR2 Serving Cell since the last transmission of a PHR due to the measured P-MPR applied to meet MPE requirements being equal to or larger than mpe-Threshold in this MAC entity.\nin which case the PHR is referred below to as 'MPE P-MPR report'.\nNOTE 2:\tThe MAC entity should avoid triggering a PHR when the required power backoff due to power management decreases only temporarily (e.g. for up to a few tens of milliseconds) and it should avoid reflecting such temporary decrease in the values of PCMAX,f,c/PH when a PHR is triggered by other triggering conditions.\nNOTE 3:\tIf a HARQ process is configured with cg-RetransmissionTimer and if the PHR is already included in a MAC PDU for transmission on configured grant by this HARQ process, but not yet transmitted by lower layers, it is up to UE implementation how to handle the PHR content.\nIf the MAC entity has UL resources allocated for a new transmission the MAC entity shall:\n1>\tif it is the first UL resource allocated for a new transmission since the last MAC reset:\n2>\tstart phr-PeriodicTimer.\n1>\tif the Power Headroom reporting procedure determines that at least one PHR has been triggered and not cancelled; and\n1>\tif the allocated UL resources can accommodate the MAC CE for PHR which the MAC entity is configured to transmit, plus its subheader, as a result of LCP as defined in clause 5.4.3.1:\n2>\tif multiplePHR with value true is configured:\n3>\tfor each activated Serving Cell with configured uplink associated with any MAC entity of which the active DL BWP is not dormant BWP; and\n3>\tfor each activated Serving Cell with configured uplink associated with E-UTRA MAC entity:\n4>\tif this MAC entity is configured with twoPHRMode:\n5>\tif this Serving Cell is configured with multiple TRP PUSCH repetition and the MAC entity this Serving Cell belongs to is configured with twoPHRMode:\n6>\tobtain two values of the Type 1 or the value of Type 3 power headroom for the corresponding uplink carrier as specified in clause 7.7 of TS 38.213 [6] for NR Serving Cell.\n5>\telse:\n6>\tobtain the value of the Type 1 or Type 3 power headroom for the corresponding uplink carrier as specified in clause 7.7 of TS 38.213 [6] for NR Serving Cell and clause 5.1.1.2 of TS 36.213 [17] for E-UTRA Serving Cell.\n4>\telse (i.e. this MAC entity is not configured with twoPHRMode):\n5>\tif this Serving Cell is configured with multiple TRP PUSCH repetition and the MAC entity this Serving Cell belongs to is configured with twoPHRMode:\n6>\tif there is at least one real PUSCH transmission at the slot where the PHR MAC CE is transmitted:\n7>\tobtain the value of the Type 1 power headroom of the first real transmission of the corresponding uplink carrier as specified in clause 7.7 of TS 38.213[6] for NR Serving Cell.\n6>\telse if there is no real PUSCH transmission at the slot where the PHR MAC CE is transmitted:\n7>\tobtain the value of the type 1 power headroom of the reference PUSCH transmission associated with the SRS-ResourceSet with a lower SRS-resourceSetID or the value of the type 3 power headroom for the corresponding uplink carrier as specified in clause 7.7 of TS 38.213[6] for NR Serving Cell.\n5>\telse:\n6>\tobtain the value of the Type 1 or Type 3 power headroom for the corresponding uplink carrier as specified in clause 7.7 of TS 38.213 [6] for NR Serving Cell and clause 5.1.1.2 of TS 36.213 [17] for E-UTRA Serving Cell.\n4>\tif this MAC entity is configured with phr-AssumedPUSCH-Reporting:\n5>\tif this MAC entity has UL resources allocated for transmission on this Serving Cell; or\n5>\tif the other MAC entity, if configured, has UL resources allocated for transmission on this Serving Cell and phr-ModeOtherCG is set to real by upper layers:\n6>\tif dynamicTransformPrecoderFieldPresenceDCI-0-1-r18 or dynamicTransformPrecoderFieldPresenceDCI-0-2-r18 is set to enabled in the active BWP of this Serving Cell:\n7>\tobtain the value for the corresponding PCMAX,f,c field for assumed PUSCH from the physical layer if available, as specified in clause 7.7 of TS 38.213 [6].\n6>\tobtain the value for the corresponding PCMAX,f,c field from the physical layer.\n4>\telse (i.e. if this MAC entity is not configured with phr-AssumedPUSCH-Reporting):\n5>\tif this MAC entity has UL resources allocated for transmission on this Serving Cell; or\n5>\tif the other MAC entity, if configured, has UL resources allocated for transmission on this Serving Cell and phr-ModeOtherCG is set to real by upper layers:\n6>\tobtain the value for the corresponding PCMAX,f,c field from the physical layer.\n6>\tif mpe-Reporting-FR2 is configured and this Serving Cell operates on FR2 and this Serving Cell is associated to this MAC entity:\n7>\tobtain the value for the corresponding MPE field from the physical layer.\n6>\tif mpe-Reporting-FR2-r17 is configured and this Serving Cell operates on FR2 and this Serving Cell is associated to this MAC entity:\n7>\tobtain the value for the corresponding MPEi field from the physical layer;\n7>\tobtain the value for the corresponding Resourcei field from the physical layer.\n6>\tif dpc-Reporting-FR1 is configured and ΔPPowerClass /ΔPPowerClass, CA/ΔPPowerClass, EN-DC/ΔPPowerClass, NR-DC reporting is triggered and this Serving Cell operates on FR1 and this Serving Cell is associated to this MAC entity:\n7>\tobtain the value for the corresponding DPC field(s) from the physical layer.\n3>\tif phr-Type2OtherCell with value true is configured:\n4>\tif the other MAC entity is E-UTRA MAC entity:\n5>\tobtain the value of the Type 2 power headroom for the SpCell of the other MAC entity (i.e. E-UTRA MAC entity);\n5>\tif phr-ModeOtherCG is set to real by upper layers:\n6>\tobtain the value for the corresponding PCMAX,f,c field for the SpCell of the other MAC entity (i.e. E-UTRA MAC entity) from the physical layer.\n3>\tinstruct the Multiplexing and Assembly procedure to generate and transmit the Enhanced Multiple entry PHR as defined in clause 6.1.3.49 if this MAC entity is configured with mpe-Reporting-FR2-r17 or the Enhanced Multiple Entry PHR for multiple TRP MAC CE as defined in clause 6.1.3.51 if this MAC entity is configured with twoPHRMode or the Multiple Entry PHR with assumed PUSCH MAC CE as defined in clause 6.1.3.78 if this MAC entity is configured with phr-AssumedPUSCH-Reporting or the Multiple Entry PHR MAC CE as defined in clause 6.1.3.9 otherwise based on the values reported by the physical layer.\n2>\telse (i.e. Single Entry PHR format is used):\n3>\tif this MAC entity is configured with twoPHRMode:\n4>\tobtain two values of the Type 1 power headroom from the physical layer for the corresponding uplink carrier of the PCell.\n3>\telse:\n4>\tobtain the value of the Type 1 power headroom from the physical layer for the corresponding uplink carrier of the PCell.\n3>\tif this MAC entity is configured with phr-AssumedPUSCH-Reporting:\n4>\tif dynamicTransformPrecoderFieldPresenceDCI-0-1-r18 or dynamicTransformPrecoderFieldPresenceDCI-0-2-r18 is set to enabled in the active BWP of this Serving Cell:\n5>\tobtain the value for the corresponding PCMAX,f,c field for assumed PUSCH from the physical layer, if available, as specified in clause 7.7 of TS 38.213 [6].\n3>\tobtain the value for the corresponding PCMAX,f,c field from the physical layer;\n3>\tif mpe-Reporting-FR2 is configured and this Serving Cell operates on FR2:\n4>\tobtain the value for the corresponding MPE field from the physical layer.\n3>\tif mpe-Reporting-FR2-r17 is configured and this Serving Cell operates on FR2 and this Serving Cell is associated to this MAC entity:\n4>\tobtain the value for the corresponding MPEi field from the physical layer;\n4>\tobtain the value for the corresponding Resourcei field from the physical layer.\n3>\tif dpc-Reporting-FR1 is configured and this Serving Cell operates on FR1:\n4>\tobtain the value for the corresponding DPC field from the physical layer.\n3>\tinstruct the Multiplexing and Assembly procedure to generate and transmit the Enhanced Single entry PHR as defined in clause 6.1.3.48 if this MAC entity is configured with mpe-Reporting-FR2-r17 or the Enhanced Single Entry PHR for multiple TRP MAC CE as defined in clause 6.1.3.50 if this MAC entity is configured with twoPHRMode or the Single Entry PHR with assumed PUSCH MAC CE as defined in clause 6.1.3.78 if this MAC entity is configured with phr-AssumedPUSCH-Reporting or the Single Entry PHR MAC CE as defined in clause 6.1.3.8 otherwise based on the values reported by the physical layer.\n2>\tif this PHR report is an MPE P-MPR report:\n3>\tstart or restart the mpe-ProhibitTimer;\n3>\tcancel triggered MPE P-MPR reporting for Serving Cells included in the PHR MAC CE.\n2>\tstart or restart phr-PeriodicTimer;\n2>\tstart or restart phr-ProhibitTimer;\n2>\tcancel all triggered PHR(s).\nAll triggered PHRs shall be cancelled when there is an ongoing SDT procedure as in clause 5.27 and the UL grant(s) can accommodate all pending data available for transmission but is not sufficient to additionally accommodate the PHR MAC CE plus its subheader.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.7\tPre-emptive Buffer Status Reporting",
                            "text_content": "The Pre-emptive Buffer Status reporting (Pre-emptive BSR) procedure is used by an IAB-MT to provide its parent IAB-DU(s) or IAB-donor-DU(s) with the information about the amount of the data expected to arrive at the IAB-MT from its child node(s) and/or UE(s) connected to it.\nIf configured, Pre-emptive BSR may be triggered for the specific case of an IAB-MT if any of the following events occur:\n-\tUL grant is provided to child IAB node or UE;\n-\tBSR is received from child IAB node or UE.\nIAB-MT may report Extended Pre-emptive BSR (as defined in clause 6.1.3.1) if the MAC entity of the IAB-MT is configured with logicalChannelGroupIAB-Ext by upper layers. Otherwise IAB-MT may report Pre-emptive BSR (as defined in clause 6.1.3.1).\nThe MAC entity shall:\n1>\tif the Pre-emptive Buffer Status reporting procedure determines that at least one Pre-emptive BSR has been triggered and not cancelled:\n2>\tif UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the Extended Pre-emptive BSR or Pre-emptive BSR MAC CE plus its subheader as a result of logical channel prioritization:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Extended Pre-emptive BSR or Pre-emptive BSR MAC CE as defined in clause 6.1.3.1.\n2>\telse:\n3>\ttrigger a Scheduling Request.\nA MAC PDU shall contain at most one Pre-emptive BSR MAC CE or Extended Pre-emptive BSR MAC CE, even when multiple events have triggered a Pre-emptive BSR.\nAll triggered Pre-emptive BSR(s) shall be cancelled when a MAC PDU is transmitted and this PDU includes the corresponding Pre-emptive BSR MAC CE or Extended Pre-emptive BSR MAC CE.\nNOTE:\tPre-emptive BSR may be used for the case of dual-connected IAB node. It is up to network implementation to work out the associated MAC entity or entities which report the Pre-emptive BSR, and the associated expected amount of data reported by any such entity or entities. For the case of dual-connected IAB node, if two ingress BH RLC channels belonging to the same ingress LCG are mapped to two different egress Cell Groups (corresponding to different parent nodes), there may be ambiguity in Pre-emptive BSR calculations and interpretation by the receiving parent node(s) and the IAB node reporting pre-emptive BSR.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.8\tTiming Advance Reporting",
                            "text_content": "The Timing Advance reporting procedure is used in a non-terrestrial network or an air to ground network to provide the gNB with an estimate of the UE's Timing Advance value (i.e., TTA as defined in the UE's TA formula, see TS 38.211 [8] clause 4.3.1).\nRRC controls Timing Advance reporting by configuring the following parameters:\n-\toffsetThresholdTA;\n-\ttimingAdvanceSR.\nA Timing Advance report (TAR) shall be triggered if any of the following events occur:\n-\tupon indication from upper layers to trigger a Timing Advance report;\n-\tupon configuration of offsetThresholdTA by upper layers, if the UE has not previously reported Timing Advance value to current Serving Cell;\n-\tif the variation between the current estimate of the Timing Advance value and the last reported Timing Advance value is equal to or larger than offsetThresholdTA, if configured.\nThe MAC entity shall:\n1>\tif the Timing Advance reporting procedure determines that at least one TAR has been triggered and not cancelled:\n2>\tif UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the Timing Advance Report MAC CE plus its subheader as a result of logical channel prioritization:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Timing Advance Report MAC CE as defined in clause 6.1.3.56.\n2>\telse\n3>\tif timingAdvanceSR is configured with value enabled:\n4>\ttrigger a Scheduling Request.\nNOTE:\tUL-SCH resources are considered available if the MAC entity has been configured with, receives, or determines an uplink grant. If the MAC entity has determined at a given point in time that UL-SCH resources are available, this need not imply that UL-SCH resources are available for use at that point in time.\nA MAC PDU shall contain at most one Timing Advance Report MAC CE, even when multiple events have triggered a Timing Advance report. The Timing Advance Report MAC CE shall be generated based on the latest available estimate of the UE's Timing Advance value prior to the MAC PDU assembly.\nAll triggered Timing Advance reports shall be cancelled when a MAC PDU is transmitted and this PDU includes a Timing Advance Report MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.9\tDelay status reporting",
                            "text_content": "The Delay Status Reporting (DSR) procedure is used to provide the serving gNB with delay status of LCGs. This delay status for an LCG includes remaining time, which is the smallest remaining value of the PDCP discardTimers among SDUs buffered for the LCG as specified in clause 7.3 in TS 38.323 [4], and the total amount of delay-critical UL data for the LCG according to the data volume calculation procedure specified in clause 5.5 in TS 38.322 [3] and clause 5.6 in TS 38.323 [4] for the associated RLC and PDCP entities, respectively.\nRRC controls the DSR procedure by configuring the following parameter:\n-\tremainingTimeThreshold: the threshold on remaining time for triggering a DSR for an LCG.\nIf an LCG is configured for delay status reporting, the MAC entity shall:\n1>\tif the smallest remaining value of the PDCP discardTimers among all the data buffered for the LCG that has not been transmitted in any MAC PDU or reported as data volume in a DSR MAC CE becomes below remainingTimeThreshold of the LCG; and\n1>\tif there is no DSR pending for the LCG since the last transmission of a DSR MAC CE:\n2>\ttrigger a DSR for the LCG.\nIf there is at least one DSR pending, the MAC entity shall:\n1>\tif UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the DSR MAC CE plus its subheader as a result of logical channel prioritization:\n2>\tinstruct the Multiplexing and Assembly procedure to generate the DSR MAC CE;\n1>\telse if there is no pending SR already triggered by the DSR procedure for the same logical channel as of this DSR:\n2>\ttrigger a Scheduling Request.\nNOTE:\tThe availability of UL-SCH resources for the transmission of the DSR MAC CE follows the same critieria specified in clause 5.4.5.\nAn SDU is considered to be associated with a DSR if it is associated with the LCG which triggered the DSR and the remaining value of its PDCP discardTimer is below remainingTimeThreshold.\nA MAC PDU shall contain at most one DSR MAC CE. The MAC entity shall not include a DSR MAC CE in a MAC PDU if the MAC PDU can accommodate the SDUs associated with all the pending DSRs.\nAfter a DSR is triggered, it is considered as pending until it is cancelled. The MAC entity shall cancel a pending DSR, either when all the SDUs associated with the DSR have been discarded, or when a MAC PDU is transmitted and this MAC PDU includes either all the SDUs associated with the DSR or a DSR MAC CE that contains the delay information of all the SDUs associated with the DSR (as described in the clause 6.1.3.72).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.5\tPCH reception",
                    "description": "",
                    "summary": "",
                    "text_content": "When the MAC entity needs to receive PCH, the MAC entity shall:\n1>\tif a PCH assignment has been received on the PDCCH for the P-RNTI:\n2>\tattempt to decode the TB on the PCH as indicated by the PDCCH information;\n2>\tif the TB on the PCH has been successfully decoded:\n3>\tdeliver the decoded MAC PDU to upper layers.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.6\tBCH reception",
                    "description": "",
                    "summary": "",
                    "text_content": "When the MAC entity needs to receive BCH, the MAC entity shall:\n1>\treceive and attempt to decode the BCH;\n1>\tif a TB on the BCH has been successfully decoded:\n2>\tdeliver the decoded MAC PDU to upper layers.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.7\tDiscontinuous Reception (DRX)",
                    "description": "",
                    "summary": "",
                    "text_content": "The MAC entity may be configured by RRC with a DRX functionality that controls the UE's PDCCH monitoring activity for the MAC entity's C-RNTI, CI-RNTI, CS-RNTI, INT-RNTI, SFI-RNTI, SP-CSI-RNTI, TPC-PUCCH-RNTI, TPC-PUSCH-RNTI, TPC-SRS-RNTI, AI-RNTI, SL-RNTI, SL-CS-RNTI and SL Semi-Persistent Scheduling V-RNTI. When using DRX operation, the MAC entity shall also monitor PDCCH according to requirements found in other clauses of this specification. When in RRC_CONNECTED, if DRX is configured, for all the activated Serving Cells, the MAC entity may monitor the PDCCH discontinuously using the DRX operation specified in this clause; otherwise the MAC entity shall monitor the PDCCH as specified in TS 38.213 [6].\nNOTE 1:\tVoid\nRRC controls DRX operation by configuring the following parameters:\n-\tdrx-onDurationTimer: the duration at the beginning of a DRX cycle;\n-\tdrx-SlotOffset: the delay before starting the drx-onDurationTimer;\n-\tdrx-InactivityTimer: the duration after the PDCCH occasion in which a PDCCH indicates a new UL, DL or SL transmission for the MAC entity;\n-\tdrx-RetransmissionTimerDL (per DL HARQ process except for the broadcast process): the maximum duration until a DL retransmission is received;\n-\tdrx-RetransmissionTimerUL (per UL HARQ process): the maximum duration until a grant for UL retransmission is received;\n-\tdrx-LongCycleStartOffset: the Long DRX cycle and drx-StartOffset which defines the subframe where the Long and Short DRX cycle starts;\n-\tdrx-NonIntegerLongCycleStartOffset (optional): the Long DRX cycle and drx-StartOffset which defines the subframe where the Long and Short DRX cycle start, when the length of the Long DRX cycle and/or the short DRX cycle is not an integer;\n-\tdrx-ShortCycle (optional): the Short DRX cycle;\n-\tdrx-NonIntegerShortCycle (optional): the Short DRX cycle whose length is not an integer;\n-\tdrx-ShortCycleTimer (optional): the duration the UE shall follow the Short DRX cycle;\n-\tdrx-HARQ-RTT-TimerDL (per DL HARQ process except for the broadcast process): the minimum duration before a DL assignment for HARQ retransmission is expected by the MAC entity;\n-\tdrx-HARQ-RTT-TimerUL (per UL HARQ process): the minimum duration before a UL HARQ retransmission grant is expected by the MAC entity;\n-\tdrx-RetransmissionTimerSL (per sidelink process): the maximum duration until a grant for SL retransmission is received;\n-\tdrx-HARQ-RTT-TimerSL (per sidelink process): the minimum duration before an SL retransmission grant is expected by the MAC entity;\n-\tdrx-LastTransmissionUL (optional): the configuration to start drx-HARQ-RTT-TimerUL after the last transmission within a bundle;\n-\tps-Wakeup (optional): the configuration to start associated drx-onDurationTimer in case DCP is monitored but not detected;\n-\tps-TransmitOtherPeriodicCSI (optional): the configuration to report periodic CSI that is not L1-RSRP on PUCCH during the time duration indicated by drx-onDurationTimer in case DCP is configured but associated drx-onDurationTimer is not started;\n-\tps-TransmitPeriodicL1-RSRP (optional): the configuration to transmit periodic CSI that is L1-RSRP on PUCCH during the time duration indicated by drx-onDurationTimer in case DCP is configured but associated drx-onDurationTimer is not started;\n-\tdownlinkHARQ-FeedbackDisabled (optional): the configuration to disable HARQ feedback per DL HARQ process;\n-\tuplinkHARQ-Mode (optional): the configuration to set HARQmodeA or HARQmodeB per UL HARQ process;\n-\tdisableCG-RetransmissionMonitoring (optional): the configuration to disable starting drx-HARQ-RTT-TimerUL for UL transmission over a configured uplink grant;\n-\tdrx-TimeReferenceSFN (optional): the reference SFN used in determining the start time of DRX on durations when short and/or long DRX cycle is not an integer.\nThe following UE variable is used for the DRX operation if drx-NonIntegerLongCycleStartOffset is configured:\n-\tDRX_SFN_COUNTER: the counter that increments when SFN changes to 0. This counter can be implemented with a maximum value of 65535.\nServing Cells of a MAC entity may be configured by RRC in two DRX groups with separate DRX parameters. When RRC does not configure a secondary DRX group, there is only one DRX group and all Serving Cells belong to that one DRX group. When two DRX groups are configured, each Serving Cell is uniquely assigned to either of the two groups. The DRX parameters that are separately configured for each DRX group are: drx-onDurationTimer, drx-InactivityTimer. The DRX parameters that are common to the DRX groups are: drx-SlotOffset, drx-RetransmissionTimerDL, drx-RetransmissionTimerUL, drx-LongCycleStartOffset, drx-NonIntegerLongCycleStartOffset, drx-ShortCycle (optional), drx-NonIntegerShortCycle (optional), drx-ShortCycleTimer (optional), drx-HARQ-RTT-TimerDL, and drx-HARQ-RTT-TimerUL.\nWhen DRX is configured, the Active Time for Serving Cells in a DRX group includes the time while:\n-\tdrx-onDurationTimer or drx-InactivityTimer configured for the DRX group is running; or\n-\tdrx-RetransmissionTimerDL, drx-RetransmissionTimerUL or drx-RetransmissionTimerSL is running on any Serving Cell in the DRX group; or\n-\tra-ContentionResolutionTimer (as described in clause 5.1.5) or msgB-ResponseWindow (as described in clause 5.1.4a) is running; or\n-\ta Scheduling Request is sent on PUCCH and is pending (as described in clause 5.4.4 or 5.22.1.5). If this Serving Cell is part of a non-terrestrial network, the Active Time is started after the Scheduling Request transmission that is performed when the SR_COUNTER is 0 for all the SR configurations with pending SR(s) plus the UE-gNB RTT; or\n-\ta PDCCH indicating a new transmission addressed to the C-RNTI of the MAC entity has not been received after successful reception of a Random Access Response for the Random Access Preamble not selected by the MAC entity among the contention-based Random Access Preamble (as described in clauses 5.1.4 and 5.1.4a); or\n-\tthere is an ongoing RACH-less LTM cell switch; or\n-\tthere is an ongoing RACH-less handover in a terrestrial network.\nThe following MAC timers are used for DRX operation in a non-terrestrial network:\n-\tHARQ-RTT-TimerDL-NTN (per DL HARQ process configured with HARQ feedback enabled): the minimum duration before a DL assignment for HARQ retransmission is expected by the MAC entity;\n-\tHARQ-RTT-TimerUL-NTN (per UL HARQ process configured with HARQModeA): the minimum duration before a UL HARQ retransmission grant is expected by the MAC entity.\nWhen DRX is not configured and multicast DRX is configured for a G-RNTI or G-CS-RNTI, the MAC entity shall:\n1>\tmonitor the PDCCH as specified in TS 38.213 [6];\n1>\tif a MAC PDU is received in a configured downlink assignment for unicast; or\n1>\tif the PDCCH indicates a DL unicast transmission:\n2>\tstop the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process.\nWhen DRX is configured, the MAC entity shall:\n1>\tif a MAC PDU is received in a configured downlink assignment for unicast:\n2>\tif this Serving Cell is configured with downlinkHARQ-FeedbackDisabled:\n3>\tif the corresponding HARQ process is configured with HARQ feedback enabled:\n4>\tset HARQ-RTT-TimerDL-NTN for the corresponding HARQ process equal to drx-HARQ-RTT-TimerDL plus the latest available UE-gNB RTT value;\n4>\tstart the HARQ-RTT-TimerDL-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.\n2>\telse:\n3>\tstart the drx-HARQ-RTT-TimerDL for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.\nNOTE 1a:\tVoid.\nNOTE 1b:\tVoid.\n2>\tstop the drx-RetransmissionTimerDL for the corresponding HARQ process;\n2>\tstop the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process.\n1>\tif a MAC PDU is transmitted in a configured uplink grant and LBT failure indication is not received from lower layers:\n2>\tif this Serving Cell is configured with uplinkHARQ-Mode:\n3>\tif the corresponding HARQ process is configured as HARQModeA:\n4>\tset HARQ-RTT-TimerUL-NTN for the corresponding HARQ process equal to drx-HARQ-RTT-TimerUL plus the latest available UE-gNB RTT value;\n4>\tif drx-LastTransmissionUL is configured:\n5>\tstart the HARQ-RTT-TimerUL-NTN for the corresponding HARQ process in the first symbol after the end of the last transmission (within a bundle) of the corresponding PUSCH transmission.\n4>\telse:\n5>\tstart the HARQ-RTT-TimerUL-NTN for the corresponding HARQ process in the first symbol after the end of the first transmission (within a bundle) of the corresponding PUSCH transmission.\n2>\telse:\n3>\tif disableCG-RetransmissionMonitoring is not configured for the configured uplink grant:\n4>\tif drx-LastTransmissionUL is configured:\n5>\tstart the drx-HARQ-RTT-TimerUL for the corresponding HARQ process in the first symbol after the end of the last transmission (within a bundle) of the corresponding PUSCH transmission.\n4>\telse:\n5>\tstart the drx-HARQ-RTT-TimerUL for the corresponding HARQ process in the first symbol after the end of the first transmission (within a bundle) of the corresponding PUSCH transmission.\n2>\tstop the drx-RetransmissionTimerUL for the corresponding HARQ process at the first transmission (within a bundle) of the corresponding PUSCH transmission.\n1>\tif a MAC PDU is transmitted in a configured sidelink grant:\n2>\tif the PUCCH resource is configured:\n3>\tstart the drx-HARQ-RTT-TimerSL for the corresponding HARQ process in the first symbol after the end of the corresponding PUCCH transmission carrying the SL HARQ feedback; or\n3>\tstart the drx-HARQ-RTT-TimerSL for the corresponding HARQ process in the first symbol after the end of the corresponding PUCCH resource for the SL HARQ feedback when the PUCCH is not transmitted;\n3>\tstop the drx-RetransmissionTimerSL for the corresponding HARQ process.\n2>\telse:\n3>\tstart the drx-HARQ-RTT-TimerSL for the corresponding HARQ process at the first symbol after the end of the corresponding PSSCH transmission;\n3>\tstop the drx-RetransmissionTimerSL for the corresponding HARQ process.\n1>\tif a drx-HARQ-RTT-TimerDL expires:\n2>\tif the data of the corresponding HARQ process was not successfully decoded:\n3>\tstart the drx-RetransmissionTimerDL for the corresponding HARQ process in the first symbol after the expiry of drx-HARQ-RTT-TimerDL.\n1>\tif a HARQ-RTT-TimerDL-NTN expires:\n2>\tif the data of the corresponding HARQ process was not successfully decoded:\n3>\tstart the drx-RetransmissionTimerDL for the corresponding HARQ process in the first symbol after the expiry of HARQ-RTT-TimerDL-NTN.\n1>\tif a drx-HARQ-RTT-TimerUL expires:\n2>\tstart the drx-RetransmissionTimerUL for the corresponding HARQ process in the first symbol after the expiry of drx-HARQ-RTT-TimerUL.\n1>\tif a HARQ-RTT-TimerUL-NTN expires:\n2>\tstart the drx-RetransmissionTimerUL for the corresponding HARQ process in the first symbol after the expiry of HARQ-RTT-TimerUL-NTN.\n1>\tif a drx-HARQ-RTT-TimerSL expires:\n2>\tif a HARQ NACK feedback for the corresponding HARQ process is transmitted on PUCCH; or\n2>\tif a HARQ NACK feedback for the corresponding HARQ process is generated but not transmitted on PUCCH; or\n2>\tif the PUCCH resource is not configured for the SL grant:\n3>\tstart the drx-RetransmissionTimerSL for the corresponding HARQ process in the first symbol after the expiry of drx-HARQ-RTT-TimerSL.\nNOTE 1c:\tThe UE handles the drx-RetransmissionTimerSL operation when sl-PUCCH-Config is configured by RRC but PUCCH resource is not scheduled same as when sl-PUCCH-Config is not configured.\n1>\tif a DRX Command MAC CE indicated by PDCCH addressed to C-RNTI or CS-RNTI, or by a configured downlink assignment for unicast transmission or a Long DRX Command MAC CE is received:\n2>\tstop drx-onDurationTimer for each DRX group;\n2>\tstop drx-InactivityTimer for each DRX group.\n1>\tif drx-InactivityTimer for a DRX group expires:\n2>\tif the Short DRX cycle is configured:\n3>\tstart or restart drx-ShortCycleTimer for this DRX group in the first symbol after the expiry of drx-InactivityTimer;\n3>\tuse the Short DRX cycle for this DRX group.\n2>\telse:\n3>\tuse the Long DRX cycle for this DRX group.\n1>\tif a DRX Command MAC CE indicated by PDCCH addressed to C-RNTI or CS-RNTI, or by a configured downlink assignment for unicast transmission is received:\n2>\tif the Short DRX cycle is configured:\n3>\tstart or restart drx-ShortCycleTimer for each DRX group in the first symbol after the end of DRX Command MAC CE reception;\n3>\tuse the Short DRX cycle for each DRX group.\n2>\telse:\n3>\tuse the Long DRX cycle for each DRX group.\n1>\tif drx-ShortCycleTimer for a DRX group expires:\n2>\tuse the Long DRX cycle for this DRX group.\n1>\tif a Long DRX Command MAC CE is received:\n2>\tstop drx-ShortCycleTimer for each DRX group;\n2>\tuse the Long DRX cycle for each DRX group.\n1>\tif the drx-NonIntegerLongCycleStartOffset is configured:\n2>\tincrement DRX_SFN_COUNTER by 1 in the first symbol of a slot in which SFN changes to 0;\n2>\tif DRX is (re-)configured by RRC:\n3>\tset DRX_SFN_COUNTER to 0 in the first symbol of the slot immediately after the successful completion of the RRC (re-)configuration;\n1>\tif the Short DRX cycle is used for a DRX group and the drx-NonIntegerShortCycle is not configured, and [(SFN × 10) + subframe number] modulo (drx-ShortCycle) = (drx-StartOffset) modulo (drx-ShortCycle); or\n1>\tif the Short DRX cycle is used for a DRX group and the drx-NonIntegerShortCycle is configured, and floor([(DRX_SFN_COUNTER × 10240) + (SFN × 10) + subframe number] modulo (drx-NonIntegerShortCycle)) = floor([(drx-TimeReferenceSFN × 10) + drx-StartOffset] modulo (drx-NonIntegerShortCycle)):\n2>\tstart drx-onDurationTimer for this DRX group after drx-SlotOffset from the beginning of the subframe.\n1>\tif the Long DRX cycle is used for a DRX group and the drx-NonIntegerLongCycleStartOffset is not configured, and [(SFN × 10) + subframe number] modulo (drx-LongCycle) = drx-StartOffset; or\n1>\tif the Long DRX cycle is used for a DRX group and the drx-NonIntegerLongCycleStartOffset is configured, and floor([(DRX_SFN_COUNTER × 10240) + (SFN × 10) + subframe number] modulo (drx-NonIntegerLongCycle)) = floor([(drx-TimeReferenceSFN × 10) + drx-StartOffset] modulo (drx-NonIntegerLongCycle)):\n2>\tif DCP monitoring is configured for the active DL BWP as specified in TS 38.213 [6], clause 10.3:\n3>\tif DCP indication associated with the current DRX cycle received from lower layer indicated to start drx-onDurationTimer, as specified in TS 38.213 [6]; or\n3>\tif all DCP occasion(s) in time domain, as specified in TS 38.213 [6], associated with the current DRX cycle occurred in Active Time considering grants/assignments/DRX Command MAC CE/Long DRX Command MAC CE received and Scheduling Request sent until 4 ms prior to start of the last DCP occasion, or during a measurement gap, or when the MAC entity monitors for a PDCCH transmission on the search space indicated by recoverySearchSpaceId of the SpCell identified by the C-RNTI while the ra-ResponseWindow is running (as specified in clause 5.1.4); or\n3>\tif ps-Wakeup is configured with value true and DCP indication associated with the current DRX cycle has not been received from lower layers:\n4>\tstart drx-onDurationTimer after drx-SlotOffset from the beginning of the subframe.\n2>\telse:\n3>\tstart drx-onDurationTimer for this DRX group after drx-SlotOffset from the beginning of the subframe.\nNOTE 2:\tIn case of unaligned SFN across carriers in a cell group, the SFN of the SpCell is used to calculate the DRX duration.\n1>\tif a DRX group is in Active Time:\n2>\tmonitor the PDCCH on the Serving Cells in this DRX group as specified in TS 38.213 [6];\n2>\tif the PDCCH indicates a DL transmission; or\n2>\tif the PDCCH indicates a one-shot HARQ feedback as specified in clause 9.1.4 of TS 38.213 [6]; or\n2>\tif the PDCCH indicates a retransmission of HARQ feedback as specified in clause 9.1.5 of TS 38.213 [6]:\n3>\tif this Serving Cell is configured with downlinkHARQ-FeedbackDisabled:\n4>\tif the corresponding HARQ process is configured with HARQ feedback enabled:\n5>\tset HARQ-RTT-TimerDL-NTN for the corresponding HARQ process equal to drx-HARQ-RTT-TimerDL plus the latest available UE-gNB RTT value;\n5>\tstart the HARQ-RTT-TimerDL-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.\n3>\telse:\n4>\tstart or restart the drx-HARQ-RTT-TimerDL for the corresponding HARQ process(es) whose HARQ feedback is reported in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.\nNOTE 3:\tWhen HARQ feedback is postponed by PDSCH-to-HARQ_feedback timing indicating an inapplicable k1 value, as specified in TS 38.213 [6], the corresponding transmission opportunity to send the DL HARQ feedback is indicated in a later PDCCH requesting the HARQ-ACK feedback.\n3>\tstop the drx-RetransmissionTimerDL for the corresponding HARQ process(es) whose HARQ feedback is reported;\n3>\tstop the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process;\n3>\tif the PDSCH-to-HARQ_feedback timing indicate an inapplicable k1 value as specified in TS 38.213 [6]:\n4>\tstart the drx-RetransmissionTimerDL in the first symbol after the (end of the last) PDSCH transmission (within a bundle) for the corresponding HARQ process.\n2>\tif the PDCCH indicates a UL transmission:\n3>\tif this Serving Cell is configured with uplinkHARQ-Mode:\n4>\tif the corresponding HARQ process is configured as HARQModeA:\n5>\tset HARQ-RTT-TimerUL-NTN for the corresponding HARQ process equal to drx-HARQ-RTT-TimerUL plus the latest available UE-gNB RTT value;\n5>\tif drx-LastTransmissionUL is configured:\n6>\tstart the HARQ-RTT-TimerUL-NTN for the corresponding HARQ process in the first symbol after the end of the last transmission (within a bundle) of the corresponding PUSCH transmission.\n5>\telse:\n6>\tstart the HARQ-RTT-TimerUL-NTN for the corresponding HARQ process in the first symbol after the end of the first transmission (within a bundle) of the corresponding PUSCH transmission.\n3>\telse:\n4>\tif drx-LastTransmissionUL is configured:\n5>\tstart the drx-HARQ-RTT-TimerUL for the corresponding HARQ process in the first symbol after the end of the last transmission (within a bundle) of the corresponding PUSCH transmission.\n4>\telse:\n5>\tstart the drx-HARQ-RTT-TimerUL for the corresponding HARQ process in the first symbol after the end of the first transmission (within a bundle) of the corresponding PUSCH transmission.\n3>\tstop the drx-RetransmissionTimerUL for the corresponding HARQ process.\n2>\tif the PDCCH indicates an SL transmission:\n3>\tif the PUCCH resource is configured:\n4>\tstart the drx-HARQ-RTT-TimerSL for the corresponding HARQ process in the first symbol after the end of the corresponding PUCCH transmission carrying the SL HARQ feedback; or\n4>\tstart the drx-HARQ-RTT-TimerSL for the corresponding HARQ process in the first symbol after the end of the corresponding PUCCH resource for the SL HARQ feedback when the PUCCH is not transmitted;\n4>\tstop the drx-RetransmissionTimerSL for the corresponding HARQ process.\n3>\telse:\n4>\tstart the drx-HARQ-RTT-TimerSL for the corresponding HARQ process at the first symbol after end of PDCCH occasion;\n4>\tstop the drx-RetransmissionTimerSL for the corresponding HARQ process.\n2>\tif the PDCCH indicates a new transmission (DL, UL or SL) on a Serving Cell in this DRX group:\n3>\tstart or restart drx-InactivityTimer for this DRX group in the first symbol after the end of the PDCCH reception.\nNOTE 3a:\tA PDCCH indicating activation of SPS, configured grant type 2, or configured sidelink grant of configured grant Type 2 is considered to indicate a new transmission.\nNOTE 3b:\tIf the PDCCH reception includes two PDCCH candidates from corresponding search spaces, as described in clause 10.1 in 38.213, start or restart drx-InactivityTimer for this DRX group in the first symbol after the end of the PDCCH candidate that ends later in time.\n2>\tif a HARQ process receives downlink feedback information and acknowledgement is indicated:\n3>\tstop the drx-RetransmissionTimerUL for the corresponding HARQ process.\n1>\tif DCP monitoring is configured for the active DL BWP as specified in TS 38.213 [6], clause 10.3; and\n1>\tif the current symbol n occurs within drx-onDurationTimer duration; and\n1>\tif drx-onDurationTimer associated with the current DRX cycle is not started as specified in this clause:\n2>\tif the MAC entity would not be in Active Time considering grants/assignments/DRX Command MAC CE/Long DRX Command MAC CE received and Scheduling Request sent until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in this clause; and\n2>\tif allowCSI-SRS-Tx-MulticastDRX-Active is not configured, or if cfr-ConfigMulticast is not configured for any of the active BWP(s) of the Serving Cell(s), or if all multicast DRXes would not be in Active Time considering multicast assignments/DRX Command MAC CE for MBS multicast received until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in Clause 5.7b and all multicast sessions are configured with multicast DRX:\n3>\tnot transmit periodic SRS and semi-persistent SRS defined in TS 38.214 [7];\n3>\tnot report semi-persistent CSI configured on PUSCH;\n3>\tnot report semi-persistent CSI on PUCCH;\n3>\tif ps-TransmitPeriodicL1-RSRP is not configured with value true:\n4>\tnot report periodic CSI that is L1-RSRP on PUCCH.\n3>\tif ps-TransmitOtherPeriodicCSI is not configured with value true:\n4>\tnot report periodic CSI that is not L1-RSRP on PUCCH.\n1>\telse:\n2>\tin current symbol n, if a DRX group would not be in Active Time considering grants/assignments scheduled on Serving Cell(s) in this DRX group and DRX Command MAC CE/Long DRX Command MAC CE received and Scheduling Request sent until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in this clause; and\n2>\tif allowCSI-SRS-Tx-MulticastDRX-Active is not configured, or if cfr-ConfigMulticast is not configured for any of the active BWP(s) of the Serving Cell(s), or, in current symbol n, if all multicast DRXes corresponding to the DRX group would not be in Active Time considering multicast assignments/DRX Command MAC CE for MBS multicast received until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in Clause 5.7b and all multicast sessions corresponding to the DRX group are configured with multicast DRX:\n3>\tnot transmit periodic SRS and semi-persistent SRS defined in TS 38.214 [7] in this DRX group;\n3>\tnot report CSI on PUCCH and semi-persistent CSI configured on PUSCH in this DRX group.\n2>\tif CSI masking (csi-Mask) is setup by upper layers:\n3>\tin current symbol n, if drx-onDurationTimer of a DRX group would not be running considering grants/assignments scheduled on Serving Cell(s) in this DRX group and DRX Command MAC CE/Long DRX Command MAC CE received until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in this clause; and\n3>\tif allowCSI-SRS-Tx-MulticastDRX-Active is not configured, or if cfr-ConfigMulticast is not configured for any of the active BWP(s) of the Serving Cell(s), or, in current symbol n, if drx-onDurationTimerPTM(s) of all multicast DRXes corresponding to the DRX group would not be running considering DRX Command MAC CE for MBS multicast received until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in Clause 5.7b and all multicast sessions corresponding to the DRX group are configured with multicast DRX:\n4>\tnot report CSI on PUCCH in this DRX group.\nNOTE 4:\tIf a UE multiplexes a CSI configured on PUCCH with other overlapping UCI(s) according to the procedure specified in TS 38.213 [6] clause 9.2.5 and this CSI multiplexed with other UCI(s) would be reported on a PUCCH resource either outside DRX Active Time of the DRX group in which this PUCCH is configured or outside the on-duration period of the DRX group in which this PUCCH is configured if CSI masking is setup by upper layers, it is up to UE implementation whether to report this CSI multiplexed with other UCI(s).\nThe MAC entity shall ensure no rounding error is generated when performing the modulus operation with drx-NonIntegerShortCycle or drx-NonIntegerLongCycle as the divisor.\nRegardless of whether the MAC entity is monitoring PDCCH or not on the Serving Cells in a DRX group, the MAC entity transmits HARQ feedback, aperiodic CSI on PUSCH, and aperiodic SRS defined in TS 38.214 [7] on the Serving Cells in the DRX group when such is expected.\nThe MAC entity needs not to monitor the PDCCH if it is not a complete PDCCH occasion (e.g. the Active Time starts or ends in the middle of a PDCCH occasion).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.7a\tDiscontinuous Reception (DRX) for MBS Broadcast",
                    "description": "",
                    "summary": "",
                    "text_content": "For MBS broadcast, the MAC entity may be configured by RRC with a DRX functionality per G-RNTI that controls the UE's PDCCH monitoring activity for the MAC entity's G-RNTI(s) as specified in TS 38.331 [5]. When in RRC_IDLE or RRC_INACTIVE or RRC_CONNECTED, if broadcast DRX is configured for a G-RNTI, the MAC entity is allowed to monitor the PDCCH for this G-RNTI discontinuously using the broadcast DRX operation specified in this clause; otherwise the MAC entity monitors each PDCCH for this G-RNTI as specified in TS 38.213 [6]. The broadcast DRX operation specified in this clause is performed independently for each G-RNTI and independently from the DRX operation specified in clauses 5.7 and 5.7b.\nRRC controls broadcast DRX operation by configuring the following parameters:\n-\tdrx-onDurationTimerPTM: the duration at the beginning of a DRX cycle;\n-\tdrx-SlotOffsetPTM: the delay before starting the drx-onDurationTimerPTM;\n-\tdrx-InactivityTimerPTM: the duration after the PDCCH occasion in which a PDCCH indicates a new DL broadcast transmission for the MAC entity;\n-\tdrx-LongCycleStartOffsetPTM: the long DRX cycle drx-LongCycle-PTM and drx-StartOffset-PTM which defines the subframe where the DRX cycle starts.\nWhen broadcast DRX is configured for a G-RNTI, the Active Time includes the time while:\n-\tdrx-onDurationTimerPTM or drx-InactivityTimerPTM for this G-RNTI is running.\nWhen broadcast DRX is configured for a G-RNTI, the MAC entity shall for this G-RNTI:\n1>\tif [(SFN × 10) + subframe number] modulo (drx-LongCycle-PTM) = drx-StartOffset-PTM:\n2>\tstart drx-onDurationTimerPTM after drx-SlotOffsetPTM from the beginning of the subframe.\n1>\tif the MAC entity is in Active Time for this G-RNTI:\n2>\tmonitor the PDCCH for this G-RNTI as specified in TS 38.213 [6];\n2>\tif the PDCCH indicates a DL transmission for MBS broadcast:\n3>\tstart or restart drx-InactivityTimerPTM in the first symbol after the end of the PDCCH reception.\nNOTE:\tIf a cell is configured for MBS broadcast reception, the SFN of this cell is used to calculate the DRX duration of MBS broadcast on this cell.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.7b\tDiscontinuous Reception (DRX) for MBS Multicast",
                    "description": "",
                    "summary": "",
                    "text_content": "For MBS multicast, the MAC entity may be configured by RRC with a DRX functionality per G-RNTI or per G-CS-RNTI that controls the UE's PDCCH monitoring activity for the MAC entity's G-RNTI(s) and G-CS-RNTI(s) as specified in TS 38.331 [5]. When in RRC_CONNECTED, if multicast DRX is configured for a G-RNTI or G-CS-RNTI, the MAC entity is allowed to monitor the PDCCH for this G-RNTI or G-CS-RNTI discontinuously using the multicast DRX operation specified in this clause; otherwise the MAC entity monitors the PDCCH for this G-RNTI or G-CS-RNTI as specified in TS 38.213 [6]. When in RRC_INACTIVE, if the UE is configured to receive multicast in RRC_INACTIVE and multicast DRX is configured for a G-RNTI, the MAC entity is allowed to monitor the PDCCH for this G-RNTI discontinuously using the multicast DRX operation specified in this clause; otherwise the MAC entity monitors the PDCCH for this G-RNTI as specified in TS 38.213 [6]. The multicast DRX operation specified in this clause is performed independently for each G-RNTI or G-CS-RNTI and independently from the DRX operation specified in clauses 5.7 and 5.7a.\nRRC controls multicast DRX operation per G-RNTI or per G-CS-RNTI by configuring the following parameters:\n-\tdrx-onDurationTimerPTM: the duration at the beginning of a DRX cycle;\n-\tdrx-SlotOffsetPTM: the delay before starting the drx-onDurationTimerPTM;\n-\tdrx-InactivityTimerPTM: the duration after the PDCCH occasion in which a PDCCH indicates a new DL multicast transmission for the MAC entity;\n-\tdrx-LongCycleStartOffsetPTM: the long DRX cycle drx-LongCycle-PTM and drx-StartOffset-PTM which defines the subframe where the long DRX cycle starts;\n-\tdrx-RetransmissionTimerDL-PTM (per DL HARQ process for MBS multicast): the maximum duration until a DL multicast retransmission is received;\n-\tdrx-HARQ-RTT-TimerDL-PTM (per DL HARQ process for MBS multicast): the minimum duration before a DL multicast assignment for HARQ retransmission is expected by the MAC entity.\nWhen multicast DRX is configured for a G-RNTI or G-CS-RNTI, the Active Time includes the time while:\n-\tdrx-onDurationTimerPTM or drx-InactivityTimerPTM or drx-RetransmissionTimerDL-PTM for this G-RNTI or G-CS-RNTI is running.\nWhen multicast DRX is not configured for a G-RNTI or G-CS-RNTI, and the cfr-ConfigMulticast is configured for at least one of the active BWP(s) of the Serving Cell(s), and unicast DRX is configured, the MAC entity shall for this G-RNTI or G-CS-RNTI:\n1>\tmonitor the PDCCH as specified in TS 38.213 [6];\n1>\tif the PDCCH indicates a DL multicast transmission; or\n1>\tif a MAC PDU is received in a configured downlink multicast assignment:\n2>\tstop the drx-RetransmissionTimerDL for the corresponding HARQ process.\n1>\tif the PDCCH addressed to G-RNTI indicates a DL multicast transmission; or\n1>\tif the PDCCH addressed to G-CS-RNTI indicates a DL multicast transmission and CS-RNTI is configured; or\n1>\tif a MAC PDU is received in a configured downlink multicast assignment and CS-RNTI is configured:\n2>\tif the first HARQ-ACK reporting mode (i.e. ack-nack) is used as specified in TS 38.213 [6]; and\n2>\tif HARQ feedback is enabled:\n3>\tstart the drx-HARQ-RTT-TimerDL for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.\nWhen multicast DRX is configured for a G-RNTI or G-CS-RNTI, and the cfr-ConfigMulticast is configured for at least one of the active BWP(s) of the Serving Cell(s), the MAC entity shall for this G-RNTI or G-CS-RNTI:\n1>\tif a MAC PDU is received in a configured downlink multicast assignment:\n2>\tif HARQ feedback is enabled:\n3>\tstart the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback;\n3>\tif the first HARQ-ACK reporting mode (i.e. ack-nack) is used as specified in TS 38.213 [6]; and\n3>\tif CS-RNTI is configured:\n4>\tstart the drx-HARQ-RTT-TimerDL for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.\n2>\telse if drx-HARQ-RTT-TimerDL-PTM is configured:\n3>\tstart the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback that would be performed if HARQ feedback were enabled.\n2>\tstop the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process;\n2>\tstop the drx-RetransmissionTimerDL for the corresponding HARQ process.\n1>\tif a drx-HARQ-RTT-TimerDL-PTM expires:\n2>\tif the data of the corresponding HARQ process was not successfully decoded:\n3>\tstart the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process in the first symbol after the expiry of drx-HARQ-RTT-TimerDL-PTM.\n1>\tif a DRX Command MAC CE indicated by PDCCH addressed to a G-RNTI or G-CS-RNTI, or by a configured downlink multicast assignment is received:\n2>\tstop drx-onDurationTimerPTM of the DRX for this G-RNTI or G-CS-RNTI, or the corresponding G-CS-RNTI;\n2>\tstop drx-InactivityTimerPTM of the DRX for this G-RNTI or G-CS-RNTI, or the corresponding G-CS-RNTI.\n1>\tif [(SFN × 10) + subframe number] modulo (drx-LongCycle-PTM) = drx-StartOffset-PTM:\n2>\tstart drx-onDurationTimerPTM after drx-SlotOffsetPTM from the beginning of the subframe.\n1>\tif the MAC entity is in Active Time for this G-RNTI or G-CS-RNTI:\n2>\tmonitor the PDCCH for this G-RNTI or G-CS-RNTI as specified in TS 38.213 [6];\n2>\tif the PDCCH indicates a DL multicast transmission:\n3>\tif HARQ feedback is enabled:\n4>\tstart the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback;\n4>\tif the first HARQ-ACK reporting mode (i.e. ack-nack) is used as specified in TS 38.213 [6]:\n5>\tif the PDCCH addressed to G-RNTI indicates a DL multicast transmission; or\n5>\tif the PDCCH addressed to G-CS-RNTI indicates a DL multicast transmission and CS-RNTI is configured:\n6>\tstart the drx-HARQ-RTT-TimerDL for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.\n3>\telse if drx-HARQ-RTT-TimerDL-PTM is configured in RRC_INACTIVE, and the UE supports ptm-RetransmissionInactive:\n4>\tstart the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding multicast transmission.\n3>\telse if drx-HARQ-RTT-TimerDL-PTM is configured:\n4>\tstart the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback that would be performed if HARQ feedback were enabled.\n3>\tstop the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process;\n3>\tstop the drx-RetransmissionTimerDL for the corresponding HARQ process.\n2>\tif the PDCCH indicates a new multicast transmission for this G-RNTI or G-CS-RNTI:\n3>\tstart or restart drx-InactivityTimerPTM in the first symbol after the end of the PDCCH reception.\nNOTE 1:\tA PDCCH indicating activation of multicast SPS is considered to indicate a new transmission.\nNOTE 2:\tThe UE may start the drx-HARQ-RTT-TimerDL after receiving a PTM transmission only if ptp-Retx-Multicast or ptp-Retx-SPS-Multicast was included in the UECapabilityInformation message to network.\nThe MAC entity needs not to monitor the PDCCH for a G-RNTI or a G-CS-RNTI if it is not a complete PDCCH occasion (e.g. the Active Time for a G-RNTI or a G-CS-RNTI starts or ends in the middle of a PDCCH occasion).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.8\tTransmission and reception without dynamic scheduling",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.8.1\tDownlink",
                            "text_content": "Semi-Persistent Scheduling (SPS) is only applicable for UEs in RRC_CONNECTED and is configured by RRC for a Serving Cell per BWP. Multiple assignments can be active simultaneously in the same BWP. Activation and deactivation of the DL SPS are independent among the Serving Cells.\nFor the DL SPS, a DL assignment is provided by PDCCH, and stored or cleared based on L1 signalling indicating SPS activation or deactivation.\nRRC configures the following parameters when the SPS is configured:\n-\tcs-RNTI: CS-RNTI for activation, deactivation, and retransmission;\n-\tnrofHARQ-Processes: the number of configured HARQ processes for SPS;\n-\tharq-ProcID-Offset: Offset of HARQ process for SPS;\n-\tperiodicity: periodicity of configured downlink assignment for SPS.\nWhen the SPS is released by upper layers, all the corresponding configurations shall be released.\nAfter a downlink assignment is configured for SPS, the MAC entity shall consider sequentially that the Nth downlink assignment occurs in the slot for which:\n(numberOfSlotsPerFrame × SFN + slot number in the frame) =\n[(numberOfSlotsPerFrame × SFNstart time + slotstart time) + N × periodicity × numberOfSlotsPerFrame / 10]\n\tmodulo (1024 × numberOfSlotsPerFrame)\nwhere SFNstart time and slotstart time are the SFN and slot, respectively, of the first transmission of PDSCH where the configured downlink assignment was (re-)initialised.\nNOTE:\tIn case of unaligned SFN across carriers in a cell group, the SFN of the concerned Serving Cell is used to calculate the occurrences of configured downlink assignments.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.1a\tDownlink for Multicast",
                            "text_content": "MBS Semi-Persistent Scheduling (SPS) is configured by RRC on one Serving Cell per BWP. Multiple assignments can be active simultaneously in the same BWP.\nFor the DL MBS SPS, a DL assignment is provided by PDCCH, and stored or cleared based on L1 signalling indicating SPS activation or deactivation.\nRRC configures the following parameters when the MBS SPS is configured:\n-\tcs-RNTI: CS-RNTI for MBS SPS deactivation, PTP for PTM retransmission if configured;\n-\tg-cs-RNTI: G-CS-RNTI for activation, deactivation, and retransmission;\n-\tnrofHARQ-Processes: the number of configured HARQ processes for MBS SPS;\n-\tharq-ProcID-Offset: Offset of HARQ process for MBS SPS;\n-\tperiodicity: periodicity of configured downlink assignment for MBS SPS.\nWhen the MBS SPS is released by upper layers, all the corresponding configurations shall be released.\nAfter a downlink assignment is configured for MBS SPS, the MAC entity shall consider sequentially that the Nth downlink assignment occurs in the slot for which:\n(numberOfSlotsPerFrame × SFN + slot number in the frame) =\n[(numberOfSlotsPerFrame × SFNstart time + slotstart time) + N × periodicity × numberOfSlotsPerFrame / 10]\n\tmodulo (1024 × numberOfSlotsPerFrame)\nwhere SFNstart time and slotstart time are the SFN and slot, respectively, of the first transmission of PDSCH where the configured downlink assignment was (re-)initialised.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.2\tUplink",
                            "text_content": "There are two types of transmission without dynamic grant:\n-\tconfigured grant Type 1 where an uplink grant is provided by RRC, and stored as configured uplink grant;\n-\tconfigured grant Type 2 where an uplink grant is provided by PDCCH, and stored or cleared as configured uplink grant based on L1 signalling indicating configured uplink grant activation or deactivation.\nType 1 and Type 2 are configured by RRC for a Serving Cell per BWP. Multiple configurations can be active simultaneously in the same BWP. For Type 2, activation and deactivation are independent among the Serving Cells. For the same BWP, the MAC entity can be configured with both Type 1 and Type 2.\nA multi-PUSCH configured grant has multiple consecutive configured uplink grants within a periodicity. Both Type 1 and Type 2 can be configured for a multi-PUSCH configured grant by RRC.\nOnly configured grant Type 1 can be configured for CG-SDT. CG-SDT can only be configured on initial BWP.\nRRC configures the following parameters when the configured grant Type 1 is configured:\n-\tcs-RNTI: CS-RNTI for retransmission;\n-\tcg-SDT-CS-RNTI: CS-RNTI for CG-SDT retransmission;\n-\tcg-SDT-RSRP-ThresholdSSB: an RSRP threshold configured for SSB selection for CG-SDT;\n-\trach-less-RSRP-ThresholdSSB: an RSRP threshold configured for SSB selection for RACH-less handover;\n-\tperiodicity: periodicity of the configured grant Type 1;\n-\ttimeDomainOffset: Offset of a resource with respect to SFN = timeReferenceSFN in time domain;\n-\ttimeDomainAllocation: Allocation of configured uplink grant in time domain which contains startSymbolAndLength (i.e. SLIV in TS 38.214 [7]) or startSymbol (i.e. S in TS 38.214 [7]);\n-\tnrofHARQ-Processes: the number of HARQ processes for configured grant;\n-\tharq-ProcID-Offset: offset of HARQ process for configured grant configured with cg-RetransmissionTimer for operation with shared spectrum channel access;\n-\tharq-ProcID-Offset2: offset of HARQ process for configured grant not configured with cg-RetransmissionTimer;\n-\ttimeReferenceSFN: SFN used for determination of the offset of a resource in time domain. The UE uses the closest SFN with the indicated number preceding the reception of the configured grant configuration;\n-\ttimeReferenceH-SFN: H-SFN used for determination of the offset of a resource in time domain. The UE uses the closest H-SFN with the indicated number preceding the reception of the configured grant configuration.\nRRC configures the following parameters when the configured grant Type 2 is configured:\n-\tcs-RNTI: CS-RNTI for activation, deactivation, and retransmission;\n-\tperiodicity: periodicity of the configured grant Type 2;\n-\tnrofHARQ-Processes: the number of HARQ processes for configured grant;\n-\tharq-ProcID-Offset: offset of HARQ process for configured grant configured with cg-RetransmissionTimer for operation with shared spectrum channel access;\n-\tharq-ProcID-Offset2: offset of HARQ process for configured grant not configured with cg-RetransmissionTimer.\nRRC configures the following parameter when retransmissions on configured uplink grant is configured:\n-\tcg-RetransmissionTimer: the duration after a configured grant (re)transmission of a HARQ process when the UE shall not autonomously retransmit that HARQ process;\n-\tcg-SDT-RetransmissionTimer: the duration after a configured grant (re)transmission of a HARQ process of the initial CG-SDT transmission with CCCH message when the UE shall not autonomously retransmit the HARQ process;\n-\tcg-LTM-RetransmissionTimer: the duration after a configured grant (re)transmission of a HARQ process of the initial transmission at LTM cell switch when the UE shall not autonomously initiate a retransmission on the HARQ process;\n-\tcg-RACH-less-RetransmissionTimer: the duration after a configured grant (re)transmission of a HARQ process of the initial transmission of RACH-less handover when the UE shall not autonomously retransmit the HARQ process.\nRRC configures the following additional parameter for a multi-PUSCH configured grant:\n-\tnrofSlotsInCG-Period: the number of configured uplink grants in a periodicity of a multi-PUSCH configured grant.\nFor a configured uplink grant, the MAC entity shall:\n1>\tif the configured uplink grant is associated with a multi-PUSCH configured grant:\n2>\tif configured uplink grant has not been indicated to the lower layers as to be unused for PUSCH transmission; and\n2>\tif the configured uplink grant meets the validity conditions specified in the clause 6.1 in TS 38.214 [7]:\n3>\tconsider the configured uplink grant available for use;\n1>\telse if the configured uplink grant has not been indicated to lower layers as to be unused for PUSCH transmission:\n2>\tconsider the configured uplink grant available for use.\nThe MAC entity determines if a configured uplink grant is going to be used for PUSCH transmission or not by considering the amount of buffered data that can be transmitted on the available occasions of the associated configured grant and other available UL-SCH resources. Upon this determination, the MAC entity sends an indication to the lower layers regarding this decision, for use in the procedure for reporting UTO-UCI (as specified in clause 9.3 in TS 38.213 [6]).\nUpon configuration of a configured grant Type 1 for a BWP of a Serving Cell by upper layers, the MAC entity shall:\n1>\tstore the uplink grant provided by upper layers as a configured uplink grant for the indicated BWP of the Serving Cell;\n1>\tinitialise or re-initialise the configured uplink grant to start in the symbol according to timeDomainOffset, timeReferenceSFN, and S (derived from SLIV or provided by startSymbol as specified in TS 38.214 [7]), and to reoccur with periodicity.\nAfter an uplink grant is configured for a configured grant Type 1, the MAC entity shall consider sequentially that the configured uplink grant, or the first configured uplink grant in a multi-PUSCH configured grant, in the Nth (N ≥ 0) periodicity occurs in the symbol for which:\n-\tif cg-SDT-PeriodicityExt (as defined in TS 38.331 [5]) is not configured:\n[(SFN × numberOfSlotsPerFrame × numberOfSymbolsPerSlot)\n\t+ (slot number in the frame × numberOfSymbolsPerSlot) + symbol number in the slot] =\n\t(timeReferenceSFN × numberOfSlotsPerFrame × numberOfSymbolsPerSlot\n\t+ timeDomainOffset × numberOfSymbolsPerSlot + S + N × periodicity)\n\tmodulo (1024 × numberOfSlotsPerFrame × numberOfSymbolsPerSlot)\n-\telse:\n[(H-SFN × numberOfSFNperH-SFN + SFN) × numberOfSlotsPerFrame × numberOfSymbolsPerSlot\n\t+ (slot number in the frame × numberOfSymbolsPerSlot) + symbol number in the slot] =\n\t((timeReferenceH-SFN × numberOfSFNperH-SFN + timeReferenceSFN)\n\t× numberOfSlotsPerFrame × numberOfSymbolsPerSlot\n\t+ timeDomainOffset × numberOfSymbolsPerSlot + S + N × periodicity)\n\tmodulo (1024 × 1024 × numberOfSlotsPerFrame × numberOfSymbolsPerSlot)\nFor a multi-PUSCH configured grant Type 1, the Mth (1 < M ≤ nrofSlotsInCG-Period) configured uplink grant within a periodicity occurs (M-1) × numberOfSymbolsPerSlot symbols after the symbol in which the first configured uplink grant in that periodicity occurs.\nFor an uplink grant configured for configured grant Type 1 for CG-SDT on the selected uplink carrier as in clause 5.27, when CG-SDT is triggered and not terminated, for each configured uplink grant valid according to TS 38.214 [7] for which the above formula is satisfied, the MAC entity shall:\n1>\tif, after initial transmission for CG-SDT with CCCH message has been performed according to clause 5.4.1, PDCCH addressed to the MAC entity's C-RNTI has not been received:\n2>\tif the SSB corresponding to the configured UL grant has the same SSB index as the SSB selected for initial transmission for CG-SDT with CCCH message (i.e., retransmission of initial transmission of CG-SDT):\n3>\tselect this SSB;\n3>\tindicate the SSB index corresponding to the configured uplink grant to the lower layer;\n3>\tconsider this configured uplink grant as valid.\n1>\telse if at least one SSB configured for CG-SDT with SS-RSRP above cg-SDT-RSRP-ThresholdSSB is available:\n2>\tif at least one SSB corresponding to the configured uplink grant with SS-RSRP above the cg-SDT-RSRP-ThresholdSSB is available:\n3>\tif this is the initial transmission of CG-SDT with CCCH message after the CG-SDT procedure is initiated as in clause 5.27 (i.e., initial transmission for CG-SDT):\n4>\tselect an SSB with SS-RSRP above cg-SDT-RSRP-ThresholdSSB amongst the SSB(s) associated with the configured uplink grant.\n3>\telse if PDCCH addressed to C-RNTI has been received after the initial transmission of CG-SDT with CCCH message (i.e., subsequent new transmission for CG-SDT):\n4>\tif SS-RSRP of the SSB selected for the previous transmission for CG-SDT is above cg-SDT-RSRP-ThresholdSSB and this SSB is associated with this configured uplink grant:\n5>\tselect this SSB.\n4>\telse if SS-RSRP of the SSB selected for the previous transmission for CG-SDT is not above cg-SDT-RSRP-ThresholdSSB:\n5>\tselect an SSB with SS-RSRP above cg-SDT-RSRP-ThresholdSSB amongst the SSB(s) associated with the configured uplink grant.\n3>\tif SSB is selected above:\n4>\tindicate the SSB index to the lower layer;\n4>\tconsider this configured uplink grant as valid.\n1>\telse:\n2>\tconsider this configured uplink grant as not valid.\n2>\tif PDCCH addressed to C-RNTI after the initial transmission of the CG-SDT with CCCH message has been received:\n3>\tif there is data available for transmission for at least one RB configured for SDT:\n4>\tinitiate Random Access procedure in clause 5.1.\nNOTE 1:\tWhen the UE determines if there is an SSB with SS-RSRP above cg-SDT-RSRP-ThresholdSSB, the UE uses the latest unfiltered L1-RSRP measurement.\nFor an uplink grant configured for configured grant Type 1 for LTM cell switch, when there is an on-going RACH-less LTM cell switch procedure, for each configured uplink grant valid according to TS 38.214 [7] for which the above formula is satisfied, the MAC entity shall:\n1>\tif an SSB corresponding to the configured UL grant has the same SSB index as the SSB associated with the TCI state indicated by LTM Cell Switch Command MAC CE, as specified in clause 5.18.35:\n2>\tselect the SSB associated with the TCI state indicated by LTM Cell Switch Command MAC CE.\n2>\tindicate the SSB index to the lower layer;\n2>\tconsider this configured uplink grant as valid.\n1>\telse:\n2>\tconsider this configured uplink grant as not valid.\nFor an uplink grant configured for configured grant Type 1 for RACH-less handover, when RACH-less handover is triggered and not terminated, for each configured uplink grant valid according to TS 38.214 [7] for which the above formula is satisfied, the MAC entity shall:\n1>\tif, after the initial transmission of RACH-less handover has been performed according to clause 5.4.1 and 5.33, PDCCH addressed to the MAC entity's C-RNTI has not been received:\n2>\tif the SSB corresponding to the configured UL grant has the same SSB index as the SSB selected for the initial transmission of RACH-less handover (i.e., retransmission of initial transmission of RACH-less handover):\n3>\tselect this SSB;\n3>\tindicate the SSB index corresponding to the configured uplink grant to the lower layer;\n3>\tconsider this configured uplink grant as valid.\n1>\telse if at least one SSB corresponding to the configured uplink grant with SS-RSRP above rach-less-RSRP-ThresholdSSB is available:\n2>\tselect an SSB with SS-RSRP above rach-less-RSRP-ThresholdSSB amongst the SSB(s) associated with the configured uplink grant;\n2>\tindicate the selected SSB index to the lower layer;\n2>\tconsider this configured uplink grant as valid.\n1>\telse:\n2>\tconsider this configured uplink grant as not valid;\n2>\tinitiate Random Access procedure in clause 5.1.\nNOTE 1A:\tWhen the UE determines if there is an SSB with SS-RSRP above rach-less-RSRP-ThresholdSSB, the UE uses the latest unfiltered L1-RSRP measurement.\nAfter an uplink grant is configured for a configured grant Type 2, the MAC entity shall consider sequentially that the configured uplink grant, or the first configured uplink grant in a multi-PUSCH configured grant, in the Nth (N ≥ 0) periodicity occurs in the symbol for which:\n[(SFN × numberOfSlotsPerFrame × numberOfSymbolsPerSlot)\n\t+ (slot number in the frame × numberOfSymbolsPerSlot) + symbol number in the slot] =\n\t[(SFNstart time × numberOfSlotsPerFrame × numberOfSymbolsPerSlot\n\t+ slotstart time × numberOfSymbolsPerSlot + symbolstart time) + N × periodicity]\n\tmodulo (1024 × numberOfSlotsPerFrame × numberOfSymbolsPerSlot)\nwhere SFNstart time, slotstart time, and symbolstart time are the SFN, slot, and symbol, respectively, of the first transmission opportunity of PUSCH where the configured uplink grant was (re-)initialised.\nFor a multi-PUSCH configured grant Type 2, the Mth (1 < M ≤ nrofSlotsInCG-Period) configured uplink grant within the same periodicity occurs (M-1) × numberOfSymbolsPerSlot symbols after the symbol in which the first configured uplink grant in that periodicity occurs.\nIf cg-nrofPUSCH-InSlot or cg-nrofSlots is configured for a configured grant Type 1 or Type 2, the MAC entity shall consider the uplink grants occur in those additional PUSCH allocations as specified in clause 6.1.2.3 of TS 38.214 [7].\nNOTE 2:\tIn case of unaligned SFN across carriers in a cell group, the SFN of the concerned Serving Cell is used to calculate the occurrences of configured uplink grants.\nWhen the configured uplink grant is released by upper layers, all the corresponding configurations shall be released and all corresponding uplink grants shall be cleared.\nThe MAC entity shall:\n1>\tif at least one configured uplink grant confirmation has been triggered and not cancelled; and\n1>\tif the MAC entity has UL resources allocated for new transmission:\n2>\tif, in this MAC entity, at least one configured uplink grant is configured by configuredGrantConfigToAddModList:\n3>\tinstruct the Multiplexing and Assembly procedure to generate a Multiple Entry Configured Grant Confirmation MAC CE as defined in clause 6.1.3.31.\n2>\telse:\n3>\tinstruct the Multiplexing and Assembly procedure to generate a Configured Grant Confirmation MAC CE as defined in clause 6.1.3.7.\n2>\tcancel all triggered configured uplink grant confirmation(s).\nFor a configured grant Type 2, the MAC entity shall clear the configured uplink grant(s) immediately after first transmission of Configured Grant Confirmation MAC CE or Multiple Entry Configured Grant Confirmation MAC CE which confirms the configured uplink grant deactivation.\nRetransmissions use:\n-\trepetition of configured uplink grants; or\n-\treceived uplink grants addressed to CS-RNTI; or\n-\tconfigured uplink grants with cg-RetransmissionTimer, cg-LTM-RetransmissionTimer, cg-RACH-less-RetransmissionTimer or cg-SDT-RetransmissionTimer configured.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.3\tSidelink",
                            "text_content": "There are two types of transmission without dynamic sidelink grant:\n-\tconfigured grant Type 1 where an sidelink grant is provided by RRC, and stored as configured sidelink grant;\n-\tconfigured grant Type 2 where an sidelink grant is provided by PDCCH, and stored or cleared as configured sidelink grant based on L1 signalling indicating configured sidelink grant activation or deactivation.\nType 1 and/or Type 2 are configured with a single BWP. Multiple configurations of up to 8 configured grants (including both Type 1 and Type 2, if configured) can be active simultaneously on the BWP.\nRRC configures the following parameters when the configured grant Type 1 is configured, as specified in TS 38.331 [5] or TS 36.331 [21]:\n-\tsl-ConfigIndexCG: the identifier of a configured grant for sidelink;\n-\tsl-CS-RNTI: SL-CS-RNTI for retransmission;\n-\tsl-NrOfHARQ-Processes: the number of HARQ processes for configured grant;\n-\tsl-PeriodCG: periodicity of the configured grant Type 1;\n-\tsl-TimeOffsetCG-Type1: Offset of a resource with respect to reference logical slot defined by sl-TimeReferenceSFN-Type1 in time domain, referring to the number of logical slots in a resource pool;\n-\tsl-TimeResourceCG-Type1: time resource location of the configured grant Type 1;\n-\tsl-CG-MaxTransNumList: the maximum number of times that a TB can be transmitted using the configured grant;\n-\tsl-HARQ-ProcID-offset: offset of HARQ process for configured grant Type 1;\n-\tsl-PRS-ResourceID: SL-PRS configuration index for configured grant Type 1;\n-\tsl-TimeReferenceSFN-Type1: SFN used for determination of the offset of a resource in time domain. If it is present, the UE uses the first logical slot of associated resource pool after the starting time of the closest SFN with the indicated number preceding the reception of the sidelink configured grant configuration Type 1 as reference logical slot. If it is absent, the indicated reference SFN is zero.\nRRC configures the following parameters when the configured grant Type 2 is configured, as specified in TS 38.331 [5]:\n-\tsl-ConfigIndexCG: the identifier of a configured grant for sidelink;\n-\tsl-CS-RNTI: SL-CS-RNTI for activation, deactivation, and retransmission;\n-\tsl-PRS-CS-RNTI: SL-PRS-CS-RNTI for activation, and deactivation;\n-\tsl-NrOfHARQ-Processes: the number of HARQ processes for configured grant;\n-\tsl-PeriodCG: periodicity of the configured grant Type 2;\n-\tsl-CG-MaxTransNumList: the maximum number of times that a TB can be transmitted using the configured grant;\n-\tsl-HARQ-ProcID-offset: offset of HARQ process for configured grant Type 2.\nUpon configuration of a configured grant Type 1, the MAC entity shall for each configured sidelink grant:\n1>\tstore the sidelink grant provided by RRC as a configured sidelink grant;\n1>\tinitialise or re-initialise the configured sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and SL-PRS transmission occasion(s) according to sl-TimeOffsetCG-Type1 and sl-TimeResourceCG-Type1, and to reoccur with sl-periodCG for transmissions of multiple MAC PDUs and SL-PRS(s) according to clause 8.1.2 of TS 38.214 [7].\nNOTE 1:\tIf the MAC entity is configured with multiple configured sidelink grants, collision among the configured sidelink grants may occur. How to handle the collision is left to UE implementation.\nAfter a sidelink grant is configured for a configured grant Type 1, the MAC entity shall consider sequentially that the first slot of the Sth sidelink grant occurs in the logical slot for which:\nCURRENT_slot = (sl-ReferenceSlotCG-Type1 + sl-TimeOffsetCG-Type1 + S × PeriodicitySL) modulo T'max\nwhere CURRENT_slot refers to current logical slot in the associated resource pool, and T'max is the number of slots that belongs to the associated resource pool as defined in clause 8 of TS 38.214[7]. sl-ReferenceSlotCG-Type1 refers to reference logical slot defined by sl-TimeReferenceSFN-Type1.\nAfter a sidelink grant is configured for a configured grant Type 2, the MAC entity shall consider sequentially that the first slot of Sth sidelink grant occurs in the logical slot for which:\nCURRENT_slot = (sl-StartSlotCG-Type2 + S × PeriodicitySL) modulo T'max\nwhere sl-StartSlotCG-Type2 refers to the logical slot of the first transmission opportunity of PSSCH or SL-PRS where the configured sidelink grant was (re)initialised.\nWhen a configured sidelink grant is released by RRC, all the corresponding configurations shall be released and all corresponding sidelink grants shall be cleared.\nThe MAC entity shall:\n1>\tif the configured sidelink grant confirmation has been triggered and not cancelled; and\n1>\tif the MAC entity has UL resources allocated for new transmission:\n2>\tinstruct the Multiplexing and Assembly procedure to generate a Sidelink Configured Grant Confirmation MAC CE as defined in clause 6.1.3.34;\n2>\tcancel the triggered configured sidelink grant confirmation.\nFor a configured grant Type 2, the MAC entity shall clear the corresponding configured sidelink grant immediately after first transmission of Sidelink Configured Grant Confirmation MAC CE triggered by the configured sidelink grant deactivation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.9\tActivation/Deactivation of SCells",
                    "description": "",
                    "summary": "",
                    "text_content": "If the MAC entity is configured with one or more SCells, the network may activate and deactivate the configured SCells. Upon configuration of an SCell, the SCell is deactivated unless the parameter sCellState is set to activated for the SCell by upper layers.\nThe configured SCell(s) is activated and deactivated by:\n-\treceiving the SCell Activation/Deactivation MAC CE described in clause 6.1.3.10;\n-\treceiving the Enhanced SCell Activation/Deactivation MAC CE described in clause 6.1.3.55;\n-\tconfiguring sCellDeactivationTimer timer per configured SCell (except the SCell configured with PUCCH, if any): the associated SCell is deactivated upon its expiry;\n-\tconfiguring sCellState per configured SCell: if configured, the associated SCell is activated upon SCell configuration;\n-\treceiving scg-State: the SCells of SCG are deactivated.\nThe MAC entity shall for each configured SCell:\n1>\tif an SCell is configured with sCellState set to activated upon SCell configuration, or an SCell Activation/Deactivation MAC CE or an Enhanced SCell Activation/Deactivation MAC CE is received activating the SCell:\n2>\tif the SCell was deactivated prior to receiving this Enhanced SCell Activation/Deactivation MAC CE and a TRS is indicated for this SCell:\n3>\tindicate to lower layers the information regarding the TRS.\n2>\tif the SCell was deactivated prior to receiving this SCell Activation/Deactivation MAC CE or this Enhanced SCell Activation/Deactivation MAC CE; or\n2>\tif the SCell is configured with sCellState set to activated upon SCell configuration:\n3>\tif firstActiveDownlinkBWP-Id is not set to dormant BWP:\n4>\tactivate the SCell according to the timing defined in TS 38.213 [6] for MAC CE activation and according to the timing defined in TS 38.133 [11] for direct SCell activation; i.e. apply normal SCell operation including:\n5>\tSRS transmissions on the SCell;\n5>\tCSI reporting for the SCell;\n5>\tPDCCH monitoring on the SCell;\n5>\tPDCCH monitoring for the SCell;\n5>\tPUCCH transmissions on the SCell, if configured.\n3>\telse (i.e. firstActiveDownlinkBWP-Id is set to dormant BWP):\n4>\tstop the bwp-InactivityTimer of this Serving Cell, if running.\n3>\tactivate the DL BWP and UL BWP indicated by firstActiveDownlinkBWP-Id and firstActiveUplinkBWP-Id respectively.\n2>\tstart or restart the sCellDeactivationTimer associated with the SCell according to the timing defined in TS 38.213 [6] for MAC CE activation and according to the timing defined in TS 38.133 [11] for direct SCell activation;\n2>\tif the active DL BWP is not the dormant BWP:\n3>\t(re-)initialize any suspended configured uplink grants of configured grant Type 1 associated with this SCell according to the stored configuration, if any, and to start in the symbol according to rules in clause 5.8.2;\n3>\ttrigger PHR according to clause 5.4.6.\n1>\telse if an SCell Activation/Deactivation MAC CE or an Enhanced SCell Activation/Deactivation MAC CE is received deactivating the SCell; or\n1>\tif the sCellDeactivationTimer associated with the activated SCell expires; or\n1>\tif the SCG associated with the activated SCell is deactivated:\n2>\tdeactivate the SCell according to the timing defined in TS 38.213 [6];\n2>\tstop the sCellDeactivationTimer associated with the SCell;\n2>\tstop the bwp-InactivityTimer associated with the SCell;\n2>\tdeactivate any active BWP associated with the SCell;\n2>\tclear any configured downlink assignment and any configured uplink grant Type 2 associated with the SCell respectively;\n2>\tclear any PUSCH resource for semi-persistent CSI reporting associated with the SCell;\n2>\tsuspend any configured uplink grant Type 1 associated with the SCell;\n2>\tflush all HARQ buffers associated with the SCell;\n2>\tcancel, if any, triggered consistent LBT failure for the SCell.\n1>\tif PDCCH on the activated SCell indicates an uplink grant or downlink assignment; or\n1>\tif PDCCH on the Serving Cell scheduling the activated SCell indicates an uplink grant or a downlink assignment for the activated SCell; or\n1>\tif a MAC PDU is transmitted in a configured uplink grant and LBT failure indication is not received from lower layers; or\n1>\tif a MAC PDU is received in a configured downlink assignment:\n2>\trestart the sCellDeactivationTimer associated with the SCell.\n1>\tif the SCell is deactivated:\n2>\tnot transmit SRS on the SCell;\n2>\tnot report CSI for the SCell;\n2>\tnot transmit on UL-SCH on the SCell;\n2>\tnot transmit on RACH on the SCell;\n2>\tnot monitor the PDCCH on the SCell;\n2>\tnot monitor the PDCCH for the SCell;\n2>\tnot transmit PUCCH on the SCell.\nWhen the measurement reporting for fast unknown SCell activation is configured by RRC, the MAC entity shall:\n1>\tif SCell Activation/Deactivation MAC CE or an Enhanced SCell Activation/Deactivation MAC CE is received activating the SCell(s):\n2>\tif SCell(s) was deactivated prior to receiving this SCell Activation/Deactivation MAC CE or this Enhanced SCell Activation/Deactivation MAC CE:\n3>\tindicate to upper layers SCell(s) activation indication.\nHARQ feedback for the MAC PDU containing SCell Activation/Deactivation MAC CE or Enhanced SCell Activation/Deactivation MAC CE shall not be impacted by PCell, PSCell and PUCCH SCell interruptions due to SCell activation/deactivation in TS 38.133 [11].\nWhen SCell is deactivated, the ongoing Random Access procedure on the SCell, if any, is aborted.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.10\tActivation/Deactivation of PDCP duplication",
                    "description": "",
                    "summary": "",
                    "text_content": "If one or more DRBs are configured with PDCP duplication, the network may activate and deactivate the PDCP duplication for all or a subset of associated RLC entities for the configured DRB(s).\nThe PDCP duplication for the configured DRB(s) is activated and deactivated by:\n-\treceiving the Duplication Activation/Deactivation MAC CE described in clause 6.1.3.11;\n-\treceiving the Duplication RLC Activation/Deactivation MAC CE described in clause 6.1.3.32;\n-\tindication by RRC.\nThe PDCP duplication for all or a subset of associated RLC entities for the configured DRB(s) is activated and deactivated by:\n-\treceiving the Duplication RLC Activation/Deactivation MAC CE described in clause 6.1.3.32;\n-\tindication by RRC.\nThe PDCP duplication for all associated RLC entities for the configured DRB(s) is activated by:\n-\treceiving an uplink grant addressed to CS-RNTI with NDI=1 for a logical channel associated with the DRB configured with survivalTimeStateSupport, described in clause 5.4.1.\nThe MAC entity shall for each DRB configured with PDCP duplication:\n1>\tif a Duplication Activation/Deactivation MAC CE is received activating the PDCP duplication of the DRB:\n2>\tindicate the activation of PDCP duplication of the DRB to upper layers.\n1>\tif a Duplication Activation/Deactivation MAC CE is received deactivating the PDCP duplication of the DRB:\n2>\tindicate the deactivation of PDCP duplication of the DRB to upper layers.\n1>\tif a Duplication RLC Activation/Deactivation MAC CE is received activating PDCP duplication for associated RLC entities of a DRB configured with PDCP duplication:\n2>\tindicate the activation of PDCP duplication for the indicated secondary RLC entity(ies) of the DRB to upper layers.\n1>\tif a Duplication RLC Activation/Deactivation MAC CE is received deactivating PDCP duplication for associated RLC entities of a DRB configured with PDCP duplication:\n2>\tindicate the deactivation of PDCP duplication for the indicated secondary RLC entity(ies) of the DRB to upper layers.\n1>\tif activation of a PDCP duplication for all configured RLC entities is triggered for the DRB as specified in clause 5.4.1:\n2>\tindicate the activation of PDCP duplication for all configured RLC entities of the DRB to upper layers.\nNOTE:\tHow to identify \"associated RLC entity\" or equivalent entity in N3C interface for a DRB configured in Multi-path U2N N3C relay is out of scope of 3GPP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.11\tMAC reconfiguration",
                    "description": "",
                    "summary": "",
                    "text_content": "When a reconfiguration of the MAC entity is requested by upper layers, the MAC entity shall:\n1>\tinitialize the corresponding HARQ entity upon addition of an SCell;\n1>\tremove the corresponding HARQ entity upon removal of an SCell;\n1>\tapply the new value for timers when the timer is (re)started;\n1>\tapply the new maximum parameter value when counters are initialized;\n1>\tapply immediately the configurations received from upper layers for other parameters.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.12\tMAC Reset",
                    "description": "",
                    "summary": "",
                    "text_content": "If a reset of the MAC entity is requested by upper layers or the reset of the MAC entity is triggered due to SCG deactivation as defined in clause 5.29, the MAC entity shall:\n1>\tif the MAC reset is not due to SCG deactivation:\n2>\tinitialize Bj for each logical channel to zero;\n1>\tinitialize SBj for each logical channel to zero if Sidelink resource allocation mode 1 is configured by RRC;\n1>\tif upper layers indicate SCG deactivation and bfd-and-RLM with value true is configured for the deactivated SCG:\n2>\tstop (if running) all timers except beamFailureDetectionTimer associated with PSCell and timeAlignmentTimers.\n1>\telse:\n2>\tstop (if running) all timers, except MBS broadcast DRX timers;\n2>\tconsider all timeAlignmentTimers, inactivePosSRS-TimeAlignmentTimer, and cg-SDT-TimeAlignmentTimer, if configured, as expired and perform the corresponding actions in clause 5.2;\n1>\tset the NDIs for all uplink HARQ processes to the value 0;\n1>\tsets the NDIs for all HARQ process IDs to the value 0 for monitoring PDCCH in Sidelink resource allocation mode 1;\n1>\tstop, if any, ongoing Random Access procedure;\n1>\tdiscard explicitly signalled contention-free Random Access Resources for 4-step RA type and 2-step RA type, if any;\n1>\tflush Msg3 buffer;\n1>\tflush MSGA buffer;\n1>\tcancel, if any, triggered Scheduling Request procedure;\n1>\tcancel, if any, triggered Buffer Status Reporting procedure;\n1>\tcancel, if any, triggered Delay Status Reporting procedure;\n1>\tcancel, if any, triggered Power Headroom Reporting procedure;\n1>\tcancel, if any, triggered consistent LBT failure;\n1>\tcancel, if any, triggered Sidelink consistent LBT failure;\n1>\tcancel, if any, triggered BFR;\n1>\tcancel, if any, triggered Sidelink Buffer Status Reporting procedure;\n1>\tcancel, if any, triggered Pre-emptive Buffer Status Reporting procedure;\n1>\tcancel, if any, triggered Timing Advance Reporting procedure;\n1>\tcancel, if any, triggered Recommended bit rate query procedure;\n1>\tcancel, if any, triggered Configured uplink grant confirmation;\n1>\tcancel, if any, triggered configured sidelink grant confirmation;\n1>\tclear, if any, configured sidelink grants;\n1>\tcancel, if any, triggered Desired Guard Symbol query;\n1>\tcancel, if any, triggered Positioning Measurement Gap Activation/Deactivation Request procedure;\n1>\tcancel, if any, triggered SDT procedure;\n1>\tcancel, if any, triggered IAB-MT Recommended Beam Indication query;\n1>\tcancel, if any, triggered Desired DL TX Power Adjustment query;\n1>\tcancel, if any, triggered Desired IAB-MT PSD range query;\n1>\tcancel, if any, triggered Case-6 Timing Request query;\n1>\tflush the soft buffers for all DL HARQ processes, except for the DL HARQ process being used for MBS broadcast;\n1>\tfor each DL HARQ process, except for the DL HARQ process being used for MBS broadcast, consider the next received transmission for a TB as the very first transmission;\n1>\trelease, if any, Temporary C-RNTI;\n1>\tclear, if any, Differential Koffset;\n1>\tif upper layers indicate SCG deactivation and bfd-and-RLM with value true is not configured; or\n1>\tif the MAC reset is not due to SCG deactivation:\n2>\treset all BFI_COUNTERs;\n1>\treset all LBT_COUNTERs.\nIf a Sidelink specific reset of the MAC entity is requested for a PC5-RRC connection by upper layers, the MAC entity shall:\n1>\tflush the soft buffers for all Sidelink processes for all TB(s) associated to the PC5-RRC connection;\n1>\tconsider all Sidelink processes for all TB(s) associated to the PC5-RRC connection as unoccupied;\n1>\tcancel, if any, triggered Scheduling Request procedure only associated to the PC5-RRC connection;\n1>\tcancel, if any, triggered Sidelink Buffer Status Reporting procedure only associated to the PC5-RRC connection;\n1>\tcancel, if any, triggered Sidelink CSI Reporting procedure associated to the PC5-RRC connection;\n1>\tcancel, if any, triggered Sidelink DRX Command MAC CE associated to the PC5-RRC connection;\n1>\tcancel, if any, triggered Sidelink IUC-Request transmission procedure associated to the PC5-RRC connection;\n1>\tcancel, if any, triggered Sidelink IUC-Information Reporting procedure associated to the PC5-RRC connection;\n1>\tstop (if running) all timers associated to the PC5-RRC connection;\n1>\treset the numConsecutiveDTX associated to the PC5-RRC connection;\n1>\tinitialize SBj for each logical channel associated to the PC5-RRC connection to zero.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.12a\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.13\tHandling of unknown, unforeseen and erroneous protocol data",
                    "description": "",
                    "summary": "",
                    "text_content": "When a MAC entity receives a MAC PDU for the MAC entity's C-RNTI, CS-RNTI, G-RNTI, G-CS-RNTI or by the configured downlink assignment, containing a Reserved LCID or eLCID value, or an LCID or eLCID value the MAC Entity does not support, the MAC entity shall at least:\n1>\tdiscard the received subPDU and any remaining subPDUs in the MAC PDU.\nWhen a MAC entity receives a MAC PDU for the MAC entity's C-RNTI or CS-RNTI, or by the configured downlink assignment, containing an LCID or eLCID value which is not configured, or an LCID or eLCID value associated with a suspended RB as specified in TS 38.331 [5], the MAC entity shall at least:\n1>\tdiscard the received subPDU.\nWhen a MAC entity receives a MAC PDU on SL-SCH containing a Reserved LCID value for broadcast or groupcast, or an LCID value which is not configured, the MAC entity shall:\n1>\tdiscard the received subPDU.\nWhen a MAC entity receives a MAC PDU on SL-SCH containing a Reserved LCID value for unicast, the MAC entity shall:\n1>\tdiscard the received subPDU and any remaining subPDUs in the MAC PDU.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.14\tHandling of measurement gaps",
                    "description": "",
                    "summary": "",
                    "text_content": "During an activated measurement gap, the MAC entity shall, on the Serving Cell(s) in the corresponding frequency range of the measurement gap configured by measGapConfig as specified in TS 38.331 [5]:\n1>\tnot perform the transmission of HARQ feedback, SR, and CSI;\n1>\tnot report SRS;\n1>\tnot transmit on UL-SCH except for Msg3 or the MSGA payload as specified in clause 5.4.2.2;\n1>\tif the ra-ResponseWindow or the ra-ContentionResolutionTimer or the msgB-ResponseWindow is running, or if there is an ongoing RACH-less LTM cell switch, or if there is an ongoing RACH-less handover in a terrestrial network:\n2>\tmonitor the PDCCH as specified in clauses 5.1.4 and 5.1.5.\n1>\telse:\n2>\tnot monitor the PDCCH;\n2>\tnot receive on DL-SCH.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.15\tBandwidth Part (BWP) operation",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.15.1\tDownlink and Uplink",
                            "text_content": "In addition to clause 12 of TS 38.213 [6], this clause specifies requirements on BWP operation.\nA Serving Cell may be configured with one or multiple BWPs, and the maximum number of BWP per Serving Cell is specified in TS 38.213 [6].\nThe BWP switching for a Serving Cell is used to activate an inactive BWP and deactivate an active BWP at a time. The BWP switching is controlled by the PDCCH indicating a downlink assignment or an uplink grant, by the bwp-InactivityTimer, by RRC signalling, or by the MAC entity itself upon initiation of Random Access procedure or upon detection of consistent LBT failure on SpCell. Upon RRC (re-)configuration of firstActiveDownlinkBWP-Id and/or firstActiveUplinkBWP-Id for SpCell except for PSCell when SCG is deactivated (see clause 5.29) or activation of an SCell, the DL BWP and/or UL BWP indicated by firstActiveDownlinkBWP-Id and/or firstActiveUplinkBWP-Id respectively (as specified in TS 38.331 [5]) is active without receiving PDCCH indicating a downlink assignment or an uplink grant. Upon RRC (re-)configuration of firstActiveDownlinkBWP-Id for PSCell when SCG is deactivated, the DL BWP is switched to the firstActiveDownlinkBWP-Id as specified in TS 38.331 [5]. The active BWP for a Serving Cell is indicated by either RRC or PDCCH (as specified in TS 38.213 [6]). For unpaired spectrum, a DL BWP is paired with a UL BWP, and BWP switching is common for both UL and DL.\nFor each SCell a dormant BWP may be configured with dormantBWP-Id by RRC signalling as described in TS 38.331 [5]. Entering or leaving dormant BWP for SCells is done by BWP switching per SCell or per dormancy SCell group based on instruction from PDCCH (as specified in TS 38.213 [6]). The dormancy SCell group configurations are configured by RRC signalling as described in TS 38.331 [5]. Upon reception of the PDCCH indicating leaving dormant BWP, the DL BWP indicated by firstOutsideActiveTimeBWP-Id or by firstWithinActiveTimeBWP-Id (as specified in TS 38.331 [5] and TS 38.213 [6]) is activated. Upon reception of the PDCCH indicating entering dormant BWP, the DL BWP indicated by dormantBWP-Id (as specified in TS 38.331 [5]) is activated. The dormant BWP configuration for SpCell or PUCCH SCell is not supported.\nBWP for SRS for positioning Tx frequency hopping can be configured for a Serving Cell in TS 38.331 [5]. BWP for SRS Tx frequency hopping is considered as activated when it is configured. BWP switching is not applicable for BWP for SRS Tx frequency hopping.\nFor each activated Serving Cell configured with a BWP, the MAC entity shall:\n1>\tif a BWP is activated and the active DL BWP for the Serving Cell is not the dormant BWP and the Serving Cell is not the PSCell of deactivated SCG:\n2>\ttransmit on UL-SCH on the BWP;\n2>\ttransmit on RACH on the BWP, if PRACH occasions are configured;\n2>\tmonitor the PDCCH on the BWP;\n2>\ttransmit PUCCH on the BWP, if configured;\n2>\treport CSI for the BWP;\n2>\ttransmit SRS on the BWP, if configured;\n2>\treceive DL-SCH on the BWP;\n2>\t(re-)initialize any suspended configured uplink grants of configured grant Type 1 on the active BWP according to the stored configuration, if any, and to start in the symbol according to rules in clause 5.8.2;\n2>\tif lbt-FailureRecoveryConfig is configured:\n3>\tstop the lbt-FailureDetectionTimer, if running;\n3>\tset LBT_COUNTER to 0;\n3>\tmonitor LBT failure indications from lower layers as specified in clause 5.21.2.\n1>\tif a BWP is activated and the active DL BWP for the Serving Cell is dormant BWP:\n2>\tstop the bwp-InactivityTimer of this Serving Cell, if running.\n2>\tnot monitor the PDCCH on the BWP;\n2>\tnot monitor the PDCCH for the BWP;\n2>\tnot receive DL-SCH on the BWP;\n2>\tnot report CSI on the BWP, report CSI except aperiodic CSI for the BWP;\n2>\tnot transmit SRS on the BWP;\n2>\tnot transmit on UL-SCH on the BWP;\n2>\tnot transmit on RACH on the BWP;\n2>\tnot transmit PUCCH on the BWP;\n2>\tclear any configured downlink assignment and any configured uplink grant Type 2 associated with the SCell respectively;\n2>\tsuspend any configured uplink grant Type 1 associated with the SCell;\n2>\tif configured, perform beam failure detection and beam failure recovery for the SCell if beam failure is detected.\n1>\tif a BWP is deactivated or the Serving Cell is PSCell of deactivated SCG:\n2>\tnot transmit on UL-SCH on the BWP;\n2>\tnot transmit on RACH on the BWP;\n2>\tnot monitor the PDCCH on the BWP;\n2>\tnot transmit PUCCH on the BWP;\n2>\tnot report CSI for the BWP;\n2>\tnot transmit SRS on the BWP;\n2>\tnot receive DL-SCH on the BWP;\n2>\tclear any configured downlink assignment and configured uplink grant of configured grant Type 2 on the BWP;\n2>\tsuspend any configured uplink grant of configured grant Type 1 on the inactive BWP.\nUpon initiation of the Random Access procedure on a Serving Cell, after the selection of carrier for performing Random Access procedure as specified in clause 5.1.1, the MAC entity shall for the selected carrier of this Serving Cell:\n1>\tif PRACH occasions are not configured for the active UL BWP:\n2>\tif the UE is an (e)RedCap UE; and\n2>\tif initialUplinkBWP-RedCap is configured:\n3>\tswitch the active UL BWP to BWP indicated by initialUplinkBWP-RedCap.\n2>\telse:\n3>\tswitch the active UL BWP to BWP indicated by initialUplinkBWP.\n2>\tif the Serving Cell is an SpCell:\n3>\tif the UE is an (e)RedCap UE; and\n3>\tif initialDownlinkBWP-RedCap is configured:\n4>\tswitch the active DL BWP to BWP indicated by initialDownlinkBWP-RedCap.\n3>\telse:\n4>\tswitch the active DL BWP to BWP indicated by initialDownlinkBWP.\n1>\telse:\n2>\tif the Serving Cell is an SpCell:\n3>\tif the active DL BWP does not have the same bwp-Id as the active UL BWP:\n4>\tswitch the active DL BWP to the DL BWP with the same bwp-Id as the active UL BWP.\n1>\tstop the bwp-InactivityTimer associated with the active DL BWP of this Serving Cell, if running.\n1>\tif the Serving Cell is SCell:\n2>\tstop the bwp-InactivityTimer associated with the active DL BWP of SpCell, if running.\n1>\tperform the Random Access procedure on the active DL BWP of SpCell and active UL BWP of this Serving Cell.\nIf the MAC entity receives a PDCCH for BWP switching of a Serving Cell, the MAC entity shall:\n1>\tif there is no ongoing Random Access procedure associated with this Serving Cell; or\n1>\tif the ongoing Random Access procedure associated with this Serving Cell is successfully completed upon reception of this PDCCH addressed to C-RNTI (as specified in clauses 5.1.4, 5.1.4a, and 5.1.5):\n2>\tcancel, if any, triggered consistent LBT failure for this Serving Cell;\n2>\tperform BWP switching to a BWP indicated by the PDCCH.\nIf the MAC entity receives a PDCCH for BWP switching for a Serving Cell(s) or a dormancy SCell group(s) while a Random Access procedure associated with that Serving Cell is ongoing in the MAC entity, it is up to UE implementation whether to switch BWP or ignore the PDCCH for BWP switching, except for the PDCCH reception for BWP switching addressed to the C-RNTI for successful Random Access procedure completion (as specified in clauses 5.1.4, 5.1.4a, and 5.1.5) in which case the UE shall perform BWP switching to a BWP indicated by the PDCCH. Upon reception of the PDCCH for BWP switching other than successful contention resolution, if the MAC entity decides to perform BWP switching, the MAC entity shall stop the ongoing Random Access procedure and initiate a Random Access procedure after performing the BWP switching; if the MAC decides to ignore the PDCCH for BWP switching, the MAC entity shall continue with the ongoing Random Access procedure on the Serving Cell.\nUpon reception of RRC (re-)configuration for BWP switching for a Serving Cell while a Random Access procedure associated with that Serving Cell is ongoing in the MAC entity, the MAC entity shall stop the ongoing Random Access procedure and initiate a Random Access procedure after performing the BWP switching.\nUpon reception of RRC (re-)configuration for BWP switching for a Serving Cell, cancel any triggered consistent LBT failure in this Serving Cell.\nThe MAC entity shall for each activated Serving Cell configured with bwp-InactivityTimer:\n1>\tif the defaultDownlinkBWP-Id is configured, and the active DL BWP is not the BWP indicated by the defaultDownlinkBWP-Id, and the active DL BWP is not the BWP indicated by the dormantBWP-Id if configured; or\n1>\tif the UE is neither a RedCap nor an eRedCap UE, and if the defaultDownlinkBWP-Id is not configured, and the active DL BWP is not the initialDownlinkBWP, and the active DL BWP is not the BWP indicated by the dormantBWP-Id if configured; or\n1>\tif the UE is an (e)RedCap UE, and if the defaultDownlinkBWP-Id is not configured, and initialDownlinkBWP-RedCap is not configured, and the active DL BWP is not the initialDownlinkBWP; or\n1>\tif the UE is an (e)RedCap UE, and if the defaultDownlinkBWP-Id is not configured, and initialDownlinkBWP-RedCap is configured, and the active DL BWP is not the initialDownlinkBWP-RedCap:\n2>\tif a PDCCH addressed to C-RNTI or CS-RNTI indicating downlink assignment or uplink grant is received on the active BWP; or\n2>\tif a PDCCH addressed to G-RNTI or G-CS-RNTI configured for multicast indicating downlink assignment is received on the active BWP; or\n2>\tif a PDCCH addressed to C-RNTI or CS-RNTI indicating downlink assignment or uplink grant is received for the active BWP; or\n2>\tif a MAC PDU is transmitted in a configured uplink grant and LBT failure indication is not received from lower layers; or\n2>\tif a MAC PDU is received in a configured downlink assignment for unicast or MBS multicast:\n3>\tif there is no ongoing Random Access procedure associated with this Serving Cell; or\n3>\tif the ongoing Random Access procedure associated with this Serving Cell is successfully completed upon reception of this PDCCH addressed to C-RNTI (as specified in clauses 5.1.4, 5.1.4a and 5.1.5):\n4>\tstart or restart the bwp-InactivityTimer associated with the active DL BWP.\n2>\tif the bwp-InactivityTimer associated with the active DL BWP expires:\n3>\tif the defaultDownlinkBWP-Id is configured:\n4>\tperform BWP switching to a BWP indicated by the defaultDownlinkBWP-Id.\n3>\telse:\n4>\tif the UE is a (e)RedCap UE; and\n4>\tif initialDownlinkBWP-RedCap is configured:\n5>\tperform BWP switching to the initialDownlinkBWP-RedCap.\n4>\telse:\n5>\tperform BWP switching to the initialDownlinkBWP.\nNOTE:\tIf a Random Access procedure is initiated on an SCell, both this SCell and the SpCell are associated with this Random Access procedure.\n1>\tif a PDCCH for BWP switching is received, and the MAC entity switches the active DL BWP:\n2>\tif the defaultDownlinkBWP-Id is configured, and the MAC entity switches to the DL BWP which is not indicated by the defaultDownlinkBWP-Id and is not indicated by the dormantBWP-Id if configured; or\n2>\tif the UE is neither a RedCap nor an eRedCap UE, and if the defaultDownlinkBWP-Id is not configured, and the MAC entity switches to the DL BWP which is not the initialDownlinkBWP and is not indicated by the dormantBWP-Id if configured; or\n2>\tif the UE is an (e)RedCap UE, and if the defaultDownlinkBWP-Id is not configured, and initialDownlinkBWP-RedCap is not configured, and the MAC entity switches to the DL BWP which is not the initialDownlinkBWP; or\n2>\tif the UE is an (e)RedCap UE, and if the defaultDownlinkBWP-Id is not configured, and initialDownlinkBWP-RedCap is configured, and the MAC entity switches to the DL BWP which is not the initialDownlinkBWP-RedCap:\n3>\tstart or restart the bwp-InactivityTimer associated with the active DL BWP.\nUpon initiation of the Random Access procedure, after selection of the carrier for performing Random Access procedure as specified in clause 5.1.1, if the UE is an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode, the MAC entity shall:\n1>\tif initialUplinkBWP-RedCap is configured for the selected carrier:\n2>\tperform the Random Access procedure as specified in clause 5.1 by using the BWP configured by initialUplinkBWP-RedCap.\n1>\telse:\n2>\tperform the Random Access procedure as specified in clause 5.1 by using the BWP configured by initialUplinkBWP.\n1>\tif initialDownlinkBWP-RedCap is configured:\n2>\tif the Random Access procedure was initiated for SI request (as specified in TS 38.331 [5]) and the Random Access Resources for SI request have been explicitly provided by RRC, and if the selected carrier is SUL carrier:\n3>\tmonitor the PDCCH on the BWP configured by initialDownlinkBWP.\n2>\telse:\n3>\tmonitor the PDCCH on the BWP configured by initialDownlinkBWP-RedCap.\n1>\telse:\n2>\tmonitor the PDCCH on the BWP configured by initialDownlinkBWP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.2\tSidelink",
                            "text_content": "In addition to clause 16 of TS 38.213 [6], this clause specifies requirements on BWP operation for sidelink.\nThe MAC entity is configured with at most a single SL BWP per sidelink carrier where sidelink transmission and reception are performed.\nFor a BWP, the MAC entity shall:\n1>\tif the BWP is activated:\n2>\ttransmit SL-BCH on the BWP, if configured;\n2>\ttransmit S-PSS and S-SSS on the BWP, if configured;\n2>\ttransmit PSCCH on the BWP;\n2>\ttransmit SL-PRS on the BWP;\n2>\ttransmit SL-SCH on the BWP;\n2>\treceive PSFCH on the BWP, if configured;\n2>\treceive S-PSS and S-SSS on the BWP, if configured;\n2>\treceive SL-BCH on the BWP, if configured;\n2>\treceive PSCCH on the BWP;\n2>\treceive SL-PRS on the BWP;\n2>\treceive SL-SCH on the BWP;\n2>\ttransmit PSFCH on the BWP, if configured;\n2>\t(re-)initialize any suspended configured sidelink grant of configured grant Type 1.\n2>\tif sl-lbt-FailureRecoveryConfig is configured:\n3>\tset SL_LBT_COUNTER to 0 for all RB sets in the SL BWP;\n3>\tmonitors SL LBT failure indications from lower layers as specified in clause 5.31.2.\n1>\tif the BWP is deactivated:\n2>\tnot transmit SL-BCH on the BWP, if configured;\n2>\tnot transmit S-PSS and S-SSS on the BWP, if configured;\n2>\tnot transmit PSCCH on the BWP;\n2>\tnot transmit SL-PRS on the BWP;\n2>\tnot transmit SL-SCH on the BWP;\n2>\tnot receive PSFCH on the BWP, if configured;\n2>\tnot receive SL-BCH on the BWP, if configured;\n2>\tnot receive S-PSS and S-SSS on the BWP, if configured;\n2>\tnot receive PSCCH on the BWP;\n2>\tnot receive SL-PRS on the BWP;\n2>\tnot receive SL-SCH on the BWP;\n2>\tnot transmit PSFCH on the BWP, if configured;\n2>\tsuspend any configured sidelink grant of configured grant Type 1;\n2>\tclear any configured sidelink grant of configured grant Type 2;\n2>\tcancel, if any, triggered Scheduling Request procedure for sidelink;\n2>\tcancel, if any, triggered Sidelink Buffer Status Reporting procedure;\n2>\tcancel, if any, triggered Sidelink CSI Reporting procedure;\n2>\tcancel, if any, triggered Sidelink DRX Command MAC CE;\n2>\tcancel, if any, triggered Sidelink IUC-Request transmission procedure;\n2>\tcancel, if any, triggered Sidelink IUC-Information Reporting procedure;\n2>\tif sl-lbt-FailureDetectionTimer is configured:\n3>\tstop the sl-lbt-FailureDetectionTimer for all RB sets in the SL BWP, if running.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.16\tSUL operation",
                    "description": "",
                    "summary": "",
                    "text_content": "The Supplementary UL (SUL) carrier can be configured as a complement to the normal UL (NUL) carrier. Switching between the NUL carrier and the SUL carrier means that the UL transmissions move from one carrier to the other carrier, which is done by:\n-\tan indication in DCI;\n-\tthe Random Access procedure as specified in clause 5.1.1;\n-\tthe SDT procedure as specified in clause 5.27.\nIf the MAC entity receives a UL grant indicating an SUL switch while a Random Access procedure is ongoing, the MAC entity shall ignore the UL grant.\nThe Serving Cell configured with supplementaryUplink belongs to a single TAG.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.17\tBeam Failure Detection and Recovery procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "The MAC entity may be configured by RRC per Serving Cell or per BFD-RS set with a beam failure recovery procedure which is used for indicating to the serving gNB of a new SSB or CSI-RS when beam failure is detected on the serving SSB(s)/CSI-RS(s). Beam failure is detected by counting beam failure instance indication from the lower layers to the MAC entity. If beamFailureRecoveryConfig is reconfigured by upper layers during an ongoing Random Access procedure for beam failure recovery for SpCell, the MAC entity shall stop the ongoing Random Access procedure and initiate a Random Access procedure using the new configuration. The Serving Cell is configured with two BFD-RS sets if and only if failureDetectionSet1 and failureDetectionSet2 are configured for the active DL BWP of the Serving Cell. When the SCG is deactivated, the UE performs beam failure detection on the PSCell if bfd-and-RLM is set to true.\nRRC configures the following parameters in the beamFailureRecoveryConfig, beamFailureRecoverySpCellConfig, beamFailureRecoverySCellConfig and the radioLinkMonitoringConfig for the Beam Failure Detection and Recovery procedure:\n-\tbeamFailureInstanceMaxCount for the beam failure detection (per Serving Cell or per BFD-RS set of Serving Cell configured with two BFD-RS sets);\n-\tbeamFailureDetectionTimer for the beam failure detection (per Serving Cell or per BFD-RS set of Serving Cell configured with two BFD-RS sets);\n-\tbeamFailureRecoveryTimer for the beam failure recovery procedure for SpCell;\n-\trsrp-ThresholdSSB: an RSRP threshold for the SpCell beam failure recovery;\n-\trsrp-ThresholdBFR: an RSRP threshold for the SCell beam failure recovery or for the beam failure recovery of BFD-RS set of Serving Cell;\n-\tpowerRampingStep: powerRampingStep for the SpCell beam failure recovery;\n-\tpowerRampingStepHighPriority: powerRampingStepHighPriority for the SpCell beam failure recovery;\n-\tpreambleReceivedTargetPower: preambleReceivedTargetPower for the SpCell beam failure recovery;\n-\tpreambleTransMax: preambleTransMax for the SpCell beam failure recovery;\n-\tscalingFactorBI: scalingFactorBI for the SpCell beam failure recovery;\n-\tssb-perRACH-Occasion: ssb-perRACH-Occasion for the SpCell beam failure recovery using contention-free Random Access Resources;\n-\tra-ResponseWindow: the time window to monitor response(s) for the SpCell beam failure recovery using contention-free Random Access Resources;\n-\tprach-ConfigurationIndex: prach-ConfigurationIndex for the SpCell beam failure recovery using contention-free Random Access Resources;\n-\tra-ssb-OccasionMaskIndex: ra-ssb-OccasionMaskIndex for the SpCell beam failure recovery using contention-free Random Access Resources;\n-\tra-OccasionList: ra-OccasionList for the SpCell beam failure recovery using contention-free Random Access Resources;\n-\tcandidateBeamRSList: list of candidate beams for SpCell beam failure recovery;\n-\tcandidateBeamRS-List-r16: list of candidate beams for SCell beam failure recovery or list of candidate beams for beam failure recovery of a Serving Cell for BFD-RS set one;\n-\tcandidateBeamRS-List2-r17: list of candidate beams for beam failure recovery of a Serving Cell for BFD-RS set two.\nThe following UE variables are used for the beam failure detection procedure:\n-\tBFI_COUNTER (per Serving Cell or per BFD-RS set of Serving Cell configured with two BFD-RS sets): counter for beam failure instance indication which is initially set to 0.\nThe MAC entity shall for each Serving Cell configured for beam failure detection:\n1>\tif the Serving Cell is configured with two BFD-RS sets:\n2>\tif beam failure instance indication for a BFD-RS set has been received from lower layers:\n3>\tstart or restart the beamFailureDetectionTimer of the BFD-RS set;\n3>\tincrement BFI_COUNTER of the BFD-RS set by 1;\n3>\tif BFI_COUNTER of the BFD-RS set >= beamFailureInstanceMaxCount:\n4>\ttrigger a BFR for this BFD-RS set of the Serving Cell;\n2>\tif BFR is triggered for both BFD-RS sets of the SpCell and the Beam Failure Recovery procedure is not successfully completed for any of the BFD-RS sets:\n3>\tinitiate a Random Access procedure (see clause 5.1) on the SpCell;\n2>\tif the Serving Cell is SpCell and the Random Access procedure initiated for beam failure recovery of both BFD-RS sets of SpCell is successfully completed (see clause 5.1):\n3>\tset BFI_COUNTER of each BFD-RS set of SpCell to 0.\n3>\tconsider the Beam Failure Recovery procedure successfully completed.\n2>\tif the beamFailureDetectionTimer of this BFD-RS set expires; or\n2>\tif beamFailureDetectionTimer, beamFailureInstanceMaxCount, or any of the reference signals used for beam failure detection is reconfigured by upper layers or by the BFD-RS Indication MAC CE associated with a BFD-RS set of the Serving Cell; or\n2>\tif the reference signal(s) associated with a BFD-RS set of the Serving Cell used for beam failure detection is changed:\n3>\tset BFI_COUNTER of the BFD-RS set to 0.\n2>\tif a PDCCH addressed to C-RNTI indicating uplink grant for a new transmission is received for the HARQ process used for the transmission of the Enhanced BFR MAC CE or Truncated Enhanced BFR MAC CE which contains beam failure recovery information of this BFD-RS set of the Serving Cell:\n3>\tset BFI_COUNTER of the BFD-RS set to 0;\n3>\tconsider the Beam Failure Recovery procedure successfully completed for this BFD-RS set and cancel all the triggered BFRs of this BFD-RS set of the Serving Cell.\n2>\tif the Serving Cell is SCell and the SCell is deactivated as specified in clause 5.9:\n3>\tset BFI_COUNTER of each BFD-RS set of SCell to 0;\n3>\tconsider the Beam Failure Recovery procedure successfully completed and cancel all the triggered BFRs of all BFD-RS sets of the Serving Cell.\n1>\telse:\n2>\tif beam failure instance indication has been received from lower layers:\n3>\tstart or restart the beamFailureDetectionTimer;\n3>\tincrement BFI_COUNTER by 1;\n3>\tif BFI_COUNTER >= beamFailureInstanceMaxCount:\n4>\tif the Serving Cell is SCell:\n5>\ttrigger a BFR for this Serving Cell;\n4>\telse if the Serving Cell is PSCell and, the SCG is deactivated:\n5>\tif beam failure of the PSCell has not been indicated to upper layers since the SCG was deactivated or since the deactivated SCG was last reconfigured with BFD-RS:\n6>\tindicate beam failure of the PSCell to upper layers.\nNOTE:\tAfter beam failure is indicated to upper layers, the UE may stop the beamFailureDetectionTimer and lower layer beam failure indication while BFI_COUNTER >= beamFailureInstanceMaxCount for the deactivated SCG.\n4>\telse:\n5>\tinitiate a Random Access procedure (see clause 5.1) on the SpCell;\n5>\tif beam failure is detected for an NCR-MT:\n6>\tindicate to NCR-Fwd to cease forwarding.\n2>\tif the beamFailureDetectionTimer expires; or\n2>\tif beamFailureDetectionTimer, beamFailureInstanceMaxCount, or any of the reference signals used for beam failure detection is reconfigured by upper layers associated with this Serving Cell; or\n2>\tif the reference signal(s) associated with this Serving Cell used for beam failure detection is changed:\n3>\tset BFI_COUNTER to 0.\n2>\tif the Serving Cell is SpCell and the Random Access procedure initiated for SpCell beam failure recovery is successfully completed (see clause 5.1):\n3>\tset BFI_COUNTER to 0;\n3>\tstop the beamFailureRecoveryTimer, if configured;\n3>\tif the Random Access procedure was triggered by beam failure recovery for NCR-MT:\n4>\tindicate to NCR-Fwd to resume forwarding using the last forwarding configuration received by NCR-MT as part of side control information before beam failure detection;\n3>\tconsider the Beam Failure Recovery procedure successfully completed.\n2>\telse if the Serving Cell is SCell, and a PDCCH addressed to C-RNTI indicating uplink grant for a new transmission is received for the HARQ process used for the transmission of the MAC CE for BFR which contains beam failure recovery information of this Serving Cell; or\n2>\tif the SCell is deactivated as specified in clause 5.9:\n3>\tset BFI_COUNTER to 0;\n3>\tconsider the Beam Failure Recovery procedure successfully completed and cancel all the triggered BFRs for this Serving Cell.\nThe MAC entity shall:\n1>\tif the Beam Failure Recovery procedure determines that at least one BFR has been triggered and not cancelled for an SCell for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed and if none of the Serving Cell(s) of this MAC entity are configured with two BFD-RS sets:\n2>\tif UL-SCH resources are available for a new transmission and if the UL-SCH resources can accommodate the BFR MAC CE plus its subheader as a result of LCP:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the BFR MAC CE.\n2>\telse if UL-SCH resources are available for a new transmission and if the UL-SCH resources can accommodate the Truncated BFR MAC CE plus its subheader as a result of LCP:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Truncated BFR MAC CE.\n2>\telse:\n3>\ttrigger the SR for SCell beam failure recovery for each SCell for which BFR has been triggered, not cancelled, and for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed.\n1>\tif the Beam Failure Recovery procedure determines that at least one BFR for any BFD-RS set has been triggered and not cancelled for an SCell for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed; or\n1>\tif the Beam Failure Recovery procedure determines that at least one BFR for only one BFD-RS set has been triggered and not cancelled for an SpCell for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed; or\n1>\tif the Beam Failure Recovery procedure determines that at least one BFR has been triggered and not cancelled for an SCell for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed and if at least one Serving Cell of this MAC entity is configured with two BFD-RS sets:\n2>\tif UL-SCH resources are available for a new transmission and if the UL-SCH resources can accommodate the Enhanced BFR MAC CE plus its subheader as a result of LCP:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Enhanced BFR MAC CE.\n2>\telse if UL-SCH resources are available for a new transmission and if the UL-SCH resources can accommodate the Truncated Enhanced BFR MAC CE plus its subheader as a result of LCP:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Truncated Enhanced BFR MAC CE.\n2>\telse:\n3>\ttrigger the SR for beam failure recovery of each BFD-RS set for which BFR has been triggered, not cancelled, and for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed;\n3>\ttrigger the SR for SCell beam failure recovery for each SCell for which BFR has been triggered, not cancelled, and for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed.\nAll BFRs triggered for an SCell shall be cancelled when a MAC PDU is transmitted and this PDU includes a MAC CE for BFR which contains beam failure information of that SCell. All BFRs triggered for a BFD-RS set of a Serving Cell shall be cancelled when a MAC PDU is transmitted and this PDU includes an Enhanced BFR MAC CE or Truncated Enhanced BFR MAC CE which contains beam failure recovery information of that BFD-RS set of the Serving Cell.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.18\tHandling of MAC CEs",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.18.1\tGeneral",
                            "text_content": "This clause specifies the requirements upon reception or transmission of the following MAC CEs:\n-\tSP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE;\n-\tAperiodic CSI Trigger State Subselection MAC CE;\n-\tTCI States Activation/Deactivation for UE-specific PDSCH MAC CE;\n-\tTCI State Indication for UE-specific PDCCH MAC CE;\n-\tSP CSI reporting on PUCCH Activation/Deactivation MAC CE;\n-\tEnhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE;\n-\tSP SRS Activation/Deactivation MAC CE;\n-\tPUCCH spatial relation Activation/Deactivation MAC CE;\n-\tEnhanced PUCCH spatial relation Activation/Deactivation MAC CE;\n-\tSP ZP CSI-RS Resource Set Activation/Deactivation MAC CE;\n-\tRecommended Bit Rate MAC CE;\n-\tEnhanced SP/AP SRS Spatial Relation Indication MAC CE;\n-\tSRS Pathloss Reference RS Update MAC CE;\n-\tPUSCH Pathloss Reference RS Update MAC CE;\n-\tServing Cell set based SRS Spatial Relation Indication MAC CE;\n-\tSP Positioning SRS Activation/Deactivation MAC CE;\n-\tTiming Delta MAC CE;\n-\tGuard Symbols MAC CEs;\n-\tPositioning Measurement Gap Activation/Deactivation Command MAC CE;\n-\tPPW Activation/Deactivation Command MAC CE;\n-\tPUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE;\n-\tPUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE;\n-\tUnified TCI States Activation/Deactivation MAC CE;\n-\tDifferential Koffset MAC CE;\n-\tCase-7 Timing advance offset MAC CE;\n-\tDL TX Power Adjustment MAC CEs;\n-\tChild IAB-DU Restricted Beam Indication MAC CE;\n-\tTiming Case Indication MAC CE;\n-\tPSI-Based SDU Discard Activation/Deactivation MAC CE;\n-\tBFD-RS Indication MAC CE;\n-\tIAB-MT Recommended Beam Indication MAC CE;\n-\tUL PSD range adjustment for IAB MAC CE;\n-\tCase-6 Timing Request MAC CE;\n-\tNCR Backhaul Link Beam Indication MAC CEs;\n-\tNCR Access Link Beam Indication MAC CE;\n-\tEnhanced Unified TCI States Activation/Deactivation MAC CE;\n-\tLTM Cell Switch Command MAC CE;\n-\tCandidate Cell TCI States Activation/Deactivation MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.2\tActivation/Deactivation of Semi-persistent CSI-RS/CSI-IM resource set",
                            "text_content": "The network may activate and deactivate the configured Semi-persistent CSI-RS/CSI-IM resource sets of a Serving Cell by sending the SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE described in clause 6.1.3.12. The configured Semi-persistent CSI-RS/CSI-IM resource sets are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.\nThe MAC entity shall:\n1>\tif the MAC entity receives an SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.3\tAperiodic CSI Trigger State Subselection",
                            "text_content": "The network may select among the configured aperiodic CSI trigger states of a Serving Cell by sending the Aperiodic CSI Trigger State Subselection MAC CE described in clause 6.1.3.13.\nThe MAC entity shall:\n1>\tif the MAC entity receives an Aperiodic CSI trigger State Subselection MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding Aperiodic CSI trigger State Subselection MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.4\tActivation/Deactivation of UE-specific PDSCH TCI state",
                            "text_content": "The network may activate and deactivate the configured TCI states for PDSCH of a Serving Cell or a set of Serving Cells configured in simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2 by sending the TCI States Activation/Deactivation for UE-specific PDSCH MAC CE described in clause 6.1.3.14. The network may activate and deactivate the configured TCI states for a codepoint of the DCI Transmission configuration indication field as specified in TS 38.212 [9] for PDSCH of a Serving Cell by sending the Enhanced TCI States Activation/Deactivation for UE-specific PDSCH MAC CE described in clause 6.1.3.24. The configured TCI states for PDSCH are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.\nThe MAC entity shall:\n1>\tif the MAC entity receives a TCI States Activation/Deactivation for UE-specific PDSCH MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the TCI States Activation/Deactivation for UE-specific PDSCH MAC CE.\n1>\tif the MAC entity receives an Enhanced TCI States Activation/Deactivation for UE-specific PDSCH MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Enhanced TCI States Activation/Deactivation for UE-specific PDSCH MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.5\tIndication of TCI state for UE-specific PDCCH",
                            "text_content": "The network may indicate a TCI state for PDCCH reception for a CORESET of a Serving Cell or a set of Serving Cells configured in simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2 by sending the TCI State Indication for UE-specific PDCCH MAC CE described in clause 6.1.3.15 or the cross-RRH TCI State Indication for UE-specific PDCCH MAC CE described in clause 6.1.3.77. The network may also indicate two TCI states for PDCCH reception for a CORESET of a Serving Cell or a set of Serving Cells configured in simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2 by sending the Enhanced TCI States Indication for UE-specific PDCCH MAC CE described in clause 6.1.3.44.\nThe MAC entity shall:\n1>\tif the MAC entity receives a TCI State Indication for UE-specific PDCCH MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the TCI State Indication for UE-specific PDCCH MAC CE.\n1>\tif the MAC entity receives an Enhanced TCI States Indication for UE-specific PDCCH MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Enhanced TCI States Indication for UE-specific PDCCH MAC CE.\n1>\tif the MAC entity receives a cross-RRH TCI State Indication for UE-specific PDCCH MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the cross-RRH TCI State Indication for UE-specific PDCCH MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.6\tActivation/Deactivation of Semi-persistent CSI reporting on PUCCH",
                            "text_content": "The network may activate and deactivate the configured Semi-persistent CSI reporting on PUCCH of a Serving Cell by sending the SP CSI reporting on PUCCH Activation/Deactivation MAC CE described in clause 6.1.3.16 or the Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE described in clause 6.1.3.80. The network may activate and deactivate at least one of the configured sub configuration of a configured Semi-Persistent CSI reporting on PUCCH of a Serving Cell by sending the Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE described in clause 6.1.3.80. For each Semi-persistent CSI reporting on PUCCH configuration configured with csi-ReportSubConfigList, the network may deactivate all configured sub configurations by sending the SP CSI reporting on PUCCH Activation/Deactivation MAC CE. The configured Semi-persistent CSI reporting on PUCCH is initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.\nThe MAC entity shall:\n1>\tif the MAC entity receives an SP CSI reporting on PUCCH Activation/Deactivation MAC CE or an Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the SP CSI reporting on PUCCH Activation/Deactivation MAC CE or the Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.7\tActivation/Deactivation of Semi-persistent SRS and Indication of spatial relation of SP/AP SRS",
                            "text_content": "The network may activate and deactivate the configured Semi-persistent SRS resource sets of a Serving Cell by sending the SP SRS Activation/Deactivation MAC CE described in clause 6.1.3.17. The network may also activate and deactivate the configured Semi-persistent SRS resource sets of a Serving Cell by sending the Enhanced SP/AP SRS Spatial Relation Indication MAC CE described in clause 6.1.3.26. The network may also activate and deactivate the configured Semi-persistent SRS resource sets of a Serving Cell by sending the SP/AP SRS TCI State Indication MAC CE described in clause 6.1.3.59. The configured Semi-persistent SRS resource sets are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync. The network may indicate the spatial relation info of SP/AP SRS resource sets of a Serving Cell by sending the Enhanced SP/AP SRS spatial relation Indication MAC CE described in clause 6.1.3.26.\nThe MAC entity shall:\n1>\tif the MAC entity receives an SP SRS Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the SP SRS Activation/Deactivation MAC CE.\n1>\tif the MAC entity receives an Enhanced SP/AP SRS Spatial Relation Indication MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Enhanced SP/AP SRS Spatial Relation Indication MAC CE.\n1>\tif the MAC entity receives an SP/AP SRS TCI State Indication MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the SP/AP SRS TCI State Indication MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.8\tActivation/Deactivation of spatial relation of PUCCH resource",
                            "text_content": "The network may activate and deactivate a spatial relation for a PUCCH resource of a Serving Cell by sending the PUCCH spatial relation Activation/Deactivation MAC CE described in clause 6.1.3.18. The network may also activate and deactivate a spatial relation for a PUCCH resource or a PUCCH resource group of a Serving Cell by sending the Enhanced PUCCH spatial relation Activation/Deactivation MAC CE described in clause 6.1.3.25. The configured spatial relation for a PUCCH resource is initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync. The network may also activate and deactivate the two spatial relations for a PUCCH resource or a PUCCH resource group of a Serving Cell by sending the PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE described in clause 6.1.3.45.\nThe MAC entity shall:\n1>\tif the MAC entity receives a PUCCH spatial relation Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the PUCCH spatial relation Activation/Deactivation MAC CE.\n1>\tif the MAC entity receives an Enhanced PUCCH spatial relation Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Enhanced PUCCH spatial relation Activation/Deactivation MAC CE.\n1>\tif the MAC entity receives a PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.9\tActivation/Deactivation of semi-persistent ZP CSI-RS resource set",
                            "text_content": "The network may activate and deactivate the configured Semi-persistent ZP CSI-RS resource set of a Serving Cell by sending the SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE described in clause 6.1.3.19. The configured Semi-persistent ZP CSI-RS resource sets are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.\nThe MAC entity shall:\n1>\tif the MAC entity receives an SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.10\tRecommended Bit Rate",
                            "text_content": "The recommended bit rate procedure is used to provide the MAC entity with information about the bit rate which the gNB recommends. The bit rate is the recommended bit rate of the physical layer. Averaging window of default value 2000 ms will apply as specified in TS 26.114 [13].\nThe gNB may transmit the Recommended bit rate MAC CE to the MAC entity to indicate the recommended bit rate for the UE for a specific logical channel and a specific direction (either uplink or downlink). Upon reception of a Recommended bit rate MAC CE the MAC entity shall:\n-\tindicate to upper layers the recommended bit rate for the indicated logical channel and direction.\nThe MAC entity may request the gNB to indicate the recommended bit rate for a specific logical channel and a specific direction. If the MAC entity is requested by upper layers to query the gNB for the recommended bit rate for a logical channel and for a direction (i.e. for uplink or downlink), the MAC entity shall:\n1>\tif a Recommended bit rate query for this logical channel and this direction has not been triggered:\n2>\ttrigger a Recommended bit rate query for this logical channel, direction, and desired bit rate.\nIf the MAC entity has UL resources allocated for new transmission the MAC entity shall:\n1>\tfor each Recommended bit rate query that the Recommended Bit Rate procedure determines has been triggered and not cancelled:\n2>\tif bitRateQueryProhibitTimer for the logical channel and the direction of this Recommended bit rate query is configured, and it is not running; and\n2>\tif the MAC entity has UL resources allocated for new transmission and the allocated UL resources can accommodate a Recommended bit rate MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Recommended bit rate MAC CE for the logical channel and the direction of this Recommended bit rate query;\n3>\tstart the bitRateQueryProhibitTimer for the logical channel and the direction of this Recommended bit rate query;\n3>\tcancel this Recommended bit rate query.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.11\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.12\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.13\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.14\tUpdate of Pathloss Reference RS of SRS",
                            "text_content": "The network may activate and update a pathloss reference RS for an SRS resource of a Serving Cell by sending the SRS Pathloss Reference RS Update MAC CE described in clause 6.1.3.27.\nThe MAC entity shall:\n1>\tif the MAC entity receives an SRS Pathloss Reference RS Update MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the SRS Pathloss Reference RS Update MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.15\tUpdate of Pathloss Reference RS of PUSCH",
                            "text_content": "The network may activate and update a pathloss reference RS for PUSCH of a Serving Cell by sending the PUSCH Pathloss Reference RS Update MAC CE described in clause 6.1.3.28.\nThe MAC entity shall:\n1>\tif the MAC entity receives a PUSCH Pathloss Reference RS Update MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the PUSCH Pathloss Reference RS Update MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.16\tIndication of spatial relation of SRS resource for a Serving Cell set",
                            "text_content": "The network may indicate the spatial relation info of SRS resource of a set of Serving Cells configured in simultaneousSpatial-UpdatedList1 or simultaneousSpatial-UpdatedList2 by sending the Serving Cell set based SRS Spatial Relation Indication MAC CE and the Serving Cell Set based SRS TCI State Indication MAC CE described in clause 6.1.3.29 and 6.1.3.60, respectively.\nThe MAC entity shall:\n1>\tif the MAC entity receives a Serving Cell set based SRS Spatial Relation Indication MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Serving Cell set based SRS Spatial Relation Indication MAC CE.\n1>\tif the MAC entity receives a Serving Cell Set based SRS TCI State Indication MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Serving Cell Set based SRS TCI State Indication MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.17\tActivation/Deactivation of Semi-Persistent Positioning SRS",
                            "text_content": "The network may activate and deactivate the configured resource sets of Semi-Persistent Positioning SRS of a Serving Cell by sending the SP Positioning SRS Activation/Deactivation MAC CE described in clause 6.1.3.36. The configured resource sets Semi-Persistent Positioning SRS are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.\nThe MAC entity shall:\n1>\tif the MAC entity receives an SP Positioning SRS Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the SP Positioning SRS Activation/Deactivation MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.18\tTiming offset adjustments for IAB",
                            "text_content": "For IAB operation, in order to achieve time-domain synchronization across multiple backhaul hops, a timing adjustment may be provided to an IAB node by its parent node. Two different values may be provided, related to Case-1/Case-6, and Case-7 timing modes respectively. The Timing Delta MAC CE carries Tdelta which is used to determine the IAB-DU DL Tx timing adjustment for the Case-1 timing mode, and to determine the IAB-DU DL Tx and IAB-MT UL Tx timing adjustment for the Case-6 timing mode. The Case-7 Timing advance offset MAC CE carries Toffset,2 which is used to determine the IAB-MT UL Tx timing adjustment for the Case-7 timing mode.\nUpon reception of a Timing Delta MAC CE the IAB node shall:\n-\tapply the value of Tdelta as specified in TS 38.213 [6].\nUpon reception of a Case-7 Timing advance offset MAC CE the IAB node shall:\n-\tapply the value of Toffset,2 as specified in TS 38.213 [6].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.19\tGuard symbols for IAB",
                            "text_content": "For IAB operation, the MAC entity on the IAB-DU or IAB-donor-DU reserves a sufficient number of symbols at the beginning and/or the end of slots where the child IAB-node switches operation from its IAB-DU to its IAB-MT function and operation from its IAB-MT to its IAB-DU function. The MAC entity on the IAB-DU or IAB-donor-DU informs the child node about the number of guard symbols it provides via the Provided Guard Symbols MAC CE. The IAB-MT on the child node may inform the parent IAB-DU or IAB-donor-DU about the number of guard symbols desired via the Desired Guard Symbols MAC CE. IAB-MT transmission timing modes are specified in clause 14 of TS 38.213 [6].\nUpon reception of a Provided Guard Symbols MAC CE the MAC entity shall:\n-\tindicate to lower layers the number of provided guard symbols and the SCS configuration for the indicated Serving Cell.\nThe MAC entity may:\n1>\tif a Desired Guard Symbol query has not been triggered:\n2>\ttrigger a Desired Guard Symbol query for this Serving Cell.\nIf the MAC entity has UL resources allocated for new transmission the MAC entity shall:\n1>\tfor each Desired Guard Symbol query that has been triggered and not cancelled:\n2>\tif the allocated UL resources can accommodate a Desired Guard Symbols MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Desired Guard Symbols MAC CE;\n3>\tcancel this Desired Guard Symbol query.\nFor Case-1 timing mode, a separate value for the number of guard symbols is specified for each of the following eight switching scenarios (see Table 5.18.19-1).\nTable 5.18.19-1: Switching scenarios and relevant guard symbols for Case-1 timing mode\n\nFor Case-6 and Case-7 timing modes, a separate value for the number of guard symbols is specified for each of the following eight switching scenarios (see Table 5.18.19-2):\nTable 5.18.19-2: Switching scenarios and relevant guard symbols for Case-6 and Case-7 timing modes\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.18.19-1: Switching scenarios and relevant guard symbols for Case-1 timing mode",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.18.19-2: Switching scenarios and relevant guard symbols for Case-6 and Case-7 timing modes",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.18.20\tPositioning Measurement Gap Activation/Deactivation Command",
                            "text_content": "If the UE is configured with pre-configured measurement gaps, the network may send DL MAC CE for Positioning Measurement Gap Activation/Deactivation Command to the UE as in clause 6.1.3.41. For the activated measurement gap, the UE shall follow the specified UE behaviour in clause 5.14.\nUpon the reception of the MAC CE for Positioning Measurement Gap Activation/Deactivation Command, the MAC entity shall:\n1>\tif the Measurement Gap Activation/Deactivation Command MAC CE indicates the deactivation of a pre-configured positioning measurement gap:\n2>\tdeactivate the positioning measurement gap.\n1>\telse if the Positioning Measurement Gap Activation/Deactivation Command MAC CE indicates the activation of a pre-configured measurement gap:\n2>\tactivate the positioning measurement gap and perform the procedure specified in clause 5.14.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.21\tPPW Activation/Deactivation Command",
                            "text_content": "If the UE is configured with pre-configured PPW, the network may send DL MAC CE for PPW Activation/Deactivation Command to the UE as in clause 6.1.3.42. For the activated PPW, the UE shall follow the specified UE behaviour in clause 5.24.\nUpon activation of DL BWP, the PPW(s) configured for that BWP are considered deactivated. Upon reconfiguration of PPW(s) of the active DL BWP, all the PPW(s) for that BWP are considered deactivated.\nUpon the reception of the MAC CE for PPW Activation/Deactivation Command, the MAC entity shall:\n1>\tif the DL MAC CE for PPW Activation/Deactivation Command indicates the deactivation of a pre-configured PPW:\n2>\tdeactivate the PPW.\n1>\telse if the DL MAC CE for PPW Activation/Deactivation Command indicates the activation of a pre-configured PPW:\n2>\tactivate the PPW according to the procedure specified in clause 5.24.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.22\tUpdate of PUCCH Power Control Set for multiple TRP PUCCH repetition",
                            "text_content": "The network may activate and deactivate PUCCH power control set(s) for multiple TRP PUCCH repetition for a PUCCH resource or a PUCCH resource group of a Serving Cell by sending the PUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE described in clause 6.1.3.46.\nThe MAC entity shall:\n1>\tif the MAC entity receives a PUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the PUCCH power control set update for multiple TRP PUCCH repetition MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.23\tUnified TCI States Activation/Deactivation MAC CE",
                            "text_content": "The network may activate and deactivate the configured unified TCI states of a Serving Cell or a set of Serving Cells configured in simultaneousU-TCI-UpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4 by sending the Unified TCI States Activation/Deactivation MAC CE described in clause 6.1.3.47. The configured unified TCI states are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.\nThe MAC entity shall:\n1>\tif the MAC entity receives a Unified TCI States Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Unified TCI States Activation/Deactivation MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.24\tUpdate of Differential Koffset",
                            "text_content": "The network may provide and update the Differential Koffset of a Serving Cell in a non-terrestrial network by sending the Differential Koffset MAC CE described in clause 6.1.3.57.\nThe MAC entity shall:\n1>\tif the MAC entity receives a Differential Koffset MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Differential Koffset MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.25\tBFD-RS Indication MAC CE",
                            "text_content": "The network may activate and deactivate the configured beam failure detection resources of a Serving Cell by sending the BFD-RS indication MAC CE described in clause 6.1.3.58.\nThe MAC entity shall:\n1>\tif the MAC entity receives a BFD-RS indication MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the BFD-RS Indication MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.26\tRestricted and recommended beam indication for IAB",
                            "text_content": "Child IAB-DU Restricted Beam Indication MAC CE is used by an IAB-node to indicate to its child node spatial resources and associated frequency information where simultaneous transmission/reception from the IAB-MT and transmission from the IAB-DU cells is restricted. IAB-MT Recommended Beam Indication MAC CE is used by an IAB-node to indicate to its parent node recommendations for such a restriction. Time resources where these restrictions/recommendations can apply are indicated via RRC, while the MAC CE further selects from these time resources the specific time resource configuration (comprising a list of slot indices) to which information provided in the MAC CE applies.\nUpon reception of a Child IAB-DU Restricted Beam Indication MAC CE the IAB-node shall:\n-\tapply the configuration signalled in the MAC CE to the time slots indicated in IAB-ResourceConfig (as specified in TS 38.331 [5]) which contains iab-ResourceConfigID parameter which matches the Resource Configuration ID field of the MAC CE.\nThe MAC entity may:\n1>\tif an IAB-MT Recommended Beam Indication query has not been triggered:\n2>\ttrigger an IAB-MT Recommended Beam Indication query for this Serving Cell.\nIf the MAC entity has UL resources allocated for new transmission the MAC entity shall:\n1>\tfor each IAB-MT Recommended Beam Indication query that has been triggered and not cancelled:\n2>\tif the allocated UL resources can accommodate a IAB-MT Recommended Beam Indication MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the IAB-MT Recommended Beam Indication MAC CE;\n3>\tcancel this IAB-MT Recommended Beam Indication query.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.27\tDL TX power adjustment for IAB",
                            "text_content": "DL TX Power Adjustment MAC CE is used by an IAB-node to indicate to its child node spatial resources and associated frequency information where the DL TX power adjustment contained in the MAC CE applies. Desired DL TX Power Adjustment MAC CE is used by an IAB-node to indicate to its parent node recommendations for such a restriction. Time resources where these restrictions/recommendations can apply are indicated via RRC, while the MAC CE further selects from these time resources the specific time resource configuration (comprising a list of slot indices) to which information provided in the MAC CE applies.\nUpon reception of a DL TX Power Adjustment MAC CE the IAB-node shall:\n-\tapply the configuration signalled in the MAC CE to the time slots indicated in IAB-ResourceConfig (as specified in TS 38.331 [5]) which contains iab-ResourceConfigID parameter which matches the Resource Configuration ID field of the MAC CE.\nThe MAC entity may:\n1>\tif a Desired DL TX Power Adjustment query has not been triggered:\n2>\ttrigger a Desired DL TX Power Adjustment query for this Serving Cell.\nIf the MAC entity has UL resources allocated for new transmission the MAC entity shall:\n1>\tfor each Desired DL TX Power Adjustment query that has been triggered and not cancelled:\n2>\tif the allocated UL resources can accommodate a Desired DL TX Power Adjustment MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Desired DL TX Power Adjustment MAC CE;\n3>\tcancel this Desired DL TX Power Adjustment query.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.28\tUL PSD range adjustment for IAB",
                            "text_content": "Desired IAB-MT PSD range MAC CE is used by an IAB-node to indicate to its parent node a recommendation of spatial resources and associated frequency information where the desired PSD range, contained in the MAC CE (and provided to help with the node's UL TX power control) could apply. Time resources where these recommendations can apply are indicated via RRC, while the MAC CE further selects from these time resources the specific time resource configuration (comprising a list of slot indices) to which information provided in the MAC CE applies.\nThe MAC entity may:\n1>\tif a Desired IAB-MT PSD range query has not been triggered:\n2>\ttrigger a Desired IAB-MT PSD range query for this Serving Cell.\nIf the MAC entity has UL resources allocated for new transmission the MAC entity shall:\n1>\tfor each Desired IAB-MT PSD range query that has been triggered and not cancelled:\n2>\tif the allocated UL resources can accommodate a Desired IAB-MT PSD range MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Desired IAB-MT PSD range MAC CE;\n3>\tcancel this Desired IAB-MT PSD range query.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.29\tTiming case indication for IAB",
                            "text_content": "Timing Case Indication MAC CE is used by an IAB-node to indicate to its child node timing modes which should apply to time resources indicated via RRC.\nUpon reception of a Timing Case Indication MAC CE the IAB-node shall:\n-\tapply the configuration signalled in the MAC CE to the time slots indicated in IAB-ResourceConfig which contains iab-ResourceConfigID parameter (as specified in TS 38.331 [5]) which matches the Resource Configuration ID field of the MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.30\tCase-6 Timing Request",
                            "text_content": "The Case-6 Timing Request MAC CE is used by the IAB-MT to inform its parent node whether Case-6 timing is required for simultaneous operation.\nThe MAC entity may:\n1>\tif a Case-6 Timing Request query has not been triggered:\n2>\ttrigger a Case-6 Timing Request query for this Serving Cell.\nIf the MAC entity has UL resources allocated for new transmission the MAC entity shall:\n1>\tfor each Case-6 Timing Request query that has been triggered and not cancelled:\n2>\tif the allocated UL resources can accommodate a Case-6 Timing Request MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Case-6 Timing Request MAC CE;\n3>\tcancel this Case-6 Timing Request range query.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.31\tBackhaul Link Beam Indication for NCR",
                            "text_content": "NCR Downlink Backhaul Link Beam Indication MAC CE and NCR Uplink Backhaul Link Beam Indication MAC CE are used by a gNB to indicate to an NCR-node the beam to be used for the downlink and uplink backhaul transmission respectively between the gNB and the NCR-node.\nUpon reception of an NCR Downlink Backhaul Link Beam Indication MAC CE, the NCR-node shall:\n-\tindicate to NCR-Fwd to apply the configuration contained in NCR Downlink Backhaul Link Beam Indication MAC CE as received by the NCR-MT.\nUpon reception of an NCR Uplink Backhaul Link Beam Indication MAC CE, the NCR-node shall:\n-\tindicate to NCR-Fwd to apply the configuration contained in the NCR Uplink Backhaul Link Beam Indication MAC CE as received by the NCR-MT.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.32\tAccess Link Beam Indication for NCR",
                            "text_content": "NCR Access Link Beam Indication MAC CE is used by a gNB to indicate to an NCR-node the forwarding resources to be used for the semi-persistent access link transmission between the NCR-node and the UE(s) served by this device.\nUpon reception of an NCR Access Link Beam Indication MAC CE, the NCR-node shall:\n-\tapply the configuration signalled in the MAC CE as received by NCR-MT to the forwarding resource lists indicated via RRC, and use it to operate the NCR-Fwd.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.33\tEnhanced Unified TCI States Activation/Deactivation MAC CE",
                            "text_content": "The network may activate and deactivate the configured unified TCI states of a Serving Cell or a set of Serving Cells configured in simultaneousU-TCI-UpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4 by sending the Enhanced Unified TCI States Activation/Deactivation MAC CE described in clause 6.1.3.70 and 6.1.3.71. The configured unified TCI states are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.\nThe MAC entity shall:\n1>\tif the MAC entity receives an Enhanced Unified TCI States Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Enhanced Unified TCI States Activation/Deactivation MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.34\tActivation/deactivation of PSI-based SDU discard",
                            "text_content": "The network activates and deactivates PSI-based SDU discard by sending the PSI-Based SDU Discard Activation/Deactivation MAC CE described in clause 6.1.3.73. The PSI-based SDU discard is initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.\nThe MAC entity shall for each DRB configured with PSI-based SDU discard:\n1>\tif a PSI-Based SDU Discard Activation/Deactivation MAC CE is received activating the PSI-based SDU discard for the DRB:\n2>\tindicate the activation of the PSI-based SDU discard for the DRB to upper-layers.\n1>\tif a PSI-Based SDU Discard Activation/Deactivation MAC CE is received deactivating the PSI-based SDU discard for the DRB:\n2>\tindicate the deactivation of the PSI-based SDU discard for the DRB to upper-layers.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.35\tLTM Cell Switch Command",
                            "text_content": "The network may instruct the UE to perform LTM cell switch procedure by sending the LTM Cell Switch Command MAC CE described in clause 6.1.3.75.\nThe MAC entity shall:\n1>\tif the MAC entity receives an LTM Cell Switch Command MAC CE on a Serving Cell:\n2>\tindicate to upper layers that the LTM cell switch procedure is triggered and the Target Configuration ID included in the MAC CE;\n2>\tif the MAC reset operation as specified in clause 5.12 is performed, as requested by upper layers:\n3>\tif Timing Advance Command value (hexa-decimal) is not set as FFF:\n4>\tprocess the received Timing Advance Command (see clause 5.2);\n4>\tconsider the RACH-less LTM cell switch to be ongoing;\n4>\tif the MAC entity is associated with SCG:\n5>\tindicate to upper layers to skip the Random Access procedure for this LTM cell switch.\n3>\telse if the Timing Advance measurement is configured as specified in TS 38.331 [5] and the UE has successfully measured the Timing Advance for the indicated LTM target:\n4>\tprocess the measured Timing Advance (see clause 5.2);\n4>\tconsider the RACH-less LTM cell switch to be ongoing.\n4>\tif the MAC entity is associated with SCG:\n5>\tindicate to upper layers to skip the Random Access procedure for this LTM cell switch.\n3>\tif TCI state information is included:\n4>\tconsider the SSB corresponding to the indicated TCI state as the one used for configured uplink grant selection for the initial uplink transmission towards the candidate cell for RACH-less LTM cell switch (as in clause 5.8.2);\n4>\tindicate to lower layers the information regarding the TCI state information included in the LTM Cell Switch Command MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.36\tCandidate Cell TCI States Activation/Deactivation",
                            "text_content": "The network may activate and deactivate the TCI states of LTM candidate cell(s) configured in CandidateTCI-State and CandidateTCI-UL-State by sending the Candidate Cell TCI States Activation/Deactivation MAC CE described in clause 6.1.3.76.\nThe MAC entity shall:\n1>\tif the MAC entity receives a Candidate Cell TCI States Activation/Deactivation MAC CE on a Serving Cell:\n2>\tindicate to lower layers the information regarding the Candidate Cell TCI States Activation/Deactivation MAC CE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.19\tData inactivity monitoring",
                    "description": "",
                    "summary": "",
                    "text_content": "The UE may be configured by RRC with a Data inactivity monitoring functionality, when in RRC_CONNECTED. RRC controls Data inactivity operation by configuring the timer dataInactivityTimer.\nWhen dataInactivityTimer is configured, the UE shall:\n1>\tif any MAC entity receives a MAC SDU for DTCH logical channel, DCCH logical channel, or CCCH logical channel, or multicast MTCH logical channel; or\n1>\tif any MAC entity transmits a MAC SDU for DTCH logical channel, or DCCH logical channel:\n2>\tstart or restart dataInactivityTimer.\n1>\tif the dataInactivityTimer expires:\n2>\tindicate the expiry of the dataInactivityTimer to upper layers.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.20\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.21\tLBT operation",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.21.1\tGeneral",
                            "text_content": "The lower layer may perform an LBT procedure, see TS 37.213 [18], according to which a transmission is not performed by lower layers if the channel is identified as being occupied. When lower layer performs an LBT procedure before a transmission and the transmission is not performed, an LBT failure indication is sent to the MAC entity from lower layers. Unless otherwise specified, when LBT procedure is performed for a transmission, actions as specified in this specification are performed regardless of if an LBT failure indication is received from lower layers. When LBT is not performed by the lower layers, LBT failure indication is not received from lower layers.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.21.2\tLBT failure detection and recovery procedure",
                            "text_content": "The MAC entity may be configured by RRC with a consistent LBT failure recovery procedure. Consistent LBT failure is detected per UL BWP by counting LBT failure indications, for all UL transmissions, from the lower layers to the MAC entity.\nRRC configures the following parameters in the lbt-FailureRecoveryConfig:\n-\tlbt-FailureInstanceMaxCount for the consistent LBT failure detection;\n-\tlbt-FailureDetectionTimer for the consistent LBT failure detection;\nThe following UE variable is used for the consistent LBT failure detection procedure:\n-\tLBT_COUNTER (per Serving Cell): counter for LBT failure indication which is initially set to 0.\nFor each activated Serving Cell configured with lbt-FailureRecoveryConfig, the MAC entity shall:\n1>\tif LBT failure indication has been received from lower layers:\n2>\tstart or restart the lbt-FailureDetectionTimer;\n2>\tincrement LBT_COUNTER by 1;\n2>\tif LBT_COUNTER >= lbt-FailureInstanceMaxCount:\n3>\ttrigger consistent LBT failure for the active UL BWP in this Serving Cell;\n3>\tif this Serving Cell is the SpCell:\n4>\tif consistent LBT failure has been triggered in all UL BWPs configured with PRACH occasions on same carrier in this Serving Cell:\n5>\tindicate consistent LBT failure to upper layers.\n4>\telse:\n5>\tstop any ongoing Random Access procedure in this Serving Cell;\n5>\tswitch the active UL BWP to a UL BWP, on same carrier in this Serving Cell, configured with PRACH occasion and for which consistent LBT failure has not been triggered;\n5>\tinitiate a Random Access Procedure (as specified in clause 5.1.1).\n1>\tif all triggered consistent LBT failures are cancelled in this Serving Cell; or\n1>\tif the lbt-FailureDetectionTimer expires; or\n1>\tif lbt-FailureDetectionTimer or lbt-FailureInstanceMaxCount is reconfigured by upper layers:\n2>\tset LBT_COUNTER to 0.\nThe MAC entity shall:\n1>\tif consistent LBT failure has been triggered, and not cancelled, in the SpCell; and\n1>\tif UL-SCH resources are available for a new transmission in the SpCell and these UL-SCH resources can accommodate the LBT failure MAC CE plus its subheader as a result of logical channel prioritization:\n2>\tinstruct the Multiplexing and Assembly procedure to generate the LBT failure MAC CE.\n1>\telse if consistent LBT failure has been triggered, and not cancelled, in at least one SCell:\n2>\tif UL-SCH resources are available for a new transmission in a Serving Cell for which consistent LBT failure has not been triggered and these UL-SCH resources can accommodate the LBT failure MAC CE plus its subheader as a result of logical channel prioritization:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the LBT failure MAC CE.\n2>\telse:\n3>\ttrigger a Scheduling Request for LBT failure MAC CE.\n1>\tif a MAC PDU is transmitted and LBT failure indication is not received from lower layers and this PDU includes the LBT failure MAC CE:\n2>\tcancel all the triggered consistent LBT failure(s) in SCell(s) for which consistent LBT failure was indicated in the transmitted LBT failure MAC CE.\n1>\tif consistent LBT failure is triggered and not cancelled in the SpCell; and\n1>\tif the Random Access procedure is considered successfully completed (see clause 5.1) in the SpCell:\n2>\tcancel all the triggered consistent LBT failure(s) in the SpCell.\n1>\tif lbt-FailureRecoveryConfig is reconfigured by upper layers for a Serving Cell:\n2>\tcancel all the triggered consistent LBT failure(s) in this Serving Cell.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.22\tSL-SCH Data transfer and SL-PRS transmission",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.22.1\tSL-SCH Data and SL-PRS transmission",
                            "text_content": "Sidelink grant is received dynamically on the PDCCH, configured semi-persistently by RRC or autonomously selected by the MAC entity. The MAC entity may have a sidelink grant on an active SL BWP to determine a set of PSCCH duration(s) in which transmission of SCI occurs and a set of PSSCH duration(s) in which transmission of SL-SCH associated with the SCI occurs. The MAC entity may have a sidelink grant on the SL-PRS shared resource pool of an active BWP to determine a set of PSCCH durations(s) in which transmission of SCI occurs and a set of SL-PRS transmission occasion(s) and PSSCH duration(s) in which transmission of SL-PRS and SL-SCH associated with the SCI occur. The MAC entity may have a sidelink grant on the SL-PRS dedicated resource pool of an active BWP to determine a set of PSCCH duration(s) in which transmission of SCI occurs and a set of SL-PRS transmission occasion(s) in which transmission of SL-PRS associated to the SCI occurs. A sidelink grant addressed to SL-CS-RNTI with NDI = 1 is considered as a dynamic sidelink grant. A sidelink grant addressed to SL-PRS-CS-RNTI with Activation/Release indication = 1 as in clause 7.3.1.4.3 in TS 38.212 [9] is considered as a dynamic sidelink grant.\nIf the MAC entity has been configured with Sidelink resource allocation mode 1 as indicated in TS 38.331 [5] or if the MAC entity has been configured with Sidelink resource allocation scheme 1 as indicated in TS 38.331 [5] and PDCCH is received for resource allocation on SL-PRS shared resource pool, the MAC entity shall for each PDCCH occasion and for each grant received for this PDCCH occasion:\n1>\tif a sidelink grant has been received on the PDCCH for the MAC entity's SL-RNTI:\n2>\tif the NDI received on the PDCCH has not been toggled compared to the value in the previously received HARQ information for the HARQ Process ID:\n3>\tuse the received sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and SL-PRS transmission occasion(s), if available, for one or more retransmissions of a single MAC PDU for the corresponding Sidelink process according to clause 8.1.2 of TS 38.214 [7] and SL-PRS according to clause 8.1.4 of TS 38.214 [7].\n2>\telse:\n3>\tuse the received sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and SL-PRS transmission occasion(s), if available, for initial transmission and, if available, retransmission(s) of a single MAC PDU and SL-PRS according to clause 8.1.2 of TS 38.214 [7].\nNOTE 0:\tWhen SL-PRS is transmitted on SL-PRS shared resource pool, the PSSCH duration(s) and SL-PRS transmission occasion(s) are determined only after the LCP procedure in clause 5.22.1.4.1.\n1>\telse if a sidelink grant has been received on the PDCCH for the MAC entity's SL-CS-RNTI:\n2>\tif PDCCH contents indicate retransmission(s) for the identified HARQ process ID that has been set for an activated configured sidelink grant identified by sl-ConfigIndexCG:\n3>\tuse the received sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and SL-PRS transmission occasion(s), if available, for one or more retransmissions of a single MAC PDU and SL-PRS according to clause 8.1.2 of TS 38.214 [7].\n2>\telse if PDCCH contents indicate configured grant Type 2 deactivation for a configured sidelink grant:\n3>\ttrigger configured sidelink grant confirmation for the configured sidelink grant.\n2>\telse if PDCCH contents indicate configured grant Type 2 activation for a configured sidelink grant:\n3>\ttrigger configured sidelink grant confirmation for the configured sidelink grant;\n3>\tstore the configured sidelink grant;\n3>\tinitialise or re-initialise the configured sidelink grant to determine the set of PSCCH durations and the set of PSSCH durations for transmissions of multiple MAC PDUs according to clause 8.1.2 of TS 38.214 [7] and the set of SL-PRS transmission occasions for transmission of multiple SL-PRS according to clause of 8.2.4 of TS 38.214 [7], if available.\n1>\tif a dynamic sidelink grant is available for retransmission(s) of a MAC PDU which has been positively acknowledged as specified in clause 5.22.1.3.1a:\n2>\tclear the PSCCH duration(s) and PSSCH duration(s) corresponding to retransmission(s) of the MAC PDU from the sidelink grant.\nIf the MAC entity has been configured with Sidelink resource allocation scheme 1 as in TS 38.331 [5] and PDCCH is received for resource allocation on SL-PRS dedicated resource pool, the MAC entity shall for each PDCCH occasion:\n1>\tif a sidelink grant has been received on the PDCCH for the MAC entity's SL-PRS-RNTI: (i.e., dynamic grant)\n2>\tuse the received sidelink grant to determine the PSCCH duration(s) and the corresponding SL-PRS occasion(s) for the transmission of SL-PRS.\n1>\telse if a sidelink grant has been received on the PDCCH for MAC entity's SL-PRS-CS-RNTI: (i.e., configured sidelink grant type 2)\n2>\tif the PDCCH content indicates the configured grant Type 2 activation for a configured sidelink grant:\n3>\tstore the configured sidelink grant;\n3>\ttrigger configured grant confirmation for the configured sidelink grant;\n3>\tinitialise or re-initialise the configured sidelink grant to determine the set of PSCCH duration(s) and the corresponding SL-PRS occasion for the transmission of SL-PRS.\n2>\telse if the PDCCH content indicates the configured Type 2 deactivation for a configured sidelink grant:\n3>\ttrigger configured grant confirmation for the configured sidelink grant.\nIf the MAC entity has been configured with Sidelink resource allocation mode 2 to transmit or Sidelink resource allocation scheme 2 using pool(s) of resources in one or multiple carriers as indicated in TS 38.331 [5] or TS 36.331 [21] based on full sensing, or partial sensing, or random selection or any combination(s), the MAC entity shall for each Sidelink process:\nNOTE 0A:\tFor SL-PRS transmission by Sidelink resource allocation scheme 2 on SL-PRS dedicated resource pool, partial sensing is not supported.\nNOTE 1:\tIf the MAC entity is configured with Sidelink resource allocation mode 2 or Sidelink resource allocation scheme 2 to transmit using a pool of resources in one or multiple carriers as indicated in TS 38.331 [5] or TS 36.331 [21], the MAC entity can create a selected sidelink grant on the pool of resources based on random selection, or partial sensing, or full sensing only after releasing configured sidelink grant(s), if any.\nNOTE 2:\tThe MAC entity expects that PSFCH is always configured by RRC for at least one pool of resources in sl-TxPoolSelectedNormal and for the resource pool in sl-TxPoolExceptional in case that at least a logical channel configured with sl-HARQ-FeedbackEnabled is set to enabled.\nNOTE 2A:\tFor the transmission of Sidelink Inter-UE Coordination Request MAC CE, the MAC entity selects the TX pool of resource where the IUC resource set is required. For the transmission of Sidelink Inter-UE Coordination Information MAC CE, the MAC entity selects the TX pool of resource where the IUC resource set is located.\nNOTE 2B:\tFor dynamic co-channel coexistence of LTE sidelink and NR sidelink, when the same TB or different TBs are transmitted on the NR SL slots overlapping with the LTE SL subframe, it is up to UE implementation how to avoid transmitting NR PSCCH/PSSCH only in the subsequent NR SL slot overlapping with an LTE SL subframe for NR PSCCH/PSSCH transmissions of 30kHz SCS.\n1>\tif the MAC entity has selected to create a selected sidelink grant corresponding to transmissions of multiple MAC PDUs, and SL data is available in a logical channel; or\n1>\tif the MAC entity has selected to create a selected sidelink grant corresponding to transmission(s) of multiple SL-PRS(s), which have been triggered by the upper layer or by the reception of a SCI from a peer UE:2>\tif the MAC entity has not selected a pool of resources allowed for the logical channel or SL-PRS transmission:\n3>\tif single carrier frequency is configured:\n4>\tif SL data is available in the logical channel for NR sidelink discovery:\n5>\tif sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon is configured according to TS 38.331 [5]:\n6>\tselect the sl-DiscTxPoolSelected configured in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon for the transmission of NR sidelink discovery message.\n5>\telse:\n6>\tselect any pool of resources among the configured pools of resources except for SL-PRS dedicated resource pool, if configured.\n4>\telse if SL data is available in the logical channel for BRID for A2X communication:\n5>\tif sl-A2X-Service in sl-TxPoolSelectedNormal configured in sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X indicates brid or bridAndDAA according to TS 38.331 [5]:\n6>\tselect the sl-TxPoolSelectedNormal configured in sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X for the transmission of SL data for A2X communication.\n5>\telse:\n6>\tselect any pool of resources among the configured pools of resources.\n4>\telse if SL data is available in the logical channel for DAA for A2X communication:\n5>\tif sl-A2X-Service in sl-TxPoolSelectedNormal configured in sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X indicates daa or bridAndDAA according to TS 38.331 [5]:\n6>\tselect the sl-TxPoolSelectedNormal configured in sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X for the transmission of SL data for A2X communication.\n5>\telse:\n6>\tselect any pool of resources among the configured pools of resources.\nNOTE 2C:\tThe MAC entity identifies the logical channel(s) for BRID or DAA based on the QoS information associated to BRID or DAA, i.e. PQI(s), from upper layers.\n4>\telse if sl-HARQ-FeedbackEnabled is set to enabled for the logical channel:\n5>\tselect any pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X, if configured or SL-PRS dedicated resource pool, if configured.\n4>\telse if SL-PRS is pending for transmission:\n5>\tselect any resource pool among the resource pool(s) allowing for SL-PRS transmission.\n4>\telse:\n5>\tselect any pool of resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X, if configured or SL-PRS dedicated resource pool, if configured.\n3>\telse (i.e. multiple carrier frequencies are configured):\n4>\ttrigger the TX carrier (re-)selection procedure as specified in clause 5.22.1.11.\n2>\tif Sidelink consistent LBT failure is detected as specified in clause 5.31.2 in all RB sets of the selected resource pool, if single carrier frequency is configured:\n3>\tif sl-HARQ-FeedbackEnabled is set to enabled for the logical channel:\n4>\tselect any pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured and the pool(s) in which all RB sets had Sidelink consistent LBT failure detected and not cancelled.\n3>\telse:\n4>\tselect any pool of resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured and the pool(s) in which all RB sets had Sidelink consistent LBT failure detected and not cancelled.\n2>\tperform the TX resource (re-)selection check on the selected pool of resources as specified in clause 5.22.1.2;\nNOTE 2D:\tIt is up to UE implementation to select a resource pool that has at least one RB set in which SL consistent LBT failure was not detected.\nNOTE 3:\tThe MAC entity continuously performs the TX resource (re-)selection check until the corresponding pool of resources is released by RRC or the MAC entity decides to cancel creating a selected sidelink grant corresponding to transmissions of multiple MAC PDUs.\n2>\tif the TX resource (re-)selection is triggered as the result of the TX resource (re-)selection check:\n3>\tif sl-lbt-FailureRecoveryConfig is configured in the SL BWP:\n4>\tindicate to the physical layer RB set information for which Sidelink consistent LBT failure was detected and not cancelled as specified in clause 5.31.2.\n3>\tif the TX carrier (re-)selection procedure was triggered in above and one or more carriers have been (re-)selected in the TX carrier (re-)selection according to clause 5.22.1.11:\n4>\tdetermine the order of the (re-)selected carriers, according to the decreasing order based on the highest priority of logical channels which are allowed on each (re-)selected carrier, and perform the resource selection procedure as specified in this clause for each Sidelink process on each (re-)selected carrier according to the order.\n3>\tif one or multiple SL DRX(s) is configured in the destination UE(s) receiving SL-SCH data:\n4>\tindicate to the physical layer SL DRX Active time in the destination UE(s) receiving SL-SCH data, as specified in clause 5.28.2.\nNOTE 3A:\tThe MAC entity selects a value for the resource reservation interval which is larger than the remaining PDB of SL data available in the logical channel or remaining SL-PRS delay budget.\n3>\trandomly select, with equal probability, an integer value in the interval [5, 15] for the resource reservation interval higher than or equal to 100ms or in the interval  for the resource reservation interval lower than 100ms and set SL_RESOURCE_RESELECTION_COUNTER to the selected value;\n3>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n4>\tselect one of the allowed values configured by RRC in sl-ResourceReservePeriodList and set the resource reservation interval, Prsvp_TX, with the selected value;\n4>\tselect the number of HARQ retransmissions from the allowed numbers, if configured by RRC, in sl-MaxTxTransNumPSSCH included in sl-PSSCH-TxConfigList and, if configured by RRC, overlapped in sl-MaxTxTransNumPSSCH indicated in sl-CBR-PriorityTxConfigList for the highest priority of the logical channel(s) and pending SL-PRS transmission(s), if available, allowed on the carrier and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement results are available or the corresponding sl-defaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding sl-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding sl-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the sl-TxPoolExceptional is not used;\nNOTE 3Aa:\tFor Multi-consecutive slots transmission as specified in clause 8.1.4 of TS 38.214 [7], during resource (re)selection, leave it to UE implementation, regarding whether to calculate the number of HARQ retransmissions from the allowed numbers based on the number of MCSt transmissions, or the number of slot(s) within Multi-consecutive slots transmission.\n4>\tselect an amount of frequency resources within the range, if configured by RRC, between sl-MinSubChannelNumPSSCH and sl-MaxSubchannelNumPSSCH included in sl-PSSCH-TxConfigList and, if configured by RRC, overlapped between sl-MinSubChannelNumPSSCH and sl-MaxSubchannelNumPSSCH indicated in sl-CBR-PriorityTxConfigList for the highest priority of the logical channel(s) and pending SL-PRS transmission(s), if available, allowed on the carrier and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement results are available or the corresponding sl-defaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding sl-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding sl-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the sl-TxPoolExceptional is not used;\n3>\telse if the selected resource pool is SL-PRS dedicated resource pool:\n4>\tselect one of the allowed values configured by RRC in sl-PRS-ResourceReservePeriodList and set the resource reservation interval, , with the selected value;\n4>\tselect the number of SL-PRS retransmissions from the allowed numbers, if configured by RRC, in sl-PRS-MaxNum-Transmissions included in sl-CBR-SL-PRS-TxConfigList.\n3>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is not configured by RRC:\n4>\tif transmission based on random selection is configured by upper layers:\n5>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resource pool which occur within the SL DRX Active time, if configured, as specified in clause 5.28.2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, and the pool(s) in which all RB sets with Sidelink consistent LBT failure detected and not cancelled are excluded, if configured, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.\nNOTE 3Ab:\tWhen there are both SL data available in the logical channel(s) and SL-PRS pending for transmission, the resources are selected based on the shorter one of the corresponding remaining PDB and the corresponding remaining SL-PRS delay budget.\n5>\telse if the selected resource pool is SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resource pool as specified in clause 5.28.2, according to the remaining SL-PRS delay budget of the SL-PRS transmission(s).\n4>\telse:\n5>\tif sl-NRPSSCH-EUTRA-ThresRSRP-List is configured by the RRC:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier;\n7>\twhen SCS of NR SL is (pre-)configured as μ = 1:\n8>\tselect the time and frequency resources in the first of NR SL slots overlapping with an LTE SL subframe;\n8>\tmay additionally select the time and frequency resources in the subsequent NR SL slot overlapping with the LTE SL subframe.\n5>\telse if the selected resource pool is not SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] which occur within the SL DRX Active time, if configured, as specified in clause 5.28.2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.\n5>\telse if the selected resource pool is SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by physical layer as clasue 8.2.4 of TS 38.214 [7] as specified in clause 5.28.2, according to the remaining SL-PRS delay budget of the SL-PRS transmission(s).\n3>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and preferred resource set is not received from a UE:\n4>\tif transmission based on random selection is configured by upper layers:\n5>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources pool excluding all RB sets had Sidelink consistent LBT failure detected and not cancelled, if configured, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.\n5>\telse if the selected resource pool is SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resource pool which as specified in clause 5.28.2, according to the remaining SL-PRS delay budget of the SL-PRS transmission(s).\n4>\telse:\n5>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.\n5>\telse if the selected resource pool is SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by physical layer as clause 8.2.4 of TS 38.214 [7], according to the remaining SL-PRS delay budget of the SL-PRS transmission.\n3>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE does not have its own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE and if the selected resource pool is not SL-PRS dedicated resource pool:\n4>\trandomly select the time and frequency resources for one transmission opportunity from the resources belonging to the received preferred resource set for SL-SCH data to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.\n3>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE has its own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE and if the selected resource pool is not SL-PRS dedicated resource pool:\n4>\trandomly select the time and frequency resources for one transmission opportunity within the intersection of the received preferred resource set and the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] for an SL-SCH data to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.\n4>\tif there are no resources within the intersection that can be selected as the time and frequency resources for the one transmission opportunity according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier.\n5>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.\n3>\tuse the randomly selected resource to select a set of periodic resources spaced by the resource reservation interval for transmissions of PSCCH, PSSCH and SL-PRS corresponding to the number of transmission opportunities of MAC PDUs or SL-PRSs determined in TS 38.214 [7].\n3>\tif one or more SL-PRS retransmissions are selected and the selected resource pool is SL-PRS dedicated resource pool:\n4>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources, according to the selected number of retransmissions and the remaining SL-PRS delay budget and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9];\n4>\tuse the randomly selected resource to select a set of periodic resources spaced by the resource reservation interval for transmissions of PSCCH and SL-PRS corresponding to the number of retransmission opportunities of SL-PRS;\n4>\tconsider the first set of transmission opportunities as the initial transmission opportunities and the other set(s) of transmission opportunities as the retransmission opportunities;\n4>\tconsider the sets of initial transmission opportunities and retransmission opportunities as the selected sidelink grant.\n3>\telse if one or more HARQ retransmissions are selected and the selected resource pool is not SL-PRS dedicated resource pool:\n4>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is not configured by RRC:\n5>\tif transmission based on full sensing or partial sensing is configured by upper layers and there are available resources left in the resources indicated by the physical layer according to clause 8.1.4 of TS 38.214 [7] for more transmission opportunities; or\n5>\tif transmission based on random selection is configured by upper layers and there are available resources left in the resource pool for more transmission opportunities:\n6>\tif sl-NRPSSCH-EUTRA-ThresRSRP-List is configured by the RRC:\n7>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n8>\twhen SCS of NR SL is (pre-)configured as μ = 1:\n9>\tselect the time and frequency resources in the second of NR SL slots of NR SL slots overlapping with an LTE SL subframe to which the selected initial transmission resources belongs, or at least select the time and frequency resources in the first of NR SL slots overlapping with an LTE SL subframe.\n6>\telse:\n7>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources which occur within the SL DRX Active time, if configured, as specified in clause 5.28.2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, and the pool(s) in which all RB sets with Sidelink consistent LBT failure detected and not cancelled are excluded, if configured, according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n4>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and preferred resource set is not received from a UE:\n5>\tif transmission based on full sensing or partial sensing is configured by upper layers and there are available resources left in the resources indicated by the physical layer according to clause 8.1.4 of TS 38.214 [7] for more transmission opportunities; or\n5>\tif transmission based on random selection is configured by upper layers and there are available resources left in the resource pool for more transmission opportunities:\n6>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources excluding all RB sets had Sidelink consistent LBT failure detected and not cancelled, if configured according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n4>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE has own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE:\n5>\tif there are available resources left in the intersection of the received preferred resource set and the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] for more transmission opportunities:\n6>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources within the intersection for SL-SCH data to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL data available in the logical channel(s) , and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n5>\tif the number of time and frequency resources that has been maximally selected for one or more transmission opportunities from the available resources within the intersection is smaller than the selected number of HARQ retransmissions and there are available resources left in the resources indicated by the physical layer for more transmission opportunities:\n6>\trandomly select the time and frequency resources for the remaining transmission opportunities except for the selected resources within the intersection from the available resources outside the intersection but left in the resources indicated by the physical layer according to clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n4>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE does not have own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE; and\n4>\tif there are available resources left in the received preferred resource set for more transmission opportunities:\n5>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources belonging to the received preferred resource set for SL-SCH data to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n4>\tuse the randomly selected resource to select a set of periodic resources spaced by the resource reservation interval for transmissions of PSCCH, PSSCH, if available and SL-PRS, if available corresponding to the number of retransmission opportunities of the MAC PDUs determined in TS 38.214 [7] or SL-PRS(s);\n4>\tconsider the first set of transmission opportunities as the initial transmission opportunities and the other set(s) of transmission opportunities as the retransmission opportunities;\n4>\tconsider the sets of initial transmission opportunities and retransmission opportunities as the selected sidelink grant.\n3>\telse:\n4>\tconsider the set as the selected sidelink grant.\n3>\tuse the selected sidelink grant to determine the set of PSCCH durations and the set of PSSCH durations and the set of SL-PRS transmission occasion(s), if available, according to TS 38.214 [7] if the selected resource pool is not SL-PRS dedicated resource pool or to determine the set of PSCCH durations and SL-PRS transmission occasion(s) if the selected resource pool is SL-PRS dedicated resource pool according to TS 38.214 [7].\n2>\telse if SL_RESOURCE_RESELECTION_COUNTER = 0 and when SL_RESOURCE_RESELECTION_COUNTER was equal to 1 the MAC entity randomly selected, with equal probability, a value in the interval [0, 1] which is less than or equal to the probability configured by RRC in sl-ProbResourceKeep:\n3>\tclear the selected sidelink grant, if available;\n3>\trandomly select, with equal probability, an integer value in the interval [5, 15] for the resource reservation interval higher than or equal to 100ms or in the interval  for the resource reservation interval lower than 100ms and set SL_RESOURCE_RESELECTION_COUNTER to the selected value;\n3>\treuse the previously selected sidelink grant for the number of transmissions of the MAC PDUs or SL-PRS(s) determined in TS 38.214 [7] with the resource reservation interval to determine the set of PSCCH durations, the set of PSSCH durations, and the pending SL-PRS transmission(s), if available, according to TS 38.214 [7].\n1>\tif the MAC entity has selected to create a selected sidelink grant corresponding to transmission(s) of a single MAC PDU, and if SL data is available in a logical channel, or an SL-CSI reporting is triggered, or a Sidelink DRX Command indication is triggered or a Sidelink Inter-UE Coordination Information reporting is triggered, or a Sidelink Inter-UE Coordination Request is triggered:\n1>\tif the MAC entity has selected to create a selected sidelink grant corresponding to transmission of a single SL-PRS transmission, which has been triggered by the upper layer or by the reception of a SCI from a peer UE:\n2>\tif single carrier frequency is configured:\n3>\tif SL data is available in the logical channel for NR sidelink discovery:\n4>\tif sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon is configured according to TS 38.331 [5]:\n5>\tselect the sl-DiscTxPoolSelected configured in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon for the transmission of NR sidelink discovery message.\n4>\telse:\n5>\tselect any pool of resources among the configured pools of resources except for SL-PRS dedicated resource pool, if configured.\n3>\telse if SL data is available in the logical channel for BRID for A2X communication:\n4>\tif sl-A2X-Service in sl-TxPoolSelectedNormal configured in sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X indicates brid or bridAndDAA according to TS 38.331 [5]:\n5>\tselect the sl-TxPoolSelectedNormal configured in sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X for the transmission of SL data for A2X communication.\n4>\telse:\n5>\tselect any pool of resources among the configured pools of resources.\n3>\telse if SL data is available in the logical channel for DAA for A2X communication:\n4>\tif sl-A2X-Service in sl-TxPoolSelectedNormal configured in sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X indicates daa or bridAndDAA according to TS 38.331 [5]:\n5>\tselect the sl-TxPoolSelectedNormal configured in sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X for the transmission of SL data for A2X communication.\n4>\telse:\n5>\tselect any pool of resources among the configured pools of resources.\nNOTE 3Ac:\tThe MAC entity identifies the logical channel(s) for BRID or DAA based on the QoS information associated to BRID or DAA, i.e. PQI(s), from upper layers.\n3>\telse if SL data for NR sidelink communication is available in the logical channel:\n4>\tif sl-HARQ-FeedbackEnabled is set to enabled for the logical channel:\n5>\tselect any pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X, if configured or SL-PRS dedicated resource pool, if configured.\n4>\telse:\n5>\tselect any pool of resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X, if configured or SL-PRS dedicated resource pool, if configured.\n3>\telse if an SL-CSI reporting or a Sidelink DRX Command or a Sidelink Inter-UE Coordination Request or a Sidelink Inter-UE Coordination Information is triggered:\n4>\tselect any pool of resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X, if configured or SL-PRS dedicated resource pool, if configured.\n2>\telse (i.e. multiple carrier frequencies are configured):\n3>\ttrigger the TX carrier (re-)selection procedure as specified in clause 5.22.1.11.\n2>\tif Sidelink consistent LBT Failure is detected as specified in clause 5.31.2 in all RB sets of the selected resource pool for the logical channel, if single carrier frequency is configured:\n3>\tclear the selected sidelink grant on the selected pool of resources.\n3>\tif sl-HARQ-FeedbackEnabled is set to enabled for the logical channel:\n4>\tselect any pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured and the pool(s) including all RB sets for which Sidelink consistent LBT failures were detected.\n3>\telse:\n4>\tselect any pool of resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured and the pool(s) including all RB sets for which Sidelink consistent LBT failures were detected.\n2>\tperform the TX resource (re-)selection check on the selected pool of resources as specified in clause 5.22.1.2;\n2>\tif the TX resource (re-)selection is triggered as the result of the TX resource (re-)selection check\n3>\tif sl-lbt-FailureRecoveryConfig is configured in the SL BWP:\n4>\tindicate to the physical layer RB set information for which Sidelink consistent LBT failure was detected as specified in clause 5.31.2.\n3>\tif the TX carrier (re-)selection procedure was triggered in above and one or more carriers have been (re-)selected in the Tx carrier (re-)selection according to clause 5.22.1.11:\n4>\tdetermine the order of the (re-)selected carriers, according to the decreasing order based on the highest priority of logical channels which are allowed on each (re-)selected carrier, and perform the resource selection procedure as specified in this clause for each Sidelink process on each (re-)selected carrier according to the order.\n3>\tif one or multiple SL DRX(s) is configured in the destination UE(s) receiving SL-SCH data:\n4>\tindicate to the physical layer SL DRX Active time in the destination UE(s) receiving SL-SCH data, as specified in clause 5.28.2.\n3>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n4>\tselect the number of HARQ retransmissions from the allowed numbers, if configured by RRC, in sl-MaxTxTransNumPSSCH included in sl-PSSCH-TxConfigList and, if configured by RRC, overlapped in sl-MaxTxTransNumPSSCH indicated in sl-CBR-PriorityTxConfigList for the highest priority of the logical channel(s) and pending SL-PRS transmission(s), if available allowed on the carrier and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement results are available or the corresponding sl-defaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding sl-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding sl-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the sl-TxPoolExceptional is not used;\nNOTE 3Ad:\tFor Multi-consecutive slots transmission as specified in clause 8.1.4 of TS 38.214 [7], during resource (re)selection, leave it to UE implementation, regarding whether to calculate the number of HARQ retransmissions from the allowed numbers based on the number of MCSt transmissions, or the number of slot(s) within Multi-consecutive slots transmission.\n4>\tselect an amount of frequency resources within the range, if configured by RRC, between sl-MinSubChannelNumPSSCH and sl-MaxSubChannelNumPSSCH included in sl-PSSCH-TxConfigList and, if configured by RRC, overlapped between sl-MinSubChannelNumPSSCH and sl-MaxSubChannelNumPSSCH indicated in sl-CBR-PriorityTxConfigList for the highest priority of the logical channel(s) and pending SL-PRS transmission(s), if available allowed on the carrier and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement results are available or the corresponding sl-defaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding sl-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding sl-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the sl-TxPoolExceptional is not used;\n3>\tif the selected resource pool is SL-PRS dedicated resource pool:\n4>\tselect the number of SL-PRS retransmissions from the allowed numbers, if configured by RRC, in sl-PRS-MaxNum-Transmissions included in sl-CBR-SL-PRS-TxConfigList.\n3>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is not configured by RRC:\n4>\tif transmission based on random selection is configured by upper layers:\n5>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources pool which occur within the SL DRX Active time, if configured, as specified in clause 5.28.2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, if configured and the pool(s) in which all RB sets had Sidelink consistent LBT failure detected and not cancelled, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and the latency requirement of the triggered SL-CSI reporting.\n5>\tif the selected resource pool is SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resource pool as specified in clause 5.28.2, according to the remaining SL-PRS delay budget of the SL-PRS transmission.\n4>\telse:\n5>\tif sl-NRPSSCH-EUTRA-ThresRSRP-List is configured by the RRC:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting;\n7>\twhen SCS of NR SL is (pre-)configured as μ = 1:\n8>\tselect the time and frequency resources in the first of NR SL slots overlapping with an LTE SL subframe;\n8>\tmay additionally select the time and frequency resources in the subsequent NR SL slot overlapping with the LTE SL subframe.\n5>\telse if the selected resource pool is not SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] which occur within the SL DRX Active time, if configured, as specified in clause 5.28.2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.\n5>\tif the selected resource pool is SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by physical layer as clasue 8.2.4 of TS 38.214 [7] as specified in clause 5.28.2, according to the remaining SL-PRS delay budget of the SL-PRS transmission.\n3>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and preferred resource set is not received from a UE:\n4>\tif transmission based on random selection is configured by upper layers:\n5>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources pool excluding all RB sets had Sidelink consistent LBT failure detected and not cancelled, if configured according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.\n4>\telse:\n5>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n6>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.\n3>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE does not have own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE and if the selected resource pool is not SL-PRS dedicated resource pool:\n4>\trandomly select the time and frequency resources for one transmission opportunity from the resources belonging to the received preferred resource set for a MAC PDU to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.\n3>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE has own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE and if the selected resource pool is not SL-PRS dedicated resource pool:\n4>\trandomly select the time and frequency resources for one transmission opportunity within the intersection of the received preferred resource set and the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] for a MAC PDU to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting;\n4>\tif there are no resources within the intersection that can be selected as the time and frequency resources for the one transmission opportunity according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier.\n5>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.\n3>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE determines the resources for Sidelink Inter-UE Coordination Information transmission upon explicit request from a UE:\n4>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting and the latency requirement of the Sidelink Inter-UE Coordination Information transmission, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available.\n3>\tif one or more SL-PRS retransmissions are selected and the selected resource pool is SL-PRS dedicated resource pool:\n4>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources, according to the selected number of retransmissions and the remaining SL-PRS delay budget and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9];\n4>\tconsider the first set of transmission opportunities as the initial transmission opportunities and the other set(s) of transmission opportunities as the retransmission opportunities;\n4>\tconsider the sets of initial transmission opportunities and retransmission opportunities as the selected sidelink grant.\n3>\telse if one or more HARQ retransmissions are selected and the selected resource pool is not SL-PRS dedicated resource pool:\n4>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is not configured by RRC:\n5>\tif transmission based on full sensing or partial sensing is configured by upper layers and there are available resources left in the resources indicated by the physical layer according to clause 8.1.4 of TS 38.214 [7] for more transmission opportunities; or\n5>\tif transmission based on random selection is configured by upper layers and there are available resources left in the resources pool for more transmission opportunities:\n6>\tif sl-NRPSSCH-EUTRA-ThresRSRP-List is configured by the RRC:\n7>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources, and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9];\n8>\twhen SCS of NR SL is (pre-)configured as μ = 1:\n9>\tselect the time and frequency resources in the second of NR SL slots of NR SL slots overlapping with an LTE SL subframe to which the selected initial transmission resources belongs, or at least select the time and frequency resources in the first of NR SL slots overlapping with an LTE SL subframe.\n6>\telse:\n7>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources which occur within the SL DRX Active time, if configured, as specified in clause 5.28.2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, and the pool(s) in which all RB sets with Sidelink consistent LBT failure detected and not cancelled are excluded, if configured, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources, and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9];\n4>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and preferred resource set is not received from a UE:\n5>\tif transmission based on sensing is configured by upper layers and there are available resources left in the resources indicated by the physical layer according to clause 8.1.4 of TS 38.214 [7] for more transmission opportunities; or\n5>\tif transmission based on random selection is configured by upper layers and there are available resources left in the resource pool for more transmission opportunities:\n6>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources excluding all RB sets had Sidelink consistent LBT failure detected and not cancelled, if configured according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n4>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE has own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE:\n5>\tif there are available resources left in the intersection of the received preferred resource set and the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] for more transmission opportunities:\n6>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources within the intersection for a MAC PDU to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n5>\tif the number of time and frequency resources that has been maximally selected for one or more transmission opportunities from the available resources within the intersection is smaller than the selected number of HARQ retransmissions and there are available resources left in the resources indicated by the physical layer for more transmission opportunities:\n6>\trandomly select the time and frequency resources for the remaining transmission opportunities except for the selected resources within the intersection from the available resources outside the intersection but left in the resources indicated by the physical layer according to clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n4>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE does not have own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE; and\n4>\tif there are available resources left in the received preferred resource set for more transmission opportunities:\n5>\trandomly select the time and frequency resources for one or more transmission opportunities from the available resources belonging to the received preferred resource set for a MAC PDU to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].\n4>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE determines the resources for Sidelink Inter-UE Coordination Information transmission upon explicit request from a UE:\n5>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting and the latency requirement of the Sidelink Inter-UE Coordination Information transmission, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available.\n4>\tconsider a transmission opportunity which comes first in time as the initial transmission opportunity and other transmission opportunities as the retransmission opportunities;\n4>\tconsider all the transmission opportunities as the selected sidelink grant.\n3>\telse:\n4>\tconsider the set as the selected sidelink grant.\n3>\tuse the selected sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and the SL-PRS transmission occasion(s), if available, according to TS 38.214 [7] if the selected resource pool is not SL-PRS dedicated resource pool or to determine the PSCCH duration(s) and SL-PRS transmission occasion(s) if the selected resource pool is SL-PRS dedicated resource pool according to TS 38.214 [7].\nNOTE 3Ae:\tMAC entity, based on UE implementation, decides whether to indicate the number of consecutive slots for Multi-consecutive slots transmission as specified in clause 8.1.4 of TS 38.214 [7] larger than 1.\nNOTE 3Af:\tMAC entity, based on UE implementation, decides the value of the number of consecutive slots for Multi-consecutive slots transmission if it decides the number of consecutive slots for Multi-consecutive slots transmission larger than 1, as long as it meets the CAPC maximum COT duration requirement as specified in TS 37.213 [18].\nNOTE 3Ag:\tWhen the MAC entity selects the time and frequency resources from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], it is up to the UE implementation whether to randomly select resources for transmission opportunities from the resources indicated by the physical layer or to select resources in consecutive slots by UE implementation from the resources indicated by the physical layer.\nNOTE 3Ah:\tFor a resource pool configured with PSFCH resource, UE cannot select consecutive slots for SL transmissions of a single TB for Multi-consecutive slots transmission.\nNOTE 3Ai:\tUE may avoid selection of N consecutive resource(s) before a reserved resource of its own, where the selection of N is up to UE implementation from {0,1,2}. UE may avoid selection of M consecutive resource(s) after a reserved resource of its own, where the selection of M is up to UE implementation (at least including 0).\nNOTE 3Aj:\tIf configured, UE may avoid selection of N consecutive resource(s) before a reserved resource of other UE when the L1 SL priority value for the transmission is higher than the L1 SL priority value of the reserved resource, where the selection of N is up to UE implementation from {0,1,2}. UE may avoid selection of M consecutive resource(s) after a reserved resource of other UE when the transmitting symbols of the reserved resource overlap with LBT of its own selected resource, where the selection of M is up to UE implementation from {0,1,2}. It is up to UE implementation how the physical layer reports detected reserved resources to MAC layer.\nNOTE 3Ak:\tIf configured, if transmission in slot(s) at least  before a reserved resource of other UE is able to share its initiated COT to the reservation, UE may prioritize/select resource(s) in the slot(s) for transmission. It is up to UE implementation how the physical layer reports detected reserved resources to MAC layer.\nNOTE 3A1:\tIf sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and if multiple preferred resource sets are received from the same UE, it is up to UE implementation to use one or multiple of them in its resource (re)selection.\nNOTE 3B1:\tIf retransmission resource(s) cannot be selected by ensuring that the resource(s) can be indicated by the time resource assignment of a prior SCI, how to select the time and frequency resources for one or more transmission opportunities from the available resources is left for UE implementation by ensuring the minimum time gap between any two selected ‎resources in case that PSFCH is configured for this pool of ‎resources.\nNOTE 3B2:\tWhen the UE receives both a single preferred resource set and a single non-preferred resource set from the same peer UE or different peer UEs, when the UE has own sensing results, it is up to the UE implementation to use the preferred resource set in its resource (re)selection for transmissions to the peer UE providing the preferred resource set.\nNOTE 3B3:\tThe UE is not required to use any resource from the preferred resource set in its resource (re-)selection if that resource is earlier than (++) after the resource of Inter-UE Coordination Information transmission, where  is equal to (+) when only MAC CE is used for inter-UE Coordination Information transmission, or  is equal to  when MAC CE and SCI format 2-C are both used for Inter-UE Coordination Information transmission. The case when  is equal to  is assuming that SCI format 2-C is received.  and  are specified in clause 8.1.4 of TS 38.214 [7].\nNOTE 3B4:\tFor Inter-UE Coordination Information triggered by an explicit Inter-UE Coordination Request in Scheme 1, whether or not to transmit the Inter-UE Coordination Information upon the Inter-UE Coordination Request reception is determined by UE implementation subject to Release-16 procedure of UL/SL prioritization, LTE SL/NR SL prioritization, and congestion control.\nNOTE 3B5:\tIf configured by RRC, sl-IUC-Explicit set to enabled and an SL-IUC request is received for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast, MAC layer indicates to physical layer the resource selection window, resource set type (i.e., preferred resource set), L1 priority, the number of sub-channels to be used for the PSSCH/PSCCH transmission and the resource reservation period for preferred resource set. If configured by RRC, sl-IUC-Explicit set to enabled and an SL-IUC request is received for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast, MAC layer indicates to physical layer resource set type (i.e., non-preferred resource set) and the resource selection window for non-preferred resource set.\nNOTE 3B6:\tIf either sl-IUC-Explicit or sl-IUC-Condition is configured as enabled, UE considers the reception of preferred and non-preferred resource is enabled.\nNOTE 3B7:\tWhen sl-TriggerConditionCoordInfo is set to value 0, for groupcast or broadcast of Inter-UE Coordination Information triggered by a condition in Scheme 1, which Destination Layer-2 ID (and the corresponding cast-type) a UE selects among Destination Layer-2 IDs that are already used or interested in NR sidelink transmission is up to the UE implementation.\n1>\tif a selected sidelink grant is available for retransmission(s) of a MAC PDU which has been positively acknowledged as specified in clause 5.22.1.3.3, except a positive acknowledgement to Multi-consecutive slots transmission (i.e., multiple TBs case) of the MAC PDU and there is remaining slot(s) for this MAC PDU:\n2>\tclear the PSCCH duration(s) and PSSCH duration(s) corresponding to retransmission(s) of the MAC PDU from the selected sidelink grant.\nNOTE 3C:\tHow the MAC entity determines the remaining PDB of SL data is left to UE implementation.\nFor a selected sidelink grant, the minimum time gap between any two selected resources comprises:\n-\ta time gap between the end of the last symbol of a PSSCH transmission of the first resource and the start of the first symbol of the corresponding PSFCH reception determined by sl-MinTimeGapPSFCH and sl-PSFCH-Period for the pool of resources; and\n-\tFor SL operation with shared spectrum channel access, the time gap between the end of the last symbol of a PSSCH transmission of the first resource and the start of the first symbol of the last corresponding PSFCH reception determined by sl-MinTimeGapPSFCH and sl-PSFCH-Period for the pool of resources; and\n-\ta time required for PSFCH reception and processing plus sidelink retransmission preparation including multiplexing of necessary physical channels and any TX-RX/RX-TX switching time.\nNOTE 4:\tHow to determine the time required for PSFCH reception and processing plus sidelink retransmission preparation is left to UE implementation.\nThe MAC entity shall for each PSSCH duration not on SL-PRS dedicated resource pool:\n1>\tfor each sidelink grant occurring in this PSSCH duration:\n2>\tselect a MCS table allowed in the pool of resource which is associated with the sidelink grant;\nNOTE 4a:\tMCS table selection is up to UE implementation if more than one MCS table is configured.\n2>\tif the MAC entity has been configured with Sidelink resource allocation mode 1 or Sidelink resource allocation Scheme 1 for SL-PRS transmission on SL-PRS shared resource pool:\n3>\tselect a MCS which is, if configured, within the range that is configured by RRC between sl-MinMCS-PSSCH and sl-MaxMCS-PSSCH associated with the selected MCS table included in sl-ConfigDedicatedNR;\n3>\tset the resource reservation interval to 0ms.\n2>\telse if the MAC entity has been configured with Sidelink resource allocation mode 2 or Sidelink resource allocation Scheme 2 for SL-PRS transmission on SL-PRS shared resource pool:\n3>\tselect a MCS which is, if configured, within the range, if configured by RRC, between sl-MinMCS-PSSCH and sl-MaxMCS-PSSCH associated with the selected MCS table included in sl-PSSCH-TxConfigList and, if configured by RRC, overlapped between sl-MinMCS-PSSCH and sl-MaxMCS-PSSCH associated with the selected MCS table indicated in sl-CBR-PriorityTxConfigList for the highest priority of the sidelink logical channel(s) in the MAC PDU or pending SL-PRS transmission(s), if available, and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement results are available or the corresponding sl-defaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding sl-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding sl-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the sl-TxPoolExceptional is not used;\n3>\tif the MAC entity decides not to use the selected sidelink grant for the next PSSCH duration corresponding to an initial transmission opportunity:\n4>\tset the resource reservation interval to 0ms.\n3>\telse:\n4>\tset the resource reservation interval to the selected value.\nNOTE 5:\tMCS selection is up to UE implementation if the MCS or the corresponding range is not configured by RRC.\n2>\tif the configured sidelink grant has been activated and this PSSCH duration corresponds to the first PSSCH transmission opportunity within this sl-PeriodCG of the configured sidelink grant:\n3>\tset the HARQ Process ID to the HARQ Process ID associated with this PSSCH duration and, if available, all subsequent PSSCH duration(s) occuring in this sl-PeriodCG for the configured sidelink grant;\n3>\tdetermine that this PSSCH duration is used for initial transmission;\n3>\tflush the HARQ buffer of Sidelink process associated with the HARQ Process ID.\n2>\tdeliver the sidelink grant, the selected MCS, and the associated HARQ information to the Sidelink HARQ Entity for this PSSCH duration.\nThe MAC entity shall for each PSCCH duration on SL-PRS dedicated resource pool:\n1>\tif the MAC entity is not configured with multiple SL-PRS transmissions with Sidelink resource allocation scheme 2; or\n1>\tif the MAC entity is configured with Sidelink resource allocation scheme 1:\n2>\tset the resource reservation period to 0.\n1>\telse if the MAC entity is configured with multiple SL-PRS transmission with Sidelink resource allocation scheme 2:\n2>\tset the resource reservation period to the selected value.\n1>\tif the configured sidelink grant has been activated and this PSSCH duration corresponds to the first PSSCH transmission opportunity within this sl-PeriodCG of the configured sidelink grant:\n2>\tset the SL-PRS Process ID to the SL-PRS Process ID associated with this PSSCH duration and, if available, all subsequent SL-PRS transmission occasion(s) occuring in this sl-PeriodCG for the configured sidelink grant;\n2>\tdetermine that this SL-PRS transmission occasion is used for initial transmission.\n1>\tprocess the sidelink grant according to clause 5.22.1.3.4 with the corresponding SL-PRS transmission information.\nFor configured sidelink grants not on SL-PRS dedicated resource pool, the HARQ Process ID associated with the first slot of an SL transmission is derived from the following equation:\nHARQ Process ID = [floor(CURRENT_slot / PeriodicitySL)] modulo sl-NrOfHARQ-Processes\n\t+ sl-HARQ-ProcID-offset\nFor configured sidelink grant on SL-PRS dedicated resource pool, the SL-PRS Process ID associated with the first slot of an SL transmission is derived from the following equation:\nSL-PRS Process ID = [floor(CURRENT_slot / PeriodicitySL)] modulo [nrOfSL-PRSProc]\nwhere CURRENT_slot refers to current logical slot in the associated resource pool, and PeriodicitySL is defined in clause 5.8.3.\nIf the TX resource (re-)selection check procedure is triggered on the selected pool of resources for a Sidelink process according to clause 5.22.1.1, the MAC entity shall for the Sidelink process:\n1>\tif PSCCH duration(s) and 2nd stage SCI on PSSCH for all transmissions of a MAC PDU of any selected sidelink grant(s) are not in SL DRX Active time as specified in clause 5.28.3 of the destination that has data to be sent; or\n1>\tif SL_RESOURCE_RESELECTION_COUNTER = 0 and when SL_RESOURCE_RESELECTION_COUNTER was equal to 1 the MAC entity randomly selected, with equal probability, a value in the interval [0, 1] which is above the probability configured by RRC in sl-ProbResourceKeep; or\n1>\tif the pool of resources is configured or reconfigured by RRC; or\n1>\tif there is no selected sidelink grant on the selected pool of resources; or\n1>\tif neither transmission nor retransmission has been performed by the MAC entity on any resource indicated in the selected sidelink grant during the last second; or\n1>\tif sl-ReselectAfter is configured and the number of consecutive unused transmission opportunities on resources indicated in the selected sidelink grant, which is incremented by 1 when none of the resources of the selected sidelink grant within a resource reservation interval is used, is equal to sl-ReselectAfter; or\n1>\tif the selected sidelink grant cannot accommodate a RLC SDU by using the maximum allowed MCS configured by RRC in sl-MaxMCS-PSSCH associated with the selected MCS table and the UE selects not to segment the RLC SDU; or\nNOTE 1:\tIf the selected sidelink grant cannot accommodate the RLC SDU, it is left for UE implementation whether to perform segmentation or sidelink resource reselection.\n1>\tif transmission(s) with the selected sidelink grant cannot fulfil the remaining PDB of the data in a logical or the remaining SL-PRS delay budget for SL-PRS transmission, if available channel, and the MAC entity selects not to perform transmission(s) corresponding to a single MAC PDU or SL-PRS transmission; or\n1>\tif Sidelink consistent LBT failure is detected as specified in clause 5.31.2 in some RB set(s) of the selected resource pool that spans multiple RB sets for the logical channel, if single carrier frequency is configured; or\n1>\tif a MAC PDU is not transmitted (i.e. initial transmission or retransmission) in any of the resources for this MAC PDU that are associated with the sidelink process for Multi-consecutive slots transmission due to the Sidelink LBT failure:\nNOTE 2:\tIf the remaining PDB is not met, it is left for UE implementation whether to perform transmission(s) corresponding to single MAC PDU or sidelink resource reselection.\nNOTE 3:\tIt is left for UE implementation whether to trigger the TX resource (re-)selection due to the latency requirement of the MAC CEs triggered according to clause 5.22.1.7 and clause 5.22.1.10.1.\n2>\tif multiple carrier frequencies are configured:\n3>\ttrigger the TX carrier (re-)selection procedure as specified in clause 5.22.1.11.\n2>\tclear the selected sidelink grant associated to the Sidelink process, if available;\n2>\ttrigger the TX resource (re-)selection.\nNOTE 4:\tVoid.\nNOTE 5:\tVoid.\nA resource(s) of the selected sidelink grant for a MAC PDU to transmit from multiplexing and assembly entity or for a SL-PRS transmission is re-evaluated by physical layer at T3 before the slot where the SCI indicating the resource(s) is signalled at first time as specified in clause 8.1.4 of TS 38.214 [7].\nA resource(s) of the selected sidelink grant which has been indicated by a prior SCI for a MAC PDU to transmit from multiplexing and assembly entity or for a SL-PRS transmission could be checked for pre-emption by physical layer at T3 before the slot where the resource(s) is located as specified in clause 8.1.4 of TS 38.214 [7].\nNOTE 1:\tIt is up to UE implementation to re-evaluate or pre-empt before 'm – T3' or after 'm – T3' but before 'm'. For re-evaluation, m is the slot where the SCI indicating the resource(s) is signalled at first time as specified in clause 8.1.4 of TS 38.214. For pre-emption, m is the slot where the resource(s) is located as specified in clause 8.1.4 of TS 38.214.\nIf the MAC entity has been configured with Sidelink resource allocation mode 2 or Sidelink resource allocation scheme 2 to transmit using pool(s) of resources in a carrier as indicated in TS 38.331 [5] or TS 36.331 [21] based on sensing or random selection the MAC entity shall for each Sidelink process or for each SL-PRS transmission:\n1>\tif a resource(s) of the selected sidelink grant which has not been identified by a prior SCI is indicated for re-evaluation by the physical layer as specified in clause 8.1.4 of TS 38.214 [7];\n2>\tremove the resource(s) from the selected sidelink grant associated to the Sidelink process or SL-PRS transmission;\n2>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n3>\trandomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] for either the removed resource or the dropped resource, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of either SL data available in the logical channel(s), and the remaining SL-PRS delay budget for SL-PRS transmission, if available, by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources, and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9];\n2>\telse if the selected resource pool is SL-PRS dedicated resource pool:\n3>\trandomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8.2.4 of TS 38.214 [7] for either the removed resource or the dropped resource, according to the selected number of SL-PRS retransmissions and the remaining SL-PRS delay budget for SL-PRS transmission and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.2 of TS 38.212 [9].\n2>\treplace the removed or dropped resource(s) by the selected resource(s) for the selected sidelink grant.\n1>\tif any resource(s) of the selected sidelink grant which has been indicated by a prior SCI is indicated for pre-emption by the physical layer as specified in clause 8.1.4 of TS 38.214 [7]:\n2>\tremove the resource(s) from the selected sidelink grant associated to the Sidelink process;\n2>\tif one or multiple SL DRX is configured:\n3>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n4>\trandomly select the time and frequency resource from the resources later than the resources for either the removed resource or the dropped resource indicated by a prior SCI, from the resource indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] which occur within the SL DRX active time as specified in clause 5.28.3 of the destination UE selected for indicating to the physical layer the SL DRX active time above, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of either SL data available in the logical channel(s) by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources, and the remaining SL-PRS delay budget for SL-PRS transmission, if available, and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9].\n2>\telse:\n3>\tif the selected resource pool is not SL-PRS dedicated resource pool:\n4>\trandomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] for either the removed resource or the dropped resource, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of either SL data available in the logical channel(s) by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources, and the remaining SL-PRS delay budget for SL-PRS transmission, if available, and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9].\n3>\telse if the selected resource pool is SL-PRS dedicated resource pool:\n4>\trandomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8.2.4 of TS 38.214 [7] for either the removed resource or the dropped resource, according to the selected number of SL-PRS retransmissions and the remaining SL-PRS delay budget for SL-PRS transmission and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9].\nNOTE 2:\tIf retransmission resource(s) cannot be selected by ensuring that the resource(s) can be indicated by the time resource assignment of a prior SCI, how to select the time and frequency resources for one or more transmission opportunities from the available resources is left for UE implementation by ensuring the minimum time gap between any two selected ‎resources in case that PSFCH is configured for this pool of ‎resources.\n2>\treplace the removed or dropped resource(s) by the selected resource(s) for the selected sidelink grant.\nNOTE 3:\tIt is left for UE implementation to reselect any pre-selected but not reserved resource(s) other than the resource(s) indicated for pre-emption or re-evaluation by the physical layer during reselection triggered by re-evaluation or pre-emption indicated by the physical layer.\nNOTE 4:\tIt is up to UE implementation whether to set the resource reservation interval in the re-selected resource to replace pre-empted resource.\nNOTE 5:\tIt is up to UE implementation whether to trigger resource reselection due to de-prioritization as specified in clause 16.2.4 of TS 38.213 [6], clause 5.14.1.2.2 of TS 36.321 [22] and clause 5.22.1.3.1a.\nNOTE 6:\tFor the selected sidelink grant corresponds to transmissions of multiple MAC PDU, it is up to UE implementation whether to apply re-evaluation check to the resources in non-initial reservation period that have been signalled neither in the immediate last nor in the current period.\nIf the MAC entity has been configured with Sidelink resource allocation mode 2 or Sidelink resource allocation scheme 2 to transmit using pool(s) of resources in a carrier as indicated in TS 38.331 [5] based on full sensing, or partial sensing or random selection or any combination(s), the MAC entity shall for each Sidelink process:\n1>\tif sl-interUECoordinationScheme2 enabling reception/transmission of a resource conflict indication is configured by RRC; and\n1>\tif the next resource of the selected sidelink grant which has been indicated by a prior SCI is overlapped with conflict resource(s) indicated by the physical layer as specified in clause 16.3.1 of TS 38.213 [6]:\n2>\tremove the resource from the selected sidelink grant associated to the Sidelink process;\n2>\trandomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] excluding the conflict resource(s) for the removed resource, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of either SL data available in the logical channel(s), and the remaining SL-PRS delay budget for SL-PRS transmission, if available, by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources, and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9];\nNOTE 1:\tIf retransmission resource cannot be selected by ensuring that the resource can be indicated by the time resource assignment of a prior SCI, how to select the time and frequency resource for more transmission opportunities from the available resources is left for UE implementation by ensuring the minimum time gap between any two selected ‎resources in case that PSFCH is configured for this pool of ‎resources.\n2>\treplace the removed resource by the selected resource for the selected sidelink grant.\nNOTE 2:\tIt is left for UE implementation to reselect any pre-selected but not reserved resource(s) other than the resource overlapping with the conflict resource(s) indicated by the physical layer during reselection triggered by the conflict resource(s) indicated by the physical layer.\nNOTE 3:\tIt is up to UE implementation whether and how to set the resource reservation interval in the re-selected resource to replace the resource overlapping with the conflict resource(s) indicated by the physical layer.\nIf the MAC entity has been configured with Sidelink resource allocation mode 2 to transmit using pool(s) of resources in a carrier as indicated in TS 38.331 [5] or TS 36.331 [21] based on sensing or random selection the MAC entity shall for each Sidelink process:\n1>\tif SL LBT failure indication is received from lower layers:\n2>\tfor the resource(s) where SL LBT failure is detected from the selected sidelink grant associated to the Sidelink process:\n3>\tif transmission based on random selection is configured by upper layers:\n4>\trandomly select the time and frequency resources for one transmission opportunity from the resource pool excluding all RB sets for which Sidelink consistent LBT failures were detected and not cancelled, if configured according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources.\n3>\telse:\n4>\trandomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources.\nThe MAC entity is configured by upper layers to transmit using pool(s) of resources on one or more carriers as indicated in clause 5.8.8 of TS 38.331 [5]. For each carrier, the MAC entity includes at most one Sidelink HARQ entity for transmission on SL-SCH, which maintains a number of parallel Sidelink processes.\nThe maximum number of transmitting Sidelink processes associated with the Sidelink HARQ Entity is 16. A sidelink process may be configured for transmissions of multiple MAC PDUs. For transmissions of multiple MAC PDUs with Sidelink resource allocation mode 2, the maximum number of transmitting Sidelink processes associated with the Sidelink HARQ Entity is 4.\nA delivered sidelink grant and its associated Sidelink transmission information are associated with a Sidelink process. Each Sidelink process supports one TB.\nFor each sidelink grant, the Sidelink HARQ Entity shall:\n1>\tif the MAC entity determines that the sidelink grant is used for initial transmission as specified in clause 5.22.1.1; or\n1>\tif the sidelink grant is a configured sidelink grant and no MAC PDU has been obtained in an sl-PeriodCG of the configured sidelink grant; or\n1>\tif the sidelink grant is a dynamic sidelink grant or selected sidelink grant and no MAC PDU has been obtained in the previous sidelink grant when PSCCH duration(s) and 2nd stage SCI on PSSCH of the previous sidelink grant is not in SL DRX Active time as specified in clause 5.28.3 of any destination that has data to be sent:\nNOTE 1:\tVoid.\n2>\t(re-)associate a Sidelink process to this grant, and for the associated Sidelink process:\n2>\tif all PSCCH duration(s) and PSSCH duration(s) for initial transmission of a MAC PDU of the dynamic sidelink grant or the configured sidelink grant is not in SL DRX Active time as specified in clause 5.28.3 of the destination that has data to be sent:\n3>\tignore the sidelink grant.\nNOTE 1A:\tThe Sidelink HARQ Entity will associate the selected sidelink grant to the Sidelink process determined by the MAC entity.\n2>\telse:\n3>\tobtain the MAC PDU and SL-PRS, if any, to transmit from the Multiplexing and assembly entity, if any;\n3>\tif a MAC PDU to transmit has been obtained:\n4>\tif a HARQ Process ID has been set for the sidelink grant:\n5>\t(re-)associate the HARQ Process ID corresponding to the sidelink grant to the Sidelink process.\nNOTE 1a:\tThere is one-to-one mapping between a HARQ Process ID and a Sidelink process in the MAC entity configured with Sidelink resource allocation mode 1.\n4>\tdetermines Sidelink transmission information of the TB for the source and destination pair of the MAC PDU as follows:\n5>\tset the Source Layer-1 ID to the 8 LSB of the Source Layer-2 ID of the MAC PDU;\n5>\tset the Destination Layer-1 ID to the 16 LSB of the Destination Layer-2 ID of the MAC PDU;\n5>\t(re-)associate the Sidelink process to a Sidelink process ID;\nNOTE 1b:\tHow UE determine Sidelink process ID in SCI is left to UE implementation for NR sidelink.\n5>\tconsider the NDI to have been toggled compared to the value of the previous transmission corresponding to the Sidelink identification information and the Sidelink process ID of the MAC PDU and set the NDI to the toggled value;\nNOTE 2:\tThe initial value of the NDI set to the very first transmission for the associated Sidelink process is left to UE implementation.\nNOTE 3:\tVoid.\n5>\tif the MAC PDU is for NR sidelink discovery:\n6>\tset the cast type indicator to broadcast.\n5>\telse:\n6>\tset the cast type indicator to one of broadcast, groupcast and unicast as indicated by upper layers.\n5>\tif HARQ feedback has been enabled for the MAC PDU according to clause 5.22.1.4.2;\n6>\tset the HARQ feedback enabled/disabled indicator to enabled.\n5>\telse:\n6>\tset the HARQ feedback enabled/disabled indicator to disabled.\n5>\tset the priority to the value of the highest priority of the logical channel(s), if any, and MAC CE(s), if included, in the MAC PDU and SL-PRS, if any;\nNOTE 3A:\tWhen determining Sidelink transmission information, the priority of the Sidelink Inter-UE Coordination Information MAC CE is the value configured in RRC parameters sl-PriorityCoordInfoCondition when triggered by a condition, or sl-PriorityCoordInfoExplicit when triggered by an explicit request. When determining Sidelink transmission information, the priority of the Sidelink Inter-UE Coordination Request MAC CE is the value configured in RRC parameter sl-PriorityRequest. When determining Sidelink transmission information, the priority of the Sidelink Inter-UE Coordination Information MAC CE is the value indicated in Priority field in the Sidelink Inter-UE Coordination Request MAC CE provided by the UE when triggered by an explicit request, if sl-PriorityCoordInfoExplicit-r17 is not configured. When determining Sidelink transmission information for performing sensing and candidate resource selections in PHY, the priority value of the Sidelink Inter-UE Coordination Information MAC CE triggered under a condition is up to UE implementation, if sl-PriorityCoordInfoCondition-r17 is not configured. When determining Sidelink transmission information for performing sensing and candidate resource selections in PHY, the priority value of Sidelink Inter-UE Coordination Request MAC CE is the same as that of a TB to be transmitted by the UE, if sl-PriorityRequest-r17 is not configured.\n5>\tif HARQ feedback is enabled for groupcast:\n6>\tif both a group size and a member ID are provided by upper layers and the group size is not greater than the number of candidate PSFCH resources in a slot associated with this sidelink grant:\n7>\tselect either positive-negative acknowledgement or negative-only acknowledgement.\nNOTE 4:\tSelection of positive-negative acknowledgement or negative-only acknowledgement is up to UE implementation.\n6>\telse:\n7>\tselect negative-only acknowledgement.\nNOTE 5:\tUE operating in SL unlicensed does not use negative-only acknowledgement for groupcast HARQ.\n6>\tif negative-only acknowledgement is selected, UE's location information is available, and sl-TransRange has been configured for a logical channel in the MAC PDU, and sl-ZoneConfig is configured as specified in TS 38.331 [5]:\n7>\tset the communication range requirement to the value of the longest communication range of the logical channel(s) in the MAC PDU;\n7>\tdetermine the value of sl-ZoneLength corresponding to the communication range requirement and set Zone_id to the value of Zone_id calculated using the determined value of sl-ZoneLength as specified in TS 38.331 [5].\n5>\tset the Redundancy version to the selected value.\n5>\tif the sidelink grant is associated with request from the higher layer for triggering the SL-PRS transmission of the peer UE identified by the Destination layer-2 ID:\n6>\tset the SL-PRS request to request.\n5>\tset the SL-PRS resource ID, if SL-PRS is available, within Sidelink transmission information.\n4>\tdeliver the MAC PDU, the SL-PRS, if available, the sidelink grant and the Sidelink transmission information of the TB to the associated Sidelink process;\n4>\tinstruct the associated Sidelink process to trigger a new transmission.\n3>\telse:\n4>\tflush the HARQ buffer of the associated Sidelink process.\n1>\telse (i.e. retransmission):\n2>\tif the HARQ Process ID corresponding to the sidelink grant received on PDCCH, the configured sidelink grant or the selected sidelink grant is associated to a Sidelink process of which HARQ buffer is empty; or\n2>\tif the HARQ Process ID corresponding to the sidelink grant received on PDCCH is not associated to any Sidelink process; or\n2>\tif PSCCH duration(s) and PSSCH duration(s) for one or more retransmissions of a MAC PDU of the dynamic sidelink grant or the configured sidelink grant is not in SL DRX Active time as specified in clause 5.28.3 of the destination that has data to be sent:\n3>\tignore the sidelink grant.\n2>\telse:\n3>\tidentify the Sidelink process associated with this grant, and for the associated Sidelink process:\n4>\tdeliver the sidelink grant of the MAC PDU and the SL-PRS, if available, to the associated Sidelink process;\n4>\tinstruct the associated Sidelink process to trigger a retransmission.\nThe Sidelink process is associated with a HARQ buffer.\nNew transmissions and retransmissions are performed on the resource indicated in the sidelink grant as specified in clause 5.22.1.1 and with the MCS selected as specified in clause 8.1.3.1 of TS 38.214 [7] and clause 5.22.1.1.\nIf the Sidelink process is configured to perform transmissions of multiple MAC PDUs with Sidelink resource allocation mode 2, the process maintains a counter SL_RESOURCE_RESELECTION_COUNTER. For other configurations of the Sidelink process, this counter is not available.\nPriority of a MAC PDU and SL-PRS, if available, is determined by the highest priority of the logical channel(s), MAC CE(s) in the MAC PDU or SL-PRS.\nIf the Sidelink HARQ Entity requests a new transmission, the Sidelink process shall:\n1>\tstore the MAC PDU in the associated HARQ buffer;\n1>\tstore the sidelink grant received from the Sidelink HARQ Entity;\n1>\tgenerate a transmission as described below.\nIf the Sidelink HARQ Entity requests a retransmission, the Sidelink process shall:\n1>\tstore the sidelink grant received from the Sidelink HARQ Entity;\n1>\tgenerate a transmission as described below.\nTo generate a transmission, the Sidelink process shall:\n1>\tif there is no uplink transmission; or\n1>\tif the MAC entity is able to simultaneously perform uplink transmission(s) and sidelink transmission at the time of the transmission; or\n1>\tif the other MAC entity and the MAC entity are able to simultaneously perform uplink transmission(s) and sidelink transmission at the time of the transmission respectively; or\n1>\tif there is a MAC PDU to be transmitted for this duration in uplink, except a MAC PDU obtained from the Msg3 buffer, the MSGA buffer, or prioritized as specified in clause 5.4.2.2, and the sidelink transmission is prioritized over uplink transmission:\n2>\tinstruct the physical layer to transmit SCI according to the stored sidelink grant with the associated Sidelink transmission information;\n2>\tinstruct the physical layer to generate a transmission according to the stored sidelink grant;\n2>\tif HARQ feedback has been enabled for the MAC PDU according to clause 5.22.1.4.2:\n3>\tinstruct the physical layer to monitor PSFCH for the transmission and perform PSFCH reception as specified in clause 5.22.1.3.2.\n2>\tif sl-PUCCH-Config is configured by RRC for the stored sidelink grant:\n3>\tdetermine transmission of an acknowledgement on the PUCCH as specified in clause 5.22.1.3.2.\n1>\tif this transmission corresponds to the last transmission of the MAC PDU and SL-PRS, if available:\n2>\tdecrement SL_RESOURCE_RESELECTION_COUNTER by 1, if available.\nNOTE 1:\tIf the number of HARQ retransmissions selected by the MAC entity has been reached, or if a positive acknowledgement to a transmission of the MAC PDU has been received, or if a negative-only acknowledgement was enabled in the SCI and no negative acknowledgement was received for the transmission of the MAC PDU, the MAC entity determines this transmission corresponds to the last transmission of the MAC PDU for Sidelink resource allocation mode 2. How to determine the last transmission in other cases is up to UE implementation.\n1>\tif sl-MaxTransNum corresponding to the highest priority of the logical channel(s) in the MAC PDU has been configured in sl-CG-MaxTransNumList for the sidelink grant by RRC and the number of transmissions of the MAC PDU has been reached to sl-MaxTransNum; or\n1>\tif a positive acknowledgement to this transmission of the MAC PDU was received according to clause 5.22.1.3.2, except a positive acknowledgement to Multi-consecutive slots transmission (i.e., multiple TBs case) of the MAC PDU and there is remaining slot(s) for this MAC PDU; or\n1>\tif negative-only acknowledgement was enabled in the SCI and no negative acknowledgement was received for this transmission of the MAC PDU according to clause 5.22.1.3.2:\n2>\tflush the HARQ buffer of the associated Sidelink process.\nThe transmission of the MAC PDU or SL-PRS, if available, is prioritized over uplink transmission(s) of the MAC entity or the other MAC entity if the following conditions are met:\n1>\tif the MAC entity is not able to perform this sidelink transmission simultaneously with all uplink transmission(s) at the time of the transmission, and\n1>\tif none of the uplink transmission(s) is prioritized by upper layer according to TS 23.287 [19], and\n1>\tif none of the NR uplink MAC PDU(s) includes any MAC CE prioritized as described in clause 5.4.3.1.3, and\n1>\tif ul-PrioritizationThres is configured and if the value of the highest priority of logical channel(s) of all the NR uplink transmission(s) is not lower than ul-PrioritizationThres, and\n1>\tif sl-PrioritizationThres is configured and if the value of the highest priority of logical channel(s) or MAC CE(s) in the MAC PDU is lower than sl-PrioritizationThres.\nNOTE 2:\tIf the MAC entity is not able to perform this sidelink transmission simultaneously with all uplink transmissions as specified in clause 5.4.2.2 of TS 36.321 [22] at the time of the transmission, and prioritization-related information is not available prior to the time of this sidelink transmission due to processing time restriction, it is up to UE implementation whether this sidelink transmission is performed.\nThe MAC entity shall for each PSSCH transmission:\n1>\tif an acknowledgement corresponding to the PSSCH transmission in clause 5.22.1.3.1a is obtained from the physical layer:\n2>\tdeliver the acknowledgement to the corresponding Sidelink HARQ entity for the Sidelink process;\n1>\telse:\n2>\tdeliver a negative acknowledgement to the corresponding Sidelink HARQ entity for the Sidelink process;\n1>\tif the PSSCH transmission occurs for a pair of Source Layer-2 ID and Destination Layer-2 ID corresponding to a PC5-RRC connection which has been established by upper layers:\n2>\tperform the HARQ-Based Sidelink RLF Detection procedure as specified in clause 5.22.1.3.3.\nIf sl-PUCCH-Config is configured by RRC, the MAC entity shall for a PUCCH transmission occasion:\n1>\tif the timeAlignmentTimer, associated with the TAG containing the Serving Cell on which the HARQ feedback is to be transmitted, is stopped or expired, and the Serving Cell is not configured with two TAGs; or\n1>\tif the Serving Cell on which the HARQ feedback is to be transmitted is configured with two TAGs and if the timeAlignmentTimer of the TAG, associated with the TCI state(s) used for transmitting the HARQ feedback, is stopped or expired:\n2>\tnot instruct the physical layer to generate acknowledgement(s) of the data in this TB.\n1>\telse if all PSCCH duration(s) and PSSCH duration(s) for initial transmission of a MAC PDU of the dynamic sidelink grant or the configured sidelink grant is not in SL DRX Active time as specified in clause 5.28.3 of the destination that has data to be sent and the sidelink grant is ignored according to clause 5.22.1.3.1:\n2>\tinstruct the physical layer to signal a positive acknowledgement corresponding to the transmission on the PUCCH according to clause 16.5 of TS 38.213 [6].\n1>\telse if a MAC PDU has been obtained for a sidelink grant associated to the PUCCH transmission occasion in clause 5.22.1.3.1, the MAC entity shall:\n2>\tif the most recent transmission of the MAC PDU was not prioritized as specified in clause 5.22.1.3.1a:\n3>\tinstruct the physical layer to signal a negative acknowledgement on the PUCCH according to clause 16.5 of TS 38.213 [6].\n2>\telse if HARQ feedback has been disabled for the MAC PDU and next retransmission(s) of the MAC PDU is not required:\n3>\tinstruct the physical layer to signal a positive acknowledgement corresponding to the transmission on the PUCCH according to clause 16.5 of TS 38.213 [6].\n2>\telse if HARQ feedback has been disabled for the MAC PDU, and no sidelink grant is available for next retransmission(s) of the MAC PDU (including immediately after all PSSCH duration(s) in an sl-PeriodCG for the sidelink grant, the number of transmissions of the MAC PDU has not reached sl-MaxTransNum corresponding to the highest priority of the logical channel(s) in the MAC PDU, if configured in sl-CG-MaxTransNumList for the sidelink grant by RRC), if any; or\n2>\telse if PSCCH duration(s) and PSSCH duration(s) for one or more retransmissions of a MAC PDU of the dynamic sidelink grant or the configured sidelink grant is not in SL DRX Active time as specified in clause 5.28.3 of the destination that has data to be sent:\n3>\tinstruct the physical layer to signal a negative acknowledgement corresponding to the transmission on the PUCCH according to clause 16.5 of TS 38.213 [6].\n2>\telse:\n3>\tinstruct the physical layer to signal an acknowledgement corresponding to the transmission on the PUCCH according to clause 16.5 of TS 38.213 [6]\n1>\telse:\n2>\tinstruct the physical layer to signal a positive acknowledgement on the PUCCH according to clause 16.5 of TS 38.213 [6].\nFor each carrier associated with a PC5-RRC connection, the HARQ-based Sidelink RLF detection procedure is used to detect Sidelink RLF based on a number of consecutive DTX on PSFCH reception occasions for a PC5-RRC connection.\nRRC configures the following parameter to control HARQ-based Sidelink RLF detection:\n-\tsl-maxNumConsecutiveDTX.\nThe following UE variable is used for HARQ-based Sidelink RLF detection.\n-\tnumConsecutiveDTX, which is maintained per carrier per PC5-RRC connection.\nFor each carrier associated with a PC5-RRC connection, the Sidelink HARQ Entity shall (re-)initialize numConsecutiveDTX to zero for each PC5-RRC connection which has been established by upper layers, if any, upon establishment of the PC5-RRC connection or (re)configuration of sl-maxNumConsecutiveDTX.\nFor each carrier associated with a PC5-RRC connection, the Sidelink HARQ Entity shall for each PSFCH reception occasion associated to the PSSCH transmission:\n1>\tif PSFCH reception is absent on the PSFCH reception occasion:\n2>\tincrement numConsecutiveDTX by 1;\nNOTE 1:\tFor SL operation with shared spectrum channel access, UE increases the numConsecutiveDTX by 1 when the UE fails to detect the HARQ feedback on all the associated PSFCH resources according to clause 16.3.0 of TS 38.213 [6].\n2>\tif more than one carrier selected as defined in clause 5.22.1.11 is considered as the carriers for HARQ-based Sidelink RLF detection:\n3>\tif numConsecutiveDTX reaches sl-maxNumConsecutiveDTX for a carrier applied for HARQ-based Sidelink RLF detection:\n4>\ttrigger the TX carrier (re-)selection procedure as specified in clause 5.22.1.11;\n4>\tindicate HARQ-based Sidelink carrier failure to RRC.\n3>\tif numConsecutiveDTX reaches sl-maxNumConsecutiveDTX for all carriers applied for HARQ-based Sidelink RLF detection:\n4>\tindicate HARQ-based Sidelink RLF detection to RRC.\n2>\telse:\n3>\tif numConsecutiveDTX reaches sl-maxNumConsecutiveDTX:\n4>\tindicate HARQ-based Sidelink RLF detection to RRC.\n1>\telse:\n2>\tre-initialize numConsecutiveDTX to zero.\n5.22.1.3.4\tProcessing of sidelink grant on SL-PRS dedicated resource pool\nFor each sidelink grant, the MAC entity shall:\n1>\tif the MAC entity determines that the sidelink grant is used for initial transmission as specified in clause 5.22.1.1; or\n1>\tif the sidelink grant is a configured sidelink grant and no MAC PDU has been obtained in an sl-PeriodCG of the configured sidelink grant:\n2>\tassociate a Sidelink process to this sidelink grant;\n2>\tset the Destination ID to the Destination layer-2 ID corresponding to the SL-PRS transmission;\n2>\tif the length of the Source ID is configured to as 12 bit:\n3>\tset the Source ID to the 12 LSB of the Source layer-2 ID corresponding to the SL-PRS transmission;\n2>\telse if length of the Source ID is configured to as 24 bit:\n3>\tset the Source ID to the Source layer-2 ID corresponding to the SL-PRS transmission;\n2>\tset the cast type indicator to one of broadcast, groupcast and unicast as indiated by the upper layer;\n2>\tset the SL-PRS priority as the value indicated by upper layer;\n2>\tset the SL-PRS resource ID;\n2>\tif the higher layer triggers SL-PRS transmission to the peer UE identified by the Destination layer-2 ID:\n3>\tset the SL-PRS request to request;\n2>\tdeliver the SL-PRS transmission information to the Sidelink process;\n2>\tinstruct the associated Sidelink process to trigger a new transmission as defined in 5.22.1.3.5.\n1>\telse (i.e., retransmission):\n2>\tidentify the Sidelink process associated with this grant;\n2>\tif sl-PRS-MaxNumTransmissions is configured and the number of transmissions of the SL-PRS has not reached sl-PRS-MaxNumTransmissions:\n3>\tdeliver the same SL-PRS transmission information as the initial transmission to the Sidelink process;\n3>\tinstruct the associated Sidelink process to trigger a retransmission as defined in 5.22.1.3.5.\nNOTE:\tFor configured sidelink grant, the Sidelink process for retransmission is identified by the SL-PRS Process ID as specified in clause 5.22.1.3.1.\n5.22.1.3.5\tSidelink process associated with SL-PRS dedicated resource pool\nIf the Sidelink process is configured to perform transmissions of multiple SL-PRS with Sidelink resource allocation scheme 2, the process maintains a counter SL_RESOURCE_RESELECTION_COUNTER. For other configurations of the Sidelink process, this counter is not available.For each SL-PRS new transmission or retransmission, the MAC entity shall:\n1>\tif there is no uplink transmission; or\n1>\tif there is uplink transmission and the sidelink transmission is prioritized over uplink transmission:\n2>\tinstruct the physical layer to transmit SCI of the SL grant with the associated SL-PRS transmission information on SL-PRS dedicated resource pool;\n2>\tinstruct the physical layer to generate the SL-PRS on SL-PRS dedicated resource pool.\n1>\tif this transmission corresponds to the last transmission of the SL-PRS transmission:\n2>\tdecrement SL_RESOURCE_RESELECTION_COUNTER by 1, if available.\nThe transmission of the SL-PRS is prioritized over uplink transmission(s) of the MAC entity or the other MAC entity if the following conditions are met:\n1>\tif the MAC entity is not able to perform this sidelink transmission simultaneously with all uplink transmission(s) at the time of the transmission, and\n1>\tif ul-PrioritizationThres is configured and if the value of the highest priority of logical channel(s) of all the NR uplink transmission(s) is not lower than ul-PrioritizationThres, and\n1>\tif sl-PrioritizationThres is configured and if the value of SL-PRS priority is lower than sl-PrioritizationThres.\nFor PDU(s) associated with one SCI, MAC shall consider only logical channels with the same Source Layer-2 ID-Destination Layer-2 ID pair for one of unicast, groupcast and broadcast which is associated with the pair. Multiple transmissions for different Sidelink processes are allowed to be independently performed in different PSSCH durations.\nNOTE:\tSidelink data for discovery and sidelink data for non-discovery transmitted by a UE cannot be multiplexed into the same TB because they are always associated with different destination L2 IDs (see TS 23.304 [26]).\nThe sidelink Logical Channel Prioritization procedure is applied whenever a new transmission is performed.\nRRC controls the scheduling of sidelink data by signalling for each logical channel:\n-\tsl-Priority where an increasing priority value indicates a lower priority level;\n-\tsl-PrioritisedBitRate which sets the sidelink Prioritized Bit Rate (sPBR);\n-\tsl-BucketSizeDuration which sets the sidelink Bucket Size Duration (sBSD).\nRRC additionally controls the LCP procedure by configuring mapping restrictions for each logical channel:\n-\tsl-configuredGrantType1Allowed which sets whether a configured grant Type 1 can be used for sidelink transmission;\n-\tsl-AllowedCG-List which sets the allowed configured grant(s) for sidelink transmission;\n-\tsl-HARQ-FeedbackEnabled which sets whether the logical channel is allowed to be multiplexed with logical channel(s) with sl-HARQ-FeedbackEnabled set to enabled or disabled.\nThe following UE variable is used for the Logical channel prioritization procedure:\n-\tSBj which is maintained for each logical channel j.\nThe MAC entity shall initialize SBj of the logical channel to zero when the logical channel is established.\nFor each logical channel j, the MAC entity shall:\n1>\tincrement SBj by the product sPBR × T before every instance of the LCP procedure, where T is the time elapsed since SBj was last incremented;\n1>\tif the value of SBj is greater than the sidelink bucket size (i.e. sPBR × sBSD):\n2>\tset SBj to the sidelink bucket size.\nNOTE:\tThe exact moment(s) when the UE updates SBj between LCP procedures is up to UE implementation, as long as SBj is up to date at the time when a grant is processed by LCP.\nThe MAC entity shall for each SCI corresponding to a new transmission:\n1>\tif sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X is configured according to TS 38.331 [5]; and\n1>\tif the new transmission is not associated to a sidelink grant on SL-PRS dedicated resource pool:\n2>\tif the new transmission is associated to a sidelink grant in sl-DiscTxPoolSelected or sl-DiscTxPoolScheduling configured in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon:\n3>\tselect a Destination associated with NR sidelink discovery as specified in TS 23.304 [26], that is in the SL Active time for the SL transmission occasion if SL DRX is applied for the destination, and among the logical channels that satisfy all the following conditions for the SL grant associated to the SCI:\n4>\tSL data for NR sidelink discovery is available for transmission; and\n4>\tSBj > 0, in case there is any logical channel having SBj > 0; and\n4>\tsl-configuredGrantType1Allowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and\n4>\tsl-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant.\n2>\telse if the new transmission is associated to a sidelink grant in sl-TxPoolSelectedNormal configured in sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X:\n3>\tselect a Destination associated with BRID if sl-A2X-Service in sl-TxPoolSelectedNormal indicates brid or bridAndDAA or select a Destination associated with DAA if sl-A2X-Service in sl-TxPoolSelectedNormal indicates daa or bridAndDAA as specified in TS 23.256 [31], and the logical channel with the highest priority, among the logical channels that satisfy all the following conditions for the SL grant associated to the SCI:\n4>\tSL data for A2X communication is available for transmission; and\n4>\tSBj > 0, in case there is any logical channel having SBj > 0.\n2>\telse:\n3>\tselect a Destination associated to one of unicast, groupcast and broadcast (excluding the Destination(s) associated with NR sidelink discovery as specified in TS 23.304 [26]), that is in the SL Active time for the SL transmission occasion if SL DRX is applied for the destination, and having at least one of the MAC CE and the logical channel and pending SL-PRS transmission(s) with the highest priority, among the logical channels that satisfy all the following conditions and MAC CE(s), if any, and SL-PRS(s), if any for the SL grant associated to the SCI:\n4>\tSL data for NR sidelink communication is available for transmission; and\n4>\tSBj > 0, in case there is any logical channel having SBj > 0; and\n4>\tsl-configuredGrantType1Allowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and\n4>\tsl-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant; and\n4>\tsl-HARQ-FeedbackEnabled is set to disabled, if PSFCH is not configured for the SL grant associated to the SCI.\n4>\tallowed on the carrier where the SCI is transmitted, if the carrier is configured by upper layers according to TS 38.331 [5] and TS 23.287 [19], if multiple carrier frequencies are configured and if the MAC entity has been configured with Sidelink resource allocation mode 2; and\nNOTE 0:\tA LCH is allowed in a carrier based on whether this selected carrier is within a subset of frequencies associated with all the PC5 QoS flows allowed to be mapped to this LCH based on RRC configuration.\n4>\thaving a priority whose associated sl-threshCBR-FreqReselection is no lower than the CBR of the carrier when the carrier is (re-)selected in accordance with clause 5.22.1.11, if multiple carrier frequencies are configured and if the MAC entity has been configured with Sidelink resource allocation mode 2.\n1>\telse:\n2>\tif COT sharing information has been received from lower layers as specified in TS 37.213[18]:\n3>\tif resources used for initial transmission for the SL grant associated to the SCI are within the COT duration and MAC entity decides to use shared COT with type-2 LBT:\n4>\tselect a Destination associated to one of unicast, groupcast and broadcast that satisfy the following destination condition and CAPC condition, and having at least one of the MAC CE and the logical channel with the highest priority, among the logical channels that satisfy all the following conditions and MAC CE(s) satisfying CAPC and destination requirement, if any, for the SL grant associated to the SCI:\n5>\tif a Source Layer-1 ID and a Destination Layer-1 ID contained in the COT initiator's SCI match to the corresponding Destination Layer-1 ID and a Source Layer-1 IDs relating to the same unicast at the receiving UE and cast type indicator in the SCI is set to unicast; or if a Destination Layer-1 ID contained in the COT initiator's SCI match to a Destination Layer-1 ID known at the receiving UE and cast type indicator in the SCI is set to groupcast or broadcast; and\n5>\tif a CAPC value of the SL data has an equal or smaller CAPC value than a CAPC value indicated in the COT sharing information; and\n5>\tSL data is available for transmission; and\n5>\tSBj > 0, in case there is any logical channel having SBj > 0; and\n5>\tsl-configuredGrantType1Allowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and\n5>\tsl-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant; and\n5>\tsl-HARQ-FeedbackEnabled is set to disabled, if PSFCH is not configured for the SL grant associated to the SCI.\n2>\telse if sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon is not configured according to TS 38.331 [5]; and\n2>\tif the new transmission is not associated to a sidelink grant on SL-PRS dedicated resource pool:\n3>\tselect a Destination associated to one of unicast, groupcast and broadcast, that is in the SL Active time for the SL transmission occasion if SL DRX is applied for the destination, and having at least one of the MAC CE and the logical channel and pending SL-PRS transmission(s) with the highest priority, among the logical channels that satisfy all the following conditions and MAC CE(s), if any, and SL-PRS(s), if any, for the SL grant associated to the SCI:\n4>\tSL data is available for transmission; and\n4>\tSBj > 0, in case there is any logical channel having SBj > 0; and\n4>\tsl-configuredGrantType1Allowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and\n4>\tsl-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant; and\n4>\tsl-HARQ-FeedbackEnabled is set to disabled, if PSFCH is not configured for the SL grant associated to the SCI; and\n4>\tallowed on the carrier where the SCI is transmitted, if the carrier is configured by upper layers according to TS 38.331 [5] and TS 23.287 [19], if multiple carrier frequencies are configured and if the MAC entity has been configured with Sidelink resource allocation mode 2; and\n4>\thaving a priority whose associated sl-threshCBR-FreqReselection is no lower than the CBR of the carrier when the carrier is (re-)selected in accordance with clause 5.22.1.11, if multiple carrier frequencies are configured and if the MAC entity has been configured with Sidelink resource allocation mode 2.\nNOTE 1:\tIf multiple Destinations have the logical channels satisfying all conditions above with the same highest priority or if multiple Destinations have either the MAC CE and/or the logical channels satisfying all conditions above with the same priority as the MAC CE, which Destination is selected among them is up to UE implementation.\n1>\telse: (i.e., the sidelink grant is associated with SL-PRS dedicated resource pool)\n2>\tselect a Destination corresponding to the cast type of the SL grant and having pending SL-PRS transmission(s) with the highest priority for the SL grant associated to the SCI.\n1>\tselect the logical channels satisfying all the following conditions among the logical channels belonging to the selected Destination when the UL grant is not associated to a sidelink grant on SL-PRS dedicated resource pool:\n2>\tSL data is available for transmission; and\n2>\tsl-configuredGrantType1Allowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and.\n2>\tsl-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant; and\n2>\tallowed on the carrier where the SCI is transmitted, if the carrier is configured by upper layers according to TS 38.331 [5] and TS 23.287 [19], if multiple carrier frequencies are configured and if the MAC entity has been configured with Sidelink resource allocation mode 2; and\n2>\thaving a priority whose associated sl-threshCBR-FreqReselection is no lower than the CBR of the carrier when the carrier is (re-)selected in accordance with clause 5.22.1.11, if multiple carrier frequencies are configured if the MAC entity has been configured with Sidelink resource allocation mode 2; and\n2>\tCAPC value of the SL data has an equal or smaller CAPC value than a CAPC value indicated in the COT sharing information if MAC decides to use the shared COT; and\n2>\tsl-HARQ-FeedbackEnabled is set to the value that satisfies the following conditions:\n3>\tif PSFCH is configured for the sidelink grant associated to the SCI and the UE is capable of PSFCH reception:\n4>\tsl-HARQ-FeedbackEnabled is set to enabled, if sl-HARQ-FeedbackEnabled is set to enabled for the highest priority logical channel satisfying the above conditions; or\n4>\tsl-HARQ-FeedbackEnabled is set to disabled, if sl-HARQ-FeedbackEnabled is set to disabled for the highest priority logical channel satisfying the above conditions.\n3>\telse:\n4>\tsl-HARQ-FeedbackEnabled is set to disabled.\nNOTE 2:\tHARQ feedback enabled/disabled indicator is set to disabled for the transmission of a MAC PDU only carrying CSI reporting MAC CE or Sidelink DRX Command MAC CE or Sidelink Inter-UE Coordination Request MAC CE or Sidelink Inter-UE Coordination Information MAC CE.\nThe MAC entity shall for each sidelink grant associated with SL-PRS shared resource pool:\n1>\tif there is SL-PRS pending for transmission for the selected destination; and\n2>\tif all the SL-SCH data within logical channel with lower priority value than that of the SL-PRS can be allocated with resources when SL-PRS is transmitted:\n3>\tdetermine that the pending SL-PRS can be transmitted in the sidelink grant.\n2>\tderive the Transport Block Size for a new transmission for SL-SCH according to clause 8.1.3.2 in TS 38.214 [7].\nThe MAC entity shall for each SCI corresponding to a new transmission for SL-SCH:\n1>\tallocate resources to the logical channels as follows:\n2>\tlogical channels selected in clause 5.22.1.4.1.2 for the SL grant with SBj > 0 are allocated resources in a decreasing priority order. If the sPBR of a logical channel is set to infinity, the MAC entity shall allocate resources for all the data that is available for transmission on the logical channel before meeting the sPBR of the lower priority logical channel(s);\n2>\tdecrement SBj by the total size of MAC SDUs served to logical channel j above;\n2>\tif any resources remain, all the logical channels selected in clause 5.22.1.4.1.2 are served in a strict decreasing priority order (regardless of the value of SBj) until either the data for that logical channel or the SL grant is exhausted, whichever comes first. Logical channels configured with equal priority should be served equally.\nNOTE 1:\tThe value of SBj can be negative.\nThe UE shall also follow the rules below during the SL scheduling procedures above:\n-\tthe UE should not segment an RLC SDU (or partially transmitted SDU or retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or retransmitted RLC PDU) fits into the remaining resources of the associated MAC entity;\n-\tif the UE segments an RLC SDU from the logical channel, it shall maximize the size of the segment to fill the grant of the associated MAC entity as much as possible;\n-\tthe UE should maximise the transmission of data;\n-\tif the MAC entity is given a sidelink grant size that is equal to or larger than 12 bytes while having data available and allowed (according to clause 5.22.1.4.1) for transmission, the MAC entity shall not transmit only padding;\n-\tA logical channel configured with sl-HARQ-FeedbackEnabled set to enabled and a logical channel configured with sl-HARQ-FeedbackEnabled set to disabled cannot be multiplexed into the same MAC PDU.\nThe MAC entity shall not generate a MAC PDU for the HARQ entity if the following conditions are satisfied:\n-\tthere is no Sidelink CSI Reporting MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.7; and\n-\tthere is no Sidelink DRX Command MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.8; and\n-\tthere is no Sidelink Inter-UE Coordination Request MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.9; and\n-\tthere is no Sidelink Inter-UE Coordination Information MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.10; and\n-\tthe MAC PDU includes zero MAC SDUs and the MAC PDU is not associated with SL-PRS transmission on SL-PRS shared resource pool.\nLogical channels shall be prioritised in accordance with the following order (highest priority listed first):\n-\tdata from SCCH;\n-\tSidelink CSI Reporting MAC CE;\n-\tSidelink Inter-UE Coordination Request MAC CE and Sidelink Inter-UE Coordination Information MAC CE;\n-\tSidelink DRX Command MAC CE;\n-\tdata from any STCH or SL-PRS.\nNOTE 2:\tThe priority order between Sidelink Inter-UE Coordination Request MAC CE and Sidelink Inter-UE Coordination Information MAC CE is up to UE implementation.\nThe MAC entity shall multiplex MAC CEs and MAC SDUs in a MAC PDU according to clauses 5.22.1.4.1 and 6.1.6.\nIn addition to clause 5.4.4, the Scheduling Request (SR) is also used for requesting SL-SCH resources for new transmission when triggered by the Sidelink BSR (clause 5.22.1.6) or the SL-CSI reporting (clause 5.22.1.7) or SL-DRX Command indication or SL consistent LBT failure recovery (see clause 5.31.2) or SL-PRS Resource Request (clause 6.1.3.74). If configured, the MAC entity performs the SR procedure as specified in this clause unless otherwise specified in clause 5.4.4. For a sidelink logical channel or for SL-CSI reporting or for SL-DRX Command indication or for SL consistent LBT failure recovery or for SL-PRS Resource Request, at most one PUCCH resource for SR is configured per UL BWP.\nThe SR configuration of the logical channel that triggered the Sidelink BSR (clause 5.22.1.6) is also considered as corresponding SR configuration for the triggered SR (clause 5.4.4). The value of the priority of the triggered SR corresponds to the value of priority of the logical channel that triggered the SR.\nEach sidelink logical channel and SL consistent LBT failure recovery may be mapped to zero or one SR configuration, which is configured by RRC. If the SL-CSI reporting procedure is enabled by RRC, the SL-CSI reporting is mapped to one SR configuration for all PC5-RRC connections. The SR configuration of the SL-CSI reporting triggered according to 5.22.1.7 is considered as corresponding SR configuration for the triggered SR (clause 5.4.4). The value of the priority of the triggered SR triggered by SL-CSI reporting corresponds to the value of the priority of the Sidelink CSI Reporting MAC CE. The SR configuration of the SL-CSI reporting is considered as corresponding SR configuration for the triggered SR of SL-DRX Command indication triggered according to 5.28.3. The value of the priority of the triggered SR triggered by SL-DRX Command indication corresponds to the value of the priority of the Sidelink DRX Command MAC CE. The SR configuration of the SL consistent LBT failure recovery triggered according to 5.31.2 is considered as corresponding SR configuration for the triggered SR (clause 5.4.4). The value of the priority of the triggered SR triggered by SL consistent LBT failure recovery corresponds to the value of the priority of the SL LBT failure MAC CE. Each SL-PRS priority may be mapped to zero or one SR configuration, which is configured by RRC. The value of the priority of the triggered SR triggered by SL-PRS resource request corresponds to the value of the priority of the SL-PRS triggering the SL-PRS Resource Request MAC CE.\nAll pending SR(s) triggered according to the Sidelink BSR procedure (clause 5.22.1.6) prior to the MAC PDU assembly shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the MAC PDU is transmitted and this PDU includes an SL-BSR MAC CE which contains buffer status up to (and including) the last event that triggered a Sidelink BSR (see clause 5.22.1.4) prior to the MAC PDU assembly.\nAll pending SR(s) triggered according to the Sidelink consistent LBT failure recovery (clause 5.31.2) shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the MAC PDU is transmitted and this PDU includes an SL LBT failure MAC CE that indicates Sidelink consistent LBT failure or when all the triggered Sidelink consistent LBT failure(s) for an SL BWP is cancelled.\nAll pending SR(s) triggered according to the Sidelink BSR procedure (clause 5.22.1.6) shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the SL grant(s) can accommodate all pending data available for transmission in sidelink.\nIf there is pending SR triggered by Sidelink consistent LBT failure recovery which has no corresponding SR configuration, MAC entity initiate a Random Access procedure (see clause 5.1) on the Serving Cell and cancel the pending SR.\nThe pending SR triggered according to the SL-CSI reporting for a destination shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the SL grant(s) can accommodate the Sidelink CSI Reporting MAC CE when the SL-CSI reporting that has been triggered but not cancelled or when the triggered SL-CSI reporting is cancelled due to latency non-fulfilment as specified in 5.22.1.7. The pending SR triggered according to the SL-DRX Command indication for a destination shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the SL grant(s) can accommodate the Sidelink DRX Command MAC CE when the SL-DRX Command indication that has been triggered but not cancelled. All pending SR(s) triggered by either Sidelink BSR or Sidelink CSI report or Sidelink DRX Command indication shall be cancelled, when RRC configures Sidelink resource allocation mode 2.\nAll pending SR(s) triggered according to the SL-PRS Resource Request procedure (clause 5.22.1.12) prior to the MAC PDU assembly shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the MAC PDU is transmitted and this PDU includes an SL-PRS Resource Request MAC CE which contains status of the pending SL-PRS transmission(s) up to (and including) the last event that triggered a SL-PRS Resource Request (see clause 5.22.1.12) prior to the MAC PDU assembly.\nAll pending SR(s) triggered according to the SL-PRS Resource Request procedure (clause 5.22.1.12) shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the SL grant(s) can accommodate the all the pending SL-PRS transmission(s).\nThe Sidelink Buffer Status reporting (SL-BSR) procedure is used to provide the serving gNB with information about SL data volume in the MAC entity.\nRRC configures the following parameters to control the SL-BSR:\n-\tsl-periodicBSR-Timer, configured by periodicBSR-Timer in sl-BSR-Config;\n-\tsl-retxBSR-Timer, configured by retxBSR-Timer in sl-BSR-Config;\n-\tsl-logicalChannelSR-DelayTimerApplied;\n-\tsl-logicalChannelSR-DelayTimer, configured by logicalChannelSR-DelayTimer in sl-BSR-Config;\n-\tsl-logicalChannelGroup.\nEach logical channel which belongs to a Destination is allocated to an LCG as specified in TS 38.331 [5]. The maximum number of LCGs is eight.\nThe MAC entity determines the amount of SL data available for a logical channel according to the data volume calculation procedure in TSs 38.322 [3] and 38.323 [4].\nAn SL-BSR shall be triggered if any of the following events occur:\n1>\tif the MAC entity has been configured with Sidelink resource allocation mode 1:\n2>\tSL data, for a logical channel which belongs to an LCG of a Destination, becomes available to the MAC entity; and either\n3>\tthis SL data belongs to a logical channel with higher priority than the priorities of the logical channels containing available SL data which belong to any LCG belonging to the same Destination; or\n3>\tnone of the logical channels which belong to an LCG belonging to the same Destination contains any available SL data.\nin which case the SL-BSR is referred below to as 'Regular SL-BSR';\n2>\tUL resources are allocated and number of padding bits remaining after a Padding BSR has been triggered is equal to or larger than the size of the SL-BSR MAC CE plus its subheader, in which case the SL-BSR is referred below to as 'Padding SL-BSR';\n2>\tsl-retxBSR-Timer expires, and at least one of the logical channels which belong to an LCG contains SL data, in which case the SL-BSR is referred below to as 'Regular SL-BSR';\n2>\tsl-periodicBSR-Timer expires, in which case the SL-BSR is referred below to as 'Periodic SL-BSR'.\n1>\telse:\n2>\tSidelink resource allocation mode 1 is configured by RRC and SL data is available for transmission in the RLC entity or in the PDCP entity, in which case the Sidelink BSR is referred below to as 'Regular SL-BSR'.\nFor Regular SL-BSR, the MAC entity shall:\n1>\tif the SL-BSR is triggered for a logical channel for which sl-logicalChannelSR-DelayTimerApplied with value true is configured by RRC:\n2>\tstart or restart the sl-logicalChannelSR-DelayTimer.\n1>\telse:\n2>\tif running, stop the sl-logicalChannelSR-DelayTimer.\nFor Regular and Periodic SL-BSR, the MAC entity shall:\n1>\tif sl-PrioritizationThres is configured and the value of the highest priority of the logical channels that belong to any LCG and contain SL data for any Destination is lower than sl-PrioritizationThres; and\n1>\tif ul-PrioritizationThres is configured and the value of the highest priority of the logical channels that belong to any LCG and contain UL data is equal to or higher than ul-PrioritizationThres according to clause 5.4.5:\n2>\tprioritize the LCG(s) for the Destination(s).\n1>\tif the Buffer Status reporting procedure determines that at least one BSR has been triggered and not cancelled according to clause 5.4.5 and the UL grant cannot accommodate an SL-BSR MAC CE containing buffer status only for all prioritized LCGs having data available for transmission plus the subheader of the SL-BSR according to clause 5.4.3.1.3, in case the SL-BSR is considered as not prioritized:\n2>\tprioritize the SL-BSR for logical channel prioritization specified in clause 5.4.3.1;\n2>\treport Truncated SL-BSR containing buffer status for as many prioritized LCGs having data available for transmission as possible, taking the number of bits in the UL grant into consideration.\n1>\telse if the number of bits in the UL grant is expected to be equal to or larger than the size of an SL-BSR containing buffer status for all LCGs having data available for transmission plus the subheader of the SL-BSR according to clause 5.4.3.1.3:\n2>\treport SL-BSR containing buffer status for all LCGs having data available for transmission.\n1>\telse:\n2>\treport Truncated SL-BSR containing buffer status for as many LCGs having data available for transmission as possible, taking the number of bits in the UL grant into consideration.\nFor Padding SL-BSR:\n1>\tif the number of padding bits remaining after a Padding BSR has been triggered is equal to or larger than the size of an SL-BSR containing buffer status for all LCGs having data available for transmission plus its subheader:\n2>\treport SL-BSR containing buffer status for all LCGs having data available for transmission;\n1>\telse:\n2>\treport Truncated SL-BSR containing buffer status for as many LCGs having data available for transmission as possible, taking the number of bits in the UL grant into consideration.\nFor SL-BSR triggered by sl-retxBSR-Timer expiry, the MAC entity considers that the logical channel that triggered the SL-BSR is the highest priority logical channel that has data available for transmission at the time the SL-BSR is triggered.\nThe MAC entity shall:\n1>\tif the sidelink Buffer Status reporting procedure determines that at least one SL-BSR has been triggered and not cancelled:\n2>\tif UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the SL-BSR MAC CE plus its subheader as a result of logical channel prioritization according to clause 5.4.3.1:\n3>\tinstruct the Multiplexing and Assembly procedure in clause 5.4.3 to generate the SL-BSR MAC CE(s);\n3>\tstart or restart sl-periodicBSR-Timer except when all the generated SL-BSRs are Truncated SL-BSRs;\n3>\tstart or restart sl-retxBSR-Timer.\n2>\tif a Regular SL-BSR has been triggered and sl-logicalChannelSR-DelayTimer is not running:\n3>\tif there is no UL-SCH resource available for a new transmission; or\n3>\tif UL-SCH resources are available for a new transmission and the UL-SCH resources cannot accommodate the SL-BSR MAC CE plus its subheader as a result of logical channel prioritization according to clause 5.4.3.1; or\n3>\tif the set of Subcarrier Spacing index values in sl-AllowedSCS-List, if configured for the logical channel that triggered the SL-BSR, does not include the Subcarrier Spacing index associated to the UL-SCH resources available for a new transmission; or\n3>\tif sl-MaxPUSCH-Duration, if configured for the logical channel that triggered the SL-BSR, is smaller than the PUSCH transmission duration associated to the UL-SCH resources available for a new transmission:\n4>\ttrigger a Scheduling Request.\nNOTE 1:\tUL-SCH resources are considered available if the MAC entity has been configured with, receives, or determines an uplink grant. If the MAC entity has determined at a given point in time that UL-SCH resources are available, this need not imply that UL-SCH resources are available for use at that point in time.\nA MAC PDU shall contain at most one SL-BSR MAC CE, even when multiple events have triggered an SL-BSR. The Regular SL-BSR and the Periodic SL-BSR shall have precedence over the padding SL-BSR.\nThe MAC entity shall restart sl-retxBSR-Timer upon reception of an SL grant for transmission of new data on any SL-SCH.\nAll triggered SL-BSRs may be cancelled when the SL grant(s) can accommodate all pending data available for transmission. All BSRs triggered prior to MAC PDU assembly shall be cancelled when a MAC PDU is transmitted and this PDU includes an SL-BSR MAC CE which contains buffer status up to (and including) the last event that triggered an SL-BSR prior to the MAC PDU assembly. All triggered SL-BSRs shall be cancelled, and sl-retx-BSR-Timer and sl-periodic-BSR-Timer shall be stopped, when RRC configures Sidelink resource allocation mode 2.\nNOTE 2:\tMAC PDU assembly can happen at any point in time between uplink grant reception and actual transmission of the corresponding MAC PDU. SL-BSR and SR can be triggered after the assembly of a MAC PDU which contains an SL-BSR MAC CE, but before the transmission of this MAC PDU. In addition, SL-BSR and SR can be triggered during MAC PDU assembly.\nThe Sidelink Channel State Information (SL-CSI) reporting procedure is used to provide a peer UE with sidelink channel state information as specified in clause 8.5 of TS 38.214 [7].\nRRC configures the following parameters to control the SL-CSI reporting procedure:\n-\tsl-LatencyBoundCSI-Report, which is maintained for each PC5-RRC connection.\nThe MAC entity maintains an sl-CSI-ReportTimer for each pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to a PC5-RRC connection. sl-CSI-ReportTimer is used for an SL-CSI reporting UE to follow the latency requirement signalled from a CSI triggering UE. The value of sl-CSI-ReportTimer is the same as the‎ latency requirement of the SL-CSI reporting in sl-LatencyBoundCSI-Report configured by RRC.\nThe MAC entity shall for each pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to a PC5-RRC connection which has been established by upper layers:\n1>\tif the SL-CSI reporting has been triggered by an SCI and not cancelled:\n2>\tif the sl-CSI-ReportTimer for the triggered SL-CSI reporting is not running:\n3>\tstart the sl-CSI-ReportTimer.\n2>\tif the sl-CSI-ReportTimer for the triggered SL-CSI reporting expires:\n3>\tcancel the triggered SL-CSI reporting.\n2>\telse if the MAC entity has SL resources allocated for new transmission and the SL-SCH resources can accommodate the SL-CSI reporting MAC CE and its subheader as a result of logical channel prioritization:\n3>\tinstruct the Multiplexing and Assembly procedure to generate a Sidelink CSI Reporting MAC CE as defined in clause 6.1.3.35;\n3>\tstop the sl-CSI-ReportTimer for the triggered SL-CSI reporting;\n3>\tcancel the triggered SL-CSI reporting.\n2>\telse if the MAC entity has been configured with Sidelink resource allocation mode 1:\n3>\ttrigger a Scheduling Request.\nNOTE 1:\tThe MAC entity configured with Sidelink resource allocation mode 1 may trigger a Scheduling Request if transmission of a pending SL-CSI reporting with the sidelink grant(s) cannot fulfil the latency requirement associated to the SL-CSI reporting.\nNOTE 2:\tRegardless of a carrier that receives an indicator triggering SL-CSI reporting in the SL Carrier Aggregation, it is up to UE implementation to decide which carrier the UE sends SL-CSI reporting MAC CE.\nThe Sidelink Inter-UE Coordination Request transmission procedure is used to trigger a peer UE to transmit Sidelink Inter-UE Coordination Information as specified in clause 8.4.1.3 of TS 38.212 [9].\nThe Sidelink Inter-UE Coordination Information reporting procedure is used to provide a peer UE with inter-UE coordination information as specified in clause 8.1.4 of TS 38.214 [7]. The Sidelink Inter-UE Coordination reporting procedure can be triggered by Sidelink Inter-UE Coordination Request MAC CE or condition (See TS 38.331 [5] and TS 38.214 [7]). Unicast for preferred resource set and non-preferred resource set and Groupcast/Broadcast for non-preferred resource set are supported for inter-UE coordination information transmission triggered by a condition other than explicit request reception.\nRRC configures the following parameter to control the SL-IUC Information reporting procedure:\n-\tsl-LatencyBoundIUC-Report, which is maintained for each PC5-RRC connection.\nThe MAC entity maintains an sl-IUC-ReportTimer for each pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to a PC5-RRC connection. sl-IUC-ReportTimer is used for an SL-IUC Information reporting UE to follow the latency requirement signalled from an IUC-Information triggering UE. The value of sl-IUC-ReportTimer is the same as the‎ latency requirement of the SL-IUC Information in sl-LatencyBoundIUC-Report configured by RRC.\nThe MAC entity shall for each pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to a PC5-RRC connection which has been established by upper layers:\n1>\tif the SL-IUC Information reporting has been triggered by an SL-IUC Request MAC CE (and/or an SCI) and not cancelled:\n2>\tif the sl-IUC-ReportTimer for the triggered SL-IUC Information reporting is not running:\n3>\tstart the sl-IUC-ReportTimer.\n2>\tif the sl-IUC-ReportTimer for the triggered SL-IUC Information reporting expires:\n3>\tcancel the triggered SL-IUC Information reporting.\n2>\telse if the MAC entity has SL resources allocated for new transmission and the SL-SCH resources can accommodate the SL-IUC Information MAC CE and its subheader as a result of logical channel prioritization:\n3>\tinstruct the Multiplexing and Assembly procedure to generate a Sidelink Inter-UE Coordination Information MAC CE as defined in clause 6.1.3.53;\n3>\tstop the sl-IUC-ReportTimer for the triggered SL-IUC Information reporting;\n3>\tcancel the triggered SL-IUC Information reporting.\nUpon the reception of SL-IUC Information MAC CE from another UE, the MAC entity shall:\n1>\tif sl-InterUE-CoordinationScheme1 enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC:\n2>\tif the SL-IUC Information MAC CE contains a non-preferred resource set and if the UE is configured to use full sensing or partial sensing in the resource pool where the non-preferred resource set is located:\n3>\tindicate the received non-preferred resource set to physical layer.\nThe MAC entity shall consider a CBR of a carrier to be one measured by lower layers according to TS 38.214 [7] if CBR measurement results are available, or the corresponding sl-defaultTxConfigIndex configured by upper layers if CBR measurement results are not available.\nIf the TX carrier (re-)selection is triggered for a Sidelink process according to clause 5.22.1.1, the MAC entity shall:\n1>\tif there is no selected sidelink grant on any carrier allowed for the sidelink logical channel where data is available as indicated by upper layers (TS 38.331 [5] and TS 23.287 [19]):\n2>\tfor each carrier configured by upper layers associated with the concerned sidelink logical channel:\n3>\tif the CBR of the carrier is below sl-threshCBR-FreqReselection associated with the priority of the sidelink logical channel:\nNOTE 1:\tIn the case of multiple resource pools configured on a carrier, which specific resource pool is used to determine the CBR of this carrier is up to UE implementation.\n4>\tconsider the carrier as a candidate carrier for TX carrier (re-)selection for the concerned sidelink logical channel when the carrier satisfies all the following conditions;\n5>\tif sl-HARQ-FeedbackEnabled is set to enabled for the sidelink logical channel:\n6>\tthe carrier includes at least one pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured.\n5>\telse:\n6>\tthe carrier includes any pool of resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured.\n1>\telse:\n2>\tif the CBR of the carrier is below sl-threshCBR-FreqKeeping associated with priority of the sidelink logical channel, for each sidelink logical channel, if any, where data is available and that are allowed on the carrier for which Tx carrier (re-)selection is triggered according to clause 5.22.1.1:\n3>\tselect the carrier and the associated pool of resources.\n2>\telse:\n3>\tif the CBR of the carrier is below sl-threshCBR-FreqReselection associated with the priority of the sidelink logical channel:\n4>\tconsider the carrier as a candidate carrier for TX carrier (re-)selection, for each carrier configured by upper layers on which the sidelink logical channel is allowed when the carrier satisfies all the following conditions;\n5>\tif sl-HARQ-FeedbackEnabled is set to enabled for the sidelink logical channel:\n6>\tthe carrier includes at least one pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured.\n5>\telse:\n6>\tthe carrier includes any pool of resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured.\nThe MAC entity shall:\n1>\tif one or more carriers are considered as the candidate carriers for TX carrier (re-)selection:\n2>\tif Tx carrier (re-)selection is triggered, for each sidelink logical channel allowed on the carrier where data is available:\n3>\tselect one or more carrier(s) and associated pool(s) of resources among the candidate carriers with increasing order of CBR from the lowest CBR.\nNOTE 2:\tIt is left to UE implementation how many carriers to select based on UE capability.\nNOTE 3:\tIt is left to UE implementation to determine the sidelink logical channels among the sidelink logical channels where data is available and that are allowed on the carrier for which Tx carrier (re-) selection is triggered.\nSL-PRS transmission can be triggered either by lower layer signalling from the peer UE or the UE's own higher layer. The SL-PRS Resource Request procedure is used to provide gNB with information about the triggered SL-PRS transmission.\nThe MAC entity shall, if Sidelink resource allocation scheme 1 for SL-PRS transmission is configured:\n1>\tif aperiodic SL-PRS is triggered:\n2>\ttrigger the SL-PRS Resource Request.\n1>\telse if periodic SL-PRS is triggered:\n2>\tnotify RRC to send SL-PRS Resource Request.\nThe MAC entity shall:\n1>\tif SL-PRS Resource Request is triggered and not cancelled:\n2>\tif UL-SCH resources are available for a new transmission and these UL-SCH resources can accommodate the SL-PRS Resource Request MAC CE plus its subheader as a result of logical channel prioritization:\n3>\tinstruct the Multiplexing and Assembly entity to generate the SL-PRS Resource Request MAC CE.\n2>\telse:\n3>\ttrigger a Scheduling Request for the SL-PRS Resource Request MAC CE as specified in clause 5.4.4.\nThe SL-PRS Resource Request MAC CE may be cancelled when SL grant can accommodate all the pending SL-PRS transmissions. The SL-PRS Resource Request MAC CE shall be cancelled when a MAC PDU is transmitted and this PDU includes a SL-PRS Resource Request MAC CE that indicates request for all the pending SL-PRS transmission(s) since the last event the MAC CE is triggered.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.22.2\tSL-SCH Data and SL-PRS reception",
                            "text_content": "SCI indicates if there is a transmission on SL-SCH and provide the relevant HARQ information. SCI can also indicate if there is a SL-PRS transmission. An SCI for SL-SCH transmission with or without corresponding SL-PRS on SL-PRS shared resource pool consists of two parts: the 1st stage SCI on PSCCH and the 2nd stage SCI on PSSCH as specified in clause 8.1 of TS 38.214 [7]. An SCI for SL-PRS transmission on SL-PRS dedicated resource pool consists of a single part on PSCCH as specified in TS 38.212 [9].\nThe MAC entity shall:\n1>\tfor each PSCCH duration during which the MAC entity monitors PSCCH:\n2>\tif a 1st stage SCI has been received on the PSCCH:\n3>\tdetermine the set of PSSCH durations in which reception of a 2nd stage SCI and the transport block occur using the received part of the SCI;\n3>\tif the 2nd stage SCI for this PSSCH duration has been received on the PSSCH:\n4>\tstore the SCI as a valid SCI for the PSSCH durations corresponding to transmission(s) of the transport block and SL-PRS, if available and the associated HARQ information and QoS information;\n2>\telse if an SCI has been received on the PSCCH reception on SL-PRS dedicated resource pool for SL-PRS transmission:\n3>\tdetermine the SL-PRS transmission occasion corresponding to the SCI;\n3>\tstore the SCI as a valid SCI for the SL-PRS transmission and the corresponding SL-PRS transmission information on SL-PRS dedicated resource pool.1>\tfor each PSSCH duration for which the MAC entity has a valid SCI:\n2>\tdeliver the SCI and the associated Sidelink transmission information to the Sidelink HARQ Entity.\n1>\tfor each SL-PRS transmission occasion for which MAC entity has a valid SCI:\n2>\tperform SL-PRS reception according to the SL-PRS transmission information within the SCI as in clause 5.22.2.2.2 for SL-PRS received on SL-PRS shared resource pool and as in clause 5.22.2.4 for SL-PRS received on SL-PRS dedicated resource pool.\nThere is at most one Sidelink HARQ Entity at the MAC entity for reception of the SL-SCH, which maintains a number of parallel Sidelink processes.\nEach Sidelink process is associated with SCI in which the MAC entity is interested. This interest is determined by the Sidelink identification information of the SCI. The Sidelink HARQ Entity directs Sidelink transmission information and associated TBs received on the SL-SCH to the corresponding Sidelink processes.\nThe number of Receiving Sidelink processes associated with the Sidelink HARQ Entity is defined in TS 38.306 [5].\nFor each PSSCH duration, the Sidelink HARQ Entity shall:\n1>\tfor each SCI valid for this PSSCH duration:\n2>\tif the NDI has been toggled compared to the value of the previous received transmission corresponding to the Sidelink identification information and the Sidelink process ID of the SCI or this is the very first received transmission for the pair of the Sidelink identification information and the Sidelink process ID of the SCI:\n3>\tif there is a Sidelink process associated with the Sidelink identification information and the Sidelink process ID of the SCI:\n4>\tconsider the Sidelink process as unoccupied;\n4>\tflush the soft buffer for the Sidelink process.\n3>\tallocate the TB received from the physical layer and the associated Sidelink identification information and Sidelink process ID to an unoccupied Sidelink process;\n3>\tassociate the Sidelink process with the Sidelink identification information and the Sidelink process ID of this SCI and consider this transmission to be a new transmission.\nNOTE 1:\tWhen a new TB arrives, the Sidelink HARQ Entity allocates the TB to any unoccupied Sidelink process. If there is no unoccupied Sidelink process in the Sidelink HARQ entity, how to manage receiving Sidelink processes is up to UE implementation.\nNOTE 1a:\tIf the NDI has not been toggled compared to the value of the previous received transmission corresponding to the Sidelink identification information and the Sidelink process ID of the SCI, and if there is no Sidelink process associated with the Sidelink identification information and the Sidelink process ID of the SCI, it is up to UE implementation to handle the corresponding TB.\n1>\tfor each Sidelink process:\n2>\tif the NDI has not been toggled compared to the value of the previous received transmission corresponding to the Sidelink identification information and the Sidelink process ID of the SCI for the Sidelink process according to its associated SCI:\n3>\tallocate the TB received from the physical layer to the Sidelink process and consider this transmission to be a retransmission.\nNOTE 2:\tA single sidelink process can only be (re-)associated to a single combination of Sidelink identification information and Sidelink process ID at a time and a single combination of Sidelink identification information and Sidelink process ID can only be (re-)associated to a single sidelink process at a time.\nFor each PSSCH duration where a transmission takes place for the Sidelink process, one TB and the associated HARQ information is received from the Sidelink HARQ Entity.\nFor each received TB and SL-PRS, if available and associated Sidelink transmission information, the Sidelink process shall:\n1>\tif this is a new transmission:\n2>\tattempt to decode the received data.\n1>\telse if this is a retransmission:\n2>\tif the data for this TB has not yet been successfully decoded:\n3>\tinstruct the physical layer to combine the received data with the data currently in the soft buffer for this TB and attempt to decode the combined data.\n1>\tif the sidelink transmission information in the SCI indicates SL-PRS transmission:\n2>\tif the SL-PRS transmission is associated to unicast:\n3>\tif the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Source Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI; and\n3>\tif the SRC field of the decoded MAC PDU subheader is equal to the 16 MSB of any of the Destination Layer-2 ID(s) of the UE for which the 8 LSB are equal to the Source ID in the corresponding SCI:\n4>\tinstruct the physical layer to perform SL-PRS reception.\n2>\telse if the SL-PRS tnramission is associated with groupcast or broadcast:\n3>\tif the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Destination Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI:\n4>\tinstruct the physical layer to perform SL-PRS reception.\n1>\tif the data which the MAC entity attempted to decode was successfully decoded for this TB; or\n1>\tif the data for this TB was successfully decoded before:\n2>\tif this is the first successful decoding of the data for this TB:\n3>\tif this TB is associated to unicast and the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Source Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI:\n4>\tif the SRC field of the decoded MAC PDU subheader is equal to the 16 MSB of any of the Destination Layer-2 ID(s) of the UE for which the 8 LSB are equal to the Source ID in the corresponding SCI; or\n4>\tif this TB is corresponding to the logical channel with LCID equal to 0 or 1 and determined to be the first TB:\n5>\tdeliver the decoded MAC PDU to the disassembly and demultiplexing entity.\n3>\tif this TB is associated to groupcast or broadcast:\n4>\tif the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Destination Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI; or\n4>\tif this TB is corresponding to the logical channel with LCID equal to 58, and the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Source Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI:\n5>\tdeliver the decoded MAC PDU to the disassembly and demultiplexing entity.\nNOTE:\tWhether the TB is the first TB can be determined based on the Source Layer-2 ID and Destination Layer-2 ID pair.\n2>\tconsider the Sidelink process as unoccupied.\n1>\telse:\n2>\tinstruct the physical layer to replace the data in the soft buffer for this TB with the data which the MAC entity attempted to decode.\n1>\tif HARQ feedback is enabled by the SCI:\n2>\tif negative-only acknowledgement is indicated by the SCI according to clause 8.4.1 of TS 38.212 [9]:\n3>\tif UE's location information is available and distance beteween UE's location and the central location of the nearest zone that is calculated based on the Zone_id in the SCI and the value of sl-ZoneLength corresponding to the communication range requirement in the SCI as specified in TS 38.331 [5] is smaller or equal to the communication range requirement in the SCI; or\n3>\tif none of Zone_id and communication range requirement is indicated by the SCI; or\n3>\tif UE's location information is not available:\n4>\tif the data which the MAC entity attempted to decode was not successfully decoded for this TB and the data for this TB was not successfully decoded before:\n5>\tinstruct the physical layer to generate a negative acknowledgement of the data in this TB.\n2>\tif negative-positive acknowledgement or unicast is indicated by the SCI according to clause 8.4.1 of TS 38.212 [9]:\n3>\tif the data which the MAC entity attempted to decode was successfully decoded for this TB or the data for this TB was successfully decoded before:\n4>\tinstruct the physical layer to generate a positive acknowledgement of the data in this TB.\n3>\telse:\n4>\tinstruct the physical layer to generate a negative acknowledgement of the data in this TB.\nThe MAC entity shall disassemble and demultiplex a MAC PDU as defined in clause 6.1.6.\nFor each SL-PRS transmission occasion on SL-PRS dedicated resource pool, the MAC entity shall:\n1>\tif this SL-PRS transmission is associated to unicast:\n2>\tif the destination ID in the corresponding SCI is equal to the UE's source ID; and if [12bitSourceID] is configured:\n3>\tif source ID in the corresponding SCI is equal to the 12 LSB of the UE's destination layer-2 ID:\n4>\tinstruct the physical layer to perform SL-PRS reception on the SL-PRS transmission occasion.\n2>\telse if the destination ID in the corresponding SCI is equal to the UE's source ID, and if [24bitSourceID] is configured:\n3>\tif source ID in the corresponding SCI is equal to the UE's destination layer-2 ID:\n4>\tinstruct the physical layer to perform SL-PRS reception on the SL-PRS transmission occasion.\n1>\telse if this SL-PRS transmission is associated to broadcast or groupcast:\n2>\tif the destination ID in the corresponding SCI is equal to the UE's destination layer-2 ID\n3>\tinstruct the physical layer to perform SL-PRS reception on the SL-PRS transmission occasion.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.23\tSL-BCH data transfer",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.23.1\tSL-BCH data transmission",
                            "text_content": "When instructed to send SL-BCH, the MAC entity shall:\n1>\tobtain the MAC PDU to transmit from SBCCH;\n1>\tdeliver the MAC PDU to the physical layer and instruct it to generate a transmission.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.23.2\tSL-BCH data reception",
                            "text_content": "When the MAC entity needs to receive SL-BCH, the MAC entity shall:\n1>\treceive and attempt to decode the SL-BCH;\n1>\tif a TB on the SL-BCH has been successfully decoded:\n2>\tdeliver the decoded MAC PDU to upper layers.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.24\tHandling of PRS Processing Window",
                    "description": "",
                    "summary": "",
                    "text_content": "When PPW is activated and PRS has higher priority than DL channel and signals, for the affected symbols within the PPW according to clause 5.1.6.5 in TS 38.214 [7], the MAC entity shall:\n1>\tif the ra-ResponseWindow or the ra-ContentionResolutionTimer or the msgB-ResponseWindow is running:\n2>\tmonitor the PDCCH as specified in clauses 5.1.4 and 5.1.5.\n1>\telse:\n2>\tnot receive DL-SCH;\n2>\tnot receive PDCCH.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.25\tPositioning Measurement Gap Activation/Deactivation Request",
                    "description": "",
                    "summary": "",
                    "text_content": "If the UE is configured with pre-configured positioning measurement gap and the request of the activation/deactivation of the positioning measurement gap by UL MAC CE, the UE may request the network to activate or deactivate the Positioning measurement gap with UL MAC CE for Positioning Measurement Gap Activation/Deactivation Request in clause 6.1.3.40.\nThe MAC entity shall, when triggered by the upper layer to send Positioning Measurement Gap Activation/Deactivation Request, cancel the triggered Positioning Measurement Gap Activation/Deactivation Request, if any and trigger another Positioning Measurement Gap Activation/Deactivation Request according to the upper layer's request.\nThe MAC entity shall,\n1>if Positioning Measurement Gap Activation/Deactivation Request MAC CE has been triggered, and not cancelled:\n2>\tif indication from upper layer has been received that the triggered Positioning Measurement Gap Activation/Deactivation Request MAC CE should be cancelled; or\n2>\tif the pre-configured measurement gap indicated in the Positioning Measurement Gap Activation/Deactivation Request MAC CE has already been activated/deactivated according to clause 5.18.20:\n3>\tcancel the triggered Positioning Measurement Gap Activation/Deactivation Request MAC CE.\n2>\tif UL-SCH resources are available for a new transmission and these UL-SCH resources can accommodate the Positioning Measurement Gap Activation/Deactivation Request MAC CE plus its subheader as a result of logical channel prioritization:\n3>\tinstruct the Multiplexing and Assembly procedure to generate the Positioning Measurement Gap Activation/Deactivation Request MAC CE according to the upper layer's request;\n3>\tcancel triggered Positioning Measurement Gap Activation/Deactivation Request MAC CE.\n2>\telse:\n3>\ttrigger a Scheduling Request for Positioning Measurement Gap Activation/Deactivation Request MAC CE as specified in clause 5.4.4.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.26\tPositioning SRS transmission in RRC_INACTIVE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.26.1\tGeneral",
                            "text_content": "Periodic and semi-persistent Positioning SRS with or without positioning SRS bandwidth aggregation can be configured for Positioning SRS transmission in RRC_INACTIVE.\nSRS for positioning Tx frequency hopping as in clause 5.32 can also be configured for Positioning SRS transmission in RRC_INACTIVE.\nThe MAC entity shall,\n1>\tif the TA of the configured Positioning SRS is valid according to clause 5.26.2, and the conditions for positioning SRS transmission in clause 7.3.1 of TS 38.213 [6] and clause 6.2.1.4 of TS 38.214 [7] are satisfied:\n2>\tif the UE is configured with UTW and the UplinkTimeWindowTimer is running according to clause 5.32; or\n2>\tif the UE is not configured with UTW:\n3>\tinstruct to the lower layer according to TS 38.214 [7] to transmit Positioning Periodic SRS or Semi-Persistent SRS that is activated according to clause 5.18.17.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.26.2\tTA validation for SRS transmission in RRC_INACTIVE",
                            "text_content": "RRC configures the following parameters for validation for SRS transmission in RRC_INACTIVE:\n-\tinactivePosSRS-RSRP-ChangeThreshold: RSRP threshold for the increase/decrease of RSRP for time alignment validation.\nThe MAC entity shall:\n1>\tif the UE receives configuration for SRS transmission in RRC_INACTIVE:\n2>\tstore the RSRP of the downlink pathloss reference with the current RSRP value of the downlink pathloss reference as in TS 38.331 [5].\n1>\telse if the UE is configured with SRS transmission in RRC_INACTIVE:\n2>\tif Timing Advance Command MAC CE is received as in clause 5.2, or;\n2>\tif Timing Advance Command or Absolute Timing Advance Command is received for Random Access procedure that is successfully completed:\n3>\tupdate the stored the RSRP of the downlink pathloss reference with the current RSRP value of the downlink pathloss reference.\n2>\tif the UE is configured with SRS with validity area and the upper layer indicates the MAC to update the stored RSRP:\n3>\tupdate the RSRP of the downlink pathloss reference with the current RSRP value of the downlink pathloss reference of the camped cell as specified in TS 38.331 [5].\nThe MAC entity shall consider the TA to be valid when the following conditions are fulfilled:\n1>\tcompared to the stored downlink pathloss reference RSRP value, the current RSRP value of the downlink pathloss reference has not increased/decreased by more than inactivePosSRS-RSRP-ChangeThreshold, if configured; and\n1>\tinactivePosSRS-TimeAlignmentTimer is running or srs-ValidityArea-TimerAlignmentTimer is running when positioning validity area is configured.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.27\tSmall Data Transmission",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.27.1\tGeneral",
                            "text_content": "The MAC entity may be configured by RRC with SDT and the SDT procedure may be initiated by RRC layer for MO-SDT or MT-SDT. The SDT procedure initiated for MO-SDT can be performed either by Random Access procedure with 2-step RA type or 4-step RA type (i.e., RA-SDT) or by configured grant Type 1 (i.e., CG-SDT). The SDT procedure initiated for MT-SDT can be performed either by Random Access procedure with 2-step RA type or 4-step RA type (i.e., RA-SDT is not applicable as specified in clause 5.1.1b) or by configured grant Type 1 (i.e., CG-SDT).\nRRC configures the following parameters for SDT procedure:\n-\tsdt-DataVolumeThreshold: data volume threshold for the UE to determine whether to perform SDT procedure initiated for MO-SDT;\n-\tsdt-RSRP-Threshold: RSRP threshold for UE to determine whether to perform SDT procedure initiated for MO-SDT;\n-\tsdt-RSRP-ThresholdMT: RSRP threshold for UE to determine whether to perform SDT procedure initiated for MT-SDT;\n-\tcg-SDT-RSRP-ThresholdSSB: an RSRP threshold configured for SSB selection for CG-SDT;\n-\tcg-MT-SDT-MaxDurationToNextCG-Occasion: time threshold which is used by the UE to determine whether to perform CG-SDT for MT-SDT;\n-\tcg-SDT-MaxDurationToNextCG-Occasion: time threshold configured per logical channel which is used by the UE to determine whether to perform CG-SDT for MO-SDT.\nThe following UE variable is used for the SDT procedure:\n-\tMAX_DURATION_TO_NEXT_CG_OCCASION;\n-\tRSRP_THRESHOLD.\nThe MAC entity shall, if initiated by the upper layers for SDT procedure:\n1>\tif SDT procedure is initiated for MO-SDT as specified in TS 38.331 [5]:\n2>\tset the MAX_DURATION_TO_NEXT_CG_OCCASION to the shortest value of cg-SDT-MaxDurationToNextCG-Occasion, if configured, among all the logical channel configured with this parameter by upper layer and having data for transmission;\n2>\tset the RSRP_THRESHOLD to the value of sdt-RSRP-Threshold, if configured.\n1>\telse if SDT procedure is initiated for MT-SDT as specified in TS 38.331 [5]:\n2>\tset the MAX_DURATION_TO_NEXT_CG_OCCASION to the value of cg-MT-SDT-MaxDurationToNextCG-Occasion, if configured;\n2>\tif sdt-RSRP-ThresholdMT is configured:\n3>\tset the RSRP_THRESHOLD to the value of sdt-RSRP-ThresholdMT.\n2>\telse if sdt-RSRP-Threshold is configured:\n3>\tset the RSRP_THRESHOLD to the value of sdt-RSRP-Threshold.\n1>\tif the SDT procedure is initiated for MO-SDT as specified in TS 38.331 [5], and the data volume of the pending UL data across all RBs configured for SDT is less than or equal to sdt-DataVolumeThreshold, or if the SDT procedure is initiated for MT-SDT as specified in TS 38.331 [5]; and\nNOTE 1:\tFor SDT procedure, the MAC entity also considers the suspended RBs configured with SDT for data volume calculation. It is up to the UE's implementation how the UE calculates the data volume for the suspended RBs. Size of the CCCH message is not considered for data volume calculation\n1>\tif the RSRP of the downlink pathloss reference is higher than RSRP_THRESHOLD or if RSRP_THRESHOLD is not set:\n2>\tif the Serving Cell is configured with supplementary uplink as specified in TS 38.331 [5]; and\n2>\tif the RSRP of the downlink pathloss reference is less than rsrp-ThresholdSSB-SUL:\n3>\tselect the SUL carrier.\n2>\telse:\n3>\tselect the NUL carrier.\n2>\tif CG-SDT is configured on the selected UL carrier, and TA for CG-SDT is valid according to clause 5.27.2 in the first available CG occasion for initial CG-SDT transmission with CCCH message according to clause 5.8.2; and\n2>\tif the SDT procedure is initiated for MO-SDT as specified in TS 38.331 [5], and, for each RB having data available for transmission, configuredGrantType1Allowed, if configured for CG-SDT, is configured with value true for the corresponding logical channel, or if the SDT procedure is initiated for MT-SDT as specified in TS 38.331 [5]; and\n2>\tif at least one SSB configured for CG-SDT with SS-RSRP above cg-SDT-RSRP-ThresholdSSB is available, and if either the time gap between the initiation of the SDT procedure and first available CG occasion for initial CG-SDT transmission with CCCH message according to clause 5.8.2 is less than MAX_DURATION_TO_NEXT_CG_OCCASION, or if the MAX_DURATION_TO_NEXT_CG_OCCASION is not set:\n3>\tindicate to the upper layers that the conditions for initiating SDT procedure are fulfilled;\n3>\tperform CG-SDT procedure on the selected UL carrier according to clause 5.8.2.\n2>\telse if a set of Random Access resources for RA-SDT is configured and can be selected according to clause 5.1.1b on the selected UL carrier on the BWP configured by initialUplinkBWP-RedCap, if configured for a RedCap UE; otherwise, on the BWP configured by initialUplinkBWP; or\n2>\tif the SDT procedure is initiated for MT-SDT as specified in TS 38.331 [5]:\n3>\tif cg-SDT-TimeAlignmentTimer is running, consider cg-SDT-TimeAlignmentTimer as expired and perform the corresponding actions in clause 5.2;\n3>\tindicate to the upper layers that the conditions for initiating SDT procedure are fulfilled.\n2>\telse:\n3>\tindicate to the upper layers that the conditions for initiating SDT procedure are not fulfilled.\n1>\telse:\n2>\tindicate to the upper layers that the conditions for initiating SDT procedure are not fulfilled.\nIf Random Access procedure is selected above for SDT procedure initiated for MO-SDT or MT-SDT and after the Random Access procedure is successfully completed (see clause 5.1.6), the UE monitors PDCCH addressed to C-RNTI received in random access response until the SDT procedure is terminated. If CG-SDT is selected above and after the initial transmission for CG-SDT is performed, the UE monitors PDCCH addressed to C-RNTI as stored in UE Inactive AS context as specified in TS 38.331 [5] and CS-RNTI until the SDT procedure is terminated.\nNOTE 2:\tWhen the UE determines if there is an SSB with SS-RSRP above cg-SDT-RSRP-ThresholdSSB, the UE uses the latest unfiltered L1-RSRP measurement.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.27.2\tTA Validation for CG-SDT",
                            "text_content": "RRC configures the following parameters for TA validation for CG-SDT:\n-\tcg-SDT-RSRP-ChangeThreshold: RSRP threshold for the increase/decrease of RSRP for time alignment validation.\nThe MAC entity shall, upon the reception of CG-SDT configuration:\n1>\tstore the current RSRP of the downlink pathloss reference for TA validation as defined in TS 38.331 [5] clause 5.7.17.\nThe MAC entity shall consider the TA of the initial CG-SDT transmission with CCCH message to be valid when the following conditions are fulfilled:\n1>\tThe RSRP values for the stored downlink pathloss reference and the current downlink pathloss reference are valid according to TS 38.133 [11]; and\n1>\tCompared to the stored downlink pathloss reference RSRP value, the current RSRP value of the downlink pathloss reference calculated as specified in TS 38.133 [11] has not increased/decreased by more than cg-SDT-RSRP-ChangeThreshold, if configured; and\n1>\tcg-SDT-TimeAlignmentTimer is running.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.28\tSidelink Discontinuous Reception (DRX)",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.28.1\tGeneral",
                            "text_content": "The MAC entity may be configured by RRC with an SL DRX functionality that controls the UE's SCI (i.e., 1st stage SCI and 2nd stage SCI) monitoring activity for unicast, groupcast and broadcast. When using SL DRX operation, the MAC entity shall also monitor SCI (i.e., 1st stage SCI and 2nd stage SCI) according to requirements found in other clauses of this specification.\nSidelink DRX and UE procedure on SL-PRS dedicated resource pool are not applied at the same time.\nRRC controls Sidelink DRX operation by configuring the following parameters:\n-\tsl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer: the duration at the beginning of an SL DRX cycle;\n-\tsl-drx-SlotOffset: the delay before starting the sl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer;\n-\tsl-drx-InactivityTimer/sl-DRX-GC-InactivityTimer (except for the SL broadcast communication): the duration after the first slot of SCI (i.e., 1st stage SCI and 2nd stage SCI) reception in which an SCI indicates a new SL transmission for the MAC entity;\n-\tsl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer (per Sidelink process except for the SL broadcast process): the maximum duration until an SL retransmission is received;\n-\tsl-drx-StartOffset: the slot where the SL DRX cycle starts;\n-\tsl-drx-Cycle/sl-DRX-GC-BC-Cycle: the Sidelink DRX cycle;\n-\tsl-drx-HARQ-RTT-Timer/sl-DRX-GC-HARQ-RTT-Timer (per Sidelink process except for the SL broadcast process): the minimum duration before an SL HARQ retransmission is expected by the MAC entity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.28.2\tBehaviour of UE receiving SL-SCH Data",
                            "text_content": "When SL DRX is configured, the Active Time includes the time while:\n-\tsl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer or sl-drx-InactivityTimer/sl-DRX-GC-InactivityTimer is running; or\n-\tsl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer is running; or\n-\tperiod of sl-LatencyBoundCSI-Report configured by RRC in case SL-CSI reporting MAC CE is not received; or\n-\tthe time between the transmission of the request of SL-CSI reporting and the reception of the SL-CSI reporting MAC CE in case SL-CSI reporting MAC CE is received; or\n-\tSlot(s) associated with the announced periodic transmission(s) by the UE transmitting SL-SCH Data; or\n-\tthe time between transmission/reception of Direct Link Establishment Request message (TS 24.587 [28]) or ProSe Direct Link Establishment Request message (TS 24.554 [29]) and reception of RRCReconfigurationSidelink message including initial DRX configuration or the link establishment procedure being aborted by upper layer; or\n-\tthe time between transmission of RRCReconfigurationSidelink message including initial DRX configuration and reception of corresponding RRCReconfigurationCompleteSidelink or RRCReconfigurationFailureSidelink message.\nWhen one or multiple SL DRX is configured, the MAC entity shall:\n1>\tif a single sl-DRX-GC-BC-Cycle that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or a single sl-DRX-GC-BC-Cycle that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List is associated to a Destination and the associated cast type is groupcast or broadcast:\n2>\tselect the sl-DRX-GC-BC-Cycle that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or the sl-DRX-GC-BC-Cycle configured in sl-DefaultDRX-GC-BC associated with the Destination.\n1>\telse if multiple sl-DRX-GC-BC-Cycle that include one or multiple sl-DRX-GC-BC-Cycle that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and, if applicable, one sl-DRX-GC-BC-Cycle that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List are associated to a Destination Layer-2 ID and the associated cast type groupcast or broadcast:\n2>\tselect the sl-DRX-GC-BC-Cycle whose length is the shortest one among multiple sl-DRX-GC-BC-Cycle that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and sl-DRX-GC-BC-Cycle configured in sl-DefaultDRX-GC-BC associated with the Destination Layer-2 ID.\n1>\tif a single sl-DRX-GC-BC-OnDurationTimer that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or a single sl-DRX-GC-BC-OnDurationTimer that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List is associated to a Destination and the associated cast type is groupcast or broadcast:\n2>\tselect the sl-DRX-GC-BC-OnDurationTimer that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or the sl-DRX-GC-BC-OnDurationTimer configured in sl-DefaultDRX-GC-BC associated with the Destination.\n1>\telse if multiple sl-DRX-GC-BC-OnDurationTimer that include one or multiple sl-DRX-GC-BC-OnDurationTimer that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and, if applicable, one sl-DRX-GC-BC-OnDurationTimer that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List are associated to a Destination Layer-2 ID and the associated cast type is groupcast or broadcast:\n2>\tselect the sl-DRX-GC-BC-OnDurationTimer whose length is the longest one among multiple sl-DRX-GC-BC-OnDurationTimer that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and sl-DRX-GC-BC-Cycle configured in sl-DefaultDRX-GC-BC associated with the Destination Layer-2 ID.\n1>\tif a single sl-DRX-GC-InactivityTimer that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or a single sl-DRX-GC-InactivityTimer that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List is associated to a Destination and the associated cast type is groupcast:\n2>\tselect the sl-DRX-GC-InactivityTimer that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or the sl-DRX-GC-InactivityTimer configured in sl-DefaultDRX-GC-BC associated with the Destination:\n1>\telse if multiple sl-DRX-GC-InactivityTimer that include one or multiple sl-DRX-GC-InactivityTimer that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and, if applicable, one sl-DRX-GC-InactivityTimer that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List of a Destination Layer-2 ID and the associated cast type is groupcast:\n2>\tselect sl-DRX-GC-InactivityTimer whose length is the longest one among multiple sl-DRX-GC-InactivityTimer that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and sl-DRX-GC-InactivityTimer configured in sl-DefaultDRX-GC-BC associated with the Destination Layer-2 ID.\n1>\tif an sl-drx-HARQ-RTT-Timer expires:\n2>\tif the data of the corresponding Sidelink process was not successfully decoded or if the HARQ feedback (i.e., negative acknowledgement) is not transmitted for unicast due to UL/SL prioritization:\n3>\tstart the sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer for the corresponding Sidelink process in the first slot after the expiry of sl-drx-HARQ-RTT-Timer.\nWhen the cast type is groupcast or broadcast as indicated by upper layer, or the cast type is unicast for the reception of Direct Link Establishment Request message [28] or ProSe Direct Link Establishment Request message [29] as indicated by upper layer, or for the reception of discovery message [26], the sl-drx-StartOffset and sl-drx-SlotOffset are derived from the following equations:\nsl-drx-StartOffset (ms) = Destination Layer-2 ID modulo sl-DRX-GC-BC-Cycle (ms).\nsl-drx-SlotOffset (ms) = (Destination Layer-2 ID modulo the number of slots in one subframe)\n/ (the number of slots in one subframe) (ms).\n1>\tif the SL DRX cycle is used, and [(DFN × 10) + subframe number] modulo (sl-drx-Cycle or sl-DRX-GC-BC-Cycle) = sl-drx-StartOffset:\n2>\tstart sl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer after sl-drx-SlotOffset from the beginning of the subframe.\n1>\tif an SL DRX is in Active Time:\n2>\tmonitor the SCI (i.e., 1st stage SCI and 2nd stage SCI).\n2>\tif the SCI indicates a new SL transmission:\n3>\tif Source Layer-1 ID of the SCI is equal to the 8 LSB of the intended Destination Layer-2 ID and Destination Layer-1 ID of the SCI is equal to the 16 LSB of the intended Source Layer-2 ID and the cast type indicator in the SCI is set to unicast:\n4>\tstart or restart sl-drx-InactivityTimer for the corresponding Source Layer-2 ID and Destination Layer-2 ID pair in the first slot after SCI reception.\n3>\tif Destination Layer-1 ID of the SCI (i.e., 2nd stage SCI) is equal to the 16 LSB of the intended Destination Layer-2 ID and the cast type indicator in the SCI is set to groupcast:\n4>\tstart or restart sl-DRX-GC-InactivityTimer for the corresponding Destination Layer-2 ID in the first slot after SCI reception.\n2>\tif the SCI indicates an SL transmission:\n3>\tif a next retransmission opportunity is indicated in the SCI:\n4>\tderive the sl-drx-HARQ-RTT-Timer from the retransmission resource timing of the next retransmission resource in the SCI.\n3>\telse if PSFCH resource is configured for the SL grant associated to the SCI:\n4>\tset the sl-drx-HARQ-RTT-Timer based on sl-drx-HARQ-RTT-Timer1 configured by upper layer if the cast type associated with the SCI is unicast or sl-DRX-GC-HARQ-RTT-Timer1 configured by upper layer if the cast type associated with the SCI is groupcast when HARQ feedback is enabled, or based on sl-drx-HARQ-RTT-Timer2 configured by upper layer if the cast type associated with the SCI is unicast or sl-DRX-GC-HARQ-RTT-Timer2 configured by upper layer if the cast type associated with the SCI is groupcast when HARQ feedback is disabled, for resource pool configured with PSFCH.\n3>\telse (i.e., if PSFCH resource is not configured for the SL grant associated to the SCI):\n4>\tset the sl-drx-HARQ-RTT-Timer as 0 slots.\n3>\tif PSFCH resource is not configured for the SL grant associated to the SCI:\n4>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the slot following the end of PSSCH transmission (i.e., currently received PSSCH).\n3>\tif PSFCH resource is configured for the SL grant associated to the SCI:\n4>\tif HARQ feedback is enabled by the SCI and the cast type associated with the SCI is unicast:\n5>\tif numPSFCHOccasions is configured as specified in TS 38.331 [5]:\n6>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of corresponding PSFCH transmission carrying the SL HARQ Feedback when the SL HARQ feedback is successfully transmitted in one of PSFCH occasions from numPSFCHOccasions; or\n6>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the last PSFCH occasion for the SL HARQ Feedback when the SL HARQ feedback is not transmitted in all PSFCH occasions from numPSFCHOccasions.\n5>\telse:\n6>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH transmission carrying the SL HARQ feedback; or\n6>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH resource for the SL HARQ feedback when the SL HARQ feedback is not transmitted due to UL/SL prioritization or SL LBT failure.\n4>\tif HARQ feedback is enabled by the SCI and the cast type associated with the SCI is groupcast and positive-negative acknowledgement is selected:\n5>\tif numPSFCHOccasions is configured as specified in TS 38.331 [5]:\n6>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the last PSFCH occasion for the SL HARQ Feedback from\n5>\telse:\n6>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH transmission carrying the SL HARQ feedback; or\n6>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH resource for the SL HARQ feedback when the SL HARQ feedback is not transmitted due to UL/SL prioritization.\n4>\tif HARQ feedback is enabled by the SCI and the cast type associated with the SCI is groupcast and negative-only acknowledgement is selected;\n5>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH transmission carrying the SL HARQ feedback; or\n5>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH resource for the SL HARQ feedback when the SL HARQ feedback is not transmitted due to UL/SL prioritization; or\n5>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH resource for the SL HARQ feedback when the SL HARQ feedback is a positive acknowledgement.\n4>\tif HARQ feedback is disabled by the SCI and the resource(s) for one or more retransmission opportunities is not scheduled in the SCI:\n5>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the slot following the end of PSFCH resource.\n4>\tif HARQ feedback is disabled by the SCI and the resource(s) for one or more retransmission opportunities is scheduled in the SCI:\n5>\tstart the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the slot following the end of PSSCH transmission (i.e., currently received PSSCH).\nNOTE:\tVoid.\n3>\tstop the sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer for the corresponding Sidelink process.\n1>\tif an SL DRX Command MAC CE is received for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast:\n2>\tstop sl-drx-onDurationTimer for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast;\n2>\tstop sl-drx-InactivityTimer for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.28.3\tBehaviour of UE transmitting SL-SCH Data",
                            "text_content": "The UE transmitting SL-SCH Data should keep aligned with its intended UE receiving the SL-SCH Data regarding the SL DRX Active time as specified in clause 5.28.2.\nFurthermore, the UE transmitting SL-SCH Data determines the SL DRX Active time based on SL DRX timers that are running (e.g., sl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer, sl-drx-InactivityTimer/sl-DRX-GC-InactivityTimer, sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer) or will be running in the future (e.g., sl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer, sl-drx-InactivityTimer/sl-DRX-GC-InactivityTimer, sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer) at the UE(s) receiving SL-SCH data. The UE may select resource for the initial transmission of groupcast within the time when sl-DRX-GC-BC-OnDurationTimer or sl-DRX-GC-InactivityTimer of the destination is running.\nNOTE 1:\tA UE may assume that a resource for retransmission is in the Active time if an initial transmission causes the sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer to be started at the receiving UE.\nNOTE 2:\tA UE may send SL DRX Command MAC CE to receiving UE for unicast and when to send SL DRX Command MAC CE is up to UE implementation.\nThe MAC entity shall for each Destination Layer-2 ID associated with groupcast that is interested in NR sidelink transmision:\n1>\tif the SCI indicates a new transmission where the cast type is set to groupcast is transmitted:\n2>\tstart or restart sl-DRX-GC-InactivityTimer for the corresponding Destination Layer-2 ID in the first slot after SCI transmission.\nThe MAC entity shall for each pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to each PC5-RRC connection which has been established by upper layers:\n1>\tif the SL DRX Command indication has been triggered by the UE:\n2>\tif the MAC entity has SL resources allocated for new transmission and the SL-SCH resources can accommodate the SL DRX Command MAC CE and its subheader as a result of logical channel prioritization:\n3>\tinstruct the Multiplexing and Assembly procedure to generate a Sidelink DRX Command MAC CE as defined in clause 6.1.3.52;\n3>\tcancel the triggered SL DRX Command indication.\n2>\telse if the MAC entity has been configured with Sidelink resource allocation mode 1:\n3>\ttrigger a Scheduling Request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.29\tActivation/Deactivation of SCG",
                    "description": "",
                    "summary": "",
                    "text_content": "The network may activate and deactivate the configured SCG.\nThe MAC entity shall for the configured SCG:\n1>\tif upper layers indicate that SCG is activated:\n2>\tif BFI_COUNTER >= beamFailureInstanceMaxCount for the PSCell or the timeAlignmentTimer associated with PTAG is not running:\n3>\tindicate to upper layers that a Random Access Procedure (as specified in clause 5.1.1) is needed for SCG activation.\n2>\tactivate the SCG according to the timing defined in TS 38.133 [11].\n2>\t(re-)initialize any suspended configured uplink grants of configured grant Type 1 associated with this PSCell according to the stored configuration, if any, and to start in the symbol according to rules in clause 5.8.2.2;\n2>\tapply normal SCG operation including:\n3>\tSRS transmissions on the PSCell;\n3>\tCSI reporting for the PSCell;\n3>\tPDCCH monitoring on the PSCell;\n3>\tPUCCH transmissions on the PSCell;\n3>\ttransmit on RACH on the PSCell;\n3>\tinitialize Bj for each logical channel to zero.\n1>\telse if upper layers indicate that the SCG is deactivated:\n2>\tdeactivate all the SCells of the SCG according to clause 5.9;\n2>\tdeactivate SCG according to the timing defined in TS 38.133 [11];\n2>\tclear any configured downlink assignment and any configured uplink grant Type 2 associated with the PSCell respectively;\n2>\tsuspend any configured uplink grant Type 1 associated with the PSCell;\n2>\treset MAC according to clause 5.12.\n1>\tif the SCG is deactivated:\n2>\tnot transmit SRS on the PSCell;\n2>\tnot report CSI for the PSCell;\n2>\tnot transmit on UL-SCH on the PSCell;\n2>\tnot transmit PUCCH on the PSCell;\n2>\tnot transmit on RACH on the PSCell;\n2>\tnot monitor the PDCCH on the PSCell.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.30\tHandling of FR2 UL gap",
                    "description": "",
                    "summary": "",
                    "text_content": "During the FR2 UL gap configured by ul-GapFR2-Config as specified in TS 38.331 [5], the MAC entity shall, on the Serving Cell(s) of FR2 single CC and intra-band CA, or on the Serving Cell(s) of FR2 inter-band CA where UE does not support tx-Support-UL-GapFR2:\n1>\tonly perform transmission of:\n2>\tPRACH preamble as specified in clause 5.1.2 and 5.1.2a;\n2>\tUL-SCH for Msg3 or the MSGA payload as specified in clause 5.4.2.2;\n2>\tUL-SCH for configured grant;\n2>\tthe valid CSI report during SCell activation procedure where the valid CSI report is valid CQI with non-zero CQI index defined in TS 38.214 [7], clause 5.2.2.1, when the time period between UL gap colliding with CSI report of non-zero CQI and the slot where the SCell activation MAC CE or CSI report activation command is received is no less than 10 ms;\n2>\tthe valid L1 RSRP report during SCell activation procedure, where the valid L1 RSRP report is non lowest L1 RSRP defined in TS 38.133 [11], clause 10.1.6, when the time period between UL gap colliding with L1 RSRP reporting and the slot where the SCell activation MAC CE or CSI report activation command is received is no less than 10 ms;\n2>\tthe PUCCH transmission for SR, and link recovery request (LRR) defined in TS 38.133 [11], clause 8.5.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.31\tSidelink LBT operation",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.31.1\tGeneral",
                            "text_content": "The lower layer may perform an SL LBT procedure, see TS 37.213 [18], according to which a transmission is not performed by lower layers if the channel is identified as being occupied. When lower layer performs an SL LBT procedure before a transmission and the transmission is not performed, an SL LBT failure indication is sent to the MAC entity from lower layers. Unless otherwise specified, when SL LBT procedure is performed for a transmission, actions as specified in this specification are performed regardless of if an SL LBT failure indication is received from lower layers. When SL LBT is not performed by the lower layers, SL LBT failure indication is not received from lower layers.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.2\tSidelink LBT failure detection and recovery procedure",
                            "text_content": "The MAC entity may be configured by RRC with a SL consistent LBT failure detection and recovery procedure. SL consistent LBT failure is detected per RB set by counting SL LBT failure indications, for all SL transmissions, from the lower layers to the MAC entity.\nRRC configures the following parameters in the sl-lbt-FailureRecoveryConfig:\n-\tsl-lbt-FailureInstanceMaxCount for the SL consistent LBT failure detection;\n-\tsl-lbt-FailureDetectionTimer for the SL consistent LBT failure detection;\nThe following UE variable is used for the SL consistent LBT failure detection procedure:\n-\tSL_LBT_COUNTER (per RB set): counter for SL LBT failure indication which is initially set to 0.\nFor activated SL BWP configured with sl-lbt-FailureRecoveryConfig, the MAC entity shall:\n1>\tif SL LBT failure indication has been received from lower layers for an RB set of the configured pool(s) of resources in the SL BWP:\n2>\tstart or restart the sl_lbt-FailureDetectionTimer for the RB set, and it is not running;\n2>\tincrement SL_LBT_COUNTER for the RB set by 1;\n2>\tif SL_LBT_COUNTER >= sl-lbt-FailureInstanceMaxCount:\n3>\ttrigger SL consistent LBT failure for the RB set in the SL BWP;\n3>\tif consistent LBT failure has been triggered in all the RB sets of the configured pool(s) of resources in the SL BWP:\n4>\tindicate SL consistent LBT failure based Sidelink RLF detection to RRC.\n1>\tif all triggered SL consistent LBT failures are cancelled in a RB set; or\n1>\tif the sl-lbt-FailureDetectionTimer expires for a RB set:\n2>\tset SL_LBT_COUNTER to 0 for the RB set.\n1>\tif sl-lbt-FailureDetectionTimer or sl-lbt-FailureInstanceMaxCount is reconfigured by upper layers:\n2>\tset SL_LBT_COUNTER to 0 for all the RB sets.\nThe sl-LBT-RecoveryTimer is used for recovery of the triggered SL consistent LBT failure, when RRC configures Sidelink resource allocation mode 2.\nThe MAC entity shall:\n1>\tif SL consistent LBT failure has been triggered, and not cancelled, in the RB set(s), and SL LBT failure MAC CE(s) has not been generated;\n2>\tif the sl-LBT-RecoveryTimer for the triggered SL consistent LBT failure is not running:\n3>\tstart the sl-LBT-RecoveryTimer.\n2>\tif UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the SL LBT failure MAC CE plus its subheader as a result of logical channel prioritization according to clause 5.4.3.1:\n3>\tinstruct the Multiplexing and Assembly procedure in clause 5.4.3 to generate the SL LBT failure MAC CE(s).\n2>\telse:\n3>\ttrigger a Scheduling Request for SL LBT failure MAC CE.\n1>\tif a MAC PDU is transmitted and this PDU includes the SL LBT failure MAC CE; or\n2>\tcancel the triggered SL consistent LBT failure(s) in RB set(s) for which SL consistent LBT failure was indicated in the transmitted SL LBT failure MAC CE if the MAC entity has been configured with Sidelink resource allocation mode 1.\n1>\tif the sl-LBT-RecoveryTimer for the triggered SL consistent LBT failure(s) expires:\n2>\tcancel the triggered SL consistent LBT failure(s) in RB set(s) for which SL consistent LBT failure was detected.\n1>\tif sl-lbt-FailureRecoveryConfig is reconfigured by upper layers for the BWP:\n2>\tcancel all the triggered SL consistent LBT failure(s) in the SL BWP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.32\tSRS for positioning Tx frequency hopping",
                    "description": "",
                    "summary": "",
                    "text_content": "SRS for positioning Tx frequency hopping can be supported for UE in RRC_CONNECTED and RRC_INACTIVE. The UE can be configured with UTW during which the UE is allowed to transmit SRS for positioning Tx frequency hopping.\nRRC configures the following parameters for the UTW for SRS for positioning Tx frequency hopping:\n-\tutw-SlotPeriodicity: Periodicity of the UTW in slot;\n-\tutw-SlotOffset: Offset of the beginning of the UTW with respect to the beginning of the UTW periodicity in time domain in slot;\n-\tuplinkTimeWindowTimer: Time duration when the UE performs SRS transmission for positioning Tx frequency hopping.\nWhen UTW is configured, the MAC entity shall start the uplinkTimeWindowTimer in the first symbol of the slot that the following condition is satisfied\nCURRENT_slot modulo (utw-SlotPeriodicity) = utw-SlotOffset\nwhere CURRENT_slot = [(SFN × numberOfSlotsPerFrame) + slot number in the frame] and numberOfSlotsPerFrame refers to the number of consecutive slots per frame as specified in TS 38.211 [8].\nWhen UTW is configured and the UE is in RRC_CONNECTED, the MAC entity shall instruct the lower layer to transmit SRS for positioning Tx frequency hopping when the uplinkTimeWindowTimer is running.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.33\tRACH-less initial UL transmission",
                    "description": "",
                    "summary": "",
                    "text_content": "The initial uplink transmission of a RACH-less handover procedure can be performed either using a dynamic uplink grant or a configured uplink grant Type 1 preallocated by RRC, if configured.\nWhen rach-LessHO is configured, the MAC entity shall:\n1>\tif cg-RACH-less-Configuration is configured:\n2>\tselect a configured uplink grant for initial uplink transmission according to clause 5.8.2;\n2>\tperform initial uplink transmission in the first available CG occasion for RACH-less handover according to clause 5.8.2.\n1>\telse:\n2>\tif tci-StateID is configured in rach-lessHO:\n3>\tindicate to lower layers the TCI state information included in tci-StateID.\n2>\telse if dg-beam is configured in rach-lessHO:\n3>\tindicate to lower layers the SSB index included in dg-beam.\n1>\tmonitor the PDCCH as specified in TS 38.213 [6].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.34\tCell-Level Energy Saving",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.34.1\tGeneral",
                            "text_content": "Each Serving Cell may be configured by RRC with a periodic cell DTX pattern (i.e., Active and Non-Active Periods). The cell DTX operation affects UE's monitoring activity of PDCCH and configured downlink assignments in RRC_CONNECTED. For all activated Serving Cells with cell DTX configured and activated, the MAC entity may monitor PDCCH and configured downlink assignments using the cell DTX operation specified in clause 5.34.2.\nEach Serving Cell may be configured by RRC with a periodic cell DRX pattern (i.e., Active and Non-Active Periods). The cell DRX operation controls Scheduling Request and configured uplink grant transmission activity in RRC_CONNECTED. For all activated Serving Cells with cell DRX configured and activated, the MAC entity may transmit configured uplink grant transmissions and Scheduling Request using the cell DRX operation specified in clause 5.34.3.\nRRC controls cell DTX and cell DRX operation by configuring the following parameters in CellDTXDRX-Config per Serving Cell:\n-\tcellDTXDRXconfigType: defines whether only cell DTX is configured, only cell DRX is configured, or both are configured;\n-\tcelldtxdrx-onDurationTimer: the active duration at the beginning of a cell DTX/DRX cycle;\n-\tcelldtxdrx-StartOffset: defines the subframe where the cell DTX/DRX cycle starts;\n-\tcelldtxdrx-SlotOffset: the delay before starting the celldtxdrx-onDurationTimer;\n-\tcelldtxdrx-Cycle: the cell DTX/DRX cycle period.\n-\tcellDTXDRXactivationStatus: the initial activation status of cell DTX and cell DRX operation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.2\tCell Discontinuous Transmission",
                            "text_content": "Cell DTX is configured if cellDTXDRXconfigType is set to dtx or dtxdrx. Cell DTX operation is activated and deactivated for each Serving Cell by:\n-\treceiving a cell DTX indication from lower layers indicating activation or deactivation of cell DTX operation, as specified in TS 38.213 [6];\n-\tconfiguring CellDTXDRX-Config by upper layers: if cell DTX is configured and cellDTXDRXactivationStatus is set to activated, cell DTX operation is activated upon cell DTX configuration; if cell DTX is configured and cellDTXDRXactivationStatus is set to deactivated, cell DTX operation is deactivated upon cell DTX configuration; if CellDTXDRX-Config is released, cell DTX operation is deactivated and all the corresponding configurations are released.\nWhen cell DTX is configured and activated for a Serving Cell, the cell DTX Active Period includes the time while:\n-\tcelldtxdrx-onDurationTimer is running for the associated Serving Cell.\nFor each Serving Cell configured with cell DTX, the MAC entity shall:\n1>\tif cell DTX is activated for this Serving Cell:\n2>\tif [(SFN × 10) + subframe number] modulo (celldtxdrx-Cycle) = (celldtxdrx-StartOffset):\n3>\tstart celldtxdrx-onDurationTimer for this serving cell after celldtxdrx-SlotOffset from the beginning of the subframe.\n1>\tif cell DTX operation is deactivated for this Serving Cell; or\n1>\tif the Serving Cell is in the cell DTX Active Period:\n2>\tmonitor PDCCH on this Serving Cell, as specified in TS 38.213 [6] and other clauses of this specification.\n1>\tif any drx-RetransmissionTimerDL, drx-RetransmissionTimerUL or drx-RetransmissionTimerSL (as described in clause 5.7) is running on any Serving Cell in the DRX group of this Serving Cell; or\n1>\tif ra-ContentionResolutionTimer (as described in clause 5.1.5) or msgB-ResponseWindow (as described in clause 5.1.4a) is running; or\n1>\tif a Scheduling Request is sent on PUCCH and is pending (as described in clause 5.4.4 or 5.22.1.5); or\n1>\tif a PDCCH indicating a new transmission addressed to the C-RNTI of the MAC entity has not been received after successful reception of a Random Access Response for the Random Access Preamble not selected by the MAC entity among the contention-based Random Access Preamble (as described in clauses 5.1.4 and 5.1.4a):\n2>\tmonitor PDCCH on the Serving Cells in the DRX group of this Serving Cell, as specified in TS 38.213 [6] and other clauses of this specification.\n1>\tif ra-ResponseWindow (as described in clause 5.1.4) is running and this Serving Cell is the SpCell:\n2>\tmonitor PDCCH on this Serving Cell (as described in clause 5.1.4).\nFor each Serving Cell configured with cell DTX, the MAC entity may:\n1>\tif cell DTX operation is activated and the Serving Cell is not in the cell DTX Active Period:\n2>\tnot monitor PDCCH irrespective of the requirements of clauses 5.7 and 5.7b, unless stated otherwise in this clause;\n2>\tnot instruct the physical layer to receive transport block on the DL-SCH of this Serving Cell according to a configured downlink assignment for SPS;\n2>\tnot indicate the presence of a configured downlink assignment and deliver the stored HARQ information to the HARQ entity;\n2>\tnot set the HARQ Process ID to the HARQ Process ID associated with the PDSCH duration of a configured downlink assignment;\n2>\tnot consider the NDI bit for the HARQ process corresponding to the PDSCH duration of a configured downlink assignment to have been toggled for the configured downlink assignment.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.3\tCell Discontinuous Reception",
                            "text_content": "Cell DRX is configured if cellDTXDRXconfigType is set to drx or dtxdrx. Cell DRX operation is activated and deactivated for each Serving Cell by:\n-\treceiving a cell DRX indication from lower layers indicating activation or deactivation of cell DRX operation, as specified in TS 38.213 [6];\n-\tconfiguring CellDTXDRX-Config by upper layers: if cell DRX is configured and cellDTXDRXactivationStatus is set to activated, cell DRX operation is activated upon cell DRX configuration; if cell DRX is configured and cellDTXDRXactivationStatus is set to deactivated, cell DRX operation is deactivated upon cell DRX configuration; if CellDTXDRX-Config is released, cell DRX operation is deactivated and all the corresponding configurations are released.\nWhen cell DRX is configured and activated for a Serving Cell, the cell DRX Active Period includes the time while:\n-\tcelldtxdrx-onDurationTimer is running for the associated Serving Cell.\nFor each Serving Cell configured with cell DRX, the MAC entity shall:\n1>\tif cell DRX is activated for this Serving Cell:\n2>\tif [(SFN × 10) + subframe number] modulo (celldtxdrx-Cycle) = (celldtxdrx-StartOffset):\n3>\tstart celldtxdrx-onDurationTimer for this serving cell after celldtxdrx-SlotOffset from the beginning of the subframe.\n1>\tif cell DRX is activated and the Serving Cell is not in the cell DRX Active Period:\n2>\tnot instruct the physical layer to signal a SR on a PUCCH resource for SR;\n2>\tnot increment the SR_COUNTER for a SR;\n2>\tnot start the sr-ProhibitTimer for a SR;\n2>\tnot deliver any configured uplink grant and the associated HARQ information to the HARQ entity;\n2>\tnot instruct a HARQ process associated with a configured uplink grant to trigger a new transmission or a retransmission;\n2>\tnot report periodic CSI on PUCCH and semi-persistent CSI configured on PUSCH;\n2>\tif an emergency service is initiated by upper layers and this Serving Cell is the SpCell:\n3>\tinitiate a Random Access procedure (as specified in clause 5.1.1).\nNOTE:\tHow the MAC layer in the UE is aware of an ongoing emergency service is up to UE implementation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tProtocol Data Units, formats and parameters",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tProtocol Data Units",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tGeneral",
                            "text_content": "A MAC PDU is a bit string that is byte aligned (i.e. multiple of 8 bits) in length. In the figures in clause 6, bit strings are represented by tables in which the most significant bit is the leftmost bit of the first line of the table, the least significant bit is the rightmost bit on the last line of the table, and more generally the bit string is to be read from left to right and then in the reading order of the lines. The bit order of each parameter field within a MAC PDU is represented with the first and most significant bit in the leftmost bit and the last and least significant bit in the rightmost bit.\nA MAC SDU is a bit string that is byte aligned (i.e. multiple of 8 bits) in length. A MAC SDU is included into a MAC PDU from the first bit onward.\nA MAC CE is a bit string that is byte aligned (i.e. multiple of 8 bits) in length.\nA MAC subheader is a bit string that is byte aligned (i.e. multiple of 8 bits) in length. Each MAC subheader is placed immediately in front of the corresponding MAC SDU, MAC CE, or padding.\nThe MAC entity shall ignore the value of the Reserved bits in downlink MAC PDUs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.2\tMAC PDU (DL-SCH and UL-SCH except transparent MAC and Random Access Response)",
                            "text_content": "A MAC PDU consists of one or more MAC subPDUs. Each MAC subPDU consists of one of the following:\n-\tA MAC subheader only (including padding);\n-\tA MAC subheader and a MAC SDU;\n-\tA MAC subheader and a MAC CE;\n-\tA MAC subheader and padding.\nThe MAC SDUs are of variable sizes.\nEach MAC subheader corresponds to either a MAC SDU, a MAC CE, or padding.\nA MAC subheader except for fixed sized MAC CE, padding, and a MAC SDU containing UL CCCH consists of the header fields R/F/LCID/(eLCID)/L. A MAC subheader for fixed sized MAC CE and padding consists of the header fields R/LCID/(eLCID). A MAC subheader for a MAC SDU containing UL CCCH consists of the header fields (LX)/R/LCID.\n\n\nThe figure depicts a 16-bit R/F/LCID/ (eLCID)/ L MAC subheader with 8-bit L field, which is a crucial component in the communication system. The figure illustrates the structure of the subheader, including the R/F/LCID/ (eLCID)/ L MAC subheader, which is used to encode the data in the frame. The 8-bit L field is used to encode the length of the frame, ensuring that the data is correctly transmitted. The figure is essential for understanding the structure and encoding of the frame in the communication system.\nFigure 6.1.2-1: R/F/LCID/(eLCID)/L MAC subheader with 8-bit L field\n\n\nThe figure depicts a 16-bit L field subheader with R/F/LCID/ (eLCID)/ L MAC subheader, which is a crucial component in the 16-bit L field subheader format used in the 16-bit L field. This subheader is used to store the information about the 16-bit L field, including the R/F/LCID/ (eLCID)/ L MAC subheader, which is used to store the information about the 16-bit L field. The figure also includes a 16-bit L field subheader with R/F/LCID/ (eLCID)/ L MAC subheader, which is used to store the information about the 16-bit L field, including the R/F/LCID/ (eLCID)/ L MAC subheader, which is used to store the information about the 16-bit L field.\nFigure 6.1.2-2: R/F/LCID/(eLCID)/L MAC subheader with 16-bit L field\n\nThe figure depicts a 5G network with various subheader MAC (Media Access Control) subframes, including the 1000BASE-T (1000 Mbps Ethernet) frame, the 1000BASE-T2 (1000 Mbps Ethernet) frame, and the 1000BASE-T3 (1000 Mbps Ethernet) frame. These subframes are used for data transmission and are essential for the efficient operation of the 5G network.\nFigure 6.1.2-3: (LX)/R/LCID/(eLCID) MAC subheader\nMAC CEs are placed together. DL MAC subPDU(s) with MAC CE(s) is placed before any MAC subPDU with MAC SDU and MAC subPDU with padding as depicted in Figure 6.1.2-4. UL MAC subPDU(s) with MAC CE(s) is placed after all the MAC subPDU(s) with MAC SDU and before the MAC subPDU with padding in the MAC PDU as depicted in Figure 6.1.2-5. The size of padding can be zero.\nThe figure depicts a DL MAC PDU (Physical Media Access Control) in a 5G network, illustrating the various components and their connections. The diagram includes a base station (gNB), a user equipment (UE), and a scatterer, all connected by optical fibers. The figure also shows the use of beamforming techniques to mitigate interference, highlighting the importance of network design in ensuring reliable communication.\nFigure 6.1.2-4: Example of a DL MAC PDU\nThe figure depicts an example of a Universal Layer 2 (UL) Medium Access Control (MAC) PDU, which is a crucial component in a 5G network. It illustrates the various functions and parameters of the PDU, such as the MAC address, data rate, and power consumption. The figure is essential for understanding the communication protocols and their implementation in 5G networks.\nFigure 6.1.2-5: Example of a UL MAC PDU\nA maximum of one MAC PDU can be transmitted per TB per MAC entity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.3\tMAC Control Elements (CEs)",
                            "text_content": "Buffer Status Report (BSR) MAC CEs consist of either:\n-\tShort BSR format (fixed size); or\n-\tExtended Short BSR format (fixed size); or\n-\tLong BSR format (variable size); or\n-\tRefined Long BSR format (variable size); or\n-\tExtended Long BSR format (variable size); or\n-\tShort Truncated BSR format (fixed size); or\n-\tExtended Short Truncated BSR format (fixed size); or\n-\tLong Truncated BSR format (variable size); or\n-\tExtended Long Truncated BSR format (variable size).\nPre-emptive BSR MAC CE consists of:\n-\tPre-emptive BSR format (variable size); or\n-\tExtended Pre-emptive BSR format (variable size).\nThe BSR formats are identified by MAC subheaders with LCIDs as specified in Table 6.2.1-2.\nThe Refined Long BSR format, Extended BSR formats and Pre-emptive BSR format are identified by MAC subheaders with eLCIDs as specified in Table 6.2.1-2b.\nThe fields in the BSR MAC CE are defined as follows:\n-\tLCG ID: The Logical Channel Group ID field identifies the group of logical channel(s) whose buffer status is being reported. The length of the field is 3 bits for the case of Short BSR and Short Truncated BSR formats, and 8 bits for the case of Extended Short BSR and Extended Short Truncated BSR formats;\n-\tLCGi: For the Long BSR format, Refined Long BSR format, Extended Long BSR format, Pre-emptive BSR format, and Extended Pre-emptive BSR format, this field indicates the presence of the Buffer Size field for the logical channel group i. The LCGi field set to 1 indicates that the Buffer Size field for the logical channel group i is reported. The LCGi field set to 0 indicates that the Buffer Size field for the logical channel group i is not reported. For the Long Truncated BSR format and the Extended Long Truncated BSR format, this field indicates whether logical channel group i has data available. The LCGi field set to 1 indicates that logical channel group i has data available. The LCGi field set to 0 indicates that logical channel group i does not have data available;\n-\tBTi: This field is included only in the Refined Long BSR format. This field is present only if the corresponding LCGi is set to 1; otherwise, this field is reserved. If present, this field indicates which buffer size table is used to set the Buffer Size field for the logical channel group i. The BTi field set to 1 indicates that the buffer size table specified in Table 6.1.3.1-3 is used for the logical channel group i. The BTi field set to 0 indicates that the buffer size table specified in Table 6.1.3.1-2 is used for the logical channel group i;\n-\tBuffer Size: The Buffer Size field identifies the total amount of data available according to the data volume calculation procedure in TSs 38.322 [3] and 38.323 [4] across all logical channels of a logical channel group after the MAC PDU has been built (i.e. after the logical channel prioritization procedure, which may result the value of the Buffer Size field to zero). The amount of data is indicated in number of bytes. The size of the RLC headers and MAC subheaders are not considered in the buffer size computation. The length of this field for the Short BSR format and the Short Truncated BSR format is 5 bits. The length of this field for the Extended Short BSR format and the Extended Short Truncated BSR format is 8 bits. The length of this field for the Long BSR format, the Refined Long BSR format, the Long Truncated BSR format, the Extended Long BSR format, and the Extended Long Truncated format is 8 bits. The values for the 5-bit Buffer Size fields are shown in Tables 6.1.3.1-1. The values for the 8-bit Buffer Size fields in the Long BSR format, the Long Truncated BSR format, the Extended Long BSR format, and the Extended Long Truncated format are shown in Table 6.1.3.1-2. For the Refined Long BSR format, if an LCG is configured with additionalBSR-TableAllowed and the amount of data for an LCG is within the buffer sizes specified in Table 6.1.3.1-3, the MAC entity shall use the buffer sizes specified in Table 6.1.3.1-3 to set the value of this field; otherwise, the MAC entity shall use Table 6.1.3.1-2 instead. For the Long BSR format, the Refined Long BSR format, the Long Truncated BSR format, the Extended Long BSR format, and the Extended Long Truncated format, the Buffer Size fields are included in ascending order based on the LCGi. For the Long Truncated BSR format and the Extended Long Truncated format the number of Buffer Size fields included is maximised, while not exceeding the number of padding bits. For the Pre-emptive BSR format and the Extended Pre-emptive BSR format, the Buffer Size field identifies the total amount of the data expected to arrive at the IAB-MT of the node where the Pre-emptive BSR/Extended Pre-emptive BSR is triggered and does not include the volume of data currently available in the IAB-MT. Pre-emptive BSR format is identical to the Long BSR format. Extended Pre-emptive BSR format is identical to the Extended Long BSR format.\nNOTE 1:\tFor the Pre-emptive BSR, if configured, the LCGs to be reported, the expected data volume calculation, the exact time to report Pre-emptive BSR and the associated LCH are left to implementation.\nNOTE 2:\tThe mapping of LCGs between the ingress and egress links of an IAB node for purposes of determining expected change in occupancy of IAB-MT buffers (to be reported as Pre-emptive BSR) is left to implementation.\nNOTE 3:\tThe number of the Buffer Size fields in the Long BSR, Extended Long BSR, Long Truncated BSR, and Extended Long Truncated BSR format can be zero.\nNOTE 4:\tThe Extended versions of the BSR formats can only be used by IAB nodes.\nThe figure depicts two types of Short BSR (Basic Shortest-Path) and Short Truncated BSR (Shortest-Path Shortest-Term) MAC (Media Access Control) and CE (Control Element) protocols, which are used in 5G networks for efficient data transmission. The figure illustrates the different paths and control elements involved in these protocols, highlighting the importance of network optimization and efficient data transmission in 5G networks.\nFigure 6.1.3.1-1: Short BSR and Short Truncated BSR MAC CE\n\nThe figure depicts three different types of Shortest-Path-First (SPF) MAC layer congestion control mechanisms: Long BSR, Long Truncated BSR, and Pre-emptive BSR. Each mechanism is represented by a different color and symbol, with the Long BSR depicted in red, the Long Truncated BSR in green, and the Pre-emptive BSR in blue. The figure illustrates the different paths through which the MAC layer can be congested, and how each mechanism can be used to manage the flow of data.\nFigure 6.1.3.1-2: Long BSR, Long Truncated BSR, and Pre-emptive BSR MAC CE\n\nThe figure depicts two types of Short BSR (Basic Short Range) and Extended Short BSR (Extended Short Range) MAC (Multiplexed Access Channel) and Truncated Short BSR MAC (Truncated Short Range) MAC, respectively, with their respective CE (Channel Estimation) and CE (Channel Estimation) MAC. The figure illustrates the different configurations and their respective functionalities, such as the use of Extended Short BSR MAC for improved channel estimation and Truncated Short BSR MAC for reduced power consumption.\nFigure 6.1.3.1-3: Extended Short BSR and Extended Short Truncated BSR MAC CE\n\nThe figure depicts the various types of Extended Long BSR (Extended Long Truncated BSR) and Extended Pre-emptive BSR MAC CE (Multiplexed Access Control) used in 5G networks. The Extended Long BSR MAC CE is a technique that allows for more efficient use of spectrum resources by combining multiple access paths into a single transmission. The Extended Long Truncated BSR MAC CE is a variant of the Extended Long BSR MAC CE that uses a truncated version of the BSR MAC CE to reduce the number of access paths. The figure also includes a comparison between the Extended Long BSR MAC CE and the Extended Pre-emptive BSR MAC CE, highlighting the differences in their performance and efficiency.\nFigure 6.1.3.1-4: Extended Long BSR, Extended Long Truncated BSR, and Extended Pre-emptive BSR MAC CE\nThe figure depicts a refined Long BSR MAC CE (Multiplexed Access Channel) with a 5x5 array of 16-QAM (Quadrature Amplitude Modulation) symbols, illustrating the improved performance of the channel.\nFigure 6.1.3.1-5: Refined Long BSR MAC CE\n\nTable 6.1.3.1-1: Buffer size levels (in bytes) for 5-bit Buffer Size field\n\nTable 6.1.3.1-2: Buffer size levels (in bytes) for 8-bit Buffer Size field\n\nTable 6.1.3.1-3. Buffer size levels (in bytes) for the Buffer Size field in Refined Long BSR\n\nThe C-RNTI MAC CE is identified by MAC subheader with LCID as specified in Table 6.2.1-2.\nIt has a fixed size and consists of a single field defined as follows (Figure 6.1.3.2-1):\n-\tC-RNTI: This field contains the C-RNTI of the MAC entity. The length of the field is 16 bits.\nThe figure depicts a C-RNTI MAC CE (Media Access Control) header, which is a crucial component in the 5G network. It is used to encapsulate the RNTI (Radio Network Identifier) and MAC (Media Access Control) information, ensuring efficient communication between the base station (gNB) and the user equipment (UE). The figure illustrates the header's structure and the various fields it contains, such as the RNTI, MAC, and other related information. This figure is crucial for understanding the 5G network's data transmission and management.\nFigure 6.1.3.2-1: C-RNTI MAC CE\nThe UE Contention Resolution Identity MAC CE is identified by MAC subheader with LCID as specified in Table 6.2.1-1.\nIt has a fixed 48-bit size and consists of a single field defined as follows (Figure 6.1.3.3-1):\n-\tUE Contention Resolution Identity: This field contains the UL CCCH SDU. If the UL CCCH SDU is longer than 48 bits, this field contains the first 48 bits of the UL CCCH SDU.\nThe figure depicts a UE contention resolution identity MAC CE, which is a crucial component in 5G networks. It shows the physical layer (PHY) MAC layer, which is responsible for transmitting and receiving data. The figure illustrates the various elements involved in the UE contention resolution process, including the MAC layer, PHY layer, and the physical layer, which are essential for ensuring efficient and reliable communication in 5G networks.\nFigure 6.1.3.3-1: UE Contention Resolution Identity MAC CE\nThe Timing Advance Command MAC CE is identified by MAC subheader with LCID as specified in Table 6.2.1-1.\nIt has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.4-1):\n-\tTAG Identity (TAG ID): This field indicates the TAG Identity of the addressed TAG. The TAG with the Identity 0 contains the SpCell. The length of the field is 2 bits;\n-\tTiming Advance Command: This field indicates the index value TA (0, 1, 2… 63) used to control the amount of timing adjustment that MAC entity has to apply (as specified in TS 38.213 [6]). The length of the field is 6 bits.\nThe figure depicts a timing advance command MAC CE (Multiplexed Access Control) in a 5G network. It illustrates the process of timing advance commands, which are used to control the timing of data transmission in the network. The figure shows the various components involved in the command, such as the control signal, the data signal, and the timing signal. The figure also includes a legend to help understand the different symbols and their meanings. Overall, the figure provides a clear and concise representation of the timing advance command in a 5G network.\nFigure 6.1.3.4-1: Timing Advance Command MAC CE\nThe Absolute Timing Advance Command MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.\nIt has a fixed size and consists of two octets defined as follows (Figure 6.1.3.4a-1):\n-\tTiming Advance Command: This field indicates the index value TA used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6]. The size of the field is 12 bits;\n-\tTI: If two TAGs are configured for the SpCell, this field indicates one of the two TAGs to which the Timing Advance Command is applied. If tag2-flag is set to true by upper layers, the field set to 0 indicates the tag2-Id and the field set to 1 indicates the tag-Id of the SpCell, otherwise the field set to 0 indicates the tag-Id and the field set to 1 indicates the tag2-Id of the SpCell. If the SpCell is not configured with two TAGs, the R bit is present instead;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a complex command structure in the context of a 5G network, specifically focusing on the Absolute Timing Advance Command (ATEC) MAC command. The command is used to advance the timing of a transmission, which is crucial for ensuring reliable communication in a 5G network. The figure includes various components such as the command structure, timing commands, and the command's effect on the network.\nFigure 6.1.3.4a-1: Absolute Timing Advance Command MAC CE\nThe DRX Command MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1.\nIt has a fixed size of zero bits.\nThe Long DRX Command MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1.\nIt has a fixed size of zero bits.\nThe Configured Grant Confirmation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-2.\nIt has a fixed size of zero bits.\nThe Single Entry PHR MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-2.\nIt has a fixed size and consists of two octets defined as follows (figure 6.1.3.8-1):\n-\tR: Reserved bit, set to 0;\n-\tPower Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 below (the corresponding measured values in dB are specified in TS 38.133 [11]);\n-\tP: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding PCMAX,f,c field would have had a different value if no power backoff due to power management had been applied;\n-\tPCMAX,f,c: This field indicates the PCMAX,f,c (as specified in TS 38.213 [6]) used for calculation of the preceding PH field. The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm are specified in TS 38.133 [11]);\n-\tMPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits or DPC is present instead;\n-\tDPC: If dpc-Reporting-FR1 is configured, and the Serving Cell operates on FR1, this field indicates the ΔPPowerClass, as specified in TS 38.101-1[14] and TS 38.101-3 [16]. This field indicates an index to Table 6.1.3.8-4 and the corresponding measured values of DPC levels in dB are specified in TS 38.133 [11], the DPC field is set to 0 if the criteria to report DPC is not met. The length of the field is 2 bits. If the Serving Cell operates on FR2, R bits or MPE is present instead.\nThe figure depicts a simplified representation of a Single Entry PHR MAC (Multipath Carrier Emulation) circuit, which is a crucial component in 5G networks. It illustrates the flow of carrier signals through the network, with the PHR MAC responsible for managing the carrier signal and ensuring it reaches the receiver. The circuit includes a PHR MAC, a carrier signal, and a PHR MAC control signal. The figure provides a clear visual representation of the circuit's structure and its role in 5G communication.\nFigure 6.1.3.8-1: Single Entry PHR MAC CE\nTable 6.1.3.8-1: Power Headroom levels for PHR\n\nTable 6.1.3.8-2: Nominal UE transmit power level for PHR\n\nTable 6.1.3.8-3: Effective power reduction for MPE P-MPR\n\nTable 6.1.3.8-4: Delta power class for DPC\n\nThe Multiple Entry PHR MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-2.\nIt has a variable size, and includes the bitmap, a Type 2 PH field and an octet containing the associated PCMAX,f,c field (if reported) for SpCell of the other MAC entity, a Type 1 PH field and an octet containing the associated PCMAX,f,c field (if reported) for the PCell. It further includes, in ascending order based on the ServCellIndex, one or multiple of Type X PH fields and octets containing the associated PCMAX,f,c fields (if reported) for Serving Cells other than PCell indicated in the bitmap. X is either 1 or 3 according to TS 38.213 [6] and TS 36.213 [17].\nThe presence of Type 2 PH field for SpCell of the other MAC entity is configured by phr-Type2OtherCell with value true.\nA single octet bitmap is used for indicating the presence of PH per Serving Cell when the highest ServCellIndex of Serving Cell with configured uplink is less than 8, otherwise four octets are used.\nThe MAC entity determines whether PH value for an activated Serving Cell is based on real transmission or a reference format by considering the configured grant(s) and downlink control information which has been received until and including the PDCCH occasion in which the first UL grant for a new transmission that can accommodate the MAC CE for PHR as a result of LCP as defined in clause 5.4.3.1 is received since a PHR has been triggered if the PHR MAC CE is reported on an uplink grant received on the PDCCH or until the first uplink symbol of PUSCH transmission minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 [6] if the PHR MAC CE is reported on a configured grant.\nFor a band combination in which the UE does not support dynamic power sharing, the UE may omit the octets containing Power Headroom field and PCMAX,f,c field for Serving Cells in the other MAC entity except for the PCell in the other MAC entity and the reported values of Power Headroom and PCMAX,f,c for the PCell are up to UE implementation.\nThe PHR MAC CEs are defined as follows:\n-\tCi: This field indicates the presence of a PH field for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The Ci field set to 1 indicates that a PH field for the Serving Cell with ServCellIndex i is reported. The Ci field set to 0 indicates that a PH field for the Serving Cell with ServCellIndex i is not reported;\n-\tR: Reserved bit, set to 0;\n-\tDPCBC: If dpc-Reporting-FR1 is configured, this field indicates the ΔPPowerClass, CA/ΔPPowerClass, EN-DC/ΔPPowerClass, NR-DC, as specified in TS 38.101-1[14] and TS 38.101-3 [16], this field set to 0 indicates the delta power class for band combination is 0dB, this field set to 1 indicates the delta power class for band combination is same or larger than 3 dB. Otherwise, R bit is present, set to 0;\n-\tV: This field indicates if the PH value is based on a real transmission or a reference format. For Type 1 PH, the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used. For Type 2 PH, the V field set to 0 indicates real transmission on PUCCH and the V field set to 1 indicates that a PUCCH reference format is used. For Type 3 PH, the V field set to 0 indicates real transmission on SRS and the V field set to 1 indicates that an SRS reference format is used. Furthermore, for Type 1, Type 2, and Type 3 PH, the V field set to 0 indicates the presence of the octet containing the associated PCMAX,f,c field and the MPE or DPC field, and the V field set to 1 indicates that the octet containing the associated PCMAX,f,c field and the MPE or DPC field is omitted;\n-\tPower Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dB for the E-UTRA Serving Cell are specified in TS 36.133 [12]);\n-\tP: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding PCMAX,f,c field would have had a different value if no power backoff due to power management had been applied;\n-\tPCMAX,f,c: If present, this field indicates the PCMAX,f,c (as specified in TS 38.213 [6]) for the NR Serving Cell and the PCMAX,c or P̃CMAX,c (as specified in TS 36.213 [17]) for the E-UTRA Serving Cell used for calculation of the preceding PH field. The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dBm for the E-UTRA Serving Cell are specified in TS 36.133 [12]);\n-\tMPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits or DPC is present instead.\n-\tDPC: If dpc-Reporting-FR1 is configured, and the Serving Cell operates on FR1, this field indicates the ΔPPowerClass, as specified in TS 38.101-1[14] and TS 38.101-3 [16]. This field indicates an index to Table 6.1.3.8-4 and the corresponding measured values of DPC levels in dB are specified in TS 38.133 [11], the DPC field is set to 0 if the criteria to report DPC is not met. The length of the field is 2 bits. If the Serving Cell operates on FR2, R bits or MPE is present instead.\nThe figure depicts a 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3 9-1-3\nFigure 6.1.3.9-1: Multiple Entry PHR MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is less than 8\nThe figure depicts a 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2 9-2\nFigure 6.1.3.9-2: Multiple Entry PHR MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is equal to or higher than 8\nThe SCell Activation/Deactivation MAC CE of one octet is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size and consists of a single octet containing seven C-fields and one R-field. The SCell Activation/Deactivation MAC CE with one octet is defined as follows (Figure 6.1.3.10-1).\nThe SCell Activation/Deactivation MAC CE of four octets is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size and consists of four octets containing 31 C-fields and one R-field. The SCell Activation/Deactivation MAC CE of four octets is defined as follows (Figure 6.1.3.10-2).\n-\tCi: If there is an SCell configured for the MAC entity with SCellIndex i as specified in TS 38.331 [5], this field indicates the activation/deactivation status of the SCell with SCellIndex i, else the MAC entity shall ignore the Ci field. The Ci field is set to 1 to indicate that the SCell with SCellIndex i shall be activated. The Ci field is set to 0 to indicate that the SCell with SCellIndex i shall be deactivated;\n-\tR: Reserved bit, set to 0.\nThe figure depicts the SCell activation/deactivation MAC CE of one octet, illustrating the process of how the SCell is activated or deactivated to control the transmission of data. The figure shows the SCell MAC CE with a red background, indicating that it is active, and a green background, indicating that it is deactivated. The figure also includes a dotted line to represent the SCell MAC CE, which is active and connected to the network. The figure is a crucial visual representation of the SCell activation/deactivation process, allowing network operators to understand how to control the transmission of data.\nFigure 6.1.3.10-1: SCell Activation/Deactivation MAC CE of one octet\nThe figure depicts the SCell activation/deactivation MAC CE of four octets, illustrating the process of cell activation and deactivation in a 5G network. The figure shows the SCell MAC CE with four octets, each representing a different state of activation or deactivation. The figure demonstrates the importance of this process in ensuring the efficient operation of the network.\nFigure 6.1.3.10-2: SCell Activation/Deactivation MAC CE of four octets\nNOTE:\tIf UE receives the SCell Activation/Deactivation MAC CE for an SCell configured with TRS for fast activation of the SCell, such TRS is not used for the corresponding SCell.\nThe Duplication Activation/Deactivation MAC CE of one octet is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size and consists of a single octet containing eight D-fields. The Duplication Activation/Deactivation MAC CE is defined, for a MAC entity, as follows (Figure 6.1.3.11-1).\n-\tDi: This field indicates the activation/deactivation status of the PDCP duplication of DRB i where i is the ascending order of the DRB ID among the DRBs configured with PDCP duplication and with RLC entity(ies) associated with this MAC entity. The Di field is set to 1 to indicate that the PDCP duplication of DRB i shall be activated. The Di field is set to 0 to indicate that the PDCP duplication of DRB i shall be deactivated.\nThe figure depicts a simplified representation of the Duplication Activation/Deactivation MAC (Media Access Control) process in a 5G network. It shows the MAC CE (Media Access Control Element) in a 1x1 configuration, with a 1x1 MAC and a 1x1 DUP (Data Unit). The figure illustrates the process of activating and deactivating the DUP, which is crucial for ensuring efficient data transmission in a 5G network.\nFigure 6.1.3.11-1: Duplication Activation/Deactivation MAC CE\nNOTE:\tThe Duplication Activation/Deactivation MAC CE is not used if a DRB is configured with more than two RLC entities, i.e. with moreThanTwoRLC-DRB.\nThe SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a variable size and consists of the following fields:\n-\tA/D: This field indicates whether to activate or deactivate indicated SP CSI-RS and CSI-IM resource set(s). The field is set to 1 to indicate activation, otherwise it indicates deactivation;\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tSP CSI-RS resource set ID: This field contains an index of NZP-CSI-RS-ResourceSet containing Semi Persistent NZP CSI-RS resources, as specified in TS 38.331 [5], indicating the Semi Persistent NZP CSI-RS resource set, which shall be activated or deactivated. The length of the field is 6 bits;\n-\tIM: This field indicates the presence of the octet containing SP CSI-IM resource set ID field. If the IM field is set to 1, the octet containing SP CSI-IM resource set ID field is present. If IM field is set to 0, the octet containing SP CSI-IM resource set ID field is not present;\n-\tSP CSI-IM resource set ID: This field contains an index of CSI-IM-ResourceSet containing Semi Persistent CSI-IM resources, as specified in TS 38.331 [5], indicating the Semi Persistent CSI-IM resource set, which shall be activated or deactivated. The length of the field is 6 bits;\n-\tTCI State IDi: This field contains TCI-StateId, as specified in TS 38.331 [5], of a TCI State, which is used as QCL source for the resource within the Semi Persistent NZP CSI-RS resource set indicated by SP CSI-RS resource set ID field. TCI State ID0 indicates TCI State for the first resource within the set, TCI State ID1 for the second one and so on. The length of the field is 7 bits. If the A/D field is set to 0, the octets containing TCI State ID field(s) are not present;\n-\tR: Reserved bit, set to 0.\nThe figure depicts the activation/deactivation of a Resource Set (RS) in a 5G network, specifically the Control Element (CE) for the Control and Reporting (CSI-RS) and Information and Management (CSI-IM) Resource Sets. The activation/deactivation process is crucial for ensuring the efficient operation of the network, as it allows for the allocation of resources to different users or services. The figure provides a visual representation of the process, highlighting the different states of the RS and the corresponding MAC CE, which are essential components of the 5G network architecture.\nFigure 6.1.3.12-1: SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE\nThe Aperiodic CSI Trigger State Subselection MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a variable size consisting of following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tTi: This field indicates the selection status of the Aperiodic Trigger States configured within aperiodicTriggerStateList, as specified in TS 38.331 [5]. T0 refers to the first trigger state within the list, T1 to the second one and so on. If the list does not contain entry with index i, MAC entity shall ignore the Ti field. The Ti field is set to 1 to indicate that the Aperiodic Trigger State i shall be mapped to the codepoint of the DCI CSI request field, as specified in TS 38.214 [7]. The codepoint to which the Aperiodic Trigger State is mapped is determined by its ordinal position among all the Aperiodic Trigger States with Ti field set to 1, i.e. the first Aperiodic Trigger State with Ti field set to 1 shall be mapped to the codepoint value 1, second Aperiodic Trigger State with Ti field set to 1 shall be mapped to the codepoint value 2 and so on. The maximum number of mapped Aperiodic Trigger States is 63;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a 5G network scenario with a focus on signal propagation and signal quality. It illustrates the signal path in a 5G network, highlighting the role of base stations (gNB), user equipment (UE), and scatterers. The figure also shows the use of beamforming techniques to mitigate interference.\nFigure 6.1.3.13-1: Aperiodic CSI Trigger State Subselection MAC CE\nThe TCI States Activation/Deactivation for UE-specific PDSCH MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a variable size consisting of following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all the Serving Cells configured in the set simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2, respectively;\n-\tBWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits. This field is ignored if this MAC CE applies to a set of Serving Cells;\n-\tTi: If there is a TCI state with TCI-StateId i as specified in TS 38.331 [5], this field indicates the activation/deactivation status of the TCI state with TCI-StateId i, otherwise MAC entity shall ignore the Ti field. The Ti field is set to 1 to indicate that the TCI state with TCI-StateId i shall be activated and mapped to the codepoint of the DCI Transmission Configuration Indication field, as specified in TS 38.214 [7]. The Ti field is set to 0 to indicate that the TCI state with TCI-StateId i shall be deactivated and is not mapped to the codepoint of the DCI Transmission Configuration Indication field. The codepoint to which the TCI State is mapped is determined by its ordinal position among all the TCI States with Ti field set to 1, i.e. the first TCI State with Ti field set to 1 shall be mapped to the codepoint value 0, second TCI State with Ti field set to 1 shall be mapped to the codepoint value 1 and so on. The maximum number of activated TCI states is 8. The activated TCI states can be associated with at most one PCI different from the Serving Cell PCI at a time;\n-\tCORESET Pool ID: This field indicates that mapping between the activated TCI states and the codepoint of the DCI Transmission Configuration Indication set by field Ti is specific to the ControlResourceSetId configured with CORESET Pool ID as specified in TS 38.331 [5]. This field set to 1 indicates that this MAC CE shall be applied for the DL transmission scheduled by CORESET with the CORESET pool ID equal to 1, otherwise, this MAC CE shall be applied for the DL transmission scheduled by CORESET pool ID equal to 0. If the coresetPoolIndex is not configured for any CORESET, MAC entity shall ignore the CORESET Pool ID field in this MAC CE when receiving the MAC CE. If the Serving Cell in the MAC CE is configured in a cell list that contains more than one Serving Cell, the CORSET Pool ID field shall be ignored when receiving the MAC CE.\nThe figure depicts the activation/deactivation states of TCI (Time-Critical Information) for User-Specific PDSCH (Personal Data Stream Channel) MAC (Media Access Control) in a 5G network. The activation/deactivation states are crucial for ensuring efficient data transmission and preventing collisions. The figure illustrates the TCI states in a layered structure, with each state representing a different level of TCI activation or deactivation. This helps in optimizing the network's performance and ensuring reliable communication.\nFigure 6.1.3.14-1: TCI States Activation/Deactivation for UE-specific PDSCH MAC CE\nThe TCI State Indication for UE-specific PDCCH MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size of 16 bits with following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2, respectively;\n-\tCORESET ID: This field indicates a Control Resource Set identified with ControlResourceSetId as specified in TS 38.331 [5], for which the TCI State is being indicated. In case the value of the field is 0, the field refers to the Control Resource Set configured by controlResourceSetZero as specified in TS 38.331 [5]. The length of the field is 4 bits;\n-\tTCI State ID: This field indicates the TCI state identified by TCI-StateId as specified in TS 38.331 [5] applicable to the Control Resource Set identified by CORESET ID field. If the field of CORESET ID is set to 0, this field indicates a TCI-StateId for a TCI state of the first 64 TCI-states configured by tci-StatesToAddModList and tci-StatesToReleaseList in the PDSCH-Config in the active BWP or by dl-OrJoint-TCI-State-ToAddModList and dl-OrJoint-TCI-State-ToReleaseList in the PDSCH-Config in the active BWP or the reference BWP. If the field of CORESET ID is set to the other value than 0, this field indicates a TCI-StateId configured by tci-StatesPDCCH-ToAddList and tci-StatesPDCCH-ToReleaseList in the controlResourceSet identified by the indicated CORESET ID. The length of the field is 7 bits.\nThe figure depicts a TCI state indication for UE-specific PDCCH MAC CE, which is a crucial component in 5G network architecture. It shows the state of the PDCCH MAC CE, which is responsible for managing the data transmission between the base station (gNB) and the user equipment (UE). The figure illustrates the various states of the PDCCH MAC CE, such as active, idle, and off, and the corresponding MAC commands that can be used to control the state. This information is crucial for ensuring efficient and reliable communication in 5G networks.\nFigure 6.1.3.15-1: TCI State Indication for UE-specific PDCCH MAC CE\nThe SP CSI reporting on PUCCH Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size of 16 bits with following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tSi: This field indicates the activation/deactivation status of the Semi-Persistent CSI report configuration within csi-ReportConfigToAddModList, as specified in TS 38.331 [5]. S0 refers to the report configuration which includes PUCCH resources for SP CSI reporting in the indicated BWP and has the lowest CSI-ReportConfigId within the list with type set to semiPersistentOnPUCCH, S1 to the report configuration which includes PUCCH resources for SP CSI reporting in the indicated BWP and has the second lowest CSI-ReportConfigId and so on. If the number of report configurations within the list with type set to semiPersistentOnPUCCH in the indicated BWP is less than i + 1, MAC entity shall ignore the Si field. The Si field is set to 1 to indicate that the corresponding Semi-Persistent CSI report configuration shall be activated. The Si field is set to 0 to indicate that the corresponding Semi-Persistent CSI report configuration i shall be deactivated. If the Semi-Persistent CSI report configuration i is configured with csi-ReportSubConfigList, the Si field is set to 0 to additionally indicate that all SubConfigurations within csi-ReportSubConfigList shall be deactivated;\n-\tR: Reserved bit, set to 0.\nNOTE:\tIf a Semi-Persistent CSI report configuration i is configured with csi-ReportSubConfigList, the corresponding Si field is not set to 1.\nThe figure depicts a network interface controller (NIC) interface, specifically the SP CSI reporting on PUCCH Activation/Deactivation MAC CE. This interface is used to report the status of the PUCCH activation/deactivation MAC CE, which is a crucial component in the network's control plane. The figure shows the interface's layout, including the MAC CE, PUCCH, and the interface's status. The interface is designed to provide real-time information to the network, ensuring efficient and reliable communication.\nFigure 6.1.3.16-1: SP CSI reporting on PUCCH Activation/Deactivation MAC CE\nThe SP SRS Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a variable size with following fields:\n-\tA/D: This field indicates whether to activate or deactivate indicated SP SRS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation;\n-\tSRS Resource Set's Cell ID: This field indicates the identity of the Serving Cell, which contains activated/deactivated SP SRS Resource Set. If the C field is set to 0, this field also indicates the identity of the Serving Cell which contains all resources indicated by the Resource IDi fields. The length of the field is 5 bits;\n-\tSRS Resource Set's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains activated/deactivated SP SRS Resource Set. If the C field is set to 0, this field also indicates the identity of the BWP which contains all resources indicated by the Resource IDi fields. The length of the field is 2 bits;\n-\tC: This field indicates whether the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present. If this field is set to 1, the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present, otherwise they are not present;\n-\tSUL: This field indicates whether the MAC CE applies to the NUL carrier or SUL carrier configuration. This field is set to 1 to indicate that it applies to the SUL carrier configuration, and it is set to 0 to indicate that it applies to the NUL carrier configuration;\n-\tSP SRS Resource Set ID: This field indicates the SP SRS Resource Set ID identified by SRS-ResourceSetId as specified in TS 38.331 [5], which is to be activated or deactivated. The length of the field is 4 bits;\n-\tFi: This field indicates the type of a resource used as a spatial relationship for SRS resource within SP SRS Resource Set indicated with SP SRS Resource Set ID field. F0 refers to the first SRS resource within the resource set, F1 to the second one and so on. The field is set to 1 to indicate NZP CSI-RS resource index is used, and it is set to 0 to indicate either SSB index or SRS resource index is used. The length of the field is 1 bit. This field is only present if MAC CE is used for activation, i.e. the A/D field is set to 1;\n-\tResource IDi: This field contains an identifier of the resource used for spatial relationship derivation for SRS resource i. Resource ID0 refers to the first SRS resource within the resource set, Resource ID1 to the second one and so on. If Fi is set to 0, and the first bit of this field is set to 1, the remainder of this field contains SSB-Index as specified in TS 38.331 [5]. If Fi is set to 0, and the first bit of this field is set to 0, the remainder of this field contains SRS-ResourceId as specified in TS 38.331 [5]. The length of the field is 7 bits. This field is only present if MAC CE is used for activation, i.e. the A/D field is set to 1;\n-\tResource Serving Cell IDi: This field indicates the identity of the Serving Cell on which the resource used for spatial relationship derivation for SRS resource i is located. The length of the field is 5 bits;\n-\tResource BWP IDi: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the resource used for spatial relationship derivation for SRS resource i is located. The length of the field is 2 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts the activation/deactivation of the SP SRS (Service Requesting) MAC CE (Control Element) in a 5G network. The diagram illustrates the process of activating or deactivating the SRS, which is crucial for managing network resources and ensuring efficient communication. The figure also includes key components such as the SRS, MAC CE, and the network control plane, which are essential for managing the network's resources and ensuring efficient communication.\nFigure 6.1.3.17-1: SP SRS Activation/Deactivation MAC CE\nThe PUCCH spatial relation Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size of 24 bits with following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tPUCCH Resource ID: This field contains an identifier of the PUCCH resource ID identified by PUCCH-ResourceId as specified in TS 38.331 [5]. The length of the field is 7 bits;\n-\tSi: If, in PUCCH-Config in which the PUCCH Resource ID is configured, there is a PUCCH Spatial Relation Info with PUCCH-SpatialRelationInfoId as specified in TS 38.331 [5], configured for the uplink bandwidth part indicated by BWP ID field, Si indicates the activation status of PUCCH Spatial Relation Info with PUCCH-SpatialRelationInfoId equal to i + 1, otherwise MAC entity shall ignore this field. The Si field is set to 1 to indicate PUCCH Spatial Relation Info with PUCCH-SpatialRelationInfoId equal to i + 1 shall be activated. The Si field is set to 0 to indicate PUCCH Spatial Relation Info with PUCCH-SpatialRelationInfoId equal to i + 1 shall be deactivated. Only a single PUCCH Spatial Relation Info can be active for a PUCCH Resource at a time;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a spatial relation activation/deactivation MAC CE (Multipath Coherent Channel) in a 5G network. It illustrates the spatial relationship between the transmitter and receiver, with the transmitter transmitting signals to multiple receivers and the receiver receiving signals from multiple transmitters. The figure shows the different paths that the signals take, including the NLOS (Non-Line-of-Sight) paths and the LOS (Line-of-Sight) paths. The figure also shows the different types of channels, such as the PUCCH (Pulsed-Uplift Coherent Channel) and the PUCCH-D (Pulsed-Uplift Coherent Channel-D) channels, which are used for different types of transmission. The figure is important for understanding the spatial relationship and channel allocation in a 5G network.\nFigure 6.1.3.18-1: PUCCH spatial relation Activation/Deactivation MAC CE\nThe SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size of 16 bits with following fields:\n-\tA/D: This field indicates whether to activate or deactivate indicated SP ZP CSI-RS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation;\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint value of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tSP ZP CSI-RS resource set ID: This field contains an index of sp-ZP-CSI-RS-ResourceSetsToAddModList, as specified in TS 38.331 [5], indicating the Semi Persistent ZP CSI-RS resource set, which shall be activated or deactivated. The length of the field is 4 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a resource set activation/deactivation MAC CE (Media Access Control) event in a 5G network. The event is triggered when a resource set is activated or deactivated, and it is used to control the transmission of data packets. The figure shows the event's details, including the MAC address of the sender, the resource set ID, and the event type.\nFigure 6.1.3.19-1: SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE\nThe Recommended bit rate MAC CE is identified by a MAC subheader with LCID as specified in Tables 6.2.1-1 and 6.2.1-2 for bit rate recommendation message from the gNB to the UE and bit rate recommendation query message from the UE to the gNB, respectively. It has a fixed size and consists of two octets defined as follows (Figure 6.1.3.20-1):\n-\tLCID: This field indicates the identity of the logical channel for which the recommended bit rate or the recommended bit rate query is applicable. The length of the field is 6 bits;\n-\tUplink/Downlink (UL/DL): This field indicates whether the recommended bit rate or the recommended bit rate query applies to uplink or downlink. The length of the field is 1 bit. The UL/DL field set to 0 indicates downlink. The UL/DL field set to 1 indicates uplink;\n-\tBit Rate: This field indicates an index to Table 6.1.3.20-1. The length of the field is 6 bits. For bit rate recommendation the value indicates the recommended bit rate. For bit rate recommendation query the value indicates the desired bit rate;\n-\tX: Bit rate multiplier. For UEs supporting recommended bit rate multiplier, when bitRateMultiplier is configured for the logical channel indicated by LCID field, X field set to 1 indicates the actual value of bit rate is the value corresponding to the index indicated by the Bit Rate field multiplied by bitRateMultiplier as specified in TS 38.331 [5].\n-\tR: reserved bit, set to 0.\nThe figure depicts a 20-1: Recommended bit rate MAC (Media Access Control) and CE (Control Element) for a 20-1 network. The figure shows the recommended bit rate for the MAC and CE, which is crucial for efficient data transmission in a 20-1 network.\nFigure 6.1.3.20-1: Recommended bit rate MAC CE\nTable 6.1.3.20-1: Values (kbit/s) for Bit Rate field\n\nThe Timing Delta MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.\nIt has a fixed size and consists of two octets defined as follows (Figure 6.1.3.21-1):\n-\tR: Reserved bit, set to 0;\n-\tTdelta: This field indicates the value (0, 1, …, 2047) used to control the amount of timing adjustment that MAC entity indicates (as specified in TS 38.213 [6]). The length of the field is 11 bits.\nThe figure depicts a timing diagram for a 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21-1-3 21\nFigure 6.1.3.21-1: Timing Delta MAC CE\nThe Guard Symbols MAC CEs (i.e. Provided Guard Symbols MAC CE and Desired Guard Symbols MAC CE) for Case-1 timing mode are identified by the MAC subheader with eLCID as specified in Table 6.2.1-1b for DL-SCH and in Table 6.2.1-2b for UL-SCH.\nIt has fixed size and consists of four octets defined as follows (Figure 6.1.3.22-1):\n-\tR: Reserved bit, set to 0;\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tSub-carrier spacing (SCS): This field indicates the subcarrier spacing used as reference for the guard spacing. The length of this field is 2bits. The values for the SCS field are shown in Table 6.1.3.22-2;\n-\tNumber of Guard Symbols (NmbGSi): This field indicates the number of guard symbols for the switching scenarios shown in Table 5.18.19-1. The number of guard symbols can take values within the range of 0 to 4. Higher values 5 to 7 are reserved.\nThe figure depicts a guard symbol s (MAC CE s) in a 22-1:1 format, which is a common format for representing guard symbols in the IEEE 802.1 standard. The guard symbol is used to indicate that the data stream is in a guard state, which is a state where the data is not yet transmitted. The figure also includes a 1:1 format, which is used to represent the guard symbol s in a 22-1:1 format. The guard symbol s is used to indicate that the data stream is in a guard state, which is a state where the data is not yet transmitted. The figure also includes a 1:1 format, which is used to represent the guard symbol s in a 22-1:1 format. The guard symbol s is used to indicate that the data stream is in a guard state, which is a state where the data is not yet transmitted. The figure also includes a 1:1 format, which is used to represent the guard symbol s in a 22-1:1 format. The guard symbol s is used to indicate that the data stream is in a guard state, which is a state where the data is not yet transmitted. The\nFigure 6.1.3.22-1: Guard Symbols MAC CEs\nTable 6.1.3.22-2: Subcarrier spacing for Guard Symbols MAC CEs\n\nThe MAC CEs for BFR consists of either:\n-\tBFR MAC CE; or\n-\tTruncated BFR MAC CE.\nThe BFR MAC CE and Truncated BFR MAC CE are identified by a MAC subheader with LCID/eLCID as specified in Table 6.2.1-2 and Table 6.2.1-2b.\nThe BFR MAC CE and Truncated BFR MAC CE have a variable size. They include a bitmap and in ascending order based on the ServCellIndex, beam failure recovery information i.e. octets containing candidate beam availability indication (AC) for SCells indicated in the bitmap. For BFR MAC CE, a single octet bitmap is used when the highest ServCellIndex of this MAC entity's SCell for which beam failure is detected and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed is less than 8, otherwise four octets are used. A MAC PDU shall contain at most one BFR MAC CE.\nFor Truncated BFR MAC CE, a single octet bitmap is used for the following cases, otherwise four octets are used:\n-\tthe highest ServCellIndex of this MAC entity's SCell for which beam failure is detected and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed is less than 8; or\n-\tbeam failure is detected for SpCell (as specified in Clause 5.17) and the SpCell is to be indicated in a Truncated BFR MAC CE and the UL-SCH resources available for transmission cannot accommodate the Truncated BFR MAC CE with the four octets bitmap plus its subheader as a result of LCP.\nThe fields in the BFR MAC CEs are defined as follows:\n-\tSP: This field indicates beam failure detection (as specified in clause 5.17) for the SpCell of this MAC entity. The SP field is set to 1 to indicate that beam failure is detected for SpCell only when BFR MAC CE or Truncated BFR MAC CE is to be included into a MAC PDU as part of Random Access Procedure (as specified in 5.1.3a and 5.1.4), otherwise, it is set to 0;\n-\tCi (BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) and the presence of an octet containing the AC field for the SCell with ServCellIndex i as specified in TS 38.331 [5]. The Ci field set to 1 indicates that beam failure is detected, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet containing the AC field is present for the SCell with ServCellIndex i. The Ci field set to 0 indicates that the beam failure is either not detected or the beam failure is detected but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed, and the octet containing the AC field is not present for the SCell with ServCellIndex i. The octets containing the AC field are present in ascending order based on the ServCellIndex;\n-\tCi (Truncated BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) for the SCell with ServCellIndex i as specified in TS 38.331 [5]. The Ci field set to 1 indicates that beam failure is detected, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet containing the AC field for the SCell with ServCellIndex i may be present. The Ci field set to 0 indicates that the beam failure is either not detected or the beam failure is detected but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed, and the octet containing the AC field is not present for the SCell with ServCellIndex i. The octets containing the AC field, if present, are included in ascending order based on the ServCellIndex. The number of octets containing the AC field included is maximised, while not exceeding the available grant size;\nNOTE:\tThe number of the octets containing the AC field in the Truncated BFR MAC CE can be zero.\n-\tAC: This field indicates the presence of the Candidate RS ID field in this octet. If at least one of the SSBs with SS-RSRP above rsrp-ThresholdBFR amongst the SSBs in candidateBeamRSSCellList or the CSI-RSs with CSI-RSRP above rsrp-ThresholdBFR amongst the CSI-RSs in candidateBeamRSSCellList is available, the AC field is set to 1; otherwise, it is set to 0. If the AC field set to 1, the Candidate RS ID field is present. If the AC field set to 0, R bits are present instead;\n-\tCandidate RS ID: This field is set to the index of an SSB with SS-RSRP above rsrp-ThresholdBFR amongst the SSBs in candidateBeamRSSCellList or to the index of a CSI-RS with CSI-RSRP above rsrp-ThresholdBFR amongst the CSI-RSs in candidateBeamRSSCellList. Index of an SSB or CSI-RS is the index of an entry in candidateBeamRSSCellList corresponding to the SSB or CSI-RS. Index 0 corresponds to the first entry in the candidateBeamRSSCellList, index 1 corresponds to the second entry in the list and so on. The length of this field is 6 bits.\n-\tR: Reserved bit, set to 0.\nThe figure depicts a BFR (Basic Frequency Reuse) and Truncated BFR MAC (Multiplexed Access Channel) with a one-octet C i field, illustrating the use of a truncated BFR MAC to improve spectral efficiency.\nFigure 6.1.3.23-1: BFR and Truncated BFR MAC CE with one octet Ci field\nThe figure depicts a BFR (Basic Frequency Reconciliation) and truncated BFR MAC (Multiplexed Access Control) with four octets of the C i field, illustrating the process of frequency reconciliation and the use of the C i field for multiplexing.\nFigure 6.1.3.23-2: BFR and Truncated BFR MAC CE with four octets Ci field\nThe Enhanced TCI States Activation/Deactivation for UE-specific PDSCH MAC CE is identified by a MAC PDU subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size consisting of following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all the Serving Cells configured in the set simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2, respectively;\n-\tBWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tCi: This field indicates whether the octet containing TCI state IDi,2 is present. If this field is set to 1, the octet containing TCI state IDi,2 is present. If this field is set to 0, the octet containing TCI state IDi,2 is not present;\n-\tTCI state IDi,j: This field indicates the TCI state identified by TCI-StateId as specified in TS 38.331 [5], where i is the index of the codepoint of the DCI Transmission configuration indication field as specified in TS 38.212 [9] and TCI state IDi,j denotes the jth TCI state indicated for the ith codepoint in the DCI Transmission Configuration Indication field. The TCI codepoint to which the TCI States are mapped is determined by its ordinal position among all the TCI codepoints with sets of TCI state IDi,j fields, i.e. the first TCI codepoint with TCI state ID0,1 and TCI state ID0,2 shall be mapped to the codepoint value 0, the second TCI codepoint with TCI state ID1,1 and TCI state ID1,2 shall be mapped to the codepoint value 1 and so on. The TCI state IDi,2 is optional based on the indication of the Ci field. The maximum number of activated TCI codepoint is 8 and the maximum number of TCI states mapped to a TCI codepoint is 2.\n-\tR: Reserved bit, set to 0.\nThe figure depicts the activation/deactivation of Enhanced TCI States for UE-specific PDSCH MAC CE, highlighting the importance of this feature in enhancing network performance and user experience.\nFigure 6.1.3.24-1: Enhanced TCI States Activation/Deactivation for UE-specific PDSCH MAC CE\nThe Enhanced PUCCH Spatial Relation Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tPUCCH Resource ID: This field contains an identifier of the PUCCH resource ID identified by PUCCH-ResourceId as specified in TS 38.331 [5], which is to be activated with a spatial relation indicated by Spatial Relation Info ID field in the subsequent octet. The length of the field is 7 bits. If the indicated PUCCH Resource ID is included in a PUCCH Resource Group (configured via resourceGroupToAddModList as specified in TS 38.331 [5]) of the indicated UL BWP, no other PUCCH Resources within the same PUCCH Resource group are indicated in the MAC CE, and this MAC CE applies to all the PUCCH Resources in the PUCCH Resource group;\n-\tSpatial Relation Info ID: This field contains PUCCH-SpatialRelationInfoId – 1 where PUCCH-SpatialRelationInfoId is the identifier of the PUCCH Spatial Relation Info in PUCCH-Config in which the PUCCH Resource ID is configured, as specified in TS 38.331 [5]. The length of the field is 6 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a spatial relation activation/deactivation MAC CE (Multipath Coherent Channel) in an Enhanced PUCCH (Physical-Layer Universal Coherent Channel) scenario. The figure illustrates the spatial relation activation/deactivation of the channel, which is crucial for ensuring reliable communication in a multi-path environment.\nFigure 6.1.3.25-1: Enhanced PUCCH spatial relation Activation/Deactivation MAC CE\nThe Enhanced SP/AP SRS Spatial Relation Indication MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:\n-\tA/D: This field indicates whether to activate or deactivate indicated SP SRS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation. If the indicated SRS resource set ID is for the AP SRS resource set, MAC entity shall ignore this field;\n-\tSRS Resource Set's Cell ID: This field indicates the identity of the Serving Cell, which contains the indicated SP/AP SRS Resource Set. If the C field is set to 0, this field also indicates the identity of the Serving Cell which contains all resources indicated by the Resource IDi fields. The length of the field is 5 bits;\n-\tSRS Resource Set's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains the indicated SP/AP SRS Resource Set. If the C field is set to 0, this field also indicates the identity of the BWP which contains all resources indicated by the Resource IDi fields. The length of the field is 2 bits;\n-\tC: This field indicates whether the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present. If this field is set to 1, Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present, otherwise they are not present so MAC entity shall ignore Resource Serving Cell ID field(s) and Resource BWP ID field(s);\n-\tSUL: This field indicates whether the MAC CE applies to the NUL carrier or SUL carrier configuration. This field is set to 1 to indicate that it applies to the SUL carrier configuration, and it is set to 0 to indicate that it applies to the NUL carrier configuration;\n-\tSRS Resource Set ID: This field indicates the SP/AP SRS Resource Set ID identified by SRS-ResourceSetId as specified in TS 38.331 [5]. The length of the field is 4 bits;\n-\tFi: This field indicates the type of a resource used as a spatial relationship for SRS resource within SP/AP SRS Resource Set indicated with SP/AP SRS Resource Set ID field. F0 refers to the first SRS resource within the resource set, F1 to the second one and so on. The field is set to 1 to indicate NZP CSI-RS resource index is used, and it is set to 0 to indicate either SSB index or SRS resource index is used. The length of the field is 1 bit. This field is only present if MAC CE is used for activation of SP SRS resource set, i.e. the A/D field is set to 1, or for AP SRS resource set;\n-\tResource Serving Cell IDi: This field indicates the identity of the Serving Cell on which the resource used for spatial relationship derivation for SRS resource i is located. The length of the field is 5 bits;\n-\tResource BWP IDi: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the resource used for spatial relationship derivation for SRS resource i is located. The length of the field is 2 bits;\n-\tResource IDi: This field contains an identifier of the resource used for spatial relationship derivation for SRS resource i. Resource ID0 refers to the first SRS resource within the resource set, Resource ID1 to the second one and so on. If Fi is set to 0, the first bit of this field is always set to 0. If Fi is set to 0, and the second bit of this field is set to 1, the remainder of this field contains SSB-Index as specified in TS 38.331 [5]. If Fi is set to 0, and the second bit of this field is set to 0, the remainder of this field contains SRS-ResourceId as specified in TS 38.331 [5]. The length of the field is 8 bits. This field is only present if MAC CE is used for activation of SP SRS resource set, i.e. the A/D field is set to 1, or for AP SRS resource set;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a spatial relation indication MAC CE (Cyclic Error Detection) for Enhanced SP/AP (Serving Point/Access Point) systems. It illustrates the spatial relation between the signal source and the receiver, which is crucial for ensuring reliable communication. The figure shows the signal strength at the receiver, the signal strength at the source, and the spatial relation between the two. This information is used to determine the error rate and enable the system to detect and correct errors.\nFigure 6.1.3.26-1: Enhanced SP/AP SRS spatial relation Indication MAC CE\nThe SRS Pathloss Reference RS Update MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size of 24 bits:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell, which contains activated SRS Resource Set. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains activated SRS Resource Set. The length of the field is 2 bits;\n-\tSRS Resource Set ID: This field indicates the SRS Resource Set ID identified by SRS-ResourceSetId as specified in TS 38.331 [5]. The length of the field is 4 bits;\n-\tPathloss Reference RS ID: This field indicates the Pathloss Reference RS ID identified by srs-PathlossReferenceRS-Id as specified in TS 38.331 [5]. It updates the pathloss reference RS for an SRS-resource set indicated by SRS Resource Set ID field. The length of the field is 6 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a schematic representation of the SRS pathloss reference for RS 1, which is updated in the MAC CE update. The figure includes various components such as the SRS (Signal Received Strength) reference, the RS (Signal Received Strength) values, and the MAC (Multiplexed Access Channel) reference. The figure is used to ensure that the SRS pathloss reference is consistent with the latest MAC CE update, which is crucial for ensuring reliable communication in the network.\nFigure 6.1.3.27-1: SRS Pathloss Reference RS Update MAC CE\nThe PUSCH Pathloss Reference RS Update MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of the following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell, which contains activated PUSCH Pathloss Reference RS. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains activated PUSCH Pathloss Reference RS. The length of the field is 2 bits;\n-\tT: If the UE is configured with two SRS resources sets for codebook or non-codebook, as specified in TS 38.331 [5], in the indicated bandwidth part of the indicated Serving Cell, if this field is set to 0, SRI ID(s) to be updated are the ones associated with the first SRS resource set, and if is set to 1 the SRI ID(s) to be updated are the ones associated with the second SRS resource set. Otherwise, this field is a reserved bit set to 0;\n-\tPUSCH Pathloss Reference RS ID: This field indicates the PUSCH Pathloss Reference RS ID identified by PUSCH-PathlossReferenceRS-Id as specified in TS 38.331 [5], which is to be updated in the SRI PUSCH power control mappings indicated by SRI ID fields indicated in the same MAC CE. The length of the field is 6 bits;\n-\tC: This field indicates the presence of the additional SRI ID in the last octet of this MAC CE. If this field is set to 1, two SRI ID(s) are present in the last octet. Otherwise only one SRI ID (i.e. the first SRI ID) is present in the last octet;\n-\tSRI ID: This field indicates the SRI PUSCH power control ID identified by sri-PUSCH-PowerControlId as specified in TS 38.331 [5]. The length of the field is 4 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a pathloss reference RS update MAC CE for a specific path, which is crucial for understanding the performance of wireless communication systems.\nFigure 6.1.3.28-1: PUSCH Pathloss Reference RS Update MAC CE\nThe Serving Cell Set based SRS Spatial Relation indication MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of the following fields:\n-\tSRS Resource's Cell ID: This field indicates the identity of the Serving Cell, which contains the indicated SP/AP SRS Resource. If the C field is set to 0, this field also indicates the identity of the Serving Cell which contains all resources indicated by the Resource IDi fields. The length of the field is 5 bits. The indicated Serving Cell is configured as part of a simultaneousSpatial-UpdatedList1 or simultaneousSpatial-UpdatedList2 as specified in TS 38.331 [5], and this MAC CE applies to all the Serving Cells configured in the set simultaneousSpatial-UpdatedList1 or simultaneousSpatial-UpdatedList2, respectively;\n-\tSRS Resource's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains the indicated AP/SP SRS Resource. If the C field is set to 0, this field also indicates the identity of the BWP which contains all resources indicated by the Resource IDi fields. The length of the field is 2 bits;\n-\tC: This field indicates whether the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present. If this field is set to 1, the Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present, otherwise they are not present so MAC entity shall ignore Resource Serving Cell ID field(s) and Resource BWP ID field(s);\n-\tSRS Resource IDi: This field indicates the SP/AP SRS Resource ID identified by SRS-ResourceId as specified in TS 38.331 [5]. The length of the field is 6 bits;\n-\tFi: This field indicates the type of a resource used as a spatial relationship for SRS resource indicated with SRS Resource IDi field. F0 refers to the first SRS resource which is indicated SRS Resource ID1, F1 to the second one and so on. The field is set to 1 to indicate NZP CSI-RS resource index is used, and it is set to 0 to indicate either SSB index or SRS resource index is used. The length of the field is 1 bit;\n-\tResource Serving Cell IDi: This field indicates the identity of the Serving Cell on which the resource used for spatial relationship derivation for SRS Resource IDi is located. The length of the field is 5 bits;\n-\tResource BWP IDi: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the resource used for spatial relationship derivation for SRS Resource IDi is located. The length of the field is 2 bits;\n-\tResource IDi: This field contains an identifier of the resource used for spatial relationship derivation for SRS resource i. Resource ID0 refers to the first SRS resource which is indicated SRS Resource ID0, Resource ID1 to the second one and so on. If Fi is set to 0, the first bit of this field is always set to 0. If Fi is set to 0, and the second bit of this field is set to 1, the remainder of this field contains SSB-Index as specified in TS 38.331 [5]. If Fi is set to 0, and the second bit of this field is set to 0, the remainder of this field contains SRS-ResourceId as specified in TS 38.331 [5]. The length of the field is 8 bits.\n-\tR: Reserved bit, set to 0.\nThe figure depicts a serving cell set based SRS spatial relation indication MAC CE, which is a crucial component in 5G network architecture. It illustrates the spatial relation indication MAC CE, which is responsible for determining the spatial relationship between the serving cell and the user equipment (UE). This information is essential for efficient network management and user experience.\nFigure 6.1.3.29-1: Serving Cell set based SRS Spatial Relation Indication MAC CE\nThe LBT failure MAC CE of one octet is identified by a MAC subheader with LCID as specified in Table 6.2.1-2. It has a fixed size and consists of a single octet containing 8 C-fields as follows (Figure 6.1.3.30-1).\nThe LBT failure MAC CE of four octets is identified by a MAC subheader with LCID as specified in Table 6.2.1-2. It has a fixed size and consists of four octets containing 32 C-fields as follows (Figure 6.1.3.30-2).\nA single octet format is used when the highest ServCellIndex of this MAC entity's Serving Cell for which consistent LBT failure is detected is less than 8, otherwise four octets format is used.\n-\tCi: If there is a Serving Cell configured for the MAC entity with ServCellIndex i as specified in TS 38.331 [5] and if consistent LBT failure have been triggered and not cancelled in this Serving Cell, the field is set to 1, otherwise the field is set to 0.\nThe figure depicts a LBT failure MAC CE of one octet, illustrating the failure of a Local Bus Terminal (LBT) in a 5G network. The diagram shows the failure mode, including the failure signal, the failure location, and the failure status. The figure is crucial for understanding the failure mechanism and its impact on the network.\nFigure 6.1.3.30-1: LBT failure MAC CE of one octet\nThe figure depicts a LBT failure MAC CE of four octets, illustrating the failure of a Local Bus Terminal (LBT) in a 5G network. The diagram shows the failure mode, including the failure signal, the failure location, and the failure status. The figure is crucial for understanding the failure mechanism and its impact on the network.\nFigure 6.1.3.30-2: LBT failure MAC CE of four octets\nThe Multiple Entry Configured Grant Confirmation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b. It has a fixed size and consists of a four octets containing 32 CG-fields. The Multiple Entry Configured Grant Confirmation MAC CE is defined as follows (Figure 6.1.3.31-1).\n-\tCGi: This field indicates whether PDCCH indicating activation or deactivation of configured uplink grant with ConfiguredGrantConfigIndexMAC i has been received. The CGi field is set to 1 to indicate that PDCCH indicating activation or deactivation of type 2 configured uplink grant with ConfiguredGrantConfigIndexMAC i has been received. The CGi field is set to 0 to indicate that PDCCH indicating activation or deactivation of type 2 configured uplink grant with ConfiguredGrantConfigIndexMAC i has not been received.\nThe figure depicts a complex network configuration, specifically a Multiple Entry Configured Grant Confirmation (MECG) MAC CE, which is a crucial component in the 5G network. The figure illustrates the various layers and components involved in the network, including the base station (gNB), user equipment (UE), and scatterers. The diagram highlights the importance of beamforming techniques to mitigate interference and ensure reliable communication.\nFigure 6.1.3.31-1: Multiple Entry Configured Grant Confirmation MAC CE\nThe Duplication RLC Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.32-1).\n-\tDRB ID: This field indicates the identity of DRB for which the MAC CE applies. The length of the field is 5 bits;\n-\tRLCi: This field indicates the activation/deactivation status of PDCP duplication for the RLC entity i where i is ascending order of logical channel ID of secondary RLC entities in the order of MCG and SCG, for the DRB. For Multi-path, RLC entity i is counted in order of direct path (where i is ascending order of logical channel ID of secondary RLC entities) and indirect path. The RLCi field is set to 1 to indicate that the PDCP duplication for the RLC entity i shall be activated. The RLCi field is set to 0 to indicate that the PDCP duplication for the RLC entity i shall be deactivated.\nThe figure depicts a complex network of communication devices, including a Duplication RLC Activation/Deactivation MAC CE, which is a crucial component in the network's data transmission and processing. The figure illustrates the various stages of data transmission, including the activation and deactivation of the MAC CE, which is responsible for managing the data flow and ensuring the network's stability. The figure also shows the various interfaces and connections between the devices, such as the Duplication RLC, which is responsible for duplicating the data and transmitting it to the next device in the network. The figure is a crucial visual aid for understanding the network's data flow and the role of the MAC CE in managing the network's data.\nFigure 6.1.3.32-1: Duplication RLC Activation/Deactivation MAC CE\nSidelink Buffer Status Report (SL-BSR) MAC CEs consist of either:\n-\tSL-BSR format (variable size); or\n-\tTruncated SL-BSR format (variable size).\nSL-BSR and Truncated SL-BSR MAC control elements consist of one Destination Index field, one LCG ID field and one corresponding Buffer Size field per reported target group.\nThe SL-BSR formats are identified by MAC subheaders with LCIDs as specified in in Table 6.2.1-2.\nThe fields in the SL-BSR MAC CE are defined as follows:\n-\tDestination Index: The Destination Index field identifies the destination. The length of this field is 5 bits. The value is set to one index corresponding to SL destination identity associated to same destination reported in sl-TxResourceReqList, sl-TxResourceReqListDisc and sl-TxResourceReqListCommRelay, if present. The value is indexed sequentially from 0 in the same ascending order of SL destination identity in sl-TxResourceReqList, sl-TxResourceReqListDisc and sl-TxResourceReqListCommRelay as specified in TS 38.331 [5]. When multiple lists are reported, the value is indexed sequentially across all the lists in the same order as presented in SidelinkUEInformaitonNR message;\n-\tLCG ID: The Logical Channel Group ID field identifies the group of logical channel(s) whose SL buffer status is being reported. The length of the field is 3 bits;\n-\tBuffer Size: The Buffer Size field identifies the total amount of data available according to the data volume calculation procedure in TSs 38.322 [3] and 38.323 [4] across all logical channels of a logical channel group of a destination after the MAC PDU has been built (i.e. after the logical channel prioritization procedure, which may result the value of the Buffer Size field to zero). The amount of data is indicated in number of bytes. The size of the RLC headers and MAC subheaders are not considered in the buffer size computation. The length of this field is 8 bits. The values for the Buffer Size field are shown in Table 6.1.3.1-2, respectively. For the Truncated SL-BSR format the number of Buffer Size fields included is maximised, while not exceeding the number of padding bits.\nBuffer Sizes of LCGs are included in decreasing order of the highest priority of the sidelink logical channel having data available for transmission in each of the LCGs irrespective of the value of the Destination Index field.\nNOTE:\tVoid.\nThe figure depicts a simplified representation of the SL-BSR and Truncated SL-BSR MAC control element, which are key components in a 5G network. The SL-BSR (Single-Lateral-Band-Rearranged) and Truncated SL-BSR (Single-Lateral-Band-Rearranged with Truncation) MAC control elements are used to manage the transmission of signals in a 5G network. The figure shows the structure of the control elements, including the control plane and data plane, and illustrates the use of redundancy paths to ensure reliability.\nFigure 6.1.3.33-1: SL-BSR and Truncated SL-BSR MAC control element\nThe Sidelink Configured Grant Confirmation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b. The Sidelink Configured Grant Confirmation MAC CE is defined as follows (Figure 6.1.3.34-1):\n-\tCi: If there is a configured grant Type 2 with sl-ConfigIndexCG i configured for the MAC entity as specified in TS 38.331 [5], this field indicates the confirmation to activation/deactivation of the configured grant with sl-ConfigIndexCG i, else the MAC entity shall ignore the Ci field. The Ci field is set to 1 to confirm that the configured grant with sl-ConfigIndexCG i shall be activated. The Ci field is set to 0 to indicate that the configured grant with sl-ConfigIndexCG i shall be deactivated.\nThe figure depicts a Sidelink Configured Grant Confirmation MAC CE (Medium Access Control) for a 5G network. It shows the configuration of the Sidelink, including the MAC CE, the Sidelink MAC, and the Sidelink MAC. The figure also includes the Sidelink MAC, the Sidelink MAC, and the Sidelink MAC. The figure illustrates the Sidelink MAC, the Sidelink MAC, and the Sidelink MAC. The figure illustrates the Sidelink MAC, the Sidelink MAC, and the Sidelink MAC. The figure illustrates the Sidelink MAC, the Sidelink MAC, and the Sidelink MAC. The figure illustrates the Sidelink MAC, the Sidelink MAC, and the Sidelink MAC. The figure illustrates the Sidelink MAC, the Sidelink MAC, and the Sidelink MAC. The figure illustrates the Sidelink MAC, the Sidelink MAC, and the Sidelink MAC. The figure illustrates the Sidelink MAC, the Sidelink MAC, and the Sidelink MAC. The figure illustrates the Sidelink MAC, the Sidelink MAC, and the Sidelink MAC. The figure illustrates\nFigure 6.1.3.34-1: Sidelink Configured Grant Confirmation MAC CE\nThe Sidelink CSI Reporting MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.4-1. The priority of the Sidelink CSI Reporting MAC CE is fixed to '1'. The Sidelink CSI Reporting MAC CE is defined as follows (Figure 6.1.3.35-1):\n-\tRI: This field indicates the derived value of the Rank Indicator for sidelink CSI reporting as specified in clause 8.5 of TS 38.214 [7]. The length of the field is 1 bit, the values of the rank indicator field are mapped to allowed rank indicator values with increasing order, where '0' is mapped to the smallest allowed rank indicator value;\n-\tCQI: This field indicates the derived value of the Channel Quality Indicator for sidelink CSI reporting as specified in clause 8.5 of TS 38.214 [7]. The length of the field is 4 bit;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a simplified representation of the Sidelink CSI Reporting MAC CE (Control and Engineering) in a 5G network. It shows the various components involved in the Sidelink CSI Reporting process, including the Sidelink Control Unit (SCU), the Sidelink Control Interface (SCI), and the Sidelink Control Element (SCE). The figure illustrates the flow of data between the SCU and SCI, as well as the communication between the SCU and SCE. The diagram highlights the importance of proper communication and control in ensuring reliable and efficient 5G network operations.\nFigure 6.1.3.35-1: Sidelink CSI Reporting MAC CE\nThe SP Positioning SRS Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:\n-\tA/D: This field indicates whether to activate or deactivate indicated SP Positioning SRS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation;\n-\tPositioning SRS Resource Set's Cell ID: This field indicates the identity of the Serving Cell, which contains activated/deactivated SP Positioning SRS Resource Set. If the C field is set to 0, this field also indicates the identity of the Serving Cell which contains all resources indicated by the Spatial Relation for Resource IDi fields, if present. The length of the field is 5 bits;\n-\tPositioning SRS Resource Set's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains activated/deactivated SP Positioning SRS Resource Set. If the C field is set to 0, this field also indicates the identity of the BWP which contains all resources indicated by the Spatial Relation for Resource IDi fields, if present. The length of the field is 2 bits;\n-\tC: This field indicates whether the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) within the field Spatial Relation for Resource ID i are present, except for Spatial Relation Resource IDi with DL-PRS or SSB. When A/D is set to 1, if this field is set to 1, the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) in the field Spatial Relation for Resource IDi are present, otherwise if this field is set to 0, they are not present. When A/D is set to 0, this field is always set to 0 that they are not present;\n-\tSUL: This field indicates whether the MAC CE applies to the NUL carrier or SUL carrier configuration. This field is set to 1 to indicate that it applies to the SUL carrier configuration, and it is set to 0 to indicate that it applies to the NUL carrier configuration;\n-\tPositoining SRS Resource Set ID: This field indicates the SP Positioning SRS Resource Set identified by SRS-PosResourceSetId as specified in TS 38.331 [5], which is to be activated or deactivated. The length of the field is 4 bits;\n-\tSpatial Relation for Resource IDi: The field Spatial Relation for Resource IDi is only present if MAC CE is used for activation, i.e. the A/D field is set to 1. M is the total number of Positioning SRS resource(s) configured under the SP Positioning SRS resource set indicated by the field Positioning SRS Resource Set ID. There are 4 types of Spatial Relation for Resource IDi, which is indicated by the F (F0 and F1) field within. The fields within Spatial Relation for Resource IDi are shown in Figures 6.1.3.36-2 to 6.1.3.36-5 for the 4 types of Spatial Relations for Resource IDi;\n-\tS: This field indicates whether the fields Spatial Relation for Resource IDi for the positioning SRS resource i within the positioning SRS resource set are present. If the field is set to 1, the fields Spatial Relation for Resource IDi are present; otherwise, they are absent;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a complex network configuration, specifically highlighting the role of the SP (Service Provider) in the network. It shows the SP's position, which is crucial for the network's operation. The activation/deactivation of the SRS (Service Reliability Service) is a critical aspect of the network's functionality, as it ensures the network's reliability. The MAC (Media Access Control) CE (Control Element) is a crucial component in the network, responsible for managing the flow of data. The figure provides a detailed view of the network's configuration, highlighting the importance of each component and the overall network's functionality.\nFigure 6.1.3.36-1: SP Positioning SRS Activation/Deactivation MAC CE\nThe figure depicts a spatial relation for Resource ID i with NZP CSI-RS, illustrating the spatial relationship between the Resource ID and the NZP CSI-RS. The diagram shows the spatial relation for Resource ID i with NZP CSI-RS, highlighting the spatial relationship between the Resource ID and the NZP CSI-RS.\nFigure 6.1.3.36-2: Spatial Relation for Resource IDi with NZP CSI-RS\nThe figure depicts a spatial relation for Resource ID i with SSB, illustrating the relationship between the spatial location of the resource and its associated SSB. The diagram shows the spatial distribution of the resource, with its location marked by a dot and its associated SSB represented by a line connecting the two. This diagram is crucial for understanding the spatial distribution of resources in a network and for implementing spatial routing algorithms.\nFigure 6.1.3.36-3: Spatial Relation for Resource IDi with SSB\nThe figure depicts a spatial relation for Resource ID i with SRS, illustrating the relationship between the Resource ID and the SRS. The diagram shows the spatial distribution of the Resource ID i, with the SRS represented by a circle. The figure is used to understand the spatial relationship between the Resource ID and the SRS, which is an important concept in network planning and design.\nFigure 6.1.3.36-4: Spatial Relation for Resource IDi with SRS\nThe figure depicts a spatial relation for Resource ID i with DL-PRS, illustrating the relationship between the spatial location of the resource and the data link protocol (DL-PRS). The diagram shows the spatial relation for Resource ID i with DL-PRS, highlighting the relationship between the spatial location of the resource and the data link protocol (DL-PRS).\nFigure 6.1.3.36-5: Spatial Relation for Resource IDi with DL-PRS\nThe field Spatial Relation for Resource IDi consists of the following fields:\n-\tF0: This field indicates the type of a resource used as a spatial relation for the ith Positioning SRS resource within the Positioning SRS Resource Set indicated with the field Positioning SRS Resource Set ID. The field is set to 00 to indicate NZP CSI-RS resource index is used; it is set to 01 to indicate SSB index is used; it is set to 10 to indicate SRS resource index is used; it is set to 11 to indicate DL-PRS index is used. The length of the field is 2 bits;\n-\tF1: This field indicates the type of SRS resource used as spatial relation for the ith Positioning SRS resource within the SP Positioning SRS Resource Set indicated with the field Positioning SRS Resource Set ID when F0 is set to 10. The field is set to 0 to indicate SRS resource index SRS-ResourceId as defined in TS 38.331 [5] is used; the field is set to 1 to indicate Positioning SRS resource index SRS-PosResourceId as defined in TS 38.331 [5] is used;\n-\tNZP CSI-RS Resource ID: This field contains an index of NZP-CSI-RS-ResourceID, as specified in TS 38.331 [5], indicating the NZP CSI-RS resource, which is used to derive the spatial relation for the positioning SRS. The length of the field is 8 bits;\n-\tSSB index: This field contains an index of SSB SSB-Index as specified in TS 38.331 [5] and/or TS 37.355 [23]. The length of the field is 6 bits;\n-\tPCI: This field contains physical cell identity PhysCellId as specified in TS 38.331 [5] and/or TS 37.355 [23]. The length of the field is 10 bits;\n-\tSRS resource ID: When F1 is set to 0, the field indicates an index for SRS resource SRS-ResourceId as defined in TS 38.331 [5]; When F1 is set to 1, the field indicates an index for Positioning SRS resource SRS-PosResourceId as defined in TS 38.331 [5]. The length of the field is 5 bits representing the index from 0 to 31;\n-\tE: This field indicates the extension of SRS resource ID as the MSB of SRS resource ID. The total length of the extended SRS resource ID is 6 bits. If E bit is set to 1, the SRS resource ID value is 5-bit SRS resource ID field + 32;\n-\tDL-PRS Resource Set ID: This field contains an index for DL-PRS Resource Set nr-DL-PRS-ResourceSetId as defined in TS 37.355 [23]. The length of the field is 3 bits;\n-\tDL-PRS Resource ID: This field contains an index for DL-PRS resource nr-DL-PRS-Resource-Id as defined in TS 37.355 [23]. The length of the field is 6 bits;\n-\tDL-PRS ID: This field contains an identity for DL-PRS resource dl-PRS-ID as defined in TS 37.355 [23]. The length of the field is 8 bits;\n-\tPI: This field indicates whether the field DL-PRS resource ID is present within the Spatial Relation for Resource IDi with DL-PRS. If the field is set to 1, the octet containing the field DL-PRS resource ID is present; otherwise, the octet is omitted;\n-\tSI: This field indicates whether the field SSB index is present within the Spatial Relation for Resource IDi with SSB. If the field is set to 1, the octet containing the field SSB index is present; otherwise, the octet is omitted;\n-\tResource Serving Cell IDi: This field indicates the identity of the Serving Cell on which the resource used for spatial relationship derivation for the ith Positioning SRS resource is located. The length of the field is 5 bits;\n-\tResource BWP IDi: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the resource used for spatial relationship derivation for the ith Positioning SRS resource is located. The length of the field is 2 bits.\nThe Guard Symbols MAC CEs (i.e. Provided Guard Symbols MAC CE and Desired Guard Symbols MAC CE) for Case-6 and Case-7 timing modes are identified by the MAC subheader with eLCIDs as specified in Table 6.2.1-1b for DL-SCH and in Table 6.2.1-2b for UL-SCH.\nThe MAC CEs have fixed size and consist of three octets each, defined as follows (Figure 6.1.3.37-1 and Figure 6.1.3.37-2):\n-\tR: Reserved bit, set to 0;\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tSub-carrier spacing (SCS): This field indicates the subcarrier spacing used as reference for the guard spacing. The length of this field is 2bits. The values for the SCS field are shown in Table 6.1.3.22-2;\n-\tNumber of Guard Symbols (NmbGSi): This field indicates the number of guard symbols for the switching scenarios shown in Table 5.18.19-2.\nThe figure depicts a set of timing guard symbols (TGS) and MAC CE (Multiplexed Access Channel) symbols, which are used in the context of a 5G network. The TGSs represent the timing of the signal, while the MAC CEs represent the multiplexed access channel. The figure illustrates the importance of these symbols in ensuring the proper timing and channel allocation for 5G signals.\nFigure 6.1.3.37-1: Case-6 timing Guard Symbols MAC CEs\n\nThe figure depicts a set of timing guard symbols (TGS) and MAC CE (Multipath Access Channel) symbols, which are used in the context of a 5G network. The TGSs represent the timing of the signal, while the MAC CEs represent the access channel for the signal. The figure illustrates the importance of these symbols in ensuring the reliability and performance of 5G networks.\nFigure 6.1.3.37-2: Case-7 timing Guard Symbols MAC CEs\n\nThe Case-7 Timing advance offset MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.\nThe Case-7 Timing advance offset MAC CE is related to the Case-7 timing mode, has a fixed size and consists of two octets defined as follows (Figure 6.1.3.21-2):\n-\tR: Reserved bit, set to 0;\n-\tToffset,2: This field indicates the value (-3072, -3071, …, 1023) used to control the amount of timing adjustment that MAC entity indicates (as specified in TS 38.213 [6]). The length of the field is 12 bits.\nThe figure depicts a 38-1 1-bit case-7 timing advance offset MAC CE, which is a crucial component in the timing and synchronization of a 38-1 1-bit system. The figure illustrates the timing advance offset (TAO) and the 1-bit case-7 timing advance offset (TAAO) in a 38-1 1-bit system. The TAO is used to determine the timing of the 1-bit data, while the TAAO is used to determine the timing of the 1-bit data in the 38-1 1-bit system. The figure also includes a 1-bit case-7 timing advance offset (TAAO) in the 38-1 1-bit system, which is used to determine the timing of the 1-bit data in the 38-1 1-bit system. The figure is important for understanding the timing and synchronization of the 38-1 1-bit system.\nFigure 6.1.3.38-1: Case-7 Timing advance offset MAC CE\n\nThe Case-6 Timing Request MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-2b. This MAC CE is used by the IAB-MT node to inform its parent node whether Case-6 timing is required for simultaneous operation.\nIt has a fixed size of zero bits.\nThe Positioning Measurement Gap Activation/deactivation request MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-2b.\nIt has a fixed 8-bit size defined as follows (Figure 6.1.3.40-1):\n-\tPositioning MG ID: This field indicates the identifier for the pre-configured positioning measurement gap. The length of the field is 4 bits;\n-\tA/D: This field indicates the activation or deactivation of the Positioning Measurement Gap. The field is set to 1 to indicate activation, otherwise it indicates deactivation. The length of the field is 1 bit;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a Positioning Measurement Gap Activation/Deactivation Request MAC CE (Media Access Control) request, which is a crucial component in a 5G network. The figure shows the request's structure, including the MAC CE request, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address, the requestor's MAC address, the requestor's IP address\nFigure 6.1.3.40-1: Positioning Measurement Gap Activation/Deactivation Request MAC CE\nThe Positioning Measurement Gap Activation/Deactivation Command MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.\nIt has a fixed 8-bit size defined as follows (Figure 6.1.3.41-1):\n-\tPositioning MG ID: This field indicates the identifier for the preconfigured positioning measurement gap. The length of the field is 4 bits;\n-\tA/D: This field indicates the activation or deactivation of the Positioning Measurement Gap. The field is set to 1 to indicate activation, otherwise it indicates deactivation. The length of the field is 1 bit;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a command MAC CE (Command MAC) for Positioning Measurement Gap Activation/Deactivation in a 5G network. The command is used to control the activation/deactivation of the Positioning Measurement Gap (PMG) in the network. The figure shows the command structure, including the command ID, command type, and the command parameters. The command is executed by the Command MAC CE, which is a part of the Command MAC protocol. The figure provides a clear and concise representation of the command's structure and functionality, making it easy to understand and interpret.\nFigure 6.1.3.41-1: Positioning Measurement Gap Activation/Deactivation Command MAC CE\nThe PPW Activation/Deactivation Command MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.\nIt has variable size defined as follows (Figure 6.1.3.42-1):\n-\tnumEntry: This field indicates the number of entries N-1 in the MAC CE. 00 indicates that N equals to 2; 01 indicates that N equals to 3 and so on. The length of the field is 2 bits;\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tPPW ID: This field indicates the index of the PPW configured on active DL BWP of the Serving Cell identified by the above Serving Cell ID. Index 0 corresponds to the first entry within the list of the PPW configuration by the increasing order of dl-PPW-ID in TS 38.331 [5] in this BWP, index 1 corresponds to the second entry in the list and so on. The length of the field is 2 bits;\n-\tA/D: This field indicates the activation or deactivation of the PPW. The field is set to 1 to indicate activation, otherwise it indicates deactivation. The length of the field is 1 bit;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a command MAC CE (Command and Acknowledgment) for PPW (Power-on-Wake-up) activation/deactivation in a 5G network. The command is used to control the power state of the network, ensuring that the network is powered on and off as needed. The figure shows the command structure, including the command type (PPW), the command parameters (power level), and the command response (ACK). The figure provides a clear and concise representation of the command, making it easy to understand and interpret.\nFigure 6.1.3.42-1: PPW Activation/Deactivation Command MAC CE\nThe Enhanced MAC CEs for BFR consists of either:\n-\tEnhanced BFR MAC CE; or\n-\tTruncated Enhanced BFR MAC CE.\nThe Enhanced BFR MAC CE and Truncated Enhanced BFR MAC CE are identified by a MAC subheader with eLCID/LCID as specified in Table 6.2.1-2 and Table 6.2.1-2b.\nThe Enhanced BFR MAC CE and Truncated Enhanced BFR MAC CE have a variable size. They include an SP field, Ci bitmap (single octet or four octets), Sj bitmap (0 to 4 octets), beam failure recovery information i.e. octets containing candidate beam availability indication (AC) for BFD-RS set(s) of SpCell configured with two BFD-RS sets, and in ascending order based on ServCellIndex, beam failure recovery information i.e. octets containing candidate beam availability indication (AC) for SCells or BFD-RS set(s) of SCells configured with two BFD-RS sets indicated in the Ci bitmap. For Enhanced BFR MAC CE, a single octet Ci bitmap is used when the highest ServCellIndex of this MAC entity's SCell for which beam failure is detected for SCell or for at least one BFD-RS set of SCell and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed is less than 8, otherwise four octets Ci bitmap is used. A MAC PDU shall contain at most one MAC CE for BFR.\nFor Truncated Enhanced BFR MAC CE, a single octet Ci bitmap is used for the following cases, otherwise four octets Ci bitmap is used:\n-\tthe highest ServCellIndex of this MAC entity's SCell for which beam failure is detected for SCell or for at least one BFD-RS set of SCell and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed is less than 8; or\n-\tbeam failure is detected for SpCell (as specified in Clause 5.17) not configured with two BFD-RS sets, and the SpCell is to be indicated in a Truncated Enhanced BFR MAC CE and the UL-SCH resources available for transmission cannot accommodate the Truncated Enhanced BFR MAC CE with the four octets Ci bitmap plus its subheader as a result of LCP; or\n-\tRandom Access procedure is initiated for beam failure recovery of both BFD-RS sets of SpCell (as specified in Clause 5.17) configured with two BFD-RS sets and the SpCell is to be indicated in a Truncated Enhanced BFR MAC CE and the UL-SCH resources available for transmission cannot accommodate the Truncated Enhanced BFR MAC CE with the four octets Ci bitmap plus its subheader as a result of LCP.\nFor Enhanced BFR MAC CE and Truncated Enhanced BFR MAC CE, a single octet Sk bitmap is included if the total number of Serving Cells configured with two BFD-RS sets for which SP/Ci field set to 1 is greater than 0 and less than 9; a two octets Sk bitmap is included if the total number of Serving Cells configured with two BFD-RS sets for which SP/Ci field set to 1 is greater than 8 and less than 17; a three octets Sk bitmap is included if the total number of Serving Cells configured with two BFD-RS sets for which SP/Ci field is set to 1 is greater than 16 and less than 25; a four octets Sk bitmap is included if the total number of Serving Cells configured with two BFD-RS sets for which SP/Ci field set to 1 is greater than 24; Sk bitmap is not included if the total number of Serving Cells configured with two BFD-RS sets for which SP/Ci field is set to 1 is zero.\nFor Truncated Enhanced BFR MAC CE, octet(s) containing the AC field, if any, are included for SpCell first, then one octet containing the AC field is included for SCell(s) (in ascending order of the ServCellIndex) and then the second octet containing the AC field, if any, is included for SCell(s) (in ascending order of the ServCellIndex), while not exceeding the available grant size. The number of the octets containing the AC field in the Truncated Enhanced BFR MAC CE can be zero.\nThe fields in the Enhanced BFR MAC CEs are defined as follows:\n-\tSP (Enhanced BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) for the SpCell of this MAC entity and the presence of octet(s) containing the AC field if the SpCell is configured with multiple BFD-RS sets. For the SpCell configured with two BFD-RS sets, this field set to 1 indicates that beam failure is detected for at least one BFD-RS set, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet(s) containing the AC field is present for the SpCell; otherwise, it is set to 0. The octet(s) containing the AC field for SpCell are included before those of SCell(s). For the SpCell not configured with multiple BFD-RS sets, the SP field is set to 1 to indicate that beam failure is detected for SpCell when Enhanced BFR MAC CE is to be included into a MAC PDU as part of Random Access Procedure (as specified in 5.1.3a and 5.1.4); otherwise, it is set to 0;\n-\tSP (Truncated Enhanced BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) for the SpCell of this MAC entity. For the SpCell configured with two BFD-RS sets, this field set to 1 indicates that beam failure is detected for at least one BFD-RS set, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet(s) containing the AC field may be present for the SpCell; otherwise, it is set to 0. For the SpCell not configured with multiple BFD-RS sets, the SP field is set to 1 to indicate that beam failure is detected for SpCell when Truncated Enhanced BFR MAC CE is to be included into a MAC PDU as part of Random Access Procedure (as specified in 5.1.3a and 5.1.4); otherwise, it is set to 0;\n-\tCi (Enhanced BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) and the presence of octet(s) containing the AC field for the SCell with ServCellIndex i as specified in TS 38.331 [5]. The Ci field set to 1 indicates that beam failure is detected for the SCell or at least one BFD-RS set of the SCell, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet(s) containing the AC field is present for the SCell with ServCellIndex i. The Ci field set to 0 indicates either that the beam failure is not detected for the SCell or any BFD-RS set of the SCell, and the octet(s) containing the AC field is not present for the SCell with ServCellIndex i; or that the beam failure is detected for the SCell or at least one BFD-RS set of the SCell but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed, and the octets containing the AC field is not present for the SCell with ServCellIndex i. The octets containing the AC field are present in ascending order based on the ServCellIndex and are included after the octet(s) containing the AC field for SpCell, if any;\n-\tCi (Truncated Enhanced BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) for the SCell with ServCellIndex i as specified in TS 38.331 [5]. The Ci field set to 1 indicates that beam failure is detected for the SCell or at least one BFD-RS set of the SCell, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet(s) containing the AC field for the SCell with ServCellIndex i may be present. The Ci field set to 0 indicates either that the beam failure is not detected for the SCell or any BFD-RS set of the SCell, and the octet(s) containing the AC field is not present for the SCell with ServCellIndex i; or that the beam failure is detected for the SCell or at least one BFD-RS set of the SCell but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed, and the octet(s) containing the AC field is not present for the SCell with ServCellIndex i;\n-\tSk (Enhanced BFR MAC CE): This field corresponds to the kth Serving Cell for which SP/Ci field is set to 1 and is configured with two BFD-RS sets. The Serving Cells for which SP/Ci field is set to 1 and are configured with two BFD-RS sets, are indexed sequentially starting with SpCell and followed by SCells in ascending order of ServCellIndex i. This field indicates whether beam failure is detected for one or both BFD-RS sets and presence of one or two octets containing the AC field of the Serving Cell. The Sk field set to 1 indicates that beam failure is detected for both the BFD-RS sets, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed for both the BFD-RS sets, and the octets containing the AC field are present for both the BFD-RS sets, of the Serving Cell. The Sk field set to 0 indicates that beam failure is either detected for one of the BFD-RS sets and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed or beam failure is detected for both the BFD-RS sets but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed for both the BFD-RS sets, and the octet containing the AC field is present for only one BFD-RS set of the Serving Cell. The Sk field not mapped to any Serving Cell is set to 0;\n-\tSk (Truncated Enhanced BFR MAC CE): This field corresponds to the kth Serving Cell for which SP/Ci field is set to 1 and is configured with two BFD-RS sets. The Serving Cells for which SP/Ci field is set to 1 and are configured with two BFD-RS sets, are indexed sequentially starting with SpCell and followed by SCells in ascending order of ServCellIndex i. This field indicates whether beam failure is detected for one or both BFD-RS sets of the Serving Cell. The Sk field set to 1 indicates that beam failure is detected for both the BFD-RS sets, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed for both the BFD-RS sets, and the octet containing the AC field is present for zero, one or two BFD-RS sets of the Serving Cell. The Sk field set to 0 indicates that beam failure is either detected for one of the BFD-RS sets and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed or beam failure is detected for both the BFD-RS sets but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed for both the BFD-RS sets, and the octet containing the AC field is present for zero or one BFD-RS set of the Serving Cell. The Sk field not mapped to any Serving Cell is set to 0;\n-\tAC: This field indicates the presence of the Candidate RS ID field in this octet. If at least one of the SSBs with SS-RSRP above rsrp-ThresholdBFR amongst the SSBs in list of candidate beams (i.e. candidateBeamRS-List-r16 for the SCell not configured with two BFD-RS sets, candidateBeamRS-List-r16 or candidateBeamRS-List2-r17 for Serving Cell configured with two BFD-RS sets) or the CSI-RSs with CSI-RSRP above rsrp-ThresholdBFR amongst the CSI-RSs in list of candidate beams is available, the AC field is set to 1; otherwise, it is set to 0. If the AC field set to 1, the Candidate RS ID field is present. If the AC field set to 0, R bits are present instead;\n-\tID: This field indicates the identity of the BFD-RS set. It is set to 0 if this octet corresponds to BFD-RS set one, failureDetectionSet1-r17. It is set to 1 if this octet corresponds to BFD-RS set two, failureDetectionSet2-r17. For the Serving cell not configured with two BFD-RS sets, this field is set to 0;\n-\tCandidate RS ID: This field is set to the index of an SSB with SS-RSRP above rsrp-ThresholdBFR amongst the SSBs in list of candidate beams (i.e. candidateBeamRS-List-r16 for the SCell not configured with two BFD-RS sets, candidateBeamRS-List-r16 or candidateBeamRS-List2-r17 for Serving Cell configured with two BFD-RS sets) or to the index of a CSI-RS with CSI-RSRP above rsrp-ThresholdBFR amongst the CSI-RSs in the list of candidate beams. Index of an SSB or CSI-RS is the index of an entry in the list of candidate beams corresponding to the SSB or CSI-RS. Index 0 corresponds to the first entry in the list of candidate beams, index 1 corresponds to the second entry in the list and so on. The length of this field is 6 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a simplified representation of Enhanced BFR (Enhanced Bit Rate) and Truncated Enhanced BFR (T-Enhanced BFR) MAC CE (Multiplexed Access Control) with one octet C i  field. The figure illustrates the use of a single octet C i  field to represent the bit rate of the Enhanced BFR and Truncated Enhanced BFR MAC CE, which is a key feature in the design of these protocols. The figure also shows the use of a single octet C i  field to represent the bit rate of the Enhanced BFR and Truncated Enhanced BFR MAC CE, which is a key feature in the design of these protocols. The figure also shows the use of a single octet C i  field to represent the bit rate of the Enhanced BFR and Truncated Enhanced BFR MAC CE, which is a key feature in the design of these protocols. The figure also shows the use of a single octet C i  field to represent the bit rate of the Enhanced BFR and Truncated Enhanced BFR MAC CE, which is a key feature in the design of these protocols. The figure also shows the use of a single octet C i  field to represent the bit rate\nFigure 6.1.3.43-1: Enhanced BFR and Truncated Enhanced BFR MAC CE with one octet Ci field\nThe figure depicts a simplified representation of Enhanced BFR (Enhanced Bit Rate) and Truncated Enhanced BFR (T-EBF) MAC CE (Multiplexed Access Control) with four octets C i  field. The figure illustrates the use of a four-octet C i  field to enhance the bit rate of the data transmission.\nFigure 6.1.3.43-2: Enhanced BFR and Truncated Enhanced BFR MAC CE with four octets Ci field\nThe Enhanced TCI States Indication for UE-specific PDCCH MAC CE is identified by a MAC PDU subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size of 24 bits with following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2, respectively;\n-\tCORESET ID: This field indicates a Control Resource Set identified with ControlResourceSetId as specified in TS 38.331 [5], for which the TCI State is being indicated. In case the value of the field is 0, the field refers to the Control Resource Set configured by controlResourceSetZero as specified in TS 38.331 [5]. The length of the field is 4 bits;\n-\tTCI state IDi: This field indicates the TCI state identified by TCI-StateId as specified in TS 38.331 [5] applicable to the Control Resource Set identified by CORESET ID field. If the field of CORESET ID is set to the other value than 0, this field indicates a TCI-StateId configured by tci-StatesPDCCH-ToAddList and tci-StatesPDCCH-ToReleaseList in the controlResourceSet identified by the indicated CORESET ID. The length of the field is 7 bits.\nNOTE 1:\tThe Enhanced TCI State Indication for UE specific PDCCH MAC CE is not applicable to any of the configured CORESETs in a BWP if the CORESETs are configured with different CORESETPoolindex values in the BWP.\nNOTE 2:\tThe Enhanced TCI State Indication for UE specific PDCCH MAC CE is applied only if sfnSchemePdcch is configured.\nNOTE 3:\tThe Enhanced TCI State Indication for UE specific PDCCH MAC CE is not applicable to the CORESET configured by controlResourceSetZero if the CORESET is associated with the search space configured by pdcch-ConfigSIB1 in MIB, or searchSpaceSIB1, searchSpaceZero, searchSpaceOtherSystemInformation, or pagingSearchSpace in PDCCH-ConfigCommon.\nThe figure depicts a schematic representation of the Enhanced TCI States Indication for UE-specific PDCCH MAC CE (Multiplexed Data Channel Control Indication for Enhanced TCI States). This figure illustrates the various states of Enhanced TCI (Time-Critical Information) and their corresponding PDCCH (Multiplexed Data Channel Control) indications for each UE (User Equipment). The figure is crucial for understanding the communication protocols and signaling mechanisms in 5G networks, as it provides a visual representation of the complex network architecture and its components.\nFigure 6.1.3.44-1: Enhanced TCI States Indication for UE-specific PDCCH MAC CE\nThe PUCCH Spatial Relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tC: This field indicates whether single or two spatial relation info(s) is activated for the indicated PUCCH Resource ID. If this field is set to 1, octet containing the second spatial relation info for the indicated PUCCH Resource is present. If this field is set to 0, octet containing the second spatial relation info for the indicated PUCCH Resource is not present;\n-\tPUCCH Resource ID: This field contains an identifier of the PUCCH resource ID identified by PUCCH-ResourceId as specified in TS 38.331 [5], which is to be activated with a spatial relations indicated by Spatial Relation Info IDi fields in the subsequent octet(s). The length of the field is 7 bits. If the indicated PUCCH Resource ID is included in a PUCCH Resource Group (configured via resourceGroupToAddModList as specified in TS 38.331 [5]) of the indicated UL BWP, no other PUCCH Resources within the same PUCCH Resource group are indicated in the MAC CE, and this MAC CE applies to all the PUCCH Resources in the PUCCH Resource group;\n-\tSpatial Relation Info IDi: This field contains PUCCH-SpatialRelationInfoId–r16 where PUCCH-SpatialRelationInfoId is the identifier of the PUCCH Spatial Relation Info in PUCCH-Config in which the PUCCH Resource ID is configured, as specified in TS 38.331 [5], where i is the index of the activated spatial relation info ID. The length of the field is 6 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a spatial relation activation/deactivation mechanism for multiple TRP PUCCH repetition MAC CE (Multiplexed Orthogonal Frequency-Division Multiplexing Channel) transmissions. The diagram illustrates the spatial relation activation/deactivation for each TRP PUCCH repetition, with the activation/deactivation status of each TRP PUCCH being represented by a different color. The figure is used to ensure the proper functioning of the TRP PUCCH system, with the activation/deactivation status of each TRP PUCCH being critical for the system's performance.\nFigure 6.1.3.45-1: PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE\nThe PUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tC: This field indicates whether single or two power control set(s) is activated for the indicated PUCCH Resource ID. If this field is set to 1, the second power control set index (i.e. Power Control Set ID1) for the indicated PUCCH Resource is present. If this field is set to 0, the second power control set index (i.e. Power Control Set ID1) for the indicated PUCCH Resource is not present;\n-\tPUCCH Resource ID: This field contains an identifier of the PUCCH resource ID identified by PUCCH-ResourceId as specified in TS 38.331 [5], which is to be activated with a power control set(s) indicated by Power Control Set IDi fields in the subsequent octet. The length of the field is 7 bits. If the indicated PUCCH Resource ID is included in a PUCCH Resource Group (configured via resourceGroupToAddModList as specified in TS 38.331 [5]) of the indicated UL BWP, no other PUCCH Resources within the same PUCCH Resource group are indicated in the MAC CE, and this MAC CE applies to all the PUCCH Resources in the PUCCH Resource group;\n-\tPower Control Set IDi: This field contains PUCCH-PowerControlSetInfoId where PUCCH-PowerControlSetInfoId is the identifier of the PUCCH Power Control Set in PUCCH-Config in which the PUCCH Resource ID is configured, as specified in TS 38.331 [5], where i is the index of the power control set ID. The length of the field is 3 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a PUCCH power control set update for multiple TRP PUCCH repetition MAC CE, which is a crucial component in the power control system of a communication network. The update is performed to ensure the proper functioning of the system and to maintain the reliability of the network.\nFigure 6.1.3.46-1: PUCCH power control set update for multiple TRP PUCCH repetition MAC CE\nThe Unified TCI States Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size consisting of following fields:\n-\tCORESET Pool ID: This field indicates that the mapping between the activated TCI states and the codepoint of the DCI Transmission Configuration Indication set by field TCI state ID is specific to the ControlResourceSetId configured with CORESET Pool ID as specified in TS 38.331 [5]. This field set to 1 indicates that the TCI states are specified to CORESET pool ID equal to 1, otherwise the TCI states are specified to CORESET pool ID equal to 0. If the coresetPoolIndex is not configured for any CORESET or only one coresetPoolIndex is configured for any CORESET, the R bit is present instead;\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousU-TCI-UpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneousU-TCI-UpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4, respectively;\n-\tDL BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tUL BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. If value of unifiedTCI-StateType in the Serving Cell indicated by Serving Cell ID is joint, this field is considered as the reserved bits. The length of the BWP ID field is 2 bits;\n-\tPi: This field indicates whether each TCI codepoint has multiple TCI states or single TCI state. If Pi field is set to 1, it indicates that ith TCI codepoint includes the DL TCI state and the UL TCI state. If Pi field is set to 0, it indicates that ith TCI codepoint includes only the DL/joint TCI state or the UL TCI state. The codepoint to which a TCI state is mapped is determined by its ordinal position among all the TCI state ID fields;\n-\tD/U: This field indicate whether the TCI state ID in the same octet is for joint/downlink or uplink TCI state. If this field is set to 1, the TCI state ID in the same octet is for joint/downlink. If this field is set to 0, the TCI state ID in the same octet is for uplink;\n-\tTCI state ID: This field indicates the TCI state identified by TCI-StateId as specified in TS 38.331 [5]. If D/U is set to 1, 7-bits length TCI state ID i.e. TCI-StateId as specified in TS 38.331 [5] is used. If D/U is set to 0, the most significant bit of TCI state ID is considered as the reserved bit and remainder 6 bits indicate the TCI-UL-State-Id as specified in TS 38.331 [5]. The maximum number of activated TCI states is 16;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a simplified representation of the Unified TCI state activation/deactivation MAC CE (Multiplexed Carrier Emulation) in a 5G network. It illustrates the process of state activation and deactivation, which is crucial for ensuring the proper functioning of the network. The figure shows the various components involved, such as the carrier, the control unit (CU), and the control information (CI), which are essential for managing the network's state. The figure also includes a visual representation of the state activation/deactivation process, which is a key aspect of 5G network management.\nFigure 6.1.3.47-1: Unified TCI state activation/deactivation MAC CE\nThe Enhanced Single Entry PHR MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b. It has a variable size with following fields:\n-\tR: Reserved bit, set to 0;\n-\tPower Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 below (the corresponding measured values in dB are specified in TS 38.133 [11]);\n-\tP: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding PCMAX,f,c field would have had a different value if no power backoff due to power management had been applied;\n-\tPCMAX,f,c: This field indicates the PCMAX,f,c (as specified in TS 38.213 [6]) used for calculation of the preceding PH field. The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm are specified in TS 38.133 [11]);\n-\tMPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits are present instead;\n-\tBi: This field indicates whether the candidate beam information identified by Resourcei is present or not. If the B1 field is set to 1, the first octet containing Resource1 is present and if the B2 field is set to 1, the second octet containing Resource2 is present, and so on;\n-\tPi: If mpe-Reporting-FR2-r17 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise;\n-\tMPEi: If mpe-Reporting-FR2-r17 is configured, and the Serving Cell operates on FR2, and if the corresponding Pi field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2-r17 is not configured, or if the Serving Cell operates on FR1, or if the Pi field is set to 0, R bits are present instead;\n-\tResourcei: This field indicates the candidate beam identified by the number of entries in the corresponding mpe-ResourcePoolToAddModList as specified in TS 38.331 [5]. The length of this field 6 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a simplified representation of the Enhanced Single Entry PHR MAC (Multipath Carrier Emulation) protocol, which is used in 5G networks to enhance the performance of the PHR (Physical-to-Radio) and PHR-to-Physical (Physical-to-Physical) paths. The figure shows the PHR MAC CE (Carrier Emulation) and PHR-to-Physical paths, with the PHR MAC CE being the primary focus. The figure also includes a simplified representation of the PHR-to-Physical path, which is crucial for the overall performance of the 5G network.\nFigure 6.1.3.48-1: Enhanced Single Entry PHR MAC CE\nThe Enhanced Multiple Entry PHR MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b. It has a variable size with following fields:\n-\tCi: This field indicates the presence of PH field(s) for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The Ci field set to 1 indicates that PH field(s) for the Serving Cell with ServCellIndex i is reported. The Ci field set to 0 indicates that a PH field for the Serving Cell with ServCellIndex i is not reported;\n-\tR: Reserved bit, set to 0;\n-\tV: This field indicates if the PH value is based on a real transmission or a reference format. For Type 1 PH, the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used. For Type 2 PH, the V field set to 0 indicates real transmission on PUCCH and the V field set to 1 indicates that a PUCCH reference format is used. For Type 3 PH, the V field set to 0 indicates real transmission on SRS and the V field set to 1 indicates that an SRS reference format is used. Furthermore, for Type 1, Type 2, and Type 3 PH, the V field set to 0 indicates the presence of the octet containing the associated PCMAX,f,c field and the MPE field, and the V field set to 1 indicates that the octet containing the associated PCMAX,f,c field and the MPE field is omitted;\n-\tPower Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dB for the E-UTRA Serving Cell are specified in TS 36.133 [12]);\n-\tP: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding PCMAX,f,c field would have had a different value if no power backoff due to power management had been applied;\n-\tPCMAX,f,c: If present, this field indicates the PCMAX,f,c (as specified in TS 38.213 [6]) for the NR Serving Cell and the PCMAX,c or P̃CMAX,c (as specified in TS 36.213 [17]) for the E-UTRA Serving Cell used for calculation of the preceding PH field. The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dBm for the E-UTRA Serving Cell are specified in TS 36.133 [12]);\n-\tMPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits are present instead;\n-\tBi: This field indicates whether the candidate beam information identified by either Resourcei is present or not. If the B1 field is set to 1, the first octet containing Resource1 is present and if the B2 field is set to 1, the second octet containing Resource2 is present, and so on.\n-\tPi: If mpe-Reporting-FR2-r17 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise;\n-\tMPEi: If mpe-Reporting-FR2-r17 is configured, and the Serving Cell operates on FR2, and if the corresponding P i field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2-r17 is not configured, or if the Serving Cell operates on FR1, or if the P i field is set to 0, R bits are present instead;\n-\tResourcei: This field indicates the candidate beam identified by by the number of entries in the corresponding mpe-ResourcePoolToAddModList as specified in TS 38.331 [5]. The length of this field 6 bits.\n-\tR: Reserved bit, set to 0.\nThe figure depicts a simplified representation of a Multiple Entry PHR (MPHR) MAC (Media Access Control) with Enhanced Multiple Entry (EME) and the highest ServCellIndex of Serving Cell. The serving cell with the configured uplink is less than 8, indicating a high-speed and efficient communication network.\nFigure 6.1.3.49-1: Enhanced Multiple Entry PHR MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is less than 8\nThe figure depicts a simplified representation of a Multiple Entry PHR (MPHR) MAC (Media Access Control) with Enhanced Multiple Entry (EME) and a ServCellIndex of 8. The figure illustrates the configuration of the serving cell with the highest ServCellIndex, ensuring efficient and reliable communication.\nFigure 6.1.3.49-2: Enhanced Multiple Entry PHR MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is equal to or higher than 8\nThe Enhanced Single Entry PHR for multiple TRP MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b.\nThe two PHs together with one PCMAX,f,c for the Serving Cell are reported if UE is configured with twoPHRMode with the multiple TRP PUSCH repetition feature is configured.\nIt has a fixed size and consists of three octets defined as follows (Figure 6.1.3.50-1):\n-\tR: Reserved bit, set to 0;\n-\tPower Headroom i (PH i): This field indicates the power headroom level, where PH 1 is associated with the SRS-ResourceSet with a lower srs-ResourceSetId and PH 2 is associated with the SRS-ResourceSet with a higher srs-ResourceSetId. PH fields for a Serving Cell are included in ascending order based on i. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB are specified in TS 38.133 [11]);\n-\tP: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding PCMAX,f,c field would have had a different value if no power backoff due to power management had been applied;\n-\tV: This field indicates if the PH value for the corresponding TRP is based on a real transmission or a reference format. For Type 1 PH, the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used;\n-\tPCMAX,f,c: This field indicates the PCMAX,f,c (as specified in TS 38.213 [6]) used for calculation of the preceding PH fields. The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm are specified in TS 38.133 [11]);\n-\tMPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits are present instead.\nThe figure depicts an enhanced Single Entry PHR (E-SIPR) for multiple TRP (Time-Related PHR) MAC (Multiplexed Access Control) in a 5G network. The figure illustrates the process of selecting the appropriate TRP MAC for each TRP, ensuring efficient resource allocation and minimizing interference. The figure also highlights the importance of using a PHR MAC for efficient resource allocation and minimizing interference in a 5G network.\nFigure 6.1.3.50-1: Enhanced Single Entry PHR for multiple TRP MAC CE\nThe Enhanced Multiple Entry PHR for multiple TRP MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b.\nIt has a variable size, and includes the bitmaps, a Type 2 PH field and an octet containing the associated PCMAX,f,c field (if reported) for SpCell of the other MAC entity, a Type 1 PH field and an octet containing the associated PCMAX,f,c field (if reported) for the PCell. It further includes, in ascending order based on the ServCellIndex, one or multiple of Type X PH fields and octets containing the associated PCMAX,f,c fields (if reported) for Serving Cells other than PCell indicated in the bitmap for indicating the presence of PH(s). X is either 1 or 3 according to TS 38.213 [6] and TS 36.213 [17].\nThe presence of Type 2 PH field for SpCell of the other MAC entity is configured by phr-Type2OtherCell with value true.\nA single octet bitmap is used for indicating the presence of PH(s) per Serving Cell when the highest ServCellIndex of Serving Cell with configured uplink is less than 8, otherwise four octets are used.\nThe MAC entity determines whether PH value for an activated Serving Cell is based on real transmission or a reference format by considering the configured grant(s) and downlink control information which has been received until and including the PDCCH occasion in which the first UL grant for a new transmission that can accommodate the MAC CE for PHR as a result of LCP as defined in clause 5.4.3.1 is received since a PHR has been triggered if the PHR MAC CE is reported on an uplink grant received on the PDCCH or until the first uplink symbol of PUSCH transmission minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 [6] if the PHR MAC CE is reported on a configured grant.\nFor a band combination in which the UE does not support dynamic power sharing, the UE may omit the octets containing Power Headroom field and PCMAX,f,c field for Serving Cells in the other MAC entity except for the PCell in the other MAC entity and the reported values of Power Headroom and PCMAX,f,c for the PCell are up to UE implementation.\nThe two PHs together with one PCMAX,f,c for the Serving Cell configured with the multiple TRP PUSCH repetition feature is configured are reported if the MAC entity is configured with twoPHRMode.\nThe Enhanced Multiple Entry PHR for multiple TRP MAC CEs are defined as follows:\n-\tCi: This field indicates the presence of PH field(s) for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The Ci field set to 1 indicates that PH field(s) for the Serving Cell with ServCellIndex i is reported. The Ci field set to 0 indicates that a PH field for the Serving Cell with ServCellIndex i is not reported;\n-\tR: Reserved bit, set to 0;\n-\tV: This field indicates if the PH value is based on a real transmission or a reference format. For Type 1 PH, the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used. For Type 2 PH, the V field set to 0 indicates real transmission on PUCCH and the V field set to 1 indicates that a PUCCH reference format is used. For Type 3 PH, the V field set to 0 indicates real transmission on SRS and the V field set to 1 indicates that an SRS reference format is used. Furthermore, for Type 1, Type 2, and Type 3 PH, the V field set to 0 indicates the presence of the octet containing the associated PCMAX,f,c field and the MPE field, and all of the V field(s) for the Serving Cell set to 1 indicates that the octet containing the associated PCMAX,f,c field and the MPE field is omitted;\n-\tPower Headroom i (PH i): This field indicates the power headroom level, where PH 1 is associated with the SRS-ResourceSet with a lower srs-ResourceSetId and PH 2 is associated with the SRS-ResourceSet with a higher srs-ResourceSetId. PH fields for a Serving Cell are included in ascending order based on i. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dB for the E-UTRA Serving Cell are specified in TS 36.133 [12]);\n-\tP: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding PCMAX,f,c field would have had a different value if no power backoff due to power management had been applied;\n-\tPCMAX,f,c: If present, this field indicates the PCMAX,f,c (as specified in TS 38.213 [6]) for the NR Serving Cell and the PCMAX,c or P̃CMAX,c (as specified in TS 36.213 [17]) for the E-UTRA Serving Cell used for calculation of the preceding PH field. The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dBm for the E-UTRA Serving Cell are specified in TS 36.133 [12]);\n-\tMPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits are present instead.\nThe figure depicts a simplified representation of a Multiple Entry PHR (MPHR) for Enhanced Multiple Entry PHR (EME-PHR) with the highest ServCellIndex of Serving Cell with configured uplink less than 8. The figure illustrates the various components and their connections, including the serving cell, the uplink, and the downlink. The ServCellIndex is a metric used to measure the efficiency of the serving cell in terms of uplink and downlink transmissions. The figure provides a clear and concise visual representation of the MPR's design and its components, making it easier to understand the concept and its implications for network performance.\nFigure 6.1.3.51-1: Enhanced Multiple Entry PHR for multiple TRP MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is less than 8\nThe figure depicts a simplified representation of a Multiple Entry PHR (MPHR) for Enhanced Multiple Entry PHR (EME-PHR) with multiple Serving Cells (SCs) and a high ServCellIndex (SCI) of the Serving Cell with the highest uplink is equal to or higher than 8. This figure illustrates the concept of multiple Serving Cells (SCs) and their role in enhancing the performance of the network.\nFigure 6.1.3.51-2: Enhanced Multiple Entry PHR for multiple TRP MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is equal to or higher than 8\nThe Sidelink DRX Command MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.4-1. The priority of the Sidelink DRX Command MAC CE is fixed to '1'.\nIt has a fixed size of zero bits.\nSL DRX Command MAC CE is only supported in sidelink unicast.\nThe Inter-UE Coordination Information MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.4-1. The priority of the Inter-UE Coordination Information MAC CE is fixed to '1' for Logical Channel Prioritization (LCP) procedure. It has a variable size with following fields:\n-\tRT: This field indicates the resource set type, i.e., preferred resource set or non-preferred resource set, as the codepoint value of the SCI format 2-C resourceSetType field as specified in TS 38.212 [9].\n-\tRSL: This field indicates the location of reference slot, as the codepoint value of the SCI format 2-C referenceSlotLocation field as specified in TS 38.212 [9]. The length of the field is 17 bits. If the length of referenceSlotLocation field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 17 bit, this field contains referenceSlotLocation field using the LSB bits;\n-\tLSIi: This field indicates lowest subchannel indices for the first resource location of each TRIV, as the codepoint value of the SCI format 2-C lowestIndices field as specified in TS 38.212 [9]. LSI0 indicates lowest subchannel indices for the first resource location of TRIV within the first resource combination, LSI1 indicates lowest subchannel indices for the first resource location of TRIV within the second resource combination and so on. The length of the field is 5 bits. If the length of lowestIndices field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 5 bit, this field contains lowestIndices field using the LSB bits;\n-\tRCi: This field indicates resource combination, as the codepoint value of the SCI format 2-C resourceCombination field as specified in TS 38.212 [9]. The number of RC is based on upper bound of the L field in the MAC subheader as indicated in clause 6.2.1. RC0 indicates the first resource combination, RC1 indicates the second resource combination and so on. The length of the field is 26 bits. If the length of resourceCombination field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 26 bit, this field contains resourceCombination field using the LSB bits;\n-\tFirst resource locationi-1: This field indicates first resource location, as the codepoint value of the SCI format 2-C firstResourceLocation field as specified in TS 38.212 [9]. First Resource Location0 indicates the first resource location for the second resource combination, First Resource Location1 indicates the first resource location for the third resource combination and so on. The length of the field is 13 bits. If the length of firstResourceLocation field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 13 bit, this field contains firstResourceLocation field using the LSB bits;\n-\tR: Reserved bit, set to 0.\nNOTE:\tIt is up to UE implementation to determine whether and how to select a subset of RCs to be included in the Inter-UE Coordination Information MAC CE.\nThe figure depicts the inter-UE coordination information MAC CE (Multipath Coordination Element) in a 5G network. It illustrates the process of how signals are coordinated between different UE (User Equipment) nodes, ensuring efficient communication and reducing interference. The figure shows the various components involved, such as the base station (gNB), user equipment (UE), and scatterers, which are essential for the successful operation of a 5G network.\nFigure 6.1.3.53-1: Inter-UE Coordination Information MAC CE\nThe Inter-UE Coordination request MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.4-1. The priority of the Inter-UE Coordination Request MAC CE is fixed to '1' for Logical Channel Prioritization (LCP) procedure. It has a fixed size of 48 bits with following fields:\n-\tRT: If the value of sl-DetermineResourceType (as specified in TS 38.331 [5] clause 6.3.5) is set to ueb, this field indicates the resource set type, i.e., preferred resource set or non-preferred resource set, as the codepoint value of the SCI format 2-C resourceSetType field as specified in TS 38.212 [9]. This field is ignored if the value of sl-DetermineResourceType is set to uea;\n-\tRP: This field indicates the resource reservation period, as the codepoint value of the SCI format 2-C resourceReservationPeriod field as specified in TS 38.212 [9]. The length of the field is 4 bits. If the length of resourceReservationPeriod field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 4 bit, this field contains resourceReservationPeriod field using the LSB bits;\n-\tPriority: This field indicates the priority, as the codepoint value of the SCI format 2-C priority field as specified in TS 38.212 [9]. The length of the field is 3 bits;\n-\tRSWL: This field indicates resource selection window location, as the codepoint value of the SCI format 2-C resourceSelectionWindowLocation field as specified in TS 38.212 [9]. The length of the field is 34 bits. If the length of resourceSelectionWindowLocation field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 34 bit, this field contains resourceSelectionWindowLocation field using the LSB bits;\n-\tNumber of Subchannel: This field indicates the number of subchannels, as the codepoint value of the SCI format 2-C numberOfSubchannel field as specified in TS 38.212 [9]. The length of the field is 5 bits. If the length of numberOfSubchannel field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 5 bit, this field contains numberOfSubchannel field using the LSB bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a 54-1: Inter-UE Coordination Request MAC CE, which is a crucial component in a 5G network. It illustrates the process of requesting inter-UE coordination from the network control center (NCC) to ensure efficient communication between different network elements. The figure shows the various elements involved in the request, such as the requestor, the NCC, and the network elements, and the steps involved in the request process. This figure is crucial for ensuring seamless communication and coordination in a 5G network.\nFigure 6.1.3.54-1: Inter-UE Coordination Request MAC CE\nThe Enhanced SCell Activation/Deactivation MAC CE with one octet Ci field is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of seven C-fields, one R-field and zero or more TRS IDj fields in ascending order based on the ScellIndex for SCells indicated by the Ci field(s) to be activated. The Enhanced SCell Activation/Deactivation MAC CE of with one octet Ci field is defined as follows (Figure 6.1.3.55-1).\nThe Enhanced SCell Activation/Deactivation MAC CE with four octet Ci field is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of 31 C-fields, one R-field and zero or more TRS IDj fields in ascending order based on the ScellIndex for SCells indicated by the Ci field(s) to be activated. The Enhanced SCell Activation/Deactivation MAC CE with four octet Ci field is defined as follows (Figure 6.1.3.55-2).\n-\tCi: If there is an SCell configured for the MAC entity with SCellIndex i as specified in TS 38.331 [5], this field indicates the activation/deactivation status of the SCell with SCellIndex i, else the MAC entity shall ignore the Ci field. The Ci field is set to 1 to indicate that the SCell with SCellIndex i shall be activated and that a TRS IDj field is included for the SCell. The Ci field is set to 0 to indicate that the SCell with SCellIndex i shall be deactivated and that no TRS ID field is included for this SCell;\n-\tTRS IDj: If TRS IDj is set to a non-zero value, it indicates the corresponding TRS address by scellActivationRS-Id as specified in TS 38.331 [5] is activated. If TRS IDj is set to zero, it indicates that no TRS is used for the corresponding SCell;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a simplified representation of the Enhanced SCell Activation/Deactivation MAC CE (Multiplexed Access Channel) with one octet C i  field. The figure illustrates the process of activating or deactivating the SCell, which is a key component in the Enhanced SCell Activation/Deactivation MAC CE. The figure shows the octet C i  field as a key indicator of the activation/deactivation status of the SCell.\nFigure 6.1.3.55-1: Enhanced SCell Activation/Deactivation MAC CE with one octet Ci field\nThe figure depicts a simplified representation of the Enhanced SCell Activation/Deactivation MAC CE (Multiplexed Access Channel) with four octet C i field, illustrating the activation and deactivation of the SCell. The figure shows the SCell as a rectangular structure with four octet C i fields, each representing a different state of the SCell. The activation and deactivation of the SCell are depicted by the change in the color of the octet C i fields. The figure is a simplified representation and does not include all the details of the SCell activation/deactivation process, but it provides a clear visual representation of the process.\nFigure 6.1.3.55-2: Enhanced SCell Activation/Deactivation MAC CE with four octet Ci field\nThe Timing Advance Report MAC CE is identified by MAC subheader with LCID as specified in Table 6.2.1-2. It has a fixed size and consists of two octets defined as follows (Figure 6.1.3.56-1):\n-\tR: Reserved bit, set to 0;\n-\tTiming Advance: In FR1 except for ATG, the Timing Advance field indicates the least integer number of slots for NTN or symbols for ATG, using subcarrier spacing of 15 kHz for NTN and either 15 kHz or 30 kHz for ATG, greater than or equal to the Timing Advance value (see TS 38.211 [8], clause 4.3.1). For ATG, the Timing Advance field indicates the least integer number of symbols greater than or equal to the Timing Advance value (see TS 38.211 [8], clause 4.3.1). The symbol duration is based on the subcarriers spacing the UE is currently configured with. In this release of the specification, only 15 kHz and 30 kHz SCS are applicable and only values 1 … 56 are used. The length of the field is 14 bits.\nThe figure depicts a timing advance report (TAR) MAC CE (Control Element) for a 5G network, illustrating the control and synchronization of the network's physical layer. The figure includes various components such as the base station (gNB), user equipment (UE), and scatterers, which are essential for the efficient operation of the network. The diagram highlights the use of beamforming techniques to mitigate interference and ensure reliable communication.\nFigure 6.1.3.56-1: Timing Advance Report MAC CE\nThe Differential Koffset MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.57-1):\n-\tR: Reserved bit, set to 0;\n-\tDifferential Koffset: This field indicates the differential Koffset in the number of slots (see clause 4.2 in TS 38.213 [6]), using subcarrier spacing of 15 kHz. The length of the field is 6 bits.\nThe figure depicts a 57-1:1 differential K-offset MAC CE (Multiplexed Access Channel) in a 5G network. It illustrates the different K-offset values for each user equipment (UE) and the corresponding MAC layer. The figure is crucial for understanding the network's architecture and the different transmission modes used in 5G.\nFigure 6.1.3.57-1: Differential Koffset MAC CE\nThe BFD-RS Indication MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size, and includes a BFD-RS-ID0 field and a BFD-RS-ID1 field (optional) of failureDetectionSet1, and a BFD-RS-ID0 field and a BFD-RS-ID1 field (optional) of failureDetectionSet2.\nIt has a variable size consisting of following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.213 [6]. The length of the BWP ID field is 2 bits;\n-\tS: This field indicates the presence of the octet containing the BFD-RS ID1 of the same BFD-RS set. The S field set to 1 indicates that the octet containing BFD-RS ID1 is included. The S field set to 0 indicates that the octet containing the BFD-RS ID1 of the same BFD-RS set is not included;\n-\tBFD-RS IDi: This field indicates the BFD-RS resource from failureDetectionSet1 or failureDetectionSet2 as specified in TS 38.331 [5];\n-\tR: Reserved bit, set to 0.\nThe figure depicts a BFD-RS indication MAC CE (Medium Access Control) signal, which is a crucial component in the communication process. The figure shows the signal's path through the network, including the base station (gNB), user equipment (UE), and other network elements. The BFD-RS indication MAC CE is used to determine the best path for the signal to reach its destination, ensuring efficient and reliable communication.\nFigure 6.1.3.58-1: BFD-RS Indication MAC CE\nThe SP/AP SRS TCI State Indication MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:\n-\tA/D: This field indicates whether to activate or deactivate indicated SP SRS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation. If the indicated SRS resource set ID is for the AP SRS resource set, MAC entity shall ignore this field;\n-\tSRS Resource Set's Cell ID: This field indicates the identity of the Serving Cell, which contains the indicated SP/AP SRS Resource Set. If the C field is set to 0, this field also indicates the identity of the Serving Cell associated with all TCI states indicated by the TCI State IDi fields. The length of the field is 5 bits;\n-\tSRS Resource Set's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains the indicated SP/AP SRS Resource Set. If the C field is set to 0, this field also indicates the identity of the BWP associated with all TCI states indicated by the TCI State IDi fields. The length of the field is 2 bits;\n-\tC: This field indicates whether the octets containing TCI State Serving Cell ID field(s) and TCI State BWP ID field(s) are present. If this field is set to 1, TCI State Serving Cell ID field(s) and TCI State BWP ID field(s) are present, otherwise they are not present so MAC entity shall ignore TCI State Serving Cell ID field(s) and TCI State BWP ID field(s);\n-\tSUL: This field indicates whether the MAC CE applies to the NUL carrier or SUL carrier configuration. This field is set to 1 to indicate that it applies to the SUL carrier configuration, and it is set to 0 to indicate that it applies to the NUL carrier configuration;\n-\tSRS Resource Set ID: This field indicates the SP/AP SRS Resource Set ID identified by SRS-ResourceSetId as specified in TS 38.331 [5]. The length of the field is 4 bits;\n-\tTCI State Serving Cell IDi: This field indicates the identity of the Serving Cell on which the TCI State used for SRS resource i is located. The length of the field is 5 bits;\n-\tTCI State BWP IDi: This field indicates a BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the TCI State used for SRS resource i is located. If value of unifiedTCI-StateType in the Serving Cell indicated by TCI State Serving Cell IDi is joint, this field indicates a DL BWP. If value of unifiedTCI-StateType in the Serving Cell indicated by TCI State Serving Cell IDi is separate, this field indicates a UL BWP. The length of the field is 2 bits;\n-\tTCI State IDi: This field contains an identifier of the TCI state used for SRS resource i. TCI State ID0 refers to the first SRS resource within the resource set, TCI State ID1 refers to the second one and so on. If joint/downlink TCI State is used, 7-bits length TCI state ID i.e. TCI-StateId as specified in TS 38.331 [5] is used. If separate downlink and uplink TCI State is used, the most significant bit of TCI state ID is considered as a reserved bit and the remaining 6 bits indicate the TCI-UL-State-Id as specified in TS 38.331 [5]. The length of the field is 7 bits. This field is only present if MAC CE is used for activation of SP SRS resource set, i.e. the A/D field is set to 1, or for AP SRS resource set;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a state indication MAC CE (Multipath Channel Error) for a SP/AP (Serving Point/Access Point) system. The figure shows the SRS (Signal Reception Status) and TCI (Time-to-Change Indicator) of the system, indicating the current state of the signal reception and the time it takes for the signal to change. The figure is used to monitor the performance of the system and ensure that it is functioning correctly.\nFigure 6.1.3.59-1: SP/AP SRS TCI State Indication MAC CE\nThe Serving Cell Set based SRS TCI State Indication MAC CE is identified by a MAC subheader with eLCID as specified. It has a variable size with following fields:\n-\tSRS Resource's Cell ID: This field indicates the identity of the Serving Cell, which contains the indicated SP/AP SRS Resource. If the C field is set to 0, this field also indicates the identity of the Serving Cell associated with all TCI States indicated by the TCI State IDi fields. The length of the field is 5 bits. The indicated Serving Cell is configured as part of simultaneousSpatial-UpdatedList1 or simultaneousSpatial-UpdatedList2 in TS 38.331 [5], and this MAC CE applies to all the Serving Cells configured in the set simultaneousSpatial-UpdatedList1 or simultaneousSpatial-UpdatedList2, respectively;\n-\tSRS Resource's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains the indicated AP/SP SRS Resource. If the C field is set to 0, this field also indicates the identity of the BWP associated with all TCI States indicated by the TCI State IDi fields. The length of the field is 2 bits;\n-\tC: This field indicates whether the octets containing TCI State Serving Cell ID field(s) and TCI State BWP ID field(s) are present. If this field is set to 1, the TCI State Serving Cell ID field(s) and TCI State BWP ID field(s) are present, otherwise they are not present so MAC entity shall ignore TCI State Serving Cell ID field(s) and TCI State BWP ID field(s);\n-\tSRS Resource IDi: This field indicates the SP/AP SRS Resource ID identified by SRS-ResourceId as specified in TS 38.331 [5]. The length of the field is 6 bits;\n-\tTCI State Serving Cell IDi: This field indicates the identity of the Serving Cell on which the TCI State used for SRS Resource IDi is located. The length of the field is 5 bits;\n-\tTCI State BWP IDi: This field indicates a BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the TCI State used for SRS Resource IDi is located. If value of unifiedTCI-StateType in the Serving Cell indicated by TCI State Serving Cell IDi is joint, this field indicates a DL BWP. If value of unifiedTCI-StateType in the Serving Cell indicated by TCI State Serving Cell IDi is separate, this field indicates a UL BWP. The length of the field is 2 bits;\n-\tTCI State IDi: This field contains an identifier of the TCI state used for SRS resource i. TCI State ID0 refers to the first SRS resource which is indicated SRS Resource ID0, TCI State ID1 refers to the second one and so on. If joint/downlink TCI State is used, 7-bits length TCI state ID i.e. TCI-StateId as specified in TS 38.331 [5] is used. If separate downlink and uplink TCI State is used, the most significant bit of TCI state ID is considered as a reserved bit and the remaining 6 bits indicate the TCI-UL-State-Id as specified in TS 38.331 [5]. The length of the field is 7 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a cellular network setup, specifically focusing on the Serving Cell Set based SRS TCI State Indication MAC CE. It illustrates the various components and their connections, including the Serving Cell Set (SCS), Base Station (BS), and User Equipment (UE). The figure also highlights the use of the TCI State Indication MAC CE, which is a crucial component in the network's signaling and control processes.\nFigure 6.1.3.60-1: Serving Cell Set based SRS TCI State Indication MAC CE\nThe Child IAB-DU Restricted Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields (Figure 6.1.3.61-1):\n-\tResource Configuration ID: This fields indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;\n-\tNumber of child IAB-DU beams: This field indicates the number of restricted child IAB-DU beams included in the MAC CE. The length of the field is 8 bits. The number of restricted child IAB-DU beams is contained in the 3 rightmost bits of the field while the remaining 5 bits are considered as reserved bits;\n-\tIAB-DU restricted beams type IDi: This field determines the type of information used as an indication of a set of child IAB-DU's restricted beams, indicated with the Child IAB-DU Resource set IDi field. IAB-DU restricted beams type ID0 refers to the first restricted beam within the resource set, IAB-DU restricted beams type ID1 to the second one and so on. If the value of the field is 00, SSB index is used (contained in the 6 rightmost bits of the Child IAB-DU Resource set IDi field, with the two leftmost bits being set to zero). If the value of the field is 01, SSB index (contained in the 6 rightmost bits of the Child IAB-DU Resource set IDi field) and STC index (contained in the two leftmost bits of the Child IAB-DU Resource set IDi field) are both used. If the value of the field is set to 11, CSI-RS index, which is the NZP-CSI-RS-ResourceId as specified in TS 38.331 [5], is used (comprising all 8 bits of the Child IAB-DU Resource set IDi field). The length of the field is 2 bits;\n-\tCi1: This field indicates whether the octet containing the Number of cell configurations IDi field is included or not. C01 refers to the first restricted beam within the resource set, C11 to the second one and so on. The field is set to 0 to indicate the octet is not included (and subsequently, that no cell information is included for the relevant restricted beam). The field is set to 1 to indicate that Number of cell configurations IDi field is included. The length of the field is 1 bits;\n-\tCi2: This field indicates whether the child IAB-DU beam indicated with the Child IAB-DU Resource set IDi field is associated with one or more uplink or downlink IAB-MT beams, indicated with the IAB-MT Resource set IDij fields. C02 refers to the first restricted beam within the resource set, C12 to the second one and so on. The field is set to 1 to indicate that at least one IAB-MT Resource set IDij field is included (and that Number of associated IAB-MT beams IDi is included), and it is set to 0 to indicate that no IAB-MT Resource set IDij field is present (and that the Number of associated IAB-MT beams IDi is absent). The length of the field is 1 bit;\n-\tR: Reserved bit, set to 0;\n-\tChild IAB-DU Resource set IDi: an indication of the child IAB-DU's beam in the direction of which simultaneous operation is restricted. The length of the field is 8 bits;\n-\tNumber of cell configurations IDi: This field indicates the number of cell configurations associated with the beam restriction indicated in Child IAB-DU Resource set IDi. Number of cell configurations ID0 refers to the first restricted beam within the resource set, Number of cell configurations ID1 to the second one and so on. The length of the field is 8 bits;\n-\tCell info type IDij: indicates the type of information included in the Cell info IDij field. If the value of the field is set to zero, the combination of {MT CC, DU cell} is included in the Cell info IDij field, by including the IAB-DU cell in the first nine bits of the field, and the IAB-MT Serving Cell index into the next 5 bits of the field,. If the value of the field is set to one, only DU cell is included in the Cell info IDij field, by including the IAB-DU cell in the first nine bits of the field, and by setting the remaining five bits to zero. The length of the field is 1 bit;\n-\tMij: This field indicates whether the octet containing multiplexing mode info (containing the Multiplexing mode info IDij field) is included or not. Mi0 refers to the first combination of {MT CC, DU cell} associated with Child IAB-DU Resource set IDi, Mi1 to the second one and so on. The field is set to 1 to indicate that multiplexing mode info is included, and it is set to 0 to indicate that multiplexing mode info is not present. The length of the field is 1 bit;\n-\tCell info IDij: indicates the cell configuration associated with beam restriction indicated in Child IAB-DU Resource set IDi. Cell info IDi0 field refers to the first cell configuration associated with the beam restriction indicated in Child IAB-DU Resource set IDi, Cell info IDi1 field refers to the second cell configuration associated with the beam restriction indicated in Child IAB-DU Resource set IDi, and so on. The length of the field is 15 bits;\n-\tMultiplexing mode info IDij: The two rightmost bits indicate which of the four multiplexing modes defined in TS 38.473 [27] is applicable. The third rightmost bit of this field indicates whether multiplexing restrictions mode information contained in the two rightmost bits of the field are applicable to non-overlapping frequency resources. This bit is set to 1 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info IDij field is applicable to non-overlapping frequency resources. This field is set to 0 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info IDij field is not applicable to non-overlapping frequency resources. The remaining 5 bits of this field are set to zero. The length of the field is 8 bits;\n-\tNumber of associated IAB-MT beams IDi: This field indicates the number of IAB-MT beams associated with the beam indicated in Child IAB-DU Resource set IDi. Number of associated IAB-MT beams ID0 refers to the first restricted beam within the resource set, Number of associated IAB-MT beams ID1 to the second one and so on. The length of the field is 8 bits. The number of IAB-MT beams associated with the beam indicated in Child IAB-DU Resource set IDi is contained in the 3 rightmost bits of the field while the remaining 5 bits are considered as reserved bits;\n-\tAssociated IAB-MT's beams type IDij: This field determines the type of information used as an indication of an uplink or downlink IAB-MT beam associated with the child IAB-DU's restricted beams, indicated with the IAB-MT Resource set IDij. If the value of the field is 00, the information included in the IAB-MT Resource set IDij field is the TCI state ID (contained in the 7 rightmost bits of the field). If the value of the field is 01, the information included in the IAB-MT Resource set IDij field is the SSB ID (contained in the 6 rightmost bits of the field). If the value of the field is 10, the information included in the IAB-MT Resource set IDij field is the CSI-RS index (comprising all 8 bits), which is the NZP-CSI-RS-ResourceId as specified in TS 38.331 [5]. If the value of the field is 11, the information included in the 6 rightmost bits in the IAB-MT Resource set IDij field is the SRS-ResourceID. The length of the field is 2 bits;\n-\tIAB-MT Resource set IDij: an indication of the IAB-MTs downlink or uplink beams which are associated with the child IAB-DU restricted beam indicated in Child IAB-DU Resource set IDi field. IAB-MT Resource set IDi0 field refers to the first IAB-MT's beam associated with the child IAB-DU's restricted beam indicated in Child IAB-DU Resource set IDi field, IAB-MT Resource set IDi1 field refers to the second IAB-MT's beam associated with the child IAB-DU's restricted beam indicated in Child IAB-DU Resource set IDi field, and so on. The length of the field is 8 bits.\nThe figure depicts a 61-1: Child IAB-DU Restricted Beam Indication MAC CE, which is a crucial protocol in the 61-1 protocol suite. It illustrates the MAC layer's role in managing the restricted beam indication for the Child IAB-DU (Inter-Access Block-Downlink User) in the 61-1 protocol. The figure shows the MAC layer's responsibilities, including the creation of a restricted beam indication, the transmission of the signal, and the reception of the signal by the receiver. The figure is crucial for understanding the 61-1 protocol and its role in ensuring efficient and secure communication.\nFigure 6.1.3.61-1: Child IAB-DU Restricted Beam Indication MAC CE\nThe IAB-MT Recommended Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-2b. It has a variable size with following fields (Figure 6.1.3.62-1):\n-\tResource Configuration ID: This field indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;\n-\tNumber of IAB-MT beams: This field indicates the number of recommended IAB-MT beams included in the MAC CE. The length of the field is 8 bits. The number of recommended IAB-MT beams is contained in the 3 rightmost bits of the field while the remaining 5 bits are considered as reserved bits;\n-\tIAB-MT beam type IDi: This field determines the type of information used as an indication of an uplink or downlink IAB-MT beam, indicated with the IAB-MT Resource set IDi. If the value of the field is 00, the information included in the IAB-MT Resource set IDi field is the TCI state ID (contained in the 7 rightmost bits of the field). If the value of the field is 01, the information included in the IAB-MT Resource set IDi field is the SSB ID (contained in the 6 rightmost bits of the field). If the value of the field is 10, the information included in the IAB-MT Resource set IDi field is the CSI-RS index (comprising all 8 bits), which is the NZP-CSI-RS-ResourceId as specified in TS 38.331 [5]. If the value of the field is 11, the information included in the 6 rightmost bits in the IAB-MT Resource set IDi field is the SRS-ResourceID. The length of the field is 2 bits;\n-\tIAB-MT Resource set IDi: an indication of the IAB-MTs recommended downlink or uplink beams. IAB-MT Resource set ID0 field refers to the first IAB-MT's beam, IAB-MT Resource set ID1 field refers to the second IAB-MT's beam, and so on. The length of the field is 8 bits;\n-\tCi1: This field indicates whether the octet containing the Number of cell configurations IDi field is included or not. C01 refers to the first recommended beam within the resource set, C11 to the second one and so on. The field is set to 0 to indicate the octet is not included (and subsequently, that no cell information is included for the relevant recommended beam). The field is set to 1 to indicate that Number of cell configurations IDi field is included. The length of the field is 1 bits;\n-\tR: Reserved bit, set to 0;\n-\tNumber of cell configurations IDi: This field indicates the number of cell configurations associated with the beam indicated in IAB-MT Resource set IDi. Number of cell configurations ID0 refers to the first recommended beam within the resource set, Number of cell configurations ID1 to the second one and so on. The length of the field is 8 bits;\n-\tCell info type IDij: indicates the type of information included in the Cell info IDij field. If the value of the field is set to zero, the combination of {MT CC, DU cell} is included in the Cell info IDij field, by including the IAB-DU cell in the first nine bits of the field, and the IAB-MT Serving Cell index into the next 5 bits of the field. If the value of the field is set to one, only MT CC information is included in the Cell info IDij field, by including the IAB-MT Serving Cell index in the first 5 bits of the field, and by setting the remaining nine bits to zero. The length of the field is 1 bit;\n-\tMij: This field indicates whether the octet containing multiplexing mode info (containing the Multiplexing mode info IDij field) is included or not. Mi0 refers to the first combination of {MT CC, DU cell} associated with IAB-MT Resource set IDi, Mi1 to the second one and so on. The field is set to 1 to indicate that multiplexing mode info is included, and it is set to 0 to indicate that multiplexing mode info is not present. The length of the field is 1 bit;\n-\tCell info IDij: indicates the cell configuration associated with beam recommendation indicated in IAB-MT Resource set IDi. Cell info IDi0 field refers to the first cell configuration associated with the beam recommendation indicated in IAB-MT Resource set IDi, Cell info IDi1 field refers to the second cell configuration associated with the beam recommendation indicated in IAB-MT Resource set IDi, and so on. The length of the field is 14 bits.\n-\tMultiplexing mode info IDij: The two rightmost bits indicate which of the four multiplexing modes defined in TS 38.473 [27] is applicable. The third rightmost bit of this field indicates whether multiplexing restrictions mode information contained in the two rightmost bits of the field are applicable to non-overlapping frequency resources. This bit is set to 1 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info IDij field is applicable to non-overlapping frequency resources. This field is set to 0 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info IDij field is not applicable to non-overlapping frequency resources. The remaining 5 bits of this field are set to zero. The length of the field is 8 bits.\nThe figure depicts a 62-1: IAB-MT Recommended Beam Indication MAC CE, which is a crucial component in the 62-1 protocol used in the IAB-MT (Interoperability and Beamforming for Multicast Transport) standard. This MAC CE is responsible for determining the optimal beamforming pattern for the multicast transport, ensuring efficient and reliable communication. The figure includes various elements such as the IAB-MT protocol, the 62-1 protocol, and the MAC CE, providing a comprehensive understanding of the IAB-MT standard.\nFigure 6.1.3.62-1: IAB-MT Recommended Beam Indication MAC CE\nThe DL TX Power Adjustment MAC CE and Desired DL TX Power Adjustment MAC CEs are identified by MAC subheaders with eLCIDs as specified in Table 6.2.1-1b and Table 6.2.1-1b, respectively. Otherwise the format of the two MAC CEs is identical. Each has a variable size with following fields (Figure 6.1.3.63-1):\n-\tResource Configuration ID: This field indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;\n-\tDL Tx Power adjustment: For the case of the Desired DL TX Power Adjustment MAC CE, this field contains desired DL TX power adjustment sent by an IAB-MT to assist with the parent node's DL TX power allocation. For the case of the DL TX Power Adjustment MAC CE, this fields contains adjustment to a node's DL TX power sent by its parent node. The value of the power adjustment is in both cases contained in the 5 right-most bits of the field with codepoints (00000, 00001, …, 11101, 11110) indicating the corresponding value (-15dB, -14dB, …, 14dB, 15dB) and the codepoint 11111 not being used, while the remaining 3 bits are set to zero. The length of the field is 8 bits;\n-\tReference CSI-RS ID: This field indicates the CSI-RS used as reference for power adjustment, which is identified by NZP-CSI-RS-ResourceId as specified in TS 38.331 [5]. The indicated DL TX power adjustment is in terms of a relative offset to the CSI-RS TX power of the indicated CSI-RS. The length of this field is 8bits;\n-\tC0: This field indicates whether the octet containing multiplexing mode info (containing the Multiplexing mode info field) is included or not. The field is set to 1 to indicate that multiplexing mode info is included, and it is set to 0 to indicate that multiplexing mode info is not present. The length of the field is 1 bit;\n-\tC1: This field indicates whether the two octets containing the Cell info are included or not. The field is set to 0 to indicate the two octets are not included (and subsequently, that no cell information is included). The field is set to 1 to indicate that the two octets are included. The length of the field is 1 bits;\n-\tC2: This field indicates whether any information on IAB-MT DL beams is included or not. The field is set to 1 to indicate that at least one IAB-MT Resource set IDi field is included, and it is set to 0 to indicate that no IAB-MT Resource set IDi field is present. The length of the field is 1 bit;\n-\tR: Reserved bit, set to 0.\n-\tMultiplexing mode info: The two rightmost bits indicate which of the four multiplexing modes defined in TS 38.473 [27] is applicable. The third rightmost bit of this field indicates whether multiplexing restrictions mode information contained in the two rightmost bits of the field are applicable to non-overlapping frequency resources. This bit is set to 1 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info field is applicable to non-overlapping frequency resources. This field is set to 0 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info field is not applicable to non-overlapping frequency resources. The remaining 5 bits of this field are set to zero. The length of the field is 8 bits;\n-\tNumber of IAB-MT DL beams: This field indicates the number of IAB-MT beams included in the MAC CE. The length of the field is 8 bits;\n-\tIAB-MT beam type IDi: This field determines the type of information used as an indication of a downlink IAB-MT beam, indicated with the IAB-MT Resource set IDi. If the value of the field is 00, the information included in the IAB-MT Resource set IDi field is the TCI state ID (contained in the 7 rightmost bits of the field). If the value of the field is 01, the information included in the IAB-MT Resource set IDi field is the SSB ID (contained in the 6 rightmost bits of the field). If the value of the field is 10, the information included in the IAB-MT Resource set IDi field is the CSI-RS index (comprising all 8 bits), which is the NZP-CSI-RS-ResourceId as specified in TS 38.331 [5]. The length of the field is 2 bits;\n-\tIAB-MT Resource set IDi: an indication of the IAB-MTs downlink beams. IAB-MT Resource set ID0 field refers to the first IAB-MT downlink beam, IAB-MT Resource set ID1 field refers to the second IAB-MT downlink beam, and so on. The length of the field is 8 bits;\n-\tDU resource configuration: when this field is set to 00, the provided power adjustment is applied on FDM resources where the simultaneous MT and DU signals are non-overlapping in the frequency-domain; when this field is set to 01, the provided power adjustment is applied on non-FDM resources where the simultaneous MT and DU signals may overlap in the frequency-domain for a given (MT CC, DU cell); when this field is set to 10, the provided power adjustment is applied on FDM resources where the simultaneous MT and DU signals are non-overlapping in the frequency-domain, and on non-FDM resources where the simultaneous MT and DU signals may overlap in the frequency-domain for a given (MT CC, DU cell). The length of the field is 2 bits;\n-\tCell info: indicates the cell configuration associated with the information contained in the MAC CE. The length of the field is 14 bits. IAB-DU cell is contained in the first nine bits of the field, while the Child IAB-MT Serving Cell index into the next 5 bits of the field. The length of the field is 14 bits.\nThe figure depicts a schematic representation of the power adjustment process for downlink (DL) transmission in a 63-1 system. It illustrates the steps taken to adjust the desired downlink transmit power, including the adjustment of the transmit power of the DL TX and the adjustment of the desired DL TX power. The figure also shows the connection between the DL TX and the desired DL TX power adjustment MAC CE, which is essential for ensuring the proper functioning of the system.\nFigure 6.1.3.63-1: DL TX Power Adjustment and Desired DL TX Power Adjustment MAC CEs\nThe Desired IAB-MT PSD range MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-2b. It has a variable size with following fields (Figure 6.1.3.64-1):\n-\tResource Configuration ID: This field indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;\n-\tPSD range: This field contains the desired PSD range a node sends to its parent node to help with the sending node's MT UL TX power control. The desired PSD range is indicated by a maximum value (i.e. Pmax), and an offset relative to the maximum value, i.e. the desired PSD range is from Pmax - offset to Pmax. The 4 left-most bits of the field indicate the offset, the offset range is from 0 dB to 10 dB, the value 0000 corresponds to 0 dB, the value 0001 corresponds to 1 dB and so on, the values from 1011 onwards are reserved. The next 7 left-most bits indicate the Pmax range, the Pmax range is from -60 dBm to 50 dBm, the value 0000000 corresponds to -60 dBm, the value 0000001 corresponds to -59 dBm and so on, the values from 1101111 onwards are reserved. The remaining 5 bits are set to zero. The length of the field is 16 bits;\n-\tC0: This field indicates whether the octet containing multiplexing mode info (containing the Multiplexing mode info field) is included or not. The field is set to 1 to indicate that multiplexing mode info is included, and it is set to 0 to indicate that multiplexing mode info is not present. The length of the field is 1 bit;\n-\tC1: This field indicates whether the two octets containing the Cell info are included or not. The field is set to 0 to indicate the two octets are not included (and subsequently, that no cell information is included). The field is set to 1 to indicate that the two octets are included. The length of the field is 1 bits;\n-\tC2: This field indicates whether any information on IAB-MT UL beams is included or not. The field is set to 1 to indicate that at least one IAB-MT Resource set IDi field is included, and it is set to 0 to indicate that no IAB-MT Resource set IDi field is present. The length of the field is 1 bit;\n-\tR: Reserved bit, set to 0;\n-\tMultiplexing mode info: The two rightmost bits indicate which of the four multiplexing modes defined in TS 38.473 [27] is applicable. The third rightmost bit of this field indicates whether multiplexing restrictions mode information contained in the two rightmost bits of the field are applicable to non-overlapping frequency resources. This bit is set to 1 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info field is applicable to non-overlapping frequency resources. This field is set to 0 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info field is not applicable to non-overlapping frequency resources. The remaining 5 bits of this field are set to zero. The length of the field is 8 bits;\n-\tNumber of IAB-MT UL beams: This field indicates the number N of IAB-MT UL beams included in the MAC CE. The length of the field is 8 bits;\n-\tIAB-MT Resource set IDi: an indication of the IAB-MTs uplink beams. IAB-MT Resource set ID0 field refers to the first IAB-MT uplink beam, IAB-MT Resource set ID1 field refers to the second IAB-MT uplink beam, and so on. If the total number N of beams included in the MAC CE is odd, the 4 right-most bits in the final octet of the IAB-MT Resource set are disregarded by the UE. The length of the field is 4 bits;\n-\tDU resource configuration: when this field is set to 00, the provided power adjustment is applied on FDM resources where the simultaneous MT and DU signals are non-overlapping in the frequency-domain; when this field is set to 01, the provided power adjustment is applied on non-FDM resources where the simultaneous MT and DU signals may overlap in the frequency-domain for a given (MT CC, DU cell); when this field is set to 10, the provided power adjustment is applied on FDM resources where the simultaneous MT and DU signals are non-overlapping in the frequency-domain, and on non-FDM resources where the simultaneous MT and DU signals may overlap in the frequency-domain for a given (MT CC, DU cell). The length of the field is 2 bits;\n-\tCell info: indicates the cell configuration associated with the information contained in the MAC CE. IAB-DU cell is contained in the first nine bits of the field, while the Child IAB-MT Serving Cell index into the next 5 bits of the field. The length of the field is 14 bits.\nThe figure depicts a 64-bit 1-bit 64-1 MAC CE (Maximum Bit Rate) range, which is a crucial component in the design of a 64-bit 1-bit 64-1 MAC CE (Maximum Bit Rate) range. This range is used to determine the maximum bit rate that can be transmitted over a given channel, ensuring that the system can support high data rates while maintaining reliability and performance. The figure provides a visual representation of the range, allowing engineers to understand the distribution of data rates across the channel and make informed decisions about the design of the system.\nFigure 6.1.3.64-1: Desired IAB-MT PSD range MAC CE\nThe Timing Case Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields (Figure 6.1.3.65-1):\n-\tResource Configuration ID: This field indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;\n-\tTiming mode IDi: when this field is set to 00, the timing mode applied to the ith slot in the list of slots slotList provided via RRC in IAB-ResourceConfig is Case-1; when this field is set to 01, the timing mode applied to the ith slot in the list of slots slotList provided via RRC in IAB-ResourceConfig is Case-6; when this field is set to 10, the timing mode applied to the ith slot in the list of slots slotList provided via RRC in IAB-ResourceConfig is Case-7. The total number N of Timing mode IDi fields corresponds to the size of slotList provided via RRC in IAB-ResourceConfig. If number N is not divisible by 4, (4 - N mod 4) of the final Timing mode IDi fields are disregarded by the receiving IAB node. The length of the field is 2 bits.\nThe figure depicts a timing case indication MAC CE (Multiplexed Channel Error) in a 65-1 65-1 system. The MAC CE indicates the presence of a timing error in the channel, which can cause a loss of data or a delay in the transmission. The figure shows the various components involved in the system, including the transmitter, receiver, and the timing error indicator. The figure is used to troubleshoot and diagnose timing errors in the system.\nFigure 6.1.3.65-1: Timing Case Indication MAC CE\nThe NCR Downlink Backhaul Link Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.66-1):\n-\tDownlink TCI state ID: This field is used to indicate the downlink beam to be used for backhaul link transmission. It contains TCI-StateId (comprising all 7 bits), as specified in TS 38.331 [5], of a TCI State in the active DL BWP. The length of the field is 7 bits;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a NCR (Network Control Room) downlink backhaul link beam indication MAC (Media Access Control) CE (Control Element) signal, which is essential for ensuring reliable communication between the NCR and the network. The signal is represented by a series of colored lines, with each line representing a different path or signal path. The figure shows the signal strength and direction of the signal, as well as the presence of a control point (CP) and a control element (CE) at the NCR. The CE is responsible for controlling the downlink backhaul link, ensuring that the signal is transmitted correctly and that the NCR can receive the necessary information. The figure provides a clear and concise representation of the NCR downlink backhaul link beam indication MAC CE signal, making it easy to understand the role of this component in the network.\nFigure 6.1.3.66-1: NCR Downlink Backhaul Link Beam Indication MAC CE\nThe NCR Uplink Backhaul Link Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.67-1):\n-\tUplink TCI state ID or SRS Resource ID: This field is used to indicate the uplink beam to be used for backhaul link transmission. If the dl-OrJointTCI-StateList is configured as specified in TS 38.331 [5] and unifiedTCI-StateType is configured with a value joint, this field contains TCI-StateId (comprising all 7 bits) of a Joint TCI State configured in the active DL BWP, which is used as the uplink beam indication for backhaul link transmission. If the ul-TCI-StateList is configured as specified in TS 38.331 [5], this field contains TCI-UL-State-Id (contained in the 6 rightmost bits) of an UL TCI State configured in the active UL BWP, which is used as the uplink beam indication for backhaul link transmission, with the 1 remaining bit set to zero. Otherwise, 6 rightmost bits of this field contain SRS-ResourceID configured in the active UL BWP which is used as the uplink beam indication for backhaul link transmission, with the 1 remaining bit set to zero;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a NCR Uplink Backhaul Link Beam Indication MAC CE, which is a crucial component in a 5G network. It shows the signal path from the base station (gNB) to the user equipment (UE) and the backhaul link, highlighting the importance of beamforming techniques to mitigate interference. The figure also illustrates the use of redundancy paths to ensure reliability and failover.\nFigure 6.1.3.67-1: NCR Uplink Backhaul Link Beam Indication MAC CE\nThe NCR Access Link Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of the following fields (Figure 6.1.3.68-1):\n-\tResource set ID: This field is used to indicate one of forwarding semi-persistent resource lists signalled in NCR-SemiPersistentFwdResourceSet (as specified in TS 38.331 [5]). The field contains a list ID (comprising all 5 bits);\n-\tA/D: If the value of this field is set to 1, the forwarding resource list indicated in Resource set ID field is being activated. If the value of this field is set to 0, the forwarding resource list indicated in Resource set ID field is being deactivated;\n-\tC: If the value of this field is set to 1, the Beam index IDi field is present. If the value of this field is set to 0, the Beam index IDi field is absent. This field can be set to 1 only if MAC CE is used for activation, i.e., when the A/D field is set to 1. If MAC CE is used for deactivation, this field is set to 0;\n-\tBeam index IDi: This field indicates the updated beam index for forwarding resources within the list indicated by the Resource set ID field. Beam index ID0 indicates the beam index for the first forwarding resource within the list; Beam index ID1 indicates the beam index for the second forwarding resource within the list and so on. The length of the field is 6 bits; the number of updated beams, N, is equal to the number of the beam indications in the semi-persistent resource set with ID Resource set ID;-\tR: Reserved bit, set to 0.\nThe figure depicts a NCR (Network Control Room) Access Link Beam Indication MAC (Media Access Control) CE (Control Element) signal, which is used to control the transmission of data between the NCR and the access link. The figure shows the signal path, including the NCR, the access link, and the control element, with various symbols representing different components and their functions. The figure is used to understand the communication between the NCR and the access link, and to ensure that the data is transmitted correctly and securely.\nFigure 6.1.3.68-1: NCR Access Link Beam Indication MAC CE\nThe SL LBT failure MAC CE of one octet is identified by a MAC subheader with LCID as specified in Table 6.2.1-2. It has a fixed size of 8bits:\n-\tRi: If there is a RB set configured for the MAC entity with RB set index i as specified in TS 38.214 [7] and if SL consistent LBT failure have been triggered and not cancelled in this RB set, the field is set to 1, otherwise the field is set to 0;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a SL LBT failure scenario, specifically the MAC CE (Control Element) of the SL LBT (Local Loop Backbone Transceiver). The figure shows the failure of the SL LBT, with the MAC CE highlighted in red, indicating the failure point. The failure is shown as a red rectangle, and the surrounding area is highlighted in yellow, emphasizing the critical nature of the failure. The figure also includes a legend to help understand the different colors and symbols used in the diagram.\nFigure 6.1.3.69-1: SL LBT failure MAC CE\nThe Enhanced Unified TCI States Activation/Deactivation MAC CE for Joint TCI States is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size consisting of following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousU-TCI-UpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneousU-TCI-UpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4, respectively;\n-\tDL BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tFi,j: This field indicates for the TCI state ID fields associated with the codepoint i of the DCI Transmission Configuration Indication field whether the j-th joint TCI state is present or not, where j=1, 2. If Fi,j field is set to 1, it indicates the j-th joint TCI state for codepoint i is present. If Fi,j field is set to 0, it indicates the j-th joint TCI state for codepoint i is absent. The codepoint to which a TCI state is mapped is determined by its ordinal position among all the TCI state ID fields;\n-\tTCI state ID: This field indicates the 7-bits length TCI state ID identified by TCI-StateId as specified in TS 38.331 [5]. The maximum number of activated TCI states is 16;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a simplified representation of Enhanced TCI state activation/deactivation MAC CE for Joint TCI States, highlighting the key components and their interactions.\nFigure 6.1.3.70-1: Enhanced TCI state activation/deactivation MAC CE for Joint TCI States\nThe Enhanced Unified TCI States Activation/Deactivation MAC CE CE for Separate TCI States is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size consisting of following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousU-TCI-UpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneousU-TCI-UpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4, respectively;\n-\tDL BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tUL BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tFi,j: This field indicates for the TCI state ID fields associated with the codepoint i of the DCI Transmission Configuration Indication field whether the j-th DL TCI state is present or not, where j=1, 2. If Fi,j field is set to 1, it indicates the j-th DL TCI state for codepoint i is present. If Fi,j field is set to 0, it indicates the j-th DL TCI state for codepoint i is absent;\n-\tSi,j: This field indicates for the TCI state ID fields associated with the codepoint i of the DCI Transmission Configuration Indication field whether the j-th UL TCI state is present or not, where j=1, 2. If Si,j field is set to 1, it indicates the j-th UL TCI state for codepoint i is present. If Si,j field is set to 0, it indicates the j-th UL TCI state for codepoint i is absent;\n-\tTCI state ID: This field indicates the TCI state identified by TCI-StateId as specified in TS 38.331 [5]. If the indicated TCI state ID is DL TCI state, 7-bits length TCI state ID, i.e. TCI-StateId, as specified in TS 38.331 [5] is used. If the indicated TCI state ID is UL TCI state, the most significant bit of TCI state ID is considered as the reserved bit and remainder 6 bits indicate the TCI-UL-State-Id as specified in TS 38.331 [5]. TCI state IDs are in the order of indication of Fi,j and Si,j fields. The maximum number of activated TCI states is 32;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a simplified representation of the Enhanced TCI state activation/deactivation MAC CE for Separate TCI States, which is a key component in the Enhanced TCI (Enhanced TCI) protocol. The figure illustrates the flow of data between the TCI (Tunnel Control Interface) and the MAC (Media Access Control) layers, highlighting the role of the MAC CE in managing the state of the TCI. The figure is a crucial visual aid in understanding the Enhanced TCI protocol and its implementation in a network.\nFigure 6.1.3.71-1: Enhanced TCI state activation/deactivation MAC CE for Separate TCI States\nThe Delay Status Report (DSR) MAC CE is identified by MAC subheader with an eLCID as specified in Table 6.2.1-2b.\nThe fields in the DSR MAC CE are defined as follows:\n-\tLCGi: This field indicates the presence of delay information (i.e. the Remaining Time and Buffer Size fields) for the LCG i. The LCGi field set to 1 indicates that the delay information for the LCG i is reported. The LCGi field set to 0 indicates that the delay information for the LCG i is not reported;\n-\tRemaining Time: This field indicates the shortest remaining value of PDCP discardTimer (described in clause 7.3 in TS 38.323 [4]) among all PDCP SDUs buffered for an LCG, at the time of the first symbol of the first PUSCH transmission that includes this DSR MAC CE. The length of this field is 6 bits. The value r in this field indicates a remaining time within the range of (r, r + 1] msec;\n-\tBT: This field is present only if the corresponding LCG is configured with additionalBSR-TableAllowed; otherwise, this field is reserved. If present, the BT field set to 1 indicates that the buffer sizes specified in Table 6.1.3.1-3 are used to set the value of the Buffer Size field, while the BT field set to 0 indicates that the buffer sizes specified in Table 6.1.3.1-2 are used instead;\n-\tBuffer Size: The Buffer Size field indicates the total amount of delay-critical UL data for an LCG according to the data volume calculation procedure specified in clause 5.5 in TS 38.322 [3] and clause 5.6 in TS 38.323 [4] for the associated RLC and PDCP entities, respectively, after the MAC PDU has been built. If the corresponding LCG is configured with additionalBSR-TableAllowed and the amount of delay-critical UL data for an LCG is within the buffer sizes specified in Table 6.1.3.1-3, the MAC entity shall use the buffer sizes specified in Table 6.1.3.1-3 to set the value of this field; otherwise, the MAC entity shall use Table 6.1.3.1-2 instead. This field is indicated in number of bytes. The length of this field is 8 bits.\nThe Remaining Time, the BT, and the Buffer Size fields for an LCG shall be reported in two consecutive octets. These three fields for different LCGs shall be included in a DSR MAC CE in ascending order based on theLCGi.\nThe figure depicts a DSR MAC CE (Multiplexed Access Channel) in a 5G network, illustrating the various components and their interactions.\nFigure 6.1.3.72-1: DSR MAC CE\nThe PSI-Based SDU Discard Activation/Deactivation MAC CE is identified by MAC subheader with an one-octet eLCID as specified in Table 6.2.1-1b.\nIt has a fixed size and consists of one octet defined as follows (Figure 6.1.3.73-1):\n-\tDi: This field indicates the activation/deactivation status of the PSI-based SDU discard of DRB i, where i is the ascending order of the DRB ID among the DRBs configured with PSI-based SDU discard. The Di field set to 1 indicates that the PSI-based SDU discard shall be activated for DRB i. The Di field set to 0 indicates that the PSI-based SDU discard shall be deactivated for DRB i.\nThe figure depicts a PSI-based SDU Discard Activation/Deactivation MAC CE, which is a crucial component in the network's data processing and communication. The figure shows the PSI (Physical Signal Integrity) and MAC (Media Access Control) layers, with the PSI layer responsible for ensuring the integrity of the physical signal, and the MAC layer responsible for the data transmission and processing. The figure also includes a detailed description of the discard activation/deactivation process, which is a critical step in ensuring the reliability and integrity of the network's data transmission.\nFigure 6.1.3.73-1: PSI-based SDU Discard Activation/Deactivation MAC CE\nThe SL-PRS Resource Request MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has the following fields:\n-\tDestination index: The Destination Index field identifies the destination. The length of this field is 5 bits. The value is set to one index corresponding to SL destination identity associated to same destination reported in sl-PosTxResourceReqList if present. The value is indexed sequentially from 0 in the same ascending order of SL destination identity in sl-PosTxResourceReqList as specified in TS 38.331 [5]. When multiple lists are reported, the value is indexed sequentially across all the lists in the same order as presented in SidelinkUEInformaitonNR message;\n-\tPriority: Priority of pending SL-PRS transmission. The length of this field is 3 bits.\nThe figure depicts a Resource Request MAC control element (R-RMAC) in a Software-Defined Networking (SDN) environment. The R-RMAC is a key component in the network, responsible for managing the request for resources (e.g., bandwidth, processing power) from the network's users. The figure shows the R-RMAC with its associated interfaces, including the MAC control plane, the request queue, and the resource request manager (R-RM). The figure also includes a diagram of the network's topology, highlighting the R-RM's role in managing the network's resources.\nFigure 6.1.3.74-1: SL-PRS Resource Request MAC control element\nThe LTM Cell Switch Command MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields (Figure 6.1.3.75-1):\n-\tR: Reserved bit, set to 0;\n-\tTarget Configuration ID: This field indicates the index of candidate target configuration to apply for LTM cell switch, corresponding to ltm-CandidateId minus 1 as specified in TS 38.331 [5]. The length of the field is 3 bits;\n-\tTiming Advance Command: This field indicates whether the TA is valid for the LTM target cell (i.e. the SpCell corresponding to the target configuration indicated by Target Configuration ID field). If the value of this field is set to FFF, this field indicates that no valid timing adjustment is available for the PTAG of the LTM target cell; Otherwise, this field indicates the index value TA used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6], and that the UE can skip the Random Access procedure for this LTM cell switch. The length of the field is 12 bits;\n-\tTCI state ID: This field indicates and activates the TCI state for the LTM target cell (i.e. the SpCell of the target configuration indicated by the Target Configuration ID field). The TCI state is identified by TCI-StateId in ltm-DL-OrJointTCI-StateToAddModList as specified in TS 38.331 [5]. If the value of unifiedTCI-StateType in the configuration indicated by Target Configuration ID field is joint, this field is for joint TCI state, otherwise, this field is for downlink TCI state. The length of the field is 7 bits;\n-\tUL TCI state ID: This field indicates and activates the uplink TCI state for the LTM target cell (i.e. the SpCell of the target configuration indicated by the Target Configuration ID field). The most significant bits of UL TCI state ID are considered as reserved bits and the remainder 6 bits indicate the TCI-UL-StateId in ltm-UL-TCI-StatesToAddModList as specified in TS 38.331 [5]. This field is included if the value of unifiedTCI-StateType in the configuration indicated by Target Configuration ID field is separate. The length of the field is 8 bits;\n-\tC: This field indicates the presence of the contention-free Random Access Resources fields. If the value of this field is set to 1, the following fields are present, including Random Access Preamble index field, S/U field, SS/PBCH index field and PRACH Mask index field. If the value of this field is set to 0, Random Access Preamble index field, SS/PBCH index field and PRACH Mask index field are absent, and S/U field is considered as Reserved field.\n-\tS/U: This field indicates which UL carrier to transmit the PRACH of the contention-free Random Access Resources. If the value of this field is set to 1, SUL is used; otherwise, NUL is used. The length of the field is 1 bit;\n-\tRandom Access Preamble index: This field indicates the Random Access Preamble index of the contention-free Random Access Resources. The length of the field is 6 bits;\n-\tSS/PBCH index: This field indicates the SS/PBCH that shall be used to determine the RACH occasion for the PRACH transmission of the contention-free Random Access Resources. The length of the field is 6 bits;\n-\tPRACH Mask index: This field indicates the RACH occasion(s) associated with the SS/PBCH indicated by \"SS/PBCH index\" for the PRACH transmission of the contention-free Random Access Resources, referring to the rach-ConfigDedicated (if not provided otherwise to the rach-ConfigCommon) in the UL BWP configuration of firstActiveUplinkBWP-Id as specified in TS 38.331 [5]. The length of the field is 4 bits.\nThe figure depicts a LTM Cell Switch Command MAC CE, which is a crucial component in the network's control and management system. It is responsible for managing the flow of data and ensuring the proper functioning of the network. The figure shows the various commands and parameters that can be used to control the LTM Cell Switch, such as the command to start the switch, the command to stop the switch, and the command to change the switch's state. The figure also includes a diagram of the switch's physical layout, which helps to understand the network's structure and the flow of data.\nFigure 6.1.3.75-1: LTM Cell Switch Command MAC CE\nThe Candidate Cell TCI States Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size consisting of following fields:\n-\tCandidate Cell ID: This field indicates the identity of an LTM candidate cell for which the MAC CE applies, corresponding to the ltm-CandidateId minus 1 as specified in TS 38.331 [5]. The length of the field is 3 bits;\n-\tPi: This field indicates whether each TCI codepoint has multiple TCI states or a single TCI state. If the Pi field is set to 1, the ith TCI codepoint includes the DL TCI state and the UL TCI state. If the Pi field is set to 0, the ith TCI codepoint includes only the DL/joint TCI state or the UL TCI state. The codepoint to which a TCI state is mapped is determined by its ordinal position among all the TCI state ID fields;\n-\tD/U: This field indicates whether the TCI state ID in the same octet is for a joint/downlink or an uplink TCI state. If this field is set to 1, the TCI state ID in the same octet is for joint/downlink TCI state. If this field is set to 0, the TCI state ID in the same octet is for uplink TCI state;\n-\tTCI state ID: This field indicates the TCI state identified by TCI-StateId in ltm-DL-OrJointTCI-StateToAddModList or TCI-UL-StateId in ltm-UL-TCI-StatesToAddModList as specified in TS 38.331 [5]. If D/U is set to 1, 7-bits length TCI state ID i.e. TCI-StateId as specified in TS 38.331 [5] is used. If D/U is set to 0, the most significant bit of TCI state ID is considered as the reserved bit and remaining 6 bits indicate the TCI-UL-StateId as specified in TS 38.331 [5]. The maximum number of activated TCI states is 16;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a candidate cell TCI state activation/deactivation MAC CE, which is a crucial component in the communication process. The figure shows the MAC CE with a state activation/deactivation button, indicating the status of the cell. The presence of the button suggests that the cell is currently in the state of activation, which is necessary for the transmission of data. The figure also includes a label indicating the MAC CE's MAC address, which is a unique identifier for the device. The figure is a visual representation of the communication process, providing a clear understanding of the cell's status and the role of the MAC CE in the overall communication system.\nFigure 6.1.3.76-1: Candidate Cell TCI state activation/deactivation MAC CE\nThe Cross-RRH TCI State Indication for UE-specific PDCCH MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size of 24 bits with following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2, respectively;\n-\tCORESET ID: This field indicates a Control Resource Set identified with ControlResourceSetId as specified in TS 38.331 [5], for which the TCI State is being indicated. In case the value of the field is 0, the field refers to the Control Resource Set configured by controlResourceSetZero as specified in TS 38.331 [5]. The length of the field is 4 bits;\n-\tTCI State ID: This field indicates the TCI state identified by TCI-StateId as specified in TS 38.331 [5] applicable to the Control Resource Set identified by CORESET ID field. If the field of CORESET ID is set to 0, this field indicates a TCI-StateId for a TCI state of the first 64 TCI-states configured by tci-StatesToAddModList and tci-StatesToReleaseList in the PDSCH-Config in the active BWP. If the field of CORESET ID is set to the other value than 0, this field indicates a TCI-StateId configured by tci-StatesPDCCH-ToAddList and tci-StatesPDCCH-ToReleaseList in the controlResourceSet identified by the indicated CORESET ID. The length of the field is 7 bits;\n-\tCross RRH Indicator: This field indicates whether the lower layers follow TCI state switching delay requirements in high speed train FR2 scenarios and apply the one shot large UL timing adjustment after switching to a TCI state identified by TCI-StateId as specified in TS 38.331 [5]. The field is set to 1 to indicate that the lower layers apply the TCI state switching delay requirements specified in Clause 8.10.3A of TS 38.133 [11] and apply the one shot large timing adjustment requirements specified in Clause 7.1.2.3 of TS 38.133 [11] immediately to the first UL transmission after TCI state switch without checking the DL timing difference threshold. The field is set to 0 to indicate that the lower layers apply the TCI state switching delay requirements specified in clause 8.10.3 of TS 38.133 [11] and apply the gradual timing adjustment requirements specified in Clause 7.1.2.1 of TS 38.133 [11] to the first UL transmission after TCI state switch without evaluating the DL timing difference. The length of the field is 1 bit;\n-\tR: Reserved bit, set to 0.\nThe figure depicts a cross-RRH TCI state indication for UE-specific PDCCH MAC CE, which is a crucial component in 5G network architecture. It illustrates the state of the TCI (Time-to-Interference) for each RRH (Radio Resource Hub) and the corresponding PDCCH MAC CE (Physical to Data Channel Converter) for each UE (User Equipment). This information is essential for ensuring efficient and reliable communication in 5G networks.\nFigure 6.1.3.77-1: Cross-RRH TCI State Indication for UE-specific PDCCH MAC CE\nThe Single Entry PHR with assumed PUSCH MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2.\nIt has a fixed size and consists of three octets defined as follows (Figure 6.1.3.8-1):\n-\tR: Reserved bit, set to 0;\n-\tPower Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 below (the corresponding measured values in dB are specified in TS 38.133 [11]);\n-\tE: This field indicates the presence of a PCMAX,f,c for assumed PUSCH field for PCell. The E field set to 1 indicates that a PCMAX,f,c for assumed PUSCH field for PCell is reported. The E field set to 0 indicates that a PCMAX,f,c for assumed PUSCH field for PCell is not reported;\n-\tP: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding PCMAX,f,c field would have had a different value if no power backoff due to power management had been applied;\n-\tPCMAX,f,c: This field indicates the PCMAX,f,c (as specified in TS 38.213 [6]) used for calculation of the preceding PH field. The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm are specified in TS 38.133 [11]);\n-\tPCMAX,f,c for assumed PUSCH: This field indicates the PCMAX,f,c for assumed PUSCH(as specified in TS 38.213 [6]). The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in [Table 6.1.3.8-2] (the corresponding measured values in dBm are specified in TS 38.133 [11]);\n-\tMPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits are present instead.\nThe figure depicts a single entry point point relay (PPR) with a presumed PUSCH MAC CE (Physical Upstream Source Channel) in a 5G network. The figure illustrates the concept of a single entry point relay, which is a key component in 5G networks. The PPR is a point-to-point relay that allows for the transmission of signals from the source to the destination. The figure also includes a presumed PUSCH MAC CE, which is a part of the PPR that is responsible for the transmission of the signal. The figure is important for understanding the architecture of 5G networks and the role of PPRs in the overall network.\nFigure 6.1.3.78-1: Single Entry PHR with assumed PUSCH MAC CE\nThe Multiple Entry PHR with assumed PUSCH MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2.\nIt has a variable size, and includes the bitmap, a Type 2 PH field , an octet containing the associated PCMAX,f,c field (if reported) and an octet containing the associated PCMAX,f,c field for assumed PUSCH (if reported) for SpCell of the other MAC entity; a Type 1 PH field, an octet containing the associated PCMAX,f,c field (if reported) and an octet containing the associated PCMAX,f,c field for assumed PUSCH (if reported) for the PCell. It further includes, in ascending order based on the ServCellIndex, one or multiple of Type X PH fields, octets containing the associated PCMAX,f,c fields (if reported) and octets containing the associated PCMAX,f,c fields for assumed PUSCH (if reported) for Serving Cells other than PCell indicated in the bitmap. X is either 1 or 3 according to TS 38.213 [6] and TS 36.213 [17].\nThe presence of Type 2 PH field for SpCell of the other MAC entity is configured by phr-Type2OtherCell with value true.\nA single octet bitmap is used for indicating the presence of PH per Serving Cell when the highest ServCellIndex of Serving Cell with configured uplink is less than 8, otherwise four octets are used.\nThe MAC entity determines whether PH value for an activated Serving Cell is based on real transmission or a reference format by considering the configured grant(s) and downlink control information which has been received until and including the PDCCH occasion in which the first UL grant for a new transmission that can accommodate the MAC CE for PHR as a result of LCP as defined in clause 5.4.3.1 is received since a PHR has been triggered if the PHR MAC CE is reported on an uplink grant received on the PDCCH or until the first uplink symbol of PUSCH transmission minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 [6] if the PHR MAC CE is reported on a configured grant.\nFor a band combination in which the UE does not support dynamic power sharing, the UE may omit the octets containing Power Headroom field and PCMAX,f,c field for Serving Cells in the other MAC entity except for the PCell in the other MAC entity and the reported values of Power Headroom and PCMAX,f,c for the PCell are up to UE implementation.\nThe PHR MAC CEs are defined as follows:\n-\tCi: This field indicates the presence of a PH field for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The Ci field set to 1 indicates that a PH field for the Serving Cell with ServCellIndex i is reported. The Ci field set to 0 indicates that a PH field for the Serving Cell with ServCellIndex i is not reported;\n-\tEi: This field indicates the presence of a PCMAX,f,c for assumed PUSCH field for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The Ei field set to 1 indicates that a PCMAX,f,c for assumed PUSCH field for the Serving Cell with ServCellIndex i is reported. The Ei field set to 0 indicates that a PCMAX,f,c for assumed PUSCH field for the Serving Cell with ServCellIndex i is not reported. For the E-UTRA Serving Cell, the corresponding Ei field is set to 0;\n-\tR: Reserved bit, set to 0;\n-\tV: This field indicates if the PH value is based on a real transmission or a reference format. For Type 1 PH, the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used. For Type 2 PH, the V field set to 0 indicates real transmission on PUCCH and the V field set to 1 indicates that a PUCCH reference format is used. For Type 3 PH, the V field set to 0 indicates real transmission on SRS and the V field set to 1 indicates that an SRS reference format is used. Furthermore, for Type 1, Type 2, and Type 3 PH, the V field set to 0 indicates the presence of the octet containing the associated PCMAX,f,c field and the MPE field, and the V field set to 1 indicates that the octet containing the associated PCMAX,f,c field and the MPE field is omitted;\n-\tPower Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dB for the E-UTRA Serving Cell are specified in TS 36.133 [12]);\n-\tP: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding PCMAX,f,c field would have had a different value if no power backoff due to power management had been applied;\n-\tPCMAX,f,c: If present, this field indicates the PCMAX,f,c (as specified in TS 38.213 [6]) for the NR Serving Cell and the PCMAX,c or P̃CMAX,c (as specified in TS 36.213 [17]) for the E-UTRA Serving Cell used for calculation of the preceding PH field. The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dBm for the E-UTRA Serving Cell are specified in TS 36.133 [12]);\n-\tPCMAX,f,c for assumed PUSCH: If present, this field indicates the PCMAX,f,c for assumed PUSCH(as specified in TS 38.213 [6]) for the NR Serving Cell. The reported PCMAX,f,c and the corresponding nominal UE transmit power levels are shown in [Table 6.1.3.8-2] (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11];\n-\tMPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits are present instead.\nThe figure depicts a 5G network with various components, including base stations (gNB), user equipment (UE), and scatterers. It illustrates the signal propagation in a 5G network, highlighting the importance of beamforming techniques to mitigate interference. The figure also shows the fiber-optic backbone architecture, with core switches, optical line terminals (OLTs), and distributed nodes. The layered design aligns with SDN principles, ensuring failover reliability and redundancy paths.\nFigure 6.1.3.79-1: Multiple Entry PHR with assumed PUSCH MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is less than 8\nThe figure depicts a 5G network with various components, including base stations (gNB), user equipment (UE), and scatterers. It illustrates the signal propagation in a 5G network, highlighting the importance of beamforming techniques to mitigate interference. The figure also shows the fiber-optic backbone architecture, with core switches, optical line terminals (OLTs), and distributed nodes. The layered design aligns with SDN principles, ensuring failover reliability and redundancy paths.\nFigure 6.1.3.79-2: Multiple Entry PHR with assumed PUSCH MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is equal to or higher than 8\nThe enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of the following fields:\n-\tServing Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;\n-\tBWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;\n-\tSi: This field indicates the activation/deactivation status of the Semi-Persistent CSI report configuration within csi-ReportConfigToAddModList, as specified in TS 38.331 [5]. S0 refers to the report configuration which includes PUCCH resources for SP CSI reporting in the indicated BWP and has the lowest CSI-ReportConfigId within the list with type set to semiPersistentOnPUCCH, S1 to the report configuration which includes PUCCH resources for SP CSI reporting in the indicated BWP and has the second lowest CSI-ReportConfigId and so on. If the number of report configurations within the list with type set to semiPersistentOnPUCCH in the indicated BWP is less than i + 1, MAC entity shall ignore the Si field. The Si field is set to 1 to indicate that the corresponding Semi-Persistent CSI report configuration shall be activated. The Si field is set to 0 to indicate that the corresponding Semi-Persistent CSI report configuration i shall be deactivated;\n-\tNi,x: this field indicates the activation/deactivation status of the Semi-Persistent CSI report SubConfiguration x within csi-ReportSubConfigList of CSI-ReportConfigId i, as specified in TS 38.331 [5]. If Si set to 1, the octet corresponding to Ni,0 to Ni,7 is present. If Si set to 0, the octet corresponding to Ni,0 to Ni,7 is not present. N0,0 refers to the report SubConfiguration which has the lowest csi-ReportSubConfigID within the list, N0,1 to the report SubConfiguration which has the second lowest csi-ReportSubConfigID and so on. If the number of report SubConfigurations within the list with type set to csi-ReportSubConfigList in the indicated BWP is less than x + 1, the MAC entity shall ignore the Ni,x field. The Ni,x field is set to 1 to indicate that the corresponding Semi-Persistent CSI report SubConfiguration x shall be activated. The Ni,x field is set to 0 to indicate that the corresponding Semi-Persistent CSI report SubConfiguration x shall be deactivated;\n-\tR: Reserved bit, set to 0.\nThe figure depicts enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE, highlighting the importance of this feature in ensuring efficient network management and data transmission.\nFigure 6.1.3.80-1: Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.3.1-1: Buffer size levels (in bytes) for 5-bit Buffer Size field",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.1-2: Buffer size levels (in bytes) for 8-bit Buffer Size field",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.1-3. Buffer size levels (in bytes) for the Buffer Size field in Refined Long BSR",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.8-1: Power Headroom levels for PHR",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.8-2: Nominal UE transmit power level for PHR",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.8-3: Effective power reduction for MPE P-MPR",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.8-4: Delta power class for DPC",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.20-1: Values (kbit/s) for Bit Rate field",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.22-2: Subcarrier spacing for Guard Symbols MAC CEs",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.1.4\tMAC PDU (transparent MAC)",
                            "text_content": "A MAC PDU consists solely of a MAC SDU whose size is aligned to a TB; as described in Figure 6.1.4-1. This MAC PDU is used for transmissions on PCH, BCH, DL-SCH including BCCH, and SL-BCH.\nThe figure depicts an example of a transparent MAC (Media Access Control) PDU (Physical Media Access Control) in a 5G network. It illustrates the transparent nature of the PDU, allowing for the transmission of data without the need for a physical connection. The figure shows the PDU with a transparent interface, allowing for the transmission of data without the need for a physical connection.\nFigure 6.1.4-1: Example of MAC PDU (transparent MAC)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.5\tMAC PDU (Random Access Response)",
                            "text_content": "A MAC PDU consists of one or more MAC subPDUs and optionally padding. Each MAC subPDU consists one of the following:\n-\ta MAC subheader with Backoff Indicator only;\n-\ta MAC subheader with RAPID only (i.e. acknowledgment for SI request);\n-\ta MAC subheader with RAPID and MAC RAR.\nA MAC subheader with Backoff Indicator consists of five header fields E/T/R/R/BI as described in Figure 6.1.5-1. A MAC subPDU with Backoff Indicator only is placed at the beginning of the MAC PDU, if included. 'MAC subPDU(s) with RAPID only' and 'MAC subPDU(s) with RAPID and MAC RAR' can be placed anywhere between MAC subPDU with Backoff Indicator only (if any) and padding (if any).\nA MAC subheader with RAPID consists of three header fields E/T/RAPID as described in Figure 6.1.5-2.\nPadding is placed at the end of the MAC PDU if present. Presence and length of padding is implicit based on TB size, size of MAC subPDU(s).\nThe figure depicts the E/T/R/R/BI MAC subheader, which is a crucial component of the 5G network. It represents the physical layer of the network, with the E/T/R/R/BI subheader being the first layer of the MAC subheader hierarchy. The figure illustrates the structure of the subheader, including the MAC subheader, the E/T/R/R/BI subheader, and the R/BI subheader. The figure also shows the physical layer parameters such as the number of subframes, the number of subframes per frame, and the number of subframes per frame. The figure is important for understanding the physical layer of the 5G network and its subheader hierarchy.\nFigure 6.1.5-1: E/T/R/R/BI MAC subheader\nThe figure depicts the E/T/RAPID MAC subheader, which is a crucial component of the E/T/RAPID protocol used in 5G networks. The subheader is a header that contains the MAC (Media Access Control) information for the data stream. It is used to identify the data stream and its associated MAC address, ensuring that the correct data is transmitted. The subheader is essential for efficient data transmission and is a key component of the 5G network's data plane.\nFigure 6.1.5-2: E/T/RAPID MAC subheader\nThe figure depicts an example of a MAC PDU (Physical Media Access Control) consisting of MAC RARs (Remote Access Routes). MAC RARs are used to establish a connection between two devices, allowing them to communicate over a network. The figure shows the various components of the MAC PDU, including the MAC RARs, the MAC PDU header, and the MAC PDU payload. The figure is a visual representation of the complex network communication process, highlighting the importance of MAC PDU in ensuring reliable and efficient communication.\nFigure 6.1.5-3: Example of MAC PDU consisting of MAC RARs\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.5a\tMAC PDU (MSGB)",
                            "text_content": "A MAC PDU consists of one or more MAC subPDUs and optionally padding. Each MAC subPDU consists one of the following:\n-\ta MAC subheader with Backoff Indicator only;\n-\ta MAC subheader and fallbackRAR;\n-\ta MAC subheader and successRAR;\n-\ta MAC subheader and MAC SDU for CCCH, DCCH or DTCH;\n-\ta MAC subheader and padding.\nA MAC subheader with Backoff Indicator consists of five header fields E/T1/T2/R/BI as described in Figure 6.1.5a-1. A MAC subPDU with Backoff Indicator only is placed at the beginning of the MAC PDU, if included.\nA MAC subheader for fallbackRAR consists of three header fields E/T1/RAPID as described in Figure 6.1.5a-2. A MAC subheader for successRAR consists of eight header fields E/T1/T2/S/R/R/R/R as described in Figure 6.1.5a-3. A MAC subheader for MAC SDU consists of the four header fields R/F/LCID/L as described in Figure 6.1.2-1 and Figure 6.1.2-2.\nAt most one 'MAC subPDU for successRAR' indicating presence of 'MAC subPDU(s) for MAC SDU' is included in a MAC PDU. MAC subPDU(s) for MAC SDU are placed immediately after the 'MAC subPDU for successRAR' indicating presence of 'MAC subPDU(s) for MAC SDU'.\nIf MAC PDU includes MAC subPDU(s) for MAC SDU, the last MAC subPDU for MAC SDU is placed before MAC subPDU with padding as depicted in Figure 6.1.5a-4. Otherwise, the last MAC subPDU in MAC PDU is placed before padding as depicted in Figure 6.1.5a-5. The MAC subPDU with padding includes R/R/LCID MAC subheader as described in Figure 6.1.2-3 and padding. The size of padding in the MAC subPDU with padding can be zero. The length of padding is implicit based on TB size, size of MAC subPDU(s).\nThe figure depicts a BI MAC subheader, which is a crucial component in a 5G network. It illustrates the various sub-header fields, such as the MAC address, network type, and other relevant information. This figure is essential for network management and troubleshooting purposes.\nFigure 6.1.5a-1: BI MAC subheader\nThe figure depicts a fallback RAR MAC subheader, which is a crucial component in the network's MAC protocol. It is used to ensure that the network can continue to function even if a primary RAR MAC subheader fails. The figure shows the structure of the subheader, including the MAC address, subheader ID, and the MAC address of the fallback subheader. This information is crucial for network management and troubleshooting.\nFigure 6.1.5a-2: FallbackRAR MAC subheader\nThe figure depicts a simplified representation of the SuccessRAR MAC subheader, which is a crucial component in the SuccessRAR protocol. The subheader is a 3-byte header that contains information about the packet's type, sequence number, and other relevant data. The figure provides a clear visual representation of the subheader's structure, allowing for easy understanding and analysis.\nFigure 6.1.5a-3: SuccessRAR MAC subheader\nThe figure depicts a typical MSGB MAC PDU (Multiplexed Signal-to-Ground Bitstream) with an MSGB MAC SDU (Multiplexed Signal-to-Ground Bitstream Unit). The figure illustrates the structure of the PDU, including the MAC SDU, the MAC PDU, and the MAC PDU with an additional MAC SDU. The figure also shows the connection between the PDU and the MAC SDU, as well as the connection between the PDU and the MAC PDU with an additional MAC SDU. The figure is a crucial component of the MSGB system, providing a clear and concise representation of the communication process.\nFigure 6.1.5a-4: Example of a MSGB MAC PDU with MAC SDU(s)\nThe figure depicts an example of a Multi-Service BGP (MSGB) MAC PDU without MAC SDU(s), illustrating the structure and components of a typical MSGB MAC PDU. The figure includes a header, a body, and a footer, with the header containing the MAC PDU ID, the body containing the MAC PDU data, and the footer containing the MAC PDU ID. The figure also includes a header with the MAC PDU ID, a body with the MAC PDU data, and a footer with the MAC PDU ID. The figure is a simplified representation of a typical MSGB MAC PDU, highlighting the structure and components of a MSGB MAC PDU.\nFigure 6.1.5a-5: Example of a MSGB MAC PDU without MAC SDU(s)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.6\tMAC PDU (SL-SCH)",
                            "text_content": "A MAC PDU consists of one SL-SCH subheader and one or more MAC subPDUs. Each MAC subPDU consists of one of the following:\n-\tA MAC subheader only (including padding);\n-\tA MAC subheader and a MAC SDU;\n-\tA MAC subheader and a MAC CE;\n-\tA MAC subheader and padding.\nThe MAC SDUs are of variable sizes.\nEach MAC subheader except SL-SCH subheader corresponds to either a MAC SDU, a MAC CE, or padding.\nThe SL-SCH subheader is of a fixed size and consists of the seven header fields V/R/R/R/R/SRC/DST.\nThe figure depicts the MAC subheader for the SL-SCH protocol, which is a key component in the 5G network. It shows the structure of the subheader, including the header field, the data field, and the control field. The figure provides a clear visual representation of the subheader's layout and structure, making it easier to understand the protocol's functionality.\nFigure 6.1.6-1: SL-SCH MAC subheader\nA MAC subheader except for fixed-sized MAC CE and padding consists of the four header fields R/F/LCID/L as depicted in Figure 6.1.2-1 (with 8-bit L field) and Figure 6.1.2-2 (with 16-bit L field). A MAC subheader for fixed-sized MAC CE and padding consists of the two header fields R/LCID as depicted in Figure 6.1.2-3.\nSL MAC subPDU(s) with MAC SDU(s) is placed after the SL-SCH subheader and before the MAC subPDU with a MAC CE and the MAC subPDU with padding in the MAC PDU as depicted in Figure 6.1.6-2. SL MAC subPDU with a MAC CE is placed after all the MAC subPDU(s) with MAC SDU and before the MAC subPDU with padding in the MAC PDU as depicted in Figure 6.1.6-2. The size of padding can be zero.\nThe figure depicts an example of a n SL MAC PDU (Physical Media Access Control) in a 5G network. It illustrates the physical media access control process, including the physical media access control (PMAC) and physical media access control (PMAC) protocol. The figure shows the physical media access control (PMAC) process, including the physical media access control (PMAC) and physical media access control (PMAC) protocol.\nFigure 6.1.6-2: Example of an SL MAC PDU\nA maximum of one MAC PDU can be transmitted per TB per MAC entity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.2\tFormats and parameters",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tMAC subheader for DL-SCH and UL-SCH",
                            "text_content": "The MAC subheader consists of the following fields:\n-\tLCID: The Logical Channel ID field identifies the logical channel instance of the corresponding MAC SDU or the type of the corresponding MAC CE or padding as described in Tables 6.2.1-1 and 6.2.1-1c for the DL-SCH and Tables 6.2.1-2 and 6.2.1-2c for the UL-SCH. There is one LCID field per MAC subheader. The size of the LCID field is 6 bits. If the LCID field is set to 34 as in Table 6.2.1-1 or 6.2.1-2, one additional octet is present in the MAC subheader containing the eLCID field and follow the octet containing LCID field. If the LCID field is set to 33 as in Table 6.2.1-1 or 6.2.1-2, two additional octets are present in the MAC subheader containing the eLCID field and these two additional octets follow the octet containing LCID field;\nNOTE 1:\tFor MBS broadcast, a logical channel is identified based on G-RNTI and LCID if the same LCID is allocated for logical channels corresponding to different G-RNTIs.\n-\teLCID: The extended Logical Channel ID field identifies the logical channel instance of the corresponding MAC SDU or the type of the corresponding MAC CE as described in tables 6.2.1-1a, 6.2.1-1b, 6.2.1-2a and 6.2.1-2b for the DL-SCH and UL-SCH respectively. The size of the eLCID field is either 8 bits or 16 bits.\nNOTE 2:\tThe extended Logical Channel ID space using two-octet eLCID and the relevant MAC subheader format is used, only when configured, on the NR backhaul links between IAB nodes or between IAB node and IAB Donor, or for multicast MTCHs.\n-\tL: The Length field indicates the length of the corresponding MAC SDU or variable-sized MAC CE in bytes. There is one L field per MAC subheader except for subheaders corresponding to fixed-sized MAC CEs, padding, and MAC SDUs containing UL CCCH. The size of the L field is indicated by the F field;\n-\tF: The Format field indicates the size of the Length field. There is one F field per MAC subheader except for subheaders corresponding to fixed-sized MAC CEs, padding, and MAC SDUs containing UL CCCH. The size of the F field is 1 bit. The value 0 indicates 8 bits of the Length field. The value 1 indicates 16 bits of the Length field;\n-\tLX: The LCID extension field indicates the use of extended LCID space. The size of the LX field is 1 bit. The LX field set to 1 indicates the use of Table 6.2.1-2c, otherwise R bit is present instead (i.e. set to 0);\n-\tR: Reserved bit, set to 0.\nThe MAC subheader is octet aligned.\nTable 6.2.1-1: Values of LCID for DL-SCH\n\nTable 6.2.1-1a: Values of two-octet eLCID for DL-SCH\n\nTable 6.2.1-1b: Values of one-octet eLCID for DL-SCH\n\nTable 6.2.1-1c: Values of LCID for MBS multicast MCCH and MBS broadcast on DL-SCH\n\nTable 6.2.1-2: Values of LCID for UL-SCH when the LX field is not present or is set to 0\n\nTable 6.2.1-2a: Values of two-octet eLCID for UL-SCH\n\nTable 6.2.1-2b: Values of one-octet eLCID for UL-SCH\n\nTable 6.2.1-2c: Values of LCID for UL-SCH when the LX field is set to 1\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.2.1-1: Values of LCID for DL-SCH",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1-1a: Values of two-octet eLCID for DL-SCH",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1-1b: Values of one-octet eLCID for DL-SCH",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1-1c: Values of LCID for MBS multicast MCCH and MBS broadcast on DL-SCH",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1-2: Values of LCID for UL-SCH when the LX field is not present or is set to 0",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1-2a: Values of two-octet eLCID for UL-SCH",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1-2b: Values of one-octet eLCID for UL-SCH",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1-2c: Values of LCID for UL-SCH when the LX field is set to 1",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.2.2\tMAC subheader for Random Access Response",
                            "text_content": "The MAC subheader consists of the following fields:\n-\tE: The Extension field is a flag indicating if the MAC subPDU including this MAC subheader is the last MAC subPDU or not in the MAC PDU. The E field is set to 1 to indicate at least another MAC subPDU follows. The E field is set to 0 to indicate that the MAC subPDU including this MAC subheader is the last MAC subPDU in the MAC PDU;\n-\tT: The Type field is a flag indicating whether the MAC subheader contains a Random Access Preamble ID or a Backoff Indicator. The T field is set to 0 to indicate the presence of a Backoff Indicator field in the subheader (BI). The T field is set to 1 to indicate the presence of a Random Access Preamble ID field in the subheader (RAPID);\n-\tR: Reserved bit, set to 0;\n-\tBI: The Backoff Indicator field identifies the overload condition in the cell. The size of the BI field is 4 bits;\n-\tRAPID: The Random Access Preamble IDentifier field identifies the transmitted Random Access Preamble (see clause 5.1.3). The size of the RAPID field is 6 bits. If the RAPID in the MAC subheader of a MAC subPDU corresponds to one of the Random Access Preambles configured for SI request, MAC RAR is not included in the MAC subPDU.\nThe MAC subheader is octet aligned.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2a\tMAC subheader for MSGB",
                            "text_content": "The MAC subheader consists of the following fields:\n-\tE: The Extension field is a flag indicating if the MAC subPDU including this MAC subheader is the last MAC subPDU (other than MAC subPDU for MAC SDU) or not in the MAC PDU. The E field is set to 1 to indicate at least another MAC subPDU (other than MAC subPDU for MAC SDU) follows. The E field is set to 0 to indicate that the MAC subPDU including this MAC subheader is the last MAC subPDU (other than MAC subPDU for MAC SDU) in the MAC PDU;\n-\tT1: The T1 field is a flag indicating whether the MAC subheader contains a Random Access Preamble ID or T2. The T1 field is set to 1 to indicate the presence of a Random Access Preamble ID field in the subheader (RAPID). The T1 field is set to 0 to indicate the presence of T2 field in the subheader;\n-\tT2: The T2 field is a flag indicating whether the MAC subheader contains a Backoff Indicator (BI) or a MAC SDU indicator (S). The T2 field is set to 0 to indicate the presence of a Backoff Indicator field in the subheader. The T2 field is set to 1 to indicate the presence of the S field in the subheader;\n-\tS: This field indicates whether 'MAC subPDU(s) for MAC SDU' follow the MAC subPDU including this MAC subheader or not; The S field is set to 1 to indicate presence of 'MAC subPDU(s) for MAC SDU'. The S field is set to 0 to indicate absence of 'MAC subPDU(s) for MAC SDU';\n-\tR: Reserved bit, set to 0;\n-\tBI: The Backoff Indicator field identifies the overload condition in the cell. The size of the BI field is 4 bits;\n-\tRAPID: The Random Access Preamble IDentifier field identifies the transmitted Random Access Preamble (see clause 5.1.3). The size of the RAPID field is 6 bits.\nThe MAC subheader is octet aligned.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3\tMAC payload for Random Access Response",
                            "text_content": "The MAC RAR is of fixed size as depicted in Figure 6.2.3-1, and consists of the following fields:\n-\tR: Reserved bit, set to 0;\n-\tTI: If two TAGs are configured for the Serving Cell in which the Random Access procedure is being performed, this field indicates one of the two TAGs to which the Timing Advance Command is applied. If tag2-flag is set to true by upper layers, the field set to 0 indicates the tag2-Id and the field set to 1 indicates the tag-Id of the Serving Cell, otherwise the field set to 0 indicates the tag-Id and the field set to 1 indicates the tag2-Id of the Serving Cell. If the Serving Cell in which the Random Access procedure is being performed is not configured with two TAGs, the R bit is present instead;\n-\tTiming Advance Command: The Timing Advance Command field indicates the index value TA used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6]. The size of the Timing Advance Command field is 12 bits;\n-\tUL Grant: The Uplink Grant field indicates the resources to be used on the uplink in TS 38.213 [6]. The size of the UL Grant field is 27 bits;\n-\tTemporary C-RNTI: The Temporary C-RNTI field indicates the temporary identity that is used by the MAC entity during Random Access. The size of the Temporary C-RNTI field is 16 bits.\nThe MAC RAR is octet aligned.\nThe figure depicts a simplified representation of a 5G network's MAC (Media Access Control) RAR (Routing and Access Control) process, illustrating the flow of data between the base station (gNB) and the user equipment (UE). The figure shows the various components involved in the RAR process, such as the base station, user equipment, and the network's physical infrastructure. The diagram highlights the importance of proper RAR design to ensure efficient data transmission and minimize latency.\nFigure 6.2.3-1: MAC RAR\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3a\tMAC payload for MSGB",
                            "text_content": "The fallbackRAR is of fixed size as depicted in Figure 6.2.3a-1, and consists of the following fields:\n-\tR: Reserved bit, set to 0;\n-\tTI: If two TAGs are configured for the SpCell, this field indicates one of the two TAGs to which the Timing Advance Command is applied. If tag2-flag is set to true by upper layers, the field set to 0 indicates the tag2-Id and the field set to 1 indicates the tag-Id of the SpCell, otherwise the field set to 0 indicates the tag-Id and the field set to 1 indicates the tag2-Id of the SpCell. If the SpCell is not configured with two TAGs, the R bit is present instead;\n-\tTiming Advance Command: The Timing Advance Command field indicates the index value TA used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6]. The size of the Timing Advance Command field is 12 bits;\n-\tUL Grant: The Uplink Grant field indicates the resources to be used on the uplink in TS 38.213 [6]. The size of the UL Grant field is 27 bits;\n-\tTemporary C-RNTI: The Temporary C-RNTI field indicates the temporary identity that is used by the MAC entity during Random Access. The size of the Temporary C-RNTI field is 16 bits.\nThe fallbackRAR is octet aligned.\nThe figure depicts a fallback routing algorithm in a network, with a detailed explanation of its components and their roles in the network's routing decision-making process.\nFigure 6.2.3a-1: fallbackRAR\nThe successRAR is of fixed size as depicted in Figure 6.2.3a-2, and consists of the following fields:\n-\tUE Contention Resolution Identity: This field contains the UL CCCH SDU. If the UL CCCH SDU is longer than 48 bits, this field contains the first 48 bits of the UL CCCH SDU.\n-\tR: Reserved bit, set to 0;\n-\tChannelAccess-CPext: The channel access type and CP extension for the PUCCH resource containing the HARQ feedback for MSGB in shared spectrum channel access as specified in TS 38.213 [6]. The field is only present when the MSGB HARQ feedback is to be transmitted with shared spectrum channel access as specified in TS 37.213 [18]. Otherwise, the field is not present and R bits are present instead. The size of the ChannelAccess-CPext field is 2 bits;\n-\tTPC: The TPC command for the PUCCH resource containing HARQ feedback for MSGB, as specified in TS 38.213 [6]. The size of the TPC field is 2 bits;\n-\tHARQ Feedback Timing Indicator: The PDSCH-to-HARQ feedback timing indicator field for MSGB HARQ feedback as specified in TS 38.213 [6]. The size of the HARQ Feedback Timing Indicator field is 3 bits;\n-\tPUCCH Resource Indicator: The PUCCH resource indicator for HARQ feedback for MSGB, as specified in TS 38.213[6]. The size of the PUCCH resource Indicator field is 4 bits;\n-\tTiming Advance Command: The Timing Advance Command field indicates the index value TA used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6]. The size of the Timing Advance Command field is 12 bits;\n-\tC-RNTI: The C-RNTI field indicates the identity that is used by the MAC entity upon completion of Random Access. The size of the C-RNTI field is 16 bits.\nThe successRAR is octet aligned.\nThe figure depicts a successful RAR (Remote Access Relay) operation, illustrating the process of remote access to a network. The diagram shows the RAR setup, including the remote access terminal (RAT), the network interface controller (NIC), and the network interface module (NIM). The RAR is connected to the network via a network interface module (NIM) and a network interface controller (NIC). The RAT is connected to the network via a network interface module (NIM) and a network interface controller (NIC). The RAR is connected to the network via a network interface module (NIM) and a network interface controller (NIC). The RAT is connected to the network via a network interface module (NIM) and a network interface controller (NIC). The RAR is connected to the network via a network interface module (NIM) and a network interface controller (NIC). The RAT is connected to the network via a network interface module (NIM) and a network interface controller (NIC). The RAT is connected to the network via a network interface module (NIM) and a network interface controller (NIC). The RAT is connected to the network via a network interface module (NIM) and a network interface controller (NIC\nFigure 6.2.3a-2: successRAR\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.4\tMAC subheader for SL-SCH",
                            "text_content": "The MAC subheader consists of the following fields:\n-\tV: The MAC PDU format version number field indicates which version of the SL-SCH subheader is used. In this version of the specification, the V field is set to 0. The size of the V field is 4 bits;\n-\tSRC: The SRC field carries the 16 most significant bits of the Source Layer-2 ID set to the identifier provided by upper layers as defined in TS 23.287 [19] or TS 23.304 [26]. The length of the field is 16 bits;\n-\tDST: The DST field carries the 8 most significant bits of the Destination Layer-2 ID set to the identifier provided by upper layers as defined in TS 23.287 [19] or TS 23.304 [26]. The length of the field is 8 bits;\n-\tLCID: The Logical Channel ID field identifies the logical channel instance of the corresponding MAC SDU or the type of the corresponding MAC CE within the scope of one Source Layer-2 ID and Destination Layer-2 ID pair or padding as described in Tables 6.2.4-1 for SL-SCH. There is one LCID field per MAC subheader except for SL-SCH subheader. The values of LCID from 21 to 36 identify the logical channels used to send duplicated RLC SDUs from logical channels of which the values of LCID from 4 to 19 respectively in sequential order. The size of the LCID field is 6 bits;\n-\tL: The Length field indicates the length of the corresponding MAC SDU or variable-sized MAC CE in bytes. There is one L field per MAC subheader except for SL-SCH subheader and subheaders corresponding to the fixed-sized MAC CE or padding. The size of the L field is indicated by the F field;\n-\tF: The Format field indicates the size of the Length field. There is one F field per MAC subheader except for SL-SCH subheader and subheaders corresponding to the fixed-sized MAC CE or padding. The size of the F field is 1 bit. The value 0 indicates 8 bits of the Length field. The value 1 indicates 16 bits of the Length field;\n-\tR: Reserved bit, set to 0.\nThe MAC subheader is octet aligned.\nTable 6.2.4-1: Values of LCID for SL-SCH\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.2.4-1: Values of LCID for SL-SCH",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tVariables and constants",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tRNTI values",
                    "description": "",
                    "summary": "",
                    "text_content": "RNTI values are presented in Table 7.1-1.\nTable 7.1-1: RNTI values.\n\nTable 7.1-2: RNTI usage.\n\n",
                    "tables": [
                        {
                            "description": "Table 7.1-1: RNTI values.",
                            "table number": 27,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table 7.1-2: RNTI usage.",
                            "table number": 28,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2\tBackoff Parameter values",
                    "description": "",
                    "summary": "",
                    "text_content": "Backoff Parameter values are presented in Table 7.2-1.\nTable 7.2-1: Backoff Parameter values.\n\n",
                    "tables": [
                        {
                            "description": "Table 7.2-1: Backoff Parameter values.",
                            "table number": 29,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.3\tDELTA_PREAMBLE values",
                    "description": "",
                    "summary": "",
                    "text_content": "The DELTA_PREAMBLE preamble format based power offset values are presented in Tables 7.3-1 and 7.3-2.\nTable 7.3-1: DELTA_PREAMBLE values for long preamble formats.\n\nTable 7.3-2: DELTA_PREAMBLE values for short preamble formats.\n\nwhere μ is the sub-carrier spacing configuration determined by msg1-SubcarrierSpacing or msgA-SubcarrierSpacing, as specified in TS 38.331 [5] and Table 4.2-1 in TS 38.211 [8], and the preamble formats are given by prach-ConfigurationIndex or msgA-PRACH-ConfigurationIndex, as specified in TS 38.331 [5] and Tables 6.3.3.2-2 to 6.3.3.2-4 in TS 38.211 [8].\n",
                    "tables": [
                        {
                            "description": "Table 7.3-1: DELTA_PREAMBLE values for long preamble formats.",
                            "table number": 30,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table 7.3-2: DELTA_PREAMBLE values for short preamble formats.",
                            "table number": 31,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.4\tPRACH Mask Index values",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 7.4-1: PRACH Mask Index values\n\n\n\n",
                    "tables": [
                        {
                            "description": "Table 7.4-1: PRACH Mask Index values",
                            "table number": 32,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "",
                            "table number": 33,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}