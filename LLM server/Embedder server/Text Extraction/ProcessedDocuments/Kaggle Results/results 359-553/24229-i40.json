{
    "document_name": "24229-i40.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the  and may change following formal  approval. Should the  modify the contents of the present document, it will be re-released by the  with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to  for information;\n2\tpresented to  for approval;\n3\tor greater indicates  approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, modal verbs have the following meanings:\nshall\t\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions, and do not appear in Technical Reports.\nThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible, and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\tindicates permission to do something\nneed not\tindicates permission not to do something\nThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\tindicates that something is possible\ncannot\tindicates that something is impossible\nThe constructions \"can\" and \"cannot\" are not substitutes for \"may\" and \"need not\".\nwill\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document defines a call control protocol for use in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP).\nThe present document is applicable to:\n-\tthe interface between the User Equipment (UE) and the Call Session Control Function (CSCF);\n-\tthe interface between the CSCF and any other CSCF;\n-\tthe interface between the CSCF and an Application Server (AS);\n-\tthe interface between the CSCF and an ISC gateway function;\n-\tthe interface between the ISC gateway function and an Application Server (AS);\n-\tthe interface between the CSCF and the Media Gateway Control Function (MGCF);\n-\tthe interface between the S-CSCF and the Multimedia Resource Function Controller (MRFC);\n-\tthe interface between the Application Server (AS) and the Multimedia Resource Function Controller (MRFC);\n-\tthe interface between the S-CSCF and the Media Resource Broker (MRB);\n-\tthe interface between the AS and the MRB;\n-\tthe interface between the MRB and the MRFC;\n-\tthe interface between the CSCF and the Breakout Gateway Control Function (BGCF);\n-\tthe interface between the BGCF and the MGCF;\n-\tthe interface between the CSCF and an IBCF;\n-\tthe interface between the IBCF and AS, MRFC or MRB;\n-\tthe interface between the E-CSCF and the Location Retrieval Function (LRF);\n-\tthe interface between the BGCF and any other BGCF;\n-\tthe interface between the CSCF and an external Multimedia IP network;\n-\tthe interface between the E-CSCF and the EATF;\n-\tthe interface between the E-CSCF and the terminating IMS network;\n-\tthe interface between the P-CSCF and the ATCF;\n-\tthe interface between the ATCF and the I-CSCF;\n-\tthe interface between the ATCF and the IBCF; and\n-\tthe interface between the transit function and the AS.\nWhere possible the present document specifies the requirements for this protocol by reference to specifications produced by the IETF within the scope of SIP and SDP. Where this is not possible, extensions to SIP and SDP are defined within the present document. The document has therefore been structured in order to allow both forms of specification.\nAs the IM CN subsystem is designed to interwork with different IP-Connectivity Access Networks (IP-CANs), the IP-CAN independent aspects of the IM CN subsystem are described in the main body and annex A of this specification. Aspects for connecting a UE to the IM CN subsystem through specific types of IP-CANs are documented separately in the annexes or in separate documents.\nThe document also specificies:\n-\tHTTP for use by an AS and by an MRB in support of the provision of media resources; and\n-\tHTTP for use by an IBCF and by an AS in support of the invocation of attestation and verification functions.\nThe document also specifies media-related requirements for the  traversal mechanisms defined in this specification.\nNOTE:\tThe present document covers only the usage of SIP and SDP to communicate with the enitities of the IM CN subsystem. It is possible, and not precluded, to use the capabilities of IP-CAN to allow a terminal containing a SIP UA to communicate with SIP servers or SIP UAs outside the IM CN subsystem, and therefore utilise the services provided by those SIP servers. The usage of SIP and SDP for communicating with SIP servers or SIP UAs outside the IM CN subsystem is outside the scope of the present document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[1A]\t3GPP TS 22.101: \"Service aspects; Service principles\".\n[1B]\t3GPP TS 22.003: \"Circuit Teleservices supported by a Public Land Mobile Network (PLMN)\".\n[1C]\t3GPP TS 22.011: \"Service accessibility\".\n[2]\t3GPP TS 23.002: \"Network architecture\".\n[3]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[4]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service description; Stage 2\".\n[4A]\t3GPP TS 23.107: \"Quality of Service (QoS) concept and architecture\".\n[4B]\t3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".\n[4C]\t3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile Station (MS) in idle mode\".\n[4D]\t3GPP TS 23.140 Release 6: \"Multimedia Messaging Service (); Functional description; Stage 2\".\n[5]\t3GPP TS 23.218: \"IP Multimedia (IM) Session Handling; IM call model\".\n[6]\t3GPP TS 23.221: \"Architectural requirements\".\n[7]\t3GPP TS 23.228: \"IP multimedia subsystem; Stage 2\".\n[7A]\t3GPP TS 23.234: \"3GPP system to Wireless Local Area Network (WLAN) interworking; System description\".\n[7B]\t3GPP TS 23.401: \"GPRS enhancements for E-UTRAN access\".\n[7C]\t3GPP TS 23.292: \"IP Multimedia Subsystem (IMS) Centralized Services; Stage 2\".\n[7D]\t3GPP TS 23.380: \"IMS Restoration Procedures\".\n[7E]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[7F]\t3GPP TS 23.334: \"IMS Application Level Gateway (IMS-) – IMS Access Gateway (IMS-AGW) interface\".\n[7G]\t3GPP TS 24.103: \"Telepresence using the IP Multimedia (IM) Core Network (CN) Subsystem (IMS); Stage 3\".\n[8]\t3GPP TS 24.008: \"Mobile radio interface layer 3 specification; Core Network protocols; Stage 3\".\n[8A]\t3GPP TS 24.141: \"Presence service using the IP Multimedia (IM) Core Network (CN) subsystem; Stage 3\".\n[8B]\t3GPP TS 24.147: \"Conferencing using the IP Multimedia (IM) Core Network (CN) subsystem; Stage 3\".\n[8C]\t3GPP TS 24.234: \"3GPP System to Wireless Local Area Network (WLAN) interworking; WLAN User Equipment (WLAN UE) to network protocols; Stage 3\".\n[8D]\tVoid.\n[8E]\t3GPP TS 24.279: \"Combining Circuit Switched (CS) and IP Multimedia Subsystem (IMS) services, stage 3, Release 7\".\n[8F]\t3GPP TS 24.247: \"Messaging service using the IP Multimedia (IM) Core Network (CN) subsystem; Stage 3\".\n[8G]\t3GPP TS 24.167: \"3GPP IMS Management Object (MO); Stage 3\".\n[8H]\t3GPP TS 24.173: \"IMS Multimedia telephony communication service and supplementary services; Stage 3\".\n[8I]\t3GPP TS 24.606: \"Message Waiting Indication () using IP Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".\n[8J]\t3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS); Stage 3\".\n[8K]\t3GPP TS 24.323: \"3GPP IMS service level tracing management object (MO)\".\n[8L]\t3GPP TS 24.341: \"Support of SMS over IP networks; Stage 3\".\n[8M]\t3GPP TS 24.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage 3\".\n[8N]\t3GPP TS 24.647: \"Advice Of Charge () using IP Multimedia (IM) Core Network (CN) subsystem\".\n[8O]\t3GPP TS 24.292: \"IP Multimedia (IM) Core Network (CN) subsystem Centralized Services (ICS); Stage 3\".\n[8P]\t3GPP TS 24.623: \"Extensible Markup Language (XML) Configuration Access Protocol (XCAP) over the Ut interface for Manipulating Supplementary Services\".\n[8Q]\t3GPP TS 24.182: \"IP Multimedia Subsystem (IMS) Customized Alerting Tones (); Protocol specification\".\n[8R]\t3GPP TS 24.183: \"IP Multimedia Subsystem (IMS) Customized Ringing Signal (); Protocol specification\".\n[8S]\t3GPP TS 24.616: \"Malicious Communication Identification (MCID) using IP Multimedia (IM) Core Network (CN) subsystem\".\n[8T]\t3GPP TS 24.305: \"Selective Disabling of 3GPP User Equipment Capabilities (SDoUE) Management Object (MO)\".\n[8U]\t3GPP TS 24.302: \"Access to the Evolved Packet Core () via non-3GPP access networks; Stage 3\".\n[8V]\t3GPP TS 24.303: \"Mobility management based on Dual-Stack Mobile IPv6\".\n[8W]\t3GPP TS 24.390: \"Unstructured Supplementary Service Data (USSD) using IP Multimedia (IM) Core Network (CN) subsystem IMS\".\n[8X]\t3GPP TS 24.139: \"3GPP System-Fixed Broadband Access Network Interworking; Stage 3\".\n[8Y]\t3GPP TS 24.322: \"UE access to IMS services via restrictive access networks - stage 3\".\n[8Z]\t3GPP TS 24.371: \"Web Real Time Communication (WebRTC) Access to IMS\".\n[8ZA]\t3GPP TS 24.525: \"Business trunking; Architecture and functional description\".\n[8ZB]\t3GPP TS 24.244: \"Wireless  control plane protocol for trusted WLAN access to ; Stage 3\".\n[8ZC]\t3GPP TS 24.337: \"IP Multimedia (IM) Core Network (CN) subsystem IP Multimedia Subsystem (IMS) inter-UE transfer; Stage 3\".\n[8ZD]\t3GPP TS 24.334: \"Proximity-services (ProSe) User Equipment (UE) to Proximity-services (ProSe) Function Protocol aspects; Stage 3\".\n[8ZE]\t3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control; Stage 3\".\n[8ZF]\t3GPP TS 24.628: \"Common Basic Communication procedures using IP Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".\n[8ZG]\t3GPP TS 24.604: \"Communication Diversion (CDIV) using IP Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".\n[8ZH]\t3GPP TS 24.174: \"Support of multi-device and multi-identity in the IP Multimedia Subsystem (IMS); Stage 3\".\n[8ZI]\t3GPP TS 24.554: \"Proximity-service (ProSe) in 5G System (5GS) protocol aspects; Stage 3\"\n[9]\t3GPP TS 25.304: \"User Equipment (UE) procedures in idle mode and procedures for cell reselection in connected mode\".\n[9A]\t3GPP TS 25.331: \"Radio Resource Control (); Protocol Specification\".\n[9B]\t3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia Telephony; Media handling and interaction\".\n[9C]\t3GPP TS 26.267: \"eCall Data Transfer; In-band modem solution; General description\".\n[10]\tVoid.\n[10A]\t3GPP TS 27.060: \"Mobile Station (MS) supporting Packet Switched Services\".\n[11]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting Packet Based Services and Packet Data Networks (PDN)\".\n[11A]\t3GPP TS 29.162: \"Interworking between the IM CN subsystem and IP networks\".\n[11B]\t3GPP TS 29.163: \"Interworking between the IP Multimedia (IM) Core Network (CN) subsystem and Circuit Switched (CS) networks\".\n[11C]\t3GPP TS 29.161: \"Interworking between the Public Land Mobile Network (PLMN) supporting Packet Based Services with Wireless Local Access and Packet Data Networks (PDN)\"\n[11D]\t3GPP TS 29.079: \"Optimal Media Routeing within the IP Multimedia Subsystem\".\n[12]\t3GPP TS 29.207 Release 6: \"Policy control over Go interface\".\n[12A]\t3GPP TS 29.273: \"Evolved Packet System (EPS); 3GPP EPS AAA interfaces\".\n[13]\tVoid.\n[13A]\t3GPP TS 29.209 Release 6: \"Policy control over Gq interface\".\n[13B]\t3GPP TS 29.212: \"Policy and Charging Control (); Reference points\".\n[13C]\t3GPP TS 29.213: \"Policy and charging control signalling flows and Quality of Service (QoS) parameter mapping\".\n[13D]\t3GPP TS 29.214: \"Policy and Charging Control over Rx reference point\".\n[14]\t3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces; Signalling flows and message contents\".\n[15]\t3GPP TS 29.229: \"Cx and Dx Interfaces based on the Diameter protocol, Protocol details\".\n[15A]\t3GPP TS 29.311: \"Service Level Interworking for Messaging Services\".\n[15B]\t3GPP TS 31.103: \"Characteristics of the IP multimedia services identity module (ISIM) application\".\n[15C]\t3GPP TS 31.102: \"Characteristics of the Universal Subscriber Identity Module (USIM) application\".\n[15D]\t3GPP TS 31.111: \"Universal Subscriber Identity Module (USIM) Application Toolkit (USAT)\".\n[16]\t3GPP TS 32.240: \"Telecommunication management; Charging management; Charging architecture and principles\".\n[17]\t3GPP TS 32.260: \"Telecommunication management; Charging management; IP Multimedia Subsystem (IMS) charging\".\n[17A]\t3GPP TS 32.422: \"Telecommunication management; Subscriber and equipment trace; Trace control and configuration management\".\n[18]\t3GPP TS 33.102: \"3G Security; Security architecture\".\n[19]\t3GPP TS 33.203: \"Access security for IP based services\".\n[19A]\t3GPP TS 33.210: \"3G security; Network Domain Security (NDS); IP network layer security\".\n[19B]\t3GPP TS 36.304: \"Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) procedures in idle mode\".\n[19C]\t3GPP TS 33.328: \"IP Multimedia Subsystem (IMS) media plane security\".\n[19D]\t3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework (AF)\".\n[19E]\t3GPP TS 36.413: \"Evolved Universal Terrestrial Radio Access Network (E-UTRAN); S1 Application Protocol (S1AP)\".\n[19F]\t3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC); Protocol specification\".\n[19G]\t3GPP TS 38.331: \" NR; Radio Resource Control (RRC); Protocol specification\".\n[20]\t3GPP TS 44.018: \"Mobile radio interface layer 3 specification; Radio Resource Control () protocol\".\n[20A]\tIETF RFC 2401 (November 1998): \"Security Architecture for the Internet Protocol\".\n[20B]\tIETF RFC 1594 (March 1994): \"FYI on Questions and Answers to Commonly asked \"New Internet User\" Questions\".\n[20C]\tVoid.\n[20D]\tVoid.\n[20E]\tIETF RFC 2462 (November 1998): \"IPv6 Stateless Address Autoconfiguration\".\n[20F]\tIETF RFC 2132 (March 1997): \"DHCP Options and BOOTP Vendor Extensions\".\n[20G]\tIETF RFC 2234 (November 1997): \"Augmented BNF for Syntax Specification: ABNF\".\n[21]\tVoid.\n[22]\tIETF RFC 3966 (December 2004): \"The tel  for Telephone Numbers\".\n[23]\tIETF RFC 4733 (December 2006): \" Payload for DTMF Digits, Telephony Tones and Telephony Signals\".\n[24]\tIETF RFC 6116 (March 2011): \"The E.164 to Uniform Resource Identifiers () Dynamic Delegation Discovery System (DDDS) Application (ENUM)\".\n[25]\tIETF RFC 6086 (October 2009): \"Session Initiation Protocol (SIP) INFO Method and Package Framework\".\n[25A]\tVoid.\n[26]\tIETF RFC 3261 (June 2002): \"SIP: Session Initiation Protocol\".\n[27]\tIETF RFC 3262 (June 2002): \"Reliability of provisional responses in Session Initiation Protocol (SIP)\".\n[27A]\tIETF RFC 3263 (June 2002): \"Session Initiation Protocol (SIP): Locating SIP Servers\".\n[27B]\tIETF RFC 3264 (June 2002): \"An Offer/Answer Model with Session Description Protocol (SDP)\".\n[28]\tIETF RFC 6665 (July 2012): \"SIP Specific Event Notification\".\n[28A]\tVoid.\n[29]\tIETF RFC 3311 (September 2002): \"The Session Initiation Protocol (SIP) UPDATE method\".\n[30]\tIETF RFC 3312 (October 2002): \"Integration of resource management and Session Initiation Protocol (SIP)\".\n[31]\tIETF RFC 3313 (January 2003): \"Private Session Initiation Protocol (SIP) Extensions for Media Authorization\".\n[32]\tIETF RFC 3320 (March 2002): \"Signaling Compression (SigComp)\".\n[33]\tIETF RFC 3323 (November 2002): \"A Privacy Mechanism for the Session Initiation Protocol (SIP)\".\n[34]\tIETF RFC 3325 (November 2002): \"Private Extensions to the Session Initiation Protocol (SIP) for Network Asserted Identity within Trusted Networks\".\n[34A]\tIETF RFC 3326 (December 2002): \"The Reason Header Field for the Session Initiation Protocol (SIP)\".\n[35]\tIETF RFC 3327 (December 2002): \"Session Initiation Protocol Extension Header Field for Registering Non-Adjacent Contacts\".\n[35A]\tIETF RFC 3361 (August 2002): \"Dynamic Host Configuration Protocol (DHCP-for-IPv4) Option for Session Initiation Protocol (SIP) Servers\".\n[36]\tIETF RFC 3515 (April 2003): \"The Session Initiation Protocol (SIP) REFER method\".\n[37]\tIETF RFC 3420 (November 2002): \"Internet Media Type message/sipfrag\".\n[37A]\tIETF RFC 3605 (October 2003): \"Real Time Control Protocol (RTCP) attribute in Session Description Protocol (SDP)\".\n[38]\tIETF RFC 3608 (October 2003): \"Session Initiation Protocol (SIP) Extension Header Field for Service Route Discovery During Registration\".\n[39]\tIETF RFC 4566 (June 2006): \"SDP: Session Description Protocol\".\n[40]\tIETF RFC 3315 (July 2003): \"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)\".\n[40A]\tIETF RFC 2131 (March 1997): \"Dynamic host configuration protocol\".\n[41]\tIETF RFC 3319 (July 2003): \"Dynamic Host Configuration Protocol (DHCPv6) Options for Session Initiation Protocol (SIP) Servers\".\n[42]\tIETF RFC 3485 (February 2003): \"The Session Initiation Protocol (SIP) and Session Description Protocol (SDP) static dictionary for Signaling Compression (SigComp)\".\n[43]\tIETF RFC 3680 (March 2004): \"A Session Initiation Protocol (SIP) Event Package for Registrations\".\n[44]\tVoid.\n[45]\tVoid.\n[46]\tVoid.\n[47]\tVoid.\n[48]\tIETF RFC 3329 (January 2003): \"Security Mechanism Agreement for the Session Initiation Protocol (SIP)\".\n[49]\tIETF RFC 3310 (September 2002): \"Hypertext Transfer Protocol (HTTP) Digest Authentication Using Authentication and Key Agreement (AKA)\".\n[50]\tIETF RFC 3428 (December 2002): \"Session Initiation Protocol (SIP) Extension for Instant Messaging\".\n[51]\tVoid.\n[52]\tIETF RFC 7315 (July 2014): \"Private Header (P-Header) Extensions to the Session Initiation Protocol (SIP) for the 3GPP\".\n[52A]\tIETF RFC 7976 (September 2016): \"Updates to Private Header (P-Header) Extension Usage in Session Initiation Protocol (SIP) Requests and Responses\".\n[52B]\tdraft-jesske-update-p-visited-network-01 (March 2019): \"Update to Private Header Field P-Visited-Network-ID in Session Initiation Protocol (SIP) Requests and Responses\".\nEditor's note (WI: IMSProtoc9, CR#5979): The above document cannot be formally referenced until it is published as an IETF RFC.\n[53]\tIETF RFC 3388 (December 2002): \"Grouping of Media Lines in Session Description Protocol\".\n[54]\tIETF RFC 3524 (April 2003): \"Mapping of Media Streams to Resource Reservation Flows\".\n[55]\tIETF RFC 3486 (February 2003): \"Compressing the Session Initiation Protocol (SIP)\".\n[55A]\tIETF RFC 3551 (July 2003): \" Profile for Audio and Video Conferences with Minimal Control\".\n[56]\tIETF RFC 3556 (July 2003): \"Session Description Protocol (SDP) Bandwidth Modifiers for  Control Protocol (RTCP) Bandwidth\".\n[56A]\tIETF RFC 3581 (August 2003): \"An Extension to the Session Initiation Protocol (SIP) for Symmetric Response Routing\".\n[56B]\tIETF RFC 3841 (August 2004): \"Caller Preferences for the Session Initiation Protocol (SIP)\".\n[56C]\tIETF RFC 3646 (December 2003): \"DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)\".\n[57]\tRecommendation ITU-T E.164: \"The international public telecommunication numbering plan\".\n[58]\tIETF RFC 4028 (April 2005): \"Session Timers in the Session Initiation Protocol (SIP)\".\n[59]\tIETF RFC 3892 (September 2004): \"The Session Initiation Protocol (SIP) Referred-By Mechanism\".\n[60]\tIETF RFC 3891 (September 2004): \"The Session Inititation Protocol (SIP) \"Replaces\" Header\".\n[61]\tIETF RFC 3911 (October 2004): \"The Session Inititation Protocol (SIP) \"Join\" Header\".\n[62]\tIETF RFC 3840 (August 2004): \"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)\".\n[63]\tIETF RFC 3861 (August 2004): \"Address Resolution for Instant Messaging and Presence\".\n[63A]\tIETF RFC 3948 (January 2005): \"UDP Encapsulation of IPsec  Packets\".\n[64]\tIETF RFC 4032 (March 2005): \"Update to the Session Initiation Protocol (SIP) Preconditions Framework\".\n[65]\tIETF RFC 3842 (August 2004) \"A Message Summary and Message Waiting Indication Event Package for the Session Initiation Protocol (SIP)\"\n[65A]\tIETF RFC 4077 (May 2005): \"A Negative Acknowledgement Mechanism for Signaling Compression\".\n[66]\tIETF RFC 7044 (February 2014): \"An Extension to the Session Initiation Protocol (SIP) for Request History Information\".\n[67]\tIETF RFC 5079 (December 2007): \"Rejecting Anonymous Requests in the Session Initiation Protocol (SIP)\".\n[68]\tIETF RFC 4458 (January 2006): \"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)\".\n[69]\tIETF RFC 5031 (January 2008): \"A Uniform Resource Name (URN) for Emergency and Other Well-Known Services\".\n[70]\tIETF RFC 3903 (October 2004): \"An Event State Publication Extension to the Session Initiation Protocol (SIP)\".\n[71]\tVoid.\n[72]\tIETF RFC 3857 (August 2004): \"A Watcher Information Event Template Package for the Session Initiation Protocol (SIP)\".\n[74]\tIETF RFC 3856 (August 2004): \"A Presence Event Package for the Session Initiation Protocol (SIP)\".\n[74A]\tIETF RFC 3603 (October 2003): \"Private Session Initiation Protocol (SIP) Proxy-to-Proxy Extensions for Supporting the PacketCable Distributed Call Signaling Architecture\".\n[74B]\tIETF RFC 3959 (December 2004): \"The Early Session Disposition Type for the Session Initiation Protocol (SIP)\".\n[75]\tIETF RFC 4662 (August 2006): \"A Session Initiation Protocol (SIP) Event Notification Extension for Resource Lists\".\n[77]\tIETF RFC 5875 (May 2010): \"An Extensible Markup Language (XML) Configuration Access Protocol (XCAP) Diff Event Package\".\n[78]\tIETF RFC 4575 (August 2006): \"A Session Initiation Protocol (SIP) Event Package for Conference State\".\n[79]\tIETF RFC 5049 (December 2007): \"Applying Signaling Compression (SigComp) to the Session Initiation Protocol (SIP)\".\n[80]\tVoid.\n[81]\tVoid.\n[82]\tIETF RFC 4457 (April 2006): \"The Session Initiation Protocol (SIP) P-User-Database Private-Header (P-header)\".\n[83]\tIETF RFC 4145 (September 2005): \"-Based Media Transport in the Session Description Protocol (SDP)\".\n[84]\tIETF RFC 4320 (January 2006): \"Actions Addressing Identified Issues with the Session Initiation Protocol's (SIP) Non-INVITE Transaction\".\n[85]\t3GPP2 C.S0005-D (March 2004): \"Upper Layer (Layer 3) Signaling Standard for cdma2000 Standards for Spread Spectrum Systems\".\n[86]\t3GPP2 C.S0024-B v3.0 (September 2009): \"cdma2000 High Rate Packet Data Air Interface Standard\".\n[86A]\t3GPP2 C.S0084-000 (April 2007): \"Overview for Ultra Mobile Broadband (UMB) Air Interface Specification\".\n[86B]\t3GPP2 X.S0060-0 v1.0: \"HRPD Support for Emergency Services\".\n[86C]\t3GPP2 X.S0057-B v2.0: \"E-UTRAN - eHRPD Connectivity and Interworking: Core Network Aspects\".\n[86D]\t3GPP2 C.S0014-C v1.0: \"Enhanced Variable Rate Codec, Speech Service Options 3, 68, and 70 for Wideband Spread Spectrum Digital Systems\".\n[86E]\t3GPP2 X.S0059-200-A v1.0: \"cdma2000 Femtocell Network: 1x and IMS Network Aspects\".\n[86F]\t3GPP2 S.R0048-A v4.0: \"3G Mobile Equipment Identifier (MEID) - Stage 1\".\n[87]\tRecommendation ITU-T J.112, \"Transmission Systems for Interactive Cable Television Services\"\n[88]\tPacketCable Release 2 Technical Report, PacketCable™ Architecture Framework Technical Report, PKT-TR-ARCH-FRM.\n[89]\tIETF RFC 6442 (December 2011): \"Location Conveyance for the Session Initiation Protocol\".\n[90]\tIETF RFC 4119 (December 2005) \"A Presence-based GEOPRIV Location Object Format\".\n[91]\tIETF RFC 5012 (January 2008): \"Requirements for Emergency Context Resolution with Internet Technologies\".\n[91A]\tVoid.\n[92]\tIETF RFC 5626 (October 2009): \"Managing Client Initiated Connections in the Session Initiation Protocol (SIP)\".\n[93]\tIETF RFC 5627 (October 2009): \"Obtaining and Using Globally Routable User Agent URIs (GRUUs) in the Session Initiation Protocol (SIP)\".\n[94]\tIETF RFC 5628 (October 2009): \"Registration Event Package Extension for Session Initiation Protocol (SIP) Globally Routable User Agent URIs (GRUUs)\".\n[95]\tVoid.\n[96]\tIETF RFC 4168 (October 2005): \"The Stream Control Transmission Protocol (SCTP) as a Transport for the Session Initiation Protocol (SIP)\".\n[97]\tIETF RFC 5002 (August 2007): \"The Session Initiation Protocol (SIP) P-Profile-Key Private Header (P-Header)\".\n[98]\tETSI ES 283 035 (V1.1.1): \"Telecommunications and Internet Converged Services and Protocols for Advanced Networks (TISPAN); Network Attachment Sub-System (NASS); e2 interface based on the DIAMETER protocol\".\n[99]\tVoid.\n[100]\tVoid.\n[101]\tVoid.\n[102]\tIETF RFC 5768 (April 2010): \"Indicating Support for Interactive Connectivity Establishment (ICE) in the Session Initiation Protocol (SIP)\".\n[103]\tIETF RFC 4967 (July 2007): \"Dial String Parameter for the Session Initiation Protocol Uniform Resource Identifier\".\n[104]\tIETF RFC 5365 (October 2008): \"Multiple-Recipient MESSAGE Requests in the Session Initiation Protocol (SIP)\".\n[105]\tIETF RFC 5368 (October 2008): \"Referring to Multiple Resources in the Session Initiation Protocol (SIP)\".\n[106]\tIETF RFC 5366 (October 2008): \"Conference Establishment Using Request-Contained Lists in the Session Initiation Protocol (SIP)\".\n[107]\tIETF RFC 5367 (October 2008): \"Subscriptions to Request-Contained Resource Lists in the Session Initiation Protocol (SIP)\".\n[108]\tIETF RFC 4583 (November 2006): \"Session Description Protocol (SDP) Format for Binary Floor Control Protocol (BFCP) Streams\".\n[109]\tIETF RFC 5009 (September 2007): \"Private Header (P-Header) Extension to the Session Initiation Protocol (SIP) for Authorization of Early Media\".\n[110]\tIETF RFC 4354 (January 2006): \"A Session Initiation Protocol (SIP) Event Package and Data Format for Various Settings in Support for the Push-to-Talk over Cellular (PoC) Service\".\n[111]\tIETF RFC 4964 (September 2007): \"The P-Answer-State Header Extension to the Session Initiation Protocol for the Open Mobile Alliance Push to Talk over Cellular\".\n[112]\tIETF RFC 4694 (October 2006): \"Number Portability Parameters for the 'tel' \".\n[113]\tVoid.\n[114]\tIETF RFC 4769 (November 2006): \"IANA Registration for an Enumservice Containing Public Switched Telephone Network (PSTN) Signaling Information\".\n[115]\tIETF RFC 4411 (February 2006): \"Extending the Session Initiation Protocol (SIP) Reason Header for Preemption Events\".\n[116]\tIETF RFC 4412 (February 2006): \"Communications Resource Priority for the Session Initiation Protocol (SIP)\".\n[117]\tIETF RFC 5393 (December 2008): \"Addressing an Amplification Vulnerability in Session Initiation Protocol (SIP) Forking Proxies\".\n[118]\tIETF RFC 4896 (June 2007): \"Signaling Compression (SigComp) Corrections and ClarificationsImplementer's Guide for SigComp\".\n[119]\tIETF RFC 5112 (January 2008): \"The Presence-Specific Static Dictionary for Signaling Compression (Sigcomp)\".\n[120]\tIETF RFC 5688 (January 2010): \"A Session Initiation Protocol (SIP) Media Feature Tag for MIME Application Subtype\".\n[121]\tIETF RFC 6050 (November 2010): \"A Session Initiation Protocol (SIP) Extension for the Identification of Services\".\n[122]\tVoid.\n[123]\tVoid.\n[124]\tIETF RFC 3986 (January 2005): \"Uniform Resource Identifiers (): Generic Syntax\".\n[125]\tIETF RFC 5360 (October 2008): \"A Framework for Consent-Based Communications in the Session Initiation Protocol (SIP)\".\n[126]\tIETF RFC 7433 (January 2015): \"A Mechanism for Transporting User-to-User Call Control Information in SIP\".\n[126A]\tIETF RFC 7434 (January 2015): \"Interworking ISDN Call Control User Information with SIP\".\n[127]\t3GPP2 X.S0011-E: \"cdma2000 Wireless IP Network Standard \".\n[130]\tIETF RFC 6432 (November 2011): \"Carrying Q.850 Codes in Reason Header Fields in SIP (Session Initiation Protocol) Responses\".\n[131]\tIETF RFC 6544 (March 2012): \" Candidates with Interactive Connectivity Establishment (ICE)\".\n[132]\tIETF RFC 3023 (January 2001): \"XML Media Types\".\n[133]\tIETF RFC 5502 (April 2009): \"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem\".\n[134]\tIETF RFC 7316 (July 2014): \"The Session Initiation Protocol (SIP) P-Private-Network-Indication PrivateHeader (P-Header)\".\n[135]\tIETF RFC 4585 (July 2006): \"Extended  Profile for Real-time Transport Control Protocol (RTCP)-Based Feedback (/AVPF)\".\n[136]\tIETF RFC 5104 (February 2008): \"Codec Control Messages in the  Audio-Visual Profile with Feedback (AVPF)\".\n[137]\tIETF RFC 5939 (September 2010): \"Session Description Protocol (SDP) Capability Negotiation\".\n[138]\tETSI ES 282 001: \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); NGN Functional Architecture Release 1\".\n[139]\tVoid.\n[140]\tIETF RFC 8497 (November 2018): \"Marking SIP Messages to Be Logged\".\n[141]\tVoid.\n[142]\tIETF RFC 6228 (May 2011): \"Response Code for Indication of Terminated Dialog\".\n[143]\tIETF RFC 6223 (April 2011): \"Indication of support for keep-alive\".\n[144]\tIETF RFC 4240 (December 2005): \"Basic Network Media Services with SIP\".\n[145]\tIETF RFC 5552 (May 2009): \"SIP Interface to VoiceXML Media Services\".\n[146]\tIETF RFC 6230 (May 2011): \"Media Control Channel Framework\".\n[147]\tIETF RFC 6231 (May 2011): \"An Interactive Voice Response (IVR) Control Package for the Media Control Channel Framework\".\n[148]\tIETF RFC 6505 (March 2012): \"A Mixer Control Package for the Media Control Channel Framework\".\n[149]\tIETF RFC 2046 (November 1996): \"Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types\".\n[150]\tIETF RFC 5621 (September 2009): \"Message Body Handling in the Session Initiation Protocol (SIP)\".\n[151]\tIETF RFC 3862 (August 2004): \"Common Presence and Instant Messaging (CPIM): Message Format\".\n[152]\tIETF RFC 3890 (September 2004): \"A Transport Independent Bandwidth Modifier for the Session Description Protocol (SDP)\".\n[153]\tIETF RFC 7254 (May 2014): \"A Uniform Resource Name Namespace for the Global System for Mobile Communications Association (GSMA) and the International Mobile station Equipment Identity (IMEI)\".\n[154]\tIETF RFC 4122 (July 2005): \"A Universally Unique IDentifier (UUID) URN Namespace\".\n[155]\tIETF RFC 7195 (May 2014): \"Session Description Protocol (SDP) Extension for Setting Audio Media Streams over Circuit-Switched Bearers in the Public Switched Telephone Network (PSTN)\".\n[156]\tIETF RFC 7006 (September 2013): \"Miscellaneous Capabilities Negotiation in the Session Description Protocol (SDP)\".\n[157]\tIETF RFC 5438 (January 2009): \"Instant Message Disposition Notification (IMDN)\".\n[158]\tIETF RFC 5373 (November 2008): \"Requesting Answering Modes for the Session Initiation Protocol (SIP)\".\n[160]\tVoid.\n[161]\tIETF RFC 4288 (December 2005): \"Media Type Specifications and Registration Procedures\".\n[162]\tIETF RFC 7989 (October 2016): \"End-to-End Session Identification in IP-Based Multimedia Communication Networks\".\n[163]\tIETF RFC 6026 (September 2010): \"Correct Transaction Handling for 2xx Responses to Session Initiation Protocol (SIP) INVITE Requests\".\n[164]\tIETF RFC 5658 (October 2009): \"Addressing Record-Route issues in the Session Initiation Protocol (SIP)\".\n[165]\tIETF RFC 5954 (August 2010): \"Essential Correction for IPv6 ABNF and  Comparison in IETF RFC3261\".\n[166]\tIETF RFC 4117 (June 2005): \"Transcoding Services Invocation in the Session Initiation Protocol (SIP) using Third Party Call Control (3pcc)\".\n[167]\tIETF RFC 4567 (July 2006): \"Key Management Extensions for Session Description Protocol (SDP) and Real Time Streaming Protocol (RTSP)\".\n[168]\tIETF RFC 4568 (July 2006): \"Session Description Protocol (SDP) Security Descriptions for Media Streams\".\n[169]\tIETF RFC 3711 (March 2004): \"The Secure Real-time Transport Protocol (SRTP)\".\n[170]\tIETF RFC 6043 (March 2011): \"MIKEY-TICKET: Ticket-Based Modes of Key Distribution in Multimedia Internet KEYing (MIKEY)\".\n[171]\tIETF RFC 4235 (November 2005): \"An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP)\".\n[172]\tIETF RFC 6871 (February 2013): \"SDP media capabilities Negotiation\".\n[173]\tIETF RFC 4488 (May 2006): \"Suppression of Session Initiation Protocol (SIP) REFER Method Implicit Subscription\".\n[174]\tVoid.\n[175]\tIETF RFC 7462 (March 2015): \"URNs for the Alert-Info Header Field of the Session Initiation Protocol (SIP)\".\n[176]\t/J--036-B: \"Enhanced Wireless 9-1-1, Phase 2\".\n[177]\tVoid.\n[178]\tIETF RFC 4975 (September 2007): \"The Message Session Relay Protocol (MSRP)\".\n[179]\tIETF RFC 3859 (August 2004): \"Common Profile for Presence (CPP)\".\n[180]\tIETF RFC 3860 (August 2004): \"Common Profile for Instant Messaging (CPIM)\".\n[181]\tIETF RFC 2368 (July 1998): \"The mailto URL scheme\".\n[182]\tIETF RFC 4745 (February 2007): \"Common Policy: A Document Format for Expressing Privacy Preferences\".\n[183]\tIETF RFC 5318 (December 2008): \"The Session Initiation Protocol (SIP) P-Refused--List Private-Header (P-Header)\".\n[184]\tIETF RFC 4538 (June 2006): \"Request Authorization through Dialog Identification in the Session Initiation Protocol (SIP)\".\n[185]\tIETF RFC 5547 (May 2009): \"A Session Description Protocol (SDP) Offer/Answer Mechanism to Enable File Transfer\".\n[186]\tIETF RFC 4483 (May 2006): \"A Mechanism for Content Indirection in Session Initiation Protocol (SIP) Messages\".\n[187]\tIETF RFC 8464 (September 2018): \"A URN Namespace for Device Identity and Mobile Equipment Identity (MEID)\".\n[188]\tIETF RFC 6679 (August 2012): \"Explicit Congestion Notification (ECN) for  over UDP\".\n[189]\tIETF RFC 3168 (September 2001): \"The Addition of Explicit Congestion Notification (ECN) to IP\".\n[190]\tIETF RFC 6809 (November 2012): \"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)\".\n[191]\tIETF RFC 6140 (March 2011): \"Registration for Multiple Phone Numbers in the Session Initiation Protocol (SIP)\".\n[192]\tIETF RFC 6917 (April 2013): \"Media Resource Brokering\".\n[193]\tETSI TS 101 454-1 v1.1.1: \"Digital Video Broadcasting (DVB); Second Generation DVB Interactive Satellite System (DVB-RCS2); Part 1: Overview and System Level specification\".\n[194]\tETSI EN 301 545-2 v1.1.1: \"Digital Video Broadcasting (DVB); Second Generation DVB Interactive Satellite System (DVB-RCS2); Part 2: Lower Layers for Satellite standard\".\n[195]\tETSI TS 101 545-3 v1.1.1: \"Digital Video Broadcasting (DVB); Second Generation DVB Interactive Satellite System (DVB-RCS2); Part 3: Higher Layers Satellite Specification\".\n[196]\tVoid.\n[197]\tIETF RFC 7135 (May 2014): \"IANA Registering a SIP Resource Priority Header Field Namespace for Local Emergency Communications\".\n[198]\tIETF RFC 6357 (August 2011): \"Design Considerations for Session Initiation Protocol (SIP) Overload Control\".\n[199]\tIETF RFC 7339 (September 2014): \"Session Initiation Protocol (SIP) Overload Control\".\n[200]\tIETF RFC 7415 (February 2015): \"Session Initiation Protocol (SIP) Rate Control\".\n[201]\tIETF RFC 7200 (April 2014): \"A Session Initiation Protocol (SIP) Load-Control Event Package\".\n[202]\tRecommendation ITU-T T.38 (September 2010): \"Procedures for real-time Group 3 facsimile communication over IP networks\".\n[203]\t 8601 (December 2004): \"Date elements and interchange formats – Information interchange – Representation of dates and times\".\n[204]\tIETF RFC 5506 (April 2009): \"Support for Reduced-Size Real-Time Transport Control Protocol (RTCP)\".\n[205]\tIETF RFC 3611 (November 2003): \" Control Protocol Extended Reports (RTCP XR)\".\n[206]\tIETF RFC 4796 (February 2007): \"The Session Description Protocol (SDP) Content Attribute\".\n[207]\t 3166-1 (2006): \"Codes for the representation of names of countries and their subdivisions – Part 1: Country codes\".\n[208]\tIETF RFC 8055 (January 2017): \"Session Initiation Protocol (SIP) Via Header Field Parameter to Indicate Received Realm\".\n[209]\tIETF RFC 7090 (April 2014): \"Public Safety Answering Point (PSAP) Callback\".\n[210]\tIETF RFC 5285 (July 2008): \"A General Mechanism for  Header Extensions\".\n[211]\tIETF RFC 6236 (May 2011): \"Negotiation of Generic Image Attributes in the Session Description Protocol (SDP)\".\n[212]\tIETF RFC 20 (May 2011): \"ASCII format for Network Interchange\".\n[213]\tIETF RFC 5280 (May 2008): \"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List () Profile\".\n[214]\tIETF RFC 6714 (August 2012): \"Connection Establishment for Media Anchoring (CEMA) for the Message Session Relay Protocol (MSRP)\".\n[215]\tIETF RFC 6135 (February 2011): \"An Alternative Connection Model for the Message Session Relay Protocol (MSRP)\".\n[216]\tVoid.\n[217]\tIETF RFC 7345 (August 2014): \"UDP Transport Layer (UDPTL) over Datagram Transport Layer Security (DTLS)\".\n[218]\tIETF RFC 4279 (December 2005): \"Pre-Shared Key Ciphersuites for Transport Layer Security ()\".\n[219]\tIETF RFC 8841 (January 2021): \"Session Description Protocol (SDP) Offer/Answer Procedures for Stream Control Transmission Protocol (SCTP) over Datagram Transport Layer Security (DTLS) Transport\".\n[220]\tIETF RFC 2817 (May 2000): \"Upgrading to  Within HTTP/1.1\".\n[221]\tIETF RFC 6062 (November 2010): \"Using Relays around  (TURN) Extensions for  Allocations\".\n[222]\tIETF RFC 5763 (May 2010): \"Framework for Establishing a Secure Real-time Transport Protocol (SRTP) Security Context Using Datagram Transport Layer Security (DTLS)\".\n[223]\tIETF RFC 5764 (May 2010): \" Datagram Transport Layer Security (DTLS) Extension to Establish Keys for the Secure Real-time Transport Protocol (SRTP)\".\n[224]\tIETF RFC 7675 (October 2015): \"STUN Usage for Consent Freshness\".\n[225]\tIETF RFC 7549 (May 2015): \"3GPP SIP  Inter Operator Traffic Leg Parameter\".\n[226]\tVoid.\n[227]\tIETF RFC 4169 (November 2005): \"Hypertext Transfer Protocol (HTTP) Digest Authentication Using Authentication and Key Agreement (AKA) Version-2\".\n[228]\tIETF RFC 6947 (May 2013): \"The Session Description Protocol (SDP) Alternate Connectivity (ALTC) Attribute\".\n[229]\tVoid.\n[230]\tIETF RFC 8119 (March 2017): \"SIP \"cause\" URI Parameter for Service Number Translation\".\n[231]\tIETF RFC 7647 (September 2015): \"Clarifications for the Use of REFER with RFC6665\".\n[232]\tIETF RFC 7614 (August 2015): \"Explicit Subscriptions for the REFER Method\".\n[233]\tIETF RFC 7621 (August 2015): \"A Clarification on the Use of Globally Routable User Agent URIs (GRUUs) in the Session Initiation Protocol (SIP) Event Notification Framework\".\n[234]\tIETF RFC 7913 (June 2016): \"P-Access-Network-Info ABNF Update\".\n[235]\tIETF RFC 7519 (May 2015): \"JSON Web Token (JWT)\".\n[236]\tVoid.\n[237]\tIETF RFC 5761 (April 2010): \"Multiplexing RTP Data and Control Packets on a Single Port\".\n[237A]\tIETF RFC 8035 (November 2016): \"Session Description Protocol (SDP) Offer/Answer Clarifications for RTP/RTCP Multiplexing\".\n[238]\tIETF RFC 8864 (January 2021): \" Negotiation Data Channels Using the Session Description Protocol (SDP)\".\n[239]\tIETF RFC 8498 (February 2019): \"A P-Served-User Header Field Parameter for an Originating Call Diversion (CDIV) Session Case in the Session Initiation Protocol (SIP)\".\n[240]\tIETF RFC 8842 (January 2021): \"Session Description Protocol (SDP) Offer/Answer Considerations for Datagram Transport Layer Security (DTLS) and Transport Layer Security (TLS)\".\n[241]\tIETF RFC 8122 (March 2017): \"Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP)\".\n[242]\tIETF RFC 3863 (August 2004): \"Presence Information Data Format\".\n[243]\tIETF RFC 4661 (September 2006): \"An Extensible Markup Language (XML) Based Format for Event Notification Filtering\".\n[244]\tIETF RFC 8147 (May 2017): \"Next-Generation Pan-European eCall\".\n[245]\tCEN EN 15722:2015 (April 2015): \"Intelligent transport systems - ESafety - ECall minimum set of data\".\n[246]\tIETF RFC 8858 (January 2021): \"Indicating Exclusive Support of RTP and RTP Control Protocol (RTCP) Multiplexing Using the Session Description Protocol (SDP)\".\n[247]\tIETF RFC 7303 (July 2014): \"XML Media Types\".\n[248]\tIEEE Std 802.11-2016: \"IEEE Standard for Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Specific requirements - Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".\n[249]\tIETF RFC 8853 (January 2021): \"Using Simulcast in Session Description Protocol (SDP) and RTP Sessions\".\n[250]\tIETF RFC 8851 (January 2021): \"RTP Payload Format Restrictions\".\n[251]\tIETF RFC 7728 (February 2016): \"RTP Stream Pause and Resume\".\n[252]\tIETF RFC 8224 (February 2018): \"Authenticated Identity Management in the Session Initiation Protocol (SIP)\".\n[253]\tIETF RFC 5279 (July 2008): \"A Uniform Resource Name (URN) Namespace for the 3rd Generation Partnership Project (3GPP)\".\n[254]\tIETF RFC 8197 (July 2017): \"A SIP Response Code for Unwanted Calls\".\n[255]\tIETF RFC 8606 (June 2019): \"ISDN User Part (ISUP) Cause Location Parameter for the SIP Reason Header Field\".\n[256]\tIETF RFC 8262 (October 2017): \"Content-ID Header Field in the Session Initiation Protocol (SIP)\".\n[257]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[258]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System (5GS); Stage 3\".\n[259]\tIETF RFC 4715 (November 2006): \"The Integrated Services Digital Network (ISDN) Subaddress Encoding Type for tel URI\".\n[260]\t3GPP TS 38.304: \" NR; User Equipment (UE) procedures in idle mode and in RRC Inactive state\".\n[261]\tIETF RFC 8588 (May 2019): \"Personal Assertion Token (PaSSporT) Extension for Signature-based Handling of Asserted information using toKENs (SHAKEN)\".\n[262]\tIETF RFC 8225 (February 2018): \"PASSporT: Personal Assertion Token\"\n[263]\t3GPP TS 24.502: \" Access to the 3GPP 5G Core Network (5GCN) via Non-3GPP Access Networks (N3AN); Stage 3\".\n[264]\t3GPP TS 37.340: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and NR; Multi-connectivity; Stage 2\".\n[265]\tIETF RFC 8946 (February 2021): \"Personal Assertion Token (PASSporT) Extension for Diverted Calls\".\n[266]\tIETF RFC 8787 (May 2020): \"Location Source Parameter for the SIP Geolocation Header Field\".\n[267]\tIETF RFC 5491 (March 2009): \"GEOPRIV Presence Information Data Format Location Object (PIDF-LO) Usage Clarification, Considerations, and Recommendations\".\n[268]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; Stage 2\".\n[269]\t3GPP TS 36.321: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Medium Access Control (MAC) protocol specification\".\n[270]\t3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".\n[271]\t3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol specification\".\n[272]\t3GPP TS 23.221: \"Architectural requirements\".\n[273]\t3GPP TS 29.514: \"5G System; Policy Authorization Service; Stage 3\".\n[274]\t3GPP TS 29.562: \"Home Subscriber Server (HSS) Services for Interworking with the IP Multimedia Subsystem (IMS); Stage 3\".\n[275]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[276]\t3GPP TS 26.238: \"Uplink Streaming\".\n[277]\tIETF RFC 4574 (August 2006): \"The Session Description Protocol (SDP) Label Attribute\".\n[278]\tIETF RFC 9027 (June 2021): \"Assertion Values for Resource Priority Header and SIP Priority Header Claims in Support of Emergency Services Networks\".\n[279]\tIETF RFC 8443 (August 2018): \"Personal Assertion Token (PASSporT) Extension for Resource Priority Authorization\".\n[280]\tIETF RFC 9112 (June 2022): \"HTTP/1.1\".\n[281]\tIETF RFC 9110 (June 2022): \" HTTP Semantics\".\n[282]\tVoid.\n[283]\tVoid.\n[284]\tIETF RFC 9111 (June 2022): \"HTTP Caching\".\n[285]\tVoid.\n[286]\tIETF RFC 7616 (September 2015): \"HTTP Digest Access Authentication\".\n[287]\tIETF RFC 8760 (March 2020): \"The Session Initiation Protocol (SIP) Digest Access Authentication Scheme\".\n[288]\t3GPP TS 29.510: \"5G System; Network function repository services; Stage 3\".\n[289]\tIETF RFC 8445 (July 2018): \"Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal\".\n[290]\tIETF RFC 8839 (January 2021): \"Session Description Protocol (SDP) Offer/Answer Procedures for Interactive Connectivity Establishment (ICE)\".\n[291]\tIETF RFC 8489 (February 2020): \"Session Traversal Utilities for NAT (STUN)\".\n[292]\tIETF RFC 8656 (February 2020): \"Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)\".\n[293]\tIETF RFC 8981 (February 2021): \"Temporary Address Extensions for Stateless Address Autoconfiguration in IPv6\".\n[294]\tIETF RFC 9410 (July 2023): \"Handling of Identity Header Errors for Secure Telephone Identity Revisited (STIR)\".\n[295]\t3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".\n[296]\tIETF RFC 9366 (March 2023): \"Multiple SIP Reason Header Field Values\".\n[297]\t3GPP TS 24.186: \"IMS Data Channel applications; Protocol specification\".\nEditor's note (WI: NG_RTC): The above document cannot be formally referenced until it is published.\n[298]\t3GPP TS 29.176: \"IP Multimedia Subsystems (IMS); Media Function (MF) Services; Stage 3\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions of terms, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tTerms",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following terms apply.\n3GPP PS data off status: indicates state of usage of the 3GPP PS data off. 3GPP PS data off status at the UE can be either \"active\" or \"inactive\".\nCountry: For the purposes of emergency service URNs in the present document, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69], an  3166-1 alpha-2 code as specified in  3166-1 [207] is used to identify a region or a country.\nEntry point: In the case that \"border control concepts\", as specified in 3GPP TS 23.228 [7], are to be applied in an IM CN subsystem, then these are to be provided by capabilities within the IBCF, and the IBCF acts as an entry point for this network (instead of the I-CSCF). In this case the IBCF and the I-CSCF can be co-located as a single physical node. If \"border control concepts\" are not applied, then the I-CSCF is considered as an entry point of a network. If the P-CSCF is in the home network, then the I-CSCF is considered as an entry point for this document. Similary, in case that \"border control concepts\", as specified in 3GPP TS 23.218 [5], are to be applied in an ISC interface, then these are to be provided by capabilities within the ISC gateway function, and the ISC gateway function acts as an entry point for this network.\nExit point: If operator preference requires the application of \"border control concepts\" as specified in 3GPP TS 23.228 [7], then these are to be provided by capabilities within the IBCF, and requests sent towards another network are routed via a local network exit point (IBCF), which will then forward the request to the other network (discovering the entry point if necessary). Similary, in case that \"border control concepts\", as specified in 3GPP TS 23.218 [5], are to be applied in an ISC interface, then these are to be provided by capabilities within the ISC gateway function, and requests sent towards another network are routed via a local network exit point (ISC gateway function).\nGeo-local number: Either a geo-local service number as specified in 3GPP TS 23.228 [7] or a number in non-international format according to an addressing plan used at the current physical location of the user.\nHome-local number: Either a home local service number as specified in 3GPP TS 23.228 [7] or a number in non-international format according to an addressing plan used in the home network of the user.\nMain : In the case that the UE supports RFC 6140 [191] and performs the functions of an external attached network, the main  is the  which is used for the registration procedures in the To header of the REGISTER request as specified in RFC 6140 [191]; it represents the public user identities associated to that UE.\nNewly established set of security associations: Two pairs of IPsec security associations that have been created at the UE and/or the P-CSCF after the 200 (OK) response to a REGISTER request was received.\nOld set of security associations: Two pairs of IPsec security associations still in existence after another set of security associations has been established due to a successful authentication procedure.\nTemporary set of security associations: Two pairs of IPsec security associations that have been created at the UE and/or the P-CSCF, after an authentication challenge within a 401 (Unauthorized) response to a REGISTER request was received. The SIP level lifetime of such created security associations will be equal to the value of reg-await-auth timer.\nIntegrity protected: See 3GPP TS 33.203 [19]. Where a requirement exists to send information \"integrity-protected\" the mechanisms specified in 3GPP TS 33.203 [19] are used for sending the information. Where a requirement exists to check that information was received \"integrity-protected\", then the information received is checked for compliance with the procedures as specified in 3GPP TS 33.203 [19].\nInstance ID: An URN generated by the device that uniquely identifies a specific device amongst all other devices, and does not contain any information pertaining to the user (e.g., in GPRS instance ID applies to the Mobile Equipment rather than the UICC). The public user identity together with the instance ID uniquely identifies a specific UA instance. If the device has an IMEI available, it generates an instance ID based on its IMEI as defined in 3GPP TS 23.003 [3] clause 13. If the device has an MEID as defined in 3GPP2 S.R0048-A [86F] available, it generates an instance ID based on its MEID as defined in RFC 8464 [187]. If the device does not have an IMEI available and does not have an MEID available, the instance ID is generated as a string representation of a UUID as a URN as defined in RFC 4122 [154].\nResource reservation: Mechanism for reserving bearer resources that is required for certain access technologies.\nLocal preconditions: The indication of segmented status preconditions for the local reservation of resources as specified in RFC 3312 [30].\nAlias , Alias SIP : A  is an alias of another  if the treatment of both URIs is identical, i.e. both URIs belong to the same set of implicitly registered public user identities, and are linked to the same service profile, and are considered to have the exact same service configuration for each and every service.\nNOTE:\tThe S-CSCF recognizes that a given  is an alias of another  using the grouping sent from the HSS (see 3GPP TS 29.228 [14]).\nGlobally Routeable SIP : a SIP  of which the hostname part can be resolved to the IP address of the entry entity of the network reponsible for the identity represented by the userpart.\nInitial registration: The registration procedure for a public user identity initiated by the UE in the absence of any valid registration.\nRegistration expiration interval: An indication on how long a registration is valid, indicated using the Expires header field, or the \"expires\" header field parameter within the Contact header field, according to the procedures specified in RFC 3261 [26].\nReregistration: The registration procedure initiated by the UE to refresh or update an already existing registration for a public user identity.\nRegistration of an additional public user identity: The registration procedure initiated by the UE to explicitly register an additional public user identity during the life time of the registration of another registered public user identity, where both public user identities have the same contact address and P-CSCF.\nEmergency registration: A special registration that relates to binding of a public user identity to a contact address used for emergency service.\nInitial emergency registration: An emergency registration that is also an initial registration.\nEmergency reregistration: An emergency registration that is also a reregistration.\nBack-to-Back User Agent (B2BUA): As given in RFC 3261 [26]. In addition, for the usage in the IM CN subsystem, a SIP element being able to handle a collection of \"n\" User Agents (behaving each one as UAC and UAS, according to SIP rules), which are linked by some application logic that is fully independent of the SIP rules.\nUE private IP address: It is assumed that the  device performs network address translation between a private and a public network with the UE located in the private network and the IM CN subsystem in the public network. The UE is assumed to be configured with a private IP address. This address will be denoted as UE private IP address.\nUE public IP address: The  device is assumed to be configured with one (or perhaps more) public address(es). When the UE sends a request towards the public network, the  replaces the source address in the IP header of the packet, which contains the UE private IP address, with a public IP addressed assigned to the . This address will be denoted as UE public IP address.\nEncapsulating UDP header: For the purpose of performing UDP encapsulation according to RFC 3948 [63A] each IPsec  packet is wrapped into an additional UDP header. This header is denoted as Encapsulating UDP header.\nPort_Uenc: In most residential scenarios, when the  device performs address translation, it also performs translation of the source port found in the transport layer (/UDP) headers. Following RFC 3948 [63A], the UE will use port 4500 as source port in the encapsulating UDP header when sending a packet. This port is translated by the  into an arbitrarily chosen port number which is denoted as port_Uenc.\nMultiple registrations: An additional capability of the UE, P-CSCF and S-CSCF, such that the UE (as identified by the private user identity and instance-id), can create multiple simultaneous registration bindings (flows), associated with one or more contact addresses, to any public user identity, Without this capability, a new registration from the UE for a public user identity replaces the existing registration binding, rather than merely creating an additional binding.\nIMS flow set: An IMS flow set is a set of flows as defined in RFC 5626 [92]. The flows in an IMS flow set are determined by a combination of transport protocol, IP addresses, and ports. An IMS flow set is established by a successful IMS registration procedure.\nNOTE:\tFor IPsec, the ports associated with the flow set include protected client ports and protected server ports as defined in 3GPP TS 33.203 [19] and an IMS flow set is made up of the following four flows:\n-\tFlow 1: (IP address UE, port_uc) <--> (IP address P-CSCF, port_ps) over ;\n-\tFlow 2: (IP address UE, port_uc) <--> (IP address P-CSCF, port_ps) over UDP;\n-\tFlow 3: (IP address UE, port_us) <--> (IP address P-CSCF, port_pc) over ; and\n-\tFlow 4: (IP address UE, port_us) <--> (IP address P-CSCF, port_pc) over UDP.\nNOTE 3:\tFor IPsec, according to 3GPP TS 33.203 [19], the P-CSCF can only select among flows 3 or 4 when forwarding requests towards the UE. According to 3GPP TS 33.203 [19], flow 2 is only used for UE generated requests and responses. The P-CSCF uses flow 2 to identify the correct IMS flow set.\nNOTE 4:\tAn IMS flow set can be considered as a realisation of a logical flow as used in RFC 5626 [92]. But this definition does not depend on any particular definition of a logical flow.\nNOTE 5:\tFor , the ports associated with the flow set include a protected client port and a protected server port and an IMS flow set is made up of the following flow:\n-\t(IP address UE, port) <--> (IP address P-CSCF, port) over .\nNOTE 6:\tFor SIP digest without , an IMS flow set is as defined in RFC 5626 [92].\nIMS flow token: A IMS flow token is uniquely associated with a IMS flow set. When forwarding a request destined towards the UE, the P-CSCF selects the flow from the IMS flow set denoted by the IMS flow token as appropriate according to 3GPP TS 33.203 [19] and RFC 3261 [26].\nIMS registration related signalling: Signalling carrying the SIP messages sent by the UE and the network during the IMS registration procedure, i.e., SIP REGISTER request, SIP SUBSCRIBE request, and their responses.\nIP Association: A mapping at the P-CSCF of a UE's packet source IP address, the \"sent-by\" parameter in the Via header field, and, conditionally, the port with the identities of the UE. This association corresponds to the IP address check table specified in 3GPP TS 33.203 [19].\nAuthorised Resource-Priority header field: a Resource-Priority header field that is either received from another entity in the trust domain relating to the Resource-Priority header field, or which has been identified as generated by a subscriber known to have such priority privileges for the resource priority namespace and level of priority used within that namespace.\nTemporarily authorised Resource-Priority header field: a Resource Priority header field that has been temporarily approved by the P-CSCF, the S-CSCF, or an IBCF. Temporarily authorised Resource-Priority heaer field appears in an INVITE request only, and is applied only in the direction P-CSCF to S-CSCF to AS, S-CSCF to AS, or IBCF to S-CSCF to AS, for the request, and the reverse direction for 1xx responses to that request. Subsequent requests in the same dialog will require an authorised Resource-Priority header field in order to obtain priority privileges. It is only valid when all entities are in the same trust domain for the Resource-Priority header field.\nNetwork-initiated resource reservation: A mechanism of resource reservation where the IP-CAN on the behalf of network initiates the resources to the UE.\nTrace depth: When SIP signalling is logged for debugging purposes, trace depth is the level of detail of what is logged.\nP-CSCF restoration procedures: the procedures for the IP-CAN and the UE to handle P-CSCF service interruption scenarios (see 3GPP TS 23.380 [7D]).\nHSS based P-CSCF restoration procedures: the procedures for the IP-CAN, the IM CN subsystem, the HSS and the UE to handle P-CSCF service interruption scenarios (see 3GPP TS 23.380 [7D]). In 5GS the procedure is called UDM/HSS based P-CSCF restoration (see 3GPP TS 23.380 [7D]) since the UDM participates in the procedure.\nPCRF based P-CSCF restoration procedures: the procedures for the IP-CAN, the IM CN subsystem, the PCRF and the UE to handle P-CSCF service interruption scenarios (see 3GPP TS 23.380 [7D]). In 5GS the procedure is called PCF based P-CSCF restoration (see 3GPP TS 23.380 [7D]) since the PCF takes the role of the PCRF.\nPublic network traffic: traffic sent to the IM CN subsystem for processing according to normal rules of the NGN. This type of traffic is known as public network traffic.\nPrivate network traffic: traffic sent to the IM CN subsystem for processing according to an agreed set of rules specific to an enterprise. This type of traffic is known as private network traffic. Private network traffic is normally within a single enterprise, but private network traffic can also exist between two different enterprises if not precluded for regulatory reasons.\nNOTE 7:\tAn IP-PBX or application functionality within the IM CN subsystem can change private network traffic to public network traffic and vice versa, by functionality known as \"breakout\" or \"breakin\" to the private network. As such a SIP transaction can be variously private network traffic and public network traffic on different hops across a SIP network.\nPrivileged sender: A privileged sender is allowed to send SIP messages where the identities in P-Asserted-Identity will be passed on in the P-CSCF and are not subject to further processing in the P-CSCF.\nS-CSCF restoration procedures: the procedures for the IM CN subsystem and the UE to handle S-CSCF service interruption scenarios (see 3GPP TS 23.380 [7D]).\nLoopback routeing: A method of routeing a SIP request back to the visited network for local breakout according to the roaming architecture for voice over IMS with local breakout as specified in 3GPP TS 23.228 [7].\nUE performing the functions of an external attached network: an independent network connected to an IMS network over the Gm interface, through a single point and which is seen by the IMS network as a specific UE; e.g. an IP-PBX.\nStatic Mode of Operation: a mode of operation where the UE performing the functions of an external attached network does not initiate any IMS level registration procedures towards the operator IMS.\nCanonical form of a SIP : Canoncial form of a SIP  takes the form \"sip:username@domain\" as specified in RFC 3261 [26] subclause 10.3. SIP  comparisons are performed as defined in RFC 3261 [26] subclause 19.1.4.\nOriginating home network: the home network of a user originating a transaction, and if applicable, the associated dialog.\nOriginating visited network: the visited network of a user originating a transaction, and if applicable, the associated dialog.\nTerminating home network: the home network of a user terminating a transaction, and if applicable, the associated dialog.\nTerminating visited network: the visited network of a user terminating a transaction, and if applicable, the associated dialog.\nType of emergency service: The type of emergency service is either an emergency call type standardized by 3GPP (see 3GPP TS 22.101 [8] subclause 10.1) or a similar capability not standardised by 3GPP and defined by national regulatory requirements. The generic (sos) service, identified by urn:service:sos, does not have a type of emergency service (even though usage of the generic (sos) service in the emergency call is defined).\nResource sharing: one dedicated EPS bearer is sharing resources among several ongoing sessions such that the highest  (and optionally MBR) to be shared for the set of /QoS rules bound to the same bearer is used as input for the calculation of the  (and optionally MBR) of that bearer among the sessions sharing the resources.\nFully-Qualified Domain Name (FQDN): the syntax of the FQDN used in this specification is defined in RFC 3261 [26] subclause 25.1.\nTrusted WLAN: A trusted non-3GPP access, where the non-3GPP access is a WLAN IP access.\nUntrusted WLAN: An untrusted non-3GPP access, where the non-3GPP access is a WLAN IP access.\nCalling number verification status determination: A feature which enables the terminating UE to determine whether number has been verified by the network as specified in RFC 8224 [252].\nCalling number verification using signature verification and attestation information: A feature which enables a calling identity validation as specified in RFC 8224 [252] and uses an attestation information to vouch for the accuracy of the source of origin of the call. Attestation information consists of an attestation level and an origination identifier and may be included in the Identity header field as defined in RFC 8588 [261] and in the Attestation-Info and Origination-Id header fields as defined in subclauses 7.2.18 and 7.2.19.\nPriority verification using assertion of priority information: A feature which enables validation of a priority level provided in the Resource-Priority header field as specified in RFC 8443 [279] and, by extension for emergency sessions, the header field value \"psap-callback\" provided in the Priority header field as specified in RFC 9027 [278]. As specified in RFC 8443 [279] the Identity header field is used for the purpose of authentication of the Resource-Priority header field and, by extension for emergency sessions, the Priority header field value \"psap-callback\".\nFor the purposes of the present document, the following terms and definitions given in RFC 3261 [26] apply (unless otherwise specified see clause 6).\nClient\nDialog\nFinal response\nHeader\nHeader field\nLoose routeing\nMethod\nOption-tag (see RFC 3261 [26] subclause 19.2)\nProvisional response\nProxy, proxy server\nRecursion\nRedirect server\nRegistrar\nRequest\nResponse\nServer\nSession\n(SIP) transaction\nStateful proxy\nStateless proxy\nStatus-code (see RFC 3261 [26] subclause 7.2)\nTag (see RFC 3261 [26] subclause 19.3)\nTarget Refresh Request\nUser agent client (UAC)\nUser agent server (UAS)\nUser agent (UA)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.002 [2] subclause 4.1.1.1 and subclause 4a.7 apply:\n3GPP  proxy\n3GPP  server\nBreakout Gateway Control Function (BGCF)\nCall Session Control Function (CSCF)\nHome Subscriber Server (HSS)\nLocation Retrieval Function (LRF)\nMedia Gateway Control Function (MGCF)\nServer enhanced for IMS centralized services\nMultimedia Resource Function Processor (MRFP)\nPacket Data Gateway ()\nSubscription Locator Function ()\nWLAN UE\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.122 [4C] apply:\nEquivalent Home PLMN (EHPLMN)\nHome PLMN (HPLMN)\nVisited PLMN (VPLMN)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.218 [5] subclauses 3.1, 8 and 13 apply:\nFilter criteria\nInitial filter criteria\nInitial request\nISC gateway function\nMedia Resource Broker (MRB)\nMultimedia Resource Function Controller (MRFC)\nStandalone transaction\nSubsequent request\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.228 [7] subclauses 3.1, 4.3.3.1, 4.3.6, 4.6, 4.13, 4.15a, 5.2, 5.4.12.1, 5.10, annex U, and annex W apply:\nBorder control concepts\nGeo-local service number\nHome local service number\nImplicit registration set\nInterconnection Border Control Function (IBCF)\nInterrogating-CSCF (I-CSCF)\nIMS Application Level Gateway (IMS-)\nIMS application reference\nIMS Application Reference Identifier (IARI)\nIMS communication service\nIMS Communication Service Identifier (ICSI)\nIMS Services for roaming users in deployments without IMS-level roaming interfaces\nLocal service number\nIP-Connectivity Access Network (IP-CAN)\nP-CSCF enhanced for WebRTC (eP-CSCF)\nPolicy and Charging Rule Function (PCRF)\nPrivate user identity\nProxy-CSCF (P-CSCF)\nPublic Service Identity (PSI)\nPublic user identity\nRoaming Architecture for Voice over IMS with Local Breakout\nServing-CSCF (S-CSCF)\nStatically pre-configured PSI\nWebRTC IMS Client (WIC)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.292 [7C] apply:\nICS UE\nAS\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.167 [4B] apply:\neCall over IMS\nEmergency-CSCF (E-CSCF)\nGeographical location information\nLocation identifier\nLocation information\nFor the purposes of the present document, the following terms and definitions given in 3GPP TR 33.203 [19] apply:\nGPRS-IMS-Bundled Authentication (GIBA)\nPort_pc\nPort_ps\nPort_uc\nPort_us\nProtected server port\nProtected client port\nspi_uc\nspi_us\nFor the purposes of the present document, the following terms and definitions given in 3GPP TR 21.905 [1] apply:\nIMS Credentials ()\nInternational Mobile Equipment Identity (IMEI)\nIMS  (ISIM)\nSerial NumbeR ()\nType Approval Code ()\nUniversal Integrated Circuit Card (UICC)\nUniversal Subscriber Identity Module (USIM)\nUser Equipment (UE)\nFor the purposes of the present document, the following terms and definitions given in RFC 2401 [20A] Appendix A apply:\nSecurity association\nA number of different security associations exist within the IM CN subsystem and within the underlying access transport. Within this document this term specifically applies to either:\ni)\tthe security association that exists between the UE and the P-CSCF. For this usage of the term, the term \"security association\" only applies to IPsec. This is the only security association that has direct impact on SIP; or\nii)\tthe security association that exists between the WLAN UE and the . This is the security association that is relevant to the discussion of Interworking WLAN as the underlying IP-CAN.\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.234 [7A] apply.\nInterworking WLAN\nFor the purposes of the present document, the following terms and definitions given in -T E.164 [57] apply:\nInternational public telecommunication number\nFor the purposes of the present document, the following terms and definitions given in RFC 5012 [91] apply:\nEmergency service identifier\nEmergency service URN\nPublic Safety Answering Point (PSAP)\nPSAP\nFor the purposes of the present document, the following terms and definitions given in RFC 5627 [93] apply:\nGlobally Routable User Agent  (GRUU)\nFor the purposes of the present document, the following terms and definitions given in RFC 5626 [92] apply:\nFlow\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 33.310 [19D] annex E and documents referenced therein:\nsession\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.292 [8O] apply:\nCS media\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.301 [8J] apply:\nIMS Voice over PS Session (IMSVoPS) indicator\nPersistent EPS bearer context\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 33.328 [19C] apply:\nEnd-to-access edge security\nFor the purposes of the present document, the following terms and definitions given in 3GPP2 S.R0048-A v4.0 [86F] apply:\nMobile Equipment Identity (MEID)\nManufacturer code\nSerial number\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.302 [8U] apply:\nRestrictive non-3GPP access network\nS2a\nS2b\nS2c\nTrusted non-3GPP access\nUntrusted non-3GPP access\nUnauthenticated IMSI\nFirewall traversal tunnel\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 32.240 [16] apply:\nCharging Data Function (CDF);\nCharging Data Record (CDR)\nOnline Charging Function (OCF)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 32.260 [17] apply:\nIM CN subsystem Charging Identifier (ICID)\nFor the purposes of the present document, the following terms and definitions given in RFC 8119 [230] apply:\nService access number\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 22.101 [1A] apply:\neCall\nMinimum Set of Data (MSD)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 22.011 [1C] apply:\n3GPP PS data off\n3GPP PS data off exempt services\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.402 [7E] apply.\nTWAN\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.604 [8ZG] apply.\nDiverting user\nDiverted-to party\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.221 [272] apply:\nRestricted Local Operator Services\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.501 [257] apply:\nStand-alone Non-Public Network\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tSymbols",
                    "description": "",
                    "summary": "",
                    "text_content": "Void.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.3\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following abbreviations apply:\n1xx\tA status-code in the range 101 through 199, and excluding 100\n18x\tA status-code in the range 180 through 189\n2xx\tA status-code in the range 200 through 299\n3xx\tA status-code in the range 300 through 399\n4xx\tA status-code in the range 400 through 499\n5GC\t5G Core Network\n5GS\t5G System\n5G-AN\t5G Access Network\n5xx\tA status-code in the range 500 through 599\n6xx\tA status-code in the range 600 through 699\nAuthentication, Authorization and Accounting\nANBR\tAccess Network Bitrate Recommendation\nAPN\tAccess Point\nAccess Point Name\nAS\tApplication Server\nATCF\tAccess Transfer Control Function\nAuthentication TokeN\nAttribute-Value Pair\nB2BUA\tBack-to-Back User Agent\nBFCP\tBinary Floor Control Protocol\nBGCF\tBreakout Gateway Control Function\nc\tconditional\nBRAS\tBroadband Remote Access Server\nBSSID\tBasic Service Set Identifier\nCharging Collection Function\nCDF\tCharging Data Function\nCDR\tCharging Data Record\nCH\tCredentials Holder\nCK\tCiphering Key\nCN\tCore Network\nCalling Party's Category\nConnectivity session Location and repository Function\nCSCF\tCall Session Control Function\nDHCP\tDynamic Host Configuration Protocol\nDNN\tData Network Name\nDNS\tDomain Name System\nDOCSIS\tData Over Cable Service Interface Specification\nDRVCC\tDual Radio Voice Call Continuity\nDTD\tDocument Type Definition\nDTLS\tDatagram Transport Layer Security\nDTMF\tDual Tone Multi Frequency\nDVB\tDigital Video Broadcast\nDVB-RCS2\tSecond Generation DVB Interactive Satellite System\ne2ae-security\tEnd-to-access edge security\nEATF\tEmergency Access Transfer Function\nEC\tEmergency Centre\nECF\tEvent Charging Function\nECI\tE-UTRAN Cell Identity\nECN\tExplicit Congestion Notification\nE-CSCF\tEmergency CSCF\nEF\tElementary File\neP-CSCF\tP-CSCF enhanced for WebRTC\nePDG\tEvolved Packet Data Gateway\nEPS\tEvolved Packet System\nFAP\tcdma2000® 1x Femtocell Access Point\nFQDN\tFully Qualified Domain Name\nGBA\tGeneric Bootstrapping Architecture\nGuaranteed Bit Rate\nGCID\tGPRS Charging Identifier\nGGSN\tGateway GPRS Support Node\nGPON\tGigabit-capable Passive Optical Networks\nGPRS\tGeneral Packet Radio Service\nGRUU\tGlobally Routable User agent\nGeneral Switched Telephone Network\nHPLMN\tHome PLMN\nHSS\tHome Subscriber Server\nHTTP\tHyperText Transfer Protocol\ni\tirrelevant\nIARI\tIMS Application Reference Identifier\nIBCF\tInterconnection Border Control Function\nICE\tInteractive Connectivity Establishment\nI-CSCF\tInterrogating CSCF\nICS\tImplementation Conformance Statement\nICID\tIM CN subsystem Charging Identifier\nICSI\tIMS Communication Service Identifier\nID\tIdentifier\nIK\tIntegrity Key\nIKEv2\tInternet Key Exchange Protocol Version 2\nIM\tIP Multimedia\nIMS Credentials\nIMEI\tInternational Mobile Equipment Identity\nIMS\tIP Multimedia core network Subsystem\nIMS-AGW\tIMS Access Gateway\nIMS-\tIMS Application Level Gateway\nInternational Mobile Subscriber Identity\nIMSVoPS\tIMS Voice over PS Session\nIOI\tInter Operator Identifier\nIP\tInternet Protocol\nIP-CAN\tIP-Connectivity Access Network\nIPsec\tIP security\nIPv4\tInternet Protocol version 4\nIPv6\tInternet Protocol version 6\nISC\tIP Multimedia Subsystem Service Control\nISIM\tIM Subscriber Identity Module\nI-WLAN\tInterworking – WLAN\nIWF\tInterworking Function\nKMS\tKey Management Service\nLRF\tLocation Retrieval Function\nm\tmandatory\nMessage Authentication Code\nMBR\tMaximum guaranteed Bit Rate\nMobile Country Code\nMCPTT\tMission Critical Push To Talk\nMEID\tMobile Equipment IDentity\nMGCF\tMedia Gateway Control Function\nMGW\tMedia Gateway\nMobile Network Code\nMF\tMedia Function\nMRB\tMedia Resource Broker\nMRFC\tMultimedia Resource Function Controller\nMRFP\tMultimedia Resource Function Processor\nMobile-services Switching Centre\nMSD\tMinimum Set of emergency related Data\nMSRP\tMessage Session Relay Protocol\nn/a\tnot applicable\nNAI\tNetwork Access Identifier\n(P)T\tNetwork Address (and Port) Translation\nNASS\tNetwork Attachment Subsystem\nNetwork Address Translation\nNetwork Control Center\n_ID\tNetwork Control Center Identifier\nNID\tNetwork Identifier\nNP\tNumber Portability\no\toptional\nOCF\tOnline Charging Function\nOLI\tOriginating Line Information\nOMR\tOptimal Media Routeing\nPolicy and Charging Control\nPCF\tPolicy Control Function\nPCO\tProtocol Configuration Options\nPCRF\tPolicy and Charging Rules Function\nP-CSCF\tProxy CSCF\nPacket Data Gateway\nPDN\tPacket Data Network\nPDP\tPacket Data Protocol\nPDU\tProtocol Data Unit\nP-GW\tPDN Gateway\nPICS\tProtocol Implementation Conformance Statement\nPIDF-LO\tPresence Information Data Format Location Object\nPLMN\tPublic Land Mobile Network\nPSAP\tPublic Safety Answering Point\nPSI\tPublic Service Identity\nPSTN\tPublic Switched Telephone Network\nQCI\tQoS Class Identifier\nQoS\tQuality of Service\nRANDom challenge\nRCS\tReturn Channel via Satellite\nRCST\tReturn Channel via Satellite Terminal\nRESponse\nRLOS\tRestricted Local Operator Services\nRTCP\tReal-time Transport Control Protocol\nReal-time Transport Protocol\nSAC\tService Area Code\nSAI\tService Area Identifier\nSBA\tService Based Architecture\nSBI\tService Based Interface\nS-CSCF\tServing CSCF\nSCTP\tStream Control Transmission Protocol\nSDES\tSession Description Protocol Security Descriptions for Media Streams\nSDP\tSession Description Protocol\nSDU\tService Data Unit\nSIP\tSession Initiation Protocol\nSubscription Locator Function\nSNPN\tStand-alone Non-Public Network\nSerial Number\nSQN\tSeQuence Number\nSRVCC\tSingle Radio Voice Call Continuity\nSTUN\tSession Traversal Utilities for\nSVN\tSatellite Virtual Network\nSVN-\tSVN Medium Access Control label\nType Approval Code\nTFT\tTraffic Flow Template\nTP\tTelepresence\nTransport Layer Security\nTRF\tTransit and Roaming Function\nTURN\tTraversal Using Relay NAT\nTWAG\tTrusted WLAN Access Gateway\nTWAN\tTrusted WLAN\nUA\tUser Agent\nUAC\tUser Agent Client\nUAS\tUser Agent Server\nUDM\tUnified Data Management\nUDPTL\tUDP Transport Layer\nUDVM\tUniversal Decompressor Virtual Machine\nUE\tUser Equipment\nUICC\tUniversal Integrated Circuit Card\nUniform Resource Identifier\nURL\tUniform Resource Locator\nURN\tUniform Resource Name\nUSAT\tUniversal Subscriber Identity Module Application Toolkit\nUSIM\tUniversal Subscriber Identity Module\nVPLMN\tVisited PLMN\nWebRTC\tWeb Real-Time Communication\nWIC\tWebRTC IMS Client\nWLAN\tWireless Local Area Network\nx\tprohibited\nxDSL\tDigital Subscriber Line (all types)\nXGPON1\t10 Gigabit-capable Passive Optical Networks\nXMAC\texpected\nXML\teXtensible Markup Language\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "3A\tInteroperability with different IP-CAN",
            "description": "The IM CN subsystem can be accessed by UEs resident in different types of IP-CAN. The main body of this document, and annex A, are general to UEs and IM CN subsystems that are accessed using any type of IP-CAN. Requirements that are dependent on the type of IP-CAN are covered in annexes B, E, H, L, M, O, Q, R, S, U and W.\nAt any given time, for a given SIP transaction or dialog, the UE sees only one type of IP-CAN, as reported to it by the lower layers. The UE follows the procedures of the IP-CAN specific annex related to the last type of IP-CAN reported, even if it is different to one used previously. In particular, handover at the radio layers between two different access technologies can result in such a change while the dialog or transaction proceeds.\nAt any given time, for a given SIP transaction or dialog, the P-CSCF sees only one type of IP-CAN, as determined by interface to a particular resource architecture, e.g. policy and charging control, and by the access technology reported to it over that interface, or in the absence of this, by preconfiguration in the system. The P-CSCF follows the procedures of the IP-CAN specific annex related to the last type of IP-CAN determined, even if it is different to one used previously. In particular, handover at the radio layers between two different access technologies can result in such a change while the dialog or transaction proceeds.\nIt is the responsibility of the IP-CAN to ensure that usage of different bearer resources are synchronised on the handover from one IP-CAN to another, e.g. so that a signalling bearer provided by one IP-CAN is a signalling bearer (if provided by that IP-CAN) after handover, and that the appropriate QoS and resource reservation exists after handover. There is no SIP signalling associated with handover at the IP-CAN, and therefore no change in SIP state at one entity is signalled to the peer SIP entity when handover occurs.\nIn particular the following constraints exist that can have an impact on P-CSCF usage:\n1)\tsome IP-CANs can explicitly label a bearer as a signalling bearer, while others provide a bearer that has appropriate QoS, but no explicit labelling. Therefore if handover occurs from an IP-CAN with explicit labelling, to an IP-CAN with no explicit labelling, and then back to an IP-CAN with explicit labelling, the signalling will then be on a bearer that is not explicitly labelled; and\n2)\tsome IP-CANs support signalling of grouping of media within particular bearers, while others do not. Therefore if handover occurs from an IP-CAN with grouping, to an IP-CAN with no grouping, and then back to an IP-CAN with grouping, the signalled grouping can have been lost.\nWhen a UE supports multiple IP-CANs, but does not support handover between those IP-CANs, the annex specific to that IP-CAN applies unmodified.\nWhere handover between IP-CANs occurs without a reregistration in the IM CN subsystem, the same identies and security credentials for access to the IM CN subsystem are used before and after the handover.\nAt the P-CSCF, the access technology can variously use the PCRF or PCF or NASS in support of both signalling and media bearer provision (or indeed use neither). How to determine which applies is up to network dependent rules, but can be specific to the access technology used by each different UE. Not all access technologies are defined for use with NASS, and not all access technologies are defined for use with the PCRF or PCF.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "4\tGeneral",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tConformance of IM CN subsystem entities to SIP, SDP and other protocols",
                    "description": "",
                    "summary": "",
                    "text_content": "SIP defines a number of roles which entities can implement in order to support capabilities. These roles are defined in annex A.\nEach IM CN subsystem functional entity using an interface at the Gm reference point, the Ma reference point, the Mg reference point, the Mi reference point, the Mj reference point, the Mk reference point, the Ml reference point, the Mm reference point, the Mr reference point, the Mr' reference point, the Cr reference point, the Mw reference point, the I2 reference point, the I4 reference point and the Ici reference point, and also using the IP multimedia Subsystem Service Control (ISC) Interface, shall implement SIP, as defined by the referenced specifications in Annex A, and in accordance with the constraints and provisions specified in annex A, according to the following roles.\nEach IM CN subsystem entity using an interface at the Rc reference point and the Ms reference point shall implement HTTP as defined in RFC 9112 [280], RFC 9110 [281] and RFC 9111 [284].\nEach IM CN subsystem entity using an interface at the W2 reference point may implement SIP as an option. The detailed procedures of W2 interface are defined in 3GPP TS 24.371 [8Z].\nThe Gm reference point, the W2 reference point, the Ma reference point, the Mg reference point, the Mi reference point, the Mj reference point, the Mk reference point, the Ml reference point, the Mm reference point, the Mr reference point, the Mw reference point, the Cr reference point, the I2 reference point, the I4 reference point and the ISC reference point are defined in 3GPP TS 23.002 [2]. The Ici reference point and the Ms reference point are defined in 3GPP TS 23.228 [7]. The Mr' reference point and the Rc reference point are defined in 3GPP TS 23.218 [5].\nFor SIP:\n-\tThe User Equipment (UE) shall provide the User Agent (UA) role, with the exceptions and additional capabilities to SIP as described in subclause 5.1, with the exceptions and additional capabilities to SDP as described in subclause 6.1, and with the exceptions and additional capabilities to SigComp as described in subclause 8.1. The UE shall also provide the access technology specific procedures described in the appropriate access technology specific annex (see subclause 3A and subclause 9.2.2). The UE may include one or several interconnected SIP elements registered as a single logical entity when the UE performs the functions of an external attached network (e.g. an enterprise network). This specification does not place any constraint on the SIP role played by each of the elements as long as the compound entity appears to the IM CM subsystem as a SIP UA with the aforementioned exceptions and additional capabilities except for the modifications defined by the UE performing the functions of an external attached network modifying role in annex A.\nNOTE 1:\tWhen the UE performs the functions of an external attached network (e.g. an enterprise network), the internal structure of this UE is outside the scope of this specification. It is expected that in the most common case, several SIP elements will be connected to an additional element directly attached to the IM CN subsystem.\n-\tThe P-CSCF shall provide the proxy role, with the exceptions and additional capabilities to SIP as described in subclause 5.2, with the exceptions and additional capabilities to SDP as described in subclause 6.2, and with the exceptions and additional capabilities to SigComp as described in subclause 8.2. Under certain circumstances, if the P-CSCF provides an application level gateway functionality (IMS-), the P-CSCF shall provide the UA role with the additional capabilities, as follows:\na)\twhen acting as a subscriber to or the recipient of event information (see subclause 5.2);\nb)\twhen performing P-CSCF initiated dialog-release, even when acting as a proxy for the remainder of the dialog (see subclause 5.2);\nc)\twhen performing  traversal procedures (see subclause 6.7.2);\nd)\twhen performing media plane security procedures (see subclause 5.2); and\ne)\twhen providing access update procedures (see subclause 5.2.14).\nThe P-CSCF shall also provide the access technology specific procedures described in the appropriate access technology specific annex (see subclause 3A and subclause 9.2.2).\n-\tThe I-CSCF shall provide the proxy role, with the exceptions and additional capabilities as described in subclause 5.3.\n-\tThe S-CSCF shall provide the proxy role, with the exceptions and additional capabilities as described in subclause 5.4, and with the exceptions and additional capabilities to SDP as described in subclause 6.3. Under certain circumstances as described in subclause 5.4, the S-CSCF shall provide the UA role with the additional capabilities, as follows:\na)\tthe S-CSCF shall also act as a registrar. When acting as a registrar, or for the purposes of executing a third-party registration, the S-CSCF shall provide the UA role;\nb)\tas the notifier of event information the S-CSCF shall provide the UA role;\nc)\twhen providing a messaging mechanism by sending the MESSAGE method, the S-CSCF shall provide the UA role; and\nd)\twhen performing S-CSCF initiated dialog release the S-CSCF shall provide the UA role, even when acting as a proxy for the remainder of the dialog.\n-\tThe MGCF shall provide the UA role, with the exceptions and additional capabilities as described in subclause 5.5, and with the exceptions and additional capabilities to SDP as described in subclause 6.4.\n-\tThe BGCF shall provide the proxy role, with the exceptions and additional capabilities as described in subclause 5.6.\n-\tThe AS, acting as terminating UA, or redirect server (as defined in 3GPP TS 23.218 [5] subclause 9.1.1.1), shall provide the UA role, with the exceptions and additional capabilities as described in subclause 5.7.2, and with the exceptions and additional capabilities to SDP as described in subclause 6.6.\n-\tThe AS, acting as originating UA (as defined in 3GPP TS 23.218 [5] subclause 9.1.1.2), shall provide the UA role, with the exceptions and additional capabilities as described in subclause 5.7.3, and with the exceptions and additional capabilities to SDP as described in subclause 6.6.\n-\tThe AS, acting as a SIP proxy (as defined in 3GPP TS 23.218 [5] subclause 9.1.1.3), shall provide the proxy role, with the exceptions and additional capabilities as described in subclause 5.7.4.\n-\tThe AS, performing 3rd party call control (as defined in 3GPP TS 23.218 [5] subclause 9.1.1.4), shall provide the UA role, with the exceptions and additional capabilities as described in subclause 5.7.5, and with the exceptions and additional capabilities to SDP as described in subclause 6.6. An AS performing media control of an MRFC shall also support the procedures and methods described in subclause 10.2.\nNOTE 2:\tSubclause 5.7 and its subclauses define only the requirements on the AS that relate to SIP. Other requirements are defined in 3GPP TS 23.218 [5].\n-\tThe AS, receiving third-party registration requests, shall provide the UA role, with the exceptions and additional capabilities as described in subclause 5.7.\n-\tThe MRFC shall provide the UA role, with the exceptions and additional capabilities as described in subclause 5.8, and with the exceptions and additional capabilities to SDP as described in subclause 6.5. The MRFC shall also support the procedures and methods described in subclause 10.3 for media control.\n-\tIn inline aware mode, the MRB shall provide the UA role, with the exceptions and additional capabilities as described in subclause 5.8A. In inline unaware mode, the MRB shall provide the proxy role, with the exceptions and additional capabilities as described in subclause 5.8A. The MRB shall also support the procedures and methods described in subclause 10.4 for media control.\n-\tThe IBCF shall provide the proxy role, with the exceptions and additional capabilities to SIP as described in subclause 5.10. If the IBCF provides an application level gateway functionality (IMS-), then the IBCF shall provide the UA role, with the exceptions and additional capabilities to SIP as described in subclause 5.10, and with the exceptions and additional capabilities to SDP as described in subclause 6.7. If the IBCF provides screening functionality, then the IBCF may provide the UA role, with the exceptions and additional capabilities to SIP as described in subclause 5.10.\n-\tThe E-CSCF shall provide the proxy role, with the exceptions and additional capabilities as described in subclause 5.11. Under certain circumstances as described in subclause 5.11, the E-CSCF shall provide the UA role in accordance with RFC 3323 [33], with the additional capabilities, as follows:\na)\twhen operator policy (e.g. determined by national regulatory requirements applicable to emergency services) allows user requests for suppression of public user identifiers and location information, then the E-CSCF shall provide the UA role, with the exceptions and additional capabilities to SIP as described in subclause 5.11;\nb)\twhen performing E-CSCF initiated dialog release the E-CSCF shall provide the UA role, even when acting as a proxy for the remainder of the dialog, e.g. for any of the reasons specified in RFC 6442 [89] or RFC 3323 [33];\nc)\twhen acting as a notifier for the dialog event package the E-CSCF shall provide the UA role; and\nd)\tif operator policy allows any LRF to provide a location by value using the mechanism defined in subclause 5.11.3. the E-CSCF shall provide the UA role.\n-\tThe LRF shall provide the UA role.\n-\tThe ISC gateway function shall provide the proxy role, with the exceptions and additional capabilities to SIP as described in subclause 5.13. If the ISC gateway function provides an application level gateway functionality (IMS-), then the ISC gateway function shall provide the UA role, with the exceptions and additional capabilities to SIP as described in subclause 5.13, and with the exceptions and additional capabilities to SDP as described in subclause 6.7.\n-\tThe  Server enhanced for ICS shall provide the UA role, with the exceptions and additional capabilities as described in 3GPP TS 24.292 [8O].\n-\tThe  server enhanced for SRVCC using SIP interface shall provide the UA role, with the exceptions and additional capabilities as described in 3GPP TS 24.237 [8M].\n-\tThe  server enhanced for DRVCC using SIP interface shall provide the UA role, with the exceptions and additional capabilities as described in 3GPP TS 24.237 [8M].\n-\tThe EATF shall provide the UA role, with the exceptions and additional capabilities as described in 3GPP TS 24.237 [8M].\n-\tThe ATCF shall:\na)\tprovide the proxy role, with the exceptions and additional capabilities as described in 3GPP TS 24.237 [8M]; and\nb)\tprovide the UA role, with the exceptions and additional capabilities as described in 3GPP TS 24.237 [8M].\n-\tWhere access to the IM CN subsystem is provided using Web Real-Time Communication (WebRTC) in accordance with 3GPP TS 24.371 [8Z], the eP-CSCF shall act as the P-CSCF in regard to the Mw reference point. For SIP, conformance of the eP-CSCF and WIC (or whatever functionality is downloaded to the WIC) is not specified by this document unless 3GPP TS 24.371 [8Z] specifies that these entities act as specified for the interface Gm reference point, in which case existing P-CSCF and UE procedures apply, with the exceptions and additional capabilities as described in 3GPP TS 24.371 [8Z]. For SDP, these entities act as specified for the interface Gm reference point, in which case existing P-CSCF and UE procedures apply, with the exceptions and additional capabilities as described in 3GPP TS 24.371 [8Z].\nIn addition to the roles specified above, the P-CSCF, the I-CSCF, the IBCF, the S-CSCF, the BGCF, the E-CSCF and the ISC gateway function can act as a UA when providing server functionality to return a final response for any of the reasons specified in RFC 3261 [26].\nIn addition to the roles specified above the S-CSCF, AS and an entity hosting the additional routeing capabilities as specified in subclause I.3 can act as a UA when providing either client or server functionality when the event package associated with overload control is deployed.\nNOTE 3:\tAnnex A can change the status of requirements in referenced specifications. Particular attention is drawn to table A.4 and table A.162 for capabilities within referenced SIP specifications, and to table A.317 and table A.328 for capabilities within referenced SDP specifications. The remaining tables build on these initial tables.\nNOTE 4:\tThe allocated roles defined in this clause are the starting point of the requirements from the IETF SIP specifications, and are then the basis for the description of further requirements. Some of these extra requirements formally change the proxy role into a B2BUA. In all other respects other than those more completely described in subclause 5.2 the P-CSCF implements proxy requirements. Despite being a B2BUA a P-CSCF does not implement UA requirements from the IETF RFCs, except as indicated in this specification, e.g., relating to registration event subscription.\nNOTE 5:\tExcept as specified in clause 5 or otherwise permitted in RFC 3261, the functional entities providing the proxy role are intended to be transparent to data within received requests and responses. Therefore these entities do not modify message bodies. If local policy applies to restrict such data being passed on, the functional entity has to assume the UA role and reject a request, or if in a response and where such procedures apply, to pass the response on and then clear the session using the BYE method.\nAll the above entities are functional entities that could be implemented in a number of different physical platforms coexisting with a number of other functional entities. The implementation shall give priority to transactions at one functional entity, e.g. that of the E-CSCF, over non-emergency transactions at other entities on the same physical implementation. Such priority is similar to the priority within the functional entities themselves specified elsewhere in this document.\nAdditional routeing functionality can be provided to support the ability for the IM CN subsystem to provide transit functionality as specified in Annex I. The additional routeing functionality shall assume the proxy role.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\t and address assignments",
                    "description": "",
                    "summary": "",
                    "text_content": "In order for SIP and SDP to operate, the following prerequisite conditions apply:\n1)\tI-CSCFs used in registration are allocated SIP URIs. Other IM CN subsystem entities may be allocated SIP URIs. For example sip:pcscf.home1.net and sip:<impl-specific-info>@pcscf.home1.net are valid SIP URIs. If the user part exists, it is an essential part of the address and shall not be omitted when copying or moving the address. How these addresses are assigned to the logical entities is up to the network operator. For example, a single SIP  may be assigned to all I-CSCFs, and the load shared between various physical boxes by underlying IP capabilities, or separate SIP URIs may be assigned to each I-CSCF, and the load shared between various physical boxes using DNS  capabilities.\n2)\tAll IM CN subsystem entities are allocated IP addresses. Any IM CN subsystem entities can be allocated IPv4 only, IPv6 only or both IPv4 and IPv6 addresses. For systems providing access to IM CN subsystem using a GPRS IP-CAN or an EPS IP-CAN this is specified in 3GPP TS 23.221 [6] subclause 5.1. For systems providing access to IM CN subsystem using a cdma2000® packet data subsystem IP-CAN this is specified in subclause M.2.2.1. For systems providing access to IM CN subsystem using a 5GS IP-CAN this is specified in 3GPP TS 23.501 [257], subclause 5.8.2.2.\n3)\tThe subscriber is allocated a private user identity by the home network operator. This private user identity is available to the SIP application within the UE. Depending on the network operator, various arrangements exist within the UE for retaining this information:\na)\twhere an ISIM is present, within the ISIM, see subclause 5.1.1.1A;\nb)\twhere no ISIM is present but USIM is present, the private user identity is derived (see subclause 5.1.1.1A);\nc)\tneither ISIM nor USIM is present, but  is present, within  (see subclause 5.1.1.1B.1);\nd)\twhen neither ISIM nor USIM nor  is present, the private user identity is available to the UE via other means (see subclause 5.1.1.1B.2).\nNOTE 1:\t3GPP TS 33.203 [19] specifies that a UE attached to a 3GPP network has an ISIM or a USIM.\nNOTE 2:\tThe SIP URIs can be resolved by using any of public DNSs, private DNSs, or peer-to-peer agreements.\n4)\tThe subscriber is allocated one or more public user identities by the home network operator. The public user identity shall take the form of SIP  as specified in RFC 3261 [26] or tel  as specified in RFC 3966 [22]. At least one of the public user identities is a SIP . All registered public user identities are available to the SIP application within the UE, after registration. Depending on the network operator, various arrangements exist within the UE for retaining this information:\na)\twhere an ISIM is present, at least one public user identity, which is a SIP , within the ISIM, see subclause 5.1.1.1A;\nb)\twhere no ISIM is present but USIM is present, a temporary public user identity is derived (see subclause 5.1.1.1A);\nc)\tneither ISIM nor USIM is present, but  is present, within  (see subclause 5.1.1.1B.1);\nd)\twhen neither ISIM nor USIM nor  is present, the public user identities are available to the UE via other means (see subclause 5.1.1.1B.2).\nNOTE 3:\t3GPP TS 33.203 [19] specifies that a UE attached to a 3GPP network has an ISIM or a USIM.\n5)\tIf the UE supports GRUU (see table A.4, item A.4/53) or multiple registrations, then it shall have an Instance ID, in conformance with the mandatory requirements for Instance IDs specified in RFC 5627 [93] and RFC 5626 [92].\n6)\tFor each tel , there is at least one alias SIP  in the set of implicitly registered public user identities that is used to implicitly register the associated tel .\nNOTE 4:\tFor each tel , there always exists a SIP  that has identical user part as the tel  and the \"user\" SIP  parameter equals \"phone\" (see RFC 3261 [26] subclause 19.1.6), that represents the same public user identity. If a tel  identifies a subscriber served by the IM CN subsystem, then the hostport parameter of the respective SIP  contains the home network domain name of the IM CN subsystem to which the subscriber belongs.\n6A)\tIdentification of the UE to a PSAP with point of presence in the CS domain is not possible if a tel  is not included in the set of implicitly registered public user identities. If the included tel  is associated either with the first entry in the list of public user identities provisioned in the UE or with the temporary public user identity, then a PSAP can uniquely identify the UE if emergency registration is performed.\nNOTE 5:\tThe tel  uniquely identifies the UE by not sharing any of the implicit registered public user identities in the implicit registration set that contains this tel .\nNOTE 6:\tEmergency registration is not always needed or supported.\n7)\tThe public user identities may be shared across multiple UEs. A particular public user identity may be simultaneously registered from multiple UEs that use different private user identities and different contact addresses. When reregistering and deregistering a given public user identity and associated contact address, the UE will use the same private user identity that it had used during the initial registration of the respective public user identity and associated contact address. If the tel  is a shared public user identity, then the associated alias SIP  is also a shared public user identity. Likewise, if the alias SIP  is a shared public user identity, then the associated tel  is also a shared public user identity.\n8)\tFor the purpose of access to the IM CN subsystem, UEs can be allocated IPv4 only, IPv6 only or both IPv4 and IPv6 addresses. For systems providing access to IM CN subsystem using a GPRS IP-CAN or an EPS IP-CAN this is specified in 3GPP TS 23.221 [6] subclause 5.1 (see subclause 9.2.1 for the assignment procedures). For systems providing access to IM CN subsystem using a cdma2000® network this is specified in subclause M.2.2.1. For systems providing access to IM CN subsystem using a 5GS IP-CAN this is specified in 3GPP TS 23.501 [257], subclause 5.8.2.2.\n9)\tFor the purpose of indicating an IMS communication service to the network, UEs are assigned ICSI values appropriate to the IMS communication services supported by the UE, coded as URNs as specified in subclause 7.2A.8.2.\nNOTE 7:\tcdma2000® is a registered trademark of the Telecommunications Industry Association (TIA-USA).\n10)\tE-CSCFs are allocated multiple SIP URIs. The SIP  configured in the P-CSCF, AS or IBCF to reach the E-CSCF is distinct from the one given by the E-CSCF to the EATF such that EATF can reach the E-CSCF.\n11)\tIf the UE supports RFC 6140 [191] and performs the functions of an external attached network, the subscriber is allocated one or usually more public user identities by the home network operator. The public user identity(s) shall be allocated as global numbers in the international format.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2A\tTransport mechanisms",
                    "description": "",
                    "summary": "",
                    "text_content": "This document makes no requirement on the transport protocol used to transfer signalling information over and above that specified in RFC 3261 [26] clause 18, unless such requirement is defined in the access technology specific annex for the current access technology (see subclause 3A). However, the UE and IM CN subsystem entities shall transport SIP messages longer than 1300 bytes according to the procedures of RFC 3261 [26] subclause 18.1.1, even if a mechanism exists of discovering a maximum transmission unit size longer than 1500 bytes.\nNOTE 1:\tSupport of SCTP as specified in RFC 4168 [96] is optional for IM CN subsystem entities implementing the role of a UA or proxy. SCTP transport between the UE and P-CSCF is not supported in the present document. Support of the SCTP transport is currently not described in 3GPP TS 33.203 [19].\nFor initial REGISTER requests, the UE and the P-CSCF shall apply port handling according to subclause 5.1.1.2 and subclause 5.2.2.\nThe UE and the P-CSCF shall send and receive request and responses other than initial REGISTER requests on the protected ports as described in 3GPP TS 33.203 [19].\nIn case of an emergency session if the UE does not have sufficient credentials to authenticate with the IM CN subsystem and regulations allow, the UE and P-CSCF shall send request and responses other than initial REGISTER requests on non protected ports.\nNOTE 2:\tWhen  is used to carry SIP signalling between the UE and the P-CSCF, it is known that there is no  between the UE and the P-CSCF and neither  nor the multiple registration mechanism is used, then both the UE and the P-CSCF can decide to close an existing  connection subject to the conditions described in RFC 3261 [26].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2B\tSecurity mechanisms",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2B.1\tSignalling security",
                            "text_content": "3GPP TS 33.203 [19] defines the security features and mechanisms for secure access to the IM CN subsystem. This document defines a number of access security mechanisms, as summarised in table 4-1.\nTable 4-1: Summary of access security mechanisms to the IM CN subsystem\n\nSpecification of the mechanisms identified within table 4-1 within this document are provided in clause 5. Subclauses where security procedures are required consist of a general subclause applicable whichever security mechanisms are in use, and a separate subclause for each security mechanism identified by a row within table 4-1.\nFor access to the IM CN subsystem different than WebRTC  is optional to implement and is used only in combination with SIP digest authentication. For WebRTC based access to the IM CN subsystem TLS can be used in combination with IMS AKA using HTTP Digest AKAv2 without IPSec security association. Authentication associated with registration to the IM CN subsystem is applicable to IMS AKA and SIP digest and is covered in subclause 5.1.1 for the UE, subclause 5.2.2 for the P-CSCF and subclause 5.4.1 for the S-CSCF. Additionally, SIP digest allows for authentication to also occur on an initial request for a dialog or a request for a standalone transaction, this additional capability is covered in subclause 5.1.2A and subclause 5.4.3.2.\nIf a UE that implements SIP digest is configured not to use , then the UE does not establish a  session toward the P-CSCF. If a UE supports , then the UE supports  as described in 3GPP TS 33.203 [19].\nFor SIP digest authentication, the P-CSCF can be configured to have  required or disabled:\n-\tif  is required, the P-CSCF requires the establishment of a  session from all SIP digest UEs, in order to access IMS subsequent to registration; or\n-\tif  is disabled, the P-CSCF does not allow the establishment of a  session from any UE.\nNOTE:\tThe mechanism to configure the P-CSCF to have  required or disabled is outside the scope of this specification.\nSIP digest cannot be used in conjunction with the procedures of Annex F.\nFor emergency calls, 3GPP TS 33.203 [19] specifies some relaxations, which are further described in the subclauses of this document relating to emergency calls.\n3GPP TS 33.210 [19A] defines the security architecture for network domain IP based control planes. 3GPP TS 33.210 [19A] applies for security mechanisms between entities in the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4-1: Summary of access security mechanisms to the IM CN subsystem",
                                    "table number": 1,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "4.2B.2\tMedia security",
                            "text_content": "3GPP TS 33.328 [19C] defines mechanisms for support of security on the media plane.\nThis document defines the required elements for signalling the support of media security.\nThe media security mechanisms are summarised as shown in table 4-2.\nTable 4-2: Summary of media security mechanisms to the IM CN subsystem\n\nFor  media security using SDES, the UE supports the SDES key management protocol and optionally the KMS key management protocol as defined in 3GPP TS 33.328 [19C] and SRTP as defined in RFC 3711 [169] for secure transport of media.\nFor end-to-access-edge media security of RTP media using DTLS-SRTP, the UE supports DTLS-SRTP as defined in RFC 5763 [222] and RFC 5764 [223] with certificate fingerprints as defined in 3GPP TS 33.328 [19C].\nFor end-to-access-edge media security for MSRP using  and certificate fingerprints, the UE supports MSRP over  as defined in RFC 4975 [178] and RFC 6714 [214] with certificate fingerprints as defined in 3GPP TS 33.328 [19C].\nFor end-to-access-edge media security for BFCP using  and certificate fingerprints, the UE supports BFCP over  as defined in RFC 4583 [108] with certificate fingerprints as defined in 3GPP TS 33.328 [19C].\nFor end-to-access-edge media security for UDPTL using DTLS and certificate fingerprints, the UE supports UDPTL over DTLS as defined in RFC 7345 [217] and RFC 8842 [240], with certificate fingerprints as defined in 3GPP TS 33.328 [19C].\nFor end-to-end media security for MSRP using  and KMS, the UE supports MSRP over  as defined in RFC 4975 [178] and RFC 6714 [214] with pre-shared key ciphersuites as defined in RFC 4279 [218] and the KMS key management protocol as defined in 3GPP TS 33.328 [19C]. The certificate fingerprints are not indicated.\nThere is no support for media security in the MGCF, because there would be no end-to-end media security support on calls interworked with the CS domain and the CS user. In this release of this document, there is no support for media security in the MRF. End-to-access-edge media security is not impacted by this absence of support.\nFor emergency calls, it is not expected that PSAPs would support end-to-end media security and therefore the procedures of this document do not allow the UE to establish such sessions with end-to-end media security. End-to-access-edge media security is not impacted and can be used on emergency calls.\nWhen the UE performs the functions of an external attached network (e.g. an enterprise network):\n-\twhere end-to-access-edge media security is used, the UE functionality is expected to be in the gateway of the external attached network, and support for further media security is outside the scope of this document; and\n-\twhere end-to-end media security is used, the UE functionality is expected to be supported by the endpoints in the attached network.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4-2: Summary of media security mechanisms to the IM CN subsystem",
                                    "table number": 2,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "4.3\tRouteing principles of IM CN subsystem entities",
                    "description": "",
                    "summary": "",
                    "text_content": "Each IM CN subsystem functional entity shall apply loose routeing policy as described in RFC 3261 [26], when processing a SIP request. In cases where the I-CSCF, IBCF, S-CSCF and the E-CSCF may interact with strict routers in non IM CN subsystem networks, the I-CSCF, IBCF, S-CSCF and E-CSCF shall use the routeing procedures defined in RFC 3261 [26] to ensure interoperability with strict routers.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.4\tTrust domain",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.4.1\tGeneral",
                            "text_content": "A trust domain can apply for specific header fields, tel URI parameters and SIP URI parameters within the IM CN subsystem.\nFor the IM CN subsystem, this trust domain consists of the functional entities that belong to the same operator's network (P-CSCF, the eP-CSCF, the E-CSCF, the I-CSCF, the IBCF, the S-CSCF, the BGCF. the MGCF, the MRFC, the MRB, the EATF, the ATCF, the ISC gateway function, and all ASs that are included in the trust domain). Additionally, other nodes within the IM CN subsystem that are not part of the same operator's domain may or may not be part of the trust domain, depending on whether an interconnect agreement exists with the remote network. SIP functional entities that belong to a network for which there is an interconnect agreement are part of the trust domain. ASs outside the operator's network can also belong to the trust domain if they have a trusted relationship with the home network.\nNOTE 1:\tWhether any peer functional entity is regarded as part of the same operator's domain, and therefore part of the same trust domain, is dependent on operator policy which is preconfigured into each functional entity.\nNOTE 2:\tFor the purpose of this document, the PSAP is typically regarded as being within the trust domain, except where indicated. National regulator policy applicable to emergency services determines the trust domain applicable to certain header fields. This means that e.g. the handling of the P-Access-Network-Info header field, P-Asserted-Identity header field and the History-Info header field can be as if the PSAP is within the trust domain, and trust domain issues will be resolved accordingly.\nThe trust domain can exist for a number of purposes:\na)\tfor the protection of information specific to an operator;\nb)\tto provide for privacy requirements of the end user; or\nc)\tto ensure that information is only passed to another entity if certain responsibilities related to that information are met by the receiving entity, for example that the signalled requirements in the Privacy header field will be met (see subclause 4.4.2 and 4.4.4).\nWithin the IM CN subsystem trust domains will be applied to a number of header fields. These trust domains do not necessarily contain the same functional entities or cover the same operator domains. The procedures in this subclause apply to the functional entities in clause 5 in the case where a trust domain boundary for that header field, tel URI parameter, or SIP URI parameter, exists at that functional entity.\nWhere the IM CN subsystem supports business communication, different trust domains can apply to public network traffic, and to private network traffic belonging to each supported corporate network.\nNOTE 3:\tWhere an external attached network (e.g. an enterprise network) is in use, the edges of the trust domains need not necessarily lie at the P-CSCF. In this release of the specification, the means by which the P-CSCF learns of such attached devices, and therefore different trust domain requirements to apply, is not provided in the specification and is assumed to be by configuration or by a mechanism outside the scope of this release of the specification.\nA trust domain applies for the purpose of the following header fields: P-Asserted-Identity, P-Access-Network-Info, History-Info, Resource-Priority, P-Asserted-Service, Reason (only in a response), P-Profile-Key, P-Private-Network-Indication, P-Served-User, P-Early-Media, Feature-Caps, Restoration-Info, Relayed-Charge, Service-Interact-Info, Cellular-Network-Info, Response-Source, Attestation-Info, Origination-Id, Additional-Identity and Priority-Verstat. A trust domain applies for the purpose of the  and OLI tel  parameters. A trust domain applies for the iotl SIP  parameter. The trust domains of these header fields and parameters need not have the same boundaries. Clause 5 defines additional procedures concerning these header fields, tel  parameters and SIP  parameter.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.2\tP-Asserted-Identity",
                            "text_content": "RFC 3325 [34] provides for the existence and trust of an asserted identity within a trust domain. A functional entity at the boundary of the trust domain will need to determine whether to remove the P-Asserted-Identity header field according to RFC 3325 [34] when SIP signalling crosses the boundary of the trust domain. The priv-value \"id\" shall not be removed from the Privacy header field when SIP signalling crosses the boundary of the trust domain. Subclause 5.4 identifies additional cases for the removal of the P-Asserted-Identity header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.3\tP-Access-Network-Info",
                            "text_content": "A functional entity at the boundary of the trust domain shall remove any P-Access-Network-Info header field according to RFC 7315 [52].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.4\tHistory-Info",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the History-Info header field according to RFC 7044 [66] subclause 10.1.2 when SIP signalling crosses the boundary of the trust domain. Subclause 5.4 identifies additional cases for the removal of the History-Info header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.5\tP-Asserted-Service",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the P-Asserted-Service header field according to RFC 6050 [121] when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.6\tResource-Priority",
                            "text_content": "If Priority verification using assertion of priority information features described in subclause 3.1 is supported then a functional entity at the boundary of the trust domain will need to determine, based on the operator policy, whether to remove a Resource-Priority header field.\nOtherwise, if Priority verification using assertion of priority information features described in subclause 3.1 is not supported a functional entity shall only include a Resource-Priority header field in a request or response forwarded to another entity within the trust domain. If a request or response is forwarded to an entity outside the trust domain, the functional entity shall remove the Resource-Priority header field from the forwarded request or response. If a request or response is received from an untrusted entity (with the exception requests or responses received by the P-CSCF from the UE for which procedures are defined in subclause 5.2) that contains the Resource-Priority header field, the functional entity shall remove the Resource-Priority header field before forwarding the request or response within the trust domain.\nNOTE:\tAlternate treatments can be applied when a non-trusted Resource-Priority header field is received over the boundary of trust domain. The exact treatment (e.g. removal, modification, or passing of the Resource-Priority header field) is left to national regulation and network configuration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.7\tReason (in a response)",
                            "text_content": "A functional entity shall only include a Reason header field in a response forwarded to another entity within the trust domain (as specified in RFC 6432 [130]). If a response is forwarded to an entity outside the trust domain, the functional entity shall remove the Reason header field from the forwarded response.\nNOTE:\tA Reason header field can be received in a response from outside the trust domain and will not be removed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.8\tP-Profile-Key",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the P-Profile-Key header field as defined in RFC 5002 [97] when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.9\tP-Served-User",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the P-Served-User header field according to RFC 5502 [133] when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.10\tP-Private-Network-Indication",
                            "text_content": "A functional entity shall only include a P-Private-Network-Indication header field in a request forwarded to another entity within the trust domain. If a request is forwarded to an entity outside the trust domain, the functional entity shall remove the P-Private-Network-Indication header field from the forwarded request. If a request is received from an untrusted entity that contains the P-Private-Network-Indication header field, the functional entity shall remove the P-Private-Network-Indication header field before forwarding the request within the trust domain.\nNOTE 1:\tOther entities within the enterprise will frequently be part of this trust domain.\nNOTE 2:\tThe presence of the P-Private-Network-Indication header field is an indication that the request constitutes private network traffic. This can modify the trust domain behaviour for other header fields.\nNOTE 3:\tIf a trust domain boundary is encountered for this header field without appropriate business communication processing, then this can be an indication that misconfiguration has occurred in the IM CN subsystem. Removal of this header field changes the request from private network traffic to public network traffic.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.11\tP-Early-Media",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the P-Early-Media header field as defined in RFC 5009 [109] when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.12\t and OLI",
                            "text_content": "Entities in the IM CN subsystem shall restrict \"cpc\" and \"oli\"  parameters to specific domains that are trusted and support the \"cpc\" and \"oli\"  parameters. Therefore for the purpose of the \"cpc\" and \"oli\"  parameters within this specification, a trust domain also applies.\nSIP functional entities within the trust domain shall remove the \"cpc\" and \"oli\"  parameters when the SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.13\tFeature-Caps",
                            "text_content": "A functional entity at the boundary of the trust domain shall remove all Feature-Caps header fields received from UEs and external networks outside the trust domain.\nNOTE:\tA UE that is a privileged sender is considered as part of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.14\tPriority",
                            "text_content": "Based on local policy, a functional entity at the boundary of the trust domain shall remove all Priority header fields with a \"psap-callback\" header field value.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.15\tiotl",
                            "text_content": "Entities in the IM CN subsystem shall restrict \"iotl\"  parameter to specific domains that are trusted and support the \"iotl\"  parameter. Support implies that the parameter is removed before the containing request is sent over an interface of a different type. Therefore for the purpose of the \"iotl\"  parameter within this specification, a trust domain also applies.\nSIP functional entities within the trust domain shall remove the \"iotl\"  parameter when the SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.16\tRestoration-Info",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the Restoration-Info header field when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.17\tRelayed-Charge",
                            "text_content": "Entities in the IM CN subsystem shall restrict the Relayed-Charge header field to specific domains that are trusted and support the Relayed-Charge header field. Trust implies that the sending domain intends the receiving domain to have the contents of this header field. Therefore for the purpose of the Relayed-Charge header field within this specification, a trust domain also applies.\nSIP functional entities within the trust domain shall remove the Relayed-Charge header field when the SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.18\tService-Interact-Info",
                            "text_content": "A functional entity at the boundary of the trust domain shall remove all Service-Interact-Info header fields defined in subclause 7.2.when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.19\tCellular-Network-Info",
                            "text_content": "A functional entity shall only include a Cellular-Network-Info header field in a request forwarded to another entity within the trust domain. If a request is forwarded to an entity outside the trust domain, the functional entity shall remove the Cellular-Network-Info header field from the forwarded request. If a request is received from an untrusted entity that contains the Cellular-Network-Info header field, the functional entity shall remove Cellular-Network-Info header field before forwarding the request within the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.20\tResponse-Source",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the Response-Source header field according to subclause 7.2.17. when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.21\tAttestation-Info header field",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the Attestation-Info header field according to subclause 7.2.18. when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.22\tOrigination-Id header field",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the Origination-Id header field according to subclause 7.2.19 when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.23\tAdditional-Identity header field",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the Additional-Identity header field according to subclause 7.2.20 when SIP signalling crosses the boundary of the trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.24\tPriority-Verstat header field",
                            "text_content": "A functional entity at the boundary of the trust domain will need to determine whether to remove the Priority-Verstat header field according to subclause 7.2.21 when SIP signalling crosses the boundary of the trust domain.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.5\tCharging correlation principles for IM CN subsystems",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.5.1\tOverview",
                            "text_content": "This subclause describes charging correlation principles to aid with the readability of charging related procedures in clause 5. See 3GPP TS 32.240 [16] and 3GPP TS 32.260 [17] for further information on charging.\nThe IM CN subsystem generates and retrieves the following charging correlation information for later use with offline and online charging:\n1.\tIM CN subsystem Charging Identifier (ICID);\n2.\tAccess network charging information;\n3.\tInter Operator Identifier (IOI);\n4.\tCharging function addresses:\na.\tCharging Data Function (CDF);\nb.\tOnline Charging Function (OCF);\n5.\tIM CN subsystem Functional Entity Identifier.\nHow to use and where to generate the parameters in IM CN subsystems are described further in the subclauses that follow. The charging correlation information is encoded in the P-Charging-Vector header field as defined in subclause 7.2A.5 and in RFC 7315 [52]. The P-Charging-Vector header field contains the following header field parameters: \"icid-value\", \"icid-generated-at\", \"related-icid\", \"related-icid-generated-at\", \"access-network-charging-info\", \"orig-ioi\", \"term-ioi\", \"transit-ioi\" and \"fe-identifier\".\nThe offline and online charging function addresses are encoded in the P-Charging-Function-Addresses as defined in RFC 7315 [52]. The P-Charging-Function-Addresses header field contains the following header field parameters: \"ccf\" for CDF and \"ecf\" for OCF.\nNOTE:\tP-Charging-Function-Addresses parameters were defined using previous terminology.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.2\tIM CN subsystem charging identifier (ICID)",
                            "text_content": "The ICID is the session level data shared among the IM CN subsystem entities including ASs in both the calling and called IM CN subsystems. The ICID is used also for session unrelated messages (e.g. SUBSCRIBE request, NOTIFY request, MESSAGE request) for the correlation with CDRs generated among the IM CN subsystem entities.\nThe first IM CN subsystem entity involved in a SIP transaction will generate the ICID and include it in the \"icid-value\" header field parameter of the P-Charging-Vector header field in the SIP request.\nFor a dialog relating to a session, the generation of the ICID will be performed only on the initial request. This ICID will be used for the initial request and any response to the initial request, and all subsequent SIP messages ina P-Charging-Vector header field.\nFor all other transactions, generation of the ICID will be performed on each SIP request. This ICID will be used for the SIP request and any response to the SIP request in a P-Charging-Vector header field.\nThe \"icid-value\" header field parameter is inserted in the IM CN subsystem, as summarised in table 4-2A.\nNOTE:\tThis summary is also applicable for SIP messages which are not specified in clause 5, although each procedure for the P-Charging-Vector header field in clause 5 is described only for specific SIP message(s) (e.g. only for a 200 (OK) response).\nTable 4-2A: Summary of ICID insertion in the IM CN subsystem\n\nSee 3GPP TS 32.260 [17] for requirements on the format of ICID. The P-CSCF will generate an ICID for UE-originated calls. The I-CSCF will generate an ICID for UE-terminated calls if there is no ICID received in the initial request (e.g. the calling party network does not behave as an IM CN subsystem). The AS will generate an ICID when acting as an originating UA. The MGCF will generate an ICID for PSTN/PLMN originated calls. The  server will generate an ICID for ICS and SRVCC originated calls. Each entity that processes the SIP request will extract the ICID for possible later use in a CDR. The I-CSCF and S-CSCF are also allowed to generate a new ICID for UE-terminated calls received from another network.\nThere is also an ICID generated by the P-CSCF with a REGISTER request that is passed in a unique instance of P-Charging-Vector header field. The valid duration of the ICID is specified in 3GPP TS 32.260 [17].\nThe \"icid-value\" header field parameter is included in any request and response that includes the P-Charging-Vector header field. However, the P-Charging-Vector (and ICID) is not passed to the UE.\nThe ICID is also passed from the P-CSCF to the IP-CAN via PCRF. The interface supporting this operation is outside the scope of this document.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4-2A: Summary of ICID insertion in the IM CN subsystem",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "4.5.2A\tRelated ICID",
                            "text_content": "During the process of SRVCC access transfer the  server or the P-CSCF generates an ICID for the target access leg. For the purpose of charging correlation between the source access leg and the target access leg when the user is roaming the  AS and the ATCF includes the ICID used on the source access leg in the \"related-icid\" header field parameter of the P-Charging-Vector header field returned in 1xx and 2xx responses to the initial INVITE request.\nDuring the process of dual radio access transfer the  server or the P-CSCF generates an ICID for the target access leg. For the purpose of charging correlation between the source access leg and the target access leg when the user is roaming the  AS includes the ICID used on the source access leg in the \"related-icid\" header field parameter of the P-Charging-Vector header field returned in 1xx and 2xx responses to the initial INVITE request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.3\tAccess network charging information",
                            "text_content": "The access network charging information are the media flow level data shared among the IM CN subsystem entities for one side of the session (either the calling or called side). GPRS charging information (GGSN identifier and PDP context information) is an example of access network charging information.\nThe IP-CAN provides the access network charging information to the IM CN subsystem. This information is used to correlate IP-CAN CDRs with IM CN subsystem CDRs, i.e. the access network charging information is used to correlate the bearer level with the session level.\nThe access network charging information is generated at the first opportunity after the resources are allocated at the IP-CAN. The access network charging information is passed from IP-CAN to P-CSCF via PCRF, over the Rx and Gx interfaces. Access network charging information will be updated with new information during the session as media flows are added or removed. The P-CSCF provides the access network charging information to the S-CSCF. The S-CSCF may also pass the information to an AS, which may be needed for online pre-pay applications. The access network charging information for the originating network is used only within that network, and similarly the access network charging information for the terminating network is used only within that network. Thus the access network charging information are not shared between the calling and called networks. The access network charging information is not passed towards the external ASs from its own network.\nThe access network charging information is populated in the P-Charging-Vector header field.\nThe access network charging information can be included in a P-Charging-Vector header field in dialog forming requests, mid-dialog requests, and responses. This is dependant on when updated information is avialable in the P-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.4\tInter operator identifier (IOI)",
                            "text_content": "The Inter Operator Identifier (IOI) is a globally unique identifier to share between sending and receiving networks, service providers or content providers.\nThe sending network populates the \"orig-ioi\" header field parameter of the P-Charging-Vector header field in a request and thereby identifies the operator network from which the request was sent. The \"term-ioi\" header field parameter is left out of the P-Charging-Vector header field in this request. The sending network retrieves the \"term-ioi\" header field parameter from the P-Charging-Vector header field in a response to the request, which identifies the operator network from which the response was sent.\nThe receiving network retrieves the \"orig-ioi\" header field parameter from the P-Charging-Vector header field in the request, which identifies the operator network from which the request was sent. The receiving network populates the \"term-ioi\" header field parameter of the P-Charging-Vector header field in the response to the request, which identifies the operator network from which the response was sent.\nThe \"orig-ioi\" and \"term-ioi\" header field parameters are inserted in the IM CN subsystem, as summarised in table 4-2B.\nNOTE:\tThis summary is also applicable for SIP messages which are not specified in clause 5, although each procedure for the P-Charging-Vector header field in clause 5 is described only for specific SIP message(s) (e.g. only for a 200 (OK) response).\nTable 4-2B: Summary of IOI insertion in the IM CN subsystem\n\nThere are three types of IOI:\na)\tType 1 IOI, between the visited network and the home network. This includes the following cases:\n-\tbetween the P-CSCF (possibly in the visited network) and the S-CSCF in the home network. This is exchanged in REGISTER requests and responses, and in all session-related and session-unrelated requests and responses;\n-\tbetween the  AS in the home network and the ATCF (possible in the visited network). This is exchanged in MESSAGE requests and responses;\nNOTE:\tFor applications where the primary relationship is home and visited network, request and responses to the request will normally contain a type 1 IOI value.\n-\tbetween the  server (possibly in the visited network) and the S-CSCF in the home network. This is exchanged in REGISTER requests and responses, and in all session-related and session-unrelated requests and responses; and\n-\twhen using Roaming Architecture for Voice over IMS with Local Breakout and loopback routeing occurs, between the S-CSCF of the home network and the TRF of the visited network or between the BGCF of the home network and the TRF of the visited network. This is exchanged in all session-related requests and responses.\nb)\tType 2 IOI, between originating network and the terminating network. This includes the following cases:\n-\tbetween the S-CSCF of the home originating network and the S-CSCF of the home terminating network or between the S-CSCF of the home originating network and the MGCF when a call/session is terminated at the PSTN/PLMN;\n-\tbetween the MGCF and the S-CSCF of the home terminating network when a call/session is originated from the PSTN/PLMN or with a PSI AS when accessed across I-CSCF; and\n-\twhen using Roaming Architecture for Voice over IMS with Local Breakout and loopback routeing occurs, between the TRF of the visited network and the S-CSCF of the home terminating network.\nThis is exchanged in all session-related and session-unrelated requests and responses.\nAdditionally, for emergency transactions, a type 2 IOI is exchanged between the E-CSCF and the MGCF or IBCF where the request is routed to a PSAP. In scenarios where the E-CSCF receives emergency requests from an S-CSCF, a type 2 IOI is exchanged. This can also occur where the E-CSCF receives emergency requests from an IBCF.\nc)\tType 3 IOI, between the S-CSCF or I-CSCF of the home operator network and any AS. Type 3 IOI are also used between E-CSCF and LRF, between E-CSCF and EATF, and between transit function and AS. The type 3 IOI is exchanged in all session-related and session-unrelated requests and responses.\nEach entity that processes the SIP request will extract the IOI for possible later use in a CDR. The valid duration of the IOI is specified in 3GPP TS 32.240 [16].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4-2B: Summary of IOI insertion in the IM CN subsystem",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "4.5.4A\tTransit inter operator identifier (Transit IOI)",
                            "text_content": "The Transit Inter Operator Identifier (Transit IOI) is a globally unique identifier to share between sending, transit and receiving networks, service providers or content providers.\nA network sending a request can retrieve the \"transit-ioi\" header field parameter value(s) from the P-Charging-Vector header field in the response to the sent request, which identify the operator network(s) which the response was transitting.\nThe transit network(s) populate(s) the \"transit-ioi\" header field parameter value(s) of the P-Charging-Vector header field in a request and thereby identify(ies) the operator network(s) which the request was transitting. The \"transit-ioi\" header field parameter is an indexed value that is incremented each time a value is added. When the index is calculated then \"void\" entries are taken into account.\nThe transit network(s) populate(s) the \"transit-ioi\" header field parameter value(s) of the P-Charging-Vector header field in the response to the request and thereby identify(ies) the operator network(s) which the response was transitting. The \"transit-ioi\" header field parameter is an indexed value that is incremented each time a value is added. When the index is calculated then \"void\" entries are taken into account.\nA network receiving a request can retrieve the \"transit-ioi\" header field parameter value(s) from the P-Charging-Vector header field in the request, which identify the operator network(s) which the request was transitting.\nEXAMPLE:\nTransit-IOI in a request when arriving on the terminating side:\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-ioi=home1.net; transit-ioi=\"operatorA.1, void, operatorB.3\"\nTransit-IOI in the corresponding response when arriving on the originating side:\nP-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-ioi=home1.net; term-ioi=home2.net; transit-ioi=\"operatorB.1, void, operatorA.3\"\nThe Transit IOI is exchanged between functional entities, as summarised in table 4-3.\nTable 4-3: Summary of Transit IOI exchange in the IM CN subsystem\n\n\nEach entity that processes the SIP requests and responses may extract the Transit IOI for charging purposes, as described in 3GPP TS 32.260 [17].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4-3: Summary of Transit IOI exchange in the IM CN subsystem",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "4.5.5\tCharging function addresses",
                            "text_content": "Charging function addresses are distributed to each of the IM CN subsystem entities in the home network for one side of the session (either the calling or called side) and provide a common location for each entity to send charging information. Charging Data Function (CDF) addresses are used for offline billing. Online Charging Function (OCF) addresses are used for online billing.\nThere may be multiple addresses for CDF and OCF addresses populated into the P-Charging-Function-Addresses header field of the SIP request or response. The header field parameters are \"ccf\" and \"ecf\" for CDF and OCF, respectively. At least one instance of either \"ccf\" or \"ecf\" header field paramter is required. If \"ccf\" header field parameter is included for offline charging, then a secondary \"ccf\" header field paramter may be included by each network for redundancy purposes, but the first instance of \"ccf\" header field parameter is the primary address. If ecf address is included for online charging, then a secondary instance may also be included for redundancy.\nThe CDF and/or OCF addresses are retrieved from an Home Subscriber Server (HSS) via the Cx interface and passed by the S-CSCF to subsequent entities. The charging function addresses are passed from the S-CSCF to the IM CN subsystem entities in its home network, but are not passed to the visited network or the UE. When the P-CSCF is allocated in the visited network, then the charging function addresses are obtained by means outside the scope of this document. The AS receives the charging function addresses from the S-CSCF via the ISC interface. CDF and/or OCF addresses may be allocated as locally preconfigured addresses. The AS can also retrieve the charging function address from the HSS via Sh interface.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.6\tRelayed charge parameters",
                            "text_content": "Where there is a desire to pass charging information to an entity over an interface to which the charging information is not directly related, then the Relayed-Charge header field is used. This is used only in accordance with the capabilities specified in this document, which currently specify only the relay of a transit IOI to an associated AS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.7\tLoopback-indication parameter",
                            "text_content": "When there is a desire to send the information that loopback has been applied to an entity, then the loopback-indication parameter is used. This parameter can e.g. be evaluated when processing the P-CSCF CDR and possibly the ATCF CDR to know whether or not to attempt to locate a correlated TRF CDR even for the non-loopback scenario when no such CDR exists. It is used only in accordance with the capabilities specified in this document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.8\tIM CN subsystem Functional Entity Identifier",
                            "text_content": "Different rules for generating and processing of charging information apply. In order to inform the billing domain which IM CN subsystem functional entities have created charging information, the IM CN subsystem functional entities and ASs include an \"fe-identifier\" header field parameter as additional information in the P-Charging-Vector header field when generating charging information as specified in 3GPP TS 32.260 [17].\nNOTE:\tWithin the billing domain this information given within the \"fe-identifier\" header field in a final response allows the billing domain to compare the generated data records for specific IM CN subsystem functional entities with the recorded addresses/identifiers of the IM CN subsystem functionial entities themselves. Thus information can be compared and missing information can be identified.\nEach IM CN subsystem functional entity that generates charging events, includes its own address or specific IM CN subsystem functional entity identifier within the \"fe-addr\" element of the \"fe-identifier\" header field parameter of the P-Charging-Vector header field into the initial SIP request to be sent from own domain.\nThe last element of the operator domain stores the \"fe-identifier\" header field parameter in the P-Charging-Vector header field and removes the \"fe-identifier\" header field parameter from the P-Charging-Vector header field.\nWhen receiving the final SIP response sent back to its own domain, the last element of the operator domain deletes, if received, the \"fe-identifier\" header field parameter from the P-Charging-Vector header field, adds the stored \"fe-identifier\" and adds its own \"fe-addr\" to the \"fe-identifier\".\nEach application for which the hosting AS is generating charging events, includes the address or specific identifier of the AS within the \"as-addr\" element and the application identifier within the \"ap-id\" element of the \"fe-identifier\" header field parameter of the P-Charging-Vector header field into the initial SIP request to be sent.\nThe final SIP response sent back by the last element of the operator domain supporting the \"fe-identifier\" header field contains the list of addresses and application identifiers received within the initial SIP request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.6\tSupport of local service numbers",
                    "description": "",
                    "summary": "",
                    "text_content": "For the IM CN subsystem, the support of local service numbers is provided by an AS in the subscriber's home network as described in subclause 5.7.1.7.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.7\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.7.1\tIntroduction",
                            "text_content": "The need for support of emergency calls in the IM CN subsystem is determined by national regulatory requirements.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.2\tEmergency calls generated by a UE",
                            "text_content": "If the UE cannot detect the emergency call attempt, the UE initiates the request as per normal procedures as described in subclause 5.1.2A. Depending on network policies, for a non-roaming UE or for a roaming UE where the P-CSCF is in the same network where the UE is roaming an emergency call attempt can succeed even if the UE did not detect that an emergency session is being requested, otherwise the network rejects the request indicating to the UE that the attempt was for an emergency service.\nThe UE procedures for UE detectable emergency calls are defined in subclause 5.1.6.\nThe P-CSCF, S-CSCF, IBCF, and E-CSCF procedures for emergency service are described in subclause 5.2.10, 5.4.8, 5.10.3.2 and 5.11, respectively.\nAccess dependent aspects of emergency service (e.g. whether the access technology defines emergency bearers, emergency registration support and location provision) are defined in the access technology specific annexes for each access technology.\nThere are a number of variants within these procedures and which variant gets used depends on a number of issues. These conditions are defined more specifically in 3GPP TS 23.167 [4B] and, where appropriate, in the access technology specific annex, but are summarised as follows:\na)\tif the UE knows that it is in its own home network, then an existing registration is permitted to be used for signalling the emergency call, except where item c) applies. The access technology specific annexes define the mechanism by which home network determination is made;\nb)\tif emergency calls are permitted without security credentials (or additionally where the authentication is not possible or has failed), then the emergency call is made directly without use of any security association created by a registration, and therefore without the registration; and\nc)\twhere the access technology defines emergency bearers for the support of emergency calls, a new emergency registration is required so that these emergency bearers can be used for both signalling and media, unless an existing emergency registration exists on those emergency bearers.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.3\tEmergency calls generated by an AS",
                            "text_content": "In certain circumstances an AS can identify that a request is an emergency call. This may relate to a request received from a UE (or subscription-based business trunking), or may be a call generated by an AS on behalf of a UE as far as the IM CN subsystem operation is concerned. These applications are outside the scope of this document to define.\nProcedures in support of an AS initiating emergency calls are provided in subclause 5.7.1.14.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.4\tEmergency calls received from an enterprise network",
                            "text_content": "An IBCF can also route emergency calls received from an enterprise network (peering-based business trunking) to an E-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.5\tLocation in emergency calls",
                            "text_content": "A number of mechanisms also exist for providing location in support of emergency calls, both for routeing to a PSAP, and for use by the PSAP itself, in the IM CN subsystem:\na)\tby the inclusion by the UE of the Geolocation header field containing a location by reference or by value (see RFC 6442 [89]);\nb)\tby the inclusion by the UE of a P-Access-Network-Info header field, which contains a cell identifier or location identitifier, which is subsequently mapped, potentially by the recipient, into a real location;\nc)\tby the inclusion by the P-CSCF of a P-Access-Network-Info header field based on information supplied by either the PCRF or the NASS, and which contains a cell identifier or location identitifier, which is subsequently mapped, potentially by the recipient, into a real location;\nd)\tby the allocation of a location reference that relates to the call by the LRF. Location is then supplied to the recipient over the Le interface (see 3GPP TS 23.167 [4B] for a definition of the Le interface) along with other call information. The LRF can obtain the location from entities outside the IM CN subsystem, e.g. by the e2 interface from the NASS (see ETSI TS 283 035 [98] or from the Gateway Mobile Location Centre (GMLC); and\ne)\tby the inclusion by the S-CSCF of a P-Access-Network-Info header field based on information supplied by HSS, and which contains a location identitifier, which is subsequently mapped, potentially by the recipient, into a real location.\nMechanisms also exist for providing emergency-related information to a PSAP, in requests subsequent to routeing an initial request to a PSAP, in the IM CN subsystem:\na)\tby the inclusion by the UE of the Geolocation header field containing a location by reference or by value (see RFC 6442 [89]);\nb)\tby the inclusion by the UE of a P-Access-Network-Info header field, which contains a cell identifier or location identitifier, which is subsequently mapped, potentially by the recipient, into a real location;\nc)\tby the inclusion by the P-CSCF of a P-Access-Network-Info header field based on information supplied by either the PCRF or the NASS, and which contains a cell identifier or location identitifier, which is subsequently mapped, potentially by the recipient, into a real location;\nd)\tby the inclusion by the UE of the emergency-related information as specified in subclause 5.1.6.10;\ne)\tby the inclusion by the S-CSCF of a P-Access-Network-Info header field based on information supplied by HSS, and which contains a location identitifier, which is subsequently mapped, potentially by the recipient, into a real location; and\nf)\tby LRF requesting the location from the UE via E-CSCF as specified in subclause 5.12.3.2, subclause 5.11.4.3, subclause 5.11.4.4, subclause 5.11.5 and subclause 5.1.6.12.\nThe E-CSCF routes such a subsequent request to the PSAP using normal SIP procedures.\nNOTE 1: Mechanisms independent from SIP for providing the emergency related information to a PSAP after session setup exist and are not listed. The use of such mechanisms is not precluded.\nWhich means of providing location is used depends on local regulatory and operator requirements. One or more mechanisms can be used. Location can be subject to privacy constraints.\nNOTE 2:\tA similar variety of mechanisms also exists for normal calls, where location can be made use of by the recipient or by an intermediate AS, again subject to privacy constraints. The LRF is not involved in a normal call, but an AS can obtain location from the e2 interface from the NASS (see ETSI TS 283 035 [98] or from the Gateway Mobile Location Centre (GMLC).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.6\teCall type of emergency service",
                            "text_content": "A PSAP supporting eCall over IMS supports:\n-\treceipt of the minimum set of emergency related data (MSD) in an INVITE or INFO request;\n-\tthe EmergencyCallData.eCall.MSD Info-Package and the ability to request an updated MSD by including an \"application/EmergencyCallData.Control+xml\" MIME body part containing a \"request\" element with an \"action\" attribute set to \"send-data\" and a \"datatype\" attribute set to \"eCall.MSD\" in an INFO request as defined in RFC 8147 [244];\n-\tsending of an acknowledgement for an MSD received in an INVITE request by including, in the final response to the INVITE request, an \"application/EmergencyCallData.Control+xml\" MIME body part with an \"ack\" element containing a \"received\" attribute set to \"true\" or \"false\" and a \"ref\" attribute set to the Content-ID of the MIME body part containing the MSD sent by the UE, as defined in RFC 8147 [244];\n-\treceipt of the MSD using audio media stream encoded as described in 3GPP TS 26.267 [9C];\n-\tthe ability to request an updated MSD using audio media stream encoded as described in 3GPP TS 26.267 [9C]; and\n-\tthe ability to request an updated MSD using audio media stream encoded as described in 3GPP TS 26.267 [9C], if the remote UA modifies an IMS emergency call of the eCall type of emergency service and stops supporting the EmergencyCallData.eCall.MSD Info-Package defined in RFC 8147 [244].\nNOTE:\tThe remote UA modifies an IMS emergency call of the eCall type of emergency service and stops supporting the EmergencyCallData.eCall.MSD Info-Package defined in RFC 8147 [244] when SRVCC access transfer takes place.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.8\tTracing of signalling",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.8.1\tGeneral",
                            "text_content": "IM CN subsystem entities can log SIP signalling, for debugging or tracing purposes, as described in 3GPP TS 32.422 [17A]. Debugging of SIP signalling is configured using the 3GPP IMS service level tracing management object (MO), specified in 3GPP TS 24.323 [8K]. This management object can provide configuration data to a UE or an S-CSCF, including in a visited network. Logging always begins with the initial request that creates a dialog and ends when a pre-configured stop trigger occurs or the dialog ends, whichever occurs first, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.8.2\tTrace depth",
                            "text_content": "The depth parameter in trace control and configuration indicates which SIP requests and responses are logged. If the trace depth is \"maximum\" then all requests and responses within a dialog or standalone transaction are logged. If the trace depth is \"minimum\" then all requests and responses except for non-reliable 1xx responses (including 100 (Trying) responses) and the ACK request are logged.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.9\tOverlap signalling",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.9.1\tGeneral",
                            "text_content": "This subclause explains the overlap signalling impacts on the core entities of the IM CN subsystem.\nThe support of overlap signalling, and each of the overlap signalling method, within the IM CN subsystem, are optional and is dependent on the network policy.\nOnly one overlap signalling method shall be used within one IM CN subsystem.\nNOTE:\tInterworking between the overlap signalling methods is not specified in this release.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.9.2\tOverlap signalling methods",
                            "text_content": "The in-dialog method uses INFO requests or INVITE requests in order to transport additional digits. Before an early dialog has been established, upon reception of a 404 (Not Found) or 484 (Address Incomplete) response to an earlier INVITE request, new INVITE requests will be sent to transfer additional digits (as specified in 3GPP TS 29.163 [11B]). Once an entity establishes an early dialog, by sending a provisional response to a INVITE request, INFO requests will be sent to carry additional digits on the early dialog.\nThe message body, and associated header values, which is used to carry additional digits in INFO requests is defined in 3GPP TS 29.163 [11B].\nThe multiple-INVITE method uses INVITE requests with the same Call ID and From header in order to transport digits (as specified in 3GPP TS 29.163 [11B]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.9.3\tRouteing impacts",
                            "text_content": "If overlap dialing is supported, the IM CN subsystem needs to be configured in such a manner that erroneous routeing of INVITE requests with incomplete numbers towards others entities than the corresponding INVITE requests with full numbers is avoided, for instance towards a default destination for unknown numbers such as a PSTN. Possibly impacted nodes include the S-CSCF for the UE-originated case, the transit routeing function, the I-CSCF, and application servers.\nA misrouteing can be avoided by configuring the entity sending overlap signalling in such a manner that it will send the first INVITE request with a sufficient number of digits to find a suitable entry in the translation database. If ENUM is used, the ENUM database in a typical deployment contains sufficient information about the first digits, as required to identify the destination IP domain. Therefore, ENUM is able to handle incomplete numbers in such deployments. As another alternative, the routeing entity can reject calls with unknown numbers with a 404 (Not Found) response, using entries in the routeing database to identify calls towards the PSTN. The S-CSCF for the UE-originated case could also forward calls with unknown numbers to the BGCF, if the BGCF is configured to reject calls to unknown destinations with a 404 (Not Found) response.\nIf the multiple-INVITE method is used for overlap signalling, if an entity receives a INVITE request outside an existing dialog with the same Call ID and From header field as a previous INVITE request during a certain period of time, the entity shall route the new INVITE request to the same next hop as the previous INVITE request.\nNOTE:\tINVITE requests with the same Call ID and From header fields received in sequence during a certain period of time belong to the same call. The routeing towards the same next hop could be achieved by an appropriately configured database or by the entity comparing the Call ID and From header fields of each INVITE request outside an existing dialog with Call IDs and \"tag\" From header field parameters of previous INVITE requests. If the entity compares the Call ID and From header field, it stores the information about received Call ID and From header fields at least for a time in the order of call setup times. If paths have been established at registration time, deterministic routeing will be automatic for entities on these paths.\nEntities performing routeing decicisions may require additional digits for a decision where to route an INVITE request. These entities may interact with a routeing database to reach this decision.\nIf no suitable entry in a database is found for the digits received in a INVITE request, an entity can reject the INVITE request with a 404 (Not Found) or 484 (Address Incomplete) response. This method of digit collection can be performed by a SIP proxy and is suitable both for the in-dialog and multiple-INVITE overlap signalling methods. Replying with a 404 (Not Found) response avoids the need to keep apart uncomplete and unknown numbers. The 484 (Address Incomplete) response requires the recognition of incomplete numbers.\nNOTE:\tAn HSS does not support the recognition of incomplete numbers. A routeing database being queried by ENUM also does not support the recognition of incomplete numbers.\nAs an alternative for the in-dialogue method, the digit collection function described in annex N.2 may be invoked. It shall be performed by an entity acting as a B2BUA. The digit collection function requires the ability to recognise incomplete number.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.10\tDialog correlation for IM CN subsystems",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.10.1\tGeneral",
                            "text_content": "The Call-ID header field in combination with the tags in the From header field and in the To header field is the standard mechanism to identify SIP messages which belong to the same dialog. However the Call-ID header field is often changed by B2BUAs and other SIP intermediaries in the end-to-end message path.\nTo solve this problem, a Session-ID header field containing a globally unique session identifier, as defined in RFC 7989 [162], can be used to correlate SIP messages belonging to the same session. In the case of a concatenation of dialogs, the dialog correlation mechanism indicates that these dialogs belong to the same session.\nThe usage of the Session-ID header field is specified in annex A.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.10.2\tCONF usage",
                            "text_content": "In case of the activation of a 3PTY conference, in the INVITE request to the CONF AS the Session-ID header field is added to the URIs in the  list, in order to indicate the dialogs which are to be included to the 3PTY conference at the CONF AS, as described in 3GPP TS 24.147 [8B].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.11\tPriority mechanisms",
                    "description": "",
                    "summary": "",
                    "text_content": "In support of priority, the IM CN subsystem uses the mechanisms of RFC 4412 [116]. The request for prioritisation of a transaction / dialog may, for some deployments, be marked with the Resource-Priority header field by the UE. For other deployments, the request is not marked for priority by the UE, but the request is instead identified as a priority request and marked for priority (via a Resource-Priority header field) by a functional entity (e.g., P-CSCF) within the network. Subsequent to successful authorisation at an authorisation point (e.g. AS), request is considered to be authorised.\nThe characteristics of any priority scheme is defined by the namespace that is used. This determines how priority is applied to the SIP signalling, to the bearer carrying the SIP signalling, and to the bearers carrying any media. Different priority levels exist within each namespace. Priority levels in one namespace have no relationship to the priority levels in any other namespace, i.e. priority level \"1\" in namespace \"A\" may have an entirely different level and characteristic of priority treatment to an identically labelled priority level \"1\" in namespace \"B\".\nA network can support multiple namespaces. It is up to the network operator (potentially based on regulatory or contractural obligations) to define the relationship between the priority mechanisms for each namespace, and indeed with calls that are not given any priority. It is normal that prioritised calls do not have access to 100% of any available resource and indeed are limited to a much lower figure. Priority is optional, and this document places no requirement on a conformant IM CN subsystem implementation to support priority, or indeed any namespace in a priority scheme. Regulators can however place their own requirements on an operator. Emergency transactions or dialogs (see subclause 4.7) can also have their own priority scheme.\nRFC 4412 [116] specifies several resource priority namespaces. For example, certain national  implementations use resource priority namespaces of  (Emergency Telecommunications Service) and  (Wireless Priority Service).\nSeveral ways of using priority exist, depending on the authorisation mechanism adopted. These are identified as follows. In each of these authorisation means authorisation to use the service, the namespace, and the priority level within that namespace:\n1)\tAuthorisation based on subscription in the IM CN subsystem only, priority requested by the UE using the Resource Priority header field. Whether the user is allowed to use priority or not, and the appropriate namespace and priority levels, is stored as part of the user profile in the HSS. As part of the reg event package subscription, this information is given to the P-CSCF when the contact information for any public user identity changes, and based on this information, the P-CSCF acts as the authorisation point for priority on individual requests. At the P-CSCF, when a Resource-Priority header field is received from the UE, if the requested priority equates to a value (namespace and priority level) that the P-CSCF knows is allowed for that public user identity, the priority is authorised.\n2)\tAuthorisation based on a database deployed by an AS; priority requested by the UE using a special dialstring. In this case the user requires no priority subscription information in the HSS. Specific dialstrings are configured in the P-CSCF. When a request is received from the UE by the P-CSCF, if the request contains a specific dialstring that is recognised by the P-CSCF as being eligible for priority treatment, the request is marked for temporary priority, subject to subsequent authorisation by an authorisation point (i.e., AS). And all such requests are routed to an AS. Final authorisation is granted by the AS, based on a PIN or password exchange with the UE. Subsequent requests or responses after authorisation are only given priority by the P-CSCF and S-CSCF if some backwards indication is received for that specific dialog. The definition of this backwards indication is outside the scope of this document (because non-standardised mechanisms have already been implemented in association with this approach).\n3)\tAuthorisation based on subscription in the IM CN subsystem and on a database deployed by an AS; priority requested by the UE using a special dialstring. Specific dialstrings are configured in the P-CSCF. When a request is received from the UE by the P-CSCF, if the request contains a specific dialstring that is recognised by the P-CSCF as being eligible for priority treatment, the request is marked for temporary priority, subject to subsequent authorisation by an authorisation point (i.e., AS). Based on iFC functionality that exists at the S-CSCF (from the users subscription in the HSS), such requests are routed to an AS. Final authorisation is granted by the AS, based on a PIN or password exchange with the UE or based on user profile. Subsequent requests or responses after authorisation are only given priority by the P-CSCF and S-CSCF if some backwards indication is received for that specific dialog. The definition of this backwards indication is outside the scope of this document (because non-standardised mechanisms have already been implemented in association with this approach).\nSome administrations can require the use of multiple approaches in the same network.\nFor the cases of interworking with other networks, where the P-CSCF of the other network does not support priority, but it is intended or required to give users of that P-CSCF priority in the home network, provision is made for recognition of dialstrings by the IBCF and the S-CSCF. In such scenarios, when the IBCF or S-CSCF recognize that a request contains a dialstring as being eligible for priority treatment, the request is marked by the IBCF or S-CSCF for temporary priority, subject to subsequent authorisation by an authorisation point (i.e. AS). This mechanism does not have an impact on the network where the P-CSCF resides.\nWhere the network has a requirement to prioritise emergency calls, it can either perform this function by the use of the \"esnet\" namespace in the Resource-Priority header field (as defined in RFC 7135 [197]), or by recognition of the presence of the service URN relating to an emergency. Where the Resource-Priority header field is used for this purpose, it is inserted by the entity identifying the emergency call, i.e. the P-CSCF or the IBCF. There is no usage of this namespace from the UE, and when this namespace is used, the trust domain implementation is set to remove it if it occurs from the UE.\nWhere a network has requirements on attestation and signing of priority IMS sessions (e.g., MPS sessions) the Priority verification using assertion of priority information feature described in subclause 3.1 shall be supported and the Calling number verification using signature verification and attestation information feature described in subclause 3.1 may be supported.\nWhere the network has requirements on attestation and signing of originating calling identification information for emergency and emergency callback IMS sessions, and on authentication of a Resource-Priority header field and a header field value \"psap-callback\" of a Priority header field, Calling number verification using signature verification and attestation information and Priority verification using assertion of priority information features described in subclause 3.1 shall be supported.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.12\tOverload control",
                    "description": "",
                    "summary": "",
                    "text_content": "Usage of overload control is independent of the nature of any SIP using entity, i.e. there are no specific requirements for any particular IMS functional entity implementing SIP. The capability however is not extended to the UE except when performing the function of an externally attached network.\nTwo mechanisms are defined as follows:\n-\ta feedback based mechanism defined in RFC 7339 [199], where the feedback is given in the Via header field of signalling messages supporting the traffic. RFC 7339 [199] also defines the default algorithm for usage of the feedback based mechanism in the IM CN subsystem (i.e. loss-based algorithm). Additional algorithms are either already defined, e.g. the rate-based scheme defined in RFC 7415 [200] or can also be defined in the future. As it is carried in the Via header fields the nature of the mechanism is hop by hop.\n-\tan event package for distributing load filters defined in RFC 7200 [201], which can be either used in a hop-by-hop manner between adjacent entities in a similar manner to the feedback based mechanism, or can be used on a wider basis across the network, subject to the restrictions given in annex A. In this manner it can be used to address expected overload situations, e.g. for voting calls initiated by a specific television programme.\nWhen the load filters based mechanism is used in the IMS, the default algorithm is loss-based (i.e. the filter specifies the relative percentage of incoming requests that can be accepted).\nThe S-CSCF, application servers and entities that implement the additional routeing capability can use both mechanisms in parallel on the same interfaces.\nThere are no specific reasons why one protocol mechanism should be specified over another, although some discussion is given in the documents specifying the mechanisms themselves. It is regarded as a deployment issue as to which mechanisms are supported, and which algorithms are supported within those mechanisms, beyond those that the mechanisms themselves identify as mandatory. An operator will need to take a network wide view to planning their overload control strategy, it cannot be performed on ad-hoc basis as nodes are deployed.\nFor the distribution of load filters mechanism, typical deployments might include an S-CSCF subscribing to the load control event package at an AS, an AS subscribing to the load control event package at an AS, and an entity hosting additional routeing capabilities as specified in subclause I.3 subscribing to the load-control event package at the AS.\nBased on regional/national requirements and network operator policy, priority calls (e.g., multimedia priority service) are exempted from SIP overload controls up to the point where further exemption would cause network instability. Therefore, SIP messages related to priority calls have the highest priority, and are last to be dropped or rejected, when an IM CN subsystem functional entity decides it is necessary to apply traffic reduction. The interaction between SIP overload control and priority services is covered in RFC 7339 [199] and RFC 7200 [201].\nBased on regional/national requirements and network operator policy, emergency calls are exempted from SIP overload controls up to a configured threshold. Therefore, when an IM CN subsystem functional entity decides it is necessary to apply traffic reduction due to overload control, SIP messages related to emergency calls are not dropped while the configured threshold regarding the amount of the ongoing emergency calls is not reached.\nMid-dialog SIP messages have higher priority with regard to initial SIP requests, and therefore are last to be dropped or rejected, when an IM CN subsystem functional entity decides it is necessary to apply traffic reduction due to overload control.\nOperation between two network operators is supported. If two network operators wish to implement overload control, it is a matter for bilateral agreement as to what is supported.\nOperation with enterprise networks is supported. The network operator and the enterprise operator will need to agree on the overload control options to be supported.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.13\tII-NNI traversal scenario",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.13.1\tGeneral",
                            "text_content": "Within the IM CN subsystem, the signalling path between a calling user and a called user can be divided into one or more traffic legs, referred to as II-NNI traversal scenarios. Each II-NNI traversal scenario can span networks belonging to different operators and will have its own characteristics that can be different from other II-NNI traversal scenarios in the same call.\nDialog creating SIP requests and standalone requests can contain an \"iotl\" SIP  parameter as specified in RFC 7549 [225] in a Request- or in one or more Route header fields. The \"iotl\" SIP  parameter is appended to the  representing the end of the II-NNI traversal scenario. The value of \"iotl\" SIP  parameter can be used to identify the II-NNI traversal scenario.\nIf the \"iotl\" SIP  parameter is not included in a dialog creating SIP requests or a standalone request, the II-NNI traversal scenario type can be determined by analysing the content of the SIP request or using a default II-NNI traversal scenario type.\nNOTE:\tHow the content of the SIP request can be used to determine the II-NNI traversal scenario is implementation dependent and outside the scope of this specification.\nThe \"iotl\" SIP  parameter is included by the start of the II-NNI traversal scenario (e.g. P-CSCF, S-CSCF, BGCF or  AS) and removed by the end of the II-NNI traversal scenario (e.g. S-CSCF, TRF or P-CSCF).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.13.2\tIdentifying the II-NNI traversal scenario",
                            "text_content": "The \"iotl\" SIP  parameter specified in RFC 7549 [225] containing traffic leg information can be used to identify the II-NNI traversal scenario type. The II-NNI traversal scenario type can be used by intermediary entities (e.g. IBCF and transit networks) to make policy decisions related to e.g. media anchoring, screening of SIP signalling, insertion of media functions (e.g. transcoder) and charging.\nOne example on how the \"iotl\" SIP  parameter is included in the Route header field by the P-CSCF in a visited network when sending a request towards the home network is shown below.\nEXAMPLE:\tRoute: <sip:ibcf-vA1.visited-A.net;lr>,<sip:home-abc@scscf-hA1.home-A.net;lr:iotl=visitedA-homeA>\nIf neither the Request- nor any of the Route header fields included in the SIP request contains the \"iotl\" SIP  parameter, the II-NNI traversal scenario type can be determined by analysing the content of the SIP request or using a default II-NNI traversal scenario type. The recommended II-NNI traversal scenario type default value is \"homeA-homeB\".\nNOTE:\tHow the content of the SIP request can be used to determine the II-NNI traversal scenario is implementation dependent and outside the scope of this specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.13.3\tSecurity aspects",
                            "text_content": "When receiving a dialog creating SIP request or a standalone SIP request from outside the trust domain the IBCF acting as an entry point removes any \"iotl\" SIP  parameter according to subclause 4.4.15 and assume the default II-NNI traversal scenario type or can use trusted elements of the SIP request to determine the II-NNI traversal scenario type.\nNOTE:\tExamples of trusted elements are protocol elements within the trust domain and protocol elements manipulated, checked or added by a previous hop secured by network domain security.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.14\tRestoration procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.14.1\tGeneral",
                            "text_content": "The present document includes optional restoration procedures for failure of P-CSCF and S-CSCF. The general mechanism is to inform the UE that one of the entities along its registration path is not working, and hence the UE needs to perform an initial registration. For systems providing access to IM CN subsystem using a GPRS IP-CAN, EPS IP-CAN or a 5GS IP-CAN, the mechanism to trigger the UE can be to use the Protocol Configuration Options IE or extended Protocol Configuration Options IE specified in 3GPP TS 24.008 [8], include an 3GPP IM CN subsystem XML body in a 504 (Server Time-out) response, or disconnect the PDN connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.14.2\tP-CSCF restoration procedures",
                            "text_content": "P-CSCF restoration procedures are implemented in the S-CSCF, the IBCF and the UE.\nWhen the UE originates a session it can detect that a P-CSCF is not reachable based on no response from the P-CSCF in which case the UE selects another P-CSCF if possible and performs a new initial registration.\nUDM/HSS or HSS based P-CSCF restoration applies to UE terminating requests where the SIP entity neighbouring the P-CSCF (S-CSCF, IBCF) can detect that a P-CSCF is not reachable. When the neighbouring entity is the S-CSCF, the S-CSCF can in this case initiate the P-CSCF restoration. The S-CSCF sends an indication to the HSS to initiate the restoration. If the terminating user is roaming, the neighbouring entity is an entry IBCF which uses the Restoration-Info header field to inform the S-CSCF about the failure in a 408 (Request Timeout) response for INVITE requests or a 504 (Server Time-out) response for non-INVITE requests and the S-CSCF can send an indication to the HSS to initiate the restoration.\nPCF or PCRF based P-CSCF restoration applies to UE terminating INVITE requests. For PCF or PCRF based P-CSCF restoration the S-CSCF uses the Restoration-Info header field to send the  in initial INVITE requests to an alternative P-CSCF. When the user is roaming, the IBCF selects an alternative P-CSCF and forwards the  of the terminating user in a Restoration-Info header field.\nRestoration can also be initiated when the P-CSCF has restarted, and lost all bindings for a particular user. In this case the P-CSCF rejects the incoming request with a 404 (Not Found) response. If the home network applies UDM/HSS or HSS based P-CSCF restoration the S-CSCF initiates the restoration procedure by sending an indication to the HSS. If PCF or PCRF based restoration is used, the S-CSCF initiate the PCF or PCRF based P-CSCF restoration procedure for the served user by including the  in a Restoration-Header field included in an initial INVITE request.\nNOTE:\tIn the rest of the present document where the \"PCRF based P-CSCF restoration\" procedure is mentioned the \"PCF based P-CSCF restoration\" procedure also applies, and where the \"HSS based P-CSCF restoration\" procedure is mentioned the \"UDM/HSS based P-CSCF restoration\" procedure also applies.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.14.3\tS-CSCF restoration procedures",
                            "text_content": "The P-CSCF can inform the UE about S-CSCF failures in a 504 (Server Time-out) response using the 3GPP IM CN subsystem XML body defined in subclause 7.6, in accordance with subclause 5.2.6.3.2A, when the P-CSCF is unable to forward a request to an S-CSCF.\nWhen the S-CSCF receives a request initiated by the served user for which the S-CSCF does not have the user profile or does not trust the data that it has (e.g. due to restart) the S-CSCF can if it fails to retrieve the data from the HSS trigger a registration by sending a 504 (Server Time-out) response using the 3GPP IM CN subsystem XML body defined in subclause 7.6 to the UE, in accordance with subclause 5.4.3.2.\nAn I-CSCF can reselect S-CSCF if the previously selected S-CSCF is not available.\nIf an IBCF acting as an entry point in the originating home network cannot forward the request the IBCF can trigger the UE to perform initial registration by including the 3GPP IM CN subsystem XML body in a 504 (Server Time-out) response, in accordance with subclause 5.10.3.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.15\tResource sharing",
                    "description": "",
                    "summary": "",
                    "text_content": "Resource sharing allows two or more sessions to use the same resources for one or more media streams in uplink, downlink or both uplink and downlink direction.\nA P-CSCF that supports resource sharing can determine that there is a potential for resource sharing based on local configuration or defer the determination of potential resource sharing to an AS in the home network.\nIf the determination of potential resource sharing is deferred to an AS in the home network:\n-\tthe P-CSCF on the originating side indicates that resource sharing is supported in the initial REGISTER request in the Resource-Share header field defined in subclause 7.2.13. The Resource-Share header field is included in the third-party REGISTER request towards the AS; and\n-\tif the \"message/sip\" MIME body in the third-party REGISTER request included the Resource-Share header field with the value \"supported\", the AS in the home network includes the Resource-Share header field containing the rules for resource sharing in responses and requests towards the P-CSCF.\nIf the rules for resource sharing are updated, the updated rule will be sent to P-CSCF in one of the sessions that share resources. The updated resource sharing rules will then be applied for all sessions that are sharing resources.\nNOTE:\tIn this release of the technical specification the UE cannot indicate support of resource sharing. However, the Resource-Share header field is not removed from requests and responses towards the UE and the UE can use the information in the header field to adapt its behaviour according to the information.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.16\tPriority sharing",
                    "description": "",
                    "summary": "",
                    "text_content": "Priority sharing allows two or more sessions with different priority to share the same bearer.\nThe determination of the use of priority sharing is deferred to an AS in the home network:\n1)\tif P-CSCF supports priority sharing and if according to local policy, the P-CSCF indicate that priority sharing is supported by including the g.3gpp.priority-share feature-capability indicator defined in subclause 7.9A.10 in a Feature-Caps header field in the REGISTER request;\nNOTE:\tThe Feature-Caps header field with the g.3gpp.priority-share feature-capability indicator is included in the \"message/sip\" MIME body in the third-party REGISTER request sent over the ISC interface.\n2)\tif the \"message/sip\" MIME body in the third-party REGISTER request included the g.3gpp.priority-share feature-capability indicator and:\na)\tif the AS determined to enable priority sharing, the AS includes the Priority-Share header field with a value \"allowed\" in a request or response sent towards the P-CSCF; or\nb)\tif the AS determined to disable priority sharing, the AS includes the Priority-Share header field with a value \"not-allowed\" in a request or response sent towards the P-CSCF.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.17\t3GPP PS data off",
                    "description": "",
                    "summary": "",
                    "text_content": "The UE and the network can support the 3GPP PS data off.\nWhen 3GPP PS data off is supported and active, IP packets that are associated with services that are not a 3GPP PS data off exempt service are prevented from transport over EPS IP-CAN, GPRS IP-CAN and 5GS IP-CAN as specified in 3GPP TS 23.228 [7]. The UE may be configured by the HPLMN, the EHPLMN or the subscribed SNPN with up to two indications whether a 3GPP IMS service is a 3GPP PS Data Off exempt service, one indication is valid when the UE is in the HPLMN, the EHPLMN, or a subscribed SNPN and the other indication is valid when the UE is in the VPLMN or, if the UE supports access to an SNPN using credentials from a CH, a non-subscribed SNPN. When the UE is only configured with the indication valid for the UE camping in HPLMN the EHPLMN or a subscribed SNPN, the UE shall use this indication also when the UE is in the VPLMN or the non-subscribed SNPN.\nWhen 3GPP PS data off is supported and active and the UE is configured, either as specified in 3GPP TS 24.167 [8G] or in 3GPP TS 31.102 [15C], with services that are 3GPP PS data off exempt, then the UE will not send uplink IP packets related to any services that are not 3GPP PS data off exempt over EPS IP-CAN, GPRS IP-CAN and 5GS IP-CAN. The UE informs the network about its 3GPP PS data off status by including a g.3gpp.ps-data-off media feature tag specified in subclauce 7.9.8 in all REGISTER requests sent over GPRS IP-CAN, EPS IP-CAN or 5GS IP-CAN. The UE reregisters over EPS IP-CAN, GPRS IP-CAN and 5GS IP-CAN every time the 3GPP PS data off status is changed or the UE is provided by the network with a new list of 3GPP PS data off exempt services while the 3GPP PS data off status is \"active\".\nAn AS handling a service is configured with information whether the service is a 3GPP PS data off exempt service. If the 3GPP PS data off status is active and the service is not a 3GPP PS data off exempt service, the AS prevents downlink IP packets of the service from reaching the UE over EPS IP-CAN, GPRS IP-CAN and 5GS IP-CAN. The AS shall be configured with up to two indications whether a 3GPP IMS service is a 3GPP PS Data Off exempt service, one indication is valid for non-roaming users, and the other indication is valid for users roaming in the various VPLMNs with whom roaming agreements exist or users accessing non-subscribed SNPNs. When the AS is only configured with the indication valid for the UE camping in the HPLMN, the EHPLMN or the subscribed SNPN, the AS shall use this indication also when the UE is in the VPLMN or non-subscribed SNPN.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.18\tDynamic Service Interaction",
                    "description": "",
                    "summary": "",
                    "text_content": "Dynamic Service Interaction allows that different ASs involved in the same IMS session (within an operator network or across networks) exchange information about executed services to avoid conflicting interactions between these services. Dynamic Service Interaction information is included in a SIP header field Service-Interact-Info defined in subclause 7.2.14.\nIf an AS which supports dynamic service interaction:\n-\tprovides one or more services:\na)\tthe AS inserts in a SIP message the Service-Interact-Info header field with the identities of the services which have been performed; and\nb)\tif the AS identified services which should be further avoided the AS adds the identities of those services in the Service-Interact-Info header field; and\n-\treceives a SIP message containing the Service-Interact-Info header field, the AS takes the received Service-Interact-Info header field information into account as described in subclause 7.2.14.3.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.19\tRestricted Local Operator Services",
                    "description": "",
                    "summary": "",
                    "text_content": "The UE and the network can support Restricted Local Operator Services (RLOS).\nRLOS services are operator defined services that are offered to UEs when using an EPS IP-CAN as specified in annex L in the following scenarios:\n-\tUE is successfully registered using IMS AKA or GPRS-IMS bundled authentication; or\n-\tUE has attempted to register and the registration is rejected from the network with a 403 (Forbidden) response.\nRLOS services are offered only for the UE-originating case.\nRLOS services can be offered to an operator's own subscribers and roaming subscribers.\n4.20\tIMS data channel\nThe UE and the network can support the IMS data channel procedures as specified in 3GPP TS 23.228 [7] and 3GPP TS 24.186 [297].\nIMS data channels are always associated with MMTEL sessions.\nNOTE:  In this release of the specification, a standalone IMS data channel without accompanying MMTEL voice and/or video call is not supported.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "5\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.1.0\tGeneral",
                            "text_content": "The UE procedures for UE detectable emergency calls are defined in subclause 5.1.6. Exceptions to UE procedures for SIP that do not relate to emergency, are documented in subclause 5.1.6 and shall apply. These exceptions include handling of a response to a request not detected by the UE as relating to an emergency.\nWhen sending a failure response to any received request, depending on operator policy, the UE may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"ue\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17. A UE when sending a failure response will add in the URN the \"side\" header field parameter set to:\n-\t\"orig\" for a UE-originating case; and\n-\t\"term\" for a UE-terminating case.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.1\tRegistration and authentication",
                            "text_content": "The UE shall register public user identities (see table A.4/1 and dependencies on that major capability).\nNOTE 1:\tThe UE can use multiple Contact header field values simultaneously containing the same IP address and port number in the contact address.\nIn case a UE registers several public user identities at different points in time, the procedures to reregister, deregister and subscribe to the registration-state event package for these public user identities can remain uncoordinated in time.\nThe UE can register any one of its public user identities with any IP address acquired by the UE. The same public user identity can be bound to more than one IP address of the UE. While having valid registrations of previously registered public user identities, the UE can register any additional public user identity with any of its IP addresses. When binding any one of its public user identities to an additional contact address, the UE shall follow the procedures described in RFC 5626 [92].\nIf SIP digest without  is used, the UE shall not include signalling plane security mechanisms in the header fields defined in RFC 3329 [48] in any SIP messages.\nNOTE 2:\tThe UE determines if SIP digest is used with or without  based on device configuration. If SIP digest with  is used, then the UE includes the  signalling plane security mechanism in the header fields defined in RFC 3329 [48] as described in subclause 5.1.1.2.4.\nSIP requests that indicate security mechanisms for both the signalling plane and the media plane can contain multiple instances or a single instance of the Security-Client, Security-Verify, or Security-Server header fields defined in RFC 3329 [48].\nIn case a device performing address and/or port number conversions is provided by a (P)T or (P)T-PT, the UE may need to modify the SIP contents according to the procedures described in either annex F or annex K.\nNOTE 3:\tIf UE populates the display-name of the Contact header field included in the REGISTER request with UE name, other UEs of the user can discover the UE name of the UE in the reg event package notification. The UE name is a text string chosen by the user allowing the user to distinguish individual UEs of the same user.\nThis subclause applies when a UE contains either an ISIM or a USIM.\nThe ISIM shall always be used for authentication to the IM CN subsystem, if it is present, as described in 3GPP TS 33.203 [19].\nThe ISIM is preconfigured with all the necessary parameters to initiate the registration to the IM CN subsystem. These parameters include:\n-\tthe private user identity;\n-\tone or more public user identities; and\n-\tthe home network domain name used to address the SIP REGISTER request\nThe first public user identity in the list stored in the ISIM is used in emergency registration requests.\nIn case the UE does not contain an ISIM, the UE shall:\n-\tgenerate a private user identity;\n-\tgenerate a temporary public user identity; and\n-\tgenerate a home network domain name to address the SIP REGISTER request to;\nin accordance with the procedures in clause C.2.\nThe temporary public user identity is only used in REGISTER requests, i.e. initial registration, re-registration, UE-initiated deregistration.\nThe UE shall not reveal to the user the temporary public user identity if the temporary public user identity is barred. The temporary public user identity is not barred if received by the UE in the P-Associated- header field.\nIf the UE is unable to derive the parameters in this subclause for any reason, then the UE shall not proceed with the request associated with the use of these parameters and will not be able to register to the IM CN subsystem.\nIn case the UE contains neither an ISIM nor a USIM, but  is present the UE shall use preconfigured parameters in the  to initiate the registration to the IM CN subsystem and for authentication.\nThe following IMS parameters are assumed to be available to the UE:\n-\ta private user identity;\n-\ta public user identity; and\n-\ta home network domain name to address the SIP REGISTER request to.\nThese parameters may not necessarily reside in a UICC.\nThe first public user identity in the list stored in the  is used in emergency registration requests.\nIf the UE contains neither ISIM, nor USIM nor , the UE shall generate a temporary public user identity, a private user identity and a home network domain name to address the SIP REGISTER request to, according 3GPP TS 23.003 [3].\nThe initial registration procedure consists of the UE sending an unprotected REGISTER request and, if challenged depending on the security mechanism supported for this UE, sending the integrity-protected REGISTER request or other appropriate response to the challenge. The UE can register a public user identity with any of its contact addresses at any time after it has acquired an IP address, discovered a P-CSCF, and established an IP-CAN bearer that can be used for SIP signalling. However, the UE shall only initiate a new registration procedure when it has received a final response from the registrar for the ongoing registration, or the previous REGISTER request has timed out.\nWhen registering any public user identity belonging to the UE, the UE shall either use an already active pair of security associations or a  session to protect the REGISTER requests, or register the public user identity via a new initial registration procedure.\nWhen binding any one of its public user identities to an additional contact address via a new initial registration procedure, the UE shall follow the procedures described in RFC 5626 [92]. The set of security associations or a  session resulting from this initial registration procedure will have no impact on the existing set of security associations or  sessions that have been established as a result of previous initial registration procedures. However, if the UE registers any one of its public user identities with a new contact address via a new initial registration procedure and does not employ the procedures described in RFC 5626 [92], then the new set of security associations or  session shall replace any existing set of security association or  session.\nIf the UE detects that the existing security associations or  sessions associated with a given contact address are no longer active (e.g., after receiving no response to several protected messages), the UE shall:\n-\tconsider all previously registered public user identities bound to this security associations or  session that are only associated with this contact address as deregistered; and\n-\tstop processing all associated ongoing dialogs and transactions that were using the security associations or  session associated with this contact address, if any (i.e. no further SIP signalling will be sent by the UE on behalf of these transactions or dialogs).\nThe UE shall send the unprotected REGISTER requests to the port advertised to the UE during the P-CSCF discovery procedure. If the UE does not receive any specific port information during the P-CSCF discovery procedure, or if the UE was pre-configured with the P-CSCF's IP address or domain name and was unable to obtain specific port information, the UE shall send the unprotected REGISTER request to the SIP default port values as specified in RFC 3261 [26].\nNOTE 1:\tThe UE will only send further registration and subsequent SIP messages towards the same port of the P-CSCF for security mechanisms that do not require to use negotiated ports for exchanging protected messages.\nThe UE shall extract or derive a public user identity, the private user identity, and the domain name to be used in the Request- in the registration, according to the procedures described in subclause 5.1.1.1A or subclause 5.1.1.1B. A public user identity may be input by the end user.\nOn sending an unprotected REGISTER request, the UE shall populate the header fields as follows:\na)\ta From header field set to the SIP  that contains:\n1)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, the main  of the UE; else\n2)\tthe public user identity to be registered;\nb)\ta To header field set to the SIP  that contains:\n1)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, the main  of the UE; else\n2)\tthe public user identity to be registered;\nc)\ta Contact header field set to include SIP (s) containing the IP address or FQDN of the UE in the hostport parameter. If the UE:\n1)\tsupports GRUU (see table A.4, item A.4/53);\n2)\tsupports multiple registrations;\n3)\thas an IMEI available; or\n4)\thas an MEID available;\nthe UE shall include a \"+sip.instance\" header field parameter containing the instance ID. Only the IMEI shall be used for generating an instance ID for a multi-mode UE that supports both 3GPP and 3GPP2 defined radio access networks.\nNOTE 2:\tThe requirement placed on the UE to include an instance ID based on the IMEI or the MEID when the UE does not support GRUU and does not support multiple registrations does not imply any additional requirements on the network.\nIf the UE supports multiple registrations it shall include a \"reg-id\" header field parameter as described in RFC 5626 [92].\nThe UE shall include all supported ICSI values (coded as specified in subclause 7.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 and RFC 3840 [62] for the IMS communication services it intends to use, and IARI values (coded as specified in subclause 7.2A.9.2), for the IMS applications it intends to use in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3840 [62].\nThe UE shall include the media feature tags defined in RFC 3840 [62] and RFC 5688 [120] for all supported streaming media types.\nIf the UE supports RFC 6140 [191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Contact  without a user portion and containing the \"bnc\"  parameter.\nIf the UE has no specific reason not to include a user part in the URI of the contact address (eg. some UE performing the functions of an external attached network), the UE should include a user part in the URI of the contact address such that the user part is globally unique and does not reveal any private information;\nNOTE 3:\tA time-based UUID (Universal Unique Identifier) generated as per subclause 4.2 of RFC 4122 [154] is globally unique and does not reveal any private information.\nd)\ta Via header field set to include the sent-by field containing the IP address or FQDN of the UE and the port number where the UE expects to receive the response to this request when UDP is used. For , the response is received on the  connection on which the request was sent. For the UDP, the UE shall also include a \"rport\" header field parameter with no value in the Via header field. Unless the UE has been configured to not send keep-alives, and unless the UE is directly connected to an IP-CAN for which usage of  is not defined, it shall include a \"keep\" header field parameter with no value in the Via header field, in order to indicate support of sending keep-alives associated with the registration, as described in RFC 6223 [143];\nNOTE 4:\tWhen sending the unprotected REGISTER request using UDP, the UE transmit the request from the same IP address and port on which it expects to receive the response to this request.\ne)\ta registration expiration interval value of 600 000 seconds as the value desired for the duration of the registration;\nNOTE 5:\tThe registrar (S-CSCF) might decrease the duration of the registration in accordance with network policy. Registration attempts with a registration period of less than a predefined minimum value defined in the registrar will be rejected with a 423 (Interval Too Brief) response.\nf)\ta Request- set to the SIP  of the domain name of the home network used to address the REGISTER request;\ng)\tthe Supported header field containing the option-tag \"path\", and\n1)\tif GRUU is supported, the option-tag \"gruu\"; and\n2)\tif multiple registrations is supported, the option-tag \"outbound\".\nh)\tif a security association or  session exists, and if available to the UE (as defined in the access technology specific annexes for each access technology), a P-Access-Network-Info header field set as specified for the access network technology (see subclause 7.2A.4);\ni)\ta Security-Client header field to announce the media plane security mechanisms the UE supports, if any, labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7;\nNOTE 6:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\nj)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Require header field containing the option-tag \"gin\"; and\nk)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Proxy-Require header field containing the option-tag \"gin\".\nOn receiving a 401 (Unauthorized) response to the REGISTER request, the UE shall:\na)\tif available, store the announcement of media plane security mechanisms the P-CSCF (IMS-) supports labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7 and received in the Security-Server header field, if any. Once the UE chooses a media security mechanism from the list received in the Security-Server header field from the server, the UE may initiate that mechanism on a media level when it initiates new media in an existing session.\nNOTE 7:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\nOn receiving the 200 (OK) response to the REGISTER request, the UE shall:\na)\tstore the expiration time of the registration for the public user identities found in the To header field value and bind it either to the respective contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used);\nNOTE 8:\tIf the UE supports RFC 6140 [191] and performs the functions of an external attached network, the To header field will contain the main  of the UE.\nb)\tstore as the default public user identity the first  on the list of URIs present in the P-Associated- header field and bind it to the respective contact address of the UE and the associated set of security associations or  session;\nNOTE 9:\tWhen using the respective contact address and associated set of security associations or  session, the UE can utilize additional URIs contained in the P-Associated- header field and bound it to the respective contact address of the UE and the associated set of security associations or  session, e.g. for application purposes.\nc)\ttreat the identity under registration as a barred public user identity, if it is not included in the P-Associated- header field;\nd)\tstore the list of service route values contained in the Service-Route header field and bind the list either to the contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used), and the associated set of security associations or  session over which the REGISTER request was sent;\nNOTE 10:\tWhen multiple registration mechanism is not used, there will be only one list of service route values bound to a contact address. However, when multiple registration mechanism is used, there will be different list of service route values bound to each registration flow and the associated contact address.\nNOTE 11:\tThe UE will use the stored list of service route values to build a proper preloaded Route header field for new dialogs and standalone transactions (other than REGISTER method) when using either the respective contact address or the registration flow and the associated contact address (if the multiple registration mechanism is used), and the associated set of security associations or  session.\ne)\tif the UE indicated support for GRUU in the Supported header field of the REGISTER request then:\n-\tif the UE did not use the procedures specified in RFC 6140 [191] for registration, find the Contact header field within the response that matches the one included in the REGISTER request. If this contains a \"pub-gruu\" header field parameter or a \"temp-gruu\" header field parameter or both, then store the value of those parameters as the GRUUs for the UE in association with the public user identity and the contact address that was registered; and\n-\tif the UE used the procedures specified in RFC 6140 [191] for registration then find the Contact header field within the response that matches the one included in the REGISTER request. If this contains a \"pub-gruu\" header field parameter then store the value of the \"pub-gruu\" header field parameter for use for generating public GRUUs for registering UAs as specified in RFC 6140 [191]. If this contains a \"temp-gruu-cookie\" header field parameter then store the value of the \"temp-gruu-cookie\" header field parameter for use for generating temporary GRUUs for registering UAs as specified in RFC 6140 [191];\nNOTE 12:\tWhen allocating public GRUUs to registering UAs the functionality within the UE that performs the role of registrar will add an \"sg\" SIP  parameter that uniquenly identifies that UA to the public GRUU it received in the \"pub-gruu\" header field parameter. The procedures for generating a temporary GRUU using the \"temp-gruu-cookie\" header field parameter are specified in subclause 7.1.2.2 of RFC 6140 [191].\nf)\tif the REGISTER request contained the \"reg-id\" and \"+sip.instance\" Contact header field parameter and the \"outbound\" option tag in a Supported header field, the UE shall check whether the option-tag \"outbound\" is present in the Require header field:\n-\tif no option-tag \"outbound\" is present, the UE shall conclude that the S-CSCF does not support the registration procedure as described in RFC 5626 [92], and the S-CSCF has followed the registration procedure as described in RFC 5627 [93] or RFC 3261 [26], i.e., if there is a previously registered contact address, the S-CSCF replaced the old contact address and associated information with the new contact address and associated information (see bullet e) above). Upon detecting that the S-CSCF does not support the registration procedure as defined in RFC 5626 [92], the UE shall refrain from registering any additional IMS flows for the same private identity as described in RFC 5626 [92]; or\nNOTE 13:\tUpon replaces the old contact address with the new contact address, the S-CSCF performs the network-initiated deregistration procedure for the previously registered public user identities and the associated old contact address as described in subclause 5.4.1.5. Hence, the UE will receive a NOTIFY request informing the UE about the deregistration of the old contact address.\n-\tif an option-tag \"outbound\" is present, the UE may establish additional IMS flows for the same private identity, as defined in RFC 5626 [92];\ng)\tif available, store the announcement of media plane security mechanisms the P-CSCF (IMS-) supports labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7 and received in the Security-Server header field, if any. Once the UE chooses a media security mechanism from the list received in the Security-Server header field from the server, it may initiate that mechanism on a media level when it initiates new media in an existing session;\nNOTE 14:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\nh)\tif the Via header field contains a \"keep\" header field parameter with a value, unless the UE detects that it is not behind a , start to send keep-alives associated with the registration towards the P-CSCF, as described in RFC 6223 [143];\ni)\tif a Feature-Caps header field, as specified in RFC 6809 [190] is received, a UE supporting the Feature-Caps header field shall consider the ICSI values received in the Feature-Caps header field of 200 (OK) response as supported by the IM subsystem for the established registration or registration flow (if the multiple registration mechanism is used);\nNOTE 15:\tThe UE and related applications can use the ICSI values received in the Feature-Caps header field of 200 (OK) response to improve the user experience.\nj)\tvoid; and\nk)\tif the 200 (OK) response includes a Feature-Caps header field, as specified in RFC 6809 [190], with a \"+g.3gpp.verstat\" header field parameter and if the UE supports calling number verification status determination, determine that the home network supports calling number verification using signature verification and attestation information, as defined in subclause 3.1.\nOn receiving a 305 (Use Proxy) response to the unprotected REGISTER request, unless otherwise specified in access specific annexes (as described in annex B, annex L or annex U), the UE shall:\na)\tignore the contents of the Contact header field if it is included in the received message;\nNOTE 16:\tThe 305 response is not expected to contain a Contact header field.\nb)\trelease all IP-CAN bearers used for the transport of media according to the procedures in subclause 9.2.2;\nc)\tinitiate either a new P-CSCF discovery procedure as described in subclause 9.2.1, or select a new P-CSCF, if the UE was pre-configured with more than one P-CSCF's IP addresses or domain names;\nd)\tselect a P-CSCF address, which is different from the previously used address, from the address list; and\ne)\tperform the procedures for initial registration as described in subclause 5.1.1.2.\nOn receiving a 423 (Interval Too Brief) response to the REGISTER request, the UE shall:\n-\tsend another REGISTER request populating the registration expiration interval value with an expiration timer of at least the value received in the Min-Expires header field of the 423 (Interval Too Brief) response.\nOn receiving a 408 (Request Timeout) response or 500 (Server Internal Error) response or 504 (Server Time-Out) or 600 (Busy Everywhere) response or 403 (Forbidden) response for an initial registration, the UE may attempt to perform initial registration again.\nWhen the timer F expires at the UE, the UE:\na)\tshall mark the currently used P-CSCF address as unavailable for the last duration of the retry delay time computed by the algorithm defined in subclause 4.5 of RFC 5626 [92] plus 5 minutes;\nb)\tif there is a locally stored P-CSCF address as specified in subclause 5.1.9 which is different from the currently used P-CSCF address and which is not marked as unavailable, may initiate an initial registration as specified in subclause 5.1.1.2 using that P-CSCF; and\nc)\tif there is no locally stored P-CSCF address as specified in subclause 5.1.9 which is different from the currently used P-CSCF address and which is not marked as unavailable, may get a new set of P-CSCF-addresses as described in subclause 9.2.1 unless otherwise specified in the access specific annexes (as described in annex B, annex L or annex U) and initiate an initial registration as specified in subclause 5.1.1.2.\nNOTE 17:\tIt is an implementation option whether these actions are also triggered by other means than expiration of timer F, e.g. based on ICMP messages.\nOn receiving a 4xx, 5xx (except 503) or 6xx response to the REGISTER request, whereby the response contains a Retry-After header field, the UE shall not automatically attempt an initial registration via the same IP-CAN and the same P-CSCF for the amount of time indicated in the Retry-After header field. If the UE is power cycled, the UE can attempt an initial registration. If no initial registration occurs within the time period indicated by the Retry-After header field, the counter of unsuccessful initial registration attempts is reset.\nOn receiving a 503 response with a Retry-After header field to the REGISTER request and the Retry-After header field indicates time bigger than the value for timer F as specified in table 7.7.1, the UE:\na)\tshall mark the currently used P-CSCF address as unavailable for the time indicated by the Retry-After header field;\nb)\tif there is a locally stored P-CSCF address as specified in subclause 5.1.9 which is different from the currently used P-CSCF address and which is not marked as unavailable, may initiate an initial registration as specified in subclause 5.1.1.2 using that P-CSCF; and\nc)\tif there is no locally stored P-CSCF address as specified in subclause 5.1.9 which is different from the currently used P-CSCF address and which is not marked as unavailable, may get a new set of P-CSCF addresses as described in subclause 9.2.1 unless otherwise specified in the access specific annexes (as described in annex B, annex L or annex U) and initiate an initial registration as specified in subclause 5.1.1.2.\nNOTE 18:\tif the Retry-After header field indicates time smaller than the value for timer F as specified in table 7.7.1, the UE continues using the currently used P-CSCF address.\nFor each 4xx, 5xx or 6xx response received without a Retry-After header field to the REGISTER request, the UE shall:\na)\tuse the mechanism defined in subclause 4.5 of RFC 5626 [92] for determination of the retry delay time before each new registration attempt;\nb) \tmark the currently used P-CSCF address as unavailable for the last duration of the retry delay time computed by the algorithm defined in subclause 4.5 of RFC 5626 [92] plus 5 minutes; and\nc)\tinitiate an initial registration as specified in subclause 5.1.1.2 after the amount of time of the last retry delay time computed by the algorithm defined in subclause 4.5 of RFC 5626 [92]; and\n-\tif there is a locally stored P-CSCF address as specified in subclause 5.1.9 which is different from the currently used P-CSCF address and which is not marked as unavailable, may initiate the initial registration using that P-CSCF; and\n-\tif there is no locally stored P-CSCF address as specified in subclause 5.1.9 which is different from the currently used P-CSCF address and which is not marked as unavailable, may get a new set of P-CSCF addresses as described in subclause 9.2.1 unless otherwise specified in the access specific annexes (as described in annex B, annex L or annex U) and initiate the initial registration as specified in subclause 5.1.1.2.\nThe values of max-time and base-time (if all failed) may be provided by the network to the UE with the management objects specified in 3GPP TS 24.167 [8G]. If no values of the parameters max-time and base-time (if all failed) have been provided to the UE by the network, the default values defined in subclause 4.5 of RFC 5626 [92] shall be used. Other mechanisms may be used as well and are outside the scope of the present document.\nNOTE 19:\tIf the UE stops initiating initial registration, the UE can attempt to perform initial registration with the network again based on the local configuration and not wait till power-cycled. The local configuration is outside the scope of this specification.\nOn sending a REGISTER request, as defined in subclause 5.1.1.2.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field, with:\n-\tthe \"username\" header field parameter, set to the value of the private user identity;\n-\tthe \"realm\" header field parameter, set to the domain name of the home network;\n-\tthe \"uri\" header field parameter, set to the SIP  of the domain name of the home network;\n-\tthe \"nonce\" header field parameter, set to an empty value; and\n-\tthe \"response\" header field parameter, set to an empty value;\nNOTE 1:\tIf the UE specifies its FQDN in the hostport parameter in the Contact header field and in the sent-by field in the Via header field, then it has to ensure that the given FQDN will resolve (e.g., by reverse DNS lookup) to the IP address that is bound to the security association.\nNOTE 2:\tThe UE associates two ports, a protected client port and a protected server port, with each pair of security association. For details on the selection of the port values see 3GPP TS 33.203 [19].\nb)\tadditionally for the Contact header field, if the REGISTER request is protected by a security association, include the protected server port value in the hostport parameter;\nc)\tadditionally for the Via header field, for UDP, if the REGISTER request is protected by a security association, include the protected server port value in the sent-by field; and\nd)\ta Security-Client header field set to specify the signalling plane security mechanism the UE supports, the IPsec layer algorithms the UE supports and the parameters needed for the security association setup. The UE shall support the setup of two pairs of security associations as defined in 3GPP TS 33.203 [19]. The syntax of the parameters needed for the security association setup is specified in annex H of 3GPP TS 33.203 [19]. The UE shall support the \"ipsec-3gpp\" security mechanism, as specified in RFC 3329 [48]. The UE shall support the IPsec layer algorithms for integrity and confidentiality protection as defined in 3GPP TS 33.203 [19], and shall announce support for them according to the procedures defined in RFC 3329 [48].\nOn receiving the 200 (OK) response to the REGISTER request defined in subclause 5.1.1.2.1, the UE shall additionally:\n1)\tIf the UE supports multiple registrations and the REGISTER request contained the \"+sip.instance\" header field parameter and the \"reg-id\" header field parameter in the Contact header field, and the \"outbound\" option-tag in the Supported header field, the UE shall check whether the option-tag \"outbound\" is present in the Require header field. If the option-tag \"outbound\" is present, then the UE shall use the bidirectional flow as defined in RFC 5626 [92] as follows:\na)\tfor UDP, the bidirectional flow consists of two unidirectional flows, i.e. the first unidirectional flow is identified with the UE's protected client port, the P-CSCF's protected server port, and the respective IP addresses. The UE uses this flow to send the requests and responses to the P-CSCF. The second unidirectional flow is identified with the P-CSCF's protected client port, the UE's protected server port and the IP addresses. The second unidirectional flow is used by the UE to receive the requests and responses from the P-CSCF; or\nb)\tfor , the bidirectional flow is the  connection between the UE and the P-CSCF. This  connection was established by the UE, i.e. from the UE's protected client port and the UE's IP address to the P-CSCF's protected server port and the P-CSCF's IP address. This  connection is used to exchange SIP messages between the UE and the P-CSCF; and\n2)\tset the security association lifetime to the longest of either the previously existing security association lifetime (if available), or the lifetime of the just completed registration plus 30 seconds.\nNOTE 3:\tIf the UE receives Authentication-Info, it will proceed as described in RFC 3310 [49] when AKAv1 is used or as described in RFC 4169 [227] when AKAv2 is used.\nWhen a 401 (Unauthorized) response to a REGISTER is received the UE shall behave as described in subclause 5.1.1.5.1.\nOn sending a REGISTER request, as defined in subclause 5.1.1.2.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field as defined in RFC 7616 [286] and RFC 8760 [287] unless otherwise specified in the access specific annexes, with:\n-\tthe \"username\" header field parameter, set to the value of the private user identity;\n-\tthe \"realm\" header field parameter, set to the domain name of the home network;\n-\tthe \"uri\" header field directive, set to the SIP  of the domain name of the home network;\n-\tthe \"nonce\" header field parameter, set to an empty value; and\n-\tthe \"response\" header field parameter, set to an empty value;\nb)\tthe hostport parameter in the Contact header field with the port value of an unprotected port where the UE expects to receive subsequent requests; and\nc)\tthe sent-by field in the Via header field with the port value of an unprotected port where the UE expects to receive responses to the request.\nThe UE shall use the locally available public user identity, the private user identity, and the domain name to be used in the Request- in the registration. The method whereby the public user identity and private user identity are made available to the UE is outside the scope of this document (e.g. a public user identity could be input by the end user).\nWhen a 401 (Unauthorized) response to a REGISTER is received the UE shall behave as described in subclause 5.1.1.5.4.\nOn sending a REGISTER request, as defined in subclause 5.1.1.2.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field set in accordance with subclause 5.1.1.2.3 unless otherwise specified in the access specific annexes; and\nb)\ta Security-Client header field set to specify the signalling plane security mechanism the UE supports. The UE shall support the setup of a  session as defined in 3GPP TS 33.203 [19]. The UE shall support the \"tls\" security mechanism, as specified in RFC 3329 [48]. The UE shall support  for integrity and confidentiality protection as defined in RFC 3261 [26], and shall announce support for them according to the procedures defined in RFC 3329 [48].\nOn receiving the 200 (OK) response to the REGISTER request defined in subclause 5.1.1.2.1, the UE shall additionally:\na)\tset the  session lifetime to the longest of either the previously existing  session lifetime (if available), or the lifetime of the just completed registration plus 30 seconds.\nIf a UE supports , then the UE shall support  ciphersuites as described in 3GPP TS 33.203 [19].  session lifetime is determined by local configuration of the UE.\nFor SIP digest with , the UE associates a protected server port with the  session port on the UE.\nWhen a 401 (Unauthorized) response to a REGISTER is received the UE shall behave as described in subclause 5.1.1.5.6.\nOn sending a REGISTER request, as defined in subclause 5.1.1.2.1, the UE shall additionally populate the header fields as follows:\na)\toptionally, an Authorization header field, with the \"username\" header field parameter, set to the value of the private user identity;\nNOTE 1:\tIn case the Authorization header field is absent, the mechanism only supports that one public user identity is associated with only one private user identity. The public user identity is set so that it is possible to derive the private user identity from the public user identity by removing SIP  scheme and the following parts of the SIP  if present: port number,  parameters, and To header field parameters.\nOn receiving the 200 (OK) response to the REGISTER request defined in subclause 5.1.1.2.1, there are no additional requirements for the UE.\nNOTE 2:\tWhen NASS-IMS bundled authentication is in use, a 401 (Unauthorized) response to the REGISTER request is not expected to be received.\nOn sending a REGISTER request, as defined in subclause 5.1.1.2.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field as defined in RFC 7616 [286] and RFC 8760 [287] shall not be included, in order to indicate support for GPRS-IMS-Bundled authentication.\nb)\tthe Security-Client header field as defined in RFC 3329 [48] shall not contain signalling plane security mechanisms;\nc)\ta From header field set to a temporary public user identity as defined in 3GPP TS 23.003 [3], as the public user identity to be registered;\nd)\ta To header field set to a temporary public user identity as defined in 3GPP TS 23.003 [3], as the public user identity to be registered;\ne)\tthe Contact header field with the port value of an unprotected port where the UE expects to receive subsequent mid-dialog requests; and\nf)\tthe Via header field with the port value of an unprotected port where the UE expects to receive responses to the request.\nNOTE 1:\tSince the private user identity is not included in the REGISTER requests when GPRS-IMS-Bundled authentication is used for registration, reregistration and de-registration procedures, all REGISTER requests from the UE use the temporary IMPU as the public user identity even when the implicitly registered IMPUs are available at the UE. The UE does not use the temporary public user identity in any non-registration SIP requests.\nOn receiving the 200 (OK) response to the REGISTER request defined in subclause 5.1.1.2.1, there are no additional requirements for the UE.\nNOTE 2:\tWhen GPRS-IMS-Bundled authentication is in use, a 401 (Unauthorized) response to the REGISTER request is not expected to be received.\nUpon receipt of a 2xx response to the initial registration, the UE shall subscribe to the reg event package for the public user identity registered at the user's registrar (S-CSCF) as described in RFC 3680 [43] and RFC 6665 [28].\nNOTE 1:\tIf the UE supports RFC 6140 [191] and performs the functions of an external attached network, the subscription will be directed to the main , as described in RFC 6140 [191].\nThe UE shall subscribe to the reg event package upon registering a new contact address via an initial registration procedure. If the UE receives a NOTIFY request via the newly established subscription dialog and via the previously established subscription dialogs (there will be at least one), the UE may terminate the previously established subscription dialogs and keep only the newly established subscription dialog.\nThe UE shall use the default public user identity for subscription to the registration-state event package.\nNOTE 2:\tThe subscription information stored in the HSS ensures that the default public user identity is a SIP .\nOn sending a SUBSCRIBE request, the UE shall populate the header fields as follows:\na)\ta Request- set to the resource to which the UE wants to be subscribed to, i.e. to the SIP  that is the default public user identity used for subscription;\nb)\ta From header field set to the SIP  that is the default public user identity used for subscription;\nc)\ta To header field set to the SIP  that is the default public user identity used for subscription;\nd)\tan Event header field set to the \"reg\" event package;\ne)\tan Expires header field set to 600 000 seconds as the value desired for the duration of the subscription;\nf)\tvoid; and\ng)\tvoid.\nUpon receipt of a dialog establishing NOTIFY request, as specified in RFC 6665 [28], associated with the SUBSCRIBE request, the UE shall:\n1)\tstore the information for the established dialog;\n2)\tstore the expiration time as indicated in the \"expires\" header field parameter of the Subscription-State header field, if present, of the NOTIFY request. Otherwise the expiration time is retrieved from the Expires header field of the 2xx response to SUBSCRIBE request; and\n3)\tfollow the procedures specified in RFC 6665 [28].\nIf continued subscription is required, the UE shall automatically refresh the subscription to the reg event package, for a previously registered public user identity, either 600 seconds before the expiration time if the initial subscription was for greater than 1200 seconds, or when half of the time has expired if the initial subscription was for 1200 seconds or less. If a SUBSCRIBE request to refresh a subscription fails with a non-481 response, the UE shall still consider the original subscription valid for the duration of the most recently known \"Expires\" value according to RFC 6665 [28]. Otherwise, the UE shall consider the subscription invalid and start a new initial subscription according to RFC 6665 [28].\nThe UE can perform the reregistration of a previously registered public user identity bound to any one of its contact addresses and the associated set of security associations or  sessions at any time after the initial registration has been completed.\nThe UE can perform the reregistration of a previously registered public user identity over any existing set of security associations or  session that is associated with the related contact address.\nThe UE can perform the reregistration of a previously registered public user identity via an initial registration as specified in subclause 5.1.1.2, when binding the previously registered public user identity to new contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used).\nThe UE can perform registration of additional public user identities at any time after the initial registration has been completed. The UE shall perform the registration of additional public user identities either:\n-\tover the existing set of security associations or  sessions, if appropriate to the security mechanism in use, that is associated with the related contact address; or\n-\tvia an initial registration as specified in subclause 5.1.1.2.\nThe UE can fetch bindings as defined in RFC 3261 [26] at any time after the initial registration has been completed. The procedure for fetching bindings is the same as for a reregistration except that the REGISTER request does not contain a Contact header field.\nUnless either the user or the application within the UE has determined that a continued registration is not required the UE shall reregister an already registered public user identity either 600 seconds before the expiration time if the previous registration was for greater than 1200 seconds, or when half of the time has expired if the previous registration was for 1200 seconds or less, or when the UE intends to update its capabilities according to RFC 3840 [62] and RFC 5688 [120] or when the UE needs to modify the ICSI values that the UE intends to use in a g.3gpp.icsi-ref media feature tag or IARI values that the UE intends to use in the g.3gpp.iari-ref media feature tag.\nWhen sending a protected REGISTER request, the UE shall use a security association or  session associated either with the contact address or with the registration flow and the associated contact address used to send the request, see 3GPP TS 33.203 [19], established as a result of an earlier initial registration.\nThe UE shall extract or derive a public user identity, the private user identity, and the domain name to be used in the Request- in the registration, according to the procedures described in subclause 5.1.1.1A or subclause 5.1.1.1B.\nOn sending a REGISTER request that does not contain a challenge response, the UE shall populate the header fields as follows:\na)\ta From header field set to the SIP  that contains:\n1)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, the main  of the UE; else\n2)\tthe public user identity to be registered;\nb)\ta To header field set to the SIP  that contains:\n1)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, the main  of the UE; else\n2)\tthe public user identity to be registered;\nc)\ta Contact header field set to include SIP (s) that contain(s) in the hostport parameter the IP address or FQDN of the UE, and containing the instance ID of the UE in the \"+sip.instance\" header field parameter, if the UE:\n1)\tsupports GRUU (see table A.4, item A.4/53);\n2)\tsupports multiple registrations;\n3)\thas an IMEI available; or\n4)\thas an MEID available.\nOnly the IMEI shall be used for generating an instance ID for a multi-mode UE that supports both 3GPP and 3GPP2 defined radio access networks.\nNOTE 1:\tThe requirement placed on the UE to include an instance ID based on the IMEI or the MEID when the UE does not support GRUU and does not support multiple registrations does not imply any additional requirements on the network.\nIf the UE support multiple registrations, it shall include \"reg-id\" header field as described in RFC 5626 [92]. The UE shall include all supported ICSI values (coded as specified in subclause 7.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 and RFC 3840 [62] for the IMS communication it intends to use, and IARI values (coded as specified in subclause 7.2A.9.2), for the IMS applications it intends to use in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3840 [62].\nIf the UE supports RFC 6140 [191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Contact  without a user portion and containing the \"bnc\"  parameter.\nIf a user part has previously been included in an initial REGISTER request, the UE shall use the user part which was previously used to create the binding being refreshed or removed;\nd)\ta Via header field set to include the IP address or FQDN of the UE in the sent-by field. For the , the response is received on the  connection on which the request was sent. If the UE previously has previously negotiated sending of keep-alives associated with the registration, it shall include a \"keep\" header field parameter with no value in the Via header field, in order to indicate continuous support to send keep-alives, as described in RFC 6223 [143];\ne)\ta registration expiration interval value, set to 600 000 seconds as the value desired for the duration of the registration;\nNOTE 2:\tThe registrar (S-CSCF) might decrease the duration of the registration in accordance with network policy. Registration attempts with a registration period of less than a predefined minimum value defined in the registrar will be rejected with a 423 (Interval Too Brief) response.\nf)\ta Request- set to the SIP  of the domain name of the home network used to address the REGISTER request;\ng)\tthe Supported header field containing the option-tag \"path\", and:\n1)\tif GRUU is supported, the option-tag \"gruu\"; and\n2)\tif multiple registrations is supported, the option-tag \"outbound\";\nh)\tif available to the UE (as defined in the access technology specific annexes for each access technology), a P-Access-Network-Info header field set as specified for the access network technology (see subclause 7.2A.4);\ni)\ta Security-Client header field to announce the media plane security mechanisms the UE supports, if any, labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7;\nNOTE 3:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\nj)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Require header field containing the option-tag \"gin\"; and\nk)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Proxy-Require header field containing the option-tag \"gin\".\nOn receiving the 200 (OK) response to the REGISTER request, the UE shall:\na)\tbind the new expiration time of the registration for this public user identity found in the To header field value either to the contact address or to the registration flow and the associated contact address used in this registration;\nNOTE 4:\tIf the UE supports RFC 6140 [191] and performs the functions of an external attached network, the To header field will contain the main  of the UE.\nb)\tstore the list of service route values contained in the Service-Route header field and bind the list either to the contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used);\nNOTE 5:\tThe stored list of service route values will be used to build a proper preloaded Route header field for new dialogs and standalone transactions (other than REGISTER method) when using either the respective contact address or the registration flow and the associated contact address (if the multiple registration mechanism is used).\nNOTE 6:\tIf the list of Service-Route headers saved from a previous registration and bound either to this contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used), and the associated set of security associations or  session already exist, then the received list of Service-Route headers replaces the old list.\nNOTE 7:\tThe UE can utilize additional URIs contained in the P-Associated- header field, e.g. for application purposes.\nc)\tif the UE indicated support for GRUU in the Supported header field of the REGISTER request then:\n-\tif the UE did not use the procedures specified in RFC 6140 [191] for registration find the Contact header field within the response that matches the one included in the REGISTER request. If this contains a \"pub-gruu\" header field parameter or a \"temp-gruu\" header field parameter or both, then store the value of those parameters as the GRUUs for the UE in association with the public user identity and the contact address that was registered; and\n-\tif the UE used the procedures specified in RFC 6140 [191]for registration then find the Contact header field within the response that matches the one included in the REGISTER request. If this contains a \"pub-gruu\" header field parameter then store the value of the \"pub-gruu\" header field parameter for use for generating public GRUUs for registering UAs as specified in RFC 6140 [191]. If this contains a \"temp-gruu-cookie\" header field parameter then store the value of the \"temp-gruu-cookie\" header field parameter for use for generating temporary GRUUs for registering UAs as specified in RFC 6140 [191];\nNOTE 8:\tWhen allocating public GRUUs to registering UAs the functionality within the UE that performs the role of registrar will add an \"sg\" SIP  parameter that uniquenly identifies that UA to the public GRUU it received in the \"pub-gruu\" header field parameter. The procedures for generating a temporary GRUU using the \"temp-gruu-cookie\" header field parameter are specified in subclause 7.1.2.2 of RFC 6140 [191].\nd)\tstore the announcement of the media plane security mechanisms the P-CSCF (IMS-) supports received in the Security-Server header field and labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7, if any. Once the UE chooses a media security mechanism from the list received in the Security-Server header field from the server, it may initiate that mechanism on a media level when it initiates new media in an existing session;\nNOTE 9:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\ne)\tif the Via header field contains a \"keep\" header field parameter with a value, continue to send keep-alives as described in RFC 6223 [143], towards the P-CSCF;\nf)\tif the 200 (OK) response contains the Authentication-Info header field including a nextnonce field, store the contained nonce as a nonce for authentication associated to the same registration or registration flow (if the multiple registration mechanism is used) and shall delete any other previously stored nonce value for authentication for this registration or registration flow (if the multiple registration mechanism is used); and\nNOTE 10:\tThe related registration flow or registration is identified by the couple instance-id and reg-id if the multiple registration mechanism is used or by contact address if not.\ng)\tif a Feature-Caps header field is received, a UE supporting the Feature-Caps header field shall consider the ICSI values received in the Feature-Caps header field of 200 (OK) response as supported for the established registration or registration flow (if the multiple registration mechanism is used) according to RFC 6809 [190]; and\nNOTE 11:\tThe UE and related applications can use the ICSI values received in the Feature-Caps header field to improve the user experience.\nh)\tvoid.\nWhen a 401 (Unauthorized) response to a REGISTER is received the UE shall behave as described in subclause 5.1.1.5.1.\nOn receiving a 423 (Interval Too Brief) response to the REGISTER request, the UE shall:\n-\tsend another REGISTER request populating the registration expiration interval value with an expiration timer of at least the value received in the Min-Expires header field of the 423 (Interval Too Brief) response.\nOn receiving a 408 (Request Timeout) response or 500 (Server Internal Error) response or 504 (Server Time-Out) response or 403 (Forbidden) response for a reregistration, the UE shall perform the procedures for initial registration as described in subclause 5.1.1.2.\nOn receiving a 305 (Use Proxy) response to the REGISTER request, unless otherwise specified in the access specific annexes (as described in annex B, annex L or annex U), the UE shall:\na)\tignore the contents of the Contact header field if it is included in the received message;\nNOTE 12:\tThe 305 response is not expected to contain a Contact header field.\nb)\trelease all IP-CAN bearers used for the transport of media according to the procedures in subclause 9.2.2;\nc)\tinitiate either a new P-CSCF discovery procedure as described in subclause 9.2.1, or select a new P-CSCF, if the UE was pre-configured with more than one P-CSCF's IP addresses or domain names;\nd)\tselect a P-CSCF address, which is different from the previously used address, from the address list; and\ne)\tperform the procedures for initial registration as described in subclause 5.1.1.2.\nWhen the timer F expires at the UE:\n1)\tthe UE shall stop processing of all ongoing dialogs and transactions associated with that flow, if any (i.e. no further SIP signalling will be sent by the UE on behalf of these transactions or dialogs); and\n2)\tafter releasing all IP-CAN bearers used for the transport of media according to the procedures in subclause 9.2.2:\na)\tthe UE may select a different P-CSCF address from the list of P-CSCF addresses discovered during the procedures described in subclause 9.2.1 or from its pre-configured list of P-CSCF's IP addresses or domain names;\nb)\tif no response has been received when attempting to contact all P-CSCFs known by the UE, the UE may get a new set of P-CSCF-addresses as described in subclause 9.2.1 unless otherwise specified in the access specific annexes (as described in annex B, annex L or annex U);\nc)\tthe UE may perform the procedures for initial registration as described in subclause 5.1.1.2; and\nd)\tthe UE shall perform the procedures in RFC 5626 [92] to form a new flow to replace the failed one if it supports multiple registrations. If failed registration attempts occur in the process of creating a new flow, the UE shall implement the flow recovery procedures defined in subclause 4.5 of RFC 5626 [92] for determination of the retry delay time before each new registration attempt. The UE shall use the values of the parameters max-time and base-time, of the algorithm defined in subclause 4.5 of RFC 5626 [92]. If no values of the parameters max-time and base-time (if all failed) have been provided to the UE by the network, the default values defined in subclause 4.5 of RFC 5626 [92] shall be used.\nNOTE 13:\tIt is an implementation option whether these actions are also triggered by other means than expiration of timer F, e.g. based on ICMP messages.\nOn receiving a 503 response with a Retry-After header field to the REGISTER request and the Retry-After header field indicates time bigger than the value for timer F as specified in table 7.7.1, the UE:\na)\tmay mark the currently used P-CSCF address as unavailable for the time indicated by the Retry-After header field;\nb)\tif there is a locally stored P-CSCF address as specified in subclause 5.1.9 which is different from the currently used P-CSCF address and which is not marked as unavailable, may initiate an initial registration as specified in subclause 5.1.1.2 using that P-CSCF; and\nc)\tif there is no locally stored P-CSCF address as specified in subclause 5.1.9 which is different from the currently used P-CSCF address and which is not marked as unavailable, may get a new set of P-CSCF addresses as described in subclause 9.2.1 unless otherwise specified in the access specific annexes (as described in annex B, annex L or annex U) and initiate an initial registration as specified in subclause 5.1.1.2.\nNOTE 14:\tIt is UE implementation dependent whether the UE stops processing of all ongoing dialogs and transactions associated with that flow.\nOn receiving a 503 response with a Retry-After header field to the REGISTER request and the Retry-After header field indicates time smaller than the value for timer F as specified in table 7.7.1, after the time indicated by the Retry-After header field elapses:\na)\tif the expiration time as indicated in the \"expires\" header field parameter of the Subscription-State header field or as retrieved from the Expires header field of the 2xx response to SUBSCRIBE request has not expired, the UE may attempt a reregistration to the same P-CSCF; or\nb)\tif the expiration time as indicated in the \"expires\" header field parameter of the Subscription-State header field or as retrieved from the Expires header field of the 2xx response to SUBSCRIBE request has expired, the UE may attempt an initial registration as specified in subclause 5.1.1.2.\nNOTE 15:\tWhen the expiration time has expied and the time indicated by the Retry-After header field does not elapse, the UE considers the subscription invalid.\nNOTE 16:\tIt is UE implementation dependent whether the UE sends reregistration due to RAT change or feature tag which includes the ICSI values that the UE intends to use in a g.3gpp.icsi-ref media feature tag or IARI values that the UE intends to use in the g.3gpp.iari-ref media feature tag during the time indicated by the Retry-After header field.\nOn sending a REGISTER request, as defined in subclause 5.1.1.4.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field, with:\n-\tthe \"username\" header field parameter set to the value of the private user identity;\n-\tthe \"realm\" header field parameter directive, set to the value as received in the \"realm\" -Authenticate header field parameter;\n-\tthe \"uri\" header field parameter, set to the SIP  of the domain name of the home network;\n-\tthe \"nonce\" header field parameter, set to last received nonce value; and\n-\tthe \"response\" header field parameter, set to the last calculated response value;\nNOTE 1:\tIf the UE specifies its FQDN in the hostport parameter in the Contact header field and in the sent-by field in the Via header field, then it has to ensure that the given FQDN will resolve (e.g., by reverse DNS lookup) to the IP address that is bound to the security association.\nNOTE 2:\tThe UE associates two ports, a protected client port and a protected server port, with each pair of security associations. For details on the selection of the protected port value see 3GPP TS 33.203 [19].\nNOTE 3:\tIf the UE is setting up an additional registration using procedures specified in RFC 5626 [92] and the UE accesses the network through 3GPP or 3GPP2 systems without any , the flow is considered to be \"logical flow\".\nb)\tadditionally for the Contact header field, include the protected server port value in the hostport parameter;\nc)\tadditionally for the Via header field, for UDP, if the REGISTER request is protected by a security association, include the protected server port value in the sent-by field;\nd)\ta Security-Client header field, set to specify the signalling plane security mechanism it supports, the IPsec layer algorithms for security and confidentiality protection it supports and the new parameter values needed for the setup of two new pairs of security associations. For further details see 3GPP TS 33.203 [19] and RFC 3329 [48]; and\ne)\ta Security-Verify header field that contains the content of the Security-Server header field received in the 401 (Unauthorized) response of the last successful authentication.\nOn receiving the 200 (OK) response to the REGISTER request, the UE shall additionally:\na)\tset the security association lifetime associated with either this contact address or the registration flow and the associated contact address (if the multiple registration mechanism is used), and the associated set of security associations to the longest of either the previously existing security association lifetime, or the lifetime of the just completed registration plus 30 seconds.\nNOTE 4:\tIf the UE receives Authentication-Info, it will proceed as described in RFC 3310 [49] when AKAv1 is used or as described in RFC 4169 [227] when AKAv2 is used.\nOn sending a REGISTER request, as defined in subclause 5.1.1.4.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field as defined in RFC 7616 [286] and RFC 8760 [287], including:\n-\tthe \"username\" header field parameter, set to the value of the private user identity;\n-\tthe \"realm\" header field parameter, set to the domain name of the home network;\n-\tthe \"uri\" header field parameter, set to the SIP  of the domain name of the home network;\n-\tthe \"nonce\" header field parameter, set to the stored nonce value for authentication for the related registration or registration flow (if the multiple registration mechanism is used); and\nNOTE:\tThe related registration flow or registration is identified by the couple instance-id and reg-id if the multiple registration mechanism is used or by contact address if not.\n-\tthe \"response\" header field parameter, set to the challenge response, constructed using the stored nonce value for authentication for the same registration or registration flow ( if the multiple registration mechanism is used), along with \"algorithm\", \"cnonce\", \"qop\", and \"nc\" header field parameters as specified in RFC 7616 [286] and RFC 8760 [287];\nb)\tthe Contact header field with the port value of an unprotected port where the UE expects to receive subsequent requests; and\nc)\tthe Via header field with the port value of an unprotected port where the UE expects to receive responses to the request.\nOn sending a REGISTER request, as defined in subclause 5.1.1.4.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field set in accordance with subclause 5.1.1.4.3;\nb)\tthe Security-Client header field set to specify the signalling plane security mechanism the UE supports. The UE shall support the setup of a  session as defined in 3GPP TS 33.203 [19]. The UE shall support the \"tls\" security mechanism, as specified in RFC 3329 [48]. The UE shall support  for integrity and confidentiality protection as defined in RFC 3261 [26], and shall announce support for them according to the procedures defined in RFC 3329 [48]; and\nc)\ta Security-Verify header field that contains the content of the Security-Server header field received in the 401 (Unauthorized) response of the last successful authentication.\nOn receiving the 200 (OK) response to the REGISTER request defined in subclause 5.1.1.2.1, the UE shall additionally:\na)\tset the lifetime of the respective  session to the value configured.\nOn sending a REGISTER request, as defined in subclause 5.1.1.4.1, the UE shall additionally populate the header fields as follows:\na)\toptionally, an Authorization header field, with the \"username\" header field parameter, set to the value of the private user identity;\nNOTE 1:\tIn case the Authorization header field is absent, the mechanism only supports that one public user identity is associated with only one private user identity.\nOn receiving the 200 (OK) response to the REGISTER request defined in subclause 5.1.1.2.1, there are no additional requirements for the UE.\nNOTE 2:\tWhen NASS-IMS bundled authentication is in use, a 401 (Unauthorized) response to the REGISTER request is not expected to be received.\nOn sending a REGISTER request, as defined in subclause 5.1.1.4.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field as defined in RFC 7616 [286] and RFC 8760 [287] shall not be included, in order to indicate support GPRS-IMS-Bundled authentication.\nb)\tsecurity agreement header field values as required by RFC 3329 [48] shall not contain signalling plane security mechanisms;\nc)\ta From header field set to a temporary public user identity derived from the , as defined in 3GPP TS 23.003 [3], as the public user identity to be registered;\nd)\ta To header field set to a temporary public user identity derived from the , as defined in 3GPP TS 23.003 [3], as the public user identity to be registered;\ne)\tthe Contact header field with the port value of an unprotected port where the UE expects to receive subsequent mid-dialog requests; and\nf)\tthe Via header field with the port value of an unprotected port where the UE expects to receive responses to the request.\nNOTE 1:\tSince the private user identity is not included in the REGISTER requests when GPRS-IMS-Bundled authentication is used for registration, reregistration and de-registration procedures, all REGISTER requests from the UE use the -derived IMPU as the public user identity even when the implicitly registered IMPUs are available at the UE. The UE does not use the temporary public user identity (-derived IMPU) in any non-registration SIP requests.\nOn receiving the 200 (OK) response to the REGISTER request defined in subclause 5.1.1.4.1, there are no additional requirements for the UE.\nNOTE 2:\tWhen GPRS-IMS-Bundled authentication is in use, a 401 (Unauthorized) response to the REGISTER request is not expected to be received.\nAuthentication is performed during initial registration. A UE can be re-authenticated during subsequent reregistrations, deregistrations or registrations of additional public user identities. When the network requires authentication or re-authentication of the UE, the UE will receive a 401 (Unauthorized) response to the REGISTER request.\nOn receiving a 401 (Unauthorized) response to the REGISTER request containing one or more -Authenticate header fields the UE shall select the topmost header field that it supports (i.e. where the \"algorithm\" -Authenticate header field parameter is \"AKAv2-SHA-256\" or \"AKAv1-MD5\"), the UE shall:\nNOTE 1:\tThe \"AKAv1-MD5\" algorithm is only supported for backward compatibility.\n1)\textract the  and  parameters;\n2)\tcheck the validity of a received authentication challenge, as described in 3GPP TS 33.203 [19] i.e. the locally calculated XMAC must match the  parameter derived from the  part of the challenge; and the SQN parameter derived from the  part of the challenge must be within the correct range; and\n3)\tcheck the existence of the Security-Server header field as described in RFC 3329 [48]. If the Security-Server header field is not present or it does not contain the parameters required for the setup of the set of security associations (see annex H of 3GPP TS 33.203 [19]), the UE shall abandon the authentication procedure and send a new REGISTER request with a new Call-ID.\nIn the case that the 401 (Unauthorized) response to the REGISTER request is deemed to be valid the UE shall:\n1)\tcalculate the  parameter and derive the keys CK and IK from  as described in 3GPP TS 33.203 [19];\n2)\tset up a temporary set of security associations for this registration based on the static list and parameters the UE received in the 401 (Unauthorized) response and its capabilities sent in the Security-Client header field in the REGISTER request. The UE sets up the temporary set of security associations using the most preferred mechanism and algorithm returned by the P-CSCF and supported by the UE and using IK and CK (only if encryption enabled) as the shared key. The UE shall use the parameters received in the Security-Server header field to setup the temporary set of security associations. The UE shall set a temporary SIP level lifetime for the temporary set of security associations to the value of reg-await-auth timer;\n3)\tstore the announcement of the media plane security mechanisms the P-CSCF (IMS-) supports received in the Security-Server header field and labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7, if any; and\nNOTE 2:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\n4)\tsend another REGISTER request towards the protected server port indicated in the response using the temporary set of security associations to protect the message. The header fields are populated as defined for the initial REGISTER request that was challenged with the received 401 (Unauthorized) response, with the addition that the UE shall include an Authorization header field containing:\n-\tthe \"realm\" header field parameter set to the value as received in the \"realm\" -Authenticate header field parameter;\n-\tthe \"username\" header field parameter, set to the value of the private user identity;\n-\tthe \"response\" header field parameter that contains the  parameter, as described in RFC 3310 [49] when AKAv1 is used or as described in RFC 4169 [227] when AKAv2 is used;\n-\tthe \"uri\" header field parameter, set to the SIP  of the domain name of the home network;\n-\tthe \"algorithm\" header field parameter, set to the value received in the 401 (Unauthorized) response; and\n-\tthe \"nonce\" header field parameter, set to the value received in the 401 (Unauthorized) response.\nThe UE shall also insert the Security-Client header field that is identical to the Security-Client header field that was included in the previous REGISTER request (i.e. the REGISTER request that was challenged with the received 401 (Unauthorized) response). The UE shall also insert the Security-Verify header field into the request, by mirroring in it the content of the Security-Server header field received in the 401 (Unauthorized) response. The UE shall set the Call-ID of the security association protected REGISTER request which carries the authentication challenge response to the same value as the Call-ID of the 401 (Unauthorized) response which carried the challenge.\nNOTE 3:\tThe Security-Client header field contains signalling plane security mechanism and if the UE supports media plane security, then media plane security mechanisms are contained, too.\nOn receiving the 200 (OK) response for the security association protected REGISTER request registering a public user identity with the associated contact address, the UE shall:\n-\tchange the temporary set of security associations to a newly established set of security associations, i.e. set its SIP level lifetime to the longest of either the previously existing set of security associations SIP level lifetime, or the lifetime of the just completed registration plus 30 seconds; and\n-\tif this is the only set of security associations available toward the P-CSCF, use the newly established set of security associations for further messages sent towards the P-CSCF. If there are additional sets of security associations (e.g. due to registration of multiple contact addresses), the UE can either use them or use the newly established set of security associations for further messages sent towards the P-CSCF as appropriate.\nNOTE 4:\tIf the UE has registered multiple contact addresses, the UE can either send requests towards the P-CSCF over the newly established set of security associations, or use different UE's contact address and associated set of security associations when sending the requests towards the P-CSCF. Responses towards the P-CSCF that are sent via UDP will be sent over the same set of security associations that the related request was received on. Responses towards the P-CSCF that are sent via  will be sent over the same set of security associations that the related request was received on.\nWhen the first request or response protected with the newly established set of security associations is received from the P-CSCF or when the lifetime of the old set of security associations expires, the UE shall delete the old set of security associations and related keys it may have with the P-CSCF after all SIP transactions that use the old set of security associations are completed.\nNOTE 5:\tIf the UE has registered multiple contact addresses, the S-CSCF can use different contact address when sending the requests destined for the UE. In this case the UE will not receive the subsequent requests over the newly established set of security associations.\nWhenever the 200 (OK) response is not received before the temporary SIP level lifetime of the temporary set of security associations expires or a 403 (Forbidden) response is received, the UE shall consider the registration to have failed. The UE shall delete the temporary set of security associations it was trying to establish, and use the old set of security associations. The UE should send an unprotected REGISTER request according to the procedure specified in subclause 5.1.1.2 if the UE considers the old set of security associations to be no longer active at the P-CSCF.\nIn the case that the 401 (Unauthorized) response is deemed to be invalid then the UE shall behave as defined in subclause 5.1.1.5.3.\nIf, in a 401 (Unauthorized) response, either the  or SQN is incorrect the UE shall respond with a further REGISTER indicating to the S-CSCF that the challenge has been deemed invalid as follows:\n-\tin the case where the UE deems the  parameter to be invalid the subsequent REGISTER request shall contain no \"auts\" Authorization header field parameter and an empty \"response\" Authorization header field parameter, i.e. no authentication challenge response;\n-\tin the case where the UE deems the SQN to be out of range, the subsequent REGISTER request shall contain the \"auts\" Authorization header field parameter (see 3GPP TS 33.102 [18]).\nNOTE:\tIn the case of the SQN being out of range, a \"response\" Authorization header field parameter can be included by the UE, based on the procedures described in RFC 3310 [49].\nWhenever the UE detects any of the above cases, the UE shall:\n-\tsend the REGISTER request using an existing set of security associations, if available (see 3GPP TS 33.203 [19]);\n-\tpopulate a new Security-Client header field within the REGISTER request and associated contact address, set to specify the security mechanisms it supports, the IPsec layer algorithms for integrity and confidentiality protection it supports and the parameters needed for the new security association setup. These parameters shall contain new values for spi_uc, spi_us and port_uc; and\n-\tnot create a temporary set of security associations.\nOn receiving a 420 (Bad Extension) in which the Unsupported header field contains the value \"sec-agree\" and if the UE supports GPRS-IMS-Bundled authentication, the UE shall initiate a new authentication attempt with the GPRS-IMS-Bundled authentication procedures as specified in subclause 5.1.1.2.6.\nOn receiving a 401 (Unauthorized) response to the REGISTER request containing one or more -Authenticate header fields the UE shall select the topmost header field that it supports (i.e. where the \"algorithm\" -Authenticate header field parameter is \"SHA2-256\", \"SHA2-512/256\" or \"MD5\"), and the UE shall:\nNOTE 1:\tThe MD5 algorithm is only supported for backward compatibility.\n1)\textract the digest-challenge parameters as indicated in RFC 7616 [286] and RFC 8760 [287] from the -Authenticate header field;\n2)\tstore the contained nonce value as the nonce for authentication associated to the same registration or registration flow (if the multiple registration mechanism is used) and delete any other previously stored nonce value for authentication for this registration or registration flow (if the multiple registration mechanism is used);\nNOTE 2:\tThe related registration flow or registration is identified by the couple instance-id and reg-id if the multiple registration mechanism is used or by contact address if not.\n3)\tcalculate digest-response parameters as indicated in RFC 7616 [286] and RFC 8760 [287];\n4)\tsend another REGISTER request containing an Authorization header field. The header fields are populated as defined in subclause 5.1.1.2.3, with the addition that the UE shall include an Authorization header field containing a challenge response, constructed using the stored nonce value for authentication for the same registration or registration flow (if the multiple registration mechanism is used) , \"algorithm\", \"cnonce\", \"qop\", and \"nc\" header field parameters as indicated in RFC 7616 [286] and RFC 8760 [287]. The UE shall set the Call-ID of the REGISTER request which carries the authentication challenge response to the same value as the Call-ID of the 401 (Unauthorized) response which carried the challenge. If SIP digest without  is used, the UE shall not include RFC 3329 [48] header fields with this REGISTER.\nOn receiving the 200 (OK) response for the REGISTER request, if the \"algorithm\" Authentication-Info header field parameter is \"SHA2-256\", \"SHA2-512/256\" or \"MD5\", the UE shall authenticate the S-CSCF using the \"rspauth\" Authentication-Info header field parameter as described in RFC 7616 [286] and RFC 8760 [287]. If the nextnonce field is present in the Authentication-Info header field the UE shall store the contained nonce value as the nonce for authentication associated to the same registration or registration flow (if the multiple registration mechanism is used) and shall delete any other previously stored nonce value for authentication for this registration or registration flow (if the multiple registration mechanism is used).\nOn receiving a 403 (Forbidden) response, the UE shall consider the registration to have failed.\nOn receiving a 401 (Unauthorized) response to the REGISTER request, the procedures in subclause 5.1.1.5.4 apply with the following differences:\n-\tThe UE shall check the existence of the Security-Server header field as described in RFC 3329 [48]. If the Security-Server header field is not present or the list of supported security mechanisms does not include \"tls\", the UE shall abandon the authentication procedure and send a new REGISTER request.\nIn the case that the 401 (Unauthorized) response to the REGISTER is deemed to be valid the UE shall:\n-\tstore the announcement of the media plane security mechanisms the P-CSCF (IMS-) supports labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7 and received in the Security-Server header field, if any; and\nNOTE 1:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\n-\tsend another REGISTER request using the  session to protect the message.\nThe header fields are populated as defined for the initial request, with the addition that the UE shall include an Authorization header field containing a challenge response, constructed using the stored nonce value for authentication for the same registration or registration flow (if the multiple registration mechanism is used), \"algorithm\", \"cnonce\", \"qop\", and \"nc\" header field parameters as indicated in RFC 7616 [286] and RFC 8760 [287]. The UE shall also insert the Security-Client header field that is identical to the Security-Client header field that was included in the previous REGISTER request (i.e. the REGISTER request that was challenged with the received 401 (Unauthorized) response). The UE shall also insert the Security-Verify header field into the request, by mirroring in it the content of the Security-Server header field received in the 401 (Unauthorized) response. The UE shall set the Call-ID to the same value as the Call-ID of the 401 (Unauthorized) response which carried the challenge.\nNOTE 2:\tThe Security-Client header field contains signalling plane security mechanism and if the UE supports media plane security, then media plane security mechanisms are contained, too.\nWhen SIP digest with  is used, and for the case where the 401 (Unauthorized) response to the REGISTER request is deemed to be valid, the UE shall establish the  session as described in 3GPP TS 33.203 [19]. The UE shall use this  session to send all further messages towards the P-CSCF towards the protected server port.\nNOTE 3:\tThe related registration flow or registration is identified by the couple instance-id and reg-id if the multiple registration mechanism is used or by contact address if not.\nOn receiving a 403 (Forbidden) response, the UE shall consider the registration to have failed. If performing SIP digest with , the UE should send an initial REGISTER according to the procedure specified in subclause 5.1.1.2 if the UE considers the  session to be no longer active at the P-CSCF.\nNASS-IMS bundled authentication is only applicable to UEs that contain neither USIM nor ISIM. Authentication is achieved via the registration and reregistration procedures as defined in subclause 5.1.1.2 and subclause 5.1.1.4. NASS-bundled authentication is granted by the network upon receipt by the UE of a 200 (OK) response to the initial REGISTER request.\nThere is no separate authentication procedure.\nThere is no separate authentication procedure, and therefore no abnormal procedures.\nAuthentication is achieved via the registration and reregistration procedures as defined in subclause 5.1.1.2 and subclause 5.1.1.4. GPRS-IMS-Bundled authentication is granted by the network upon receipt by the UE of a 200 (OK) response to the initial REGISTER request.\nThere is no separate authentication procedure and therefore no abnormal procedures.\nA UE shall only respond to two consecutive invalid challenges. The UE may attempt to register with the network again after an implementation specific time.\nAt any time, the UE can receive a NOTIFY request carrying information related to the reg event package (as described in subclause 5.1.1.3). If:\n-\tthe state attribute in any of the <registration> elements is set to \"active\";\n-\tthe value of the <uri> sub-element inside the <contact> sub-element is set to the Contact address that the UE registered; and\n-\tthe event attribute of that <contact> sub-element(s) is set to \"shortened\";\nthe UE shall:\n1)\tuse the expires attribute of the <contact> sub-element that the UE registered to adjust the expiration time for that public user identity; and\n2)\tstart the re-authentication procedures at the appropriate time (as a result of the S-CSCF procedure described in subclause 5.4.1.6) by initiating a reregistration as described in subclause 5.1.1.4, if required.\nNOTE:\tWhen authenticating a given private user identity, the S-CSCF will only shorten the expiry time within the <contact> sub-element that the UE registered using its private user identity. The <contact> elements for the same public user identity, if registered by another UE using different private user identities remain unchanged. The UE will not initiate a reregistration procedure, if none of its <contact> sub-elements was modified.\nStateless address autoconfiguration as described in RFC 2462 [20E] defines how an IPv6 prefix and an interface identifier is used by the UE to construct a complete IPv6 address.\nIf the UE receives an IPv6 prefix, the UE may change the interface identity of the IPv6 address as described in RFC 8981 [293] due to privacy but this can result in service discontinuity for services provided by the IM CN subsystem.\nNOTE:\tWhen the UE constructs new IPv6 address by changing the interface identity, the UE can either transfer all established dialogs to new IPv6 address as specified in 3GPP TS 24.237 [8M] and subsequently relinquish the old IPv6 address, or terminate all established dialogs and transactions. While transferring the established dialogs to new IPv6 address, the UE will have double registration, i.e. one registration for the old IPv6 address and another for the new IPv6 address.\nThe procedure described below assumes that the UE will terminate all established dialogs and transactions and temporarily disconnect the UE from the IM CN subsystem until the new registration is performed. If the UE decides to change the IPv6 address due to privacy and terminate all established dialogs and transaction, associated with old IPv6 address, the UE shall:\n1)\tterminate all ongoing dialogs (e.g., sessions) and transactions (e.g., subscription to the reg event) that were using the old IPv6 address;\n2)\tderegister all registered public user identities that were using the old IPv6 address as described in subsclause 5.1.1.4;\n3)\tconstruct a new IPv6 address according to the procedures specified in RFC 8981 [293];\n4)\tregister the public user identities that were deregistered in step 2 above with a new IPv6 address, as follows:\na)\tby performing an initial registration as described in subsclause 5.1.1.2; and\nb)\tby performing a subscription to the reg event package as described in subsclause 5.1.1.3; and\n5)\tsubscribe to other event packages it was subscribed to before the change of IPv6 address procedure started.\nTo ensure a maximum degree of continuous service to the end user, the UE should transfer all established dialogs to the new IPv6 address as specified in 3GPP TS 24.237 [8M] rather than terminate all established dialogs and transactions and temporarily disconnect the UE from the IM CN subsystem as described above.\nFor any public user identity that the UE has previously registered, the UE can deregister via a single registration procedure:\n-\tall contact addresses bound to the indicated public user identity;\n-\tsome contact addresses bound to the indicated public user identity;\n-\ta particular contact address bound to the indicated public user identity; or\n-\twhen the UE supports multiple registrations (i.e. the \"outbound\" option tag is included in the Supported header field) one or more flows bound to the indicated public user identity.\nThe UE can deregister a public user identity that it has previously registered with its contact address at any time. The UE shall protect the REGISTER request using a security association or  session that is associated with contact address, see 3GPP TS 33.203 [19], established as a result of an earlier registration, if one is available.\nThe UE shall extract or derive a public user identity, the private user identity, and the domain name to be used in the Request- in the registration, according to the procedures described in subclause 5.1.1.1A or subclause 5.1.1.1B.\nPrior to sending a REGISTER request for deregistration, the UE shall release all dialogs that were using the contact addresses or the flow that is going to be deregistered and related to the public user identity that is going to be deregistered or to one of the implicitly registered public user identities. However:\n-\tif the dialog that was established by the UE subscribing to the reg event package used the public user identity that is going to be deregistered; and\n-\tthis dialog is the only remaining dialog used for subscription to reg event package of the user, i.e. there are no other contact addresses registered with associated subscription to the reg event package of the user;\nthen the UE shall not release this dialog.\nOn sending a REGISTER request that will remove the binding between the public user identity and one of its contact addresses or one of its flows, the UE shall populate the header fields as follows:\na)\ta From header field set to the SIP  that contains:\n1)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, the main  of the UE; else\n2)\tthe public user identity to be deregistered;\nb)\ta To header field set to the SIP  that contains:\n1)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, the main  of the UE; else\n2)\tthe public user identity to be deregistered;\nc)\ta Contact header field set to the SIP (s) that contain(s) in the hostport parameter the IP address of the UE or FQDN, and:\n1)\tif the UE is removing the binding between the public user identity indicated in the To header field, (together with the associated implicitly registered public user identities), and the contact address indicated in the Contact header field; and\n-\tif the UE supports GRUU, or multiple registrations (i.e. the \"outbound\" option tag is included in the Supported header field), or has an IMEI available, or has an MEID available, the Contact header field also contains the \"+sip.instance\" header field parameter. Only the IMEI shall be used for generating an instance ID for a multi-mode UE that supports both 3GPP and 3GPP2 defined radio access networks;\n-\tif the UE supports multiple registrations (i.e. the \"outbound\" option tag is included in the Supported header field), the Contact header field does not contain the \"reg-id\" header field parameter;\n-\tif the UE does not supports GRUU and does not support multiple registrations (i.e. the \"outbound\" option tag is not included in the Supported header field), and does not have an IMEI available, and does not have an MEID available, the Contact header field does not contain either the \"+sip.instance\" header field parameter or the \"reg-id\" header field parameter;\nNOTE 1:\tSince the contact address is deregistered, if there are any flows that were previously registered with the respective contact address, all flows terminating at the respective contact address are removed.\n2)\tif the UE is removing the binding between the public user identity indicated in the To header field, (together with the associated implicitly registered public user identities) and one of its flows, the Contact header field contains the \"+sip.instance\" header field parameter and the \"reg-id\" header field parameter that identifies the flow; and\nNOTE 2:\tThe requirement placed on the UE to include an instance ID based on the IMEI when the UE does not support GRUU and does not support multiple registrations does not imply any additional requirements on the network.\n3)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Contact  without a user portion and containing the \"bnc\"  parameter;\nd)\ta Via header field set to include the IP address or FQDN of the UE in the sent-by field;\ne)\ta registration expiration interval value set to the value of zero, appropriate to the deregistration requirements of the user;\nf)\ta Request- set to the SIP  of the domain name of the home network used to address the REGISTER request;\ng)\tif available to the UE (as defined in the access technology specific annexes for each access technology), a P-Access-Network-Info header field set as specified for the access network technology (see subclause 7.2A.4);\nh)\ta Security-Client header field to announce the media plane security mechanisms the UE supports, if any;\nNOTE 3:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\ni)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Require header field containing the option-tag \"gin\"; and\nj)\tif the UE supports RFC 6140 [191] and performs the functions of an external attached network, for the registration of bulk number contacts the UE shall include a Proxy-Require header field containing the option-tag \"gin\".\nFor a public user identity that the UE has registered with multiple contact addresses or multiple flows (e.g. via different P-CSCFs), the UE shall also be able to deregister multiple contact addresses or multiple flows, bound to its public user identity, via single deregistration proceduere as specified in RFC 3261 [26]. The UE shall send a single REGISTER request, using one of its contact addresses and the associated set of security associations or  session, containing a list of Contact headers. Each Contact header field is populated as specifed above in bullets a) through i).\nThe UE can deregister all contact addresses bound to its public user identity and associated with its private user identity. The UE shall send a single REGISTER request, using one of its contact addresses and the associated set of security associations or  session, containing a public user identity that is being deregistered in the To header field, and a single Contact header field with value of \"*\" and the Expires header field with a value of \"0\". The UE shall not include the \"instance-id\" feature tag and the \"reg-id\" header field parameter in the Contact header field in the REGISTER request.\nNOTE 4:\tAll entities subscribed to the reg event package of the user will be informed via NOTIFY request which contact addresses bound to the public user identity have been deregistered.\nWhen a 401 (Unauthorized) response to a REGISTER request is received the UE shall behave as described in subclause 5.1.1.5.1.\nOn receiving the 200 (OK) response to the REGISTER request, the UE shall:\n-\tremove all registration details relating to this public user identity and the associated contact address.\n-\tstore the announcement of the media plane security mechanisms the P-CSCF (IMS-) supports labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7 and received in the Security-Server header field, if any.\nNOTE 5:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\nIf there are no more public user identities registered with this contact address, the UE shall delete any stored media plane security mechanisms and related keys and any security associations or  sessions and related keys it may have towards the IM CN subsystem.\nIf all public user identities are deregistered and all security association or  session is removed, then the UE shall consider subscription to the reg event package cancelled (i.e. as if the UE had sent a SUBSCRIBE request with an Expires header field containing a value of zero).\nOn sending a REGISTER request, as defined in subclause 5.1.1.6.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field, with:\n-\tthe \"username\" header field parameter, set to the value of the private user identity;\n-\tthe \"realm\" header field parameter, set to the value as received in the \"realm\" -Authenticate header field parameter;\n-\tthe \"uri\" header field parameter, set to the SIP  of the domain name of the home network;\n-\tthe \"nonce\" header field parameter, set to last received nonce value; and\n-\tthe response directive, set to the last calculated response value;\nb)\tadditionally for each Contact header field and associated contact address, include the associated protected server port value in the hostport parameter;\nc)\tadditionally for the Via header field, include the protected server port value bound to the security association in the sent-by field;\nNOTE 1:\tIf the UE specifies its FQDN in the hostport parameter in the Contact header field and in the sent-by field in the Via header field, then it has to ensure that the given FQDN will resolve (e.g., by reverse DNS lookup) to the IP address that is bound to the security association.\nd)\ta Security-Client header field, set to specify the signalling plane security mechanisms it supports, the IPsec layer algorithms for integrity and confidentiality protection it supports and the new parameter values needed for the setup of two new pairs of security associations. For further details see 3GPP TS 33.203 [19] and RFC 3329 [48]; and\ne)\ta Security-Verify header field that contains the content of the Security-Server header field received in the 401 (Unauthorized) response of the last successful authentication.\nNOTE 2:\tWhen the UE has received the 200 (OK) response for the REGISTER request of the only public user identity currently registered with this contact address and its associated set of implicitly registered public user identities (i.e. no other public user identity is registered), the UE removes the security association (between the P-CSCF and the UE) that were using this contact address. Therefore further SIP signalling using this security association (e.g. the NOTIFY request containing the deregistration event) will not reach the UE.\nOn sending a REGISTER request, as defined in subclause 5.1.1.6.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field as defined in RFC 7616 [286] and RFC 8760 [287], including:\n-\tthe \"username\" header field parameter, set to the value of the private user identity;\n-\tthe \"realm\" header field parameter, set to the domain name of the home network;\n-\tthe \"uri\" header field parameter, set to the SIP  of the domain name of the home network;\n-\tthe \"nonce\" header field parameter, set to an empty value; and\n-\tthe \"response\" header field parameter, set to an empty value;\nb)\tfor each Contact header field and associated contact address include the associated unprotected port value (where the UE was expecting to receive mid-dialog requests); and\nc)\tthe Via header field with the port value of an unprotected port where the UE expects to receive responses to the request.\nOn sending a REGISTER request, as defined in subclause 5.1.1.6.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field set in accordance with subclause 5.1.1.6.3; and\nb)\ta Security-Client header field, set to specify the signalling plane security mechanism it supports. For further details see 3GPP TS 33.203 [19] and RFC 3329 [48]; and\nc)\ta Security-Verify header field that contains the content of the Security-Server header field received in the 401 (Unauthorized) response of the last successful authentication.\nOn sending a REGISTER request, as defined in subclause 5.1.1.6.1, the UE shall additionally populate the header fields as follows:\na)\toptionally, an Authorization header field, with the \"username\" header field parameter, set to the value of the private user identity;\nNOTE 1:\tIn case the Authorization header field is absent, the mechanism only supports that one public user identity is associated with only one private user identity.\nOn receiving the 200 (OK) response to the REGISTER request defined in subclause 5.1.1.6.1, there are no additional requirements for the UE.\nNOTE 2:\tWhen NASS-IMS bundled authentication is in use, a 401 (Unauthorized) response to the REGISTER request is not expected to be received.\nOn sending a REGISTER request, as defined in subclause 5.1.1.6.1, the UE shall additionally populate the header fields as follows:\na)\tan Authorization header field as defined in RFC 7616 [286] and RFC 8760 [287] shall not be included, in order to indicate support GPRS-IMS-Bundled authentication.\nb)\tthe Security-Verify header field and the Security-Client header field values as defined by RFC 3329 [48] shall not contain signalling plane security mechanisms;\nc)\ta From header field set to a temporary public user identity derived from the , as defined in 3GPP TS 23.003 [3], as the public user identity to be deregistered;\nd)\ta To header field set to a temporary public user identity derived from the , as defined in 3GPP TS 23.003 [3], as the public user identity to be deregistered;\ne)\tfor each Contact header field and associated contact address include the associated unprotected port value (where the UE was expecting to receive mid-dialog requests); and\nf)\tthe Via header field with the port value of an unprotected port where the UE expects to receive responses to the request.\nNOTE 1:\tSince the private user identity is not included in the REGISTER requests when GPRS-IMS-Bundled authentication is used for registration, reregistration and de-registration procedures, all REGISTER requests from the UE use the -derived IMPU as the public user identity even when the implicitly registered IMPUs are available at the UE. The UE does not use the temporary public user identity (-derived IMPU) in any non-registration SIP requests.\nOn receiving the 200 (OK) response to the REGISTER request defined in subclause 5.1.1.6.1, there are no additional requirements for the UE.\nNOTE 2:\tWhen GPRS-IMS-Bundled authentication is in use, a 401 (Unauthorized) response to the REGISTER request is not expected to be received.\nUpon receipt of a NOTIFY request, on any dialog which was generated during the subscription to the reg event package as described in subclause 5.1.1.3, including one or more <registration> element(s) which were registered by this UE, with:\n1)\tthe state attribute within the <registration> element set to \"terminated\", and within each <contact> element belonging to this UE, the state attribute set to \"terminated\" and the event attribute set either to \"unregistered\", or \"rejected\", or \"deactivated\", the UE shall remove all registration details relating to the respective public user identity (i.e. consider the public user identity indicated in the aor attribute of the <registration> element as deregistered); or\n2)\tthe state attribute within the <registration> element set to \"active\", and within a given <contact> element belonging to this UE, the state attribute set to \"terminated\", and the associated event attribute set either to \"unregistered\", or \"rejected\" or \"deactivated\", the UE shall consider the binding between the public user identity and either the contact address or the registration flow and the associated contact address (if the multiple registration mechanism is used) indicated in the respective <contact> element as removed. The UE shall consider its public user identity as deregistered when all bindings between the respective public user identity and all contact addresses and all registration flow and the associated contact address (if the multiple registration mechanism is used) belonging to this UE are removed.\nNOTE 1:\tWhen multiple registration mechanism is used to register a public user identity and bind it to a registration flow and the associated contact address, there will be one <contact> element for each registration flow and the associated contact address.\nNOTE 2:\tIf the state attribute within the <registration> element is set to \"active\" and the <contact> element belonging to this UE is set to \"active\", the UE will consider that the binding between the public user identity and either the respective contact address or the registration flow and the associated contact address as left unchanged.\nIn case of a \"deactivated\" event attribute, the UE shall start the initial registration procedure as described in subclause 5.1.1.2. In case of a \"rejected\" event attribute, the UE shall release all dialogs related to those public user identities.\nUpon receipt of a NOTIFY request, the UE shall delete all security associations or  sessions towards the P-CSCF either:\n-\tif all <registration> element(s) have their state attribute set to \"terminated\" (i.e. all public user identities are deregistered) and the Subscription-State header field contains the value of \"terminated\"; or\n-\tif each <registration> element that was registered by this UE has either the state attribute set to \"terminated\", or the state attribute set to \"active\" and the state attribute within the <contact> element belonging to this UE set to \"terminated\".\nWhen all UE's public user identities are registered via a single P-CSCF and the subscription dialog to the reg event package of the UE is set via the respective P-CSCF, the UE shall delete these security associations or  sessions towards the respective P-CSCF when all public user identities have been deregistered and after the server transaction (as defined in RFC 3261 [26]) pertaining to the received NOTIFY request terminates.\nNOTE 3:\tDeleting a security association or  session is an internal procedure of the UE and does not involve any SIP procedures.\nNOTE 4:\tIf all the public user identities (i.e. <contact> elements) registered by this UE are deregistered and the security associations or  sessions have been removed, the UE considers the subscription to the reg event package terminated since the NOTIFY request was received with Subscription-State header field containing the value of \"terminated\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2\tSubscription and notification",
                            "text_content": "Upon receipt of a NOTIFY request for the dialog associated with the subscription to the reg event package the UE shall perform the following actions:\n-\tstore the information for the established dialog;\n-\tstore the expiration time as indicated in the \"expires\" header field parameter of the Subscription-State header field, if present, of the NOTIFY request. Otherwise the expiration time is retrieved from the Expires header field of the 2xx response to SUBSCRIBE request;\n-\tif a <registration> element with state attribute \"active\", i.e. registered, is received for one or more public user identities, the UE shall store the indicated public user identities as registered;\n-\tif a <registration> element with state attribute \"active\" is received, and the UE supports GRUU (see table A.4, item A.4/53), then for each public user identity indicated in the notification that contains a <pub-gruu> element or a <temp-gruu> element or both (as defined in RFC 5628 [94]), the UE shall store the value of those elements in association with the public user identity;\n-\tif a <registration> element with state attribute \"terminated\", i.e. deregistered, is received for one or more public user identities, the UE shall store the indicated public user identities as deregistered and shall remove any associated GRUUs; and\nNOTE 1:\tThere can be public user identities which are automatically registered within the registrar (S-CSCF) of the user upon registration of one public user identity or when S-CSCF receives a Push-Profile-Request (PPR) from the HSS (as described in 3GPP TS 29.228 [14]) changing the status of a public user identity associated with a registered implicit set from barred to non-barred. Usually these automatically or implicitly registered public user identities belong to the same service profile of the user and they might not be available within the UE. The implicitly registered public user identities can also belong to different service profiles. The here-described procedures provide a different mechanism (to the 200 (OK) response to the REGISTER request) to inform the UE about these automatically registered public user identities.\nNOTE 2:\tRFC 5628 [94] provides guidance on the management of temporary GRUUs, utilizing information provided in the reg event notification.\n-\tfollow the procedures specified in RFC 6665 [28].\nIf the UE receives a 503 (Service Unavailable) response to an initial SUBSCRIBE request containing a Retry-After header field, then the UE shall not automatically reattempt the request until after the period indicated by the Retry-After header field contents.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2A\tGeneric procedures applicable to all methods excluding the REGISTER method",
                            "text_content": "The procedures of this subclause are general to all requests and responses, except those for the REGISTER method.\nWhen the UE re-uses a previously registered contact address, the UE shall remove any parameters dedicated to registration from the Contact header field (e.g. \"expires\").\nWhen the UE sends any request, the UE shall use either a given contact address that has been previously registered or a registration flow and the associated contact address (if the multiple registration mechanism is used) and shall:\n-\tif IMS AKA is in use as a security mechanism:\na)\tif the UE has not obtained a GRUU, populate the Contact header field of the request with the protected server port and the respective contact address; and\nb)\tinclude the protected server port and the respective contact address in the Via header field entry relating to the UE;\n-\tif SIP digest without  is in use as a security mechanism:\na)\tif the UE has not obtained a GRUU, populate the Contact header field of the request with the port value of an unprotected port and the contact address where the UE expects to receive subsequent mid-dialog requests;\nb)\tpopulate the Via header field of the request with the port value of an unprotected port and the respective contact address where the UE expects to receive responses to the request; and\nc)\tif a nonce value for proxy authentication is stored for the related registration or registration flow (if the multiple registration mechanism is used), insert a Proxy-Authorization header field containing a challenge response, constructed using the stored nonce value for proxy authentication for the same registration or registration flow (if the multiple registration mechanism is used), \"algorithm\", \"cnonce\", \"qop\", and \"nc\" header field parameters as specified in RFC 7616 [286] and RFC 8760 [287];\n-\tif SIP digest with  is in use as a security mechanism:\na)\tif the UE has not obtained a GRUU, populate the Contact header field of the request with the protected server port;\nb)\tinclude the protected server port in the Via header field entry relating to the UE; and\nc)\tif a nonce value for proxy authentication is stored for the related registration or registration flow (if the multiple registration mechanism is used), insert a Proxy-Authorization header field containing a challenge response, constructed using the stored nonce value for proxy authentication for the same registration or registration flow (if the multiple registration mechanism is used), \"algorithm\", \"cnonce\", \"qop\", and \"nc\" header field parameters as specified in RFC 7616 [286] and RFC 8760 [287];\n-\tif NASS-IMS bundled authentication is in use as a security mechanism, and therefore no port is provided for subsequent SIP messages by the P-CSCF during registration, the UE shall send any request to the same port used for the initial registration as described in subclause 5.1.1.2;\n-\tif GPRS-IMS-Bundled authentication is in use as a security mechanism, and therefore no port is provided for subsequent SIP messages by the P-CSCF during registration, the UE shall send any request to the same port used for the initial registration as described in subclause 5.1.1.2.\nIf SIP digest without  is used, the UE shall not include RFC 3329 [48] header field s in any SIP messages.\nWhen SIP digest is in use, upon receiving a 407 (Proxy Authentication Required) response to an initial request, the originating UE shall:\n-\textract the digest-challenge parameters as indicated in RFC 7616 [286] and RFC 8760 [287] from the Proxy-Authenticate header field;\n-\tif the contained nonce value is associated to the realm used for the related REGISTER request authentication, store the contained nonce as a nonce value for proxy authentication associated to the same registration or registration flow (if the multiple registration mechanism is used) and shall delete any other previously stored nonce value for proxy authentication for this registration or registration flow;\n-\tcalculate the response as described in RFC 7616 [286] and RFC 8760 [287] using the stored nonce value for proxy authentication associated to the same registration or registration flow (if the multiple registration mechanism is used); and\n-\tsend a new request containing a Proxy-Authorization header field in which the header field parameters are populated as defined in RFC 7616 [286] and RFC 8760 [287] using the calculated response.\nWhere a security association or  session exists, the UE shall discard any SIP response that is not protected by the security association or  session and is received from the P-CSCF outside of the registration and authentication procedures. The requirements on the UE within the registration and authentication procedures are defined in subclause 5.1.1.\nFor a UE performing the functions of an external attached network operating in static mode, authentication can take place without a registration based on  client certificate. Before any originating or terminating procedures can take place between the UE performing the functions of an external attached operating in static mode and the P-CSCF or between the UE performing the functions of an external attached network operating in static mode and the IBCF of the IMS network, for security and authentication between the UE performing the functions of an external attached network operating in static mode and the IMS network, the UE performing the functions of an external attached network operating in static mode shall use the  procedures according to 3GPP TS 33.310 [19D] using certificates.\nIn accordance with RFC 3325 [34] the UE may insert a P-Preferred-Identity header field in any initial request for a dialog or request for a standalone transaction as a hint for creation of an asserted identity (contained in the P-Asserted-Identity header field) within the IM CN subsystem.\nNOTE 1:\tSince the S-CSCF uses the P-Asserted-Identity header field when checking whether the UE originating request matches the initial filter criteria, the P-Preferred-Identity header field inserted by the UE determines which services and applications are invoked.\nWhen sending any initial request for a dialog or request for a standalone transaction using either a given contact address that has been previously registered or a registration flow and the associated contact address (if the multiple registration mechanism is used), the UE may include any of the following in the P-Preferred-Identity header field:\n-\ta public user identity which has been registered by the user with the respective contact address;\n-\tan implicitly registered public user identity returned in a registration-state event package of a NOTIFY request whose <uri> sub-element inside the <contact> sub-element of the <registration> element is the same as the contact address being used for this request and was not subsequently deregistered or that has not expired; or\n-\tany other public user identity which the user has assumed by mechanisms outside the scope of this specification to have a current registration.\nNOTE 2:\tThe temporary public user identity specified in subclause 5.1.1.1 is not a public user identity suitable for use in the P-Preferred-Identity header field.\nNOTE 3:\tProcedures in the network require international public telecommunication numbers when telephone numbers are used in P-Preferred-Identity header field.\nNOTE 4:\tA number of header fields can reveal information about the identity of the user. Where privacy is required, implementers should also give consideration to other header fields that can reveal identity information. RFC 3323 [33] subclause 4.1 gives considerations relating to a number of header fields.\nWhere privacy is required, in any initial request for a dialog or request for a standalone transaction, the UE shall set a display-name of the From header field to \"Anonymous\" as specified in RFC 3261 [26] and set an addr-spec of the From header field to Anonymous User Identity as specified in 3GPP TS 23.003 [3].\nNOTE 5:\tThe contents of the From header field are not necessarily modified by the network based on any privacy specified by the user either within the UE indication of privacy or by network subscription or network policy. Therefore the user should include the value \"Anonymous\" whenever privacy is explicitly required. As the user can well have privacy requirements, terminal manufacturers should not automatically derive and include values in this header field from the public user identity or other values stored in or derived from the UICC. Where the user has not expressed a preference in the configuration of the terminal implementation, the implementation should assume that privacy is required. Users that require to identify themselves, and are making calls to SIP destinations beyond the IM CN subsystem, where the destination does not implement RFC 3325 [34], will need to include a value in the From header field other than Anonymous.\nThe UE shall determine the public user identity to be used for this request as follows:\n1)\tif a P-Preferred-Identity was included, then use that as the public user identity for this request; or\n2)\tif no P-Preferred-Identity was included, then use the default public user identity for the security association or  session and the associated contact address as the public user identity for this request;\nThe UE shall not include its \"+sip.instance\" header field parameter in the Contact header field in its non-register requests and responses except when the request or response is guaranteed to be sent to a trusted intermediary that will remove the \"+sip.instance\" header field parameter prior to forwarding the request or response to the destination.\nNOTE 6:\tSuch trusted intermediaries include an AS that all such requests as part of an application or service traverse. In order to ensure that all requests or responses containing the \"+sip.instance\" header field parameter are forwarded via the trusted intermediary the UE needs to have first verified that the trusted intermediary is present (e.g. first contacted via a registration or configuration procedure). Including the \"+sip.instance\" header field parameter containing an IMEI URN does not violate RFC 7254 [153] even when the UE requests privacy using RFC 3323 [33].\nIf this is a request for a new dialog, the Contact header field is populated as follows:\n1)\ta contact header value which is one of:\n-\tif a public GRUU value (\"pub-gruu\" header field parameter) has been saved associated with the public user identity to be used for this request, and the UE does not indicate privacy of the P-Asserted-Identity, then the UE should insert the public GRUU (\"pub-gruu\" header field parameter) value as specified in RFC 5627 [93]; or\n-\tif a temporary GRUU value (\"temp-gruu\" header field parameter) has been saved associated with the public user identity to be used for this request, and the UE does indicate privacy of the P-Asserted-Identity, then the UE should insert the temporary GRUU (\"temp-gruu\" header field parameter) value as specified in RFC 5627 [93];\n-\totherwise, a SIP  containing the contact address of the UE that has been previously registered without any contact parameters dedicated to registration procedure;\nNOTE 7:\tThe above items are mutually exclusive.\n2)\tinclude an \"ob\" SIP  parameter, if the UE supports multiple registrations, and the UE wants all subsequent requests in the dialog to arrive over the same flow identified by the flow token as described in RFC 5626 [92];\n3)\tif the request is related to an IMS communication service that requires the use of an ICSI then the UE shall include in a g.3gpp.icsi-ref media feature tag, as defined in subclause 7.9.2 and RFC 3841 [56B], the ICSI value (coded as specified in subclause 7.2A.8.2) for the IMS communication service. The UE may also include other ICSI values that the UE is prepared to use for all dialogs with the terminating UE(s); and\n4)\tif the request is related to an IMS application that is supported by the UE, then the UE may include in a g.3gpp.iari-ref media feature tag, as defined in subclause 7.9.3 and RFC 3841 [56B], the IARI value (coded as specified in subclause 7.2A.9.2) that is related to the IMS application and that applies for the dialog.\nIf this is a request within an existing dialog, and the request includes a Contact header field, then the UE should insert the previously used Contact header field.\nIf the UE support multiple registrations as specified in RFC 5626 [92], the UE should include option-tag \"outbound\" in the Supported header field.\nIf this is a request for a new dialog or standalone transaction and the request is related to an IMS communication service that requires the use of an ICSI then the UE:\n1)\tshall include the ICSI value (coded as specified in subclause 7.2A.8.2), for the IMS communication service that is related to the request in a P-Preferred-Service header field according to RFC 6050 [121]. If a list of network supported ICSI values was received as specified in 3GPP TS 24.167 [8G], the UE shall only include an ICSI value that is in the received list;\nNOTE 8: The UE only receives those ICSI values corresponding to the IMS communication services that the network provides to the user.\n2)\tmay include an Accept-Contact header field containing an ICSI value (coded as specified in subclause 7.2A.8.2) that is related to the request in a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 if the ICSI for the IMS communication service is known. The UE may remove one or more subclasses from an ICSI when including it in an Accept-Contact header field provided that the included ICSI corresponds to an IMS communication service.\nNOTE 9:\tIf the UE includes the same ICSI values into the Accept-Contact header field and the P-Preferred-Service header field, there is a possibility that one of the involved S-CSCFs or an AS changes the ICSI value in the P-Asserted-Service header field, which results in the message including two different ICSI values (one in the P-Asserted-Service header field, changed in the network and one in the Accept-Contact header field).\nIf an IMS application indicates that an IARI is to be included in a request for a new dialog or standalone transaction, the UE shall include an Accept-Contact header field containing an IARI value (coded as specified in subclause 7.2A.9.2) that is related to the request in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3841 [56B].\nNOTE 10:\tRFC 3841 [56B] allows multiple Accept-Contact header fields along with multiple Reject-Contact header fields in a SIP request, and within those header fields, expressions that include one or more logical operations based on combinations of media feature tags. Which registered UE will be contacted depends on the Accept-Contact header field and Reject-Contact header field combinations included that evaluate to a logical expression and the relative qvalues of the registered contacts for the targeted registered public user identity. There is therefore no guarantee that when multiple Accept-Contact header fields or additional Reject-Contact header field(s) along with the Accept-Contact header field containing the ICSI value or IARI value are included in a request that the request will be routed to a contact that registered the same ICSI value or IARI value. Charging and accounting is based upon the contents of the P-Asserted-Service header field and the actual media related contents of the SIP request and not the Accept-Contact header field contents or the contact reached.\nNOTE 11:\tThe UE only includes the header field parameters \"require\" and \"explicit\" in the Accept-Contact header field containing the ICSI value or IARI value if the IMS communication service absolutely requires that the terminating UE understand the IMS communication service in order to be able to accept the session. Including the header field parameters \"require\" and \"explicit\" in Accept-Contact header fields in requests which don't absolutely require that the terminating UE understand the IMS communication service in order to accept the session creates an interoperability problem for sessions which otherwise would interoperate and violates the interoperability requirements for the ICSI in 3GPP TS 23.228 [7].\nAfter the dialog is established the UE may change the dialog capabilities (e.g. add a media or request a supplementary service) if defined for the IMS communication service as identified by the ICSI value using the same dialog. Otherwise, the UE shall initiate a new initial request to the other user.\nThe UE can indicate privacy of the P-Asserted-Identity that will be generated by the P-CSCF in accordance with RFC 3323 [33], and the additional requirements contained within RFC 3325 [34].\nIf resource priority in accordance with RFC 4412 [116] is required for a dialog, then the UE shall include the Resource-Priority header field in all requests associated with that dialog.\nNOTE 12:\tThe case where the UE is unaware of the requirement for resource priority because the user requested the capability as part of the dialstring falls outside the scope of this requirement. Such cases can exist and will need to be dealt with by an appropriate functional entity (e.g. P-CSCF) to process the dialstring. For certain national implementations, signalling of a Resource-Priority header field to or from a UE is not required.\nIf available to the UE (as defined in the access technology specific annexes for each access technology), the UE shall insert a P-Access-Network-Info header field into any request for a dialog, any subsequent request (except CANCEL requests) or response (except CANCEL responses) within a dialog or any request for a standalone method (see subclause 7.2A.4). Insertion of the P-Access-Network-Info header field into the ACK request is optional.\nNOTE 13:\tDuring the dialog, the points of attachment to the IP-CAN of the UE can change (e.g. UE connects to different cells). The UE will populate the P-Access-Network-Info header field in any request or response within a dialog with the current point of attachment to the IP-CAN (e.g. the current cell information).\nNOTE 14:\tThe value of the P-Access-Network-Info header field could be stale if the point of attachment of the UE with the network changes before the message is received by the network.\nThe UE shall build a proper preloaded Route header field value for all new dialogs and standalone transactions. The UE shall build a list of Route header field values made out of the following, in this order:\na)\tthe P-CSCF  containing the IP address acquired at the time of the P-CSCF discovery procedures which was used in registration of the contact address (or registration flow); and\nNOTE 15:\tIf the UE is provisioned with or receives a FQDN at the time of the P-CSCF discovery procedures, the FQDN is resolved to an IP address at the time of the P-CSCF discovery procedures.\nb)\tthe P-CSCF port based on the security mechanism in use:\n-\tif IMS AKA or SIP digest with  is in use as a security mechanism, the protected server port learnt during the registration procedure;\n-\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled authentication is in use as a security mechanism, the unprotected server port used during the registration procedure;\nc)\tand the values received in the Service-Route header field saved from the 200 (OK) response to the last registration or reregistration of the public user identity with associated contact address.\nNOTE 16:\tWhen the UE registers multiple contact addresses, there will be a list of Service-Route headers for each contact address. When sending a request using a given contact address and the associated security associations or  session, the UE will use the corresponding list of Service-Route headers to construct a list of Route headers.\nThe UE may indicate that proxies should not fork the request by including a \"no-fork\" directive within the Request-Disposition header field in the request as described in RFC 3841 [56B].\nIf a request is for a new dialog or standalone transaction, and the request matches a trigger for starting logging of SIP signalling, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K], the UE shall:\n-\tstart to log SIP signalling for this dialog; and\n-\tin any requests or responses sent on this dialog, append a \"logme\" header field parameter to the SIP Session-ID header field.\nIf a request or response is sent on a dialog for which logging of signalling is in progress, the UE shall check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K].\na)\tIf a stop trigger event has occurred, the UE shall stop logging of signalling; or\nb)\tif a stop trigger event has not occurred, the UE shall:\n-\tin any requests or responses sent on this dialog, append a \"logme\" header field parameter to the SIP Session-ID header field; and\n-\tlog the request.\nIf the UE receives a 1xx or 200 (OK) response to an initial request for a dialog, the response containing a P-Asserted-Identity header field set to an emergency number as specified in 3GPP TS 22.101 [1A], the UE procedures in subclause 5.1.6.10 apply.\nIf the UE receives a 3xx response containing a Contact header field:\n1)\tif the 3xx response is a 380 (Alternative Service) response to an INVITE request the response containing a P-Asserted-Identity header field with a value equal to the value of the last entry of the Path header field value received during registration and the response contains a 3GPP IM CN subsystem XML body that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2) then the UE shall select a domain in accordance with the conventions and rules specified in 3GPP TS 22.101 [1A] and 3GPP TS 23.167 [4B], and:\n-\tif the CS domain is selected, the UE behavior is defined in subclause 7.1.2 of 3GPP TS 23.167 [4B] and, where appropriate, in the access technology specific annex;\n-\tif the IM CN subsystem is selected, the UE shall apply the procedures in subclause 5.1.6 with the exception of selecting a domain for the emergency call attempt; and\n2)\tif the response is:\n-\tnot a 380 (Alternative Service) response; or\n-\ta 380 (Alternative Service) response, and the response:\ni.\tdoes not contain a 3GPP IM CN subsystem XML body that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2); or\nii.\tdoes contain a 3GPP IM CN subsystem XML body that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2), and the response;\nI)\tdoes not contain a P-Asserted-Identity header field; or\nII)\tdoes contain a P-Asserted-Identity header field with a value not equal to the value of the last entry of the Path header field value received during registration;\nthe UE should not automatically recurse on the Contact header field without first indicating the identity of the user to which a request will be sent and obtaining authorisation of the served user.\nNOTE 17:\tThe last entry on the Path header field value received during registration is the value of the SIP  of the P-CSCF. If there are multiple registration flows associated with the registration, then the UE has received from the P-CSCF during registration multiple sets of Path header field values. The last entry of the Path header field value corresponding to the flow on which the 380 (Alternative Service) response was received is checked.\nNOTE 18:\tA UE can still automatically recurse on 3xx responses as part of a service if the nature of the service enables the UE to identify 3xx responses as having originated from the home network and networks trusted by the home network and the nature of the service ensures that the charging for the requests sent as a result of the 3xx response is correlated with the original request.\nNOTE 19:\tAutomatically recursing on untrusted 3xx responses opens up the UE to being redirected to premium rate URIs without the user's consent.\nThe UE performing the functions of an external attached network operating in static mode shall send all requests using the already established  session as described in this subclause.\nA UE supporting RFC 4028 [58], when it receives a 422 (Session Interval Too Small) to an INVITE request where the response contains a Min-SE header field, shall retry the request in accordance with RFC 4028 [58] subclause 7.4.\nThe UE may include a SIP  complying with RFC 3261 [26], a tel  complying with RFC 3966 [22], a pres  complying with RFC 3859 [179], an im  complying with RFC 3860 [180] or a mailto  complying with RFC 2368 [181].\nNOTE:\tThis version of the document does not specify how the UE determines the host part of the SIP .\nThe UE may use non-international formats of E.164 numbers or non-E.164 numbers, including geo-local numbers and home-local numbers and other local numbers (e.g. private number), in the Request-.\nThe actual value of the  depends on whether user equipment performs an analysis of the dial string input by the end user or not, see subclauses 5.1.2A.1.3 and 5.1.2A.1.4.\nIn this case the UE does not perform any analysis of the dial string. This requires that the dialling plan is designed so it enables the network to differentiate local numbers from other numbers.\nThe dial string is sent to the network, in the Request- of a initial request or a stand alone transaction, using one of the following formats:\n1)\ta tel-, syntactically complying with RFC 3966 [22], with the dial string encoded as a local number followed by a \"phone-context\" tel  parameter value;\nEXAMPLE:\ttel:00447700900123;phone-context=example.com\n2)\ta SIP , syntactically complying with RFC 3261 [26], with the user=phone parameter, embedding a tel- with a \"phone-context\" tel  parameter value;\nEXAMPLE:\tsip:00447700900123;\nphone-context=example.com@example.com;user=phone\n3)\ta SIP , complying with RFC 3261 [26] and RFC 4967 [103], with the user=dialstring parameter and with a \"phone-context\" tel- parameter value in the user part; or\nEXAMPLE:\tsip:00447700900123;\nphone-context=example.com@example.com;user=dialstring\n4)\ta SIP  syntactically complying with RFC 3261 [26], where the user part contains the dial string and the domain name is specific enough to enable to network to understand that the user part contains a dial string.\nEXAMPLE:\tsip:00447700900123@dialstrings.entreprise.com\nFor cases 1), 2), and 3) the UE shall set the \"phone-context\" tel  parameter in accordance with subclause 5.1.2A.1.5.\nIn this case the UE performs sufficient dial string analysis (or receives an explicit indication from the user) to identify the type of numbering that is used and processes the dial string accordingly before building the Request-.\nIf the UE detects that a local dialling plan is being used, where the UE is able to identify a global telephone number, the UE shall translate the number into E.164 international format after removing all dial string elements used for local numbering detection purposes (e.g. escape codes).\nIf the UE detects that a local (private or public) dialling plan is being used and the UE is not able to identify a global number, it may decide to send the dial string unchanged to the network as described in subclause 5.1.2A.1.3 or the UE may decide to alter it to comply with the local numbering plan (e.g. remove all dial string elements used for local numbering detection).\nIn the latter case the local numbering information is sent using one of the following formats:\n1)\ta tel-, complying with RFC 3966 [22], with a local number followed by a \"phone-context\" tel- parameter value;\n2)\ta SIP , complying with RFC 3261 [26], with the \"user\" SIP  parameter set to \"phone\" and a user part embedding a local number with a phone-context parameter; and\n3)\tif the UE intends to send information related to supplementary services, a SIP , complying with RFC 3261 [26] and RFC 4967 [103], with the \"user\" SIP  parameter set to \"dialstring\" and with a \"phone-context\" tel  parameter value in the user part.\nThe UE shall set the \"phone-context\" tel  parameter in accordance with subclause 5.1.2A.1.5.\nNOTE:\tThe way how the UE process the dial-string and handles special characters (e.g. pause) in order to produce a conformant SIP  or tel- according to RFC 3966 [22] is implementation specific.\nAs a general rule, recognition of special service numbers shall take priority over other dialling plan issues. If the dial string equates to a pre-configured service URN as specified in RFC 5031 [69]) then the service-urn should be sent.\nWhen the UE uses home-local number, the UE shall include in the \"phone-context\" tel  parameter the home network domain name in accordance with RFC 3966 [22].\nWhen the UE uses geo-local number, the UE shall:\n-\tif access technology information available to the UE (i.e., the UE can insert P-Access-Network-Info header field into the request), include the access technology information in the \"phone-context\" tel  parameter according to RFC 3966 [22] as defined in subclause 7.2A.10; and\n-\tif access technology information is not available to the UE (i.e., the UE cannot insert P-Access-Network-Info header field into the request), include in the \"phone-context\" tel  parameter the home network domain name prefixed by the \"geo-local.\" string according to RFC 3966 [22] as defined in subclause 7.2A.10.\nWhen the UE uses other local numbers, than geo-local number or home local numbers, e.g. private numbers that are different from home-local number or the UE is unable to determine the type of the dialled number, the UE shall include a \"phone-context\" tel  parameter set according to RFC 3966 [22], e.g. if private numbers are used a domain name to which the private addressing plan is associated. The \"phone-context\" value used in the case of other local numbers shall be different from \"phone-context\" values used with geo-local numbers and home-local numbers.\nNOTE 1:\tThe \"phone-context\" tel  parameter value can be entered or selected by the subscriber, or can be a \"pre-configured\" value (e.g. using OMA-DM with the management object specified in 3GPP TS 24.167 [8G]) inserted by the UE.\nNOTE 2:\tThe way how the UE determines whether numbers in a non-international format are geo-local, home-local or relating to another network in absence of matching UE configuration in subclause 5.1.2A.1.5A, is implementation specific.\nNOTE 3:\tHome operator's local policy can define a prefix string(s) to enable subscribers to differentiate dialling a geo-local number and/or a home-local number.\nPolicy on local numbers consists of zero or more parts of policy on local numbers\nA part of policy on local numbers indicates an IMS communication service (identified by an ICSI) in which the UE is to use a number in non-international format without associated \"phone-context\" value as:\n1)\ta geo-local number; or\n2)\ta home-local number.\nThe UE may support the policy on local numbers.\nIf the UE supports the policy on local numbers:\n1)\tif:\na)\tthe upper layers provide a number in non-international format to be included in Request-URI of a SIP request;\nb)\tthe upper layers do not provide a \"phone-context\" value associated with the number;\nc)\tthe UE is not configured to associate a particular \"phone-context\" value with the number; and\nd)\tthe SIP request is related to an IMS communication service (identified by an ICSI) indicated in a part of the policy on local numbers such that:\ni)\tthe part of the policy on local numbers indicates to use the number as a geo-local number, then the UE shall use the number as a geo-local number in subclause 5.1.2A.1.5; and\nii)\tthe part of the policy on local numbers indicates to use the number as a home-local number, then the UE shall use the number as a home-local number in subclause 5.1.2A.1.5; and\n2)\tthe UE may support being configured with the policy on local numbers using one or more of the following methods:\na)\tthe Policy_on_local_numbers node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Policy_on_local_numbers node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Policy_on_local_numbers node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the Policy_on_local_numbers node of 3GPP TS 24.167 [8G] and the Policy_on_local_numbers node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or the Policy_on_local_numbers node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B], then the Policy_on_local_numbers node of the EFIMSConfigData file shall take precedence.\nNOTE:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nIn the event the UE receives a 504 (Server Time-out) response containing:\n1)\ta P-Asserted-Identity header field set to a value equal to a :\na)\tfrom the Service-Route header field value received during registration; or\nb)\tfrom the Path header field value received during registration; and\nNOTE 1:\tIf there are multiple registration flows associated with the registration, then the UE has received from the P-CSCF during registration multiple sets of Path header field and Service-Route header field values. The Path header field value and Service-Route header field value corresponding to the flow on which the 504 (Server Time-out) response was received are checked.\n2)\ta Content-Type header field set according to subclause 7.6 (i.e. \"application/3gpp-ims+xml\"), independent of the value or presence of the Content-Disposition header field, independent of the value or presence of Content-Disposition parameters,\nthen the following treatment is applied:\na)\tif the 504 (Server Time-out) response includes an IM CN subsystem XML body as described in subclause 7.6 with the <ims-3gpp> element, including a version attribute, with the <alternative-service> child element:\nA)\twith the <type> child element set to \"restoration\" (see table 7.6.2); and\nB)\twith the <action> child element set to \"initial-registration\" (see table 7.6.3);\nthen the UE:\n-\tshall initiate S-CSCF restoration procedures by performing an initial registration as specified in subclause 5.1.1.2; and\n-\tmay provide an indication to the user based on the text string contained in the <reason> child element of the <alternative-service> child element of the <ims-3gpp> element.\nNOTE 2:\tIf the UE has discovered multiple P-CSCF addresses and has information that the P-CSCF was unable to forward the request resulting in sending back the 504 (Server Time-out) response, when starting the initial registration it is appropriate for the UE to select a P-CSCF address different from the one used for the registration binding on which the 504 (Server Time-out) response was received.\nWhen sending a request from a contact address that has been previously registered (or via a registration flow if the multiple registration mechanism is used) which is bound to a public user identity by registration which used a P-CSCF address, and:\n-\tif timer F expires in the \"Trying\" state of non-INVITE client transaction as described in IETF RFC 3261 [26];\n-\tif a fatal transport error is reported by the transport layer in the \"Trying\" state of non-INVITE client transaction as described in IETF RFC 3261 [26];\n-\tif timer B expires in the \"Calling\" state of INVITE client transaction as described in IETF RFC 6026 [163]; or\n-\tif a fatal transport error is reported by the transport layer in \"Calling\" state of INVITE client transaction as described in IETF RFC 6026 [163];\nthen the UE shall:\n1)\tif the multiple registration mechanism is not used:\nA)\tconsider the contact address as not bound to any public user identity;\nB)\tmark the currently used P-CSCF address (i.e. P-CSCF address using which the contact address was registered) as unavailable;\nC)\tif there is a locally stored P-CSCF addressas specified in subclause 5.1.9 which is  different than thecurrently used  P-CSCF address and which is not marked as unavailable, initiate an initial registration as specified in subclause 5.1.1.2 using that P-CSCF; and\nD)\tif there is no locally stored P-CSCF address as specified in subclause 5.1.9 which is different than the currently used P-CSCF address and which is not marked as unavailable, get a new set of P-CSCF addresses as described in subclause 9.2.1 unless otherwise specified in the access specific annexes (as described in annex B, annex L or annex U) and initiate an initial registration as specified in subclause 5.1.1.2; and\n2)\tif the multiple registration mechanism is used, declare the registration flow dead as defined in RFC 5626 [92] and mark the currently used P-CSCF address as unavailable.\nNOTE 3:\tWhen a fatal transport error occurs, further steps might be necessary to restore the transport layer, possibly including re-establishment of an IP-CAN bearer.\nWhen sending a request from a contact address that has been previously registered (or via a registration flow if the multiple registration mechanism is used) which is bound to a public user identity by registration which used a P-CSCF address, and if a 503 (Service Unavailable) response without a Retry-After header field is received for request as described in IETF RFC 3261 [26], the UE shall:\n1)\tif the multiple registration mechanism is not used:\nA)\tconsider the contact address as not bound to any public user identity;\nB)\tmark the currently used P-CSCF address (i.e. P-CSCF address using which the contact address was registered) as unavailable;\nC)\tif there is a locally stored P-CSCF address as specified in subclause 5.1.9 which is different than the currently used P-CSCF address and which is not marked as unavailable, initiate an initial registration as specified in subclause 5.1.1.2 using that P-CSCF; and\nD)\tif there is no locally stored P-CSCF address as specified in subclause 5.1.9 which is different than the currently used P-CSCF address and which is not marked as unavailable, get a new set of P-CSCF addresses as described in subclause 9.2.1 unless otherwise specified in the access specific annexes (as described in annex B, annex L or annex U) and initiate an initial registration as specified in subclause 5.1.1.2; and\n2)\tif the multiple registration mechanism is used, declare the registration flow dead as defined in RFC 5626 [92] and mark the currently used P-CSCF address as unavailable.\nWhen sending a request from a contact address that has been previously registered (or via a registration flow if the multiple registration mechanism is used) which is bound to a public user identity by registration which used a P-CSCF address, and if a 503 (Service Unavailable) response with a Retry-After header field is received for request as described in IETF RFC 3261 [26] and :\n-\tif the request was a non-INVITE request, the Retry-After header field indicates a time bigger than value for timer F as specified in table 7.7.1; and\n-\tif the request was an INVITE request, the Retry-After header field indicates a time bigger than value for timer B as specified in table 7.7.1;\nthe UE shall:\n1)\tif the multiple registration mechanism is not used:\nA)\tconsider the contact address as not bound to any public user identity;\nB)\tmark the currently used P-CSCF address (i.e. P-CSCF address using which the contact address was registered) as unavailable for the time indicated by the Retry-After header field;\nC)\tif there is a locally stored P-CSCF address as specified in subclause 5.1.9 which is different than the currently used P-CSCF address and which is not marked as unavailable, initiate an initial registration as specified in subclause 5.1.1.2 using that P-CSCF; and\nD)\tif there is no locally stored P-CSCF address as specified in subclause 5.1.9 which is different than the currently used P-CSCF address and which is not marked as unavailable, get a new set of P-CSCF addresses as described in subclause 9.2.1 unless otherwise specified in the access specific annexes (as described in annex B, annex L or annex U) and initiate an initial registration as specified in subclause 5.1.1.2; and\n2)\tif the multiple registration mechanism is used, declare the registration flow dead as defined in RFC 5626 [92] and mark the currently used P-CSCF address as unavailable for the time indicated by the Retry-After header field.\nNOTE 4:\tif the Retry-After header field indicates time smaller than the value for timer F or timer B as specified in table 7.7.1, the UE continues using the currently used P-CSCF address.\nThe procedures of this subclause are general to all requests and responses, except those for the REGISTER method.\nWhere a security association or  session exists, the UE shall discard any SIP request that is not protected by the security association or  session and is received from the P-CSCF outside of the registration and authentication procedures. The requirements on the UE within the registration and authentication procedures are defined in subclause 5.1.1.\nIf an initial request contains an Accept-Contact header field containing the g.3gpp.icsi-ref media feature tag with an ICSI value, the UE should invoke the IMS application that is the best match for the ICSI value.\nIf an initial request contains an Accept-Contact header field containing the g.3gpp.iari-ref media feature tag with an IARI value the UE should invoke the IMS application that is the best match for the IARI value.\nThe UE can receive multiple ICSI values, IARI values or both in an Accept-Contact header field. In this case it is up to the implementation which of the multiple ICSI values or IARI values the UE takes action on.\nNOTE 1:\tThe application verifies that the contents of the request (e.g. SDP media capabilities, Content-Type header field) are consistent with the ICSI value in the g.3gpp.icsi-ref media feature tag and IARI value contained in the g.3gpp.iari-ref media feature tag.\nIf an initial request does not contain an Accept-Contact header field containing a g.3gpp.icsi-ref media feature tag or a g.3gpp.iari-ref media feature tag the UE shall invoke the application that is the best match based on the contents of the request (e.g. SDP media capabilities, Content-Type header field, media feature tag).\nThe UE can indicate privacy of the P-Asserted-Identity that will be generated by the P-CSCF in accordance with RFC 3323 [33], and the additional requirements contained within RFC 3325 [34].\nNOTE 2:\tIn the UE-terminating case, this version of the document makes no provision for the UE to provide a P-Preferred-Identity in the form of a hint.\nNOTE 3:\tA number of header fields can reveal information about the identity of the user. Where, privacy is required, implementers should also give consideration to other header fields that can reveal identity information. RFC 3323 [33] subclause 4.1 gives considerations relating to a number of header fields.\nThe UE shall not include its \"+sip.instance\" header field parameter in the Contact header field in its non-register requests and responses except when the request or response is guaranteed to be sent to a trusted intermediary that will remove the \"+sip.instance\" header field parameter prior to forwarding the request or response to the destination.\nNOTE 4:\tSuch trusted intermediaries include an AS that all such requests as part of an application or service traverse. In order to ensure that all requests or responses containing the \"+sip.instance\" header field parameter are forwarded via the trusted intermediary the UE needs to have first verified that the trusted intermediary is present (e.g first contacted via a registration or configuration procedure). Including the \"+sip.instance\" header field parameter containing an IMEI URN does not violate RFC 7254 [153] even when the UE requests privacy using RFC 3323 [33].\nIf the response includes a Contact header field, and the response is sent within an existing dialog, and the Contact address previously used in the dialog was a GRUU, then the UE should insert the previously used GRUU value in the Contact header field as specified in RFC 5627 [93].\nIf the response includes a Contact header field, and the response is not sent within an existing dialog, the Contact header field is populated as follows:\n1)\tif a public GRUU value (\"pub-gruu\" header field parameter) has been saved associated with the public user identity from the P-Called-Party-ID header field, and the UE does not indicate privacy of the contents of the P-Asserted-Identity header field, then the UE should insert the public GRUU (\"pub-gruu\" header field parameter) value as specified in RFC 5627 [93];\n2)\tif a temporary GRUU value (\"temp-gruu\" header field parameter) has been saved associated with the public user identity from the P-Called-Party-ID header field, and the UE does indicate privacy of the P-Asserted-Identity, then should insert the temporary GRUU (\"temp-gruu\" header field parameter) value in the Contact header field as specified in RFC 5627 [93];\nNOTE 5: The above items 1 and 2 are mutually exclusive.\n3)\tif the request is related to an IMS communication service that requires the use of an ICSI then the UE shall include in a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 and RFC 3841 [56B] the ICSI value (coded as specified in subclause 7.2A.8.2), for the IMS communication service and then the UE may include the IARI value for any IMS application that applies for the dialog, (coded as specified in subclause 7.2A.9.2), that is related to the request in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3841 [56B]. The UE may also include other ICSI values that the UE is prepared to use for all dialogs with the originating UE(s) and other IARI values for the IMS application that is related to the IMS communication service; and\n4)\tif the request is related to an IMS application that is supported by the UE when the use of an ICSI is not needed, then the UE may include the IARI value (coded as specified in subclause 7.2A.9.2), that is related to any IMS application and that applies for the dialog, in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3841 [56B].\nAfter the dialog is established the UE may change the dialog capabilities (e.g. add a media or request a supplementary service) if defined for the IMS communication service as identified by the ICSI value using the same dialog. Otherwise, the UE shall initiate a new initial request to the other user.\nIf the UE did not insert a GRUU in the Contact header field then the UE shall include a contact address that has been previously registered with contact parameters used for registration removed and a port in the address in the Contact header field as follows:\n-\tif IMS AKA or SIP digest with  is being used as a security mechanism, the protected server port value as in the initial registration; or\n-\tif SIP digest without  is being used as a security mechanism, the port value of an unprotected port where the UE expects to receive subsequent mid-dialog requests. The UE shall set the unprotected port value to the port value used in the initial registration.\nIf the UE receives a Resource-Priority header field in accordance with RFC 4412 [16] in an initial request for a dialog, then the UE shall include the Resource-Priority header field in all requests associated with that dialog.\nNOTE 6:\tFor certain national implementations, signalling of a Resource-Priority header field to and from a UE is not required.\nIf available to the UE (as defined in the access technology specific annexes for each access technology), the UE shall insert a P-Access-Network-Info header field into any response to a request for a dialog, any subsequent request (except CANCEL requests) or response (except CANCEL responses) within a dialog or any response to a standalone method (see subclause 7.2A.4).\nThe terminating UE shall not include the P-Early-Media header field in any SIP messages, unless the terminating UE is a UE performing the functions of an external attached network that is allowed to send early media.\nIf a request or response is sent on a dialog for which logging of signalling is in progress, the UE shall check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K].\na)\tIf a stop trigger event has occurred, the UE shall stop logging of signalling; or\nb)\tif a stop trigger event has not occurred, the UE shall:\n-\tin any requests or responses sent on this dialog, append a \"logme\" header field parameter to the SIP Session-ID header field; and\n-\tlog the request or response.\nThe UE shall not support RFC 7090 [209] (see table A.4, item A.4/116) and, in this version of the specification, the UE shall not perform any specific procedures beyond those defined in RFC 3261 [26] for the Priority header field.\nNOTE 7:\tThe mechanism specified in RFC 7090 [209] is based on the presence of a trust domain for the Priority header field in the operator's network. The UE is not aware whether a trust domain for the Priority header field exists in the operator's network.\nIf the terminating UE needs to retrieve the last service access number when the AS applies a number translation as described in subclause 5.7.1.22; the terminating UE can find the requested service access number in the hi-entry within the History-Info header field having a hi-index that match the \"mp\" or \"rc\" header field parameter value of the last hi-entry containing a \"cause\" SIP URI parameter, defined in RFC 4458 [68], set to the value \"380\" defined in RFC 8119 [230]. If no \"mp\" or \"rc\" header field parameter is received in the concerned hi-entry, the service access number can be found in the hi-entry preceding the hi-entry with the \"cause\" SIP URI parameter set to \"380\".\nIf the terminating UE\na)\tsupports calling number verification status determination;\nb)\tduring registration determined that the home network supports calling number verification using signature verification as and attestation information, as defined in subclause 3.1; and\nc)\treceives initial INVITE request for a dialog or a MESSAGE request containing a P-Asserted-Identity header field or a From header field with a \"verstat\" tel URI parameter in a tel URI or a SIP URI with a user=phone parameter;\nthen the terminating UE shall:\na)\tdetermine the calling number verification status based on the \"verstat\" tel URI parameter value; and\nb)\tif unable to determine the calling number verification status based on the \"verstat\" parameter value, discard the parameter and treat the P-Asserted-Identity header field and the From header field in the same way as if the parameter would not have been included.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.3\tCall initiation - UE-originating case",
                            "text_content": "Where multiple domains exist for initiating a call/session, before sending an initial INVITE request, the UE shall perform access domain selection in accordance with the appropriate specification for the IP-CAN in use, taking into account the media to be requested. Access domain selection allows the policy of the network operator to be taken into account before the initial INVITE request is sent. Access dependent aspects of access domain selection are defined in the access technology specific annexes for each access technology.\nUpon generating an initial INVITE request, the UE shall include the Accept header field with \"application/sdp\", the MIME type associated with the 3GPP IM CN subsystem XML body (see subclause 7.6.1) and any other MIME type the UE is willing and capable to accept.\nThe \"integration of resource management and SIP\" extension is hereafter in this subclause referred to as \"the precondition mechanism\" and is defined in RFC 3312 [30] as updated by RFC 4032 [64].\nThe preconditions mechanism should be supported by the originating UE.\nIf the precondition mechanism is disabled as specified in subclause 5.1.5A, the UE shall not use the precondition mechanism.\nThe UE may initiate a session without the precondition mechanism if the originating UE does not require local resource reservation.\nNOTE 1:\tThe originating UE can decide if local resource reservation is required based on e.g. application requirements, current access network capabilities, local configuration, etc.\nIn order to allow the peer entity to reserve its required resources, if the precondition mechanism is enabled as specified in subclause 5.1.5A; the originating UE supporting the precondition mechanism should make use of the precondition mechanism, even if it does not require local resource reservation.\nUpon generating an initial INVITE request using the precondition mechanism, the UE shall:\n-\tindicate the support for reliable provisional responses and specify it using the Supported header field; and\n-\tindicate the support for the preconditions mechanism and specify it using the Supported header field.\nUpon generating an initial INVITE request using the precondition mechanism, the UE shall not indicate the requirement for the precondition mechanism by using the Require header field.\nDuring the session initiation, if the originating UE indicated the support for the precondition mechanism in the initial INVITE request and:\na)\tthe received response with an SDP body includes a Require header field with \"precondition\" option-tag, the originating UE shall include a Require header field with the \"precondition\" option-tag:\n-\tin subsequent requests that include an SDP body, that the originating UE sends in the same dialog as the response is received from; and\n-\tin responses with an SDP body to subsequent requests that include an SDP body and include \"precondition\" option-tag in Supported header field or Require header field received in-dialog; or\nb)\tthe received response with an SDP body does not include the \"precondition\" option-tag in the Require header field,\n-\tin subsequent requests that include an SDP body, the originating UE shall not include a Require or Supported header field with \"precondition\" option-tag in the same dialog;\n-\tin responses with an SDP body to subsequent requests with an SDP body but without \"precondition\" option-tag in the Require or Supported header field, the originating UE shall not include a Require or Supported header field with \"precondition\" option-tag in the same dialog; and\n-\tin responses with an SDP body to subsequent requests with an SDP body and with \"precondition\" option-tag in the Require or Supported header field, the originating UE shall include a Require header field with \"precondition\" option-tag in the same dialog.\nNOTE 2:\tTable A.4 specifies that UE support of forking is required in accordance with RFC 3261 [26]. The UE can accept or reject any of the forked responses, for example, if the UE is capable of supporting a limited number of simultaneous transactions or early dialogs.\nIf the precondition mechanism is used, the UE shall, upon successful reservation of local resources, confirm the successful resource reservation (see subclause 6.1.2) within the next SIP request.\nNOTE 3:\tThe next SIP request will be either a PRACK request or an UPDATE request.\nNOTE 4:\tThe UE can receive a P-Early-Media header field authorizing an early-media flow while the required preconditions, if any, are not met and/or the flow direction is not enabled by the SDP direction parameter. According to RFC 5009 [109], an authorized early-media flow can be established only if the necessary conditions related to the SDP negotiation are met. These conditions can evolve during the session establishment.\nNOTE 5:\tWhen the UE is confirming the successful resource reservation using an UPDATE request (or a PRACK request) and the UE receives a 180 (Ringing) response or a 200 (OK) response to the initial INVITE request before receiving a 200 (OK) response to the UPDATE request (or a 200 (OK) response to the PRACK request), the UE does not treat this as an error case and does not release the session.\nNOTE 6:\tThe UE procedures for rendering of the received early media and of the locally generated communication progress information are specified in 3GPP TS 24.628 [8ZF].\nIf the UE wishes to receive early media authorization indications, as described in RFC 5009 [109], the UE shall add the P-Early-Media header field with the \"supported\" parameter to the initial INVITE request.\nA UE supporting the Session Timer extension as described in RFC 4028 [58] may support the extension being configured using Session_Timer_Support node specified in 3GPP TS 24.167 [8G].\nIf the UE supports the Session Timer extension, the UE shall include the option-tag \"timer\" in the Supported header field and should either insert a Session-Expires header field with the header field value set to the configured session timer interval value, or should not include the Session-Expires header field in the initial INVITE request. The header field value of the Session-Expires header field may be configured using local configuration or using the Session_Timer_Initial_Interval node specified in 3GPP 24.167 [8G]. If the UE is configured with both the local configuration and the Session_Timer_Initial_Interval node specified in 3GPP 24.167 [8G], then the local configuration shall take precedence.\nIf the UE inserts the Session-Expires header field in the initial INVITE request, the UE may also include the \"refresher\" parameter with the \"refresher\" parameter value set to \"uac\".\nWhen a final answer is received for one of the early dialogs, the UE proceeds to set up the SIP session. The UE shall not progress any remaining early dialogs to established dialogs. Therefore, upon the reception of a subsequent final 200 (OK) response for an INVITE request (e.g., due to forking), the UE shall:\n1)\tacknowledge the response with an ACK request; and\n2)\tsend a BYE request to this dialog in order to terminate it.\nUpon receiving a 488 (Not Acceptable Here) response to an initial INVITE request, the originating UE should send a new INVITE request containing SDP according to the procedures defined in subclause 6.1.\nNOTE 7:\tAn example of where a new request would not be sent is where knowledge exists within the UE, or interaction occurs with the user, such that it is known that the resulting SDP would describe a session that did not meet the user requirements.\nUpon receiving a 421 (Extension Required) response to an initial INVITE request in which the precondition mechanism was not used, including the \"precondition\" option-tag in the Require header field, if the UE supports the precondition mechanism and the precondition mechanism is enabled as specified in subclause 5.1.5A, the originating UE shall:\n-\tsend a new INVITE request using the precondition mechanism; and\n-\tsend an UPDATE request as soon as the necessary resources are available and a 200 (OK) response for the first PRACK request has been received.\nUpon receiving a 503 (Service Unavailable) response to an initial INVITE request containing a Retry-After header field, then the originating UE shall not automatically reattempt the request via the same P-CSCF until after the period indicated by the Retry-After header field contents.\nThe UE may include a \"cic\" tel  parameter in a tel , or in the userinfo part of a SIP  with user=phone, in the Request- of an initial INVITE request if the UE wants to identify a user-dialed carrier, as described in RFC 4694 [112].\nNOTE 8:\tThe method whereby the UE determines when to include a \"cic\" tel- parameter and what value it should contain is outside the scope of this document (e.g. the UE could use a locally configured digit map to look for special prefix digits that indicate the user has dialled a carrier).\nNOTE 9:\tThe value of the \"cic\" tel- parameter reported by the UE is not dependent on UE location (e.g. the reported value is not affected by roaming scenarios).\nIn the event the UE receives a 380 (Alternative Service) response to an initial INVITE request the response containing a P-Asserted-Identity header field with a value equal to the value of the last entry of the Path header field value received during registration and the response containing a 3GPP IM CN subsystem XML body that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2), the UE shall select a domain in accordance with the conventions and rules specified in 3GPP TS 22.101 [1A] and 3GPP TS 23.167 [4B], and:\n-\tif the CS domain is selected, the UE behavior is defined in subclause 7.1.2 of 3GPP TS 23.167 [4B] and, where appropriate, in the access technology specific annex; and\n-\tif the IM CN subsystem is selected, the UE shall apply the procedures in subclause 5.1.6 with the exception of selecting a domain for the emergency call attempt.\nNOTE 10:\tThe last entry on the Path header field value received during registration is the value of the SIP  of the P-CSCF. If there are multiple registration flows associated with the registration, then the UE has received from the P-CSCF during registration multiple sets of Path header field values. The last entry of the Path header field value corresponding to the flow on which the 380 (Alternative Service) response was received is checked.\nUpon receiving a 199 (Early Dialog Terminated) provisional response to an established early dialog the UE shall release resources specifically related to that early dialog.\nThe UE shall include the media feature tags defined in RFC 3840 [62] and RFC 5688 [120] for all supported streaming media types in the initial INVITE request.\nIf the UE sends a CANCEL request to cancel an initial INVITE request, the UE shall when applicable include in the CANCEL request a Reason header field with a protocol value set to \"RELEASE_CAUSE\" and a \"cause\" header field parameter as specified in subclause 7.2A.18.11.2. The UE may also include the \"text\" header field parameter with reason-text as specified in subclause 7.2A.18.11.2.\nUpon receiving a 500 (Server Internal Error) response to an initial INVITE request including a Reason header field with a protocol value set to \"FAILURE_CAUSE\" and a cause header field parameter value set to \"1\" as specified in subclause 7.2A.18.12.2 and a Response-Source header field with a \"fe\" header field parameter set to \"<urn:3gpp:fe:p-cscf.orig>\", the UE can determine that the QoS or bearer resources in the originating IP-CAN is not available.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.4\tCall initiation - UE-terminating case",
                            "text_content": "The preconditions mechanism should be supported by the terminating UE.\nThe handling of incoming initial INVITE requests at the terminating UE is mainly dependent on the following conditions:\n-\tthe specific service requirements for \"integration of resource management and SIP\" extension (hereafter in this subclause known as the precondition mechanism and defined in RFC 3312 [30] as updated by RFC 4032 [64], and with the request for such a mechanism known as a precondition);\n-\tthe UEs configuration for the case when the specific service does not require the precondition mechanism; and\n-\tthe precondition disabling policy specified in subclause 5.1.5A, if supported by the UE.\nIf an initial INVITE request is received the terminating UE shall check whether the terminating UE requires local resource reservation.\nNOTE 1:\tThe terminating UE can decide if local resource reservation is required based on e.g. application requirements, current access network capabilities, local configuration, etc.\nDuring the session initiation, if local resource reservation is required at the terminating UE and the terminating UE supports the precondition mechanism, and:\na)\tthe received INVITE request includes the \"precondition\" option-tag in the Supported header field or Require header field and the precondition mechanism is enabled as specified in subclause 5.1.5A, the terminating UE shall use the precondition mechanism and shall include a Require header field with the \"precondition\" option-tag:\n-\tin responses to that INVITE request if those responses include an SDP body;\n-\tin responses to subsequent requests received in-dialog that include an SDP body and include \"precondition\" option-tag in Supported header field or Require header field; and\n-\tin subsequent requests that include an SDP body, that it sends towards the originating UE during the session initiation;\nb)\tthe received INVITE request includes the \"precondition\" option-tag in the Supported header field, and the precondition mechanism is disabled as specified in subclause 5.1.5A, the terminating UE shall not use the precondition mechanism:\nc)\tthe received INVITE request includes the \"precondition\" option-tag in the Require header field, and the precondition mechanism is disabled as specified in subclause 5.1.5A, the terminating UE shall reject the INVITE request with a 420 (Bad Extension) response; and\nd)\tthe received INVITE request does not include the \"precondition\" option-tag in the Supported header field or Require header field, the terminating UE shall not use the precondition mechanism.\nDuring the session initiation, if local resource reservation is not required by the terminating UE and the terminating UE supports the precondition mechanism and:\na)\tthe received INVITE request includes the \"precondition\" option-tag in the Supported header field and:\ni)\tthe required resources at the originating UE are not reserved, and the precondition mechanism is enabled as specified in subclause 5.1.5A, the terminating UE shall use the precondition mechanism and shall include a Require header field with the \"precondition\" option-tag:\n-\tin responses to that INVITE request if those responses include an SDP body;\n-\tin responses with an SDP body to subsequent requests received in-dialog that include an SDP body and include \"precondition\" option-tag in Supported header field or Require header field; and\n-\tin subsequent requests that include an SDP body, that it sends towards the originating UE during the session initiation;\nii)\tthe required local resources at the originating UE and the terminating UE are available and the precondition mechanism is enabled as specified in subclause 5.1.5A, the terminating UE may use the precondition mechanism; and\niii)\tthe precondition mechanism is disabled as specified in subclause 5.1.5A, the terminating UE shall not use the precondition mechanism;\nb)\tthe received INVITE request does not include the \"precondition\" option-tag in the Supported header field or Require header field, the terminating UE shall not use the precondition mechanism;\nc)\tthe received INVITE request includes the \"precondition\" option-tag in the Require header field and the precondition mechanism is enabled as specified in subclause 5.1.5A, the terminating UE shall use the precondition mechanism; and\nd)\tthe received INVITE request includes the \"precondition\" option-tag in the Require header field, and the precondition mechanism is disabled as specified in subclause 5.1.5A, the terminating UE shall reject the INVITE request with a 420 (Bad Extension) response.\nNOTE 2:\tTable A.4 specifies that UE support of forking is required in accordance with RFC 3261 [26].\nNOTE 3:\tIf the terminating UE does not support the precondition mechanism it will apply regular SIP session initiation procedures.\nIf the received INVITE request indicated support for reliable provisionable responses, but did not require their use and the terminating UE supports reliable provisional responses, and if:\na)\tthe terminating UE requires a reliable alerting indication at the originating side;\nb)\tthe 18x response (other than 183 response) carries SDP or for other application related purposes that requires its reliable transport; or\nc)\tthe reliable 18x policy indicates (see subclause 5.1.4.2) the UE to do so;\nthe terminating UE shall send the 18x response (other than 183 response) reliably.\nNOTE 4:\tIf the terminating UE is configured by the home operator to send the 18x response (other than 183 response) reliably and the received INVITE request did not indicate support for reliable provisional responses, then the terminating UE sends the 18x response (other than 183 response) unreliably.\nThe terminating UE shall send the 18x responses (other than 183 response) unreliably if the reliable 18x policy (see subclause 5.1.4.2) indicates the UE to do so, unless the received INVITE request requires to use reliable provisional responses.\nNOTE 5:\tCertain applications, services and operator policies might mandate the terminating UE to send a 199 (Early Dialog Terminated) provisional response (see RFC 6228 [142]) prior to sending a non-2xx final response to the INVITE request.\nIf the terminating UE uses the precondition mechanism, upon successful reservation of local resources:\n-\tif the originating side requested confirmation for the result of the resource reservation (as defined in RFC 3312 [30]) at the terminating UE, the terminating UE shall confirm the successful resource reservation (see subclause 6.1.3) within an SIP UPDATE request; and\nNOTE 6:\tOriginating side requests confirmation for the result of the resource reservation at the terminating UE e.g. when an application server performs 3rd party call control. The request for confirmation for the result of the resource reservation at the terminating UE can be included e.g. in the SDP answer in the PRACK request.\n-\tif the originating side did not request confirmation for the result of the resource reservation (as defined in RFC 3312 [30]) at the terminating UE, the terminating UE shall not confirm the successful resource reservation (see subclause 6.1.3) within an UPDATE request.\nNOTE 7:\tThe terminating UE can send an UPDATE request for reasons other than confirmation of the successful resource reservation.\nNOTE 8:\tIf the terminating UE supports the precondition mechanism and has indicated the resources are not available or sufficient during SDP negotiation, the UE sends 180 (Ringing) response after the resources on the terminating side are successfully reserved.\nIf the terminating UE included an SDP offer or an SDP answer in a reliable provisional response to the INVITE request and both the terminating UE and the originating UE support UPDATE method, then in order to remove one or more media streams negotiated in the session for which a final response to the INVITE request has not been sent yet, the terminating UE shall send an UPDATE request with a new SDP offer and delays sending of 200 (OK) response to the INVITE request till after reception of 200 (OK) response to the UPDATE request.\nIf the user does not accept a media stream accepted in the SDP answer and the terminating UE, the originating UE or both do not support the UPDATE method, then after reception of ACK request related to 200 (OK) response to the INVITE request, the UE shall modify the session.\nThe terminating UE shall include the media feature tags defined in RFC 3840 [62] and RFC 5688 [120] for all supported streaming media types in the SIP response other than the 100 (Trying) response to the SIP INVITE request.\nIf the received INVITE request was received over a registration for which the 200 (OK) contained a Feature-Caps header field including the \"+sip.607\" header field parameter the UE may send a 607 (Unwanted) response as specified in RFC 8197 [254].\nNOTE 9:\t607 (Unwanted) response is normally sent after user interaction.\nIf the terminating UE supports the Session Timer extension, as described in RFC 4028 [58], and if the received INVITE request includes the \"timer\" option tag in the Supported header field, then the terminating UE shall behave as described in RFC 4028 [58] with the following clarification:\n-\tIf the received INVITE request does not contain the Session-Expires header field, then the terminating UE shall include a Session-Expires header field with the header field value set to the greater of the configured session timer interval value or the value contained in the Min-SE header field (if present, in the received INVITE), and the \"refresher\" parameter set to the configured \"refresher\" parameter value in the 200 (OK) response to the INVITE request. The session timer interval value may be configured using local configuration or the Session_Timer_Initial_Interval node specified in 3GPP 24.167 [8G]. If the UE is configured with both the local configuration and the Session_Timer_Initial_Interval node, then the local configuration shall take precedence. The\"refresher\" parameter value may be configured using local configuration or using the Session_Timer_Initial_MT_Refresher node specified in 3GPP 24.167 [8G]. If the UE is configured with both the local configuration and the Session_Timer_Initial_MT_Refresher node, then the local configuration shall take precedence;\n-\tIf the received INVITE request includes the \"timer\" option tag in the Supported header field and contains the Session-Expires header field without \"refresher\" parameter, then the terminating UE shall include a Session-Expires header field with the \"refresher\" parameter set to the configured \"refresher\" parameter value in the 200 (OK) response to the INVITE request, and shall set the header field value of the Session-Expires header field of the 200 (OK) response to the INVITE request to the value received in the INVITE request. The \"refresher\" parameter value may be configured using local configuration or using the Session_Timer_Initial_MT_Refresher node specified in 3GPP 24.167 [8G]. If the UE is configured with both the local configuration and the Session_Timer_Initial_MT_Refresher node specified in 3GPP 24.167 [8G], then the local configuration shall take precedence; or\n-\tIf the received INVITE request contains the Session-Expires header field with \"refresher\" parameter, then the terminating UE shall include a Session-Expires header field with the \"refresher\" parameter set to the received \"refresher\" parameter value in the 200 (OK) response to the INVITE request, and shall set the header field value of the Session-Expires header field of the 200 (OK) response to the INVITE request to the value received in the INVITE request.\nThe reliable 18x policy consists of one or more reliable 18x policy parts.\nThe reliable 18x policy part consists of a mandatory send 18x reliably configuration and an optional ICSI condition.\nA 18x response (other than 183 response) to an INVITE request is to be sent reliably according to the reliable 18x policy if:\n1)\tan INVITE request indicates support for reliable provisional responses; and\n2)\tthe terminating UE supports reliable provisional responses;\nand if the reliable 18x policy contains a reliable 18x policy part such that:\n1)\tthe send 18x reliably configuration indicates to send 18x responses reliably; and\n2)\tthe following is true:\na)\tthe corresponding INVITE request is subject to an IMS communication service identified in the ICSI condition of the reliable 18x policy part; or\nb)\tthe reliable 18x policy part does not have the ICSI condition.\nA 18x response (other than 183 response) to an INVITE request is to be sent unreliably according to the reliable 18x policy if the INVITE request does not require use of reliable provisional responses and the reliable 18x policy contains a reliable 18x policy part such that:\n1)\tthe send 18x reliably configuration indicates to send 18x responses unreliably; and\n2)\tthe following is true:\na)\tthe corresponding INVITE request is subject to an IMS communication service identified in the ICSI condition of the reliable 18x policy part; or\nb)\tthe reliable 18x policy part does not have the ICSI condition.\nIf the INVITE request is subject to an IMS communication service which does not match the ICSI condition in any of the reliable 18x policy parts and if there is no reliable 18x policy part without ICSI, it is IMS communication service and/or implemention dependent whether to send the SIP 18x responses reliably.\nNOTE 1:\tSome IMS communication services require that SIP 18x responses are not sent reliably. Mandating that the UE send all SIP 18x responses reliably could prevent those IMS communication services from operating correctly.\nThe UE may support the reliable 18x policy.\nThe UE may support being configured with the reliable 18x policy using one or more of the following methods:\na)\tthe Reliable_18x_policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Reliable_18x_policy node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Reliable_18x_policy node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the Reliable_18x_policy node of 3GPP TS 24.167 [8G] and the Reliable_18x_policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the Reliable_18x_policy node of the EFIMSConfigData file shall take precedence.\nNOTE 2:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.4A\tSession modification",
                            "text_content": "This subclause applies after the 2xx response to the initial INVITE request has been sent or received.\nIf the precondition mechanism was used during the session establishment, as described in subclause 5.1.3.1 or 5.1.4.1, the UE shall indicate support of the precondition mechanism during a session modification. If the precondition mechanism was not used during the session establishment, the UE shall not indicate support of the precondition mechanism during a session modification.\nIn order to indicate support of the precondition mechanism during a session modification, upon generating a reINVITE request, an UPDATE request with an SDP body, or a PRACK request with an SDP body, the UE shall:\na)\tindicate the support for the precondition mechanism using the Supported header field;\nb)\tnot indicate the requirement for the precondition mechanism using the Require header field; and\nc)\tif a re-INVITE request is being generated, indicate the support for reliable provisional responses using the Supported header field;\nand follow the SDP procedures in clause 6 for the precondition mechanism.\nUpon receiving a reINVITE request, an UPDATE request, or a PRACK request that indicates support for the precondition mechanism by using the Supported header field or requires use of the precondition mechanism by using the Require header field, the UE shall:\na)\tif the precondition mechanism was used during the session establishment, as described in subclause 5.1.3.1 or 5.1.4.1, use the precondition mechanism for the session modification; and\nb)\tif the precondition mechanism was not used during the session establishment, and:\n1)\tif the use of the precondition mechanism is required using the Require header field, reject the request by sending a 420 (Bad Extension) response; and\n2)\tif the support of the precondition mechanism is indicated using the Supported header field, not use the precondition mechanism for the session modification.\nIf the precondition mechanism is used for the session modification, the UE shall indicate support for the preconditions mechanism, using the Require header field, in responses that include an SDP body, to the session modification request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.5\tCall release",
                            "text_content": "If the UE sends a BYE request, the UE shall when applicable include in the BYE request a Reason header field with a protocol value set to \"RELEASE_CAUSE\" and a \"cause\" header field parameter as specified in subclause 7.2A.18.11.2. The UE may also include the \"text\" header field parameter with reason-text as specified in subclause 7.2A.18.11.2.\nIf the UE sends a BYE request, due to the call being unwanted, and the received INVITE request was received over a registration for which the 200 (OK) contained a Feature-Caps header field including the \"+sip.607\" header field parameter, the UE shall include in the BYE request a Reason header field with a protocol value set to \"SIP\" and a \"cause\" header field parameter set to \"607\" as specified in RFC 8197 [254]. The UE may also include the \"text\" header field parameter with reason-text as specified in RFC 8197 [254].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.5A\tPrecondition disabling policy",
                            "text_content": "The precondition disabling policy indicates whether the UE is allowed to use the precondition mechanism or whether the UE is not allowed to use the precondition mechanism.\nIf the precondition disabling policy is not configured, the precondition disabling policy is assumed to indicate that the UE is allowed to use the precondition mechanism.\nThe UE may support the precondition disabling policy.\nIf the UE supports the precondition disabling policy, the UE may support being configured with the precondition disabling policy using one or more of the following methods:\na)\tthe Precondition_disabling_policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Precondition_disabling_policy node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Precondition_disabling_policy node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the Precondition_disabling_policy node of 3GPP TS 24.167 [8G] and the Precondition_disabling_policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the Precondition_disabling_policy node of the EFIMSConfigData file shall take precedence.\nNOTE:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nThe precondition mechanims is disabled, if the UE supports the precondition disabling policy and the precondition disabling policy indicates that the UE is not allowed to use the precondition mechanism.\nThe precondition mechanism is enabled, if:\n1)\tthe UE does not support the precondition disabling policy; or\n2)\tthe UE supports the precondition disabling policy and the precondition disabling policy indicates that the UE is allowed to use the precondition mechanism.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.6\tEmergency service",
                            "text_content": "A CS and IM CN subsystem capable UE shall follow the conventions and rules specified in 3GPP TS 22.101 [1A] and 3GPP TS 23.167 [4B] to select the domain for the emergency call attempt. If the CS domain is selected, the UE shall attempt an emergency call setup using appropriate access technology specific procedures.\nNOTE 1:\tFor CS systems based on 3GPP TS 24.008 [8], clause B.5 applies.\nThe UE shall determine, whether it is currently attached to its home operator's network (e.g. HPLMN or subscribed SNPN) or to a different network than its home operator's network (e.g. VPLMN or non-subscribed SNPN) by applying access technology specific procedures described in the access technology specific annexes.\nIf the IM CN subsystem is selected and the UE is currently attached to its home operator's network (e.g. HPLMN or subscribed SNPN) and the UE is currently registered and the IP-CAN does not define emergency bearers, the UE shall attempt an emergency call as described in subclause 5.1.6.8.4.\nIf the IM CN subsystem is selected and the UE is currently attached to its home operator's network (e.g. HPLMN or subscribed SNPN) and the UE is currently registered and the IP-CAN defines emergency bearers and the core network has indicated that it supports emergency bearers, the UE shall:\n1)\tperform an initial emergency registration, as described in subclause 5.1.6.2; and\n2)\tattempt an emergency call as described in subclause 5.1.6.8.3.\nIf the IM CN subsystem is selected and the UE is currently attached to its home operator's network (e.g. HPLMN or subscribed SNPN) and the UE is not currently registered, the UE shall:\n1)\tperform an initial emergency registration, as described in subclause 5.1.6.2; and\n2)\tattempt an emergency call as described in subclause 5.1.6.8.3.\nIf the IM CN subsystem is selected and the UE is attached to a different network than its home operator's network (e.g. VPLMN or non-subscribed SNPN), the UE shall:\n1)\tperform an initial emergency registration, as described in subclause 5.1.6.2; and\n2)\tattempt an emergency call as described in subclause 5.1.6.8.3.\nIf the UE supports the emerg-reg timer defined in table 7.8.1, the UE shall start the emerg-reg timer when the UE decides that an emergency call is to be established via the IM CN subsystem. The UE shall stop the timer when the UE determines that an initial emergency registration, as described in subclause 5.1.6.2, is not required or upon receipt of any final SIP response during the initial emergency registration.\nIf the UE supports emerg-reg-retry timer defined in table 7.8.1, the UE shall start the timer when sending an emergency REGISTER. The UE shall stop the emerg-reg-retry timer when the UE receives any final response from this P-CSCF or when the emerg-reg timer has been stopped or expired.\nOn expiry of emerg-reg-retry timer, the UE shall:\n1)\tif the emerg-reg timer has not expired and the initial REGISTER request for the initial emergency registration has not received any response , consider that the emergency registration attempt for this P-CSCF has failed. The UE may retry registration on a different P-CSCF and restart the emerg-reg-retry timer. If the UE has no more available P-CSCFs, the UE shall stop the emerg-reg timer by considering the emergency registration has failed and follow the procedures related to emergency registration failure that are defined in 3GPP TS 23.167 [4B] subclause 6.1; and\n2)\tif the initial REGISTER request for the initial emergency registration has not been sent:\n-\tif the emerg-reg timer has not expired and the UE has successfully established an IP-CAN bearer for an emergency session, consider that the emergency registration attempt for this P-CSCF has failed. The UE may retry registration on a different P-CSCF if available and restart the emerg-reg-retry timer. If the UE has no more available P-CSCFs the UE shall stop the emerg-reg timer by considering the emergency registration has failed and follow the procedures related to emergency registration failure that are defined in 3GPP TS 23.167 [4B] subclause 6.1; or\nOn expiry of emerg-reg timer, the UE shall:\n-\tif the UE has successfully established an IP-CAN bearer for an emergency session, consider that the attempt to set up the emergency call via the IM CN subsystem has failed and follow the procedures related to emergency registration failure that are defined in 3GPP TS 23.167 [4B] subclause 6.1; or\n-\tif the UE has not successfully established an IP-CAN bearer for an emergency session, consider that the attempt to set up the emergency call via the IM CN subsystem has failed, abort any ongoing IP-CAN procedures for the emergency registration, and follow the procedures for domain selection as defined in 3GPP TS 23.167 [4B] clause H.5.\nstop the emerg-reg-retry timer, if running.\nThe UE may support being pre-configured for the Emerg-reg timer using one or more of the following methods:\na)\tthe Timer_Emerg-reg leaf of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Timer_Emerg-reg leaf of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Timer_Emerg-reg leaf of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the Timer_Emerg-reg leaf of 3GPP TS 24.167 [8G] and the Timer_Emerg-reg leaf of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the Timer_Emerg-reg leaf of the EFIMSConfigData file shall take precedence.\nNOTE 2:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nIf the IM CN subsystem is selected and the UE has no credentials the UE can make an emergency call without being registered. The UE shall attempt an emergency call as described in subclause 5.1.6.8.2.\nAn IP-CAN can, dependent on the IP-CAN capabilities, provide local emergency numbers (including information about emergency service categories or information about emergency service URNs) to the UE which has that capability, in order for the UE to recognize these numbers as emergency call.\nWhen the user initiates an emergency call, if emergency registration is needed (including cases described in subclause 5.1.6.2A), the UE shall perform an emergency registration prior to sending the SIP request related to the emergency call.\nThe UE shall have only one valid emergency registration at any given time. If the UE initiates a new emergency registration using different contact address, and the previous emergency registration has not expired, the UE shall consider the previous emergency registration as expired.\nIP-CAN procedures for emergency registration are defined in 3GPP TS 23.167 [4B] and in each access technology specific annex.\nWhen a UE performs an initial emergency registration the UE shall perform the actions as specified in subclause 5.1.1.2 with the following additions and modifications:\na)\tthe UE shall include a \"sos\" SIP  parameter in the Contact header field as described in subclause 7.2A.13, indicating that this is an emergency registration and that the associated contact address is allowed only for emergency service; and\nb)\tthe UE shall populate the From and To header fields of the REGISTER request with:\n-\tthe first entry in the list of public user identities provisioned in the UE;\n-\tthe default public user identity obtained during the normal registration, if the UE is not provisioned with a list of public user identites, but the UE is currently registered to the IM CN subsystem; and\n-\tthe derived temporary public user identity, in all other cases.\nWhen the UE performs an initial emergency registration and whilst this emergency registration is active, the UE shall:\n-\thandle the emergency registration independently from any other ongoing registration to the IM CN subsystem;\n-\thandle any signalling or media related IP-CAN for the purpose of emergency calls independently from any other established IP-CAN for IM CN subsystem related signalling or media; and\n-\thandle all SIP signalling and all media related to the emergency call independently from any other ongoing IM CN subsystem signalling and media.\nIf:\n1)\tthe UE receives a 420 (Bad Extension) response to the REGISTER request for initial emergency registration containing an \"sos\" SIP URI parameter in the Contact header field;\n2)\tthe UE does not support GPRS-IMS-Bundled authentication; and\n3)\tthe response contains a 3GPP IM CN subsystem XML body that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2) and <action> child element set to \"anonymous-emergencycall\" (see table 7.6.3);\nthe UE shall attempt an emergency call as described in subclause 5.1.6.8.2.\nIf:\n1)\tthe UE receives a 403 (Forbidden) response to the REGISTER request for initial emergency registration containing an \"sos\" SIP URI parameter in the Contact header field; and\n2)\tthe response contains a 3GPP IM CN subsystem XML body that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2) and <action> child element set to \"anonymous-emergencycall\" (see table 7.6.3);\nthe UE shall attempt an emergency call as described in subclause 5.1.6.8.2.\nThe UE shall perform a new initial emergency registration, as specified in subclause 5.1.6.2, if the UE determines that:\n-\tit has previously performed an emergency registration which has not yet expired; and\n-\tit has obtained an IP address from the serving IP-CAN, as specified in subclause 9.2.1, different than the IP address used for the emergency registration.\nUpon receiving the 200 (OK) to the REGISTER request that completes the emergency registration, the UE shall not subscribe to the reg event package of the public user identity specified in the REGISTER request.\nThe UE shall perform user-initiated emergency reregistration as specified in subclause 5.1.1.4 if half of the time for the emergency registration has expired and:\n-\tthe UE has emergency related ongoing dialog;\n-\tstandalone transactions exist; or\n-\tthe user initiates an emergency call.\nThe UE shall not perform user-initiated emergency reregistration in any other cases.\nWhen a UE performs authentication a UE shall perform the procedures as specified in subclause 5.1.1.5.\nOnce the UE registers a public user identity and an associated contact address via emergency registration, the UE shall not perform user-initiated deregistration of the respective public user identity and the associated contact address.\nNOTE:\tThe UE will be deregistered when the emergency registration expires.\nAn emergency registration will not be deregistered by the network (see subclause 5.4.8.4).\nThe UE shall translate any user indicated emergency number as specified in 3GPP TS 22.101 [1A] to an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69].\nWhen an initial request for a dialog or a standalone transaction, or an unknown method transmitted as part of UE detected emergency call procedures as defined in subclause 5.1.6 is initiated:\n-\tin event other than reception of a 380 (Alternative Service) response to an initial request for a dialog, or a standalone transaction, or an unknown method as defined in procedures in subclause 5.1.2A.1.1, subclause 5.1.3.1, subclause 5.1.6.8.1, subclause 5.1.6.8.3 and subclause 5.1.6.8.4; or\n-\tupon reception of a 380 (Alternative Service) response to an initial request for a dialog, or a standalone transaction, or an unknown method as defined in procedures in subclause 5.1.2A.1.1, subclause 5.1.3.1, subclause 5.1.6.8.1, subclause 5.1.6.8.3 and subclause 5.1.6.8.4, and the 380 (Alternative Service) response does not contain a Contact header field containing a service URN with a top-level service type of \"sos\",\nthe Request- of the initial request for a dialog or the standalone transaction, or the unknown method transmitted as part of UE detected emergency call procedures as defined in subclause 5.1.6 shall include one of the following service URNs:\n-\t\"urn:service:sos\", \"urn:service:sos.ambulance\", \"urn:service:sos.police\", \"urn:service:sos.fire\", \"urn:service:sos.marine\", \"urn:service:sos.mountain\", \"urn:service:sos.ecall.manual\", \"urn:service:sos.ecall.automatic\". If the UE can determine the type of emergency service the UE shall use an emergency service URN with a sub-service type corresponding to the type of emergency service.\n-\tas derived from the information about emergency service URNs provided with local emergency numbers (see subclause 5.1.6.1).\nNOTE 1:\tA service URN with a top-level service type of \"sos\" is used only when the user intends to establish an emergency call.\nNOTE 2:\tIn countries where a type of emergency service is required, due to national regulations, an emergency call request with emergency service URN \"urn:service:sos\" can fail.\nWhen an initial request for a dialog or a standalone transaction, or an unknown method transmitted as part of UE detected emergency call procedures as defined in subclause 5.1.6 is initiated upon reception of 380 (Alternative Service) response to an initial request for a dialog, or a standalone transaction, or an unknown method as defined in procedures in subclause 5.1.2A.1.1, subclause 5.1.3.1, subclause 5.1.6.8.1, subclause 5.1.6.8.3 and subclause 5.1.6.8.4, and if the 380 (Alternative Service) response contains a Contact header field containing a service URN with a top-level service type of \"sos\", the UE shall set the Request- of the initial request for a dialog or the standalone transaction, or the unknown method transmitted as part of UE detected emergency call procedures as defined in subclause 5.1.6 to the service URN of the Contact header field of the 380 (Alternative Service) response.\nIn the event the UE receives a 380 (Alternative Service) response to an INVITE request the response including a 3GPP IM CN subsystem XML body as described in subclause 7.6 that includes an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2), the UE shall automatically send an ACK request to the P-CSCF as per normal SIP procedures and terminate the session. In addition, if the 380 (Alternative Service) response includes a P-Asserted-Identity header field with a value equal to the value of the last entry on the Path header field value received during registration:\n-\tthe UE may also provide an indication to the user based on the text string contained in the <reason> child element of the <alternative-service> child element of the <ims-3gpp> element; and\n-\tone of subclause 5.1.6.8.3 or subclause 5.1.6.8.4 applies.\nNOTE 3:\tEmergency numbers which the UE does not detect, will be treated as a normal call.\nNOTE 4:\tThe last entry on the Path header field value received during registration is the value of the SIP  of the P-CSCF. If there are multiple registration flows associated with the registration, then the UE has received from the P-CSCF during registration multiple sets of Path header field values. The last entry of the Path header field value corresponding to the flow on which the 380 (Alternative Service) response was received is checked.\nIf the UE supports the emerg-request timer defined in Table 7.8.1, the UE shall start the emerg-request timer when sending the initial INVITE request for emergency service. The UE shall stop the timer upon receipt of any 18x provisional SIP response. When the emerg-request timer expires, the UE shall consider that the emergency service request has failed and apply the procedures related to emergency service request failure that are defined in 3GPP TS 23.167 [4B] subclause 7.3 with clarifications in clause H.5. The UE may support being configured for the emerg-request timer using one or more of the following methods:\na)\tthe Timer_Emerg-request leaf of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Timer_Emerg-request leaf of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Timer_Emerg-request leaf of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the Timer_Emerg-request leaf of 3GPP TS 24.167 [8G] and the Timer_Emerg-request leaf of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the Timer_Emerg-request leaf of the EFIMSConfigData file shall take precedence.\nNOTE 5:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nWhen establishing an emergency session for an unregistered user, the UE is allowed to receive responses to emergency requests and requests inside an established emergency session on the unprotected ports. The UE shall reject or silently discard all other messages not arriving on a protected port. Additionally, the UE shall transmit signalling packets pertaining to the emergency session from the same IP address and unprotected port on which it expects to receive signalling packets containing the responses to emergency requests and the requests inside the established emergency session.\nPrior to establishing an emergency session for an unregistered user, the UE shall acquire a local IP address, discover a P-CSCF, and establish an IP-CAN bearer that can be used for SIP signalling. The UE shall send only the initial INVITE requests to the port advertised to the UE during the P-CSCF discovery procedure. If the UE does not receive any specific port information during the P-CSCF discovery procedure, the UE shall send the initial INVITE request to the SIP default port values as specified in RFC 3261 [26].\nThe UE shall apply the procedures as specified in subclause 5.1.2A.1 and subclause 5.1.3 with the following additions:\n1)\tthe UE shall set the From header field of the INVITE request to \"Anonymous\" as specified in RFC 3261 [26];\n2)\tthe UE shall include a service URN in the Request- of the initial INVITE request in accordance with subclause 5.1.6.8.1;\nNOTE 1:\tOther specifications make provision for emergency service identifiers, which are not specifically the emergency service URN, to be recognised in the UE. Emergency service identifiers which the UE does not detect will be treated as a normal call by the UE.\n3)\tthe UE shall insert in the INVITE request, a To header field with the same emergency service URN as in the Request-;\n4)\tif available to the UE (as defined in the access technology specific annexes for each access technology), the UE shall include in the P-Access-Network-Info header field in any request for a dialog, any subsequent request (except CANCEL requests) or response (except CANCEL responses) within a dialog or any request. Insertion of the P-Access-Network-Info header field into the ACK request is optional. The UE shall populate the P-Access-Network-Info header field with the current point of attachment to the IP-CAN as specified for the access network technology (see subclause 7.2A.4). The P-Access-Network-Info header field contains the location identifier such as the cell id, the line id or the identity of the WLAN access node, which is relevant for routeing the emergency call;\n5)\tif defined by the access technology specific annex, the UE shall populate the P-Preferred-Identity header field in the INVITE request with an equipment identifier as a SIP . The special details of the equipment identifier to use depend on the IP-CAN;\n6)\ta Contact header field set to include SIP  that contains in the hostport parameter the IP address of the UE and an unprotected port where the UE will receive incoming requests belonging to this dialog. The UE shall also include a \"sip.instance\" media feature tag containing Instance ID as described in RFC 5626 [92]. The UE shall not include either the public or temporary GRUU in the Contact header field;\n7)\ta Via header field set to include the IP address of the UE in the sent-by field and for the UDP the unprotected server port value where the UE will receive response to the emergency request, while for the , the response is received on the  connection on which the emergency request was sent. For the UDP, the UE shall also include \"rport\" header field parameter with no value in the top Via header field. Unless the UE has been configured to not send keep-alives, and unless the UE is directly connected to an IP-CAN for which usage of  is not defined, it shall include a \"keep\" header field parameter with no value in the Via header field, in order to indicate support of sending keep-alives associated with, and during the lifetime of, the emergency session, as described in RFC 6223 [143];\nNOTE 2:\tThe UE inserts the same IP address and port number into the Contact header field and the Via header field, and sends all IP packets to the P-CSCF from this IP address and port number.\n8)\tif the UE has its location information available, or a  that points to the location information, the UE shall include a Geolocation header field in the INVITE request in the following way:\n-\tif the UE is aware of the  that points to where the UE's location is stored, include the  as the Geolocation header field value, as described in RFC 6442 [89]; or\n-\tif the UE is aware of its location information, include the location information in a PIDF location object, in accordance with RFC 4119 [90] and RFC 5491 [267], include the location object in a message body with the content type application/pidf+xml, and include a Content ID URL, referring to the message body, as the Geolocation header field value, as described RFC 6442 [89], and include a Content-Disposition header field with a disposition type \"render\" value and a \"handling\" header field parameter with an \"optional\" value, as described in RFC 3261 [26];\nNOTE 3:\tIf the location information is old or inaccurate, the UE does not consider location information to be available.\n9)\tif the UE includes a Geolocation header field, the UE shall also include a Geolocation-Routing header field with a \"yes\" header field value, which indicates that the location of the UE can be used by other entities to make routing decisions, as described in RFC 6442 [89];\n10)\tif the UE has neither geographical location information available, nor a  that points to the location information, the UE shall not insert a Geolocation header field in the INVITE request; and\nNOTE 4:\tIt is suggested that UE's only use the option of providing a  when the domain part belongs to the current P-CSCF or S-CSCF provider. This is an issue on which the network operator needs to provide guidance to the end user. A  that is only resolvable to the UE which is making the emergency call is inapplicable in this area.\n11)\tif support of the current location discovery during an emergency call is allowed in the IP-CAN specific annex and the UE supports the current location discovery during an emergency call, the UE shall include a Recv-Info header field as described in RFC 6086 [25], indicating the g.3gpp.current-location-discovery info package name and shall include an Accept header field indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME type.\nNOTE 5:\tDuring the dialog, the points of attachment to the IP-CAN of the UE can change (e.g. UE connects to different cells). The UE will populate the P-Access-Network-Info header field in any request or response within a dialog with the current point of attachment to the IP-CAN (e.g. the current cell information).\nThe UE shall build a proper preloaded Route header field value for all new dialogs. The UE shall build a Route header field value containing only the P-CSCF  (containing the unprotected port number and the IP address acquired at the time of the P-CSCF discovery procedures which was used in registration of the contact address (or registration flow).\nNOTE 6:\tIf the UE is provisioned with or receives a FQDN at the time of the P-CSCF discovery procedures, the FQDN is resolved to an IP address at the time of the P-CSCF discovery procedures.\nWhen a SIP transaction times out, i.e. timer B, timer F or timer H expires at the UE, the UE may behave as if timer F expired, as described in subclause 5.1.1.4.\nNOTE 7:\tIt is an implementation option whether these actions are also triggered by other means.\nNOTE 8:\tA number of header fields can reveal information about the identity of the user. Where privacy is required, implementers should also give consideration to other header fields that can reveal identity information. RFC 3323 [33] subclause 4.1 gives considerations relating to a number of header fields.\nNOTE 9:\tRFC 3261 [26] provides for the use of the Priority header field with a suggested value of \"emergency\". It is not precluded that emergency sessions contain this value, but such usage will have no impact on the processing within the IM CN subsystem.\nIf the response for the initial INVITE request indicates that the UE is behind , and the INVITE request was sent over  connection, the UE shall keep the  connection during the entire duration of the emergency session. In this case the UE will receive all responses to the emergency requests and the requests inside the established emergency session over this  connection.\nIf the Via header field of any provisional response, or of the final 200 (OK) response, for the initial INVITE request contains a \"keep\" header field parameter with a value, unless the UE detects that it is not behind a , the UE shall start to send keep-alives associated with the session towards the P-CSCF, as described in RFC 6223 [143].\nAfter a successful initial emergency registration, the UE shall apply the procedures as specified in subclause 5.1.2A and 5.1.3 with the following additions:\n1)\tthe UE shall insert in the INVITE request, a From header field that includes the public user identity registered via emergency registration or the tel  associated with the public user identity registered via emergency registration, as described in subclause 4.2;\n2)\tthe UE shall include a service URN in the Request- of the INVITE request in accordance with subclause 5.1.6.8.1;\n3)\tthe UE shall insert in the INVITE request, a To header field with the same emergency service URN as in the Request-;\n4)\tif available to the UE, and if defined for the access type as specified in subclause 7.2A.4, the P-Access-Network-Info header field shall contain a location identifier such as the cell id, line id or the identity of the WLAN access node, which is relevant for routeing the IMS emergency call;\nNOTE 1:\tThe IMS emergency specification in 3GPP TS 23.167 [4B] describes several methods how the UE can get its location information from the access network or from a server. Such methods are not in the scope of this specification.\n5)\tthe UE shall insert in the INVITE request, one or two P-Preferred-Identity header field(s) that include the public user identity registered via emergency registration or the tel  associated with the public user identity registered via emergency registration as described in subclause 4.2;\nNOTE 2:\tProviding two P-Preferred-Identity header fields is usually supported by UE acting as enterprise network.\n6)\tvoid;\n7)\tif the UE has its location information available, or a  that points to the location information, then the UE shall include a Geolocation header field in the INVITE request in the following way:\n-\tif the UE is aware of the  that points to where the UE's location is stored, include the  as the Geolocation header field value, as described in RFC 6442 [89]; or\n-\tif the UE is aware of its location information, include the location information in a PIDF location object, in accordance with RFC 4119 [90] and RFC 5491 [267], include the location object in a message body with the content type application/pidf+xml, and include a Content ID URL, referring to the message body, as the Geolocation header field value, as described RFC 6442 [89], and include a Content-Disposition header field with a disposition type \"render\" value and a \"handling\" header field parameter with an \"optional\" value, as described in RFC 3261 [26];\nNOTE 3:\tIf the location information is old or inaccurate, the UE does not consider location information to be available.\n8)\tif the UE includes a Geolocation header field, the UE shall also include a Geolocation-Routing header field with a \"yes\" header field value, which indicates that the location of the UE can be used by other entities to make routing decisions, as described in RFC 6442 [89];\nNOTE 4:\tIt is suggested that UE's only use the option of providing a  when the domain part belongs to the current P-CSCF or S-CSCF provider. This is an issue on which the network operator needs to provide guidance to the end user. A  that is only resolvable to the UE which is making the emergency call is not desirable.\n9)\tif the UE has neither geographical location information available, nor a  that points to the location information, the UE shall not insert a Geolocation header field in the INVITE request; and\n10)\tif support of the current location discovery during an emergency call is allowed in the IP-CAN specific annex and the UE supports the current location discovery during an emergency call, the UE shall include a Recv-Info header field as described in RFC 6086 [25], indicating the g.3gpp.current-location-discovery info package name and shall include an Accept header field indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME type.\nNOTE 5:\tRFC 3261 [26] provides for the use of the Priority header field with a suggested value of \"emergency\". It is not precluded that emergency sessions contain this value, but such usage will have no impact on the processing within the IM CN subsystem.\nIn the event the UE receives a 380 (Alternative Service) response with a P-Asserted-Identity header field with a value equal to the value of the last entry on the Path header field value received during registration, and the Content-Type header field set according to subclause 7.6 (i.e. \"application/3gpp-ims+xml\"), independent of the value or presence of the Content-Disposition header field, independent of the value or presence of Content-Disposition parameters, then the following treatment is applied:\n1)\tif the 380 (Alternative Service) response includes a 3GPP IM CN subsystem XML body as described in subclause 7.6 the <ims-3gpp> element, including a version attribute, with the <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2), then the UE shall:\na)\tif the CS domain is available to the UE, and no prior attempt using the CS domain for the current emergency call attempt has been made, attempt emergency call via CS domain using appropriate access technology specific procedures;\nb)\tif the CS domain is not available to the UE or the emergency call has already been attempted using the CS domain, then perform one of the following actions:\n-\tif the <action> child element of the <alternative-service> child element of the <ims-3gpp> element in the IM CN subsystem XML body as described in subclause 7.6 is set to \"emergency-registration\" (see table 7.6.3), perform an initial emergency registration using a different VPLMN or non-subscribed SNPN, if available, as described in subclause 5.1.6.2 and if the new emergency registration succeeded, attempt an emergency call as described in this subclause; or\n-\tperform implementation specific actions to establish the emergency call; and\n2)\tif the 380 (Alternative Service) response includes a 3GPP IM CN subsystem XML body as described in subclause 7.6 with the <ims-3gpp> element, including a version attribute, with the <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2) then the UE may also provide an indication to the user based on the text string contained in the <reason> child element of the <alternative-service> child element of the <ims-3gpp> element.\nNOTE 6:\tThe last entry on the Path header field value received during registration is the value of the SIP  of the P-CSCF. If there are multiple registration flows associated with the registration, then the UE has received from the P-CSCF during registration multiple sets of Path header field values. The last entry of the Path header field value corresponding to the flow on which the 380 (Alternative Service) response was received is checked.\nThe UE shall apply the procedures as specified in subclauses 5.1.2A and 5.1.3 with the following additions:\n1)\tthe UE shall include a service URN in the Request- of the INVITE request in accordance with subclause 5.1.6.8.1;\n2)\tthe UE shall insert in the INVITE request, a To header field with the same emergency service URN as in the Request-;\n3)\tthe UE shall insert in the INVITE request, a From header field that includes the public user identity or the tel  associated with the public user identity, as described in subclause 4.2;\n4)\tif available to the UE, and if defined for the access type as specified in subclause 7.2A.4, the UE shall insert in the P-Access-Network-Info header field a location identifier such as the cell id, line id or the identity of the WLAN access node, which is relevant for routeing the IMS emergency call;\nNOTE 1:\t3GPP TS 23.167 [4B] describes several methods how the UE can get its location information from the access network or from a server. Such methods are not in the scope of this specification.\n5)\tthe UE shall insert in the INVITE request one or two P-Preferred-Identity header field(s) that include the public user identity or the tel  associated with the public user identity as described in subclause 4.2;\nNOTE 2:\tProviding two P-Preferred-Identity header fields is usually supported by UE acting as enterprise network.\n6)\tif the UE has its location information available, or a  that points to the location information, then the UE shall include a Geolocation header field in the INVITE request in the following way:\n-\tif the UE is aware of the  that points to where the UE's location is stored, include the  as the Geolocation header field value, as described in RFC 6442 [89]; or\n-\tif the UE is aware of its location information, include the location information in a PIDF location object, in accordance with RFC 4119 [90] and RFC 5491 [267], include the location object in a message body with the content type application/pidf+xml, and include a Content ID URL, referring to the message body, as the Geolocation header field value, as described RFC 6442 [89], and include a Content-Disposition header field with a disposition type \"render\" value and a \"handling\" header field parameter with an \"optional\" value, as described in RFC 3261 [26];\nNOTE 3:\tIf the location information is old or inaccurate, the UE does not consider location information to be available.\n7)\tif the UE includes a Geolocation header field, the UE shall also include a Geolocation-Routing header field with a \"yes\" header field value, which indicates that the location of the UE can be used by other entities to make routing decisions, as described in RFC 6442 [89];\n8)\tif the UE has neither geographical location information available, nor a  that points to the location information, the UE shall not insert a Geolocation header field in the INVITE request;\nNOTE 4:\tIt is suggested that UE's only use the option of providing a  when the domain part belongs to the current P-CSCF or S-CSCF provider. This is an issue on which the network operator needs to provide guidance to the end user. A  that is only resolvable to the UE which is making the emergency call is not desirable.\n9)\tif a public GRUU value (\"pub-gruu\" header field parameter) has been saved associated with the public user identity to be used for this request, then insert the public GRUU (\"pub-gruu\" header field parameter) value in the Contact header field as specified in RFC 5627 [93]. Otherwise the UE shall include the address in the Contact header field set to contain the IP address or FQDN of the UE, and the UE shall also include:\n-\tif IMS AKA or SIP digest with  is being used as a security mechanism, the protected server port value as in the initial registration; or\n-\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled Authentication is being used as a security mechanism, the port value of an unprotected port where the UE expects to receive subsequent mid-dialog requests. The UE shall set the unprotected port value to the port value used in the initial registration; and\n10)\tif support of the current location discovery during an emergency call is allowed in the IP-CAN specific annex and the UE supports the current location discovery during an emergency call, the UE shall include a Recv-Info header field as described in RFC 6086 [25], indicating the g.3gpp.current-location-discovery info package name and shall include an Accept header field indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME type.\nIn the event the UE receives a 380 (Alternative Service) response with a P-Asserted-Identity header field with a value equal to the value of the SIP  of the P-CSCF received in the Path header field during registration, and the Content-Type header field set according to subclause 7.6 (i.e. \"application/3gpp-ims+xml\"), independent of the value or presence of the Content-Disposition header field, independent of the value or presence of Content-Disposition parameters, then the following treatment is applied:\na)\tif the 380 (Alternative Service) response includes a 3GPP IM CN subsystem XML body as described in subclause 7.6 with an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2), then the UE shall:\n-\tif the <action> child element of the <alternative-service> child element of the <ims-3gpp> element in the IM CN subsystem XML body as described in subclause 7.6 is set to \"emergency-registration\" (see table 7.6.3), perform an initial emergency registration, as described in subclause 5.1.6.2 and attempt an emergency call as described in subclause 5.1.6.8.3;\n-\tattempt emergency call via CS domain using appropriate access technology specific procedures, if available and not already tried; or\n-\tperform implementation specific actions to establish the emergency call; and\nb)\tif the 380 (Alternative Service) response includes a 3GPP IM CN subsystem XML body as described in subclause 7.6 with an <ims-3gpp> element, including a version attribute, with an <alternative-service> child element with the <type> child element set to \"emergency\" (see table 7.6.2) then the UE may also provide an indication to the user based on the text string contained in the <reason> child element of the <alternative-service> child element of the <ims-3gpp> element.\nNOTE 5:\tRFC 3261 [26] provides for the use of the Priority header field with a suggested value of \"emergency\". It is not precluded that emergency sessions contain this value, but such usage will have no impact on the processing within the IM CN subsystem.\nNOTE 6:\tThe last entry on the Path header field value received during registration is the value of the SIP  of the P-CSCF. If there are multiple registration flows associated with the registration, then the UE has received from the P-CSCF during registration multiple sets of Path header field values. The last entry of the Path header field value corresponding to the flow on which the 380 (Alternative Service) response was received is checked.\nNormal call release procedure shall apply, as specified in the subclause 5.1.5.\nIf the UE receives a 1xx or 200 (OK) response to an initial request for a dialog, the response containing a P-Asserted-Identity header field set to an emergency number as specified in 3GPP TS 22.101 [1A], and:\n-\tif a public GRUU value (pub-gruu) has been saved associated with the public user identity, the public GRUU value has not been included in the Contact header field of the initial request for a dialog as specified in RFC 5627 [93];\n-\tif a public GRUU value (pub-gruu) has not been saved and a protected server port was not included in the address in the Contact header field of the initial request for a dialog; or\n-\tif the UE has its geographical location information available, or a  that points to the location information, and the geographical location information or  has not been included in the initial request for a dialog;\nthen the UE shall send an UPDATE request according to RFC 3311 [29]; and:\n1)\tif available to the UE, and if defined for the access type as specified in subclause 7.2A.4, the UE shall include in the UPDATE request a P-Access-Network-Info header field and it shall contain a location identifier such as the cell id or the identity of the WLAN access node;\n2)\tif the UE has its geographical location information available, or a  that points to the location information, then the UE shall include it in the UPDATE request in the following way:\nI)\tif the UE is aware of the  that points to where the UE's location is stored, include the  as the Geolocation header field value, as described in RFC 6442 [89]; or\nII)\tif the UE is aware of its location information, include the location information in a PIDF location object, in accordance with RFC 4119 [90] and RFC 5491 [267], include the location object in a message body with the content type application/pidf+xml, and include a Content ID URL, referring to the message body, as the Geolocation header field value, as described RFC 6442 [89], and include a Content-Disposition header field with a disposition type \"render\" value and a \"handling\" header field parameter with an \"optional\" value, as described in RFC 3261 [26];\nNOTE 1:\tIf the location information is old or inaccurate, the UE does not consider location information to be available.\n3)\tif the UE includes a Geolocation header field, the UE shall also include a Geolocation-Routing header field with a \"yes\" header field value, which indicates that the location of the UE can be used by other entities to make routing decisions, as described in RFC 6442 [89];\n4)\tif the UE has neither geographical location information available, nor a  that points to the location information, the UE shall not insert a Geolocation header field in the UPDATE request; and\n5)\tif a public GRUU value (\"pub-gruu\" header field parameter) has been saved associated with the public user identity, then the UE shall insert the public GRUU (\"pub-gruu\" header field parameter) value in the Contact header field of the UPDATE request as specified in RFC 5627 [93]; otherwise the UE shall include the address in the Contact header field set in accordance with subclause 5.1.6.8.4, item 8.\nNOTE 2:\tThe IMS emergency specification in 3GPP TS 23.167 [4B] describes several methods how the UE can get its location information from the access network or from a server. Such methods are not in the scope of this specification.\nNOTE 3:\tIt is suggested that UEs only use the option of providing a  when the domain part belongs to the current P-CSCF or S-CSCF provider. This is an issue on which the network operator needs to provide guidance to the end user. A  that is only resolvable to the UE which is making the emergency call is not desirable.\nNOTE 4:\tDuring the dialog, the points of attachment to the IP-CAN of the UE can change (e.g. UE connects to different cells). The UE will populate the P-Access-Network-Info header field in any request (except CANCEL requests) or response (except CANCEL responses) within a dialog with the current point of attachment to the IP-CAN (e.g. the current cell information).\nNOTE 5:\tIn this version of the specification, only requests creating a dialog can request emergency services.\nIf the UE receives a 1xx or 200 (OK) response to an initial request for a dialog the response containing a P-Asserted-Identity header field set to an emergency number as specified in 3GPP TS 22.101 [1A], then the UE may indicate the nature of the session to the user.\nIf the upper layers request establishment of an IMS emergency call of the manually initiated eCall type of emergency service, the service URN shall be \"urn:service:sos.ecall.manual\" as specified in RFC 8147 [244].\nIf the upper layers request establishment of an IMS emergency call of the automatically initiated eCall type of emergency service, the service URN shall be \"urn:service:sos.ecall.automatic\" as specified in RFC 8147 [244].\nNOTE 1:\tThe manually initiated eCall type of emergency service is used when the eCall IMS emergency session is invoked with user input. The automatically initiated eCall type of emergency service is used if the eCall IMS emergency session is invoked without user input.\nNOTE 2:\tTo ensure the identification and the related routing (e.g. to a test centre) of non-emergency calls initiated for eCall testing or eCall terminal reconfiguration purposes, \"urn:service:sos.ecall.automatic\" or \"urn:service:sos.ecall.manual\" are not used for such calls. Additionally the usage of any other service URN to establish non-emergency calls initiated for eCall testing or eCall terminal reconfiguration purposes needs to be in accordance with local operator policy.\nIf the upper layers request establishment of an IMS emergency call of the automatically initiated eCall type of emergency service or of the manually initiated eCall type of emergency service and if allowed by IP-CAN specific annex, the UE shall send an INVITE request as specified in the procedures in subclause 5.1.6.8 with the following additions:\n1)\tthe UE shall set the Request-URI to \"urn:service:sos.ecall.automatic\" or \"urn:service:sos.ecall.manual\"; and\n2)\tif the IP-CAN indicates the eCall support indication, the UE shall:\na)\tinsert a multipart/mixed body containing an \"application/EmergencyCallData.eCall.MSD\" MIME body part as defined in RFC 8147 [244], containing the MSD not exceeding 140 bytes and encoded in binary ASN.1 PER as specified in CEN EN 15722:2015 [245] and include a Content-Disposition header field with a \"handling\" header field parameter with an \"optional\" value, as described in RFC 3261 [26];\nb)\tinsert an Accept header field indicating the UE is willing to accept an \"application/EmergencyCallData.Control+xml\" MIME type as defined in RFC 8147 [244]; and\nc)\tinsert a Recv-Info header field set to \"EmergencyCallData.eCall.MSD\" as defined in RFC 8147 [244].\nNOTE:\tFurther content for the INVITE is as defined in RFC 8147 [244].\nThen the UE shall proceed as follows:\n1)\tif the UE receives a 200 (OK) response to the INVITE request not containing:\na)\ta multipart/mixed body containing an \"application/EmergencyCallData.Control+xml\" MIME body part as defined in RFC 8147 [244] with an \"ack\" element containing:\ni)\ta \"received\" attribute set to \"true\"; and\nii)\ta \"ref\" attribute set to the Content-ID of the MIME body part containing the MSD sent by the UE;\nthen the UE shall send the MSD using audio media stream encoded as described in 3GPP TS 26.267 [9C];\n2)\tif the UE receives a 200 (OK) response to the INVITE request containing:\na)\ta multipart/mixed body containing an \"application/EmergencyCallData.Control+xml\" MIME body part as defined in RFC 8147 [244] with an \"ack\" element containing:\ni)\ta \"received\" attribute set to \"true\"; and\nii)\ta \"ref\" attribute set to the Content-ID of the MIME body part containing the MSD sent by the UE;\nthen the UE shall consider the initial MSD transmission as successful;\n3)\tif the UE receives a 486 (Busy Here), 600 (Busy Everywhere) or 603 (Decline) response to the INVITE request containing:\na)\ta multipart/mixed body containing an \"application/EmergencyCallData.Control+xml\" MIME body part as defined in RFC 8147 [244] with an \"ack\" element containing:\ni)\ta \"received\" attribute set to \"true\"; and\nii)\ta \"ref\" attribute set to the Content-ID of the MIME body part containing the MSD sent by the UE;\nthen the UE shall consider the initial MSD transmission as successful and shall perform domain selection to re-attempt the eCall as specified in 3GPP TS 23.167 [4B]; and\n4)\tin all other cases, the UE shall perform domain selection to re-attempt the eCall as specified in 3GPP TS 23.167 [4B].\nDuring an emergency session established for eCall type of emergency service as described in subclause 5.1.6.11.2, if the UE receives an INFO request with:\n1)\tan Info-Package header field set to \"EmergencyCallData.eCall.MSD\" as defined in RFC 8147 [244];\n2)\ta multipart/mixed body including:\na)\tan \"application/EmergencyCallData.Control+xml\" MIME body part as defined in RFC 8147 [244] containing a \"request\" element with an \"action\" attribute set to \"send-data\" and a \"datatype\" attribute set to \"eCall.MSD\"; and\nb)\ta Content-Disposition header field set to \"By-Reference\" associated with the \"application/EmergencyCallData.Control+xml\" MIME body part; and\n3)\ta Content-Disposition header field set to \"Info-Package\" associated with the multipart/mixed body;\nthe UE shall proceed as follows:\n1)\tif the UE is able to provide an updated MSD, the UE shall send an INFO request containing:\na)\tan Info-Package header field set to \"EmergencyCallData.eCall.MSD\" as defined in RFC 8147 [244];\nb)\ta multipart/mixed body including:\ni)\tan \"application/EmergencyCallData.eCall.MSD\" MIME body part as defined in RFC 8147 [244] containing the MSD not exceeding 140 bytes and encoded in binary ASN.1 as specified in CEN EN 15722:2015 [245]; and\nii)\ta Content-Disposition header field set to \"By-Reference\" associated with the \"application/EmergencyCallData.eCall.MSD\" MIME body part; and\nc)\ta Content-Disposition header field set to \"Info-Package\" associated with the multipart/mixed body; and\n2)\tif the UE is not able to provide an updated MSD, the UE shall send an INFO request containing:\na)\tan Info-Package header field set to \"EmergencyCallData.eCall.MSD\" as defined in RFC 8147 [244];\nb)\ta multipart/mixed body including:\ni)\tan \"application/EmergencyCallData.Control+xml\" MIME body part as defined in RFC 8147 [244] with an \"ack\" element containing:\n-\ta \"ref\" attribute set to the Content-ID of the \"application/EmergencyCallData.Control+xml\" MIME body part in the INFO request received by the UE; and\n-\tan \"actionResult\" child element containing:\nA)\tan \"action\" attribute set to \"send-data\";\nB)\ta \"success\" attribute set to \"false\"; and\nC)\ta \"reason\" attribute set to an appropriate value as defined in RFC 8147 [244]; and\nii)\ta Content-Disposition header field set to \"By-Reference\" associated with the \"application/EmergencyCallData.Control+xml\" MIME body part; and\nc)\ta Content-Disposition header field set to \"Info-Package\" associated with the multipart/mixed body.\nNOTE:\tFurther content for the INFO request is as defined in RFC 8147 [244].\nThe UE can be requested to provide the current location information during an established emergency call.\nIf:\n1)\tthe UE indicated a Recv-Info header field with the g.3gpp.current-location-discovery info package name in the dialog of the emergency call;\n2)\tthe UE indicated an Accept header field indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME type in the dialog of the emergency call; and\n3)\tthe dialog of the emergency call is a confirmed dialog;\nthen upon receiving an INFO request as described in RFC 6086 [25] as in-dialog request of the dialog of the emergency call:\n1)\twith Info-Package header field as described in RFC 6086 [25], containing the g.3gpp.current-location-discovery info package name; and\n2)\twith a request-for-current-location body as specified in subclause 7.12.2.2 in the MIME body of \"application/vnd.3gpp.current-location-discovery+xml\" MIME type;\nthe UE shall send a response to the INFO request according to RFC 6086 [25]. If a 200 (OK) response is sent to the INFO request, the UE shall perform the procedure in subclause 5.1.6.12.3.\nIf the UE has its location information available, the UE shall provide the location information.\nIf the UE does not have its location information available, the UE may attempt to obtain the location information. If the location information becomes available at a subsequent time, the UE shall provide the location information. If the UE does not attempt to obtain its location information or when the UE stops attempting to obtain the location information, the UE shall inform the network about the location information not being available.\nIn order to provide the location information or to inform the network about the location information not being available, the UE shall apply the procedures as specified in subclauses 5.1.2A with the following additions.\nThe UE shall send a PUBLISH request as described in RFC 3903 [70] and RFC 3856 [74], as an in-dialog request of the dialog of the emergency call. In the PUBLISH request, the UE shall include an application/pidf+xml MIME body. If the UE has its location information available, the UE shall include the location information in a PIDF location object, in accordance with RFC 4119 [90] and RFC 5491 [267] in the application/pidf+xml MIME body.\nNOTE:\tIf the UE does not have its location information available, a PUBLISH request with an application/pidf+xml MIME body not containing a PIDF location object is sent.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.7\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.8\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.9\tP-CSCF addresses management",
                            "text_content": "The UE shall locally store the P-CSCF addresses discovered during the procedures described in subclause 9.2.1.\nBased on conditions identified in subclause 5.1.1.2.1 and subclause 5.1.2A.1.6, the UE marks the locally stored P-CSCF addresses as unavailable.\nThe UE shall not use a locally stored P-CSCF address which is marked as unavailable when performing initial registration.\nAfter:\n-\ta computed retry delay time determined by the algorithm defined in subclause 4.5 of RFC 5626 [92] plus 5 minutes (if no expiration time was identified in subclause 5.1.1.2.1 or subclause 5.1.2A.1.6); or\n-\ta time indicated by the network for this P-CSCF (if expiration time was identified in in subclause 5.1.1.2.1 or subclause 5.1.2A.1.6)\nafter marking of a locally stored P-CSCF address as unavailable elapses, the UE clears the mark on the locally stored P-CSCF address.\nIf the UE performs a new P-CSCF discovery or is power-cycled, the UE shall clear all the availability marks on the locally stored P-CSCF addresses.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tGeneral",
                            "text_content": "Where the P CSCF provides emergency call support, the procedures of subclause 5.2.10 shall be applied first.\nSubclause 5.2.2 through subclause 5.2.9 define P-CSCF procedures for SIP that do not relate to emergency. All SIP requests are first screened according to the procedures of subclause 5.2.10 to see if they do relate to an emergency.\nFor all SIP transactions identified:\n-\tas relating to an emergency; or\n-\tif priority is supported, as containing an authorised Resource-Priority header field or a temporarily authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe P-CSCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If the P-CSCF recognises the need for priority processing to a request or if the P-CSCF recognises the need to provide different priority processing than the one indicated by the originating UE, based on the information stored during registration, the P-CSCF may insert or modify Resource-Priority header in accordance with RFC 4412 [116].\nNOTE 1:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nThe P-CSCF shall support the Path and Service-Route header fields.\nNOTE 2:\tThe Path header field is only applicable to the REGISTER request and its 200 (OK) response. The Service-Route header field is only applicable to the 200 (OK) response of REGISTER request.\nNOTE 3:\tIn subsequent procedures, the P-CSCF can address the needs of individual users (e.g. in support of attached enterprise networks or in support of priority mechanisms, from information saved during registration. In this release of the specification, no information is specified in the registration procedures to perform this, and therefore this information has to either be associated with the user at time of registration from configured information, or by a mechanism outside the scope of this release of the specification.\nWhen the P-CSCF sends any request or response to the UE, before sending the message the P-CSCF shall:\n-\tremove the P-Charging-Function-Addresses and P-Charging-Vector header fields, if present.\nWhen the P-CSCF receives any request or response from the UE, the P-CSCF:\n1)\tshall remove the P-Charging-Function-Addresses and P-Charging-Vector header fields, if present. Also, the P-CSCF shall ignore any data received in the P-Charging-Function-Addresses and P-Charging-Vector header fields; and\n2)\tmay insert previously saved values into the P-Charging-Function-Addresses header field before forwarding the message;\nNOTE 4:\tWhen the P-CSCF is located in the visited network, then it will not receive the P-Charging-Function-Addresses header field from the S-CSCF, IBCF, or I-CSCF. Instead, the P-CSCF discovers charging function addresses by other means not specified in this document.\n3)\tshall remove the P-Access-Network-Info header field, if the request or the response include a P-Access-Network-Info header field with a \"network-provided\" parameter;\n4)\tmay insert a P-Access-Network-Info header field where:\na)\tif no mechanism exists to support the access technology for this UE, the \"network-provided\" parameter is included, and the access-type field is set to a preconfigured value;\nb)\tif NASS is used to support the access technology for this UE, the \"network-provided\" parameter is included, and the access-type field is set:\n-\twhen xDSL is the IP-CAN, to one of \"ADSL\", \"ADSL2\", \"ADSL2+\", \"RADSL\", \"SDSL\", \"HDSL\", \"HDSL2\", \"G.SHDSL\", \"VDSL\", \"IDSL\", or \"xDSL\", and the \"dsl-location\" parameter is set with the value received in the Location-Information header field in the User-Data Answer command as specified in ETSI ES 283 035 [98];\nNOTE 5:\txDSL is a general abbreviation for all types of Digital Subscriber Lines, and \"xDSL\" is a possible access-type value of the P-Access-Network-Info header field.\n-\twhen Ethernet is the IP-CAN, to one of \"IEEE-802.3\", \"IEEE-802.3a\", \"IEEE-802.3e\", \"IEEE-802.3i\", \"IEEE-802.3j\", \"IEEE-802.3u\",\"IEEE-802.3ab\"or \"IEEE-802.3ae\", \"IEEE-802.3ak\", \"IEEE-802.3aq\", \"IEEE-802.3an\", \"IEEE-802.3y\" or \"IEEE-802.3z\" and if NASS subsystem is used, and the \"eth-location\" parameter is set with the value received in the Location-Information header field in the User-Data Answer command as specified in ETSI ES 283 035 [98];\n-\twhen Fiber is the IP-CAN, to one of \"G-PON\", \"XGPON1\" or \"IEEE-802.3ah\" and if NASS subsystem is used, and the \"fiber-location\" parameter is set with the value received in the Location-Information header field in the User-Data Answer command as specified in ETSI ES 283 035 [98];\nc)\tif the PCRF is used to support the access technology for this UE and 3GPP-User-Location-Info as specified in 3GPP TS 29.214 [13D] is not available:\n-\tif the IP-CAN-Type value provided by the PCRF is not \"DVB-RCS2\", then:\nI)\tthe access-type field or the access-class field is set to a value consistent with that received from the PCRF in the IP-CAN-Type, RAT-Type and AN-Trusted parameters using the procedures specified in 3GPP TS 29.214 [13D].\nIf the IP-CAN-Type parameter is set \"Non-3GPP-EPS (6)\" as specified in 3GPP TS 29.212 [13B], the RAT-Type parameter is set to \"VIRTUAL (1)\" as specified in 3GPP TS 29.212 [13B] and the AN-Trusted parameter is set to \"UNTRUSTED (1)\" as specified in 3GPP TS 29.273 [12A], the P-CSCF shall include the access-class field set to \"untrusted-non-3GPP-VIRTUAL-EPC\".\nII)\tif a 3GPP-MS-TimeZone parameter is available from the PCRF, then the \"local-time-zone\" parameter and the \"daylight-saving-time\" parameter may also be added using this information;\nIII)\tthe \"network-provided\" parameter is added;\nIV)\tif a TWAN-Identifier as specified in 3GPP TS 29.214 [13D] is received from the PCRF, the received TWAN-Identifier contains the Circuit-ID and the associated \"Relay Identity\", the received TWAN-Identifier does not contain the \"Civic Address Information\" and the P-CSCF is able to deduce a Geographical Identifier from the Circuit-ID and the associated \"Relay Identity\", then, if required by local operator policy, the P-CSCF shall include an operator-specific-GI field. The P-CSCF can obtain a Geographical Identifier from the  by using the e2 interface (see ETSI ES 283 035 [98]);\nNOTE 6:\tETSI ES 283 035 [98] Release 3 enables querying a  using the User-Data-Request command in which the Global-Access-Id  contains the Fixed-Access-ID  set using the Circuit-ID value as the Logical-Access-ID and the \"Relay Identity\" as the Relay-Agent to get a corresponding Geographical Identifier. If multiple CLFs are deployed, the P-CSCF can dertermine which  to query based on the  or the SAI values or can use a DIAMETER proxy if deployed.\nV)\tif WLAN Location Information as specified in 3GPP TS 23.402 [7E] is received from the PCRF, the received WLAN Location Information contains the location identifier and the P-CSCF is able to deduce a Geographical Identifier from the WLAN Location Information, then, if required by local operator policy, the P-CSCF shall include an operator-specific-GI field; and\nVI)\tif:\nA)\tthe access-class field of the P-Access-Network-Info header field is set to \"untrusted-non-3GPP-VIRTUAL-EPC\"; or\nB)\tthe access-class field of the P-Access-Network-Info header field is set to \"3GPP-WLAN\" and the AN-Trusted parameter specified in 3GPP TS 29.273 [12A] is received from PCRF and is set to \"UNTRUSTED (1)\";\nthen:\nA)\tif a UE-Local-IP-Address parameter specified in 3GPP TS 29.212 [13B] is received from the PCRF and if required by local operator policy, P-CSCF shall also include in the P-Access-Network-Info header field a UE-local-IP-address parameter set to the UE local IP address in the UE-Local-IP-Address parameter received from PCRF;\nB)\tif a UDP-Source-Port parameter specified in 3GPP TS 29.212 [13B] is received from the PCRF and if required by local operator policy, the P-CSCF shall also include in the P-Access-Network-Info header field a UDP-source-port parameter set to the UDP port in the UDP-Source-Port parameter received from PCRF;\nC)\tif a TCP-Source-Port parameter specified in 3GPP TS 29.212 [13B] is received from the PCRF and if required by local operator policy, the P-CSCF shall also include in the P-Access-Network-Info header field a TCP-source-port parameter set to the TCP port in the TCP-Source-Port parameter received from PCRF; and\nD)\tif an AN-GW-Address parameter specified in 3GPP TS 29.212 [13B] is received from the PCRF and if required by local operator policy, the P-CSCF shall also include in the P-Access-Network-Info header field an ePDG-IP-address parameter set to the ePDG IP address in the ePDG-IP-Address parameter received from PCRF; and\nVII)\tif the P-CSCF supports reporting EPS fallback, then the \"eps-fallback\" parameter is included, if the information is available to the P-CSCF; and\n-\tif the IP-CAN-Type value provided by the PCRF is \"DVB-RCS2\", then the \"network-provided\" parameter is included, the access-type field is set to \"DVB-RCS2\", and the \"dvb-rcs2-node-id\" parameter is set with the value provided by the IP-CAN provider;\nd)\tif the PCRF is used to support the access technology for this UE and 3GPP-User-Location-Info as specified in 3GPP TS 29.214 [13D] is available;\nI)\tthe access-type field or the access-class field is set to a value consistent with that received from the PCRF in the IP-CAN-Type and RAT-Type parameters;\nII)\tthe access-info field is set to a value consistent with the information received from the PCRF in the 3GPP-User-Location-Info parameter;\nIII)\tif a 3GPP-MS-TimeZone parameter is available from the PCRF, then the \"local-time-zone\" parameter and the \"daylight-saving-time\" parameter may also be added using this information;\nIV)\tthe \"network-provided\" parameter is added;\nV)\tif required by local operator policy and the P-CSCF is able to deduce a Geographical Identifier from the Cell Global Identity () or form the Service Area Identifier (SAI) received from the PCRF, the P-CSCF shall include an operator-specific-GI field. The P-CSCF can obtain a Geographical Identifier from the  by using the e2 interface (see ETSI ES 283 035 [98]); and\nNOTE 7:\tETSI ES 283 035 [98] Release 3 enables querying a  using the User-Data-Request command in which the Global-Access-Id  contains the 3GPP-User-Location-Info  with a  or a SAI value to get a corresponding Geographical Identifier. If multiple CLFs are deployed, the P-CSCF can determine which  to query based on the  or the SAI values or can use a DIAMETER proxy if deployed.\nVI)\tif the P-CSCF supports reporting EPS fallback then the \"eps-fallback\" parameter is included, if the information is available to the P-CSCF; and\ne)\tif DOCSIS is used, and proprietary means of obtaining a location are used, the access-type field is set to \"DOCSIS\" and the \"network-provided\" parameter is added; and\nf)\tif none of NASS, PCRF and DOCSIS are used to support the access technology for the UE and the IP-CAN is not provided by the packet switched domain of the PLMN of the P-CSCF:\nI)\tif the P-CSCF is unaware of the radio access technology used by the UE, the access-class field is set to \"VIRTUAL-no-PS\";\nII)\tif the P-CSCF is aware that the radio access technology used by the UE is specified by IEEE Std 802.11 [248], the access-class field is set to \"WLAN-no-PS\"; and\nIII)\tthe \"network-provided\" parameter is added;\n5)\tshall remove all Feature-Caps header fields, if present, from a UE that is not considered as privileged sender;\n6)\tmay insert a P-Visited-Network-ID header field (except ACK, BYE, CANCEL, NOTIFY, PRACK, INFO and UPDATE) according to RFC 7976 [52A] with the value:\nI)\tof a pre-provisioned string that identifies the network of the P-CSCF at the home network; or\nII)\tif the UE is roaming in deployments without IMS-level roaming interfaces according to 3GPP TS 23.228 [7], a string that identifies the visited network of the UE including an indication that the P-CSCF is located in the home network;\n7)\tmay insert a P-Visited-Network-ID header field in 200 (OK) response to INVITE request and in 200 (OK) response to MESSAGE request according to draft-jesske-update-p-visited-network [52B]; and\n8)\tif a Geolocation header field is received from the UE, shall remove any present loc-src parameter from the Geolocation header field.\nWhen the P-CSCF receives any request or response containing the P-Media-Authorization header field, the P-CSCF shall remove the header field.\nNOTE 8:\tDepending on the security mechanism in use, the P-CSCF can integrity protect all SIP messages sent to the UE outside of the registration and authentication procedures by using a security association or  session. The P-CSCF will discard any SIP message that is not protected by using a security association or  session and is received outside of the registration and authentication procedures. The integrity and confidentiality protection and checking requirements on the P-CSCF within the registration and authentication procedures are defined in subclause 5.2.2.\nWith the exception of 305 (Use Proxy) responses, the P-CSCF shall not recurse on 3xx responses.\nNOTE 9:\tIf the P-CSCF is connected to a PDF the requirements for this interconnection is specified in the Release 6 version of this specification.\nThe P-CSCF may add, remove, or modify, the P-Early-Media header field within forwarded SIP requests and responses according to procedures in RFC 5009 [109].\nNOTE 10:\tThe P-CSCF can use the P-Early-Media header field for the gate control procedures, as described in 3GPP TS 29.214 [13D]. In the presence of early media for multiple dialogs due to forking, if the P-CSCF is able to identify the media associated with a dialog, (i.e., if symmetric  is used by the UE and the P-CSCF can use the remote SDP information to determine the source of the media) the P-CSCF can selectively open the gate corresponding to an authorized early media flow for the selected media.\nWhen SIP digest without  is used, the P-CSCF shall discard any SIP messages received outside of the registration and authentication procedures that do not map to an existing IP association as defined in subclause 5.2.3.\nIn case a device performing address and/or port number conversions is provided by a (P)T or (P)T-PT controlled by the P-CSCF, the P-CSCF may need to modify the SIP contents according to the procedures described in annex F. In case a device performing address and/or port number conversions is provided by a (P)T or (P)T-PT not controlled by the P-CSCF, the P-CSCF may need to modify the SIP contents according to the procedures described in annex K if both a \"reg-id\" and \"+sip.instance\" header field parameters are present in the received Contact header field as described in RFC 5626 [92].\nThe P-CSCF shall support the provision of the user-related policies (e.g. consideration of the user as a privileged sender):\n-\tfrom the S-CSCF during registration; and\n-\tby local configuration.\nFor the same policy, the precedence between the locally configured policy and a policy received during registration shall be based on local operator policy.\nFor UE performing the functions of an external attached networks using static mode of operation, the P-CSCF will receive requests to establish a  session that are not accompanied by the associated procedures of subclause 5.2.2. The P-CSCF shall permit the establishment of such  sessions, but subsequent operations without the reception of a REGISTER request shall only be permitted if the P-CSCF is configured for such a UE performing the functions of an external attached network using static mode of operation. Where a REGISTER request is received from a UE, the P-CSCF shall process the REGISTER request as defined in subclause 5.2.2, and shall not provide special procedures for a UE performing the functions of an external attached network using static mode of operation for the duration of the registration.\nNOTE 11:\tFor requests other than REGISTER received from UEs that are not configured in this manner, then the procedures of subclause 5.2.6.3.2A apply.\nNOTE 12:\tThe P-CSCF does not subscribe to the reg event package for a UE performing the functions of an external attached network using static mode of operation.\nWhen sending a failure response to any received request, depending on operator policy, the P-CSCF may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"p-cscf\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17. A P-CSCF when sending a failure response will add in the URN the \"side\" header field parameter set to:\n-\t\"orig\" for a UE-originating case; and\n-\t\"term\" for a UE-terminating case.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tRegistration",
                            "text_content": "The P-CSCF shall be prepared to receive the unprotected REGISTER requests on the SIP default port values as specified in RFC 3261 [26]. The P-CSCF shall also be prepared to receive the unprotected REGISTER requests on the port advertised to the UE during the P-CSCF discovery procedure.\nNOTE 1:\tThe P-CSCF will only accept further registration and subsequent SIP messages on the same ports for security mechanisms that do not require to use negotiated ports for exchanging protected messages.\nThe P-CSCF shall distinguish between security mechanisms through the use of the Security-Client header field and Authorization header field as follows:\n1)\tif a REGISTER request from the UE contains a Security-Client header field and the Require and Proxy-Require header fields contain \"sec-agree\", then for an initial registration, the P-CSCF shall select the sec-mechanism and mode (as described in Annex H of 3GPP TS 33.203 [19]) from the corresponding parameters offered in the Security-Client header field according to its priorities, as follows:\n-\tif the P-CSCF selects the sec-mechanism \"ipsec- 3gpp\" then follow the procedures as described in subclause 5.2.2.2, in addition to the procedures described in this subclause;\n-\tif the P-CSCF selects the sec-mechanism \"tls\" then follow the procedures as described in subclause 5.2.2.4, in addition to the procedures described in this subclause.\nNOTE 2:\tIf the Security-Client header field contains only media plane security mechanisms then Require and Proxy-Require header fields will not contain \"sec-agree\". The P-CSCF will then continue as per the procedure in bullet 2), not select a signalling plane security mechanism and then distinguish signalling plane security based upon the Authorization header field as described in the steps below.\n2)\tif:\na)\ta REGISTER request from the UE does not contain a Security-Client header field;\nb)\ta REGISTER request from the UE contains a Security-Client header field containing only media plane security mechanisms and the Require and Proxy-Require header fields do not contain \"sec-agree\"; or\nc)\tthe P-CSCF does not select any signalling plane security mechanism from the Security-Client header field;\nthen the P-CSCF shall behave as follows, in addition to the procedures described in the remainder of this subclause:\n-\tif the REGISTER request does not contain an Authorization header field and was received over an access network defined in 3GPP specifications then follow the GPRS-IMS-Bundled authentication procedures as described in subclause 5.2.2.6; or\n-\tif the REGISTER request does not contain an Authorization header field and was received over a TISPAN NASS and the P-CSCF supports both SIP digest and NASS-IMS bundled authentication, then the P-CSCF shall perform the steps required for NASS-IMS bundled authentication, in subclause 5.2.2.5, as well as the steps required for SIP digest without , in subclause 5.2.2.3, unless it is configured to behave differently or the P-CSCF only supports either SIP digest without  or NASS-IMS bundled authentication. If the NASS-IMS bundled authentication related query from the P-CSCF to the TISPAN NASS fails, then the P-CSCF shall only continue with the SIP digest related steps; or\n-\tif the REGISTER request does not contain an Authorization header field, and was received over an access other than defined in 3GPP specifications or TISPAN NASS, then follow the SIP digest without  procedures described in subclause 5.2.2.3; or\nNOTE 3:\tHow the P-CSCF recognizes over which access network a request was received is an implementation specific feature.\n-\tif the REGISTER request contains an Authorization header field with an \"algorithm\" header field parameter set to \"AKAv2-SHA-256\" and the REGISTER request was received by eP-CSCF over , then follow the IMS-AKA procedures for eP-CSCF defined in 3GPP TS 24.371 [8Z]; or\n-\tif the REGISTER request contains an Authorization header field without an \"algorithm\" header field parameter set to \"AKAv2-SHA-256\" and was not received over a TISPAN NASS then follow the SIP digest without  procedures as described in subclause 5.2.2.3; or\n-\tif the REGISTER request contains an Authorization header field and was received over a TISPAN NASS, and the P-CSCF supports both SIP digest and NASS-IMS bundled authentication, then the P-CSCF shall perform the steps required for NASS-IMS bundled authentication, in subclause 5.2.2.5, as well as the steps required for SIP digest without , in subclause 5.2.2.3, unless it is configured to behave differently. If the NASS-IMS bundled authentication related query from the P-CSCF to the TISPAN NASS fails, then the P-CSCF shall only continue with the SIP digest related steps.\nFor subsequent registrations, the P-CSCF shall continue to use the selected mechanism.\nNOTE 4:\tThe steps required for SIP digest and for NASS-IMS bundled authentcation are not in contradiction. Rather, for NASS-IMS bundled authentication the P-CSCF needs to perform additional steps, namely an exchange with the TISPAN NASS and an inclusion of NASS location information in the REGISTER request, on top of the steps required for SIP digest.\nNOTE 5:\tHow the P-CSCF knows the access network type of a specific network interface is implementation-dependent (e.g. it can know the access network type from different UE IP address ranges or by using different network interfaces for different access network types).\nWhen the P-CSCF receives a REGISTER request from the UE, the P-CSCF shall:\n1)\tinsert a Path header field in the request including an entry containing:\n-\tthe SIP  identifying the P-CSCF;\n-\tan indication that requests routed in this direction of the path (i.e. from the S-CSCF towards the P-CSCF) are expected to be treated as for the UE-terminating case;\nNOTE 6:\tThis indication can e.g. be in a parameter in the , a character string in the user part of the  or be a port number in the .\n-\tan IMS flow token in the user portion of the P-CSCF's SIP  inserted into the Path header field, and the \"ob\" SIP  parameter according to RFC 5626 [92]. The same SIP  (user portion, hostport parameter and SIP  parameters) shall be used for the initial registration, and the reregistrations, binding fetchings, and de-registration that refreshes of the respective registration;\n-\tthe P-CSCF shall use a different IMS flow token for each registration. If the multiple registration mechanism is used, the P-CSCF shall also use a different IMS flow token for each registration flow associated with the registration;\nNOTE 7:\tThe form of the IMS flow token is of local significance to the P-CSCF only and can thus be chosen freely by a P-CSCF implementation.\nNOTE 8:\tBy inserting the \"ob\" SIP  parameter in its SIP , the P-CSCF indicates that it supports multiple registrations as specified in RFC 5626 [92]. The presence of the \"ob\" SIP  parameter is not an indication that the P-CSCF supports the keep-alive mechanism. When the P-CSCF detects that the UE is behind a  and the P-CSCF supports a keep-alive mechanism defined in RFC 5626 [92].\n-\tif\na)\tthe P-CSCF supports indicating the traffic leg associated with a  as specified in RFC 7549 [225];\nb)\tthe UE is roaming;\nc)\tthe P-CSCF is not in the home network; and\nd)\trequired by local policy;\nthen the P-CSCF may append an \"iotl\" SIP  parameter with a value set to \"homeB-visitedB\" to the SIP  of the Path header field;\n2)\tinsert a Require header field containing the option-tag \"path\";\n3)\tinsert a P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter;\n4)\tinsert a P-Visited-Network-ID header field, with the value:\n-\tof a pre-provisioned string that identifies the network of the P-CSCF at the home network; or\n-\tif the UE is roaming in deployments without IMS-level roaming interfaces according to 3GPP°TS°23.228°[7], a string that identifies the visited network of the UE including an indication that the P-CSCF is located in the home network.\nEXAMPLE:\tA UE is roaming using a deployment without an IMS-level roaming interface and the P-CSCF receives via Rx interface a MCC with the value \"111\" and a MNC with the value \"22\" identifying the visited network. The domain name of the home network where the P-CSCF is located has the value \"networkoperator\". In this case, the P-CSCF can set up the P-Visited Network-ID header with a string which can look like: \"s8hr.mnc22.mcc111.networkoperator\".\nNOTE 9:\tThe information of the visited network of the UE is taken from Rx interface as defined in 3GPP°TS°29.214°[13D].\nNOTE 10:\tIf required, the P-CSCF can determine that a UE is roaming using deployment without IMS-level roaming interfaces, if the via Rx interface received network information of the roaming UE points to a different network as the P-CSCF belongs to.\n4A)\tstore the announcement of the media plane security mechanisms the UE supports labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7 and received in the Security-Client header field, if any. Also, if the Security-Client header field contains only media plane security mechanisms, remove the header field;\nNOTE 11:\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\n4B)\tif the REGISTER request contains an Authorization header field, remove the \"integrity-protected\" header field parameter, if present;\n4C)\tif the host portion of the sent-by field in the topmost Via header field contains a FQDN, or if it contains an IP address that differs from the source address of the IP packet, the P-CSCF shall add a \"received\" Via header field parameter in accordance with the procedure defined in RFC 3261 [26];\n5)\tif the P-CSCF is located in the visited network, and local policy requires the application of IBCF capabilities in the visited network towards the home network:\na)\tif the request is not to be forwarded to an ATCF according to local policy select an exit point in visited network;\nNOTE 12:\tThe list of the exit points can be either obtained as specified in RFC 3263 [27A] or provisioned in the P-CSCF.\nb)\tif the request is to be forwarded to an ATCF according to local policy:\ni)\tinsert a Route header field with the ATCF  for originating requests; and\nii)\tforward the request; and\nc)\tif the request is not to be forwarded to an ATCF according to local policy, then forward the request to the selected exit point.\nIf:\n-\tno response is received to the REGISTER request and its retransmissions by the P-CSCF; or\n-\ta 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request is received;\nthe P-CSCF shall repeat the actions of this bullet with a different exit point or a different ATCF.\nIf the P-CSCF fails to forward the REGISTER request to any exit point or any ATCF, the P-CSCF shall send back a 504 (Server Time-Out) response to the user, in accordance with the procedures in RFC 3261 [26] unless local policy allows omitting the exit point;\nNOTE 13:\tIf the P-CSCF forwards the request to an IBCF in the visited network, the IBCF in the visited network can determine the entry point of the home network, as specified in RFC 3263 [27A] or the entry point of the home network can be provisioned in the IBCF in the visited network.\n6)\tif the P-CSCF is located in the visited network and local policy does not require the application of IBCF capabilities in the visited network towards the home network:\na)\tif the request is not to be forwarded to an ATCF according to local policy select an entry point of the home network;\nNOTE 14:\tThe list of the entry points can be either obtained as specified in RFC 3263 [27A] or provisioned in the P-CSCF.\nb)\tif the request is to be forwarded to an ATCF according to local policy:\ni)\tinsert a Route header field with the ATCF  for originating requests; and\nii)\tforward the request; and\nc)\tif the request is not to be forwarded to an ATCF according to local policy, then forward the request to the selected entry point.\nIf:\n-\tno response is received to the REGISTER request and its retransmissions by the P-CSCF; or\n-\ta 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request is received;\nthe P-CSCF shall repeat the actions of this bullet with a different entry point or a different ATCF.\nIf the P-CSCF fails to forward the REGISTER request to any entry point or any ATCF, the P-CSCF shall send back a 504 (Server Time-Out) response to the user, in accordance with the procedures in RFC 3261 [26];\n7)\tif the P-CSCF is located in the home network:\na)\tif the request is not to be forwarded to an ATCF according to local policy select the I-CSCF of the home network;\nNOTE 15:\tThe list of the I-CSCFs can be either obtained as specified in RFC 3263 [27A] or provisioned in the P-CSCF.\nb)\tif the request is to be forwarded to an ATCF according to local policy:\ni)\tinsert a Route header field with the ATCF  for originating requests; and\nii)\tforward the request; and\nc)\tif the request is not to be forwarded to an ATCF according to local policy, then forward the request to the selected I-CSCF.\nIf:\n-\tno response is received to the REGISTER request and its retransmissions by the P-CSCF; or\n-\ta 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request is received;\nthe P-CSCF shall repeat the actions of this bullet with a different I-CSCF or a different ATCF.\nIf the P-CSCF fails to forward the REGISTER request to any I-CSCF or any ATCF, the P-CSCF shall send back a 504 (Server Time-Out) response to the user, in accordance with the procedures in RFC 3261 [26]; and\n8)\tvoid.\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request, the P-CSCF shall check the value of the registration expiration interval value. When the registration expiration interval value is different than zero, then the P-CSCF shall:\n1)\tsave the list of service route values in the Service-Route header fields preserving the order, and bind the list either to the contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used) and the associated security association or  session over which the REGISTER request was received. The P-CSCF shall store this list during the entire registration period of the respective public user identity and bind it either to the associated contact address or to the registration flow and the associated contact address (if the multiple registration mechanism is used). The P-CSCF shall use this list to validate the routeing information in the requests originated by the UE using either the respective contact address or the registration flow and the associated contact address, and received over the respective security association or a  session. If the list of Service-Route header fields already exists either for this contact address or the registration flow and the associated contact address (if the multiple registration mechanism is used), then the P-CSCF shall replace the already existing list of service route values with the list of Service-Route header fields received in the 200 (OK) response;\nNOTE 16:\tWhen the UE registers multiple registration flows and the associated contact addresses, then the UE and the P-CSCF will have a list of Service-Route header fields for each registration flow and the associated contact address and the associated security association or  session. When sending a request using a given registration flow and the associated contact address and the associated security association or  session, the UE will use the corresponding list of Service-Route header fields, when building a list of Route header fields.\n2)\tassociate the list of service route values with the registered public user identity and either the associated contact address or the registration flow and the associated contact address (if the multiple registration mechanism is used) and the associated security association or  session;\n3)\tstore the public user identities, found in the P-Associated- header field value, including any associated display names, and any parameters associated with either the user or the identities of the user, and associate them to the registered public user identity, i.e. the registered public user identity and its associated set of implicitly registered public user identities are bound to the contact address and security association or  session over which the REGISTER request was received;\n3A)\tif the user-related policies statically provisioned to the P-CSCF (see subclause 5.2.1) indicate that the URIs contained in the P-Associated- header field shall not be forwarded towards the UE, and the P-CSCF is located in the home operator network of the UE, then the P-CSCF shall remove all but the first  contained in the P-Associated- header field of the 200 (OK) response;\nNOTE 17:\tThe URIs in the P-Associated- header field might need to be removed in case of the UE performs the functions of an external attached network (e.g an enterprise network).\n4)\tstore the default public user identity, including its associated display name, if provided, for use with procedures for the P-Asserted-Identity header field for requests received from the UE over the respective security association or  session. The default public user identity is the first on the list of URIs present in the P-Associated- header field;\nNOTE 18:\tThere can be more than one default public user identity stored in the P-CSCF, as the result of the multiple registrations of public user identities.\nNOTE 19:\tFor each contact address and the associated security association or  session the P-CSCF will maintain a list of registered public user identities and the associated default public user identities, that it will use when populating the P-Asserted Identity header.\n5)\tstore the values received in the P-Charging-Function-Addresses header field;\n6)\tif a \"term-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"term-ioi\" header field parameter;\nNOTE 20:\tAny received \"term-ioi\" header field parameter will contain a type 1 IOI. The type 1 IOI identifies the home network of the registered user.\n7)\tif the P-CSCF included an IMS flow token and the \"ob\" SIP  parameter in the Path header field of the REGISTER request, check for presence of the option-tag \"outbound\" in the Require header field of the a 200 (OK) response:\n-\tif the option-tag \"outbound\" is present, it indicates that the UE has successfully registered its public user identity with a new bidirectional flow as defined in RFC 5626 [92]. In this case the P-CSCF shall route the subsequent requests and responses destined for the UE as specified in RFC 5626 [92]; or\n-\tif the option-tag \"outbound\" is not present, it indicates that the public user identity has not been registered as specified in RFC 5626 [92]. In this case the P-CSCF shall route the subsequent requests and responses destined for the UE as specified in RFC 3261 [26];\n8)\tif the P-CSCF detects that the UE is behind a , and the UE's Via header field contains a \"keep\" header field parameter, the P-CSCF shall add a value to the parameter, to indicate that it is willing to receive keep-alives associated with the registration from the UE, as defined in RFC 6223 [143];\n9)\tvoid; and\n10)\tif the P-CSCF is located in the visited network, store the value of a \"+g.3gpp.thig-path\" Feature-Caps header field parameter, defined in subclause 7.9A.9, if included in the response. The P-CSCF shall remove the \"+g.3gpp.thig-path\" Feature-Caps header field parameter before forwarding the 200 (OK) response to the UE.\nIf the P-CSCF detects that the UE is behind a , and the request was received over a  connection, the P-CSCF shall not close the  connection during the duration of the registration.\nNOTE 21:\tThe P-CSCF can conclude whether the UE is behind a  or not by comparing the IP address in the \"received\" header field parameter with the IP address in the sent-by parameter in the topmost Via header field. If the values do not match, the P-CSCF can conclude that the UE is behind a .\nWhen the P-CSCF receives a REGISTER request from the UE, as defined in subclause 5.2.2.1, the P-CSCF shall additionally:\n1)\tinsert the \"integrity-protected\" header field parameter (described in subclause 7.2A.2) with a value \"yes\" into the Authorization header field in case the REGISTER request was either received protected with the security association created during an ongoing authentication procedure and includes an authentication challenge response (i.e.  parameter), or it was received on the security association created during the last successful authentication procedure, otherwise insert the parameter with the value \"no\";\n1A)\tif the \"reg-id\" header field parameter was included in the Contact header field of the REGISTER request, insert in the Path header an IMS flow token and the \"ob\"  parameter according to RFC 5626 [92]. The IMS flow token shall identify the flow from the P-CSCF toward the UE, as follows:\na)\tfor UDP, the IMS flow token identifies the unidirectional flow from the P-CSCF's protected client port and the P-CSCF's IP address to the UE's protected server port and the UE's IP address. This flow is used by the P-CSCF to send requests and responses to the UE. The P-CSCF shall receive the requests and responses from the UE on its protected server port; or\nb)\tfor , the IMS flow token identifies the existing  connection between the UE and the P-CSCF. This  connection is established by the P-CSCF, i.e. from the P-CSCF's protected client port and the P-CSCF's IP address to the UE's protected server port and the UE's IP address. This  connection is used to send SIP requests from the P-CSCF to the UE and receive SIP responses from the UE to the P-CSCF;\n2)\tin case the REGISTER request was received without protection, on the default port or port advertised to UE for P-CSCF discovery:\na)\tcheck the existence of the Security-Client header field. If the Security-Client header field is present, then remove and store it. If the Security-Client header field is not present, then the P-CSCF shall return a suitable 4xx response;\nb)\tif the \"rport\" header field parameter is included in the Via header field, set the value of the \"rport\" header field parameter in the Via header field to the source port of the received REGISTER request;\nc)\tinsert the \"received\" header field parameter in the Via header field containing the source IP address that the request came from, as defined in RFC 3581 [56A]; and\nNOTE 1:\tAs defined in RFC 3581 [56A], the P-CSCF will insert a \"received\" header field parameter containing the source IP address that the request came from, even if it is identical to the value of the \"sent-by\" component.\nNOTE 2:\tUpon receiving the unprotected REGISTER request the P-CSCF detects if the UE is behind a .\n3)\tin case the REGISTER request was received protected, then towards the port that was notified to the UE in the previous response:\na)\tcheck the security association which protected the request. If the security association is a temporary one, then the request is expected to contain a Security-Verify header field in addition to a Security-Client header field. If there are no such header fields, then the P-CSCF shall return a suitable 4xx response. If there are such header fields, then the P-CSCF shall compare the content of the Security-Verify header field with the content of the Security-Server header field sent earlier and the content of the Security-Client header field with the content of the Security-Client header field received in the challenged REGISTER request. If those do not match, then there is a potential man-in-the-middle attack. The request should be rejected by sending a suitable 4xx response. If the contents match, the P-CSCF shall remove the Security-Verify and the Security-Client header field;\nb)\tif the security association the REGISTER request was received on, is an already established one, then:\n-\tthe P-CSCF shall remove the Security-Verify header field if it is present;\n-\ta Security-Client header field containing new parameter values is expected. If the Security-Client header field or any required parameter is missing, then the P-CSCF shall return a suitable 4xx response; and\n-\tthe P-CSCF shall remove and store the Security-Client header field before forwarding the request to the S-CSCF;\nc)\tcheck if the private user identity conveyed in the Authorization header field of the protected REGISTER request is the same as the private user identity which was previously challenged or authenticated. If the private user identities are different, the P-CSCF shall reject the REGISTER request by returning a 403 (Forbidden) response; and\nd)\tignore the \"rport\" Via header field parameter, if included.\nNOTE 3:\tOnce the IPsec security associations between the UE and the P-CSCF have been created, in case of UDP the P-CSCF sends the responses to a different UE's port then the one from which the request was received from the UE. For the , the responses are sent on the  connection on which the request was received. Hence, the P-CSCF will ignore the \"rport\" Via header field parameter in all protected requests and responses, if received.\nWhen the P-CSCF receives a 401 (Unauthorized) response to a REGISTER request, the P-CSCF shall:\n1)\tdelete any temporary set of security associations established towards the UE;\n2)\tremove the \"ck\" and \"ik\" -Authenticate header field parameters contained in the 401 (Unauthorized) response and bind the values to the proper private user identity and to the temporary set of security associations which will be setup as a result of this challenge. The P-CSCF shall forward the 401 (Unauthorized) response to the UE if and only if the \"ck\" and \"ik\" header field parameters have been removed;\n3)\tinsert a Security-Server header field in the response, containing the P-CSCF static signalling plane security list and the parameters needed for this security association setup, as specified in Annex H of 3GPP TS 33.203 [19]. The P-CSCF shall support the \"ipsec-3gpp\" security mechanism, as specified in RFC 3329 [48]. The P-CSCF shall support the IPsec layer algorithms for integrity and confidentiality protection as defined in 3GPP TS 33.203 [19] and shall announce support for them according to the procedures defined in RFC 3329 [48];\n3A)\tinsert a Security-Server header field to specify the media plane security mechanisms the P-CSCF (IMS-) supports, if any, labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7;\nNOTE 4\tThe \"mediasec\" header field parameter indicates that security mechanisms are specific to the media plane.\n4)\tset up the temporary set of security associations for this registration with a temporary SIP level lifetime between the UE and the P-CSCF for the user identified with the private user identity. For further details see 3GPP TS 33.203 [19] and RFC 3329 [48]. The P-CSCF shall set the temporary SIP level lifetime for the temporary set of security associations to the value of reg-await-auth timer; and\n5)\tsend the 401 (Unauthorized) response to the UE using the security association with which the associated REGISTER request was protected, or unprotected in case the REGISTER request was received unprotected. If the 401 (Unauthorized) response to the unprotected REGISTER request is sent using UDP, the P-CSCF shall send the response to the IP address listed in the \"received\" Via header field parameter and the port in the \"rport\" Via header field parameter. In case of , the P-CSCF shall send the response over the same  connection over which the request was received from the UE.\nNOTE 5:\tThe challenge in the 401 (Unauthorized) response sent back by the S-CSCF to the UE as a response to the REGISTER request is piggybacked by the P-CSCF to insert the Security-Server header field in it. The S-CSCF authenticates the UE, while the P-CSCF negotiates and sets up two pairs of security associations with the UE during the same registration procedure. For further details see 3GPP TS 33.203 [19].\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request as defined in subclause 5.2.2.1, the P-CSCF shall additionally:\n1)\tif an existing set of security association is available, set the SIP level lifetime of the security association to the longest of either the previously existing security association lifetime, or the lifetime of the just completed registration plus 30 seconds;\n2)\tif a temporary set of security associations exists, change the temporary set of security associations to a newly established set of security associations, i.e. set its SIP level lifetime to the longest of either the previously existing set of security associations SIP level lifetime, or the lifetime of the just completed registration plus 30 seconds; and\n3)\tprotect the 200 (OK) response to the REGISTER request within the same security association to that in which the REGISTER request was protected.\nIf the P-CSCF receives a SIP message (including REGISTER requests) from the UE over the newly established set of security associations that have not yet been taken into use, the P-CSCF shall:\n1)\treduce the SIP level lifetime of the old set of security associations towards the same UE to 64*T1 (if currently longer than 64*T1); and\n2)\tuse the newly established set of security associations for further messages sent towards the UE as appropriate (i.e. take the newly established set of security associations into use).\nNOTE 6:\tIf the UE has registered other contact addresses and established security associations for these contact addresses, it can use them when sending subsequent SIP messages rather than using the newly established set of security associations. In this case the P-CSCF will not receive any SIP message over the newly established set of security associations.\nNOTE 7:\tIn this case, the P-CSCF will send requests (that specify the associated contact address in the Request-) towards the UE over the newly established set of security associations. Responses towards the UE that are sent via UDP will be sent over the newly established set of security associations. Responses towards the UE that are sent via  will be sent over the same set of security associations that the related request was received on.\nNOTE 8:\tWhen receiving a SIP message (including REGISTER requests) from the UE over a set of security associations that is different from the newly established set of security associations, the P-CSCF will not take any action on any set of security associations.\nWhen the SIP level lifetime of an old set of security associations is about to expire, i.e. their SIP level lifetime is shorter than 64*T1 and a newly established set of security associations has not been taken into use, the P-CSCF shall use the newly established set of security associations for further messages towards the UE as appropriate (see NOTE 2).\nWhen sending the 200 (OK) response for a REGISTER request that concludes a re-authentication, the P-CSCF shall:\n1)\tkeep the set of security associations that was used for the REGISTER request that initiated the re-authentication;\n2)\tkeep the newly established set of security associations created during this authentication; and\n3)\tgo on using for further requests sent towards the UE the set of security associations and associated contact address that was used to protect the REGISTER request that initiated the re-authentication as appropriate (see NOTE 6).\nWhen sending the 200 (OK) respone for a REGISTER request that concludes an initial authentication of the user registering its public user identity with a given contact address the associated security association, i.e. the REGISTER request that initiated the authentication was received unprotected, the P-CSCF shall:\n1)\tkeep the newly established set of security associations created during this authentication; and\n2)\tuse the kept newly established set of security associations and associated contact address for further messages sent towards the UE as appropriate (see NOTE 6).\nNOTE 9:\tFor each contact address or for each registration flow and the associated contact address and bound to a set of security associations the P-CSCF will maintain two Route header field lists. The first Route header field list (constructed form the Service-Route header fields received during the last registration procedure of either the respective contact address or a registration flow and the associated contact address) is used only to validate the routeing information in the initial requests for a dialog and stand alone transactions originating from the UE using either the respective contact address or a registration flow and the associated contact address and are the respective security association. This list is valid as long as there is at least one public user identity registered either with the associated contact address or a registration flow and the associated contact address. The second list is the list of Route header fields (constructed from the Record Route header fields in the initial INVITE request and associated response) is used during the duration of the call. Once the call is terminated, this list of Route header fields is discarded.\nThe P-CSCF shall delete any security association from the IPsec database when their SIP level lifetime expires.\nThe handling of the security associations at the P-CSCF is summarized in table 5.2.2-1.\nTable 5.2.2-1: Handling of security associations at the P-CSCF\n\nWhen the P-CSCF receives a REGISTER request from the UE, as defined in subclause 5.2.2.1, the P-CSCF shall additionally:\n1)\tif the REGISTER request includes an Authorization header field update the \"integrity-protected\" header field parameter as follows:\na)\tif the REGISTER request does not map to an existing IP association, and does not contain a challenge response, not include the \"integrity-protected\" header field parameter; or\nb)\tif the REGISTER request does not map to an existing IP association, and does contain a challenge response, include an \"integrity-protected\" header field parameter with the value set to \"ip-assoc-pending\"; or\nc)\tif the REGISTER request does map to an existing IP association, include an \"integrity-protected\" header field parameter with the value set to \"ip-assoc-yes\";\nNOTE 1:\tThe value of \"ip-assoc-pending\" for the \"integrity-protected\" header field parameter or the absence of an \"integrity-protected\" header field parameter in the Authorization header field is an indication to the I-CSCF and S-CSCF that this is an initial REGISTER request.\n2)\tif the P-CSCF adds a \"received\" header field parameter and UDP is being used, also add an \"rport\" Via header field parameter with the IP source port of the received REGISTER request; and\n3)\tif the REGISTER request does not contain an Authorization header field and the requests was received over a non 3GPP access network, insert a P-Access-Network-Info header field as described in subclause 5.2.1 step 4).\nNOTE 2:\tHow the P-CSCF recognizes over which access network a request was received is an implementation specific feature.\nNOTE 3:\tSubclause 5.2.1 describes the encoding of the P-Access-Network-Info header field, the mandatory requirement is defined in the above bullet.\nIf the P-CSCF receives a 500 (Server Internal Error) or 504 (Server Time-Out) response to a REGISTER request, and if the REGISTER request is mapped to an existing IP association, then the P-CSCF shall delete the IP association.\nNOTE 4:\tThe P-CSCF deletes the IP association on receipt of 500 (Server Internal Error) or 504 (Server Time-Out) so that the next REGISTER request received from the UE will look like an initial REGISTER request.\nWhen the P-CSCF receives a 401 (Unauthorized) response to a REGISTER request, the P-CSCF shall:\n1)\tinsert a Security-Server header field to specify the media plane security mechanisms the P-CSCF (IMS-) supports, if any, labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7; and\n2)\tsend the 401 (Unauthorized) response to the UE unprotected as defined in clause 4 of RFC 3581 [56A].\nNOTE 5:\tThe P-CSCF does not include signalling plane security mechanisms because the Require and Proxy-Require header fields in the REGISTER request do not contain \"sec-agree\".\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request as defined in subclause 5.2.2.1, and the registration expiration interval value is different than zero, the P-CSCF shall additionally:\na)\tcreate an IP association by storing and associating the UE's packet source IP address and port along with the \"sent-by\" parameter of the Via header field, cf. RFC 3261 [26], of the REGISTER request with the private user identity and all the successfully registered public user identities related to that private user identity;\nb)\toverwrite any existing IP association which has the same pair of IP address and port, but a different private user identity; and\nc)\tsend the 200 (OK) response to the UE unprotected as defined in clause 4 of RFC 3581 [56A].\nis optional to implement and is used only in combination with SIP digest authentication. If the P-CSCF supports , then the P-CSCF shall support  as described in 3GPP TS 33.203 [19]. If the P-CSCF supports , the P-CSCF shall support  ciphersuites as described in 3GPP TS 33.203 [19].\nWhen the P-CSCF receives a REGISTER request from the UE, as defined in subclause 5.2.2.1, the P-CSCF shall additionally:\n1)\tin case the REGISTER request was received without protection on the default port or port advertised to UE for P-CSCF discovery and with the Security-Client header field indicating \"tls\", then:\na)\tremove and store the Security-Client header field;\nb)\tdo not include the \"integrity-protected\" header field parameter in the Authorization header;\nc)\tif the \"rport\" header field parameter is included in the Via header field, set the value of the \"rport\" header field parameter in the Via header to the source port of the received REGISTER request; and\nd)\tinsert the \"received\" header field parameter in the Via header containing the source IP address that the request came from, as defined in RFC 3581 [56A];\nNOTE 1:\tThe absence of an \"integrity-protected\" header field parameter in the Authorization header is an indication to the I-CSCF and S-CSCF that this is an initial REGISTER request.\nNOTE 2:\tAs defined in RFC 3581 [56A], the P-CSCF will insert a \"received\" header field parameter containing the source IP address that the request came from, even if it is identical to the value of the \"sent-by\" component.\nNOTE 3:\tUpon receiving the unprotected REGISTER request the P-CSCF detects if the UE is behind a .\n2)\tif the REGISTER request was received protected with a  session, on the protected server port, created during an ongoing authentication procedure, where the Session ID for the  session is not yet bound to a private user identity, and contains an authentication challenge response (i.e. response parameter), then:\na)\tcheck if the private user identity conveyed in the Authorization header of the protected REGISTER request is the same as the private user identity which was previously challenged. If the private user identities are different, the P-CSCF shall reject the REGISTER request by returning a 403 (Forbidden) response;\nb)\tcheck the existence of the Security-Verify header field and the Security-Client header field. If there are no such headers, then the P CSCF shall return a suitable 4xx response. If there are such headers, then the P-CSCF shall compare the content of the Security-Verify header field with the content of the Security-Server header field sent earlier and the content of the Security-Client header field with the content of the Security-Client header field received in the challenged REGISTER request. If those do not match, then there is a potential man-in-the-middle attack. The P-CSCF should reject the request by sending a suitable 4xx response. If the contents match, the P-CSCF shall remove the Security-Verify and the Security-Client header fields;\nc)\tinclude an \"integrity-protected\" header field parameter with the value set to \"tls-pending\"; and\nd)\tif the hostport parameter in the Contact header field is in the form of a FQDN, the P-CSCF shall ensure that the given FQDN will resolve (e.g. by reverse DNS lookup) to the IP address bound to the  session; or\n2A)\tif the REGISTER request was received, protected with a  session on the protected server port, created during an ongoing authentication procedure, where the Session ID for the  session is not yet bound to a private user identity, and does not contain an authentication challenge response (i.e. response parameter), reject the REGISTER request by returning a 403 (Forbidden) response;\n3)\tif the REGISTER request was received on an existing  session created during a previous authentication procedure, then:\na)\tif the REGISTER request includes an Authorization header field, check if the private user identity conveyed in the Authorization header of the protected REGISTER request is the same as the private user identity which was previously authenticated, i.e. the private user identity previously associated with the Session ID for this  session. If the private user identities are different, the P-CSCF shall reject the REGISTER request by returning a 403 (Forbidden) response;\nb)\tcheck the existence of the Security-Verify header field and Security-Client header field. If there are no such header fields, then the P-CSCF shall return a suitable 4xx response. If there are such headers, then the P-CSCF shall compare the content of the Security-Verify header field with the content of the Security-Server header field sent earlier and the content of the Security-Client header field with the content of the Security-Client header field received in the challenged REGISTER request. If those do not match, then there is a potential man-in-the-middle attack. The P-CSCF should reject the request by sending a suitable 4xx response;\nc)\tthe P-CSCF shall remove and store the Security-Client header field and remove the Security-Verify header field before forwarding the request to the S-CSCF; and\nd)\tinclude an \"integrity-protected\" header field parameter with the value set to \"tls-yes\".\nIf the P-CSCF require security agreement, and the Security-Client header field is not present, then the P-CSCF shall return a suitable 4xx response.\nWhen the P-CSCF receives a 401 (Unauthorized) response to a REGISTER request, the P-CSCF shall:\n1)\tinsert a Security-Server header field in the response, containing the P-CSCF selected signalling plane mechanism name, as specified in Annex H of 3GPP TS 33.203 [19]. The P-CSCF shall support and indicate the \"tls\" security mechanism, as specified in RFC 3329 [48]. The P-CSCF shall support the  ciphersuites as described in 3GPP TS 33.203 [19] and shall announce support for them according to the procedures defined in RFC 3329 [48]; and\n1A)\tinsert a Security-Server header field in the response, containing the P-CSCF static media plane security list, if any, labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7;\n2)\tsend the 401 (Unauthorized) response to the UE using the  session with which the associated REGISTER request was protected, or unprotected in case the REGISTER request was received unprotected. If the 401 (Unauthorized) response to the unprotected REGISTER request is sent using UDP, the P-CSCF shall send the response to the IP address listed in the \"received\" header field parameter and the port in the \"rport\" header field parameter. In case of , the P-CSCF shall send the response over the same  connection over which the request was received from the UE.\nNOTE 4:\tThe challenge in the 401 (Unauthorized) response sent back by the S-CSCF to the UE as a response to the REGISTER request is piggybacked by the P-CSCF to insert the Security-Server header field in it.\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request as defined in subclause 5.2.2.1, and the registration expiration interval value is different than zero, the P-CSCF shall additionally:\n-\tcreate an association by storing and associating the UEs IP address and port of the  connection with the  Session ID, the private user identity and all the successfully registered public user identities related to that private user identity; and\n-\tprotect the 200 (OK) response to the REGISTER request within the same  session to that in which the request was protected.\nWhen the P-CSCF receives a REGISTER request from the UE, as defined in subclause 5.2.2.1, the P-CSCF shall additionally:\n1)\tperform the NASS-IMS bundled authentication related query from the P-CSCF to the TISPAN NASS;\n2)\tif the query in step 1) is successful, insert a P-Access-Network-Info header field as described in subclause 5.2.1 step 4); and\n3)\tif the P-CSCF adds a \"received\" header field parameter and UDP is being used, the P-CSCF shall also add an \"rport\" Via header field parameter with the IP source port of the received REGISTER request.\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request from the UE, as defined in subclause 5.2.2.1, the P-CSCF shall additionally:\n1)\tstore an association between the IP source address and port of the initial REGISTER request and the public user identities found in the P-Associated- header field value and associate them to the public user identity under registration;\n2)\tstore an association between the IP source address and port of the initial REGISTER request the default public user identity for use with procedures for the P-Asserted-Identity header field. The default public user identity is the first on the list of URIs present in the P-Associated- header field; and\n3)\tinsert a Security-Server header field to specify the media plane security mechanisms the P-CSCF (IMS-) supports, if any, labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7.\nNOTE 3:\tThe P-CSCF does not include signalling plane security mechanisms because the Require and Proxy-Require header fields in the REGISTER request do not contain \"sec-agree\".\nWhen the P-CSCF receives a SIP request from a GPRS-IMS-Bundled UE, the P-CSCF checks the IP address in the \"sent-by\" parameter of the Via header field provided by the UE as specified in RFC 3261 [6]. If the \"sent-by\" parameter contains a domain name, or if it contains an IP address that differs from the packet source IP address, the P-CSCF adds a \"received\" header field parameter to that Via header field value. This parameter contains the source IP address from which the packet was received.\nWhen the P-CSCF receives a 200 (OK) response to a REGISTER request from the UE, as defined in subclause 5.2.2.1, the P-CSCF shall additionally:\n1)\tstore an association between the IP source address and port of the initial REGISTER request and the public user identities found in the P-Associated- header field value and associate them to the public user identity under registration;\n2)\tstore an association between the IP source address and port of the initial REGISTER request the default public user identity for use with procedures for the P-Asserted-Identity header field. The default public user identity is the first on the list of URIs present in the P-Associated- header field;\n3)\tif the P-CSCF adds a \"received\" header field parameter and UDP is being used, the P-CSCF shall also add an \"rport\" Via header field parameter with the IP source port of the received REGISTER request; and\n4)\tinsert a Security-Server header field to specify the media plane security mechanisms the P-CSCF (IMS-) supports, if any, labelled with the \"mediasec\" header field parameter specified in subclause 7.2A.7.\nNOTE:\tThe P-CSCF does not include signalling plane security mechanisms because the Require and Proxy-Require header fields in the REGISTER request do not contain \"sec-agree\".\nIf the P-CSCF has been reconfigured to not accept initial registrations and reregistrations and to redirect incoming registrations to another P-CSCF, on recepetion of a REGISTER request the P-CSCF shall return a 305 (Use Proxy) response.\nNOTE 1:\tAs an example, this situation can happen in case the P-CSCF has been administratively configured to force the UEs to attempt initial registration with another P-CSCF before shutdown.\nNOTE 2:\tThe UE does not use the Contact header field of 305 (Use Proxy) response to determine the IP address of the new P-CSCF through which the UE will attempt a new initial registration.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.2.2-1: Handling of security associations at the P-CSCF",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.2.3\tSubscription to the user's registration-state event package",
                            "text_content": "Upon receipt of a 200 (OK) response to the first initial REGISTER request (i.e. this was the first initial REGISTER request that the P-CSCF received from the user identified with its private user identity), the P-CSCF shall:\n1)\tgenerate a SUBSCRIBE request in accordance with RFC 3680 [43] and RFC 6665 [28], with the following elements:\na)\ta Request- set to the resource to which the P-CSCF wants to be subscribed to, i.e. to the SIP  that is the default public user identity of the user;\nb)\ta From header field set to the P-CSCF's SIP ;\nc)\ta To header field, set to the SIP  that is the default public user identity of the user;\nd)\tan Event header field set to the \"reg\" event package;\ne)\tan Expires header field set to a value higher than the registration expiration interval value indicated in the 200 (OK) response to the REGISTER request;\nf)\ta P-Asserted-Identity header field:\n-\tif the received 200 (OK) response to the REGISTER request contained a \"+g.3gpp.thig-path\" Feature-Caps header field parameter, as defined in subclause 7.9A.9, and if the P-CSCF is located in the visited network, set to the value of the received \"+g.3gpp.thig-path\" Feature-Caps header field parameter; or\n-\tset to the SIP  of the P-CSCF, which was inserted into the Path header field during the registration of the user to whose registration state the P-CSCF subscribes to; and\ng)\ta P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter;\n1A)\tif\na)\tthe P-CSCF supports indicating the traffic leg as specified in RFC 7549 [225];\nb)\tthe SIP  used in the Request- of the SUBSCRIBE request belongs to a UE that is roaming;\nc)\tthe P-CSCF is not in the home network; and\nd)\tif required by local policy;\nthen append the \"iotl\" SIP  parameter set to \"visitedA-homeA\" to the Request-;\n1B)\tif required by local policy, then insert a Route header field in the SUBSCRIBE request with the list of service route values saved from the Service-Route header field received in the 200 (OK) response to the last registration of the public user identity with associated contact address and skip steps 2 to 4;\n2)\tif the P-CSCF is located in the visited network, and local policy requires the application of IBCF capabilities in the visited network towards the home network, then the P-CSCF shall forward the request to an IBCF in the visited network;\n3)\tif the P-CSCF is located in the visited network and local policy does not require the application of IBCF capabilities in the visited network towards the home network, determine the entry point of the home network (e.g., by using DNS services) and send the SUBSCRIBE request to that entry point, according to the procedures of RFC 3261 [26]; and\n4)\tif the P-CSCF is located in the home network, then the P-CSCF shall forward the request to an I-CSCF in the home network.\nNOTE:\tThe subscription to reg event package is done once per private user identity.\nUpon receipt of a dialog establishing NOTIFY request, as specified in RFC 6665 [28], associated with the SUBSCRIBE request, the P-CSCF shall:\n1)\tstore the information for the so established dialog;\n2)\tstore the expiration time as indicated in the \"expires\" header field parameter of the Subscription-State header field, if present, of the received NOTIFY request. Otherwise the expiration time is retrieved from the Expires header field of the 2xx response to SUBSCRIBE request;\n3)\tfollow the procedures specified in RFC 6665 [28]; and\n4)\tstore the \"icid-value\" header field parameter and the \"orig-ioi\" header field parameter if present in the received P-Charging-Vector header field.\nWhen sending a response to the NOTIFY request, the P-CSCF shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the NOTIFY request, a type 1 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The P-CSCF shall set the type 1 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request.\nIf continued subscription is required the P-CSCF shall automatically refresh the subscription by the reg event package 600 seconds before the expiration time for a previously registered public user identity, either 600 seconds before the expiration time if the initial subscription was for greater than 1200 seconds, or when half of the time has expired if the initial subscription was for 1200 seconds or less. If a SUBSCRIBE request to refresh a subscription fails with a non-481 response, the P-CSCF shall still consider the original subscription valid for the duration of the most recently known \"Expires\" value according to RFC 6665 [28]. Otherwise, the P-CSCF shall consider the subscription invalid and start a new initial subscription according to RFC 6665 [28].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3A\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3B\tSUBSCRIBE request",
                            "text_content": "Upon receipt of a NOTIFY request with the Subscription-State header field set to \"terminated\", once the NOTIFY transaction is terminated, the P-CSCF can remove all the stored information related to the associated subscription.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.4\tRegistration of multiple public user identities",
                            "text_content": "Upon receipt of a NOTIFY request for the dialog associated with the subscription to the reg event package of the user, the P-CSCF shall:\n-\tstore the information for the established dialog;\n-\tstore the expiration time as indicated in the \"expires\" header field parameter of the Subscription-State header field, if present, of the SIP NOTIFY request. Otherwise the expiration time is retrieved from the Expires header field of the 2xx response to SIP SUBSCRIBE request;\n-\tidentify the public user identity as follows:\n1)\tif no <wildcardedIdentity> subelement is included in the <registration> element, the public user identity is taken from the 'aor' attribute of the registration element; or\n2)\tif a <wildcardedIdentity> sub element is included in the <registration> element, the wildcarded public user identity is taken from the <wildcardedIdentity> sub element. The wildcarded public user identity is treated as a public user identity in the procedures of this subclause;\n3)\tfor each public user identity whose state attribute in the <registration> element is set to \"active\", i.e. registered; and\ni)\tthe state attribute within the <contact> sub-element is set to \"active\";\nii)\tthe value of the <uri> sub-element inside the <contact> sub-element is set to the contact address of the user's UE; and\niii)\tthe event attribute of that <contact> sub-element(s) is set to \"registered\" or \"created\";\nthe P-CSCF shall:\ni)\tbind the indicated public user identity as registered to the contact address of the respective user, including any associated display names, and any parameters associated with either the user or the identities of the user;\nii)\tadd the public user identity to the list of the public user identities that are registered for the user saved against the contact address;\niii)\tif the <actions> child element is included in the <registration> element, bind the policy received in the <actions> child element of the <registration> element to each contact address of the public user identity; and\niv)\tif the <actions> child element is not included in the <registration> element, remove the policy bound to each contact address of the public user identity;\n4)\tfor each public user identity whose state attribute in the <registration> element is set to \"active\", i.e. registered: and\ni)\tthe state attribute within the <contact> sub-element is set to \"terminated\";\nii)\tthe value of the <uri> sub-element inside the <contact> sub-element is set to the contact address of the user's UE; and\niii)\tthe event attribute of that <contact> sub-element(s) is set to \"deactivated\", \"expired\", \"probation\", \"unregistered\", or \"rejected\";\nthe P-CSCF shall consider the binding between the indicated public user identity and the contact address and its related information as deregistered for this user, and shall release all stored information associated with the deregistered contact address and related information associated with this contact address; and\n5)\tfor each public user identity whose state attribute in the <registration> element is set to \"terminated\", i.e. deregistered; and for each <contact> sub-element, if\ni)\tthe value of the <uri> sub-element inside each <contact> sub-element is set to the respective contact address of the user's UE; and\nii)\tthe event attribute of each <contact> sub-element(s) is set to \"deactivated\", \"expired\", \"probation\", \"unregistered\", or \"rejected\";\nthe P-CSCF shall consider the indicated public user identity and all its contact addresses as deregistered for this UE, and shall release all stored information for these public user identity bound to the respective user and remove the public user identity from the list of the public user identities that are registered for the user;\n-\tshall store the \"orig-ioi\" header field parameter if present in the received P-Charging-Vector header field; and\n-\tfollow the procedures specified in RFC 6665 [28].\nWhen sending a response to the NOTIFY request, the P-CSCF shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the NOTIFY request, a type 1 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The P-CSCF shall set the type 1 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the value populated in the initial request for the dialog.\nIf the P-CSCF is informed that all contact addresses that are registered with this P-CSCF and belonging to the user using its private user identity have been deregistered, i.e. the state attribute within each <contact> sub-element is set to \"terminated\", the P-CSCF shall either unsubscribe to the reg event package or let the subscription expire.\nNOTE 1:\tSince there can be other active registrations of the user via other P-CSCFs, the S-CSCF will not terminate the by sending a NOTIFY request that includes the Subscription-State header set to \"terminated\".\nIf all public user identities, that were registered by the user using its private user identity, have been deregistered, the P-CSCF, will receive from the S-CSCF a NOTIFY request that may include the Subscription-State header field set to \"terminated\", as described in subclause 5.4.2.1.2. If the Subscription-State header field was not set to \"terminated\", the P-CSCF may either unsubscribe to the reg event package of the user or let the subscription expire.\nNOTE 2:\tUpon receipt of a NOTIFY request with the Subscription-State header field set to \"terminated\", the P-CSCF considers the subscription to the reg event package terminated (i.e. as if the P-CSCF had sent a SUBSCRIBE request with an Expires header field containing a value of zero).\nNOTE 3:\tThere can be public user identities which are implicitly registered within the registrar (S-CSCF) of the user upon registration of one public user identity. The procedures in this subclause provide a mechanism to inform the P-CSCF about these implicitly registered public user identities.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.5\tDeregistration",
                            "text_content": "When the P-CSCF receives a 200 (OK) response to a REGISTER request (sent according to subclause 5.2.2) sent by this UE, then the P-CSCF shall check each Contact header field included in the response. If there is a Contact header field that contains the contact address registered via this P-CSCF via the respective security associations or  sessions, and the value of the registration expiration interval value equals zero, then the P-CSCF shall:\n1)\tif the \"reg-id\" header field parameter is not included in the Contact header field, remove the binding between the public user identity found in the To header field (together with the implicitly registered public user identities) and the contact address indicated in the Contact header field, from the registered public user identities list belonging to this UE and all related stored information;\n1A)\tif the \"reg-id\" header field parameter is included in the Contact header field, remove the public user identity found in the To header field (together with the implicitly registered public user identities) and the flow identified by the \"reg-id\" header field parameter and all its related stored information belonging to this UE;\n2)\tif multiple registrations is not used, check if the UE has left any other registered public user identity. When all of the public user identities that were registered by this UE are deregistered, the P-CSCF shall delete any security associations,  sessions or IP associations towards the UE, after the server transaction (as defined in RFC 3261 [26]) pertaining to this deregistration terminates; and\n2A)\tif multiple registrations is used, check if the UE has left any other registered public user identity that is bound to this flow. When all of the public user identities that were registered and are bound to this flow are deregistered, the P-CSCF shall delete any security associations or  sessions associated with this flow, after the server transaction (as defined in RFC 3261 [26]) pertaining to this deregistration terminates.\nNOTE 1:\tUpon receipt of a NOTIFY request with all <registration> element(s) having their state attribute set to \"terminated\" (i.e. all public user identities are deregistered) and the Subscription-State header field set to \"terminated\", the P-CSCF considers the subscription to the reg event package terminated (i.e. as if the P-CSCF had sent a SUBSCRIBE request with an Expires header field containing a value of zero).\nNOTE 2:\tThere is no requirement to distinguish a REGISTER request relating to a registration from that relating to a deregistration. For administration reasons the P-CSCF may distinguish such requests, however this has no impact on the SIP procedures.\nNOTE 3:\tWhen the P-CSCF has sent the 200 (OK) response for the REGISTER request of the only public user identity currently registered with its associated set of implicitly registered public user identities using the respective security association or  session (i.e. no other public user identity belonging to the user is registered with this contact address the associated security association or  session), the P-CSCF removes the security association or  session established between the P-CSCF and the UE. Therefore further SIP signalling sent over this security association or  session (e.g. the NOTIFY request containing the deregistration event) will not reach the UE.\nUpon receipt of a NOTIFY request on the dialog which was generated during subscription to the reg event package of the UE, as described in subclause 5.2.3, including one or more <registration> element(s) which were registered by the UE with either:\n-\tthe state attribute within the <registration> element set to \"terminated\"; or\n-\tthe state attribute within the <registration> element set to \"active\" and the state attribute within the <contact> sub-element belonging to this UE and registered via this P-CSCF set to \"terminated\", and the event attribute within the <contact> sub-element belonging to this UE set either to \"unregistered\", or \"rejected\" or \"deactivated\";\nthe P-CSCF shall remove all stored information for these public user identities for this UE and remove these public user identities from the list of the public user identities that are registered for the user.\nNOTE 1:\tIf all public user identities have been removed from the list of the public user identities registered via this P-CSCF, and the NOTIFY request indicates that the UE is still registered (e.g. via another P-CSCF), the P-CSCF can unsubscribe from the reg event package of the UE.\nUpon receipt of a NOTIFY request with all <registration> element(s) having their state attribute set to \"terminated\" (i.e. all public user identities are deregistered) and the Subscription-State header field set to \"terminated\" or when all public user identities of the UE have been deregistered, the P-CSCF shall shorten any security associations or  sessions towards the UE.\nNOTE 2:\tThe security association between the P-CSCF and the UE is shortened to a value that will allow the NOTIFY request containing the deregistration event to reach the UE.\nNOTE 3:\tWhen the P-CSCF receives the NOTIFY request with Subscription-State header field containing the value of \"terminated\", the P-CSCF considers the subscription to the reg event package terminated (i.e. as if the P-CSCF had sent a SUBSCRIBE request to the S-CSCF with an Expires header field containing a value of zero).\nUpon receipt of a NOTIFY request for the dialog associated with the subscription to the reg event package of the user the P-CSCF shall store the \"orig-ioi\" header field parameter if present in the received P-Charging-Vector header field.\nWhen sending a response to the NOTIFY request, the P-CSCF shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the NOTIFY request, a type 1 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The P-CSCF shall set the type 1 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the value populated in the initial request for the dialog.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.6\tGeneral treatment for all dialogs and standalone transactions excluding the REGISTER method",
                            "text_content": "The procedures of subclause 5.2.6 and its subclauses are general to all requests and responses, except those for the REGISTER method.\nUpon receipt of an initial request or a target refresh request or a stand-alone transaction, the P-CSCF shall:\n-\tperform the procedures for the UE-terminating case as described in subclause 5.2.6.4 if the request makes use of the information for UE-terminating calls, which was added to the Path header field entry of the P-CSCF during registration (see subclause 5.2.2), e.g. the message is received at a certain port or the topmost Route header field contains a specific user part or parameter;\n-\tperform the procedures for the UE-originating case as described in subclause 5.2.6.3 if this information is not used by the request.\nWhen the P-CSCF receives an initial request for a dialog or a request for a standalone transaction from a UE that is not considered as privileged sender, and:\n-\tthe request does not include any P-Preferred-Identity header field or none of the P-Preferred-Identity header fields included in the request matches any of the registered public user identities or any of the registered wildcarded public user identities, then the P-CSCF shall identify the originator and the served user of the request by the default public user identity;\n-\tthe request includes one or two P-Preferred-Identity header field(s) each of which matches one of the registered public user identity or a registered wildcarded public user identity, the P-CSCF shall identify the originator and the served user of the request by the public user identity from the first such P-Preferred-Identity header field; and\n-\tthe request includes two P-Preferred-Identity header fields, each of which matches a registered public user identity or a registered wildcarded public user identity, the P-CSCF shall identify the alternative identity of the originator of the request by the public user identity from the second such P-Preferred-Identity header field.\nNOTE:\tWhen two identities are provided in the P-Preferred-Identity header fields, it is assumed that one is an alias of the other but P-CSCF does not have the information to verify this.\nWhen the P-CSCF receives an initial request for a dialog or a request for a standalone transaction from a UE that is considered as privileged sender, and the request:\na)\tdoes not include any P-Preferred-Identity header field, then the P-CSCF shall identify the served user of the request by the default public user identity;\nb)\tincludes a P-Preferred-Identity header field that does not match one of the registered public user identities or wildcarded public user identities, then the P-CSCF shall identify the served user of the request by the default public user identity; or\nc)\tincludes a P-Preferred-Identity header field that matches one of the registered public user identities or wildcarded public user identities, then the P-CSCF shall identify the served user of the request by the public user identity from the P-Preferred-Identity header field.\nIf a P-Preferred-Identity header field value is a SIP  with the user part starting with a \"+\", and a \"user\" SIP  parameter with a \"phone\" value, then the P-CSCF shall translate the SIP  to a tel  with the user part of the SIP  in the telephone-subscriber element in the tel  when checking whether the header field value matches any of the registered public user identities. The P-CSCF shall not modify the header field value within the P-Preferred-Identity header field.\nNOTE 1:\tThe case above can occur when the UE receives a public user identity as a tel  during registration, and then translates that into a SIP  when sending an initial request for a dialog or a request for a standalone transaction.\nIn addition, if the request from a UE that is considered as privileged sender:\n1)\tincludes one or two P-Asserted-Identity header field(s) then the P-CSCF shall identify the originator of that request by the public user identity from the first P-Asserted-Identity header field; or\n2)\tdoes not include a P-Asserted-Identity header field then the P-CSCF shall identify the originator of that request by the same identity that has been determined for the served user according to steps a), b), and c) above.\nNOTE 2:\tIf no security association was set-up during registration, the P-CSCF identifies the originator and served user of the request by using the IP association information stored during the registration for which it holds the list of registered public user identities.\nNOTE 3:\tThe contents of the From header field do not form any part of this decision process.\nNOTE 4: The display-name portion of the P-Preferred-Identity header field and the registered public user identities is not included in the comparison to determine a match.\nNOTE 5:\tThe P-CSCF determines if the UE is considered as privileged sender using the user-related policies provisioned to the P-CSCF (see subclause 5.2.1).\nWhen the P-CSCF receives from the UE an initial request for a dialog or a request for a standalone transaction, if the host portion of the sent-by field in the topmost Via header field contains a FQDN, or if it contains an IP address that differs from the source address of the IP packet, the P-CSCF shall add a \"received\" header field parameter in accordance with the procedure defined in RFC 3261 [26].\nIf the P-CSCF adds a \"received\" header field parameter and UDP is being used, the P-CSCF shall also add an \"rport\" header field parameter. If IMS AKA is used, the parameter value shall contain the UEs protected server port. Otherwise the parameter value shall contain the IP source of the request.\nWhen the P-CSCF receives from the UE an initial request for a dialog or a request for a standalone transaction, and the request matches a trigger for starting logging of SIP signalling, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K], the P-CSCF shall treat the dialog as one for which logging of signalling is in progress and start to log SIP signalling for this dialog according to its trace configuration.\nWhen the P-CSCF receives from the UE a request sent on a dialog for which logging of signalling is in progress, the P-CSCF shall check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred then the P-CSCF shall stop treating the dialog as one for which logging of signalling is in progress, else the P-CSCF shall append a \"logme\" header field parameter to the SIP Session-ID header field if the parameter is missing and determine, by checking its trace configuration, whether to log the request.\nIf:\n-\tthe P-CSCF supports indicating the traffic leg as specified in RFC 7459 [225];\n-\tthe UE is roaming;\n-\tthe P-CSCF is not in the home network; and\n-\trequired by local policy;\nthen the P-CSCF shall:\n-\tif the bottommost Route header field does not contain the \"tokenized-by\" header field parameter and an \"iotl\" SIP  parameter is not already included, append the \"iotl\" SIP  parameter with a value set to \"visitedA-homeA\" to the  of the bottommost Route header field; and\n-\tif the bottommost Route header field contains the \"tokenized-by\" header field parameter and an \"iotl\" SIP  parameter is not already included, append the \"iotl\" SIP  parameter with a value set to \"visitedA-homeA\" to the  of the second Route header field from the bottom.\nNOTE 6:\tThe bottommost Route header field contains the \"iotl\" SIP  parameter if the S-CSCF added the \"iotl\" SIP  parameter in the Service-Route header field during registration and if the home network does not apply topology hiding. The second Route header field from the bottom contains the \"iotl\" SIP  parameter if the S-CSCF added the \"iotl\" SIP  parameter in the Service-Route header field during registration and if the home network applies topology hiding.\nIf a P-CSCF supporting barring of premium numbers when roaming receives a request from a roaming UE and the Request- contains an E.164 number encoded as described in subclause 5.1.2A.1.2 which the P-CSCF is able to identify as a premium rate number in the country of the served network, the P-CSCF shall, based on local policy, add the \"premium-rate\" tel  parameter specified in subclause 7.2A.17 set to a value \"information\" or \"entertainment\" as appropriate.\nNOTE 7:\tThe feature barring of premium numbers when roaming can be implemented in the P-CSCF or an IBCF of the visited network. Local policy ensures that the feature is only activiated in one of the two.\nThe P-CSCF shall log all SIP responses destined for the UE that contain a \"logme\" Session-ID header field parameter based on local policy.\nWhen the P-CSCF is unable to forward the request to the next hop by the Route header fields, as determined by one of the following:\n-\tthere is no response to the service request and its retransmissions by the P-CSCF; or\n-\tby unspecified means available to the P-CSCF;\nand:\n-\tthe P-CSCF supports S-CSCF restoration procedures;\nthen the P-CSCF:\n1)\tshall reject the request by returning a 504 (Server Time-out) response to the UE;\n2)\tshall assume that the UE supports version 1 of the XML Schema for the 3GPP IM CN subsystem XML body if support for the 3GPP IM CN subsystem XML body as described in subclause 7.6 in the Accept header field is not indicated; and\n3)\tshall include in the 504 (Server Time-out) response:\n-\ta Content-Type header field with the value set to associated MIME type of the 3GPP IM CN subsystem XML body as described in subclause 7.6.1;\n-\ta P-Asserted-Identity header field set to the value of the SIP  of the P-CSCF included in the Path header field during the registration of the user whose UE sent the request causing this response (see subclause 5.2.2.1); and\n-\ta 3GPP IM CN subsystem XML body containing:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service:\ni)\ta <type> child element, set to \"restoration\" (see table 7.6.2) to indicate that S-CSCF restoration procedures are supported;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"initial-registration\" (see table 7.6.3).\nNOTE 1:\tThese procedures do not prevent the usage of unspecified reliability or recovery techniques above and beyond those specified in this subclause.\nIf the P-CSCF receives a SIP request different from REGISTER that does not map to an existing IP association and unless the P-CSCF detects that the request is related to an emergency communication that is to be handled according to subclause 5.2.10.2 and if the request is not received from a UE performing the functions of an external attached network using static mode of operation, the P-CSCF shall discard this SIP request, i.e. it shall not send back a 100 Trying SIP response to the UE and shall not try to forward the request to the S-CSCF.\nNOTE 2:\tReception of SIP requests not corresponding to a stored registration context may happen if the P-CSCF has lost the registration context. If the UE does not receive any SIP response to the sent SIP request (i.e. the SIP transaction timer B or F expires), the UE will perform a new initial registration procedure.\nNOTE 3:\tThe P-CSCF can identify that a request is received from a UE performing the functions of an external attached network using static mode of operation by evaluating the  session or by other means. Such operation requires preconfiguration of the capability for this attached network in the P-CSCF.\nWhen the P-CSCF receives from the UE an initial request for a dialog, and a service route value list exists for the served user of the request, the P-CSCF shall:\n1)\tremove its own SIP  from the top of the list of Route header fields;\n2)\tif the UE is performing the functions of an external attached network using static mode of operation:\ni)\tselect an I-CSCF and insert a Route header field with the  of the I-CSCF as the topmost Route header field; otherwise\nNOTE 1:\tThe list of the I-CSCFs can be either obtained as specified in RFC 3263 [27A] or be provisioned in the P-CSCF.\nii)\tverify that the resulting list of Route header fields matches the list of URIs received in the Service-Route header field (during the last successful registration or reregistration). This verification is done on a per  basis, not as a whole string. If the verification fails, then the P-CSCF shall either:\na)\treturn a 400 (Bad Request) response; the P-CSCF shall not forward the request, and shall not continue with the execution of steps 2 onwards; or\nb)\treplace the preloaded Route header field value in the request with the value of the Service-Route header field received during the last 200 (OK) response for the last successful registration or reregistration;\nNOTE 2:\tThe P-CSCF can identify that a request is received from a UE performing the functions of an external attached network using static mode of operation by evaluating the  session or by other means.\n3)\tif the 200 (OK) response to the last REGISTER request, which created or refreshed the binding of the contact address from which the request is received, has not contained a Feature-Caps header field, specified in RFC 6809 [190] with a \"+g.3gpp.atcf\" header field parameter, then:\na)\tif the P-CSCF is located in the visited network, and local policy requires the application of IBCF capabilities in the visited network towards the home network, select an IBCF in the visited network and add the  of the selected IBCF to the topmost Route header field;\nNOTE 3:\tIt is implementation dependent as to how the P-CSCF obtains the address of the IBCF exit point.\n3A)\tif the 200 (OK) response to the last REGISTER request, which created or refreshed the binding of the contact address from which the request is received, contained a Feature-Caps header field with a \"+g.3gpp.atcf\" header field parameter, then:\na)\tadd the ATCF  for originating requests that the P-CSCF used to forward the last REGISTER request which created or refreshed the binding of the contact address from which the request is received, to the topmost Route header field;\n4)\tadd its own address to the Via header field. The P-CSCF Via header field entry is built in a format that contains the port number of the P-CSCF in accordance with the procedures of RFC 3261 [26], and either:\na)\tthe P-CSCF FQDN that resolves to the IP address, or\nb)\tthe P-CSCF IP address;\n5)\twhen adding its own SIP  to the Record-Route header field, build the P-CSCF SIP  in a format that contains the port number of the P-CSCF where it awaits subsequent requests from the called party, and either:\na)\tthe P-CSCF FQDN that resolves to the IP address; or\nb)\tthe P-CSCF IP address.\nIf the Contact header field in the request contains an \"ob\" SIP  parameter, the P-CSCF shall add a flow token and the \"ob\" SIP  parameter to its SIP ;\nNOTE 4:\tThe inclusion of these values in the Record-Route header field will ensure that all subsequent mid dialog requests destined for the UE are sent over the same IMS flow over which the initial dialog-forming request was received.\n5A)\tif a P-Private-Network-Indication header field is included in the request, check whether the information saved during registration or from configuration allows the receipt of private network traffic from this source. If private network traffic is allowed, the P-CSCF shall check whether the received domain name in any included P-Private-Network-Indication header field in the request is the same as the domain name associated with that saved information. If private network traffic is not allowed, or the received domain name does not match, then the P-CSCF shall remove the P-Private-Network-Indication header field;\n5B)\tif the served user of the request is understood from information saved during registration or from configuration to always send and receive private network traffic from this source, insert a P-Private-Network-Indication header field containing the domain name associated with that saved information;\n5C)\tif the request is originated from a UE which the P-CSCF considers as privileged sender (including one which is also a UE performing the functions of an external attached network using static mode of operation), keep the P-Asserted-Identity header field unchanged if one was received, or include the originator of the request in the P-Asserted-Identity header field if no P-Asserted-Identity header field was received. In addition remove any P-Preferred-Identity header field, include the served user of the request in the P-Served-User header field as specified in RFC 5502 [133] and skip step 6) below;\nNOTE 5:\tThe P-CSCF determines if the UE is considered as privileged sender using the user-related policies provisioned to the P-CSCF (see subclause 5.2.1).\nNOTE 6:\tThe P-CSCF can retrieve the identity of the UE performing the functions of an external attached network from the subjectCommonName (CN) if it is not present in the subjectAltName in the certificates during the  session setup in accordance with the procedures of RFC 5280 [213] or by other means.\n5D)\tif the request is originated from a UE performing the functions of an external attached network using static mode of operation and which the P-CSCF considers as is not a privileged sender, include the served user of the request in the P-Served-User header field as specified in RFC 5502 [133] and skip step 6) below;\n6)\tremove any P-Preferred-Identity header field or P-Asserted-Identity header field, if present, and insert a P-Asserted-Identity header field with the value identifying the originator of the request and the value of the alternative identity of the originator of the request, if identified (see subclause 5.2.6.3.1), including the display name if previously stored during registration representing the served user of the request;\n6A)\tif the identity of the served user of the request was taken from P-Preferred-Identity header field by matching a registered wildcarded public user identity, and the identity of the served user is not a distinct identity within the range of the wildcarded public user identity, include the wildcarded public user identity value in the P-Profile-Key header field as defined in RFC 5002 [97];\nNOTE 7:\tThe matching of distinct public user identities takes precedence over the matching of wildcarded public user identities.\n7)\tadd a P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter. Based on local policy, the P-CSCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier;\n7A)\tif the request comes from a UE performing the functions of an external attached network using static mode of operation add the \"orig\" parameter to the dialog request to indicate that this is an originating request; and\n8)\tif the request is an INVITE request, save the Contact, CSeq and Record-Route header field values received in the request such that the P-CSCF is able to release the session if needed. If the Contact header field in the INVITE request contains a GRUU, the P-CSCF shall save the GRUU received in the Contact header field of the request and associate that GRUU with the UE contact address used during registration or with the registration flow and the associated UE contact address used over which the INVITE request was received such that the P-CSCF is able to release the session if needed\nbefore forwarding the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26].\nNOTE 8:\tAccording to RFC 5626 [92], an approach such as having the Edge Proxy adds a Record-Route header field with a flow token is one way to ensure that mid-dialog requests are routed over the correct flow.\nIf the request comes from a UE performing the functions of an external attached network using static mode of operation:\n-\tno response is received to the initial request for dialog and its retransmissions by the P-CSCF; or\n-\ta 3xx response or 480 (Temporarily Unavailable) response is received,\nthe P-CSCF shall repeat the actions of the above bullets with a different I-CSCF.\nIf the P-CSCF fails to forward the initial request for dialog to any I-CSCF, the P-CSCF shall send back a 504 (Server Time-Out) response to the UE performing the functions of an external attached network, in accordance with the procedures in RFC 3261 [26].\nWhen the P-CSCF receives any 1xx or 2xx response to the above request, the P-CSCF shall:\n1)\tstore the values received in the P-Charging-Function-Addresses header field;\n2)\tstore the list of Record-Route header fields from the received response;\n3)\tstore the dialog ID and associate it with the private user identity and public user identity involved in the session;\n4)\tif a security association or  session exists, in the response rewrite its own Record Route entry to its own SIP  that contains the protected server port number of the security association or  session established from the UE to the P-CSCF and either:\na)\tthe P-CSCF FQDN that resolves to the IP address of the security association or  session established from the UE to the P-CSCF; or\nb)\tthe P-CSCF IP address of the security association or  session established from the UE to the P-CSCF;\nNOTE 1:\tThe P-CSCF associates two ports, a protected client port and a protected server port, with each pair of security associations. For details on the selection of the protected port values see 3GPP TS 33.203 [19].\n5)\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled authentication is used, in the response rewrite its own Record-Route entry to its own SIP  that contains an unprotected server port number where the P-CSCF expects subsequent requests from the UE; and\n6)\tif the response corresponds to an INVITE request, save the Contact, From, To and Record-Route header field values received in the response such that the P-CSCF is able to release the session if needed;\nbefore forwarding the response to the UE in accordance with the procedures of RFC 3261 [26].\nNOTE 2:\tThe P-CSCF can find the IMS communication service supported for the dialog, as determined by the originating home network, in the topmost occurance of the \"+g.3gpp.icsi-ref\" header field parameter of the Feature-Caps header field(s) of 18x or 2xx response. The information can be used for charging purpose or resource reservation purpose.\nThe P-CSCF shall forward the response to the UE using the mechanisms described in RFC 3261 [26] and RFC 3581 [56A], i.e. the P-CSCF shall send the response to the IP address indicated in the \"received\" header field parameter and, in case UDP is used, to the port indicated in the \"rport\" header field parameter (if present) of the Via header field associated with the UE. In case  is used, the P-CSCF shall use the  connection on which the REGISTER request was received for sending the response back to the UE.\nWhen the P-CSCF receives from the UE a target refresh request for a dialog, the P-CSCF shall:\n1)\tverify if the request relates to a dialog in which the originator of the request is involved:\na)\tif the request does not relates to an existing dialog in which the originator is involved, then the P-CSCF shall answer the request by sending a 403 (Forbidden) response back to the originator. The P-CSCF will not forward the request. No other actions are required; or\nb)\tif the request relates to an existing dialog in which the originator is involved, then the P-CSCF shall continue with the following steps;\n1A)\tremove its own SIP  from the top of the list of Route header fields;\n2)\tverify that the resulting list of Route header fields matches the list of Record-Route header fields constructed by inverting the order of the stored list of Record-Route header fields and removing its Record-Route header field value from the list. This verification is done on a per  basis, not as a whole string. If the verification fails, then the P-CSCF shall either:\na)\treturn a 400 (Bad Request) response; the P-CSCF shall not forward the request, and shall not continue with the execution of steps 3 onwards; or\nb)\treplace the Route header field value in the request with the list of Record-Route header fields constructed by inverting the order of the stored list of Record-Route header fields and removing its Record-Route header value from the list;\n3)\tadd its own address to the Via header field. The P-CSCF Via header field entry is built in a format that contains the port number of the P-CSCF where it awaits the responses to come, and either:\na)\tthe P-CSCF FQDN that resolves to the IP address, or\nb)\tthe P-CSCF IP address;\n4)\tvoid\n5)\tfor INVITE dialogs (i.e. dialogs initiated by an INVITE request), replace the saved Contact and CSeq header field values received in the request such that the P-CSCF is able to release the session if needed. If the Contact header field in the INVITE request contains a GRUU, the P-CSCF shall save the GRUU received in the Contact header field of the request and associate that GRUU with the UE contact address used during session establishment or with the registration flow and the associated UE contact address used during session establishment such that the P-CSCF is able to release the session if needed;\nNOTE:\tThe replaced Contact header field value is valid only if a 1xx or 2xx response will be received for the request. In other cases the old value is still valid.\n6)\tif the P-CSCF inserted the header field parameters into the Feature-Caps header field of the initial request for the dialog then when the target refresh request is forwarded in the same direction, the P-CSCF shall insert the header field parameters with the same parameter values in the Feature-Caps header field; and\n7)\tadd a P-Charging-Vector header field with the \"icid-value\" header field parameter set to the value populated in the initial request for the dialog and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter;\nbefore forwarding the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26].\nWhen the P-CSCF receives a 1xx or 2xx response to the above request, the P-CSCF shall:\n1)\tif a security association or  session exists, rewrite the address and port number of its own Record Route entry to the same value as for the response to the initial request for the dialog; and\n2)\treplace the saved Contact header field value received in the response such that the P-CSCF is able to release the session if needed;\nbefore forwarding the response to the UE in accordance with the procedures of RFC 3261 [26].\nWhen the P-CSCF receives from the UE the request for a standalone transaction, and a service route value list exists for the served user of the request, the P-CSCF shall:\n1)\tremove its own SIP  from the top of the list of Route header fields;\n2)\tif the UE is performing the functions of an external attached network using static mode of operation:\ni)\tselect an I-CSCF and insert a Route header field with the  of the I-CSCF as the topmost Route header field; otherwise\nNOTE 1:\tThe list of the I-CSCFs can be either obtained as specified in RFC 3263 [27A] or be provisioned in the P-CSCF.\nii)\tverify that the resulting list of Route header fields matches the list of URIs received in the Service-Route header field (during the last successful registration or reregistration). This verification is done on a per  basis, not as a whole string. If the verification fails, then the P-CSCF shall either:\na)\treturn a 400 (Bad Request) response; the P-CSCF shall not forward the request, and shall not continue with the execution of steps 3 onwards; or\nb)\treplace the preloaded Route header field value in the request with the one received during the last registration in the Service-Route header field of the 200 (OK) response;\nNOTE 2:\tThe P-CSCF can identify that a request is received from a UE performing the functions of an external attached network using static mode of operation by evaluating the  session or by other means.\n3)\tif the 200 (OK) response to the last REGISTER request, which created or refreshed the binding of the contact address from which the request is received, has not contained a Feature-Caps header field, specified in RFC 6809 [190] with a \"+g.3gpp.atcf\" header field parameter, then:\na)\tif the P-CSCF is located in the visited network, and local policy requires the application of IBCF capabilities in the visited network towards the home network, select an IBCF in the visited network and add the  of the selected IBCF to the topmost Route header field;\nNOTE 3:\tIt is implementation dependent as to how the P-CSCF obtains the address of the IBCF exit point.\n3A)\tif the 200 (OK) response to the last REGISTER request, which created or refreshed the binding of the contact address from which the request is received, contained a Feature-Caps header field with a \"+g.3gpp.atcf\" header field parameter, then:\na)\tadd the ATCF  for originating requests, that the P-CSCF used to forward the last REGISTER request which created or refreshed the binding of the contact address from which the request is received, to the topmost Route header field;\n3B)\tif the request is originated from a UE which the P-CSCF considers as privileged sender (including one which is also a UE performing the functions of an external attached network using static mode of operation), keep the P-Asserted-Identity header field unchanged if one was received, or include the originator of the request in the P-Asserted-Identity header field if no P-Asserted-Identity header field was received. In addition remove any P-Preferred-Identity header field, include the served user of the request in the P-Served-User header field as specified in RFC 5502 [133] and skip step 4) below;\nNOTE 4:\tThe P-CSCF determines if the UE is considered as privileged sender using the user-related policies provisioned to the P-CSCF (see subclause 5.2.1).\nNOTE 5:\tThe P-CSCF can retrieve the identity of the UE performing the functions of an external attached network from the subjectCommonName (CN) if it is not present in the subjectAltName in the certificates during the  session setup in accordance with the procedures of RFC 5280 [213] or by other means.\n3D)\tif the request is originated from a UE performing the functions of an external attached network using static mode of operation and which the P-CSCF considers as is not a privileged sender, include the served user of the request in the P-Served-User header field as specified in RFC 5502 [133] and skip step 4) below;\n4)\tremove any P-Preferred-Identity header field or P-Asserted-Identity header field, if present, and insert P-Asserted-Identity header fields the value identifying the served user of the request and the value of the alternative identity of the originator of the request, if identified (see subclause 5.2.6.3.1), including the display name if previously stored during registration, representing the served user of the request;\n4A)\tif the identity of the served user of the request was taken from P-Preferred-Identity header field by matching a registered wildcarded public user identity, and the identity of the served user is not a distinct identity within the range of the wildcarded public user identity, include the wildcarded public user identity value in the P-Profile-Key header field as defined in RFC 5002 [97];\nNOTE 6:\tThe matching of distinct public user identities takes precedence over the matching of wildcarded public user identities.\n4B)\tif a P-Private-Network-Indication header field is included in the request, check whether the information saved during registration or from configuration allows the receipt of private network traffic from this source. If private network traffic is allowed, the P-CSCF shall check whether the received domain name in any included P-Private-Network-Indication header field in the request is the same as the domain name associated with that saved information. If private network traffic is not allowed, or the received domain name does not match, then the P-CSCF shall remove the P-Private-Network-Indication header field;\n4C)\tif the served user of the request is understood from information saved during registration or from configuration to always send and receive private network traffic from this source, insert a P-Private-Network-Indication header field containing the domain name associated with that saved information; and\n4D)\tif the request comes from a UE performing the functions of an external attached network using static mode of operation add the \"orig\" parameter to the dialog request to indicate that this is an originating request; and\n5)\tadd a P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter. Based on local policy, the P-CSCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier;\nbefore forwarding the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26].\nIf the request comes from a UE performing the functions of an external attached network using static mode of operation:\n-\tno response is received to the standalone SIP request and its retransmissions by the P-CSCF; or\n-\ta 3xx response or 480 (Temporarily Unavailable) response is received,\nthe P-CSCF shall repeat the actions of the above bullets with a different I-CSCF.\nIf the P-CSCF fails to forward the standalone SIP request to any I-CSCF, the P-CSCF shall send back a 504 (Server Time-Out) response to the UE performing the functions of an external attached network, in accordance with the procedures in RFC 3261 [26].\nWhen the P-CSCF receives any response to the above request, the P-CSCF shall:\n1)\tstore the values received in the P-Charging-Function-Addresses header field;\nbefore forwarding the response to the UE in accordance with the procedures of RFC 3261 [26].\nNOTE:\tThe P-CSCF can find the IMS communication service supported for the standalone transaction, as determined by the originating home network, in the topmost occurance of the \"+g.3gpp.icsi-ref\" header field parameter of the Feature-Caps header field(s) of 18x or 2xx response. The information can be used for charging purpose.\nThe P-CSCF shall forward the response to the UE using the mechanisms described in RFC 3261 [26] and RFC 3581 [56A], i.e. the P-CSCF shall send the response to the IP address indicated in the \"received\" header field parameter and, in case UDP is used, to the port indicated in the \"rport\" header field parameter (if present) of the Via header field associated with the UE. In case  is used, the P-CSCF shall use the  connection on which the REGISTER request was received for sending the response back to the UE.\nWhen the P-CSCF receives from the UE a subsequent request other than a target refresh request (including requests relating to an existing dialog where the method is unknown), the P-CSCF shall:\n1)\tverify if the request relates to a dialog in which the originator of the request is involved:\na)\tif the request does not relates to an existing dialog in which the originator is involved, then the P-CSCF shall answer the request by sending a 403 (Forbidden) response back to the originator. The P-CSCF will not forward the request. No other actions are required; or\nb)\tif the request relates to an existing dialog in which the originator is involved, then the P-CSCF shall continue with the following steps;\n1A)\tremove its own SIP  from the top of the list of Route header fields;\n2)\tverify that the resulting list of Route header fields matches the list of Record-Route header fields constructed by inverting the order of the stored list of Record-Route header fields and removing its Record-Route header field from the list. This verification is done on a per  basis, not as a whole string. If the verification fails, then the P-CSCF shall either:\na)\treturn a 400 (Bad Request) response; the P-CSCF shall not forward the request, and shall not continue with the execution of steps 3 onwards; or\nb)\treplace the Route header field value in the request with the list of Record-Route header fields constructed by inverting the order of the stored list of Record-Route header fields and removing its Record-Route header field from the list;\n3)\tadd a P-Charging-Vector header field with the \"icid-value\" header field parameter set to the value populated in the initial request for the dialog and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter; and\n4)\tfor INVITE dialogs, replace the saved CSeq header field value received in the request such that the P-CSCF is able to release the session if needed;\nbefore forwarding the request (based on the topmost Route header field), in accordance with the procedures of RFC 3261 [26].\nVoid\nWhen the P-CSCF receives from the UE the request for an unknown method (that does not relate to an existing dialog), and a service route value list exists for the served user of the request, the P-CSCF shall:\n1)\tif the UE performing the functions of an external attached network using static mode of operation:\ni)\tselect an I-CSCF and insert a Route header field with the  of the I-CSCF as the topmost Route header field; otherwise\nNOTE 1:\tThe list of the I-CSCFs can be either obtained as specified in RFC 3263 [27A] or be provisioned in the P-CSCF.\nii)\tverify that the list of URIs received in the Service-Route header field (during the last successful registration or reregistration) is included, preserving the same order, as a subset of the preloaded Route header fields in the received request. This verification is done on a per  basis, not as a whole string. If the verification fails, then the P-CSCF shall either:\na)\treturn a 400 (Bad Request) response; the P-CSCF shall not forward the request, and shall not continue with the execution of steps 2 onwards; or\nb)\treplace the Route header field value in the request with the one received during the last registration in the Service-Route header field of the 200 (OK) response;\nNOTE 2:\tThe P-CSCF can identify that a request is received from a UE performing the functions of an external attached network using static mode of operation by evaluating the  session or by other means.\n2)\tif the 200 (OK) response to the last REGISTER request, which created or refreshed the binding of the contact address from which the request is received, has not contained a Feature-Caps header field, specified in RFC 6809 [190] with a \"+g.3gpp.atcf\" header field parameter, then:\na)\tif the P-CSCF is located in the visited network, and local policy requires the application of IBCF capabilities in the visited network towards the home network, then the P-CSCF shall select an IBCF in the visited network and add the  of the selected IBCF to the topmost Route header field;\nNOTE 3:\tIt is implementation dependent as to how the P-CSCF obtains the address of the IBCF exit point.\n2A)\tif the 200 (OK) response to the last REGISTER request, which created or refreshed the binding of the contact address from which the request is received, contained a Feature-Caps header field with a \"+g.3gpp.atcf\" header field parameter, then:\na)\tadd the ATCF  for originating requests, that the P-CSCF used to forward the last REGISTER request which created or refreshed the binding of the contact address from which the request is received, to the topmost Route header field;\n2B)\tif the request is originated from a UE which the P-CSCF considers as privileged sender (including one which is also a UE performing the functions of an external attached network using static mode of operation), keep the P-Asserted-Identity header field unchanged if one was received, or include the originator of the request in the P-Asserted-Identity header field if no P-Asserted-Identity header field was received. In addition remove any P-Preferred-Identity header field, include the served user of the request in the P-Served-User header field as specified in RFC 5502 [133] and skip step 3) below;\nNOTE 4:\tThe P-CSCF determines if the UE is considered privileged sender using based on the user-related policies provisioned to the P-CSCF (see subclause 5.2.1).\nNOTE 5:\tThe P-CSCF can retrieve the identity of the UE performing the functions of an external attached network from the subjectCommonName (CN) if it is not present in the subjectAltName in the certificates during the  session setup in accordance with the procedures of RFC 5280 [213] or by other means.\n2C)\tif the request is originated from a UE performing the functions of an external attached network using static mode of operation and which the P-CSCF considers as is not a privileged sender, include the served user of the request in the P-Served-User header field as specified in RFC 5502 [133] and skip step 3) below;\n3)\tremove any P-Preferred-Identity header field or P-Asserted-Identity header field, if present, and insert a P-Asserted-Identity header fields the value identifying the originator of the request and the value of the alternative identity of the originator of the request, if identified (see subclause 5.2.6.3.1), including the display name if previously stored during registration, representing the served user of the request;\n3A)\tif the identity of the served user of the request was taken from P-Preferred-Identity header field by matching a registered wildcarded public user identity, and the identity of the served user is not a distinct identity within the range of the wildcarded public user identity, include the wildcarded public user identity value in the P-Profile-Key header field as defined in RFC 5002 [97]; and\n3B)\tif the request comes from a UE performing the functions of an external attached network using static mode of operation add the \"orig\" parameter to the dialog request to indicate that this is an originating request; and\n4)\tadd a P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter. Based on local policy, the P-CSCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier;\nNOTE 6:\tThe matching of distinct public user identities takes precedence over the matching of wildcarded public user identities.\nbefore forwarding the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26].\nIf the request comes from a UE performing the functions of an external attached network using static mode of operation:\n-\tno response is received to the standalone SIP request and its retransmissions by the P-CSCF; or\n-\ta 3xx response or 480 (Temporarily Unavailable) response is received,\nthe P-CSCF shall repeat the actions of the above bullets with a different I-CSCF.\nIf the P-CSCF fails to forward the unknown SIP request to any I-CSCF, the P-CSCF shall send back a 504 (Server Time-Out) response to the UE performing the functions of an external attached network using static mode of operation, in accordance with the procedures in RFC 3261 [26].\nNOTE:\tThe P-CSCF can find the IMS communication service supported for the transaction, as determined by the originating home network, in the topmost occurance of the \"+g.3gpp.icsi-ref\" header field parameter of the Feature-Caps header field(s) of 18x or 2xx response. The information can be used for charging purpose.\nThe P-CSCF shall log all SIP requests destined for the UE that contain a \"logme\" Session-ID header field parameter based on local policy.\nIf the serving network supports PCRF based P-CSCF restoration and the Restoration-Info header field is included in the incoming request, and the P-CSCF has no binding for the identity in the Request-, the P-CSCF shall:\n-\tinitiate the PCRF based P-CSCF restoration procedure as specified in 3GPP TS 23.380 [7D] using the  value contained in the Restoration-Info header field; and\n-\treject the request with a 404 (Not Found) response.\nIf the P-CSCF supports PCRF based P-CSCF restoration procedures, the P-CSCF shall remove the Restoration-Info header field, if included in the incoming request.\nIf the serving network supports HSS based P-CSCF restoration procedures and the P-CSCF has no binding for the identity in the Request-, the P-CSCF shall reject the request with a 404 (Not Found) response.\nIf the user-related policies provisioned to the P-CSCF (see subclause 5.2.1) do not indicate that the served UE is authorized to send early media, the P-CSCF shall not allow media flows in forward and backward direction before the 200 (OK) response to the initial INVITE is received. Based on operator policy the P-CSCF shall either remove the P-Early-Media header field or replace the value of the P-Early-Media header field with \"inactive\", if received from the terminating UE.\nIf the user-related policies provisioned to the P-CSCF (see subclause 5.2.1) indicate that the served UE is authorized to send early media, the P-CSCF shall not remove or modify the P-Early-Media header field if received in an UPDATE request.\nWhen the P-CSCF receives, destined for the UE, a response sent on a dialog for which logging of signalling is in progress, the P-CSCF shall check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred then the P-CSCF shall stop treating the dialog as one for which logging of signalling is in progress, else the P-CSCF shall append a \"logme\" header field parameter to the SIP Session-ID header field if the parameter is missing and determine, by checking its trace configuration, whether to log the request.\nIf the user-related policies provisioned to the P-CSCF (see subclause 5.2.1) do not indicate that the served UE is authorized to send early media, the P-CSCF shall not allow media flows in forward and backward direction before the 200 (OK) response to the initial INVITE is received. Based on operator policy the P-CSCF shall either remove the P-Early-Media header field or replace the value of the P-Early-Media header field with \"inactive\", if received from the terminating UE.\nIf the user-related policies provisioned to the P-CSCF (see subclause 5.2.1) indicate that the served UE is authorized to send early media, the P-CSCF shall not remove or modify the P-Early-Media header field if received in a 18x provisional response.\nWhen the P-CSCF receives, destined for the UE, an initial request for a dialog, prior to forwarding the request, the P-CSCF shall:\n1)\tif an indication has been received from the PCRF that the signalling bearer to the UE is lost, and has not recovered, reject the request by sending 500 (Server Internal Error) response;\nNOTE 1:\tThe signalling bearer can be considered as recovered by the P-CSCF when the registration timer expires in P-CSCF and the user is de-registered from the IM CN subsystem, a new REGISTER request from the UE is received providing an indication to the P-CSCF that the signalling bearer to that user has become available or a P-CSCF implementation dependent function which discovers that the signalling bearer is available to the UE.\nNOTE 2:\tThe Retry-After header field value is set based on operator policy.\n2)\tconvert the list of Record-Route header field values into a list of Route header field values and save this list of Route header fields;\n3)\tif the request is an INVITE request, save a copy of the Contact, CSeq and Record-Route header field values received in the request such that the P-CSCF is able to release the session if needed;\n4)\tif a security association or  session exists, when adding its own SIP  to the top of the list of Record-Route header fields and save the list, build the P-CSCF SIP  in a format that contains the protected server port number of the security association or  session established from the UE to the P-CSCF and either:\na)\tthe P-CSCF FQDN that resolves to the IP address of the security association or  session established from the UE to the P-CSCF; or\nb)\tthe P-CSCF IP address of the security association or  session established from the UE to the P-CSCF;\n5)\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled authentication is used, when adding its own SIP  to the top of the list of Record-Route header fields and saving the list, build the P-CSCF  in a format that contains an unprotected server port number where the P-CSCF expects subsequent requests from the UE;\n6)\tif a security association or  session exists, when adding its own address to the top of the received list of Via header fields and save the list, build the P-CSCF Via header field entry in a format that contains the protected server port number of the security association or  session established from the UE to the P-CSCF and either:\na)\tthe P-CSCF FQDN that resolves to the IP address of the security association or  session established from the UE to the P-CSCF; or\nb)\tthe P-CSCF IP address of the security association or  session established from the UE to the P-CSCF;\nNOTE 3:\tThe P-CSCF associates two ports, a protected client port and a protected server port, with each pair of security associations or  session. For details of the usage of the two ports see 3GPP TS 33.203 [19].\n7)\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled athentication is used, when adding its own address to the top of the received list of Via header fields and saving the list, build the P-CSCF Via header field entry in a format that contains an unprotected server port number where the P-CSCF expects responses to the current request from the UE;\n7A)\tif the recipient of the request is understood from information saved during registration or from configuration to always send and receive private network traffic from this source, remove the P-Private-Network-Indication header field containing the domain name associated with that saved information;\n8)\tstore the values received in the P-Charging-Function-Addresses header field;\n9)\tstore the \"icid-value\" header field parameter and if present, the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field;\n10)\tif the request contains an \"fe-identifier\" header field parameter, based on local policy, store the content of the \"fe-identifier\" header field parameter of the P-Charging-Vector header field; and\n11)\tsave a copy of the P-Called-Party-ID header field;\nbefore forwarding the request to the UE either in accordance with the procedures of RFC 3261 [26] or as specified in RFC 5626 [92].\nIf no security association exists between the P-CSCF and the UE performing the functions of an external attached network operating in static mode, the P-CSCF shall initiate a  session towards the UE performing the functions of an external attached network operating in static mode before sending the initial request in accordance with 3GPP TS 33.310 [19D].\nNOTE 4:\tThe P-CSCF can identify that a call is directed to a UE performing the functions of an external attached network operating in static mode by evaluating the Route header field, the Request  or other means.\nOnce the  session is set up (using the certificates) the P-CSCF shall send the initial request for dialog over the secure connection to the UE performing the functions of an external attached network operating in static mode.\nWhen the P-CSCF receives any 1xx or 2xx response to the above request, the P-CSCF shall:\n0A)\tif the response is originated from a UE which the P-CSCF considers as privileged sender, remove any P-Preferred-Identity header field, and skip step 1) below;\nNOTE:\tThe P-CSCF determines if the UE is considered privileged sender using based on the user-related policies provisioned to the P-CSCF (see subclause 5.2.1).\n1)\tremove any P-Preferred-Identity header field or P-Asserted-Identity header field, if present, and insert a P-Asserted-Identity header field with the saved public user identity from the P-Called-Party-ID header field that was received in the request, plus the display name if previously stored during registration, representing the originator of the response;\n2)\tverify that the list of Via header fields matches the saved list of Via header fields received in the request corresponding to the same dialog, including the P-CSCF Via header field value. This verification is done on a per Via header field value basis, not as a whole string. If the verification fails, then the P-CSCF shall either:\na)\tdiscard the response; or\nb)\treplace the Via header field values with those received in the request;\n3)\tverify that the list of URIs received in the Record-Route header field of the request corresponding to the same dialog is included, preserving the same order, as a subset of the Record-Route header field list of this response. This verification is done on a per  basis, not as a whole string.\nIf the verification fails, then the P-CSCF shall either:\na)\tdiscard the response; or\nb)\treplace the Record-Route header field values with those received in the request, and if a security association or  session exists, add its own Record-Route entry with its own SIP  with the port number where it awaits subsequent requests from the calling party. The P-CSCF shall include in the Record-Route header field either:\n-\tthe P-CSCF FQDN that resolves to its IP address; or\n-\tthe P-CSCF IP address.\nThe P-CSCF shall remove the \"comp\" SIP  parameter from the Record-Route header field.\nIf the verification is successful, the P-CSCF shall rewrite its own Record-Route entry to its SIP  in a format that contains the port number where it awaits subsequent requests from the calling party. The P-CSCF shall include in the Record-Route header field either:\na)\tthe P-CSCF FQDN that resolves to its IP address; or\nb)\tthe P-CSCF IP address.\nThe P-CSCF shall remove the \"comp\" SIP  parameter from the Record-Route header field;\nWhen adding its SIP  to the Record-Route header field, the P-CSCF shall also copy the flow token and the \"ob\" SIP  parameter from the Route header field of the initial dialog-forming request destined for the UE to its SIP , if the Route header field contained these values;\n4)\tstore the dialog ID and associate it with the private user identity and public user identity involved in the session;\n5)\tif the response corresponds to an INVITE request, save the Contact, To, From and Record-Route header field value received in the response such that the P-CSCF is able to release the session if needed. If the Contact header field in the response to the INVITE request contains a GRUU, the P-CSCF shall save the GRUU received in the Contact header field of the response and associate that GRUU with the contact address which was used to send the INVITE request or with the registration flow and the associated UE contact address which was used to send on which the INVITE request such that the P-CSCF is able to release the session if needed; and\n6)\tinclude in the P-Charging-Vector header field:\n-\tan \"icid-value\" header field parameter set to the value received in the request;\n-\tthe \"orig-ioi\" header field parameter, if received in the request; and\n-\ta type 1 \"term-ioi\" header field parameter that identifies the sending network;\n-\tif the P-CSCF has stored an \"fe-identifier\" header field parameter of the P-Charging-Vector header field, based on local policy, the stored \"fe-identifier\" header field parameter and include its own address or identifier in the \"fe-addr\" element of the \"fe-identifier\" header field parameter of the P-Charging-Vector header field.\nbefore forwarding the response in accordance with the procedures of RFC 3261 [26].\nWhen the P-CSCF receives any other response to the above request, the P-CSCF shall:\n1)\tverify that the list of Via header fields matches the saved list of Via header fields received in the request corresponding to the same dialog, including the P-CSCF Via header field value. This verification is done on a per Via header field value basis, not as a whole string. If these lists do not match, then the P-CSCF shall either:\na)\tdiscard the response; or\nb)\treplace the Via header field values with those received in the request; and\n2)\tinclude in the P-Charging-Vector header field:\na)\tan \"icid-value\" header field parameter set to the value received in the request;\nb)\tthe \"orig-ioi\" header field parameter, if received in the request; and\nc)\ta type 1 \"term-ioi\" header field parameter that identifies the sending network;\nbefore forwarding the response in accordance with the procedures of RFC 3261 [26].\nWhen the P-CSCF receives, destined for the UE, a target refresh request for a dialog, prior to forwarding the request, the P-CSCF shall:\n1)\tif a security association or  session exists, add its own address to the top of the received list of Via header fields and save the list. The P-CSCF Via header field entry is built in a format that contains the protected server port number of the security association or  session established from the UE to the P-CSCF and either:\na)\tthe P-CSCF FQDN that resolves to the IP address of the security association or  session established from the UE to the P-CSCF; or\nb)\tthe P-CSCF IP address of the security association or  session established from the UE to the P-CSCF;\nNOTE 1:\tThe P-CSCF associates two ports, a protected client port and a protected server port, with each pair of security associations or  session. For details of the usage of the two ports see 3GPP TS 33.203 [19].\n2)\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled authentication is used, when adding its own address to the top of the received list of Via header fields and saving the list, build the P-CSCF Via header field entry in a format that contains an unprotected server port number where the P-CSCF expects responses to the current request from the UE;\n3)\tif a security association or  session exists, when adding its own SIP  to the top of the list of Record-Route header fields and save the list, build the P-CSCF SIP  in a format that contains the protected server port number of the security association or  session established from the UE to the P-CSCF and either:\na)\tthe P-CSCF FQDN that resolves to the IP address of the security association or  session established from the UE to the P-CSCF; or\nb)\tthe P-CSCF IP address of the security association or  session established from the UE to the P-CSCF;\n4)\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled authentication is used, when adding its own SIP  to the top of the list of Record-Route header fields and saving the list, build the P-CSCF  in a format that contains an unprotected server port number where the P-CSCF expects subsequent requests from the UE;\n5)\tfor INVITE dialogs, replace the saved Contact and CSeq header field values received in the request such that the P-CSCF is able to release the session if needed;\n6)\tif the request is destined to a UE performing the functions of an external attached network operating in static mode, send the request using the already established  session as described in subclause 5.2.6.4.3; and\nNOTE 2:\tThe replaced Contact header field value is valid only if a 1xx or 2xx response will be received for the request. In other cases the old value is still valid.\n7)\tstore the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present;\nbefore forwarding the request to the UE in accordance with the procedures of either RFC 3261 [26] or RFC 5626 [92].\nWhen the P-CSCF receives a 1xx or 2xx response to the above request, the P-CSCF shall:\n1)\tverify that the list of Via header fields matches the saved list of Via header fields received in the request corresponding to the same dialog, including the P-CSCF Via header field value. This verification is done on a per Via header field value basis, not as a whole string. If the verification fails, then the P-CSCF shall either:\na)\tdiscard the response; or\nb)\treplace the Via header field values with those received in the request;\n2)\tif a security association or  session exists, rewrite its own Record-Route entry to the same value as for the response to the initial request for the dialog and remove the \"comp\" SIP  parameter;\n3)\treplace the saved Contact header field value received in the response such that the P-CSCF is able to release the session if needed. If the Contact header field in the response to the target refresh request for a dialog contains a GRUU, the P-CSCF shall save the GRUU received in the Contact header field of the response and associate that GRUU with the contact address which was used to send the target refresh request or with the registration flow and the associated UE contact address which was used to send the target refresh request such that the P-CSCF is able to release the session if needed;\n4)\tif the P-CSCF inserted the header field parameters into the Feature-Caps header field of the initial request for the dialog then when the response is forwarded in the same direction, the P-CSCF shall insert the header field parameters with the same parameter values in the Feature-Caps header field; and\n5)\tinclude in the P-Charging-Vector header field:\n-\tan \"icid-value\" header field parameter set to the value populated in the initial request for the dialog;\n-\tthe \"orig-ioi\" header field parameter, if received in the request; and\n-\ta type 1 \"term-ioi\" header field parameter that identifies the sending network;\nbefore forwarding the response in accordance with the procedures of RFC 3261 [26].\nWhen the P-CSCF receives any other response to the above request, the P-CSCF shall:\n1)\tverify that the list of Via header fields matches the saved list of Via header fields received in the request corresponding to the same dialog, including the P-CSCF Via header field value. This verification is done on a per Via header field value basis, not as a whole string. If the verification fails, then the P-CSCF shall either:\na)\tdiscard the response; or\nb)\treplace the Via header field values with those received in the request; and\n2)\tif a security association or  session exists, rewrite the IP address and the port number of its own Record-Route entry to the IP address and the port number where it awaits subsequent requests from the calling party and remove the \"comp\" SIP  parameter;\n3)\tinclude in the P-Charging-Vector header field:\na)\tan \"icid-value\" header field parameter set to the value populated in the initial request for the dialog;\nb)\tthe \"orig-ioi\" header field parameter, if received in the request; and\nc)\ta type 1 \"term-ioi\" header field parameter that identifies the sending network;\nbefore forwarding the response in accordance with the procedures of RFC 3261 [26].\nWhen the P-CSCF receives, destined for the UE, a request for a standalone transaction, or a request for an unknown method (that does not relate to an existing dialog), prior to forwarding the request, the P-CSCF shall:\n1)\tif an indication has been received from the PCRF that the signalling bearer to the UE is lost, and has not recovered, reject the request by sending 500 (Server Internal Error) response;\nNOTE 1:\tThe signalling bearer can be considered as recovered by the P-CSCF when the registration timer expires in P-CSCF and the user is de-registered from the IM CN subsystem, a new REGISTER request from the UE is received providing an indication to the P-CSCF that the signalling bearer to that user has become available or a P-CSCF implementation dependent function which discovers that the signalling bearer is available to the UE.\nNOTE 2:\tThe Retry-After header field value is set based on operator policy.\n2)\tif a security association or  session exists, add its own address to the top of the received list of Via header fields and save the list. The P-CSCF Via header field entry is built in a format that contains the protected server port number of the security association or  session established from the UE to the P-CSCF and either:\na)\tthe P-CSCF FQDN that resolves to the IP address of the security association or  session established from the UE to the P-CSCF; or\nb)\tthe P-CSCF IP address of the security association or  session established from the UE to the P-CSCF;\nNOTE 3:\tThe P-CSCF associates two ports, a protected client port and a protected server port, with each pair of security associations or  session. For details of the usage of the two ports see 3GPP TS 33.203 [19].\n3)\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled authentication is used, when adding its own address to the top of the received list of Via header fields and saving the list, build the P-CSCF Via header field entry in a format that contains an unprotected server port number where the P-CSCF expects responses to the current request from the UE;\n3A)\tif the recipient of the request is understood from information saved during registration or from configuration to always send and receive private network traffic from this source, remove the P-Private-Network-Indication header field containing the domain name associated with that saved information;\n4)\tstore the values received in the P-Charging-Function-Addresses header field;\n5)\tstore the \"icid-value\" header field parameter and if present, the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field;\n6)\tif the request contains an \"fe-identifier\" header field parameter, based on local policy, store the content of the \"fe-identifier\" header field parameter of the P-Charging-Vector header field; and\n7)\tsave a copy of the P-Called-Party-ID header field;\nbefore forwarding the request to the UE either in accordance with the procedures of RFC 3261 [26] or as specified in RFC 5626 [92].\nIf no security association exists between the P-CSCF and the UE performing the functions of an external attached network operating in static mode, the P-CSCF shall initiate a  session towards the UE performing the functions of an external attached network operating in static mode before sending the standalone SIP request in accordance with 3GPP TS 33.310 [19D].\nNOTE 4:\tThe P-CSCF can identify that a call is directed to a UE performing the functions of an external attached network operating in static mode by evaluating the Route header field, the Request  or other means.\nOnce the  session is set up (using the certificates) the P-CSCF shall send the standalone SIP request over the secure connection to the UE performing the functions of an external attached network operating in static mode.\nWhen the P-CSCF receives any response to the above request, the P-CSCF shall:\n1)\tverify that the list of Via header fields matches the saved list of Via header fields received in the request corresponding to the same dialog, including the P-CSCF Via header field value. This verification is done on a per Via header field value basis, not as a whole string. If these lists do not match, then the P-CSCF shall either:\na)\tdiscard the response; or\nb)\treplace the Via header field values with those received in the request;\n1A)\tif the response is originated from a UE which the P-CSCF considers as privileged sender, remove any P-Preferred-Identity header field, and skip step 2) below;\nNOTE:\tThe P-CSCF determines if the UE is considered privileged sender using based on the user-related policies provisioned to the P-CSCF (see subclause 5.2.1).\n2)\tremove any P-Preferred-Identity header field or P-Asserted-Identity header field, if present, and insert an P-Asserted-Identity header field with the saved public user identity from the P-Called-Party-ID header field of the request, plus the display name if previously stored during registration, representing the originator of the response; and\n3)\tinclude in the P-Charging-Vector header field:\n-\tan \"icid-value\" header field parameter set to the value received in the request;\n-\tthe \"orig-ioi\" header field parameter, if received in the request;\n-\ta type 1 \"term-ioi\" header field parameter that identifies the sending network; and\n-\tif the P-CSCF has stored an \"fe-identifier\" header field parameter of the P-Charging-Vector header field, based on local policy, the stored \"fe-identifier\" header field parameter and include its own address or identifier in the \"fe-addr\" element of the \"fe-identifier\" header field parameter of the P-Charging-Vector header field.\nbefore forwarding the response in accordance with the procedures of RFC 3261 [26].\nWhen the P-CSCF receives, destined for the UE, a subsequent request for a dialog that is not a target refresh request (including requests relating to an existing dialog where the method is unknown), prior to forwarding the request, the P-CSCF shall:\n1)\tif a security association or  session exists, add its own address to the top of the received list of Via header fields and save the list The P-CSCF Via header field entry is built in a format that contains the protected server port number of the security association or  session established from the UE to the P-CSCF and either:\na)\tthe P-CSCF FQDN that resolves to the IP address of the security association or  session established from the UE to the P-CSCF; or\nb)\tthe P-CSCF IP address of the security association or  session established from the UE to the P-CSCF;\nNOTE:\tThe P-CSCF associates two ports, a protected client port and a protected server port, with each pair of security associations or  session. For details of the usage of the two ports see 3GPP TS 33.203 [19].\n2)\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled authentication is used, when adding its own address to the top of the received list of Via header fields and saving the list, build the P-CSCF Via header field entry in a format that contains an unprotected server port number where the P-CSCF expects responses to the current request from the UE;\n3)\tvoid;\n4)\tfor INVITE dialogs, replace the saved CSeq header field value received in the request such that the P-CSCF is able to release the session if needed;\n5)\tif the request is destined to a UE performing the functions of an external attached network operating in static mode, send the request using the already established  session as described in subclause 5.2.6.4.3; and\n6)\tstore the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present;\nbefore forwarding the request to the UE either in accordance with the procedures of RFC 3261 [26] or as specified in RFC 5626 [92].\nWhen the P-CSCF receives any response to the above request, the P-CSCF shall:\n1)\tverify that the list of Via header fields matches the saved list of Via header fields received in the request corresponding to the same dialog, including the P-CSCF Via header field value. This verification is done on a per Via header field value basis, not as a whole string. If these lists do not match, then the P-CSCF shall either:\na)\tdiscard the response; or\nb)\treplace the Via header field values with those received in the request; and\n2)\tinclude in the P-Charging-Vector header field:\na)\tan \"icid-value\" header field parameter set to the value received in the initial request for the dialog;\nb)\tthe \"orig-ioi\" header field parameter, if received in the request; and\nc)\ta type 1 \"term-ioi\" header field parameter that identifies the sending network;\nbefore forwarding the response in accordance with the procedures of RFC 3261 [26].\nVoid.\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.7\tInitial INVITE",
                            "text_content": "In addition to following the procedures for initial requests defined in subclause 5.2.6, initial INVITE requests also follow the procedures of this subclause.\nWhen the P-CSCF receives from the UE an INVITE request for which resource authorization procedure is required, if it receives from the IP-CAN (e.g. via PCRF) an indication that the requested resources for the multimedia session being established cannot be granted and this indication does not provide an acceptable bandwidth information:\n-\tif the P-CSCF is unable to handle further requests from the UE (i.e. P-CSCF is overloaded by SIP requests), the P-CSCF shall return a 503 (Service Unavailable) response to the received INVITE request. Depending on local operator policy, the 503 (Service Unavailable) response may include a Retry-After header field; and\n-\tif the P-CSCF is able to handle further requests from the UE (i.e. P-CSCF is not overloaded by SIP requests), the P-CSCF shall return a 500 (Server Internal Error) response to the received INVITE request. Depending on local operator policy, the 500 (Server Internal Error) response may include a Retry-After header field.\nWhen the P-CSCF receives from the UE an INVITE request, the P-CSCF may require the periodic refreshment of the session to avoid hung states in the P-CSCF. If the P-CSCF requires the session to be refreshed, then the P-CSCF shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 1:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nThe P-CSCF shall respond to all INVITE requests with a 100 (Trying) provisional response.\nIf received from the IP-CAN, the P-CSCF shall also include the access-network-charging-info parameter (e.g. received via the PCRF, over the Rx or Gx interfaces) in the P-Charging-Vector header field in the first request originated by the UE that traverses the P-CSCF, as soon as the charging information is available in the P-CSCF, e.g., after the local resource reservation is complete. Typically, this first request is an UPDATE request if the remote UA supports the \"integration of resource management in SIP\" extension or a re-INVITE request if the remote UA does not support the \"integration of resource management in SIP\" extension. See subclause 5.2.7.4 for further information on the access network charging information.\nIf:\n-\tthe UE is roaming;\n-\tthe P-CSCF is not in the home network; and\n-\tan agreement exists with the home network operator (as identified by the bottom most  in the list of URIs received in the Service-Route header field during the last successful registration or reregistration) to support Roaming Architecture for Voice over IMS with Local Breakout;\nthe P-CSCF may:\n-\tinsert into the request a Feature-Caps header field with the \"+g.3gpp.trf\" header field parameter as specified in RFC 6809 [190]. Based on local policy the P-CSCF shall insert the \"+g.3gpp.trf\" header field parameter with the parameter value set to the  of the desired TRF; and\n-\tif a TRF  is included in the \"+g.3gpp.trf\" header field parameter and the P-CSCF supports indicating the traffic leg associated with a  as specified in RFC 7549 [225] and if required by local policy, append an \"iotl\" SIP  parameter with a value set to \"homeA-visitedA\" to the TRF .\nIf:\n-\tthe UE is roaming;\n-\tthe P-CSCF is not in the home network; and\n-\tthe visited network supports MRB functionality for the allocation of MRF resources and if an agreement exists with the home operator (identified by the bottom most  in the list of URIs received in the Service-Route header field during the last successful registration or reregistration) to provide access to MRF resources from the visited network;\nthe P-CSCF may insert into the request a Feature-Caps header field with the \"+g.3gpp.mrb\" header field parameter, as specified in RFC 6809 [190]. Based on local policy the P-CSCF shall insert the \"+g.3gpp.mrb\" header field parameter with the parameter value set to the  of the desired MRB.\nThe P-CSCF (IMS-) shall transparently forward a received Contact header field towards the UE when the Contact header field contains a GRUU or a media feature tag indicating a capability for which the  can be used.\nNOTE 2:\tOne example of such a media feature tag is the isfocus media feature tag where the  in the Contact header field is used by conference services to transport the temporary conference identity that can be used when rejoining an ongoing conference.\nNOTE 3:\tVarious mechanisms can be applied to recognize the need for priority treatment (e.g., based on the dialled digits). The exact mechanisms are left to national regulation and network configuration.\nBased on the alternative mechanism to recognize the need for priority treatment, the P-CSCF shall insert the temporarily authorised Resource-Priority header field with appropriate namespace and priority value in the INVITE request.\nWhen the P-CSCF responds to the UE with a 500 (Server Internal Error) response after receiving an indication that radio/bearer resources are not available, then based on operator policy, the P-CSCF may include a Reason header field with a protocol value set to \"FAILURE_CAUSE\" and a \"cause\" header field parameter set to \"1\" as specified in subclause 7.2A.18.12.2 and a Response-Source header field with a \"fe\" header field parameter set to \"<urn:3gpp:fe:p-cscf.orig>\".\nIf the P-CSCF supports the in-call access update procedure and if a received response to the INVITE request contains a Feature-Caps header field with a g.3gpp.in-call-access-update feature capability indicator, the P-CSCF shall store the value of this feature capability indicator.\nWhen the P-CSCF receives an INVITE request destined for the UE the P-CSCF may require the periodic refreshment of the session to avoid hung states in the P-CSCF. If the P-CSCF requires the session to be refreshed, then the P-CSCF shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 1:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it in order to make it work.\nWhen the P-CSCF receives an initial INVITE request destined for the UE, it will have a list of Record-Route header fields. Prior to forwarding the initial INVITE request, the P-CSCF shall respond to all INVITE requests with a 100 (Trying) provisional response.\nIf received from the IP-CAN, the P-CSCF shall also include the access-network-charging-info parameter (e.g. received via the PCRF, over the Rx or Gx interfaces) in the P-Charging-Vector header field in the first request or reliable response originated by the UE that traverses the P-CSCF, as soon as the charging information is available in the P-CSCF e.g., after the local resource reservation is complete. When the P-CSCF sends the response including P-Charging-Vector header field, the P-CSCF shall set the \"icid-value\" header field parameter to the previously received value of \"icid-value\" header field parameter in the request. See subclause 5.2.7.4 for further information on the access network charging information.\nThe P-CSCF (IMS-) shall transparently forward a received Contact header field towards the UE when the Contact header field contains a GRUU or a media feature tag indicating a capability for which the  can be used.\nNOTE 2:\tOne example of such a media feature tag is the isfocus media feature tag where the  in the Contact header field is used by conference services to transport the temporary conference identity that can be used when rejoining an ongoing conference.\nIf the P-CSCF supports the in-call access update procedure and if the received INVITE request contains a Feature-Caps header field with a g.3gpp.in-call-access-update feature capability indicator, the P-CSCF shall store the value of this feature capability indicator.\nThe P-CSCF shall include the \"access-network-charging-info\" header field parameter within the P-Charging-Vector header field as described in subclause 7.2A.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.8\tCall release",
                            "text_content": "Upon receipt of an indication that the signalling bearer is no longer available (e.g. an Rx interface message from PCRF), the P-CSCF shall cancel that dialog by applying the following steps:\n1)\tif the P-CSCF serves the calling user of the session, send out a CANCEL request to cancel the INVITE request towards the terminating UE that includes:\na)\tif a cause or error code was received from the entity controlling radio/bearer resources, a Reason header field, with an appropriate protocol value in the protocol field, and the \"cause\" header field parameter set to the received cause or error code; and\nb)\tif:\n-\tno cause or error code was received from the entity controlling radio/bearer resources; or\n-\tif the abort cause PS_TO_CS_HANDOVER was received over Rx from the entity controlling radio/bearer resources;\na Reason header field containing a 503 (Service Unavailable) status code according to the procedures described in RFC 3261 [26] and RFC 3326 [34A]; and\n2)\tif the P-CSCF serves the called user of the session, send out a 500 (Server Internal Error) response to the received INVITE request. If a cause or error code was received from the entity controlling radio/bearer resources the P-CSCF shall include a Reason header field, with a protocol value set to \"FAILURE_CAUSE\" in the \"protocol\" header field parameter as described in subclause 7.2A.18.12.2, and the \"cause\" header field parameter set to \"2\" as described in subclause 7.2A.18.12.2.\nUpon receipt of an indication that QoS or bearer resources are no longer available for a media negotiated in a multimedia session currently being established (e.g. an Rx interface message from PCRF) and if no SIP message removing the media for which resources are no longer available is received within an operator defined time after the reception of the indication, the P-CSCF shall:\n1)\tcancel that dialog by responding to the original INVITE request with a 500 (Server Internal Error) response. If a cause or error code was received from the entity controlling radio/bearer resources the P-CSCF shall include a Reason header field, with a protocol value set to \"FAILURE_CAUSE\" in the \"protocol\" header field parameter as described in subclause 7.2A.18.12.2, and the \"cause\" header field parameter set to \"1\" as described in subclause 7.2A.18.12.2; and\n2)\tby sending out a CANCEL request to the INVITE request towards the terminating UE that includes a Reason header field containing a 503 (Service Unavailable) status code according to the procedures described in RFC 3261 [26] and RFC 3326 [34A].\nUpon:\n1)\treceipt of an indication that the radio/bearer resources are no longer available for a media negotiated in a session (e.g. an Rx interface message from PCRF) and if no SIP message removing the media for which resources are no longer available is received within an operator defined time after the reception of the indication;\n2)\treceipt of an indication that the signalling bearer is no longer available (e.g. an Rx interface message from PCRF); or\n3)\tdetecting that the SDP offer conveyed in a SIP response contained parameters which are not allowed according to the local policy (as specified in the subclause 6.2);\nthe P-CSCF shall release the respective dialog by applying the following steps:\n1)\tif the P-CSCF serves the calling user of the session, then the P-CSCF shall generate a BYE request destined for the called user based on the information saved for the related dialog, including:\n-\ta Request-, set to the stored Contact header field provided by the called user;\n-\ta To header field, set to the To header field value as received in the 200 (OK) response for the initial INVITE request;\n-\ta From header field, set to the From header field value as received in the initial INVITE request;\n-\ta Call-ID header field, set to the Call-Id header field value as received in the initial INVITE request;\n-\ta CSeq header field, set to the current CSeq value stored for the direction from the calling to the called user, incremented by one;\n-\ta Route header field, set to the routeing information towards the called user as stored for the dialog;\n-\ta Reason header field or Reason header fields that contains:\na)\tif a cause or error code was received from the entity controlling radio/bearer resources, an appropriate protocol value in the protocol field, and the \"cause\" header field parameter set to the received cause or error code;\nb)\tif no cause or error code was received from the entity controlling radio/bearer resources, and if radio/bearer interface resources are no longer available, a 503 (Service Unavailable) response code;\nc)\tif no cause or error code was received from the entity controlling radio/bearer resources, and if the signalling bearer is no longer available, a 503 (Service Unavailable) response code;\nd)\tif no cause or error code was received from the entity controlling radio/bearer resources, and if a SDP offer conveyed in a SIP response contained parameters which are not allowed according to the local policy, a 488 (Not Acceptable Here) response code; and\ne)\tif the abort cause PS_TO_CS_HANDOVER was received over Rx from the entity controlling radio/bearer resources, a 503 (Service Unavailable) response code;\n-\tfurther header fields, based on local policy; and\n-\tsend the generated BYE requests towards the called user;\n2)\tif the P-CSCF serves the calling user of the session and upon detecting that the SDP offer conveyed in a SIP response contained parameters which are not allowed according to the local policy (as specified in the subclause 6.2), then the P-CSCF shall generate an additional BYE request destined for the calling user based on the information saved for the related dialog, including:\n-\ta Request-, set to a contact address obtained from the stored Contact header field if provided by the calling user. If the stored Contact header field contains either a public or a temporary GRUU, the P-CSCF shall set the Request- either to:\na)\tthe stored UE IP address and the UE port associated with the respective GRUU, if the stored Contact header field contains either a public or a temporary GRUU and the bidirectional flow as defined in RFC 5626 [92] is not used for this session; or\nb)\tthe UE IP address and UE port associated with the bidirectional flow that the P-CSCF uses to send the in-dialog requests toward the UE as defined in RFC 5626 [92];\n-\ta To header field, set to the From header field value as received in the initial INVITE request;\n-\ta From header field, set to the To header field value as received in the 200 (OK) response for the initial INVITE request;\n-\ta Call-ID header field, set to the Call-Id header field value as received in the initial INVITE request;\n-\ta CSeq header field, set to the current CSeq value stored for the direction from the called to the calling user, incremented by one;\n-\ta Route header field, set to the routeing information towards the calling user as stored for the dialog;\n-\ta Reason header field that contains a 488 (Not Acceptable Here) response code;\n-\tfurther header fields, based on local policy; and\n-\tsend the BYE request either:\na)\tto the contact address indicated in the Request-, if the dialog being released did not use the bidirectional flow to send the requests to the UE as defined in RFC 5626 [92]; or\nb)\tover the same flow that the P-CSCF uses to send the in-dialog requests toward the UE as defined in RFC 5626 [92];\n3)\tIf the P-CSCF serves the called user of the session, then the P-CSCF shall generate a BYE request destined for the calling user based on the information saved for the related dialog, including:\n-\ta Request-, set to the stored Contact header field provided by the calling user;\n-\ta To header field, set to the From header field value as received in the initial INVITE request;\n-\ta From header field, set to the To header field value as received in the 200 (OK) response for the initial INVITE request;\n-\ta Call-ID header field, set to the Call-Id header field value as received in the initial INVITE request;\n-\ta CSeq header field, set to the current CSeq value stored for the direction from the called to the calling user, incremented by one;\n-\ta Route header field, set to the routeing information towards the calling user as stored for the dialog;\n-\ta Reason header field or Reason header fields that contains:\na)\tif a cause or error code was received from the entity controlling radio/bearer resources, an appropriate protocol value in the protocol field, and the \"cause\" header field parameter set to the received cause or error code;\nb)\tif no cause or error code was received from the entity controlling radio/bearer resources, and if radio/bearer interface resources are no longer available, a 503 (Service Unavailable) response code;\nc)\tif no cause or error code was received from the entity controlling radio/bearer resources, and if a SDP offer conveyed in a SIP response contained parameters which are not allowed according to the local policy, a 488 (Not Acceptable Here) response code; and\nd)\tif the abort cause PS_TO_CS_HANDOVER was received over Rx from the entity controlling radio/bearer resources, a 503 (Service Unavailable) response code;\n-\tfurther header fields, based on local policy; and\n-\tsend the generated BYE requests towards the calling user;\n4)\tif the P-CSCF serves the called user of the session and upon detecting that the SDP offer conveyed in a SIP response contained parameters which are not allowed according to the local policy (as specified in the subclause 6.2), then the P-CSCF shall generate an additional BYE request destined for the called user based on the information saved for the related dialog, including:\n-\ta Request-, set to a contact address obtained from the stored Contact header field if provided by the called user. If the stored Contact header field contains either a public or a temporary GRUU, the P-CSCF shall set the Request- either to:\na)\tthe stored UE IP address and the UE port associated with the respective GRUU, if the stored Contact header field contains either a public or a temporary GRUU and the bidirectional flow as defined in RFC 5626 [92] is not used for this session; or\nb)\tthe UE IP address and the UE port associated with the bidirectional flow that the P-CSCF uses to send the in-dialog requests toward the UE as defined in RFC 5626 [92];\n-\ta To header field, set to the To header field value as received in the 200 (OK) response for the initial INVITE request;\n-\ta From header field, set to the From header field value as received in the initial INVITE request;\n-\ta Call-ID header field, set to the Call-Id header field value as received in the initial INVITE request;\n-\ta CSeq header field, set to the current CSeq value stored for the direction from the calling to the called user, incremented by one;\n-\ta Route header field, set to the routeing information towards the called user as stored for the dialog;\n-\ta Reason header field that contains a 488 (Not Acceptable Here) response code;\n-\tfurther header fields, based on local policy; and\n-\tsend the BYE request either:\na)\tto the contact address indicated in the Request-, if the dialog being released did not use t the bidirectional flow to send the requests to the UE as defined in RFC 5626 [92]; or\nb)\tover the same flow that the P-CSCF uses to send the in-dialog requests toward the UE as defined in RFC 5626 [92].\nUpon receipt of the 2xx responses for the BYE requests, the P-CSCF shall delete all information related to the dialog and the related multimedia session.\nUpon receipt of a request on a dialog for which the P-CSCF initiated session release, the P-CSCF shall terminate this received request and answer it with a 481 (Call/Transaction Does Not Exist) response.\nIf there are still active dialogs associated with the user after the security associations, IP association or  sessions were deleted, the P-CSCF shall discard all information pertaining to these dialogs without performing any further SIP transactions with the peer entities of the P-CSCF.\nNOTE:\tIf the interface between the P-CSCF and the IP-CAN is supported, the P-CSCF will also indicate (e.g. via the Rx or Gx interface) that the session has been terminated.\nWhen the P-CSCF receives a 2xx response for a BYE request matching an existing dialog, then the P-CSCF shall delete all the stored information related to the dialog.\nIf the P-CSCF requested the session to be refreshed periodically, and the P-CSCF got the indication that the session will be refreshed, when the session timer expires, the P-CSCF shall delete all the stored information related to the dialog.\nNOTE:\tIf the interface between the P-CSCF and the IP-CAN is supported, the P-CSCF will also indicate to the IP-CAN (e.g. via the Rx or Gx interface), that the session has terminated.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.9\tSubsequent requests",
                            "text_content": "The P-CSCF shall respond to all reINVITE requests with a 100 (Trying) provisional response.\nFor a reINVITE request or UPDATE request from the UE within the same dialog, the P-CSCF shall include the updated access-network-charging-info parameter from P-Charging-Vector header field when sending the SIP request to the S-CSCF. See subclause 5.2.7.4 for further information on the access network charging information.\nFor an ACK request from the UE sent on a dialog where a 200 (OK) has been received, the P-CSCF shall include the access-network-charging-info parameter from the P-Charging-Vector header field when updated access-network-charging-info is available when sending the ACK request to the S-CSCF. See subclause 5.2.7.4 for further information on the access network charging information.\nIf priority is supported, the P-CSCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field value.\nNOTE:\tA UE-initiated priority upgrade request directly from the UE to the P-CSCF is not supported using a special dial string as described in clause 4.11.\nThe P-CSCF shall respond to all reINVITE requests with a 100 (Trying) provisional response.\nFor a reINVITE request or UPDATE request destined towards the UE within the same dialog, when the P-CSCF sends 200 (OK) response (to the INVITE request or UPDATE request) towards the S-CSCF, the P-CSCF shall include the updated access-network-charging-info parameter in the P-Charging-Vector header field. See subclause 5.2.7.4 for further information on the access network charging information.\nIf priority is supported, the P-CSCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field value and set the backwards indication accordingly.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.10\tEmergency service",
                            "text_content": "If the P-CSCF belongs to a network where the registration is not required to obtain emergency service, the P-CSCF shall accept any unprotected request on the IP address and port advertised to the UE during the P-CSCF discovery procedure. The P-CSCF shall also accept any unprotected request on the same IP address and the default port as specified in RFC 3261 [26].\nWhen the P-CSCF sends unprotected responses to the UE, it shall use the same IP address and port where the corresponding request was received.\nThe P-CSCF can handle emergency session and other requests from both a registered user as well as an unregistered user. Certain networks only allow emergency session from registered users.\nNOTE 1:\tIf only emergency setup from registered users is allowed, a request from an unregistered user is ignored since it is received outside of the security association,  session or IP association.\nThe P-CSCF can handle emergency session establishment within a non-emergency registration, i.e. one that did not contain the \"sos\" SIP  parameter in the Contact header field of the 200 (OK) response.\nIf the network uses the Resource-Priority header field to control the priority of emergency calls, and the P-CSCF receives a REGISTER request containing an \"sos\" SIP  parameter in the Contact header field, the P-CSCF shall, in addition to the normal handling of the REGISTER request, add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197] to the REGISTER request.\nUpon receiving the 200 (OK) response to the REGISTER request that completes the emergency registration, as identified by the presence of the \"sos\" SIP  parameter in the Contact header field of the 200 (OK) response, the P-CSCF shall not subscribe to the registration event package for any emergency public user identity specified in the REGISTER request.\nUpon reception of a REGISTER request containing an \"sos\" SIP URI parameter in the Contact header field and not containing an Authorization header field, if:\n1)\tthe network supports IMS Services for roaming users in deployments without IMS-level roaming interfaces;\n2)\tthe UE is roaming;\n3)\tthere is no II-NNI to the HPLMN of the served user; and\n4)\tthe access type is not set to \"3GPP-NR-ProSe-L3UNR\";\nNOTE 2:\tThe P-CSCF can determine whether the UE is roaming by analysing the home network domain name of the user received in the Request- in the REGISTER request.\nNOTE 3:\tThe P-CSCF can know if II-NNI to the HPLMN of the served user is supported by analysing the home network domain name of the user received in the Request- in the REGISTER request.\nor:\n1)\tif required by operator policy; and\n2)\tthe UE is not roaming;\nthe P-CSCF:\n1)\tshall not forward the REGISTER request; and\n2)\tif the PCRF is used to retrieve the EPS-level identities (i.e., IMSI, IMEI(SV)) as specified in 3GPP TS 29.214 [13D] and IMSI is retrieved:\na)\tif the P-CSCF supports IMSI or IMEI verification upon reception of a REGISTER request without Authorization header;\ni)\tif the IMSI derived from public user identity conveyed in To header is different from the IMSI received from PCRF, shall reject the REGISTER request by returning a 403 (Forbidden) response and shall not perform the rest of steps; and\nNOTE 4:\tThe P-CSCF can also derive IMSI from derived private user identity. The private user identity can be derived from the public user identity being registered by removing  scheme and the following parts of the  if present: port number,  parameters, and To header field parameters.\nii)\tif the IMEI(SV) is retrieved from the PCRF and the TAC and SNR portions of the IMEI obtained from instance ID conveyed in Contact header field are different from the TAC and SNR portions of IMEI(SV) received from PCRF, reject the REGISTER request by returning a 403 (Forbidden) response and shall not perform the rest of steps;\nb)\tif MSISDN is retrieved:\ni)\tshall generate:\n-\ta SIP URI with user=phone for the retrieved MSISDN; and\n-\ta tel  for the retrieved MSISDN;\nand shall include the URIs in the associated set of implicitly registered public user identities bound to the contact address from which the REGISTER request was received; and\nii)\tshall treat the SIP URI with user=phone for the retrieved MSISDN as the default public user identity for requests received from the contact address from which the REGISTER request was received;\nc)\tif MSISDN is not retrieved:\ni)\tshall generate a temporary public user identity for the IMSI retrieved from the PCRF as specified in 3GPP TS 29.214 [13D] and shall include the temporary public user identity in the associated set of implicitly registered public user identities bound to the contact address from which the REGISTER request was received; and\nii)\tshall treat the temporary public user identity for the retrieved IMSI as the default public user identity for requests received from the contact address from which the REGISTER request was received; and\nNOTE 5:\tIn the case when MSISDN is not retrieved, if the temporary public user identity is not provisioned in the HSS or is provisioned in the HSS, but barred, then a PSAP callback is not possible.\nd)\tshall send a 200 (OK) response for the REGISTER request. In the 200 (OK) response, the P-CSCF shall include a P-Associated- header field containing the list of the implicitly registered public user identities bound to the contact address from which the REGISTER request was received. The first  in the list of public user identities will indicate the default public user identity.\nThe P-CSCF shall store a configurable list of local emergency service identifiers, i.e. emergency numbers (the emergency numbers that can be resolved in the network to which the P-CSCF belongs) and emergency service URNs (i.e. emergency service URNs identifying emergency services that can be resolved in the network to which the P-CSCF belongs). In addition to the configurable list of local emergency service identifiers, the P-CSCF shall store a configurable list of roaming partners' emergency service identifiers (i.e. the emergency service numbers or the emergency service URNs identifying emergency services, which can be resolved in the roaming partners' network). Each emergency number in a configurable list is mapped to an emergency service URN if the network is configured, for the emergency number, to:\n-\taccept a received request including the emergency number; or\n-\treject, using a 380 (Alternative Service) response, a received request including the emergency number, and include in the response a Contact header field with the emergency service URN.\nNOTE 6:\tThe emergency service URN is common to all networks, although subtypes might either not necessarily be in use, or a different set of subtypes is in use in different networks.\nAccess technology specific procedures are described in each access technology specific annex to determine the originating network of the requests.\nNOTE 7:\tDepending on local operator policy, the P-CSCF has the capability to reject requests relating to specific methods in accordance with RFC 3261 [26], as an alternative to the functionality described above.\nIf the P-CSCF receives an initial request for a dialog or standalone transaction, or an unknown method from an unregistered user on the IP address and the unprotected port advertised to the UE during the P-CSCF discovery or the SIP default port, the P-CSCF shall inspect the Request- independent of values of possible entries in the received Route header fields for emergency service identifiers. The P-CSCF shall consider the Request  of the initial request as an emergency service identifier, if it is an emergency number or an emergency service URN in the list of local emergency service identifiers or in the list of roaming partners emergency service identifiers.\nIf the Request-URI is a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69] and the P-CSCF does not consider the Request  of the initial request as an emergency service identifier, the P-CSCF may:\n-\tremove the right most service identifier and re-inspect the Request- for emergency service identifiers; or\n-\tset the Request-URI to an operator defined emergency service URN that matches one of the emergency service identifiers.\nIf the P-CSCF detects that the Request- of the initial request for a dialog or a standalone transaction, or an unknown method matches one of the emergency service identifiers, the P-CSCF:\n1)\tshall include in the Request- an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" in accordance with RFC 5031 [69]:\na)\tif the received Request- matches an emergency service URN, as received in the Request- from the UE; and\nb)\tif the received Request- does not match an emergency service URN, as deduced from the Request- received from the UE;\nNOTE 1:\tBullet b) can happen if a request is received from a UE not following the procedures in the present document.\n2)\tshall include a topmost Route header field set to the  associated with an E-CSCF;\nNOTE 2:\tHow the list of E-CSCF is obtained by the P-CSCF is implementation dependent.\n3)\tshall execute the procedure described in subclause 5.2.6.3.3, subclause 5.2.6.3.7, subclause 5.2.6.3.11 and subclause 5.2.7.2, as appropriate except for:\n-\tverifying the preloaded route against the received Service-Route header field;\n-\trouting to IBCF;\n-\tremoving the P-Preferred-Identity header field;\n-\tinserting a P-Asserted-Identity header field; and\n-\tinserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field;\n3A)\tvoid;\n3B)\twhere the network uses the Resource-Priority header field to control the priority of emergency calls, shall add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197];\n4)\tif the P-CSCF detects that the UE is behind a , and the UE's Via header field contains a \"keep\" header field parameter, shall add a value to the parameter, to indicate that it is willing to receive keep-alives associated with the dialog from the UE, as defined in RFC 6223 [143]; and\n5)\tif required by operator policy (e.g. when the network supports IMS services for roaming users in deployments without IMS-level roaming interfaces), and the P-CSCF supports including EPS-level identities (i.e. IMSI, IMEI(SV)) and MSISDN in a request from an unregistered user:\na)\tshall attempt to retrieve from PCRF the EPS-level identities and MSISDN available for the IP-CAN session of the request:\nb)\tif a Subscription-Id AVP(s) as specified in 3GPP TS 29.214 [13D] with an MSISDN, an IMSI or both is(are) retrieved:\ni)\tshall remove from the request any P-Preferred-Identity header field;\nii)\tif an MSISDN is retrieved, shall insert in the request a P-Asserted-Identity header field set to a tel URI carrying the MSISDN; and\niii)\tif an IMSI is retrieved, shall insert in the request a P-Asserted-Identity header field set to a temporary public user identity derived from the IMSI, as defined in 3GPP TS 23.003 [3]; and\nc)\tif a User-Equipment-Info-Type AVP or a User-Equipment-Info-Extension AVP as specified in 3GPP TS 29.214 [13D] with an IMEI(SV) is retrieved where the TAC and SNR portions are different from the TAC and SNR portions of the IMEI received in the \"+sip.instance\" header field parameter of the Contact header field of the request and if according to operator policy, shall reject the request with 403 (Forbidden) response.\nWhen the P-CSCF receives any 1xx or 2xx response to the above requests, the P-CSCF shall execute the appropriate procedure for the type of request described in subclause 5.2.6.3.4, subclause 5.2.6.3.8, and subclause 5.2.6.3.12, except that the P-CSCF may rewrite the port number of its own Record-Route entry to an unprotected port where the P-CSCF wants to receive the subsequent incoming requests from the UE belonging to this dialog.\nIf the P-CSCF does not receive any response to the initial request for a dialog or standalone transaction or unknown method (including its retransmissions); or receives a 3xx response or 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method, the P-CSCF shall include a  associated with a different E-CSCF in the topmost Route header field and forward the request.\nWhen the P-CSCF received a subsequent request in the dialog from the UE, and the network uses the Resource-Priority header field to control the priority of emergency calls, the P-CSCF shall add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197].\nWhen the P-CSCF receives a target refresh request from the UE for a dialog, the P-CSCF shall execute the procedure described in subclause 5.2.6.3.5, except for inserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field.\nWhen the P-CSCF receives from the UE subsequent requests other than a target refresh request (including requests relating to an existing dialog where the method is unknown), the P-CSCF shall execute the procedure described in subclause 5.2.6.3.9, except for inserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field.\nWhen the P-CSCF receives any 1xx or 2xx response to the above requests, the P-CSCF shall execute the appropriate procedure for the type of request described in subclause 5.2.6.3.5 or subclause 5.2.6.3.9.\nWhen the P-CSCF receives, destined for the UE, a target refresh request for a dialog, prior to forwarding the request, the P-CSCF shall execute the procedure described in step 5, the paragraph of subclause 5.2.6.4.5.\nWhen the P-CSCF receives a 1xx or 2xx response to the above request the P-CSCF shall execute the procedure described in subclause 5.2.6.4.6, except for inserting type 1 \"orig-ioi\" and \"term-ioi\" header field parameters in the P-Charging-Vector header field.\nWhen the P-CSCF receives any other response to the above request the P-CSCF shall execute the procedure described in steps in the paragraph of subclause 5.2.6.4.6 describing when the P-CSCF receives any other response to a target request, except for inserting type 1 \"orig-ioi\" and \"term-ioi\" header field parameters in the P-Charging-Vector header field.\nWhen the P-CSCF receives, destined for the UE, a subsequent request for a dialog that is not a target refresh request (including requests relating to an existing dialog where the method is unknown), prior to forwarding the request, the P-CSCF shall execute the procedure described in steps 3 and 4 of subclause 5.2.6.4.9 describing when a P-CSCF receives a subsequent request.\nWhen the P-CSCF receives any other response to the above request the P-CSCF shall execute the procedure described in steps in the paragraph of subclause 5.2.6.4.10 describing when the P-CSCF receives any other response to a subsequent request, except for inserting type 1 \"orig-ioi\" and \"term-ioi\" header field parameters in the P-Charging-Vector header field.\nIf the P-CSCF receives an initial request for a dialog, or a standalone transaction, or an unknown method, for a registered user over the security association,  session, or IP association that was created during the emergency registration, as identified by the presence of the \"sos\" SIP  parameter in the Contact header field of the 200 (OK) response, the P-CSCF shall inspect the Request- independent of values of possible entries in the received Route header fields for emergency service identifiers. The P-CSCF shall consider the Request  of the initial request as an emergency service identifier, if it is an emergency number or an emergency service URN from the configurable lists that are associated with:\n-\tthe country of the operator to which the P-CSCF belongs to; and\n-\tfor inbound roamers, the country from which the UE is roaming from. The P-CSCF determines the country to which the UE is belonging to based on the content of the P-Assserted-Identity header field which contains the home network domain name in a SIP  belonging to the user.\nIf the P-CSCF detects that the Request- of the initial request for a dialog, or a standalone transaction, or an unknown method does not match any one of the emergency service identifiers in the associated lists, the P-CSCF shall either:\n-\treject the request by returning a 403 (Forbidden) response to the UE; or\n-\tif the Request-URI is a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69]:\n1)\tthe P-CSCF sets the Request-URI to an operator defined emergency service URN that matches one of the emergency service identifiers; or\n2)\tremove the right most service identifier and re-inspect the Request- for emergency service identifiers.\nIf the P-CSCF detects that the Request- of the initial request for a dialog, or a standalone transaction, or an unknown method matches one of the emergency service identifiers in the associated lists, the P-CSCF shall:\n1)\tinclude in the Request- an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69]:\na)\tif the received Request- matches an emergency service URN, as received from the UE in the Request-; and\nb)\tif the received Request- does not match an emergency service URN, as deduced from the Request- received from the UE.\nNOTE 1:\tBullet b) can happen if a request is received from a UE not following the procedures in the present document.\n1A)\tif the operator policy requires that emergency service requests are forwarded to the S-CSCF and the P-CSCF determines that the network to which the originating user is attached (see the IP-CAN specific annexes for the detailed procedure) is the network the P-CSCF is in and if the user is not roaming, then:\nNOTE 2:\tThe P-CSCF can know if the user is roaming by comparing the home network domain name of the user received in the Request- in the REGISTER request with its own domain name. If they are different the user is a roaming user.\na)\texecute the procedure described in subclause 5.2.6.3.3, subclause 5.2.6.3.7, subclause 5.2.6.3.11 and subclause 5.2.7.2, as appropriate except for routing to IBCF;\nb)\tbefore the request is forwarded in the referenced procedures, include a bottom most Route header field set to the  associated with an E-CSCF;\nNOTE 3:\tIt is implementation dependent as to how the P-CSCF obtains the list of E-CSCFs.\nc)\tafterwards upon receipt of a target refresh request or a subsequent request other than a target refresh request (including requests relating to an existing dialog where the method is unknown) for a dialog from the UE, execute the procedure described in subclause 5.2.6.3.5 and subclause 5.2.6.3.9; and\nd)\tafterwards upon receipt of any response from the UE to a target refresh request or a subsequent request other than a target refresh request (including requests relating to an existing dialog where the method is unknown) for a dialog, execute the procedure described in subclause 5.2.6.4.6 and subclause 5.2.6.4.10;\n1B)\tif the condition for 1A) is not fulfilled then:\na)\texecute the procedure described in subclause 5.2.6.3.3, subclause 5.2.6.3.7, subclause 5.2.6.3.11 and subclause 5.2.7.2, as appropriate except for:\n-\tverifying the preloaded route against the received Service-Route header field;\n-\trouting to IBCF; and\n-\tinserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field;\nb)\tbefore the request is forwarded in the referenced procedures, remove all Route header fields and include a Route header field set to the  associated with an E-CSCF;\nNOTE 4:\tIt is implementation dependent as to how the P-CSCF obtains the list of E-CSCFs.\nc)\tafterwards upon receipt of a target refresh request or a subsequent request other than a target refresh request (including requests relating to an existing dialog where the method is unknown) for a dialog from the UE, execute the procedure described in subclause 5.2.6.3.5 and subclause 5.2.6.3.9, except for inserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field; and\nd)\tafterwards upon receipt of any response from the UE to a target refresh request or a subsequent request other than a target refresh request (including requests relating to an existing dialog where the method is unknown) for a dialog, execute the procedure described in subclause 5.2.6.4.6 and subclause 5.2.6.4.10, except for inserting type 1 \"orig-ioi\" and \"term-ioi\" header field parameters in the P-Charging-Vector header field;\n1C)\tif the request is from a UE that is not considered as privileged sender and if the alternative identity of the originator of the request was not identified (see subclause 5.2.6.3.1):\ni)\tif the P-Asserted-Identity header field in the request to be sent contains a SIP  and if a tel  belongs to the set of implicitly registered public user identities that contains the SIP , add a second P-Asserted-Identity header field that contains the first tel  of the implicitly registered public user identities; and\nii)\tif the P-Asserted-Identity header field in the request to be sent contains a tel , add a second P-Asserted-Identity header field that contains the first SIP  of the implicitly registered public user identities that contains the tel ;\n2)\tif the request contains a Contact header field containing a GRUU the P-CSCF shall save the GRUU received in the Contact header field of the request and associate it with the UE IP address and UE port such that the P-CSCF is able to route target refresh request containing that GRUU in the Request-. The UE port used for the association is determined as follows:\n-\tif IMS AKA or SIP digest with  is being used as a security mechanism, the UE protected server port for the security association on which the request was received; or\n-\tif SIP digest without , NASS-IMS bundled authentication or GPRS-IMS-Bundled Authentication is being used as a security mechanism, the UE unprotected port on which the request was received;\n3)\twhere the network uses the Resource-Priority header field to control the priority of emergency calls, add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197]; and\n4)\tif the P-CSCF supports calling number verification using signature verification and attestation information as specified in subclause 3.1 and if required by operator policy, the P-CSCF shall perform attestation of the user identity by inserting:\n-\ta \"verstat\" tel URI parameter, specified in subclause 7.2A.20, to the tel URI or SIP URI with a user=phone parameter in the From header field or the P-Asserted-Identity header field;\n-\tan Attestation-Info header field specified in subclause 7.2.18; and\n-\tan Origination-Id header field, specified in subclause 7.2.19, set to a UUID identifying the P-CSCF which is configured based on local policy;\nIf the P-CSCF does not receive any response to an initial request for a dialog or standalone transaction or an unknown method sent to an E-CSCF (including its retransmissions); or receives a 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method sent to an E-CSCF, the P-CSCF shall include a , associated with a different E-CSCF, in the topmost Route header field and forward the request.\nIf the P-CSCF does not receive any response to an initial request for a dialog or standalone transaction or an unknown method sent to a S-CSCF (including its retransmissions); or receives a 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method sent to a S-CSCF, the P-CSCF shall include a , associated with a different E-CSCF, in the topmost Route header field of the initial request for a dialog or standalone transaction or an unknown method, and forward the request.\nWhen the P-CSCF received a subsequent request in the dialog from the UE, and the network uses the Resource-Priority header field to control the priority of emergency calls, the P-CSCF shall add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197].\nWhen the P-CSCF receives a target refresh request for a dialog with the Request- containing a GRUU the P-CSCF shall:\n-\tobtain the UE IP address and UE port associated to the GRUU contained in the Request- and rewrite the Request- with that UE IP address and UE port; and\n-\tperform the steps in subclause 5.2.6.4.5 for when the P-CSCF receives, destined for the UE, a target refresh request for a dialog.\nIf the P-CSCF receives an initial request for a dialog, or a standalone transaction, or an unknown method, for a registered user, and the request is:\na)\tunderstood from saved or included information to relate to private network traffic (see subclause 5.2.6.3), and operator policy requires the P-CSCF to detect an emergency session request relating to private network traffic; or\nb)\tnot understood from saved or included information to relate to private network traffic (see subclause 5.2.6.3);\nthen the P-CSCF shall inspect the Request- independent of values of possible entries in the received Route header fields for emergency service identifiers. The P-CSCF shall consider the Request  of the initial request as an emergency service identifier, if it is an emergency numbers or an emergency service URN from the configurable lists that are associated with:\n-\tthe country of the operator to which the P-CSCF belongs to;\n-\tfor inbound roamers, the country from which the UE is roaming from. The P-CSCF determines the country to which the UE is belonging to based on the content of the P-Assserted-Identity header field which contains the home network domain name in a SIP  belonging to the user; and\n-\tthe country of roaming partners, if the request originates from a different country then the country of the network to which the P-CSCF belongs to. Access technology specific procedures are described in each access technology specific annex to determine from which country and roaming partner the request was originated. If the country from which the request originates can not be determined all lists are associated.\nIf the P-CSCF detects that the Request- of the initial request for a dialog, or a standalone transaction, or an unknown method matches one of the emergency service identifiers in the associated lists, the P-CSCF shall:\n0A)\tdetermine the geographical location of the UE. Access technology specific procedures are described in each access technology specific annex:\na)\tif the UE is roaming and the P-CSCF is in the home operator's network, or the SDP of the request describes CS media (see 3GPP TS 24.292 [8O]), then the P-CSCF:\nI)\tshall reject the request as specified in subclause 5.2.10.5;\nb)\tif the UE is roaming and the P-CSCF is in the same network where the UE is roaming, or the UE is not roaming, then the P-CSCF, depending on operator policies:\nI)\tmay reject the request as specified in subclause 5.2.10.5; or\nII)\tmay continue with the next steps;\nNOTE 1:\tRoaming is when a UE is in a geographic area that is outside the serving geographic area of the home IM CN subsystem.\nNOTE 2:\tEmergency service URN in the request- indicates for the network that the emergency call attempt is recognized by the UE.\n1)\tinclude in the Request- an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69], if necessary. If information on the type of emergency service is known include a sub-service type. The entry in the Request- that the P-CSCF includes shall be:\n-\tif the received Request- matches an emergency service URN, as received from the UE in the Request-; and\n-\tif the received Request- does not match an emergency service URN, as deduced from the Request- received from the UE;\n1A)\tif operator policy requires that emergency service requests are forwarded to the S-CSCF and the P-CSCF determines that the network to which the originating user is attached (see the IP-CAN specific annexes for the detailed procedure) is the network the P-CSCF is in then:\na)\texecute the procedure described in subclause 5.2.6.3.3, subclause 5.2.6.3.7, subclause 5.2.6.3.11 and subclause 5.2.7.2, as appropriate except for routing to IBCF;\nb)\tbefore the request is forwarded in the referenced procedures, include a bottom most Route header field set to the  associated with an E-CSCF;\nNOTE 3:\tIt is implementation dependent as to how the P-CSCF obtains the list of E-CSCFs.\nc)\tafterwards upon receipt of a target refresh request or a subsequent request other than a target refresh request (including requests relating to an existing dialog where the method is unknown) for a dialog from the UE, execute the procedure described in subclause 5.2.6.3.5 and subclause 5.2.6.3.9; and\nd)\tafterwards upon receipt of any response from the UE to a target refresh request or a subsequent request other than a target refresh request (including requests relating to an existing dialog where the method is unknown) for a dialog, execute the procedure described in subclause 5.2.6.4.6 and subclause 5.2.6.4.10;\n1B)\tif the condition for 1A) is not fulfilled then:\na)\texecute the procedure described in subclause 5.2.6.3.3, subclause 5.2.6.3.7, subclause 5.2.6.3.11 and subclause 5.2.7.2, as appropriate except for:\n-\tverifying the preloaded route against the received Service-Route header field;\n-\trouting to IBCF; and\n-\tinserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field;\nb)\tbefore the request is forwarded in the referenced procedures, remove all Route header fields and include a Route header field set to the  associated with an E-CSCF;\nNOTE 4:\tIt is implementation dependent as to how the P-CSCF obtains the list of E-CSCFs.\nc)\tafterwards upon receipt of a target refresh request or a subsequent request other than a target refresh request (including requests relating to an existing dialog where the method is unknown) for a dialog from the UE, execute the procedure described in subclause 5.2.6.3.5 and subclause 5.2.6.3.9, except for inserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field; and\nd)\tafterwards upon receipt of any response from the UE to a target refresh request or a subsequent request other than a target refresh request (including requests relating to an existing dialog where the method is unknown) for a dialog, execute the procedure described in subclause 5.2.6.4.6 and subclause 5.2.6.4.10, except for inserting type 1 \"orig-ioi\" and \"term-ioi\" header field parameters in the P-Charging-Vector header field;\n1C)\tif the request is from a UE that is not considered as privileged sender and if the alternative identity of the originator of the request was not identified (see subclause 5.2.6.3.1):\ni)\tif the P-Asserted-Identity header field in the request to be sent contains a SIP  and if a tel  belongs to the set of implicitly registered public user identities that contains the SIP , add a second P-Asserted-Identity header field that contains the first tel  of the implicitly registered public user identities; and\nii)\tif the P-Asserted-Identity header field in the request to be sent contains a tel , add a second P-Asserted-Identity header field that contains the first SIP  of the implicitly registered public user identities that contains the tel ;\n2)\tif the request contains a Contact header field containing a GRUU the P-CSCF shall save the GRUU received in the Contact header field of the request and associate it with the UE IP address and UE port such that the P-CSCF is able to route target refresh request containing that GRUU in the Request-. The UE port used for the association is determined as follows:\n-\tif IMS AKA or SIP digest with  is being used as a security mechanism, the UE protected server port for the security association on which the request was received; or\n-\tif SIP digest without  is being used as a security mechanism, the UE unprotected port on which the request was received; and\n3)\twhere the network uses the Resource-Priority header field to control the priority of emergency calls, add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197].\nIf the P-CSCF does not receive any response to the initial request for a dialog or standalone transaction or an unknown method sent to an E-CSCF (including its retransmissions); or receives a 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method sent to an E-CSCF, the P-CSCF shall include a , associated with a different E-CSCF that has not been tried before for this initial request for the dialog or standalone transaction (including its retransmissions), in the topmost Route header field and forward the request.\nIf the P-CSCF does not receive any response to the initial request for a dialog or standalone transaction or an unknown method sent to a S-CSCF (including its retransmissions); or receives a 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method sent to a S-CSCF, the P-CSCF shall include a , associated with a different E-CSCF that has not been tried before for this initial request for the dialog or standalone transaction (including its retransmissions), in the topmost Route header field of the initial request for a dialog or standalone transaction or an unknown method, and forward the request.\nIf the P-CSCF:\n-\tdoes not receive any response to this initial request for a dialog or standalone transaction or an unknown method (including its retransmissions); or receives a 3xx response or 480 (Temporarily Unavailable) response to an initial request for a dialog or standalone transaction or an unknown method, and if all E-CSCFs have been tried before for this initial request for the dialog or standalone transaction (including its retransmissions), the P-CSCF shall reject this request as specified in subclause 5.2.10.5;\n-\treceives:\n1)\tany 4xx response other than a 480 (Temporarily Unavailable) response;\n2)\tany 5xx response;\n3)\tany 6xx response,\nand the entry in the Request- as received from the UE is not in accordance with RFC 5031 [69], then the P-CSCF shall reject this request as specified in subclause 5.2.10.5.\nIf the P-CSCF receives from the IP-CAN (e.g. via PCRF) an indication that the requested resources for the multimedia session being established cannot be granted and the entry in the Request- as received from the UE is not in accordance with RFC 5031 [69], then the P-CSCF shall:\n-\tsend a CANCEL request to cancel the request forwarded to the selected E-CSCF; and\n-\treject this request as specified in subclause 5.2.10.5.\nWhen the P-CSCF received a subsequent request in the dialog from the UE, and the network uses the Resource-Priority header field to control the priority of emergency calls, the P-CSCF shall add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197].\nWhen the P-CSCF receives a target refresh request for a dialog with the Request- containing a GRUU the P-CSCF shall:\n-\tobtain the UE IP address and UE port associated to the GRUU contained in the Request- and rewrite the Request- with that UE IP address and UE port; and\n-\tperform the steps in subclause 5.2.6.4 for when the P-CSCF receives, destined for the UE, a target refresh request for a dialog.\nIf the IM CN subsystem to where the P-CSCF belongs to is not capable to handle emergency sessions or due to local policy does not handle emergency sessions or only handles certain type of emergency session request or does not support emergency sessions for either the geographical location of the UE is located or the IP-CAN to which the UE is attached, or the SDP of the request describes CS media (see 3GPP TS 24.292 [8O]), or for reasons described in subclause 5.2.10.4, the P-CSCF shall not forward the initial request for a dialog or standalone transaction or an unknown method. The P-CSCF:\nI)\tshall reject the request by returning a 380 (Alternative Service) response;\nII)\tif:\n-\tsupport for the 3GPP IM CN subsystem XML body as described in subclause 7.6 in the Accept header field is not indicated, the P-CSCF shall assume that the UE supports version 1 of the 3GPP XML Schema for the IM CN subsystem XML; or\n-\tif both the \"sv\" and \"schemaversion\" parameters are present, then the P-CSCF shall ignore the value of the \"schemaversion\" parameter;\nIII)\tshall include in the 380 (Alternative Service) response:\na)\ta Content-Type header field with the value set to associated MIME type of the 3GPP IM CN subsystem XML body as described in subclause 7.6.1;\nb)\ta P-Asserted-Identity header field set to the value of the SIP  of the P-CSCF included in the Path header field during the registration of the user whose UE sent the request causing this response (see subclause 5.2.2.1); and\nc)\tif required by operator policy implementing national regulatory requirements, a Contact header field with an emergency service URN (i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69]). If a type of emergency service can be deduced from the Request- received from the UE and if required by operator policy implementing national regulatory requirements, the P-CSCF shall include in the emergency service URN a sub-service type deduced from the Request- received from the UE; and\nNOTE 1:\tIf the Request- identifies an emergency service with a type of emergency service, and the 380 (Alternative Service) response does not contain a Contact header field with an emergency service URN or contains a Contact header field with an emergency service URN which does not include a sub-service type, and if, upon reception of the response, the UE performs the emergency call attempt in the IM CN subsystem, then the emergency call attempt in the IM CN subsystem can be misrouted.\nIV)\tshall include an IM CN subsystem XML body with the following elements:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service;\ni)\ta <type> child element, set to \"emergency\" (see table 7.6.2) to indicate that it was an emergency call;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"emergency-registration\" (see table 7.6.3) if the P-CSCF is accordingly configured by the operator.\nNOTE 2:\tEmergency service URN in the request- indicates for the network that the emergency call attempt is recognized by the UE.\nNOTE 3:\tSome networks only allow session requests with a Request- containing an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69].\nUpon reception of a REGISTER request containing an \"sos\" SIP URI parameter in the Contact header field and containing an Authorization header field, if:\n1)\tthe network supports IMS Services for roaming users in deployments without IMS-level roaming interfaces;\n2)\trequired by operator policy;\n3)\tthe UE is roaming; and\n4)\tthere is no II-NNI to the HPLMN of the served user;\nNOTE 4:\tThe P-CSCF can determine whether the UE is roaming by analysing the home network domain name of the user received in the Request-URI in the REGISTER request.\nNOTE 5:\tThe P-CSCF can know if II-NNI to the HPLMN of the served user is supported by analysing the home network domain name of the user received in the Request-URI in the REGISTER request.\nor:\n1)\tif required by operator policy; and\n2)\tthe UE is not roaming;\nthe P-CSCF:\n1)\tif the P-CSCF supports GPRS-IMS-Bundled authentication, shall reject the request by returning a 420 (Bad Extension) response in which the Unsupported header field contains the value \"sec-agree\"; and\n2)\tif the P-CSCF does not support GPRS-IMS-Bundled authentication, shall reject the request by returning a 403 (Forbidden) response.\nWhen the P-CSCF responds 420 (Bad Extension) or 403 (Forbidden) response, if required by operator policy implementing national regulatory requirements (i.e., the network support an emergency session for an unregistered user as described in subclause 5.2.10.2), the P-CSCF shall include:\n1)\ta Content-Type header field with the value set to associated MIME type of the 3GPP IM CN subsystem XML body as described in subclause 7.6.1;\n2)\ta Content-Disposition header field with a disposition type \"render\" value and a \"handling\" header field parameter with an \"optional\" value, as described in RFC 3261 [26];\n3)\ta P-Asserted-Identity header field set to the value of the SIP  of the P-CSCF; and\n4)\ta 3GPP IM CN subsystem XML body containing:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service:\ni)\ta <type> child element, set to \"emergency\" (see table 7.6.2) to indicate that it was an emergency call;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"anonymous-emergencycall\" (see table 7.6.3) if the P-CSCF is accordingly configured by the operator.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.11\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.12\tResource sharing",
                            "text_content": "The P-CSCF supporting resource sharing shall perform the actions defined in access technology specific annexes.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.13\tPriority sharing",
                            "text_content": "The P-CSCF supporting priority sharing shall perform the actions defined in access technology specific annexes.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.14\tAccess update",
                            "text_content": "This subclause specifies procedures for the P-CSCF to inform the S-CSCF and any AS as applicable that the UE has changed access and possibly PLMN. This includes access update when the UE is not in a call and an in-call access update procedure when the access change happens when the UE is involved in an IMS session.\nIf the P-CSCF is aware that the UE has changed PLMN, and the P-CSCF has a policy to require a different encryption for the new PLMN than what the UE currently uses, the P-CSCF shall send a MESSAGE request towards the S-CSCF populated as follows:\n1)\tthe Request-URI set to the URI of the S-CSCF as received in the Service-Route header field during the registration of the served UE;\n2)\ta From header field set to the FQDN of the P-CSCF sending the request;\n3)\ta To header field, set to the same value as the Request-URI;\n4)\ta P-Asserted-Identity header field set to the default public user identity of the served user;\n5)\ta P-Charging-Vector header field with the \"icid-value\" header field parameter populated with the ICID value used for the dialog related to the access change and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter;\n6)\ta P-Access-Network-Info header field including network-provided location information;\n7)\ta P-Visited-Network-ID header field; and\n8)\tbased on network configuration a Handover-Info header field, defined in subclause 7.2.15, set to \"authentication-needed\";\nWhen the UE is in a call,if the P-CSCF supports the in-call access update procedure, has received the g.3gpp.in-call-access-update feature-capability indicator during session set-up, and determines that the UE has changed access or PLMN, then the P-CSCF shall generate a MESSAGE request populated as follows:\n1)\tthe Request URI set to the stored value of the g.3gpp.in-call-access-update feature-capability indicator;\n2)\ta From header field set to the FQDN of the P-CSCF sending the request;\n3)\ta To header field, set to the same value as the Request-URI;\n4)\ta P-Asserted-Identity header field set to the default public user identity of the served user;\n5)\ta P-Charging-Vector header field with the \"icid-value\" header field parameter populated with the ICID value used for the dialog related to the access change and a type 1 \"orig-ioi\" header field parameter. The P-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The P-CSCF shall not include the type 1 \"term-ioi\" header field parameter;\n6)\ta P-Access-Network-Info header field including network-provided location information;\n7)\ta P-Visited-Network-ID header field; and\n8)\tif the MESSAGE request is to be sent via the S-CSCF, a Route header field with the S-CSCF address as received in the Service-Route header field during registration.\nIf the procedure above leads to a re-authentication from the user and no encryption of the signalling is used, the P-CSCF shall after a successful re-authentication, i.e. on receipt of the 200 (OK) response to the REGISTER request, send a MESSAGE request populated as above and including a Handover-Info header field set to \"handover-completed\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3\tProcedures at the I-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.0\tGeneral",
                            "text_content": "When sending a failure response to any received request, depending on operator policy, the I-CSCF may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"i-cscf\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.1\tRegistration procedure",
                            "text_content": "During the registration procedure the I-CSCF shall behave as a stateful proxy.\nWhen the I-CSCF receives a REGISTER request, the I-CSCF shall verify whether or not it has arrived from a trusted domain. If the request has not arrived from a trusted domain, the I-CSCF shall complete the processing of the request by responding with 403 (Forbidden) response. Otherwise, the I-CSCF starts the user registration status query procedure to the HSS as specified in 3GPP TS 29.228 [14].\nNOTE 1:\tThe I-CSCF can find out whether the request arrived from a trusted domain or not, from the procedures described in 3GPP TS 33.210 [19A].\nNOTE 2:\tDifferent UEs, each with its own private user identity, can register the same shared public user identity. Registrations of all public user identities belonging to these UEs are directed to the same S-CSCF as described in 3GPP TS 29.228 [14].\nIf the REGISTER request does not include an Authorization header field and private user identity, the I-CSCF shall derive the private user identity from the public user identity being registered, contained in the To header field, by removing  scheme and the following parts of the  if present: port number,  parameters, and To header field parameters.\nPrior to performing the user registration query procedure to the HSS, the I-CSCF decides which HSS to query, possibly as a result of a query to the Subscription Locator Functional () entity as specified in 3GPP TS 29.228 [14]. As a result of the query the I-CSCF gets the Redirect-Host .\nIf the user registration status query response from the HSS includes a valid SIP , the I-CSCF shall:\n1)\treplace the Request- of the received REGISTER request with the SIP  received from the HSS in the Server-Name ;\n2)\toptionally include in the P-User-Database header field defined in RFC 4457 [82]:\na)\teither the received Redirect-Host  value; or\nb)\tthe HSS Group ID using the form \"aaa://hss.5gc.gid.<GID>.invalid\", if the HSS Group ID is received following procedures in clause X.3; and\n3)\tforward the REGISTER request to the indicated S-CSCF.\nNOTE 3:\tThe P-User-Database header field can be included only if the I-CSCF can assume (e.g. based on local configuration) that the receiving S-CSCF will be able to process the header field.\nIf the user registration status query response from the HSS includes a list of capabilities, the I-CSCF shall:\n1)\tselect a S-CSCF that fulfils the indicated mandatory capabilities – if more than one S-CSCFs fulfils the indicated mandatory capabilities the S-CSCF which fulfils most of the possibly additionally indicated optional capabilities;\n2)\treplace the Request- of the received REGISTER request with the  of the S-CSCF;\n3)\toptionally, include in the P-User-Database header field defined in RFC 4457 [82]:\na)\teither the received Redirect-Host  value; or\nb)\tthe HSS Group ID using the form \"aaa://hss.5gc.gid.<GID>.invalid\", if the HSS Group ID is received following procedures in clause X.3; and\n4)\tforward the REGISTER request to the selected S-CSCF.\nNOTE 4:\tThe P-User-Database header field can be included only if the I-CSCF can assume (e.g. based on local configuration) that the receiving S-CSCF will be able to process the header field.\nNOTE 5:\tIt is important that the I-CSCF does not alter the Via header field for requests and responses sent in the direction from the UE to the S-CSCF in the case of GPRS-IMS-Bundled authentication\nWhen the I-CSCF receives a 2xx response to a REGISTER request, the I-CSCF shall forward the 2xx response to the P-CSCF.\nIn the case of  query, if the  does not send HSS address to the I-CSCF, the I-CSCF shall send back a 403 (Forbidden) response to the UE.\nIf the HSS sends a negative response to the user registration status query request, the I-CSCF shall send back a 403 (Forbidden) response.\nIf the user registration status query procedure cannot be completed, e.g. due to time-out or incorrect information from the HSS, the I-CSCF shall send back a 480 (Temporarily Unavailable) response to the UE.\nIf a selected S-CSCF:\n-\tdoes not respond to the REGISTER request and its retransmissions by the I-CSCF; or\n-\tsends back a 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request;\nand:\n-\tthe REGISTER request did not include an \"integrity-protected\" header field parameter in the Authorization header field;\n-\tthe REGISTER request did include an \"integrity-protected\" header field parameter in the Authorization header field with a value set to \"no\" in the Authorization header field;\n-\tthe REGISTER request did include an \"integrity-protected\" header field parameter in the Authorization header field with a value set to other than \"no\" and the I-CSCF supports S-CSCF restoration procedures; or\n-\tthe REGISTER request did not include an Authorization header field and the I-CSCF supports S-CSCF restoration procedures;\nthen:\n-\tif the I-CSCF has received the list of capabilities from the HSS, the I-CSCF shall select a new S-CSCF as described in subclause 5.3.1.2, based on the capabilities indicated from the HSS. The newly selected S-CSCF shall not be one of any S-CSCFs selected previously during this same registration procedure; or\n-\tif the I-CSCF has received a valid SIP  from the HSS because the S-CSCF is already assigned to other UEs sharing the same public user identity, it will request the list of capabilities from the HSS and, on receiving these capabilities, the I-CSCF shall select a new S-CSCF as described in subclause 5.3.1.2, based on the capabilities indicated from the HSS. The newly selected S-CSCF shall not be one of any S-CSCFs selected previously during this same registration procedure.\nNOTE 1:\tChecking for the inclusion of the Authorization header field is necessary to prevent S-CSCF reselection in the case of GPRS-IMS-Bundled authentication or NASS-IMS bundled authentication when no Authorization header field is present in case I-CSCF does not support S-CSCF restoration procedures.\nNOTE 2:\tIn case the S-CSCF does not respond, the I-CSCF can apply a pre-configured timer based on local policy before re-selecting a new S-CSCF.\nWhen forwarding the REGISTER request to the new S-CSCF, the I-CSCF includes the SIP URI parameter \"scscf-reselection\" to the Request-URI of the REGISTER request.\nIf a selected S-CSCF does not respond to a REGISTER request and its retransmissions by the I-CSCF and none of the conditions specified above in this case are fulfilled, the I-CSCF shall send back a or 504 (Server Time-Out) response to the user, in accordance with the procedures in RFC 3261 [26].\nIf the I-CSCF cannot select a S-CSCF which fulfils the mandatory capabilities indicated by the HSS, the I-CSCF shall send back a 600 (Busy Everywhere) response to the user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.2\tInitial requests",
                            "text_content": "The I-CSCF may behave as a stateful proxy for initial requests.\nUpon receipt of a request, the I-CSCF shall perform the originating procedures as described in subclause 5.3.2.1A if the topmost Route header field of the request contains the \"orig\" parameter. Otherwise, the I-CSCF shall continue with the rest of the procedures of this subclause.\nWhen the I-CSCF receives a request, the I-CSCF shall verify whether it has arrived from a trusted domain or not. If the request has arrived from a non trusted domain, then the I-CSCF shall remove all P-Charging-Vector header fields and all P-Charging-Function-Addresses header fields the request may contain.\nNOTE 1:\tThe I-CSCF can find out whether the request arrived from a trusted domain or not, from the procedures described in 3GPP TS 33.210 [19A].\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe I-CSCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the I-CSCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE 2:\tThe special treatment can included filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nThe I-CSCF shall discard the P-Profile-Key header field, if the I-CSCF receives the P-Profile-Key header field in a SIP request or response.\nWhen the I-CSCF receives, destined for a served user or a PSI, an initial request for a dialog or standalone transaction the I-CSCF shall:\n1)\tif the Request- includes:\na)\ta pres: or an im: , then translate the pres: or im:  to a public user identity and replace the Request- of the incoming request with that public user identity; or\nb)\ta SIP- that is not a GRUU and with the user part starting with a + and the \"user\" SIP  parameter equals \"phone\" then replace the Request- with a tel- with the user part of the SIP- in the telephone-subscriber element in the tel-, and carry forward the tel- parameters that may be present in the Request-; or\nc)\ta SIP  that is a GRUU, then obtain the public user identity or an identity of the UE that represents the functionality within the UE that performs the role of registrar from the Request- and use it for location query procedure to the HSS. When forwarding the request, the I-CSCF shall not modify the Request- of the incoming request;\nNOTE 3:\t records have to be advertised in DNS pointing to the I-CSCF for pres: and im: queries.\n2)\tremove its own SIP  from the topmost Route header field, if present; and\n3)\tcheck if the domain name of the Request- matches with one of the PSI subdomains configured in the I-CSCF. If the match is successful, the I-CSCF resolves the Request- by an internal DNS mechanism into the IP address of the AS hosting the PSI and does not start the user location query procedure. Otherwise, the I-CSCF will start the user location query procedure to the HSS as specified in 3GPP TS 29.228 [14] for the called PSI or user, indicated in or derived from the Request-. Prior to performing the user location query procedure to the HSS, the I-CSCF decides which HSS to query, possibly as a result of a query to the Subscription Locator Functional () entity as specified in 3GPP TS 29.228 [14].\nWhen the I-CSCF receives any response to such a request, the I-CSCF shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present.\nNOTE 4:\tA received \"term-ioi\" header field parameter will be a type 3 IOI if received from an AS hosting a PSI or a type 2 IOI if received from the S-CSCF of the served user. The type 3 IOI identifies the service provider from which the response was sent and the type 2 IOI identifies the network from which the response was sent.\nWhen the I-CSCF receives an INVITE request, the I-CSCF may require the periodic refreshment of the session to avoid hung states in the I-CSCF. If the I-CSCF requires the session to be refreshed, then the I-CSCF shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 5:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nIn case the I-CSCF is able to resolve the Request- into the IP address of the AS hosting the PSI, then the I-CSCF shall:\n1)\tstore the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and retain the \"icid-value\" header field parameter in the P-Charging-Vector header field. If no P-Charging-Vector header field was found, then insert the P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17]. The I-CSCF shall insert a type 3 \"orig-ioi\" header field parameter in place of any received \"orig-ioi\" header field parameter. The I-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The I-CSCF shall not include the type 3 \"term-ioi\" header field parameter. Based on local policy, the I-CSCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier; and\n2)\tforward the request directly to the AS hosting the PSI.\nUpon successful user location query, when the response contains the  of the assigned S-CSCF, or the  of an AS hosting the PSI, the I-CSCF shall:\n1)\tinsert the  received from the HSS as the topmost Route header field;\n2)\tstore the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and retain the P-Charging-Vector header field in the P-Charging-Vector header field. If no \"icid-value\" header field parameter was found, then insert the P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17];\n2A)\tbased on local policy, add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier;\n3)\toptionally, include in the P-User-Database header field defined in RFC 4457 [82]:\na)\teither the received Redirect-Host  value; or\nb)\tthe HSS Group ID using the form \"aaa://hss.5gc.gid.<GID>.invalid\", if the HSS Group ID is received following procedures in clause X.3;\n3A)\tif the Wildcarded Identity value is received from the HSS in the Wildcarded-Identity  and the I-CSCF supports the SIP P-Profile-Key private header extension, include the wildcarded identity value in the P-Profile-Key header field defined in RFC 5002 [97]; and\n4)\tforward the request based on the topmost Route header field.\nNOTE 6:\tThe P-User-Database header field can be included only if the I-CSCF can assume (e.g. based on local configuration) that the receiving S-CSCF will be able to process the header field.\nUpon successful user location query, when the response contains information about the required S-CSCF capabilities, the I-CSCF shall:\n1)\tif overlap signalling using the multiple-INVITEs method is supported as a network option, and if the I-CSCF receives an INVITE request outside an existing dialog with the same Call ID and From header as a previous INVITE request during a certain period of time, route the new INVITE to the same next hop as the previous INVITE request; otherwise\n2)\tselect a S-CSCF according to the method described in 3GPP TS 29.228 [14];\n3)\tinsert the  of the selected S-CSCF as the topmost Route header field value;\n4)\texecute the procedure described in step 2 and 3 in the above paragraph (upon successful user location query, when the response contains the  of the assigned S-CSCF);\n5)\toptionally, include in the P-User-Database header field defined in RFC 4457 [82]:\na)\teither the received Redirect-Host  value; or\nb)\tthe HSS Group ID using the form \"aaa://hss.5gc.gid.<GID>.invalid\", if the HSS Group ID is received following procedures in clause X.3;\n6)\tif the Wildcarded Identity value is received from the HSS in the Wildcarded-Identity  and the I-CSCF supports the SIP P-Profile-Key private header extension, include the wildcarded identity value in the P-Profile-Key header field as defined in RFC 5002 [97]; and\nNOTE 7:\tA Wildcarded Identity can be either a PSI or a public user identity.\n7)\tforward the request to the selected S-CSCF.\nNOTE 8:\tThe P-User-Database header field can be included only if the I-CSCF can assume (e.g. based on local configuration) that the receiving S-CSCF will be able to process the header field.\nUpon an unsuccessful user location query when the response from the HSS indicates that the user does not exist, and if the Request- is a tel  containing a public telecommunications number as specified in RFC 3966 [22], the I-CSCF may support a local configuration option that indicates whether or not request routeing is to be attempted. If the local configuration option indicates that request routeing is to be attempted, then the I-CSCF shall perform one of the following procedures based on local operator policy:\n1)\tforward the request to the transit functionality for subsequent routeing; or\n2)\tinvoke the portion of the transit functionality that translates the public telecommunications number contained in the Request- to a routeable SIP , and process the request based on the result, as follows:\na)\tif the translation fails, the request may be forwarded to a BGCF or any other appropriate entity (e.g. a MRFC to play an announcement) in the home network, or the I-CSCF may send an appropriate SIP response to the originator, such as 404 (Not Found) or 604 (Does not exist anywhere). When forwarding the request to a BGCF or any other appropriate entity, the I-CSCF shall leave the original Request- containing the tel  unmodified:\ni)\tif overlap signalling using the multiple-INVITEs method is supported as a network option, and if the I-CSCF receives an INVITE request outside an existing dialog with the same Call ID and From header as a previous INVITE request during a certain period of time, the I-CSCF shall route the new INVITE to the same next hop as the previous INVITE request; and\nii)\tadditional procedures apply if the I-CSCF supports NP capabilities and these capabilities are enabled by local policy, and the database used for translation from an international public telecommunications number to a SIP  also provides NP data (for example, based on the PSTN Enumservice as defined by RFC 4769 [114] or other appropriate data bases). If the above translation from an international public telecommunications number to a SIP  failed, but NP data was obtained from the database, then the I-CSCF shall replace the tel- in the Request- with the obtained NP data, prior to forwarding the request to the BGCF or other appropriate entity. The  is updated by the I-CSCF by adding the NP parameters defined by RFC 4694 [112] to the tel- in the Request-: an \"npdi\" tel- parameter is added to indicate that NP data retrieval has been performed, and if the number is ported, an \"rn\" tel- parameter is added to identify the ported-to routeing number. The I-CSCF shall perform these procedures if the tel- in the received Request- does not contain an \"npdi\" tel- parameter. In addition, the I-CSCF may, based on local policy, perform these procedures when the tel- in the received Request- contains an \"npdi\" tel- parameter indicating that the NP data has been previously obtained; or\nNOTE 9: The I-CSCF might need to replace NP data added by a previous network if the previous network's NP database did not contain the local ported data for the called number. When the I-CSCF replaces the tel  in the Request- with the obtained NP data, all tel  parameters in the received Request- will be replaced by the obtained NP data.\nb)\tif this translation succeeds, then replace the Request- with the routeable SIP  and process the request as follows:\n-\tdetermine the destination address (e.g. DNS access) using the  placed in the topmost Route header field if present, otherwise based on the Request-. If the destination requires interconnect functionalities (e.g. the destination address is of an IP address type other than the IP address type used in the IM CN subsystem), the I-CSCF shall:\ni)\tif the I-CSCF supports indicating the traffic leg as specified in RFC 7549 [225] and required by local policy, append the \"iotl\" SIP  parameter set to \"homeA-homeB\" to the Request-; and\nii)\tforward the request to the destination address via an IBCF in the same network;\n-\tif network hiding is needed due to local policy, put the address of the IBCF to the topmost Route header field;\n-\troute the request based on SIP routeing procedures; and\n-\tif overlap signalling using the multiple-INVITE method is supported as a network option, and if the I-CSCF receives an INVITE request outside an existing dialog with the same Call ID and From header as a previous INVITE request during a certain period of time, route the new INVITE to the same next hop as the previous INVITE request.\nUpon an unsuccessful user location query when the response from the HSS indicates that the user does not exist, and if local operator policy does not indicate that request routeing is to be attempted, then, the I-CSCF shall return an appropriate unsuccessful SIP response. Upon an unsuccessful user location query when the response from the HSS indicates that the user does not exist, and if if the Request- is a SIP , the I-CSCF shall also return an appropriate unsuccessful SIP response. This response may be a 404 (Not found) or 604 (Does not exist anywhere) in the case the user is not a user of the home network.\nUpon an unsuccessful user location query when the response from the HSS indicates that the user is not registered and no services are provided for such a user, the I-CSCF shall return an appropriate unsuccessful SIP response. This response may be a 480 (Temporarily unavailable) response if the user is recognized as a valid user, but is not registered at the moment and it does not have services for unregistered users.\nWhen the I-CSCF receives an initial request for a dialog or standalone transaction, that contains a single Route header field pointing to itself, the I-CSCF shall determine from the entry in the Route header field whether it needs to do HSS query. In case HSS query not is needed, then the I-CSCF shall:\n1)\tremove its own SIP  from the topmost Route header field; and\n2)\troute the request based on the Request-.\nWhen the I-CSCF receives an initial request for a dialog or standalone transaction containing more than one Route header field, the I-CSCF shall:\n1)\tremove its own SIP  from the topmost Route header field; and\n2)\tforward the request based on the topmost Route header field.\nNOTE 10:\tIn accordance with SIP the I-CSCF can add its own routeable SIP  to the top of the Record-Route header field to any request, independently of whether it is an initial request. The P-CSCF will ignore any Record-Route header field that is not in the initial request of a dialog.\nWhen the I-CSCF receives a response to an initial request (e.g. 183 (Session Progress) response or 2xx response), the I-CSCF shall store the values from the P-Charging-Function-Addresses header field, if present. If the next hop is outside of the current network, then the I-CSCF shall remove the P-Charging-Function-Addresses header field prior to forwarding the message.\nWhen the I-CSCF receives any response to the initial request for a dialog or standalone transaction containing a \"term-ioi\" header field parameter in the P-Charging-Vector header field from the AS hosting the PSI, the I-CSCF shall:\n1)\tremove all received \"orig-ioi\" and \"term-ioi\" header field parameters from the forwarded response;\n2)\tinsert the stored \"orig-ioi\" header field parameter if received in the request; and\n3)\tinsert a type 2 \"term-ioi\" header field parameter. The \"term-ioi\" header field parameter is set to a value that identifies the sending network of the response.\nWhen the I-CSCF, upon sending an initial INVITE request to the S-CSCF, receives a 305 (Use Proxy) response from the S-CSCF, the I-CSCF shall forward the initial INVITE request to the SIP  indicated in the Contact field of the 305 (Use Proxy) response, as specified in RFC 3261 [26].\nThe procedures of this subclause apply for requests received at the I-CSCF when the topmost Route header field of the request contains the \"orig\" parameter.\nThe I-CSCF shall verify for all requests whether they arrived from a trusted domain or not. If the request arrived from a non trusted domain, then the I-CSCF shall respond with 403 (Forbidden) response.\nIf the request arrived from a trusted domain, the I-CSCF shall perform the procedures below.\nNOTE 1:\tThe I-CSCF can find out whether the request arrived from a trusted domain or not, from the procedures described in 3GPP TS 33.210 [19A].\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe I-CSCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the I-CSCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE 2\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nIf the I-CSCF receives the P-Profile-Key header field in a SIP request or response the I-CSCF shall discard the P-Profile-Key header field.\nWhen the I-CSCF receives an initial request for a dialog or standalone transaction the I-CSCF will start the user location query procedure to the HSS as specified in 3GPP TS 29.228 [14] for the calling user, indicated in either:\n1)\tthe P-Served-User header field, if included in the request; or\n2)\tthe P-Asserted-Identity header field, if the P-Served-User header field is not included in the request.\nPrior to performing the user location query procedure to the HSS, the I-CSCF decides which HSS to query, possibly as a result of a query to the Subscription Locator Functional () entity as specified in 3GPP TS 29.228 [14].\nWhen the I-CSCF receives an INVITE request, the I-CSCF may require the periodic refreshment of the session to avoid hung states in the I-CSCF. If the I-CSCF requires the session to be refreshed, the I-CSCF shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 3:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nWhen the response for user location query contains information about the required S-CSCF capabilities, the I-CSCF shall select a S-CSCF according to the method described in 3GPP TS 29.228 [14].\nIf the user location query was successful, the I-CSCF shall:\n1)\tinsert the  of an AS hosting the PSI, or the  of the S-CSCF - either received from the HSS, or selected by the I-CSCF based on capabilities - as the topmost Route header field appending the \"orig\" parameter to the  of the S-CSCF;\n2)\tstore the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and retain the \"icid-value\" header field parameter in the P-Charging-Vector header field. If no P-Charging-Vector header field was found, then insert the P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17];\n2A)\tbased on local policy, add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier;\n3)\toptionally, include in the P-User-Database header field defined in RFC 4457 [82]:\na)\teither the received Redirect-Host  value; or\nb)\tthe HSS Group ID using the form \"aaa://hss.5gc.gid.<GID>.invalid\", if the HSS Group ID is received following procedures in clause X.3;\n4)\tif a wildcarded identity value is received from the HSS in the Wildcarded-Identity  and the I-CSCF supports the SIP P-Profile-Key private header extension, include the wildcarded public user identity value in the P-Profile-Key header field as defined in RFC 5002 [97]; and\n5)\tforward the request based on the topmost Route header field.\nNOTE 4:\tThe P-User-Database header field can be included only if the I-CSCF can assume (e.g. based on local configuration) that the receiving S-CSCF will be able to process the header field.\nUpon an unsuccessful user location query, the I-CSCF shall return an appropriate unsuccessful SIP response. This response may be a 404 (Not found) response or 604 (Does not exist anywhere) response in the case the user is not a user of the home network.\nWhen the I-CSCF receives any response to the above request, and forwards it to AS, the I-CSCF shall:\n-\tstore the values from the P-Charging-Function-Addresses header field, if present. If the next hop is outside of the current network, then the I-CSCF shall remove the P-Charging-Function-Addresses header field prior to forwarding the message; and\n-\tinsert a P-Charging-Vector header field containing the type 3 \"orig-ioi\" header field parameter, if received in the request, and a type 3 \"term-ioi\" header field parameter in the response. The I-CSCF shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the sending network of the response and the type 3 \"orig-ioi\" header field parameter is set to the previously received value of type 3 \"orig-ioi\" header field parameter.\nIn the case of  query, if the  does not send HSS address to the I-CSCF, the I-CSCF shall send back a 404 (Not Found) response to the UE.\nUpon successful user location query, when the response contains the  of the assigned S-CSCF, if the I-CSCF is unable to contact the assigned S-CSCF, as determined by one of the following:\n-\tthe S-CSCF does not respond to the service request and its retransmissions by the I-CSCF; or\n-\tby unspecified means available to the I-CSCF;\nand:\n-\tthe I-CSCF supports S-CSCF restoration procedures;\nthen:\n-\tthe I-CSCF shall explicitly request the list of capabilities from the HSS and, on receiving these capabilities, the I-CSCF shall select a new S-CSCF, based on the capabilities indicated from the HSS. The newly selected S-CSCF shall not be one of any S-CSCFs selected previously during this same terminating procedure. Re-selection shall be performed until SIP transaction timer expires as specified in RFC 3261 [26]. When forwarding the request to the new S-CSCF, the I-CSCF includes the SIP URI parameter \"scscf-reselection\" to the Request-URI of the request.\n\nNOTE 1:\tThese procedures do not prevent the usage of unspecified reliability or recovery techniques above and beyond those specified in this subclause.\nUpon successful user location query, when the response contains information about the required S-CSCF capabilities, if the I-CSCF is unable to contact a selected S-CSCF, as determined by one of the following:\n-\tthe S-CSCF does not respond to the service request and its retransmissions by the I-CSCF; or\n-\tby unspecified means available to the I-CSCF;\nthen:\n-\tthe I-CSCF shall select a new S-CSCF, based on the capabilities indicated from the HSS. The newly selected S-CSCF shall not be one of any S-CSCFs selected previously during this same terminating procedure. Re-selection shall be performed until SIP transaction timer expires as specified in RFC 3261 [26]. When forwarding the request to the new S-CSCF, the I-CSCF includes the SIP URI parameter \"scscf-reselection\" to the Request-URI of the request.\nNOTE 2:\tThese procedures do not prevent the usage of unspecified reliability or recovery techniques above and beyond those specified in this subclause.\nIf the I-CSCF receives a negative response to the user location query, the I-CSCF shall send back a 404 (Not Found) response.\nIf the I-CSCF receives a CANCEL request and if the I-CSCF finds an internal state indicating a pending Cx transaction with the HSS, the I-CSCF:\n-\tshall answer the CANCEL request with a 200 (OK) response; and\n-\tshall answer the original request with a 487 (Request Terminated) response.\nNOTE 3:\tThe I-CSCF will discard any later arriving (pending) Cx answer message from the HSS.\nWith the exception of 305 (Use Proxy) response, the I-CSCF may recurse on a 3xx response only when the domain part of the  contained in the 3xx response is in the same domain as the I-CSCF. For the same cases, if the  is an IP address, the I-CSCF shall only recurse if the IP address is known locally to be a address that represents the same domain as the I-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.5\tSubsequent requests",
                            "text_content": "When the I-CSCF receives a subsequent request, the I-CSCF shall verify whether it has arrived from an entity within the trust domain or not. If the request has not arrived from an entity within the trust domain, then the I-CSCF shall remove all P-Charging-Vector header fields, if present.\nIf no P-Charging-Vector header field was found in the received subsequent request, then insert the P-Charging-Vector header field with the \"icid-value\" header field parameter set to the value populated in the initial request for the dialog.\nWhen the I-CSCF receives any response to the subsequent request, the I-CSCF shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present.\nWhen the I-CSCF receives a subsequent request directly forwarded to the AS hosting the PSI, the I-CSCF shall insert a type 3 \"orig-ioi\" header field parameter in place of any received \"orig-ioi\" header field parameter, if the received request including a P-Charging-Vector header field. The I-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The I-CSCF shall not include the type 3 \"term-ioi\" header field parameter.\nWhen the I-CSCF receives any response to the subsequent request from the AS hosting the PSI, if the received response containing a \"term-ioi\" header field parameter in the P-Charging-Vector header field, the I-CSCF shall:\n1)\tremove all received \"orig-ioi\" and \"term-ioi\" header field parameters from the forwarded response;\n2)\tinsert the stored \"orig-ioi\" header field parameter if received in the request; and\n3)\tinsert a type 2 \"term-ioi\" header field parameter. The \"term-ioi\" header field parameter is set to a value that identifies the sending network of the response.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.4\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.4.0\tGeneral",
                            "text_content": "Where the S-CSCF provides emergency call support, the procedures of subclause 5.4.8 shall be applied first.\nUpon\n1)\ta third-party registration due to initial registration on behalf of a served public user identity; or\n2)\ta trigger to an AS for an unregistered public user identity and there is no IP address of that AS associated with that public user identity stored;\nthe S-CSCF shall store the IP address of the AS and associate the IP address with the public user identity and the AS SIP URI along with all URI parameters.\nWhen sending a failure response to any received request, depending on operator policy, the S-CSCF may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"s-cscf\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17. A S-CSCF when sending a failure response will add in the URN the \"side\" header field parameter set to:\n-\t\"orig\" for a UE-originating case; and\n-\t\"term\" for a UE-terminating case.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.1\tRegistration and authentication",
                            "text_content": "The S-CSCF shall determine which authentication mechanism applies based on the contents of the REGISTER request and the authentication mechanism assigned in the HSS:\n1)\tif the REGISTER request contains an Authorization header field with the \"integrity-protected\" header field parameter set to \"no\", the S-CSCF shall perform the initial registration procedures with IMS-AKA authentication described in subclauses 5.4.1.2.1 and 5.4.1.2.1A;\n2)\tif the REGISTER request contains an Authorization header field with the \"integrity-protected\" header field parameter set to \"yes\", the S-CSCF shall perform the protected registration procedures with IMS-AKA as a security mechanism as described in subclause 5.4.1.2.2;\n2A)\tif the REGISTER request contains an Authorization header field with the \"integrity-protected\" header field parameter set to \"tls-connected\" and with the \"algorithm\" header field parameter set to \"AKAv2-SHA-256\", and if the S-CSCF supports the IMS AKA using HTTP Digest AKAv2 without IPSec security association, the S-CSCF shall perform:\na)\tif the REGISTER request does not contain an authentication challenge response, the initial registration procedures for IMS-AKA authentication described in subclauses 5.4.1.2.1 and 5.4.1.2.1A; or\nb)\tif the REGISTER request contains an authentication challenge response, the protected registration procedures with IMS-AKA as a security mechanism as described in subclause 5.4.1.2.2;\nNOTE 1:\t3GPP TS 33.203 [19] defines support of IMS AKA using http Digest AKAv2 without IPSec security association only for WebRTC.\n3)\tif the REGISTER request does not contain an Authorization header field, then the S-CSCF shall identify the user by the public user identity as received in the To header field of the REGISTER request. The S-CSCF shall derive the private user identity from the public user identity being registered. The S-CSCF shall derive the private user identity by removing SIP  scheme and the following parts of the SIP  if present: port number,  parameters, and To header field parameters or by alternative mechanisms to derive the private user identity if operator policy requires to do so. These alternative mechanisms are not defined in this version of the specification;\n4)\tif the REGISTER request does not contain an Authorization header field and the access-type field in the P-Access-Network-Info header field indicated xDSL, Ethernet, or Fiber access, and containing the \"network provided\" header field parameter and the S-CSCF supports NASS-IMS-bundled authentication but does not support SIP digest, then the S-CSCF shall perform the initial registration procedures with NASS-IMS bundled authentication as a security mechanism as described in subclause .2.1D;\n5)\tif the REGISTER request does not contain an Authorization header field and the access-type field in the P-Access-Network-Info header field indicates it is received from an IP-CAN different from 3GPP and containing the \"network provided\" header field parameter and the S-CSCF supports SIP digest but does not support NASS-IMS-bundled authentication, then the S-CSCF shall perform the initial registration procedures with SIP digest as a security mechanism as described in subclauses .2.1 and 5.4.1.2.1B;\n6)\tif the REGISTER request does not contain an Authorization header field and there is no P-Access-Network-Info header field containing the \"network provided\" field or there is a P-Access-Network-Info header field indicating a 3GPP access network containing the \"network provided\", and the S-CSCF supports GPRS-IMS-Bundled authentication, the S-CSCF shall perform the initial registration procedures with GPRS-IMS-Bundled authentication described in subclause 5.4.1.2.1E;\n7)\tif the REGISTER request does not contain an Authorization header field, and the P-Access-Network-Info header field indicates it is received from an access network other than 3GPP, xDSL, Ethernet or Fiber and containing the \"network provided\" header field parameter, and the S-CSCF supports SIP digest and NASS-IMS bundled authentication, the S-CSCF shall perform the initial registration procedures with SIP digest as a security mechanism as described in subclauses .2.1 and 5.4.1.2.1B:\n8)\tif the REGISTER request does not contain an Authorization header field, and the P-Access-Network-Info header field indicates it is received from a xDSL, Ethernet or Fiber access network, and containing the \"network provided\" header field parameter, and the S-CSCF supports SIP digest and NASS-IMS bundled authentication, the S-CSCF sends an authentication request for the user to the HSS indicating that the authentication scheme is unknown as described in 3GPP TS 29.228 [14]:\n-\tif the HSS responds with an authentication scheme of SIP digest, then the S-CSCF shall perform the initial registration procedures with SIP digest as a security mechanism as described in subclauses 5.4.1.2.1 and 5.4.1.2.1B; or\n-\tif the HSS responds with an authentication scheme of NASS-IMS bundled authentication and the request was received from a P-CSCF in the home network and the P-CSCF is \"TISPAN-enabled\", then the S-CSCF shall perform the initial registration procedures with NASS-IMS bundled authentication as a security mechanism as described in subclause 5.4.1.2.1D;\n9)\tif the REGISTER request contains an Authorization header field without an \"integrity-protected\" header field parameter, the S-CSCF shall send an authentication request for the user to the HSS indicating that the authentication scheme is unknown as described in 3GPP TS 29.228 [14]:\n-\tif the HSS responds with an authentication scheme of NASS-IMS bundled authentication and the request was received from a P-CSCF is in the home network and the P-CSCF is \"TISPAN-enabled\", then the S-CSCF shall perform the initial registration procedures with NASS-IMS bundled authentication as a security mechanism as described in subclause 5.4.1.2.1D; or\n-\tif the HSS responds with an authentication scheme of SIP digest, then the S-CSCF shall perform the initial registration procedures with SIP digest as a security mechanism as described in subclauses 5.4.1.2.1 and 5.4.1.2.1B;\n10)\tif the REGISTER request contains an Authorization header field with the \"integrity-protected\" header field parameter set to \"tls-pending\", \"tls-yes\", \"ip-assoc-pending\" or \"ip-assoc-yes\", the S-CSCF shall perform the protected registration procedures for SIP digest described in subclause 5.4.1.2.2A;\n11)\tif the REGISTER request contains an Authorization header field with the \"integrity-protected\" header field parameter set to \"auth-done\", the S-CSCF shall perform the protected registration procedures described in subclause 5.4.1.2.2E; and\n12)\tif the REGISTER request contains a JSON Web Token with the \"3gpp-waf\" JSON Web Token claim or with the \"3gpp-wwsf\" JSON Web Token claim, as defined in RFC 7519 [235], and if the S-CSCF supports WebRTC, and if the S-CSCF has received authorization information about WAF or WWSF entities from the HSS, or per configuration, then the S-CSCF shall check whether the WAF or WWSF is not barred, as specified in 3GPP TS 33.203 [9] annex X. If the WAF or the WWSF is barred, the S-CSCF shall send a 403 (Forbidden) response to the REGISTER request.\nNOTE 2:\tThe S-CSCF needs to be configured to know which P-CSCFs are \"TISPAN-enabled\" and uses the Via header field to determine which P-CSCF forwarded the registration request.\nThe S-CSCF shall act as the SIP registrar for all UEs belonging to the IM CN subsystem and with public user identities.\nSubclause 5.4.1.2 through subclause 5.4.1.7 define S-CSCF procedures for SIP registration that do not relate to emergency. All registration requests are first screened according to the procedures of subclause 5.4.8.2 to see if they do relate to an emergency registration.\nFor all SIP registrations identified:\n-\tas relating to an emergency; or\n-\tif priority is supported, as containing an authorised Resource-Priority header field;\nthe S-CSCF shall give priority over other registrations. This allows special treatment of such registrations.\nNOTE 3:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nThe S-CSCF shall support the use of the Path and Service-Route header field. The S-CSCF shall also support the Require and Supported header fields. The Path header field is only applicable to the REGISTER request and its 200 (OK) response. The Service-Route header field is only applicable to the 200 (OK) response of REGISTER. The S-CSCF shall not act as a redirect server for REGISTER requests.\nThe network operator defines minimum and maximum times for each registration. These values are provided within the S-CSCF.\nThe procedures for notification concerning automatically registered public user identities of a user are described in subclause 5.4.2.1.2.\nIf the S-CSCF supports HSS based P-CSCF restoration procedures, and receives a REGISTER request from a P-CSCF that the S-CSCF considers is in a non-working state, the S-CSCF shall consider this P-CSCF as being in a working state.\nIf the S-CSCF supports PCRF based P-CSCF restoration procedures, and receives a REGISTER request from a P-CSCF that the S-CSCF considers is in a non-working state, the S-CSCF shall consider this P-CSCF as being in a working state.\nIn case a device performing address and/or port number conversions is provided by a (P)T or (P)T-PT, the S-CSCF may need to modify the SIP signalling according to the procedures described in annex K if both a \"reg-id\" and \"+sip.instance\" header field parameter are present in the received Contact header field as described in RFC 5626 [92].\nAny REGISTER request received unprotected by the S-CSCF without an Authorization header field, or with an Authorization header field having the \"integrity-protected\" header field parameter in the Authorization header field set to \"no\", or without an \"integrity-protected\" header field parameter is considered to be an initial registration. If such an initial registration contains a private user identity specifically reserved for IM CN subsystem registrations from an  Server enhanced for ICS as defined in 3GPP TS 23.003 [3], the S-CSCF shall respond with a 403 (Forbidden) response. The S-CSCF shall consider this registration attempt as failed.\nNOTE 1:\tFor NASS-IMS bundled authentication and GPRS-IMS-Bundled Authentication there is no distinction between a protected and an unprotected REGISTER. There is only an unprotected REGISTER to consider.\nNOTE 2:\tIf IMS AKA or SIP digest with  are used as a security mechanism, a 200 (OK) final response to an initial registration will only be sent back after the S-CSCF receives a correct authentication challenge response in a REGISTER request that is sent integrity protected.\nNOTE 3:\tA REGISTER with the registration expiration interval value equal to zero will always be received protected. However, it is possible that in error conditions a REGISTER with the registration expiration interval value equal to zero can be received unprotected. In that instance the procedures below will be applied.\nUpon receipt of a REGISTER request that is part of an initial registration as outlined above, for a public user identity for which the maximum number of allowed simultaneously registration flows for the used UE (i.e. linked to the same private user identity and instance ID) is reached, if the REGISTER is adding a new registration flow, then the S-CSCF shall reject the REGISTER by generating a 403 (Forbidden) response. If not, the S-CSCF shall continue with the rest of the procedures of this subclause.\nUpon receipt of a REGISTER request that is part of an initial registration as outlined above, for a user identity linked to a private user identity and instance ID/reg-id if available, that has previously registered one or more public user identities, the S-CSCF shall:\n1)\tperform the procedure below in this subclause for receipt of a REGISTER request for a public user identity which is not already registered, for the received public user identity;\n2)\tif the multiple registrations is not used and if the authentication that in step 1) has been successful, and there are public user identities (including the public user identity being registered, if previously registered) that belong to this user that have been previously registered with the same private user identity, and with an old contact address different from the one received in the REGISTER request, and the previous registrations have not expired, perform the network-initiated deregistration procedure (as described in subclause 5.4.1.5) for the previously registered public user identities belonging to this user including the public user identity being registered, if previously registered; and\n3)\tif the multiple registrations is used (i.e., the \"reg-id\" header field parameter is included in the REGISTER request), and if the authentication that concludes the initial registration has been successful, and if the public user identity being registered has been previously registered with the same private user identity and the same \"+sip.instance\" and \"reg-id\" header field parameter values, and the previous registration has not expired:\na)\tidentify the registration flow being replaced;\nb)\tterminate any dialog, as specified in subclause 5.4.5.1.2, with a status code 480 (Temporarily Unavailable) in the Reason header field of the BYE request, associated with the registration flow being replaced; and\nc)\tsend a NOTIFY request to the subscribers to the registration event package for the public user identity indicated in the REGISTER request, as described in subclause 5.4.2.1.2.\nNOTE 4:\tThe way the S-CSCF identifies the dialogs associated with the registration flow being replaced is implementation specific.\nNOTE 5:\tThe S-CSCF will inform the HSS that the previously registered public user identities, excluding the public user identity being registered, have been deregistered.\nNOTE 6:\tContact related to emergency registration is not affected. S-CSCF is not able deregister contact related to emergency registration and will not delete that.\nWhen S-CSCF receives a REGISTER request with the \"integrity-protected\" header field parameter in the Authorization header field set to \"no\" and a non-empty \"response\" Authorization header field parameter, the S-CSCF shall ignore the value of the \"response\" header field parameter.\nUpon receipt of a REGISTER request that is part of an initial registration as outlined above, for a public user identity which is not already registered linked to the same private user identity and the \"+sip.instance\" and \"reg-id\" header field parameters, if available, the S-CSCF shall:\n1)\tidentify the user by the public user identity as received in the To header field and if the REGISTER request includes an Authorization header field, identify the private user identity as received in the \"username\" Authorization header field parameter of the REGISTER request;\n2)\tcheck if the P-Visited-Network-ID header field is included in the REGISTER request, and if it is included identify the visited network by the value of this header field;\n3)\tselect an authentication vector for the user. If no authentication vector for this user is available, after the S-CSCF has performed the Authentication procedure with the HSS, as described in 3GPP TS 29.228 [14], the S-CSCF shall select an authentication vector as described in 3GPP TS 33.203 [19].\nPrior to performing Authentication procedure with the HSS, the S-CSCF decides which HSS to query, possibly as a result of a query to the Subscription Locator Functional () entity as specified in 3GPP TS 29.228 [14] or use the value as received in the P-User-Database header field in the REGISTER request as defined in RFC 4457 [82];\nNOTE 7:\tThe HSS address received in the response to  query or as a value of P-User-Database header field can be used to address the HSS of the public user identity in further queries.\nNOTE 8:\tAt this point the S-CSCF informs the HSS, that the user currently registering will be served by the S-CSCF by passing its SIP  to the HSS. This will be used by the HSS to direct all subsequent incoming initial requests for a dialog or standalone transactions destined for this user to this S-CSCF.\nNOTE 9:\tWhen passing its SIP  to the HSS, the S-CSCF may include in its SIP  the transport protocol and the port number where it wants to be contacted.\n4)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n5)\tchallenge the user by generating a 401 (Unauthorized) response for the received REGISTER request appropriate to the security mechanism in use;\n6)\tsend the so generated 401 (Unauthorized) response towards the UE, and if the  in the first Path header field has an \"ob\" SIP  parameter, include a Require header field with the option-tag \"outbound\" as described in RFC 5626 [92]; and\n7)\tstart timer reg-await-auth which guards the receipt of the next REGISTER request.\nIf the received REGISTER request indicates that the challenge sent previously by the S-CSCF to the UE was deemed to be invalid by the UE, the S-CSCF shall stop the timer reg-await-auth and proceed as described in the subclause 5.4.1.2.3.\nOn sending a 401 (Unauthorized) response to an unprotected REGISTER request, the S-CSCF shall populate the header fields as follows:\n1)\ta -Authenticate header field which transports:\na)\ta globally unique name of the S-CSCF in the \"realm\" header field parameter;\nb)\tthe  and  parameters and optional server specific data for the UE in the \"nonce\" header field parameter;\nc)\tif the REGISTER request contains an Authorization header field with an \"integrity-protected\" header field parameter set to the value \"no\":\n-\tthe security mechanism, in the \"algorithm\" header field parameter set to the value as received in the Authorization header field i.e. \"AKAv2-SHA-256\" or \"AKAv1-MD5\";\nNOTE:\tThe \"AKAv1-MD5\" algorithm is only supported for backward compatibility.\n-\tthe IK (Integrity Key) parameter for the P-CSCF in the \"ik\" header field parameter (see subclause 7.2A.1); and\n-\tthe CK (Cipher Key) parameter for the P-CSCF in the \"ck\" header field parameter (see subclause 7.2A.1); and\nd)\tif the REGISTER request does contain an Authorization header field with the \"algorithm\" header field parameter set to \"AKAv2-SHA-256\", and if the S-CSCF supports the IMS AKA using HTTP Digest AKAv2 without IPSec security association:\n-\tthe security mechanism, which is \"AKAv2-SHA-256\" in the \"algorithm\" header field parameter.\nThe S-CSCF shall store the  parameter used in the 401 (Unathorized) response for future use in case of a resynchronisation. If a stored  already exists in the S-CSCF, the S-CSCF shall overwrite the stored  with the  used in the most recent 401 (Unauthorized) response.\nOn sending a 401 (Unauthorized) response to an unprotected REGISTER request, the S-CSCF shall populate the header fields as follows:\n1)\tfor each supported digest algorithm the S-CSCF shall create a -Authenticate header field as defined in RFC 7616 [286] and RFC 8760 [287], which transports:\n-\ta protection domain in the \"realm\" header field parameter;\n-\ta \"nonce\" header field parameter (generated by the S-CSCF);\n-\tan \"algorithm\" header field parameter; and\n-\ta \"qop\" header field parameter; if the qop value is not provided in the authentication vector, it shall contain the value \"auth\".\nThe S-CSCF shall include the WWW-Authenticate header fields to the 401 (Unauthorized) response in order of preference, starting with the most preferred algorithm.\nThe procedures for subclause 5.4.1.2.1B apply.\nNOTE:\tThe S-CSCF is not able to distinguish between SIP Digest with  and SIP Digest without  for the case of an unprotected REGISTER request, therefore the procedures are the same for both.\nUpon receipt of a REGISTER request that is determined to be NASS-IMS bundled authentication, for a user identity linked to a private user identity that has a registered public user identity but with a new contact address, the S-CSCF shall:\n1)\tperform the procedure for receipt of a REGISTER request without the \"integrity-protected\" header field parameter in the Authorization header field or without the Authorization header field, for the received public user identity; and\n2)\tif the Contact header field of the REGISTER request does not contain a \"reg-id\" header field parameter (i.e., the multiple registrations mechanism is not used), and the authentication has been successful, and there are public user identities (including the public user identity being registered, if previously registered) belonging to this user that have been previously registered with the same private user identity and with an old contact address different from the one received in the REGISTER request and if the previous registration have not expired:\na)\tterminate all dialogs, if any, associated with the previously registered public user identities (including the public user identity being registered, if previously registered), with a status code 480 (Temporarily Unavailable) in the Reason header field of the BYE request, as specified in subclause 5.4.5.1.2;\nb)\tsend a NOTIFY request, to the subscribers to the registration event package of the previously registered public user identities, that indicates that all previously registered public user identities (excluding the public user identity being registered) belonging to this user identified with its private user identity, have been deregistered, as described in subclause 5.4.2.1.2. For the public user identity being registered, the NOTIFY request contains the new contact information; and\nNOTE 1:\tThe last dialog to be terminated will be the dialog established by the UE subscribing to the reg event package. When sending the NOTIFY request to the UE over this dialog, the S-CSCF will terminate this dialog by setting in the NOTIFY request the Subscription-State header field to the value of \"terminated\".\nc)\tdelete all information associated with the previously registered public user identities.\nNOTE 2:\tContact related to emergency registration is not affected. The S-CSCF is not able to deregister contact related to emergency registration and will not delete it.\nUpon receipt of a REGISTER request that is determined to be NASS-IMS bundled authentication, for a public user identity for which the maximum number of allowed simultaneously registration flows is for the used UE (i.e. linked to the same private user identity and instance ID) is reached, if the REGISTER is adding a new registration flow, then the S-CSCF shall reject the REGISTER by generating a 403 (Forbidden) response. If not, the S-CSCF shall continue with the rest of the procedures of this subclause;\nUpon receipt of a REGISTER request without the \"integrity-protected\" header field parameter in the Authorization header field or without an Authorization header field, which is not for an already registered public user identity linked to the same private user identity, the S-CSCF shall:\n1)\tidentify the user by the public user identity as received in the To header field of the REGISTER request and if the Authorization header field is present, the private user identity as received in the Authorization header field of the REGISTER request. If the Authorization header field is not present, the S-CSCF shall derive the private user identity from the public user identity being registered by removing SIP  scheme and the following parts of the SIP  if present: port number,  parameters, and To header field parameters;\n2)\tcheck whether one or more Line-Identifiers previously received over the Cx interface, and stored as a result of a Authentication procedure with the HSS, are available for the user. If not, the S-CSCF performs the Authentication procedure with the HSS, as described in 3GPP TS 29.228 [14], in order to obtain these Line-Identifiers;\n3)\tin the particular case where the S-CSCF received via the Cx interface one or more Line-Identifiers, compare each of Line-Identifiers with the \"dsl-location\", \"eth-location\" or \"fiber-location\" parameter of the P-Access-Network-Info header field (if present and if it includes the \"network-provided\" parameter):\n-\tif one of these match, the user is considered authenticated, behave as described in step 5) to 11) of subclause 5.4.1.2.2;\n-\totherwise i.e. if these do not match, return a 403 (Forbidden) response to the REGISTER request; and\n4)\tif no Line-Identifier is received over the Cx interface, send a 500 (Server Internal Error) response to the REGISTER request.\nUpon receipt of a REGISTER request without the \"integrity-protected\" header field parameter in the Authorization header field or without an Authorization header field, for an already registered public user identity linked to the same private user identity, and for existing contact information, the S-CSCF shall behave as described in subclause 5.4.1.2.2F.\nUpon receipt of a REGISTER request without an Authorization header field, the S-CSCF shall:\n1)\tidentify the user by the public user identity as received in the To header field of the REGISTER request. The S-CSCF shall derive the private user identity from the public user identity being registered by removing  scheme and the following parts of the  if present: port number,  parameters, and To header field parameters;\n1A)\tif the maximum number of simultaneously registration flows allowed for the related public user identity for the used UE (i.e. linked to the same private user identity and instance ID) is reached, then the S-CSCF shall reject the REGISTER by generating a 403 (Forbidden) response. If not, the S-CSCF shall continue with the rest of the steps;\n2)\tcheck if the P-Visited-Network-ID header field is included in the REGISTER request, and if it is included identify the visited network by the value of this header field;\n3)\tcheck whether an IP address is stored for this UE. If no IP address (or prefix) is stored for the UE, query the HSS as described in 3GPP TS 29.228 [14] with the derived private user identity and the public user identity as input and store the received IP address (or prefix) of the UE; if the S-CSCF receives a prefix from the HSS, it will only check against prefixes otherwise it will check against the full IP address;\nNOTE 1:\tAt this point the S-CSCF informs the HSS, that the user currently registering will be served by the S-CSCF by passing its SIP  to the HSS. This will be indicated by the HSS for all further incoming requests to this user, in order to direct all these requests directly to this S-CSCF.\n4)\tcheck whether a \"received\" header field parameter exists in the Via header field provided by the UE. If a \"received\" header field parameter exists, the S-CSCF shall compare the IP address recorded in the \"received\" header field parameter against the UE's IP address stored during registration. In case of IPv6 stateless autoconfiguration, the S-CSCF shall compare the prefix of the IP address recorded in the \"received\" header field parameter against the UE's IP address prefix stored during registration. If no \"received\" header field parameter exists in the Via header field provided by the UE, then the S-CSCF shall compare IP address recorded in the \"sent-by\" parameter against the stored UE IP address. In case of IPv6 stateless autoconfiguration, S-CSCF shall compare the prefix of the IP address recorded in the \"sent-by\" parameter against the UE's IP address prefix stored during registration. In any case, if the stored IP address (or prefix) and the (prefix of the) IP address recorded in the Via header field provided by the UE do not match, the S-CSCF shall query the HSS as described in 3GPP TS 29.228 [14] with the derived private user identity and the public user identity as input and store the received IP address (or prefix) of the UE. If the stored IP address (or prefix) and the (prefix of the) IP address recorded in the Via header field provided by the UE still do not match the S-CSCF shall reject the registration with a 403 (Forbidden) response and skip the following steps;\n5)\tafter performing the S-CSCF Registration/deregistration notification procedure with the HSS, as described in 3GPP TS 29.228 [14], store the following information in the local data:\na)\tthe list of public user identities, including the registered own public user identity and its associated set of implicitly registered public user identities and wildcarded public user identities due to the received REGISTER request. Each public user identity is identified as either barred or non-barred;\nb)\tall the service profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including initial Filter Criteria (the initial Filter Criteria for the Registered and common parts is stored and the unregisterd part is retained for possible use later - in the case the S-CSCF is retained if the user becomes unregistered);\nc)\tif S-CSCF restoration procedures are supported, the restoration information if received as specified in 3GPP TS 29.228 [14]; and\nd)\tif PCRF based P-CSCF restoration procedures are supported, all the user profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including the , if available;\nNOTE 2:\tThere might be more than one set of initial Filter Criteria received because some implicitly registered public user identities that are part of the same implicit registration set belong to different service profiles.\n6)\tupdate registration bindings as follows:\na)\tbind to each non-barred registered public user identity all registered contact information including all header field parameters contained in the Contact header field and all associated  parameters with the exception of the \"pub-gruu\" and \"temp-gruu\" header field parameters as specified in RFC 5627 [93], and store information for future use; and\nb)\tif the Contact  in the Contact header field does not contain a \"bnc\"  parameter, then for each binding that contains a \"+sip.instance\" Contact header field parameter, assign a new temporary GRUU, as specified in subclause 5.4.7A.3;\nNOTE 3:\tThere might be more than one contact information available for one public user identity.\nNOTE 4:\tThe barred public user identities are not bound to the contact information.\n7)\tcheck whether a Path header field was included in the REGISTER request and construct a list of preloaded Route header fields from the list of entries in the received Path header field. The S-CSCF shall preserve the order of the preloaded Route header fields and bind them either to the contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used) and the contact information that was received in the REGISTER request;\nNOTE 5:\tIf this registration is a reregistration or an initial registration (i.e., there are previously registered public user identities belonging to the user that have not been deregistered or expired), then a list of pre-loaded Route header fields will already exist. If multiple registration mechanism was not used, then the existing list of pre-loaded Route header fields is bound to a respective contact address of the UE. However, if multiple registration mechanism was used, then the existing list of pre-loaded Route header fields is bound to a registration flow and the associated contact address that was used to send the REGISTER request. In either case, the new list replaces the old list.\n8)\tdetermine the duration of the registration by checking the registration expiration interval value in the received REGISTER request and bind it either to the respective contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used). Based on local policy, the S-CSCF may reduce the duration of the registration or send back a 423 (Interval Too Brief) response specifying the minimum allowed time for registration. The local policy can take into account specific criteria such as the used authentication mechanism to determine the allowed registration duration;\n9)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n9A)\tif an \"orig-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"orig-ioi\" header field parameter; and\nNOTE 6:\tAny received \"orig-ioi\" header field parameter will be a type 1 IOI. The type 1 IOI identifies the network from which the request was sent.\n10)\tcreate and send a 200 (OK) response for the REGISTER request as specified in subclause 5.4.1.2.2F.\nWhen a user de-registers, or is de-registered by the HSS, the S-CSCF shall delete the IP address stored for the UE.\nUpon receipt of a REGISTER request with the \"integrity-protected\" header field parameter in the Authorization header field set to \"yes\" or to \"tls-connected\", the S-CSCF shall identify the user by the public user identity as received in the To header field and the private user identity as received in the Authorization header field of the REGISTER request, and:\nIf the maximum number of simultaneously registration flows allowed for the related public user identity for the used UE (i.e. linked to the same private user identity and instance ID) is reached, then the S-CSCF shall reject the REGISTER by generating a 403 (Forbidden) response. If not, the S-CSCF shall continue with rest of the procedures of this subclause;\nIn the case that there is no authentication currently ongoing for this user (i.e. no timer reg-await-auth is running):\n1)\tcheck if the user needs to be re-authenticated.\nThe S-CSCF may require authentication of the user for any REGISTER request, and shall always require authentication for REGISTER requests received without the \"integrity-protected\" header field parameter in the Authorization header field set to \"yes\" or \"tls-connected\".\nIf the user needs to be re-authenticated, the S-CSCF shall proceed with the procedures as described for the unprotected REGISTER in subclause 5.4.1.2.1, beginning with step 3). If the user does not need to be re-authenticated, the S-CSCF shall proceed with the following steps in this paragraph; and\n2)\tcheck whether a registration expiration interval value is included in the REGISTER request and its value. If the registration expiration interval value indicates a zero value, the S-CSCF shall perform the deregistration procedures as described in subclause 5.4.1.4. If the registration expiration interval value does not indicate zero, the S-CSCF:\n-\tif the REGISTER request does not contain a \"reg-id\" header field parameter and the contact address indicated in the Contact header field was not previously registered, send a 403 (Forbidden) response to the UE; and\nNOTE 1:\tNew contact address is always registered via an initial registration.\n3)\tcheck whether the public user identity received in the To header field is already registered. If it is not registered, the S-CSCF shall proceed beginning with step 4B below. Otherwise, the S-CSCF shall:\n-\tsend a 439 (First Hop Lacks Outbound Support) response to the UE, if the REGISTER request contains the \"reg-id\" Contact header field parameter and the \"outbound\" option tag in a Supported header field, but the first  in the Path header field does not have an \"ob\"  parameter; or\n-\totherwise proceed beginning with step 6 below.\nIn the case that a timer reg-await-auth is running for this user the S-CSCF shall:\n1)\tcheck if the Call-ID of the request matches with the Call-ID of the 401 (Unauthorized) response which carried the last challenge. The S-CSCF shall only proceed further if the Call-IDs match;\n2)\tstop timer reg-await-auth;\n3)\tcheck whether an Authorization header field is included, containing:\na)\tthe private user identity of the user in the \"username\" header field parameter;\nb)\tif the \"integrity-protected\" header field parameter is set to \"yes\", the \"algorithm\" header field parameter set to \"AKAv2-SHA-256\" or \"AKAv1-MD5\";\nc)\tif the \"integrity-protected\" header field parameter is set to \"tls-connected\", the \"algorithm\" header field parameter set to \"AKAv2-SHA-256\" if the S-CSCF supports the IMS AKA using HTTP Digest AKAv2 without IPSec security association; and\nd)\tthe authentication challenge response needed for the authentication procedure in the \"response\" header field parameter.\nThe S-CSCF shall only proceed with the following steps in this paragraph if the authentication challenge response was included;\n4)\tcheck whether the received authentication challenge response and the expected authentication challenge response (calculated by the S-CSCF using XRES and other parameters as described in RFC 3310 [49] when AKAv1 is used or as described in RFC 4169 [227] when AKAv2 is used) match. The XRES parameter was received from the HSS as part of the Authentication Vector. The S-CSCF shall only proceed with the following steps if the challenge response received from the UE and the expected response calculated by the S-CSCF match;\n4A)\tif the Contact header field of the REGISTER request does not contain a \"reg-id\" header field parameter (i.e., the multiple registrations mechanism is not used), and there are public user identities (including the public user identity being registered, if previously registered) that belong to this user that have been previously registered with the same private user identity, and with an old contact address different from the one received in the REGISTER request and if the previous registrations have not expired:\na)\tterminate all dialogs, associated with the previously registered public user identities (including the public user identity being registered, if previously registered), with a status code 480 (Temporarily Unavailable) in the Reason header field of the BYE request, as specified in subclause 5.4.5.1.2;\nb)\tsend a NOTIFY request, to the subscribers to the registration event package of the previously registered public user identities, that indicates that all previously registered public user identities (excluding the public user identity being registered) belonging to this user identified with its private user identity, have been deregistered, as described in subclause 5.4.2.1.2. For the public user identity being registered, the NOTIFY request contains the new contact information; and\nNOTE 2:\tThe last dialog to be terminated will be the dialog established by the UE subscribing to the reg event package. When sending the NOTIFY request to the UE over this dialog, the S-CSCF will terminate this dialog by setting in the NOTIFY request the Subscription-State header field to the value of \"terminated\".\nc)\tdelete all information associated with the previously registered public user identities;\nNOTE 3:\tContact related to emergency registration is not affected. The S-CSCF is not able to deregister contact related to emergency registration and will not delete it.\n4B)\tif the REGISTER request contains the \"reg-id\" Contact header field parameter and the \"outbound\" option tag in a Supported header field, but the first  in the Path header field does not have an \"ob\"  parameter, send a 439 (First Hop Lacks Outbound Support) response to the UE;\n5)\tafter performing the S-CSCF Registration/deregistration notification procedure with the HSS, as described in 3GPP TS 29.228 [14], store the following information in the local data:\na)\tthe list of public user identities, including the registered own public user identity and its associated set of implicitly registered public user identities and wildcarded public user identities due to the received REGISTER request. Each public user identity is identified as either barred or non-barred;\nb)\tall the service profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including initial Filter Criteria(the initial Filter Criteria for the Registered and common parts is stored and the unregistered part is retained for possible use later - in the case of the S-CSCF is retained if the user becomes unregistered);\nc)\tif S-CSCF restoration procedures are supported, the restoration information if received as specified in 3GPP TS 29.228 [14]; and\nd)\tif PCRF based P-CSCF restoration procedures are supported, all the user profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including the , if available;\nNOTE 4:\tThere might be more than one set of initial Filter Criteria received because some implicitly registered public user identities that are part of the same implicit registration set belong to different service profiles.\n6)\tupdate registration bindings:\na)\tif the Contact  in the Contact header field does not contains a \"bnc\"  parameter, then bind to each non-barred registered public user identity all registered contact information including all header field parameters contained in the Contact header field and all associated SIP  parameters, with the exception of the \"pub-gruu\" and \"temp-gruu\" header field parameters as specified in RFC 5627 [93], and store information for future use;\nb)\tif the Contact  in the Contact header field contains a \"bnc\"  parameter, as a network option bind each non-barred registered public user identity to a contact address generated according to the procedures of RFC 6140 [191].\nNOTE 5:\tIt is assumed that when the Contact header field contains a \"bnc\" parameter, the associated public user identities obtained from the HSS are all of a form compatible with registration procedures as specified in RFC 6140 [191]; i.e. the set consists only of distinct public user identities contain global numbers in the international format or wildcarded public user identities representing multiple global numbers in the international format. The S-CSCF procedures for handling the error case where an associated public user identity is incompatible with RFC 6140 [191] is out of scope of this specification.\nc)\tif the Contact  in the Contact header field does not contain a \"bnc\"  parameter, then for each binding that contains a \"+sip.instance\" Contact header field parameter, assign a new temporary GRUU, as specified in subclause 5.4.7A.3;\nd)\tif the Contact header field of the REGISTER request contained a \"+sip.instance\" and a \"reg-id\" header field parameter, and the SIP  in the Path header field inserted by the P-CSCF contained an \"ob\" SIP  parameter header field, and:\n-\tif the public user identity has not previously been registered with the same \"+sip.instance\" and \"reg-id\" Contact header field parameter values, then create the registration flow in addition to any existing registration flow; or\n-\tif the public user identity has previously been registered with the same \"+sip.instance\" and \"reg-id\" header field parameter values, then determine whether the request refreshes or replaces an existing registration flow. If the request:\ni)\trefreshes an existing registration flow, then the S-CSCF shall leave the flow intact; or\nii)\treplaces the existing registration flow with a new flow, then the S-CSCF shall:\na)\tterminate any dialog, as specified in subclause 5.4.5.1.2, with a status code 480 (Temporarily Unavailable) in the Reason header field of the BYE request, associated with the registration flow being replaced; and\nb)\tsend a NOTIFY request to the subscribers to the registration event package for the public user identity indicated in the REGISTER request, as described in subclause 5.4.2.1.2;\nNOTE 6:\tThe S-CSCF determines whether this REGISTER request replaces or refreshes an existing registration flow by examining the SIP  in the Path header field inserted into the request by the P-CSCF (see subclause 5.2.2.1).\nNOTE 7:\tThe way the S-CSCF identifies the dialogs associated with the registration flow being replaced is implementation specific.\nNOTE 8:\tThere might be more than one contact information available for one public user identity.\nNOTE 9:\tThe barred public user identities are not bound to the contact information.\nNOTE 10:\tContact related to emergency registration is not affected. S-CSCF is not able deregister contact related to emergency registration and will not delete that.\n7)\tcheck whether a Path header field was included in the REGISTER request and construct a list of preloaded Route header fields from the list of entries in the received Path header field. The S-CSCF shall preserve the order of the preloaded Route header fields and bind them either to the contact address of the UE or the registration flow and the associated contact address (if the multiple registration mechanism is used) and the contact information that was received in the REGISTER request;\nNOTE 11:\tIf this registration is a reregistration or an initial registration (i.e., there are previously registered public user identities belonging to the user that have not been deregistered or expired), then a list of pre-loaded Route header fields will already exist. If multiple registration mechanism was not used, then the existing list of pre-loaded Route header fields is bound to a respective contact address of the UE. However, if multiple registration mechanism was used, then the existing list of pre-loaded Route header fields is bound to a registration flow and the associated contact address that was used to send the REGISTER request. In either case, the new list replaces the old list.\n8)\tdetermine the duration of the registration by checking the value of the registration expiration interval value in the received REGISTER request and bind it either to the respective contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used). Based on local policy, the S-CSCF may reduce the duration of the registration or send back a 423 (Interval Too Brief) response specifying the minimum allowed time for registration. The local policy can take into account specific criteria such as the used authentication mechanism to determine the allowed registration duration;\n9)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n10)\tif an \"orig-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"orig-ioi\" header field parameter; and\nNOTE 12:\tAny received \"orig-ioi\" header field parameter will be a type 1 IOI. The type 1 IOI identifies the network from which the request was sent.\n11)\tcreate and send a 200 (OK) response for the REGISTER request as specified in subclause 5.4.1.2.2F.\nUpon receipt of a REGISTER request with the \"integrity-protected\" header field parameter in the Authorization header field set to \"tls-pending\", \"tls-yes\", \"ip-assoc-pending\", or \"ip-assoc-yes\", the S-CSCF shall identify the user by the public user identity as received in the To header field and the private user identity as received in the Authorization header field of the REGISTER request, and:\nNOTE 1:\tAlthough the REGISTER request with the \"integrity-protected\" header field parameter set to \"ip-assoc-pending\" or \"ip-assoc-yes\" is handled as protected REGISTER request, the integrity of the request is actually not protected by SIP digest.\nIf the maximum number of simultaneously registration flows allowed for the related public user identity for the used UE (i.e. linked to the same private user identity and instance ID) is reached, then the S-CSCF shall reject the REGISTER by generating a 403 (Forbidden) response. If not, the S-CSCF shall continue with rest of the procedures of this subclause;\nIn the case that there is no authentication currently ongoing for this user (i.e. no timer reg-await-auth is running):\n1)\tcheck if the user needs to be re-authenticated. The S-CSCF may require authentication of the user for any REGISTER request, and shall always require authentication for REGISTER requests received without the \"integrity-protected\" header field parameter in the Authorization header field set to \"tls-yes\".\nIf the user needs to be re-authenticated and the REGISTER did not include an Authorization header field with a digest response, the S-CSCF shall proceed with the authentication procedures as described for the initial REGISTER in subclause 5.4.1.2.1 and subclause 5.4.1.2.1B.\nIf the user needs to be re-authenticated and the REGISTER included an Authorization header field with a digest response, the S-CSCF shall proceed with the authentication procedures as described for the initial REGISTER in subclause 5.4.1.2.1 and subclause 5.4.1.2.1B and include the \"stale\" header field parameter with value \"true\" in the -Authenticate header field.\nIn the case that a timer reg-await-auth is running for this user the S-CSCF shall:\n1)\tcheck if the Call-ID of the request matches with the Call-ID of the 401 (Unauthorized) response which carried the last challenge. The S-CSCF shall only proceed further if the Call-IDs match;\n2)\tstop timer reg-await-auth;\n3)\tin the case the algorithm is \"SHA2-256\", \"SHA2-512/256\" or \"MD5\", check the following additional fields:\nNOTE 2:\tThe MD5 algorithm is only supported for backward compatibility.\n-\ta \"realm\" header field parameter matching the \"realm\" header field parameter in the authentication challenge;\n-\tan \"algorithm\" header field parameter which matches the \"algorithm\" header field parameter sent in the authentication challenge;\n-\t\"nonce\" header field parameter matching the \"nonce\" header field parameter in the authentication challenge;\n-\ta \"cnonce\" header field parameter; and\n-\ta \"nc\" header field parameter.\nThe S-CSCF shall only proceed with the following steps in this paragraph if the authentication challenge response was included;\n4)\tcheck whether the received authentication challenge response and the expected authentication challenge response match. The expected response is calculated by the S-CSCF as described in RFC 7616 [286] and RFC 8760 [287] using the H(A1) value provided by the HSS. If the received authentication challenge response and the expected authentication challenge response match, then the UE is considered authenticated. If the UE is considered authenticated, and if the \"integrity-protected\" header field parameter in the Authorization header field is set to the value \"tls-pending\" or \"tls-yes\", then the S-CSCF shall associate the registration with the local state of \"tls-protected\";\nNOTE 3:\tThe S-CSCF can have a local security policy to treat messages other than initial REGISTER requests, messages relating to emergency services, and error messages, differently depending on whether the registration is associated with the state \"tls-protected\".\n4A)\tif the REGISTER request contains the \"reg-id\" Contact header field parameter and the \"outbound\" option tag in a Supported header field, but the first  in the Path header does not have an \"ob\"  parameter, send a 439 (First Hop Lacks Outbound Support) response to the UE;\n5)\tafter performing the S-CSCF Registration/deregistration notification procedure with the HSS, as described in 3GPP TS 29.228 [14], store the following information in the local data:\na)\tthe list of public user identities, including the registered own public user identity and its associated set of implicitly registered public user identities and wildcarded public user identities due to the received REGISTER request. Each public user identity is identified as either barred or non-barred;\nb)\tall the service profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including initial Filter Criteria(the initial Filter Criteria for the Registered and common parts is stored and the unregistered part is retained for possible use later - in the case of the S-CSCF is retained if the user becomes unregistered);\nc)\tif S-CSCF restoration procedures are supported, the restoration information, if received, as specified in 3GPP TS 29.228 [14]; and\nd)\tif PCRF based P-CSCF restoration procedures are supported, all the user profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including the , if available;\nNOTE 4:\tThere might be more than one set of initial Filter Criteria received because some implicitly registered public user identities that are part of the same implicit registration set belong to different service profiles.\n6)\tupdate registration bindings:\na)\tif the Contact  in the Contact header field does not contains a \"bnc\"  parameter, then bind to each non-barred registered public user identity all registered contact information including all header field parameters contained in the Contact header field and all associated  parameters, with the exception of the \"pub-gruu\" and \"temp-gruu\" header field parameters as specified in RFC 5627 [93], and store information for future use;\nb)\tif the Contact  in the Contact header field contains a \"bnc\"  parameter, as a network option bind each non-barred registered public user identity to a contact address as specified in RFC 6140 [191].\nNOTE 5:\tIt is assumed that when the Contact header field contains a \"bnc\" parameter, the associated public user identities obtained from the HSS are all of a form compatible with registration procedures as specified in RFC 6140 [191]; i.e. the set consists only of distinct public user identities contain global numbers in the international format or wildcarded public user identities representing multiple global numbers in the international format. The S-CSCF procedures for handling the error case where an associated public user identity is incompatible with RFC 6140 [191] is out of scope of this specification.\nc)\tif the Contact  in the Contact header field does not contain a \"bnc\"  parameter, then for each binding that contains a \"+sip.instance\" Contact header field parameter, assign a new temporary GRUU, as specified in subclause 5.4.7A.3;\nd)\tif the Contact header field of the REGISTER request does not contain a \"reg-id\" header field parameter (i.e., the multiple registrations mechanism is not used), and there are public user identities (including the public user identity being registered, if previously registered) that belong to this user that have been previously registered with the same private user identity, and with an old contact address different from the one received in the REGISTER request and if the previous registrations have not expired:\n-\tterminate all dialogs, associated with the previously registered public user identities (including the public user identity being registered, if previously registered), with a status code 480 (Temporarily Unavailable) in the Reason header field of the BYE request, as specified in subclause 5.4.5.1.2;\n-\tsend a NOTIFY request, to the subscribers to the registration event package of the previously registered public user identities, that indicates that all previously registered public user identities (excluding the public user identity being registered) belonging to this user identified with its private user identity, have been deregistered, as described in subclause 5.4.2.1.2. For the public user identity being registered, the NOTIFY request contains the new contact information; and\nNOTE 6:\tThe last dialog to be terminated will be the dialog established by the UE subscribing to the reg event package. When sending the NOTIFY request to the UE over this dialog, the S-CSCF will terminate this dialog by setting in the NOTIFY request the Subscription-State header field to the value of \"terminated\".\n-\tdelete all information associated with the previously registered public user identities;\nNOTE 7:\tContact related to emergency registration is not affected. The S-CSCF is not able to deregister contact related to emergency registration and will not delete it.\ne)\tif the Contact header field of the REGISTER request contained a \"+sip.instance\" and a \"reg-id\" header field parameter, and the SIP  in the Path header field inserted by the P-CSCF contained an \"ob\" SIP  parameter header field, and:\n-\tif the public user identity has not previously been registered with the same \"+sip.instance\" and \"reg-id\" Contact header field parameter values, then create the registration flow in addition to any existing registration flow; or\n-\tif the public user identity has previously been registered with the same \"+sip.instance\" and \"reg-id\" header field parameter values, then determine whether the request refreshes or replaces an existing registration flow. If the request:\ni)\trefreshes an existing registration flow, then the S-CSCF shall leave the flow intact; or\nii)\treplaces the existing registration flow with a new flow, then the S-CSCF shall:\na)\tterminate any dialog, as specified in subclause 5.4.5.1.2, with a status code 480 (Temporarily Unavailable) in the Reason header field of the BYE request, associated with the registration flow being replaced; and\nb)\tsend a NOTIFY request to the subscribers to the registration event package for the public user identity indicated in the REGISTER request, as described in subclause 5.4.2.1.2; and\nf)\tstore the used nonce as a valid nonce for this registration or registration flow (if multiple registration mechanism is used) for an operator configured duration.\nNOTE 8:\tThe S-CSCF determines whether this REGISTER request replaces or refreshes an existing registration flow by examining the SIP  in the Path header field inserted into the request by the P-CSCF (see subclause 5.2.2.1).\nNOTE 9:\tThe way the S-CSCF identifies the dialogs associated with the registration flow being replaced is implementation specific.\nNOTE 10:\tThere might be more than one contact information available for one public user identity.\nNOTE 11:\tThe barred public user identities are not bound to the contact information.\nNOTE 12:\tContact related to emergency registration is not affected. S-CSCF is not able deregister contact related to emergency registration and will not delete that.\n7)\tcheck whether a Path header field was included in the REGISTER request and construct a list of preloaded Route header fields from the list of entries in the received Path header field. The S-CSCF shall preserve the order of the preloaded Route header fields and bind them to either the contact address of the UE or the registration flow and the associated contact address (if the multiple registration mechanism is used) and contact information that was received in the REGISTER request;\nNOTE 13:\tIf this registration is a reregistration or an initial registration (i.e., there are previously registered public user identities belonging to the user that have not been deregistered or expired), then a list of pre-loaded Route header fields will already exist. If multiple registration mechanism was not used, then the existing list of pre-loaded Route header fields is bound to a respective contact address of the UE. However, if multiple registration mechanism was used, then the existing list of pre-loaded Route header fields is bound to a registration flow and the associated contact address that was used to send the REGISTER request. In either case, the new list replaces the old list.\n8)\tdetermine the duration of the registration by checking the value of the registration expiration interval value in the received REGISTER request and bind it either to the respective contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used). Based on local policy, the S-CSCF may reduce the duration of the registration or send back a 423 (Interval Too Brief) response specifying the minimum allowed time for registration. The local policy can take into account specific criteria such as the used authentication mechanism to determine the allowed registration duration;\n9)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n10)\tif an \"orig-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"orig-ioi\" header field parameter; and\nNOTE 14:\tAny received \"orig-ioi\" header field parameter will be a type 1 IOI. The type 1 IOI identifies the network from which the request was sent.\n11)\tcreate and send a 200 (OK) response for the REGISTER request as specified in subclause 5.4.1.2.2F. The S-CSCF shall also store the nonce-count value in the received REGISTER request and include an Authentication-Info header field containing the fields described in RFC 7616 [286] and RFC 8760 [287] as follows:\n-\ta \"nextnonce\" header field parameter if the S-CSCF requires a new nonce for subsequent authentication responses from the UE. In that case, the S-CSCF shall consider this nonce as a valid nonce for this registration or registration flow (if multiple registration mechanism is used) for an operator configured duration;\n-\ta \"qop\" header field parameter matching the \"qop\" Authorization header field parameter sent by the UE;\n-\ta \"rspauth\" header field parameter with a response-digest calculated as described in RFC 7616 [286] and RFC 8760 [287];\n-\ta \"cnonce\" header field parameter matching the \"cnonce\" Authorization header field parameter sent by the UE; and\n-\ta \"nc\" header field parameter matching the \"nc\" Authorization header field parameter sent by the UE.\nThe procedures for subclause 5.4.1.2.2A apply.\nThere is no protected REGISTER when NASS-IMS bundled authentication is used as a security mechanism. The procedures of subclause 5.4.1.2.1D apply to all REGISTER requests.\nThere is no protected REGISTER when GPRS-IMS-Bundled authentication is used as a security mechanism. The procedures of subclause 5.4.1.2.1E apply to all REGISTER requests.\nThe S-CSCF shall not perform authentication of the user for any REGISTER request with the \"integrity-protected\" header field parameter in the Authorization header set to \"auth-done\".\nIn this release of this document, when the registration procedure as specified in this subclause is performed, i.e., the REGISTER request contains the \"integrity-protected\" header field parameter in the Authorization header set to \"auth-done\", the S-CSCF shall not employ outbound registration as described in RFC 5626 [92].\nUpon receipt of a REGISTER request with the \"integrity-protected\" header field parameter in the Authorization header set to \"auth-done\", the S-CSCF shall identify the user by the public user identity as received in the To header field and the private user identity as received in the Authorization header field of the REGISTER request.\nIn addition the S-CSCF shall check whether a registration expiration interval value is included in the REGISTER request and its value. If the registration expiration interval value indicates a zero value, the S-CSCF shall perform the deregistration procedures as described in subclause 5.4.1.4. If the registration expiration interval value does not indicate zero, the S-CSCF shall:\n1)\tif the REGISTER request contains the \"reg-id\" header field parameter in the Contact header field, respond with a 403 (Forbidden) response to the REGISTER request; and\n2)\tif there are public user identities (including the public user identity being registered, if previously registered) that belong to this user that have been previously registered with the same private user identity, and with an old contact address different from the one received in the REGISTER request and if the previous registrations have not expired:\na)\tterminate all dialogs, associated with the previously registered public user identities (including the public user identity being registered, if previously registered), with a status code 480 (Temporarily Unavailable) in the Reason header field of the BYE request, as specified in subclause 5.4.5.1.2;\nb)\tsend a NOTIFY request, to the subscribers to the registration event package of the previously registered public user identities, that indicates that all previously registered public user identities (excluding the public user identity being registered) belonging to this user identified with its private user identity, have been deregistered, as described in subclause 5.4.2.1.2. For the public user identity being registered, the NOTIFY request contains the new contact information; and\nNOTE 1:\tThe last dialog to be terminated will be the dialog established by the user (identified with its private user identity) subscribing to its own reg event package using the old contact address. When sending the NOTIFY request over this dialog, the S-CSCF will terminate this dialog by setting in the NOTIFY request the Subscription-State header field to the value of \"terminated\".\nc)\tdelete all information associated with the previously registered public user identities;\nSubsequently, the S-CSCF shall check whether the public user identity received in the To header field is already registered. If it is not registered, the S-CSCF shall proceed beginning with step 1 below. Otherwise, the S-CSCF shall proceed beginning with step 2 below.\n1)\tafter performing the S-CSCF Registration/deregistration notification procedure with the HSS, as described in 3GPP TS 29.228 [14], store the following information in the local data:\na)\tthe list of public user identities, including the registered own public user identity and its associated set of implicitly registered public user identities and wildcarded public user identities due to the received REGISTER request. Each public user identity is identified as either barred or non-barred;\nb)\tall the service profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including initial Filter Criteria(the initial Filter Criteria for the Registered and common parts is stored and the unregistered part is retained for possible use later - in the case of the S-CSCF is retained if the user becomes unregistered); and\nc)\tif PCRF based P-CSCF restoration procedures are supported, all the user profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including the , if available;\nNOTE 2:\tThere might be more than one set of initial Filter Criteria received because some implicitly registered public user identities that are part of the same implicit registration set belong to different service profiles.\n2)\tupdate registration bindings:\na)\tif the Contact  in the Contact header field does not contains a \"bnc\"  parameter, then bind to each non-barred registered public user identity all registered contact information including all header parameters contained in the Contact header and all associated  parameters, with the exception of the  \"pub-gruu\" and \"temp-gruu\" parameters as specified in RFC 5627 [93], and store information for future use;\nb)\tif the Contact  in the Contact header field contains a \"bnc\"  parameter, as a network option bind each non-barred registered public user identity to a contact address as specified in RFC 6140 [191].\nNOTE 3:\tIt is assumed that when the Contact header field contains a \"bnc\" parameter, the associated public user identities obtained from the HSS are all of a form compatible with registration procedures as specified in RFC 6140 [191]; i.e. the set consists only of distinct public user identities contain global numbers in the international format or wildcarded public user identities representing multiple global numbers in the international format. The S-CSCF procedures for handling the error case where an associated public user identity is incompatible with RFC 6140 [191] is out of scope of this specification.\nc)\tif the Contact  in the Contact header field does not contain a \"bnc\"  parameter, then for each binding that contains a \"+sip.instance\" header field parameter, assign a new temporary GRUU, as specified in subclause 5.4.7A.3.\nNOTE 4:\tThere might be more than one contact information available for one public user identity.\nNOTE 5:\tThe barred public user identities are not bound to the contact information.\n3)\tcheck whether a Path header was included in the REGISTER request and construct a list of preloaded Route headers from the list of entries in the received Path header field. The S-CSCF shall preserve the order of the preloaded Route header fields and bind them to the contact information that was received in the REGISTER request;\nNOTE 6:\tIf this registration is a reregistration or an initial registration (i.e., there are previously registered public user identities belonging to the user that have not been deregistered or expired), then a list of pre-loaded Route headers will already exist. The new list replaces the old list.\n4)\tdetermine the duration of the registration by checking the value of the registration expiration interval value in the received REGISTER request. Based on local policy, the S-CSCF may reduce the duration of the registration or send back a 423 (Interval Too Brief) response specifying the minimum allowed time for registration. The local policy can take into account specific criteria such as the used authentication mechanism to determine the allowed registration duration;\n5)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header;\n6)\tif an \"orig-ioi\" header field parameter is received in the P-Charging-Vector header, store the value of the received \"orig-ioi\" header field parameter; and\nNOTE 7:\tAny received \"orig-ioi\" header field parameter will be a type 1 IOI. The type 1 IOI identifies the network from which the request was sent.\n7)\tcreate and send a 200 (OK) response for the REGISTER request as specified in subclause 5.4.1.2.2F.\nIf a 200 (OK) response is to be sent for a REGISTER request, the S-CSCF shall, in addition to any contents identified elsewhere in subclause 5.4.1.2, include:\na)\tthe list of received Path header fields;\nb)\ta P-Associated- header field containing the list of the registered distinct public user identity and its associated set of implicitly registered distinct public user identities. The first  in the list of public user identities supplied by the HSS to the S-CSCF will indicate the default public user identity to be used by the S-CSCF. The public user identity indicated as the default public user identity must be a registered public user identity. The S-CSCF shall place the default public user identity as the first entry in the list of URIs present in the P-Associated- header field. The default public user identity will be used by the P-CSCF in conjunction with the procedures for the P-Asserted-Identity header field, as described in subclause 5.2.6.3. If the S-CSCF received a display name from the HSS for a public user identity, then the S-CSCF shall populate the P-Associated- header field entry for that public identity with the associated display name. The S-CSCF shall not add a barred public user identity to the list of URIs in the P-Associated- header field;\nNOTE 1:\tThe P-Associated- header field lists only the public user identity and its associated set of implicitly registered public user identities that have been registered, rather than the list of user's URIs that may be either registered or unregistered as specified in RFC 7315 [52]. If the registered public user identity which is not barred does not have any other associated public user identities or wildcarded public user identities, the P-Associated- header field lists only the registered public user identity itself. The P-Associated- header field does not list wildcarded public user identities.\nc)\ta Service-Route header field containing:\nA)\tthe SIP  identifying the S-CSCF containing an indication that subsequent requests routed via this service route (i.e. from the P-CSCF to the S-CSCF) was sent by the UE using either the contact address of the UE or the registration flow and the associated contact address (if the multiple registration mechanism is used) that has been registered and are treated as for the UE-originating case.\nNOTE 2:\tThis indication can e.g. be in a parameter in the , a character string in the user part of the  or be a port number in the .\nThe S-CSCF shall use a different SIP  for each registration. If the multiple registration mechanism is used, the S-CSCF shall also use a different SIP  for each registration flow associated with the registration;\nB)\tif network topology hiding is required a SIP  identifying an IBCF as the topmost entry; and\nNOTE 3:\tIn accordance with the procedures described in RFC 3608 [38], an IBCF does not insert its own routable SIP  to the Service-Route header field.\nC)\tif\n1)\tS-CSCF supports indicating the traffic leg associated with a  as specified in RFC 7549 [225];\n2)\tthe UE is roaming;\n3)\tthe P-CSCF is not in the home network; and\n4)\trequired by local policy\nthen the S-CSCF may append an \"iotl\" SIP  parameter with a value set to \"visitedA-homeA\" to the S-CSCF SIP  in the Service-Route header field;\nd)\tif the P-CSCF is in the same network as the S-CSCF a P-Charging-Function-Addresses header field containing the values received from the HSS. It can be determined if the P-CSCF is in the same network as the S-CSCF by the contents of the P-Visited-Network-ID header field included in the REGISTER request;\nNOTE 4:\tThe P-CSCF does not check the P-Charging-Function-Addresses header field, providing this header field to the visiting network could cause undefined charging behaviour.\ne)\ta P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the REGISTER request, a type 1 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The S-CSCF shall set the type 1 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request;\nf)\ta Contact header field listing all contact addresses for this public user identity, including all saved header field parameters and  parameters (including all ICSI values and IARI values) received in the Contact header field of the REGISTER request,\ng)\tGRUUs in the Contact header field. If the REGISTER request contained a Required or Supported header field containing the value \"gruu\" then for each contact address in the Contact header field that has a \"+sip.instance\" header field parameter:\ni)\tadd \"pub-gruu\" header field parameter containing the public GRUU representing (as specified in subclause 5.4.7A.2) the association between the public user identity from the To header field in the REGISTER request and the instance ID contained in the \"+sip.instance\" header field parameter;\nii)\tif the Contact  in the Contact header field does not contain a \"bnc\"  parameter, then add a \"temp-gruu\" header field parameters. containing the most recently assigned temporary GRUU representing (as specified in subclause 5.4.7A) the association between the public user identity from the To header field in the REGISTER request and the instance ID contained in the \"+sip.instance\" header field parameter; and\niii)\tif the S-CSCF supports RFC 6140 [191] and the Contact  in the Contact header field contains a \"bnc\"  parameter, then add a \"temp-gruu-cookie\" header field parameter containing a value generated as specified in RFC 6140 [191];\nh)\tif the received REGISTER request contained both a \"reg-id\" and \"+sip.instance\" header field parameters in the Contact header field, and the first  within the Path header field contains the \"ob\" SIP  parameter a Require header field with the \"outbound\" option-tag as described in RFC 5626 [92];\nNOTE 5:\tThere might be other contact addresses available, that this UE or other UEs have registered for the same public user identity.\ni)\tvoid\nj)\toptionally, a Feature-Caps header field including the ICSI values contained in the service profile of the served user except the ones that require explicit support indication of capabilities by intermediary entities and that have not been indicated as supported according to RFC 6809 [190] for the corresponding registration or registration flow (if multiple registration mechanism is used);\nk)\tif the home network supports calling number verification using signature verification and attestation information, as defined in subclause 3.1,a Feature-Caps header field, as specified in RFC 6809 [190], including the \"+g.3gpp.verstat\" header field parameter;\nNOTE 6:\tIf the network has indicated support for the calling number verification using signature verification and attestation information to a UE during registration, the network needs to perform calling number verification for all calls delivered to the registered contact address.\nl)\tif the home network supports the response code 607 (Unwanted) as specified in RFC 8197 [254], a Feature-Caps header field including the \"+sip.607\" header field parameter; and\nm)\tif the home network supports the data channel, a Feature-Caps header field, as specified in clause B.1.1 of 3GPP TS 24.186 [297], including the \"+g.3gpp.datachannel\" header field parameter.\nand send the so created 200 (OK) response to the UE.\nFor all service profiles in the implicit registration set, the S-CSCF shall send a third-party REGISTER request, as described in subclause 5.4.1.7, to each AS that matches the Filter Criteria of the service profile from the HSS for the REGISTER event; and,\nNOTE 7:\tIf this registration is a reregistration, the Filter Criteria already exists in the local data.\nNOTE 8:\tIf the same AS matches the Filter Criteria of several service profiles for the event of REGISTER request, then the AS will receive several third-party REGISTER requests. Each of these requests will include a public user identity from the corresponding service profile.\nThe S-CSCF shall consider the public user identity being registered to be bound either to the contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used), as specified in the Contact header field, for the duration indicated in the registration expiration interval value.\nIn the case that the expiration timer from the UE is too short to be accepted by the S-CSCF, the S-CSCF shall:\n-\treject the REGISTER request with a 423 (Interval Too Brief) response, containing a Min-Expires header field with the minimum registration time the S-CSCF will accept.\nOn receiving a failure response to one of the third-party REGISTER requests, based on the information in the Filter Criteria the S-CSCF may:\n-\tabort sending third-party REGISTER requests; and\n-\tinitiate network-initiated deregistration procedure.\nIf the Filter Criteria does not contain instruction to the S-CSCF regarding the failure of the contact to the AS, the S-CSCF shall not initiate network-initiated deregistration procedure.\nIn the case that the REGISTER request from the UE contains multiple SIP URIs which are different addresses as Contact header field entries, the S-CSCF shall store:\n-\tthe entry in the Contact header field with the highest value of the \"q\" header field parameter; or\n-\tan entry decided by the S-CSCF based on local policy;\nand include the stored entry in the 200 (OK) response.\nIn the case that the REGISTER request from the UE contains multiple SIP URIs which are the same addresses with the same value of the \"q\" Contact header field parameter, the S-CSCF shall not store multiple entries with the same \"q\" value but store one of the entries with the same \"q\" value based on local policy along with any entries that have different \"q\" values and include only the stored entries in the 200 (OK) response.\nNOTE 1:\tThe UE can register multiple SIP URIs in the Contact header field simultanously, provided they all contain the same IP address and port number. In this case the S-CSCF behaviour is as defined RFC 3261 [26] (i.e multiple Contact header field entries are bound to the public user identity in the To header field and are returned in the 200 (OK) response).\nNOTE 2:\tIf the timer reg-await-auth expires, the S-CSCF will consider the authentication to have failed. If the public user identity was already registered, the S-CSCF will leave it registered, as described in 3GPP TS 33.203 [19].\nIf the S-CSCF receives a new initial REGISTER request before the reg-await-auth timer expires, the S-CSCF shall:\n1)\tstop the reg-await-auth timer; and\n2)\tinitiate the authentication procedures for initial registration as if there is no authentication currently ongoing for this user and send a 401 (Unauthorized) response containing a new challenge as described in subclause 5.4.1.\nFor any error response, the S-CSCF shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the REGISTER request, a type 1 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The S-CSCF shall set the type 1 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request.\nNOTE 3:\tAny previously received \"orig-ioi\" header field parameter will be a type 1 IOI. The type 1 IOI identifies the visited network of the registered user.\nIf the Contact header field in the REGISTER request from the UE contains an invalid Contact  as defined in RFC 6140 [191] (e.g., the Contact  contains both a \"bnc\" and \"user\"  parameter) then the S-CSCF shall reject the REGISTER request with a 400 (Bad Request) response.\nIn the case that the REGISTER request, that contains the authentication challenge response from the UE does not match with the expected REGISTER request (e.g. wrong Call-Id or authentication challenge response) and the request has the \"integrity-protected\" header field parameter in the Authorization header field set to \"yes\", the S-CSCF shall:\n-\tsend a 403 (Forbidden) response to the UE. The S-CSCF shall consider this authentication attempt as failed. The S-CSCF shall not update the registration state of the subscriber.\nNOTE 1:\tIf the UE was registered before, it stays registered until the registration expiration time expires.\nIn the case that the REGISTER request from the UE containing an \"auts\" Authorization header field parameter, indicating that the SQN was deemed to be out of range by the UE), the S-CSCF will fetch new authentication vectors from the HSS. In order to indicate a resynchronisation, the S-CSCF shall include the value of the \"auts\" header field parameter received from the UE and the stored , when fetching the new authentication vectors. On receipt of the new authentication vectors from the HSS, the S-CSCF shall either:\n-\tsend a 401 (Unauthorized) response to initiate a further authentication attempt, using these new vectors; or\n-\trespond with a 403 (Forbidden) response if the authentication attempt is to be abandoned. The S-CSCF shall not update the registration state of the subscriber.\nNOTE 2:\tIf the UE was registered before, it stays registered until the registration expiration time expires.\nNOTE 3:\tSince the UE responds only to two consecutive invalid challenges, the S-CSCF will send a 401 (Unauthorized) response that contains a new challenge only twice.\nNOTE 4:\tIn the case of an \"auts\" Authorization header field parameter being present in the REGISTER request, the \"response\" Authorization header field parameter in the same REGISTER request will not be taken into account by the S-CSCF.\nIn the case that the S-CSCF receives a REGISTER request with the \"integrity-protected\" header field parameter in the Authorization header field set to \"yes\", for which the public user identity received in the To header field and the private user identity received in the \"username\" Authorization header field parameter of the REGISTER request do not match to any registered user at this S-CSCF, if the S-CSCF supports S-CSCF restoration procedures, the S-CSCF shall behave as described in subclause 5.4.1.2.2, otherwise the S-CSCF shall:\n-\trespond with a 500 (Server Internal Error) response to the UE.\nNOTE 5:\tThis error is not raised if there is a match on the private user identity, but no match on the public user identity.\nIn the case that the REGISTER request, that contains the authentication challenge response from the UE does not match with the expected REGISTER request (e.g. wrong Call-Id or authentication challenge response) and the request has the \"integrity-protected\" header field parameter in the Authorization header field set to either \"tls-pending\", \"tls-yes\", \"ip-assoc-pending\", or \"ip-assoc-yes\", the S-CSCF shall do one of the following:\n-\tsend a 403 (Forbidden) response to the UE. The S CSCF shall consider this authentication attempt as failed. The S-CSCF shall not update the registration state of the subscriber; or\n-\trechallenge the user by issuing a 401 (Unauthorized) response including a challenge as per the authentication procedures described in subclause 5.4.1.2.1B.\nNOTE 1:\tIf the UE was registered before, it stays registered until the registration expiration time expires.\nIn the case that the REGISTER request from the UE contains an invalid \"nonce\" Authorization header field parameter with a valid challenge response for that nonce (indicating that the client knows the correct username/password), or when the nonce-count value sent by the UE is not the expected value, the S-CSCF shall:\n-\tsend a 401 (Unauthorized) response to initiate a further authentication attempt with a fresh nonce and the \"stale\" header field parameter set to \"true\" in the -Authenticate header field.\nIn the case that the S-CSCF receives a REGISTER request with the \"integrity-protected\" header field parameter in the Authorization header field set to \"tls-pending\", \"tls-yes\", \"ip-assoc-pending\", or \"ip-assoc-yes\", for which the public user identity received in the To header field and the private user identity received in the Authorization header field of the REGISTER request do not match to any registered or initial registration pending user at this S-CSCF, if the S-CSCF supports S-CSCF restoration procedures, the S-CSCF shall behave as described in subclause 5.4.1.2.2A, otherwise the S-CSCF shall:\n-\trespond with a 500 (Server Internal Error) response to the UE.\nNOTE 2:\tThis error is not raised if there is a match on the private user identity, but no match on the public user identity.\nThe procedures for subclause 5.4.1.2.3B apply.\nThere are no abnormal cases for NASS-IMS bundled authentication.\nThere are no abnormal cases for GPRS-IMS-Bundled authentication.\nAuthentication and re-authentication is performed by the registration procedures as described in subclause 5.4.1.2.\nWhen S-CSCF receives a REGISTER request with the registration expiration interval value containing the value zero, the S-CSCF shall:\n1)\tverify that the REGISTER request is associated with an existing registered contact or an existing flow or, if the S-CSCF restoration procedures are supported by this S-CSCF, attempt to restore a contact or flow from HSS associated with the REGISTER request. If no associated contact or flow exists then the S-CSCF shall send a 481 (Call Leg/Transaction Does Not Exist) response to the UE and skip the remaining procedures in this subclause;\n2)\tif IMS AKA is in use as the security mechanism, check whether the \"integrity-protected\" header field parameter in the Authorization header field set to \"yes\", indicating that the REGISTER request was received integrity protected. The S-CSCF shall only proceed with the following steps if the \"integrity-protected\" header field parameter is set to \"yes\";\n3)\tif SIP digest without  or SIP digest with  is in use as a security mechanism, check whether the \"integrity-protected\" header field parameter in the Authorization header field set to \"tls-yes\" or \"ip-assoc-yes\", indicating that the REGISTER request was received from a previously registered user. If the \"integrity-protected\" header field parameter is set to \"tls-pending\", \"ip-assoc-pending\" or is not present the S-CSCF shall ensure authentication is performed as described in subclause 5.4.1.2.1 (and consequently subclause 5.4.1.2.1B or 5.4.1.2.1C) if local policy requires. The S-CSCF shall only proceed with the following steps if the \"integrity-protected\" header field parameter is set to \"tls-yes\", \"ip-assoc-yes\", or the required authentication is successfully performed if required by local policy;\n4)\tif NASS-IMS bundled authentication is in use as a security mechanism, only proceed with the following steps if the \"integrity-protected\" header field parameter in the Authorization header field does not exist or without an Authorization header field, and one or more Line-Identifiers previously received over the Cx interface, stored as a result of an Authentication procedure with the HSS, as described in 3GPP TS 29.228 [14], are available for the user;\n4A)\tif the security mechanism as described in subclause 5.4.1.2.2E is in use, check whether the \"integrity-protected\" header field parameter in the Authorization header field set to \"auth-done\". The S-CSCF shall only proceed with the following steps if the \"integrity-protected\" header field parameter is set to \"auth-done\";\n5)\trelease all INVITE dialogs that include this user's contact addresses or the flows that are being deregistered, and where these dialogs were initiated by or terminated towards these contact addresses and the same public user identity found that was To header field that was received REGISTER request or with one of the implicitly registered public user identities by applying the steps listed in subclause 5.4.5.1.2;\n6)\texamine the Contact header field in the REGISTER request, and:\na)\tif the value \"*\" is not included in the Contact header field and:\ni)\tif the \"reg-id\" header field parameter is not included in the Contact header field, then:\n-\tremove the binding (i.e. deregister) between the public user identity found in the To header field together with the implicitly registered public user identities and the contact addresses specified in the REGISTER request. The S-CSCF shall only remove the contact addresses that were registered by this UE;\nii)\tif the \"reg-id\" header field parameter and \"+sip.instance\" header field parameter are included in the Contact header field, and the UE supports multiple registrations (i.e. the \"outbound\" option tag is included in the Supported header field), then:\n-\tremove the binding (i.e. deregister) between the public user identity indicated in the To header field (together with the associated implicitly registered public user identities) and the flow identified by the \"reg-id\" header field parameter;\n7)\tif the S-CSCF receives a REGISTER request with the value \"*\" in the Contact header field and the value zero in the Expires header field, remove all contact addresses that were bound to the public user identity found in the To header field and have been registered by this UE identified with its private user identity;\n8)\tfor all service profiles in the implicit registration set send a third-party REGISTER request, as described in subclause 5.4.1.7, to each AS that matches the Filter Criteria of the service profile from the HSS for the REGISTER event;\n9)\tif this is a deregistration request for the only public user identity currently registered with its associated set of implicitly registered public user identities (i.e. no other is registered) and there are still active multimedia sessions that includes this user's registered contact address, where the session was initiated by or terminated towards the contact with the registered contact address for that public user identity which is currently registered or with one of the implicitly registered public user identities, release only each of these multimedia sessions associated with the registered contact address by applying the steps listed in subclause 5.4.5.1.2. The S-CSCF shall only release dialogs associated to the multimedia sessions originated or terminated towards the registered user's contact address; and\n10)\tsend a 200 (OK) response to a REGISTER request that contains a list of Contact header fields enumerating all contacts and flows that are currently registered, and all contacts that have been deregistered. For each contact address and the flow that has been deregistered, the Contact header field shall contain the contact address and the \"reg-id\" header field parameter that identifies the flow, if a flow was deregistered, and the associated information, and the registration expiration interval value shall be set to zero.\nIf all public user identities of the UE are deregistered, then the S-CSCF may consider the UE and P-CSCF subscriptions to the reg event package cancelled (i.e. as if the UE had sent a SUBSCRIBE request with an Expires header field containing a value of zero).\nIf the Authorization header field of the REGISTER request contained an \"integrity-protected\" header field parameter set to the value \"no\", the S-CSCF shall apply the procedures described in subclause 5.4.1.2.1.\nOn completion of the above procedures in this subclause and of the S-CSCF Registration/deregistration notification procedure with the HSS, as described in 3GPP TS 29.228 [14], for one or more public user identities, the S-CSCF shall:\n1)\tupdate or remove those public user identities, their registration state and the associated service profiles from the local data; and\n2)\tif all the contacts bound to the public user identities have been deregistered and there is no ongoing session due to the public user identities, then remove all the stored AS IP addresses which are associated with those public user identities.\nBased on operators' policy the S-CSCF can request the HSS to either be kept or cleared as the S-CSCF allocated to this subscriber. If emergency contacts are still registered for this subscriber, the S-CSCF requests the HSS to be kept as the S-CSCF allocated to this subscriber.\nIf case that the S-CSCF receives a REGISTER request with the \"integrity-protected\" header field parameter in the Authorization header set to \"yes\" or to \"tls-connected\", for which the public user identity received in the To header and the private user identity received in the Authorization header of the REGISTER request do not match to any registered user at this S-CSCF, if the S-CSCF supports S-CSCF restoration procedures as specified in 3GPP TS 23.380 [7D], the S-CSCF shall behave as described in subclause 5.4.1.4.1, otherwise the S-CSCF shall:\n-\trespond with a 500 (Server Internal Error) response to the UE.\nNOTE:\tThis error is not raised if there is a match on the private user identity, but no match on the public user identity.\nThe procedures for subclause 5.4.1.4.2 apply.\nThere are no abnormal cases for NASS-IMS bundled authentication.\nThere are no abnormal cases for GPRS-IMS-Bundled authentication.\nNOTE 1:\tA network-initiated deregistration event that occurs at the S-CSCF can be received from the HSS or can be an internal event in the S-CSCF.\nFor any registered public user identity, the S-CSCF can deregister:\n-\tall contact addresses bound to the indicated public user identity (i.e. deregister the respective public user identity);\n-\tsome contact addresses bound to the indicated public user identity;\n-\ta particular contact address bound to the indicated public user identity; or\n-\tone or more registration flows and the associated contact address bound to the indicated public user identity, when the UE supports multiple registration procedure;\nby sending a single NOTIFY request.\nPrior to initiating the network-initiated deregistration for the only currently registered public user identity and its associated set of implicitly registered public user identities and wildcarded public user identities that have been registered either with the same contact address of the UE or the same registration flow and the associated contact address (if the multiple registration mechanism is used), i.e. there are no other public user identities registered either with this contact address or with this registration flow and the associated contact address (if the multiple registration mechanism is used), and there are still active multimedia sessions belonging either to this contact address or to this registration flow and the associated contact address (if the multiple registration mechanism is used), the S-CSCF shall release only multimedia sessions belonging to this contact address or to this registration flow and the associated contact address (if the multiple registration mechanism is used) as described in the following paragraph. The multimedia sessions for the same public user identity, if registered either with another contact address or another registration flow and the associated contact address (if the multiple registration mechanism is used) remain unchanged.\nPrior to initiating the network-initiated deregistration while there are still active multimedia sessions that are associated with this user and contact, the S-CSCF shall release none, some or all of these multimedia sessions by applying the steps listed in subclause 5.4.5.1.2 under the following conditions:\n-\twhen the S-CSCF does not expect the UE to reregister a given public user identity and its associated set of implicitly registered public user identities that have been registered with respective contact address (i.e. S-CSCF will set the event attribute within the respective <contact> element to \"rejected\" for the NOTIFY request, as described below), the S-CSCF shall release all sessions that are associated with the registered contact address for the public user identities using the contact address that is being deregistered, which includes the implicitly registered public user identities.\n-\twhen the S-CSCF expects the UE to reregister a given public user identity and its associated set of implicitly registered public user identities that have been registered with respective contact address (i.e. S-CSCF will set the event attribute within the respective <contact> element to \"deactivated\" for the NOTIFY request, as described below), the S-CSCF shall only release sessions that currently include the user's contact address, where the session was initiated by or terminated towards the user with the contact address registered to one of the public user identities using the contact address that is being deregistered, which includes the implicitly registered public user identities.\nWhen a network-initiated deregistration event occurs for one or more public user identities that are bound either to one or more contact addresses or registration flows and the associated contact addresses (if the multiple registration mechanism is used), the S-CSCF shall send a NOTIFY request to all subscribers that have subscribed to the respective reg event package. For each NOTIFY request, the S-CSCF shall:\n1)\tset the Request- and Route header field to the saved route information during subscription;\n2)\tset the Event header field to the \"reg\" value;\n3)\tin the body of the NOTIFY request, include as many <registration> elements as many public user identities the S-CSCF is aware of the user owns;\n4)\tset the aor attribute within each <registration> element to one public user identity:\na)\tset the <uri> sub-element inside each <contact> sub-element of each <registration> element to the respective contact address provided by the UE;\nb)\tif the public user identity:\ni)\thas been deregistered (i.e. all contact addresses and all registration flows and associated contact addresses bound to the indicated public user identity are removed) then:\n-\tset the state attribute within the <registration> element to \"terminated\";\n-\tset the state attribute within each <contact> element belonging to this UE to \"terminated\"; and\n-\tset the event attribute within each <contact> element belonging to this UE to either \"unregistered\", or \"deactivated\" if the S-CSCF expects the UE to reregister or \"rejected\" if the S-CSCF does not expect the UE to reregister; or\nNOTE 2:\tIf the multiple registration mechanism is used, then the reg-id header field parameter will be included as an <unknown-param> element within each respective <contact> element.\nNOTE 3:\tThe UE will consider its public user identity as deregistered when the binding between the respective public user identity and all contact addresses and all registration flows and associated contact addresses (if the multiple registration mechanism is used) belonging to the UE have been removed.\nii)\thas been kept registered then:\nI)\tset the state attribute within the <registration> element to \"active\";\nII)\tset the state attribute within each <contact> element to:\n-\tfor the binding between the public user identity and either the contact address or a registration flow and associated contact addresses (if the multiple registration mechanism is used) to be removed set the state attribute within the <contact> element to \"terminated\", and event attribute element to either \"unregistered\", or \"deactivated\" if the S-CSCF expects the UE to reregister or \"rejected\" if the S-CSCF does not expect the UE to reregister; or\n-\tfor the binding between the public user identity and either the contact address or the registration flow and associated contact addresses (if the multiple registration mechanism is used) which remain unchanged, if any, leave the <contact> element unmodified, and if the contact has been assigned GRUUs and the Contact  did not contain a \"bnc\" SIP  parameter then set the <pub-gruu> and <temp-gruu> sub-elements of the <contact> element as specified in RFC 5628 [94] and include the <unknown-param> sub-element within each <contact> to any additional header field parameters contained in the Contact header field of the REGISTER request according to RFC 3680 [43]; and\nNOTE 4:\tThere might be more than one contact information available for one public user identity. When deregistering this UE, the S-CSCF will only modify the <contact> elements that were originally registered by this UE using its private user identity. The <contact> elements of the same public user identity, if registered by another UE using different private user identities remain unchanged.\n5)\tadd a P-Charging-Vector header field with the \"icid-value\" header field parameter set to the value populated in the initial request for the dialog and a type 1 \"orig-ioi\" header field parameter. The S-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The S-CSCF shall not include the type 1 \"term-ioi\" header field parameter.\nThe S-CSCF shall only include the non-barred public user identities in the NOTIFY request.\nWhen sending a final NOTIFY request with all <registration> element(s) having their state attribute set to \"terminated\" (i.e. all public user identities have been deregistered or expired), the S-CSCF shall also terminate the subscription to the registration event package by setting the Subscription-State header field to the value of \"terminated\".\nAlso, for all service profiles in the implicit registration set the S-CSCF shall send a third-party REGISTER request, as described in subclause 5.4.1.7, to each AS that matches the Filter Criteria of the service profile from the HSS as if a equivalent REGISTER request had been received from the user deregistering that public user identity, or combination of public user identities.\nOn completion of the above procedures for one or more public user identities linked to the same private user identity, the S-CSCF shall consider those public user identities and the associated implicitly registered public user identities which have no contact address or a registration flow and associated contact addresses (if the multiple registration mechanism is used) bound to them as deregistered. On completion of the S-CSCF Registration/deregistration notification procedure with the HSS, as described in 3GPP TS 29.228 [14], the S-CSCF shall:\n1)\tupdate or remove those public user identities linked to the same private user identity, their registration state and the associated service profiles from the local data (based on operators' policy the S-CSCF can request of the HSS to either be kept or cleared as the S-CSCF allocated to this subscriber); and\n2)\tif all the contacts bound to the public user identities have been deregistered and there is no ongoing session due to the public user identities, then remove all the stored AS IP addresses which are associated with those public user identities.\nOn the completion of the network-initiated de-registration by the HSS procedure, as described in 3GPP TS 29.228 [14], the S-CSCF shall remove:\n1)\tthose public user identities, their registration state and the associated service profiles from the local data; and\n2)\tif all the contacts bound to the public user identities have been deregistered and there is no ongoing session due to the public user identities, then remove all the stored AS IP addresses which are associated with those public user identities.\nThe S-CSCF may request a subscriber to re-authenticate at any time, based on a number of possible operator settable triggers.\nNOTE 1:\tTriggers for re-authentication include e.g. a current registration of the UE is set to expire at a predetermined time; one or more error conditions in the S-CSCF; the S-CSCF mistrusts the UE, the S-CSCF receives an access update requesting re-authentication as specified in subclause 5.2.14.\nIf the S-CSCF is informed that a private user identity needs to be re-authenticated, the S-CSCF shall generate a NOTIFY request on all dialogs which have been established due to subscription to the reg event package of that user. For each NOTIFY request the S-CSCF shall:\n1)\tset the Request- and Route header field to the saved route information during subscription;\n2)\tset the Event header field to the \"reg\" value;\n3)\tin the body of the NOTIFY request, include as many <registration> elements as many public user identities the S-CSCF is aware of the user owns:\na)\tset the <uri> sub-element inside the <contact> sub-element of each <registration> element to the contact address provided by the UE;\nb)\tset the aor attribute within each <registration> element to one public user identity;\nc)\tset the state attribute within each <registration> element to \"active\";\nd)\tset the state attribute within each <contact> element to \"active\";\ne)\tset the event attribute within each <contact> element that was registered by this UE to \"shortened\";\nf)\tset the expiry attribute within each <contact> element that was registered by this UE to an operator defined value; and\ng)\tif the Contact  did not contain a \"bnc\" SIP  parameter then set the <pub-gruu> and <temp-gruu> sub-elements within each <contact> element as specified in subclause 5.4.2.1.2; and\nNOTE 2:\tThere might be more than one contact information available for one public user identity. The S-CSCF will only modify the <contact> elements that were originally registered by this UE using its private user identity. The S-CSCF will not modify the <contact> elements for the same public user identitity, if registered by another UE using different private user identity.\n4)\tset a P-Charging-Vector header field with the \"icid-value\" header field parameter set to the value populated in the initial request for the dialog and a type 1 \"orig-ioi\" header field parameter. The S-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The S-CSCF shall not include the type 1 \"term-ioi\" header field parameter.\nAfterwards the S-CSCF shall wait for the user to re-authenticate (see subclause 5.4.1.2).\nNOTE 3:\tNetwork initiated re-authentication can occur due to internal processing within the S-CSCF.\nThe S-CSCF shall only include the non-barred public user identities in the NOTIFY request.\nWhen generating the NOTIFY request, the S-CSCF shall shorten the validity of all registration lifetimes associated with this private user identity to an operator defined value that will allow the user to be re-authenticated.\nDuring registration, the S-CSCF shall include the P-Access-Network-Info header fields (as received in the REGISTER request from the UE and the P-CSCF) and a P-Visited-Network-ID header field (as received in the REGISTER request from the UE) in the third-party REGISTER request sent towards the ASs, if the AS is part of the trust domain. If the AS is not part of the trust domain, the S-CSCF shall not include any P-Access-Network-Info header field or P-Visited-Network-ID header field. The S-CSCF shall not include a P-Access-Network-Info header field in any responses to the REGISTER request.\nIf the registration procedure described in subclauses 5.4.1.2, 5.4.1.4 or 5.4.1.5 (as appropriate) was successful, the S-CSCF shall send a third-party REGISTER request to each AS with the following information:\na)\tthe Request-, which shall contain the AS's SIP ;\nb)\tthe From header field, which shall contain the S-CSCF's SIP ;\nc)\tthe To header field, which shall contain a non-barred public user identity belonging to the service profile of the processed Filter Criteria. It may be either a public user identity as contained in the REGISTER request received from the UE or one of the implicitly registered public user identities in the service profile, as configured by the operator;\nNOTE 1:\tFor the whole implicit registration set only one public user identity per service profile appears in the third-party REGISTER requests. Thus, based on third-party REGISTER requests only, the ASs will not have complete information on the registration state of each public user identity in the implicit registration set. The only way to have a complete and continuously updated information (even upon administrative change in subscriber's profile) is to subscribe to the reg event package.\nd)\tthe Contact header field, which shall contain the S-CSCF's SIP ;\ne)\tfor initial registration and user-initiated reregistration (subclause 5.4.1.2), the registration expiration interval value, which shall contain the same value that the S-CSCF returned in the 200 (OK) response for the REGISTER request received from the UE;\nf)\tfor user-initiated deregistration (subclause 5.4.1.4) and network-initiated deregistration (subclause 5.4.1.5), the registration expiration interval value, which shall contain the value zero;\nNOTE 2:\tThe user can have one or more contacts registered after a third-party deregister. If an AS needs more detailed knowledge of the user registration status, the AS can subscribe to the reg event package.\ng)\tfor initial registration and user-initiated reregistration (subclause 5.4.1.2), a message body, if there is Filter Criteria indicating the need to include HSS provided data for the REGISTER event (e.g. HSS may provide AS specific data to be included in the third-party REGISTER) or if there is Filter Criteria indicating the need to include the contents of the incoming REGISTER request or the contents of the 200 (OK) response to the incoming REGISTER request in the body of the third-party REGISTER. The S-CSCF shall format the MIME body and set the value of the Content-Type header field to include the MIME type specified in subclause 5.4.1.7A;\nNOTE 3:\tWhen the AS is outside the trust domain for any header field that is permitted in the REGISTER request received from the UE or final response to the REGISTER request received from the UE, including an Include Register Request or Include Register Response indication in the initial Filter Criteria would cause the incoming REGISTER request or 200 (OK) response to the incoming REGISTER request contents to be delivered to the AS revealing information that AS is not trusted to obtain. Include Register Request and Include Register Response indication is therefore not included in the initial Filter Criteria for an AS that exists outside the trust domain for any such header field.\nh)\tfor initial registration and user-initiated reregistration, the P-Charging-Vector header field, which shall contain the same \"icid-value\" header field parameter that the S-CSCF received in the REGISTER request from the UE. The S-CSCF shall insert a type 3 orig-ioi parameter in place of any received \"orig-ioi\" header field parameter and shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The S-CSCF shall not include the type 3 \"term-ioi\" header field parameter;\ni)\tfor initial registration and user-initiated reregistration, a P-Charging-Function-Addresses header field, which shall contain the values received from the HSS if the message is forwarded within the S-CSCF home network;\nj)\tin case the received REGISTER request contained a P-User-Database header field and the AS belongs to the same operator as the S-CSCF, optionally a P-User-Database header field which shall contain the received value; and\nk)\tvoid\nl)\tif the S-CSCF supports using a token to identify the registration for initial registration and user initiated reregistration, a \"+g.3gpp.registration-token\" Contact header field parameter, as defined in subclause 7.9.7, set to a value identifying this registration among the set of registrations for the registered URI. The value shall be the same until the UE is deregistered.\nNOTE 4:\tSetting the value of the registration-token to the same value as the S-CSCF will use for the \"id\" parameter identifying this contact in the \"reg\" event package allows the AS to retrieve the value using the \"reg\" event package.\nFor third-party REGISTER upon user-initiated reregistration, user-initiated deregistration or network-initiated deregistration, the S-CSCF shall send SIP REGISTER request towards the IP address associated with the corresponding registered public user identity stored as described in subclause 5.4.0.\nWhen the S-CSCF receives any response to a third-party REGISTER request, the S-CSCF shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present.\nNOTE 5:\tAny received \"term-ioi\" header field parameter will be a type 3 IOI. The type 3 IOI identifies the service provider from which the response was sent.\nIf the S-CSCF fails to receive a SIP response or receives a 408 (Request Timeout) response or a 5xx response to a third-party REGISTER, the S-CSCF shall:\n-\tif the default handling defined in the filter criteria indicates the value \"SESSION_CONTINUED\" as specified in 3GPP TS 29.228 [14] or no default handling is indicated, no further action is needed; and\n-\tif the default handling defined in the filter criteria indicates the value \"SESSION_TERMINATED\" as specified in 3GPP TS 29.228 [14], initiate the network-initiated deregistration as described in subclause 5.4.1.5 for the currently registered public user identity and its associated set of implicitly registered non-barred public user identities bound to the contact(s) registered in the REGISTER request causing the third-party REGISTER request.\nIf there is a service information XML element provided in the HSS Filter Criteria for an AS (see 3GPP TS 29.228 [14]), then in the third-party REGISTER request the S-CSCF shall:\n-\tinclude in the message body the service information within the <service-info> XML which is a child XML element of an <ims-3gpp> element with the \"version\" attribute set to \"1\" element as described in subclause 7.6; and\n-\tset the value of the content type to the MIME type specified in subclause 7.6.\nIf there is an Include Register Request XML element provided in the HSS Filter Criteria for an AS (see 3GPP TS 29.228 [14]), then in the third-party REGISTER request the S-CSCF shall:\n-\tinclude in the message body the incoming SIP REGISTER request within a \"message/sip\" MIME body as defined in RFC 3261 [26]; and\n-\tset the value of the content type to \"message/sip\".\nIf there is an Include Register Response XML element provided in the HSS Filter Criteria for an AS (see 3GPP TS 29.228 [14]), then in the third-party REGISTER request, the S-CSCF shall:\n-\tinclude in the message body the 200 (OK) response to the incoming SIP REGISTER request within a \"message/sip\" MIME body as defined in RFC 3261 [26]; and\n-\tset the value of the content type to \"message/sip\".\nIf there is more than one message body to be included in the third-party REGISTER request then in the third-party REGISTER request the S-CSCF shall:\n-\tinclude a multipart message body and set the value of the Content-Type header field to \"multipart/mixed\" as specified in RFC 2046 [149] and RFC 5621 [150]; and\n-\tset the Content-Type of the elements of the MIME body to the content type specified for the body.\nIf there is only one message body to be included in the third-party REGISTER request then the S-CSCF sets the Content-Type header field to the content type specified for the body.\nNOTE 1:\tThe S-CSCF can receive an update of subscriber data notification on the Cx interface, from the HSS, which can affect the stored information about served public user identities. According to 3GPP TS 29.228 [14], the changes are guaranteed not to affect the default public user identity within the registration implicit set.\nWhen receiving a Push-Profile-Request (PPR) from the HSS (as described in 3GPP TS 29.228 [14]), modifying the service profile of served public user identities, the S-CSCF shall:\n1)\tif the modification consists in the addition of a new non-barred public user identity to an implicit set, or in the change of status from barred to non-barred for a public user identity already in the implicit set, add the public user identity to the list of registered, non-barred public user identities;\n2)\tif the modification consists in the deletion of a public user identity while there are no active multimedia session belonging to this public user identity, or in the change of status from non-barred to barred of a public user identity in an implicit set, remove the public user identity from the list of registered, non-barred public user identities;\nNOTE 2:\tAs the S-CSCF checks the barring status of the public user identity on receipt of a initial request for a dialog, or a standalone transaction, the above procedures have no impact on transactions or dialogs already in progress and are effective only for new transactions and dialogs.\n3)\tif the modification consists of deletion of a public user identity from an implicit registration set while there are active multimedia session belonging to this public user identity and contact, release these multimedia sessions as described in subclause 5.4.5.1.2 and after all multimedia sessions are released, remove the public user identity from the list of registered, non-barred public user identities; and\n4)\tsynchronize with the UE and IM CN entities, by either:\n-\tperforming the procedures for notification of the reg-event subscribers about registration state, as described in subclause 5.4.2.1.2; or\n-\ttriggering the UE to reregister, by:\na)\tdepending on operator configuration, rejecting a request from the UE using a 504 (Server Time-out) response and indicating in the response that S-CSCF restoration procedures are supported, in accordance with subclause 5.4.3.2; or\nb)\tshortening the life time of the current registration, as described in subclause 5.4.1.6, e.g. when a new trigger point of Register method is added in the iFCs.\nNOTE 3:\tThe UE procedure in response to receiving a rejection as described in item a) (see subclause 5.1.2A.1.6) is specified for UEs since 3GPP Rel-8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.2\tSubscription and notification",
                            "text_content": "When an incoming SUBSCRIBE request addressed to S-CSCF arrives containing the Event header field with the reg event package, the S-CSCF shall:\n0) if the Request- of the SUBSCRIBE request contains a  for which currently no binding exists, then send a 480 (Temporarily Unavailable) response indicating that the subscription was not successful and skip the remainder of the steps;\n1)\tcheck if, based on the local policy, the request was generated by a subscriber who is authorised to subscribe to the registration state of this particular user. The authorized subscribers include:\n-\tall public user identities this particular user owns, that the S-CSCF is aware of, and which are not-barred;\n-\tall the entities identified by the Path header field (i.e. the P-CSCF to which this user is attached to or the IBCF which encrypted the Path header field); and\n-\tall the ASs listed in the initial filter criteria that are part of the trust domain;\nif the request is received from a subscriber which is not auhorized to subscribe to the registration state of this particular user, then send a 403 (Forbidden) response indicating that the subscription was not successful and skip the remainder of the steps;\nNOTE 1:\tThe S-CSCF finds the identity for authentication of the subscription in the P-Asserted-Identity header field received in the SUBSCRIBE request.\n1A)\tif the Request- of the SUBSCRIBE request identifies a public user identity that was implicitly registered using the registration procedures defined in RFC 6140 [191] and performs the functions of an external attached network, and the registration is currently active, then skip the remainder of the procedure in this subclause and route the SUBSCRIBE request to the UE performing the functions of an externally attached network using the procedures defined in subclause 5.4.3.3;\n1B)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n2)\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present;\nNOTE 2:\tAny received \"orig-ioi\" header field parameter will be either a type 1 IOI or a type 3 IOI. The type 1 IOI identifies the sending network and the type 3 IOI identifies the service provider from which the request was sent.\n3)\tgenerate a 200 (OK) response acknowledging the SUBSCRIBE request and indicating that the authorised subscription was successful as described in RFC 3680 [43] and RFC 6665 [28]. The S-CSCF shall populate the header fields as follows:\n-\tan Expires header field, set to either the same or a decreased value as the Expires header field in SUBSCRIBE request;\n-\tif the request originated from an ASs listed in the initial filter criteria, a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the SUBSCRIBE request, a type 3 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The S-CSCF shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request; and\n-\tif the request originated from a public user identity this particular user owns, or any of the entities identified by the Path header field, a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the SUBSCRIBE request, a type 1 \"term-ioi\" header field parameter, and the \"icid-value\" header field parameter. The S-CSCF shall set the type 1 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request.\nThe S-CSCF may set the Contact header field to an identifier uniquely associated to the SUBSCRIBE request and generated within the S-CSCF, that may help the S-CSCF to correlate refreshes for the SUBSCRIBE dialog; and\nNOTE 3:\tThe S-CSCF could use such unique identifiers to distinguish between UEs, when two or more users, holding a shared subscription, register under the same public user identity.\n4)\tdetermine the applicable private user identity as the private user identity included in a REGISTER request:\n-\twhich created (implicitly or explictly) a binding of the public user identity in the Request- of the SUBSCRIBE request to an contact address; and\n-\tfor which one of the following is true:\na)\tthe 200 (OK) response to the REGISTER request contained the Service-Route header field with the S-CSCF  matching the  in the top Route header field of the SUBSCRIBE request (i.e. the SUBSCRIBE request originated by a served UE); or\nb)\tthe 200 (OK) response to the REGISTER request contained a Path header field with a  matching the  in the P-Asserted-Identity header field of the SUBSCRIBE request (i.e. the SUBSCRIBE request originated by a P-CSCF serving a UE).\nNOTE 4:\tIf the  in the P-Asserted-Identity header field of the initial SUBSCRIBE request matches URIs of several Path header fields (e.g. the SUBSCRIBE request is originated by Rel-7 P-CSCF), the applicable private user identity is not determined.\nAfterwards the S-CSCF shall perform the procedures for notification about registration state as described in subclause 5.4.2.1.2.\nIf the SUBSCRIBE request originated from an AS listed in the initial filter criteria, for any response that is not a 2xx response, the S-CSCF shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the SUBSCRIBE request, a type 3 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The S-CSCF shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request.\nIf the SUBSCRIBE request originated from a public user identity this particular user owns, or any of the entities identified by the Path header field, for any response that is not a 2xx response, the S-CSCF shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the SUBSCRIBE request, a type 1 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The S-CSCF shall set the type 1 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request.\nWhen the S-CSCF receives a subscription refresh request for a dialog that was established by the UE subscribing to the reg event package, the S-CSCF shall accept the request irrespective if the user's public user identity specified in the SUBSCRIBE request is either registered or has been deregistered.\nThe UE can bind any one of its public user identities either to its contact address or to a registration flow and the associated contact address (if the multiple registration mechanism is used) via a single registration procedure. When multiple registrations mechanism is used to register a public user identity and bind it to a registration flow and the associated contact address, the S-CSCF shall generate a NOTIFY request that includes one <contact> element for each binding between a public user identity and a registration flow and the associated contact address.\nNOTE 1:\tIf the UE binds a given public user identity to the same contact address but several registration flows and the associated contact address (via several registrations), then the NOTIFY request will contain one <contact> element for each registration flow and the associated contact address. Each respective <contact> elements will contain the same contact address in the <uri> sub-element, but different value in the \"id\" attribute and different \"reg-id\" value included in the respective <unknown-param> element.\nFor every successful registration that creates a new binding between a public user identity and either its contact address or the registration flow and the associated contact address (if the multiple registration mechanism is used, the NOTIFY request shall always include a new <contact> element containing new value in the \"id\" sub-element, the state attribute set to \"active\", and event attribute set to either \"registered\" or \"created\".\nAny successful registration (that creates a new binding between a public user identity and either its contact address or a registration flow and associated contact address) may additionally replace or remove one or more existing bindings. In the NOTIFY request, for each replaced or removed binding, the <contact> element shall have the state attribute set to \"terminated\" and the event attribute set to \"unregistered\", \"deactivated\", or \"rejected\".\nNOTE 2:\tWhen multiple registrations mechanism is not used, if the UE registers new contact address then all registrations, if any, using an old contact address are deregistered, i.e. the new registration replaces the old registrations. Hence, for each deregistered public user identity, the NOTIFY request will have the state attribute within the <registration> element set to \"terminated\" and the state attribute in the <contact> element set to \"terminated\" and the event attribute set to \"unregistered\", \"deactivated\", or \"rejected\".\nNOTE 3:\tIf the UE uses a multiple registrations mechanism to bind a public user identity to a new registration flow the registration flow and the associated contact address, and if the new registration flow replaces an existing registration flow, then for the registration flow and the associated contact address being replaced, the respective <contact> element in the NOTIFY request will have the state attribute set to \"terminated\" and the event attribute set to \"unregistered\", \"deactivated\", or \"rejected\".\nThe S-CSCF shall send a NOTIFY request:\n-\twhen an event pertaining to the user occurs. In this case the NOTIFY request is sent on all dialogs which have been established due to subscription to the reg event package of that user; and\n-\tas specified in RFC 6665 [28].\nWhen sending a NOTIFY request, the S-CSCF shall not use the default filtering policy as specified in RFC 3680 [43], i.e. the S-CSCF shall always include in every NOTIFY request the state information of all registered public user identities of the user (i.e. the full state information).\nNOTE 4:\tContact information related to emergency registration is not included.\nWhen generating NOTIFY requests, the S-CSCF shall not preclude any valid reg event package parameters in accordance with RFC 3680 [43].\nFor each NOTIFY request triggered by an event and on all dialogs which have been established due to subscription to the reg event package of that user, the S-CSCF shall:\n1)\tset the Request- and Route header field to the saved route information during subscription;\n2)\tset the Event header field to the \"reg\" value;\n3)\tin the body of the NOTIFY request, include one <registration> elements for each public user identity that the S-CSCF is aware the user owns.\nIf the user shares one or more public user identities with other users, the S-CSCF shall include any contact addresses registered by other users of the shared public user identity in the NOTIFY request;\n4)\tfor each <registration> element:\na)\tset the aor attribute to one public user identity or if the public user identity of this <registration> element is a wildcarded public user identity, then choose arbitrarily a public user identity that matches the wildcarded public user identity and the service profile of the wildcarded public user identity and set the aor attribute to this public user identity;\nNOTE 5:\tIf the public user identity of this <registration> element is a wildcarded public user identity, the value of the aor attribute will not be used by the receiver of the NOTIFY.\nb)\tset the <uri> sub-element inside each <contact> sub-element of the <registration> element to the contact address provided by the respective UE as follows:\nI)\tif the aor attribute of the <registration> element contains a SIP  and if the Contact  did not contain a \"bnc\" SIP  parameter, then for each contact address that contains a \"+sip.instance\" Contact header field parameter, include <pub-gruu> and <temp-gruu> sub-elements within the corresponding <contact> element. The S-CSCF shall set the contents of these elements as specified in RFC 5628 [94]; or\nII)\tif the aor attribute of the <registration> element contains a tel-, determine its alias SIP  and if the Contact  did not contain a \"bnc\" SIP  parameter then include a copy of the <pub-gruu> and <temp-gruu> sub-elements from that equivalent element;\nc)\tif the respective UE has provided a display-name in a Contact header field, set the <display-name> sub-element inside the respective <contact> sub-element of the <registration> element to the value provided by the UE according to RFC3680 [43];\nd)\tif the user owns a wildcarded public user identity then include a <wildcardedIdentity> sub-element as described in subclause 7.10.2;\ne)\tif the public user identity set in step a):\nI)\thas been deregistered either by the UE or the S-CSCF (i.e. upon the deregistration, there are no binding left between this public user identity and either a contact address or a registration flows and associated contact addresses that belong to this user) then:\n-\tset the state attribute within the <registration> element to \"terminated\";\n-\tset the state attribute within each <contact> element belonging to this user to \"terminated\"; and\n-\tset the event attribute within each <contact> element to \"deactivated\", \"expired\", \"unregistered\", \"rejected\" or \"probation\" according to RFC 3680 [43].\nIf the public user identity has been deregistered for this user and this deregistration has already been indicated in the NOTIFY request, and no new registration for this user has occurred, its <registration> element shall not be included in the subsequent NOTIFY requests;\nII)\thas been registered by the UE (i.e. the public user identity has not been previously bound either to a contact address or to a registration flow and the associated contact address (if the multiple registration mechanism is used)) then:\n-\tset the <unknown-param> element to any additional header field parameters contained in the Contact header field of the REGISTER request according to RFC 3680 [43];\nNOTE 6:\tIf the multiple registration mechanism is used, then the reg-id header field parameter will be included as an <unknown-param> element.\n-\tif the subscription contains, for the applicable private user identity (determined as described in subclause 5.4.2.1.1) and the public user identity, any of the policies described in subclause 7.10.3, then include the policy associated with the applicable private user identity and the public user identity using coding described in subclause 7.10.3;\n-\tset the state attribute within the <registration> element to \"active\"; and:\n-\tset the state attribute within the <contact> element belonging to this user to \"active\", include new value for the \"id\" attribute within the <contact> sub-element, and set the event attribute within this <contact> element to \"registered\";\nNOTE 7:\tIf this registration, that created new binding, additionally replaces or removes one or more existing registrations, then for the replaced or removed registrations the respective <registration> elements and <contact> elements will be modified accordingly.\nIII)\thas been reregistered (i.e. it has been previously registered) then:\n-\tset the state attribute within the <registration> element to \"active\";\n-\tif the subscription contains, for the applicable private user identity (determined as described in subclause 5.4.2.1.1) and the public user identity, any of the policies described in subclause 7.10.3, then include the policy associated with the applicable private user identity and the public user identity using coding described in subclause 7.10.3;\n-\tset the <unknown-param> element to any additional header field parameters contained in the Contact header field of the REGISTER request according to RFC 3680 [43];\n-\tfor contact addresses to be registered: set the state attribute within the <contact> element to \"active\"; and set the event attribute within the <contact> element to \"registered\";\n-\tfor contact addresses to be reregistered, set the state attribute within the <contact> element to \"active\"; and set the event attribute within the <contact> element to \"refreshed\" or \"shortened\" according to RFC 3680 [43]; and\n-\tfor contact addresses that remain unchanged, if any, leave the <contact> element unmodified (i.e. the event attribute within the <contact> element includes the last event that caused the transition to the respective state);\nIV)\thas been automatically registered or registered by the S-CSCF, and has not been previously automatically registered:\n-\tset the <unknown-param> element to any additional header field parameters contained in the Contact header field of the REGISTER request according to RFC 3680 [43];\n-\tset the state attribute within the <registration> element to \"active\";\n-\tset the state attribute within the <contact> element to \"active\"; and\n-\tset the event attribute within the <contact> element to \"created\"; or\nV)\tis hosted (unregistered case) at the S-CSCF:\n-\tset the state attribute within the <registration> element to \"terminated\";\n-\tset the state attribute within each <contact> element to \"terminated\"; and\n-\tset the event attribute within each <contact> element to \"unregistered\".\nThe S-CSCF shall also terminate the subscription to the registration event package by setting the Subscription-State header field to the value of \"terminated\"; and\nNOTE 8:\tThe value of \"init\" for the state attribute within the <registration> element is not used.\nf)\tset the callid and cseq attributes for the <contact> as specified in RFC 3680 [43], and the first-cseq attribute as specified in RFC 5628 [94]; and\nNOTE 9:\tErrata of RFC 5628 clarifies the usage of the first-cseq attribute of the <temp-gruu> element.\n5)\tset the P-Charging-Vector header field with the \"icid-value\" header field parameter set to the value populated in the initial request for the dialog, and\n-\tif the NOTIFY request is sent towards an AS listed in the initial filter criteria a type 3 \"orig-ioi\" header field parameter. The S-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The S-CSCF shall not include the type 3 \"term-ioi\" header field parameter; and\n-\tif the NOTIFY request is sent towards a public user identity this particular user owns, or any of the entities identified by the Path header field, a type 1 \"orig-ioi\" header field parameter. The S-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The S-CSCF shall not include the type 1 \"term-ioi\" header field parameter.\nNOTE 10:\tWhen sending a NOTIFY request to a subscriber subscribing or unsubscribing to the reg event package, or when the S-CSCF terminates the subscription, the event attribute within the <contact> element includes the last event that caused the transition to the respective state.\nThe S-CSCF shall only include the non-barred public user identities in the NOTIFY request.\nEXAMPLE 1:\tIf sip:user1_public1@home1.net is registered, the public user identity sip:user1_public2@home1.net can automatically be registered. Therefore the entries in the body of the NOTIFY request look like:\n<?xml version=\"1.0\"?>\n<reginfo xmlns=\"urn:ietf:params:xml:ns:reginfo\"\nxmlns:cp=\"urn:ietf:params:xml:ns:common-policy\"\nxmlns:eri=\"urn:3gpp:ns:extRegInfo:1.0\"\nversion=\"0\" state=\"full\">\n<registration aor=\"sip:user1_public1@home1.net\" id=\"as9\"\nstate=\"active\">\n<contact id=\"76\" state=\"active\" event=\"registered\">\n<uri>sip:[5555::aaa:bbb:ccc:ddd]</uri>\n<unknown-param name=\"audio\"/>\n</contact>\n</registration>\n<registration aor=\"sip:user1_public2@home1.net\" id=\"as10\"\nstate=\"active\">\n<contact id=\"86\" state=\"active\" event=\"created\">\n<uri>sip:[5555::aaa:bbb:ccc:ddd]</uri>\n<unknown-param name=\"audio\"/>\n</contact>\n<cp:actions>\n<eri:rph ns=\"wps\" val=\"1\"/>\n<eri:privSender/>\n</cp:actions>\n</registration>\n</reginfo>\n\nEXAMPLE 2:\tIf sip:user1_public1@home1.net is registered, the public user identity sip:ep_user1@home1.net can automatically be registered. sip:ep_user1@home1.net is a dedicated identity out of the related range indicated in the <wildcardedIdentity> element. Therefore the entries in the body of the NOTIFY request look like:\n<?xml version=\"1.0\"?>\n<reginfo xmlns=\"urn:ietf:params:xmlns:reginfo\"\nxmlns:ere=\"urn:3gpp:ns:extRegExp:1.0\"\nversion=\"0\" state=\"full\">\n<registration aor=\"sip:user1_public1@home1.net\" id=\"as10\"\nstate=\"active\">\n<contact id=\"86\" state=\"active\" event=\"created\">\n<uri>sip:[5555::aaa:bbb:ccc:ddd]</uri>\n</contact>\n</registration>\n<registration aor=\"sip:ep_user1@home1.net\" id=\"as11\"\nstate=\"active\">\n<contact id=\"86\" state=\"active\" event=\"created\">\n<uri>sip:[5555::aaa:bbb:ccc:ddd]</uri>\n</contact>\n<ere:wildcardedIdentity>sip:ep_user!.*!@home1.net\n</ere:wildcardedIdentity>\n</registration>\n</reginfo>\n\nWhen sending a final NOTIFY request with all <registration> element(s) having their state attribute set to \"terminated\" (i.e. all public user identities have been deregistered, expired or are hosted (unregistered case) at the S-CSCF), the S-CSCF shall also terminate the subscription to the registration event package by setting the Subscription-State header field to the value of \"terminated\".\nWhen all of a UE's contact addresses have been deregistered (i.e. there is no <contact> element set to \"active\" for this UE), the S-CSCF shall consider subscription to the reg event package belonging to the UE cancelled (i.e. as if the UE had sent a SUBSCRIBE request with an Expires header field containing a value of zero).\nThe S-CSCF shall only include the non-barred public user identities in the NOTIFY request.\nWhen the S-CSCF receives any response to the NOTIFY request, the S-CSCF shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present.\nNOTE 11:\tAny received \"term-ioi\" header field parameter will be a type 3 IOI if received from an AS or a type 1 IOI if received from a public user identity this particular user owns, or any of the entities identified by the Path header field. The type 3 IOI identifies the service provider from which the response was sent and the type 1 IOI identifies the network from which the response was sent.\nBased on operator policy, the S-CSCF may subscribe to the load-control event package with one or more target SIP entities. The list of target SIP entities is provisioned.\nSubscription to the load-control event package is triggered by internal events (e.g. the physical device hosting the SIP entity is power-cycled) or through a management interface.\nThe S-CSCF shall perform subscriptions to the load-control event package to a target entity in accordance with RFC 6665 [28] and with RFC 7200 [201]. When subscribing to the load-control event, the S-CSCF shall:\n1)\tSend a SUBSCRIBE request in accordance with RFC 6665 [28] and with RFC 7200 [201] to the target entity, with the following elements:\n-\tan Expires header field set to a network specific value;\n2)\tIf the target entity is located in a different network and local policy requires the application of IBCF capabilities, forward the request to an IBCF acting as an exit point.\nThe S-CSCF shall automatically refresh ongoing subscription to the load-control event package either 600 seconds before the expiration time if the initial subscription was for greater than 1200 seconds, or when half of the time has expired if the initial subscription was for 1200 seconds or less.\nThe S-CSCF can terminate a subscription according to RFC 6665 [28].\nUpon receipt of a NOTIFY request with the Subscription-State header field set to \"terminated\" and the S-CSCF has retained the SIP dialog state information for the associated subscription, once the NOTIFY transaction is terminated, the S-CSCF can remove all the stored information related to the associated subscription.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.3\tGeneral treatment for all dialogs and standalone transactions excluding requests terminated by the S-CSCF",
                            "text_content": "Upon receipt of an initial request or a stand-alone transaction, the S-CSCF shall:\n-\tperform the procedures for the UE-originating case as described in subclause 5.4.3.2 if the request makes use of the information for UE-originating calls, which was added to the Service-Route header field entry of the S-CSCF during registration (see subclause 5.4.1.2.2F), e.g. the message is received at a certain port or the topmost Route header field contains a specific user part or parameter; or,\n-\tperform the procedures for the UE-originating case as described in subclause 5.4.3.2 if the topmost Route header field of the request contains the \"orig\" parameter. The S-CSCF shall remove the \"orig\" parameter from the topmost Route header field; or,\n-\tperform the procedures for the UE-terminating case as described in subclause 5.4.3.3 if this information is not used by the request.\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field or a temporarily authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe S-CSCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the S-CSCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE 1:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nWhen the S-CSCF receives from the UE an initial request for a dialog, which contains a GRUU and an \"ob\" SIP  parameter in the Contact header field, and multiple contact addresses have been registered for the specific GRUU, then for all subsequent in-dialog requests sent toward the UE's, the S-CSCF shall populate the Request- with the registered contact address from which the UE sent the initial request for the dialog.\nNOTE 2:\tWhen a given contact address is registered, the S-CSCF can use a dedicated value in its Service-Route header field entry to identify the given contact address. When the S-CSCF receives an initial request for a dialog, the S-CSCF can find out from which contact address the initial request was sent by looking at the preloaded Route header field (constructed from the Service-Route header field returned in the response for the REGISTER request) which contains the entry of the S-CSCF.\nWhen performing SIP digest without , when the S-CSCF receives from the served user an initial request for a dialog or a request for a standalone transaction, the S-CSCF may perform the steps in subclause 5.4.3.6 to challenge the request based on local policy.\nNOTE 3:\tIf the user registration is associated with the state \"tls-protected\", then the execution of Proxy-Authorization as described in subclause 5.4.3.6 is still possible, although it is unlikely this would add additional security provided the P-CSCF is trusted. Thus, in most cases the state \"tls-protected\" will be reason for the S-CSCF to not desire Proxy-Authentication for this user.\nNOTE 4:\tThe option for the S-CSCF to challenge the request does not apply to a request from an AS acting as an originating UA.\nWhen performing GPRS-IMS-Bundled authentication, when the S-CSCF receives from the served user an initial request for a dialog or a request for a standalone transaction, the S-CSCF shall check whether a \"received\" header field parameter exists in the Via header field provided by the UE. If a \"received\" header field parameter exists, S-CSCF shall compare the (prefix of the) IP address received in the \"received\" header field parameter against the UE's IP address (or prefix) stored during registration. If no \"received\" header field parameter exists in the Via header field provided by the UE, then S-CSCF shall compare the (prefix of the) IP address received in the \"sent-by\" parameter against the IP address (or prefix) stored during registration. If the stored IP address (or prefix) and the (prefix of the) IP address in the \"received\" Via header field parameter provided by the UE do not match, the S-CSCF shall reject the request with a 403 (Forbidden) response. In case the stored IP address (or prefix) and the (prefix of the) IP address in the \"received\" Via header field parameter provided by the UE do match, the S-CSCF shall proceed as described in the remainder of this subclause.\nIf the S-CSCF supports HSS based P-CSCF restoration, and receives a request from a P-CSCF that the S-CSCF considers is not reachable, the S-CSCF shall consider this P-CSCF as being reachable.\nIf the S-CSCF supports PCRF based P-CSCF restoration, and receives a request from a P-CSCF that the S-CSCF considers is in a not reachable, the S-CSCF shall consider this P-CSCF as being reachable.\nWhen the S-CSCF receives from the served user or from a PSI an initial request for a dialog or a request for a standalone transaction, and the request is received either from a functional entity within the same trust domain or contains a valid original dialog identifier (see step 3) or the dialog identifier (From, To and Call-ID header fields) relates to an existing request processed by the S-CSCF, then prior to forwarding the request, the S-CSCF shall:\n0)\tif the request is received from a P-CSCF that does not support the trust domain handling of the P-Served-User header field then remove any P-Served-User header fields;\n1)\tdetermine the served user as follows:\na)\tif the request contains a P-Served-User header field then\ni)\tdetermine the served user by taking the identity contained in a P-Served-User header field as defined in RFC 5502 [133]. Then check whether the determined served user is a barred public user identity. In case the said header field contains the served user identity is a barred public user identity for the user, then the S-CSCF shall reject the request by generating a 403 (Forbidden) response. Otherwise, the S-CSCF shall save the public user identity of the served user and continue with the rest of the steps;\nNOTE 5:\tIf the P-Served-User header field contains a barred public user identity, then the message has been received, either directly or indirectly, from a non-compliant entity which should have had generated the content with a non-barred public user identity.\nb)\tif the request does not contain a P-Served-User header field then\ni)\tdetermine the served user by taking the identity contained in one of the (s) of the P-Asserted-Identity header field. In case the determined served user is a barred public user identity, then the S-CSCF shall reject the request by generating a 403 (Forbidden) response. Otherwise, the S-CSCF shall save the public user identity of the served user and continue with the rest of the steps; and\nii)\tif the P-Asserted-Identity header field contains two URIs and the  other than the determined served user is not an alias of the determined served user or is barred then act based on local policy, e.g. reject the request by generating a 403 (Forbidden) response or remove the  not identifying the determined served user from the P-Asserted-Identity header field;\nNOTE 6:\tIf the P-Asserted-Identity header field contains a barred public user identity, then the message has been received, either directly or indirectly, from a non-compliant entity which should have had generated the content with a non-barred public user identity.\n1A)\tif the Contact is a GRUU, but is not valid as defined in subclause 5.4.7A.4, then return a 4xx response as specified in RFC 5627 [93];\n2)\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present, and remove it from any forwarded request;\nNOTE 7:\tAny received \"orig-ioi\" header field parameter will be either a type 1 IOI or a type 3 IOI. The type 1 IOI identifies the network from which the request was sent and the type 3 IOI identifies the service provider from which the request was sent (AS initiating a session on behalf of a user or a PSI);\n3)\tcheck if an original dialog identifier that the S-CSCF previously placed in a Route header field is present in the topmost Route header field of the incoming request.\n-\tIf not present, the S-CSCF shall build an ordered list of initial filter criteria based on the public user identity of the served user (as determined in step 1) of the received request as described in 3GPP TS 23.218 [5].\n-\tIf present, the request has been sent from an AS in response to a previously sent request, an ordered list of initial filter criteria already exists and the S-CSCF shall not change the ordered list of initial filter criteria even if the AS has changed the P-Served-User header field or the P-Asserted-Identity header field;\nNOTE 8:\tAn original dialog identifier is sent to each AS invoked due to iFC evaluation such that the S-CSCF can associate requests as part of the same sequence that trigger iFC evaluation in priority order (and not rely on SIP dialog information that can change due to B2BUA AS). If the same original dialog identifier is included in more than one request from a particular AS (based on service logic in the AS), then the S-CSCF will continue the iFC evaluation sequence rather than build a new ordered list of iFC;\n4)\tremove its own SIP  from the topmost Route header field;\n4A)\tif a reference location was received from the HSS at registration as part of the user profile and the request does not contain a message body with the content type application/pidf+xml in accordance with RFC 6442 [89] and does not contain a P-Access-Network-Info header field containing the \"network-provided\" parameter, the S-CSCF shall insert a P-Access-Network-Info header field constructed according to the reference location received from the HSS and containing the \"network-provided\" parameter. The access type information received from the HSS shall be mapped into the corresponding access-type parameter of the P-Access-Network-Info header field and the location information shall be mapped into the location parameter corresponding to the access-type parameter, i.e. into \"dsl-location\" parameter, \"fiber-location\" parameter or \"eth-location\" parameter;\n4B)\tif there was an original dialog identifier present in the topmost Route header field of the incoming request and the request is received from a functional entity within the same trust domain and contains a P-Asserted-Service header field, continue the procedure with step 5;\n4C) if the request contains a P-Preferred-Service header field, check whether the ICSI value contained in the P-Preferred-Service header field is part of the set of the subscribed services for the served user and determine, using operator-configured data, whether the contents of the request match the ICSI for the subscribed service. The operator-configured data used to determine if there is a matching between the request and the ICSI value may be based on any information in the request (e.g. SDP media capabilities, Content-Type header field, request method). Then:\na)\tif there is no match between the request and the ICSI value, as an operator option, the S-CSCF may reject the request by generating a 403 (Forbidden) response. Otherwise remove the P-Preferred-Service header field and continue with the rest of the steps; and\nb)\tif there is a match between the request and the ICSI value, then include a P-Asserted-Service header field in the request containing the ICSI value contained in the P-Preferred-Service header field, remove the P-Preferred-Service header field, and continue the procedure with step 5;\n4D)\tif the request does not contain a P-Preferred-Service header field, check, using operator-configured data, whether the contents of the request match a subscribed service for each and any of the subscribed services for the served user:\na)\tif not, as an operator option, the S-CSCF may reject the request by generating a 403 (Forbidden) response; and\nb)\tif so, and if the request is related to an IMS communication service and the IMS communication service requires the use of an ICSI value then select an ICSI value for the related IMS communication service and include a P-Asserted-Service header field in the request containing the selected ICSI value; and\nNOTE 9:\tIf more than one ICSI values match the contents of the request, the S-CSCF selects an ICSI value based on local policy.\nc)\tif so, and if the request is related to an IMS communication service and the IMS communication service does not require the use of an ICSI value then continue without including an ICSI value; and\nd)\tif so, and if the request does not relate to an IMS communication service (or if the S-CSCF is unable to unambiguously determine the service being requested but decides to allow the session to continue) then continue without including an ICSI value;\n5)\tcheck whether the initial request matches any unexecuted initial filter criteria. If there is a match, then the S-CSCF shall select the first matching unexecuted initial filter criteria from the ordered list of initial filter criteria and the S-CSCF shall:\na)\tinsert the AS  to be contacted into the Route header field as the topmost entry followed by its own  populated as specified in the subclause 5.4.3.4;\nNOTE 10:\tIf the AS is accessed via an ISC gateway function, then the  will be the address of the ISC gateway function.\nb)\tif the S-CSCF supports the P-Served-User extension as specified in RFC 5502 [133] and RFC 8498 [239] insert P-Served-User header field populated with the served user identity as determined in step 1. If required by operator policy, the S-CSCF shall:\n-\tif the associated session case is \"Originating\" as specified in 3GPP TS 29.228 [14], include the sescase header field parameter set to \"orig\" and the regstate header field parameter set to \"reg\";\n-\tif the associated session case is \"Originating_Unregistered\" as specified in 3GPP TS 29.228 [14], include the sescase header field parameter set to \"orig\" and the regstate header field parameter set to \"unreg\";\n-\tif the associated session case is \"Originating_CDIV\" as specified in 3GPP TS 29.228 [14], include the \"orig-cdiv\" header field parameter, defined in RFC 8498 [239]; and\nc)\tif the AS is located outside the trust domain then the S-CSCF shall remove the access-network-charging-info parameter in the P-Charging-Vector header field from the request that is forwarded to the AS; if the AS is located within the trust domain, then the S-CSCF shall retain the access-network-charging-info parameter in the P-Charging-Vector header field in the request that is forwarded to the AS;\nd)\tinsert a type 3 \"orig-ioi\" header field parameter in place of any received \"orig-ioi\" header field parameters in the P-Charging-Vector header field. The S-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The S-CSCF shall not include the type 3 \"term-ioi\" header field parameter;\ne)\tremove the \"transit-ioi\" header field parameter, if received;\nf)\tbased on operator policy insert in a Relayed-Charge header field the value of the received \"transit-ioi\" header field parameter in the P-Charging-Vector header field;\ng)\tbased on local policy, the S-CSCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier;\nh)\tif the S-CSCF supports using a token to identify the registration and if a registration exists, insert a \"+g.3gpp.registration-token\" Feature-Caps header field parameter, as defined in subclause 7.9A.8, set to the same value as included in the \"+g.3gpp.registration-token\" Contact header field parameter of the third party REGISTER request sent to the AS when the UE registered; and\ni)\tif an IP address associated with the served user and the AS SIP URI is stored as described in subclause 5.4.0 exists, then the S-CSCF forwards the SIP message to the IP address associated with the served user and the AS SIP URI;\nNOTE 11:\tDepending on the result of processing the filter criteria the S-CSCF might contact one or more AS(s) before processing the outgoing Request-.\nNOTE 12:\tAn AS can activate or deactivate its own filter criteria via the Sh interface. As the S-CSCF checks initial filter criteria only on receipt of an initial request for a dialog, or a standalone transaction, a modified service profile will have no impact on transactions or dialogs already in progress and the modified profile will be effective only for new transactions and dialogs. If the S-CSCF receives a modification of the iFC during their execution, then it should not update the stored initial Filter Criteria until the iFC related to the initial request have been completely executed.\n6)\tif there was no original dialog identifier present in the topmost Route header field of the incoming request store the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and retain the \"icid-value\" header field parameter in the P-Charging-Vector header field. Optionally, the S-CSCF may generate a new, globally unique ICID and insert the new value in the \"icid-value\" header field parameter of the P-Charging-Vector header field when forwarding the message. If the S-CSCF creates a new ICID, then it is responsible for maintaining the two ICID values in the subsequent messaging. Based on local policy, the S-CSCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier if not already available;\n7)\tin step 5, if the initial request did not match any unexecuted initial filter criteria (i.e. the request is not forwarded to an AS):\na)\tremove the received \"transit-ioi\" from the P-Charging-Vector header field, if present;\nb)\tinsert a type 2 \"orig-ioi\" header field parameter into the P-Charging-Vector header field. The S-CSCF shall set the type 2 \"orig-ioi\" header field parameter to a value that identifies the sending network. The S-CSCF shall not include the type 2 \"term-ioi\" header field parameter; and\nc)\tremove the Relayed-Charge header field, if present;\n8)\tinsert a P-Charging-Function-Addresses header field populated with values received from the HSS if the request does not contain a P-Charging-Function-Addresses header field and the message is forwarded within the S-CSCF home network, including towards AS;\n9)\tif there was no original dialog identifier present in the topmost Route header field of the incoming request and if the served user is not considered a privileged sender then:\na)\tif the P-Asserted-Identity header field contains only a SIP  and if the S-CSCF has knowledge that the SIP  contained in the received P-Asserted-Identity header field is an alias SIP  for a tel , add a second P-Asserted-Identity header field containing this tel-, including the display name associated with the tel , if available; and\nb)\tif the P-Asserted-Identity header field contains only a tel , the S-CSCF shall add a second P-Asserted-Identity header field containing a SIP . The added SIP  shall contain in the user part a \"+\" followed by the international public telecommunication number contained in tel , and user's home network domain name in the hostport part. The added SIP  shall contain the same value in the display name as contained in the tel . The S-CSCF shall also add a \"user\" SIP  parameter equals \"phone\" to the SIP ;\nNOTE 13:\tIf tel  is shared  so is the alias SIP .\n10)\tif the request is not forwarded to an AS and if the outgoing Request- is:\n-\ta SIP  with the user part starting with a + and the \"user\" SIP  parameter equals \"phone\", and if configured per local operator policy, the S-CSCF shall perform the procedure described here. Local policy can dictate whether this procedure is performed for all domains of the SIP , only if the domain belongs to the home network, or not at all. If local policy indicates that the procedure is to be performed, then the S-CSCF shall translate the international public telecommunications number contained in the user part of the SIP  (see RFC 3966 [22]) to a globally routeable SIP  using either an ENUM/DNS translation mechanism with the format specified in RFC 6116 [24], or any other available database. Database aspects of ENUM are outside the scope of the present document. An S-CSCF that implements the additional routeing functionality described in annex I may forward the request without attempting translation. If an agreement exists between the home network and the visited network to support roaming architecture for voice over IMS with local breakout, the S-CSCF does not enable NP capabilities, and the S-CSCF decides to loopback the call to the visited network, the S-CSCF may forward the request without attempting translation. If a translation is in fact performed and it succeeds, the S-CSCF shall update the Request- with the globally routeable SIP  either returned by ENUM/DNS or obtained from any other available database. If this translation fails, the request may be forwarded to a BGCF or any other appropriate entity (e.g. a MRFC to play an announcement) in the originator's home network or the S-CSCF may send an appropriate SIP response to the originator. When forwarding the request to a BGCF or any other appropriate entity, the S-CSCF shall leave the original Request- containing the SIP  with \"user\" SIP  parameter equals phone unmodified. If the request is forwarded, the S-CSCF shall remove the access-network-charging-info parameter from the P-Charging-Vector header field prior to forwarding the message;\n-\ta SIP  with a \"user\" SIP  parameter equals \"dialstring\" and the domain name of the SIP  belongs to the home network (i.e. the local number analysis and handling is either failed in the appropriate AS or the request has not been forwarded to AS for local number analysis and handling at all), either forward the request to any appropriate entity (e.g a MRFC to play an announcement) in the originator's home network or send an appropriate SIP response to the originator;\n-\ta SIP  with a local number (see RFC 3966 [22]) in the user part and a \"user\" SIP  parameter equals \"phone\" and the domain name of the SIP  belongs to the home network (i.e. the local number analysis and handling is either failed in the appropriate AS or the request has not been forwarded to AS for local number analysis and handling at all), either forward the request to to a BGCFor any appropriate entity (e.g a MRFC to play an announcement) in the originator's home network or send an appropriate SIP response to the originator;\n-\ta tel  containing a global number (see RFC 3966 [22]) in the international format, the S-CSCF shall translate the E.164 address to a globally routeable SIP  using either an ENUM/DNS translation mechanism with the format specified in RFC 6116 [24], or any other available database. Database aspects of ENUM are outside the scope of the present document. An S-CSCF that implements the additional routeing functionality described in annex I may forward the request without attempting translation. If an agreement exists between the home network and the visited network to support roaming architecture for voice over IMS with local breakout, the S-CSCF does not enable NP capabilities, and the S-CSCF decides to loopback the call to the visited network, the S-CSCF may forward the request without attempting translation. If this translation is in fact performed and it succeeds, the S-CSCF shall update the Request- with the globally routeable SIP  returned by ENUM/DNS or any other available database. If this translation fails, the request may be forwarded to a BGCF or any other appropriate entity (e.g a MRFC to play an announcement) in the originator's home network or the S-CSCF may send an appropriate SIP response to the originator. When forwarding the request to a BGCF or any other appropriate entity, the S-CSCF shall leave the original Request- containing the tel  unmodified. If the request is forwarded, the S-CSCF shall remove the access-network-charging-info parameter from the P-Charging-Vector header field prior to forwarding the message;\n-\ta tel  containing a local number (see RFC 3966 [22]) (i.e. the local number analysis and handling is either failed in the appropriate AS or the request has not been forwarded to AS for local number analysis and handling at all), either forward the request to a BGCF or any other appropriate entity (e.g. a MRFC to play an announcement) in the originator's home network or send an appropriate SIP response to the originator;\n-\ta pres  or an im , the S-CSCF shall forward the request as specified in RFC 3861 [63]. In this case, the S-CSCF shall not modify the received Request-: and\n-\ta service URN, e.g. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69]. In this case the S-CSCF shall not modify the received Request-.\nNOTE 14:\tIf there is no SIP-based transport found after applying the procedure specified in RFC 3861 [63], the S-CSCF can forward the request to a translating gateway.\nAdditional procedures apply if the S-CSCF supports NP capabilities and these capabilities are enabled by local policy, and the database used for translation from an international public telecommunications number to a SIP  also provides NP data (for example, based on the PSTN Enumservice as defined by RFC 4769 [114] or other appropriate data bases). If the above translation from an international public telecommunications number to a SIP  failed, but NP data was obtained from the database and there is no \"npdi\" parameter in the received request, then the S-CSCF shall, based on operator policy, replace the  in the Request- with the obtained NP data, prior to forwarding the request to the BGCF or other appropriate entity. If the received request already contains a tel- \"npdi\" parameter, then the S-CSCF may update the  with the obtained NP data. The  is updated by the S-CSCF by adding NP parameters defined by RFC 4694 [112]. If the Request- is a tel-, then an \"npdi\" tel- parameter is added to indicate that NP data retrieval has been performed, and if the number is ported, an \"rn\" tel- parameter is added to identify the ported-to routeing number. If the Request- is in the form of a SIP  user=phone, the \"npdi\" and \"rn\" tel- parameters are added as described above to the userinfo part of the SIP ;\nNOTE 15:\tWhen the S-CSCF replaces the tel- in the Request- with the obtained NP data, all tel  parameters in the received Request- will be replaced by the obtained NP data.\n10A)\tif the request is not forwarded to an AS and if local policy requires the application of additional routeing capabilities, as defined in annex I, the S-CSCF shall apply the additional routeing capabilities if they are locally available or forward the request to an entity that implements the additional routeing capabilities;\n10B)\tif an agreement exists between the home network and the visited network to support Roaming Architecture for Voice over IMS with Local Breakout then continue with the following steps. Otherwise continue with step 11. If:\n-\tthe top most Route header contains an indication that this is the UE-originating case;\nNOTE 16:\tThis indication can e.g. be in a  parameter, a character string in the user part of the  or can be a port number in the  added by the S-CSCF during the registration in the Service-Route header field.\n-\tthe UE is roaming (as identified by the P-Visited-Network-ID header field value in the original REGISTER request); and\n-\tthe request is an INVITE request;\ndetermine if loopback routeing is applicable for this request using local policy, and save this decision for subsequent processing along with the following information:\na)\tany  representing the TRF address preference received from the visited network; and\nb)\tthe ICID received in the request.\nIn addition, the S-CSCF shall also include in the request a Feature-Caps header field with the \"+g.3gpp.home-visited\" header field parameter according to RFC 6809 [190] with the \"+g.3gpp.home-visited\" header field parameter set to the identifier of the visited network received in the P-Visited-Network-ID header field in the original registration request;\n10C)\tif the request is an INVITE request, then determine whether loopback is applied for this request. The information saved in step 10B, and the presence or absence of the Feature-Caps header field with the \"+g.3gpp.home-visited\" header field parameter in the received INVITE request are taken into account in making this decision:\na)\tif loopback routeing is not to be performed for this request remove any \"+g.3gpp.trf\" header field parameter or \"+g.3gpp.home-visited\" header field parameter from the Feature-Caps header field of the outgoing request;\nb)\tif loopback routeing is applied for this request;\ni)\tremove all entries in the Route header field;\nii)\tif a \"+g.3gpp.trf\" header field parameter with a parameter value containing a valid , is included in the Feature-Caps header field of the request, insert the  in a Route header field;\niii)\tif a \"+g.3gpp.trf\" header field parameter, with a parameter value containing a valid  is not included in the Feature-Caps header field of the request, insert a locally configured TRF address, associated with the visited network for this call, in the Route header field;\niv)\tremove any \"+g.3gpp.home-visited\" header field parameter from the Feature-Caps header field of the outgoing request;\nv)\tinsert the \"+g.3gpp.loopback\" header field parameter as specified in subclause 7.9A.4 in the Feature-Caps header field of the request, in accordance with the RFC 6809 [190]. If providing the identifier of the home network is supported by the S-CSCF and the visited network, the S-CSCF may based on operator agreement insert the \"+g.3gpp.loopback\" header field parameter set to the identifier of the home network;\nvi)\tif included in the incoming request, remove the \"+g.3gpp.trf\" header field parameter from the Feature-Caps header field from the outgoing request;\nvii)\tremove a type 2 \"orig-ioi\" header field parameter that was added in step 7 from the P-Charging-Vector header field and insert a type 1 \"orig-ioi\" header field parameter into the P-Charging-Vector header field. The S-CSCF shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the network in which the S-CSCF resides. The S-CSCF shall not include the \"term-ioi\" header field parameter; and\nviii)\tif the S-CSCF supports indicating the traffic leg associated with a  as specified in RFC 7549 [225] and if an \"iotl\" SIP  parameter is not included in the TRF  in the Route header field and if required by local policy, append an \"iotl\"  parameter with a value set to \"homeA-visitedA\" to the  in the Route header field; and\nc)\tif the final decision on loopback routeing is deferred to a subsequent entity in the home network, the BGCF, then the S-CSCF includes, if absent, in the request a Feature-Caps header field with the \"+g.3gpp.home-visited\" header field parameter, with the parameter value set to the identifier of the visited network received in the P-Visited-Network-ID header field in the original registration request. The S-CSCF is expected to know by means of network configuration that such a subsequent entity exists; and\nNOTE 17:\tThe subsequent entity in the home network, the BGCF, will remove the \"+g.3gpp.home-visited\" header field parameter from the Feature-Caps header field when a final routeing decision is taken.\n11)\tdetermine the destination address (e.g. DNS access) using the  placed in the topmost Route header field if present, otherwise based on the Request-. If the destination requires interconnect functionalities (e.g. the destination address is of an IP address type other than the IP address type used in the IM CN subsystem), the S-CSCF shall forward the request to the destination address via an IBCF in the same network;\n12)\tif network hiding is needed due to local policy, put the address of the IBCF to the topmost Route header field;\n13)\tin case of an initial request for a dialog:\na)\tdetermine the need for GRUU processing. GRUU processing is required if:\n-\tan original dialog identifier that the S-CSCF previously placed in a Route header field is not present in the topmost Route header field of the incoming request (this means the request is not returning after having been sent to an AS), and\n-\tthe contact address contains a GRUU that was either assigned by the S-CSCF that is valid as specified in subclause 5.4.7A.4 or a temporary GRUU self assigned by the UE based on the \"temp-gruu-cookie\" header parameter provided to the UE;\nNOTE 18:\tThe procedures for determining that a  is a temporary GRUU assigned by the UE are specified in subclause 7.1.2.3 of RFC 6140 [191].\nb)\tif GRUU processing is not required and the initial request originated from a served user, then determine the need to record-route for other reasons:\n-\tif the request is routed to an AS which is part of the trust domain, the S-CSCF shall decide, based on operator policy, whether to record-route or not. The decision is configured in the S-CSCF using any information in the received request that may otherwise be used for the initial filter criteria. If the request is record-routed the S-CSCF shall create a Record-Route header field containing its own SIP ;\n-\tif the request is a SUBSCRIBE request and routed elsewhere, the S-CSCF shall decide, based on operator policy, whether to record-route or not. The decision is configured in the S-CSCF using any information in the received request (e.g. event package name). If the request is record-routed the S-CSCF shall create a Record-Route header field containing its own SIP ; or\nNOTE 19: Some subscriptions to event packages (e.g. presence) can result in virtually persistent subscriptions and if the S-CSCF Record-Routes this can prevent reassignment of the S-CSCF.\nNOTE 20: If the S-CSCF does not Record-Route the initial SUBSCRIBE request, it will not be possible to perform SIP digest authentication of SIP requests sent inside the SIP dialog related to the associated subscription.\n-\tif the request not a SUBSCRIBE request and is routed elsewhere, create a Record-Route header field containing its own SIP ;\nNOTE 21:\tFor requests originated from a PSI the S-CSCF can decide whether to record-route or not based on operator policy.\nc)\tif GRUU processing is required, the S-CSCF shall create a Record-Route header field containing its own SIP ;\nd)\tif GRUU processing is required, the S-CSCF shall save an indication that GRUU-routeing is to be performed for in-dialog requests that reach the S-CSCF because of the Record-route header field added in step c);\nNOTE 22:\tThe manner of representing the GRUU-routeing indication is a private matter for the S-CSCF. The indication is used during termination processing of in-dialog requests to cause the S-CSCF to replace a Request- containing a GRUU with the corresponding registered contact address. It can be saved using values in the Record-Route header field, or in dialog state.\n14)\tbased on the destination user (Request-), remove any P-Access-Network-Info header field and the access-network-charging-info parameter in the P-Charging-Vector header field prior to forwarding the message;\n14A)\tif the request is not routed to an AS, to a BGCF or to an entity that implements the additional routeing functionality, remove the P-Served-User header field prior to forwarding the request;\n14B)\tif the S-CSCF supports indicating the traffic leg as specified in RFC 7549 [225], the request is not routed to an AS, to a BGCF or to an entity that implements the additional routeing functionality, loopback routeing is not to be performed for this request, required by local policy and the Request- contains a SIP , append the \"iotl\" SIP  parameter set to \"homeA-homeB\" to the Request-;\n15)\troute the request based on SIP routeing procedures;\n16)\tif the request is an INVITE request, save the Contact, CSeq and Record-Route header field values received in the request such that the S-CSCF is able to release the session if needed;\n17)\tif the request contains a \"logme\"parameter in the Session-ID header field, treat this dialog as one for which logging is in progress and log SIP signalling for this dialog according to its trace configuration;\n18)\tif the S-CSCF supports using a token to identify the registration and if the request is not forwarded to an AS, remove the \"+g.3gpp.registration-token\" Feature-Caps header field parameter, defined in subclause 7.9A.8, if received in the request; and\n19)\tif the received request is an INVITE request or a MESSAGE request and the S-CSCF supports calling number verification using signature verification and attestation information as specified in subclause 3.1, the S-CSCF shall based on local policy perform attestation of the user identity by inserting:\n-\ta \"verstat\" tel URI parameter, specified in subclause 7.2A.20, to the tel URI or SIP URI with a user=phone parameter in the From header field or the P-Asserted-Identity header field;\nan Origination-Id header field, specified in subclause 7.2.19, set to a UUID identifying the S-CSCF which is configured based on local policy and requirements from national regulation: and\n-\tan Attestation-Info header field, specified in subclause 7.2.18, set to the value \"A\".\nWhen the S-CSCF receives, an initial request for a dialog or a request for a standalone transaction, from an AS acting on behalf of an unregistered user, the S-CSCF shall:\n1)\texecute the procedures described in the steps 1, 2, 3, 4, 4B, 4C, 4D, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 and 16 in the above paragraph (when the S-CSCF receives, from a registered served user, an initial request for a dialog or a request for a standalone transaction).\nNOTE 23:\tWhen the S-CSCF does not have the user profile, before executing the actions as listed above, it initiates the S-CSCF Registration/deregistration notification procedure, as described in 3GPP TS 29.228 [14]; with the purpose of downloading the relevant user profile (i.e. for unregistered user) and informs the HSS that the user is unregistered. The S-CSCF will assess triggering of services for the unregistered user, as described in 3GPP TS 29.228 [14]. When requesting the user profile, and the request received by the S-CSCF contains a P-Profile-Key header field, the S-CSCF can include the header field value in S-CSCF Registration/deregistration notification. If the response from the HSS includes a Wildcarded Public Identity , and if the request received by the S-CSCF did not include a P-Profile-Key header field, the S-CSCF uses the  value to set the P-Profile-Key header field before forwarding the request to an AS.\nWhen the S-CSCF receives a request initiated by the served user for which the S-CSCF does not have the user profile or does not trust the data that it has (e.g. due to restart), the S-CSCF shall attempt to retrieve the user profile from the HSS. If the S-CSCF receives a Diameter result code of DIAMETER_UNABLE_TO_COMPLY as defined in 3GPP TS 29.228 [14], the S-CSCF supports S-CSCF restoration procedures, and the Request- of the request does not match an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69], then the S-CSCF shall:\nI)\treject the request by returning a 504 (Server Time-out) response to the UE;\nII)\tassume that the UE supports version 1 of the XML Schema for the 3GPP IM CN subsystem XML body if support for the 3GPP IM CN subsystem XML body as described in subclause 7.6 in the Accept header field is not indicated; and\nIII)\tinclude in the 504 (Server Time-out) response:\n-\ta Content-Type header field with the value set to associated MIME type of the 3GPP IM CN subsystem XML body as described in subclause 7.6.1;\n-\ta P-Asserted-Identity header field set to the value of the SIP  of the S-CSCF included in the Service-Route header field (see subclause 5.4.1.2.2F) during the registration of the user whose UE sent the request causing this response; and\n-\ta 3GPP IM CN subsystem XML body:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service;\ni)\ta <type> child element, set to \"restoration\" (see table 7.6.2) to indicate that S-CSCF restoration procedures are supported;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"initial-registration\" (see table 7.6.3).\nNOTE 24:\tThese procedures do not prevent the usage of unspecified reliability or recovery techniques above and beyond those specified in this subclause.\nDepending on operator configuration (see subclause 5.4.1.8), when the S-CSCF receives a request with a Request- that does not match an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69], the request initiated by the served user for which the S-CSCF has modified but not synchronized the service profile for the served user and the S-CSCF supports S-CSCF restoration procedures, then the S-CSCF shall reject the request as described in items I), II) and III).\nIf the S-CSCF:\na)\tfails to receive a SIP response within a configurable time; or\nb)\treceives a 408 (Request Timeout) response or a 5xx response from the AS without previously receiving a 1xx response to the original SIP request, and without previously receiving a SIP request from the AS that contained the same original dialog identifier as the original request;\nthe S-CSCF shall:\n-\tif the default handling defined in the filter criteria indicates the value \"SESSION_CONTINUED\" as specified in 3GPP TS 29.228 [14] or no default handling is indicated, execute the procedure from step 5; and\n-\tif the default handling defined in the filter criteria indicates the value \"SESSION_TERMINATED\" as specified in 3GPP TS 29.228 [14], either forward the received response or, if the request is an initial INVITE request, send a 408 (Request Timeout) response or a 5xx response towards the served UE as appropriate (without verifying the matching of filter criteria of lower priority and without proceeding for further steps).\nIf the S-CSCF receives any final response from the AS, the S-CSCF shall forward the response towards the served UE (without verifying the matching of filter criteria of lower priority and without proceeding for further steps).\nWhen the S-CSCF receives any response to the above request containing a Relayed-Charge header field, and the next hop is not an AS, the S-CSCF shall remove the Relayed-Charge header field from the forwarded response.\nWhen the S-CSCF receives any response to the above request, the S-CSCF may:\n1)\tapply any privacy required by RFC 3323 [33] and RFC 3325 [34] to the P-Asserted-Identity header field.\nNOTE 25:\tThe P-Asserted-Identity header field would normally only be expected in 1xx or 2xx responses.\nNOTE 26:\tThe optional procedure above is in addition to any procedure for the application of privacy at the edge of the trust domain specified by RFC 3325 [34].\nWhen the S-CSCF receives any response to the above request, the S-CSCF shall:\n1)\tIf logging is in progress for this dialog, check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred then stop treating this as a dialog for which logging is in progress, else the S-CSCF shall append a \"logme\" header field parameter to the SIP Session-ID header field if the parameter is missing and determine, by checking its trace configuration, whether to log the response.\nWhen the S-CSCF receives any response to the above request containing a \"term-ioi\" header field parameter in the P-Charging-Vector header field, the S-CSCF shall:\n1)\tstore the value of the received \"term-ioi\" header field parameter if present;\n2)\tremove all received \"orig-ioi\", \"term-ioi\" and \"transit-ioi\" header field parameters from the forwarded response;\n3)\tinclude the stored \"orig-ioi\" header field parameter if received in the request;\n4)\tinclude a type 1 \"term-ioi\" header field parameter if next hop is not an AS, or a type 3 \"term-ioi\" header field parameter. The \"term-ioi\" header field parameter is set to a value that identifies the sending network of the response\nNOTE 27:\tAny received \"term-ioi\" header field parameter will be a type 2 IOI, if received from an S-CSCF, or type 3 IOI, if received from an AS, or type 1 IOI if the S-CSCF performed loopback routeing for this request. A type 2 IOI identifies the sending network of the response, a type 3 IOI identifies the sending service provider of the response, and a type 1 IOI identifies the visited network of the served user.\n5)\tbased on operator policy include any received \"transit-ioi\" header field parameter, from the P-Charging-Vector header field, in a Relayed-Charge header field, if the next hop is an AS.\nWhen the S-CSCF receives any 1xx or 2xx response to the initial request for a dialog, if the response corresponds to an INVITE request, the S-CSCF shall save the Contact and Record-Route header field values in the response in order to be able to release the session if needed.\nWhen the S-CSCF receives any 1xx or 2xx response to an initial request for a dialog or a request for a standalone transaction, if the response is forwarded within the S-CSCF home network and not to an AS, the S-CSCF shall insert a P-Charging-Function-Addresses header field populated with values received from the HSS.\nWhen the S-CSCF, upon sending an initial INVITE request that includes an IP address in the SDP offer (in \"c=\" parameter), receives an error response indicating that the IP address type is not supported, (e.g., the S-CSCF receives the 488 (Not Acceptable Here) with 301 Warning header field indicating \"incompatible network address format\"), the S-CSCF shall either:\n-\tfork the initial INVITE request to the IBCF; or\n-\tprocess the error response and forward it using the Via header field.\nNOTE 28:\tIf the S-CSCF knows that the originating UE supports both IPv6 and IPv4 addresses simultaneously, the S-CSCF will forward the error response to the UE using the Via header field. The present version of the specification does not specify how the S-CSCF determines whether the UE supports both IPv6 and IPv4 addressing simultaneously.\nWhen the S-CSCF receives from the served user a target refresh request for a dialog, prior to forwarding the request the S-CSCF shall:\n0A)\tif the dialog is related to an IMS communication service determine whether the contents of the request (e.g. SDP media capabilities, Content-Type header field) match the IMS communication service as received as the ICSI value in the P-Asserted-Service header field in the initial request. As an operator option, if the contents of the request do not match the IMS communication service the S-CSCF may reject the request by generating a status code reflecting which added contents are not matching. Otherwise, continue with the rest of the steps;\n1)\tremove its own  from the topmost Route header field;\n2)\tcreate a Record-Route header field containing its own SIP ;\n3)\tfor INVITE dialogs (i.e. dialogs initiated by an INVITE request), save the Contact and CSeq header field values received in the request such that the S-CSCF is able to release the session if needed;\n4)\tin case the request is routed towards the destination user (Request-) or in case the request is routed to an AS located outside the trust domain, remove the access-network-charging-info parameter in the P-Charging-Vector header field;\n5)\troute the request based on the topmost Route header field; and\n6)\tif the request was sent on a dialog for which logging of signalling is in progress, check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred then stop logging of signalling, else determine, by checking its trace configuration, whether to log the response.\nWhen the S-CSCF receives any response to the above request, the S-CSCF shall:\n1)\tIf logging is in progress for this dialog, check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred then stop logging of signalling, else determine, by checking its trace configuration, whether to log the response.\nWhen the S-CSCF receives any 1xx or 2xx response to the target refresh request for an INVITE dialog, the S-CSCF shall replace the saved Contact header field values in the response such that the S-CSCF is able to release the session if needed.\nIf the S-CSCF inserted in the initial request for the dialog the header field parameters into the Feature-Caps header field then the S-CSCF shall include the header field parameters with the same parameter values into the Feature-Caps header field in any target refresh request for the dialog, and in each 1xx or 2xx response to target refresh request sent in the same direction.\nWhen the S-CSCF receives from the served user a subsequent request other than a target refresh request for a dialog, prior to forwarding the request the S-CSCF shall:\n1)\tremove its own  from the topmost Route header field;\n2)\tin case the request is routed towards the destination user (Request-) or in case the request is routed to an AS located outside the trust domain, remove the access-network-charging-info parameter in the P-Charging-Vector header field; and\n3)\troute the request based on the topmost Route header field; and\n4)\tif the request was sent on a dialog for which logging of signalling is in progress, check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred, stop logging of signalling, else determine, by checking its trace configuration, whether to log the request.\nWhen the S-CSCF receives any response to the above request, the S-CSCF shall:\n1)\tIf logging is in progress for this dialog, check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred then stop logging of signalling, else determine, by checking its trace configuration, whether to log the response.\nWith the exception of 305 (Use Proxy) responses, the S-CSCF shall not recurse on 3xx responses.\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field or a temporarily authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe S-CSCF shall give priority over other transactions or dialogs. This allows special treatment for such transactions or dialogs. If priority is supported, the S-CSCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE 1:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nWhen the S-CSCF receives, destined for a registered served user, an initial request for a dialog or a request for a standalone transaction, and the request is received either from a functional entity within the same trust domain or contains a valid original dialog identifier or the dialog identifier (From, To and Call-ID header fields) relates to an existing request processed by the S-CSCF, then prior to forwarding the request, the S-CSCF shall:\n1)\tcheck if an original dialog identifier that the S-CSCF previously placed in a Route header field is present in the topmost Route header field of the incoming request.\n-\tIf present, the request has been sent from an AS in response to a previously sent request.\n-\tIf not present, it indicates that the request is visiting the S-CSCF for the first time and in this case the S-CSCF shall determine the served user by taking the identity contained in the Request-. If the Request- is a temporary GRUU assigned by the S-CSCF as defined in subclause 5.4.7A.3, then take the public user identity that is associated with the temporary GRUU to be the served user identity. Then check whether the determined served user identity is a barred public user identity. In case the served user identity is a barred public user identity for the user, then the S-CSCF shall reject the request by generating a 404 (Not Found) response. Otherwise, the S-CSCF shall save the Request- from the request, the served user identity and the public user identity of the served user and continue with the rest of the steps;\nNOTE 2:\tAn original dialog identifier is sent to each AS invoked due to iFC evaluation such that the S-CSCF can associate requests as part of the same sequence that trigger iFC evaluation in priority order (and not rely on SIP dialog information that can change due to B2BUA AS). If the same original dialog identifier is included in more than one request from a particular AS (based on service logic in the AS), then the S-CSCF will continue the iFC evaluation sequence rather than build a new ordered list of iFC;\n2)\tremove its own  from the topmost Route header field;\n2A)\tif there was no original dialog identifier present in the topmost Route header field of the incoming request build an ordered list of initial filter criteria based on the public user identity in the Request- of the received request as described in 3GPP TS 23.218 [5].\n3)\tif there was an original dialog identifier present in the topmost Route header field of the incoming request then check whether the Request- matches the saved Request-. The Request- and saved Request- are considered a match:\na)\tif the canonical forms of the two Request- are equal to the saved value of the Request-;\nb)\tif the Request- is a GRUU (public or temporary) and the saved value of the Request- is a GRUU (public or temporary) and both GRUUs represent the same public user identity or represent public user identities that are alias SIP URIs of each other; or\nc)\tif the Request- is an alias SIP  of the saved value of the Request-.\nNOTE 3:\tThe canonical form of the Request- is obtained by removing all  parameters (including the user-param), and by converting any escaped characters into unescaped form. The alias SIP  is defined in subclause 3.1.\nIf there is no match, then the S-CSCF shall decide whether to trigger the originating services to be executed after retargeting. The decision is configured in the S-CSCF and may use any information in the received request that is used for the initial filter criteria or an operator policy. The S-CSCF shall decide either to:\na)\tstop evaluating current iFC. In that case, if the request is an INVITE request, save the Contact, CSeq and Record-Route header field values received in the request such that the S-CSCF is able to release the session if needed, forward the request based on the topmost Route header field or if not available forward the request based on the Request- (routeing based on Request- is specified in steps 2, 7 and 10 through 14a from subclause 5.4.3.2) and skip the following steps; or\nb)\tstop evaluating current iFC and build an ordered list of iFC with the originating services to be executed after retargeting as described in 3GPP TS 23.218 [5] criteria based on the public user identity of the served user and start the evaluation of that iFC as described in subclause 5.4.3.2 starting at step 4B of subclause 5.4.3.2;\nNOTE 4:\tThe S-CSCF assesses triggering of services for the originating services after retargeting means it evaluates IFCs with a SessionCase set to ORIGINATING_CDIV, as defined in 3GPP TS 29.228 [14]. If the P-Served-User extension specified in RFC 5502 [133] is supported, the S-CSCF uses the \"orig-cdiv\" header field parameter defined in RFC 8498 [239].\nNOTE 5:\tThe identity of the served user can be obtained from the History-Info header field (see RFC 7044 [66]) or the P-Served User header field as specified in RFC 5502 [133]. The served user can be a public user identity, a public GRUU, or a temporary GRUU. It needs to be ensure, that all ASs in the iFC can determine the served user correctly.\nNOTE 6:\tThe S-CSCF determines whether to apply a) or b) based on information in the initial Filter Criteria.\n3A)\tif the Request- is a GRUU, but is not valid as defined in subclause 5.4.7A.4, then return a 4xx response as specified in RFC 5627 [93];\n3B)\tif the Request- contains a public GRUU and the saved value of the Request- is a temporary GRUU, then replace the Request- with the saved value of the Request-;\n3C)\tif the request contains a P-Asserted-Service header field check whether the IMS communication service identified by the ICSI value contained in the P-Asserted-Service header field is allowed by the subscribed services for the served user:\na)\tif so, continue from step 4; and\nb)\tif not, as an operator option, the S-CSCF may reject the request by generating a 403 (Forbidden) response. Otherwise, remove the P-Asserted-Service header field and continue with the rest of the steps;\n3D)\tif the request does not contain a P-Asserted-Service header field check if the contents of the request matches a subscribed service (e.g. SDP media capabilities, Content-Type header field) for each and any of the subscribed services for the served user:\na)\tif not, as an operator option, the S-CSCF may reject the request by generating a 403 (Forbidden) response. Otherwise, continue with the rest of the steps; and\nb) if so, and if the request is related to an IMS communication service and the IMS communication service requires the use of an ICSI value then include a P-Asserted-Service header field in the request containing the ICSI value for the related IMS communication service, and use it as a header field in the initial request when matching initial filter criteria in step 4; and\nc)\tif so, and if the request is related to an IMS communication service and the IMS communication service does not require the use of an ICSI value then continue without including an ICSI value; and\nd)\tif so, and if the request does not relate to an IMS communication service (or if the S-CSCF is unable to unambiguously determine the service being requested but decides to allow the session to continue) then continue without inclding an ICSI value;\n4)\tcheck whether the initial request matches any unexecuted initial filter criteria based on the public user identity of the served user in the priority order and apply the filter criteria on the SIP method as described in 3GPP TS 23.218 [5] subclause 6.5. If there is a match, then the S-CSCF shall select the first matching unexecuted initial filter criteria and:\na)\tif the Request- is a temporary GRUU as defined in subclause 5.4.7A.3, then replace the Request- with the public GRUU that is associated with the temporary GRUU (i.e. the public GRUU representing the same public user identity and instance ID as the temporary GRUU);\nb)\tinsert the AS  to be contacted into the Route header field as the topmost entry followed by its own  populated as specified in the subclause 5.4.3.4;\nc)\tif the S-CSCF supports the P-Served-User extension as specified in RFC 5502 [133], insert the P-Served-User header field populated with the served user identity as determined in step 1. If required by operator policy, the S-CSCF shall:\n-\tif the associated session case is \"Terminating\" as specified in 3GPP TS 29.228 [14], include the sescase header field parameter set to \"term\" and the regstate header field parameter set to \"reg\";\n-\tif the associated session case is \"Terminating_Unregistered\" as specified in 3GPP TS 29.228 [14], include the sescase header field parameter set to \"term\" and the regstate header field parameter set to \"unreg\";\nd)\tinsert a type 3 \"orig-ioi\" header field parameter replacing any received \"orig-ioi\" header field parameter in the P-Charging-Vector header field. The type 3 \"orig-ioi\" header field parameter identifies the sending network of the request message. The S-CSCF shall not include the type 3 \"term-ioi\" header field parameter;\ne)\tbased on local policy, the S-CSCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier if not already available;\nf)\tremove the \"transit-ioi\" header field parameter, if received;\ng)\tbased on operator policy insert a Relayed-Charge header field containing the value of the received \"transit-ioi\" header field parameter in the P-Charging-Vector header field; and\nh)\tif an IP address associated with the served user and the AS SIP URI is stored as described in subclause 5.4.0 exists, then the S-CSCF forwards the SIP message to the IP address associated with the served user and the AS SIP URI;\nNOTE 7:\tDepending on the result of the previous process, the S-CSCF can contact one or more AS(s) before processing the outgoing Request-.\nNOTE 8:\tIf the Request- of the received terminating request contains a temporary GRUU, then step 4 replaces the Request- with the associated public GRUU before invoking the AS, and step 3B restores the original temporary GRUU when the request is returned from the AS.\nNOTE 9:\tAn AS can activate or deactivate its own filter criteria via the Sh interface. As the S-CSCF checks initial filter criteria only on receipt of an initial request for a dialog, or a standalone transaction, a modified service profile will have no impact on transactions or dialogs already in progress and the modified profile will be effective only for new transactions and dialogs. If the S-CSCF receives a modification of the iFC during their execution, then it should not update the stored initial Filter Criteria until the iFC related to the initial request have been completely executed.\n5)\tif there was no original dialog identifier present in the topmost Route header field of the incoming request insert a P-Charging-Function-Addresses header field, if not present, populated with values received from the HSS if the message is forwarded within the S-CSCF home network, including towards AS;\n6)\tif there was no original dialog identifier present in the topmost Route header field of the incoming request store the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and retain the \"icid-value\" header field parameter in the P-Charging-Vector header field;\n7)\tif there was no original dialog identifier present in the topmost Route header field of the incoming request:\n-\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field, if present;\n-\tremove received \"orig-ioi\", \"term-ioi\" and \"transit-ioi\" header field parameters from the forwarded request if next hop is not an AS; and\n-\tinclude a type 1 \"orig-ioi\" header field parameter if next hop is not an AS;\nNOTE 10:\tAny received \"orig-ioi\" header field parameter will be a type 2 IOI. or type 3 IOI. A type 2 IOI identifies the sending network of the request message, a type 3 IOI identifies the sending service provider of the request message.\n7A)\tif there was an original dialog identifier present in the topmost Route header field of the incoming request:\n-\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field, if present;\n-\tremove the received \"orig-ioi\" header field parameter if next hop is not an AS;\n-\tinclude a type 1 \"orig-ioi\" header field parameter if next hop is not an AS;\n-\tbased on local policy, the S-CSCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or if not already available; and\n-\tremove any received Relayed-Charge header field if next hop is not an AS;\nNOTE 11:\tAny received \"orig-ioi\" header field parameter will be a type 3 IOI. A type 3 IOI identifies the sending service provider of the request message.\n8)\tin the case:\ni)\tthere are no Route header fields in the request; and\nii)\tthere are bindings saved during registration or reregistration as described in subclause 5.4.1.2 which are not marked as created by an emergency registration as described in subclause 5.4.8.2;\nthen, create a target set of potential routes from the list of preloaded routes associated with the bindings in item 8) ii), as follows:\na)\tif the Request- contains a valid GRUU assigned by the S-CSCF as defined in subclause 5.4.7A.4 that does not contain a \"bnc\"  parameter, then the target set is determined by following the procedures for Request Targeting specified in RFC 5627 [93], using the public user identity and instance ID derived from the GRUU using the procedures of subclause 5.4.7A;\nb)\tif the Request- contains a valid public GRUU assigned by the S-CSCF as defined in subclause 5.4.7A.4 that contains a \"bnc\"  parameter then the target set is determined by following the procedures for routeing of public GRUUs specified in RFC 6140 [191].\nNOTE 12:\tThe procedures for Request Targeting for public GRUUs in subclause 7.1.1 of RFC 6140 [191] involve copying the \"sg\" SIP  parameter from the Public GRUU into the Request- along with the bound registered Contact Address.\nNOTE 13:\tIn this release of the specification, use of preloaded routes saved during registration or reregistration which created or refreshed bindings marked as created by an emergency registration is out of scope.\nc)\tif the Request- contains a temporary GRUU not assigned by the S-CSCF but that contains \"temp-gruu-cookie\" information provided by the S-CSCF to the UE in a \"temp-gruu-cookie\" header field parameter as specified in RFC 6140 [191] then the target set is determined by following the procedures for Request Targeting for temporary GRUUs specified in RFC 6140 [191]; or\nNOTE 14:\tThe procedures for obtaining the \"temp-gruu-cookie\" information from the temporary GRUU and for routeing of temporary GRUUs are specified in subclause 7.1.2.3 of RFC 6140 [191].\nd)\tif the Request- contains a public user identity or a GRUU not assigned by the S-CSCF, then the target set is all the registered contacts saved for the destination public user identity;\n9)\tif necessary perform the caller preferences to callee capabilities matching according to RFC 3841 [56B] to the target set;\nNOTE 15:\tThis might eliminate entries and reorder the target set.\nNOTE 16: The S-CSCF performs caller preferences to callee capabilities matching also to select among multiple targets set to a single instance-id, when the UE has registered multiple registration flows.\n10)\tin case there are no Route header fields in the request:\na)\tif there is more than one route in the target set determined in steps 8) and 9) above:\n-\tif the fork directive in the Request-Disposition header field was set to \"no-fork\", use the contact with the highest qvalue parameter to build the target . In case no qvalue parameters were provided, the S-CSCF shall decide locally what contact address to be used to build the target ;\n-\tif the fork directive in the Request-Disposition header field was not set to \"no-fork\", fork the request or perform sequential search based on the relative preference indicated by the qvalue parameter of the Contact header field in the REGISTER request, as described in RFC 3261 [26]. In case no qvalue parameters were provided, then the S-CSCF determine the contact address to be used to build the target  as directed by the Request-Disposition header field as described in RFC 3841 [56B]. If the Request-Disposition header field is not present, the S-CSCF shall decide locally whether to fork or perform sequential search among the contact addresses;\n-\tin case that no route is chosen, return a 480 (Temporarily unavailable) response or another appropriate unsuccessful SIP response and terminate these procedures; and\n-\tper the rules defined in RFC 5626 [92], the S-SCSF shall not populate the target set with more than one contact with the same public user identity and instance-id at a time. If a request for a particular public user identity and instance-id fails with a 430 response, the S-CSCF shall replace the failed branch with another target with the same public user identity and instance-id, but a different reg-id;\nb)\tIf no \"Loose-Route Indication\" indicating the HSS requires the loose-route mechanism as described in 3GPP TS 29.228 [14] has been received, in the service profile of the served public user identity, from the HSS during registration, build the Request- with the contents of the target  determined in the previous step, otherwise the Request- is retained as received;\nc)\tinsert a P-Called-Party-ID SIP header field containing the contents of the Request- (if no \"Loose-Route Indication\" indicating the HSS requires the loose-route mechanism as described in 3GPP TS 29.228 [14] has been received, in the service profile of the served public user identity, from the HSS during registration, then exclude \"rn\" tel- parameter and \"npdi\" tel- parameter as defined in RFC 4694 [112]) received in the request unless the Request- contains a temporary GRUU in which case insert the public GRUU in the P-Called-Party-ID;\nd)\tbuild the Route header field with the Path values from the chosen route and if \"Loose-Route Indication\" indicating the HSS requires the loose-route mechanism as described in 3GPP TS 29.228 [14] has been received, in the service profile of the served user identity, from the HSS during registration and the selected contact address was not registered as described in RFC 5626 [92], add the content of the target  determined in step a), as last  of the route. If the selected contact address was registered as described in RFC 5626 [92], the target  determined in step a) is not added to the Route header field; and\ne)\tsave the Request- and the total number of Record-Route header fields as part of the dialog request state.\nNOTE 17:\tFor each initial dialog request terminated at a served user two pieces of state are maintained to assist in processing GRUUs: the chosen contact address to which the request is routed; and the position of an entry for the S-CSCF in the Record-Route header field that will be responsible for GRUU translation, if needed (the position is the number of entries in the list before the entry was added). The entry will be added in step 5) of the below procedures for handling S-CSCF receipt any 1xx or 2xx response to the initial request for a dialog. The S-CSCF can record-route multiple times, but only one of those (the last) will be responsible for gruu translation at the terminating end.\n11)\tif the request is an INVITE request, save the Contact, CSeq and Record-Route header field values received in the request such that the S-CSCF is able to release the session if needed;\n12)\toptionally, apply any privacy required by RFC 3323 [33] and RFC 3325 [34] to the P-Asserted-Identity header field and privacy required by RFC 7044 [66]. The S-CSCF shall not remove any priv-value from the Privacy header field;\nNOTE 18: keeping the priv-value in the Privacy header field is necessary to indicate to the UE that the public user identity was not sent because of restriction. Although RFC 3323 [33] states that when a privacy service performs one of the functions corresponding to a privacy level listed in the Privacy header field, it SHOULD remove the corresponding priv-value from the Privacy header field, there is no harm that the S-CSCF does not remove the priv-values as there will be no other entity that would perform the privacy service after the S-CSCF.\nNOTE 19:\tThe optional procedure above is in addition to any procedure for the application of privacy at the edge of the trust domain specified by RFC 3325 [34].\n13)\tin case of an initial request for a dialog, either:\n-\tif the request is routed to an AS which is part of the trust domain, the S-CSCF shall decide, based on operator policy, whether to record-route or not. The decision is configured in the S-CSCF using any information in the received request that may otherwise be used for the initial filter criteria. If the request is record-routed the S-CSCF shall create a Record-Route header field containing its own SIP ; or\n-\tif the request is routed elsewhere, create a Record-Route header field containing its own SIP ;\n13A)\tif the request is routed towards the UE remove the P-User-Database header field and P-Served-User header field if present;\n13B)\tvoid\n13C)\tif the request was sent on a dialog for which logging of signalling is in progress, check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred, stop treating the dialog as one for which logging of signalling is in progress, else append a \"logme\" header field parameter to the SIP Session-ID header field if the parameter is missing and determine, by checking its trace configuration, whether to log the request;\n13D)\tif the request is routed towards the UE,\n-\tthe S-CSCF supports indicating the traffic leg as specified in RFC 7549 [225];\n-\tthe UE is roaming; and\n-\trequired by local policy;\nthen:\n-\tif the bottommost Route header field does not contain the \"tokenized-by\" header field parameter and an \"iotl\" SIP  parameter is not already included, append an \"iotl\" SIP  parameter set to \"homeB-visitedB\" to the  of the bottommost Route header field; and\n-\tif the bottommost Route header field contains the \"tokenized-by\" header field parameter and an \"iotl\" SIP  parameter is not already included, append an \"iotl\" SIP  parameter set to \"homeB-visitedB\" to the  of the second Route header field from the bottom;\nNOTE 20:\tThe bottommost Route header field contains an \"iotl\" SIP  parameter if the P-CSCF added the \"iotl\" SIP  parameter in the Path header field during registration and if the visited network does not apply topology hiding. The second Route header field from the bottom contains an \"iotl\" SIP  parameter if the P-CSCF added the \"iotl\" SIP  parameter in the Path header field during registration and if the visited network applied topology hiding.\n13E)\tif the S-CSCF supports HSS based P-CSCF restoration and the S-CSCF considers the P-CSCF, identified by the bottommost Route header field, is not reachable:\n-\treject the request with a 480 (Temporarily Unavailable) response; and\n-\tinitiate the HSS based P-CSCF restoration procedure towards the served user as specified in 3GPP TS 23.380 [7D];\n13F)\tif the S-CSCF supports PCRF based P-CSCF restoration procedures, insert a Restoration-Info header field including the  value contained in the user profile of the registered served user as a quoted string defined in 3GPP TS 29.228 [14];\nNOTE 21:\tIf PCRF based P-CSCF restoration procedure is operated between the home network and the visited network, the operator policy depends on an agreement with the visited network operator.\n13G)\tif the S-CSCF supports PCRF based P-CSCF restoration procedures,\n-\tthe request contains a topmost Route header field pointing to a P-CSCF, and\n-\tthe S-CSCF considers the P-CSCF is in a non-working state,\nremove all entries in the Route header field and add a Route header field set to the  associated with an alternative P-CSCF; and\nNOTE 22:\tHow the SIP  of the alternative P-CSCF is obtained by the S-CSCF is implementation dependent. The S-CSCF can make sure that selected P-CSCF support the PCRF based P-CSCF restoration procedures based on local configuration.\nNOTE 23:\tIt is implementation dependent as to how the S-CSCF determines the P-CSCF is in non-working state.\n14)\tforward the request based on the topmost Route header field.\nIf the S-CSCF receives any response to the above request, the S-CSCF shall:\n1)\tIf the response contains a \"logme\" header field parameter in the SIP Session-ID header field then log the response based on local policy.\nIf the S-CSCF supports HSS based P-CSCF restoration and\na)\treceives a 404 (Not Found) response;\nb)\tfails to receive any SIP response from a P-CSCF serving a non-roaming user within a configurable time; or\nNOTE 24:\tThe configurable time needs to be less than timer B and timer F.\nc)\treceives a 408 (Request Timeout) response or a 504 (Server Time-out) response:\n-\tincluding a Restoration-Info header field defined in subclause 7.2.11 set to \"noresponse\"; and\n-\tthe \"+g.3gpp.ics\" Contact header field parameter with a value set to \"server\" was not included in the REGISTER request when the UE registered;\nNOTE 25:\tIf this Contact header field parameter is not included the S-CSCF can deduce that the P-CSCF did not respond to the request.\nthe S-CSCF shall:\n-\tsend a 480 (Temporarily Unavailable) response;\n-\tinitiate the HSS based P-CSCF restoration procedure towards the served user as specified in 3GPP TS 23.380 [7D]; and\n-\tif b) or c) above applied consider the P-CSCF as not reachable.\nIf the S-CSCF supports PCRF based P-CSCF restoration and receives a 404 (Not Found) response, the S-CSCF shall consider the P-CSCF to be in a non-working state and shall initiate the PCRF based P-CSCF restoration procedure towards the served user as specified in 3GPP TS 23.380 [7D].\nIf the S-CSCF:\na)\tfails to receive a SIP response within a configurable time; or\nb)\treceives a 408 (Request Timeout) response or a 5xx response from the AS without previously receiving a 1xx response to the original SIP request, and without previously receiving a SIP request from the AS that contained the same original dialog identifier as the original request;\nthe S-CSCF shall:\n-\tif the default handling defined in the filter criteria indicates the value \"SESSION_CONTINUED\" as specified in 3GPP TS 29.228 [14] or no default handling is indicated, execute the procedure from step 4; and\n-\tif the default handling defined in the filter criteria indicates the value \"SESSION_TERMINATED\" as specified in 3GPP TS 29.228 [14], either forward the received response or, if the request is an initial INVITE request, send a 408 (Request Timeout) response or a 5xx response towards the originating UE as appropriate (without verifying the matching of filter criteria of lower priority and without proceeding for further steps).\nIf the S-CSCF receives any final response from the AS, the S-CSCF shall forward the response towards the originating UE (without verifying the matching of filter criteria of lower priority and without proceeding for further steps).\nWhen the S-CSCF receives any response to the above request and forwards it to an AS, the S-CSCF shall remove any \"orig-ioi\", \"term-ioi\" and \"transit-ioi\" header field parameter if received in a P-Charging-Vector header field, insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the request, a type 3 \"term-ioi\" header field parameter, and based on operator option insert a Relayed-Charge header field in the response. The S-CSCF shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and include in the Relayed-Charge header field the received \"transit-ioi\" header field parameter from the P-Charging-Vector header field.\nNOTE 26:\tAny received \"term-ioi\" header field parameter will be a type 1 IOI or a type 3 IOI. The type 1 IOI identifies the network from which the response was sent and the type 3 IOI identifies the service provider from which the response was sent.\nWhen the S-CSCF receives, destined for an unregistered served user or a statically pre-configured PSI, an initial request for a dialog or a request for a standalone transaction, the S-CSCF shall:\n1)\tVoid.\n2)\texecute the procedures described in 1, 2, 3, 3C, 3D, 4, 5, 6, 7, 11, 13, 13B, 13C and 14 in the above paragraph (when the S-CSCF receives, destined for the registered served user, an initial request for a dialog or a request for a standalone transaction).\n3)\tIn case that no more AS needs to be contacted, then S-CSCF shall return an appropriate unsuccessful SIP response. This response may be a 480 (Temporarily unavailable) and terminate these procedures.\nNOTE 27:\tWhen the S-CSCF does not have the user profile, before executing the actions as listed above, it initiates the S-CSCF Registration/deregistration notification procedure, as described in 3GPP TS 29.228 [14]; with the purpose of downloading the relevant user profile (i.e. for unregistered user) and informs the HSS that the user is unregistered. The S-CSCF will assess triggering of services for the unregistered user, as described in 3GPP TS 29.228 [14]. When requesting the user profile the S-CSCF can include the information in the P-Profile-Key header field in S-CSCF Registration/deregistration notification. When requesting the user profile, and the request received by the S-CSCF contains a P-Profile-Key header field, the S-CSCF can include the header field value in S-CSCF Registration/deregistration notification. If the response from the HSS includes a Wildcarded Public Identity , and if the request received by the S-CSCF did not include a P-Profile-Key header field, the S-CSCF uses the  value to set the P-Profile-Key header field before forwarding the request to an AS.\nPrior to performing S-CSCF Registration/Deregistration procedure with the HSS, the S-CSCF decides which HSS to query, possibly as a result of a query to the Subscription Locator Functional () entity as specified in 3GPP TS 29.228 [14] or use the value as received in the P-User-Database header field in the initial request for a dialog or a request for a standalone transaction as defined in RFC 4457 [82]. The HSS address received in the response to  query can be used to address the HSS of the public user identity with further queries.\nIf the HSS indicates to the S-CSCF that there is already another S-CSCF assigned for the user, the S-CSCF shall return a 305 (Use Proxy) response containing the SIP  of the assigned S-CSCF received from the HSS in the Contact header field.\nWhen the S-CSCF receives any response to the above request containing a Relayed-Charge header field, and the next hop is not an AS, the S-CSCF shall remove the Relayed-Charge header field.\nWhen the S-CSCF receives any 1xx or 2xx response to the initial request for a dialog (whether the user is registered or not), the S-CSCF shall:\n1)\tif the response corresponds to an INVITE request, save the Contact and Record-Route header field values in the response such that the S-CSCF is able to release the session if needed;\n2)\tif the response is not forwarded to an AS (i.e. the response is related to a request that was matched to the first executed initial filter criteria):\na)\tremove the received \"transit-ioi\" header field parameter if present and insert a type 2 \"term-ioi\" header field parameter in the P-Charging-Vector header field of the outgoing response. The type 2 \"term-ioi\" header field is set to a value that identifies the sending network of the response and the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter. Values of \"orig-ioi\" and \"term-ioi\" header field parameters in the received response are removed; and\nb)\tif the S-CSCF supports using a token to identify the registration, remove the \"+g.3gpp.registration-token\" Feature-Caps header field parameter, defined in subclause 7.9A.8, if received in the response;\n3)\tin case the served user is not considered a privileged sender then:\na)\tif the P-Asserted-Identity header field contains only a SIP  and in the case where the S-CSCF has knowledge that the SIP  contained in the received P-Asserted-Identity header field is an alias SIP  for a tel , the S-CSCF shall add a second P-Asserted-Identity header field containing this tel , including the display name associated with the tel , if available; and\nb)\tif the P-Asserted-Identity header field contains only a tel , the S-CSCF shall add a second P-Asserted-Identity header field containing a SIP . The added SIP  shall contain in the user part a \"+\" followed by the international public telecommunication number contained in tel , and user's home network domain name in the hostport part. The added SIP  shall contain the same value in the display name as contained in the tel . The S-CSCF shall also add a \"user\" SIP  parameter equals \"phone\" to the SIP ;\n4)\tin case the response is sent towards the originating user, the S-CSCF may retain the P-Access-Network-Info header field based on local policy rules and the destination user (Request-);\n5)\tsave an indication that GRUU routeing is to be performed for subsequent requests sent within this same dialog if:\na)\tthere is a record-route position saved as part of the initial dialog request state; and\nb)\tthe contact address in the response is a valid GRUU assigned by the S-CSCF as specified in subclause 5.4.7A.4 or a temporary GRUU self assigned by the UE based on the \"temp-gruu-cookie\" header field parameter provided to the UE;\n6)\tif the S-CSCF supports using a token to identify the registration and if a registration exists, add a \"+g.3gpp.registration-token\" Feature-Caps header field parameter, as defined in subclause 7.9A.8, set to the same value as included in the \"+g.3gpp.registration-token\" Contact header field parameter of the third party REGISTER request sent to the AS when the UE registered; and\nNOTE 28:\tThere could be several responses returned for a single request, and the decision to insert or modify the Record-Route needs to be applied to each. But a response might also return to the S-CSCF multiple times as it is routed back through AS. The S-CSCF will take this into account when carrying out step 5) to ensure that the information is stored only once.\n7)\tif the response is forwarded within the S-CSCF home network and not to an AS, insert a P-Charging-Function-Addresses header field populated with values received from the HSS.\nWhen the S-CSCF receives a response to a request for a standalone transaction (whether the user is registered or not), then:\n1)\tin case the served user is not considered a privileged sender then:\na)\tif the P-Asserted-Identity header field contains only a SIP  and in the case where the S-CSCF has knowledge that the SIP  contained in the received P-Asserted-Identity header field is an alias SIP  for a tel , the S-CSCF shall add a second P-Asserted-Identity header field containing this tel , including the display name associated with the tel , if available; and\nb)\tif the P-Asserted-Identity header field contains only a tel , the S-CSCF shall add a second P-Asserted-Identity header field containing a SIP . The added SIP  shall contain in the user part a \"+\" followed by the international public telecommunication number contained in tel , and user's home network domain name in the hostport part. The added SIP  shall contain the same value in the display name as contained in the tel . The S-CSCF shall also add a \"user\" SIP  parameter equals \"phone\" to the SIP ; and\n2)\tin case the response is forwarded to an AS that is located within the trust domain, the S-CSCF shall retain the access-network-charging-info parameter in the P-Charging-Vector header field; otherwise, the S-CSCF shall remove the access-network-charging-info parameter in the P-Charging-Vector header field.\nWhen the S-CSCF receives the 200 (OK) response for a standalone transaction request, the S-CSCF shall:\n1)\tinsert a P-Charging-Function-Addresses header field populated with values received from the HSS if the message is forwarded within the S-CSCF home network, including towards an AS;\n1A)\tif the S-CSCF supports using a token to identify the registration and if a registration exists, add a \"+g.3gpp.registration-token\" Feature-Caps header field parameter, as defined in subclause 7.9A.8, set to the same value as included in the \"+g.3gpp.registration-token\" Contact header field parameter of the third party REGISTER request sent to the AS when the UE registered;\n1B)\tif the S-CSCF supports using a token to identify the registration in case the response is not forwarded to an AS the S-CSCF shall remove the \"+g.3gpp.registration-token\" Feature-Caps header field parameter, defined in subclause 7.9A.8, if received in the response; and\n2)\tif the response is not forwarded to an AS (i.e. the response is related to a request that was matched to the first executed initial filter criteria), remove the received \"orig-ioi\", \"term-ioi\" and \"transit-ioi\" header field parameter if present and insert a type 2 \"term-ioi\" header field parameter in the P-Charging-Vector header field of the outgoing response. The type 2 \"term-ioi\" header field parameter is set to a value that identifies the sending network of the response and the type 2 \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter.\nNOTE 29:\tIf the S-CSCF forked the request of a stand alone transaction to multiple UEs and receives multiple 200 (OK) responses, the S-CSCF will select and return only one 200 (OK) response. The criteria that the S-CSCF employs when selecting the 200 (OK) response is based on the operator's policy (e.g. return the first 200 (OK) response that was received).\nWhen the S-CSCF receives, destined for a served user, a target refresh request for a dialog, prior to forwarding the request, the S-CSCF shall:\n0)\tif the dialog is related to an IMS communication service determine whether the contents of the request (e.g. SDP media capabilities, Content-Type header field) match the IMS communication service as received as the ICSI value in the P-Asserted-Service header field in the initial request. As an operator option, if the contents of the request do not match the IMS communication service the S-CSCF may reject the request by generating a status code reflecting which added contents are not matching. Otherwise, continue with the rest of the steps;\n1)\tif the incoming request is received on a dialog for which GRUU routeing is to be performed and the Request- is not the GRUU for this dialog, then return a response of 400 (Bad Request).\n2)\tif the incoming request is received on a dialog for which GRUU routeing is to be performed and the Request- contains the GRUU for this dialog then:\ni)\tif the Request- contains a valid GRUU assigned by the S-CSCF as defined in subclause 5.4.7A.4 that does not contain a \"bnc\"  parameter, then perform the procedures for Request Targeting specified in RFC 5627 [93], using the public user identity and instance ID derived from the Request-, as specified in subclause 5.4.7A;\nii)\tif the Request- contains a valid public GRUU assigned by the S-CSCF as defined in subclause 5.4.7A.4 that contains a \"bnc\"  parameter then the target set is determined by following the procedures for routeing of public GRUUs specified in RFC 6140 [191]. or\nNOTE 30:\tThe procedures for Request Targeting for public GRUUs in subclause 7.1.1 of RFC 6140 [191] involve copying the \"sg\" SIP  parameter from the Public GRUU into the Request- along with the bound registered Contact Address.\niii)\tif the Request- contains a temporary GRUU not assigned by the S-CSCF but that contains \"temp-gruu-cookie\" information provided by the S-CSCF to the UE in a \"temp-gruu-cookie\" header field parameter as specified in RFC 6140 [191] then the target set is determined by following the procedures for routeing of temporary GRUUs specified in RFC 6140 [191];\nNOTE 31:\tThe procedures for obtaining the \"temp-gruu-cookie\" information from the temporary GRUU and for routeing of temporary GRUUs are specified in subclause 7.1.2.3 of RFC 6140 [191].\niv)\tif no contact can be selected, return a response of 480 (Temporarily Unavailable);\n3)\tremove its own  from the topmost Route header field;\n4)\tfor INVITE dialogs (i.e. dialogs initiated by an INVITE request), save the Contact and CSeq header field values received in the request such that the S-CSCF is able to release the session if needed;\n5)\tcreate a Record-Route header field containing its own SIP ;\n5A)\tvoid\n5B)\tif the request was sent on a dialog for which logging of signalling is in progress, check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred, stop treating the dialog as one for which logging of signalling is in progress, else append a \"logme\" header field parameter to the SIP Session-ID header field if the parameter is missing and determine, by checking its trace configuration, whether to log the request; and\n6)\tforward the request based on the topmost Route header field.\nWhen the S-CSCF receives any response to the above request, the S-CSCF shall:\n1)\tIf the response contains a \"logme\" header field parameter in the SIP Session-ID header field then log the response based on local policy.\nWhen the S-CSCF receives any 1xx or 2xx response to the target refresh request for a dialog (whether the user is registered or not), the S-CSCF shall:\n1)\tfor INVITE dialogs, replace the saved Contact header field values in the response such that the S-CSCF is able to release the session if needed; and\n2)\tin case the response is forwarded to an AS that is located within the trust domain, the S-CSCF shall retain the access-network-charging-info parameter in the P-Charging-Vector header field; otherwise, the S-CSCF shall remove the access-network-charging-info parameter in the P-Charging-Vector header field.\nWhen the S-CSCF receives, destined for the served user, a subsequent request other than target refresh request for a dialog, prior to forwarding the request, the S-CSCF shall:\n1)\tif the incoming request is received on a dialog for which GRUU routeing is to be performed and the Request- is not the GRUU for this dialog, then return a response of 400 (Bad Request).\n2)\tif the incoming request is received on a dialog for which GRUU routeing is to be performed and the Request- contains the GRUU for this dialog then:\ni)\tif the Request- contains a valid GRUU assigned by the S-CSCF as defined in subclause 5.4.7A.4 that does not contain a \"bnc\"  parameter, then perform the procedures for Request Targeting specified in RFC 5627 [93], using the public user identity and instance ID derived from the Request-, as specified in subclause 5.4.7A;\nii)\tif the Request- contains a valid public GRUU assigned by the S-CSCF as defined in subclause 5.4.7A.4 that contains a \"bnc\"  parameter then the target set is determined by following the procedures for routeing of public GRUUs specified in RFC 6140 [191]; or\nNOTE 32:\tThe procedures for Request Targeting for public GRUUs in subclause 7.1.1 of RFC 6140 [191] involve copying the \"sg\" SIP  parameter from the Public GRUU into the Request- along with the bound registered Contact Address.\niii)\tif the Request- contains a temporary GRUU not assigned by the S-CSCF but that contains \"temp-gruu-cookie\" information provided by the S-CSCF to the UE in a \"temp-gruu-cookie\" header field parameter as specified in RFC 6140 [191] then the target set is determined by following the procedures for routeing of temporary GRUUs specified in RFC 6140 [191].\nNOTE 33:\tThe procedures for obtaining the \"temp-gruu-cookie\" information from the temporary GRUU and for routeing of temporary GRUUs are specified in subclause 7.1.2.3 of RFC 6140 [191].\niv)\tif no contact can be selected, return a response of 480 (Temporarily Unavailable).\n3)\tremove its own  from the topmost Route header field;\n3A)\tvoid\n3B)\tif the request was sent on a dialog for which logging of signalling is in progress, check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred, stop treating the dialog as one for which logging of signalling is in progress, else append a \"logme\" header field parameter to the SIP Session-ID header field if the parameter is missing and determine, by checking its trace configuration, whether to log the request; and\n4)\tforward the request based on the topmost Route header field.\nWhen the S-CSCF receives any response to the above request, the S-CSCF shall:\n1)\tIf the response contains a \"logme\" header field parameter in the SIP Session-ID header field then log the response based on local policy.\nWhen the S-CSCF receives a response to a a subsequent request other than target refresh request for a dialog, in case the response is forwarded to an AS that is located within the trust domain, the S-CSCF shall retain the access-network-charging-info parameter from the P-Charging-Vector header field; otherwise, the S-CSCF shall remove the access-network-charging-info parameter from the P-Charging-Vector header field.\nWith the exception of 305 (Use Proxy) responses, the S-CSCF shall not recurse on 3xx responses.\nThe original dialog identifier is an implementation specific token that the S-CSCF encodes into the own S-CSCF  in a Route header field, prior to forwarding the request to an AS. This is possible because the S-CSCF is the only entity that creates and consumes the value.\nThe token may identify the original dialog of the request, so in case an AS acting as a B2BUA changes the dialog, the S-CSCF is able to identify the original dialog when the request returns to the S-CSCF. In a case of a standalone transaction, the token indicates that the request has been sent to the S-CSCF from an AS in response to a previously sent request. The token can be encoded in different ways, such as e.g., a character string in the user-part of the S-CSCF , a parameter in the S-CSCF  or port number in the S-CSCF .\nThe S-CSCF shall ensure that the value chosen is unique so that the S-CSCF may recognize the value when received in a subsequent message of one or more dialogs and make the proper association between related dialogs that pass through an AS.\nAn original dialog identifier is sent to each AS invoked due to iFC evaluation such that the S-CSCF can associate requests as part of the same sequence that trigger iFC evaluation in priority order (and not rely on SIP dialog information that may change due to B2BUA AS).\nNOTE:\tIf the same original dialog identifier is included in more than one request from a particular AS (based on service logic in the AS), then the S-CSCF will continue the iFC evaluation sequence. If the AS wants iFC evaluation to start from the beginning for a request, then AS should not include an original dialog identifier;\nWhen the S-CSCF receives from the UE a request (excluding REGISTER), and SIP digest without  or SIP digest with  is supported and in use for this UE, the S-CSCF may perform the following steps if authentication of SIP request methods initiated by the UE excluding REGISTER is desired:\n1)\tThe S-CSCF shall identify the user by the public user identity as received in the P-Asserted-Identity header field;\n2)\tIf the public user identity does not match one of the registered public user identities, and the public user identity does not match one of the registered wildcarded public user identities, the S-CSCF may reject the request with a 400 (Bad Request) response or silently discard the request;\n3)\tIf the request does not contain a Proxy-Authorization header field or the Proxy-Authorization header field does not contain a digest response, the S-CSCF shall:\na)\tchallenge the user by generating a 407 (Proxy Authentication Required) response for the received request, including a Proxy-Authenticate header field as defined in RFC 7616 [286] and RFC 8760 [287], which includes:\n-\ta \"realm\" header field parameter;\n-\ta \"nonce\" header field parameter, with a newly generated value by the S-CSCF;\n-\tan \"algorithm\" header field parameter; and\n-\ta \"qop\" header field parameter; if the qop value is not provided in the authentication vector, it shall have the value \"auth\".\nThe challenge parameters, with the exception of the \"nonce\" header field parameter, shall be the same as the ones used for the last successful registration.\nNOTE 1:\tThe usage of the same parameters for authentication of non-registration SIP requests requires the storage of these parameters during authentication of REGISTER requests, as retrieval of authentication vectors is only specified for REGISTER requests.\nNOTE 2:\tIf these parameters are not locally stored in the S-CSCF, i.e. when the S-CSCF has restarted, and the S-CSCF supports restoration as specified in 3GPP TS 23.380 [7D], subclause 4.4.2, the S-CSCF can fetch these parameters from the HSS.\nb)\tsend the so generated 407 (Proxy Authentication Required) response towards the UE;\nc)\tretain the nonce and initialize the corresponding nonce count to a value of 1; and\nd)\tstart timer request-await-auth.\n4)\tIf the request contains a Proxy-Authorization header field, the S-CSCF shall:\na)\tcheck whether the Proxy-Authorization header field contains:\n-\tthe private user identity of the user in the \"username\" header field parameter;\n-\tan \"algorithm\" header field parameter value which matches the \"algorithm\" header field parameter in the authentication challenge (i.e. \"SHA2-256\", \"SHA2-512/256\" or \"MD5\");\n-\ta \"response\" header field parameter with the authentication challenge response;\n-\ta \"realm\" header field parameter matching the \"realm\" header field parameter in the authentication challenge;\n-\t\"nonce\" header field parameter matching a nonce that is deemed valid by the S-CSCF for the related registration or registration flow (i.e. a nonce that was set in a a Proxy-Authenticate header field of a 407 (Proxy Authentication Required) response to a non-REGISTER request for which the associated validity duration has not expired or in a -Authenticate header field of a 401 (Unauthorized) response to a REGISTER request for which the associated validity duration has not expired, a nonce sent in a \"nextnonce\" header field parameter sent in a Authentication-Info header field of a 200 OK (OK) to REGISTER request ) or if an authentication is ongoing for this request (i.e. a associated \"req-await-auth\" is running) matching the nonce that was sent in a Proxy-Authenticate header field of the 407 (Proxy Authentication Required) response to this request;\nNOTE 3:\tThe related registration flow or registration is identified by the couple instance-id and reg-id if the multiple registration mechanism is used or by contact address if not.\n-\ta \"uri\" header field parameter matching the SIP Request-;\n-\ta \"cnonce\" header field parameter; and\n-\ta \"nc\" header field parameter with a value that equals the nonce-count expected by the S-CSCF. The S-CSCF may choose to accept a nonce-count which is greater than the expected nonce-count. If the S-CSCF uses this nonce-count and authentication is successful and the S-CSCF increments it for any subsequent authentication responses.\nIf any of the above checks do not succeed, the S-CSCF shall proceed as described in subclause 5.4.3.6.2, and skip the remainder of this procedure; and\nb)\tcheck whether the received authentication challenge response and the expected authentication challenge response match. The S-CSCF shall compute the expected digest response as described in RFC 7616 [286] and RFC 8760 [287] using the H(A1) value contained within the authentication vector, and other digest parameters (i.e. nonce, cnonce, nc, qop).\nIn the case where the digest response does not match the expected digest response calculated by the S-CSCF, the S-CSCF shall consider the authentication attempt as failed and do one of the following:\n1)\trechallenge the user by issuing a 407 (Proxy Authentication Required) response including a challenge as per procedures described in this subclause; or\n2)\treject the request by issuing a 403 (Forbidden) response; or\n3)\treject the request without sending a response.\nIn the case where the digest response matches the expected digest response calculated by the S-CSCF, the S-CSCF shall:\n1)\tconsider the identity of the user verified and the request authenticated and continue with the procedures as described in subclause 5.4.3;\n2)\tif the used nonce was not considered valid before the authentication succed (i.e a \"req-await-auth\" was running), add this nonce to the list of the valid nonces for the related registration or registration flow (if multiple registration mechanism is used) for an operator configured duration; and\n3)\tstop the related \"request-await-auth\" running if any.\nIf the timer request-await-auth expires, the S-CSCF shall consider the authentication to have failed.\nIn the case that SIP digest is used and the request from the UE contains an invalid \"nonce\" Authorization header field parameter with a valid challenge response for that nonce (indicating that the client knows the correct username/password), or when the \"nonce-count\" Authorization header field parameter value sent by the UE is not the expected value, or when the Proxy-Authorization header field does not include the correct parameters, the S-CSCF shall:\n-\tsend a 407 (Proxy Authentication Required) response to initiate a further authentication attempt with a fresh nonce and the \"stale\" header field parameter set to \"true\" in the Proxy-Authenticate header field.\nWhen the S-CSCF cannot forward an initial incoming request to an Application Server due to overload control mechanism, it shall either\n-\tif the default handling defined in the filter criteria indicates the value \"SESSION_CONTINUED\" as specified in 3GPP TS 29.228 [14] or no default handling is indicated, execute the procedure from step 5 in subclause 5.4.3.2 or from step 4 in subclause 5.4.3.3 depending on the type of request; and\n-\tif the default handling defined in the filter criteria indicates the value \"SESSION_TERMINATED\" as specified in 3GPP TS 29.228 [14], reject the request as specified in RFC 7339 [199] and RFC 7200 [201] (without verifying the matching of filter criteria of lower priority and without proceeding for further steps).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.4\tCall initiation",
                            "text_content": "When the S-CSCF receives an INVITE request, either from the served user or destined to the served user, the S-CSCF may require the periodic refreshment of the session to avoid hung states in the S-CSCF. If the S-CSCF requires the session to be refreshed, the S-CSCF shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 1:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nFor interworking with a visiting network, where the P-CSCF of the visiting network does not support priority but it is intended or required to give users of that P-CSCF priority in the home network, the S-CSCF in the home network shall recognize the need for priority treatment if such detection is not alternately provided via an IBCF in the home network.\nNOTE 2:\tVarious mechanisms can be applied to recognize the need for priority treatment (e.g., based on the dialled digits). The exact mechanisms are left to national regulation and network configuration.\nWhen an S-CSCF interworks with a visiting network that does not support priority, and the S-CSCF recognizes the need for priority treatment, the S-CSCF shall insert the temporarily authorised Resource-Priority header field with appropriate namespace and priority value in the INVITE request.\nWhen the S-CSCF receives an initial INVITE request destined for the served user, the S-CSCF shall either:\na)\texamine the SDP offer (the \"c=\" parameter) to detect if it contains an IP address type that is not supported by the IM CN subsystem; or\nNOTE 3:\tThe S-CSCF can, based on local policy, assume that a UE supports the IP address type of the SDP offer for media if it is identical to the address type of a contact that the UE has registered.\nb)\tprocess the initial INVITE request without examining the SDP.\nNOTE 4:\tIf the S-CSCF knows that the terminating UE supports both IPv6 and IPv4 addressing simultaneously, the S-CSCF will forward the initial INVITE request to the UE without examining the SDP. The present version of the specification does not specify how the S-CSCF determines whether the UE supports both IPv6 and IPv4 addressing simultaneously.\nNOTE 5:\tIf the SDP offer contained an IP address type that is not supported by the IM CN subsystem, the S-CSCF will receive the 488 (Not Acceptable Here) response with 301 Warning header field indicating \"incompatible network address format\".\nSubsequently, when the S-CSCF detects that the SDP offer contained an IP address type that is not supported by the IM CN subsystem (i.e., either case a) or b)), the S-CSCF shall either:\n-\treturn a 305 (Use Proxy) response to the I-CSCF with the Contact field containing the SIP  of the IBCF, or\n-\tforward the initial INVITE request to the IBCF. When forwarding the initial INVITE request, the S-CSCF shall not insert its SIP  into the Record-Route header field.\nIf overlap signalling using the multiple-INVITE method is supported as a network option, several INVITE requests with the same Call ID and the same From header field (including \"tag\" header field parameter) can be received outside of an existing dialog. Such INVITE requests relate to the same call. If the S-CSCF receives an INVITE request from the served user outside an existing dialog with the same Call ID and From header field as a previous INVITE request during a certain period of time, it shall route the new INVITE request to the same next hop as the previous INVITE request.\nWhen the S-CSCF receives the request containing the access-network-charging-info parameter in the P-Charging-Vector, the S-CSCF shall store the access-network-charging-info parameter from the P-Charging-Vector header field. The S-CSCF shall retain access-network-charging-info parameter in the P-Charging-Vector header field when the request is forwarded to an AS. However, the S-CSCF shall not include the access-network-charging-info parameter in the P-Charging-Vector header field when the request is forwarded outside the home network of the S-CSCF.\nWhen the S-CSCF receives any request or response (excluding CANCEL requests and responses) related to a UE-originated dialog or standalone transaction, the S-CSCF shall insert previously saved values into the P-Charging-Vector header field before forwarding the message within the S-CSCF home network, including towards AS.\nWhen the S-CSCF receives any request or response (excluding ACK requests and CANCEL requests and responses) related to a UE-originated dialog or standalone transaction, the S-CSCF may insert previously saved values into the P-Charging-Function-Addresses header field before forwarding the message within the S-CSCF home network, including towards AS.\nWhen the S-CSCF receives 180 (Ringing) or 200 (OK) (to INVITE) responses containing the access-network-charging-info parameter in the P-Charging-Vector, the S-CSCF shall store the access-network-charging-info parameter from the P-Charging-Vector header field. The S-CSCF shall retain the access-network-charging-info parameter in the P-Charging-Vector header field when the response is forwarded to an AS. However, the S-CSCF shall not include the access-network-charging-info parameter in the P-Charging-Vector header field when the response is forwarded outside the home network of the S-CSCF.\nWhen the S-CSCF receives any request or response (excluding CANCEL requests and responses) related to a UE-terminated dialog or standalone transaction, the S-CSCF shall insert previously saved values into the P-Charging-Vector header field before forwarding the message within the S-CSCF home network, including towards AS.\nWhen the S-CSCF receives any request or response (excluding ACK requests and CANCEL requests and responses) related to a UE-terminated dialog or standalone transaction, the S-CSCF may insert previously saved values into the P-Charging-Function-Addresses header field before forwarding the message within the S-CSCF home network, including towards AS.\nWhen the S-CSCF receives an error response (to INVITE) for an existing early dialog, and if the S-CSCF does not forward the response immediately (if the S-CSCF forked the INVITE request it may wait for additional final responses), the S-CSCF does not have knowledge of having received an 199 (Early Dialog Terminated) provisional response on the same early dialog, and the associated INVITE request included the \"199\" option-tag in the Supported header field, and the INVITE request did not include the \"100rel\" option tag in the Require header field, the S-CSCF shall trigger and send an unreliable 199 (Early Dialog Terminated) provisional response, using the same \"tag\" To header field parameter value as the error response, as specified in RFC 6228 [142].\nWhen the S-CSCF has forked an initial INVITE request, and it has received:\n-\ta 2xx response associated with one of the early dialogs, the S-CSCF shall in each CANCEL request it generates as specified in RFC 3261 [26] insert a Reason header field with a \"SIP\" protocol header field parameter value, a \"200\" cause header field parameter value, and a \"Call completed elsewhere\" text header field parameter value, as specified in RFC 3326 [34A]; or\n-\ta 6xx response associated with one of the early dialogs, the S-CSCF shall, in each CANCEL request it generates as specified in RFC 3261 [26] insert a Reason header field with \"SIP\" protocol header field parameter value, a cause header field parameter value representing the response code (e.g. \"603\") in the received response, and a text header field parameter with a value associated with the response code (e.g. a \"Declined\" value in the case of a \"603\" response code), as specified in RFC 3326 [34A].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.5\tCall release",
                            "text_content": "Upon receipt of a network internal indication to release a session which is currently being established, the S-CSCF shall:\n1)\tcancel the related dialogs by sending the CANCEL request according to the procedures described in RFC 3261 [26]; and\n2)\tsend an appropriate response to the sender of the original INVITE request.\nUpon receipt of a network internal indication to release an existing multimedia session, the S-CSCF shall:\n1)\tif the S-CSCF serves the calling user of the session, generate a BYE request destined for the called user based on the information saved for the related dialog, including:\n-\ta Request-, set to the stored Contact header field provided by the called user;\n-\ta To header field, set to the To header field value as received in the 200 (OK) response for the initial INVITE request;\n-\ta From header field, set to the From header field value as received in the initial INVITE request;\n-\ta Call-ID header field, set to the Call-Id header field value as received in the initial INVITE request;\n-\ta CSeq header field, set to the CSeq value that was stored for the direction from the calling to the called user, incremented by one;\n-\ta Route header field, set to the routeing information towards the called user as stored for the dialog;\n-\ta Reason header field that contains proper SIP response code;\n-\tfurther header fields, based on local policy;\n-\ttreat the BYE request as if received directly from the calling user, i.e. the S-CSCF shall send the BYE request to the internal service control and based on the outcome further on towards the called user; and\n2)\tif the S-CSCF serves the calling user of the session, generate an additional BYE request destined for the calling user based on the information saved for the related dialog, including:\n-\ta Request-, set to a contact address obtained from the stored Contact header field if provided by the calling user. If the stored Contact header field contained either a public or a temporary GRUU, the S-CSCF shall set the Request- either to:\na)\tthe contact address bound to the respective GRUU, if the stored Contact header field did not include an \"ob\" SIP  parameter; or\nb)\tthe contact address that the UE used to send the initial INVITE request, if the stored Contact header field included an \"ob\" SIP  parameter;\nNOTE 1:\tSince the same public GRUU can be bound to multiple contact addresses of the UE that were registered as specified in RFC 5626 [92], the S-CSCF selects the contact address that the UE used to send the initial INVITE request.\n-\ta To header field, set to the From header field value as received in the initial INVITE request;\n-\ta From header field, set to the To header field value as received in the 200 (OK) response for the initial INVITE request;\n-\ta Call-ID header field, set to the Call-Id header field value as received in the initial INVITE request;\n-\ta CSeq header field, set to the CSeq value that was stored for the direction from the called to the calling user, incremented by one – if no CSeq value was stored for that session the S-CSCF shall generate and apply a random number within the valid range for CSeqs;\n-\ta Route header field, set to the routeing information towards the calling user as stored for the dialog;\n-\ta Reason header field that contains proper SIP response code;\n-\tfurther header fields, based on local policy;\n-\tsend the BYE request directly to the calling user.\n3)\tif the S-CSCF serves the called user of the session, generate a BYE request destined for the called user based on the information saved for the related dialog, including:\n-\ta Request-, set to a contact address that the S-CSCF uses to send the in-dialog requests towards the called UE as defined in RFC 5626 [92] and RFC 5627 [93];\n-\ta To header, set to the To header value as received in the 200 (OK) response for the initial INVITE request;\n-\ta From header, set to the From header value as received in the initial INVITE request;\n-\ta Call-ID header, set to the Call-Id header value as received in the initial INVITE request;\n-\ta CSeq header, set to the CSeq value that was stored for the direction from the calling to the called user, incremented by one;\n-\ta Route header, set to the routeing information towards the called user as stored for the dialog;\n-\ta Reason header that contains proper SIP response code;\n-\tfurther headers, based on local policy;\n-\tsend the BYE request directly to the called user; and\n4)\tif the S-CSCF serves the called user of the session, generate an additional BYE request destined for the calling user based on the information saved for the related dialog, including:\n-\ta Request-, set to the stored Contact header field provided by the calling user;\n-\ta To header, set to the From header field value as received in the initial INVITE request;\n-\ta From header, set to the To header field value as received in the 200 (OK) response for the initial INVITE request;\n-\ta Call-ID header, set to the Call-Id header field value as received in the initial INVITE request;\n-\ta CSeq header, set to the CSeq value that was stored for the direction from the called to the calling user, incremented by one – if no CSeq value was stored for that session the BYE shall generate and apply a random number within the valid range for CSeqs;\n-\ta Route header field, set to the routeing information towards the calling user as stored for the dialog;\n-\ta Reason header field that contains proper SIP response code;\n-\tfurther headers, based on local policy;\n-\ttreat the BYE request as if received directly from the called user, i.e. the S-CSCF shall send the BYE request to the internal service control and based on the outcome further on towards the calling user.\nUpon receipt of the 2xx responses for both BYE requests, the S-CSCF shall release all information related to the dialog and the related multimedia session.\nWhen:\n1)\tthe registration lifetime of the only public user identity currently registered with its associated set of implicitly registered public user identities (i.e. no other is registered) and bound either to the contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used) expires;\n2)\tthere are still active multimedia sessions that includes either this user's contact address or the registration flow and the associated contact address (if the multiple registration mechanism is used);\n3)\tthe session was initiated by or terminated towards the user using the public user identity currently registered or with one of the implicitly registered public used identities bound either to the contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used);\nthen the S-CSCF shall:\n-\trelease each of these multimedia sessions by applying the steps listed in the subclause 5.4.5.1.2. The S-CSCF shall only release dialogs associated with the multi media sessions originated or terminated towards the registered user's contact address or the registration flow and the associated contact address (if the multiple registration mechanism is used).\nUpon receipt of a request on a dialog for which the S-CSCF initiated session release, the S-CSCF shall terminate the received request and answer it with a 481 (Call/Transaction Does Not Exist) response.\nUpon receipt of a 2xx response for a BYE request matching an existing dialog, the S-CSCF shall delete all the stored information related to the dialog.\nIf the S-CSCF requested the session to be refreshed periodically, and the S-CSCF got the indication that the session will be refreshed, when the session timer expires, the S-CSCF shall delete all the stored information related to the dialog.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.6\tCall-related requests",
                            "text_content": "Void.\nFor a reINVITE request or UPDATE request from the UE within the same dialog, the S-CSCF shall store the updated access-network-charging-info parameter from P-Charging-Vector header field in the received SIP request. The S-CSCF shall retain the access-network-charging-info parameter in the P-Charging-Vector header field when the request is forwarded to an AS. However, the S-CSCF shall not include the access-network-charging-info parameter in the P-Charging-Vector header field when the request is forwarded outside the home network of the S-CSCF.\nFor a reINVITE request from the UE, if the request is to be forwarded to an AS that is located within the trust domain, the S-CSCF shall retain the access-network-charging-info parameter from the P-Charging-Vector header field; otherwise, the S-CSCF shall remove the access-network-charging-info parameter from the P-Charging-Vector header field.\nFor a reINVITE request or UPDATE request destined towards the UE within the same dialog, when the S-CSCF receives the 200 (OK) response (to the INVITE request or UPDATE request), the S-CSCF shall store the updated access-network-charging-info parameter from the P-Charging-Vector header field. The S-CSCF shall retain the access-network-charging-info parameter in the P-Charging-Vector header field when the response is forwarded to the AS. However, the S-CSCF shall not include the access-network-charging-info parameter in the P-Charging-Vector header field when the 200 (OK) response is forwarded outside the home network of the S-CSCF.\nFor any SIP response to an INVITE request, if the response is to be forwarded to an AS that is located within the trust domain, the S-CSCF shall retain the access-network-charging-info parameter from the P-Charging-Vector header field; otherwise, the S-CSCF shall remove the access-network-charging-info parameter from the P-Charging-Vector header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.7\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.7A\tGRUU management",
                            "text_content": "The S-CSCF provides a service of assigning and translating GRUUs for use by registered UEs, unless \"Loose-Route Indication\" indicating the HSS requires the loose-route mechanism as described in 3GPP TS 29.228 [14] has been provisioned in the service profile of the registered public user identity. This is conducted as specified in RFC 5627 [93] and RFC 5628 [94]. Two kinds of GRUUs are assigned: public GRUUs and temporary GRUUs.\nNOTE:\tIf the UE performs the functions of an external attached network (e.g an enterprise network) the UE could have self allocated its own GRUUs. In this version of the specification only UE self allocated public GRUUs are supported. Routeing to a specific UE self-allocated public GRUUs requires that \"Loose-Route Indication\" indicating the HSS requires the loose-route mechanism as described in 3GPP TS 29.228 [14] is provisioned in the service profile of the served public user identity. Use of UE self-allocated temporary GRUUs is not supported in this version of the specification and requests addressed to UE self allocated temporary GRUUs will fail to be routed to the UE.\nEach assigned GRUU represents an association between a public user identity and an instance ID provided by a registering UE. It is used to address a particular UE that possesses the instance ID and registers with the public user identity. The GRUU also denotes a contact address registered with a public user identity when the contact address has a \"+sip.instance\" header field parameter containing the GRUU instance ID.\nThe S-CSCF issues GRUUs as part of the registration process, and also reports GRUUs as part of notifications for subscriptions to the \"reg\" event package. The S-CSCF always issues GRUUs in pairs – a public GRUU and a temporary GRUU. In case of implicit registration the S-CSCF assigns a unique public GRUU and a unique temporary GRUU for each public user identity.\nThe S-CSCF may also support the procedures for allocating public GRUUs and supporting the generation of temporary GRUUs by the functionality within the UE that performs the role of registrar as specified in RFC 6140 [191] as well as the procedures to route requests containing such GRUUs.\nEach public GRUU shall conform to all requirements specified in RFC 5627 [93].\nIf the Contact  in the Contact header field does not contain a \"bnc\"  parameter, then the S-CSCF constructs a public GRUU by adding a \"gr\" SIP  parameter to the canonical for m of the SIP  which contains a public user identity.\nIf the Contact  in the Contact header field contains a \"bnc\"  parameter and if the S-CSCF supports RFC 6140 [191], then the S-CSCF constructs a public GRUU by adding both \"bnc\" and \"gr\" SIP  parameters to the canonical form of the SIP  from the To header field of the REGISTER request\nThe \"gr\" SIP  parameter serves as an indicator that the  is in fact a GRUU and if the \"+sip.instance\" header field parameter from the Contact address contains an IMEI URN or a MEID URN then it carries a value that encodes the IMEI based instance ID that is defined in 3GPP TS 23.003 [3] or the MEID based instance ID which is defined in RFC 8464 [187] otherwise it carries the value received in the \"+sip.instance\" header field parameter.\nBy default, the value of the \"gr\" SIP  parameter is a copy of the value of the \"+sip.instance\" header field parameter from a Contact address registered with the S-CSCF, with escaping of special characters as specified in RFC3261 [26].\nThe public GRUU that is returned in the \"pub-gruu\" parameter in the 200 (OK) response to the REGISTER request is constructed using the canonical form of the SIP  of the public user identity from the To header field of the REGISTER request provided that public user identity is not barred. If the public user identity from the To header field of the REGISTER request is barred then the public GRUU that is returned in the \"pub-gruu\" parameter in the 200 (OK) response to the REGISTER request is constructed using the canonical form of the SIP  of the default public user identity.\nNOTE 1:\tThe default public user identity is always provisioned as a SIP .\nIf the \"+sip.instance\" header field parameter from the Contact address contains an IMEI URN, as specified in RFC 7254 [153] or an MEID URN, as specified in RFC 8464 [187], then the value of the \"gr\" SIP  parameter is generated by the S-CSCF using the name-based UUID algorithm defined in RFC 4122 [154]. The following applies to the algorithm:\n1)\tthe \"name space ID\" shall be a UUID generated for use across the administrative domain and shall use the algorithm for creating a UUID from truly random numbers specified in RFC 4122 [154];\nNOTE 2:\tIf the generated UUID is changed, then newly created GRUUs will not match those that were created with the previous UUID. Therefore, the UUID needs to remain the same in order to create consistent GRUUs. This means that the namespace UUID needs to be the same for all S-CSCFs within the domain for which the public GRUU is hosted (it cannot be generated at run time by the S-CSCF as that would produce different values).\n2)\tSHA-1 shall be used as the hash algorithm; and\n3)\tthe \"name\" is made up of a concatenation of the ASCII representation (see RFC 20 [212]) of:\na)\tif IMEI, the  and  portions of the IMEI; or\nb)\tif MEID, the Manufacturer Code and the Serial Number portions of the MEID;\nfrom the \"+sip.instance\" header field parameter.\nOnly the IMEI shall be use for generating an instance ID for a multi-mode UE that supports both 3GPP and 3GPP2 defined radio access networks, and the S-CSCF shall follow the procedures for an IMEI as described above.\nThe S-CSCF shall store the \"gr\" parameter used in a public GRUU and the associated value received in a \"+sip.instance\" header field parameter.\nThe public GRUU for a particular association of public user identity and instance ID is persistent. The same public GRUU will be returned each time a registration is performed with a particular pair of public user identity and instance ID.\nNOTE 1:\tFor UEs performing the functions of an external attached network that support RFC 6140 [191] the S-CSCF does not allocate temporary GRUUs but assists the functionality within the UE that performs the role of registrar in allocating it's own temporary GRUUs by providing to the UE the \"temp-gruu-cookie\" header field parameter that uniquely identifies the registration. The functionality within the UE that performs the role of registrar then is able to allocate its own temporary GRUUs as per RFC 6140 [191] procedures.\nEach temporary GRUU shall conform to all requirements specified in RFC 5627 [93].\nBecause of the limited lifetime of an temporary GRUU, only the S-CSCF that created a temporary GRUU is required to understand how to translate that GRUU to the corresponsing public user identity and instance ID.\nThe temporary GRUU that is returned in the \"temp-gruu\" parameter in the 200 (OK) response to the REGISTER request is mapped to the public user identity from the To header field of the REGISTER request provided that public user identity is not barred. If the public user identity from the To header field of the REGISTER request is barred then the temporary GRUU that is returned in the \"temp-gruu\" parameter in the 200 (OK) response to the REGISTER request is mapped to the default public user identity.\nNOTE 2:\tThe default public user identity is always provisioned as a SIP .\nThe specific representation of a temporary GRUU may be decided by each S-CSCF implementation. Temporary GRUUs must route to the assigning S-CSCF without requiring each assigned GRUU to be stored in the HSS.\nThe S-CSCF may choose a representation of temporary GRUUs that requires no extra state to be retained, such as that specified in RFC 5627 [93]. Alternatively, the S-CSCF may choose a stateful representation. This is an implementation choice.\nNOTE 3:\tOne possible implementation is for the S-CSCF to have a statically configured wildcard PSI that routes to it, with each temporary GRUU being encoded so that it matches the wildcard.\nThe S-CSCF shall recognize those GRUUs it has assigned, verify their validity, and extract the associated public user identity or stored identity of the UE that represents the functionality within the UE that performs the role of registrar and instance ID. This is true for both public GRUUs and temporary GRUUs.\nNOTE 1:\tThe S-CSCF only validates and extracts the associated public user identity and instance ID for GRUUs that it assigned.\nGRUUs are distinguished from other URIs by the presence of a \"gr\" SIP  parameter. Public GRUUs are distinguished from temporary GRUUs by the presence of a value for the \"gr\" SIP  parameter.\nThe instance ID is obtained from a public GRUU by using the \"gr\" parameter to retrieve the stored associated instance ID. The public user identity or stored identity of the UE that represents the functionality within the UE that performs the role of registrar is extracted from a public GRUU by removing the \"gr\" SIP  parameter.\nThe S-CSCF can recognize a public GRUU as valid if the \"gr\" parameter contains a value that was stored in the S-CSCF during generation of the public GRUU, and the derived public user identity compares equal, according to the comparison rules of RFC3261 [26], to a public user identity active within the S-CSCF or a stored identity of the UE that represents the functionality within the UE that performs the role of registrar from which a public GRUU was created. When validating public GRUUs the S-CSCF shall ignore the presence of any \"sg\" SIP  parameter when determining if a public GRUU is one allocated by the S-CSCF.\nNOTE 2:\tThe UE that supports RFC 6140 [191] and performs the functions of an external attached network, adds a unique \"sg\" SIP  parameter value to the public GRUU supplied by the S-CSCF when generating public GRUUs for its registering UAs.\nThe public user identity and instance ID are derived from a temporary GRUU via implementation specific means consistent with the way temporary GRUUs are constructed. The S-CSCF shall determine the validity of a temporary GRUU in conformance with RFC 5627 [93], and if the GRUU was allocated using RFC 6140 [191] procedures then in conformance with RFC 6140 [191] or using implementation specific means.\nThe S-CSCF regards a UE self-allocated public GRUU as valid if \"Loose-Route Indication\" indicating the HSS requires the loose-route mechanism as described in 3GPP TS 29.228 [14] is provisioned in the service profile of the served public user identity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.8\tEmergency service",
                            "text_content": "The S-CSCF shall handle the emergency registration as per the needs of the normal registration.\nNOTE 1:\tEmergency specific procedures for the Cx interface are specified in annex G in 3GPP TS 29.228 [14].\nNOTE 2:\tWhen receiving an emergency service request then the S-CSCF handles the emergency service request as per the procedures in subclause 5.4.3.2. The Route header field indicating the URI associated with the E-CSCF is included by a P-CSCF or an AS.\nWhen the S-CSCF receives a REGISTER request; and the Contact header field includes a \"sos\" SIP  parameter that indicates that this is an emergency registration, the S-CSCF shall perform the actions as specified in subclause 5.4.1.1 with the following additions:\n1)\twhen handling unprotected REGISTER request or protected REGISTER request, the S-CSCF:\na)\tshall deregister only contacts that were registered as part of emergency registration; and\nb)\tshall not deregister contacts that were registered as part of non-emergency registration;\nNOTE 1:\tother conditions triggering contact deregistration are described in subclause 5.4.1.\n2)\tfor the protected REGISTER request, when the S-CSCF receives a REGISTER request with the \"integrity-protected\" header field parameter in the Authorization header field set to \"yes\", \"tls-yes\" or \"ip-assoc-yes\", i.e. for the protected REGISTER request, and the Contact header field includes a \"sos\" SIP  parameter that indicates that this is an emergency registration, the S-CSCF shall identify the user by the public user identity as received in the To header field and the private user identity as received in the Authorization header field of the REGISTER request;\n3)\tif operator policy does not require that emergency service requests are forwarded to the S-CSCF, the S-CSCF shall not include a Service-Route header field in the 200 (OK) response to the REGISTER request;\n4)\tthe S-CSCF shall not include a temporary GRUU in the 200 (OK) response to the REGISTER request;\n5)\tthe S-CSCF shall in the Contact header field of the 200 (OK) response to the REGISTER request include only the  that was successfully emergency registered and in this URI include the \"sos\" SIP URI parameter;\nNOTE 2\tOnly including the emergency registered contact in the 200 (OK) response to the REGISTER request deviates from bullet 8 in section 10.3 of RFC 3261 [26].\nNOTE 3:\tIn the case where the S-CSCF returns a GRUU in the Contact header field of the 200 (OK) response to the REGISTER request, the \"sos\" SIP  parameter is appended to the  and not included as a Contact header field parameter. The public GRUU that is returned in the 200 (OK) response includes the \"sos\" SIP  parameter as a parameter of the  included in the \"pub-gruu\" Contact header field parameter.\n6)\tstore the Path header field and the contact information including all header field parameters contained in the Contact header field;\nNOTE 4:\tThe Path header field and contact information used for the emergency dialogs destined for the UE and obtained during the emergency registration can be different than the Path header field used for the non-emergency communication and obtained during the non-emergency registration.\nNOTE 5:\tThe S-CSCF will not perform the network-initiated deregistration procedure for an emergency registration, but will let it expire. A new emergency registration will overwrite any previous emergency registration.\n7)\tthe S-CSCF shall not send any third-party REGISTER requests to any AS;\n8)\tvoid\n9)\tdetermine the duration of the registration by checking the value of the registration expiration interval value in the received REGISTER request and based on local policy; and\nNOTE 6:\tThe value of the emergency registration time is subject to national regulation and can be subject to roaming agreements.\n10)\tfor any bindings created by the emergency registration, mark those bindings as created by an emergency registration.\nWhen S-CSCF receives a REGISTER request with the registration expiration interval value containing zero and the Contact header field contains a contact address that has been registered for emergency service (i.e. the \"sos\" SIP  parameter that indicates that this is an emergency registration is included in the Contact header field), the S-CSCF shall reject the REGISTER request by sending a 501 (Not Implemented) response.\nNOTE:\tThe UE cannot deregister its emergency public user identity.\nThe S-CSCF shall not perform a network-initiated emergency deregistration.\nIf a given public user identity and the associated contact address have been registered via emergency registration, the S-CSCF shall not re-authenticate this public user identity.\nIf a S-CSCF receives a SUBSCRIBE request addressed to S-CSCF containing the Event header field with the reg event package with the Contact header field that contains a contact address that has been registered for emergency service, the S-CSCF shall reject the SUBSCRIBE request for the reg-event package by sending a 489 (Bad Event) response.\nWhen the user performs an emergency registration or when the emergency registration expires, the S-CSCF shall not send a NOTIFY request to the subscribers to the reg event package of the respective user.\nThe contact address that has been registered for emergency service shall not be included in the NOTIFY requests sent to the subscribers to the reg event package of the user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.5\tProcedures at the MGCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.5.1\tGeneral",
                            "text_content": "The MGCF, although acting as a UA, does not initiate any registration of its associated addresses. These are assumed to be known by peer-to-peer arrangements within the IM CN subsystem. Therefore table A.4/1 and dependencies on that major capability shall not apply.\nThe use of the Path and Service-Route header fields shall not be supported by the MGCF.\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe MGCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the MGCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nWhen the MGCF sends any request or response related to a dialog, the MGCF may insert previously saved values into P-Charging-Vector and P-Charging-Function-Addresses header fields before sending the message.\nThe MGCF shall use a GRUU referring to itself (as specified in RFC 5627 [93]) when inserting a contact address in a dialog establishing or target refreshing SIP message. This specification does not define how GRUUs are created by the MGCF; they can be provisioned by the operator or obtained by any other mechanism. A GRUU used by the MGCF when establishing a dialog shall remain valid for the lifetime of the dialog. The GRUU used by the MGCF shall not reveal calling party related information.\nThe MGCF shall handle requests addressed to its currently valid GRUUs when received outside of the dialog in which the GRUU was provided.\nEXAMPLE:\tUpon receipt of an INVITE request addressed to a GRUU assigned to a dialog it has active, and containing a Replaces header field referencing that dialog, the MGCF will be able to establish the new call replacing the old one.\nThe MGCF may support retrieval of NP data, subject to local policy. The interface used at the MGCF to retrieve the NP data is out of scope of this specification. Retrieval of NP data is relevant only if the Request- contains an international public telecommunications number. For requests from the IM CN subsystem network, if the Request- contains a tel- with an \"npdi\" tel- parameter, as defined in RFC 4694 [112], NP data has been obtained previously and NP data retrieval is not needed, but still may still be performed if required by local policy. If NP data is retrieved by the MGCF, and the request is routed to the IM CN subsystem, the MGCF shall add the tel- NP parameters to the Request- as defined in RFC 4694 [112]: an \"npdi\" tel- parameter is added to indicate that NP data retrieval has been performed, and if the number is ported, an \"rn\" tel- parameter is added to identify the ported-to routeing number.\nThe MGCF NP procedures also apply when the request contains a Request- in the form of a SIP  user=phone, where the \"npdi\" and \"rn\" tel- parameters are contained in the userinfo part of the SIP .\nThe MGCF supports as a network option the inclusion of the XML MIME schema for N. In cases where the XML MIME for N is included the Content-Type header field is set to \"application/vnd.etsi.pstn+xml\" and the Content-Disposition to \"signal\" with the \"handling\" parameter set to \"optional\".\nThe MGCF shall log all SIP requests and responses that contain a \"logme\" header field parameter in the SIP Session-ID header field if required by local policy.\nWhen sending a failure response to any received request, depending on operator policy, the MGCF may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"mgcf\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.2\tSubscription and notification",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.3\tCall initiation",
                            "text_content": "When the MGCF receives an indication of an incoming call from a circuit-switched network, the MGCF shall:\n1)\tgenerate an INVITE request:\n-\tset the Request- to the \"tel\" format using an E.164 address or to the \"sip\" format using an E164 address in the user portion and set user=phone in accordance with 3GPP TS 29.163 [11B];\nNOTE 1:\tDetails how to set the host portion are out of scope of the document. However, when a SIP  is used the host portion needs to be part of the domain name space owned by the I-CSCF\n-\tinclude the \"100rel\" option tag in the Supported header field (as defined in RFC 3262 [27]);\n-\tinclude the \"precondition\" option tag in the Supported header field (as defined in RFC 3312 [30] as updated by RFC 4032 [64]) if the MGCF supports the SIP preconditions mechanism;\n-\tnot indicate the requirement for the precondition mechanism by using the Require header field;\n-\tcreate a new, globally unique value for the \"icid-value\" header field parameter and insert it into the P-Charging-Vector header field;\n-\tinsert a type 2 \"orig-ioi\" header field parameter into the P-Charging-Vector header field. The MGCF shall set the type 2 \"orig-ioi\" header field parameter to a value that identifies the sending network in which the MGCF resides and the type 2 \"term-ioi\" header field parameter shall not be included;\n-\tbased on local policy, add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier; and\n-\tif services that require knowledge of the adjacent network are provided within the network, based on operator policy, insert a Via \"received-realm\" header field parameter, as defined in RFC 8055 [208];\nWhen the MGCF receives a 1xx or 2xx response to an initial request for a dialog, the MGCF shall store the value of the received \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present.\nNOTE 2:\tAny received \"term-ioi\" header field parameter will be a type 2 IOI. The type 2 IOI identifies the sending network of the response message.\nUpon receiving a 199 (Early Dialog Terminated) provisional response to an established early dialog the MGCF shall release resources specifically related to that early dialog.\nBased upon local policy, the MGCF may support preferred circuit carrier access (RFC 4694 [112]). If such routeing is applicable for the call, the MGCF shall perform the interworking of the carrier identification code from the circuit switched signalling protocol as described in 3GPP TS 29.163 [11B].\nIf resource priority in accordance with RFC 4412 [116] is required for a dialog, then the MGCF shall include the Resource-Priority header field in all requests associated with that dialog.\nIf overlap signalling using the multiple-INVITE method is supported as a network option, several INVITE requests with the same Call ID and the same From header field (including \"tag\" header field parameter) that relate to the same call can be sent by the MGCF. The MGCF shall route those INVITE requests to the same next hop.\nWhen the MGCF receives an initial INVITE request with Supported header field indicating \"100rel\", the MGCF shall:\n1)\tbased on local policy, store the \"fe-identifier\" header field parameter of the P-Charging-Vector header field, if present;\n2)\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field, if present;\nNOTE 1:\tAny received \"orig-ioi\" header field parameter will be a type 2 IOI. The type 2 IOI identifies the sending network of the request message.\n3)\tsend a 100 (Trying) response;\n4)\tafter a matching codec is found or no codec is required at the MGW, send 183 \"Session Progress\" response:\n-\tset the Require header field to the value of \"100rel\";\n-\tstore the values received in the P-Charging-Function-Addresses header field;\n-\tstore the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field; and\n-\tinsert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the initial INVITE request, a type 2 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The MGCF shall set the type 2 \"term-ioi\" header field parameter to a value that identifies the network in which the MGCF resides, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request. Based on local policy, the MGCF shall include the stored \"fe-identifier\" header field parameter in the P-Charging-Vector header field.\nIf a codec is required and the MGCF does not find an available matching codec at the MGW for the received initial INVITE request, the MGCF shall:\n-\tsend 503 (Service Unavailable) response if the type of codec was acceptable but none were available and the MGCF is unable to handle further requests received from the same upstream entity on the transport address where the INVITE request was received (i.e. MGCF is overloaded by SIP requests);\n-\tsend 500 (Server Internal Error) response if the type of codec was acceptable but none were available and the MGCF is able to handle further requests received from the same upstream entity on the transport address where the INVITE request was received (i.e. MGCF is not overloaded by SIP requests); or\n-\tsend 488 (Not Acceptable Here) response if the type of codec was not supported, and may include SDP in the message body to indicate the codecs supported by the MGCF/MGW.\nBased upon local policy, the MGCF may support preferred ciruit carrier access (RFC 4694 [112]), if such routeing is applicable for the call.\nNOTE 2:\tInterworking of the \"cic\" tel- parameter, if present in a tel- or in the userinfo part of a SIP  with user=phone Request-, to the circuit switched signalling protocol is described in 3GPP TS 29.163 [11B].\nThe MGCF may support resource priority in accordance with RFC 4412 [116] if required for a dialog. The MGCF shall use compatible namespace and priority levels to the capabilities supported in the CS network.\nBased on local policy, the MGCF shall include the stored \"fe-identifier\" header field parameter in the P-Charging-Vector header field, add its own address or identifier as \"fe-addr\" element of the \"fe-identifier\" header field parameter of the P-Charging-Vector header field and send the P-Charging-Vector header field in the related final response.\nWhen the MGCF generate a subsequent request in accordance with 3GPP TS 29.163 [11B], the MGCF shall:\na)\tadd a P-Charging-Vector header field with the \"icid-value\" header field parameter set to the value populated in the initial request for the dialog and a type 2 \"orig-ioi\" header field parameter. The MGCF shall set the type 2 \"orig-ioi\" header field parameter to a value that identifies the sending network in which the MGCF resides and shall not set the type 2 \"term-ioi\" header field parameter.\nWhen the MGCF receives a 1xx or 2xx response to a subsequent request for a dialog, the MGCF shall store the value of the received \"term-ioi\" header field parameter in the P-Charging-Vector header field, if present.\nWhen the MGCF receives 183 (Session Progress) response to an INVITE request, the MGCF shall:\n-\tstore the values received in the P-Charging-Function-Addresses header field.\nThe MGCF shall send an UPDATE request when the following conditions are fulfilled:\n-\tconditions as specified in 3GPP TS 29.163 [11B]; and\n-\tthe MGCF receives 200 (OK) response to a PRACK request\nNOTE:\tWhen the MGCF is confirming the successful resource reservation using an UPDATE request (or a PRACK request) and the MGCF receives a 180 (Ringing) response or a 200 (OK) response to the initial INVITE request before receiving a 200 (OK) response to the UPDATE request (or a 200 (OK) response to the PRACK request), the MGCF does not treat this as an error case and does not release the session.\nWhen the MGCF receives a subsequent request, the MGCF shall:\n1)\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field, if present.\nNOTE:\tAny received \"orig-ioi\" header field parameter will be a type 2 IOI. The type 2 IOI identifies the sending network of the request message.\nWhen the MGCF generate a response to a subsequent request in accordance with 3GPP TS 29.163 [11B], the MGCF shall, insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the subsequent request, a type 2 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The MGCF shall set:\n1)\tthe type 2 \"term-ioi\" header field parameter to a value that identifies the network in which the MGCF resides;\n2)\tthe \"orig-ioi\" header field parameter set to the previously received value of \"orig-ioi\" header field parameter in the subsequent request; and\n3)\tthe \"icid-value\" header field parameter set to the previously received value of \"icid-value\" header field parameter in the subsequent request.\nWhen the MGCF receives an indication of a ringing for the called party of outgoing call to a circuit-switched network, the MGCF shall:\n-\tsend 180 (Ringing) response to the UE.\nWhen the MGCF receives an indication of answer for the called party of outgoing call to a circuit-switched network, the MGCF shall:\n-\tsend 200 (OK) response to the UE. The 200 (OK) response shall include an P-Asserted-Identity header field if corresponding information is received from the circuit-switched network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.4\tCall release",
                            "text_content": "When the MGCF receives an indication of call release from a circuit-switched network, the MGCF shall:\n-\tsend a BYE request to the UE.\nNOTE:\tThe release of a call towards the circuit-switched network additionally requires signalling procedures other than SIP in the MGCF that are outside the scope of this document.\nWhen the MGCF receives an indication from the MGW that the bearer was lost, the MGCF shall:\n-\tsend a BYE request towards the UE; and\n-\tmay include Error-Info header field with a pointer to additional information indicating that bearer was lost.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.5\tCall-related requests",
                            "text_content": "This subclause applies after the 2xx response to the initial INVITE request has been sent or received.\nIf the precondition mechanism was used during the session establishment, as described in subclause 5.5.3.1.1 or 5.5.3.1.2, the MGCF shall indicate support of the precondition mechanism during a session modification. If the precondition mechanism was not used during the session establishment, the MGCF shall not indicate support of the precondition mechanism during a session modification.\nIn order to indicate support of the precondition mechanism during a session modification, upon generating a reINVITE request, an UPDATE request with an SDP body, or a PRACK request with an SDP body, the MGCF shall:\na)\tindicate the support for the precondition mechanism using the Supported header field;\nb)\tnot indicate the requirement for the precondition mechanism using the Require header field; and\nc)\tif a reINVITE request is being generated, indicate the support for reliable provisional responses using the Supported header field,\nand follow the SDP procedures in clause 6 for the precondition mechanism.\nWhen the MGCF receives a reINVITE request for hold/resume operation, the MGCF shall:\n-\tsend a 100 (Trying) response;\n-\tafter performing interaction with MGW to hold/resume the media flow, send a 200 (OK) response.\nUpon receiving a reINVITE request, an UPDATE request, or a PRACK request that indicates support for the precondition mechanism by using the Supported header field or requires use of the precondition mechanism by using the Require header field, the MGCF shall:\na)\tif the precondition mechanism was used during the session establishment, as described in subclause 5.5.3.1.1 or 5.5.3.1.2, use the precondition mechanism for the session modification; and\nb)\tif the precondition mechanism was not used during the session establishment, and\n1)\tif use of the precondition mechanism is required using the Require header field, reject the request by sending a 420 (Bad Extension) response; and\n2)\tif the support of the precondition mechanism is indicated using the Supported header field, not use the precondition mechanism for the session modification.\nIf the precondition mechanism is used for the session modification, the MGCF shall indicate support for the preconditions mechanism, using the Require header field, in responses that include an SDP body, to the session modification request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.6\tFurther initial requests",
                            "text_content": "When the MGCF responds to an OPTIONS request with a 200 (OK) response, the MGCF may include a message body with an indication of the DTMF capabilities and supported codecs of the MGCF/MGW.\nNOTE:\tThe detailed interface for requesting MGCF/MGW capabilities is not specified in this version of the document. Other solutions can be used in the interim.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.6\tProcedures at the BGCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.6.1\tGeneral",
                            "text_content": "The use of the Path and Service-Route header fields shall not be supported by the BGCF.\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe BGCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the MGCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nWhen the BGCF receives any request or response related to a dialog or standalone transaction, the BGCF may insert previously saved values into a P-Charging-Vector header field before forwarding the message.\nWhen the BGCF receives any request or response (excluding ACK requests and CANCEL requests and responses) related to a dialog or standalone transaction, the BGCF may insert previously saved values into a P-Charging-Function-Addresses header field before forwarding the message.\nWith the exception of 305 (Use Proxy) responses, the BGCF may recurse on a 3xx response only when the domain part of the  contained in the 3xx response is in the same domain as the BGCF. For the same cases, if the  is an IP address, the BGCF shall only recurse if the IP address is known locally to be a address that represents the same domain as the BGCF.\nThe BGCF shall log all SIP requests and responses that contain a \"logme\" header field parameter in the SIP Session-ID header field if required by local policy.\nWhen sending a failure response to any received request, depending on operator policy, the BGCF may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"bgcf\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.2\tCommon BGCF procedures",
                            "text_content": "When determining where to route the received request, the originating BGCF may use the information obtained from other protocols or any other available databases.\nThe BGCF may support retrieval of NP data as part of the procedures to determine where to route the request. Retrieval of NP data by the BGCF is subject to local policy. Retrieval of NP data is relevant only if the Request- contains an international public telecommunications number. The interface used at the BGCF to retrieve the NP data is out of scope of this specification. If the Request- contains a tel- with an \"npdi\" tel- parameter, as defined in RFC 4694 [112], NP data has been obtained previously and NP data retrieval is only performed if required by local policy. If NP data is retrieved by the BGCF, the BGCF shall add the tel- NP parameters to the Request- as defined in RFC 4694 [112]: an \"npdi\" tel- parameter is added to indicate that NP data retrieval has been performed, and if the number is ported, an \"rn\" tel- parameter is added to identify the ported-to routeing number. The \"rn\" tel- parameter may be used by the BGCF for routeing the request.\nThe BGCF NP procedures also apply when the request contains a Request- in the form of a SIP  user=phone, where the \"npdi\" and \"rn\" tel- parameters are contained in the userinfo part of the SIP .\nWhen the BGCF receives a request, the BGCF shall forward the request:\n-\tto an MGCF within its own network; or\n-\tto another network containing a BGCF, or I-CSCF; or\n-\twhere the request is for another network, to an IBCF in its own network, if local policy requires IBCF capabilities towards another network; or\n-\twhere the Ici interface is used to interconnect two networks and the destination network is beyond such interface, to an IBCF in its own network.\nWhen forwarding the request to the next hop, the BGCF may leave the received Request- unmodified.\nIf the request is not routed to a BGCF or to an entity that implements the additional routeing functionality, the BGCF shall remove the P-Served-User header field prior to forwarding the request.\nWhen the BGCF receives a request and the Request- contains a tel  in local number format or a SIP  with the user part not starting with a + and the \"user\" SIP  parameter equals \"phone\", the BGCF shall not forward the request to an entity in another network (e.g. BGCF, I-CSCF) unless the local policy (e.g. routeing of service numbers) requires forwarding the request outside the network. If local policy does not allow forwarding the request outside the network and additional routeing capabilities as defined in annex I are locally available, the BGCF shall attempt translation of the local number. If the translation fails, the BGCF shall send an appropriate SIP response to the originator. If local policy does not allow forwarding the request outside the network and additional routeing capabilities as defined in annex I are not locally available, the BGCF shall either:\n-\tforward the request to any appropriate entity in its own network where additional routeing functionality are available; or\n-\tsend an appropriate SIP response to the originator.\nThe BGCF need not Record-Route the INVITE and the SUBSCRIBE requests. While the next entity may be a MGCF acting as a UA, the BGCF shall not apply the procedures of RFC 3323 [33] relating to privacy. The BGCF shall store the values received in the P-Charging-Function-Addresses header field. The BGCF shall store the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and retain the \"icid-value\" header field parameter in the P-Charging-Vector header field.\nNOTE 1:\tThe means by which the decision is made to forward to an MGCF or to another network is outside the scope of the present document, but can be by means of a lookup to an external database, or can be by data held internally to the BGCF.\nIf the BGCF supports carrier routeing, then the BGCF shall support the following procedures, based on local policy:\na)\tif the BGCF is configured to populate an operator configured preassigned carrier into a tel- contained in the Request-, and a preassigned carrier is required for this call, then the BGCF shall include the \"cic\" tel- parameter in the Request- identifying the preassigned carrier (as described in RFC 4694 [112]); or\nb)\tif the BGCF is configured to populate the freephone carrier ID, and a freephone carrier is required for this call, then the BGCF shall include the \"cic\" tel- parameter in the Request- identifying the freephone carrier (as described in RFC 4694 [112]).\nThe BGCF carrier routeing procedures also apply when the Request- is in the form of a SIP  user=phone, where the \"cic\" tel- parameter is contained in the userinfo part of the SIP .\nThe BGCF shall not add the \"cic\" tel- parameter in the Request- if the parameter already exists in the tel-.\nNOTE 2:\tLocal policy should be able to control the interaction and precedence between routeing on \"cic\" parameter versus routeing based on \"rn\" parameter.\nNOTE 3:\tThe means to configure the BGCF with the pre-assigned carrier is outside the scope of this document.\nIf\na)\tthe BGCF supports indicating the traffic leg as specified in RFC 7549 [225];\nb)\tan \"iotl\" SIP  parameter is not already included in the Request-; and\nNOTE 4:\tIf an \"iotl\" SIP  parameter is included it contains the value \"visitedA-homeB\" inserted by the TRF in the roaming architecture for voice over IMS with local breakout scenario.\nc)\trequired by local policy;\nthe BGCF shall before forwarding the request:\na) if the Request- contains a SIP , append the \"iotl\" SIP  parameter set to \"homeA-homeB\" to the Request-; and\nb) if the Request- contains a tel  that can be converted to a SIP  by the BGCF:\n-\tconvert the tel  in the Request- to the form of a SIP  with user=phone; and\n-\tappend an \"iotl\" SIP  parameter with a value set to \"homeA-homeB\" in the Request-.\nNOTE 5:\tIf the \"iotl\" SIP  parameter can not be included by the above procedure, the upstream nodes have to determine the II-NNI traversal scenario by analysing the content of the SIP request (implementation dependent) or using the default II-NNI traversal scenario type.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.3\tSpecific procedures for INVITE requests and responses",
                            "text_content": "When the BGCF receives an INVITE request that contains a Feature-Caps header field with the \"+g.3gpp.home-visited\" header field parameter, the BGCF shall decide based on local policy whether to perform loopback routeing for this request. The BGCF shall:\na)\tif loopback routeing is not to be performed for this request remove any \"+g.3gpp.trf\" or \"+g.3gpp.home-visited\" header field parameter from the Feature-Caps header field of the outgoing request;\nb)\tif loopback routeing is applied for this request:\ni)\tremove all entries in the Route header field;\nii)\tif a \"+g.3gpp.trf\" header field parameter with a parameter value containing a valid , is included in the Feature-Caps header field of the request, insert the  in a Route header field;\niii)\tif a \"+g.3gpp.trf\" header field parameter, with a parameter value containing a valid  is not included in the Feature-Caps header field of the request, insert a locally configured TRF address, associated with the visited network for this call (as identified in the \"+g.3gpp.home-visited\" header field parameter), in the Route header field;\niv)\tremove any \"+g.3gpp.home-visited\" header field parameter from the Feature-Caps header field of the outgoing request;\nv)\tif included in the incoming request, remove the \"+g.3gpp.trf\" header field parameter from the Feature-Caps header field from the outgoing request;\nvi)\tinsert the \"+g.3gpp.loopback\" header field parameter, as specified in subclause 7.9A.4 in the Feature-Caps header field of the request, in accordance with RFC 6809 [190]. If providing the identifier of the home network is supported by the BGCF and the visited network, the BGCF may based on operator agreement insert the \"+g.3gpp.loopback\" header field parameter set to the identifier of the home network;\nvii)\tremove the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field, if present. The BGCF shall insert a type 1 \"orig-ioi\" header field parameter into the P-Charging-Vector header field and shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the home network of the served user (i.e. the network in which the BGCF resides). The BGCF shall not include the \"term-ioi\" header field parameter; and\nviii)\tif the BGCF supports indicating the traffic leg associated with a  as specified in RFC 7549 [225] and if an \"iotl\" SIP  parameter is not included in the TRF  in the Route header field, the BGCF if required by local policy, append an \"iotl\"  parameter with a value set to \"homeA-visitedA\" to the  in the Route header field; and\nc)\tif the final decision on loopback routeing is deferred to a subsequent entity in the home network, a further BGCF, then, retain in the request a Feature-Caps header field with the \"+g.3gpp.home-visited\" header field parameter with the parameter value set to the identifier of the visited network. The BGCF is expected to know by means of network configuration that such a subsequent entity exists;\nIf the BGCF inserts its own Record-Route header field, the BGCF may require the periodic refreshment of the session to avoid hung states in the BGCF. If the BGCF requires the session to be refreshed, the BGCF shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nIf overlap signalling using the multiple-INVITE method is supported as a network option, several INVITE requests with the same Call ID and the same From header field (including \"tag\" header field parameter) can be received outside of an existing dialog. Such INVITE requests relate to the same call and the BGCF shall route such INVITE request received during a certain period of time to the same next hop.\nIf the BGCF inserted in the initial request for the dialog the header field parameters into the Feature-Caps header field then the BGCF shall include the header field parameters with the same parameter values into the Feature-Caps header field in any target refresh request for the dialog, and in each 1xx or 2xx response to target refresh request sent in the same direction.\nBased on local policy, the BGCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter of the P-Charging-Vector header field with its own address or identifier to an initial request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.4\tSpecific procedures for subsequent requests and responses",
                            "text_content": "When the BGCF receives a subsequent request whose initial request applied loopback routeing, the BGCF shall:\na)\tremove the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field, if present. The BGCF shall insert a type 1 \"orig-ioi\" header field parameter into the P-Charging-Vector header field and shall set the type 1 \"orig-ioi\" header field parameter to a value that identifies the home network of the served user (i.e. the network in which the BGCF resides). The BGCF shall not include the \"term-ioi\" header field parameter.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.7\tProcedures at the Application Server (AS)",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.7.1\tCommon Application Server (AS) procedures",
                            "text_content": "When sending a failure response to any received request, depending on operator policy, the AS may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"as\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17. An AS when sending a failure response will add in the URN the \"role\" header field parameter set to the corresponding AS role listed in subclause 7.2.17.\nThe AS may support the REGISTER method in order to discover the registration status of the user. If a REGISTER request arrives and the AS supports the REGISTER method, the AS shall store the registration expiration interval value from the request and generate a 200 (OK) response or an appropriate failure response. For the success case, the 200 (OK) response shall contain a registration expiration interval value equal to the value received in the REGISTER request. The AS shall store the values received in P-Charging-Function-Addresses header field. Also, the AS shall store the values of the \"icid-value\" header field parameter and \"orig-ioi\" header field parameter if present in the P-Charging-Vector header field from the REGISTER request.\nNOTE 1:\tThe user can have one or more contacts registered after a 3rd party REGISTER request with an Expires header field set to a value \"0\" has been received. If an AS needs more detailed knowledge of the user registration status, the AS can subscribe to the reg event package.\nIf a Contact header field is included in the REGISTER request including a \"+g.3gpp.registration-token\" header field parameter as defined in subclause 7.9.7, the AS supporting this feature shall store the value of the \"+g.3gpp.registration-token\" header field parameter.\nNOTE 2:\tThe S-CSCF can set this token to the same value as used in the \"id\" parameter identifying the contact in the \"reg\" event package, allowing the AS to retrieve the value from the \"reg\" event package. The AS can know by configuration or other means if the S-CSCF uses this value.\nThe AS shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the REGISTER request, a type 3 \"term-ioi\" header field parameter in the response to REGISTER and the \"icid-value\" header field parameter. The AS shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the service provider from which the response is sent, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request.\nUpon receipt of a third-party REGISTER request, with the Content-Type header field or with a MIME body part's Content-Type header field set according to subclause 7.6 (i.e. \"application/3gpp-ims+xml\"), independent of the value or presence of the Content-Disposition header field or a MIME body part's Content-Type header field, independent of the value or presence of Content-Disposition parameters or MIME body part's Content-Disposition parameters, then the following treatment is applied:\n-\tif the third-party REGISTER request includes an IM CN subsystem XML body with an <ims-3gpp> element, including a version attribute, with the <service-info> child element or a MIME body part containing an <ims-3gpp> element with a <service-info> XML child element as described in subclause 7.6, then the AS may retrieve the service information within the <service-info> XML child element of the <ims-3gpp> element.\nUpon receipt of a third-party REGISTER request, with the Content-Type header field or with a body part's Content-Type header field set to \"message/sip\" and including a \"message/sip\" MIME body of the incoming REGISTER request, or the 200 (OK) response to the incoming REGISTER request then the AS may retrieve information from the \"message/sip\" MIME body or body part.\nUpon receipt of a third-party REGISTER request, the AS may subscribe to the reg event package for the public user identity registered at the user's registrar (S-CSCF) as described in RFC 3680 [43] and RFC 6665 [28].\nOn sending a SUBSCRIBE request, the AS shall populate the header fields as follows:\na)\ta Request- set to the resource to which the AS wants to be subscribed to, i.e. to a SIP  that contains the public user identity of the user that was received in the To header field of the third-party REGISTER request;\nb)\ta From header field set to the AS's SIP ;\nc)\ta To header field, set to a SIP  that contains the public user identity of the user that was received in the To header field of the third-party REGISTER request;\nd)\tan Event header field set to the \"reg\" event package;\ne)\ta P-Asserted-Identity header field set to the SIP  of the AS; and\nNOTE 3:\tThe S-CSCF expects the SIP  used in the P-Asserted-Identity header field to correspond to the SIP , which identified this AS in the initial filter criteria of the user to whose registration state the AS subscribes to.\nf)\ta P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 3 \"orig-ioi\" header field parameter. The type 3 \"orig-ioi\" header field parameter identifies the service provider from which the request is sent. The AS shall not include the type 3 \"term-ioi\" header field parameter.\nUpon receipt of a dialog establishing NOTIFY request, as specified in RFC 6665 [28], associated with the SUBSCRIBE request, the AS shall:\n1)\tstore the information for the so established dialog;\n2)\tstore the expiration time as indicated in the \"expires\" header field parameter of the Subscription-State header field, if present, of the NOTIFY request. Otherwise the expiration time is retrieved from the Expires header field of the 2xx response to SUBSCRIBE request; and\n3)\tfollow the procedures specified in RFC 6665 [28].\nUpon receipt of any response, the AS shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field if present.\nNOTE 4:\tAny received term-ioi parameter will be a type 3 term-ioi. The type 3 term-ioi identifies the network operator from which the response was sent.\nNOTE 5:\tUpon receipt of a NOTIFY request with all <registration> element(s) having their state attribute set to \"terminated\" (i.e. all public user identities are deregistered) and the Subscription-State header field set to \"terminated\", the AS considers the subscription to the reg event package terminated, i.e. as if the AS had sent a SUBSCRIBE request with an Expires header field containing a value of zero.\nUpon receipt of a NOTIFY request for the dialog associated with the subscription to the reg event package, the AS shall:\n-\tstore the information for the established dialog;\n-\tstore the expiration time as indicated in the \"expires\" header field parameter of the Subscription-State header field, if present, of the NOTIFY request. Otherwise the expiration time is retrieved from the Expires header field of the 2xx response to SUBSCRIBE request;\n-\tstore the value of the \"orig-ioi\" header field parameters if present in the P-Charging-Vector header field. The AS shall insert a P-Charging-Vector header field in the response to the NOTIFY request containing the \"orig-ioi\" header field parameter, if received in the NOTIFY request, a type 3 \"term-ioi\" header field and the \"icid-value\" header field parameter;\n-\tset the type 3 \"term-ioi\" header field parameter to a value that identifies the service provider from which the response is sent, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request; and\n-\tfollow the procedures specified in RFC 6665 [28].\nWhen an AS receives an initial request for a dialog or a request for a standalone transaction, the AS shall store the values received in the P-Charging-Vector header field, e.g. \"orig-ioi\" header field parameter, if present, and \"icid-value\" header field parameter, and retain the P-Charging-Vector header field in the message. The AS shall store the values received in the P-Charging-Function-Addresses header field and retain the P-Charging-Function-Addresses header field in the message.\nWhen an AS sends any request or response related to a dialog or standalone transaction, the AS shall insert previously saved values into the P-Charging-Vector header field and may insert previously saved values into the P-Charging-Function-Addresses header field before sending the message.\nThe AS may receive information about the served user core network in REGISTER requests from S-CSCF. This information can be obtained either from the P-Access-Network-Info header field and P-Visited-Network-ID header field in the REGISTER request or can be obtained from those header fields in the body of the REGISTER request.\nThe AS may also receive information about the served user access network in other requests (excluding CANCEL requests and responses). This information can be obtained from the P-Access-Network-Info header field.\nThe AS can use the P-Access-Network-Info and P-Visited-Network-ID header fields to provide an appropriate service to the user.\nThe determination of the served user is different per session:\n-\tfor an originating session, the procedure is described in subclause 5.7.1.3A.2; and\n-\tfor a terminating session the procedure is described in subclause 5.7.1.3A.3.\nIf the AS supports the P-Served-User header field as defined in RFC 5502 [133] and RFC 8498 [239] and the P-Served-User header field is included in the received request, the AS can determine the session case related to the request, as specified in 3GPP TS 29.228 [14], from the P-Served-User header field parameters if available.\nIf an AS receives a request on behalf of an originating user:\n-\tand the AS supports the P-Served-User header field as defined in RFC 5502 [133], the AS shall determine the served user by taking the identity contained in the P-Served-User header field if available;\n-\totherwise, if the AS supports the History-Info header field as defined in RFC 7044 [66] the AS shall determine the served user from the content of the History-Info header field if available; and\n-\totherwise, the AS shall determine the served user by taking the identity contained in P-Asserted-Identity header field.\nIf an AS receives a request on behalf of a terminating user:\n-\tand the AS supports the P-Served-User header field as defined in RFC 5502 [133], the AS shall determine the served user by taking the identity contained in the P-Served-User header field if available;\n-\totherwise, if the AS supports the History-Info header field as defined in RFC 7044 [66] the AS shall determine the served user from the content of the History-Info header field if available; and\n-\totherwise, the AS shall determine the served user from the content of the Request-.\nA prerequisite for the procedure in this subclause is that a REGISTER request has been received including a Contact header field with a \"+g.3gpp.registration-token\" header field parameter and that the AS supports using this token to identify the registration.\nWhen receiving an initial request for a dialog or a request for a standalone transaction, or a response to such request the AS shall if a \"+g.3gpp.registration-token\" header field parameter as defined in subclause 7.9A.8 is included in a Feature-Caps header field use this value to identify the registration used for this initial request for a dialog or this request for a standalone transaction or a response to such request by comparing it to the value of the \"+g.3gpp.registration-token\" Contact header field parameter stored when the user registered.\nNOTE:\tThe Include Register Request or Include Register Response indication in the initial Filter Criteria can be used to provide the incoming REGISTER request or 200 (OK) response to the incoming REGISTER request containing the instance ID to the AS. The AS can use the mechanism in this subclause to determine the instance ID for subsequent requests and responses.\nIf the AS routes the originating request to another entity than the S-CSCF, the AS shall remove the \"+g.3gpp.registration-token\" header field parameter from the Feature-Caps header field before forwarding the request.\nThe procedures at the AS to accomplish user identity verification are described with the help of figure 5-1. Procedures for user identity verification using the Identity header field are specified in subclause 5.7.1.25.\nNOTE:\tDifferent means can be used to represent or transport the credentials. Such mechanisms are subject to operator policy and can e.g. include the P-Asserted-Identity header field, the Authorization header field or other mechanisms not specified by 3GPP TS 24.229.\nWhen the AS receives a SIP initial or standalone request, excluding REGISTER request, that does not contain credentials, the AS shall:\na)\tif a Privacy header field is present in the initial or standalone request and the Privacy header field value is set to \"id\" or \"user\", then the user and the request are considered as anonymous, and no further actions are required. The AS shall consider the request as authenticated;\nb)\tif there is no Privacy header field present in the initial or standalone request, or if the Privacy header field contains a value other than \"id\" or \"user\", then the AS shall check for the presence of a P-Asserted-Identity header field in the initial or standalone request. Two cases exist:\ni)\tthe initial or standalone request contains a P-Asserted-Identity header field. This is typically the case when the user is located inside a trusted domain as defined by subclause 4.4. In this case, the AS is aware of the identity of the user and no extra actions are needed. The AS shall consider the request as authenticated; and\nii)\tthe initial or standalone request does not contain a P-Asserted-Identity header field. This is typically the case when the user is located outside a trusted domain as defined by subclause 4.4. In this case, the AS does not have a verified identity of the user. The AS shall check the From header field of the initial or standalone request. If the From header field value in the initial or standalone request is set to \"Anonymous\" as specified in RFC 3261 [26], then the user and the request are considered as anonymous and no further actions are required. If the From header field value does not indicate anonymity, then the AS shall challenge the user by issuing a 401 (Unauthorized) response including a challenge as per procedures described in RFC 3261 [26].\nWhen the AS receives a SIP initial or standalone request that contains credentials but it does not contain a P-Asserted-Identity header field the AS shall check the correctness of the credentials as follows:\na)\tIf the credentials are correct, then the AS shall consider the identity of the user verified, and the AS shall consider the request as authenticated;\nb)\tIf the credentials are not correct, the AS may either rechallenge the user by issuing a 401 (Unauthorized) response including a challenge as per procedures described in RFC 3261 [26] (up to a predetermined maximum number of times predefined in the AS configuration data), or consider the user as anonymous. If the user is considered anonymous, the AS shall consider the request as authenticated.\n\nThe figure depicts the user identity verification process at the Access Service Provider (AS) level, illustrating the flow of authentication and authorization. It includes steps such as user identification, authentication, and authorization, with the use of biometric and behavioral biometrics. The figure also highlights the role of the Identity and Access Management (IAM) system in managing user identities and access rights.\nFigure 5-1: User identity verification flow at the AS\nOnce the AS have tried to verify the identity of the user, the AS either has a verified identity of the user or it considers the user as anonymous.\nIf the user is considered anonymous, the AS shall check whether the authorization policy defined for this request allows anonymous requests. If anonymous requests are allowed, then the AS can proceed with the requested functionality, otherwise, the AS shall not proceed with the requested functionality.\nIf the user is identified by an identity, the AS shall apply the authorization policy related to the requested functionality to detect whether the particular user is allowed to request the functionality. The authorization policy may require a verified identity of a user.\nIf the request is authorized then the AS shall continue with the procedures as defined for that request.\nIf the request is not authorized, the AS shall either:\n-\treject the request according to the procedures defined for that request e.g., by issuing a 403 (Forbidden) response; or\n-\tsend a 2xx final response if the authorization policy requires to deny the requested functionality, whilst appearing to the user as if the request has been granted.\nIf the AS has a local configuration information limiting the rate at which notification generation is allowed, then the AS shall take that information into account. Such local configuration information could be e.g. the shortest time period between issuing consecutive NOTIFY requests.\nIf home operator's local policy defines a prefix string(s) to enable subscribers to differentiate dialling a geo-local number and/or a home-local number and if the phone number in a non-international format in the Request- includes such a prefix, the AS shall interpret the received number in a non-international format as a geo-local number or as a home-local number according to the prefix.\nIf the phone number in a non-international format in the Request- includes a \"phone-context\" tel  parameter, the AS shall:\n1)\tif the \"phone-context\" tel  parameter contains access technology information or the home network domain name prefixed by the \"geo-local.\" string, interpret it as a geo-local number;\n2)\tif the \"phone-context\" tel  parameter contains the home network domain name, interpret it as a home-local number; or\n3)\tif the \"phone-context\" tel  parameter contains any other value, apply general procedures for translation.\nNOTE 1:\tIf business communication services are provided to the calling user, and the \"phone-context\" tel  parameter contains a value associated with a private numbers, it is expected that any needed translation of the number information is handled by the corresponding business communication AS.\nIf the phone number in a non-international format in the Request- includes both operator defined prefix and a \"phone-context\" tel  parameter and those information are contradictory, the AS shall ignore either the prefix or the \"phone-context\" tel  parameter according to operator policy.\nIf the phone number in a non-international format in the Request- does not include either a \"phone-context\" tel  parameter or an operator defined prefix, the AS shall interpret the phone number in a non-international format either as a geo-local number or as a home-local number according to operator policy.\nNOTE 2:\tOperator must ensure that service setting dialling strings do not reach local numbering AS by setting appropriately the precedences of the initial filter criteria.\nWhen an AS receives a request having a geo-local number in a non-international format in the Request-, the AS shall use the \"phone-context\" tel  parameter to determine the visited access network, if the \"phone-context\" tel  parameter in the Request- is available. If the \"phone-context\" tel  parameter in the Request- is not available, the AS may determine the visited access network based on the available P-Access-Network-Info header fields containing the access-type field, if it is available in the received request, or by means outside the scope of this document.\nIf the visited access network is determined:\n1)\tif the home network supports the roaming architecture for voice over IMS with local breakout, and an incoming INVITE request contains a Feature-Caps header field with the \"+g.3gpp.home-visited\" header field parameter, the AS may choose to not attempt translation of some geo-local numbers and defer the translation to the visited network after loopback has been performed; or\n2)\tthe AS shall attempt to determine whether the geo-local number:\na)\tcorresponds to a home local service number that can be used by a roaming user;\nb)\tis used to access a service in the visited network; or\nc)\tis used to access the local addressing plan of the visited network\n-\tand translate the received geo-local number to a globally routeable SIP  or an international tel :\nNOTE 1:\tDuring the translation the AS can contact an entity in the visited access network for getting the needed information. The protocol and procedures for this is outside the scope of this specification.\nNOTE 2:\tThe AS can translate the tel  to a SIP  by including the 'telephone-subscriber' part of the received tel  to the user part of the SIP  and setting the domain name of the SIP  to indicate the domain name of the network of the phone number based on the received \"phone-context\" tel  parameter.\nNOTE 3:\tIn addition to the service numbers corresponding to a service in the visited network the home network can also support service numbers corresponding to services in the home network as geo-local service numbers.\nWhen an AS receives a request having a home-local number in a non-international format in the Request-, the AS shall determine whether the home-local number is used to access a service or the local addressing plan and translate the received home-local number to a globally routeable SIP  or an international tel :\nWhen an AS receives a request having any other number in a non-international format in the Request-, the AS shall attempt to determine whether it is used to access a service in the third network or the local addressing plan of the third network and translate the received number in a non-international format to a globally routeable SIP  or an international tel :\nNOTE 4:\tThe AS can translate the tel  to a SIP  by including the 'telephone-subscriber' part of the received tel  to the user part of the SIP  and setting the domain name of the SIP  to indicate the domain name of the network of the phone number based on the received \"phone-context\" tel  parameter;\nNOTE 5:\tIf business communication services are provided to the calling user, and the \"phone-context\" tel  parameter contains a value associated with a private numbers, it is expected that any needed translation of the number information is handled by the corresponding business communication AS.\nIf the translation at the AS fails, the AS shall either send an appropriate SIP response or leave the Request- unmodified and route the request based on the topmost Route header field, based on local policy.\nIt is possible for an AS to use a GRUU referring to itself when inserting a contact address in a dialog establishing or target refreshing SIP message.\nThis specification does not define how GRUUs are created by the AS; they can be provisioned by the operator or obtained by any other mechanism. The GRUU shall remain valid for the time period in which features addressed to it remain meaningful.\nThe AS shall handle requests addressed to its currently valid GRUUs when received outside of the dialog in which the GRUU was provided.\nEXAMPLE:\tUpon receipt of an INVITE request addressed to a GRUU assigned to a dialog it has active, and containing a Replaces header field referencing that dialog, the AS will be able to establish the new call replacing the old one, if that is appropriate for the features being provided by the AS.\nWhen an AS is acting as a routeing B2BUA (as defined in subclause 5.7.5) it may provide a contact address that is not a GRUU when the contact address in the incoming message that is being replaced is not a GRUU.\nWhen an AS is acting as a routeing B2BUA forwards a SIP request it shall transparently forward a received Contact header field when the Contact header field contains a GRUU. When transparently forwarding a received Contact header field of a dialog-forming request, the AS shall include its own  in a Record-Route header field in order to ensure that it is included on the route of subsequent requests.\nWhen an AS acts as UA or Initiating B2BUA it shall use a GRUU as the contact address if the AS acts as a notifier per RFC 6665 [28] and RFC 7647 [231], otherwise the AS may provide a contact address that is not a GRUU in cases where it can ascertain that valid requests that could result from the use of that contact and follow the usage rules of RFC 5627 [93] will reach the element. In all other cases the AS shall use a GRUU.\nAn AS acting as a UA or an initiating B2BUA on behalf of a public user identity can provide a GRUU in the contact address referring to itself as described above. When the AS provides a GRUU on behalf of a user, subsequent dialog-initiating requests sent to that GRUU will be routed directly to the AS, thus bypassing terminating services assigned to the user. If the AS wishes to have terminating services applied for the user, the AS may generate a new terminating request addressed to a public GRUU associated with the public user identity of the user.\nNOTE 1:\tIf the AS wishes to have terminating services applied when the public user identity on whose behalf the AS is acting is unregistered, then the options available to the AS depend on whether or not the subscriber has ever previously registered with the IM CN subsystem. In the case where the public user identity had previously registered with the IM CN subsystem, then the AS can use the most recently allocated public GRUU if available. In the case where the user has never registered with the IM CN subsystem, then the AS can use the public user identity itself.\nNOTE 2:\tOnce terminating services have been applied, it is assumed that the terminating S-CSCF will route the request back to this AS via the initial filter criteria. In order for this to work, the initial filter criteria of the target user need to be configured so that the AS is invoked at the appropriate time relative to other terminating ASs (say, after the required terminating services have been applied). The mechanism to ensure that the AS is invoked by the initial filter criteria at the appropriate time is outside the scope of this specification (e.g. the user's filter criteria could be statically configured to invoke the AS at the correct time, or the AS could use the Dynamic Service Activation Information mechanism to activate the appropriate filter criteria).\nWhen an AS acts as a UA or an initiating B2BUA, and is originating or terminating a request on behalf of a public user identity, and privacy is required, the AS shall ensure that any GRUU provided in the contact address in the request does not reveal the public user identity of the user.\nBased on service logic, an AS can validate an ICSI value received in an Accept-Contact header field or received in a P-Asserted-Service header field and reject the request if necessary.\nA trusted AS may insert a P-Asserted-Service header field in a request for a new dialog or standalone transaction. An untrusted AS may insert a P-Preferred-Service header field in a request for a new dialog or standalone transaction. If the request is related to an IMS communication service that requires the use of an ICSI then the AS:\n-\tshall include the ICSI value (coded as specified in subclause 7.2A.8.2), for the IMS communication service that is related to the request in either a P-Asserted-Service header field or a P-Preferred-Service header field depending whether the AS is trusted or not according to RFC 6050 [121].\nWhen an AS that is acting as a UA or initiating B2BUA or routeing B2BUA sends an initial request for a dialog or a request for a standalone transaction, the AS may include an Accept-Contact header field containing:\n-\tan ICSI value (coded as specified in subclause 7.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 and RFC 3841 [56B]; and\n-\tone or more IARI values (coded as specified in subclause 7.2A.9.2) that are related to the request in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3841 [56B];\nif the ICSI or IARIs for the IMS communication service and IMS application are known.\nThe AS may:\n-\tinclude the received ICSI and IARI values;\n-\treplace or remove received ICSI and IARI values; or\n-\tinclude new ICSI and IARI values.\nWhen the AS acting as a UA or initiating B2BUA or routeing B2BUA sends a SIP request or a SIP response related to an IMS communication service, the AS may include in the Contact header field:\n-\tin a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 one or more ICSI values (coded as specified in subclause 7.2A.8.2); and\n-\tone or more IARI values (coded as specified in subclause 7.2A.9.2) in a g.3gpp.iari-ref media feature tag, for the IMS applications, that are related to the request as defined in subclause 7.9.2 and RFC 3840 [62];\nif the ICSI or IARIs for the IMS communication service and IMS application are known. The AS may:\n-\tinclude the received ICSI and IARI values;\n-\treplace or remove received ICSI values; or\n-\tinclude new ICSI and IARI values.\nWhen sending a 18x or 2xx response to a request on behalf of an originating user, then the AS may insert a Feature-Caps header field with the \"+g.3gpp.icsi-ref\" header field parameter into the response, as specified in RFC 6809 [190]. The parameter value is set according to subclause 7.9A.2.\nNOTE 3:\tThe AS can insert the Feature-Caps header field e.g. based on operator policy, IMS communication service specification or depending whether other AS already inserted the Feature-Caps header field with the \"+g.3gpp.icsi-ref\" header field parameter in the response.\nWhen sending a request on behalf of a terminating user, then the AS may insert a Feature-Caps header field with the \"+g.3gpp.icsi-ref\" header field parameter. The parameter value is set according to subclause 7.9A.2.\nNOTE 4:\tThe AS can insert the Feature-Caps header field e.g. based on operator policy, IMS communication service specification or depending whether other AS already inserted the Feature-Caps header field with the \"+g.3gpp.icsi-ref\" header field parameter in the request.\nIf the AS inserted the header field parameters in the Feature-Caps header field in the request or in 18x or 2xx response to request then the AS shall include the header field parameters with the same parameter values into the Feature-Caps header field in any target refresh request, and in each 1xx or 2xx response to target refresh request sent in the same direction.\nAn AS may play a role in support of carrier selection as defined in RFC 4694 [112].\nNOTE 1:\tIn general, ASs do not need to support carrier selection, Rather a specific AS or a few ASs in a network will be used for carrier selection,\nWhen an AS that supports carrier selection receives an initial request with a Request- in the form of a tel- that contains a \"cic\" tel- parameter inserted by the UE and if configured per operator policy, the AS may validate the value of the \"cic\" parameter. If an AS that supports carrier selection determines the \"cic\" parameter received in the initial request to be valid, as configured per operator policy, the AS shall process the request accordingly. If an AS supports carrier selecton and determines the \"cic\" parameter received in the initial request to be invalid, then the AS shall remove the \"cic\" parameter and process the request as if no \"cic\" had been received from the UE.\nWhen an AS that support carrier selection receives an initial request with a Request- in the form of a tel-, the AS may, based on operator policy, insert an appropriate value for the \"cic\" tel- parameter as defined in RFC 4694 [112].\nNOTE 2:\tFor example, the AS that supports preferred carrier could insert a \"cic\" tel- parameter that identifies the originating user's preassigned carrier, or the carrier assigned to a called freephone number.\nWhen an AS that support carrier selection receives an initial request with a Request- in the form of a SIP  user=dialstring (see RFC 4967 [103]), the AS may translate the SIP  to a valid tel- or a valid SIP  user=phone comprising a userinfo part containing the tel- and a domain matching the domain of the original SIP  user=dialstring. If the received SIP  user=dialstring is successfully converted, then the AS shall replace the Request- with the newly created tel- or SIP  user=phone. The AS shall then process the request as if it had arrived from the UE containing this tel- or SIP  user=phone in the Request-.\nNOTE 3:\tThis specification does not make any assumptions regarding how these procedures are mapped to ASs; whether all procedures are supported by a single AS or spread across multiple ASs. However, this specification does assume that the responsibility for ensuring that the UE complies with the carrier selection procedures defined in RFC 4694 [112] will be performed by a single AS (e.g. validate \"cic\"), and the filter criteria will be configured so that this AS is invoked before other ASs that have carrier selection responsibilities.\nThe AS carrier selection procedures also apply when the request contains a Request- in the form of a SIP  user=phone, where the \"cic\" tel- parameter is contained in the userinfo part of the SIP .\nAn AS can retrieve tracing configuration information from the HSS via the Sh reference point. The AS tracing configuration can use the parameters specified in 3GPP TS 24.323 [8K] but need not structure them as a management object.\nIf the service the AS provides needs to deliver the original destination identity to the UE, the AS shall insert a new hi-entry to the last hi-entry of History-Info header field including \"mp\" header field parameter as specified in RFC 7044 [66].\nNOTE:\tIf the \"mp\" header field parameter is present in the hi-entries within the History-Info header field, the information of the original destination number or , e.g. the service number for freephone, will be found in the hi-entry whose index-val matches the value of the first hi-entry with \"mp\" header field parameter.\nThe AS may populate the \"cpc\" and \"oli\"  parameters in each initial request for a dialog or a request for a standalone transaction in the tel  or SIP  representation of telephone numbers in the P-Asserted-Identity header field based on their origin source.\nIdentification of emergency transactions for termination in the public network by an AS are outside the scope of this document, and are dependent on many application specific considerations.\nWhere an AS decides to generate an emergency request on behalf of its served user, the AS shall meet the following conditions:\n1)\tthe UE is in the same network as the S-CSCF (i.e. that the UE is not roaming).\nNOTE 1:\tHow the above is determined is outside the scope of this document and will depend on the application supported. Possible mechanisms could be: 1) that the AS only receives requests that are from non-roaming UEs; 2) analysis of the P-Access-Network-Info header field in a received request from the UE.\nThe AS generate the request with the following contents:\n1)\tinclude in the Request- an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69]. An additional sub-service type can be added if information on the type of emergency service is known;\n2)\ta Route header field with the topmost Route header field set to the  associated with an E-CSCF;\n3)\tif the AS is part of the trust domain of the network, a P-Asserted-Identity header field containing the identity of the UE served by the AS;\n4)\tif the AS is not part of the trust domain of the network, a P-Preferred-Identity header field containing the identity of the UE served by the AS;\n5)\tif a GRUU is available for the UE served by the AS, provide the GRUU as part of a Contact header field;\nNOTE 2:\tIf the AS is not already aware of the GRUU of the UE due to previously receiving it in a Contact header, and the UE is registered, the GRUU can be obtained using either the subscription to the reg events package or using the third-party registration procedure with the REGISTER request including a \"message/sip\" MIME body of the 200 (OK) response for the REGISTER request as described in subclause 5.7.1.1.\n6)\tif a location is available at the AS in any form, include a Geolocation header field with that location;\n7)\ta P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17];\n8)\tif the AS supports calling number verification using signature verification and attestation information as specified in subclause 3.1 and if required by operator policy, the AS shall perform attestation of the user identity by inserting:\n-\ta \"verstat\" tel URI parameter, specified in subclause 7.2A.20, to the tel URI or SIP URI with a user=phone parameter in the From header field or the P-Asserted-Identity header field;\n-\tan Attestation-Info header field, specified in subclause 7.2.18; and\nan Origination-Id header field, specified in subclause 7.2.19, set to a UUID identifying the AS which is configured based on local policy and requirements from national regulation; and\n9)\tif the AS supports priority verification using assertion of priority information as specified in subclause 3.1 and if required by operator policy, the AS shall add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197].\nIf the AS does not receive any response to the INVITE request (including its retransmissions); or receives a 3xx response or 480 (Temporarily Unavailable) response to an INVITE request, the AS shall select a new E-CSCF and forward the INVITE request.\nThe AS upon receiving a 3xx response to a request from the served UE that contains a Contact header field may remove the Contact header field or modify the response code from 3xx to an appropriate non 2xx response code (e.g. 5xx response code) based on operator policy before sending the response towards the UE.\nNOTE:\tAutomatically recursing on untrusted 3xx responses opens up the UE to being redirected to premium rate URIs without the user's consent. An AS that protects against attacks using 3xx responses needs to ensure that it doesn't break services that depend on 3xx responses being passed to the UE. Subclause 5.1.2A.1.1 specifies how a UE protects itself against attacks using 3xx responses. For some services an AS could automatically recurse on a 3xx response.\nAn AS in a network supporting the roaming architecture for voice over IMS with local breakout shall not change the value of the \"icid-value\" header field parameter in the P-Charging-Vector header field received in the INVITE request when the AS sends any request or response related to an INVITE transaction.\nNOTE:\tAn AS that determines that loopback is not a viable option can change or remove any of the above parameters if required by the application logic performed by the AS.\nWhen the AS is accessed by a network supporting roaming architecture for voice over IMS with local breakout, and the incoming INVITE request contains a Feature-Caps header field with the \"+g.3gpp.home-visited\" header field parameter, the AS can indicate to the S-CSCF its preference for loopback routeing not to occur by removing the \"+g.3gpp.home-visited\" header field parameter from the Feature-Caps header field from any outgoing INVITE request back to the S-CSCF. Reasons for such an indication might include the need to terminate media streams at an MRF in the home network.\nNOTE:\tIf the original dialog identifier sent by the S-CSCF is not preserved by the AS in the outgoing requests, then loopback routeing will not occur.\nIf the AS supports delivery of network provided location information, and the AS performs the retrieval of cell id and/or UE time zone via Sh interface, the AS shall insert the P-Access-Network-Info header field with the cell id, local-time-zone parameter and/or the \"daylight-saving-time\" parameter, including a \"network-provided\" parameter in the incoming request or response. Additionally, if required by local operator policy and the AS is able to deduce a Geographical Identifier from the Cell Global Identity () or form the Service Area Identifier (SAI), the AS shall include an operator-specific-GI header field parameter. The P-Access-Network-Info header field shall only be inserted if there is not already a network provided information.\nWhen the AS receives, in a SIP request or response, a P-Access-Network-Info header field which does not contain the operator-specific-GI header field parameter, contains a Cell Global Identity () or a Service Area Identifier (SAI) information and contains the \"network provided\" header field parameter, if required by local operator policy and if the AS is able to deduce a Geographical Identifier from the contained Cell Global Identity () or form the contained Service Area Identifier (SAI), the AS shall instert an operator-specific-GI header field parameter in that received network provided P-Access-Network-Info header field.\nThe AS can obtain a Geographical Identifier from the  by using the e2 interface (see ETSI ES 283 035 [98]).\nNOTE:\tETSI ES 283 035 [98] Release 3 enables querying a  using the User-Data-Request command in which the Global-Access-Id  contains the 3GPP-User-Location-Info  with a  or a SAI value to get a corresponding Geographical Identifier. If multiple CLFs are deployed, the AS can dertermine which  to query based on the  or the SAI values or can use a DIAMETER proxy if deployed.\nA visited MRB address can be received during session establishment. If an AS receives the  of an MRB in a \"+g.3gpp.mrb\" header field parameter included in a Feature-Caps header field of an INVITE request, it shall store this . If the AS requests allocation of MRF resources from an MRB in its own network, either in in-line or query mode, the AS shall forward the visited network MRB  in the request.\nBased on operator policy, the AS may subscribe to the load-control event package with one ore more target SIP entities. The list of target SIP entities is provisioned.\nSubscription to the load-control event package is triggered by internal events (e.g. the physical device hosting the SIP entity is power-cycled) or through a management interface.\nThe AS shall perform subscriptions to the load-control event package to a target entity in accordance with RFC 6665 [28] and with RFC 7200 [201]. When subscribing to the load-control event, the AS shall:\n1)\tSend a SUBSCRIBE request in accordance with RFC 6665 [28] and with RFC 7200 [201] to the target entity, with the following elements:\n-\tan Expires header field set to a network specific value;\n2)\tIf the target entity is located in a different network and local policy requires the application of IBCF capabilities, forward the request to an IBCF acting as an exit point.\nThe AS shall automatically refresh ongoing subscriptions to the load-control event package either 600 seconds before the expiration time if the initial subscription was for greater than 1200 seconds, or when half of the time has expired if the initial subscription was for 1200 seconds or less.\nThe AS can terminate a subscription according to RFC 6665 [28].\nIf subscriptions to load-control event package is supported, the AS shall handle incoming subscriptions to the load-control event package in accordance with RFC 6665 [28] and with RFC 7200 [201]. When the AS receives a SUBCRIBE request for the load-control event from an unauthorised or unexpected source, the AS shall generate a \"403 forbidden\" response to the SUBSCRIBE request.\nIf the AS receives a SUBSCRIBE request from an authorised source the AS shall:\n2)\tGenerate a \"200 OK\" response to the SUBSCRIBE request with the following settings:\n-\tan Expires header field, set to either the same or a decreased value as the Expires header field in SUBSCRIBE request; and\n-\tthe Contact header field set to an identifier uniquely associated to the SUBSCRIBE request that may help correlating refreshes.\n3)\tIn case of an initial subscription, determine the list of load filters applicable to the subscriber, create an XML document to represent this information and send it as an attachement to a NOTIFY request towards the subscriber. If no applicable load filters are identified when the subscription request is received, an empty document is attached to the NOTIFY request.\nSubsequent NOTIFY requests with updated or new filters may then be sent as the actual load of the target entity evolves.\nAn AS supporting resource sharing shall use the \"+g.3gpp.registration-token\" header field parameter in the Contact header field of the incoming third-party REGISTER request and the \"+g.3gpp.registration-token\" header field parameter in the Feature-Caps header field in the initial INVITE request or provisional responses to the initial INVITE to identify the UE.\nThe AS supporting resource sharing shall only include the Resource-Share header field in requests and responses destined to the served user and in all other cases remove the header field.\nIf the AS supporting resource sharing receives a response or request destined to the served user containing a Resource-Share header field, the AS shall remove that header field from the outgoing response or request.\nUpon receiving an SDP answer in a provisional response or a 200 (OK) response to an initial INVITE request from a UE served by a P-CSCF supporting resource sharing, the AS supporting resource sharing shall determine whether resource sharing can be applied.\nNOTE 1:\tAn AS can learn that a P-CSCF supports resource sharing from the Resource-Share header field with the value \"supported\" in the initial REGISTER request that is contained in the \"message/sip\" MIME body of the third-party REGISTER request received when the UE registered.\nNOTE 2:\tThe conditions for resource sharing are outside the scope of the present document.\nIf the AS:\n1)\tdetermines that at least one media stream in the initial SDP answer is subject to resource sharing, the AS shall in the outgoing response include a Resource-Share header field as described in subclause 7.2.13.4 with the following clarifications:\na)\tthe AS shall set the \"origin\" header field parameter to \"session-initiator\"; and\nb)\tif\n-\ta session exists that can share resources with the dialog created by the initial INVITE request involving the same UE, the AS shall include a new sharing key set to the value of the sharing key in the other session and use this sharing key to identify the resource sharing rule for this media stream in this session; and\n-\tno session exists that can share resources with the dialog created by the initial INVITE request, the AS shall include a new sharing key unique among all UEs registered by the user and use this sharing key to identify the resource sharing rule for this media stream in this session; and\n2)\tdetermines that resource sharing can never be applied for any of the media streams in the SDP answer, the AS shall include a Resource-Share header field set to the value \"no-media-sharing\" in the outgoing response.\nUpon receiving an initial INVITE request containing an initial SDP offer destined for the served user, the AS supporting resource sharing shall if at least one registered UE is served by a P-CSCF supporting resource sharingdetermine if resource sharing can be applied.\nNOTE 1:\tAn AS can learn that a P-CSCF supports resource sharing from the Resource-Share header field with the value \"supported\" in the initial REGISTER request that is contained in the \"message/sip\" MIME body of the third-party REGISTER request received when the UE registered.\nNOTE 2:\tThe condition for resource sharing is outside the scope of the present document.\nIf the AS:\n1)\tdetermines that at least one media stream in the initial SDP answer is subject to resource sharing, the AS shall in the outgoing request include a Resource-Share header field as described in subclause 7.2.13.4 with the following clarifications:\na)\tthe AS shall set the \"origin\" header field parameter to \"session-receiver\";\nb)\tthe AS shall include a new sharing key part that is determined as follows:\nA)\tif the AS is aware of only one registered contact:\nI)\tif a session exists where media in the existing session can be shared with media in the new SDP offer, the sharing key in the INVITE request  shall be set to the value of the sharing key used in the existing session and the AS shall use this sharing key to identify the resource sharing rules for each media stream in the session; or\nII)\tif no session exists where media in the existing session can be shared with media in the new SDP offer, the AS shall create a new sharing key that is unique among all sessions that exist on the UE. This new sharing key shall be included in the INVITE request and is used to identify the resource sharing rules for each media stream in this session; and\nB)\tif the AS is aware of more than one registered contacts:\nI)\tif the AS is using an Accept-Contact header field, Reject-Contact header field, and/or a GRUU in the request URI to target a specific registered UE and a session exists on the target UE where media in the existing session can be shared with media in the new SDP offer, the sharing key in the INVITE request shall be set to the value of the sharing key used in the existing session and the AS shall use this sharing key to identify the resource sharing rules for each media stream in the session; or\nII)\tif no session exists on the target UE (or on the set of UEs when more than one UE is registered and the S-CSCF can fork the INVITE request to more than one UE) where media in the existing session can be shared with media in the new SDP offer, the AS shall create a new sharing key that is unique among all sessions that exist for all UEs registered for the server user. This new sharing key shall be included in the INVITE request and is used to identify the resource sharing rules for each media stream in this session; and\nc)\tif the AS is aware of more than one registered contact and the AS is not using an Accept-Contact header field, Reject-Contact header field, and/or a GRUU in the request URI to target a specific registered UE (so that the S-CSCF is allowed to fork the INVITE request to one or more UEs) and sessions exist with any registered UE where media in an existing session can be shared with media in the new SDP offer, the existing-sharing-key-list part in the INVITE shall be set to the value of the sharing keys used in the existing sessions; and\n2)\tdetermines that resource sharing can not be applied, the AS shall include a Resource-Share header field set to the value \"no-media-sharing\" in the outgoing request.\nUpon receiving a PRACK request or an ACK request destined to a UE served by a P-CSCF supporting resource sharing that contains an initial SDP answer, the AS supporting resource sharing shall determine if resource sharing can be applied.\nNOTE 1:\tAn AS can learn that a P-CSCF supports resource sharing from the Resource-Share header field with the value \"supported\" in the initial REGISTER request when that is contained in the \"message/sip\" MIME body of the third-party REGISTER request received the UE registered.\nNOTE 2:\tThe condition for resource sharing is outside the scope of this technical specification.\nIf the AS:\n1)\tdetermines that at least one media stream in the initial SDP answer is subject to resource sharing, the AS shall in the outgoing request include a Resource-Share header field as described in subclause 7.2.13.4 with the following clarifications:\na)\tthe \"origin\" header field parameter shall be set to \"session-receiver\"; and\nb)\tif\n-\ta session exists that can share resources involving the same UE, the AS shall include a new sharing key set to the value of the sharing key in the other session and use this sharing key to identify the resource sharing rule for this media stream in this dialog; and\n-\tno session exists that can share resources, the AS shall include a new sharing key unique among all UEs registered by the user and use this sharing key to identify the resource sharing rule for this media stream in this dialog; and\n2)\tdetermines that resource sharing can never be applied for any of the media streams in the SDP answer, the AS shall include a Resource-Share header field with the value \"no-media-sharing\" as described in subclause 7.2.13.4 in the outgoing response.\nIf the AS during the duration of the call determines that the resource sharing options needs to be changed (e.g. if media streams are added by the UE), then the AS shall include a Resource-Share header field with the updated resource sharing options as specified in subclause 7.2.13, in the outgoing request or response causing the reason for change.\nNOTE:\tIf more than one dialog exists and the update is sent before the session invitation is accepted by the terminating user, the resource sharing options are determined per individual dialog.\nIf the AS receives a request or response from a served user containing a Resource-Share field with the value \"no-media-sharing\", the AS shall no longer apply resource sharing with sessions involving the UE sending the request or response.\nIf the AS receives a request or response from a served user containg an SDP offer conflicting with an earlier decision to share resources, the AS shall include in the response carrying the SDP answer towards the served user a Resource-Share header field with the value \"no-media-sharing\" along with the \"origin\" header field parameter set to \"session-initiator\" or \"session-receiver\" as appropriate and no longer apply resource sharing with sessions involving the UE sending the request or response.\nNOTE:\tA typical example when this can happen is the communication waiting use case. If the UE sends a 200 (OK) response to the INVITE request without putting the first call on hold, the UE's behaviour is then regarded as unpredictable and resource sharing cannot be used towards that UE.\nIf an AS supports dynamic service interaction, the AS should insert the Service-Interact-Info header field into the SIP messages before those messages are sent out. The Service-Interact-Info field is filled with the service identities of the services which have been executed. Additionally, the AS may insert into the Service-Interact-Info header field with the identities of the services which may have confliction with the executed services according to local policy.\nNOTE:\tNo service identifiers are defined in this release of the present document.\nIf the AS supports dynamic service interaction, it should take the information contained in any received Service-Interact-Info header field into account when executing service logic.\nIf the AS does not recognize the service identities contained in the Service-Interact-Info header field, they should be ignored.\nWhen the AS is accessed by a service access number (e.g. toll free, premium service) and performes a translation of this number into a routeable number, the AS shall include in the outgoing request:\n1)\tthe Request- set to the targeted SIP  containing the \"cause\" SIP  parameter, defined in RFC 4458 [68], set to the value \"380\" defined in RFC 8119 [230]; and\n2)\tthe History-Info header field constructed according to RFC 7044 [66] in which the hi-targeted-to-uri of the last hi-entry is set to the new Request- with the \"cause\" SIP  parameter, defined in RFC 4458 [68], set to the value \"380\" defined in RFC 8119 [230].\nA service access number does not constrain the number format. A local service number as defined in TS 23.228 [7] and described in subclause 5.7.1.7 can be a service access number.\nAn AS supporting priority sharing and if according to local policy shall apply priority sharing as specified in the following subclauses.\nNOTE:\tThe MCPTT server is the only AS in the present document defined to use priority sharing (see 3GPP TS 24.379 [8ZE]).\nAn AS supporting priority sharing shall only include a Priority-Share header field in requests and responses destined to the served user and in all other cases remove the header field.\nIf the Feature-Caps header field with the g.3gpp.priority-share feature-capability indicator was included in the \"message/sip\" MIME body in the third-party REGISTER request and when the AS determines that priority sharing can be applied, the AS supporting priority sharing shall:\n1)\tinclude the Priority-Share header field with the value \"allowed\" defined in subclause 7.2.16 in a 18x and 2xx response to the initial INVITE request; or\n2)\tinclude the Priority-Share header field with the value \"allowed\" defined in subclause 7.2.16 in a subsequent request or a response to subsequent requests destined to the served user.\nIf priority sharing can not be applied any longer, the AS shall include the Priority-Share header field, defined in subclause 7.2.16, with the value \"not-allowed\" in a request or response destined to the served user.\nNOTE:\tThe AS can enable or disable priority sharing by including the Priority-Share header field with the value \"allowed\" or \"not-allowed\" as specified above until the session is released.\nIf the incoming REGISTER request contained in the \"message/sip\" MIME body of a third-party REGISTER request the g.3gpp.priority-share feature-capability indicator in a Feature-Caps header field and when the AS determines that priority sharing can be applied, the AS supporting priority sharing shall:\n1).\tinclude the Priority-Share header field with the value \"allowed\" defined in subclause 7.2.16 in the initial INVITE request destined to the served user; or\n2)\tinclude Priority-Share header field with the value \"allowed\" defined subclause 7.2.16 in a subsequent request or responses to a subsequent request destined to the served user.\nIf priority sharing can not be applied any longer, the AS shall include the Priority-Share header field, defined in subclause 7.2.16, with the value \"not-allowed\" in a request or response destined to the served user.\nNOTE:\tThe AS can enable or disable priority sharing by including the Priority-Share header field with the value \"allowed\" or \"not-allowed\" as specified above until the session is released.\nAn AS shall handle re-INVITE request collisions as specified in RFC 3261 [26] with the clarification in this subclause.\nWhen the AS receives a SIP 491 (Request Pending) response to a re-INVITE request initiated by the AS and sent towards the remote user, the AS shall:\n1)\tif the AS is serving the user at the originating side of the call, act as the the owner of the Call-ID of the dialog ID and should select a randomly choosen time to be between 2.1 and 4 seconds in units of 10 ms; and\n2)\tif the AS is serving the user at the terminating side of the call, act as not being the owner of the Call-ID of the dialog ID and should select a randomly choosen time to be between 0 and 2 seconds in units of 10 ms.\nWhen the AS receives a SIP 491 (Request Pending) response to a re-INVITE request initiated by the AS and sent towards the served user, the AS shall:\n1)\tif the AS is serving the user at the originating side of the call, act as not being the owner of the Call-ID of the dialog ID and should select a randomly choosen time to be between 0 and 2 seconds in units of 10 ms; and\n2)\tif the AS is serving the user at the terminating side of the call, act as the owner of the Call-ID of the dialog ID and should select a randomly choosen time to be between 2.1 and 4 seconds in units of 10 ms.\nRFC 8224 [252] describes a mechanism where an authentication service after verifying the calling number identity inserts a signature over selected header fields. A verification service can then use this signature to trust the correctness of the identity.\nRFC 8946 [265] describes a mechanism where an authentication service after verifying the diverting number identity inserts a signature over selected header fields. A verification service can then use this signature to trust the correctness of the diverting identity.\nRFC 8443 [279] describes a mechanism where an authentication service after verifying the Resource-Priority header field inserts a signature over the Resource-Priority header field. A verification service can then use this signature to trust the correctness of the Resource-Priority header field.\nRFC 9027 [278] extends a mechanism defined in RFC 8443 [279] to enable authentication of the header field value \"psap-callback\" of the Priority header field and inserts a signature over the Resource-Priority header field and the header field value \"psap-callback\" provided in the Priority header field. A verification service can then use this signature to trust the correctness of the Resource-Priority header field and header field value \"psap-callback\" of the Priority header field.\nAn originating AS supporting the calling number verification using signature verification and attestation information, as defined in subclause 3.1:\n1)\tmay based on local policy insert an Identity header field as specified in RFC 8224 [252] for all initial INVITE requests and MESSAGE requests and shall for this purpose use the identity in the P-Asserted-Identity header field or the From header field; or\nNOTE 1:\tThis option is kept from the original release-14 functionality. If the AS knows the IBCF supports invoking an AS for providing an Identity header field the below actions are more efficient.\n2)\tmay based on local policy perform attestation of the identity of the served user by:\na)\tinserting a \"verstat\" tel URI parameter, specified in subclause 7.2A.20; in the From header field or the P-Asserted-Identity header field if not already present; and\nb)\tinsert an Origination-Id header field as specified in subclause 7.2.19 and an Attestation-Info header field specified in subclause 7.2.18, if not alredy present.\nIf the AS performs originating services on behalf of a diverting user, the AS may assert the identity of the diverting user by inserting a \"verstat\" tel URI parameter, specified in subclause 7.2A.20, in the History-Info hi-entry representing the diverting user.\nIf the AS supports priority verification using assertion of priority information as specified in subclause 3.1 and if allowed by local operator policy, the AS may insert an Identity header field as described in RFC 8443 [279] and RFC 9027 [278], and shall for this purpose use the resource priority of the Resource-Priority header field in the received initial INVITE or re-INVITE request.\nNOTE 2:\tFor sessions terminating in another domain, only one of the following entities needs to be configured to provide an Identity header field for the resource priority: the IBCF or the AS. Which functional entity inserts the Identity header field is subject to network configuration and local policy.\nNOTE 3:\tHow the AS asserts the authenticity of the Resource-Priority header field value is out of scope of the present document.\nUpon receiving an initial INVITE request or a MESSAGE request containing one or more Identity header fields, an AS supporting the calling number verification using signature verification and attestation information, as defined in subclause 3.1, shall if the network indicated support for the calling number verification during registration:\n-\tif no \"verstat\" tel URI parameter is present for the identity to be verified in the From or P-Asserted-Identity header field, perform user identity verification of the originating user identity using the Identity header field containing a PASSporT SHAKEN JSON Web Token, specified in RFC 8588 [261] and based on local policy all Identity header fields containing a PASSporT div JSON Web Token, specified in RFC 8946 [265], in the received request. Based on the outcome of the verification insert a \"verstat\" tel URI parameter, specified in subclause 7.2A.20, with a value representing the outcome of the verification in the tel URI or SIP URI with the user=phone parameter of each P-Asserted-Identity header field or From header field where the URI contains the calling number that was tested for verification and based on local policy in all verified identities in the History-Info header field.\nIf no Identity header field is present in the received INVITE or MESSAGE request, but an Origination-Id header field along with an Attestation-Info header field set either to \"B\" or \"C\" is present, the AS shall set the verstat tel URI parameter to the value \"No-TN-Validation\".\nIf the AS supports priority verification using assertion of priority information as specified in subclause 3.1 and if allowed by local operator policy, the AS may verify that the Priority and Resource-Priority header field values are authorized. To do so, the AS:\nverifies the Identity header fields containing a PASSporT rph JSON Web Token as specified in RFC 8443 [279] and RFC 9027 [278] if included in the initial INVITE or re-INVITE request; and\nverifies that the Priority and Resource-Priority header field values are authorized by valid \"rph\" PASSporT claims.\nThe AS shall populate the Priority-Verstat header field associated with the Resource-Priority header field and include the Priority-Verstat header field in the forwarded SIP request.\nThe AS may report any verification failure of an Identity header field to the appropriate upstream signing service by populating for each reported Identity header field verification error a Reason header field in the next provisional or final response to the INVITE or MESSAGE request, where the Reason header field \"protocol\" value is set to \"STIR\", as specified in RFC 9410 [294] and RFC 9366 [296], and the \"cause\" header field parameter contains the 4xx response code of the failing PASSporT, as defined in RFC 8224 [252]. Additionally, the AS may include the \"ppi\" header field parameter containing the failing PASSporT.\nNOTE 1:\tFor sessions originating in another domain, only one of the following entities needs to be configured to verify the Identity header field for the resource priority: the IBCF or the AS. Which functional entity inserts the Identity header field verification is subject to network configuration and local policy.\nNOTE 2:\tMultiple Reason header fields with the protocol value set to \"STIR\" are not supported in the present document.\nIf the AS receives a verificationRequest as specified in annex V, the AS verifies the request and when verified generates a verificationResponse, as specified in annex V, including a \"verstat\" claim for the verified identity.\nIf the AS receives a signingRequest, specified in annex V, the AS sends the signed information in a signingResponse as specified in annex V.\nAn AS that supports 3GPP PS data off can receive in the message/SIP MIME body in a third party REGISTER request the REGISTER request sent by the UE. If this REGISTER request contains a \"+g.3gpp.ps-data-off\" Contact header field parameter the AS can determine that the UE supports 3GPP PS data off, and the value of the parameter indicates the 3GPP PS data off status. When the AS receives an initial request for a dialog or a standalone transaction destined to the served user, if:\n-\tthe latest \"+g.3gpp.ps-data-off\" Contact header field parameter, specified in subclauce 7.9.8, that was received in a third party REGISTER request, as specified above, was set to \"active\" in the UE; and\n-\tthe service the AS supports is not configured as a 3GPP PS data off exempt service to be used in the HPLMN,the EHPLMN or the subscribed SNPN, or the service the AS support is not configured as a 3GPP PS data off exempt service to be used in the VPLMN or the non-subscribed SNPN;\nthe AS shall not send the request to the UE via GPRS IP-CAN, EPS IP-CAN or 5GS IP-CAN.\nThe AS can indicate that it supports in-call access update procedures by sending a feature-capability indicator including a public service identity indicating to where to send the updates.\nWhen the AS receives a MESSAGE request with a P-Charging-Vector header field containing an \"icid-value\" header field parameter matching the \"icid-value\" header field parameter of an existing dialog, the AS can use the location information in the received MESSAGE request to update the location information for the dialog identified by the Call-Id.\nIf the AS supports in-call access update procedures and the AS is interested in receiving updates of changes of IP-CAN or PLMN the AS shall include in responses to an initial INVITE request a g.3gpp.in-call-access-update feature-capability indicator with a value set to a public service identity resolving to the AS.\nWhen the AS receives a Handover-Info header field defined in subclause 7.2.22 with the header field value set to \"handover-completed\", then the AS shall send an INVITE or UPDATE request towards the originating UE including an SDP offer with the previous SDP, including the same SDP version parameter, and include the Handover-Info header field with the \"Role\" header field value set to a value \"session-initiator\".\nIf the AS supports access update procedures and the AS is interested in receiving updates of changes of IP-CAN or PLMN the AS shall include in the INVITE request a g.3gpp.in-call-access-update feature-capability indicator with a value set to a public service identity resolving to the AS.\nWhen the AS receives a Handover-Info header field defined in subclause 7.2.22 with the header field value set to \"handover-completed\", then the AS shall send an INVITE or UPDATE request towards the terminating UE including an SDP offer with the previous SDP, including the same SDP version parameter, and include the Handover-Info header field with the \"Role\" header field value set to a value \"session-receiver\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.2\tApplication Server (AS) acting as terminating UA, or redirect server",
                            "text_content": "When acting as a terminating UA the AS shall behave as defined for a UE in subclause 5.1.4, with the exceptions identified in this subclause.\nThe AS, although acting as a UA, does not initiate any registration of its associated addresses. These are assumed to be known by peer-to-peer arrangements within the IM CN subsystem.\nIf the AS requires knowledge of the served user it shall determine the served user according to the applicable procedure in subclause 5.7.1.3A.\nAn AS acting as redirect server shall propagate any received IM CN subsystem XML message body in the redirected message.\nWhen an AS acting as a terminating UA generates a subsequent request for a dialog, the AS shall insert a P-Charging-Vector header field with the \"icid-value\" header field parameter set to the value populated in the initial request for the dialog and a type 3 \"orig-ioi\" header field parameter. The AS shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the service provider from which the request is sent. The AS shall not include the type 3 \"term-ioi\" header field parameter.\nWhen the AS acting as terminating UA receives a request, the AS shall store the value of the \"orig-ioi\" header field parameters received in the P-Charging-Vector header field if present.\nNOTE 1:\tAny received orig-ioi parameter will be a type 3 orig-ioi. The orig-ioi identifies the network operator from which the request was sent.\nWhen the AS acting as terminating UA generates a response to a request, the AS shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the request, a type 3 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The AS shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the service provider from which the response is sent, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request.\nThe AS acting as terminating UA receiving an initial request with a P-Charging-Vector header field shall, based on local policy, store the \"fe-identifier\" header field parameter of the P-Charging-Vector header field.\nThe AS acting as terminating UA shall, based on local policy, include the stored \"fe-identifier\" header field parameter in the P-Charging-Vector header field, add its address or identifier and application id to the \"as-addr\" and \"as-id\" elements of the \"fe-identifier\" header field parameter of the P-Charging-Vector header field and send the P-Charging-Vector header field in the related final response.\nNOTE 2:\tAn AS hosting multiple applications can add multiple pairs of \"as-addr\" and \"as-id\" header field parameters when executing these applications.\nIf resource priority in accordance with RFC 4412 [116] is required for a dialog, then the AS shall include the Resource-Priority header field in all requests associated with that dialog. If priority is supported, the AS shall take into account that subsequent received SIP requests or responses within the same dialog or transaction may have added or changed the Resource-Priority header field or backwards indication.\nNOTE 3:\tAn AS can modify the priority using the Resource-Priority header field in a dialog on behalf of a user. The mechanism for a user to invoke this AS action is out of scope of this release of the specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.3\tApplication Server (AS) acting as originating UA",
                            "text_content": "In order to support an AS acting as an originating UA, the AS has to be within the same trust domain as the S-CSCF to which requests will be sent.\nWhen acting as an originating UA the AS shall behave as defined for a UE in subclause 5.1.3, with the exceptions identified in this subclause.\nThe AS, although acting as a UA, does not initiate any registration of its associated addresses and does not participate in any authentication procedures defined for a UE. These are assumed to be known by peer-to-peer arrangements within the IM CN subsystem.\nWhen an AS acting as an originating UA generates an initial request for a dialog or a request for a standalone transaction, the AS shall insert a P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 3 \"orig-ioi\" header field parameter. The AS shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the service provider from which the request is sent. The AS shall not include the type 3 \"term-ioi\" header field parameter.\nNOTE 1:\tThe AS can retrieve CDF and/or ODF addresses from HSS on Sh interface.\nWhen the AS acting as an originating UA receives any response to a request, the AS shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field if present.\nNOTE 2:\tAny received \"term-ioi\" header field parameter will be a type 3 IOI. The type 3 IOI identifies the network operator from which the response was sent.\nWhen an AS acting as an originating UA generates a subsequent request for a dialog, the AS shall insert a P-Charging-Vector header field with the \"icid-value\" header field parameter set to the value populated in the initial request for the dialog and a type 3 \"orig-ioi\" header field parameter. The AS shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the service provider from which the request is sent. The AS shall not include the type 3 \"term-ioi\" header field parameter.\nBased on local policy, the AS acting as an originating UA or application(s) hosted by the AS acting as originating UA shall add an \"as-addr\" and an \"as-id\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier and application identifier to an initial request.\nNOTE 3:\tAn AS hosting multiple applications can add multiple pairs of \"as-addr\" and \"as-id\" header field parameters when executing these applications for an initial request.\nThe AS shall extract charging function addresses from any P-Charging-Function-Addresses header field that is received in any 1xx or 2xx responses to the requests.\nThe AS may also indicate that the proxies should not fork the request by including a \"no-fork\" directive within the Request-Disposition header field in the request as described in RFC 3841 [56B].\nWhen sending any initial request, an identity is needed that will correlate with the service profile to be used at the S-CSCF. If the identity for that service profile corresponds to the value to be used to identify the caller to the destination user, include the identity in the P-Asserted-Identity header field. If the identity for that service profile does not correspond to the value to be used to identify the caller to the destination user, and the P-Served-User header field is supported by the S-CSCF, include the identity in the P-Served-User header field. This leaves the P-Asserted-Identity header field for the identity to be used to identify the caller to the destination user. If the identity for that service profile matches a wildcarded identity and the P-Profile-Key header field is supported by the AS, include the wildcarded identity in the P-Profile-Key header field.\nWhen sending an initial request on behalf of a PSI that is hosted by the AS, the AS shall:\n-\tinsert a Request- as determined by the service logic;\n-\tinsert a P-Asserted-Identity header field and possibly a P-Served-User header field containing the PSI as indicated earlier in this subclause;\n-\tif the AS is not able to resolve the next hop address by itself or the operator policy does not allow it, insert a Route header field pointing either to the S-CSCF where the PSI is hosted, or to the entry point of the home network of the PSI or to the transit function. The AS shall append the \"orig\" parameter to the  in the topmost Route header field; and\nNOTE 4:\tThe address of the S-CSCF hosting the PSI can be obtained by querying the HSS on the Sh interface.\nNOTE 5:\tAS can only send the initial request to the entry point of the home network of the PSI only if the AS can assume (e.g. based on local configuration) that the receiving entry point will be able to process the request as an originating request.\n-\tif the AS is able to resolve the next hop address by itself and the operator policy allows it, forward the originating request directly to the destination without involving any S-CSCF in the originating IM CN subsystem.\nWhen sending an initial request on behalf of a public user identity, the AS shall:\n-\tinsert a Request- as determined by the service logic;\n-\tinsert a P-Asserted-Identity header field and possibly a P-Served-User header field containing the public user identity as indicated earlier in this subclause;\n-\tif the AS intends to send the originating request to the home network of the public user identity or the operator policy requires it, insert a Route header field pointing to the S-CSCF where the public user identity on whose behalf the request is generated is registered or hosted (unregistered case) or to the entry point of the public user identity's network. The AS shall append the \"orig\" parameter to the  in the topmost Route header field; and\nNOTE 6:\tThe address of the S-CSCF can be obtained either by querying the HSS on the Sh interface or during third-party registration.\nNOTE 7:\tAS can send the initial request to the entry point of the public user identity's network or to the entry point of the home network of the PSI only if the AS can assume (e.g. based on local configuration) that the receiving entry point will be able to process the request as an originating request.\n-\tif the AS intends to send the originating request directly to the terminating network and the operator policy allows it, forward the originating request directly to the destination without involving any S-CSCF in the originating IM CN subsystem.\nWhen sending an initial request to a served public user identity, the AS shall insert:\n-\ta Request- containing the served public user identity;\n-\ta P-Asserted-Identity as determined by the service logic (e.g. the  of the AS or the  of the entity that triggered the SIP request, if the sending of the initial request is triggered by a non-SIP request); and\n-\ta Route header field pointing to the S-CSCF where the public user identity to whom the request is generated is registered or hosted (unregistered case) or to the entry point of the public user identity's network. The AS shall not append the \"orig\" parameter to the  in the topmost Route header field.\nNOTE 8:\tThe address of the S-CSCF can be obtained either by querying the HSS on the Sh interface or during third-party registration.\nThe AS can indicate privacy of the P-Asserted-Identity in accordance with RFC 3323 [33], and the additional requirements contained within RFC 3325 [34].\nWhere privacy is required, in any initial request for a dialog or request for a standalone transaction, the AS shall set a display-name of the From header field to \"Anonymous\" as specified in RFC 3261 [26] and set an addr-spec of the From header field to Anonymous User Identity as specified in 3GPP TS 23.003 [3].\nNOTE 9:\tThe contents of the From header field cannot be relied upon to be modified by the network based on any privacy specified by the user either within the AS indication of privacy or by network subscription or network policy. Therefore the AS includes the value \"Anonymous\" whenever privacy is explicitly required.\nIf resource priority in accordance with RFC 4412 [116] is required for a dialog, then the AS shall include the Resource-Priority header field in all requests associated with that dialog. If priority is supported, the AS shall take into account that subsequent received SIP requests or responses within the same dialog or transaction may have added or changed the Resource-Priority header field or backwards indication.\nNOTE 10:\tAn AS can modify the priority using the Resource-Priority header field in a dialog on behalf of a user. The mechanism for a user to invoke this AS action is out of scope of this release of the specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.4\tApplication Server (AS) acting as a SIP proxy",
                            "text_content": "When the AS acting as a SIP proxy receives a request from the S-CSCF, prior to forwarding the request, the AS shall:\n-\tremove its own  from the topmost Route header field;\n-\tif the request contains a \"logme\" header field parameter in the SIP Session-ID header field then log the request if required by local policy; and\n-\tafter executing the required services, route the request based on the topmost Route header field.\nWhen the AS acting as a SIP proxy receives any response to the above request, the AS shall:\n-\tif the response contains a \"logme\" header field parameter in the SIP Session-ID header field then log the request if required by local policy.\nThe AS may modify the SIP requests based on service logic, prior to forwarding the request back to the S-CSCF.\nThe AS shall not fork the request if the fork-directive in the Request-Disposition header field is set to \"no-fork\" as described in RFC 3841 [56B].\nIf the AS requires knowledge of the served user it shall determine the served user according to the applicable procedure in subclause 5.7.1.3A.\nAn AS acting as a SIP proxy shall propagate any received IM CN subsystem XML message body in the forwarded message.\nWhen the AS acting as a SIP proxy receives a request, the AS shall store the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present. The AS shall remove the \"orig-ioi\" header field parameter from the forwarded request and insert a type 3 \"orig-ioi\" header field parameter. The AS shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the service provider from which the request is sent. The AS shall not include the type 3 \"term-ioi\" header field parameter.\nNOTE 1:\tA received orig-ioi parameter will be a type 3 orig-ioi. The orig-ioi identifies the network operator from which the request was sent.\nWhen the AS acting as a SIP proxy forwards a response to a request, the AS shall remove any received \"orig-ioi\" and \"term-ioi\" header field parameters, and insert a P-Charging-Vector header field containing the previously stored \"orig-ioi\" header field parameter, if received in the request and a type 3 \"term-ioi\" header field parameter. The AS shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the service provider from which the response is sent and the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter. Any values of \"orig-ioi\" or \"term-ioi\" header field parameters received in any response that is being forwarded are not used.\nBased on local policy, the AS acting as a SIP proxy shall add an \"as-addr\" and an \"as-id\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier and application identifier.\nNOTE 2:\tAn AS hosting multiple applications can add multiple pairs of \"as-addr\" and \"as-id\" header field parameters when executing these applications for an initial request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.5\tApplication Server (AS) performing 3rd party call control",
                            "text_content": "The AS performing 3rd party call control acts as a B2BUA. There are two kinds of 3rd party call control:\n-\tRouteing B2BUA: an AS receives a request, terminates it and generates a new request, which is based on the received request.\n-\tInitiating B2BUA: an AS initiates two requests, which are logically connected together at the AS, or an AS receives a request and initiates a new request that is logically connected but unrelated to the incoming request from the originating user (e.g. the P-Asserted-Identity of the incoming request is changed by the AS). AS can initiate additional requests and associate them with a related incoming request.\nWhen the AS acting as an initiating B2BUA receives a request and initiates a new request that is logically connected but unrelated to the incoming request from the originating user, the AS can include an original dialog identifier in the Route header field for the S-CSCF that it learned from the incoming request, per service logic needs.\nNOTE 1:\tIf the AS does not include the original dialog identifier in an initiated request, the S-CSCF can apply the default handling procedure relating to the incoming request if after a certain time no 1xx response is sent by the AS to the incoming request or if the AS forwards a 408 (Request Timeout) response or a 5xx response received from downstream as a response to the incoming request. To avoid the application of the default handling procedure by the S-CSCF when the AS is waiting for a SIP response for an initiated request, the AS can generate a SIP provisional response to the incoming request.\nIf the AS requires knowledge of the served user the AS shall determine the served user according to the applicable procedure in subclause 5.7.1.3A.\nWhen the AS receives a terminated call and generates a new call, and dependent on whether the service allows the AS to change the P-Asserted-Identity for outgoing requests compared with the incoming request, the AS will select appropriate kind of 3rd party call control.\nThe B2BUA AS will internally map the message header fields between the two dialogs that it manages. It is responsible for correlating the dialog identifiers and will decide when to simply translate a message from one dialog to the other, or when to perform other functions. These decisions are specific to each AS and are outside the scope of the present document.\nThe AS, although acting as a UA, does not initiate any registration of its associated addresses. These are assumed to be known by peer-to-peer arrangements within the IM CN subsystem.\nFor standalone transactions, when the AS is acting as a Routeing B2BUA, the AS shall copy the remaining Route header field(s) unchanged from the received request for a standalone transaction to the new request for a standalone transaction.\nWhen the AS receives a Replaces header field within an initial request for a dialog, the AS should check, whether the AS acts as a routeing B2BUA for the dialog identified in the Replaces header field. The AS should:\n-\tif the AS acts as routeing B2BUA for the dialog indicated in the Replaces header field, include in the forwarded request a Replaces header field, indicating the dialog on the outgoing side that corresponds to the dialog identified in the received Replaces header field; or\n-\tif the AS does not act as a routeing B2BUA for the dialog indicated in the Replaces header field, include in the forwarded request the Replaces header field as received in the incoming request.\nWhen the AS receives a Target-Dialog header field within an initial request or a standalone transaction for a dialog, the AS shall:\n-\tif the AS acts as routeing B2BUA for the dialog indicated in the Target-Dialog header field, include in the forwarded request a Target-Dialog header field, indicating the dialog on the outgoing side that corresponds to the dialog identified in the received Target-Dialog header field.\nWhen the AS acting as a routeing B2BUA receives a request, the AS shall:\n-\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present; and\n-\tremove the \"orig-ioi\" header field parameter from the forwarded request.\nNOTE 2:\tAny received orig-ioi parameter will be a type 3 orig-ioi. The orig-ioi identifies the network operator from which the request was sent.\nWhen an AS acts as a routeing B2BUA and the received Contact header field contains a media feature tag indicating a capability for which the Contact  can be used by the remote party, the AS shall transparently forward the Contact header field. When transparently forwarding a received Contact header field of a dialog-forming request, the AS shall include its own  in a Record-Route header field in order to ensure that it is included on the route of subsequent requests.\nNOTE 3:\tOne example of such a media feature tag is the isfocus media feature tag where the  in the Contact header field is used by conference services to transport the temporary conference identity that can be used when rejoining an ongoing conference.\nWhen the AS acting as a routeing B2BUA generates a response to a request, the AS shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the request, a type 3 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The AS shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the service provider from which the response is sent, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request. Any values of \"orig-ioi\" or \"term-ioi\" header field parameter received in any response that is being forwarded are not used.\nThe AS shall transparently pass supported and unsupported signalling elements (e.g. SIP headers, SIP messages bodies), except signalling elements that are modified or deleted as part of the hosted service logic, or based on service provider policy.\nIf resource priority in accordance with RFC 4412 [116] is required for a dialog, then the AS shall include the Resource-Priority header field in all requests associated with that dialog. If priority is supported, the AS shall take into account that subsequent received SIP requests or responses within the same dialog or transaction may have added or changed the Resource-Priority header field or backwards indication.\nThe AS shall log all SIP requests and responses that contain a \"logme\" header field parameter in the SIP Session-ID header field if required by local policy.\nWhen the AS acting as a Routeing B2BUA receives an initial INVITE request, the AS shall:\n1)\tremove its own SIP  from the topmost Route header field of the received INVITE request;\n2)\tperform the AS specific functions. See 3GPP TS 23.218 [5];\n3)\tif successful, generate and send a new INVITE request to establish a new dialog;\n4)\tcopy the remaining Route header field(s) unchanged from the received INVITE request to the new INVITE request;\n5)\tcopy the P-Asserted-Identity to the outgoing request;\n6)\tif a Route header field is present, route the new INVITE request based on the topmost Route header field; and\nNOTE 1:\tThe topmost Route header field of the received INVITE request will contain the AS's SIP . The following Route header field will contain the SIP  of the S-CSCF.\n7)\tif no Route header field is present (e.g. the AS may be acting on behalf of a PSI):\na)\tinsert a Route header field pointing either to the S-CSCF where the PSI is hosted or to the entry point of the home network of the PSI or to the transit function, if the AS is not able to resolve the next hop address by itself or the operator policy requires it; or\nb)\tforward the originating request directly to the destination without involving any S-CSCF in the originating IM CN subsystem, if the AS is able to resolve the next hop address by itself, and the operator policy allows it.\nNOTE 2:\tThe address of the S-CSCF hosting the PSI can be obtained by querying the HSS on the Sh interface.\nWhen the AS is acting as an Initiating B2BUA, the AS shall apply the procedures described in subclause 5.7.3 for any outgoing requests. The AS shall either set the \"icid-value\" header field parameter in the P-Charging-Vector header field to be the same as received or different.\nNOTE 3:\tThe AS can retrieve CDF and/or ODF adresses from HSS on Sh interface.\nIf the policy or service logic requires the AS to check whether the session is still alive, the AS shall send UPDATE requests periodically to the served UE. The UPDATE requests shall not contain SDP offer.\nNOTE: The exact timing of sending the UPDATE requests is out of scope of this specification. Sending UPDATE requests too frequently can increase the load on the network and increase the probability of interactions delaying urgent requests (e.g., those related to session transfers). RFC 4028 [58] provides additional information on the problems caused by sending too frequest SIP \"keep alives\" and provides recommendations on suitable timer values to avoid such issues.\nAn AS may initiate a call release. See 3GPP TS 23.218 [5] for possible reasons. The AS shall simultaneously send the BYE request for both dialogs managed by the B2BUA.\nVoid.\nWhen the AS is acting as an Initiating B2BUA the AS shall apply the procedures described in subclause 5.7.3 for the requests. The AS shall either set the \"icid-value\" header field parameter in the P-Charging-Vector header field to be the same as received or different. The AS may initiate any number of requests, per service logic needs.\nAn AS may invoke transcoding at an MRFC by the use of RFC 4117 [166], if the MRFC supports acting as the transcoding server described in RFC 4117 [166].\nDuring the call setup, an AS may decide proactively to invoke transcoding when receiving an INVITE request, or reactively when the callee rejects the call setup using a 488 (Not Acceptable Here) response. To invoke transcoding using RFC 4117 [166], the AS shall act as a B2BUA between caller and callee and establish a third SIP dialogue towards the MRFC, supporting the transcoding as defined in subclause 6.6.\nThe SIP messages relating to the dialogue between AS and MRFC are sent either via the S-CSCF over the ISC and Mr interfaces, or directly over the Mr' interface.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.6\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.8\tProcedures at the MRFC",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.8.1\tGeneral",
                            "text_content": "Although the MRFC is acting as a UA, it is outside the scope of this specification how the MRFC associated addresses are made known to other entities.\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe MRFC shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the MGCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE:\tThis special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nWhen the MRFC sends any request or response (excluding CANCEL requests and responses) related to a dialog or standalone transaction, the MRFC may insert previously saved values into P-Charging-Vector header field before sending the message.\nWhen the MRFC sends any request or response (excluding ACK requests and CANCEL requests and responses) related to a dialog or standalone transaction, the MRFC may insert previously saved values into P-Charging-Function-Addresses header fields before sending the message.\nThe MRFC shall use a GRUU referring to itself (as specified in RFC 5627 [93]) when inserting a contact address in a dialog establishing or target refreshing SIP message. This specification does not define how GRUUs are created by the MRFC; they can be provisioned by the operator or obtained by any other mechanism. A GRUU used by the MRFC when establishing a dialog shall remain valid for the lifetime of the dialog.\nThe MRFC shall handle requests addressed to its currently valid GRUUs when received outside of the dialog in which the GRUU was provided.\nEXAMPLE:\tUpon receipt of an INVITE request addressed to a GRUU assigned to a dialog it has active, and containing a Replaces header field referencing that dialog, the MRFC will be able to establish the new call replacing the old one.\nThe MRFC shall log all SIP requests and responses that contain a \"logme\" header field parameter in the SIP Session-ID header field if required by local policy.\nWhen sending a failure response to any received request, depending on operator policy, the MRFC may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"mrfc\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.2\tCall initiation",
                            "text_content": "The MRFC shall provide a P-Asserted-Identity header field in a response to the initial request for a dialog, or any response for a standalone transaction. It is a matter of network policy whether the MRFC expresses privacy according to RFC 3323 [33] with such responses.\nWhen the MRFC receives an initial INVITE request, the MRFC shall store the values received in the P-Charging-Vector header field, e.g. \"icid-value\" header field parameter. The MRFC shall store the values received in the P-Charging-Function-Addresses header field.Based on local policy, the MRFC shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier to an initial request.\nIf the MRFC receives an initial request with a P-Charging-Vector header field, the MRFC shall, based on local policy, store the \"fe-identifier\" header field parameter of the P-Charging-Vector header field.\nWhen the MRFC receives a final response, the MRFC shall, based on local policy, include the stored \"fe-identifier\" header field parameter in the P-Charging-Vector header field and add its own address or identifier as an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header.\n5.8.2.1.1.2\tTones and announcements\nThe MRFC can receive INVITE requests to set up a session to play tones and announcements. The MRFC acts as terminating UA in this case.\nWhen the MRFC receives an INVITE request for a tone or announcement, the MRFC shall:\n-\tsend 100 (Trying) response.\n5.8.2.1.1.3\tAd-hoc conferences\nThe MRFC can receive INVITE requests to set up an ad-hoc conferencing session (for example a multiparty call) or to add parties to the conference. The MRFC acts as terminating UA in this case.\nWhen the MRFC receives an INVITE request for ad hoc conferencing, the MRFC shall:\n-\tsend 100 (Trying) response.\nWhen the MRFC receives an INVITE request to add a party to an existing ad hoc conference (i.e. MRFC conference identifier), the MRFC shall:\n-\tsend 100 (Trying) response.\n5.8.2.1.1.4\tTranscoding\nThe MRFC may receive INVITE requests to set up transcoding between endpoints with incompatible codecs. The MRFC acts as terminating UA in this case.\nWhen the MRFC receives an INVITE request for transcoding and a codec is supplied in SDP, the MRFC shall:\n-\tsend 100 (Trying) response.\nWhen the MRFC receives an INVITE request with an indicator for transcoding but no SDP, the MRFC shall:\n-\tsend 183 (Session Progress) response with list of codecs supported by the MRFC/MRFP.\nThe MRFC shall provide a P-Asserted-Identity header field in an initial request for a dialog, or any request for a standalone transaction. It is a matter of network policy whether the MRFC expresses privacy according to RFC 3323 [33] with such requests.\nWhen an MRFC generates an initial request for a dialog or a request for a standalone transaction, the MRFC shall insert a P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17].\nWhen the MRFC receives an ACK request for a session, this may be considered as an event to direct the MRFP to start the playing of a tone or announcement.\nWhen the MRFC receives a PRACK request (in response to the 183 (Session Progress) response with an indicator for transcoding and codec supplied in SDP, the MRFC shall:\n-\tafter the MRFP indicates that the transcoding request is granted, send 200 (OK) response.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.3\tCall release",
                            "text_content": "When the MRFC receives a BYE request for a session, the MRFC directs the MRFP to stop the playing of a tone or announcement.\nWhen the MRFC has a timed session to play tones and announcements and the time expires, the MRFC shall:\n-\tsend a BYE request towards the UE.\nWhen the MRFC is informed by the MRFP that tone or announcement resource has been released, the MRFC shall:\n-\tsend a BYE request towards the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.4\tCall-related requests",
                            "text_content": "5.8.4.1.1.1\tAd-hoc conferences\nThe MRFC can receive reINVITE requests to modify an ad-hoc conferencing session (for example a multiparty call) for purposes of floor control and for parties to leave and rejoin the conference.\nWhen the MRFC receives a reINVITE request, the MRFC shall:\n-\tsend 100 (Trying) response; and\n-\tafter the MRFP indicates that the conferencing request is granted, send 200 (OK) response. The MRFC may choose to send a 183 (Session Progress) response prior to the 200 (OK) response.\nVoid.\nVoid.\nVoid.\nVoid.\nVoid.\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.5\tFurther initial requests",
                            "text_content": "When the MRFC responds to an OPTIONS request with a 200 (OK) response, the MRFC may include a message body with an indication of the supported tones/announcement packages, DTMF capabilities, supported codecs and conferencing options of the MRFC/MRFP.\nNOTE:\tAs specified in RFC 6230 [146] an MRFC supporting the use of the control channel framework shall support the  command to indicate the media control packages supported. Additionally each media control package should define an audit command for discovery of package capabilities (for example supported codecs and options).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.8A\tProcedures at the MRB",
                    "description": "",
                    "summary": "",
                    "text_content": "For all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe MRB shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the MRB shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE:\tThis special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nThe MRB shall log all SIP requests and responses that contain a \"logme\" header field parameter in the SIP Session-ID header field based on local policy.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.9\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.9.1\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.10\tProcedures at the IBCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.10.1\tGeneral",
                            "text_content": "As specified in 3GPP TS 23.228 [7] border control functions may be applied between two IM CN subsystems or between an IM CN subsystem and other SIP-based multimedia networks based on operator preference. The IBCF may act both as an entry point and as an exit point for a network. If it processes a SIP request received from other network it functions as an entry point (see subclause 5.10.3) and it acts as an exit point whenever it processes a SIP request sent to other network (see subclause 5.10.2).\nThe functionalities of the IBCF are entry and exit point procedures as defined in subclause 5.10.2 and subclause 5.10.3 and additionally can include:\n-\tnetwork configuration hiding (as defined in subclause 5.10.4);\n-\tapplication level gateway (as defined in subclause 5.10.5);\n-\ttransport plane control, i.e. QoS control (as defined in subclause 5.10.5);\n-\tscreening of SIP signalling (as defined in subclause 5.10.6);\n-\tinclusion of an IWF if appropriate;\n-\tmedia transcoding control (as defined in suclause 5.10.7);\n-\tprivacy protection (as defined in subclause 5.10.8);\n-\tadditional routeing functionality (as defined in Annex I); and\n-\tinvocation of an AS over the Ms reference point (as defined in subclause 5.10.10).\nNOTE 1:\tThe functionalities performed by the IBCF are configured by the operator, and it is network specific.\nThe IBCF shall log all SIP requests and responses that contain a \"logme\" header field parameter in the SIP Session-ID header field if required by local policy.\nWhen an IBCF acting as an exit or an entry point receives a SIP request, the IBCF may reject the SIP request based on local policy by sending an appropriate SIP 4xx response.\nNOTE 2:\tThe local policy can take bilateral agreements between operators into consideration.\nNOTE 3:\tSome SIP requests can be rejected by an AS instead of the IBCF according to local policy.\nThe IBCF, acting as B2BUA, which is located between visited network and home network shall preserve the dialog identifier, i.e. shall not change the Call-Id header field value, the \"tag\" header field parameter value of the From header field in any SIP INVITE request and any SIP response to the SIP INVITE request, and shall preserve the \"tag\" header field parameter value of the To header field, in any SIP response to the SIP INVITE request.\nNOTE 4:\tThe IBCF can identify whether it is located between visited network and home network based on local configuration or, if IBCF supports indicating traffic leg associated with a  as specified in RFC 7549 [225], based on the value of the \"iotl\" SIP  parameter.\nIf the IBCF has verified that an initial INVITE request is for a PSAP callback, then depending on local policy it may include a Priority header field with a \"psap-callback\" header field value in the INVITE request. If the IBCF included the Priority header field with a \"psap-callback\" header field value, if the IBCF supports priority verification using assertion of priority information as specified in subclause 3.1 and if required by operator policy, the IBCF shall add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197] if not already present.\nNOTE 5:\tThe means for the IBCF to verify that a request is for a PSAP callback is outside the scope of this specification.\nWhen receiving a dialog creating SIP request or a SIP stand-alone request and if an IBCF acting as an entry or exit point supports indicating the traffic leg as specified in RFC 7549 [225], the IBCF can identify the II-NNI traversal scenario as described in subclause 4.13 and make policy decisions based on the II-NNI traversal scenario type. If a received request contains more than one \"iotl\" SIP  parameter the IBCF shall select one of the \"iotl\" SIP parameters in the received request in accordance with the RFC 7549 [225].\nWhen sending a failure response to any received request, depending on operator policy, the IBCF may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"ibcf\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.2\tIBCF as an exit point",
                            "text_content": "When IBCF receives a REGISTER request, the IBCF shall:\n1)\tvoid;\n2)\tif network topology hiding is required or IBCF is configured to perform application level gateway and/or transport plane control functionalities, then the IBCF shall add its own routeable SIP  to the top of the Path header field; and\nNOTE 1:\tThe IBCF can include in the inserted SIP  an indicator that identifies the direction of subsequent requests received by the IBCF i.e., from the S-CSCF towards the P-CSCF, to identify the UE-terminating case. The IBCF can encode this indicator in different ways, such as, e.g., a unique parameter in the , a character string in the username part of the , or a dedicated port number in the .\nNOTE 2:\tAny subsequent request that includes the direction indicator (in the Route header field) or arrives at the dedicated port number, indicates that the request was sent by the S-CSCF towards the P-CSCF.\n3)\tselect an entry point of the home network and forward the request to that entry point.\nIf the selected entry point:\n-\tdoes not respond to the REGISTER request and its retransmissions by the IBCF; or\n-\tsends back a 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request;\nthe IBCF shall select a new entry point and forward the REGISTER request to that entry point.\nNOTE 3:\tThe list of the entry points can be either obtained as specified in RFC 3263 [27A] or provisioned in the IBCF. The entry point can be an IBCF or an I-CSCF.\nIf the IBCF fails to forward the REGISTER request to any entry point, the IBCF shall send back a 504 (Server Time-Out) response to the P-CSCF, in accordance with the procedures in RFC 3261 [26].\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field or a temporarily authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe IBCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the IBCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE 1:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nBased on local policy, the IBCF acting as an exit point shall add in responses in the P-Charging-Vector header field a \"transit-ioi\" header field parameter with an entry which identifies the operator network which the response is transitting or with a void entry.\nBased on local policy the IBCF shall delete or void in responses in the P-Charging-Vector header field any received \"transit-ioi\" header field parameter value.\nIf an IBCF in the originating visited network, supporting barring of premium numbers when roaming, receives a request to be sent towards the originating home network and the request is originated from a roaming UE and the Request- contains an E.164 number encoded as described in subclause 5.1.2A.1.2 which the IBCF is able to identify as a premium rate number in the country of the served network, the IBCF shall, based on local policy, add the \"premium-rate\" tel  parameter specified in subclause 7.2A.17 set to a value \"information\" or \"entertainment\" as appropriate.\nNOTE 2:\tThe feature barring of premium numbers when roaming can be implemented in the P-CSCF or an IBCF of the visited network. Local policy ensures that the feature is only activiated in one of the two.\nNOTE 3:\tIf the visited network supports indicating traffic leg as specified in RFC 7549 [225] the above request includes the \"iotl\" SIP  parameter with the value \"visitedA-homeA\" in the bottommost Route header field.\nUpon receipt of:\n-\tan initial request for a dialog;\n-\ta request for a standalone transaction, except the REGISTER method; or\n-\ta request for an unknown method that does not relate to an existing dialog;\nthe IBCF shall:\n1)\tif the request is an INVITE request, respond with a 100 (Trying) provisional response;\n1A)\tremove its own SIP  from the topmost Route header field;\n2)\tif the request is an INVITE request and the IBCF is configured to perform application level gateway and/or transport plane control functionalities, save the Contact, CSeq and Record-Route header field values received in the request such that the IBCF is able to release the session if needed;\n2A)\tIf the request is a SUBSCRIBE and the IBCF does not need to act as B2BUA, based on operator policy, the IBCF shall determine whether or not to retain, for the related subscription, the SIP dialog state information and the duration information;\nNOTE 1:\tThe event package name can be taken into account to decide whether or not the SIP dialog state and the subscription duration information needs to be retained.\nNOTE 2:\tThe IBCF needs to insert its own  in Record-Route of the initial SUBSCRIBE request and all subsequent NOTIFY requests if it decides to retain the SIP dialog state information.\n2B)\tif the request is an initial request for a dialog and local policy requires the application of IBCF capabilities in subsequent requests, perform record route procedures as specified in RFC 3261 [26];\n3)\tvoid;\n4)\tvoid;\n5)\tvoid;\n5A)\tif the recipient of the request is understood from configured information to always send and receive private network traffic from this source, remove the P-Private-Network-Indication header field containing the domain name associated with that saved information;\n6)\tstore the values from the P-Charging-Function-Addresses header field, if present;\n7)\tif the request is an initial request and \"fe-identifier\" header field parameter of P-Charging-Vector header field is applied in the operator domain;\n-\tstore the \"fe-identifier\" header field parameter in the P-Charging-Vector header field; and\n-\tremove the \"fe-identifier\" header field parameter from the P-Charging-Vector header field;\n8)\tremove some of the parameters from the P-Charging-Vector header field or the header field itself, depending on operator policy, if present;\n9)\tremove the P-Charging-Function-Addresses header fields, if present; and\n10)\tremove the Via \"received-realm\" header field parameter, as defined in RFC 8055 [208], if present, prior to forwarding the request;\nand forward the request according to RFC 3261 [26].\nNOTE 3:\tIf IBCF processes a request without a pre-defined route (e.g. the subscription to reg event package originated by the P-CSCF), the next-hop address can be either obtained as specified in RFC 3263 [27A] or be provisioned in the IBCF.\nWhen the IBCF receives an INVITE request, the IBCF may require the periodic refreshment of the session to avoid hung states in the IBCF. If the IBCF requires the session to be refreshed, the IBCF shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 4:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nWhen receiving a response to the initial request with a P-Charging-Vector header field, the IBCF acting as an exit point shall, if \"fe-identifier\" header field parameter of P-Charging-Vector header field is applied in the operator domain:\n-\tremove any received \"fe-identifier\" header field parameter from the P-Charging-Vector header field; and\n-\tadd the \"fe-identifier\" header field parameter stored from the initial request to the P-Charging-Vector header field and add its own address or identifier as an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field.\nWith the exception of 305 (Use Proxy) responses, the IBCF shall not recurse on 3xx responses.\nUpon receipt of a subsequent request, the IBCF shall:\n1)\tif the request is an INVITE request, respond with a 100 (Trying) provisional response;\n1A)\tif the request is a NOTIFY request with the Subscription-State header field set to \"terminated\" and the IBCF has retained the SIP dialog state information for the associated subscription, once the NOTIFY transaction is terminated, the IBCF can remove all the stored information related to the associated subscription;\n2)\tif the request is a target refresh request and the IBCF is configured to perform application level gateway and/or transport plane control functionalities, save the Contact and CSeq header field values received in the request such that the IBCF is able to release the session if needed; and\n3)\tif the subsequent request is other than a target refresh request (including requests relating to an existing dialog where the method is unknown) and the IBCF is configured to perform application level gateway and/or transport plane control functionalities, save the Contact and CSeq header field values received in the request such that the IBCF is able to release the session if needed;\nand forwards the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26].\nIf the IBCF provides transport plane control functionality and receives an indication of a transport plane related error the IBCF may:\n1)\tgenerate a BYE request for the terminating side based on information saved for the related dialog; and\n2)\tgenerate a BYE request for the originating side based on the information saved for the related dialog.\nNOTE:\tTransport plane related errors can be indicated from e.g. TrGW, or PCRF. The protocol for indicating transport plane related errors to the IBCF is out of scope of this specification.\nUpon receipt of the 2xx responses for both BYE requests, the IBCF shall release all information related to the dialog and the related multimedia session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.3\tIBCF as an entry point",
                            "text_content": "When IBCF receives a REGISTER request, the IBCF shall:\n1)\tverify if it arrived from a trusted domain or not. If the request arrived from an untrusted domain, respond with 403 (Forbidden) response;\nNOTE 1:\tThe IBCF can find out whether the request arrived from a trusted domain or not, from the procedures described in 3GPP TS 33.210 [19A].\n2)\tif network topology hiding, or screening of SIP signalling, is required or IBCF is configured to perform application level gateway and/or transport plane control functionalities, add its own routeable SIP  to the top of the Path header field; and\nNOTE 2:\tThe IBCF can include in the inserted SIP  an indicator that identifies the direction of subsequent requests received by the IBCF i.e., from the S-CSCF towards the P-CSCF, to identify the UE-terminating case. The IBCF can encode this indicator in different ways, such as, e.g., a unique parameter in the , a character string in the username part of the , or a dedicated port number in the .\nNOTE 3:\tAny subsequent request that includes the direction indicator (in the Route header field) or arrives at the dedicated port number, indicates that the request was sent by the S-CSCF towards the P-CSCF.\n3)\tIf IBCF is colocated with an I-CSCF, or it has a preconfigured I-CSCF to be contacted, forward the request to that I-CSCF. Otherwise select an I-CSCF and forward the request to that I-CSCF.\nNOTE 5: The selection of an I-CSCF can lead to additional delays.\nIf the selected I-CSCF:\n-\tdoes not respond to the REGISTER request and its retransmissions by the IBCF; or\n-\tsends back a 3xx response or 480 (Temporarily Unavailable) response to a REGISTER request;\nthe IBCF shall select a new I-CSCF and forward the REGISTER request to that I-CSCF.\nNOTE 4:\tThe list of the I-CSCFs can be either obtained as specified in RFC 3263 [27A] or provisioned in the IBCF.\nIf the IBCF fails to forward the REGISTER request to any I-CSCF, the IBCF shall send back a 504 (Server Time-Out) response towards the P-CSCF, in accordance with the procedures in RFC 3261 [26].\nFor all SIP transactions identified:\n-\tif priority is supported (NOTE 1), as containing an authorised Resource-Priority header field or a temporarily authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field;\nthe IBCF shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the IBCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE 1:\tFor an INVITE request, various mechanisms can be applied to recognize the need for priority treatment (e.g., based on the dialled digits). The exact mechanisms are left to national regulation and network configuration.\nBased on the alternative mechanism to recognize the need for priority treatment, the IBCF shall insert the temporarily authorised Resource-Priority header field with appropriate namespace and priority value in the INVITE request.\nNOTE 2:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nBased on local policy, the IBCF acting as an entry point shall add in requests in the P-Charging-Vector header field a \"transit-ioi\" header field parameter with an entry which identifies the operator network which the request is transitting or with a void entry.\nBased on local policy the IBCF shall delete or void in requests in the P-Charging-Vector header field any received \"transit-ioi\" header field parameter value.\nNOTE 3:\tOnly one \"transit-ioi\" header field parameter entry is added per transit network.\nUpon receipt of:\n-\tan initial request for a dialog;\n-\ta request for a standalone transaction except the REGISTER request; or\n-\ta request for an unknown method that does not relate to an existing dialog;\nthe IBCF shall verify whether the request is arrived from a trusted domain or not. If the request arrived from an untrusted domain, then the IBCF shall:\n-\tif the topmost Route header field of the request contains the \"orig\" parameter, respond with 403 (Forbidden) response.\nOtherwise,\n-\tremove all P-Charging-Vector header fields and all P-Charging-Function-Addresses header fields the request may contain; and\n-\tremove all Feature-Caps header fields, if present.\nUpon receipt of:\n-\tan initial request for a dialog;\n-\ta request for a standalone transaction except the REGISTER request; or\n-\ta request for an unknown method that does not relate to an existing dialog;\nthe IBCF shall:\n1)\tif the request is an INVITE request, then respond with a 100 (Trying) provisional response;\n1A)\tif a P-Private-Network-Indication header field is included in the request, check whether the configured information allows the receipt of private network traffic from this source. If private network traffic is allowed, the IBCF shall check whether the received domain name in any included P-Private-Network-Indication header field in the request is the same as the domain name associated with that configured information. If private network traffic is not allowed, or the received domain name does not match, then the IBCF shall remove the P-Private-Network-Indication header field;\n1B)\tif the initiator of the request is understood from configured information to always send and receive private network traffic from this source, insert a P-Private-Network-Indication header field containing the domain name associated with that configured information;\n1C)\tremove its own SIP  from the topmost Route header field;\n2)\tif the request is an INVITE request and the IBCF is configured to perform application level gateway and/or transport plane control functionalities, then the IBCF shall save the Contact, CSeq and Record-Route header field values received in the request such that the IBCF is able to release the session if needed;\n2A)\tIf the request is a SUBSCRIBE and the IBCF does not need to act as B2BUA, based on operator policy, the IBCF shall determine whether or not to retain, for the related subscription, the SIP dialog state information and the duration information;\nNOTE 1:\tThe event package name can be taken into account to decide whether or not the SIP dialog state and the subscription duration information needs to be retained.\nNOTE 2:\tThe IBCF needs to insert its own  in Record-Route of the initial SUBSCRIBE request and all subsequent NOTIFY requests if it decides to retain the SIP dialog state information.\n2B)\tif the request is an initial request for a dialog and local policy requires the application of IBCF capabilities in subsequent requests, perform record route procedures as specified in RFC 3261 [26];\n2C)\tif\n-\tthe request is an initial request for a dialog, or a standalone request, and\n-\tthe Request- contains an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69] and\n-\ta P-Private-Network-Indication valid within the trust domain is not included, and\n-\tbased on local policy, no Route header field is remaining after step 1C) was executed,\nthen include a topmost Route header field set to the  associated with an E-CSCF;\n2D)\tif the network uses the Resource-Priority header field to control the priority of emergency calls, the IBCF shall add a Resource-Priority header field containing a namespace of \"esnet\" as defined in RFC 7135 [197];\n3)\tvoid;\n4)\tif IBCF receives an initial request for a dialog or standalone transaction, that contains a single Route header field pointing to itself, and it is co-located with an I-CSCF, or it has a preconfigured I-CSCF to be contacted, then forward the request to that I-CSCF. Otherwise select an I-CSCF and forward the request to that I-CSCF. If the single Route header field of the request contains the \"orig\" parameter, the IBCF shall insert the \"orig\" parameter to the  of the I-CSCF;\nNOTE 3: The selection of an I-CSCF can lead to additional delays.\n5)\tif the request does not contain a Route header field or if it contains one or more Route header fields where the topmost Route header field does not contain the \"orig\" parameter, optionally – based on operator policy – append the \"orig\" parameter to the  in the topmost Route header field of the next request sent from the IBCF to an entity of the IM CN subsystem for which it is an entry point;\nNOTE 4: The appending of an \"orig\" parameter to the  in the topmost Route header field enables an IM CN subsystem to perform originating services to the network that originated the initial request. The appending can be dependent on the network that originated the initial request as determined by e.g. origin IP address of the received request, etc.\n6)\tif services that require knowledge of the adjacent network are provided within the network for which the IBCF is acting as an entry point, based on operator policy, insert a Via \"received-realm\" header field parameter, as defined in RFC 8055 [208];\n6A)\tif the IBCF, acting as an entry point to a terminating visited network, PCRF based P-CSCF restoration procedures,\n-\tthe request contains a topmost Route header field pointing to a P-CSCF, and\n-\tthe IBCF considers the P-CSCF is in a non-working state,\nremove all entries in the Route header field and add a Route header field set to the  associated with an alternative P-CSCF;\nNOTE 5:\tHow the SIP  of the alternative P-CSCF is obtained by the IBCF is implementation dependent. The IBCF can make sure that selected P-CSCF support the PCRF based P-CSCF restoration procedures based on local configuration.\nNOTE 6:\tIt is implementation dependent as to how the IBCF determines the P-CSCF is in non-working state.\n7)\tif the initiator of the request is understood to always send and receive private network traffic:\nNOTE 7:\tThe IBCF can identify that a request is received from a source that always sends or receives private traffic by evaluating the  session or by other means.\na)\tadd the identity of the initiator in a P-Served-User header field as defined in RFC 5502 [133] as a SIP  identifying the initiator; and\nNOTE 8:\tThe IBCF can retrieve the identity of the initiator from the subjectCommonName (CN) if it is not present in the subjectAltName in the certificates during the  session setup in accordance with the procedures of RFC 5280 [213] or by other means.\nb)\tif not already appended in 4) or 5) above, append the \"orig\" parameter to the  in the topmost Route header field of the request sent from the IBCF to the entity of the IM CN subsystem for which it is an entry point;\n8)\tif the request is an initial request and \"fe-identifier\" header field parameter of P-Charging-Vector header field is applied in the operator domain:\n-\tremove any received \"fe-identifier\" header field parameter from the P-Charging-Vector header field; and\n-\tadd an \"fe-addr\" element in an \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier; and\n9)\tif the IBCF supports calling number verification using signature verification and attestation information as described in subclause 3.1 and no Identity header field is received in an initial INVITE or MESSAGE request, based on local policy insert:\na)\tan Attestation-Info header field specified in subclause 7.2.18 set to a value \"C\", specified in RFC 8588 [261]; and\nb)\tan Origination-Id header field specified in subclause 7.2.19 containing an \"origid\" claim as specified in RFC 8588 [261] set to a value identifying the source of the request;\nand forward the request according to RFC 3261 [26].\nWhen the IBCF receives an INVITE request, the IBCF may require the periodic refreshment of the session to avoid hung states in the IBCF. If the IBCF requires the session to be refreshed, the IBCF shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 9:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nIf the serving network supports HSS based P-CSCF restoration as specified in 3GPP TS 23.380 [7D], the IBCF is acting as an entry point to a terminating visited network and the IBCF does not receive any response within a configured time:\nNOTE 10:\tThe configurable time needs to be less than timer B and timer F.\n1)\tto an initial INVITE request, then if the Route header field contains only one entry the IBCF shall in the 408 (Request Timeout) response include a Restoration-Info header field specified in subclause 7.2.11 containing the value \"noresponse\"; and\n2)\tto an initial non-INVITE request for a dialog, a standalone transaction or an unknown method that does not relate to an existing dialog, then if the Route header field contains only one entry the IBCF shall send a 504 (Server Time-out) response include a Restoration-Info header field specified in subclause 7.2.11 containing the value \"noresponse\".\nNOTE 11:\tThe IBCF determines if it is acting as an entry point to a terminating visited network based on configuration or other data in the incoming request, or the \"iotl\" SIP  parameter specified in RFC 7549 [225].\nNOTE 12:\tIf there is only one entry in the Route header field it represents either an  server or a P-CSCF. The S-CSCF will use the g.3gpp.ics media feature tag to determine if it is the  server or the P-CSCF.\nWhen the IBCF receives a response to an initial request (e.g. 183 or 2xx), the IBCF shall:\n1)\tstore the values from the P-Charging-Function-Addresses header field, if present;\n2)\tremove the \"fe-identifier\" header field parameter from the P-Charging-Vector header field, if present; and\n3)\tremove the P-Charging-Function-Addresses header field prior to forwarding the message;\nWith the exception of 305 (Use Proxy) responses, the IBCF shall not recurse on 3xx responses.\nUpon receipt of a subsequent request, the IBCF shall:\n1)\tif the request is an INVITE request, then respond with a 100 (Trying) provisional response;\n1A)\tif the request is a NOTIFY request with the Subscription-State header field set to \"terminated\" and the IBCF has retained the SIP dialog state information for the associated subscription, once the NOTIFY transaction is terminated, the IBCF can remove all the stored information related to the associated subscription;\n2)\tif the request is a target refresh request and the IBCF is configured to perform application level gateway and/or transport plane control functionalities, then the IBCF shall save the Contact and CSeq header field values received in the request such that the IBCF is able to release the session if needed;\n3)\tif the subsequent request is other than a target refresh request (including requests relating to an existing dialog where the method is unknown) and the IBCF is configured to perform application level gateway and/or transport plane control functionalities, then the IBCF shall save the Contact and CSeq header field values received in the request such that the IBCF is able to release the session if needed;\n4)\tvoid;\n5)\tif the request is received from an untrusted domain, remove all Feature-Caps header fields, if present; and\n6)\tif the subsequent request is received from an entity outside the trust domain, then the IBCF shall remove a P-Charging-Vector header field, if present;\nand forwards the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26].\nIf the IBCF provides transport plane control functionality and receives an indication of a transport plane related error the IBCF may:\n1)\tgenerate a BYE request for the terminating side based on information saved for the related dialog; and\n2)\tgenerate a BYE request for the originating side based on the information saved for the related dialog.\nNOTE:\tTransport plane related errors can be indicated from e.g. TrGW or PCRF. The protocol for indicating transport plane related errors to the IBCF is out of scope of this specification.\nUpon receipt of the 2xx responses for both BYE requests, the IBCF shall release all information related to the dialog and the related multimedia session.\nWhen the IBCF acting as an entry point in the originating home network is unable to forward a SIP request, as determined by one of the following:\nNOTE 1:\tIf IBCF supports indicating traffic leg associated with a  as specified in RFC 7549 [225], the IBCF can determine that IBCF is acting as an entry point in the originating home network by inspecting the value of the \"iotl\" SIP  parameter, if an \"iotl\" SIP  is included in the SIP request.\n-\tthere is no response to the SIP request and its retransmissions by the IBCF; or\n-\tby unspecified means available to the IBCF;\nand:\n-\tthe IBCF supports S-CSCF restoration procedures;\nthen the IBCF:\n1)\tshall reject the request by returning a 504 (Server Time-out) response; and\n2)\tshall include in the 504 (Server Time-out) response:\n-\ta Content-Type header field with the value set to associated MIME type of the 3GPP IM CN subsystem XML body as described in subclause 7.6.1;\n-\ta P-Asserted-Identity header field set to the value of the SIP  of the IBCF included in the Path header field during the registration (see subclause 5.10.3.1); and\n-\ta 3GPP IM CN subsystem XML body containing:\na)\tan <ims-3gpp> element with the \"version\" attribute set to \"1\" and with an <alternative-service> child element, set to the parameters of the alternative service:\ni)\ta <type> child element, set to \"restoration\" (see table 7.6.2) to indicate that restoration procedures are supported;\nii)\ta <reason> child element, set to an operator configurable reason; and\niii)\tan <action> child element, set to \"initial-registration\" (see table 7.6.3).\nNOTE 2:\tThese procedures do not prevent the usage of unspecified reliability or recovery techniques above and beyond those specified in this subclause.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.4\tTHIG functionality in the IBCF",
                            "text_content": "NOTE 1:\tTHIG functionality is performed in I-CSCF in Release-5 and Release-6 and is compatible with the procedures specified in this subclause.\nThe following procedures shall only be applied if network topology hiding is required by the network. The network requiring network topology hiding is called the hiding network.\nNOTE 2:\tRequests and responses are handled independently therefore no state information is needed for that purpose within an IBCF.\nThe IBCF shall apply network topology hiding to all header fields which reveal topology information, such as Via, Route, Record-Route, Service-Route, and Path.\nUpon receiving an incoming REGISTER request for which network topology hiding has to be applied and which includes a Path header field, the IBCF shall add the routeable SIP  of the IBCF to the top of the Path header field. The IBCF may:\n1)\tinclude in the inserted SIP  an indicator that identifies the direction of subsequent requests received by the IBCF i.e., from the S-CSCF towards the P-CSCF, to identify the UE-terminating case. The IBCF may encode this indicator in different ways, such as, e.g., a unique parameter in the , a character string in the username part of the , or a dedicated port number in the ; and\n2)\tif:\na)\tIBCF supports indicating traffic leg associated with a  as specified in RFC 7549 [225]; and\nb)\tif the SIP  in the bottommost hidden Path header field contains an \"iotl\" SIP  parameter;\nthen append an \"iotl\" SIP  parameter with the same value to its own SIP  in the Path header field.\nNOTE 3:\tAny subsequent request that includes the direction indicator (in the Route header field) or arrives at the dedicated port number, indicates that the request was sent by the S-CSCF towards the P-CSCF.\nUpon receiving a 200 (OK) response to the REGISTER request and:\n1.\tif the IBCF is located in the visited network; and\n2.\tif the IBCF applied topology hiding on the Path header field contained in the REGISTER request;\nthe IBCF shall:\n1.\tperform a decryption procedure, as described in subclause 5.10.4.3, on the received Path header field; and\n2.\tinsert a \"+g.3gpp.thig-path\" Feature-Caps header field parameter, as defined in subclause 7.9A.9, set to the same IBCF's SIP  value as included in the Path header field of the REGISTER request sent to the home network.\nNOTE 4:\tIf a decryption of the Path header field contained in a 200 (OK) response on REGISTER request is not done then the UE will not perform restoration procedures if the P-CSCF rejects an initial request for a dialog or a request for a standalone transaction with a 504 (Server Time-out) response since there will be a mismatch between a SIP  in the P-Asserted-Identity header field received in a valid 504 (Server Time-out) response and the SIP URIs the UE received in the Path header field.\nUpon receiving an incoming initial request for which network topology hiding has to be applied and which includes a Record-Route header field, the IBCF shall add its own routeable SIP  to the top of the Record-Route header field.\nUpon receiving a 200 (OK) response to a REGISTER request for which network topology hiding has to be applied and which includes an  identifying the IBCF in the topmost Service-Route header field and:\n1)\tif IBCF supports indicating the traffic leg associated with a  as specified in RFC 7549 [225]; and\n2)\tif an \"iotl\" parameter is included in the bottommost SIP ;\nthen append an \"iotl\" SIP  parameter with the same value to its own SIP  in the Service-Route header field.\nWhen the home network IBCF receives a 504 (Server Time-out) response containing a P-Asserted-Identity header field set to the value of the S-CSCF's SIP  for a roaming UE and if the home network is a hiding network then the IBCF shall replace the received P-Asserted-Identity header field with the P-Asserted-Identity header field set to the value of the own SIP .\nNOTE 5:\tBy provision or by obtaining from the corresponding request's Route header field, the IBCF deduces whether the received value of the P-Asserted-Identity header field in the 504 (Server Time-out) response is the value of S-CSCF's SIP .\nUpon receiving an outgoing request/response from the hiding network the IBCF shall perform the encryption for network topology hiding purposes, i.e. the IBCF shall:\n0)\tif applying encryption procedure on the Service-Route header field, exclude from the Service-Route header field the entry corresponding to its own SIP  and use the remaining header field values which were added by one or more specific entity of the hiding network as input to encryption and skip item 1) below;\nNOTE 1:\tIn accordance with the procedures described in RFC 3608 [38], the IBCF does not insert its own routable SIP  to the Service-Route header field i.e. the SIP  identifying the IBCF in the topmost entry of the Service-Route header field is inserted by the S-CSCF. However this entry is excluded from encryption and will stay in the topmost entry of the Service-Route header field i.e. before the topmost encrypted entry.\n1)\tuse the whole header field values which were added by one or more specific entity of the hiding network as input to encryption, besides the UE entry;\n2)\tnot change the order of the header fields subject to encryption when performing encryption;\n3)\tuse for one encrypted string all received consecutive header field entries subject to encryption, regardless if they appear in separate consecutive header fields or if they are consecutive entries in a comma separated list in one header field;\n4)\tconstruct a hostname that is the encrypted string in a way that allows to identify the encrypting network's name (i.e. the IBCF network);\nNOTE 2:\tThis is to allow the IBCF to identify that itself has encrypted the string when subsequently receiving the encrypted string. The details of encoding the encrypting networks's name are not specified as the IBCF is the creator and consumer of this value. This is needed because header field parameters (like \"tokenized-by\") are not required to be preserved when creating a route set.\n5)\tappend a \"tokenized-by\" header field parameter and set it to the value of the encrypting network's name, after the constructed hostname;\n6)\tform one valid entry for the specific header field out of the resulting NAI, e.g. prepend \"SIP/2.0/UDP\" for Via header fields or \"sip:\" for Path, Service-Route, Route and Record-Route header fields;\n7)\tif the IBCF encrypted an entry in the Route header field, then it also inserts its own  before the topmost encrypted entry; and\n8)\tif the IBCF encrypted an entry in the Via header field, then it also inserts its own  before the topmost encrypted entry.\nNOTE 3:\tEven if consecutive entries of the same network in a specific header field are encrypted, they will result in only one encrypted header field entry. For example:\nVia: SIP/2.0/UDP ibcf1.home1.net;lr,\nSIP/2.0/UDP Token(\tSIP/2.0/UDP scscf1.home1.net;lr,\nSIP/2.0/UDP pcscf1.home1.net;lr)@home1.net;\ntokenized-by=home1.net,\nSIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]\n\nNOTE 4:\tIf multiple entries of the same network are within the same type of header fields, but they are not consecutive, then these entries will be tokenized to different strings. For example:\nRecord-Route:\tsip:ibcf1.home1.net;lr,\nsip:Token(sip:scscf1.home1.net;lr)@home1.net;tokenized-by=home1.net,\nsip:as1.foreign.net;lr,\nsip:Token(sip:scscf1.home1.net;lr,\nsip:pcscf1.home1.net;lr)@home1.net;tokenized-by=home1.net\n\nNOTE 5:\tIf request will return to the hiding network (e.g. after visiting an AS), then the  of IBCF is inserted. For example:\nRoute: sip:as1.foreign.net;lr,\nsip:ibcf1.home1.net;lr,\nsip:Token(sip:scscf1.home1.net;lr);tokenized-by=home1.net\n\nUpon receiving and incoming requests/response to the hiding network the IBCF shall perform the decryption for network topology hiding purposes, i.e. the IBCF shall:\n1)\tidentify hostnames encrypted by the network this IBCF belongs to within all header fields of the incoming message;\n2)\tuse those hostnames that carry the identification of the hiding network as input to decryption;\n3)\tuse as encrypted string the hostname which follows the sent-protocol (for Via header fields, e.g. \"SIP/2.0/UDP\") or the  scheme (for Path, Route and Record-Route header fields, e.g. \"sip:\");\n4)\treplace all content of the received header field which carries encrypted information with the entries resulting from decryption.\nEXAMPLE:\tAn encrypted entry to a Via header field that looks like:\nVia:\tSIP/2.0/UDP Token(SIP/2.0/UDP scscf1.home1.net;lr,\nSIP/2.0/UDP pcscf1.home1.net;lr);tokenized-by=home1.net\n\nwill be replaced with the following entries:\nVia: SIP/2.0/UDP scscf1.home1.net;lr, SIP/2.0/UDP pcscf1.home1.net;lr\n\nNOTE:\tMotivations for these decryption procedures are e.g. to allow the correct routeing of a response through the hiding network, to enable loop avoidance within the hiding network, or to allow the entities of the hiding network to change their entries within e.g. the Record-Route header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.5\tIMS- functionality in the IBCF",
                            "text_content": "The IBCF shall only apply the following procedures if application level gateway functionality is required by the network.\nThe IBCF acts as a B2BUA when it performs IMS- functionality. As an IMS-, the IBCF will internally map the message header fields between the two dialogs that it manages. It is responsible for correlating the dialog identifiers and will decide when to simply translate a message from one dialog to the other, or when to perform other functions. The IBCF, although acting as a UA, does not initiate any registration of its associated addresses. These are assumed to be known by peer-to-peer arrangements within the IM CN subsystem.\nAn IBCF may replace a contact address with a  of its own when the contact address in the incoming message is not a GRUU. In all other cases the IBCF shall use a GRUU (e.g when the contact address is an IP address).\nThe IBCF shall transparently forward a received Contact header field when the Contact header field contains a GRUU or a media feature tag is included indicating a capability for which the Contact  can be used by the remote party. When transparently forwarding a received Contact header field of a dialog-forming request, the IBCF shall include its own  in a Record-Route header field in order to ensure that it is included on the route of subsequent requests.\nNOTE:\tOne example of such a media feature tag is the isfocus media feature tag used by conference services to transport the temporary conference identity that can be used when rejoining an ongoing conference.\nThe internal function of the IBCF as an IMS- is defined in 3GPP TS 29.162 [11A].\nIf the IBCF receives a message with a body part for a UE from an S-CSCF, and:\n-\tif the body part is the 3GPP IM CN subsystem XML body (as indicated by the Content-Type header field, see subclause 7.6) and the body part is not optional (as indicated by the (absence of the) Content-Disposition header field); or\n-\tif a header field that describes the body is present and the header field's value is not understood (e.g. Content-Language header field or Content-Encoding header field);\nthen the IBCF shall transparently forward the message with the body part and the header field(s) that describe the body part.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.6\tScreening of SIP signalling",
                            "text_content": "The IBCF may act as a B2BUA when it performs screening of SIP signalling functionality. In this case the B2BUA behaviour of the IBCF shall comply with the description given in subclause 5.10.5 for the IMS- functionality.\nNOTE:\tMany header fields are intended for end-to-end operation; removal of such header fields will impact the intended end-to-end operation between the end users. Additionally the IM CN subsystem does not preclude security mechanisms covering SIP header fields; any such removal can prevent validation of all header fields covered by the security mechanism.\nIf specified by local policy rules, the IBCF may omit or modify any received SIP header fields prior to forwarding SIP messages, with the following exceptions.\nAs a result of any screening policy adopted, the IBCF should not modify at least the following header fields which would cause misoperation of the IM CN subsystem:\n-\tAuthorization; and\n-\t-Authenticate.\nWhere the IBCF appears in the path between the UE and the S-CSCF, some header fields are involved in the registration and authentication of the user. As a result of any screening policy adopted as part of normal operation, e.g. where the request or response is forwarded on, the IBCF should not modify as part of the registration procedure at least the following header fields:\n-\tPath; and\n-\tService-Route.\nNOTE 1:\tIf the IBCF modifies SIP information elements (SIP header fields, SIP message bodies) other than as specified by SIP procedures (e.g., RFC 3261 [26]) caution needs to be taken that SIP functionality (e.g., routeing using Route, Record-Route and Via) is not impacted in a way that could create interoperability problems with networks that assume that this information is not modified.\nNOTE 2:\tWhere operator requirements can be achieved by configuration hiding, then these procedures can be used in preference to screening.\nThe IBCF may add, remove, or modify, the P-Early-Media header field within forwarded SIP requests and responses according to procedures in RFC 5009 [109].\nNOTE 3:\tThe IBCF can use the P-Early-Media header field for the gate control procedures,by through-connect control as described in 3GPP TS 29.162 [11A]. In the presence of early media for multiple dialogs due to forking, if the IBCF is able to identify the media associated with a dialog, (i.e., if symmetric  is used by the UE and the IBCF can use the remote SDP information to determine the source of the media) the IBCF can selectively open the gate corresponding to an authorized early media flow for the selected media.\nThe IBCF may add, or omit any P-Asserted-Identity header fields prior to forwarding SIP messages according to local policy.\nNOTE 4:\tThe IBCF can use the P-Asserted-Identy header field to trigger identity specific procedures in subsequent entities, e.g. for malicious call identification. As an example, a P-Asserted-Identity header field will be deleted and a new P-Asserted-Identity header field with operator specific content will be added to the outgoing request, if the request was received from a network which cannot support the deletion of INFO request which is needed for the support of the malicious call identification service.\nWhen the IBCF, located in the home network, receives a SIP request from another entity within the same trust domain, the IBCF may police the ICSI value contained in the P-Asserted-Service header field.\nIf the IBCF acts as a B2BUA, and the IBCF receives a message with a body part for a UE from an S-CSCF, and:\n-\tif the body part is the 3GPP IM CN subsystem XML body (as indicated by the Content-Type header field, see subclause 7.6) and the body part is not optional (as indicated by the (absence of the) Content-Disposition header field); or\n-\tif a header field that describes the body is present and the header field's value is not understood (e.g. Content-Language header field or Content-Encoding header field),\nthen the IBCF shall transparently forward the message with the body part and the header field(s) that describe the body part.\nIf IP address translation ((P)T or IP version interworking) occurs on the user plane, the IBCF shall modify SDP according to subclause 6.7.1;\nAdditionally, the IBCF may take the followings action upon SIP message bodies:\n1)\texamine the length of a SIP message body and if required by local policy, take an appropriate action (e.g. forward the message body transparently, reject the request, remove the body);\n2)\texamine the characteristics of the SIP message body MIMEs (i.e. check the values of any Content-Type, Content-Disposition, and Content-Language header fields), take an appropriate action defined by local policy (e.g. forward the body unchanged, remove the SIP message body MIME, reject the call); and\n3)\texamine the content of SIP message body MIMEs, and take appropriate action defined by local policy (e.g. forward the body unchanged, remove the SIP message body MIME, reject the call).\nWhen the intended action of an IBCF, based on local policy, is to remove a message body MIME from a SIP message body, and a Content-Disposition header field with a \"handling\" parameter set to \"required\" is associated with the MIME, the IBCF shall reject the SIP request with the 415 (Unsupported Media Type) response code as specified in RFC 5621 [150].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.7\tMedia transcoding control",
                            "text_content": "The IBCF may perform the media transcoding control in order to allow establishing communication between IM CN subsystems using different media codecs based on the interworking agreement and session information. When performing media transcoding control the IBCF acts as a special case of an IMS- compliant with the description given in subclause 5.10.5.\nUpon receipt of any request containing an SDP offer, based on local policy and signalling inspection (e.g ICSI values, SDP), the IBCF may perform media transcoding control, as defined in subclause 6.7.1.3. Based on the local configuration determines the media which requires transcoding in the SDP offer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.8\tPrivacy protection at the trust domain boundary",
                            "text_content": "In order to ensure privacy IBCF shall additionally to what is specified in subclause 4.4 and before sending the SIP requests or SIP responses outside the trust domain boundary perform the privacy protection as specified in RFC 3323 [33] and RFC 7044 [66] applicable to header fields with the clarifications in this subclause. If there are any conflicts between topology hiding specified in subclause 5.10.4 and the procedures in this subclause, the topology hiding takes precedence over privacy protection.\nNOTE:\tThe privacy protection for the History-Info header field is performed in accordance with RFC 7044 [66] subclause 10.1.2.\nIf a Privacy header field with a value different from \"none\" is received the IBCF shall:\n1)\tif \"header\" privacy is requested as specified in RFC 3323 [33]:\n-\tremove all received Via header fields and then add a single Via header field with a  of its own as described in RFC 3323 [33] subclause 5.1;\n-\tif the Contact header field does not contain a GRUU or does not contain an isfocus media feature tag, replace the value of the  of the Contact header field with a  that does not dereference to the originator of the message as described in RFC 3323 [33] subclause 5.1; and\n-\tremove any Record-Route header fields as described in RFC 3323 [33] subclause 5.1;\n2)\tif \"user\" level privacy is requested as specified in RFC 3323 [33]:\n-\tanonymize the From header field. The convention for configuring an anonymous From header field described in RFC 3323 [33] and RFC 3325 [34] should be followed; i.e. From: \"Anonymous\" <sip:anonymous@anonymous.invalid>;tag= xxxxxxx; and\n3)\tif any modification of any dialog-matching headers for privacy protection reasons is done act as a transparent B2BUA as described in RFC 3323 [33] subclause 5.3.\nIf a Privacy header field is not received IBCF may based on local policy act as if \"id\", \"user\", \"header\" and \"history\" was received and perform privacy protection as specified in RFC 3325 [34], RFC 3323 [33] and RFC 7044 [66] with the clarifications above.\nIf a Privacy header field with the value \"none\" is received the IBCF should not protect the privacy of the identity information.\nNOTE:\tA local policy can regard a Privacy header field with the value \"none\" the same as if no Privacy header field was received.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.9\tRoaming architecture for voice over IMS with local breakout",
                            "text_content": "The IBCF shall apply OMR as specified in 3GPP TS 29.079 [11D] and in accordance with the roaming architecture for voice over IMS with local breakout when a session is identified as a roaming architecture for voice over IMS with local breakout session.\nA session can be identified as a potential roaming architecture for voice over IMS with local breakout session when:\n1)\ta received initial INVITE request contains a Feature-Caps header field with a \"+g.3gpp.trf\" header field parameter, a \"+g.3gpp.loopback\" header field parameter or any other implementation dependent indication; or\nNOTE:\tAn implementation dependent indication can e.g. be in a  parameter, a character string in the user part of the  or be a port number in the .\n2)\tif indicating traffic leg as specified in RFC 7549 [225] is supported and used:\na)\tthe \"iotl\" SIP  parameter with the value \"visitedA-homeA\" in the bottommost Route header field; or\nb)\tthe \"iotl\" SIP  parameter with the value \"homeA-visitedA\" in the bottommost Route header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.10\tHTTP procedures over the Ms reference point",
                            "text_content": "General procedures over the Ms reference point are specified in clause V.2.\nWhen receiving an initial INVITE, re-INVITE or MESSAGE request containing one or more SIP Identity header fields, the IBCF shall determine the information (originating identity, diverting identities, contents of the Resource-Priority and Priority header fields) to be verified by decoding the Identity header fields containing a PASSporT SHAKEN JSON Web Token and/or a PASSporT rph JSON Web Token with an optional PASSporT sph JSON Web Token. The IBCF uses the Identity header fields to:\n1)\tbuild and send a verificationRequest, specified in annex V, to an AS for verification over the Ms reference point; and\n2)\tshall upon receiving an HTTP 200 (OK) response to the above request, use:\n-\tthe verstat claim from this response to populate the \"verstat\" tel URI parameter associated with the originating identity and add this parameter to the verified identity in the SIP From header field or the SIP P-Asserted-Identity header field in the forwarded SIP request. Additionally, if the HTTP 200 (OK) response included verification results for the diverting identities, the IBCF shall based on local policy add the \"verstat\" tel URI parameter to the verified diverting identities in the History-Info header field if this field is available;\n-\tthe verstatPriority claim from this response to populate the Priority-Verstat header field associated with the Resource-Priority header field and with the header field value \"psap-callback\" of the Priority header field (if present) and include the Priority-Verstat header field in the forwarded SIP request; and\n-\tthe verifyResults from this response, if present, to store any of the PASSporT verification failure parameters shown in Table V.2.6.2-4.\nBased on local policy, the IBCF may populate for each reported Identity header field verification error a Reason header field in the next provisional or final response of the INVITE or MESSAGE request, where the Reason header field protocol value is set to \"STIR\", as specified inRFC 9410 [294] and RFC 9366 [296], and the \"cause\" header field parameter contains the stored \"reasonCode\" value. Additionally, the IBCF may include the \"ppi\" header field parameter containing the failing PASSporT.\nNOTE 1:\tMultiple Reason header fields with the protocol value set to \"STIR\" are not supported in the present document.\nBased on local policy, the IBCF may verify that the validated claims returned in the validClaims parameter of the verification response authorize the associated SIP header field values.\nNOTE 2:\tFor sessions originating in another domain, only one of the following entities needs to be configured to verify the Identity header field for the resource priority: the IBCF or the AS. Which functional entity inserts the Identity header field verification is subject to network configuration and local policy.\nWhen receiving an initial INVITE or MESSAGE request containing:\nNOTE 1:\tAs part of the border control procedures the IBCF can apply privacy procedures and in these cases this procedure is not needed.\n1)\ta \"verstat\" tel URI parameter in at least one of the SIP From header field or the SIP P-Asserted-Identity header field;\n2)\ta SIP Attestation-Info header field as defined in subclause 7.2.18; and\n3)\ta SIP Origination-Id header field as defined in subclause 7.2.19;\nand if no Identity header field exists, the IBCF sends a signingRequest, specified in annex V, over the Ms reference point. When the HTTP 200 (OK) response to this request is received, the IBCF shall include value of the \"identity\" claim in an Identity header field in the forwarded SIP request.\nWhen receiving an initial INVITE or MESSAGE request containing at least one Identity header field and a \"verstat\" tel URI parameter in a tel URI or a SIP URI with a user=phone parameter in one or more History-Info header field(s) or using other not specified means to determine that a diversion has occurred, then the IBCF sends a signingRequest, specified in annex V, over the Ms reference point for each of the identities to be signed. When the HTTP 200 (OK) response for any of these requests is received, the IBCF shall include the value of the \"identity\" claim in an Identity header field in the forwarded SIP request.\nNOTE 2:\tAs part of the border control procedures the IBCF can apply privacy procedures and in these cases this procedure is not needed.\nWhen receiving an initial INVITE request containing the Resource-Priority header field and optionally the Priority header field with a \"psap-callback\" header field value or if the IBCF included the Priority header field with a \"psap-callback\" header field value and the Resource-Priority header field (as specified in subclause 5.10.1), the IBCF sends  a signingRequest, over the Ms reference point, as specified in annex V, for the resource priority and optionally, the Priority header fields. When the HTTP 200 (OK) response to this request is received, the IBCF shall include the value of the \"identity\" claim in an Identity header field in the forwarded initial INVITE request.\nWhen receiving a re-INVITE request containing the Resource-Priority header field, the IBCF sends a signingRequest, over the Ms reference point, as specified in annex V, for the resource priority. When the HTTP 200 (OK) response to this request is received, the IBCF shall include the value of the \"identity\" claim in an Identity header field in the forwarded re-INVITE request.\nNOTE 3:\tFor sessions terminating in another domain, only one of the following entities needs to be configured to provide an Identity header field for the resource priority: the IBCF or the AS. Which functional entity inserts the Identity header field is subject to network configuration and local policy.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.11\tProcedures at the E-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.11.1\tGeneral",
                            "text_content": "The PSAP may either be directly connected to the IM CN subsystem or via the PSTN. Based on regional/national requirements and network operator policy, the PSAP may be connected to the IM CN subsystem of another network.\nThe E-CSCF can receive URIs for a domain for which the operator running the E-CSCF is not responsible. Where RFC 3261 [26] specifies a requirement that the SIP entity has to be responsible for the domain for particular functionality to occur, the E-CSCF may ignore this restriction.\nNOTE 1:\tThe E-CSCF would normally implement this override if the P-CSCF or S-CSCF is configured to pass on URIs (e.g. Request-) that are outside the responsible domain of the E-CSCF, otherwise emergency calls might not be routed to a PSAP. If the P-CSCF or S-CSCF does not do this, then the override need not be applied.\nThe E-CSCF retrieves a PSAP , based on the location of the UE and the requested type of emergency service. The PSAP  can be retrieved from LRF (see subclause 5.11.3) or from local configuration. The PSAP address will either point to a PSAP connected to the IM CN subsystem or to a PSAP connected to the PSTN.\nIf operator policy determines that the E-CSCF selects the PSAP and if, based on the location information contained in the INVITE request, the E-CSCF fails to select the PSAP, the E-CSCF can interrogate an external server in order to retrieve location information.\nNOTE 2:\tThe protocol used between an E-CSCF and an external server is not specified in this version of the specification.\nWhen the E-CSCF receives an emergency request for a dialog requesting privacy or a standalone emergency transaction requesting privacy or any request or response related to a UE-originated emergency dialog requesting privacy, and if operator policy (e.g. determined by national regulatory requirements applicable to emergency services) allows requests for suppression of public user identifiers and location information per 3GPP TS 22.101 [1A], the E-CSCF:\n-\tshall provide the privacy service role according to RFC 3323 [33] and RFC 3325 [34];\nNOTE 3:\tThe procedure above is in addition to any procedure for the application of privacy at the edge of the trust domain specified by RFC 3325 [34] and subclause 4.4.\n-\tshall remove any location object from the message's body with Content-Type header field containing the content type application/pidf+xml. If only one message body remains in the message's body then the E-CSCF sets the Content-Type header field to the content type specified for the body; and\n-\tshall remove the Geolocation header field (if present) and the Geolocation-Routing header field (if present);\nNOTE 4:\tOperator policy can require retention/removal of user location information from such request or response separately from user identity, based on the national regulatory requirements.\nprior to forwarding any such request to a PSAP.\nNOTE 5:\tIf the routeing functions are supported by an LRF, this information is not removed before the request is sent to the LRF.\nThe E-CSCF shall log all SIP requests and responses that contain a \"logme\" header field parameter in the SIP Session-ID header field if required by local policy.\nWhen sending a failure response to any received request, depending on operator policy, the E-CSCF may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"e-cscf\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.11.2\tUE originating case",
                            "text_content": "The E-CSCF may forward an emergency request to a PSAP in the IM CN subsystem, a PSAP attached to another network, or a PSAP in the PSTN. If the PSAP is attached to another network, the requrest can pass IBCF(s) before entering the other network. If the PSAP is located in the PSTN, the request will pass a BGCF and a MGCF before entering the PSTN.\nUpon receipt of an initial request for a dialog, or a standalone transaction, or an unknown method including a Request- with an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69], or an emergency number the E-CSCF shall:\n1)\tif:\na)\tthe topmost Route header field of the received SIP INVITE request contains an E-CSCF  inserted by a P-CSCF, an AS or an IBCF;\nNOTE 1:\tThe E-CSCF is identified by two URIs, one preconfigured in the P-CSCF, AS or IBCF and one used to receive the request from EATF.\nb)\tthe Contact header field includes an instance-id feature tag containing an IMEI URN as specified in RFC 7254 [153] or an MEID URN as specified in RFC 8464 [187]. Only the IMEI shall be used for generating an instance ID for a multi-mode UE that supports both 3GPP and 3GPP2 defined radio access networks; and\nc)\trequired by the operator policy;\nthen:\na0)\tremove its own SIP  from the topmost Route header field;\na)\tinsert  of the EATF to be contacted into the Route header field as the topmost entry followed by own  to be used to receive the request from EATF;\nb)\tinsert a type 3 \"orig-ioi\" header field parameter in the P-Charging-Vector header field. The E-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The E-CSCF shall not include the type 3 \"term-ioi\" header field parameter;\nc)\tif required by national regulatory requirements applicable to emergency services, include:\n-\ta  with value \"emergency\"; and optionally\n-\tan OLI set to a value corresponding to the characteristics of the access used when the emergency request was initiated by the UE, i.e., an OLI that corresponds to a wireless access; and\nd)\troute the request based on SIP routeing procedures and do not continue with the rest of the steps;\n1A)\tremove its own SIP  from the topmost Route header field;\n1B)\tif the received request does not contain a P-Charging-Vector header field, insert a P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17];\n1C)\tif an \"orig-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"orig-ioi\" header field parameter;\nNOTE 2:\tAny received \"orig-ioi\" header field parameter will be a type 2 IOI generated by an S-CSCF or passed on by an IBCF. The type 2 IOI identifies the network from which the request was sent.\n1D)\tif operator policy determines that an LRF is to be used, forward the request to the LRF as indicated in subclause 5.11.3;\n2)\tif the PSAP is the next hop, store the value of the \"icid-value\" header field parameter received in the P-Charging-Vector header field and remove the received information in the P-Charging-Vector header field, else keep the P-Charging-Vector if the next hop is an exit IBCF or a BGCF;\n3)\tif the PSAP is the next hop remove the P-Charging-Function-Addresses header fields, if present, else keep the P-Charging-Function-Addresses header fields if the next hop is an exit IBCF or an BGCF;\n4)\tif an IBCF or a BGCF is the next hop, delete any received \"orig-ioi\" header field parameter, and insert a type 2 \"orig-ioi\" header field parameter into the P-Charging-Vector header field. The E-CSCF shall set the type 2 \"orig-ioi\" header field parameter to a value that identifies the sending network. The E-CSCF shall not include the \"term-ioi\" header field parameter;\n5)\tget location information as:\n-\tgeographical location information received in a PIDF location object as defined in RFC 4119 [90] and RFC 5491 [267], with the content type application/pidf+xml, as described RFC 6442 [89]; and\n-\tlocation identifier as derived from the P-Access-Network-Info header field, if available.\nNOTE 3:\tAs an alternative to retrieve location information from the LRF the E-CSCF can also request location information from an external server. The address to the external server can be received in the Geolocation header field as specified in RFC 6442 [89]. The protocol used to retrieve the location information from the external server is not specified in this version of the specification.\n5A)\tif the location is retrieved using information from the Geolocation header field, and if:\n-\tthe Geolocation-Routing header field is present, and includes a value not allowing routing of the request based on user location information;\n-\tthe Geolocation-Routing header field is present, and includes a value unknown to the E-CSCF; or\n-\tthe Geolocation-Routing header field is not present.\nnot use the location retrieved from the Geolocation header field when deciding where to forward the request.\n6)\tselect, based on location information and optionally type of emergency service:\na)\ta PSAP connected to the IM CN subsystem or another network, and add the PSAP  to the topmost Route header field; or\nNOTE 4:\tIf the user did not request privacy or if national regulator policy applicable to emergency services does not require the user be allowed to request privacy, the E-CSCF conveys the Geolocation header field (if present), the Geolocation-Routing header field (if present), the location information in a PIDF location object (if present) and the P-Access-Network-Info header field containing the location identifier, if defined for the access type as specified in subclause 7.2A.4, to the PSAP.\nb)\ta PSAP in the PSTN, add the BGCF  to the topmost Route header field, add a PSAP  in tel  format to the Request- with an entry used in the PSTN/CS domain to address the PSAP and set the handling header field parameter value of the Content-Disposition header field associated with the application/pidf+xml message body (if present) to \"optional\";\nNOTE 5:\tIf the user did not request privacy or if national regulator policy applicable to emergency services does not require the user be allowed to request privacy, the E-CSCF conveys the Geolocation header field (if present), the Geolocation-Routing header field (if present), the location information in a PIDF location object (if present) and the P-Access-Network-Info header field containing the location identifier, if defined for the access type as specified in subclause 7.2A.4, towards the MGCF. The MGCF can translate the location information if included in INVITE (i.e. both the geographical location information in PIDF-LO and the location identifier in the P-Access-Network-Info header field) into ISUP signalling, see 3GPP TS 29.163 [11B].\nNOTE 6:\tThe way the E-CSCF determines the next hop address when the PSAP address is a tel  is implementation dependent.\n7)\tvoid;\n8)\tif due to local policy or if the PSAP requires interconnect functionalities (e.g. PSAP address is of an IP address type other than the IP address type used in the IM CN subsystem, or the PSAP URI contains the domain name of another network), put the address of the IBCF to the topmost Route header field, in order to forward the request to the PSAP via an IBCF in the same network;\n9)\tcreate a Record-Route header field containing its own SIP ;\n10)\tif the request is an INVITE request, save the Contact, CSeq and Record-Route header field values received in the request such that the E-CSCF is able to release the session if needed; and\n11)\tif no P-Asserted-Identity header field is present and if required by operator policy governing the indication to PSAPs that a UE does not have sufficient credentials (e.g. determined by national regulatory requirements applicable to emergency services), insert a P-Asserted-Identity header field set to a non-dialable callback number (see /J--036-B [176]);\nNOTE 7:\tA P-Asserted-Identity header field that is present can contain a reference number used in the communication between the PSAP and LRF according to procedures in subclause 5.11.3. Such a P-Asserted-Identity header field would not be replaced with a P-Asserted-Identity header field set to a non-dialable callback number.\n12)\tif required by national regulatory requirements applicable to emergency services, include:\n-\ta  with value \"emergency\"; and optionally\n-\tan OLI set to a value corresponding to the characteristics of the access used when the emergency request was initiated by the UE, i.e., an OLI that corresponds to a wireless access; and\n13)\troute the request based on SIP routeing procedures.\nNOTE 8:\tDepending on local operator policy, the E-CSCF has the capability to reject requests relating to specific methods in accordance with RFC 3261 [26], as an alternative to the functionality described above.\nUpon receipt of an initial request for a dialog, a standalone transaction, or an unknown method, that does not include a Request- with an emergency service URN or an emergency number, the E-CSCF shall reject the request by sending a 403 (Forbidden) response.\nWhen the E-CSCF receives the request containing the access-network-charging-info parameter in the P-Charging-Vector, the E-CSCF shall store the access-network-charging-info parameter from the P-Charging-Vector header field. The E-CSCF shall retain access-network-charging-info parameter in the P-Charging-Vector header field.\nWhen the E-CSCF receives any request or response (excluding ACK requests and CANCEL requests and responses) related to a UE-originated dialog or standalone transaction, the E-CSCF may insert previously saved values into a P-Charging-Function-Addresses header field before forwarding the message.\nWhen the E-CSCF receives any request or response related to a UE-originated dialog or standalone transaction, the E-CSCF may insert previously saved values into a P-Charging-Vector before forwarding the message. If the original request contained a P-Charging-Vector header field including an orig-IOI header field parameter, insert a type 2 \"term-ioi\" header field parameter in the P-Charging-Vector header field of the outgoing response. The type 2 \"term-ioi\" header field is set to a value that identifies the sending network of the response and the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter. Values of \"orig-ioi\" and \"term-ioi\" header field parameters in the received response are removed.\nBased on local policy the E-CSCF shall add an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier to an initial request.\nWhen the E-CSCF receives any 1xx or 2xx response related to a UE-originated dialog or standalone transaction, the E-CSCF shall remove any P-Preferred-Identity header field and P-Asserted-Identity header field, and insert a P-Asserted-Identity header field with the digits that can be recognized as a valid emergency number if dialled as a tel  representing the number, before forwarding the message.\nNOTE 9:\tNumbers that can be recognized as valid emergency numbers if dialled by the user are specified in 3GPP TS 22.101 [1A]. The emergency numbers 112 and 911 are stored on the ME, in accordance with 3GPP TS 22.101 [1A].\nWhen the E-CSCF receives any response related to a UE-originated dialog or standalone transaction containing a \"term-ioi\" header field parameter, the E-CSCF shall store the value of the received \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present, and remove all received \"orig-ioi\" and \"term-ioi\" header field parameters.\nNOTE 10:\tAny received \"term-ioi\" header field parameter will be a type 2 IOI. The IOI identifies the sending network of the response message.\nWhen the E-CSCF receives an INVITE request from the UE, the E-CSCF may require the periodic refreshment of the session to avoid hung states in the E-CSCF. If the E-CSCF requires the session to be refreshed, the E-CSCF shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 11:\tRequesting the session to be refreshed requires support by at least the UE or the PSAP or MGCF. This functionality cannot automatically be granted, i.e. at least one of the involved UAs needs to support it in order to make it work.\nWhen the E-CSCF receives a 2xx response related to a UE-originated dialog and if:\n1)\tthe E-CSCF supports the current location discovery during the emergency call;\n2)\tthe UE indicated a Recv-Info header field with the g.3gpp.current-location-discovery info package name in the dialog of the emergency call; and\n3)\tthe UE indicated an Accept header field indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME type in the dialog of the emergency call;\nthe E-CSCF:\n1)\tshall include an Allow header field indicating support of the PUBLISH method in the SIP 2xx response; and\n2)\tshall include an Allow-Events header field indicating support of the presence event package in the SIP 2xx response;\nbefore forwarding the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.11.3\tUse of an LRF",
                            "text_content": "Where the network operator determines that an LRF is to be used, the E-CSCF shall route initial requests for a dialog and standalone requests that contain an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69], or an emergency number, to the LRF in accordance with the procedures of RFC 3261 [26].\nNOTE 1:\tThe E-CSCF is by definition responsible for emergency service URNs and is therefore allowed to change the Request- of requests containing emergency service URNs when a 3xx or 416 response is received.\nFor the outgoing request, the E-CSCF shall:\n1)\tinsert a type 3 \"orig-ioi\" header field parameter in the P-Charging-Vector header field. The E-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The E-CSCF shall not include the type 3 \"term-ioi\" header field parameter; and\n2)\tperform step 11 of subclause 5.11.2 before sending the INVITE request to the LRF.\nWhen the E-CSCF receives any 3xx response to such a request, the E-CSCF shall select a Contact header field  from the 3xx response according to RFC 3261 [26] and continue processing the steps given in subclause 5.11.2 with the following additions:\na)\tat step 6), if item a) applies, place the  received in the selected Contact header field  in the 3xx response in the topmost entry in the Route header field;\nb)\tat step 6), if item b) applies, replace the original Request- with the  received in the selected Contact header field  in the 3xx response;\nc)\tif the user did not request privacy or if national regulator policy applicable to emergency services does not require the user be allowed to request privacy, then if the selected Contact header field  contains a P-Asserted-Identity header field encoded as a header field of the , replace all P-Asserted-Identity header fields in the original request with this value;\nNOTE 2:\tSuch a P-Asserted-Identity header field contains a reference number which is used in the communication between the PSAP and LRF.\nd)\tif operator local policies allow insertion of UE location information and if the received 3xx response contains a message/external-body MIME type as specified in RFC 4483 [186] with \"access-type\" MIME type parameter containing \"URL\" and \"URL\" MIME type parameter containing an HTTP or HTTPS  identifying a PIDF location object as defined in RFC 4119 [90] and RFC 5491 [267], then the E-CSCF shall insert a Geolocation header field containing this PIDF location object by reference (see RFC 6442 [89]);\ne)\tif the location source parameter for the SIP Geolocation header field as defined in RFC 8787 [266] is supported, include a loc-src parameter in the Geolocation header field set to the domain name of the visited network; and\nf)\tif operator policies allow forming requests from a  and if 3xx response is received, then follow the procedures of RFC 3261 [26] subclause 19.1.5 with the following additions and clarifications:\n-\treplacement or inclusion of any header field from the  in the selected Contact header field is subject to operator policy; and\n-\tif operator policy allows any LRF to provide a location by value, and the  in the selected Contact header field contains the \"Geolocation\" header field, a \"Geolocation-Routing\" header field and a header field with hname \"body\" with a value, replace the entire message body with value of the header field with hname \"body\" in the  in the selected Contact header field, otherwise do not perform this replacement.\nIf no 1xx or 2xx response to the request is received from the addressed PSAP within an operator settable timeout, or a 4xx – 5xx response is received, and additional  values were included in the Contact header field of the response, the E-CSCF shall use these values according to RFC 3261 [26] in new requests that are otherwise generated according to the rules specified above.\nIf no 1xx or 2xx response to the request is received from the addressed PSAP within an operator settable timeout, or a 4xx – 5xx response is received, and all  values included in the Contact header field of the 3xx response have been attempted, the E-CSCF shall use a default  value configured in the E-CSCF in a new request that is otherwise generated according to the rules specified above.\nIf a 6xx response to the request is received, the E-CSCF acts in accordance with RFC 3261 [26].\nWhen the E-CSCF receives any response related to the above request containing a \"term-ioi\" header field parameter, the E-CSCF shall store the value of the received \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present, and remove all received \"orig-ioi\" and \"term-ioi\" header field parameters from the forwarded response.\nNOTE 3:\tAny received \"term-ioi\" header field parameter will be a type 3 IOI. The IOI identifies the sending network of the response message.\nIf no 3xx response to the request is received from the LRF within an operator settable timeout, the E-CSCF shall use a default  value configured in the E-CSCF in a request that is otherwise generated according to the rules specified above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.11.4\tSubscriptions to E-CSCF events",
                            "text_content": "When an incoming SUBSCRIBE request addressed to the E-CSCF arrives containing the Event header field with the dialog event package, the E-CSCF shall:\n1)\tbased on the local policy, check if the request was generated by a subscriber who is authorised to subscribe to the dialog state of this particular user. The authorized subscribers include:\n-\tall the LRFs that belong to the same network operator.\nIf the requester is not authorised, the E-CSCF shall reject the request with an appropriate 4xx – 6xx response;\n2)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n3)\tstore the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present; and\nNOTE:\tAny received \"orig-ioi\" header field parameter will be a type 3 IOI. The type 3 IOI identifies the service provider from which the request was sent.\n4)\tgenerate a 200 (OK) response acknowledging the SUBSCRIBE request and indicating that the authorised subscription was successful as described in RFC 4235 [171]. The E-CSCF shall populate the header fields as follows:\n-\tan Expires header field, set to either the same or a decreased value as the Expires header field in the SUBSCRIBE request; and\n-\ta P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the SUBSCRIBE request, a type 3 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The E-CSCF shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of the \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the received value of the \"icid-value\" header field parameter in the request.\nThe E-CSCF may set the Contact header field to an identifier uniquely associated to the SUBSCRIBE request and generated within the E-CSCF, that may help the E-CSCF to correlate refreshes for the SUBSCRIBE.\nAfterwards the E-CSCF shall perform the procedures for notification about dialog state as described in subclause 5.11.4.2.\nWhen the E-CSCF receives a subscription refresh request for a dialog that was established by the UE subscribing to the dialog event package, the E-CSCF shall accept the request.\nThe E-CSCF shall send a NOTIFY request when an event pertaining to the dialog or dialogs occurs, as specified in RFC 6665 [28].\nWhen generating NOTIFY requests, the E-CSCF shall not preclude any valid dialog event package parameters in accordance with RFC 4235 [171]. Where RFC 4235 [171] expresses an option or only a recommendation as to the generation of a NOTIFY request, it is a matter of operator policy as to whether such requests are generated.\nFor each NOTIFY request triggered by an event and on all dialogs which have been established due to subscription to the dialog event package, and in addition to the requirements specified in RFC 4235 [171], the E-CSCF shall:\n1)\tset the P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17], and a type 3 \"orig-ioi\" header field parameter. The E-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The E-CSCF shall not include the type 3 \"term-ioi\" header field parameter.\n2)\tin the body of the NOTIFY request, include one <dialog> XML element for each dialog to be reported in accordance with the subscription; and\n3)\tfor each <dialog> XML element:\n-\tif the subscription is for all dialogs, rather than a specific dialog, then include the call-id attribute.\nIf the subscription is to a specific dialog (or to a specific set of dialogs), when sending a final NOTIFY request with all dialogs set to a state of \"terminated\", the E-CSCF shall also terminate the subscription to the dialog event package by setting the Subscription-State header field to the value of \"terminated\".\nWhen the E-CSCF receives any response to the NOTIFY request, the E-CSCF shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present.\nNOTE:\tAny received \"term-ioi\" header field parameter will be a type 3 IOI. The type 3 IOI identifies the service provider from which the response was sent.\nWhen an incoming SUBSCRIBE request addressed to the E-CSCF arrives containing the Event header field with the presence event package and a Target-Dialog header field:\n1)\tbased on the local policy, the E-CSCF shall check if the request was generated by a subscriber who is authorised to subscribe to the presence state of this particular user. The authorized subscribers include:\n-\tall the LRFs that belong to the same network operator.\nIf the requester is not authorised, the E-CSCF shall reject the request with an appropriate 4xx – 6xx response;\n2)\tthe E-CSCF shall determine the dialog of the related emergency call, i.e. a confirmed dialog identified by:\na)\tthe call identifier in the callid portion of the Target-Dialog header field; and\nb)\tthe \"remote-tag\" header field parameter of the Target-Dialog header field.\nIf such dialog does not exist, the E-CSCF shall reject the request with an appropriate 4xx – 6xx response;\n3)\tif :\na)\tthe UE did not indicate a Recv-Info header field with the g.3gpp.current-location-discovery info package name in the dialog of the related emergency call; or\nb)\tthe UE did not indicate an Accept header field indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME type in the dialog of the related emergency call;\nthe E-CSCF shall reject the request with an appropriate 4xx – 6xx response;\n4)\tthe E-CSCF shall store the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n5)\tthe E-CSCF shall store the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present; and\nNOTE:\tAny received \"orig-ioi\" header field parameter will be a type 3 IOI. The type 3 IOI identifies the service provider from which the request was sent.\n6)\tthe E-CSCF shall generate a 200 (OK) response acknowledging the SUBSCRIBE request and indicating that the authorised subscription was successful as described in RFC 4235 [171]. The E-CSCF shall populate the header fields as follows:\n-\tan Expires header field, set to either the same or a decreased value as the Expires header field in the SUBSCRIBE request; and\n-\ta P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the SUBSCRIBE request, a type 3 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The E-CSCF shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the sending network of the response, the \"orig-ioi\" header field parameter is set to the previously received value of the \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the received value of the \"icid-value\" header field parameter in the request;\n7)\tthe E-CSCF shall associate the dialog of the 200 (OK) response to the SUBSCRIBE request with the dialog of the related emergency call;\n8)\tif the Expires header field of the SUBSCRIBE request is set to zero, the E-CSCF shall perform the procedure in subclause 5.11.5.2 in the dialog of the related emergency call and shall indicate that the receiving entity is requested to send the location information once; and\n9)\tif the Expires header field of the SUBSCRIBE request is not set to zero, the E-CSCF shall perform the procedure in subclause 5.11.5.2 in the dialog of the related emergency call and shall indicate that the receiving entity is requested to start sending the location information.\nThe E-CSCF may set the Contact header field to an identifier uniquely associated to the SUBSCRIBE request and generated within the E-CSCF, that may help the E-CSCF to correlate refreshes for the SUBSCRIBE.\nAfterwards the E-CSCF shall perform the procedures for notification about presence event as described in subclause 5.11.4.4.\nWhen the E-CSCF receives a subscription refresh request for the subscription associated with the initial SUBSCRIBE request, the E-CSCF shall accept the request.\nWhen the E-CSCF receives an unsubscription request for the subscription associated with the initial SUBSCRIBE request:\n1)\tthe E-CSCF shall accept the request; and\n2)\tif the dialog of the related emergency call still exists, the E-CSCF shall perform the procedure in subclause 5.11.5.2 in the dialog of the related emergency call and shall indicate that the receiving entity is requested to stop sending the location information.\nUpon reception of a PUBLISH request in the dialog of the related emergency call as described in subclause 5.11.5.3, the E-CSCF shall send a NOTIFY request for the presence event package as specified in RFC 6665 [28]. The E-CSCF:\n1)\tif the PUBLISH request contains a body of the \"application/pidf+xml\" MIME type, shall include in the NOTIFY request the body of the \"application/pidf+xml\" MIME type of the PUBLISH request;\n2)\tif the PUBLISH request contains P-Access-Network-Info header field(s), shall include in the NOTIFY request the P-Access-Network-Info header field(s) of the PUBLISH request; and\n3)\tshall set the P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17], and a type 3 \"orig-ioi\" header field parameter in the NOTIFY request. The E-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The E-CSCF shall not include the type 3 \"term-ioi\" header field parameter.\nIf the dialog of the related emergency call is terminated, the E-CSCF shall send a NOTIFY request for the presence event package indicating that the subscription is terminated by setting the Subscription-State header field to the \"terminated\" value. The E-CSCF shall set the P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17], and a type 3 \"orig-ioi\" header field parameter in the NOTIFY request. The E-CSCF shall set the type 3 \"orig-ioi\" header field parameter to a value that identifies the sending network of the request. The E-CSCF shall not include the type 3 \"term-ioi\" header field parameter.\nWhen the E-CSCF receives any response to the NOTIFY request, the E-CSCF shall store the value of the \"term-ioi\" header field parameter received in the P-Charging-Vector header field, if present.\nNOTE:\tAny received \"term-ioi\" header field parameter will be a type 3 IOI. The type 3 IOI identifies the service provider from which the response was sent.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.11.5\tCurrent location discovery during an emergency call",
                            "text_content": "The UE can be requested to provide the current location information during an emergency call.\nIf:\n1)\tthe UE indicated a Recv-Info header field with the g.3gpp.current-location-discovery info package name in the dialog of the emergency call;\n2)\tthe UE indicated an Accept header field indicating the \"application/vnd.3gpp.current-location-discovery+xml\" MIME type in the dialog of the emergency call; and\n3)\tthe dialog of the emergency call is a confirmed dialog;\nthen in order to request providing of the location information, the E-CSCF shall send an INFO request as described in RFC 6086 [25], as an in-dialog request of the dialog of the emergency call towards the UE. In the INFO request:\n1)\tthe E-CSCF shall include an Info-Package header field as described in RFC 6086 [25], containing the g.3gpp.current-location-discovery info package name; and\n2)\tthe E-CSCF shall include an request-for-current-location body as specified in subclause 7.12.2.2 in the MIME body of \"application/vnd.3gpp.current-location-discovery+xml\" MIME type.\nUpon receiving a PUBLISH request as described in RFC 3903 [70] as in-dialog request of the dialog of the emergency call, with Event header field containing the presence event package name, the E-CSCF shall perform the procedures described in subclause 5.11.4.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.12\tLocation Retrieval Function (LRF)",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.12.1\tGeneral",
                            "text_content": "The LRF can receive URIs for a domain for which the operator running the LRF is not responsible. Where RFC 3261 [26] specifies a requirement that the SIP entity has to be responsible for the domain for particular functionality to occur, the LRF may ignore this restriction.\nNOTE:\tThe LRF would normally implement this override if the P-CSCF is configured to pass on URIs (e.g. Request-) that are outside the responsible domain of the LRF, otherwise emergency calls might not be routed to a PSAP. If the P-CSCF does not do this, then the override need not be applied.\nThe LRF shall log all SIP requests and responses that contain a \"logme\" header field parameter in the SIP Session-ID header field if required by local policy.\nWhen sending a failure response to any received request, depending on operator policy, the LRF may insert a Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"lrf\" and optionally an appropriate fe-param part of the URN set in accordance with subclause 7.2.17.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.12.2\tTreatment of incoming initial requests for a dialog and standalone requests",
                            "text_content": "The LRF shall respond to all received initial requests for a dialog, and to all standalone requests, as a redirect server as defined in subclause 8.3 of RFC 3261 [26] with the following additions:\n1)\tthe LRF shall generate a 300 (Multiple Choices) response to all such requests;\n2)\tthe LRF shall set the Contact header field of the response to a list (one or more) address(es) of PSAP(s), selected according to network operator policy;\nNOTE 1:\tThe mechanisms for selection of PSAP addresses are outside the scope of this specification, but can be based on a variety of input information including the value of the URN included in the Request- of the request, the value of the Geolocation header field and Geolocation-Routing header field received in the request, the value of the P-Access-Network-Info header field received in the request, any location known at the LRF for the requesting user as identified by the P-Access-Network-Info header field.\n2A)\tif the location is retrieved using information from the Geolocation header field, and if:\n-\tthe Geolocation-Routing header field is present, and includes a value not allowing routing of the request based on user location information;\n-\tthe Geolocation-Routing header field is present, and includes a value unknown to the LRF; or\n-\tthe Geolocation-Routing header field is not present;\nthe LRF shall not use the location retrieved from the Geolocation header field when selecting PSAP(s);\n3)\tthe LRF shall insert a P-Charging-Vector header field containing the \"orig-ioi\" header field parameter, if received in the request, a type 3 \"term-ioi\" header field parameter and the \"icid-value\" header field parameter. The LRF shall set the type 3 \"term-ioi\" header field parameter to a value that identifies the service provider from which the response is sent, the \"orig-ioi\" header field parameter is set to the previously received value of \"orig-ioi\" header field parameter and the \"icid-value\" header field parameter is set to the previously received value of \"icid-value\" header field parameter in the request;\n4)\toptionally, generate a reference identifier and set the P-Asserted-Identity header field encoded as a header field of the  in the Contact header field to this value in each included Contact header field  associated with a PSAP. The LRF shall maintain state for any generated reference identifier. If the LRF uses a SIP  (or any other permitted  scheme other than tel ) as the reference identifier, the LRF has the responsibility of ensuring (e.g. by configuration) that the emergency request is being routed to an IP connected PSAP. Subclause 5.12.3.1 defines a means of maintaining the state of the reference identifier. If required by operator policy governing the indication to PSAPs that a UE does not have sufficient credentials (e.g. determined by national regulatory requirements applicable to emergency services), the reference identifier shall not be equal to a non-dialable callback number used to indicate the UE does not have credentials;\nNOTE 2:\tThe reference identifier is used to correlate information requested over the Le interface (see 3GPP TS 23.167 [4B]) and is not needed if the Le interface is not used. The protocol at the Le interface is not defined in this release.\nNOTE 3:\tThe reference identifier is managed by the RDF or the LRF. If the RDF manages the reference identifier, the LRF obtains the a reference identifier from the RDF. In some regional systems, this reference identifier is the ESQK.\n5)\tif required by operator local policies, the LRF shall include a message/external-body MIME type as specified in RFC 4483 [186] with:\na)\t\"access-type\" MIME type parameter containing \"URL\"; and\nb)\t\"URL\" MIME type parameter containing an HTTP or HTTPS  identifying a PIDF location object as defined in RFC 4119 [90] and RFC 5491 [267]; and\n6)\tif required by operator local policies, the LRF shall include geographical information, encoded as header fields of the  in a Contact header field of the 300 (Multiple Choices) response, in the following way:\na)\tif operator policy indicates location-by-reference is to be used:\ni.\ta Geolocation-Routing header field with value \"yes\"; and\nii.\ta Geolocation header field that contains an HTTP  or a HTTPS  associated with a location-by-reference, as defined in RFC 6442 [89]; and\nb)\tif operator policy indicates location-by-value is to be used:\ni.\ta Geolocation-Routing header field with value \"yes\";\nii.\tGeolocation header field with value associated with the location-by-value;\niii.\ta header field with hname \"body\" and with a value that contains an escape encoded MIME body of multipart/mixed MIME type containing:\n-\tthe MIME body from the received request; and\n-\tthe geographical location information as PIDF location object in accordance with RFC 4119 [90] and RFC 5491 [267]; and\niv.\ta Content-Type header field with multipart/mixed MIME type.\nNOTE 4:\tThe mechanisms for selection of PSAP addresses are outside the scope of this specification. See note 1.\nNOTE 5:\tThe body of the received request can include a PIDF location object and SDP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.12.3\tSubscription and notification",
                            "text_content": "Based on operator policy, the LRF can either subscribe to all dialog information on an E-CSCF or individually subscribe to each dialog as it receives the requests.\nNOTE 1:\tSubscription to dialog information is dependent on the use of Le interface as described in subclause 5.12.2.\nIn the case that the LRF is subscribing to all dialogs at the E-CSCF, the LRF shall generate a SUBSCRIBE request to the dialog state event package in accordance with RFC 6665 [28] and RFC 4235 [171]. The LRF shall include the following additional information in the SUBSCRIBE request:\na)\tthe Request- set to an E-CSCF address;\nNOTE 2:\tIn this case, it is expected that the LRF will be configured with a set of E-CSCF addresses, and the LRF will subscribe to all of them.\nb)\tno header field parameters in the Event header field;\nc)\tan Expires header field set to 600 000 seconds; and\nd)\ta P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 3 \"orig-ioi\" header field parameter. The type 3 \"orig-ioi\" header field parameter identifies the service provider from which the request is sent. The LRF shall not include the type 3 \"term-ioi\" header field parameter.\nUpon generation of a 300 response to an incoming dialog forming request that contains a reference identifier, and in the case that the LRF is subscribing to individual dialogs at the E-CSCF, the LRF shall generate a SUBSCRIBE request to the dialog state event package in accordance with RFC 6665 [28] and RFC 4235 [171]. The LRF shall include the following additional information in the SUBSCRIBE request:\na)\tthe Request- set to the value of the P-Asserted-Identity in the original request to which the response was generated;\nb)\ta Route header field that addresses the request to the E-CSCF. How such a value is determined depends on deployment;\nNOTE 3:\tA number of mechanisms exist for identifying the required E-CSCF, however all suffer some restrictions. It is therefore a matter of configuration at deployment time to identify the solution that works for that particular deployment. Mechanisms that exist include:\ni)\tif there is only one E-CSCF in the network, using the address of that E-CSCF preconfigured into the system;\nii)\tusing the last entry in the Via header field of the original request to which the 3xx response was generated. If the deployment however includes some intermediate SIP proxy or B2BUA not otherwise included in the emergency call architecture this will not provide the desired result; or\niii)\tusing the IP address from which the original request was received to which the 3xx response was generated. The request is sent to the same port number and IP address as the 3xx response was generated. If the deployment however includes some intermediate SIP proxy or B2BUA not otherwise included in the emergency call architecture this will not provide the desired result, and additionally, if the system is set up to use port numbers in a unidirectional manner, i.e. one port number for requests and another port number for responses, it will also not operate correctly.\nc)\tthe \"call-id\" and \"to-tag\" header field parameters in the Event header field set to the values in the original request to which the 3xx response was generated. No \"from-tag\" header field parameter can be included as it is not known by the LRF;\nd)\tan Expires header field set to 86400 seconds; and\ne)\ta P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 3 \"orig-ioi\" header field parameter. The type 3 \"orig-ioi\" header field parameter identifies the service provider from which the request is sent. The LRF shall not include the type 3 \"term-ioi\" header field parameter.\nIn the case that the LRF is subscribing to individual dialogs at the E-CSCF, and a NOTIFY request is received indicating a state of \"terminated\", the LRF shall end the subscription to the dialog event package.\nNOTE 4:\tSuch NOTIFY requests will normally be accompanied by the Subscription-State header field set to the value of \"terminated\".\nWhen, as a result of successful subscription to the dialog event package, the LRF receives a notification containing dialog updates, the LRF shall update its record for each dialog included in the event package information.\nBased on operator policy, the LRF can subscribe to UE location as it receives the requests.\nUpon generation of a 300 response to an incoming dialog forming request that contains a reference identifier, the LRF shall generate a SUBSCRIBE request to the presence event package in accordance with RFC 6665 [28] and RFC 3856 [74]. The LRF shall include the following additional information in the SUBSCRIBE request:\na)\tthe Request- set to an E-CSCF address;\nb)\ta Target-Dialog header field with the callid portion and the \"remote-tag\" header field parameter set to the values in the original request to which the 3xx response was generated. No \"local-tag\" header field parameter can be included as it is not known by the LRF;\nc)\tan Expires header field set to 86400 seconds or to 0 seconds; and\nd)\ta P-Charging-Vector header field with the \"icid-value\" header field parameter populated as specified in 3GPP TS 32.260 [17] and a type 3 \"orig-ioi\" header field parameter. The type 3 \"orig-ioi\" header field parameter identifies the service provider from which the request is sent. The LRF shall not include the type 3 \"term-ioi\" header field parameter.\nWhen, as a result of successful subscription to the presence event package, the LRF receives a notification containing the UE location, the LRF shall update its record for the dialog indicated in the Target-Dialog header field of the SUBSCRIBE request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.13\tISC gateway function",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.13.1\tGeneral",
                            "text_content": "As specified in 3GPP TS 23.218 [5] border control functions may be applied between the IM CN subsystem and an application server based on operator preference. The ISC gateway function may act both as an entry point and as an exit point for a network. If it processes a SIP request received from another network it functions as an entry point (see subclause 5.13.3) and it acts as an exit point whenever it processes a SIP request sent to other network (see subclause 5.13.2).\nIn many cases, the ISC interface carries more than one hop of the session, e.g. the application server has applied a service to a SIP request and then returned the SIP request to the S-CSCF, or a AS acting as a third-party call controller generates multiple outgoing legs. In these cases all the requests relating to the session on all hops / legs should be configured to route through the same ISC gateway function.\nNOTE 1:\tThis is to provide for future requirements for the ISC gateway function that may need to provide correlation of the SIP transactions, and additional functionality based on that correlation.\nThis ISC gateway function exists on a one to one basis with its addressed AS, i.e. the  used to address the ISC gateway function will always reach the same AS beyond the ISC gateway function.\nThe functionalities of the ISC gateway function are entry and exit point procedures as defined in subclause 5.13.2 and subclause 5.13.3 and additionally can include:\n-\tnetwork configuration hiding (as defined in subclause 5.13.4);\n-\tapplication level gateway (as defined in subclause 5.13.5);\n-\ttransport plane control, i.e. QoS control (as defined in subclause 5.13.5); and\n-\tscreening of SIP signalling (as defined in subclause 5.13.6);\nNOTE 2:\tThe functionalities performed by the application level gateway are configured by the operator, and it is network specific.\nThe application level gateway shall log all SIP requests and responses that contain a \"logme\" header field parameter in the SIP Session-ID header field based on local policy.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.13.2\tISC gateway function as an exit point",
                            "text_content": "There are no specific requirements for the REGISTER method, i.e. the REGISTER method is treated as for other SIP methods.\nThis subclause applies for requests sent from the S-CSCF to the AS via the ISC gateway function.\nFor all SIP transactions identified:\n-\tif priority is supported, as containing an authorised Resource-Priority header field or a temporarily authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field, the ISC gateway function shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the ISC gateway function shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nUpon receipt of:\n-\tan initial request for a dialog;\n-\ta request for a standalone transaction; or\n-\ta request for an unknown method that does not relate to an existing dialog;\nthe ISC gateway function shall:\n1)\tif the request is an INVITE request, respond with a 100 (Trying) provisional response;\n2)\tremove the topmost entry from the Route header field in accordance with RFC 3261 [26] procedures for processing Route header fields, and then add as the topmost entry the  of the application server associated with this ISC gateway function, followed by a next entry of a  needed to reach this ISC gateway function from the application server;\n3)\tif the request is an INVITE request and the ISC gateway function is configured to perform application level gateway and/or transport plane control functionalities, save the Contact, CSeq and Record-Route header field values received in the request such that the ISC gateway function is able to release the session if needed;\n4)\tIf the request is a SUBSCRIBE and the ISC gateway function does not need to act as B2BUA, based on operator policy, the ISC gateway function shall determine whether or not to retain, for the related subscription, the SIP dialog state information and the duration information;\nNOTE 1:\tThe event package name can be taken into account to decide whether or not the SIP dialog state and the subscription duration information needs to be retained.\nNOTE 2:\tThe ISC gateway function needs to insert its own  in the Record-Route header field of the initial SUBSCRIBE request and all subsequent NOTIFY requests if it decides to retain the SIP dialog state information.\n5)\tif the request is an initial request for a dialog and local policy requires the application of ISC gateway function capabilities in subsequent requests, perform record route procedures as specified in RFC 3261 [26];\n6)\tif the recipient of the request is understood from configured information to always send and receive private network traffic from this source, remove the P-Private-Network-Indication header field containing the domain name associated with that saved information;\n7)\tstore the values from the P-Charging-Function-Addresses header field, if present;\n8)\tif the request is an initial request and \"fe-identifier\" header field parameter of P-Charging-Vector header field is applied in the operator domain;\n-\tstore the \"fe-identifier\" header field parameter of the P-Charging-Vector header field; and\n-\tremove the \"fe-identifier\" header field parameter from the P-Charging-Vector header field;\n9)\tremove some of the parameters from the P-Charging-Vector header field or the header field itself, depending on operator policy, if present; and\nNOTE 3:\tAn example where an ISC-GW removes the P-Charging-Vector header field is where the request is forwarded to outside the trust domain.\n10)\tremove the P-Charging-Function-Addresses header fields, if present, prior to forwarding the message;\nand forwards the request according to RFC 3261 [26].\nNOTE 4:\tIf ISC gateway function processes a request without a pre-defined route (e.g. the subscription to reg event package originated by the AS), the next-hop address can be either obtained as specified in RFC 3263 [27A] or be provisioned in the ISC gateway function.\nWhen the ISC gateway function receives an INVITE request, the ISC gateway function may require the periodic refreshment of the session to avoid hung states in the ISC gateway function. If the ISC gateway function requires the session to be refreshed, the ISC gateway function shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 5:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nWhen the ISC gateway function receives a response to any of the requests handled in this subclause, then the ISC gateway function shall:\n1)\tin the P-Charging-Vector header field, subject to operator policy, reinsert any parameters that were removed and stored. In addition, where the operator policy requires it, include on behalf of the supported application server a type 3 \"term-ioi\" header field parameter. This IOI may represent either the network of the ISC gateway function or the network providing the AS.\nIn responses, if \"fe-identifier\" header field parameter of P-Charging-Vector header field is applied in the operator domain, the ISC gateway function acting as an exit point shall:\n-\tdelete in the P-Charging-Vector header field any received \"fe-identifier\" header field parameter; and\n-\tadd the stored\"fe-identifier\" to the P-Charging-Vector header field and include its own address or identifier as an \"fe-addr\" element of the \"fe-identifier\" header field parameter of the P-Charging-Vector header.\nWith the exception of 305 (Use Proxy) responses, the ISC gateway function shall not recurse on 3xx responses.\nUpon receipt of a subsequent request, the ISC gateway function shall:\n1)\tif the request is an INVITE request, respond with a 100 (Trying) provisional response;\n2)\tif the request is a NOTIFY request with the Subscription-State header field set to \"terminated\" and the ISC gateway function has retained the SIP dialog state information for the associated subscription, once the NOTIFY transaction is terminated, the ISC gateway function can remove all the stored information related to the associated subscription;\n3)\tif the request is a target refresh request and the ISC gateway function is configured to perform application level gateway and/or transport plane control functionalities, save the Contact and CSeq header field values received in the request such that the ISC gateway function is able to release the session if needed; and\n4)\tif the subsequent request is other than a target refresh request (including requests relating to an existing dialog where the method is unknown) and the ISC gateway function is configured to perform application level gateway and/or transport plane control functionalities, save the Contact and CSeq header field values received in the request such that the ISC gateway function is able to release the session if needed;\nand forwards the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26].\nIf the ISC gateway function provides transport plane control functionality and receives an indication of a transport plane related error the ISC gateway function may:\n1)\tgenerate a BYE request for the terminating side based on information saved for the related dialog; and\n2)\tgenerate a BYE request for the originating side based on the information saved for the related dialog.\nNOTE:\tTransport plane related errors can be indicated from e.g. TrGW. The protocol for indicating transport plane related errors to the ISC gateway function is out of scope of this specification.\nUpon receipt of the 2xx responses for both BYE requests, the ISC gateway function shall release all information related to the dialog and the related multimedia session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.13.3\tISC gateway function as an entry point",
                            "text_content": "There are no specific requirements for the REGISTER method, i.e. the REGISTER method is treated as for other SIP methods.\nThis subclause applies for requests sent from the AS to the S-CSCF via the ISC gateway function. Such requests come from the AS as a result of a request received from the S-CSCF and forwarded by the ISC gateway function.\nFor all SIP transactions identified:\n-\tif priority is supported (NOTE), as containing an authorised Resource-Priority header field or a temporarily authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field, the ISC gateway function shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the ISC gateway function shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nUpon receipt of:\n-\tan initial request for a dialog;\n-\ta request for a standalone transaction; or\n-\ta request for an unknown method that does not relate to an existing dialog;\nthe ISC gateway function shall verify whether the request is arrived from a trusted domain or not. If the request arrived from an untrusted domain, then the ISC gateway function shall:\n-\tremove all P-Charging-Vector header fields and all P-Charging-Function-Addresses header fields the request may contain.\nUpon receipt of:\n-\tan initial request for a dialog;\n-\ta request for a standalone transaction except the REGISTER request; or\n-\ta request for an unknown method that does not relate to an existing dialog;\nthe ISC gateway function shall:\n1)\tif the request is an INVITE request, respond with a 100 (Trying) provisional response;\n2)\tremove the topmost entry from the Route header field in accordance with RFC 3261 [26] procedures for processing Route header fields;\n3)\tif a P-Private-Network-Indication header field is included in the request, check whether the configured information allows the receipt of private network traffic from this source. If private network traffic is allowed, the ISC gateway function shall check whether the received domain name in any included P-Private-Network-Indication header field in the request is the same as the domain name associated with that configured information. If private network traffic is not allowed, or the received domain name does not match, then the ISC gateway function shall remove the P-Private-Network-Indication header field;\n4)\tif the initiator of the request is understood from configured information to always send and receive private network traffic from this source, insert a P-Private-Network-Indication header field containing the domain name associated with that configured information;\n5)\tif the request is an INVITE request and the ISC gateway function is configured to perform application level gateway and/or transport plane control functionalities, then the ISC gateway function shall save the Contact, CSeq and Record-Route header field values received in the request such that the ISC gateway function is able to release the session if needed;\n6)\tIf the request is a SUBSCRIBE and the ISC gateway function does not need to act as B2BUA, based on operator policy, the ISC gateway function shall determine whether or not to retain, for the related subscription, the SIP dialog state information and the duration information; and\nNOTE 1:\tThe event package name can be taken into account to decide whether or not the SIP dialog state and the subscription duration information needs to be retained.\nNOTE 2:\tThe ISC gateway function needs to insert its own  in the Record-Route header field of the initial SUBSCRIBE request and all subsequent NOTIFY requests if it decides to retain the SIP dialog state information.\n7)\tif the request is an initial request for a dialog and local policy requires the application of ISC gateway function capabilities in subsequent requests, perform record route procedures as specified in RFC 3261 [26];\nWhen the ISC gateway function receives an INVITE request, the ISC gateway function may require the periodic refreshment of the session to avoid hung states in the ISC gateway function. If the ISC gateway function requires the session to be refreshed, the ISC gateway function shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 3:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nWhen receiving an initial request and \"fe-identifier\" header field parameter of P-Charging-Vector header field is applied in the operator domain, the ISC gateway function acting as an entry point shall:\n-\tadd an \"fe-addr\" element of the \"fe-identifier\" header field parameter to the P-Charging-Vector header field with its own address or identifier; and\n-\tdelete in the P-Charging-Vector header field any received \"fe-identifier\" header field parameter.\nWhen the ISC gateway function receives a response to an initial request (e.g. 183 or 2xx), the ISC gateway function shall:\n1)\tstore the values from the P-Charging-Function-Addresses header field, if present;\n2)\tremove the \"fe-identifier\" header field parameter from the P-Charging-Vector header field, if present; and\n3)\tremove the P-Charging-Function-Addresses header field prior to forwarding the message.\nWith the exception of 305 (Use Proxy) responses, the ISC gateway function shall not recurse on 3xx responses.\nUpon receipt of a subsequent request, the ISC gateway function shall:\n1)\tif the request is an INVITE request, then respond with a 100 (Trying) provisional response;\n2)\tif the request is a NOTIFY request with the Subscription-State header field set to \"terminated\" and the ISC gateway function has retained the SIP dialog state information for the associated subscription, once the NOTIFY transaction is terminated, the ISC gateway function can remove all the stored information related to the associated subscription;\n3)\tif the request is a target refresh request and the ISC gateway function is configured to perform application level gateway and/or transport plane control functionalities, then the ISC gateway function shall save the Contact and CSeq header field values received in the request such that the ISC gateway function is able to release the session if needed;\n4)\tif the subsequent request is other than a target refresh request (including requests relating to an existing dialog where the method is unknown) and the ISC gateway function is configured to perform application level gateway and/or transport plane control functionalities, then the ISC gateway function shall save the Contact and CSeq header field values received in the request such that the ISC gateway function is able to release the session if needed; and\n5)\tif the subsequent request is received from outside the trust domain, then the ISC gateway function shall remove a P-Charging-Vector header field, if present;\nand forwards the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26].\nIf the ISC gateway function provides transport plane control functionality and receives an indication of a transport plane related error the ISC gateway function may:\n1)\tgenerate a BYE request for the terminating side based on information saved for the related dialog; and\n2)\tgenerate a BYE request for the originating side based on the information saved for the related dialog.\nNOTE:\tTransport plane related errors can be indicated from e.g. TrGW. The protocol for indicating transport plane related errors to the ISC gateway function is out of scope of this specification.\nUpon receipt of the 2xx responses for both BYE requests, the ISC gateway function shall release all information related to the dialog and the related multimedia session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.13.4\tTHIG functionality in the ISC gateway function",
                            "text_content": "The ISC gateway function shall act according to the procedures defined for the IBCF in subclause 5.10.4 with the following exceptions:\n-\tthere are no specific requirements for the REGISTER method, i.e. the REGISTER method is treated as for other SIP methods.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.13.5\tIMS- functionality in the ISC gateway function",
                            "text_content": "The ISC gateway function shall act according to the procedures defined for the IBCF in subclause 5.10.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.13.6\tScreening of SIP signalling",
                            "text_content": "The ISC gateway function shall act according to the procedures defined for the IBCF in subclause 5.10.6.\nNOTE 1:\tSubclause 5.10.6 identifies a number of header fields that should not be screened. It is not expected that the ISC gateway function will see these header fields.\nNOTE 2:\tIn identifying header fields to be screened, care is needed to ensure that header fields needed by application servers later in the filter criteria chain are not removed. The ordering of the applications in the filter criteria chain might be reordered if this is a constraint that cannot be met.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tApplication usage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tGeneral",
                            "text_content": "The \"integration of resource management and SIP\" extension is hereafter in this subclause referred to as \"the precondition mechanism\" and is defined in RFC 3312 [30] as updated by RFC 4032 [64].\nIn order to authorize the media streams, the P-CSCF and S-CSCF have to be able to inspect SDP message bodies. Hence, the UE shall not encrypt SDP message bodies.\nDuring the session establishment procedure, and during session modification procedures, SIP messages shall only contain an SDP message body if that is intended to modify the session description, or when the SDP message body is included in the message because of SIP rules described in RFC 3261 [26].\nNOTE 1:\tA codec can have multiple payload type numbers associated with it.\nIn order to support accurate bandwidth calculations, the UE may include the \"a=ptime\" attribute for all \"audio\" media lines as described in RFC 4566 [39]. If a UE receives an \"audio\" media line with \"a=ptime\" specified, the UE should transmit at the specified packetization rate. If a UE receives an \"audio\" media line which does not have \"a=ptime\" specified or the UE does not support the \"a=ptime\" attribute, the UE should transmit at the default codec packetization rate as defined in RFC 3551 [55A]. The UE will transmit consistent with the resources available from the network.\nFor \"video\" and \"audio\" media types that use the /RTCP and where the port number is not zero, the UE shall specify the proposed bandwidth for each media stream using the \"b=\" media descriptor and the \"AS\" bandwidth modifier in the SDP.\nNOTE 2:\tThe above is the minimum requirement for all UEs. Additional requirements can be found in other specifications.\nFor \"video\" and \"audio\" media types that use the /RTCP and where the port number is not zero, the UE may include for each RTP payload type \"a=bw-info\" SDP attribute(s) (defined in clause 19 of 3GPP TS 26.114 [9B]) to indicate the additional bandwidth information. The \"a=bw-info\" SDP attribute line(s) shall be specified in accordance with 3GPP TS 26.114 [9B]. The value of the \"a=bw-info\" SDP attribute(s) may affect the assigned QoS which is defined in 3GPP TS 29.213 [13C].\nFor \"video\" and \"audio\" media types that utilize the /RTCP, in addition to the \"b=AS\" parameter, the UE may specify the \"b=TIAS\", and \"a=maxprate\" parameters in accordance with RFC 3890 [152]. The value of the parameter shall be determined as described in RFC 3890 [152]. The value or absence of the \"b=\" parameter(s) may affect the assigned QoS which is defined in 3GPP TS 29.213 [13C].\nIf a UE receives a media line which contains both a=ptime and a=maxprate, the UE should use the a=maxprate value, if this attribute is supported.\nIf multiple codecs are specified on the media line, \"a=maxprate\" (or \"a=ptime\" if \"a=maxprate\" is not available or not supported) should be used to derive the packetization time used for all codecs specified on the media line. Given that not all codecs support identical ranges of packetization, the UE should ensure that the packetization derived by \"a=maxprate\" (or \"a=ptime\" if \"a=maxprate\" is not available or not supported) is a valid packetization time for each codec specified in the list.\nIf the media line in the SDP message body indicates the usage of /RTCP, and if the UE is configured to request an RTCP bandwidth level for the session is different than the default RTCP bandwidth as specified in RFC 3556 [56], then in addition to the \"AS\" bandwidth modifier in the media-level \"b=\" line, the UE shall include two media-level \"b=\" lines, one with the \"RS\" bandwidth modifier and the other with the \"RR\" bandwidth modifier as described in RFC 3556 [56] to specify the required bandwidth allocation for RTCP. The bandwidth-value in the b=RS: and b=RR: lines may include transport overhead as described in subclause 6.1 of RFC 3890 [152].\nFor other media streams the \"b=\" media descriptor may be included. The value or absence of the \"b=\" parameter will affect the assigned QoS which is defined in or 3GPP 29.213 [13C].\nNOTE 3:\tIn a two-party session where both participants are active, the RTCP receiver reports are not sent, therefore, the RR bandwidth modifier will typically get the value of zero.\nIf an in-band DTMF codec is supported by the application associated with an audio media stream, then the UE shall include, in addition to the payload type numbers associated with the audio codecs for the media stream, for each clock rate associated with the audio codecs for the media stream, a payload type number associated with the MIME subtype \"telephone-event\", to indicate support of in-band DTMF as described in RFC 4733 [23].\nThe UE shall inspect the SDP message body contained in any SIP request or response, looking for possible indications of grouping of media streams according to RFC 3524 [54] and perform the appropriate actions for IP-CAN bearer establishment for media according to IP-CAN specific procedures (see subclause B.2.2.5 for IP-CAN implemented using GPRS, subclause L.2.2.5 for IP-CAN implemented using EPS, and subclause U.2.2.5 for IP-CAN implemented using 5GS).\nIn case of UE initiated resource reservation and if the UE determines resource reservation is needed, the UE shall start reserving its local resources whenever it has sufficient information about the media streams, media authorization and used codecs available.\nNOTE 4:\tBased on this resource reservation can, in certain cases, be initiated immediately after the sending or receiving of the initial SDP offer.\nIn order to fulfil the QoS requirements of one or more media streams, the UE may re-use previously reserved resources. In this case the UE shall indicate as met the local preconditions related to the media stream, for which resources are re-used.\nIf the SDP is affected due to a rejected IP-CAN bearer or a released IP-CAN bearer then the UE shall:\n1)\tupdate the session according to RFC 3264 [27B] and set the ports of the media stream(s) for which IP-CAN resource was rejected or released to zero in the new SDP offer;\n2)\trelease the session according to RFC 3261 [26];\n3)\tcancel the session setup or the session modification according to RFC 3261 [26]; or\n4)\treject the session setup or the session modification according to RFC 3261 [26].\nIf the SDP is affected due to a modified IP-CAN bearer, and the desired QoS resources for one or more media streams are no longer available at the UE due to the modification, then the UE shall:\n1)\tupdate the session according to RFC 3264 [27B] and set the ports of the media stream(s) for which IP-CAN resource was modified to zero in the new SDP offer;\n2)\trelease the session according to RFC 3261 [26];\n3)\tcancel the session setup or the session modification according to RFC 3261 [26]; or\n4)\treject the session setup or the session modification according to RFC 3261 [26].\nNOTE 5:\tThe UE can use one IP address for signalling (and specify it in the Contact header field) and different IP address(es) for media (and specify it in the \"c=\" parameter of the SDP).\nIf the UE wants to transport media streams with  and there are no specific alternative negotiation mechanisms defined for that particular application, then the UE shall support the procedures and the SDP rules specified in RFC 4145 [83].\nThe UE may support being configured with a media type restriction policy using one or more of the following methods:\na)\tthe Media_type_restriction_policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Media_type_restriction_policy node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Media_type_restriction_policy node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the Media_type_restriction_policy node of 3GPP TS 24.167 [8G] and the Media_type_restriction_policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B, then the Media_type_restriction_policy node of the EFIMSConfigData file shall take precedence.\nNOTE 6:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nIf the UE supports being configured with a media type restriction policy, the UE shall not include in a sent SDP message (SDP offer or SDP answer) a media stream with:\n-\tnon zero port number; and\n-\ta media type which is restricted from inclusion in an SDP message according to the media type restriction policy.\nNOTE 7:\t488 (Not Acceptable Here) response is sent when all media types of all media streams of an SDP offer are restricted from inclusion in an SDP message according to the media type restriction policy.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.2\tHandling of SDP at the originating UE",
                            "text_content": "An INVITE request generated by a UE shall contain a SDP offer and at least one media description. This SDP offer shall reflect the calling user's terminal capabilities and user preferences for the session.\nIf the desired QoS resources for one or more media streams have not been reserved at the UE when constructing the SDP offer, the UE:\n-\tshall indicate the related local preconditions for QoS as not met, using the segmented status type, as defined in RFC 3312 [30] and RFC 4032 [64], as well as the strength-tag value \"mandatory\" for the local segment and the strength-tag value either \"optional\" or as specified in RFC 3312 [30] and RFC 4032 [64] for the remote segment, if the UE uses the precondition mechanism (see subclause 5.1.3.1); and\n-\tif the UE uses the precondition mechanism (see subclause 5.1.3.1), shall not request confirmation for the result of the resource reservation (as defined in RFC 3312 [30]) at the terminating UE.\nNOTE 1:\tPrevious versions of this document mandated the use of the SDP inactive attribute. This document does not prohibit specific services from using direction attributes to implement their service-specific behaviours.\nIf the UE uses the precondition mechanism (see subclause 5.1.3.1), and the desired QoS resources for one or more media streams are available at the UE when the SDP offer is sent, the UE shall indicate the related local preconditions as met, using the segmented status type, as defined in RFC 3312 [30] and RFC 4032 [64], as well as the strength-tag value \"mandatory\" for the local segment and the strength-tag value either \"optional\" or as specified in RFC 3312 [30] and RFC 4032 [64] for the remote segment and shall not request confirmation for the result of the resource reservation (as defined in RFC 3312 [30]) at the terminating UE.\nNOTE 2:\tIf the originating UE does not use the precondition mechanism (see subclause 5.1.3.1), it will not include any precondition information in the SDP message body.\nIf the UE indicated support for end-to-access-edge media security using SDES during registration, and the P-CSCF indicated support for end-to-access-edge media security using SDES during registration, then upon generating an SDP offer with an  based media, for each  based media except those for which the UE requests an end-to-end media security mechanism, the UE shall:\n-\toffer SRTP transport protocol according to RFC 3711 [169] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP crypto attribute according to RFC 4568 [168] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude an SDP \"a=3ge2ae:requested\" attribute.\nIf the UE indicated support for the end-to-access-edge media security for RTP media using DTLS-SRTP and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for RTP media using DTLS-SRTP and certificate fingerprints during registration, then upon generating an SDP offer with an RTP based media, for each RTP based media except those for which the UE requests an end-to-end media security mechanism, the UE shall:\n-\toffer \"UDP/TLS/RTP/SAVP\" or \"UDP/TLS/RTP/SAVPF\" as the transport protocol according to RFC 5763 [222] and RFC 5764 [223] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP \"a=3ge2ae:requested\" attribute; and\n-\tinclude the SDP tls-id attribute according to RFC 8842 [240].\nIf the UE indicated support for the end-to-access-edge media security for MSRP using  and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for MSRP using  and certificate fingerprints during registration, then upon generating an SDP offer with an MSRP based media, for each MSRP based media except those for which the UE requests an end-to-end security mechanism, the UE shall:\n-\toffer MSRP over  transport protocol according to RFC 4975 [178], RFC 6714 [214] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude the SDP \"a=3ge2ae:requested\" attribute.\nNOTE 3:\t client role and  server role are determined according to RFC 6135 [215] (referenced by RFC 6714 [214]). If the SDP answer contains the SDP setup attribute with \"active\" attribute value, the answerer performs the  client role. If the SDP answer contains the SDP setup attribute with \"passive\" attribute value, the offerer performs the  client role.\nIf the UE indicated support for the end-to-access-edge media security for BFCP using  and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for BFCP using  and certificate fingerprints during registration, then upon generating an SDP offer with an BFCP based media, for each BFCP based media except those for which the UE requests an end-to-end security mechanism, the UE shall:\n-\toffer BFCP over  transport protocol according to RFC 4583 [108] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude the SDP \"a=3ge2ae:requested\" attribute.\nUnless a new  session is negotiated, subsequent SDP offers and answers shall not impact the previously negotiated  roles.\nNOTE 4:\tRFC 4583 [108] specifies that the SDP answerer will act as the  server but leaves the impact of SDP renegotiation on  unspecified.\nIf the UE indicated support for the end-to-access-edge media security for UDPTL using DTLS and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for UDPTL using DTLS and certificate fingerprints during registration, then upon generating an SDP offer with an UDPTL based media, for each UDPTL based media except those for which the UE requests an end-to-end security mechanism, the UE shall:\n-\toffer UDPTL over DTLS transport protocol according to RFC 7345 [217], RFC 8842 [240] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP \"a=3ge2ae:requested\" attribute; and\n-\tinclude the SDP tls-id attribute according to RFC 8842 [240].\nIf the P-CSCF did not indicate support for end-to-access-edge media security using neither DTLS-SRTP nor SDES during registration, the UE shall not include an SDP \"a=3ge2ae:requested\" attribute in any  based media in any SDP offer.\nIf the P-CSCF did not indicate support for the end-to-access-edge media security for MSRP using  and certificate fingerprints during registration, the UE shall not include an SDP \"a=3ge2ae:requested\" attribute in any MSRP based media in any SDP offer.\nIf the P-CSCF did not indicate support for the end-to-access-edge media security for BFCP using  and certificate fingerprints during registration, the UE shall not include an SDP \"a=3ge2ae:requested\" attribute in any BFCP based media in any SDP offer.\nIf the P-CSCF did not indicate support for the end-to-access-edge media security for UDPTL using DTLS and certificate fingerprints during registration, the UE shall not include an SDP \"a=3ge2ae:requested\" attribute in any UDPTL based media in any SDP offer.\nThe UE shall not include an SDP \"a=3ge2ae:requested\" attribute in any media other than  based, MSRP based, BFCP based and UDPTL based in any SDP offer.\nUpon generating an SDP offer with an MSRP based media protected by the end-to-end media security for MSRP using  and KMS, the UE shall:\n-\toffer MSRP over  transport protocol according to RFC 4975 [178], RFC 6714 [214] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude the SDP key-mgmt attribute according to RFC 4567 [167] and the profile defined in 3GPP TS 33.328 [19C];\nNOTE 5:\tSDP fingerprint attribute is not included.\nUpon receiving an SDP answer to the SDP offer with the MSRP based media protected by the end-to-end media security for MSRP using  and KMS, and if the MSRP based media is accepted and associated with the SDP key-mgmt attribute as described in RFC 4567 [167] and the profile defined in 3GPP TS 33.328 [19C] in the SDP answer, then the UE indicate the pre-shared key ciphersuites according to RFC 4279 [218] and the profile defined in 3GPP TS 33.328 [19C] in  handshake of  connection transporting the MSRP based media.\nWhen the UE detects that an emergency call is being made, the UE shall not include end-to-end media security on any media in the SDP offer.\nUpon generating the SDP offer for an INVITE request generated after receiving a 488 (Not Acceptable Here) response, as described in subclause 5.1.3.1, the SDP offer shall contain a subset of the allowed media types, codecs and other parameters from the SDP message bodies of all 488 (Not Acceptable Here) responses so far received for the same session establishment attempt (i.e. a set of INVITE requests used for the same session establishment). For each media line, the UE shall order the codecs in the SDP offer according to the order of the codecs in the SDP message bodies of the 488 (Not Acceptable Here) responses.\nNOTE 6:\tThe UE can attempt a session establishment through multiple networks with different policies and potentially can need to send multiple INVITE requests and receive multiple 488 (Not Acceptable Here) responses from different CSCF nodes. The UE therefore takes into account the SDP message bodies of all the 488 (Not Acceptable Here) responses received related to the same session establishment when building a new INVITE request.\nUpon confirming successful local resource reservation, the UE shall create an SDP offer in which the related local preconditions are set to met, using the segmented status type, as defined in RFC 3312 [30] and RFC 4032 [64].\nUpon receiving an SDP answer, which includes more than one codec per media stream, excluding the in-band DTMF codec, as described in subclause 6.1.1, the UE shall:\n-\tsend an SDP offer at the first possible time, selecting only one codec per media stream; or\n-\tif the UE is participant in a multi-stream multiparty multimedia conference session using simulcast (indicated by the presence of \"a=simulcast\" SDP attribute(s) in the SDP answer, as defined in RFC 8853 [249]), apply the procedures defined in 3GPP TS 26.114 [9B] annex S.\nIf the UE sends an initial INVITE request that includes only an IPv6 address in the SDP offer, and receives an error response (e.g., 488 (Not Acceptable Here) with 301 Warning header field) indicating \"incompatible network address format\", the UE shall send an ACK as per standard SIP procedures. Subsequently, the UE may acquire an IPv4 address or use an existing IPv4 address, and send a new initial INVITE request to the same destination containing only the IPv4 address in the SDP offer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.3\tHandling of SDP at the terminating UE",
                            "text_content": "Upon receipt of an initial SDP offer in which no precondition information is available, the terminating UE shall in the SDP answer:\n-\tif, prior to sending the SDP answer the desired QoS resources have been reserved at the terminating UE, set the related media streams in the SDP answer to:\n-\tactive mode, if the offered media streams were not listed as inactive; or\n-\tinactive mode, if the offered media streams were listed as inactive.\nIf the terminating UE had previously set one or more media streams to inactive mode and the QoS resources for those media streams are now ready, the UE shall set the media streams to active mode by applying the procedures described in RFC 4566 [39] with respect to setting the direction of media streams.\nUpon sending a SDP answer to an SDP offer (which included one or more media lines which was offered with several codecs) the terminating UE shall:\n-\tselect exactly one codec per media line and indicate only the selected codec for the related media stream. In addition, the UE may indicate support of the in-band DTMF codec, as described in subclause 6.1.1; or\n-\tif the UE is participant in a multi-stream multiparty multimedia conference session using simulcast (indicated by the presence of \"a=simulcast\" SDP attribute(s) in the SDP answer, as defined in RFC 8853 [249]), apply the procedures defined in 3GPP TS 26.114 [9B] annex S.\nIf the terminating UE does not support any of the offered codecs, or there are other parameters not acceptable to the UE, the UE shall send a 488 (Not Acceptable Here) response and shall in the response include an SDP in the message body containing the codecs and parameters supported by the UE.\nUpon sending an SDP answer to an SDP offer, with the SDP answer including one or more media streams for which the originating side did indicate its local preconditions as not met, if the precondition mechanism is used by the terminating UE (see subclause 5.1.4.1), the terminating UE shall indicate its local preconditions and request the confirmation for the result of the resource reservation at the originating end point.\nNOTE 1:\tIf the terminating UE does not use the precondition mechanism (see subclause 5.1.4.1), it will ignore any precondition information received from the originating UE.\nUpon receiving an initial INVITE request that includes the SDP offer containing an IP address type (in the \"c=\" parameter) that is not supported by the UE, the UE shall:\n-\tif the UE is a UE performing the functions of an external attached network and\n1)\tif the received SDP offer contains an \"altc\" SDP attribute indicating an alternative and supported IP address; and\n2)\tthe UE supports the \"altc\" SDP attribute;\nselect an IP address type in accordance with RFC 6947 [228]; or\n-\totherwise respond with a 488 (Not Acceptable Here) response including a 301 Warning header field indicating \"incompatible network address format\".\nNOTE 2:\tUpon receiving an initial INVITE request that does not include an SDP offer, the UE can accept the request and include an SDP offer in the first reliable response. The SDP offer will reflect the called user's terminal capabilities and user preferences for the session.\nIf the UE receives an SDP offer that specifies different IP address type for media (i.e. specify it in the \"c=\" parameter of the SDP offer) that the UE is using for signalling, and if the UE supports both IPv4 and IPv6 addresses simultaneously, the UE shall accept the received SDP offer. Subsequently, the UE shall either acquire an IP address type or use an existing IP address type as specified in the SDP offer, and include it in the \"c=\" parameter in the SDP answer.\nNOTE 3:\tUpon receiving an initial INVITE request, that includes an SDP offer containing connection addresses (in the \"c=\" parameter) equal to zero, the UE will select the media streams that is willing to accept for the session, reserve the QoS resources for accepted media streams, and include its valid connection address in the SDP answer.\nIf the UE supports the end-to-access-edge media security using SDES, upon receiving an SDP offer containing an  based media:\n-\ttransported using the SRTP transport protocol as defined in RFC 3711 [169];\n-\twith an SDP crypto attribute as defined in RFC 4568 [168]; and\n-\twith the SDP \"a=3ge2ae:applied\" attribute;\nand if the UE accepts the  based media, then the UE shall generate the SDP answer with the related  based media:\n-\ttransported using the SRTP transport protocol according to RFC 3711 [169] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tincluding an SDP crypto attribute according to RFC 4568 [168] and the profile defined in 3GPP TS 33.328 [19C].\nIf the UE supports the end-to-access-edge media security for RTP media using -SRTP and certificate fingerprints, upon receiving an SDP offer containing an  based media:\n-\ttransported using the \"UDP/TLS/RTP/SAVP\" or \"UDP/TLS/RTP/SAVPF\" as the transport protocol according to RFC 5763 [222] and RFC 5764 [223];\n-\twith the SDP fingerprint attribute as defined in RFC 8122 [241]; and\n-\twith the SDP \"a=3ge2ae:applied\" attribute;\nand if the UE accepts the  based media, then the UE shall generate the SDP answer with the related  based media:\n-\ttransported using \"UDP/TLS/RTP/SAVP\" or \"UDP/TLS/RTP/SAVPF\" as the transport protocol according to RFC 5763 [222] and RFC 5764 [223] and the profile defined in 3GPP TS 33.328 [19C];\n-\tincluding the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tincluding the SDP tls-id attribute according to RFC 8842 [240].\nIf the UE supports the end-to-access-edge media security for MSRP using  and certificate fingerprints, upon receiving an SDP offer containing an MSRP based media:\n-\ttransported using the MSRP over  transport protocol as defined in RFC 4975 [178] and RFC 6714 [214];\n-\twith the SDP fingerprint attribute as defined in RFC 8122 [241]; and\n-\twith the SDP \"a=3ge2ae:applied\" attribute;\nand if the UE accepts the MSRP based media, then the UE shall generate the SDP answer with the related MSRP based media:\n-\ttransported using the MSRP over  transport protocol according to RFC 4975 [178], RFC 6714 [214] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tincluding the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C].\nNOTE 4:\t client role and  server role are determined according to RFC 6135 [215] (referenced by RFC 6714 [214]). If the SDP answer contains the SDP setup attribute with \"active\" attribute value, the answerer performs the  client role. If the SDP answer contains the SDP setup attribute with \"passive\" attribute value, the offerer performs the  client role.\nIf the UE supports the end-to-access-edge media security for BFCP using  and certificate fingerprints, upon receiving an SDP offer containing an BFCP based media:\n-\ttransported using the BFCP over  transport protocol as defined in RFC 4583 [108];\n-\twith the SDP fingerprint attribute as defined in RFC 8122 [241]; and\n-\twith the SDP \"a=3ge2ae:applied\" attribute;\nand if the UE accepts the BFCP based media, then the UE shall generate the SDP answer with the related BFCP based media:\n-\ttransported using the BFCP over  transport protocol according to RFC 4583 [108] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tincluding the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C].\nUnless a new  session is negotiated, subsequent SDP offers and answers shall not impact the previously negotiated  roles.\nNOTE 5:\tRFC 4583 [108] specifies that the SDP answerer will act as the  server but leaves the impact of SDP renegotiation on  unspecified.\nIf the UE supports the end-to-access-edge media security for UDPTL using DTLS and certificate fingerprints, upon receiving an SDP offer containing an UDPTL based media:\n-\ttransported using the UDPTL over DTLS transport protocol as defined in RFC 7345 [217] and RFC 8842 [240];\n-\twith the SDP fingerprint attribute as defined in RFC 8122 [241]; and\n-\twith the SDP \"a=3ge2ae:applied\" attribute;\nand if the UE accepts the UDPTL based media, then the UE shall generate the SDP answer with the related UDPTL based media:\n-\ttransported using the UDPTL over DTLS transport protocol according to RFC 7345 [217], RFC 8842 [240] and the profile defined in 3GPP TS 33.328 [19C];\n-\tincluding the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tincluding the SDP tls-id attribute according to RFC 8842 [240].\nUpon receiving an SDP offer containing an MSRP based media:\n-\ttransported using the MSRP over  transport protocol as defined in RFC 4975 [178] and RFC 6714 [214]; and\n-\twith the SDP key-mgmt attribute according to RFC 4567 [167] and the profile defined in 3GPP TS 33.328 [19C];\nand if the UE accepts the MSRP based media, the UE shall:\n1)\tgenerate the SDP answer with the related MSRP based media:\na)\ttransported using the MSRP over  transport protocol according to RFC 4975 [178], RFC 6714 [214] and the profile defined in 3GPP TS 33.328 [19C]; and\nb)\tinclude the SDP key-mgmt attribute according to RFC 4567 [167] and the profile defined in 3GPP TS 33.328 [19C]; and\nNOTE 6:\tSDP fingerprint attribute is not included.\n2)\tindicate the pre-shared key ciphersuites according to RFC 4279 [218] and the profile defined in 3GPP TS 33.328 [19C] in  handshake of  connection transporting the MSRP based media.\nIf the terminating UE uses the precondition mechanism (see subclause 5.1.4.1), if the desired QoS resources for one or more media streams have not been reserved at the terminating UE when constructing the SDP offer, the terminating UE shall indicate the related local preconditions for QoS as not met, using the segmented status type, as defined in RFC 3312 [30] and RFC 4032 [64], as well as the strength-tag value \"mandatory\" for the local segment and the strength-tag value either \"optional\" or as specified in RFC 3312 [30] and RFC 4032 [64] for the remote segment.\nNOTE 7:\tIt is out of scope of this specification which media streams are to be included in the SDP offer.\nIf the terminating UE uses the precondition mechanism (see subclause 5.1.4.1) and if the desired QoS resources for one or more media streams are available at the terminating UE when the SDP offer is sent, the UE shall indicate the related local preconditions as met, using the segmented status type, as defined in RFC 3312 [30] and RFC 4032 [64], as well as the strength-tag value \"mandatory\" for the local segment and the strength-tag value either \"optional\" or as specified in RFC 3312 [30] and RFC 4032 [64] for the remote segment.\nIf the terminating UE sends an UPDATE request to remove one or more media streams negotiated in the session for which a final response to the INVITE request has not been sent yet, the terminating UE sets the ports of the media streams to be removed from the session to zero in the new SDP offer.\nNOTE 8:\tUpon receiving an initial INVITE request with one or more media streams which the terminating UE supports and one or more media streams which the UE does not support, the UE is not expected to reject the INVITE request just because of the presence of the unsupported media stream.\nNOTE 9:\tPrevious versions of this document mandated the use of the SDP inactive attribute in the SDP offer if the desired QoS resources for one or more media streams had not been reserved at the originating UE when constructing the SDP offer unless the originating UE knew that the precondition mechanism was supported by the remote UE. The use can still occur when interoperating with devices based on earlier versions of this document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.4\tSession modification",
                            "text_content": "This subclause applies after the 2xx response to the initial INVITE request has been sent or received.\nIf the precondition mechanism is used for the session modification, the following applies:\na)\tif the session modification does not increase the QoS requirement of the already established media stream (e.g., all the media streams in a call hold procedure, audio stream in a call upgrade procedure), in the SDP body of the request (re-INVITE, UPDATE, or PRACK), both local and remote QoS of this media shall be indicated as met; and\nb)\tif the session modification increases the QoS requirement of some already established media stream(s) (e.g., request of using a different audio/video codec that requires higher bandwidth), or if the session modification adds a new media stream (e.g., call upgrade), the setting of the current and desired QoS status of the modified or added media stream shall be the same as specified in subclause 6.1.2. If the network fails to modify or reserve the required resources, the UE shall send a CANCEL request to terminate the session modification.\nIf the precondition mechanism is used for the session modification, the settings of the current and desired QoS status shall be the same as specified in subclause 6.1.3. If the network cannot modify or reserve the required resources, the UE shall send a 580 (Precondition-Failure) response towards the UE that initiated the session modification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "The P-CSCF shall perform IMS- functionality:\n-\twhen the P-CSCF needs to perform procedures for hosted  traversal according to Annex F; or\n-\twhen the P-CSCF needs to perform procedures for media plane security (see subclause 6.7.2.2);\n-\twhen required by the user-related policies provisioned to the P-CSCF (see subclause 5.2.1);\n-\twhen the P-CSCF needs to perform ECN procedures (see subclause 6.7.2.3);\n-\twhen the P-CSCF needs to perform procedures for OMR (see subclause 6.7.2.4);\n-\twhen the P-CSCF needs to perform P-CSCF controlled (P)T and (P)T-PT (see subclause 6.7.2.5);\n-\twhen the P-CSCF needs to perform hosted  procedures (see subclause 6.7.2.6);\n-\twhen the P-CSCF needs to perform ICE procedures (see subclause 6.7.2.7); or\n-\twhen the P-CSCF needs to perform transcoding procedures (see subclause 6.7.2.8).\nUpon receiving an initial INVITE request that includes the SDP offer containing only an IPv6 address (in the \"c=\" parameter) and if the P-CSCF knows that the terminating UE supports only IPv4 addressing and does not perform the IP version interworking as described in subclause 6.7.2.5.1, the P-CSCF may, based on local policy, respond with a 488 (Not Acceptable Here) response including a 301 Warning header field indicating \"incompatible network address format\".\nNOTE 1:\tHow the P-CSCF determines whether the UE supports only IPv4 addressing is implementation specific.\nNOTE 2:\tUpon receiving an initial INVITE request that does not include an SDP offer, the P-CSCF can accept the request and receive an SDP offer in the first reliable response. The SDP offer will reflect the called user's terminal capabilities and user preferences for the session.\nWhen the P-CSCF receives any SIP request containing an SDP offer, the P-CSCF shall examine the media parameters in the received SDP offer.\nIf the P-CSCF finds any media parameters which are not allowed on the network by local policy or if available by bandwidth authorisation limitation information coming from the IP-CAN (e.g. via PCRF), the P-CSCF shall return a 488 (Not Acceptable Here) response containing an SDP message body. This SDP message body contains either all the media types, codecs and other SDP parameters which are allowed according to the local policy, or, based on configuration by the operator of the P-CSCF, a subset of these allowed parameters. This subset may depend on the content of the received SIP request. For each media line, the P-CSCF shall build the SDP message body in the 488 (Not Acceptable Here) response in the same manner as a UAS builds the SDP message body in a 488 (Not Acceptable Here) response as specifed in RFC 3261 [26]. The P-CSCF shall order the codecs with the most preferred codec listed first. If the SDP offer is encrypted, the P-CSCF may reject the request.\nSubject to local policy, if it is not possible to generate a SDP message body (e.g. the available bandwidth is less than the bandwidth of any codec allowed by the local policy), the P-CSCF shall return a 486 (Busy here) response with a 370 Warning header field indicating \"insufficient bandwidth\".\nWhen the P-CSCF receives a SIP response different from 200 (OK) response containing SDP offer, the P-CSCF shall not examine the media parameters in the received SDP offer, but the P-CSCF shall rather check the succeeding request containing the SDP answer for this offer, and if necessary (i.e. the SDP answer reduced by the UE still breaches local policy, or if available by bandwidth authorisation limitation information coming from the IP-CAN, e.g. via PCRF), the P-CSCF shall return a 488 (Not Acceptable Here) response containing the local policy allowed SDP message body. If the SDP answer is encrypted, the P-CSCF may reject the succeeding request.\nWhen the P-CSCF receives a 200 (OK) response containing SDP offer, the P-CSCF shall examine the media parameters in the received SDP offer. If the P-CSCF finds any media parameters which are not allowed on the network by local policy or if available by bandwidth authorisation limitation information coming from the IP-CAN (e.g. via PCRF), the P-CSCF shall forward the SDP offer and on the receipt of the ACK request containing the SDP answer, the P-CSCF shall immediately terminate the session as described in subclause 5.2.8.1.2. If the SDP offer is encrypted, the P-CSCF shall forward the SDP offer and on the receipt of the ACK request containing the SDP answer, it may immediately terminate the session as described in subclause 5.2.8.1.2.\nIn case a device performing address and/or port number conversions is provided by a (P)T or (P)T-PT controlled by the P-CSCF, or by a hosted , the P-CSCF may need to modify the media connection data in SDP message bodies according to the procedures described in annex F or subclause 6.7.2.5.\nThe P-CSCF shall apply the same SDP policy to the initial request or response containing an SDP message body, and throughout the complete SIP session.\nThe P-CSCF may inspect, if present, the \"b=RS\" and \"b=RR\" lines in order to find out the bandwidth allocation requirements for RTCP.\nSubject to local policy, the P-CSCF shall prohibit the negotiation of ECN during SDP offer/answer exchanges associated with multimedia priority service by removing any ECN attribute \"a=ecn-capable-rtp\" from the SDP offer and shall not invoke ECN for SIP transactions associated with multimedia priority service.\nAdditional procedures where the P-CSCF acts as an IMS- are given in subclause 6.7.2. The IMS- only applies where there are specific gateway capabilities to be provided.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "When the S-CSCF receives any SIP request containing an SDP offer, the S-CSCF shall examine the media parameters in the received SDP offer. If the S-CSCF finds any media parameters which are not allowed based on local policy or subscription (i.e. the information in the instances of the Core Network Service Authorization class in the service profile, described in 3GPP TS 29.228 [14]), the S-CSCF shall return a 488 (Not Acceptable Here) response containing an SDP message body. This SDP message body contains either all the media types, codecs and other SDP parameters which are allowed according to the local policy and users subscription or, based on configuration by the operator of the S-CSCF, a subset of these allowed parameters. This subset may depend on the content of the received SIP request. The S-CSCF shall build the SDP message body in the 488 (Not Acceptable Here) response in the same manner as a UAS builds the SDP message body in a 488 (Not Acceptable Here) response as specified in RFC 3261 [26]. If the SDP offer is encrypted, the S-CSCF may reject the request.\nWhen the S-CSCF receives a SIP response different from 200 (OK) response containing SDP offer, the S-CSCF shall not examine the media parameters in the received SDP offer, but the S-CSCF shall rather check the succeeding request containing the SDP answer for this offer, and if necessary (i.e. the SDP answer reduced by the UE still breaches local policy), the S-CSCF shall return a 488 (Not Acceptable Here) response containing the local policy allowed SDP message body. If the SDP answer is encrypted, the S-CSCF may reject the succeeding request.\nWhen the S-CSCF receives a 200 (OK) response containing an SDP offer, the S-CSCF shall examine the media parameters in the received SDP offer. If the S-CSCF finds any media parameters which are not allowed based on local policy or subscription (i.e. the information in the instances of the Core Network Service Authorization class in the service profile, described in 3GPP TS 29.228 [14]), the S-CSCF shall forward the SDP offer and on the receipt of the ACK request containing the SDP answer, the S-CSCF shall immediately terminate the session as described in subclause 5.4.5.1.2. If the SDP offer is encrypted, the S-CSCF shall forward the SDP offer and on the receipt of the ACK request containing the SDP answer, it may immediately terminate the session as described in subclause 5.4.5.1.2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.4\tProcedures at the MGCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.4.1\tCalls originating from circuit-switched networks",
                            "text_content": "The usage of SDP by the MGCF is the same as its usage by the UE, as defined in the subclause 6.1 and A.3.2, with the following exceptions:\n-\tin an initial INVITE request generated by a MGCF, the MGCF shall indicate the current status of the local precondition;\n-\tend-to-access edge media security is not applicable to the MGCF; and\n-\tprocedures related to the handling of the IP-CAN bearer rejection, modification or release are not applicable to the MGCF.\nWhen sending an SDP message body, the MGCF shall not include the \"i=\", \"u=\", \"e=\", \"p=\", \"r=\", and \"z=\" descriptors in the SDP message body, and the MGCF shall ignore them if received in an SDP message body.\nWhen the MGCF generates and sends an INVITE request for a call originating in a circuit-switched network, the MGCF shall populate the SDP with the codecs supported by the associated MGW.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.2\tCalls terminating in circuit-switched networks",
                            "text_content": "The usage of SDP by the MGCF is the same as its usage by the UE, as defined in the subclause 6.1 and A.3.2, with the following exceptions:\na)\twhen the MGCF sends a 183 (Session Progress) response with an SDP message body, the MGCF shall only request confirmation for the result of the resource reservation (as defined in RFC 3312 [30]) at the originating end point if all of the following conditions are true:\n-\tthere are any remaining unfulfilled preconditions at the originating end point;\n-\tthe received initial INVITE request indicates support of SIP preconditions; and\n-\tlocal configuration indicates support of SIP preconditions;\nb)\tend-to-access edge media security is not applicable to the MGCF; and\nc)\tprocedures related to the handling of the IP-CAN bearer rejection, modification or release are not applicable to the MGCF.\nWhen sending an SDP message body, the MGCF shall not include the \"i=\", \"u=\", \"e=\", \"p=\", \"r=\", and \"z=\" descriptors in the SDP message body, and the MGCF shall ignore them if received in an SDP message body.\nIf receiving a SIP request containing a message body with data channel media descriptors, the MGCF shall ignore them, and the MGCF shall set the data channel media port number in the data channel media descriptors as zero when sending theSIP response message to IMS network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.3\tOptimal Media Routeing (OMR)",
                            "text_content": "If the MGCF supports OMR it shall also perform the UA procedures described in 3GPP TS 29.079 [11D].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.4\tExplicit congestion control support in MGCF",
                            "text_content": "An MGW associated with an MGCF can support Explicit Congestion Notification (ECN) according to RFC 3168 [189], and can act as an ECN endpoint to enable ECN with a local ECN-capable terminal within a local network that properly handles ECN-marked packets.\nIf the MGCF receives a SDP offer containing ECN attribute \"a=ecn-capable-rtp\" as specified in RFC 6679 [188], and if the MGCF knows via configuration that the MGW handles ECN-marked packets properly then the MGCF, taking into account the initialisation method the MGW supports, shall return a SDP answer containing the ECN attribute \"a=ecn-capable-rtp\" according to RFC 6679 [188].\nNOTE 1:\tThe \"leap\" initialisation method is the only initialisation method the MGW supports over the Mn interface in this release.\nWhen creating an SDP offer and if the MGCF knows via configuration that the MGW handles ECN-marked packets properly the MGCF may initiate ECN negotiation in accordance with RFC 6679 [188].\nIf the MGCF receives the SDP answer also containing ECN attribute \"a=ecn-capable-rtp\" then the MGCF will instruct the MGW to apply ECN procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.5\tProcedures at the MRFC",
                    "description": "",
                    "summary": "",
                    "text_content": "Void.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.6\tProcedures at the AS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.6.1\tGeneral",
                            "text_content": "Since an AS may provide a wide range of different services, procedures for the SDP usage for an AS acting as originating UA, terminating UA or third-party call control role are dependent on the service provided to the UA and on the capabilities on the remote UA. There is no special requirements regarding the usage of the SDP, except the requirements for the SDP capabilities described in the following paragraphs and clause A.3:\n1)\tProviding that an INVITE request generated by an AS contains an SDP message body, the AS has the capability of reflecting the originating AS's capabilities, desired QoS and precondition requirements for the session in the SDP message body.\n2)\tWhen the AS sends a 183 (Session Progress) response with an SDP message body including one or more \"m=\" media types, it has the capability of requesting confirmation for the result of the resource reservation at the originating endpoint.\nWhen an AS acts as a B2BUA, and it controls media resources using an MRF, it may support OMR. When the AS supports OMR, and it controls media resources using an MRF, it shall also perform the procedures described in 3GPP TS 29.079 [11D].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.2\tTranscoding",
                            "text_content": "The AS shall send an SDP offer to the MRFC with the codecs supported by the caller and the codecs to be offered towards the callee, and the IP address and port information received from caller, in seperate media lines. When receiving an SDP answer from the MRFC, the AS shall forward the received selected codecs and IP address and port information in the callee´s media line(s) as an SDP offer towards the callee.\nWhen the callee provides an SDP answer with selected codecs and IP address and port information, the AS shall forward this information within a new SDP offer to the MRFC. When receiving the corresponding SDP answer from the MRFC, the AS shall forward the address and port information within the caller´s media line(s) as an SDP answer towards the caller.\nThe codecs offered for transcoding are subject to network policy which shall be according to clause T.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.3\tAS procedures to support WebRTC media optimization procedure",
                            "text_content": "When an AS acts as a B2BUA, and it controls media resources using an MRF, it may support switching to transparent media for WebRTC when those media have been negotiated, as specified in annex U.2.4 of 3GPP TS 23.228 [7]. An AS that supports switching to transparent media for WebRTC shall apply the procedures in the present subclause.\nNOTE 1:\tThe AS can in addition apply OMR procedures described in 3GPP TS 29.079 [11D].\nIf the AS receives an SDP offer that contains any \"tra-contact\" SDP attribute, and the AS decides to include an MRF in the media path, the AS shall:\n1)\tinclude the address information as received from the MRF in that contact line and also encapsulate the address information into each received \"tra-contact\" attribute, replacing previous information; and\n2)\ttransparently pass all received \"tra-m-line\", \"tra-att\", \"tra-SCTP-association\", \"tra-media-line-number\" and \"tra-bw\" SDP attributes.\nNOTE 2:\tWhen interacting with the MRF to reserve resources and provide the information needed for media handling the AS will ask for resources suitable for the media described in the SDP offer outside the \"tra-m-line\", \"tra-att\" and \"tra-bw\" SDP attributes.\nIf an AS receives an SDP answer and the SDP answer includes \"tra-m-line\" media level SDP attributes, the AS shall:\n1)\tconfigure the MRF to transparently pass the media described in the received \"tra-m-line\", \"tra-att\", \"tra-SCTP-association\", and \"tra-bw\" SDP attributes; and\n2)\ttransparently pass all received \"tra-m-line\", \"tra-att\", \"tra-SCTP-association\" and \"tra-bw\" SDP attributes.\nNOTE 3:\tWhen interacting with MRF the AS will deactivate media plane interworking in the MRF. The AS will use the \"tra-SCTP-association\" SDP attributes to determine which media streams need to be multiplexed into the same SCTP association.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.7\tProcedures at the IMS- functionality",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.7.1\tIMS- in IBCF",
                            "text_content": "When the IBCF acts as an IMS-, it makes procedures as for an originating UA and terminating UA. The IMS- acts as a B2BUA. The general treatment of the SDP information between originating UA and terminating UA is described in 3GPP TS 29.162 [11A]. For the use of the IMS- for specific capabilities, additional procedures are defined in subsequent subclauses.\nSubject to local policy, the IBCF shall prohibit the negotiation of ECN during SDP offer/answer exchanges associated with multimedia priority service by removing any ECN attribute \"a=ecn-capable-rtp\" from the SDP offer and shall not invoke ECN for SIP transactions associated with multimedia priority service.\nNOTE:\tDisabling ECN in an IBCF does not prevent a P-CSCF (IMS ), subject to roaming agreement, from applying ECN over the access network between a UE and the P-CSCF (IMS-).\nThis subclause describes procedures of an IBCF to support ICE as defined in RFC 8445 [289] and RFC 8839 [290].\nIf no TrGW is inserted, an IBCF may transparently pass ICE related SDP attibutes to support ICE. The remaining procedures in this subclause are only applicable if the IBCF is inserting a TrGW on the media plane.\nWhen the IBCF with attached TrGW receives SDP candidate information from the SDP offerer the IBCF shall not forward the candidate information towards the SDP answerer. When the IBCF receives SDP candidate information from the SDP answerer the IBCF shall not forward the candidate information towards the SDP offerer. The remaining procedures in this subclause are optional.\nNOTE:\tAn IBCF that removes and/or does not provide ICE related SDP attributes (e.g. a=candidate) in the offer/answer exchange will cause the ICE procedures to be aborted and the address and port information in the m and c lines of the SDP offer will be used. If this address and port information contains the relayed candidate address of a STUN Relay server, as recommended by ICE, then an extra media relay server will be used for the session which is not necessary nor desirable.\nThe IBCF with attached TrGW performs separate ICE procedures towards the SDP offerer and the SDP answerer. The usage of ICE is negotiated separately with the SDP offerer and SDP answerer, and ICE may be applied independently at either side. Furthermore, the IBCF may be configured to apply ICE procedures only towards one network side, e.g. towards the IM CN subsystem it belongs to.\nSince the IBCF is not located behind a , it does not request the TrGW to generate keep-alive messages even when acting as a full ICE entity. The IBCF only requests the TrGW to terminate and generate STUN messages used for the candidate selection procedures.\nSince the IBCF is not located behind a  the IBCF shall only include host candidates in SDP offers and answers generated by the IBCF.\nThis subclause describes the IBCF full ICE procedures for UDP based streams.\nWhen the IBCF receives an SDP offer including ICE candidate information, the IBCF shall send the candidate information for each UDP based stream received in the SDP offer towards the TrGW. The IBCF will request the TrGW to reserve media- and STUN resources towards the SDP offerer, based on the candidate information, in order to allow the TrGW to perform the necessary connectivity checks per the ICE procedures.\nIf the SDP offerer is acting as an ICE controller entity the IBCF shall act as an ICE controlled entity in the direction towards the SDP offerer. If the SDP offerer is acting as an ICE controlled entity the IBCF shall act as an ICE controller entity in the direction towards the SDP offerer.\nPrior to sending an SDP offer, the IBCF may choose to apply related ICE procedues, e.g. if it expects to interact with terminals applying procedures as described in subclause K.5.2, and if both the IBCF and TrGW also support ICE procedures. To invoke these ICE procedures, the IBCF will request the TrGW to reserve media- and STUN resources towards the SDP answerer for each UDP based media stream and include a host candidate attribute for each UDP based stream in the SDP offer, providing the reserved address and port at the TrGW as destination.\nThe IBCF shall always act as an ICE controller entity towards the SDP answerer.\nNOTE: The host candidate address included by the IBCF in the generated SDP offer matches the c- and m line information for the associcated UDP stream in the SDP offer.\nWhen the IBCF receives an SDP answer including ICE candidate information, the IBCF will send the candidate information for each UDP based stream received in the SDP answer towards the TrGW.\nThe IBCF will request the TrGW to perform ICE candidate selection procedures towards the SDP answerer. The IBCF will request the TrGW to inform the IBCF, for each UDP stream, which candidate pair has been selected towards the SDP answerer, once the candidate selection procedure towards the SDP answerer has finished.\nIf the TrGW indicates to the IBCF that, for at least one UDP stream, the selected candidate pair does not match the c- and m- line address information for the associated UDP stream, exchanged between the IBCF and the SDP answerer, and the IBCF acts an ICE controller entity towards the SDP answerer, the IBCF shall send a new offer towards the SDP answerer in order to allign the c- and m- lines address information with the chosen candidate pair for the associated UDP stream.\nWhen the IBCF generates an SDP answer for an offer that included ICE candidate information, the IBCF will request the TrGW to reserve media- and STUN resources towards the SDP offerer for each UDP based media stream and include an SDP host candidate attribute for each UDP based stream in the SDP answer, providing the reserved address and port at the TrGW as destination.\nThe IBCF shall in the generated SDP answer include host candidate information which matches the c- and m line information for the associated UDP stream in the SDP answer.\nThe IBCF will request the TrGW to perform ICE candidate selection procedures towards the SDP offerer. The IBCF will request the TrGW to inform the IBCF, for each UDP stream, which candidate pair has been selected towards the SDP offerer, once the candidate selection procedure towards the SDP answerer has finished.\nIf the TrGW indicates to the IBCF that the selected candidate pair towards the SDP offerer does not match the c- and m- line address information for the associated UDP stream, exchanged between the IBCF and the SDP offerer, and the IBCF acts an ICE controller entity towards the SDP offerer, the IBCF shall send an offer towards the SDP offerer (which will now act as an SDP answerer) in order to allign the c- and m- line address information with the chosen candidate pair for the associated UDP stream.\nWhen the IBCF is using ICE lite procedures for UDP based streams, the IBCF procedures are identical as described in subclause 6.7.1.2.2, with the following exceptions:\n-\tThe IBCF always acts as an ICE controlled entity towards the SDP offerer and towards the SDP answerer, and;\n-\tThe IBCF requests the TrGW to perform ICE lite candidate selection procedures, as defined in ICE\nThe IBCF shall terminate ICE procedures for  based streams. Instead the IBCF will use the mechanism defined in RFC 4145 [83] for establishing  based streams, as defined in RFC 6544 [131].\nAn entity that supports ICE continues the ICE procedures for UDP based streams, even if no candidates are provided for  based streams.\nNOTE:\tThe IBCF ICE procedures for  based streams are identical no matter whether the IBCF uses full ICE- or ICE lite- procedures for UDP based streams.\nWhen the IBCF receives an SDP offer, the IBCF shall ignore the candidate attributes for  based streams. The IBCF shall not send the candidate information for  based streams towards the TrGW.\nWhen the IBCF generates an SDP offer the IBCF shall include an \"actpass\" setup attribute, as defined in RFC 4145 [83], for each  based stream, which will cause the SDP answerer to initiate the  connections towards the TrGW. The IBCF shall not include any candidate attributes for  based streams in the SDP offer.\nSince the IBCF does not include candidates in the SDP offer towards the SDP answerer, there are no ICE specific procedures when the IBCF receives an SDP answer.\nNOTE:\tIf the SDP answer contains candidate attributes for  based streams, the IBCF simply discards the candidate attributes.\nWhen the IBCF generates an SDP answer the IBCF shall include a \"passive\" setup attribute, as defined in RFC 4145 [83], for each  based stream, which will cause the SDP offerer to initiate the  connections towards the TrGW. The IBCF shall not include any candidate attributes for  based streams in the SDP answer.\nBefore forwarding the SDP offer to the answerer, the IBCF may add to the selected media one or more codecs to the codec list contained in the SDP offer. The codecs added to the SDP offer are based on local policy and shall be in accordance with the requirements of clause T.2.\nNOTE 1:\tThe local policy can be based on supported codecs in the terminating network.\nUpon receipt of an SDP answer, the IBCF shall inspect the list of the returned codecs and proceed as follows:\n-\tif the list contains at least one of the codecs belonging to the original SDP offer, the IBCF shall not invoke the transcoding function; and\n-\tif the list contains none of the codecs belonging to the original SDP offer, the IBCF shall select one of the returned codecs introduced in the answer and invoke the transcoding function. In order to perform the transcoding the IBCF shall select one of the codecs originally offered and set to a non-zero port value the related media stream in the answer sent to the offerer.\nNOTE 2:\tThe protocol used between IBCF and TrGW to allow the transport plane media trascoding control is out of scope of this specification. The codec selected by the answerer and the one selected by the IBCF and sent to the offerer can be used to instruct the TrGW for the transcoding purposes.\nThe IBCF shall remove from the SDP the codecs added to the original SDP offer before forwarding the SDP answer to the offerer.\nNOTE 3:\tIn accordance with normal SDP procedure the transcoding IBCF informs the answerer of the properties of the chosen codecs (IP-address and ports).\nThis subclause describes the IBCF procedures for supporting the scenario where IP address and/or port conversions occur at the TrGW level in the media path between the UE and the backbone. Two types of address conversions are covered:\n-\tIP version interworking ((P)T-PT); and\n-\tIP address/port translation ((P)T).\nWhen the IBCF performs procedures for IBCF controlled (P)T and (P)T-PT, the IBCF shall modify the IP address(es) and port numbers (in case of (P)T) in SDP offers and answers, based on the IP address(es) and port number(s) received from the TrGW, as described in subclause 6.7.2.1.\nFor terminating sessions the IBCF may towards a UE performing the functions of an external attached network indicate in the SDP offer alternate IP address versions (IPv4 and IPv6) by inserting two \"altc\" attributes as defined in RFC 6947 [228]. The order of setting the two IP addresses in the two \"altc\" SDP attributes shall be based on local policy. The insertion of the \"altc\" attributes is independent of their presence in the received SDP offer.\nNOTE 1:\tThe insertion of alternate IP versions allows avoiding the rejection of the SDP offer because of incompatible network address formats and when the request terminates in a corporate network enables the corporate network to avoid IP version interworking.\nNOTE 2:\tThe handling of alternative IP addresses between the IMS- and the TrGW is defined in 3GPP TS 29.162 [11A].\nIf the IBCF sends an initial INVITE request that includes only an IPv6 address in the SDP offer, and receives a 488 (Not Acceptable Here) response with 301 Warning header field indicating \"incompatible network address format\", the IBCF shall send an ACK as per standard SIP procedures. Subsequently, based on operator policy, the IBCF may, by performing the IP version interworking, acquire an IPv4 address or use an existing IPv4 address, and send a new initial INVITE request to the same destination containing only the IPv4 address in the SDP offer.\nThe IMS-ALG in the IBCF may support switching to transparent media for WebRTC when those media have been negotiated, as specified in annex U.2.4 of 3GPP TS 23.228 [7]. An IMS-ALG that supports switching to transparent media for WebRTC shall apply the procedures in the present subclause.\nNOTE 1:\tThe IMS-ALG can in addition apply OMR procedures described in 3GPP TS 29.079 [11D].\nIf the IMS-ALG receives an SDP offer that contains any \"tra-contact\" SDP attribute, and the IMS-ALG decides to include a TrGw in the media path, the IMS-ALG shall:\n1)\tinclude the address information as received from the TrGW in that contact line and also encapsulate the address information into each received \"tra-contact\" attribute, replacing previous information; and\n2)\ttransparently pass all received \"tra-m-line\", \"tra-att\", \"tra-SCTP-association\", \"tra-media-line-number\" and \"tra-bw\" SDP attributes.\nNOTE 2:\tWhen interacting with the TrGW to reserve resources and provide the information needed for media handling the IMS-ALG will ask for resources suitable for the media described in the SDP offer outside the \"tra-m-line\", \"tra-att\" and \"tra-bw\" SDP attributes. The details of the interaction between the IMS-ALG and the TrGW are out of scope of this document.\nIf an IMS-ALG receives an SDP answer and the SDP answer includes \"tra-m-line\" media level SDP attributes, the IMS-ALG shall:\n1)\tconfigure the TrGW to transparently pass the media described in the received \"tra-m-line\", \"tra-att\", \"tra-SCTP-association\", and \"tra-bw\" SDP attributes; and\n2)\ttransparently pass all received \"tra-m-line\", \"tra-att\", \"tra-SCTP-association\" and \"tra-bw\" SDP attributes.\nNOTE 3:\tWhen interacting with TrGW the IMS-AGW will deactivate media plane interworking in the TrGW. The details of this interaction are out of scope of this document. The IMS-AGW will use the \"tra-SCTP-association\" SDP attributes to determine which media streams need to be multiplexed into the same SCTP association.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.7.2\tIMS- in P-CSCF",
                            "text_content": "This subclause specifies the general procedures for the support of SDP in IMS- within the P-CSCF. For the use of the IMS- for specific capabilities, additional procedures are defined in subsequent subclauses.\nWhen the IMS- receives an SDP offer, it shall create a new SDP offer, based the contents of the received SDP offer, modified according to procedures and policies associated with specific capabilities that the IMS- is used for, according to capabilities supported by the IMS-AGW, and to provide the IP address and port information received by the IMS-AGW.\nWhen the IMS- receives an SDP answer, it shall create a new SDP answer, to respond to the originally received SDP offer, modified according to the same procedures and policies that were used to modify the SDP offer.\nThe P-CSCF may receive multiple provisional responses with an SDP answer due to forking of a request before the first final answer is received. For each SDP answer received in such subsequent provisional responses, the P-CSCF shall apply the procedure in this subclause.\nAfter the session is established, it is possible for both ends of the session to change the media connection data for the session. When the P-CSCF receives a SDP offer/answer where port number(s) or IP address(es) is/are included, there are three different possibilities:\n-\tIP address(es) or/and port number(s) have been added;\n-\tIP address(es) and port number(s) have been reassigned to the end points; or\nNOTE 1:\tIf necessary, the P-CSCF will request the IMS-AGW access gateway to release the resources related to the previously assigned IP address(es) and port number(s).\n-\tno change has been made to the IP address(es) and port number(s).\nNOTE 2:\tIn the particular case of  flows, port conversions also apply to the associated RTCP flows.\nWhen the P-CSCF acts as an IMS-, it acts as a B2BUA and modifies the SDP as described as described in 3GPP TS 23.334 [7F].\nIf the P-CSCF indicated support for end-to-access-edge media security using SDES during registration:\n1)\tupon receiving an SDP offer from the served UE containing an end-to-access-edge protected  based media, i.e. a  media stream:\n-\ttransported using the SRTP transport protocol as defined in RFC 3711 [169];\n-\twith an SDP crypto attribute as defined in RFC 4568 [168]; and\n-\twith the SDP \"a=3ge2ae:requested\" attribute;\nthe P-CSCF shall invoke IMS- procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and SRTP is concerned, and shall:\n-\tif the SDP offer contains a Transport Protocol Capability SDP attribute (see RFC 5939 [137]) offering:\na)\t\"RTP/SAVPF\" transport, e.g. \"a=tcap:x RTP/SAVPF\", replace this transport with \"RTP/AVPF\" within that attribute; and\nb)\t\"RTP/SAVP\" transport, e.g. \"a=tcap:x RTP/SAVP\", replace this transport with \"RTP/AVP\" within that attribute; and\n-\tstrip the SDP \"a=3ge2ae:requested\" attribute and the SDP crypto attribute from the end-to-access-edge protected  based media of the received SDP offer; and\n2)\tupon sending an SDP answer to the SDP offer from the served UE, for each end-to-access-edge protected  based media of the SDP offer from the served UE which is accepted in the SDP answer, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and SRTP is concerned and shall:\n-\tindicate the SRTP transport protocol according to RFC 3711 [169] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude a SDP crypto attribute according to RFC 4568 [168] and the profile defined in 3GPP TS 33.328 [19C].\nIf the served UE indicated support for end-to-access-edge media security using SDES, during registration, and the P-CSCF indicated support for end-to-access-edge 2ae-media security using SDES during registration:\n1)\tupon receiving an SDP offer from remote user with an  based media, for each end-to-access-edge protected  based media, i.e. a  based media except those for which the result of the SDP offer / answer exchange results in the application of an end-to-end media security mechanism, the P-CSCF shall invoke IMS- procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and  is concerned, and shall:\n-\tremove any SDP crypto attribute and any \"a=acap:x crypto\" SDP attribute (see RFC 5939 [137]);\n-\tif the SDP offer contains any potential configuration(s) using \"RTP/SAVPF\" transport or \"RTP/SAVP\" transport, as offered in corresponding Transport Protocol Capability SDP attribute(s) (see RFC 5939 [137]), (e.g. \"a=tcap:x RTP/AVPF a=pcfg:y t=x\"), remove those potential configuration(s);\nNOTE:\tKeeping the related \"RTP/SAVPF\" transport or \"RTP/SAVP\" transport within a Transport Protocol Capability SDP attribute that also contains other transports avoids a potential need to renumber other transports and adjust other potential configurations in the SDP offer and the actual configuration in the SDP answer accordingly.\n-\tif the SDP offer contains a Transport Protocol Capability SDP attribute (see RFC 5939 [137]) offering:\na)\t\"RTP/AVPF\" transport (e.g. \"a=tcap:x RTP/AVPF\"), replace this transport with \"RTP/SAVPF\" within that attribute; and\nb)\t\"RTP/AVP\" transport (e.g. \"a=tcap:x RTP/AVP\"), replace this transport with \"RTP/SAVP\" within that attribute;\n-\tif the SDP offer contains any potential configuration(s) with delete-attribute parameter(s) (see RFC 5939 [137]), (e.g. \"a=pcfg:1 a=-sm:1\"), remove those potential configuration(s);\n-\toffer SRTP transport protocol according to RFC 3711 [169] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude a SDP crypto attribute according to RFC 4568 [168] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude a SDP \"a=3ge2ae:applied\" attribute; and\n2)\tupon receiving an SDP answer to the SDP offer from remote user, for each accepted end-to-access-edge protected  based media, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and  is concerned, and shall remove the SDP crypto attribute.\nIf the P-CSCF indicated support for the end-to-access-edge media security for RTP media using DTLS-SRTP and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from the served UE containing an end-to-access-edge protected RTP based media, i.e. an RTP based media:\n-\ttransported using \"UDP/TLS/RTP/SAVP\" or \"UDP/TLS/RTP/SAVPF\" as the transport protocol according to RFC 5763 [222] and RFC 5764 [223];\n-\twith the SDP fingerprint attribute as defined in RFC 8122 [241];\n-\twith the SDP \"a=3ge2ae:requested\" attribute; and\n-\twith the SDP tls-id attribute as defined in RFC 8842 [240];\nthe P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and \"RTP/AVP\" or \"RTP/AVPF\" over UDP is concerned, and shall strip the SDP \"a=3ge2ae:requested\" attribute, the SDP fingerprint attribute and the SDP tls-id attribute from the RTP based media of the received SDP offer; and\n2)\tupon sending an SDP answer to the SDP offer from the served UE, for each end-to-access-edge protected RTP based media of the SDP offer from the served UE that is accepted in the SDP answer, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and \"RTP/AVP\" or \"RTP/AVPF\" over UDP is concerned and shall:\n-\tindicate the \"UDP/TLS/RTP/SAVP\" or \"UDP/TLS/RTP/SAVPF\" as the transport protocol according to RFC 5763 [222], RFC 5764 [223] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude the SDP tls-id attribute as defined in RFC 8842 [240].\nIf the served UE indicated support for the end-to-access-edge media security for RTP media using DTLS-SRTP and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for RTP media using DTLS-SRTP and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from remote UE with an RTP based media, for each end-to-access-edge protected RTP based media, i.e. an RTP based media except those for which the result of the SDP offer / answer exchange results in the application of an end-to-end security mechanism, the P-CSCF shall invoke IMS-ALG procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and \"RTP/AVP\" or \"RTP/AVPF\" over UDP is concerned, and shall:\n-\tremove any SDP fingerprint attribute;\n-\tremove any SDP tls-id attribute;\n-\toffer \"UDP/TLS/RTP/SAVP\" or \"UDP/TLS/RTP/SAVPF\" as the transport protocol according to RFC 5763 [222], RFC 5764 [223] and the profile defined in 3GPP TS 33.328 [19C];\n-\tif the SDP offer contains any potential configuration(s) with delete-attribute parameter(s) (see RFC 5939 [137]), (e.g. \"a=pcfg:1 a=-sm:1\"), remove those potential configuration(s);\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP \"a=3ge2ae:applied\" attribute; and\n-\tinclude the SDP tls-id attribute as defined in RFC 8842 [240]; and\n2)\tupon receiving an SDP answer to the SDP offer from remote user, for each accepted end-to-access-edge protected RTP based media, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and \"RTP/AVP\" or \"RTP/AVPF\" over UDP is concerned, and shall remove the SDP fingerprint attribute and SDP tls-id attribute.\nIf the P-CSCF indicated support for the end-to-access-edge media security for MSRP using  and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from the served UE containing an end-to-access-edge protected MSRP based media, i.e. an MSRP based media:\n-\ttransported using the MSRP over  transport protocol as defined in RFC 4975 [178] and RFC 6714 [214];\n-\twith the SDP fingerprint attribute as defined in RFC 8122 [241]; and\n-\twith the SDP \"a=3ge2ae:requested\" attribute;\nthe P-CSCF shall invoke IMS- procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and MSRP is concerned, and shall strip the SDP \"a=3ge2ae:requested\" attribute and the SDP fingerprint attribute from the end-to-access-edge protected MSRP based media of the received SDP offer; and\n2)\tupon sending an SDP answer to the SDP offer from the served UE, for each end-to-access-edge protected MSRP based media of the SDP offer from the served UE which is accepted in the SDP answer, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and MSRP is concerned and shall:\n-\tindicate the MSRP over  transport protocol according to RFC 4975 [178], RFC 6714 [214] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C].\nIf the served UE indicated support for the end-to-access-edge media security for MSRP using  and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for MSRP using  and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from remote user with an MSRP based media, for each end-to-access-edge protected MSRP based media, i.e. an MSRP based media except those for which the result of the SDP offer / answer exchange results in the application of an end-to-end security mechanism, the P-CSCF shall invoke IMS- procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and MSRP is concerned, and shall:\n-\tremove any SDP fingerprint attribute;\n-\toffer MSRP over  transport protocol according to RFC 4975 [178], RFC 6714 [214] and the profile defined in 3GPP TS 33.328 [19C];\n-\tif the SDP offer contains any potential configuration(s) with delete-attribute parameter(s) (see RFC 5939 [137]), (e.g. \"a=pcfg:1 a=-sm:1\"), remove those potential configuration(s);\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude the SDP \"a=3ge2ae:applied\" attribute; and\n2)\tupon receiving an SDP answer to the SDP offer from remote user, for each accepted end-to-access-edge protected MSRP based media, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and MSRP is concerned, and shall remove the SDP fingerprint attribute.\nIf the P-CSCF indicated support for the end-to-access-edge media security for BFCP using  and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from the served UE containing an end-to-access-edge protected BFCP based media, i.e. a BFCP based media:\n-\ttransported using the BFCP over  transport protocol as defined in RFC 4583 [108];\n-\twith the SDP fingerprint attribute as defined in RFC 8122 [241]; and\n-\twith the SDP \"a=3ge2ae:requested\" attribute;\nthe P-CSCF shall invoke IMS- procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and BFCP is concerned, and shall strip the SDP \"a=3ge2ae:requested\" attribute and the SDP fingerprint attribute from the BFCP based media of the received SDP offer; and\n2)\tupon sending an SDP answer to the SDP offer from the served UE, for each end-to-access-edge protected BFCP based media of the SDP offer from the served UE which is accepted in the SDP answer, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and BFCP is concerned and shall:\n-\tindicate the BFCP over  transport protocol according to RFC 4583 [108] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C].\nIf the served UE indicated support for the end-to-access-edge media security for BFCP using  and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for BFCP using  and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from remote UE with an BFCP based media, for each end-to-access-edge protected BFCP based media, i.e. a BFCP based media except those for which the result of the SDP offer / answer exchange results in the application of an end-to-end security mechanism, the P-CSCF shall invoke IMS- procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and BFCP is concerned, and shall:\n-\tremove any SDP fingerprint attribute;\n-\toffer BFCP over  transport protocol according to RFC 4583 [108] and the profile defined in 3GPP TS 33.328 [19C];\n-\tif the SDP offer contains any potential configuration(s) with delete-attribute parameter(s) (see RFC 5939 [137]), (e.g. \"a=pcfg:1 a=-sm:1\"), remove those potential configuration(s);\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude the SDP \"a=3ge2ae:applied\" attribute; and\n2)\tupon receiving an SDP answer to the SDP offer from remote user, for each accepted end-to-access-edge protected BFCP based media, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and BFCP is concerned, and shall remove the SDP fingerprint attribute.\nIf the P-CSCF indicated support for the end-to-access-edge media security for UDPTL over DTLS and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from the served UE containing an end-to-access-edge protected UDPTL based media, i.e. a UDPTL based media:\n-\ttransported using the UDPTL over DTLS transport protocol as defined in RFC 7345 [217] and RFC 8842 [240];\n-\twith the SDP fingerprint attribute as defined in RFC 8122 [241];\n-\twith the SDP \"a=3ge2ae:requested\" attribute; and\n-\twith the SDP tls-id attribute as defined in RFC 8842 [240];\nthe P-CSCF shall invoke IMS- procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and UDPTL is concerned, and shall strip the SDP \"a=3ge2ae:requested\" attribute and the SDP fingerprint attribute and the SDP tls-id attribute from the UDPTL based media of the received SDP offer; and\n2)\tupon sending an SDP answer to the SDP offer from the served UE, for each end-to-access-edge protected UDPTL based media of the SDP offer from the served UE which is accepted in the SDP answer, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and UDPTL is concerned and shall:\n-\tindicate the UDPTL over DTLS transport protocol according to RFC 7345 [217], RFC 8842 [240] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C]; and\n-\tinclude the SDP tls-id attribute as defined in RFC 8842 [240].\nIf the served UE indicated support for the end-to-access-edge media security for UDPTL using DTLS and certificate fingerprints during registration, and the P-CSCF indicated support for the end-to-access-edge media security for UDPTL using DTLS and certificate fingerprints during registration:\n1)\tupon receiving an SDP offer from remote UE with an UDPTL based media, for each end-to-access-edge protected UDPTL based media, i.e. a UDPTL based media except those for which the result of the SDP offer / answer exchange results in the application of an end-to-end security mechanism, the P-CSCF shall invoke IMS- procedures, will act as defined in 3GPP TS 23.334 [7F] as far as SDP and UDPTL is concerned, and shall:\n-\tremove any SDP fingerprint attribute;\n-\tremove any SDP tls-id attribute;\n-\toffer UDPTL over DTLS transport protocol according to RFC 7345 [217], RFC 8842 [240] and the profile defined in 3GPP TS 33.328 [19C];\n-\tif the SDP offer contains any potential configuration(s) with delete-attribute parameter(s) (see RFC 5939 [137]), (e.g. \"a=pcfg:1 a=-sm:1\"), remove those potential configuration(s);\n-\tinclude the SDP fingerprint attribute according to RFC 8122 [241] and the profile defined in 3GPP TS 33.328 [19C];\n-\tinclude the SDP \"a=3ge2ae:applied\" attribute; and\n-\tinclude the SDP tls-id attribute as defined in RFC 8842 [240]; and\n2)\tupon receiving an SDP answer to the SDP offer from remote user, for each accepted end-to-access-edge protected UDPTL based media, the P-CSCF will act as defined in 3GPP TS 23.334 [7F] as far as SDP and UDPTL is concerned, and shall remove the SDP fingerprint attribute and SDP tls-id attribute.\nAn IMS- may support ECN according to RFC 6679 [188].\nSubject to local policy, an IMS- shall prohibit the negotiation of ECN during SDP offer/answer exchanges associated with multimedia priority service by removing any ECN attribute \"a=ecn-capable-rtp\" from the SDP offer and shall not invoke ECN for SIP transactions associated with multimedia priority service.\nIf the IMS- receives an SDP offer containing the \"a=ecn-capable-rtp\" attribute as specified in RFC 6679 [188] and:\n-\tthe IMS- knows via configuration that the IMS-AGW supports transparently forwarding of ECN bits according to RFC 3168 [189];\n-\tthe IMS- knows via configuration that the (IMS) network handles ECN-marked packets properly; and\n-\tthe IMS- does not configure the IMS-AGW to transcode,\nthen the IMS- shall:\n-\tif the \"ecn-capable-rtp\" attribute includes both the \"ice\" initialisation method and other initialisation methods, remove the \"ice\" initialisation method from the \"ecn-capable-rtp\" attribute and add the attribute with this modification in the outgoing the SDP offer;\n-\tif the \"ecn-capable-rtp\" attribute only includes the \"ice\" initialisation method, do not include the \"ecn-capable-rtp\" attribute it outgoing SDP offer; and\n-\tif the \"ecn-capable-rtp\" attribute did not includes the \"ice\" initialisation method include the unmodified \"ecn-capable-rtp\" attribute within the outgoing SDP offer.\nIf the IMS- receives an SDP offer containing the ECN attribute \"a=ecn-capable-rtp\" as specified in RFC 6679 [188] and any of the following conditions apply:\n-\tthe IMS- knows by configuration that the IMS-AGW does not support transparent transport of ECN-marked packets;\n-\tthe IMS- knows by configuration that the (IMS) network does not properly handle ECN-marked packets; or\n-\tthe IMS- does not configure the IMS-AGW to transcode,\nthen the IMS- shall not include ECN attributes in the outgoing SDP offer, and, if the IMS- knows in addition via configuration that the IMS-AGW supports acting as an ECN endpoint and that the IMS- supports at least some of the initialisation methods offered within the \"a=ecn-capable-rtp\" attribute, the IMS- shall:\n-\tselect an initialisation method supported by the IMS-AGW; and\n-\treturn a SDP answer according to the capabilities of the IMS-AGW, containing the \"a=ecn-capable-rtp\" attribute,\nand the IMS- will configure the IMS-AGW to act as an end point for ECN.\nIf the IMS- receives an SDP answer containing the \"a=ecn-capable-rtp\" attribute it will instruct the IMS-AGW to transparently forward the ECN bits described in RFC 3168 [189].\nIf the IMS- receives a SDP offer without the \"a=ecn-capable-rtp\" attribute and all of the following conditions apply:\n-\tthe IMS- knows via configuration that the IMS-AGW supports acting as ECN endpoint; and\n-\tthe IMS- knows via configuration that the succeeding network supports ECN,\nthen the IMS- may include the \"a=ecn-capable-rtp\" attribute in the offer it forwards towards the succeeding node, indicating the related capabilities of the IMS-AGW.\nIf the IMS- inserted ECN attributes in the SDP offer and receives an SDP answer containing the \"a=ecn-capable-rtp\" attribute, the IMS- shall return the SDP answer to the preceding node removing the \"a=ecn-capable-rtp\" attribute, and will configure the IMS-AGW to act as an ECN endpoint.\nBased on operator policy, the P-CSCF shall remove OMR related SDP attributes before it sends an SDP offer or answer towards an UE, as specified in subclause 2.1.9 of 3GPP TS 29.079 [11D].\nThis subclause describes the P-CSCF procedures for supporting the scenario where IP address and/or port conversions occur at the IMS-AGW level in the media path between the UE and the backbone. Two types of address conversions are covered:\n-\tIP version interworking ((P)T-PT); and\n-\tIP address/port translation ((P)T).\nWhen the P-CSCF performs procedures for P-CSCF controlled (P)T and (P)T-PT, it shall modify the IP address(es) and port numbers (in case of (P)T) in SDP offers and answers, based on the IP address(es) and port number(s) received from the IMS-AGW, as described in subclause 6.7.2.1.\nFor terminating sessions the P-CSCF may towards a UE performing the functions of an external attached network indicate in the SDP offer alternate IP address versions (IPv4 and IPv6) by inserting two \"altc\" attributes as defined in RFC 6947 [228]. The order of setting the two IP addresses in the two \"altc\" SDP attributes shall be based on local policy. The insertion of the \"altc\" attributes is independent of their presence in the received SDP offer.\nNOTE 1:\tThe insertion of alternate IP versions allows avoiding the rejection of the SDP offer because of incompatible network address formats and when the request terminates in a corporate network enables the corporate network to avoid IP version interworking.\nNOTE 2:\tThe handling of alternative IP addresses between the IMS- and the TrGW is defined in 3GPP TS 23.334.\nWhen the P-CSCF performs procedures for hosted , it shall modify the IP address(es) and port numbers, based on the IP address(es) and number(s) received from the IMS-AGW, as described in subclause 6.7.2.1.\nWhen the P-CSCF acts as an IMS-, it acts as a B2BUA and modifies the SDP as described as described in 3GPP TS 23.334 [7F].\nThis subclause describes procedures of a P-CSCF to support ICE, as defined in RFC 8445 [289] and RFC 8839 [290].\nNOTE 1:\tIf no IMS-AGW is inserted on the media plane, a P-CSCF might transparently pass ICE related SDP attibutes, in order to support ICE between the UE and remote entities. The remaining procedures in this subclause apply to when the P-CSCF inserts an IMS- on the media plane.\nWhen the P-CSCF with attached IMS-AGW receives SDP candidate information from the offerer, it shall not forward the candidate information towards the answerer. When the P-CSCF receives SDP candidate information from the answerer, it shall not forward the candidate information towards the offerer. The remaining procedures in subclause 6.7.2.7.1 are optional.\nNOTE 2:\tAn P-CSCF that removes and/or does not provide ICE related SDP attributes (e.g. a=candidate) in the offer/answer exchange will cause the ICE procedures to be aborted and the address and port information in the m and c lines of the SDP offer will be used. If this address and port information contains the relayed candidate address of a STUN Relay server, as recommended by ICE, then an extra media relay server will be used for the session which is not necessary nor desirable.\nThe P-CSCF with attached IMS- performs separate ICE procedures towards the offerer and the answerer. The usage of ICE is negotiated separately with the offerer and answerer, and ICE may be applied independently at either side. Furthermore, the P-CSCF may be configured to apply ICE procedures only towards one network side, e.g. towards the IM CN subsystem it belongs to.\nNOTE 3:\tSince the P-CSCF is inserting an IMS-, it can choose to provide the  traversal mechanism defined in Annex F towards the UE. In such case the P-CSCF will not provide ICE support towards the UE, but the P-CSCF can still provide ICE support towards the core network in scenarios where ICE is used in the core network, e.g. to support  traversal for other access networks with no deploied IMS-ALGs.\nSince the P-CSCF is not located behind a , it does not request the IMS- to generate keep-alive messages even when acting as a full ICE entity. The P-CSCF only requests the IMS- to terminate and generate STUN messages used for the candidate selection procedures.\nSince the P-CSCF is not located behind a  the P-CSCF shall only include host candidates in SDP offers and answers generated by the P-CSCF.\nThis subclause describes the P-CSCF full ICE procedures for UDP based streams.\nWhen the P-CSCF receives an SDP offer including ICE candidate information, the P-CSCF shall send the candidate information for each UDP based stream received in the SDP offer towards the IMS-. If the SDP offer includes  candidate information for a UDP based stream, the P-CSCF may send such candidate information to the IMS-AGW, in addition to the UDP candidate information as defined in RFC 6544 [131]. The P-CSCF shall request the IMS- to reserve media- and STUN resources towards the offerer, based on the candidate information, in order to allow the IMS- to perform the necessary connectivity checks per the ICE procedures.\nIf the offerer is acting as an ICE controller entity the P-CSCF shall act as an ICE controlled entity in the direction towards the offerer. If the offerer is acting as an ICE controlled entity the P-CSCF shall act as an ICE controller entity in the direction towards the offerer.\nPrior to sending an SDP offer, the P-CSCF may choose to apply related ICE procedues, e.g. if it expects to interact with terminals applying procedures as described in subclause K.5.2, and if both the P-CSCF and IMS- also support ICE procedures. To invoking these ICE procedures, the P-CSCF shall request the IMS- to reserve media- and STUN resources towards the answerer for each UDP based media stream and include a host candidate attribute for each UDP based stream in the SDP offer, providing the reserved address and port at the IMS- as destination. The P-CSCF may also include host  candidate information for UDP based streams in the SDP offer as defined in RFC 6544 [131].\nThe P-CSCF shall always act as an ICE controller entity towards the answerer.\nNOTE: The host candidate address included by the P-CSCF in the generated SDP offer matches the c- and m line information for the associcated UDP stream in the SDP offer.\nWhen the P-CSCF receives an SDP answer including ICE candidate information, the P-CSCF shall send the candidate information for each UDP based stream received in the SDP answer towards the IMS-.\nThe P-CSCF shall request the IMS- to perform ICE candidate selection procedures towards the answerer. The P-CSCF shall request the IMS- to inform the P-CSCF, for each UDP stream, which candidate pair has been selected towards the answerer, once the candidate selection procedure towards the answerer has finished.\nIf the IMS- indicates to the P-CSCF that, for at least one UDP stream, the selected candidate pair does not match the c- and m- line address information for the associated UDP stream, exchanged between the P-CSCF and the answerer, and the P-CSCF acts an ICE controller entity towards the answerer, the P-CSCF shall send a new offer towards the answerer in order to allign the c- and m- lines address information with the chosen candidate pair for the associated UDP stream.\nWhen the P-CSCF generates an SDP answer for an offer that included ICE candidate information, the P-CSCF shall request the IMS- to reserve media- and STUN resources towards the offerer for each UDP based media stream and include an SDP host candidate attribute for each UDP based stream in the SDP answer, providing the reserved address and port at the IMS- as destination.\nThe P-CSCF shall in the generated SDP answer include host candidate information which matches the c- and m line information for the associated UDP stream in the SDP answer.\nThe P-CSCF shall request the IMS- to perform ICE candidate selection procedures towards the offerer. The P-CSCF shall request the IMS- to inform the P-CSCF, for each UDP stream, which candidate pair has been selected towards the offerer, once the candidate selection procedure towards the answerer has finished.\nIf the IMS- indicates to the P-CSCF that the selected candidate pair towards the offerer does not match the c- and m- line address information for the associated UDP stream, exchanged between the P-CSCF and the offerer, and the P-CSCF acts an ICE controller entity towards the offerer, the P-CSCF shall send an offer towards the offerer (which will now act as an answerer) in order to allign the c- and m- line address information with the chosen candidate pair for the associated UDP stream.\nWhen the P-CSCF is using ICE lite procedures for UDP based streams, the P-CSCF procedures are identical as described in subclause 6.7.2.7.2, with the following exceptions:\n-\tThe P-CSCF always acts as an ICE controlled entity towards the offerer and towards the answerer; and\n-\tThe P-CSCF requests the IMS- to perform ICE lite candidate selection procedures, as defined in RFC 8445 [289].\nThe P-CSCF shall disable ICE procedures for  based streams, i.e. streams where  is indicated as transport protocol in the m-line. Instead the P-CSCF will use the mechanism defined in RFC 4145 [83] for establishing  based streams, as defined in RFC 6544 [131].\nNOTE 1:\tHandling of  candidates for UDP based streams is described in subclause 6.7.2.7.2.\nNOTE 2:\tAn entity that supports ICE continues the ICE procedures for UDP based streams, even if no candidates are provided for  based streams.\nWhen the P-CSCF receives an SDP offer, the P-CSCF shall ignore the candidate attributes for  based streams. The P-CSCF shall not send the candidate information for  based streams towards the IMS-.\nWhen the P-CSCF generates an SDP offer the P-CSCF shall include an \"actpass\" setup attribute, as defined in RFC 4145 [83], for each  based stream, which will cause the answerer to initiate the  connections towards the IMS-. The P-CSCF shall not include any candidate attributes for  based streams in the SDP offer.\nSince the P-CSCF does not include candidates in the SDP offer towards the answerer, there are no ICE specific procedures when the P-CSCF receives an SDP answer.\nNOTE:\tIf the SDP answer contains candidate attributes for  based streams, the P-CSCF simply discards the candidate attributes.\nWhen the P-CSCF generates an SDP answer the P-CSCF shall include a \"passive\" setup attribute, as defined in RFC 4145 [83], for each  based stream, which will cause the offerer to initiate the  connections towards the IMS-. The P-CSCF shall not include any candidate attributes for  based streams in the SDP answer.\nAn IMS- may support procedures to modify SDP for transcoding purposes. The IMS- shall only apply those transcoding procedures if an attached IMS-AGW supports transcoding.\nUpon receipt of an SDP offer, based on local policy and SDP signalling inspection, the IMS- may decide to offer transcoding.\nTo offer transcoding at the IMS-AGW, the IMS- shall add codecs selected by local policy and supported by the IMS-AGW to the SDP offer. The local policy shall be in accordance with the requirements of clause T.2.\nUpon receipt of the corresponding SDP answer, the IMS- shall inspect the list of the codecs within the SDP answer and proceed as follows:\n-\tIf the list contains at least one of the codecs that was already contained in the previously received SDP offer, no transcoding at the IMS-AGW is required and the IMS- will configure the IMS-AGW accordingly. The IMS- shall remove from the SDP the codecs added to the original offer before forwarding the response to the offerer.\n-\tIf only the codecs inserted by the IMS- are contained in the answer, the IMS- will configure the IMS-AGW to transcode. The IMS- shall replace the received codecs in the SDP anwer with the codec it configured the IMS-AGW to use towards the SDP offerer´s direction.\nFor an IMS- acting as ATCF, the following applies in addition:\n-\tDuring an originating or terminating session establishment, for media using PS transport towards the UE, the IMS- (ATCF) should pass SDP offers without adding codecs to the SDP offer and pass SDP answers without modification to the contained codecs to avoid the potential need for transcoding in the IMS-AGW before the PS to CS access transfer; and\n-\tduring the PS to CS access transfer procedure, the IMS- (ATCF) shall preferentially select from the SDP offer it receives from the  server the codec already configured on the corresponding remote leg, if available.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.7.3\tIMS- in ISC gateway function",
                            "text_content": "When the ISC gateway function acts as an IMS-, it makes procedures as for an originating UA and terminating UA. The IMS- acts as a B2BUA. For the use of the IMS- for specific capabilities, additional procedures are defined in subsequent subclauses.\nNOTE:\tThe internal function of the IBCF as an IMS- is defined in 3GPP TS 29.162 [11A], and the capabilities are identical for the ISC gateway function.\nThe application gateway function shall act according to the procedures defined for the IBCF in subclause 6.7.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tExtensions within the present document",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tSIP methods defined within the present document",
                    "description": "",
                    "summary": "",
                    "text_content": "There are no SIP methods defined within the present document over and above those defined in the referenced IETF specifications.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2\tSIP header fields defined within the present document",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.2.0\tGeneral",
                            "text_content": "This subclause defines additional header fields.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.1\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.6\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.7\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.8\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.9\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.10\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.11\tDefinition of Restoration-Info header field",
                            "text_content": "IANA registry: Header Fields registry for the Session Initiation Protocol (SIP)\nHeader field name: Restoration-Info\nUsage: The Restoration-Info header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nIn case of a node failure there are cases where an upstream node can use information about a node failure. The upstream node can use this information for error reporting, or possibly for error recovery.\nAn upstream node can inform a downstream node about supported error recovery mechanisms. The downstream node can use this information for error recovery.\nThe Restoration-Info header field is applicable within a single private administrative domain or between different administrative domains.\nThe Restoration-Info header field is applicable when:\n1)\ta node has failed and the SIP node detecting this failure needs to inform a proxy in the administrative domain of the terminating user about the failure; or\n2)\ta proxy located in the private administrative domain of a user wants to send information about the subscriber  to a downstream proxy for error recovery.\nFor case 1) the SIP node detecting the failure can include the Restoration-Info header field set to the value \"noresponse\" in a 408 (Request Timeout) response to an INVITE request or a 504 (Server Time-out) response to a dialog forming request or standalone transaction,\nFor case 2) the Restoration-Info header field is included in an initial INVITE request with an \"\" header field parameter set to a value identifying the user.\nA SIP entity that does not receive a response from the next SIP node, may include a Restoration-Info header field in the error response to inform upstream nodes or networks about the downstream node failure. The upstream nodes or networks may use this information to either inform the originating user, to report the failure or to initiate restoration.\nA SIP entity in the home network domain may use the Restoration-Info header field to transport an  value to downstream SIP entities. The downstream SIP entity can use this information to initiate restoration for this user.\nThere are no specific procedures specified for a UA. A UAC in a B2BUA may use the information in the Restoration-Info header field for error reporting, or take this information into account when deciding on re-attempting the request. A UAS may include a Retoration-Info header field in an error respons to inform upstream nodes or networks about the downstream node failure.\nA SIP proxy that supports this extension and receives a request may insert a Restoration-Info header field prior to forwarding the request. The header field is populated with the  value received in the body of a DIAMETER request as per 3GPP TS 29.228 [14] within the quoted string .\nA SIP proxy that supports this extension and receives a request with the Restoration-Info header field, may retrieve the  value from the header field and use it to poulate a DIAMETER request as per 3GPP TS 29.214 [13D] for the purposes of performing PCRF restoration procedures.\nA SIP proxy that supports this extension and receives a 408 response with this header field present can use this information for restoration procedures or reporting.\nThe Restoration-Info header field can contain sensitive information. When the Restoration-Info header field contains the  value, it shall be sent only to trusted entities.\nA UE is not expected to receive this information.\nThe syntax for Restoration-Info header field is specified in table 7.2.11-1.\nTable 7.2.11-1: Syntax of Restoration-Info\n\nRestoration-Info      = \"Restoration-Info\" HCOLON pcrf-token / reason / generic-param\npcrf-token            = (\"\" / ext-type) EQUAL pcrf-param\npcrf-param            = quoted-string\nreason                = \"noresponse\"\next-type              = token\n\nThe Restoration-Info header field can be inserted by the neighbouring upstream SIP node to the SIP node that does not respond. The header field value \"noresponse\" can be used to inform the upstream SIP entity about the failure. The upstream SIP entity such as a 3GPP S-CSCF can use this information to initiate restoration procedures. The restoration can be in the form of a lower layer message to the terminating UE to indicate that the UE needs to perform a new SIP registration.\nThe Restoration-Info header field can be used to transport the  value from the S-CSCF to a P-CSCF. The S-CSCF obtains the  value as a string over the 3GPP Cx interface specified in 3GPP TS 29.228 [14]. The downstream node can include the  string received in a diameter request specified in 3GPP TS 29.214 [13D]. The receiver of this diameter request uses the information to find the UE and indicate that the UE needs to perform a new SIP registration.\nThe indication to the UE that it needs to perform a new SIP registration is sent over a lower layer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.12\tRelayed-Charge header field",
                            "text_content": "IANA registry: Header Fields registry for the Session Initiation Protocol (SIP)\nHeader field name: Relayed-Charge\nUsage: The Relayed-Charge header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nThe P-Charging-Vector header field is used to carry information relating to charging as it accumulates to various entities within the IM CN subsystem. The information within that header field is applicable to the current dialog or transaction at the point where it is received. Sometimes it is appropriate to carry this accumulated charging information, relating to the same dialog or transaction to other entities within the IM CN subsystem. The Relayed-Charge header field is defined to relay the current contents of the P-Charging-Vector header field as known by one entity to another entity with an indication of the Source entity.\nThe Relayed-Charge header field is applicable within a single private administrative domain or between different administrative domains where there is a trust relationship between the domains.\nThe Relayed-Charge header field is not included in a SIP message sent to another network if there is no trust relationship.\nThe Relayed-Charge header field is applicable whenever the P-Charging-Vector header field would be applicable, as defined by RFC 7315 [52].\nA SIP entity that receives a P-Charging-Vector header field may take appropriate fields from the received header field and encode them in the equivalent field within the Relayed-Charge header field, along with a value in the relay-source to indicate the relaying SIP entity.\nA SIP UA or SIP proxy that receives a SIP request or response that contains a Relayed-Charge header field can use the values, to produce charging records.\nA SIP proxy may remove the Relayed-Charge header field if it is known there is no intended collector of the Relayed-Charge header field subsequent in the path of the request or response.\nThis document does not specify any procedure at a UA located outside the administrative domain of a private network (e.g., PSTN gateway or conference mixer), with regard to the Relayed-Charge header field. UAs need not understand this header field.\nHowever, it might be possible that a UA be located within the administrative domain of a private network (e.g., a PSTN gateway, or conference mixer), and it may interact with the charging entities.\nIn this case, a UA may insert the Relayed-Charge header field in a SIP request or response when the next hop for the message is a proxy or UA located in the same administrative domain. Similarly, such a UA may use the contents of the Relayed-Charge header field in communicating with the charging entities.\nA SIP proxy that supports this extension and receives a request or response without the Relayed-Charge header field  insert a Relayed-Charge header field prior to forwarding the message.  The header is populated with one or more parameters, as described in the syntax, including but not limited to, a globally unique charging identifier.\nIf a proxy that supports this extension receives a request or response with the Relayed-Charge header field, it may retrieve the information from the header value to use with application-specific logic, i.e., charging. If the next hop for the message is within the trusted domain, then the proxy should include the Relayed-Charge header field in the outbound message. If the next hop for the message is outside the trusted domain, then the proxy may remove the Relayed-Charge header field.\nPer local application-specific logic, the proxy may modify the contents of the Relayed-Charge header field prior to sending the message.\nIt is expected as normal behavior that proxies within a closed network will modify the values of the Relayed-Charge header field and insert it into a SIP request or response.  However, these proxies that share this information shall have a trust relationship.\nIf an untrusted entity were inserted between trusted entities, it could potentially interfere with the charging correlation mechanism. Therefore, an integrity-protection mechanism such as IPsec or other available mechanisms shall be applied in order to prevent such attacks. Since each trusted proxy may need to view or modify the values in the Relayed-Charge header field, the protection should be applied on a hop-by-hop basis.\nThe syntax for Relayed-Charge header field is specified in table 7.2.12.1\nTable 7.2.12.1: Syntax of Relayed-Charge\n\nrelayed-charge      = \"Relayed-Charge\" HCOLON relayed-charge-list\nrelayed-charge-list = relayed-charge-item *(COMMA relayed-charge-item)\nrelayed-charge-item = relay-source HCOLON charge-params *( charge-params)\nrelay-source = \"PCSCF\" / \"SCSCF\" / \"IBCF\" / \"transitfunction\" / \"ICSCF\" / other-source\nother-source = token\n\ncharge-params are as defined for the P-Charging-Vector header field\n\n\nThe Relayed-Charge header field is used in situations where there is a need to carry charging information applicable to a dialog or transaction which is not directly pertinent to the next hop. So for example, at the S-CSCF the accumulation of the \"transit-ioi\" header field parameter for an incoming call is removed and a new accumulation of \"transit-ioi\" header field parameters started. The received transit-ioi header field parameter accumulation can be passed to the online charging server (acting as an AS in the IM CN subsystem) using the Relayed-Charge header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.13\tResource-Share header field",
                            "text_content": "IANA registry: Header Fields registry for the Session Initiation Protocol (SIP)\nHeader field name: Resource-Share\nUsage: The Resource-Share header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nThe P-CSCF in the 3GPP architecture is responsible for reserving resources in the media plane. The resources reservation procedure includes the possibility to allow resources to be shared between sessions involving the same UE. The possibility to share resources can be dependent on services controlled by application servers.\nSince the P-CSCF is service unaware the P-CSCF can benefit from receiving information from application servers regarding potential resource sharing options.\nThe Resource-Share header field is applicable within a single private administrative domain or between different administrative domains.\nThe P-CSCF can include the Resource-Share header field in the REGISTER request to indicate the support of receiving resource sharing information from application servers in the user's home network or in an subsequent request or response within an existing dialog created by an INVITE request to indicate that resource sharing no longer is possible.\nAn application server in a user's home network acting as a SIP proxy or a UA may use a Resource-Share header field to transport resource sharing information in any request or response destined for the served user.\nThe P-CSCF receiving a request or response destined for a served UE containing a Resource-Share header field can use the resource sharing information when reserving resources in the media plane.\nAn application server acting as a UA that supports this extension and receives a request or response destined for the served user containing an SDP offer or answer may insert a Resource-Share header field prior to forwarding the request or response. The value of the header field set to \"media-sharing\" or \"no-media-sharing\". When set to \"media-sharing\" the header field shall further be populated with the \"rules\" and \"timestamp\" header field parameters.\nWhen a P-CSCF supporting this extension receives a REGISTER request from a served UE, the P-CSCF may insert a Resource-Share header field prior to forwarding the REGISTER request. The value of the header field is then set to \"supported\".\nWhen the P-CSCF receives an SDP offer or answer from the served UE in a subsequent request or response within an existing dialog and if the SDP offer or answer contains information conflicting with the applied resource sharing, the P-CSCF may include the Resource-Share header field set to \"no-media-sharing\" in the request or response sent towards the application server.\nWhen an application server acting as a SIP proxy supporting this extension receives a request or response destined for the served user containing an SDP offer or answer, the SIP proxy may insert a Resource-Share header field prior to forwarding the request or response. The value of the header field set to \"media-sharing\" or \"no-media-sharing\". When set to \"media-sharing\" the header field shall further be populated with the \"rules\" and \"timestamp\" header field parameters.\nWhen the P-CSCF supporting this extension receives a request or response destined for the served UE containing the Resource-Share header field with the value \"media-sharing\", the P-CSCF may extract resource sharing rules from the \"rules\" header field parameter and use the extracted resource sharing rules to populate a DIAMETER request as per 3GPP TS 29.214 [13D] for the purposes of performing resource sharing procedures.\nThe Resource-Share header field does not contain any information that can disclose user information or the topology of nodes within an operator network.\nThe syntax for Resource-Share header field is specified in table 7.2.13.1\nTable 7.2.13.1: Syntax of Resource-Share\nresource-share      = \"Resource-Share\" HCOLON r-s-param\nr-s-param                 = r-s-supported / r-s-no-media-sharing / r-s-media-sharing / r-s-other\nr-s-supported             = \"supported\" [ origin] *( generic-param)\nr-s-no-media-sharing      = \"no-media-sharing\"  origin *( generic-param)\nr-s-media-sharing         = \"media-sharing\"  origin  resource-sharing-rules\ntimestamp *( generic-param)\nr-s-other                 = other-status *( generic-param)\nother-status              = token\norigin                    = \"session-initiator\" / \"session-receiver\" / other-origin\nother-origin              = token\nresource-sharing-rules    = \"rules\" EQUAL DQUOTE resource-sharing-rule *(COMMA\nresource-sharing-rule) DQUOTE\nresource-sharing-rule     = [ active-resource-sharing-rule ]\nactive-resource-sharing-rule    = new-sharing-key COLON [ existing-sharing-key-list ] \n                                COLON directionality *( COLON generic-rule-param-value )\nnew-sharing-key           = sharing-key\nexisting-sharing-key-list = sharing-key *(SLASH sharing-key)\ndirectionality            = \"UL\" / \"DL\" / \"UL-DL\" / other-directionality\nother-directionality      = token\nsharing-key               = token\ngeneric-rule-param-value  = token\ntimestamp                 = \"timestamp\" EQUAL 1*DIGIT\n\n\nThe values in the \"resource-share\" header field field are defined as follows:\n\"supported\"\tindicates that the sender would like to receive information about resource sharing options for sessions involving the UE identified by the \"+sip.instance\" header field parameter in the Contact header field.\n\"media-sharing\"\tindicates that an application server has determined that one or more media streams in the session can be subject for resource sharing.\n\"no-media-sharing\"\tindicates that an application server or the P-CSCF has determined that none of the media streams in the session are subjects for resource sharing.\nThe Resource-Share header field contains the \"origin\", \"rules\" and \"timestamp\" header field parameters.\nThe \"origin\" header field parameter is used to identify the source of the resource sharing information. The values in the \"origin\" header field field are defined as follows:\n\"session-initiator\"\tindicates that the application server or the P-CSCF that included the Resource-Share header field is serving the UE sending the initial INVITE request.\n\"session-receiver\"\tindicates that the application server or the P-CSCF that included the Resource-Share header field is serving the UE receiving the initial INVITE request.\nThe \"rules\" header field parameter carries one or more rules for resource sharing. Each rule is included in the same order as the corresponding m-line in the SDP offer/answer and consists of the following parts:\n\"new-sharing-key\"\tthis part is mandatory and identifies a media stream in an exisiting ongoing session or is a new sharing key value when the UE is not already involved in a session subject for resource sharing. The same value of the \"new-sharing-key\" can only appear in one media stream.\n\"existing-sharing-key-list\"\tthis part is optional and is only included in the INVITE request when the request is forked and if there are UEs (registered via a P-CSCF indicating that receiving resource sharing option information would be useful) already involved in sessions where the media-stream can be shared. Each value in the \"existing-sharing-list\" identifies a media stream in the ongoing session. In the forking case the \"new-sharing-key\" includes a new sharing key value to be used by UEs not involved in a session yet. The same value of a sharing key in the \"existing-sharing-key-list\" can only appear in one media stream.\n\"directionality\"\tthis part indicates in which direction resource sharing applies. \"UL\" indicates that resource sharing can be applied in the direction from the UE. \"DL\" indicates that resource sharing can be applied in the direction towards the UE. \"UL-DL\" indicates that resource sharing can be applied in both directions.\nThe \"timestamp\" header field parameter indicates when the application server determined the resource sharing rules and is used to determine the most applicable resource sharing option.\nNOTE:\tSince the media streams in several sessions can be shared race conditions can occur due to retransimissions of requests or responses carrying the Resource header field.\nThe value is a counter unique for each user and is increased and inserted in the header field each time the application server includes a Resource-Share header field in a request or response involving a UE registered by the user.\nWhen the P-CSCF receives a Resorce-Share header field, the P-CSCF extracts and stores the extracted resource sharing rule along with the value of the received \"timestamp\" header field as follows:\n1)\tif a resource sharing rule identified by the sharing key is not already stored, store the extracted resource sharing rule along with the value of the received \"timestamp\" header field;\n2)\tif a resource sharing rule identified by the sharing key is already stored with a lower timestamp value than the value of the received \"timestamp\" header field, replace the stored resource sharing rule with the extracted resource sharing rule along with the value of the received \"timestamp\" header field; or\n3)\tif a resource sharing rule identified by the sharing key is stored with a higher timestamp value than the value of the received \"timestamp\" header field, discard the extracted resource sharing rule.\nThe \"timestamp\" header field can be reset to \"0\" when none of the UEs registered by the user is involved in a session any longer.\nThe following subclauses describe examples on how:\n-\tthe P-CSCF indicates in the REGISTER request that P-CSCF supports receiving information about resource sharing;\n-\tthe application server sends information about potential resource sharing to the P-CSCF; and\n-\tthe P-CSCF extracts resource sharing information for media-streams.\nWhen P-CSCF receives a REGISTER request from a UE served by the P-CSCF, the P-CSCF can include a Resource-Share header field indicating that the P-CSCF supports receiving information about resource sharing.\nThe example 1 shows the coding when the P-CSCF indicates that the P-CSCF is interested in receiving information about resource sharing in a REGISTER request.\nEXAMPLE 1:\tResouce-Share: supported\nWhen the application server receives a request or response containing an initial SDP offer/answer with media streams subject for resource sharing, the application server includes the Resource-Share header field with the value \"media-sharing\" and includes a \"origin\" header field parameter set to \"session-initiator\" or \"session-receiver\" depending on if the application server is serving the user that initiated the session invitation or if the application server is serving the user receiving the session invitation.\nThe application server includes resource sharing information in a \"rules\" header field parameter with one resource sharing rule per media stream in the same order the corresponding m-line appears in the SDP. Each resource sharing rule is constructed as follows:\n1)\tif the media stream is subject for resource sharing, the application server:\n-\tincludes a \"new-sharing-key\" part;\n-\tif it is the INVITE request and the request will be sent to more than one UE, includes an \"existing-resource-sharing-list\" part containing one or more sharing keys already in use in other sessions involving UEs that potentially can receive the session invitation due to the forking of the INVITE request; and\n-\tincludes a \"directionality\" part indicating in which direction resources sharing can apply; or\n2)\tif the media stream can never be shared, includes an empty string.\nFinally, the application server includes a \"timestamp\" header field parameter with a value higher than included in any other Resource-Share header field involving any of the UEs registered by the user.\nThe example 1 shows the Resource-Share header field when included in the initial SDP answer on the originating side. The SDP answer contains two media streams and both media streams are subject to resource sharing.\nEXAMPLE 1:\tResouce-Share: media-sharing; session-initiator; rules=\"k1::UL, k20::UL-DL\"; timestamp=55688\nThe example 2 shows the Resource-Share header field when included in the initial SDP offer on the terminating side. The user has several UEs registered where three UEs are already involved in sessions with media streams subject to resource sharing. The SDP offer contains three media streams where only the first and third media stream is subject to resource sharing identified by K2,K3 and K4 for the first media stream and K21, K22 and k23 for the third media stream in already ongoing sessions. The fact that the second media stream is not subject to resource sharing is indicated as an empty string in second position in the comma delimited list of resource sharing rules in the \"rules\" header field parameter.\nEXAMPLE 2:\tResouce-Share: media-sharing; session-receiver; rules=\"k1:k2/k3/k4:UL,, k20:k21/k22/k23:UL-DL\"; timestamp=45678\nThe example 3 shows the Resource-Share header field when included in a SIP request or SIP response on the originating side when an application server indicates that resources can not be shared due to some service specific reason. This indication can be included already from the beginning of the session or at any point during a session if the SIP proxy or UA determines that resource sharing is not possible any longer.\nEXAMPLE 3:\tResource-Share: no-media-sharing; session-initiator\nWhen the P-CSCF receives an initial SDP answer destined for the served UE in a request or response containing the Resource-Share header field, the P-CSCF extracts the resource sharing rules for each media stream from the \"rules\" header field parameter in the same order that the corresponding m-line appear in the SDP. The P-CSCF stores and uses the value in the \"new-sharing-key\" to identify the resource sharing rule for a media stream.\nWhen the P-CSCF receives an initial SDP offer destined for the served UE in a request, the P-CSCF extracts the resource sharing rules for each media stream from the \"rules\" header field parameter in the same order that the corresponding m-line appear in the SDP. For each extracted resource sharing rule the P-CSCF checks if the UE is involved in any session using a sharing key in the \"existing-sharing-key-list\" to identify a media-stream, and\n-\tif the UE is involved in a session using a sharing key in the \"existing-sharing-key-list\" to identify a media-stream, the P-CSCF stores and uses that sharing key value to identify this resource sharing rule for the media stream in this session; or\n-\tif none of the sharing keys in the \"existing-sharing-key-list\" is used by any session involving the UE or if the \"existing-sharing-key-list\" is empty, the P-CSCF stores and uses the value in the \"new-sharing-key\" to identify this resource sharing rule for this media stream in this session.\nNOTE:\tBefore storing and using an extracted resource sharing rule the P-CSCF determines the applicability of the rule using the value of the \"timestamp\" header field parameter as described in subclause 7.2.13.8.4.\nIf the P-CSCF receives a Resource-Share header field with the value \"no-media-sharing\" for media streams where resource sharing is already applied due to receipt of a Resource-Share header field with the value \"media-sharing\" prior to receiving \"no-media-sharing\" value, the SIP proxy stops media sharing as specified in 3GPP TS 29.214 [13D] annex A.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.14\tDefinition of Service-Interact-Info header field",
                            "text_content": "IANA registry: Header Field Parameter Registry for the Session Initiation Protocol (SIP)\nHeader field name: Service-Interact-Info\nUsage: The Service Interact-Infor header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nOne subscriber can subscribe to one or more services provided by different ASs, and one service may be in conflict with one or more other service. Since the conflict can be subject to the status of the service execution, it cannot be avoided during the service provisioning phase.\nTo avoid such service conflicts, it is needed to have a mechanism to convey information about services executed between the ASes, and an AS can take such information into account to avoid conflicts when executing the local service logic.\nThe Service-Interact-Info header field is applicable within a trust domain. The Service-Interact-Info header field can be included in initial SIP requests and responses to initial SIP requests.\nAS can include the service identity which has been executed into the Service-Interact-Info header field and also insert service identities which is in conflict with the already executed service.\nUpon receiving a SIP message and executing service logic, the AS should take the information contained in the Service-Interact-Info header field into account. If\n1)\tthe executed services indicated in the Service-Interact-Info header field is in conflict with the local service logic; or\n2)\tthe local service logic indicated the Service-Interact-Info header field is inconflict with a previously executed service;\nthe AS should based on local policy decide whether or not to execute the local service.\nWhen certain service logic has been executed, the AS should include the corresponding service identity into the Service-Interact-Info header field. Additionally, the AS can also include identities of any service which may be in conflicit with the executed service.\nThere are no specific procedures specified for a UA. A UAC in a B2BUA can add a Service-Interact-Info header field into the SIP message, or insert a service identity into the Service-Interact-Info header field, or remove the Service-Interact-Info header field when sending a SIP message\nA SIP proxy that supports this extension can add a Service-Interact-Info header field into a SIP message, insert a service identity into the Service-Interact-Info header field, or remove the Service-Interact-Info header field when forwarding the SIP message.\nThe Service-Interact-Info header field can contain sensitive information. The Service-Interact-Info header field should be removed when sent outside the trust domain.\nA UE is not expected to receive the Service-Interact-Info header field.\nThe syntax for Service-Interact-Info header field is specified in table 7.2.14-1.\nTable 7.2.14-1: Syntax of Service-Interact-Info\n\nService-Interact-Info    = \"Service-Interact-Info\" HCOLON executed-service-params*(COMMA executed-service-params)\nexecuted-service-params  = executed-service / avoid-service\nexecuted-service         = \"executed-service\" EQUAL service-spec\navoid-service            = \"avoid-service\" EQUAL service-spec\nservice-spec             = service-id *( service-param)\nservice-id               = token/quoted-string\nservice-param            = generic-param\n\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.15\tDefinition of Cellular-Network-Info header field",
                            "text_content": "A User Agent (UA) supporting one or more cellular radio access technology (e.g. E-UTRAN) but using a non-cellular IP-CAN to access the IM CN subsystem can use this header field to relay information to its service provider about the radio cell identity of the cellular radio access network the UE most recently camped on. For example, a UE making an emergency call using the Evolved Packet Core (EPC) via Untrusted Wireless Local Access Network (WLAN) as IP-CAN to access the IM CN subsystem uses this header field to convey location information to its service provider.\nThe Cellular-Network-Info field is applicable within a trust domain. The Cellular-Network-Info header field can be included in any SIP requests and responses in which the P-Access-Network-Info header field is present.\nThe Cellular-Network-Info header field is populated with the following contents:\n1)\tthe access-type field is set to one of \"3GPP-GERAN\",\"3GPP-UTRAN-FDD\", \"3GPP-UTRAN-TDD\", \"3GPP-E-UTRAN-FDD\", \"3GPP-E-UTRAN-TDD\", \"3GPP-E-UTRAN-ProSe-UNR\", \"3GPP-NR-FDD\", \"3GPP-NR-TDD\", \"3GPP-NR-U-FDD\", \"3GPP-NR-U-TDD\", \"3GPP-NR-ProSe-L2UNR\", \"3GPP-NR-ProSe-L3UNR\", \"3GPP2-1X\", \"3GPP2-1X-HRPD\", \"3GPP2-UMB\", \"3GPP2-1X-Femto\" as appropriate to the additional access technology the information is provided about;\n2)\tif the access-type field is set to \"3GPP-GERAN\", a cgi-3gpp parameter set to the Cell Global Identity obtained from lower layers of the UE. The Cell Global Identity is a concatenation of MCC (3 decimal digits), MNC (2 or 3 decimal digits depending on MCC value), LAC (4 hexadeciaml digits) and CI (as described in 3GPP TS 23.003 [3]. The \"cgi-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\n3)\tif the access-type field is equal to \"3GPP-UTRAN-FDD\", or \"3GPP-UTRAN-TDD\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits), MNC (2 or 3 decimal digits depending on MCC value), LAC (4 hexadecimal digits) as described in 3GPP TS 23.003 [3] and the UMTS Cell Identity (7 hexadecimal digits) as described in 3GPP TS 25.331 [9A]), obtained from lower layers of the UE. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\n4)\tif the access-type field is equal to \"3GPP-E-UTRAN-FDD\" or \"3GPP-E-UTRAN-TDD\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits), MNC (2 or 3 decimal digits depending on MCC value), Tracking Area Code (4 hexadecimal digits when accessing to EPC and 6 hexadecimal digits when accessing to 5GCN) as described in 3GPP TS 23.003 [3]) and the E-UTRAN Cell Identity (ECI) (7 hexadecimal digits) as described in 3GPP TS 23.003 [3]). The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\nEXAMPLE:\tIf MCC is 111, MNC is 22, TAC is 33C4 and ECI is 76B4321, then Cellular-Network-Info header field looks like follows: Cellular-Network-Info: 3GPP-E-UTRAN-FDD;utran-cell-id-3gpp=1112233C476B4321\n5)\tif the access-type field is equal to \"3GPP-E-UTRAN-ProSe-UNR\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the  (3 decimal digits),  (2 or 3 decimal digits depending on MCC value) and the E-UTRAN Cell Identity (ECI) (7 hexadecimal digits) as described in 3GPP TS 23.003 [3] obtained from the ProSe-UE-to-network relay that the UE is connected to as specified in 3GPP TS 24.334 [8ZD]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\nEXAMPLE:\tIf  is 111,  is 22 and ECI is 76B4321, then Cellular-Network-Info header field looks like follows: Cellular-Network-Info: 3GPP-E-UTRAN-ProSe-UNR;utran-cell-id-3gpp=1112276B4321.\n6)\tif the access-type field is set to \"3GPP2-1X\", a ci-3gpp2 parameter set to the ASCII representation of the hexadecimal value of the string obtained by the concatenation of SID (16 bits), NID (16 bits), PZID (8 bits) and BASE_ID (16 bits) (see 3GPP2 C.S0005-D [85]) in the specified order. The length of the ci-3gpp2 parameter shall be 14 hexadecimal characters. The hexadecimal characters (A through F) shall be coded using the uppercase ASCII characters. If the UE does not know the values for any of the above parameters, the UE shall use the value of 0 for that parameter. For example, if the SID is unknown, the UE shall represent the SID as 0x0000;\nNOTE 1:\tThe SID value is represented using 16 bits as opposed to 15 bits as specified in 3GPP2 C.S0005-D [85].\nEXAMPLE:\tIf SID = 0x1234, NID = 0x5678, PZID = 0x12, BASE_ID = 0xFFFF, the ci-3gpp2 value is set to the string \"1234567812FFFF\".\n7)\tif the access-type field is set to \"3GPP2-1X-HRPD\", a ci-3gpp2 parameter set to the ASCII representation of the hexadecimal value of the string obtained by the concatenation of Sector ID (128 bits) and Subnet length (8 bits) (see 3GPP2 C.S0024-B [86]) and Carrier-ID, if available, (see 3GPP2 X.S0060 [86B]) in the specified order. The length of the ci-3gpp2 parameter shall be 34 or 40 hexadecimal characters depending on whether the Carrier-ID is included. The hexadecimal characters (A through F) shall be coded using the uppercase ASCII characters;\nEXAMPLE:\tIf the Sector ID = 0x12341234123412341234123412341234, Subnet length = 0x11, and the Carrier-ID=0x555444, the ci-3gpp2 value is set to the string \"1234123412341234123412341234123411555444\".\n8)\tif the access-type field is set to \"3GPP2-UMB\" 3GPP2 C.S0084-000 [86A], a ci-3gpp2 parameter is set to the ASCII representation of the hexadecimal value of the Sector ID (128 bits) defined in 3GPP2 C.S0084-000 [86A]. The length of the ci-3gpp2 parameter shall be 32 hexadecimal characters. The hexadecimal characters (A through F) shall be coded using the uppercase ASCII characters;\nEXAMPLE:\tIf the Sector ID = 0x12341234123412341234123412341234, the ci-3gpp2 value is set to the string \"12341234123412341234123412341234\".\n9)\tif the access-type field is set to \"3GPP2-1X-Femto\", a ci-3gpp2-femto parameter set to the ASCII representation of the hexadecimal value of the string obtained by the concatenation of femto MSCID (24 bit), femto CellID (16 bit), FEID (64bit), macro MSCID (24 bits) and macro CellID (16 bits) (3GPP2 X.P0059-200 [86E]) in the specified order. The length of the ci-3gpp2-femto parameter is 36 hexadecimal characters. The hexadecimal characters (A through F) are coded using the uppercase ASCII characters;\n10)\tthe cell-info-age parameter indicates the relative time since the information about the cell identity was collected by the UE. The value of the parameter is a number indicating seconds;\nNOTE 2:\tHow the UE determines the relative time is up to UE implementation per operator policy or local configuration.\n11)\tif the access-type field is equal to \"3GPP-NR-FDD\" or \"3GPP-NR-TDD\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits), MNC (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3], the NR Cell Identity (NCI) (9 hexadecimal digits) and optionally, the Network Identifier (NID) (11 hexadecimal digits) as specified in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\nNOTE 3:\tNID is included only if a cellular radio access network the UE most recently camped on is an SNPN identified by a combination of NID, MCC and MNC. The serving network type can be unambiguously deduced from the total length of the \"utran-cell-id-3gpp\" parameter.\n12)\tif the access-type field is equal to \"3GPP-NR-U-FDD\" or \"3GPP-NR-U-TDD\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits), MNC (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3], the NR Cell Identity (NCI) (9 hexadecimal digits) and optionally, the NID (11 hexadecimal digits) as specified in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212]; and\n13)\tif the access-type field is equal to \"3GPP-NR-ProSe-L2UNR\" or \"3GPP-NR-ProSe-L3UNR\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits), MNC (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3] and the NR Cell Identity (NCI) (9 hexadecimal digits) obtained from the 5G ProSe UE-to-network relay UE that the UE is connected to as specified in 3GPP TS 24.554 [8ZI]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212].\nA UA that supports this extension and is willing to disclose the related parameters may insert the Cellular-Network-Info header field in any SIP request or response in which the P-Access-Network-Info header field is allowed to be present.\nA SIP proxy shall not modify the value of the Cellular-Network-Info header field.\nA SIP proxy shall remove the Cellular-Network-Info header field when the SIP signaling is forwarded to a SIP server located in an untrusted administrative network domain.\nA SIP proxy that is providing services to the UA, can act upon the information present in the Cellular-Network-Info header field value, if present, to provide a different service depending on the network or the location through which the UA is accessing the server.A SIP proxy can determine the age of the cell identity information from the cell-info-age parameter. Depending on the recentness of the information the SIP proxy can perform different procedures.\nThe Cellular-Network-Info header field contains sensitive information. The Cellular-Network-Info header field should be removed when sent outside the trust domain.\nA UE is not expected to receive the Cellular-Network-Info header field.\nThe syntax for Cellular-Network-Info header field is specified in table 7.2.15-1.\nTable 7.2.15-1: Syntax of Cellular-Network-Info\n\nCellular-Network-Info   = \"Cellular-Network-Info\" HCOLON cellular-net-spec\ncellular-net-spec       = access-type *(SEMI cellular-access-info)\naccess-type             = \"3GPP-GERAN\" / \"3GPP-UTRAN-FDD\" / \"3GPP-UTRAN-TDD\" /\n\"3GPP-E-UTRAN-FDD\" / \"3GPP-E-UTRAN-TDD\" / \"3GPP2-1X-Femto\" /\n\"3GPP2-UMB\" / \"3GPP2-1X-HRPD\" / \"3GPP2-1X\" /\n\"3GPP-E-UTRAN-ProSe-UNR\" / \"3GPP-NR-FDD\" / \"3GPP-NR-TDD\" /\n\"3GPP-NR-U-FDD\" / \"3GPP-NR-U-TDD\" /\n\"3GPP-NR-ProSe-L2UNR\" / \"3GPP-NR-ProSe-L3UNR\" /\ntoken\ncellular-access-info              = access-info / cell-info-age\naccess-info                       = cgi-3gpp / utran-cell-id-3gpp /\nci-3gpp2 / ci-3gpp2-femto / extension-access-info\nextension-access-info             = generic-param\ncgi-3gpp                          = \"cgi-3gpp\" EQUAL (token / quoted-string)\nutran-cell-id-3gpp                = \"utran-cell-id-3gpp\" EQUAL (token / quoted-string)\nci-3gpp2                          = \"ci-3gpp2\" EQUAL (token / quoted-string)\nci-3gpp2-femto                    = \"ci-3gpp2-femto\" EQUAL (token / quoted-string)\ncell-info-age                     = \"cell-info-age\" EQUAL 1*9DIGIT\n\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.16\tPriority-Share header field",
                            "text_content": "IANA registry: Header Field Parameter Registry for the Session Initiation Protocol (SIP)\nHeader field name: Priority-Share\nUsage: The Priority-Share header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nThe Priority-Share header field is used to carry information relating to the possibility to use priority sharing. Priority sharing allows the P-CSCF to instruct the access gateway to use the same bearer for several sessions regardless of the priority of the sessions. When priority sharing is not allowed the P-CSCF will instruct the access gateway to not use priority sharing.\nThe Priority-Share header field is applicable within a single private administrative domain or between different administrative domains where there is a trust relationship between the domains.\nThe Priority-Share header field is not included in a SIP message sent to another network if there is no trust relationship.\nThe Priority-Share header field is applicable whenever an application/sdp MIME body would be applicable, as defined by RFC 3261 [26].\nA SIP UA or SIP proxy that receives a SIP request or response that contains a Priority-Share header field can use the values as appropriate.\nA SIP proxy may remove the Priority-Share header field according to local policy.\nAn application server acting as a UA that supports this extension and receives a request or response without the Priority-Share header field may insert a Priority-Share header field prior to forwarding the message. The header is populated as described in subclause 7.2.16.7.\nIf an application server acting as a UA that supports this extension receives a request or response with the Priority-Share header field, it may use the information from the header field for application-specific logic, i.e., resource reservation. If information from the header field is used, the header field shall be removed from the request or response.\nA SIP proxy that supports this extension and receives a request or response without the Priority-Share header field may insert a Priority-Share header field prior to forwarding the message. The header is populated as described in subclause 7.2.16.7.\nIf a proxy that supports this extension receives a request or response with the Priority-Share header field, it may use the information from the header field for application-specific logic, i.e., resource reservation. If information from the header field is used, the header field shall be removed from the request or response.\nThe Priority-Share header field does not contain any information that can disclose user information or the topology of nodes within an operator network.\nThe syntax for Priority-Share header field is specified in table 7.2.16.1\nTable 7.2.16.1: Syntax of Priority-Share\n\npriority-share      = \"Priority-Share\" HCOLON priority-share-options *( SEMI generic-param)\npriority-share-options = \"allowed\" / \"not-allowed\" / other-options\nother-options = token\n\n\nThe Priority-Share header field is included by an application server in the home network to inform about the possibility to share resources between session regardless of the priority of a session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.17\tDefinition of Response-Source header field",
                            "text_content": "IANA registry: Header Fields registry for the Session Initiation Protocol (SIP)\nHeader field name: Response-Source\nUsage: the Response-Source header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229,\nThe Response-Source header field is used to carry information related to the originator of an error response. The receiving entities may possibly use this information to decide a more appropriate procedure to invoke in regards with the failure response.\nThe Response-Source header field is applicable within a single private administrative domain or between different administrative domains where there is a trust relationship between the domains.\nA SIP UA or SIP proxy may include the Response-Source header field when responding to a SIP request with an error response to provide the information on who is the sender of the error response using the appropriate URN value as defined in subclause 7.2.17.7.\nA SIP UA or SIP proxy that receives a SIP response that contains a Response-Source header field can use the values as appropriate.\nA UA that supports this extension and rejects a request with an error response may insert a Response-Source header field within the response message. The header is populated as described in subclause 7.2.17.7.\nIf a UA that supports this extension receives a response with the Response-Source header field, it may take the information from the Response-Source header field into account when handling the response.\nNOTE:\tThe Response-Source header field is informational. A UA receiving a response containing a Response-Source header field does not perform any action contrary to the behavior specified in RFC 3261 [26] or other RFCs that specify UA actions upon receiving the specific response code.\nA proxy that supports this extension and receives a request for which its internal logic leads to reject the request with an error response may insert a Response-Source header field within the response message. The header is populated as described in subclause 7.2.17.7.\nIf a proxy that supports this extension receives a response with the Response-Source header field, it may use the information from the header field for its internal logic for error reponses handling.\nThe Response-Source header field will contain a URN identifying the sender that may be considered as sensitive information. The Response-Source header field may be removed when received from outside the trust domain depending on the network policy.\nThe ABNF syntax for Response-Source header field is specified in table 7.2.17.7-1.\nTable 7.2.17.7-1: Syntax of Response-Source header field\nResponse-Source\t= \"Response-Source\" HCOLON source-info\nsource-info\t\t= source-params *(SEMI source-params)\nsource-params\t= source-urn / token\nsource-urn\t\t= \"fe\" EQUAL LAQUOT source-urn-val RAQUOT\nsource-urn-val\t= 1*uric ; defined in RFC 3261\n\nThe source-urn-val of the source-urn parameter is coded as a URN. The URN identifies the SIP capable functional entity sending a SIP response.\nA URN is defined under the \"urn:3gpp\" label defined in RFC 5279 [253].\nThe extension of 3gpp-urn is:\nurn:3gpp:fe\nA formal reference to the publicly available specification:\n3GPP TS 24.229\nA short phrase describing the function of the extension:\nThe namespace \"fe\" is for indicating an IMS functional-entity. See the coding for the namespace extension ns-ext in table 7.2.17.7-2:\nTable 7.2.17.7-2: Syntax of urn:3gpp:fe\nns-ext\t\t= HCOLON \"fe\" HCOLON functional-entity\nfunctional-entity\t= fe-id *(\".\" fe-param)\nfe-id\t\t= \"ue\" / \"p-cscf\" / \"i-cscf\" / \"s-cscf\" / \"e-cscf\" / \"mgcf\" / \"bgcf\" / \"ibcf\" / \"trf\" / \"atcf\" / \"agcf\" / \"mrfc\" / \"lrf\" / \"msc-server\" / \"as\" / token\nfe-param\t\t= role / side / token\nrole\t\t= \"tas\" / \"scc-as\" / \"ip-sm-gw\" / \"pf-mcptt-server\" / \"cf-mcptt-server\" / \"ncf-mcptt-server\" / \"cms\" / \"gms\" / \"tads\" / \"iua\" / \"msc-server-ics\" / token\nside\t\t= \"orig\" / \"term\" / \"transit\"/ token\n\nContact information for the organization or person making the registration\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\nThe following fe-id values are defined:\n-\tue:\trepresents the UE;\n-\tp-cscf:\trepresents the P-CSCF;\n-\ti-cscf:\trepresents the I-CSCF;\n-\ts-cscf:\trepresents the S-CSCF;\n-\te-cscf:\trepresents the E-CSCF;\n-\tmgcf:\trepresents the MGCF;\n-\tbgcf:\trepresents the BGCF;\n-\tibcf:\trepresents the IBCF;\n-\ttrf:\trepresents the TRF;\n-\tatcf:\trepresents the ATCF;\n-\tagcf:\trepresents the AGCF;\n-\tmrfc:\trepresents the MRFC;\n-\tlrf:\trepresents the LRF;\n-\tmsc-server:\trepresents the MSC server; and\n-\tas:\trepresents the AS.\nThe following fe-param values are defined:\n-\trole:\na.\tmmtel-as:\tindicates that the AS is performing the MMTel services role;\nb.\tscc-as:\tindicates that the AS is performing the SCC AS role;\nc.\tip-sm-gw:\tindicates that the AS is performing the IP-SM-GW role;\nd.\tpf-mcptt-server:\tindicates that the AS is performing the participating MCPTT server role;\ne.\tcf-mcptt-server:\tindicates that the AS is performing the controling MCPTT server role;\nf.\tncf-mcptt-server:\tindicates that the AS is performing the non-controling MCPTT server role;\ng.\tcms:\tindicates that the AS is performing the configuration management server role;\nh.\tgms:\tindicates that the AS is performing the group management server role;\ni.\ttads:\tindicates that the AS is performing the terminating access domain selection role;\nj.\tiua:\tindicates that the AS is performing the ICS User Agent role; and\nk.\tmsc-server-ics:\tindicates that the MSC is performing the MSC server enhanced for ICS role.\n-\tside:\na.\torig:\tindicates that this functional entity is in the originating network;\nb.\tterm:\tindicates that this functional entity is in the terminating network;and\nc.\ttransit:\tindicates that this functional entity is in a transit network.\nAn example of the source-urn header field parameter value is: fe=<urn:3gpp:fe:p-cscf.orig>.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.18\tDefinition of Attestation-Info header field",
                            "text_content": "IANA registry: Header Fields registry for the Session Initiation Protocol (SIP)\nHeader field name: Attestation-Info\nUsage: The Attestation-Info header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nWhen a node has performed attestation of an identity in an incoming request or has attested the origin of the request, the node can inform a downstream node about what kind of attestation the node has performed. A downstream node such as an application server can use this information to provide the user with more accurate information regarding the attested identity.\nThe Attestation-Info header field is applicable within a single private administrative domain or between different administrative domains.\nThe Attestation-Info header field is applicable when:\n1)\ta node has performed attestation of an identity in an incoming request; or\n2)\thas performed gateway attestation of the request itself.\nCase 1) is when a node has knowledge about the originating identity and can attest this identity based on this knowledge.\nCase 2) is when a border node in a network receives a request where the border node has no relation to the originating user and the border node adds a value identifying the source of the request.\nA node in the originating network attesting the identity of the originating user can add an Attestation-Info header field to inform what relation the network has with the originating user. A node at a border of a network can add an identifier identifying from where the request was received. The Attestation-Info header field informs that this procedure has been performed.\nA downstream node can use the Attestation-Info header field when providing analytics functions to inform the terminating user the trust level of the originating identity.\nThere are no specific procedures specified for a UA.\nA SIP proxy that supports this extension and receives a request may as part of its procedures insert an Attestation-Info header field prior to forwarding the request. The header field is populated with a value as specified in Table 7.2.18-1.\nThe Attestation-Info header field does not contain any sensitive information.\nA UE is not expected to receive this information.\nThe syntax for Attestation-Info header field is specified in table 7.2.18-1.\nTable 7.2.18-1: Syntax of Attestation-Info\n\nAttestation-Info      = \"Attestation-Info\" HCOLON attestation-level / generic-param\nattestation-level     = (\"A\" / \"B\" / \"C\")\n\nThe meaning of the values \"A\", \"B\" and \"C\" is as defined in RFC 8588 [261] and references therein.\nA node in the originating network, such as a 3GPP S-CSCF or an application server, can when attesting the identity of an originating user insert an Attestation-Info header field to provide information on the relation the network has to the originating user. This information can be used when inserting an Identity header field, or can be taken into account when informing the terminating user about the identity of the originating user.\nAn edge node, such as a 3GPP entry IBCF, receiving a message withouth any Identity header field can use the Attestation-Info header field to inform that the edge node has performed a gateway attestation as specified in RFC 8588 [261].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.19\tDefinition of Origination-Id header field",
                            "text_content": "IANA registry: Header Fields registry for the Session Initiation Protocol (SIP)\nHeader field name: Origination-Id\nUsage: The Origination-Id header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nWhen a node has performed attestation of an identity in an incoming request the node can add a unique identifier to inform about who attested the identity. When a node has attested from where it received the request, the node can send a unique identifier identifying from where the request was received. A downstream node such as an application server can use this information to provide the user with more accurate information regarding the attested identity.\nThe Origination-Id header field is applicable within a single private administrative domain or between different administrative domains.\nThe Origination-Id header field is applicable when:\n1)\ta node has performed attestation of an identity in an incoming request; or\n2)\thas performed gateway attestation of the request itself.\nCase 1) is when a node has knowledge about the originating identity and can attest this identity based on this knowledge.\nCase 2) is when a border node in a network receives a request where the border node has no relation to the originating user and the border node adds a value identifying the source of the request.\nA node in the originating network attesting the identity of the originating user can add an Origination-Id header field to identify the node that performed the identity attestation. This value is based on local configuration and regulation. A node at a border of a network can add an Origination-Id header field with a unique identifier identifying from where the request was received.\nA downstream node can use the Origination-Id header field when providing analytics functions to inform the terminating user the trust level of the originating identity.\nThere are no specific procedures specified for a UA.\nA SIP proxy that supports this extension and receives a request may as part of its procedures insert an Origination-ID header field prior to forwarding the request. The header field is populated with a value as specified in Table 7.2.19-1.\nThe Origination-Id header field can contain a unique value identifying a specific node in the network. A network operator may want to remove this information before transporting to an utrusted entity.\nA UE is not expected to receive this information.\nThe syntax for Origination-Id header field is specified in table 7.2.19-1.\nTable 7.2.19-1: Syntax of Origination-Id\n\nOrigination-Id        = \"Origination-Id\" HCOLON originator / token\noriginator            = UUID\n\nThe format of the UUID is as defined as in RFC 4122.\nA node in the originating network, such as a 3GPP S-CSCF or an application server, can when attesting the identity of an originating user insert an Origination-Id header field to provide information on who attested the identity of the originating user. This information can be used when inserting an Identity header field, or can be taken into account when informing the terminating user about the identity of the originating user.\nAn edge node, such as a 3GPP entry IBCF, receiving a message without any Identity header field can use the Origination-Id header field to a unique identifier of from where the request is received.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.20\tDefinition of Additional-Identity header field",
                            "text_content": "IANA registry: Header Fields registry for the Session Initiation Protocol (SIP)\nHeader field name: Additional-Identity\nUsage: The Additional-Identity header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nThe Additional-Identity header field is used to convey an originating identity on the originating side or a target identity on the terminating side where the served user is not registering this identity but is authorized by the network to use this identity.\nOn the originating side, when a user has requested such an additional identity to be used for an originating request, the UA can insert this identity in the Additional-Identity header field. When the identity in the Additional-Identity header field has been authorized by the network, the network can remove, ignore or use the Additional-Identity header field. A downstream node such as an application server or UA can use this information to identify the not registered identity on whose behalf the originating user is sending the request.\nOn the terminating side, when a user is contacted with such an additional identity, and the network decides to inform the terminating user that the user was contacted with this identity, the network can insert this identity in the Additional-Identity header field. A terminating request to the UA can hence contain the Additional-Identity header field with the identity used to reach the terminating user.\nThe Additional-Identity header field is applicable within a single private administrative domain or between different administrative domains.\nThe Additional-Identity header field is applicable when:\n-\tan originating UA wants to indicate the identity to be used as an originating identity in a multi-identity service;\n-\ta node performs the multi-identity service for an originating UA in an incoming request;\n-\ta node has performed the multi-identity service for a terminating identity in an incoming request; or\n-\ta terminating UA wants to identify the identity used to contact the terminating user.\nA SIP UA or SIP proxy may include the Additional-Identity header field to indicate:\n-\tin the originating network, the identity to be used for originating requests when the originating user is subscribed to the multi-identity service; and\n-\tin the terminating network, the identity to which the terminating user is contacted when the terminating user is subscribed to the multi-identity service.\nA SIP UA that supports this extension may as part of its procedures insert the Additional-Identity header field prior to sending the request. The header field is populated with a value as specified in table 7.2.20.7-1.\nA SIP proxy that supports this extension and receives a request may as part of its procedures insert an Additional-Identity header field prior to forwarding the request. The header field is populated with a value as specified in table 7.2.20.7-1.\nWithin a 3GPP environment, the Additional-Identity header field is exchanged between a SIP UA and a SIP proxy in the same network. The Additional-Identity header field may also be exchanged between networks when there is a trust relationship for the Additional-Identity header field.\nA functional entity at the boundary of the trust domain will remove the Additional-Identity header field when SIP signalling crosses the boundary of the trust domain.\nThe syntax for Additional-Identity header field is specified in table 7.2.20.7-1.\nTable 7.2.20.7-1: Syntax of the Additional-Identity Header Field\n\nAdditional-Identity  = \"Additional-Identity\" HCOLON id-spec / token\nid-spec              = name-addr *(SEMI (id-param))\nid-param             = generic-param\n\n\nA node in the originating network, such as a UA, can use the Additional-Identity header field to provide to a multi-identity service the information about which identity of the originating user is to be used for this originating request.\nA node in the terminating network, such as an application server, when performing the multi-identity service for a terminating user, can insert the Additional-Identity header field to provide information about which identity of the terminating user is to be used as a contacted identity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.21\tDefinition of Priority-Verstat header field",
                            "text_content": "IANA registry: Header Fields registry for the Session Initiation Protocol (SIP)\nHeader field name: Priority-Verstat\nUsage: The Priority-Verstat header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nWhen a node has performed verification of a Resource-Priority header field and of a header field value \"psap-callback\" of a Priority header field (if present) in an incoming request, the node can inform a downstream node whether the Resource-Priority header field and the header field value \"psap-callback\" of the Priority header field (if present) was populated by an authorized entity and can be trusted. A downstream node can use use this information to determine whether the call should be treated according to the priority level indicated in the Resource-Priority header field and (if the Priority header field was present) whether the call should be treated as emergency call back.\nThe Priority-Verstat header field is applicable within a single private administrative domain or between different administrative domains.\nThe Priority-Verstat header field is applicable when a node has performed authentication of a Resource-Priority header field and a header field value \"psap-callback\" of a Priority header field in an incoming request.\nThe Priority-Verstat header field is used to indicate the verification status of the Resource-Priority header field and optionally the header field value \"psap-callback\" of the Priority header field.\nThere are no specific procedures specified for a UA.\nA SIP proxy that supports this extension and receives a request may as part of its procedures insert a Priority-Verstat header field prior to forwarding the request. The header field is populated as specified in table 7.2.21-1.\nA UE is not expected to receive this information.\nThe syntax for Priority-Verstat header field is specified in table 7.2.21-1.\nTable 7.2.21-1: Syntax of Priority-Verstat\n\nPriority-Verstat = \"Priority-Verstat\" HCOLON verstat-value\nverstat-value    = \"RPH-Validation-Passed\" / \"RPH-Validation-Failed\" / \"No-RPH-Validation\" /\n                   \"ECB-RPH-Validation-Passed\" / \"ECB-RPH-Validation-Failed\" / \"No-ECB-RPH-Validation\" / other-value\nother-value      = token\n\nThe Priority-Verstat header field is used in networks which have requirements on authentication of a Resource-Priority header field and a header field value \"psap-callback\" of a Priority header field to authenticate content of the Resource-Priority header field and the header field value \"psap-callback\" of the Priority header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.22\tDefinition of Handover-Info header field",
                            "text_content": "Editor's note: [WI: TEI18, CR 6585] as per RFC 5727 an IETF expert review is needed in order to obtain the IANA registration of this header field.\nIANA registry: Header Fields registry for the Session Initiation Protocol (SIP)\nHeader field name: Handover-Info\nUsage: The Handover-Info header field is used only for informative purposes.\nHeader field specification reference: 3GPP TS 24.229, http://www.3gpp.org/ftp/Specs/archive/24_series/24.229/\nThe Handover-Info header field can be used in two situations:\n-\tWhen a border node detects that a UE has changed network, the node can inform downstream nodes about the change of network serving the UE. The Handover-Info header field can in this situation contain an indication that re-authentication is needed.\n-\tA service node that has been aware that a UE during an ongoing session has reregistered, e.g., to change encryption, can use the Handover-Info header field to inform downstream nodes about the role of the terminating UE in the original session set-up.\nThe Handover-Info header field is applicable within a single private administrative domain.\nThe Handover-Info header field is used to indicate that the UE needs to be re-authenticated using mechanisms defined in 3GPP TS 24.229, and to inform when a re-authentication of a UE entering the mobile network has been completed. The Handover-Info header field can be used to inform the UE of the role in a call, fulfilling legal requirements.\nThere are no specific procedures specified for a UA.\nA SIP proxy that supports this extension and receives a request may as part of its procedures insert a Handover-Info header field prior to forwarding the request. The header field is populated as specified in table 7.2.22-1.\nThe header field when reaching a UE only contains information of whether the UE initiated or terminated the call which does not have any security or privacy impacts.\nThe syntax for Handover-Info header field is specified in table 7.2.22-1.\nTable 7.2.22-1: Syntax of Handover-Info\n\nHandover-Info   = \"Handover-Info\" HCOLON info-element / role\ninfo-element    = \"authentication-needed\" / \"handover-completed\" /\n                   other-value\nrole            = \"Role\" EQUAL \"session-initiator\" / \"session-receiver\"\nother-value     =  token\n\nThe Handover-Info header field is used in networks where UEs can roam into other networks but where the SIP core nodes are located in the home network. The header field is used to inform the core nodes in the home network that a re-authentication of the UE is needed. The home network can further use the header field to update nodes supporting the roaming UE about SIP session details.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.2A\tExtensions to SIP header fields defined within the present document",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.2A.1\tExtension to -Authenticate header field",
                            "text_content": "This extension defines a new authentication parameter (auth-param) for the -Authenticate header field used in a 401 (Unauthorized) response to the REGISTER request. For more information, see RFC 9110 [281] subclause 11.3 and clause A.\nThe syntax for for auth-param is specified in table 7.2A.1.\nTable 7.2A.1: Syntax of auth-param\n\nauth-param\t= 1#( integrity-key / cipher-key )\nintegrity-key\t= \"ik\" EQUAL ik-value\ncipher-key\t= \"ck\" EQUAL ck-value\nik-value\t= LDQUOT *(HEXDIG) RDQUOT\nck-value\t= LDQUOT *(HEXDIG) RDQUOT\n\n\nThis authentication parameter will be used in a 401 (Unauthorized) response in the -Authenticate header field during UE authentication procedure as specified in subclause 5.4.1.\nThe S-CSCF appends the integrity-key parameter (directive) to the .-Authenticate header field in a 401 (Unauthorized) response. The P-CSCF stores the integrity-key value and removes the integrity-key parameter from the header field prior to forwarding the response to the UE.\nThe S-CSCF appends the cipher-key parameter (directive) to the -Authenticate header field in a 401 (Unauthorized) response. The P-CSCF removes the cipher-key parameter from the header field prior to forwarding the response to the UE. In the case ciphering is used, the P-CSCF stores the cipher-key value.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.2\tExtension to Authorization header field",
                            "text_content": "This extension defines new dig-resp parameters for the Authorization header field used in REGISTER requests. For more information, see RFC 9110 [281] subclause 11.3 and clause A.\nThe syntax of integrity-protected for the Authorization header field is specified in table 7.2A.2.\nTable 7.2A.2: Syntax of integrity-protected for Authorization header field\n\ndig-resp =/ \"integrity-protected\" EQUAL (\"yes\" / \"no\" / \"tls-pending\" / \"tls-yes\" / \"ip-assoc-pending\" / \"ip-assoc-yes\" / \"auth-done\" / \"tls-connected\")\n\n\nThis authentication parameter is inserted in the Authorization header field of all the REGISTER requests. The value of the \"integrity-protected\" header field parameter in the auth-param parameter is set as specified in subclause 5.2.2. This information is used by S-CSCF to decide whether to challenge the REGISTER request or not, as specified in subclause 5.4.1.\nThe values in the \"integrity-protected\" header field field are defined as follows:\n\"yes\":\tindicates that a REGISTER request received in the P-CSCF is protected using an IPsec security association and IMS AKA is used as authentication scheme.\n\"no\":\tindicates that a REGISTER request received in the P-CSCF is not protected using an IPsec security association and IMS AKA is used as authentication scheme, i.e. this is an initial REGISTER request with the Authorization header field not containing a challenge response.\n\"tls-yes\":\tindicates that a REGISTER request is received in the P-CSCF protected over a  connection and the Session ID, IP address and port for the  connection are already bound to a private user identity. The S-CSCF will decide whether or not to challenge such a REGISTER request based on its policy. This is used in case of SIP digest with .\n\"tls-pending\":\tindicates that a REGISTER request is received in the P-CSCF protected over a  connection and the Session ID, IP address and port for the  connection are not yet bound to a private user identity. The S-CSCF shall challenge such a REGISTER request if it does not contain an Authorization header field with a challenge response or if the verification of the challenge response fails. This is used in case of SIP digest with .\n\"ip-assoc-yes\":\tindicates that a REGISTER request received in the P-CSCF does map to an existing IP association in case SIP digest without  is used.\n\"ip-assoc-pending\":\tindicates that a REGISTER request received in the P-CSCF does not map to an existing IP association, and does contain a challenge response in case SIP digest without  is used.\n\"auth-done\":\tindicates that a REGISTER request is sent from an entity that is trusted and has authenticated the identities used in the REGISTER request. An example for such an entity is the  server enhanced for IMS centralized services. The S-CSCF shall skip authentication.\n\"tls-connected\":\tindicates that a REGISTER request received in the eP-CSCF is issued by a UE over a  session established prior to the registration and IMS AKAv2 is used as authentication scheme. This integrity-protected flag value is used for example in case of WebRTC over IMS when the Authentication is IMS-AKA as defined in 3GPP TS 24.371 [8Z].\nNOTE 1:\tIn case of SIP digest with  is used, but the REGISTER request was not received over , the P-CSCF does not include an \"integrity-protected\" header field parameter in the auth-param to indicate that an initial REGISTER request was not received over an existing  session. The S-CSCF will always challenge such a REGISTER request.\nNOTE 2:\tIn case of SIP digest without  is used, but the REGISTER request was not received over , the P-CSCF does not include an \"integrity-protected\" header field parameter in the auth-param to indicate that the REGISTER request does not map to an existing IP association, and does not contain a challenge response. The S-CSCF will always challenge such a REGISTER request.\nNOTE 3:\tThe value \"yes\" is also used when an initial REGISTER request contains an Authorization header field with a challenge response as in this case the IPsec association is already in use, and its use by the UE implicitly authenticates the UE. This is a difference to  case where the use of  alone does not yet implicitly authenticates the UE. Hence in the  case, for an initial REGISTER request containing an Authorization header field with a challenge response the value \"tls-pending\" and not \"tls-yes\" is used.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.3\tTokenized-by header field parameter definition (various header fields)",
                            "text_content": "The \"tokenized-by\" header field parameter is an extension parameter appended to encrypted entries in various SIP header fields as defined in subclause 5.10.4.\nThe syntax for the \"tokenized-by\" header field parameter is specified in table 7.2A.3:\nTable 7.2A.3: Syntax of tokenized-by-param\n\nrr-param =  tokenized-by-param / generic-param\nvia-params =  via-ttl / via-maddr\n/ via-received / via-branch\n/ tokenized-by-param / via-extension\ntokenized-by-param = \"tokenized-by\" EQUAL hostname\n\n\nThe BNF for rr-param and via-params is taken from RFC 3261 [26] and modified accordingly.\nThe \"tokenized-by\" header field parameter is appended by IBCF (THIG) after all encrypted strings within SIP header fields when network configuration hiding is active. The value of the header field parameter is the domain name of the network which encrypts the information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.4\tP-Access-Network-Info header field",
                            "text_content": "The P-Access-Network-Info header field is extended to include specific information relating to particular access technologies.\nThe syntax of the P-Access-Network-Info header field is described in RFC 7315 [52] and RFC 7913 [234]. There are additional coding rules for this header field depending on the type of IP-CAN, according to access technology specific descriptions.\nTable 7.2A.4 describes the 3GPP-specific extended syntax of the P-Access-Network-Info header field defined in RFC 7315 [52] and RFC 7913 [234].\nTable 7.2A.4: Syntax of extended P-Access-Network-Info header field\n\ndaylight-saving-time   = \"daylight-saving-time\" EQUAL quoted-string\nUE-local-IP-address = \"UE-local-IP-address\" EQUAL DQUOTE ( IPv4address / IPv6reference ) DQUOTE\nUDP-source-port = \"UDP-source-port\" EQUAL port\nTCP-source-port = \"TCP-source-port\" EQUAL port\nePDG-IP-address = \"ePDG-IP-address\" EQUAL DQUOTE ( IPv4address / IPv6reference ) DQUOTE\naccess-class    =/ \"untrusted-non-3GPP-VIRTUAL-EPC\" / \"VIRTUAL-no-PS\" / \"WLAN-no-PS\" /\n\"3GPP-NR\" / \"3GPP-NR-U\" / \"3GPP-NR-SAT\"\naccess-type     =/ \"3GPP-E-UTRAN-ProSe-UNR\" / \"xDSL\" / \"3GPP-NR-FDD\" / \"3GPP-NR-TDD\" /\n\"IEEE-802.11ac\" / \"3GPP-NR-U-FDD\" / \"3GPP-NR-U-TDD\" / \"3GPP-NR-SAT\" / \"3GPP-NR-ProSe-L2UNR\" / \"3GPP-NR-ProSe-L3UNR\"\neps-fb          = \"eps-fallback\" EQUAL \"0\" / \"1\"\n\n\nThe daylight-saving-time and the UE-local-IP-address are instances of generic-param from the current extension-access-info component of the P-Access-Network-Info header field defined in RFC 7315 [52] and RFC 7913 [234].\nThe presence of the \"network-provided\" header field parameter defined in RFC 7315 [52] indicates a P-Access-Network-Info header field is provided by the P-CSCF, S-CSCF, the AS, the  server enhanced for ICS, the  server enhanced for SRVCC using SIP interface, the  server enhanced for DRVCC using SIP interface or by the MGCF. The content can differ from a P-Access-Network-Info header field without this parameter which is provided by the UE.\nThe \"network-provided\" header field parameter can be used with both \"access-type\" and \"access-class\" constructs. The \"access-class\" construct is provided for use where the value is not known to be specific to a particular \"access-type\" value, e.g. in the case of some values delivered from the PCRF. The \"access-class\" field can be set only by the P-CSCF, the  server enhanced for ICS, the  server enhanced for SRVCC using SIP interface, the  server enhanced for DRVCC using SIP interface or by the AS. The \"network-provided\" header field parameter can be set only by the P-CSCF, S-CSCF, the AS, the  server enhanced for ICS, the MSC server enhanced for SRVCC using SIP interface, the  server enhanced for DRVCC using SIP interface or by the MGCF. The \"local-time-zone\" parameter, the \"daylight-saving-time\" parameter, the \"gstn-location\" parameter, the \"\" value of access-type field and the \"untrusted-non-3GPP-VIRTUAL-EPC\" value of access-class field shall not be inserted by the UE.\nThe \"local-time-zone\" parameter defined in RFC 7315 [52] indicates the time difference between local time and UTC of day. For 3GPP accesses, the \"local-time-zone\" parameter represents the time zone allocated to the routing area or traffic area which the UE is currently using. As the edge of such areas may overlap, there can be some discrepancy with the actual time zone of the UE where the UE is in the near proximity to a time zone boundary.\nThe \"daylight-saving-time\" parameter indicates by how much the local time of the UE has been adjusted due to the use of daylight saving time. Providing the \"daylight-saving-time\" parameter is optional.\nThe \"UE-local-IP-address\" parameter indicates the UE local IP address.\nNOTE:\tThe UE local IP address is the source address on the outer header of the IPsec tunnel packets received by the ePDG on the S2b interface.\nThe \"UDP-source-port\" parameter indicates that the IKEv2 messages exchanged between the UE and the ePDG are encapsulated in the UDP messages according to IETF RFC 3948 [63A]. The value of the \"UDP-source-port\" parameter is the UDP source port of the UDP messages:\n-\treceived by the ePDG; and\n-\tencapsulating the IKEv2 messages.\nThe \"TCP-source-port\" parameter indicates that the IKEv2 messages exchanged between the UE and the ePDG are transported using the firewall traversal tunnel as described in 3GPP TS 24.302 [8U]. The value of the \"TCP-source-port\" parameter is the TCP source port of the TCP messages:\n-\treceived by the ePDG; and\n-\tof the firewall traversal tunnel transporting the IKEv2 messages.\nThe \"ePDG-IP-address\" parameter indicates the ePDG IP address used as IKEv2 tunnel endpoint with the UE.\nThe \"eps-fallback\" header field parameter is used to indicate that the current access technology is used as a result of EPS fallback. The value \"1\" indicates that EPS fallback has occurred, the value \"0\" that EPS fallback has not occurred. The parameter can be set only by the P-CSCF.\nThe P-Access-Network-Info header field is populated with the following contents:\n1)\tthe access-type field set to one of \"3GPP-GERAN\",\"3GPP-UTRAN-FDD\", \"3GPP-UTRAN-TDD\", \"3GPP-E-UTRAN-FDD\", \"3GPP-E-UTRAN-TDD\", \"3GPP-E-UTRAN-ProSe-UNR\", \"3GPP-NR-FDD\", \"3GPP-NR-TDD\", \"3GPP-NR-U-FDD\", \"3GPP-NR-U-TDD\", \"3GPP-NR-SAT\", \"3GPP-NR-ProSe-L2UNR\", \"3GPP-NR-ProSe-L3UNR\", \"3GPP2-1X\", \"3GPP2-1X-HRPD\", \"3GPP2-UMB\", \"3GPP2-1X-Femto\", \"IEEE-802.11\", \"IEEE-.11a\", \"IEEE-.11b\", \"IEEE-.11g\", \"IEEE-.11n\", \"IEEE-.11ac\", \"ADSL\", \"ADSL2\", \"ADSL2+\", \"RADSL\", \"SDSL\", \"HDSL\", \"HDSL2\", \"G.SHDSL\", \"VDSL\", \"IDSL\", \"xDSL\", \"DOCSIS\", \"IEEE-.3\", \"IEEE-.3a\", \"IEEE-.3e\", \"IEEE-.3i\", \"IEEE-.3j\", \"IEEE-.3u\", \"IEEE-.3ab\", \"IEEE-.3ae\", \"IEEE-802.3ah\", \"IEEE-.3ak\", \"IEEE-.3aq\", \"IEEE-.3an\", \"IEEE-802.3y\", \"IEEE-802.3z\", or \"DVB-RCS2\" as appropriate to the access technology in use.\n1A)\tthe access-class field set to one of \"3GPP-GERAN\", \"3GPP-UTRAN\", \"3GPP-E-UTRAN\", \"3GPP-NR\", \"3GPP-NR-U\", \"3GPP-NR-SAT\", \"3GPP-WLAN\", \"3GPP-GAN\", \"3GPP-HSPA\", \"3GPP2\", \"untrusted-non-3GPP-VIRTUAL-EPC\", \"VIRTUAL-no-PS\", or \"WLAN-no-PS\" as appropriate to the technology in use. The access-class field set to \"untrusted-non-3GPP-VIRTUAL-EPC\" indicates the IP-CAN associated with an EPC based untrusted non-3GPP access with unknown radio access technology. The access-class field set to \"VIRTUAL-no-PS\" indicates an IP-CAN associated with an unknown radio access technology, such that the IP-CAN is not provided by the packet switched domain of the PLMN of the P-CSCF. The access-class field set to \"WLAN-no-PS\" indicates an IP-CAN associated with WLAN, such that the IP-CAN is not provided by the packet switched domain of the PLMN of the P-CSCF. The access-class field set to \"3GPP-NR-SAT \" indicates an IP-CAN associated with satellite NG-RAN.\n2)\tif the access-type field or the access-class field is set to \"3GPP-GERAN\", a cgi-3gpp parameter set to the Cell Global Identity obtained from lower layers of the UE. The Cell Global Identity is a concatenation of  (3 decimal digits),  (2 or 3 decimal digits depending on  value), LAC (4 hexadeciaml digits) and CI (as described in 3GPP TS 23.003 [3]. The \"cgi-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\n3)\tif the access-type field is equal to \"3GPP-UTRAN-FDD\", or \"3GPP-UTRAN-TDD\", and a UE provides the P-Acces-Network-Info header field, a \"utran-cell-id-3gpp\" parameter set to a concatenation of the  (3 decimal digits),  (2 or 3 decimal digits depending on  value), LAC (4 hexadecimal digits) as described in 3GPP TS 23.003 [3] and the UMTS Cell Identity (7 hexadecimal digits) as described in 3GPP TS 25.331 [9A]), obtained from lower layers of the UE. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\n3A)\tif the access-type field is equal to \"3GPP-UTRAN-FDD\", or \"3GPP-UTRAN-TDD\", and an entitiy that can use the \"network-provided\" header field parameter provides the P-Access-Network-Info header field, if available a \"utran-sai-3gpp\" parameter set to a concatenation of the  (3 decimal digits),  (2 or 3 decimal digits depending on  value), LAC (4 hexadecimal digits) as described in 3GPP TS 23.003 [3] and SAC (4 hexadecimal digits) as described in 3GPP TS 23.003 [3]. The \"utran-sai-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\n3B)\tif the access-class field is equal to \"3GPP-UTRAN\", or \"3GPP-HSPA\", if available a \"utran-sai-3gpp\" parameter set to a concatenation of the  (3 decimal digits),  (2 or 3 decimal digits depending on  value), LAC (4 hexadecimal digits) as described in 3GPP TS 23.003 [3] and SAC (4 hexadecimal digits) as described in 3GPP TS 23.003 [3]. The \"utran-sai-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\n4)\tvoid\n5)\tif the access-type field is set to \"3GPP2-1X\", a ci-3gpp2 parameter set to the ASCII representation of the hexadecimal value of the string obtained by the concatenation of  (16 bits), NID (16 bits), PZID (8 bits) and BASE_ID (16 bits) (see 3GPP2 C.S0005-D [85]) in the specified order. The length of the ci-3gpp2 parameter shall be 14 hexadecimal characters. The hexadecimal characters (A through F) shall be coded using the uppercase ASCII characters. If the UE does not know the values for any of the above parameters, the UE shall use the value of 0 for that parameter. For example, if the  is unknown, the UE shall represent the  as 0x0000;\nNOTE 1:\tThe  value is represented using 16 bits as supposed to 15 bits as specified in 3GPP2 C.S0005-D [85].\nEXAMPLE:\tIf  = 0x1234, NID = 0x5678, PZID = 0x12, BASE_ID = 0xFFFF, the ci-3gpp2 value is set to the string \"1234567812FFFF\".\n6)\tif the access-type field is set to \"3GPP2-1X-HRPD\", a ci-3gpp2 parameter set to the ASCII representation of the hexadecimal value of the string obtained by the concatenation of Sector ID (128 bits) and Subnet length (8 bits) (see 3GPP2 C.S0024-B [86]) and Carrier-ID, if available, (see 3GPP2 X.S0060 [86B])in the specified order. The length of the ci-3gpp2 parameter shall be 34 or 40 hexadecimal characters depending on whether the Carrier-ID is included. The hexadecimal characters (A through F) shall be coded using the uppercase ASCII characters;\nEXAMPLE:\tIf the Sector ID = 0x12341234123412341234123412341234, Subnet length = 0x11, and the Carrier-ID=0x555444, the ci-3gpp2 value is set to the string \"1234123412341234123412341234123411555444\".\n7)\tif the access-type field is set to \"3GPP2-UMB\" 3GPP2 C.S0084-000 [86A], a ci-3gpp2 parameter is set to the ASCII representation of the hexadecimal value of the Sector ID (128 bits) defined in 3GPP2 C.S0084-000 [86A]. The length of the ci-3gpp2 parameter shall be 32 hexadecimal characters. The hexadecimal characters (A through F) shall be coded using the uppercase ASCII characters;\nEXAMPLE:\tIf the Sector ID = 0x12341234123412341234123412341234, the ci-3gpp2 value is set to the string \"12341234123412341234123412341234\".\n8)\tif the access-type field set to one of \"IEEE-802.11\", \"IEEE-802.11a\", \"IEEE-802.11b\", \"IEEE-802.11g\", \"IEEE-802.11n\", or \"IEEE-.11ac\", an \"i-wlan-node-id\" parameter is set to the ASCII representation of the hexadecimal value of the AP's  address without any delimiting characters;\nNOTE 2:\tThe AP's  address is provided in the BSSID information element.\nEXAMPLE:\tIf the AP's  address = 00-0C-F1-12-60-28, then i-wlan-node-id is set to the string \"000cf1126028\".\nNOTE 3:\t\"i-wlan-node-id\" parameter is not restricted to I-WLAN. \"i-wlan-node-id\" parameter can be inserted for a WLAN which is not an I-WLAN.\n9)\tif the access-type field is set to \"3GPP2-1X-Femto\", a ci-3gpp2-femto parameter set to the ASCII representation of the hexadecimal value of the string obtained by the concatenation of femto MSCID (24 bit), femto CellID (16 bit), FEID (64bit), macro MSCID (24 bits) and macro CellID (16 bits) (3GPP2 X.P0059-200 [86E]) in the specified order. The length of the ci-3gpp2-femto parameter is 36 hexadecimal characters. The hexadecimal characters (A through F) are coded using the uppercase ASCII characters.\n10)\tif the access-type field is set to one of \"ADSL\", \"ADSL2\", \"ADSL2+\", \"RADSL\", \"SDSL\", \"HDSL\", \"HDSL2\", \"G.SHDSL\", \"VDSL\", \"IDSL\", or \"xDSL\", the access-info field shall contain a dsl-location parameter obtained from the  (see NASS functional architecture);\n11)\tif the access-type field set to \"DOCSIS\", the access info parameter is not inserted. This release of this specification does not define values for use in this parameter;\n12)\tif the access-type field is equal to \"3GPP-E-UTRAN-FDD\" or \"3GPP-E-UTRAN-TDD\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the  (3 decimal digits),  (2 or 3 decimal digits depending on  value) which should be obtained from the E-UTRAN Cell Global Identifier (ECGI), Tracking Area Code (4 hexadecimal digits when accessing to EPC and 6 hexadecimal digits when accessing to 5GCN) as described in 3GPP TS 23.003 [3] and the E-UTRAN Cell Identity (ECI) (7 hexadecimal digits) as described in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\nEXAMPLE:\tIf  is 111,  is 22,  is 33C4 and ECI is 76B4321, then P-Access-Network-Info header field looks like follows: P-Access-Network-Info: 3GPP-E-UTRAN-FDD;utran-cell-id-3gpp=1112233C476B4321;network-provided\nNOTE 4:\tThe total length of the \"utran-cell-id-3gpp\" parameter depends on the various combinations of MNC and TAC possible sizes. The actual length of MNC and TAC parts can be unambiguously deduced from the total length.\nNOTE 5:\tThe P-CSCF obtains the ECGI in the 3GPP-User-Location-Info AVP received from the PCRF, while the UE obtains the ECGI from RAN. In roaming scenarios with P-GW in the HPLMN, the MCC-MNC contained in the ECGI retrieved by the P-CSCF can differ from that contained in the ECGI retrieved by the UE. Using MNC and MCC from a different source than ECGI can lead to collision between cell-id values which makes the determination of the UE location not possible or incorrect and disables routing of emergency calls based on location information.\n12A)\tif the access-class field is equal to \"3GPP-E-UTRAN\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the  (3 decimal digits),  (2 or 3 decimal digits depending on  value) which should be obtained from the E-UTRAN Cell Global Identifier (ECGI), Tracking Area Code (4 hexadecimal digits when accessing to EPC and 6 hexadecimal digits when accessing to 5GCN) as described in 3GPP TS 23.003 [3] and the E-UTRAN Cell Identity (ECI) (7 hexadecimal digits) as described in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\n12B)\tif the access-type field is equal to \"3GPP-E-UTRAN-ProSe-UNR\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the  (3 decimal digits),  (2 or 3 decimal digits depending on MCC value) which should be obtained from the E-UTRAN Cell Global Identifier (ECGI) and the E-UTRAN Cell Identity (ECI) (7 hexadecimal digits) as described in 3GPP TS 23.003 [3] obtained from the ProSe-UE-to-network relay that the UE is connected to as specified in 3GPP TS 24.334 [8ZD]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in in RFC 20 [212];\nEXAMPLE:\tIf  is 111,  is 22 and ECI is 76B4321, then P-Access-Network-Info header field looks like follows: P-Access-Network-Info: 3GPP-E-UTRAN-ProSe-UNR;utran-cell-id-3gpp=1112276B4321.\n12C)\tif the access-type field is equal to \"3GPP-E-UTRAN-FDD\" or \"3GPP-E-UTRAN-TDD\", an \"eps-fallback\" header field parameter set to an appropriate value;\n12D)\tif the access-class field is equal to \"3GPP-E-UTRAN\", an \"eps-fallback\" header field parameter set to an appropriate value;\n13)\tif the access-type field is set to one of \"IEEE-802.3\", \"IEEE-802.3a\", \"IEEE-802.3e\", \"IEEE-802.3i\", \"IEEE-802.3j\", \"IEEE-802.3u\", \"IEEE-802.3ab\", \"IEEE-802.3ae\", IEEE-802.3ak\", IEEE-802.3aq\", IEEE-802.3an\", \"IEEE-802.3y\" or \"IEEE-802.3z\" and NASS subsystem is used, the access-info field shall contain an eth-location parameter obtained from the  (see NASS functional architecture);\n14)\tif the access-type field is set to one of \"GPON\", \"XGPON1\" or \"IEEE-802.3ah\" and NASS is used, the access-info field shall contain an fiber-location parameter obtained from the  (see NASS functional architecture);\n15)\tif the access-type field is set to \"\", the access-info field may contain a gstn-location parameter if received from the ;\nNOTE 6:\tThe \"cgi-3gpp\", the \"utran-cell-id-3gpp\", the \"ci-3gpp2\", the \"ci-3gpp2-femto\", the \"i-wlan-node-id\", eth-location, and the \"dsl-location\" parameters described above among other usage also constitute the location identifiers that are used for emergency services.\n16)\tif the access-type field is set to \"DVB-RCS2\", the access-info field shall contain a \"dvb-rcs2-node-id\" parameter which consists of comma-separated list consisting of _ID, satellite_ID, beam_ID, and SVN- as specified in ETSI TS 101 545-2 [194], ETSI TS 101 545-3 [195]; the _ID shall be represented as two digit hexadecimal value, the satellite_ID shall be represented as a two digit hexadecimal value, the beam_ID shall be respresented as a four digit hexadecimal value, and the SVN- shall be represented as six digit hexadecimal value;\nEXAMPLE:\tIf the (8 bit) _ID = 0x3A, the (8 bit) satellite_ID = 0xF5, the (16 bit) beam_ID = 0xEA23, and the (24 bit) SVN- = 0xE40AB9, then the \"dvb-rcs2-node-id\" is set to the string \"3A,F5,EA23,E40AB9\".\n17)\tthe \"local-time-zone\" parameter in the access-info field is coded as a text string as follows:\nUTC±[hh]:[mm]. [hh] is two digits, and [mm] is two digits from four values: \"00\", \"15\", \"30\" or \"45\", see  8601 [203];\nEXAMPLE:\t\"UTC+01:00\" indicates that the time difference between local time and UTC of day is one hour.\n18)\tthe \"daylight-saving-time\" parameter in the access-info field is coded as a text string as follows:\n[hh]. [hh] is a two digits value from three values \"00\", \"01\" or \"02\" indicating the positive adjustment in hours;\n19)\tvoid;\n20)\tthe operator-specific-GI in the access-info field is coded as a text string and conveys an operator-specifc geographical identifier;\n21)\tif\na)\tthe access-class field is set to \"untrusted-non-3GPP-VIRTUAL-EPC\"; or\nb)\tthe access-class field is set to \"3GPP-WLAN\" and the WLAN is an untrusted WLAN;\nthen:\na)\tif a UE local IP address is available, then a \"UE-local-IP-address\" parameter set to the UE local IP address;\nb)\tif the IKEv2 messages exchanged between the UE and the ePDG are encapsulated in the UDP messages according to IETF RFC 3948 [63A] and the UDP source port of the UDP messages received by ePDG is available, then a \"UDP-source-port\" parameter set to the UDP source port of the UDP messages:\n-\treceived by the ePDG; and\n-\tencapsulating the IKEv2 messages;\nc)\tif the IKEv2 messages exchanged between the UE and the ePDG are transported using the firewall traversal tunnel as described in 3GPP TS 24.302 [8U] and the TCP source port of the TCP messages of the firewall traversal tunnel received by ePDG is available, then a \"TCP-source-port\" parameter set to the TCP source port of the TCP messages:\n-\treceived by the ePDG; and\n-\tof the firewall traversal tunnel transporting the IKEv2 messages; and\nd)\tif an ePDG IP address used as IKEv2 tunnel endpoint with the UE is available, then an \"ePDG-IP-address\" parameter set to the ePDG IP address used as IKEv2 tunnel endpoint with the UE;\n22)\tif the access-type field is equal to \"3GPP-NR-FDD\" or \"3GPP-NR-TDD\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits),  (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3], the NR Cell Identity (NCI) (9 hexadecimal digits) and optionally, the Network Identifier (NID) (11 hexadecimal digits) as specified in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212]; and\nNOTE 7:\tNID is included only if a serving network is a Stand-alone Non-Public Network (SNPN) identified by a combination of NID, MCC and MNC. The serving network type can be unambiguously deduced from the total length of the \"utran-cell-id-3gpp\" parameter.\n22A)\tif the access-class field is equal to \"3GPP-NR\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits),  (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3], the NR Cell Identity (NCI) (9 hexadecimal digits) and optionally, the NID (11 hexadecimal digits) as specified in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212].\n23)\tif the access-type field is equal to \"3GPP-NR-U-FDD\" or \"3GPP-NR-U-TDD\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits),  (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3], the NR Cell Identity (NCI) (9 hexadecimal digits) and optionally, the NID (11 hexadecimal digits) as specified in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\n23A)\tif the access-class field is equal to \"3GPP-NR-U\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits),  (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3], the NR Cell Identity (NCI) (9 hexadecimal digits) and optionally, the NID (11 hexadecimal digits) as specified in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212 ];\n24)\tif the access-type field is equal to \"3GPP-NR-SAT\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits), MNC (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3], the NR Cell Identity (NCI) (9 hexadecimal digits) and optionally, the NID (11 hexadecimal digits) as specified in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212];\n25) if the access-class field is equal to \"3GPP-NR-SAT\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits), MNC (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3], the NR Cell Identity (NCI) (9 hexadecimal digits) and optionally, the NID (11 hexadecimal digits) as specified in 3GPP TS 23.003 [3]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212]; and\n26) if the access-type field is equal to \"3GPP-NR-ProSe-L2UNR\" or \"3GPP-NR-ProSe-L3UNR\", a \"utran-cell-id-3gpp\" parameter set to a concatenation of the MCC (3 decimal digits), MNC (2 or 3 decimal digits depending on MCC value), Tracking Area Code (6 hexadecimal digits) as described in 3GPP TS 23.003 [3], and the NR Cell Identity (NCI) (9 hexadecimal digits) obtained from the 5G ProSe UE-to-network relay UE that the UE is connected to as specified in 3GPP TS 24.554 [8ZI]. The \"utran-cell-id-3gpp\" parameter is encoded in ASCII as defined in RFC 20 [212].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.5\tP-Charging-Vector header field",
                            "text_content": "The P-Charging-Vector header field is extended to include specific charging correlation information needed for IM CN subsystem functional entities.\nThe syntax of the P-Charging-Vector header field is described in RFC 7315 [52]. There may be additional coding rules for this header field depending on the type of IP-CAN, according to access technology specific descriptions.\nTable 7.2A.5 describes 3GPP-specific extensions to the P-Charging-Vector header field defined in RFC 7315 [52].\nTable 7.2A.5: Syntax of extensions to P-Charging-Vector header field\n\naccess-network-charging-info = (gprs-charging-info / i-wlan-charging-info / xdsl-charging-info / packetcable-charging-info / icn-charging-info / eps-charging-info / eth-charging-info/ loopback-indication / 5gs-charging-info / generic-param)\ngprs-charging-info = ggsn  auth-token [ pdp-info-hierarchy] *( extension-param)\nggsn = \"ggsn\" EQUAL gen-value\npdp-info-hierarchy = \"pdp-info\" EQUAL LDQUOT pdp-info *(COMMA pdp-info) RDQUOT\npdp-info = pdp-item  pdp-sig  gcid [ flow-id]\npdp-item = \"pdp-item\" EQUAL DIGIT\npdp-sig = \"pdp-sig\" EQUAL (\"yes\" / \"no\")\ngcid = \"gcid\" EQUAL 1*HEXDIG\nauth-token = \"auth-token\" EQUAL 1*HEXDIG\nflow-id = \"flow-id\" EQUAL \"(\" \"{\" 1*DIGIT COMMA 1*DIGIT \"}\" *(COMMA \"{\" 1*DIGIT COMMA 1*DIGIT \"}\")\")\"\ni-wlan-charging-info = \"pdg\"\nxdsl-charging-info = bras  auth-token [ xDSL-bearer-info] *( extension-param)\nbras = \"bras\" EQUAL gen-value\nxDSL-bearer-info = \"dsl-bearer-info\" EQUAL LDQUOT dsl-bearer-info *(COMMA dsl-bearer-info) RDQUOT\ndsl-bearer-info = dsl-bearer-item  dsl-bearer-sig  dslcid [ flow-id]\ndsl-bearer-item = \"dsl-bearer-item\" EQUAL DIGIT\ndsl-bearer-sig = \"dsl-bearer-sig\" EQUAL (\"yes\" / \"no\")\ndslcid = \"dslcid\" EQUAL 1*HEXDIG\npacketcable-charging-info = packetcable [ bcid]\npacketcable = \"packetcable-multimedia\"\nbcid = \"bcid\" EQUAL 1*48(HEXDIG)\nicn-charging-info = icn-bcp *( itid) [ extension-param]\nicn-bcp = \"icn-bcp\" EQUAL gen-value\nitid = itc-sig  itc-id  *(flow-id2)\nitc-sig = \"itc-sig\" EQUAL (\"yes\" / \"no\")\nitc-id = \"itc-id\" EQUAL gen-value\nflow-id2 = \"flow-id\" EQUAL gen-value\nextension-param = token [EQUAL (token | quoted-string)]\neps-charging-info = pdngw [ eps-bearer-hierarchy] *( extension-param)\npdngw = \"pdngw\" EQUAL gen-value\neps-bearer-hierarchy = \"eps-info\" EQUAL LDQUOT eps-info *(COMMA eps-info) RDQUOT\neps-info = eps-item  eps-sig  ecid [ flow-id]\neps-item = \"eps-item\" EQUAL DIGIT\neps-sig = \"eps-sig\" EQUAL (\"yes\" / \"no\")\necid = \"ecid\" EQUAL 1*HEXDIG\neth-charging-info = ip-edge *( extension-param)\nfiber-charging-info = ip-edge *( extension-param)\nip-edge = \"ip-edge\" EQUAL gen-value\nloopback-indication = \"loopback\"\nfe-identifier = \"fe-identifier\" EQUAL fe-id-list   fe-id-list = DQUOTE fe-id-param *(COMMA fe-id-param) DQUOTE\nfe-id-param = fe-addr/as-addr\nfe-addr = \"fe-addr\" EQUAL gen-value\nas-addr = \"as-addr\" EQUAL gen-value \"-\" ap-id\nap-id = \"ap-id\" EQUAL gen-value\n5gs-charging-info = smf [ 5gs-pdu-session-hierarchy] *( extension-param)\nsmf = \"smf\" EQUAL gen-value\n5gs-pdu-session-hierarchy = \"5gs-info\" EQUAL LDQUOT 5gs-info *(COMMA 5gs-info) RDQUOT\n5gs-info = 5gs-item  5gscid [ flow-id]\n5gs-item = \"5gs-item\" EQUAL DIGIT\n5gscid = \"5gscid\" EQUAL 1*HEXDIG\n\nNOTE:\tThe syntax above is not aligned with the rules for defining new P-Charging-Vector header field parameters as defined in RFC 7315 [52]. Entities that perform syntax check (even if they are not interested in specific header field parameter values) of the header field need to follow the explicit syntax above, as using the rules in RFC 7315 [52] would trigger a parser error.\nThe access-network-charging-info parameter is an instance of generic-param from the current charge-params component of P-Charging-Vector header field.\nThe access-network-charging-info parameter includes alternative definitions for different types access networks. The description of these parameters are given in the subsequent subclauses.\nThe \"access-network-charging-info\" header field parameter is not included in the P-Charging-Vector for SIP signalling that is not associated with a session.\nWhen the \"access-network-charging-info\" is included in the P-Charging-Vector and necessary information is not available from the IP-CAN (e.g. via Gx/Rx interface) reference points then null or zero values are included.\nFor type 1 and type 3 IOIs, the generating SIP entity shall express the \"orig-ioi\" and \"term-ioi\" header field parameters in the format of a quoted string as specified in RFC 7315 [52].\nIf an IOI is a type 1 IOI, the content of the quoted string consists of the \"Type 1\" string prefix followed by the IOI value. The \"Type 1\" string prefix is the type-1-prefix value specified in the table 7.2A.5A.\nIf an IOI is a type 3 IOI, the content of the quoted string consists of the \"Type 3\" string prefix followed by the IOI value. The \"Type 3\" string prefix is the type-3-prefix value specified in the table 7.2A.5A.\nTable 7.2A.5A: String prefixes\n\ntype-1-prefix = %x54.79.70.65.20.31 ; \"Type 1\"\ntype-3-prefix = %x54.79.70.65.20.33 ; \"Type 3\"\n\n\nIf an IOI is a type 2 IOI, the value of the \"orig-ioi\" and \"term-ioi\" header field parameters is set to the IOI value. No string prefix is used.\nThe receiving SIP entity does not perform syntactic checking of the contents of the IOI parameter (the IOI parameter is passed unmodified to charging entities).\nThe \"loopback\" parameter is provided to the charging system of other entities in the signalling path to indicate that loopback has been applied and entities of the IM CN subsystem involved in the loopback, e.g. TRF, can have generated CDRs in their own right.\nThe \"fe-identifier\" header field parameter is an instance of generic-param from the current charge-params component of the P-Charging-Vector header field. This header field parameter contains one or more IM CN subsystem functional entity addresses (\"fe-addr\") and/or AS addresses (\"as-addr\") and application identifiers (\"ap-id\") where the IM CN subsystem functional entity does create charging information for the related CDR of this IM CN subsystem functional entity. For AS hosting several applications the AS address can appear several times, each accompanied with a different application identifier based on the application executed by the AS.\nGPRS is a supported access network (gprs-charging-info parameter). For GPRS there are the following components to track: GGSN address (ggsn parameter), media authorization token (auth token parameter), and a pdp-info parameter that contains the information for one or more PDP contexts. In this release the media authorization token is set to zero. The pdp-info contains one or more pdp-item values followed by a collection of parameters (pdp-sig, gcid, and flow-id). The value of the pdp-item is a unique number that identifies each of the PDP-related charging information within the P-Charging-Vector header field. Each PDP context has an indicator if it is an IM CN subsystem signalling PDP context (pdp-sig parameter), an associated GPRS Charging Identifier (gcid parameter), and a identifier (flow-id parameter). The flow-id parameter contains a sequence of curly bracket delimited flow identifier tuples that identify associated m-lines and relative order of port numbers in an m-line within the SDP from the SIP signalling to which the PDP context charging information applies. For a complete description of the semantics of the flow-id parameter see 3GPP TS 29.214 [13D] Annex B. The gcid, ggsn address and flow-id parameters are transferred from the GGSN to the P-CSCF via the PCRF over the Rx interface (see 3GPP TS 29.214 [13D] and Gx interface (see 3GPP TS 29.212 [13B]).\nThe gcid value is received in binary format at the P-CSCF (see 3GPP TS 29.214 [13D]). The P-CSCF shall encode it in hexadecimal format before include it into the gcid parameter. On receipt of this header field, a node receiving a gcid shall decode from hexadecimal into binary format.\nThe \"access-network-charging-info\" is not included in the P-Charging-Vector for SIP signalling that is not associated with a multimedia session. The access network charging information may be unavailable for sessions that use a general purpose PDP context (for both SIP signalling and media) or that do not require media authorisation.\nThe access-network-charging-info parameter is an instance of generic-param from the current charge-params component of P-Charging-Vector header field.\nThis version of the specification defines the use of \"pdg\" for inclusion in the P-Charging-Vector header field. No other extensions are defined for use in I-WLAN in this version of the specification.\nEditor's note: WI: TEI12: CR5046: The application of the ABNF element relating to \"pdg\" to EPS needs to be clarified.\nThe access-network-charging-info parameter is an instance of generic-param from the current charge-params component of P-Charging-Vector header field. The access-network-charging-info parameter includes alternative definitions for different types of access networks. This subclause defines the components of the xDSL instance of the access-network-charging-info.\nFor xDSL, there are the following components to track: BRAS address (bras parameter), media authorization token (auth-token parameter), and a set of dsl-bearer-info parameters that contains the information for one or more xDSL bearers.\nThe dsl-bearer-info contains one or more dsl-bearer-item values followed by a collection of parameters (dsl-bearer-sig, dslcid, and flow-id). The value of the dsl-bearer-item is a unique number that identifies each of the dsl-bearer-related charging information within the P-Charging-Vector header field. Each dsl-bearer-info has an indicator if it is an IM CN subsystem signalling dsl-bearer (dsl-bearer-sig parameter), an associated  Charging Identifier (dslcid parameter), and a identifier (flow-id parameter). The flow-id parameter contains a sequence of curly bracket delimited flow identifier tuples that identify associated m-lines and relative order of port numbers in an m-line within the SDP from the SIP signalling to which the dsl-bearer charging information applies. For a complete description of the semantics of the flow-id parameter see 3GPP TS 29.214 [13D].\nThe format of the dslcid parameter is identical to that of ggsn parameter. On receipt of this header field, a node receiving a dslcid shall decode from hexadecimal into binary format.\nFor a dedicated dsl-bearer for SIP signalling, i.e. no media stream requested for a session, then there is no authorisation activity or information exchange over the Rx and Gx interfaces. Since there are no dslcid, media authorization token or flow identifiers in this case, the dslcid and media authorization token are set to zero and no flow identifier parameters are constructed by the PCRF.\nThe access-network-charging-info parameter is an instance of generic-param from the current charge-params component of P-Charging-Vector header field. The access-network-charging-info parameter includes alternative definitions for different types of access networks. This subclause defines the components of the cable instance of the access-network-charging-info. Cable access is based upon the architecture defined by Data Over Cable Service Interface Specification (DOCSIS).\nThe billing correlation identifier (bcid) uniquely identifies the PacketCable DOCSIS bearer resources associated with the session within the cable operator's network for the purposes of billing correlation. To facilitate the correlation of session and bearer accounting events, a correlation ID that uniquely identifies the resources associated with a session is needed. This is accomplished through the use of the bcid as generated by the PacketCable Multimedia network. This bcid is returned to the P-CSCF within the response to a successful resource request.\nThe bcid is specified in RFC 3603 [74A]. This identifier is chosen to be globally unique within the system for a window of several months. Consistent with RFC 3603 [74A], the BCID must be encoded as a hexadecimal string of up to 48 characters. Leading zeroes may be suppressed.\nIf the bcid value is received in binary format by the P-CSCF from the IP-CAN, the P-CSCF shall encode it in hexadecimal format before including it into the bcid parameter. On receipt of this header field, a node using a bcid will normally decode from hexadecimal into binary format.\nThe specific extensions to the P-Charging-Vector header field defined in RFC 7315 [52] when the access network is cdma2000® packet data subsystem are: the icn-charging-info parameter contains one icn-bcp child parameter and one or more child itid parameters. The icn-bcp parameter, identifies the point of attachment where UE has attached itself to the cdma2000® packet data subsystem. The icn-bcp parameter is conveyed to the P-CSCF by the cdma2000® packet data subsystem. Each itid child parameter within icn-charging-info corresponds to one IP-CAN bearer that was established by the cdma2000® packet data subsystem for the UE. Each itid parameter contains an indicator if it is an IP-CAN subsystem signalling IP-CAN bearer (itc-sig parameter), an associated IP-CAN charging identifier (itc-id parameter), and one or more flow identifiers (flow-id parameter) that identify associated m-lines within the SDP from the SIP signalling. These parameters are transferred from the cdma2000® packet data subsystem to the P-CSCF over the respective interface.\nFor an IP-CAN bearer that is only used for SIP signalling, i.e. no media stream requested for a session, then there is no authorisation activity or information exchange with the P-CSCF over the respective cdma2000® interfaces. Since there is no itc-id, or flow identifiers in this case, the itc-id is set to zero and no flow identifier parameters are constructed by the P-CSCF.\nFor EPS there are the following components to track: P-GW address (pdngw parameter), and a eps-info parameter that contains the information for one or more EPS bearers. The eps-info contains one or more eps-item values followed by a collection of parameters (eps-sig, ecid, and flow-id). The value of the eps-item is a unique number that identifies each of the EPS-bearer-related charging information within the P-Charging-Vector header field. Each EPS bearer context has an associated QCI indicating if it is an IM CN subsystem signalling EPs bearer context (eps-sig parameter), an associated EPS Charging Identifier (ecid parameter), and a identifier (flow-id parameter). The flow-id parameter contains a sequence of curly bracket delimited flow identifier tuples that identify associated m-lines and relative order of port numbers in an m-line within the SDP from the SIP signalling to which the EPS bearer charging information applies. For a complete description of the semantics of the flow-id parameter see 3GPP TS 29.214 [13D] Annex B. The ecid, pdngw address and flow-id parameters are transferred from the P-GW to the P-CSCF via the PCRF over the Rx interface (see 3GPP TS 29.214 [13D] and Gx interface (see 3GPP TS 29.212 [13B]).\nThe ecid value is received in binary format at the P-CSCF (see 3GPP TS 29.214 [13D]). The P-CSCF shall encode it in hexadecimal format before include it into the ecid parameter. On receipt of this header field, a node receiving a gcid shall decode from hexadecimal into binary format.\nThe \"access-network-charging-info\" header field parameter is not included in the P-Charging-Vector for SIP signalling that is not associated with a multimedia session. The access network charging information may be unavailable for sessions that use a general purpose EPS bearer context (for both SIP signalling and media).\nThe access-network-charging-info parameter is an instance of generic-param from the current charge-params component of P-Charging-Vector header field. For Ethernet accesses, the IP Edge Node address (ip-edge parameter) is tracked. The IP Edge Node is defined in ETSI ES 282 001 [138].\nThe access-network-charging-info parameter is an instance of generic-param from the current charge-params component of P-Charging-Vector header field. For Fiber accesses, the IP Edge Node address (ip-edge parameter) is tracked. The IP Edge Node is defined in ETSI ES 282 001 [138].\nFor 5GS there are the following components to track: SMF address (SMF parameter) and a 5gs-info parameter that contains the information for one or more 5GS PDU sessions. The 5gs-info contains one or more 5gs-item values followed by a collection of parameters (5gscid and flow-id). The value of the 5gs-item is a unique number that identifies each of the 5GS PDU session charging information within the P-Charging-Vector header field.\nEach 5GS PDU session has an associated 5GS Charging Identifier (5gscid parameter), and an additional information (flow-id parameter). The flow-id parameter contains a sequence of curly bracket delimited parameter tuples that identify associated m-lines and relative order of port numbers in an m-line within the SDP from the SIP signalling to which the 5GS PDU session charging information applies. For a complete description of the semantics of the flow-id parameter see 3GPP TS 29.214 [13D]. The smf address, 5gscid and flow-id parameters are transported to the P-CSCF via the PCRF over the Rx interface (see 3GPP TS 29.214 [13D].\nThe 5gscid value is received in binary format at the P-CSCF (see 3GPP TS 29.214 [13D]). The P-CSCF shall encode it in hexadecimal format before include it into the 5gscid parameter. On receipt of this header field, a node receiving a 5gscid shall decode from hexadecimal into binary format.\nThe \"access-network-charging-info\" header field parameter is not included in the P-Charging-Vector for SIP signalling that is not associated with a multimedia session.\nThe operation of this header field is described in subclauses 5.2, 5.3, 5.4, 5.5, 5.6, 5.7 and 5.8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.6\tOrig parameter definition",
                            "text_content": "The \"orig\" parameter is a uri-parameter intended to:\n-\ttell the S-CSCF that it has to perform the originating services instead of terminating services;\n-\ttell the I-CSCF that it has to perform originating procedures.\nThe syntax for the orig parameter is specified in table 7.2A.6:\nTable 7.2A.6: Syntax of orig parameter\n\nuri-parameter = transport-param / user-param / method-param / ttl-param / maddr-param / lr-param / orig / other-param\norig = \"orig\"\n\n\nThe BNF for uri-parameter is taken from RFC 3261 [26] and modified accordingly.\nThe orig parameter is appended to the address of the S-CSCF, I-CSCF or IBCF by the ASs, when those initiate requests on behalf of the user, or to the address of the S-CSCF or I-CSCF by an IBCF acting as entry point, if the network is performing originating service to another network. The S-CSCF will run originating services whenever the orig parameter is present next to its address. The I-CSCF will run originating procedures whenever the orig parameter is present next to its address. The IBCF will preserve the \"orig\" parameter in the topmost Route header field if received, or it may append the \"orig\" parameter to the  in the topmost Route header field (see subclause 5.10.2.3).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.7\tExtension to Security-Client, Security-Server and Security-Verify header fields",
                            "text_content": "This extension defines new parameters for the Security-Client, Security-Server and Security-Verify header fields.\nThis subclause defines the \"mediasec\" header field parameter that labels any of the Security-Client:, Security-Server, or Security-Verify: header fields as applicable to the media plane and not the signalling plane.\nThe syntax for the Security-Client, Security-Server and Security-Verify header fields is defined in RFC 3329 [48]. The additional syntax is defined in Annex H of 3GPP TS 33.203 [19].\nThis specification reuses Security-Client, Security-Server and Security-Verify defined in RFC 3329 [48] and defines the mechanism listed in table 7.2A.7.2.2-2 and the header field parameter \"mediasec\".\nSecurity mechanisms that apply to the media plane only shall not have the same name as any signalling plane mechanism. If a signalling plane security mechanism name is re-used for the media plane and distinguished only by the \"mediasec\" parameter, then implementations that do not recognize the \"mediasec\" parameter may incorrectly use that security mechanism for the signalling plane.\nThe \"mediasec\" header field parameter may be used in the Security- Client, Security-Server, or Security-Verify header fields defined in RFC 3329 [48] to indicate that a header field applies to the media plane. Any one of the media plane security mechanisms supported by both client and server, if any, may be applied when a media stream is started. Or, a media stream may be set up without security.\nValues in the Security-Client, Security-Server, or Security-Verify header fields labelled with the \"mediasec\" header field parameter are specific to the media plane and specific to the secure media transport protocol used on the media plane.\nEXAMPLE:\tSecurity-Client: sdes-srtp;mediasec\nUsage of the \"mediasec\" header field parameter in mech-parameters rule of RFC 3329 [48] and the syntax of the \"mediasec\" header field parameter is shown in table 7.2A.7.2.2-1.\nTable 7.2A.7.2.2-1\nmech-parameters =/ mediasec-param\nmediasec-param = \"mediasec\"\n\nThe security mechanisms which can be labelled by the \"mediasec\" header field parameter are listed in the table 7.2A.7.2.2-2, where each line (other than the first line) indicates a token and a media security mechanism for which the token indicates support.\nTable 7.2A.7.2.2-2\nmechanism-name =/ ( sdes-srtp-name / msrp-tls-name / bfcp-tls-name / udptl-dtls-name /\ndtls-srtp-name / token )\nsdes-srtp-name = \"sdes-srtp\" ; End-to-access-edge media security using SDES.\nmsrp-tls-name = \"msrp-tls\" ; End-to-access-edge media security for MSRP using  and certificate fingerprints.\nbfcp-tls-name = \"bfcp-tls\" ; End-to-access-edge media security for BFCP using  and certificate fingerprints.\nudptl-dtls-name = \"udptl-dtls\" ; End-to-access-edge media security for UDPTL using DTLS and certificate fingerprints.\ndtls-srtp-name = \"dtls-srtp\" ; End-to-access-edge media security for RTP using DTLS-SRTP and certificate fingerprints.\n\nThe operation of the additional parameters for the Security-Client, Security-Server and Security-Verify header fields is defined in Annex H of 3GPP TS 33.203 [19].\nAny one of the mechanisms listed in table 7.2A.7.2.2-2 and labelled with the \"mediasec\" header field parameter can be applied on-the-fly as a media stream is started, unlike mechanisms for signalling one of which is chosen and then applied throughout a session.\nMedia plane security can be supported independently of any signalling plane security defined in RFC 3329 [4], but in order to protect any cryptographic key carried in SDP signalling plane security as defined in RFC 3329 [4] SHOULD be used. Each media security mechanism can be supported independently.\nThe message flow is identical to the flow in RFC 3329 [48], but it is not mandatory for the user agent to apply media plane security immediately after it receives the list of supported media plane mechanisms from the server, or any timer after that, nor will the lack of a mutually supported media plane security mechanism prevent SIP session setup.\nEditor's note: [MEDIASEC_CORE, CR 4156] This subclause forms the basis for IANA registration of the mediasec header field parameter. Registration is intended to be created by an RFC that describes the mediasec header field parameter and creates an IANA registry for its values.\nNOTE:\tThis subclause contains information to be provided to IANA for the registration of the media plane security indicator header field parameter.\nContact name, email address, and telephone number:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\nHeader field in which the parameter can appear:\nSecurity-Client, Security-Server and Security-Verify header fields.\nName of the header field parameter being registered:\nmediasec\nWhether the parameter only accepts a set of predefined values:\nNo value is defined for the parameter.\nA reference to the RFC where the parameter is defined and to any RFC that defines new values for the parameter:\nThis parameter is defined in 3GPP TS 24.229.\nEditor's note: [MEDIASEC_CORE, CR 4156] This subclause forms the basis for IANA registration of the value for the mediasec header field parameter. The registration should be performed by  when the registry for mediasec parameter values has been created by IANA.\nNOTE:\tThis subclause contains information to be provided to IANA for the registration of the media plane security indicator header field parameter.\nContact name, email address, and telephone number:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\nThe mechanism-name token:\nsdes-srtp\nThe published RFC describing the details of the corresponding security mechanism:\nThis mechanism is defined in 3GPP TS 24.229.\nEditor's note: [WI: eMEDIASEC-CT, CR#4624] This subclause forms the basis for IANA registration of the value for the mediasec header field parameter. The registration should be performed by  when the registry for mediasec parameter values has been created by IANA.\nNOTE:\tThis subclause contains information to be provided to IANA for the registration of the media plane security indicator header field parameter.\nContact name, email address, and telephone number:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\nThe mechanism-name token:\nmsrp-tls\nThe published RFC describing the details of the corresponding security mechanism:\nThis mechanism is defined in 3GPP TS 24.229.\nEditor's note: [WI: eMEDIASEC-CT, CR#4624] This subclause forms the basis for IANA registration of the value for the mediasec header field parameter. The registration should be performed by  when the registry for mediasec parameter values has been created by IANA.\nNOTE:\tThis subclause contains information to be provided to IANA for the registration of the media plane security indicator header field parameter.\nContact name, email address, and telephone number:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\nThe mechanism-name token:\nbfcp-tls\nThe published RFC describing the details of the corresponding security mechanism:\nThis mechanism is defined in 3GPP TS 24.229.\nEditor's note: [WI: eMEDIASEC-CT, CR#4624] This subclause forms the basis for IANA registration of the value for the mediasec header field parameter. The registration should be performed by  when the registry for mediasec parameter values has been created by IANA.\nNOTE:\tThis subclause contains information to be provided to IANA for the registration of the media plane security indicator header field parameter.\nContact name, email address, and telephone number:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\nThe mechanism-name token:\nudptl-dtls\nThe published RFC describing the details of the corresponding security mechanism:\nThis mechanism is defined in 3GPP TS 24.229.\nEditor's note: [WI: eCryptPr, CR#6554] This subclause forms the basis for IANA registration of the value for the mediasec header field parameter. The registration should be performed by  when the registry for mediasec parameter values has been created by IANA.\nNOTE:\tThis subclause contains information to be provided to IANA for the registration of the media plane security indicator header field parameter.\nContact name, email address, and telephone number:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\nThe mechanism-name token:\ndtls-srtp\nThe published RFC describing the details of the corresponding security mechanism:\nThis mechanism is defined in 3GPP TS 24.229.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.8\tIMS Communication Service Identifier (ICSI)",
                            "text_content": "The ICSI is defined to fulfil the requirements as stated in 3GPP TS 23.228 [7]. An ICSI may have specialisations which refine it by adding subclass identifiers separated by dots. Any specialisations of an ICSI shall have an \"is a\" relationship if the subclasses are removed. For example, a check for ICSI urn:urn-7:3gpp-service.ims.icsi.mmtel will return true when evaluating ICSI urn:urn-7:3gpp-service.ims.icsi.mmtel.hd-video.\nThis parameter is coded as a URN. The ICSI URN may be included as:\n-\ta tag-value within the g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 and RFC 3840 [62], in which case those characters of the URN that are not part of the tag-value definition in RFC 3840 [62] shall be represented in the percent encoding as defined in RFC 3986 [124];\n-\ta feature cap value within the \"g.3gpp.icsi-ref\" feature-capability indicator, as defined in subclause 7.9A.1 and RFC 6809 [190], in which case those characters of the URN that are not part of the feature-capability indicator value definition syntax shall be represented in the percent encoding, as defined in RFC 3986 [124]; or\n-\tas a value of the P-Preferred-Service or P-Asserted-Service header fields as defined RFC 6050 [121].\nA list of the URNs containing ICSI values registered by 3GPP can be found at http://www.3gpp.org/specifications-groups/34-uniform-resource-name-urn-list\nAn example of an ICSI for a 3GPP defined IMS communication service is:\nurn:urn-7:3gpp-service.ims.icsi.mmtel\n\nAn example of a g.3gpp.icsi-ref media feature tag containing an ICSI for a 3GPP defined IMS communication service is:\ng.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel\"\n\nAn example of a g.3gpp.icsi-ref feature-capability indicator containing an ICSI for a 3GPP defined IMS communication service is:\ng.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel\"\n\nAn example of an ICSI for a 3GPP defined IMS communication service in a P-Preferred-Service header field is\nP-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\n\nAn example of an ICSI for a 3GPP defined IMS communication service in a P-Asserted-Service header field is\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel\n\nAn example of an ICSI for a defined IMS communication service with a specialisation is:\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel.game-v1\n\nAn example of an ICSI for a 3GPP defined IMS communication service with an organisation-y defined specialisation is:\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel.organisation-y.game-v2\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.9\tIMS Application Reference Identifier (IARI)",
                            "text_content": "The IARI is defined to fulfil the requirements as stated in 3GPP TS 23.228 [7].\nThis parameter is coded as a URN. The IARI URN may be included as a tag-value within the g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3840 [62], in which case those characters of the URN that are not part of the tag-value definition in RFC 3840 [62] shall be represented in the percent encoding as defined in RFC 3986 [124].\nA list of the URNs containing IARI values registered by 3GPP can be found at http://www.3gpp.org/specifications-groups/34-uniform-resource-name-urn-list\nAn example of a g.3gpp.iari-ref media feature tag containing an IARI is:\ng.3gpp.iari-ref=\"urn%3Aurn-7%3A3gpp-application.ims.iari.game-v1\"\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.10\t\"phone-context\" tel  parameter",
                            "text_content": "When the request- contains a local number, then a phone-context tel  parameter as described in RFC 3966 [22] shall be present to indicate the related numbering plan.\nProcedures for using this parameter are given in subclause 5.1.2A.1.5 and additional coding rules are detailed in subclause 7.2A.10.3.\nThe syntax of the \"phone-context\" tel  parameter is described in RFC 3966 [22]. There are additional coding rules for this parameter depending on the type of IP-CAN, according to access technology specific descriptions.\nIn case the access network information is available, the entities inserting the \"phone-context\" tel  parameter shall populate the \"phone-context\" tel  parameter with the following contents:\n1)\tif the IP-CAN is GPRS, then the \"phone-context\" tel  parameter is a domain name. It is constructed from the , the  and the home network domain name by concatenating the , , and the string \"gprs\" as domain labels before the home network domain name;\nEXAMPLE:\tIf  = 216,  = 01, then the \"phone-context\" tel  parameter is set to '216.01.gprs.home1.net'.\n2)\tif the IP-CAN is Evolved Packet Core () via WLAN or 5GCN via WLAN, then the \"phone-context\" tel  parameter is a domain name.\na)\tif all characters of the SSID are allowed by domainlabel syntax definition of clause 3 of RFC 3966 [22], the domain name is constructed from the SSID, AP's  address, and the home network domain name by concatenating the SSID, AP's  address, and the string \"i-wlan\" as domain labels before the home network domain name; and\nb)\totherwise, the domain name is constructed from AP's  address, and the home network domain name by concatenating AP's  address, and the string \"i-wlan\" as domain labels before the home network domain name.\nNOTE:\tThe AP's  address is provided in the BSSID information element.\nEXAMPLE:\tIf SSID = BU-Airport, AP's  = 00-0C-F1-12-60-28, and home network domain name is \"home1.net\", then the \"phone-context\" tel  parameter is set to the string \"bu-airport.000cf1126028.i-wlan.home1.net\".\nEXAMPLE:\tIf SSID = <BU Airport>, AP's  = 00-0C-F1-12-60-28, and home network domain name is \"home1.net\", then the \"phone-context\" tel  parameter is set to the string \"000cf1126028.i-wlan.home1.net\".\n3)\tif the IP-CAN is xDSL, then the \"phone-context\" tel  parameter is a domain name. It is constructed from the dsl-location (see subclause 7.2A.4) and the home network domain name by concatenating the dsl-location and the string \"xdsl\" as domain labels before the home network domain name;\n4)\tif the IP-CAN is DOCSIS, then the \"phone-context\" tel  parameter is based on data configured locally in the UE;\n5)\tif the IP-CAN is EPS, then the \"phone-context\" tel  parameter is a domain name. It is constructed from the , the  and the home network domain name by concatenating the , , and the string \"eps\" as domain labels before the home network domain name;\n6)\tif the IP-CAN is Ethernet, then the \"phone-context\" parameter is a domain name. It is constructed from the eth-location (see subclause 7.2A.4) and the home network domain name by concatenating the eth-location and the string \"ethernet\" as domain labels before the home network domain name;\n7)\tif the IP-CAN is Fiber, then the \"phone-context\" parameter is a domain name. It is constructed from the fiber-location (see subclause 7.2A.4) and the home network domain name by concatenating the fiber-location and the string \"fiber\" as domain labels before the home network domain name;\n8)\tif the IP-CAN is cdma2000®, then the \"phone-context\" parameter is a domain name. It is constructed from the subnet id and the home network domain name by concatenating the subnet id as the domain label before the home network domain name;\n9)\tif the IP-CAN is DVB-RCS2, then the \"phone-context\" tel  parameter is based on data configured locally in the UE;\n10)\tif the IP-CAN is 5GS via 3GPP access and the serving network is a PLMN, then the \"phone-context\" tel  parameter is a domain name. It is constructed from the , the  and the home network domain name by concatenating the , , and the string \"5gs\" as domain labels before the home network domain name; and\n11)\tif the IP-CAN is 5GS via 3GPP access and the serving network is an SNPN, then the \"phone-context\" tel URI parameter is a domain name. It is constructed from the MCC, the MNC, the NID and the home network domain name by concatenating the , , the SNPN Network Identifier (NID) (11 hexadecimal digits) as specified in 3GPP TS 23.003 [3] and the string \"5gs-snpn\" as domain labels before the home network domain name.\nIf the access network information is not available in the UE, then the \"phone-context\" tel  parameter is set to the home network domain name preceded by the string \"geo-local.\".\nIn case the home domain is indicated in the \"phone-context\" tel  parameter, the \"phone-context\" tel  parameter is set to the home network domain name (as it is used to address the SIP REGISTER request, see subclause 5.1.1.1A or subclause 5.1.1.1B).\nIn case the \"phone-context\" tel  parameter indicates a network other than the home network or the visited access network, the \"phone-context\" tel  parameter is set according to RFC 3966 [22].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.11\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.12\t and OLI tel  parameter definition",
                            "text_content": "The use of the \"cpc\" and \"oli\"  parameters for use in the P-Asserted-Identity in SIP requests is defined.\nThe Calling Party's Category and Originating Line Information are represented as  parameters for the tel  scheme and SIP  representation of telephone numbers. The ABNF syntax is specified in table 7.2A.7 and extends the formal syntax for the tel  as specified in RFC 3966 [22]:\nTable 7.2A.7\npar =/ cpc / oli\ncpc = cpc-tag \"=\" cpc-value\noli = oli-tag \"=\" oli-value\ncpc-tag = \"cpc\"\noli-tag = \"oli\"\ncpc-value\n= \"ordinary\" / \"test\" / \"operator\" /\n\"payphone\" / \"unknown\" / \"mobile-hplmn\" / \"mobile-vplmn\" / \"emergency\" /\ngenvalue\noli-value = 2DIGIT\ngenvalue = 1*(alphanum / \"-\" / \".\" )\n\nThe Accept-Language header field shall be used to express the language of the operator.\nThe semantics of these Calling Party's Category values are described below:\nordinary: The caller has been identified, and has no special features.\ntest: This is a test call that has been originated as part of a maintenance procedure.\noperator: The call was generated by an operator position.\npayphone: The calling station is a payphone.\nunknown: The  could not be ascertained.\nmobile-hplmn: The call was generated by a mobile device in its home PLMN.\nmobile-vplmn: The call was generated by a mobile device in a vistited PLMN.\nemergency: The call is an emergency service call.\nNOTE 1:\tThe choice of  and OLI values and their use are up to the Service Provider.  and OLI values can be exchanged across networks if specified in a bilateral agreement between the service providers.\nNOTE 2:\tAdditional national/regional  values can exist.\nThe two digit OLI values are decimal codes assigned and administered by North American Numbering Plan Administration.\nThe \"cpc\" and \"oli\"  parameters may be supported by IM CN subsystem entities that provide the UA role and by IM CN subsystem entities that provide the proxy role.\nThe \"cpc\" and \"oli\"  parameters shall not be populated at the originating UE.\nIn case the \"cpc\"  parameter is not included, the call is treated as if the \"cpc\"  parameter is set to \"ordinary\".\nUnless otherwise specified in this document, \"cpc\" and \"oli\"  parameters are only passed on by IM CN subsystem entities (subject to trust domain considerations as specified in subclause 4.4.12).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.13\t\"sos\" SIP  parameter",
                            "text_content": "The \"sos\" SIP  parameter is intended to:\n-\tindicate to the S-CSCF that a REGISTER request that includes the \"sos\" SIP  parameter is for emergency registration purposes;\n-\ttell the S-CSCF to not apply barring of the public user identity being registered; and\n-\ttell the S-CSCF to not apply initial filter criteria to requests destined for an emergency registered contact.\nThe syntax for the \"sos\" SIP  parameter is specified in table 7.2A.8.\nTable 7.2A.8: Syntax of sos SIP  parameter\nuri-parameter =/ sos-param\nsos-param = \"sos\"\n\nThe BNF for uri-parameter is taken from RFC 3261 [26] and modified accordingly.\nWhen a UE includes the \"sos\" SIP  parameter in the  included in the Contact header field of REGISTER request, the REGISTER request is intended for emergency registration.\nWhen a S-CSCF receives a REGISTER request for emergency registration that includes the \"sos\" SIP  parameter, the S-CSCF is required to preserve the previously registered contact address. This differs to the registrar operation as defined in RFC 3261 [26] in that the rules for  comparison for the Contact header field shall not apply and thus, if the  in the Contact header field matches a previously received , then the old contact address shall not be overwritten.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.14\tP-Associated- header field",
                            "text_content": "Procedures of RFC 7315 [52] are modified to allow a SIP proxy to remove URIs from the P-Associated- header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.15\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.16\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.17\t\"premium-rate\" tel  parameter definition",
                            "text_content": "The use of the \"premium-rate\"  parameters for use in the Request- in SIP requests is defined.\nThe premium-rate category that a called number belongs to is represented as a  parameter for the tel  scheme and SIP  representation of telephone numbers. The ABNF syntax is as specified in Table 7.2A.17 and extends the formal syntax for the tel  as specified in RFC 3966 [22]:\nTable 7.2A.17\npar =/ premrate\npremrate = premrate-tag \"=\" premrate-value\npremrate-tag = \"premium-rate\"\npremrate-value = \"information\" / \"entertainment\"\n\nThe \"premium-rate\"  parameter may be supported by IM CN subsystem entities that provide the AS role and by IM CN subsystem entities that provide the proxy role.\nNOTE:\tThis subclause contains information to be provided to IANA for the registration of the tel- parameter \"premium-rate\".\nThis parameter needs to be defined in the sub-registry under the tel  parameters.\n\nContact name, email address, and telephone number:\n3GPP Specifications Manager:\n\n+33 (0)492944200\n\nName of the parameter:\n\"premium-rate\"\n\nWhether the parameter only accepts a set of predefined values:\n\"Constrained\"\n\nReference to the RFC or other permanent and readily available public specification defining the parameter and new values:\nThis parameter and its values are defined in 3GPP TS 24.229.\n\nDescription:\nThis tel  parameter is used in networks supporting roaming and operator determined barring feature. The tel  parameter provides a means to identify that a number in a tel  belongs to a premium rate category in the roaming network. SIP servers in the home network use this information to apply the operator determined barring functionality. An overview of the 3GPP IM CN subsystem can be found in RFC 4083.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.18\tReason header field",
                            "text_content": "The Reason header field is extended to include the additional protocol values.\nThe syntax of the Reason header field is described in RFC 3326 [34A].\nTable 7.2A.18 describes 3GPP-specific extension to the Reason header field.\nTable 7.2A.18: Syntax of extension to Reason header field\n\nprotocol          /= \"EMM\" / \"ESM\" / \"S1AP-RNL\" / \"S1AP-TL\" / \"S1AP-NAS\" / \"S1AP-MISC\" /\n\"S1AP-PROT\" / \"DIAMETER\" / \"IKEV2\" / \"RELEASE_CAUSE\" / \"FAILURE_CAUSE\" /\n\"5GMM\" / \"5GSM\" / \"NGAP-RNL\" / \"NGAP-TL\" / \"NGAP-NAS\" / \"NGAP-MISC\" /\n\"NGAP-PROT\"\n\n\nFor all the above protocols, the protocol cause is included.\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: EMM\nProtocol cause: Cause value in decimal representation (Note)\nReference: 3GPP TS 24.301 [8J] subclause 9.9.3.9\nNOTE:\tThis protocol value can also be used to represent MM cause from 3GPP TS 24.008 [8].\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: ESM\nProtocol cause: Cause value in decimal representation (Note)\nReference: 3GPP TS 24.301 [8J] subclause 9.9.4.4\nNOTE:\tThis protocol value can also be used to represent SM cause from 3GPP TS 24.008 [8].\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: S1AP-RNL\nProtocol cause: Radio network layer cause value in decimal representation\nReference: 3GPP TS 36.413\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: S1AP-TL\nProtocol cause: Radio network layer cause value in decimal representation\nReference: 3GPP TS 36.413\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: S1AP-NAS\nProtocol cause: Non-access stratum cause value in decimal representation\nReference: 3GPP TS 36.413\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: S1AP-MISC\nProtocol cause: Miscellaneous cause value in decimal representation\nReference: 3GPP TS 36.413\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: S1AP-PROT\nProtocol cause: S1 Protocol cause value in decimal representation\nReference: 3GPP TS 36.413\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: DIAMETER\nProtocol cause: Cause for protocol failure of GTP-C supporting WLAN, as a representation in decimal digits of the received binary value.\nReference: 3GPP TS 29.274 subclause 8.103\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: IKEV2\nProtocol cause: Cause for protocol failure of IKEV2 supporting untrusted WLAN, as a representation in decimal digits of the received binary value.\nReference: 3GPP TS 29.274 subclause 8.103\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: 5GMM\nProtocol cause: Cause value in decimal representation\nReference: 3GPP TS 24.501 [258] subclause 9.11.3.2\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: 5GSM\nProtocol cause: Cause value in decimal representation\nReference: 3GPP TS 24.501 [258] subclause 9.11.4.2\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: NGAP-RNL\nProtocol cause: Radio network layer cause value in decimal representation\nReference: 3GPP TS 38.413 [295]\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: NGAP-TL\nProtocol cause: Radio network layer cause value in decimal representation\nReference: 3GPP TS 38.413 [295]\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: NGAP-NAS\nProtocol cause: Non-access stratum cause value in decimal representation\nReference: 3GPP TS 38.413 [295]\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: NGAP-MISC\nProtocol cause: Miscellaneous cause value in decimal representation\nReference: 3GPP TS 38.413 [295]\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThe following entry is added to the Reason Protocols table within the Session Initiation Protocol (SIP) Parameters.\nProtocol value: NGAP-PROT\nProtocol cause: S1 Protocol cause value in decimal representation\nReference: 3GPP TS 38.413 [295]\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\nThis subclause defines an extension to the SIP Reason header field enabling the UE to define release cause events. In a network it is useful for the UE to specify a release cause when sending a BYE request or a CANCEL request. This release cause is for information purpose and can be useful for the remote UE to display to the user. For a network explicit release causes makes it possible to distinguish reasons for releasing a call. The network can then log error cases more accurate.\nThis document adds to the existing IANA registry for the SIP Reason header field the following protocol value and protocol cause:\nTable 7.2A.18.11-1: Addition to the IANA Registry for the SIP Reason header field\n\nThis document adds to the existing IANA registry for SIP Reason header Reason-text strings associated with their respective protocol type and Reason- param cause values:\nTable 7.2A.18.11-2: Cause values and Reason-text strings for the RELEASE_CAUSE protocol value\n\n\nThis subclause defines an extension to the SIP Reason header field to indroduce a new protocol enabling the IMS network entities to define failure cause events. This new indication is intended to be included in SIP error responses with the appropriate cause value and reason text to provide a complementatry indication on the original reason for which this error response has been sent.\nThis document adds to the existing IANA registry for the SIP Reason header field the following protocol value and protocol cause:\nTable 7.2A.18.12-1: Addition to the IANA Registry for the SIP Reason header field\n\nThis document adds to the existing IANA registry for SIP Reason header field the new \"FAILURE_CAUSE\" protocol parameter value associated with their respective protocol-cause values and reason-text strings:\nTable 7.2A.18.12-2: Cause values and Reason-text strings for the FAILURE_CAUSE protocol value\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2A.18.11-1: Addition to the IANA Registry for the SIP Reason header field",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.2A.18.11-2: Cause values and Reason-text strings for the RELEASE_CAUSE protocol value",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.2A.18.12-1: Addition to the IANA Registry for the SIP Reason header field",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.2A.18.12-2: Cause values and Reason-text strings for the FAILURE_CAUSE protocol value",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2A.19\tThig-path",
                            "text_content": "The thig-path header field parameter is defined to enable the P-CSCF which is located in the visited network to subscribe to user's registration-state event package if topology hiding is done on the Path header field.\nThe thig-path header field parameter is coded as a . The thig-path  is a SIP  of the visited network IBCF which applied topology hiding on the Path header field contained in the REGISTER request. The thig-path  may be included as:\n-\ta fcap-string-value within the \"g.3gpp.thig-path\" feature-capability indicator, as defined in subclause 7.9A.9 and RFC 6809 [190]; or\n-\tas a value of the P-Asserted-Identity header field.\nAn example of a g.3gpp.thig-path feature-capability indicator containing thig-path  is:\n+g.3gpp.thig-path = \"<sip:visit-abc@ibcf-vA1.visited-A.net:5070;lr>\"\n\nAn example of a thig-path  in a P-Asserted-Identity header field is:\nP-Asserted-Identity: <sip:visit-abc@ibcf-vA1.visited-A.net:5070;lr>\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2A.20\t\"verstat\" tel URI parameter definition",
                            "text_content": "This extension defines the \"verstat\" tel URI parameter used in the P-Asserted-Identity and the From header fields in a SIP request.\nThe status of the calling number verification performed by the home network is represented as a URI parameter for the tel URI scheme and SIP URI representation of telephone numbers. The ABNF syntax is as specified in Table 7.2A.20.2-1 and extends the formal syntax for the tel URI as specified in RFC 3966 [22]:\nTable 7.2A.20.2-1\npar =/ verstat\nverstat = verstat-tag \"=\" verstat-value\nverstat-tag = \"verstat\"\nverstat-value = \"TN-Validation-Passed\" / \"TN-Validation-Failed\" / \"No-TN-Validation\" / other-value\nother-value = token\n\nThe \"verstat\" tel URI parameter may be supported by IM CN subsystem entities that provide the AS role and by IM CN subsystem entities that provide the proxy role.\nThe \"verstat\" tel URI parameter is inserted by an AS or a proxy in the IM CN subsystem to provide the UE with the calling identity number verification status in an initial INVITE request or when a standalone message is delivered.\nTable 7.2A.20.3-1 shows the \"verstat\" parameter values that are currently defined:\nTable 7.2A.20.3-1: Verstat values\n\nNOTE:\tThere is no default value for the \"verstat\" parameter. If new values are defined, specifications need to describe the appropriate procedure if an endpoint receives a parameter value that it does not support.\nNOTE:\tThis subclause contains information to be provided to IANA for the registration of the tel URI parameter \"verstat\".\nThis parameter needs to be defined in the sub-registry under the tel URI parameters.\n\nContact name, email address, and telephone number:\n3GPP Specifications Manager\n\n+33 (0)492944200\n\nName of the parameter\n\"verstat\"\n\nWhether the parameter only accepts a set of predefined values\nConstrained\n\nReference to the RFC or other permanent and readily available public specification defining the parameter and new values\nThis parameter and its values are defined in 3GPP TS 24.229.\n\nDescription:\nThis tel URI parameter is used in networks supporting calling number verification, as described in RFC 8224. The tel URI parameter provides a means to identify that a number in a tel URI or a SIP URI with the user=phone parameter has been verified (verification passed or failed) or to identify that verification was not performed for the number. SIP user agents can use this information to apply functionality based on the verification status. An overview of the 3GPP IM CN subsystem can be found in 3GPP TS 23.228 and 3GPP TS 24.229.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2A.20.3-1: Verstat values",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2A.21\tExtension to \"isub-encoding\" tel URI parameter",
                            "text_content": "This extension defines a new value \"user-specified\" for the \"isub-encoding\" tel URI parameter.\nThe syntax for the \"isub-encoding\" tel URI parameter is defined in IETF RFC 4715 [259].\nThis specification reuses the \"isub-encoding\" tel URI parameter and defines the new value \"user-specified\" as listed in table 7.2A.21.2-1.\nTable 7.2A.21.2-1: Syntax of extension of \"isub-encoding\" tel URI parameter\nisub-encoding-value =/ \"user-specified\"\n\nThe semantics of this \"isub-encoding\" value are described below:\nuser-specified: Indication that the \"isub\" parameter value needs to be encoded using a user-specified encoding type.\nThis subclause defines an extension to the SIP \"isub-encoding\" tel URI parameter to introduce a new value \"user-specified\" enabling the IMS network entities to identify that the \"isub\" tel URI parameter has been encoded using a user specified format.\nThis document adds to the existing IANA registry for the SIP \"isub-encoding\" tel URI parameter the following value:\nTable 7.2A.21.3.2-1: Addition to the IANA Registry for the \"isub-encoding\" SIP tel URI parameter\n\nContact:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2A.21.3.2-1: Addition to the IANA Registry for the \"isub-encoding\" SIP tel URI parameter",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2A.22\tscscf-reselection parameter definition",
                            "text_content": "The \"scscf-reselection\" parameter is a SIP URI parameter intended to:\n-\tinform the S-CSCF it has been reselected due to failure of the previously assigned S-CSCF.\nThe syntax for the scscf-reselection parameter is specified in table 7.2A.22.2-1:\nTable 7.2A.22.2-1: Syntax of scscf-reselection parameter\n\nuri-parameter =/ scscf-reselection\nscscf-reselection = \"scscf-reselection\"\n\n\nThe BNF for uri-parameter is taken from RFC 3261 [26] and extended accordingly.\nThe \"scscf-reselection\" parameter is appended to the address of the S-CSCF by the I-CSCF, upon failed communication with the currently assigned S-CSCF. The S-CSCF receiving this parameter includes the S-CSCF reselection indicator set to \"true\" in the S-CSCF Registration procedure with the HSS, as described in 3GPP TS 29.562 [274], so the change of S-CSCF is accepted by the HSS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.3\tOption-tags defined within the present document",
                    "description": "",
                    "summary": "",
                    "text_content": "There are no option-tags defined within the present document over and above those defined in the referenced IETF specifications.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.4\tStatus-codes defined within the present document",
                    "description": "",
                    "summary": "",
                    "text_content": "There are no status-codes defined within the present document over and above those defined in the referenced IETF specifications.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.5\tSession description types defined within the present document",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.5.1\tGeneral",
                            "text_content": "This subclause contains definitions for SDP parameters that are specific to SDP usage in the 3GPP IM CN Subsystem and therefore are not described in an RFC.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.2\tEnd-to-access-edge media plane security",
                            "text_content": "The end-to-access-edge media security-indicator is used to indicate that a UE requests a P-CSCF to apply media plane security or to indicate that a P-CSCF has applied end-to-access-edge media security as defined in 3GPP TS 33.328 [19C].\n3GPP end-to-access-edge media security indicator is a value attribute which is encoded as a media-level SDP attribute with the ABNF syntax defined in table 7.5.1. ABNF is defined in RFC 2234 [20G].\nTable 7.5.1: ABNF syntax of 3ge2ae attribute\n3ge2ae-attribute = \"a=3ge2ae:\" indicator\nindicator = \"requested\" / \"applied\" / token\n\"requested\": the sender indicates its wish that end-to-access-edge media security is applied.\n\"applied\": the sender indicates that it has applied end-to-access-edge media security.\nThis version of the specification only defines usage of the \"requested\" and \"applied\" attribute values. Other values shall be ignored.\nThe \"3ge2ae\" attribute is charset-independent.\nNOTE:\tThis subclause contains information to be provided to IANA for the registration of the end-to-access-edge security indicator SDP attribute.\nContact name, email address, and telephone number:\n3GPP Specifications Manager\n3gppContact@etsi.org\n+33 (0)492944200\nAttribute Name (as it will appear in SDP)\n3ge2ae\nLong-form Attribute Name in English:\n3GPP_e2ae-security-indicator\nType of Attribute\nMedia level\nIs Attribute Value subject to the Charset Attribute?\nThis Attribute is not dependent on charset.\nPurpose of the attribute:\nThis attribute specifies the end-to-access-edge security-indicator as used for IMS media plane security\nAppropriate Attribute Values for this Attribute:\nThe attribute is a value attribute. The values \"requested\" and \"applied\" are defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.3\tOptimal Media Routeing (OMR) attributes",
                            "text_content": "The SDP attributes associated with OMR are used to identify and select alternative media plane paths for the purpose of bypassing unneeded media functions in the network, as described in 3GPP TS 29.079 [11D].\nThe visited-realm attribute contains an IP realm identifier and transport address for a media function in the media plane that can potentially be used to bypass other allocated media functions.\nThe secondary-realm attribute contains an IP realm identifier and transport address for an alternate media function in the media plane that can potentially be used to bypass other allocated media functions.\nThe omr-s-cksum and omr-m-cksum attributes includes checksums for session level information and media level information to identify if the SDP was altered by intermediaries in such a way as to invalidate OMR information present in the SDP.\nThe \"omr-codecs\", \"omr-m-att\" and \"omr-s-att\" attributes contain codec-related SDP offer information encapsulated by a SIP- in the signalling path that has modified codec related information.\nThe \"omr-m-bw\" and \"omr-s-bw\" attributes contain bandwidth-related SDP offer information encapsulated by a SIP- in the signalling path that has modified codec related information.\nEach group of zero or more versions of each of the \"omr-codecs\", \"omr-m-att\", \"omr-s-att\", \"omr-m-bw\" and \"omr-s-bw\" attributes for a media line with the same instance number is associated with the visited-realm instance for the modified media line and represents the version of the SDP information for the media line before modifications.\nThe syntax specified in table 7.5.2 uses the augmented Backus-Naur Form as described in RFC 2234 [20G].\nTable 7.5.2: Syntax OMR attributes\nvisited-realm      = \"visited-realm\" \":\" instance-number SP\nrealm SP\nnettype SP                                      ;from RFC 4566 [39]\naddrtype SP                                     ;from RFC 4566 [39]\nconnection-address SP                           ;from RFC 4566 [39]\nport                                            ;from RFC 4566 [39]\n[SP rtcp-port [SP rtcp-address]]\n*(SP extension-name SP extension-value)\n\nsecondary-realm    = \"secondary-realm\" \":\" instance-number SP\nrealm SP\nnettype SP                                      ;from RFC 4566 [39]\naddrtype SP                                     ;from RFC 4566 [39]\nconnection-address SP                           ;from RFC 4566 [39]\nport                                            ;from RFC 4566 [39]\n[SP rtcp-port [SP rtcp-address]]\n*(SP extension-name SP extension-value)\n\ninstance-number    = 1*DIGIT\n\nrealm              = non-ws-string            ;from RFC 4566 [39]\n\nrtcp-port          = \"rtcp-port\" SP port\n\nrtcp-address       = \"rtcp-address\" SP connection-address\n\nextension-name     = token              ;shall be different to existing tokens \"previsous-fmt\",\n\"rtcp-port\" and \"rtcp-address\".\nextension-value    = non-ws-string\n\nomr-m-cksum      = \"omr-m-cksum\" \":\" 1*HEXDIG\n\nomr-s-cksum      = \"omr-s-cksum\" \":\" 1*HEXDIG\n\nomr-codecs         = \"omr-codecs\" \":\" instance-number SP proto 1*(SP fmt) ;from RFC 4566 [39]\n\nomr-m-att          = \"omr-m-att\" \":\" instance-number SP attribute        ;from RFC 4566 [39]\n\nomr-s-att          = \"omr-s-att\" \":\" instance-number SP attribute        ;from RFC 4566 [39]\n\nomr-m-bw           = \"omr-m-bw\" \":\" instance-number SP bwtype \":\" bandwidth ;from RFC 4566 [39]\n\nomr-s-bw           = \"omr-s-bw\" \":\" instance-number SP bwtype \":\" bandwidth ;from RFC 4566 [39]\n\n\nThis grammar encodes the primary media level information about each visited-realm and secondary-realm instance: the sequence in which the realm was visited, the realm identity, its IP address and port:\n<instance-number>: instance-number is a positive decimal integer which identifies the sequence in which this visited-realm was added during the forwarding of an SDP offer. If an IMS- adds second-realm attribute(s), omr-codecs attribute(s), omr-m-att attribute(s), omr-s-att attribute(s), omr-m-bw attribute(s) and/or the omr-s-bw attribute(s) to an SDP offer it will assign the same instance number as assigned to the visited-realm attribute for the forwarded SDP offer. When used in the SDP answer, the instance-number, realm, nettype and addrtype uniquely identify the corresponding visited-realm or secondary-realm instance from the SDP offer.\n<realm>: identifies a set of mutually reachable IP endpoints that share a common IP addressing scheme.\nEffective application of OMR depends on the scope of each realm being determined by reachability and not by administrative domain. A public IPv4 or IPv6 address reachable from the open internet shall be associated with the special realm \"IN\". For application to OMR in IPv6 networks, a realm corresponds to an IPv6 autonomous system.\nEntity operators must adhere to the following guidelines for creation of an OMR realm string to ensure the integrity of the visited-realm and secondary-realm instance information for their realm(s): 1) Realm strings must be globally unique. It is recommended that a realm string contain a hostname or domain name, following the recommendation in subclause 3.3 of RFC 7616 [286], 2) Realm strings should present a human-readable identifier that can be rendered to a user.\n<nettype>, <addrtype> and <connection-address>: are taken from the connection-field (c= line) of RFC 4566 [39]. They describe the IP address associated with the visited-realm or secondary-realm instance, allowing for IPv4 addresses, IPv6 addresses and FQDNs. The connection-address can be either an IP address or an FQDN.\n<port>: It is the port associated with the visited-realm or secondary-realm instance as taken from RFC 4566 [39]. Its meaning depends on the network being used for the connection-address, and on the transport protocol selected for the corresponding media line, e.g., UDP or .\n<rtcp-port> and <rtcp-address>: taken together are semantically equivalent to the rtcp attribute defined in RFC 3605 [37A]. They optionally encode the RTCP port and address information when the RTCP port number is not exactly one greater than the port for an  stream at the same address.\nThe previous-fmt-list may be supplied within the visited-realm if this attribute is included in an SDP offer and shall not be supplied if this attribute is included in an SDP answer.\nThe visited-realm and secondary-realm attributes can be extended via <extension-name> and <extension-value>. The grammar allows for new name/value pairs to be added at the end of the attribute.\n<omr-m-cksum>: is a hex value calculated on the contents of the media level information per media line.\n<omr-s-cksum>: is a hex value calculated on the contents of the session level information.\n<omr-codecs> provides the transport format <proto> and list of media formats (e.g., payload type numbers) <fmt> supported by the visited-realm instance immediately preceding the instance identified by <instance-number>. Transport format <proto> and media format <fmt> are defined in RFC 4566 [39] for the SDP m-line.\n<omr-m-att> provides a media level SDP attribute <attribute> supported by the visited-realm instance immediately preceding the instance identified by <instance-number>. Attribute <attribute> is defined in RFC 4566 [39] for the SDP a-line.\n<omr-s-att> provides a session level SDP attribute <attribute> supported by the visited-realm instance immediately preceding the instance identified by <instance-number>. Attribute <attribute> is defined in RFC 4566 [39] for the SDP a-line.\n<omr-m-bw> provides a media level SDP bandwidth described by <bwtype> and <bandwidth> supported by the visited-realm instance immediately preceding the instance identified by <instance-number>. <bwtype> and <bandwidth> are defined in RFC 4566 [39] for the SDP b-line.\n<omr-s-bw> provides a session level SDP bandwidth described by <bwtype> and <bandwidth> supported by the visited-realm instance immediately preceding the instance identified by <instance-number>. <bwtype> and <bandwidth> are defined in RFC 4566 [39] for the SDP b-line.\nThe \"visited-realm\", \"secondary-realm\", \"omr-m-cksum\", \"omr-s-cksum\", \"omr-codecs\", \"omr-m-att\", \"omr-s-att\" \"omr-m-bw\" and \"omr-s-bw\" SDP attributes are media-level attributes.\nContact Name:3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: visited-realm\nLong Form: visited-realm\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks employing OMR procedures allowing to bypass border gateways in configurations in which IP realms are re-entered when establishing an end-to-end multimedia session. This attribute is used to identify configurations in which IP realms are re-entered when establishing an end-to-end multimedia session, so that border gateways can be bypassed without compromising their role in securing access to the networks. The attribute provides a means to identify connection information for visited IP realms to help select the most optimal available path.\nAppropriate Values: See table 7.5.2.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: secondary-realm\nLong Form: secondary-realm\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks employing OMR procedures allowing to bypass border gateways in configurations in which IP realms are re-entered when establishing an end-to-end multimedia session. This attribute is used to identify configurations in which secondary IP realms are available to establish an end-to-end multimedia session, so that border gateways can be bypassed without compromising their role in securing access to the networks. The attribute provides a means to identify connection information for secondary IP realms to help select the most optimal available path.\nAppropriate Values: See table 7.5.2.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: omr-s-cksum\nLong Form: omr-s-cksum\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks employing OMR procedures allowing to bypass border gateways in configurations in which IP realms are re-entered when establishing an end-to-end multimedia session. This attribute is used to provide a means to verify that session level SDP information has not been modified by intermediate SIP nodes not supporting the OMR procedures. The attribute provides a checksum calculated value against the session level information. Any OMR information associated with unexpectedly modified media information will be discarded.\nAppropriate Values: See table 7.5.2.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: omr-m-cksum\nLong Form: omr-m-cksum\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks employing OMR procedures allowing to bypass border gateways in configurations in which IP realms are re-entered when establishing an end-to-end multimedia session. This attribute is used to provide a means to verify that media level SDP information has not been modified by intermediate SIP nodes not supporting the OMR procedures. The attribute provides a checksum calculated value against the media level information associated with the media stream for which the checksum is provided. Any OMR information associated with unexpectedly modified media information will be discarded.\nAppropriate Values: See table 7.5.2.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: omr-codecs\nLong Form: omr-codecs\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks employing OMR procedures allowing to bypass border gateways in configurations in which IP realms are re-entered when establishing an end-to-end multimedia session. The attribute provides a means to encapsulate codec related SDP information transport format and list of media formats that are applicable if a particular border gateway is bypassed.\nAppropriate Values: See table 7.5.2.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: omr-m-att\nLong Form: omr-m-att\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks employing OMR procedures allowing to bypass border gateways in configurations in which IP realms are re-entered when establishing an end-to-end multimedia session. The attribute provides means to encapsulate a media-level SDP attribute that is applicable if a particular border gateway is bypassed.\nAppropriate Values: See table 7.5.2.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: omr-s-att\nLong Form: omr-s-att\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks employing OMR procedures allowing to bypass border gateways in configurations in which IP realms are re-entered when establishing an end-to-end multimedia session. The attribute provides means to encapsulate a session-level SDP attribute that is applicable if a particular border gateway is bypassed.\nAppropriate Values: See table 7.5.2.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: omr-m-bw\nLong Form: omr-m-bw\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks employing OMR procedures allowing to bypass border gateways in configurations in which IP realms are re-entered when establishing an end-to-end multimedia session. The attribute provides means to encapsulate a media-level SDP bandwidth that is applicable if a particular border gateway is bypassed.\nAppropriate Values: See table 7.5.2.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: omr-s-bw\nLong Form: omr-s-bw\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks employing OMR procedures allowing to bypass border gateways in configurations in which IP realms are re-entered when establishing an end-to-end multimedia session. The attribute provides means to encapsulate a session-level SDP bandwidth that is applicable if a particular border gateway is bypassed.\nAppropriate Values: See table 7.5.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.4\tMedia plane optimization for WebRTC",
                            "text_content": "The SDP attributes associated with media plane optimization procedures for WebRTC are used to encapsulate an SDP offer or SDP answer received from a WIC, as described in 3GPP TS 23.228 [7], annex U.2.4.\nThe \"tra-m-line\" and \"tra-att\" SDP attributes contain media-related SDP information which is applicable if optimized transparent media between WICs are selected. In the SDP offer, the attributes describe the offered transparent media which can be selected. In the SDP answer, the presence of the attributes indicates that the transparent media have been selected and the attributes which have been selected.\nThe \"tra-SCTP-association\" SDP attribute indicates for a media line that the related optimized transparent media are transported in the indicated SCTP association. The optimized transparent media related to several media lines can be transported in the same SCTP association.\nThe \"tra-bw\" SDP attribute contains bandwidth-related SDP information which is applicable if the optimized transparent media between WICs are selected. In the SDP offer, the attributes describe the bandwidths the offerer wants to receive for transparent media. In the SDP answer, the attributes describe the bandwidths the answerer wants to receive for transparent media.\nThe \"tra-contact\" SDP attribute in the SDP offer encapsulate address information which is compared with the address information in contact by the receiving eP-CSCF to detect whether intermediates that do not support switching to transparent media between WICs are in the path.\nThe \"tra-media-line-number\" SDP attribute provides the total number of media lines in the SDP, excluding any media lines with port zero, which is compared with the real number of media lines in the SDP, excluding any media lines with port zero, by the receiving eP-CSCF to detect whether intermediates have removed or dissabled media lines.\nThe syntax specified in table 7.5.4.3-1 uses the augmented Backus-Naur Form as described in RFC 2234 [20G].\nTable 7.5.4.3-1: Syntax of media plane optimization for WebRTC related SDP attributes\n\ntra-contact            = \"tra-contact\" \":\" nettype SP addrtype SP connection-address\n; from RFC 4566 [39]\n\ntra-m-line             = \"tra-m-line\" \":\" media SP port [\"/\" integer] proto 1*(SP fmt)\n; from RFC 4566 [39]\n\ntra-att                = \"tra-att\" \":\" attribute                ; from RFC 4566 [39]\n\ntra-bw                 = \"tra-bw\" \":\" bwtype \":\" bandwidth      ; from RFC 4566 [39]\n\ntra-SCTP-association   = \"tra-SCTP-association\" \":\" SCTP-association-number\n\ntra-media-line-number  = \"media-line-number\" \":\" m-line-number\n\nSCTP-association-number = integer\n\nm-line-number           = integer\n\n\nThis grammar encodes the media level information received in an initial SDP offer from a WIC.\n<tra-contact>: It is the contact used in the outgoing SDP offer which contains encapsulated media information. It contains nettype, addrtype and connection-address. Nettype, addrtype and connection-address are defined in RFC 4566 [39].\n<tra-m-line>: provides the media <media>, port <port>, transport format <proto> and list of media formats (e.g., payload type numbers) <fmt> in the received SDP offer. Media <media>, port <port>, transport format <proto> and media format <fmt> are defined in RFC 4566 [39] for the SDP m-line.\n<tra- att> provides an encapsulated SDP attribute <attribute> supported by the sender of the offer. Attribute <attribute> is defined in RFC 4566 [39] for the SDP a-line.\n<tra- bw> provides an SDP bandwidth described by <bwtype> and <bandwidth> supported by the sender of the offer. <bwtype> and <bandwidth> are defined in RFC 4566 [39] for the SDP b-line.\n<tra-SCTP-association> provides the number <SCTP-association-number> of an SCTP association a media line relates to. If optimized media are selected, the media related to a media line with an \"a= tra-SCTP-association\" SDP attribute will be transported in that SCTP association, possibly together with media relating to other media lines with a= tra-SCTP-association\" SDP attributes with the same <SCTP-association-number>. For a WIC terminating call, the eP-CSCF receiving an offer from the core network containg m-lines with \"a= tra-SCTP-association\" SDP attributes with the same <SCTP-association-number> will construct a single m-line related to that SCTP association in the offer towards the served WIC.\n<tra-media-line-number> provides the total number  <m-line-number> of media lines in the SDP, excluding any media lines with port zero.\nThe \"tra-contact\", \"tra- att\", \"tra-bw\", SDP attributes are session and media-level attributes.\nThe \"tra-m-line\" and \"tra-SCTPassociation\" SDP attributes are media level attributes.\nThe \"tra-media-line-number\" SDP attribute is a session level attribute.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: tra-contact\nLong Form: tra-contact\nType of Attribute: session and media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks supporting WebRTC-IMS interworking. This attribute is used to encapsulate contact information received from gateways in the SDP offers and SDP answers when setting up a session that supports media plane optimization feature as specified in 3GPP TS 23.228 and 3GPP TS 24.371.\nAppropriate Values: See table 7.5.4.3-1.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: tra-m-line\nLong Form: tra-m-line\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks supporting WebRTC-IMS interworking. This attribute is used to encapsulate an m-line received in an SDP offer or SDP answer into an attribute in an outgoing SDP offer or SDP answer when setting up a session that supports media plane optimization feature as specified in 3GPP TS 23.228 and 3GPP TS 24.371.\nAppropriate Values: See table 7.5.4.3-1.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: tra-att\nLong Form: tra-att\nType of Attribute: session and media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks supporting WebRTC-IMS interworking. This attribute is used to encapsulate an attribute received in an SDP offer or SDP answer into an attribute in an outgoing SDP offer or SDP answer when setting up a session that supports media plane optimization feature as specified in 3GPP TS 23.228 and 3GPP TS 24.371.\nAppropriate Values: See table 7.5.4.3-1.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: tra-bw\nLong Form: tra-bw\nType of Attribute: session and media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks supporting WebRTC-IMS interworking. This attribute is used to encapsulate bandwidth information received in the SDP offers and SDP answers when setting up a session that supports media plane optimization feature as specified in 3GPP TS 23.228 and 3GPP TS 24.371.\nAppropriate Values: See table 7.5.4.3-1.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: tra-SCTP-association\nLong Form: tra-SCTP-association\nType of Attribute: media level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks supporting WebRTC-IMS interworking. This attribute is used to indicate that a media line relates to an SCTP association received in the SDP offers and SDP answers when setting up a session that supports media plane optimization feature as specified in 3GPP TS 23.228 and 3GPP TS 24.371.\nAppropriate Values: See table 7.5.4.3-1.\nContact Name: 3GPP Specifications Manager, , +33 (0)492944200\nAttribute Name: tra-media-line-number\nLong Form: tra-media-line-number\nType of Attribute: session level\nCharset Considerations: The attribute is not subject to the charset attribute.\nPurpose: This attribute is used in networks supporting WebRTC-IMS interworking. This attribute is used to encapsulate the total number  of media lines in the SDP, excluding any media lines with port zero, to detect a removal or dissabling of media lines by intermediate nodes when setting up a session that supports media plane optimization feature as specified in 3GPP TS 23.228 and 3GPP TS 24.371.\nAppropriate Values: See table 7.5.4.3-1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.6\tSDP content attribute values",
                            "text_content": "As defined in RFC 4796 [206], the \"a=content\" attribute is a media level attribute in SDP.\nThe SDP \"a=content\" attribute \"g.3gpp.announcement-no-confirmation\" value is used only for informative purposes during an established session, to indicate an SDP media description is for the video announcement service and the operator wishes to play the announcement stream without user confirmation.\nThe AS may use this value, based on the operator policy, only for the video announcement which is important or needs to be seen by the user immediately.\nThe UE may accept to play the video announcement without user confirmation when received this value, based on UE's local policy (e.g., local configuration on the UE).\nThe use of the SDP \"a=content\" attribute \"g.3gpp.announcement-no-confirmation\" value shall conform to the procedure specified in 3GPP TS 24.628 [8ZF].\nIANA registration table: \"content SDP Parameters\" table of \"Session Description Protocol (SDP) Parameters\" registry.\nIANA registry: A new value \"g.3gpp.announcement-no-confirmation\" for the SDP a=content media-level attribute defined in RFC 4796 [206].\nReference: 3GPP TS 24.229, .\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.6\t3GPP IM CN subsystem XML body",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.6.1\tGeneral",
                            "text_content": "This subclause contains the 3GPP IM CN Subsystem XML body in XML format. The 3GPP IM CN Subsystem XML shall be valid against the 3GPP IM CN Subsystem XML schema defined in table 7.6.1.\nAny SIP User Agent or proxy may insert or remove the 3GPP IM CN subsystem XML body or parts of it, as required, in any SIP message. The 3GPP IM CN subsystem XML body shall not be forwarded outside a 3GPP network.\nSee subclause 7.6.4 and subclause 7.6.5 for the associated MIME type definition.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.2\tDocument Type Definition",
                            "text_content": "The XML Schema, is defined in table 7.6.1.\nTable 7.6.1: IM CN subsystem XML body, XML Schema\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" elementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\" version=\"1\">\n<xs:complexType name=\"tIMS3GPP\">\n<xs:sequence>\n<xs:choice>\n<xs:element name=\"alternative-service\" type=\"tAlternativeService\"/>\n<xs:element name=\"service-info\" type=\"xs:string\"/>\n</xs:choice>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"version\" type=\"xs:decimal\" use=\"required\"/>\n<xs:anyAttribute/>\n</xs:complexType>\n<xs:complexType name=\"tAlternativeService\">\n<xs:sequence>\n<xs:element ref=\"type\"/>\n<xs:element name=\"reason\" type=\"xs:string\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute/>\n</xs:complexType>\n\n<!-- root element -->\n<xs:element name=\"ims-3gpp\" type=\"tIMS3GPP\"/>\n\n<xs:element name=\"type\" type=\"xs:string\"/>\n\n<!-- action element for //ims-3gpp//alternative-service -->\n<xs:element name=\"action\" type=\"xs:string\"/>\n\n</xs:schema>\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.3\tXML Schema description",
                            "text_content": "This subclause describes the elements of the IM CN subsystem XML Schema as defined in table 7.6.1.\n<ims-3gpp>:\tThe <ims-3gpp> element is the root element of the IM CN subsystem XML body. It is always present. XML instance documents of future versions of the XML Schema in table 7.6.1 is valid against the XML Schema in table 7.6.1 in this document. XML instance documents of the XML Schema in table 7.6.1 in the present document have a version attribute value, part of the <ims-3gpp> element, that is equal to the value of the XML Schema version described in the present document.\n<service-info>:\tthe transparent element received from the HSS for a particular trigger point are placed within this optional element.\n<alternative-service>:\tin the present document, the alternative service is used as a response for an attempt to establish an emergency session within the IM CN subsystem or as a response to initiate S-CSCF restoration procedures. The element describes an alternative service where the call should success. The alternative service is described by the type of service information. A possible reason cause why an alternative service is suggested may be included.\nIn the present document, the <alternative-service> element contains a <type> element, a <reason> element, and an optional <action> element.\nThe <type> element indicates the type of alternative service. The <type> element contains only the values specified in table 7.6.2 in the present document.\nTable 7.6.2: ABNF syntax of values of the <type> element\nemergency-value = %x65.6D.65.72.67.65.6E.63.79 ; \"emergency\"\nrestoration-value = %x72.65.73.74.6F.72.61.74.69.6F.6E ; \"restoration\"\n\nThe <action> element contains only the values specified in table 7.6.3 in the present document.\nTable 7.6.3: ABNF syntax of values of the <action> element\nemergency-registration-value = %x65.6D.65.72.67.65.6E.63.79.2D.72.65.67.69.73.74.72.61.74.69.6F.6E ; \"emergency-registration\"\ninitial-registration-value = %x69.6E.69.74.69.61.6C.2D.72.65.67.69.73.74.72.61.74.69.6F.6E ; \"initial-registration\"\nanonymous-emergencycall-value = %x61.6E.6F.6E.79.6D.6F.75.73.2D.65.6D.65.72.67.65.6E.63.79.63.61.6C.6C ; \"anonymous-emergencycall\"\n\nThe <reason> element contains an explanatory text with the reason why the session setup has been redirected. A UE may use this information to give an indication to the user.\nIf included in the IM CN subsystem XML body:\n1.\tthe <type> element with the value \"emergency\" is included as the first child element of the <alternative-service> element;\n2.\tthe <type> element with the value \"restoration\" is included as one of the following:\na)\tthe first child element of the <alternative-service> element; or\nb)\tthe third or later child element of the <alternative-service> element;\n3.\tthe <action> element with the value \"emergency-registration\" is includes as the third child element of the <alternative-service> element;\n4.\tthe <action> element with value \"initial-registration\" is included as the third or later child element of the <alternative-service> element; and\n5.\tthe <action> element with value \"anonymous-emergencycall\" is included as the third or later child element of the <alternative-service> element.\n\nNOTE:\tWhen included, the <action> and the second occurence of the <type> elements are validated by the <xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/> particle of their parent elements.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.4\tMIME type definition",
                            "text_content": "This subclause defines the MIME type for \"application/3gpp-ims+xml\". A 3GPP IM CN subsystem XML Document can be identified with this media type.\nThe following optional parameters are defined:\n-\t\"charset\": the parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in RFC 3023 [132].\n-\t\"sv\" or \"schemaversion\": the syntax for the \"sv\" or \"schemaversion\" parameter is specified in table 7.6.4:\nTable 7.6.4: Syntax of the \"sv\" or \"schemaversion\" parameter\n\nm-parameter    =/ (\"sv\" / \"schemaversion\") EQUAL LDQUOT [ sv-value-list ] RDQUOT\nsv-value-list  =  sv-value-range *( \",\" sv-value )\nsv-value-range =  sv-value [ \"-\" sv-value ]\nsv-value       =  number / token\nnumber         =  1*DIGIT [ \".\" 1*DIGIT ]\n\n\nThe BNF for m-parameter is taken from RFC 3261 [26] and modified accordingly.\nThe encoding considerations for \"application/3gpp-ims+xml\" are identical to those of \"application/xml\" as described in RFC 3023 [132].\nThe \"sv\" or \"schemaversion\" parameter's value is used to indicate:\n-\tthe versions of the 3GPP IM CN Subsystem XML schema that can be used to validate the 3GPP IM CN subsystem XML body (if the MIME type and parameter are present in the Content-Type header field); or\n-\tthe accepted versions of the 3GPP IM CN Subsystem XML body (if the MIME type and parameter are present in the Accept header field).\nIf the \"sv\" and \"schemaversion\" parameter are absent, it shall be assumed that version 1 of the XML Schema for the IM CN subsystem XML body is supported.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.5\tIANA Registration",
                            "text_content": "NOTE:\tRFC 4288 [161], subclause 9, states the process that applies in case of changes to the registry of media types. Any future changes to the format or to subclause 7.6.5 would invoke this procedure.\nMIME media type name:\napplication\nMIME subtype name:\n3gpp-ims+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in RFC 3023 [132].\n\"sv\" or \"schemaversion\"\tthe parameter's value is used to indicate:\n-\tthe versions of the 3GPP IP Multimedia (IM) Core Network (CN) subsystem XML schema that can be used to validate the 3GPP IM CN subsystem XML body (if the MIME type and parameter are present in the Content-Type header field); or\n-\tthe accepted versions of the 3GPP IM CN Subsystem XML body (if the MIME type and parameter are present in the Accept header field).\nIf the \"sv\" and \"schemaversion\" parameter are absent, it shall be assumed that version 1 of the XML Schema for the IM CN subsystem XML body is supported.\nEncoding considerations:\nSame as encoding considerations of application/xml as specified in RFC 3023 [132]\nSecurity considerations:\nSame as general security considerations for application/xml as specified in subclause 10 of RFC 3023 [132].\nIn addition, this content type provides a format for exchanging information in SIP, so the security considerations from RFC 3261 [26] apply.\nInteroperability considerations:\nSame as Interoperability considerations as specified in subclause 3.1 of RFC 3023 [132].\nIf both \"sv\" and \"schemaversion\" are specified, then the value of \"schemaversion\" is ignored\nPublished specification:\n3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP), stage 3\", as published in subclause 7.6.5, version 8.9.0.\nAvailable via <http://www.3gpp.org/specs/numbering.htm>.\nApplications which use this media:\nApplications that use the 3GPP IM CN Subsystem as defined by 3GPP.\nIntended usage:\nCOMMON\nAdditional information:\n1.\tMagic number(s): none\n2.\tFile extension(s): none\n3.\tMacintosh file type code: none\n4.\tObject Identifiers: none\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.7\tSIP timers",
                    "description": "",
                    "summary": "",
                    "text_content": "The timers T1, T2, T4 A, B, C, D, E, F, G, H and I (defined in RFC 3261 [26]), timers L and M (defined in RFC 6026 [163]), and timer N (defined in RFC 6665 [28]) need modification in some cases to accommodate the delays introduced by the air interface processing and transmission delays. Table 7.7.1 shows recommended values for IM CN subsystem.\nTable 7.7.1 lists in the first column, titled \"SIP Timer\" the timer names as defined in RFC 3261 [26] and RFC 6026 [163].\nThe second column, titled \"value to be applied between IM CN subsystem elements\" lists the values recommended for network elements e.g. P-CSCF, S-CSCF, MGCF, when communicating with each other i.e. when no air interface leg is included. These values are identical to those recommended by RFC 3261 [26], RFC 6026 [163], and RFC 6665 [28].\nThe third column, titled \"value to be applied at the UE\" lists the values recommended for the UE, when in normal operation the UE generates requests or responses containing a P-Access-Network-Info header field which included a value of \"3GPP-GERAN\",\"3GPP-UTRAN-FDD\", \"3GPP-UTRAN-TDD\", \"3GPP-E-UTRAN-FDD\", \"3GPP-E-UTRAN-TDD\", \"3GPP-E-UTRAN-ProSe-UNR\", \"3GPP-NR-FDD\", \"3GPP-NR-TDD\", \"3GPP-NR-U-FDD\", \"3GPP-NR-U-TDD\", \"3GPP-NR-SAT\", \"3GPP-NR-ProSe-L2UNR\", \"3GPP-NR-ProSe-L3UNR\", \"3GPP2-1X\", \"3GPP2-1X-HRPD\", \"3GPP2-UMB\", \"IEEE-802.11\", \"IEEE-802.11a\", \"IEEE-802.11b\", \"IEEE-802.11g\", \"IEEE-802.11n\", \"IEEE-802.11ac\", or \"DVB-RCS2\". These are modified when compared to RFC 3261 [26] and RFC 6026 [163] to accommodate the air interface delays. In all other cases, the UE should use the values specified in RFC 3261 [26] or RFC 6026 [163] as indicated in the second column of table 7.7.1.\nThe fourth column, titled \"value to be applied at the P-CSCF toward a UE\" lists the values recommended for the P-CSCF when an air interface leg is traversed, and which are used on all SIP transactions on a specific security association where the security association was established using a REGISTER request containing a P-Access-Network-Info header field provided by the UE which included a value of \"3GPP-GERAN\",\"3GPP-UTRAN-FDD\", \"3GPP-UTRAN-TDD\", \"3GPP-E-UTRAN-FDD\", \"3GPP-E-UTRAN-TDD\", \"3GPP-E-UTRAN-ProSe-UNR\", \"3GPP-NR-FDD\", \"3GPP-NR-TDD\", \"3GPP-NR-U-FDD\", \"3GPP-NR-U-TDD\", \"3GPP-NR-SAT\", \"3GPP-NR-ProSe-L2UNR\", \"3GPP-NR-ProSe-L3UNR\", \"3GPP2-1X\", \"3GPP2-1X-HRPD\", \"3GPP2-UMB\", \"IEEE-802.11\", \"IEEE-802.11a\", \"IEEE-802.11b\", \"IEEE-802.11g\", \"IEEE-802.11n\", \"IEEE-802.11ac\", or \"DVB-RCS2\". These are modified when compared to RFC 3261 [26] and RFC 6026 [163]. In all other cases, the P-CSCF should use the values specified in RFC 3261 [26] and RFC 6026 [163] as indicated in the second column of table 7.7.1.\nThe final column reflects the timer meaning as defined in RFC 3261 [26], RFC 6026 [163] or RFC 6665 [28].\nTable 7.7.1: SIP timers\n\n",
                    "tables": [
                        {
                            "description": "Table 7.7.1: SIP timers",
                            "table number": 13,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.8\tIM CN subsystem timers",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 7.8.1 shows recommended values for timers specific to the IM CN subsystem.\nTable 7.8.1: IM CN subsystem\nEditor's note:\t(WI: IMSProtoc18, CR#6590) How to determine the emerg-reg-retry timer value is FFS.\nNOTE:\tThe UE and the P-CSCF use the value of the reg-await-auth timer to set the SIP level lifetime of the temporary set of security associations.\n",
                    "tables": [
                        {
                            "description": "Table 7.8.1: IM CN subsystem",
                            "table number": 14,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.9\tMedia feature tags defined within the current document",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.9.1\tGeneral",
                            "text_content": "This subclause describes the media feature tag definitions that are applicable for the 3GPP IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.2\tDefinition of media feature tag g.3gpp.icsi-ref",
                            "text_content": "Media feature-tag name: g.3gpp.icsi-ref.\n.1 Identifier: 1.3.6.1.8.2.4\nSummary of the media feature indicated by this tag: Each value of the Service Reference media feature-tag indicates the software applications supported by the agent. The values for this tag equal the IMS communication Service Identifier (ICSI) values supported by the agent.\nThe Service Reference media feature tag is defined to fulfil the requirements for forking to an appropriate UE when multiple UEs are registered and dispatch to an appropriate application within the UE based upon the IMS communication Service Identifier (ICSI) values as stated in 3GPP TS 23.228 [7].\nMultiple tag-values can be included in the Service Reference media feature-tag.\nValues appropriate for use with this feature-tag: Token with an equality relationship.\nThe feature-tag is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms:\nThis feature-tag is most useful in a communications application, for describing the capabilities of a device, such as a phone or .\nExamples of typical use: Routeing an IMS Communication Session to a device that supports a particular software application or understands a particular service.\nRelated standards or documents:\n3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP), stage 3\"\nSecurity Considerations: Security considerations for this media feature-tag are discussed in subclause 11.1 of RFC 3840 [62].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.3\tDefinition of media feature tag g.3gpp.iari-ref",
                            "text_content": "Media feature-tag name: g.3gpp.iari-ref.\n.1 Identifier: 1.3.6.1.8.2.5\nSummary of the media feature indicated by this tag: Each value of the Application Reference media feature-tag indicates the software applications supported by the agent. The values for this tag equal IMS Application Reference Identifier (IARI) values supported by the agent\nThe Application Reference media feature tag is defined to fulfil the requirements for forking to an appropriate UE when multiple UEs are registered and dispatch to an appropriate application within the UE based upon and IMS Application Reference Identifier (IARI) values as stated in 3GPP TS 23.228 [7].\nMultiple tag-values can be included in the Application Reference media feature-tag.\nValues appropriate for use with this feature-tag: Token with an equality relationship.\nThe feature-tag is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms:\nThis feature-tag is most useful in a communications application, for describing the capabilities of a device, such as a phone or .\nExamples of typical use: Routeing an IMS Application Session to a device that supports a particular software application or understands a particular application.\nRelated standards or documents:\n3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP), stage 3\"\nSecurity Considerations: Security considerations for this media feature-tag are discussed in subclause 11.1 of RFC 3840 [62].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.6\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.7\tDefinition of media feature tag g.3gpp.registration-token",
                            "text_content": "Media feature tag name: g.3gpp.registration-token\nASN.1 Identifier: .1.8.2.27\nSummary of the media feature indicated by this media feature tag:\nThis media feature tag, when included in a third party SIP REGISTER request, indicates the support of using a token to identify the registration used for the request. The mediafeature tag is assigned a value that can be used by the receiving AS to later identify the used registration for initial requests from an originating user or dialog forming responses from a terminating user.\nMedia feature tag specification reference: 3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this media feature tag:\nString with an equality relationship.\nTable 7.9.7-1: ABNF syntax of values of the g.3gpp.registration-token media feature tag\n\ng-3gpp-registration-token = \"<\"qdtext\">\"\n\n\nThe media feature tag is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This media feature tag is used to indicate support of using a token to identify the registration used for the current request or response among the set of registrations for the registered URI. As the token is unique per URI, different URIs for different users can have the same value of the token.\nExamples of typical use: The S-CSCF includes this media feature tag in a third-party REGISTER request to indicate support of this feature. The value is a unique value identifying this registration among the set of registrations for the registered URI. The S-CSCF includes a token with identical value in subsequent initial requests and responses. An AS supporting this feature can use the value of the token to identify the used registration.\nSecurity Considerations: Security considerations for this media feature-tag are discussed in subclause 11.1 of RFC 3840 [62].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.8\tDefinition of media feature tag g.3gpp.ps-data-off",
                            "text_content": "Media feature tag name: g.3gpp.ps-data-off.\nASN.1 Identifier: .1.8.2.35\nSummary of the feature indicated by this media feature tage: This media feature tag when included in a Contact header field in a REGISTER request indicates the status of the 3GPP PS data off for the registration time.\nThis media feature tag, when included in the Contact header field in a REGISTER request indicates that the UE supports the 3GPP PS data off. The g.3gpp.ps-data-off media feature tag can take a value that indicates whether the 3GPP PS data off has been activated or deactivated by the user at the UE.\nMedia feature tag specification reference: 3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this media feature tag:\nString with an equality relationship\nTable 7.9.8-1: ABNF syntax of values of the g.3gpp.ps-data-off media feature tag\n\ng-3gpp-ps-data-off = \"active\" / \"inactive\" / token\n\n\nExamples of typical use: Indicating support and activation status of the 3GPP PS data off function to IMS network entities.\nSecurity Considerations: Security considerations for this media feature tag are discussed in clause 9 of RFC 6809 [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.9\tDefinition of media feature tag g.3gpp.rlos",
                            "text_content": "Media feature-tag name: g.3gpp.rlos\nASN.1 Identifier: .1.8.2.x\nSummary of the media feature indicated by this tag: This feature-tag when used in a SIP REGISTER request indicates that the function sending the SIP message supports restricted local operator service.\nValues appropriate for use with this feature-tag: Boolean\nThe feature-tag is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-tag is most useful in a communications application, for describing the capabilities of a device, such as a phone or PDA.\nExamples of typical use: Indicating that a mobile phone supports the restricted local operator service\nRelated standards or documents: 3GPP TS 24.229: \" IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\"\nSecurity Considerations: Security considerations for this media feature-tag are discussed in subclause 12.1 of IETF RFC 3840 [53].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.9A\tFeature-capability indicators defined within the current document",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.9A.1\tGeneral",
                            "text_content": "This subclause describes the feature-capability indicators definitions, according to RFC 6809 [190], that are applicable for the 3GPP IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.2\tDefinition of feature-capability indicator g.3gpp.icsi-ref",
                            "text_content": "Feature-capability indicator name: g.3gpp.icsi-ref.\nSummary of the feature indicated by this feature-capability indicator: Each value of the Service Reference feature-capability indicator indicates the software applications supported by the entity. The values for this feature-capability indicator equal the IMS communication Service Identifier (ICSI) values supported by the entity.\nMultiple feature-capability indicator values can be included in the Service Reference feature-capability indicators.\nWhen included in the Feature-Caps header field, according to RFC 6809 [190], the value of this feature-capability indicator contains the IMS communication service identifier (ICSI) of the IMS communication service supported for use:\n-\tin the standalone transaction (if included in a request for a standalone transaction or a response associated with it); or\n-\tin the dialog (if included in an initial request for dialog or a response associated with it);\nby the entity which included the Feature-Caps header field.\nFeature-capability indicator specification reference: 3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator:\nWhen used in a Feature-Caps header field, the g.3gpp-icsi-ref feature-capability indicator is encoded using the feature-cap header field rules specified in clause 6.3 of RFC 6809 [190], where the feature-capability indicator value is an instance of fcap-value-list, listing one or more token values, as specified in RFC 6809 [190].\nExamples of typical use: Indicating support of IMS Communication Services to other network entities.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809 [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.3\tDefinition of feature-capability indicators g.3gpp.trf",
                            "text_content": "Feature-capability indicator name: g.3gpp.trf\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator, when included in a Feature-Caps header field as specified in RFC 6809 [190] in a SIP INVITE request, indicates that in a roaming scenario, the visited network supports a transit and roaming functionality in order to allow loopback of session requests to the visited network from the home network. When used, it may indicate the  of the transit and roaming functionality.\nFeature-capability indicator specification reference: 3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator:\nNone or string with an equality relationship. When used in a Feature-Caps header field, the value is string and follows the syntax as described in table 7.9A.1 for g-3gpp-trf. The value of g-3gpp-trf parameter is an instance of fcap-string-value of Feature-Caps header field specified in RFC 6809 [190].\nTable 7.9A.1: ABNF syntax of values of the g.3gpp.trf feature-capability indicator\n\ng-3gpp-trf = \"<\" SIP- \">\"\n\n\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate visited network support of the roaming architecture for voice over IMS with local breakout and to transport the TRF address.\nExamples of typical use: A visited network indicating the presence and support of a TRF in a visited network to the home network.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809 [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.4\tDefinition of feature-capability indicator g.3gpp.loopback",
                            "text_content": "Feature-capability indicator name: g.3gpp.loopback\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator, when included in a Feature-Caps header field as specified in RFC 6809 [190] in a SIP INVITE request, indicates the support of the roaming architecture for voice over IMS with local breakout.\nFeature-capability indicator specification reference: 3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator:\nNone or a string with an equality relationship.\nWhen used in a Feature-Caps header field, the value is a string identifying the home network and follows the syntax as described in table 7.9A.4-1 for g-3gpp-loopback. The value of g-3gpp-loopback parameter is an instance of fcap-string-value of Feature-Caps header field specified in RFC 6809 [190].\nTable 7.9A.4-1: ABNF syntax of values of the g-3gpp-loopback feature-capability indicator\n\ng-3gpp-loopback = \"<\" 1*(qdtext / quoted-pair) \">\"\n\n\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate support of the roaming architecture for voice over IMS with local breakout and that the INVITE request is a loopback request.\nExamples of typical use: The home network indicating when a loopback INVITE request is sent to a visited network.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809 [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.5\tDefinition of feature-capability indicator g.3gpp.home-visited",
                            "text_content": "Feature-capability indicator name: g.3gpp.home-visited\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator, when included in a Feature-Caps header field as specified in RFC 6809 [190] in a SIP INVITE request, indicates that the home network supports loopback to the identified visited network for this session. The loopback is expected to be applied at some subsequent entity to the insertion point. The feature-capability indicator carries a parameter value which indicates the visited network.\nFeature-capability indicator specification reference: 3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator:\nString with an equality relationship. When used in a Feature-Caps header field, the value follows the syntax as described in table 7.9A.2 for g-3gpp-home-visited. The value of g-3gpp-home-visited parameter is an instance of fcap-string-value of Feature-Caps header field specified in RFC 6809 [190].\nTable 7.9A.2: ABNF syntax of values of the g.3gpp.home-visited feature-capability indicator\n\ng-3gpp-home-visited = \"<\" 1*(qdtext / quoted-pair) \">\"\n\n\nThe value follows that used in the P-Visited-Network-ID header field.\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate the home network supports loopback to the identified visited network for this session. The loopback is expected to be applied at some subsequent entity to the insertion point. The feature-capability indicator carries a parameter which indicates the visited network.\nExamples of typical use: A home network indicating the home network supports loopback to the identified visited network for this session.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809 [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.6\tDefinition of feature-capability indicator g.3gpp.mrb",
                            "text_content": "Feature-capability indicator name: g.3gpp.mrb\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator when included in a Feature-Caps header field as specified in RFC 6809 [190] in a SIP INVITE request indicates that in a roaming scenario, the visited network supports media resource broker functionality for the allocation of multimedia resources in the visited network. When used, it indicates the  of the visited network MRB.\nFeature-capability indicator specification reference:\n3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator:\nString with an equality relationship. When used in a Feature-Caps header field, the value is string and follows the syntax as described in table 7.9A.3 for g-3gpp-mrb. The value of g-3gpp-mrb parameter is an instance of fcap-string-value of Feature-Caps header field specified in RFC 6809 [190].\nTable 7.9A.3: ABNF syntax of values of the g.3gpp.mrb feature-capability indicator\n\ng-3gpp-mrb = \"<\" SIP- \">\"\n\n\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate the  of the media resource broker.\nExamples of typical use: Indicating the  of the visited network MRB to the home network.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of draft-ietf-sipcore-proxy-feature [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.7\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.8\tDefinition of feature-capability indicator g.3gpp.registration-token",
                            "text_content": "Feature-capability indicator name: g.3gpp. registration-token\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator, when included in a Feature-Caps header field as specified in RFC 6809 [190], indicates the support of using a token to identify the registration used for the request.\nThis feature-capability indicator can be included in an originating initial request for a dialog or a request for a standalone transaction to identify which registration was used for this request by setting the indicator to the same value as in the g.3gpp.registration-token media feature tag in the Contact header field of the REGISTER request.\nThis feature-capability indicator can be included in 1xx or 2xx response to a terminating initial request for a dialog or a 2xx response to a request for a standalone transaction to identify which registration was used for the response by setting the indicator to the same value as in the g.3gpp.registration-token media feature tag in the Contact header field of the REGISTER request.\nFeature-capability indicator specification reference: 3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator:\nString with an equality relationship.\nWhen used in a Feature-Caps header field, the value is a string identifying the used registration and follows the syntax as described in table 7.9A.8-1 for g-3gpp-registration-token. The value of g-3gpp-registration-token parameter is an instance of fcap-string-value of Feature-Caps header field specified in RFC 6809 [190].\nTable 7.9A.8-1: ABNF syntax of values of the g.3gpp.registration-token feature-capability indicator\n\ng-3gpp-registration-token = \"<\"qdtext\">\"\n\n\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate support of using a token to identify the registration used for the current request or response.\nExamples of typical use: The S-CSCF includes a media feature tag in a third-party REGISTER request to indicate support of this feature. The value is a unique value identifying this registration among the set of registrations for the registered URI. The S-CSCF includes this token with an identical value as in the previous REGISTER request in subsequent initial requests and responses to indicate its continuous support. An AS supporting this feature can use the value of the token to identify the used registration.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809 [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.9\tDefinition of feature-capability indicator g.3gpp.thig-path",
                            "text_content": "Feature-capability indicator name: g.3gpp.thig-path\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator when included in a Feature-Caps header field as specified in RFC 6809 [190] in a 200 (OK) response to the REGISTER request indicates that in a roaming scenario, the visited network IBCF supports topology hiding of a Path header field.\nFeature-capability indicator specification reference:\n3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator:\nString with an equality relationship. When used in a Feature-Caps header field, the value is string and follows the syntax as described in table 7.9A.y for g-3gpp-thig-path. The value of g-3gpp-thig-path parameter is an instance of fcap-string-value of Feature-Caps header field specified in RFC 6809 [190].\nTable 7.9A.9-1: ABNF syntax of values of the g.3gpp.thig-path feature-capability indicator\n\ng-3gpp-thig-path = \"<\" SIP- \">\"\n\n\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate that the visited network IBCF supports topology hiding of a Path header field and to pass to the P-CSCF a SIP  of the visited network IBCF which applied topology hiding on the Path header field.\nExamples of typical use: The visited network IBCF includes the g.3gpp.thig-path feature-capability indicator in a 200 (OK) response to the REGISTER request to pass to the P-CSCF a SIP  of the visited network IBCF which applied topology hiding on the Path header field contained in the REGISTER request.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809 [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.10\tDefinition of feature-capability indicator g.3gpp.priority-share",
                            "text_content": "Feature-capability indicator name: g.3gpp.priority-share.\nSummary of the feature indicated by this feature-capability indicator: When included in a Feature-Caps header field in SIP requests or SIP responses the sender indicates that priority sharing is supported.\nFeature-capability indicator specification reference: 3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator:\nWhen used in a Feature-Caps header field, the g.3gpp.priority-share feature-capability indicator is encoded using the feature-cap header field rules specified in subclause 6.3 of RFC 6809 [190], where the feature-capability indicator value is an instance of fcap-value-list, listing one or more token values, as specified in RFC 6809 [190].\nExamples of typical use: Indicating support of priority sharing to other network entities.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809 [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.11\tDefinition of feature-capability indicator g.3gpp.verstat",
                            "text_content": "Feature-capability indicator name: g.3gpp.verstat\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator, when included in a Feature-Caps header field as specified in RFC 6809 in a 200 (OK) response to a REGISTER request, indicates that the home network supports calling party number verification, as described in RFC 8224.\nFeature-capability indicator specification reference:\n3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator: Not applicable.\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate the support of calling party number verification functionality.\nExamples of typical use: Indicating the support of calling number verification in the home network.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.12\tDefinition of feature-capability indicator g.3gpp.anbr",
                            "text_content": "Feature-capability indicator name: g.3gpp.anbr\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator, when included in a Feature-Caps header field as specified in RFC 6809 in a 200 (OK) response to a REGISTER request, indicates that the network supports ANBR as specified in 3GPP TS 26.114 [9B].\nFeature-capability indicator specification reference:\n3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator: Not applicable.\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate the support of ANBR.\nExamples of typical use: Indicating the support of ANBR.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809 [190].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9A.13\tDefinition of feature-capability indicator g.3gpp.in-call-access-update",
                            "text_content": "Feature-capability indicator name: g.3gpp.in-call-access-update\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator, when included in a Feature-Caps header field as specified in RFC 6809 [190] in a SIP INVITE request or a response to a SIP INVITE, indicates that the entity supports in-call access update procedure specified in 3GPP TS 24.229. The value of this feature capability indicator is a SIP URI to where the entity can be reached.\nFeature-capability indicator specification reference: 3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\nValues appropriate for use with this feature-capability indicator:\nString with an equality relationship. When used in a Feature-Caps header field, the value follows the syntax as described in table 7.9A.13-1 for g-3gpp-in-call-access-update. The value of the g-3gpp-in-call-access-update parameter is an instance of fcap-string-value of Feature-Caps header field specified in RFC 6809.\nTable 7.9A.13-1: ABNF syntax of values of the g.3gpp.in-call-access-update feature-capability indicator\n\ng-3gpp-in-call-access-update = \"<\" SIP-URI \">\"\n\n\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate that an entity reached by the URI in the value supports mid call updates of e.g. location. The mid-call update is performed by a downstream entity when needed.\nExamples of typical use: A network entity indicating support for mid-call updates. A downstream network entity performs the update.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.10\tReg-event package extensions defined within the current document",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.10.1\tGeneral",
                            "text_content": "This subclause describes the reg-event package extensions that are applicable for the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.10.2\tReg-Event package extension to transport wildcarded public user identities",
                            "text_content": "This subclause defines an extension to the event registration package (RFC 3680 [43]) to transport policy to transport wildcarded public user identities that are encoded using regular expression.\nIn order to include a wildcared public user identity in the event registration package, the notifier shall\n1.\tif the registration set of the identity whose registration status is notified contains a wildcarded public user identity, add a <wildcardedIdentity> sub-element defined in subclause 7.10.2.2 of this document to the <registration> element of the wildcarded identiy;\n2.\tfor the <registration> element containing a <wildcardedIdentity> sub-element:\na)\tset the aor attribute to any public user identity that is represented by the wildcarded identity; and\nb)\tset the <wildcardedIdentity> sub-element inside of the <registration> element to the wildcarded identity as received via the Cx interface.\nNOTE:\tThe public user identity that is put into the aor attribute does not have any extra privileges over any other public user identity that is represented by a wildcarded public user identity.\nTable 7.10.1 in this subclause defines the XML Schema describing the extension to transport wildcarded public user identities which can be included in the reg event package sent from the S-CSCF in NOTIFY requests.\nTable 7.10.1: Wildcarded Identity, XML Schema\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\ntargetNamespace=\"urn:3gpp:ns:extRegExp:1.0\"\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nelementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\">\n<xs:element name=\"wildcardedIdentity\" type=\"xs:string\"/>\n</xs:schema>\n\n\nNOTE:\tMultiple wildcarded elements can be included in one registration element.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.10.3\tReg-event package extension for policy transport",
                            "text_content": "This subclause describes coding which extends the registration event package defined in RFC 3680 [43] to transport policy associated with a public user identity.\nThe policy associated with a public user identity shall be encoded as follows:\n1.\tadd an <actions> element defined in the RFC 4745 [182] in the <registration> element of the public user identity in the registration information;\nNOTE:\tThe <actions> element is validated by the <xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/> particle of the <registration> elements.\n2.\tif the policy to the usage of the communication resource priority (see RFC 4412 [116]) is associated with the public user identity, then for each allowed usage:\na.\tinclude <rph> child element in the <actions> child element of the <registration> element;\nb.\tset the 'ns' attribute of the <rph> child element of the <actions> child element of the <registration> element to the allowed resource priority namespace as specified in RFC 4412 [116] and as registered in IANA; and\nc.\tset the 'val' attribute of the <rph> child element of the <actions> child element of the <registration> element to the allowed resource priority value within the allowed resource priority namespace;\n3.\tif the policy to act as privileged sender (the P-CSCF passes identities for all calls) is associated with the public user identity, then include a <privSender> child element in the <actions> child element of the <registration> element;\n4.\tif the policy for special treatment of the P-Private-Network-Indication header field (the P-CSCF allows the UE to make private calls) is associated with the public user identity, then include a <pni> child element in the <actions> child element of the <registration> element, and shall:\na.\tif a P-Private-Network-Indication header field shall be forwarded, if received from the attached equipment, set the \"insert\" attribute of the <pni> element to a \"fwd\" value;\nb.\tif a P-Private-Network-Indication header field shall be inserted in all requests received from the attached equipment, insert an \"insert\" attribute of the <pni> element to a \"ins\" value; and\nc.\tif the value of the \"insert\" attribute is \"ins\", insert a \"domain\" attribute with the value of the  to be set in the P-Private-Network-Indication header field; and\n5.\tif the policy to act as privileged sender for the calls with the P-Private-Network-Indication header field (the P-CSCF allows the UE to make private calls, and the P-CSCF passes identities only for private calls) is associated with the public user identity, then include a <privSenderPNI> child element in the <actions> child element of the <registration> element.\nNOTE:\tIf only the <privSender> child element is sent and no <privSenderPNI> child element is sent, then the <privSender> child element applies to both public network traffic and private network traffic (i.e. that with special treatment of the P-Private-Network-Indication header field).\nTable 7.10.2 in this subclause defines the XML Schema describing the individual policies which can be delivered to the P-CSCF or UE using the reg event package extension for policy transport.\nTable 7.10.2: Reg event package extension for policy transport, XML Schema\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\ntargetNamespace=\"urn:3gpp:ns:extRegInfo:1.0\"\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nelementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\">\n<xs:element name=\"rph\">\n<xs:complexType>\n<xs:attribute name=\"ns\" type=\"xs:string\"/>\n<xs:attribute name=\"val\" type=\"xs:string\"/>\n</xs:complexType>\n</xs:element>\n<xs:element name=\"privSender\">\n<xs:complexType/>\n</xs:element>\n<xs:element name=\"pni\">\n<xs:complexType>\n<xs:attribute name=\"insert\">\n<xs:simpleType>\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"fwd\"/>\n<xs:enumeration value=\"ins\"/>\n</xs:restriction>\n</xs:simpleType>\n</xs:attribute>\n<xs:attribute name=\"domain\" type=\"xs:anyURI\"/>\n</xs:complexType>\n</xs:element>\n<xs:element name=\"privSenderPNI\">\n<xs:complexType/>\n</xs:element>\n</xs:schema>\n\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.11\tURNs defined within the present document",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.11.1\tCountry specific emergency service URN",
                            "text_content": "The country specific emergency service URN is intended to uniquely identify a type of emergency service for which an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69], registered by IANA is not available.\nThe country specific emergency service URN is intended to be used only when an emergency service URN for a given type of emergency service, with approximately the same caller expectation in terms of services rendered, is not registered by IANA.\nThe country specific emergency service URN is intended to be used only inside the country where the national regulatory authority defines emergency services only by national numbers. The country specific emergency service URN is not intended to be used by the UE except when indicated by the network.\nThe country specific emergency service URN is a service URN with:\n1)\tthe top-level service type of \"sos\" as specified in RFC 5031 [69];\n2)\tthe first sub-service of \"country-specific\";\n3)\tthe second sub-service indicating the country where the type of emergency service is deployed. The format of second sub-service is an  3166-1 alpha-2 code as specified in  3166-1 [207]; and\n4)\tthe third sub-service uniquely identifying the type of emergency service in the country where the type of emergency service is deployed. The third sub-service is defined by the national regulation of the country where the type of emergency service is deployed. The set of allowable characters for the third sub-service is the same as that for domain names (see RFC 5031 [69]) and the number of characters for the third sub-service shall be less than 64.\nEXAMPLE:\turn:service:sos.country-specific.xy.567 can identify a type of emergency service identified by an emergency number 567 in a country identified by \"xy\"  3166-1 alpha-2 code as specified in  3166-1 [207].\nUnless explicitly prohibited, wherever an emergency service URN i.e. a service URN with the top-level service type of \"sos\" as specified in RFC 5031 [69] can be used, the country specific emergency service URN can also be used.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.11.2\tICSI value for RLOS",
                            "text_content": "This subclause describes the IMS communications service identifier definitions that is applicable for the usage of restricted local operator service (RLOS).\nNOTE:\tThe template has been created using the headers of the table in http://www.3gpp.org/specifications-groups/34-uniform-resource-name-urn-list\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.11.2.2\tURN",
                    "description": "",
                    "summary": "",
                    "text_content": "urn:urn-7:3gpp-service.ims.icsi.rlos\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.11.2.3\tDescription",
                    "description": "",
                    "summary": "",
                    "text_content": "This URN indicates that the device has the capabilities to support the restricted local operator service (RLOS).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.11.2.4\tReference",
                    "description": "",
                    "summary": "",
                    "text_content": "3GPP TS 24 229: \" IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\"\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.11.2.5\tContact",
                    "description": "",
                    "summary": "",
                    "text_content": "Name:\t<MCC name>\nEmail:\t<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.11.2.6\tRegistration of subtype",
                    "description": "",
                    "summary": "",
                    "text_content": "Yes\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.11.2.7\tRemarks",
                    "description": "",
                    "summary": "",
                    "text_content": "None\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.12\tInfo package definitions and associated MIME type definitions",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.12.1\tDTMF info package and session-info MIME type",
                            "text_content": "This subclause contains the information required for the IANA registration of an info package.\nThe digit message body and associated MIME type can also be used as defined in other specifications in a legacy manner as defined by RFC 6086 [25].\nDTMF tones are normally sent when a user presses a button on the terminal. Each tone, identified by a unique frequency, represents a number (0-9) or a special character. The DTMF info package is used to transport that value. In-order delivery of the DTMF digits is not controlled by the DTMF info package, this would be controlled either by queuing in the sender or by separate interaction with the human user; such mechanisms are out of scope of this registration.\nThe DTMF info package can be used to transport a single DTMF tone, or a series of tones. If a series of tones is transported in a single SIP INFO request, it is not possible to indicate the duration between each tone in the series.\nThe DTMF info package is not defined for a specific application. Any application, where sending of DTMF tones using the SIP INFO method is required, can used the DTMF info package.\nThe info package mechanism for transporting DTMF tones has been chosen because it allows SIP entities that do not have access to the user plane (where DTMF tones can also be transported) to send and receive tones. The mechanism also allows the tones to be sent inside an existing dialog, using the same signalling path as other SIP messages within the dialog, rather than having to establish a separate dialog (DTMF tones can also be transported using subscription event packages).\nThe name of the DTMF info package is: infoDtmf\nNo parameters are defined for the DTMF info package.\nNo SIP option tags are defined for the DTMF info package.\nThe DTMF digits are carried in the Overlap digit message body, defined in subclause 7.12.1.2.\nThe MIME type value for the message body is \"application/session-info\", defined in subclause 7.12.1.2.\nThe Content Disposition value for the message body, when associated with the DTMF info package, is \"info-package\" (see RFC 6086 [25]).\nNo usage restrictions are defined for the DTMF info package.\nIf SIP entities support multiple mechanisms for sending DTMF tones they need to ensure, using negotiation mechanisms, that each entity is aware of which mechanism is used.\nNo maximum rate or minimum rate is defined for sending INFO requests associated with the DTMF info package.\nWhen DTMF tones are triggered by user interaction, the DTMF tones are normally generated when the user pushes a button. Specific applications can decide upon which rate DTMF tones are generated. However, the DTMF info package does not provide a feedback mechanism to indicate to the sender that the rate of DTMF tones is too slow or fast.\nNo additional security mechanism is defined for the DTMF info package.\nThe security of the DTMF info package is based on the generic security mechanism provided for the underlying SIP signalling.\nThe mechanism should not be used for transferring any data that requires a greater level of security than the underlying SIP signalling.\nThis section defines a message body that shall be used for sending additional digits, which have not previously been sent, in SIP INFO messages (\"legacy\" mode of usage of the INFO method as defined in RFC 6086 [25]) when the in-dialog method is used for overlap dialling.\nThe same message body can also be used for transporting Dual Tone Multi Frequency (DTMF) tones using SIP INFO requests, using the DTMF info package (see RFC 6086 [25]) defined in subclause 7.12.1.1.\nThe support of this message body is a network option.\nThe message body defined in the present annex is registered at IANA as \"application/session-info\" MIME type.\nIf the message body is embedded in SIP INFO messages, the Content-Type header shall be set to \"application/session-info\" and the Content-Disposition header shall be set to \"signal\" with the handling parameter set to \"optional\".\nsession-info = SubsequentDigit\nSubsequentDigit = \"SubsequentDigit\" HCOLON phonedigits\nphonedigits = 1*(HEXDIG / \"*\" / \"#\")\nHEXDIG = DIGIT / \"A\" / \"B\" / \"C\" / \"D\" / \"E\" / \"F\"\nWithin the present subclause, information required for an IANA registration at  is provided.\n1. Media Type Name\nApplication\n2. Subtype name\n\"session-info\" (Standards Tree)\n3. Required parameters\nnone\n4. Optional parameters\nnone\n5. Encoding considerations\nbinary\n6. Security considerations\nModifications of the MIME body by a man-in-the-middle can have severe consequences:\nThe overlap digits that can be transported with this MIME body influence the routeing of the SIP session that is being setup.\nDual Tone Multi Frequency (DTMF) tones that can also be transported with this MIME body will be interpreted by the application of the end points of the communication for various purposes.\nHowever, this MIME body is used only attached to SIP INFO messages, and modifications of other parts of the SIP signalling will lead to comparable consequences. Protection of the SIP signalling will also protect the present MIME body.\nThe information transported in this MIME media type does not include active or executable content.\nMechanisms for privacy and intregrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\n7. Interoperability considerations\nnone\n8. Published specification\n3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP), stage 3\".\n9. Applications which use this media type\nThis MIME type is used as a message body within SIP INFO messages.\nIt is either used for sending additional digits of the callee´s number, which have not previously been sent, in SIP INFO messages (\"legacy\" mode of usage of the INFO method as defined in IETF RFC 6086) when the in-dialog method is used for overlap dialling.\nThe same message body can also be used for transporting Dual Tone Multi Frequency (DTMF) tones using SIP INFO requests, using the DTMF info package (see RFC 6086) defined in subclause 7.12.1.1.\n10. Additional information\nMagic number(s): none\nFile extension(s): none\nMacintosh File Type Code(s): none\nObject Identifier(s) or OID(s): none\n11. Intended usage\nLimited Use\n12. Other Information/General Comment\nnone.\nExamples of the DTMF info package usage can be found in the following specification:\n-\t3GPP TS 24.182 [8Q]: \"Customized Alerting Tones; Protocol specification\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.12.2\tg.3gpp.current-location-discovery info package and request-for-current-location body",
                            "text_content": "This subclause contains information required for registration of the g.3gpp.current-location-discovery info package with IANA.\nLocation of a UA participating in an INVITE-initiated dialog can change during duration of the INVITE-initiated dialog.\nThe g.3gpp.current-location-discovery info package enables a UA participanting in an INVITE-initiated dialog to indicate a request for location information to the other UA participating in the INVITE-initiated dialog.\nA number of solutions for the transportation of the pieces of information identified in the overall description were identified and considered:\n1)\tUse of session related methods for transporting event and state information, e.g. re-INVITE request, UPDATE request.\n2)\tUse of OPTIONS request.\n3)\tUse of SIP MESSAGE method.\n4)\tUse of media plane mechanisms.\n5)\tUse of subscription to the presence event package as described in RFC 3856 [74].\n6)\tUse of SIP INFO method as decribed in RFC 6086 [25], by defining a new info package.\nFurthermore, each of the solutions was evaluated.\nUse of session related methods was discounted since purpose of the INVITE request and the UPDATE request was to modify the dialog, or the parameters of the session or both and neither the dialog nor the parameters of the session needed to be modified.\nUse of the OPTIONS request was discounted since purpose of the OPTIONS request was to query UAS for UAS' capabilites rather than requesting an information available at the UAS.\nUse of the MESSAGE request was discounted since the use of the INFO method enabled negotiation of supported event packages in the INVITE transaction while the use of the MESSAGE method did not.\nUse of the media plane mechanisms was discounted since the amount of information transferred between the UAs was limited and set up of media stream generated generate extra messages.\nUse of the presence event package was discounted since the dialog reuse technique was deprecated accoding to RFC 6665 [28]. Thus, SUBSCRIBE request for the presence event package needed to be sent using a dialog other than any dialog established as result of a INVITE request. However, in some situation - e.g. an emergency session initiated by a UA without a prior registration, there was no way how to ensure delivery of a new initial request for a dialog to the UA. The remote target indicated in Contact header field of:\n-\tthe INVITE request; or\n-\tthe received response to the INVITE request;\nsent by the UA was not necessarily globally routable (e.g. when the UA was behind NAT or when the UA was behind a SIP proxy with a firewall), and the route set indicated in the Record-Route header fields of:\n-\tthe INVITE request; or\n-\tthe received response to the INVITE request;\nsent by the UA might be dedicated to the messages of dialogs established as result of the INVITE request.\nBased on the above analyses, the SIP INFO method was chosen.\nInfo package name is: g.3gpp.current-location-discovery\nNo info package parameters are defined for the g.3gpp.current-location-discovery info package.\nNo SIP option tags are defined for the g.3gpp.current-location-discovery info package.\nThe MIME type of the body is application/vnd.3gpp.current-location-discovery+xml. The application/vnd.3gpp.current-location-discovery+xml MIME type is defined in 3GPP TS 24.229.\nWhen associated with the g.3gpp.current-location-discovery info package, the Content-Disposition value of the body is \"info-package\".\nNo usage restrictions are defined for the g.3gpp.current-location-discovery info package.\nNo maximum rate or minimum rate is defined for sending INFO requests associated with the g.3gpp.current-location-discovery info package.\nThe security of the g.3gpp.current-location-discovery info package is based on the generic security mechanism provided for the underlaying SIP signalling.\nAs the location information is a sensitive information, unless the location information is requested from a UA who initiated an emergency session, the UA requested to provide the location information needs to authorize the request with the user at the UA.\nThe request-for-current-location body is of \"application/vnd.3gpp.current-location-discovery+xml\" MIME type.\nThe request-for-current-location body is an XML document compliant to the XML schema defined in subclause 7.12.2.2.2, compliant to the additional syntax rules in subclause 7.12.2.2.3, with semantic defined in subclause 7.12.2.2.4.\nThe XML Schema, is defined in table 7.12.2.2.2.1.\nTable 7.12.2.2.2.1: XML schema of application/vnd.3gpp.current-location-discovery+xml MIME type\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nelementFormDefault=\"qualified\"\nattributeFormDefault=\"unqualified\">\n\n<xs:element name=\"requestForLocationInformation\"\ntype=\"requestForLocationInformationType\"/>\n\n<xs:complexType name=\"requestForLocationInformationType\">\n<xs:sequence>\n<xs:choice>\n<xs:element name=\"oneShot\" type=\"anyExtType\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n</xs:choice>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\"\nmaxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\"\nmaxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n</xs:schema>\n\nThe <requestForLocationInformation> element is the root element.\nThe <requestForLocationInformation> root element contains:\n1)\tone of the following elements:\na)\tthe <oneShot> element;\nb)\tthe <anyExt> element;and\nc)\tan element from another namespace for the purposes of extensibility;\n2)\tzero or one <anyExt> element;and\n3)\tzero or more elements from other namespaces for the purposes of extensibility; and\n4)\tzero or more attributes from any namespaces for the purpose of extensibility.\nThe <oneShot> element contains:\n1)\tzero or more elements from any namespaces for the purposes of extensibility; and\n2)\tzero or more attributes from any namespaces for the purpose of extensibility.\nThe <anyExt> element contains:\n1)\tzero or more elements from any namespaces for the purposes of extensibility; and\n2)\tzero or more attributes from any namespaces for the purpose of extensibility.\nThe <oneShot> child element of the <requestForLocationInformation> root element indicates that the receiving entity is requested to send the location information once.\nThe <anyExt> element contains elements defined in future version of this specification.\nThe receiving entity ignores any unknown XML element and any unknown XML attribute.\nYour name:\n<MCC name>\nYour email address:\n<MCC email>\nMedia type name:\napplication\nSubtype name:\nvnd.3gpp.current-location-discovery+xml\nRequired parameters:\nnone.\nOptional parameters:\n1)\t\"charset\" - the parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in section 9.1 of IETF RFC 7303 [247].\nEncoding considerations:\nbinary.\nSecurity considerations:\nsame as general security considerations for application/xml media type as specified in section 9.1 of RFC 7303 [247]. In addition, this media type provides a format for exchanging information in SIP, so the security considerations from RFC 3261 [26] apply.\nThe information transported in this MIME media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\nThis media type includes provisions for directives that institute actions on a recipient's files or other resources. The action is providing the location information. The action is providing the location information of the entity receiving the body. Except when sent a part of an emergency session, the entity receiving the body needs to request the user at the entity to authorize the action.\nThis media type includes provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way. The action is providing the location information of the entity receiving the body. Except when sent a part of an emergency session, the entity receiving the body needs to request the user at the entity to authorize the action.\nThis media type does not employ compression.\nInteroperability considerations:\nSame as general interoperability considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303 [247].\nPublished specification:\n3GPP TS 24.229, ()\nApplications which use this media type:\nThis MIME type is used for a MIME body within SIP INFO requests.\nFragment identifier considerations:\nThe handling in section 5 of IETF RFC 7303 [247] applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nN/A\nAdditional information:\n1)\tDeprecated alias names for this type: none\n2)\tMagic number(s): none\n3)\tFile extension(s): none\n4)\tMacintosh file type code(s): none\n5)\tObject identifier(s) or OID(s): none\nIntended usage:\nCommon.\nPerson to contact for further information\n1) Name: <MCC>\n2) Email: <MCC email>\n3) Author/change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.13\tJSON Web Token claims defined within the present document",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.13.1\tGeneral",
                            "text_content": "This subclause contains definitions for JSON Web Token claims RFC 7519 [235] usage in the 3GPP IM CN subsystem.\nNOTE:\tThe claim names are defined as private claim names, and do not require registration, as defined in RFC 7519 [235].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.13.2\t3GPP-WAF",
                            "text_content": "The 3gpp-waf claim is used to transport the identity of the WAF.\nClaim name:\t3gpp-waf\nClaim value: String\nClaim description:\tWAF identity\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.13.3\t3GPP-WWSF",
                            "text_content": "The 3gpp-wwsf claim is used to transport the identity of the WAF.\nClaim name:\t3gpp-wwsf\nClaim value: String\nClaim description:\tWWSF identity\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.13.4\tidentityHeader",
                            "text_content": "The identityHeader claim is used to transport a SIP Identity header field.\nClaim name:\tidentityHeader\nClaim value: String\nClaim description:\tContents of an Identity header field\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.13.5\tverstatValue",
                            "text_content": "The verstatValue claim is used to transport the value of a verstat tel URI parameter.\nClaim name:\tverstatValue\nClaim value: String\nClaim description:\tThe value of a verstat tel URI parameter.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.13.6\tidentityHeaders",
                            "text_content": "The identityHeaders claim is used to transport one or more SIP Identity header field(s).\nClaim name:\tidentityHeaders\nClaim value: Array of strings\nClaim description:\tArray of Identity header fields needed to verify diverting users.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.13.7\tdivResult",
                            "text_content": "The divResult claim is used to transport the result for the verified div claims and related identities.\nClaim name:\tdivResult\nClaim value: Array of one or more [div, verstatValue] tuples\nClaim description:\tThe value of a verstat tel URI parameter.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.13.8\tverstatPriority",
                            "text_content": "The verstatPriority claim is used to transport the verification value of the Resource-Priority header field and optionally the header field value \"psap-callback\" of the Priority header field.\nClaim name:\tverstatPriority\nClaim value: String\nClaim description:\tIndicates the result of the verification of the Resource-Priority header field and optionally the header field value \"psap-callback\" of the Priority header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.14\tDialog event package extensions defined within the present document",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.14.1\tGeneral",
                            "text_content": "This subclause describes the dialog event package extensions that are applicable for the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.14.2\tDialog event package extension to transport UE identity information",
                            "text_content": "This subclause defines an extension to the dialog event package (RFC 4235 [171]) to transport UE identity information for UEs belonging to the same subscription.\nIn order to include UE identity information in the dialog event package, the notifier shall\n1.\tin the <dialog-info> element add one or more <ue-instance> elements defined in subclause 7.14.2.2 and 3GPP TS 24.174 [8ZH], each element containing:\na)\tan \"identity\" attribute set to an identifier of the UE as specified in 3GPP TS 24.174 [8ZH]; and\nb)\tan \"alias\" attribute set to a user friendly name of the UE as specified in 3GPP TS 24.174 [8ZH].\nTable 7.14.1 in this subclause defines the XML Schema describing the extension to include UE identity information which can be included in the dialog event package sent from the TAS in NOTIFY requests.\nTable 7.14.1: UE identity information, XML Schema\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\ntargetNamespace=\"urn:3gpp:extDEN:1.0\"\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nxmlns:ss=\"http://uri.etsi.org/ngn/params/xml/simservs/xcap\"\nelementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\">\n<xs:include schemaLocation=\"XCAP.xsd\"/>\n<ss:ue-instance/>\n</xs:schema>\n\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "8\tSIP compression",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tSIP compression procedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.1.1\tSIP compression",
                            "text_content": "If in normal operation the UE generates requests or responses containing a P-Access-Network-Info header field which included a value of \"3GPP-GERAN\",\"3GPP-UTRAN-FDD\", \"3GPP-UTRAN-TDD\", \"3GPP-E-UTRAN-FDD\", \"3GPP-E-UTRAN-TDD\", \"3GPP-E-UTRAN-ProSe-UNR\", \"3GPP-NR-FDD\", \"3GPP-NR-TDD\", \"3GPP-NR-U-FDD\", \"3GPP-NR-U-TDD\", \"3GPP-NR-SAT\", \"3GPP-NR-ProSe-L2UNR\", \"3GPP-NR-ProSe-L3UNR\", \"3GPP2-1X\", \"3GPP2-1X-HRPD\", \"3GPP2-UMB\", \"IEEE-802.11\", \"IEEE-802.11a\", \"IEEE-802.11b\", \"IEEE-802.11g\", \"IEEE-802.11n\", \"IEEE-802.11ac\", or \"DVB-RCS2\", then the UE shall support:\n-\tSigComp as specified in RFC 3320 [32] and as updated by RFC 4896 [118]; and\n-\tthe additional requirements specified in RFC 5049 [79], with the exception that the UE shall take a State Memory Size of at least 4096 bytes as a minimum value.\nIf in normal operation the UE generates requests or responses containing a P-Access-Network-Info header field which included a value of \"3GPP-GERAN\",\"3GPP-UTRAN-FDD\", \"3GPP-UTRAN-TDD\", \"3GPP-E-UTRAN-FDD\", \"3GPP-E-UTRAN-TDD\", \"3GPP-E-UTRAN-ProSe-UNR\", \"3GPP-NR-FDD\", \"3GPP-NR-TDD\", \"3GPP-NR-U-FDD\", \"3GPP-NR-U-TDD\", \"3GPP-NR-SAT\", \"3GPP-NR-ProSe-L2UNR\", \"3GPP-NR-ProSe-L3UNR\", \"3GPP2-1X\", \"3GPP2-1X-HRPD\", \"3GPP2-UMB\", \"IEEE-802.11\", \"IEEE-802.11a\", \"IEEE-802.11b\", \"IEEE-802.11g\", \"IEEE-802.11n\", \"IEEE-802.11ac\", or \"DVB-RCS2\", then the UE may support:\n-\tthe negative acknowledgement mechanism specified in RFC 4077 [65A].\nWhen using SigComp the UE shall send compressed SIP messages in accordance with RFC 3486 [55]. When the UE will create the compartment is implementation specific, but the compartment shall not be created until a set of security associations or a  session is set up if signalling security is in use. The UE shall finish the compartment when the UE is deregistered. The UE shall alow state creations and announcements only for messages received in a security association.\nNOTE:\tExchange of bytecodes during registration will prevent unnecessary delays during session setup.\nIf the UE supports SigComp:\n-\tthe UE shall support the SIP dictionary specified in RFC 3485 [42] and as updated by RFC 4896 [118]. If compression is enabled, the UE shall use the dictionary to compress the first message; and\n-\tif the UE supports the presence user agent or watcher roles as specified in table A.3A/2 and table A.3A/4, the UE may support the presence specific dictionary specified in RFC 5112 [119].\nThe use of SigComp is not re-negotiated between initial registration and deregistration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.1.2\tCompression of SIP requests and responses transmitted to the P-CSCF",
                            "text_content": "In normal operation the UE should send the generated requests and responses transmitted to the P-CSCF:\n-\tcompressed according to subclause 8.1.1, if the P-Access-Network-Info header field of the initial registration message includes a value of \"3GPP-GERAN\",\"3GPP-UTRAN-FDD\", \"3GPP-UTRAN-TDD\",  \"3GPP2-1X\", \"3GPP2-1X-HRPD\", \"3GPP2-UMB\", \"IEEE-802.11\", \"IEEE-802.11a\", \"IEEE-802.11b\", IEEE-802.11g\", \"IEEE-802.11n\", \"IEEE-802.11ac\", or \"DVB-RCS2\";\n-\tuncompressed, if the P-Access-Network-Info header field of the initial registration message includes a value of \"3GPP-E-UTRAN-FDD\", \"3GPP-E-UTRAN-TDD\", \"3GPP-E-UTRAN-ProSe-UNR\", \"3GPP-NR-FDD\", \"3GPP-NR-TDD\",\"3GPP-NR-U-FDD\", \"3GPP-NR-U-TDD\", \"3GPP-NR-SAT\", \"3GPP-NR-ProSe-L2UNR\", \"3GPP-NR-ProSe-L3UNR\".\nIn other cases where SigComp is supported, the UE need not compress the requests and responses.\nNOTE 1:\tCompression of SIP messages is an implementation option. However, compression is strongly recommended.\nNOTE 2:\tIn an IP-CAN where compression support is mandatory the UE can send even the first message compressed. Sigcomp provides mechanisms to allow the UE to know if state has been created in the P-CSCF or not.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.1.3\tDecompression of SIP requests and responses received from the P-CSCF",
                            "text_content": "If the UE supports SigComp, then the UE shall decompress the compressed requests and responses received from the P-CSCF according to subclause 8.1.1.\nNOTE:\tAccording to RFC 3486 [55], the UE not supporting SigComp or not indicating willingness to receive compressed messages never receives compressed SIP messages.\nIf the UE detects a decompression failure at the P-CSCF, the recovery mechanism is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "8.2\tSIP compression procedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.2.1\tSIP compression",
                            "text_content": "The P-CSCF shall support:\n-\tSigComp as specified in RFC 3320 [32] and as updated by RFC 4896 [118]; and\n-\tthe additional requirements specified in RFC 5049 [79], with the exception that the P-CSCF shall take a State Memory Size of at least 4096 bytes as a minimum value.\nThe P-CSCF may support:\n-\tthe negative acknowledgement mechanism specified in RFC 4077 [65A].\nWhen using SigComp the P-CSCF shall send compressed SIP messages in accordance with RFC 3486 [55]. When the P-CSCF will create the compartment is implementation specific, but the compartment shall not be created until a set of security associations are set up. The P-CSCF shall finish the compartment when the UE is deregistered. The P-CSCF shall allow state creations and announcements only for messages received in a security association.\nThe P-CSCF:\n-\tshall support the SIP dictionary specified in RFC 3485 [42] and as updated by RFC 4896 [118]. If compression is enabled, the P-CSCF shall use the dictionary to compress the first message; and\n-\tmay support the presence specific dictionary specified in RFC 5112 [119].\nNOTE:\tExchange of bytecodes during registration will prevent unnecessary delays during session setup.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.2\tCompression of SIP requests and responses transmitted to the UE",
                            "text_content": "For all SIP transactions on a specific security association where the security association was established using a REGISTER request from the UE containing a P-Access-Network-Info header field which included a value of \"3GPP-GERAN\",\"3GPP-UTRAN-FDD\", \"3GPP-UTRAN-TDD\", \"3GPP-E-UTRAN-ProSe-UNR\", \"3GPP-NR-FDD\", \"3GPP-NR-TDD\",\"3GPP-NR-U-FDD\", \"3GPP-NR-U-TDD\", \"3GPP-NR-SAT\", \"3GPP-NR-ProSe-L2UNR\", \"3GPP-NR-ProSe-L3UNR\", \"3GPP-E-UTRAN-FDD\", \"3GPP-E-UTRAN-TDD\", \"3GPP2-1X\", \"3GPP2-1X-HRPD\", \"3GPP2-UMB\", \"IEEE-802.11\", \"IEEE-802.11a\", \"IEEE-802.11b\", \"IEEE-802.11g\", \"IEEE-802.11n\", \"IEEE-802.11ac\", or \"DVB-RCS2\", and the UE has indicated that it supports SigComp and is willing to receive compressed messages in accordance with RFC 3486 [55], then the P-CSCF should compress the requests and responses transmitted to the UE according to subclause 8.2.1. In other cases where SigComp is supported, it need not.\nNOTE:\tCompression of SIP messages is an implementation option. However, compression is strongly recommended.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.3\tDecompression of SIP requests and responses received from the UE",
                            "text_content": "The P-CSCF shall decompress the compressed requests and responses received from the UE according to subclause 8.2.1.\nIf the P-CSCF detects a decompression failure at the UE, the recovery mechanism is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "9\tIP-Connectivity Access Network aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "9.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem and the IM CN subsystem itself utilises the services supported by the IP-CAN to provide packet-mode communication between the UE and the IM CN subsystem. General requirements for the UE on the use of these packet-mode services are specified in this clause.\nPossible aspects particular to each IP-CAN is described separately for each IP-CAN.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.2.1\tConnecting to the IP-CAN and P-CSCF discovery",
                            "text_content": "Prior to communication with the IM CN subsystem, the UE shall:\na)\testablish a connection with the IP-CAN;\nb)\tobtain an IP address using either the standard IETF protocols (e.g., DHCP or IPCP) or a protocol that is particular to the IP-CAN technology that the UE is utilising. The UE shall fix the obtained IP address throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the last deregistration; and\nc)\tacquire a P-CSCF address(es).\nThe UE may acquire an IP address via means other than the DHCP. In this case, upon acquiring an IP address, the UE shall request the configuration information (that includes the DNS and P-CSCF addresses) from the DHCP server.\nThe methods for acquiring a P-CSCF address(es) are:\nI.\tEmploy Dynamic Host Configuration Protocol for IPv4 RFC 2131 [40A] or for IPv6 (DHCPv6) RFC 3315 [40]. Employ the DHCP options for SIP servers RFC 3319 [41] or, for IPv6, RFC 3361 [35A]. Employ the DHCP options for Domain Name Servers (DNS) RFC 3646 [56C].\nThe UE shall either:\n-\tin the DHCP query, request a list of SIP server domain names of P-CSCF(s) and the list of Domain Name Servers (DNS); or\n-\trequest a list of SIP server IP addresses of P-CSCF(s).\nII.\tObtain the P-CSCF address(es) by employing a procedure that the IP-CAN technology supports. (e.g. GPRS).\nIII.\tThe UE may use pre-configured P-CSCF address(es) (IP address or domain name). For example:\na.\tThe UE selects a P-CSCF from the list stored in ISIM or ;\nb.\tThe UE selects a P-CSCF from the list in IMS management object.\nNOTE 1:\tAccess-specific annexes provide additional guidance on the method to be used by the UE to acquire P-CSCF address(es).\nWhen acquiring a P-CSCF address(es), the UE can freely select either method I or II or III.\nNOTE 2:\tIn case a P-CSCF address is provisioned or received as a FQDN, procedures according to RFC 3263 [27A] will provide the resolution of the FQDN.\nThe UE may also request a DNS Server IP address(es) as specified in RFC 3315 [40] and RFC 3646 [56C] or RFC 2131 [40A].\nWhen:\n-\tthe UE obtains a connection with the IP-CAN by performing handover of the connection from another IP-CAN;\n-\tIP address of the UE is not changed during the handover; and\n-\tthe UE already communicates with the IM CN subsystem via the connection with the other IP-CAN, e.g. the UE determines that its contact with host portion set to the UE IP address (or FQDN of the UE) associated with the connection with the other IP-CAN has been bound to a public user identity;\nthe UE shall continue using the P-CSCF address(es) acquired in the other IP-CAN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.2.2\tHandling of the IP-CAN",
                            "text_content": "The means to ensure that appropriate resources are available for the media flow(s) on the IP-CAN(s) related to a SIP session is dependant on the characteristics for each IP-CAN, and is described separately for each IP-CAN in question.\nGPRS is described in annex B. xDSL is described in annex E. DOCSIS is described in annex H. EPS is described in annex L. cdma2000® packet data subsystem is described in annex M.  via cdma2000® HRPD is described in annex O. cdma2000® Femtocell network is described in annex Q. Evolved Packet Core () via WLAN is described in annex R. DVB-RCS2 is described in annex S. 5GS is described in annex U. If a particular handling of the IP-CAN is needed for emergency calls, this is described in the annex for each access technology.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.2.2A\tP-CSCF restoration procedure",
                            "text_content": "The UE may support P-CSCF restoration procedures.\nAn IP-CAN may provide means for detecting a P-CSCF failure.\nAn UE supporting the P-CSCF restoration procedure should either use the keep-alive procedures described in RFC 6223 [143] or the procedure provided by a IP-CAN for monitoring the P-CSCF status.\nNOTE 1:\tThe UE can use other means to monitor the P-CSCF status, e.g. ICMP echo request/response. However, those other means are out of scope of this document.\nNOTE 2:\tA UE registered through the procedures described in RFC 5626 [92] can use the keep-alive mechanism to monitor the status of the P-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.2.3\tSpecial requirements applying to forked responses",
                            "text_content": "Since the UE does not know that forking has occurred until a second provisional response arrives, the UE will request the radio/bearer resources as required by the first provisional response. For each subsequent provisional response that may be received, different alternative actions may be performed depending on the requirements in the SDP answer:\n-\tthe UE has sufficient radio/bearer resources to handle the media specified in the SDP of the subsequent provisional response, or\n-\tthe UE must request additional radio/bearer resources to accommodate the media specified in the SDP of the subsequent provisional response.\nNOTE 1:\tWhen several forked responses are received, the resources requested by the UE is the \"logical OR\" of the resources indicated in the multiple responses to avoid allocation of unnecessary resources. The UE does not request more resources than proposed in the original INVITE request.\nNOTE 2:\tWhen service-based local policy is applied, the UE receives the same authorization token for all forked requests/responses related to the same SIP session.\nWhen an 199 (Early Dialog Terminated) response for the INVITE request is received for an early dialogue, the UE shall release reserved radio/bearer resources associated with that early dialogue.\nWhen the first final 200 (OK) response for the INVITE request is received for one of the early dialogs, the UE proceeds to set up the SIP session using the radio/bearer resources required for this session. Upon the reception of the first final 200 (OK) response for the INVITE request, the UE shall release all unneeded radio/bearer resources.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "10\tMedia control",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "10.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The choice of which media control methods below to use is service specific, it depends on the functionality required and physical deployment architectures.\nCombinations of the capabilities below are supported by the use of the control channel framework RFC 6230 [146] with associated media control packages.\nFor security, the principles and protocols described in 3GPP TS 33.210 [19A] shall take precedence over those specified in the referenced specifications in this clause.\nFor codecs, those described in access specific specifications shall take precedence over those specified in the referenced specifications in this clause.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.2\tProcedures at the AS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.2.1\tGeneral",
                            "text_content": "An AS requesting charging information and authorisation for specific media operations and media usage controlled by the MRFC shall use RFC 6230 [146] together with appropriate packages.\nNOTE:\tThis is in addition to the charging related procedures in clause 5 and to the charging information and authorisation requests, defined in 3GPP TS 32.260 [17] which provide charging information and authorisation for SIP session and SDP information.\nAn AS may support delegation of an XML (such as CCXML or SCXML) script execution to an MRFC. An AS supporting delegation of XML script execution shall use RFC 6230 [146] together with appropriate packages.\nThe packages, or extensions to existing packages using RFC 6230 [146] framework are not specified in this release.\nThe AS may support the media server resource consumer interface as defined by RFC 6917 [192]. If supported the AS can support either the in-line mode or the query mode or both.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.2\tTones and announcements",
                            "text_content": "An AS may support control of the MRFC for tones and announcements. An AS supporting control of the MRFC for tones and announcements shall support one or more of the following methods:\n-\tRFC 4240 [144] announcement service;\n-\tRFC 5552 [145]; or\n-\tRFC 6230 [146] and RFC 6231 [147].\nThe AS may support control of the MRFC for basic announcements by the use of RFC 4240 [144] and the announcement service described in RFC 4240 [144] subclause 3.\nThe media control commands are carried between the AS and the MRFC either directly over the Mr' interface or via the S-CSCF over the ISC and Mr interfaces.\nThe AS shall provide remote prompts to the MRFC using the AS-MRFC Cr interface.\nThe AS may support control of the MRFC for voice dialogs by the use of RFC 5552 [145].\nThe media control commands are carried between the AS and the MRFC either directly over the Mr' interface or via the S-CSCF over the ISC and Mr interfaces.\nThe AS shall provide remote prompts and scripts to the MRFC using the AS-MRFC Cr interface.\nData shall be returned to the AS from the MRFC by either use of the AS-MRFC Cr interface (subclause 4.1 of RFC 5552 [145]), via the ISC interface (subclause 4.2 of RFC 5552 [145]) or via the Mr' interface.\nThe AS may support control of the MRFC for interactive voice response by the use of RFC 6231 [147] and RFC 6230 [146].\nThe AS shall provide remote prompts, media control commands and scripts to the MRFC using the AS-MRFC Cr interface.\nThe AS shall implement the control client role as described in RFC 6230 [146].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.3\tAd-hoc conferences",
                            "text_content": "An AS may support control of the MRFC for ad-hoc conferencing. An AS supporting control of the MRFC for ad-hoc conferencing shall support one or more of the following methods:\n-\tRFC 4240 [144] conference service; or\n-\tRFC 6230 [146] and RFC 6505 [148].\nThe AS may support control of the MRFC for basic conferencing by the use of RFC 4240 [144] and the conference service described in RFC 4240 [144] subclause 5.\nThe media control commands are carried between the AS and the MRFC either directly over the Mr' interface or via the S-CSCF over the ISC and Mr interfaces.\nThe AS may support control of the MRFC for conference mixing by the use of RFC 6505 [148] and RFC 6230 [146].\nAn AS may support control of the MRFC for floor controlled conferences (as specified in 3GPP TS 24.147 [8B]), via the use of RFC 6230 [146] together with appropriate packages. The packages, or extensions to existing packages using RFC 6230 [146] framework are not specified in this release.\nAn AS may support control of the MRFC for session-mode messaging conferences (as specified in 3GPP TS 24.247 [8F]), via the use of RFC 6230 [146] together with appropriate packages. The packages, or extensions to existing packages using RFC 6230 [146] framework are not specified in this release.\nThe AS shall provide media control commands to the MRFC using the AS-MRFC Cr interface.\nThe AS shall implement the control client role as described in RFC 6230 [146].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.4\tTranscoding",
                            "text_content": "An AS may support control of the MRFC for transcoding. An AS supporting control of the MRFC for transcoding shall support one or more of the following methods:\n-\tRFC 4240 [144] conference service; or\n-\tRFC 6230 [146] and RFC 6505 [148].\nThe AS may support control of the MRFC for transcoding by the use of RFC 4240 [144] and the conference service described in RFC 4240 [144] subclause 5.\nThe media control commands are carried between the AS and the MRFC either directly over the Mr' interface or via the S-CSCF over the ISC and Mr interfaces.\nThe AS may support control of the MRFC for transcoding by the use of RFC 6505 [148] and RFC 6230 [146].\nThe AS shall provide media control commands to the MRFC using the AS-MRFC Cr interface.\nThe AS shall implement the control client role as described in RFC 6230 [146].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.3\tProcedures at the MRFC",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.3.1\tGeneral",
                            "text_content": "An MRFC required to generate charging information and authorize requests from an AS for specific media operations and media usage shall support RFC 6230 [146] together with appropriate packages.\nNOTE:\tThis is in addition to the charging related procedures in clause 5 and to the charging information and authorisation requests, defined in 3GPP TS 32.260 [17] which provide charging information and authorisation for SIP session and SDP information.\nAn MRFC may support delegated XML (such as CCXML or SCXML) script execution from an AS. An MRFC supporting delegation of XML script execution shall use RFC 6230 [146] together with appropriate packages.\nThe packages, or extensions to existing packages using RFC 6230 [146] framework above are not specified in this release.\nThe MRFC may support the media server resource publish interface as defined by RFC 6917 [192].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.2\tTones and announcements",
                            "text_content": "An MRFC may support control of tones and announcements. An MRFC supporting control of tones and announcements shall support one or more of the following methods:\n-\tRFC 4240 [144] announcement service;\n-\tRFC 5552 [145]; or\n-\tRFC 6230 [146] and RFC 6231 [147].\nThe MRFC may support control of basic announcements by the use of RFC 4240 [144] and the announcement service described in RFC 4240 [144] subclause 3.\nThe media control commands are received from the AS either directly over the Mr' interface or via the S-CSCF over the ISC and Mr interfaces.\nThe MRFC shall fetch remote prompts from the AS using the AS-MRFC Cr interface.\nThe MRFC acts as the media server described in RFC 4240 [144].\nThe MRFC may support control of voice dialogs by the use of RFC 5552 [145].\nThe media control commands are received from the AS either directly over the Mr' interface or via the S-CSCF over the ISC and Mr interfaces.\nThe MRFC shall fetch via the AS-MRFC Cr interface the remote prompts and scripts from the address included in the \"voicexml\"  parameter, if received, in the Request- of the SIP INVITE request.\nData shall be returned to the AS from the MRFC by either use of the AS-MRFC Cr interface (subclause 4.1 of RFC 5552 [145]), via the ISC interface (subclause 4.2 of RFC 5552 [145]) or via the Mr' interface.\nThe MRFC acts as the VoiceXML media server described in RFC 5552 [145].\nThe MRFC may support control of interactive voice response by the use of RFC 6231 [147] and RFC 6230 [146].\nThe MRFC shall fetch remote prompts and scripts from the MRFC using the AS-MRFC Cr interface. The MRFC shall send media control command responses and notifications to the AS using the AS-MRFC Cr interface.\nThe MRFC shall implement the control server role as described in RFC 6230 [146].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.3\tAd-hoc conferences",
                            "text_content": "An MRFC may support control of ad-hoc conferencing. An MRFC supporting control of ad-hoc conferencing shall support one or more of the following methods:\n-\tRFC 4240 [144] conference service; or\n-\tRFC 6230 [146] and RFC 6505 [148].\nThe MRFC may support control of basic conferencing by the use of RFC 4240 [144] and the conference service described in RFC 4240 [144] subclause 5.\nThe media control commands are received from the AS either directly over the Mr' interface or via the S-CSCF over the ISC and Mr interfaces.\nThe MRFC acts as the media server described in RFC 4240 [144].\nThe MRFC may support control of conference mixing by the use of RFC 6505 [148] and RFC 6230 [146].\nAn MRFC may support control of floor controlled conferences (as specified in 3GPP TS 24.147 [8B]), via the use of RFC 6230 [146] together with appropriate packages. The packages, or extensions to existing packages using RFC 6230 [146] framework are not specified in this release. In addition, the MRFC may support the procedures for a multi-stream multiparty multimedia conference using simulcast defined in 3GPP TS 26.114 [9B] annex S.\nAn MRFC may support control of session-mode messaging conferences (as specified in 3GPP TS 24.247 [8F]), via the use of RFC 6230 [146] together with appropriate packages. The packages, or extensions to existing packages using RFC 6230 [146] framework are not specified in this release.\nThe MRFC shall send media control command responses and notifications to the AS using the AS-MRFC Cr interface.\nThe MRFC shall implement the control server role as described in RFC 6230 [146].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.4\tTranscoding",
                            "text_content": "An MRFC may support control of transcoding. An MRFC supporting control of transcoding shall support one or more of the following methods:\n-\tRFC 4240 [144] conference service;\n-\tRFC 6230 [146] and RFC 6505 [148]; or\n-\tRFC 4117 [166]. This is detailed in subclause 5.7.5.6.\nThe MRFC may support control of transcoding by the use of RFC 4240 [144] and the conference service described in RFC 4240 [144] subclause 5.\nThe media control commands are received from the AS either directly over the Mr' interface or via the S-CSCF over the ISC and Mr interfaces.\nThe MRFC acts as the media server described in RFC 4240 [144].\nThe MRFC may support control of transcoding by the use of RFC 6505 [148] and RFC 6230 [146].\nThe MRFC shall send media control command responses and notifications to the AS using the AS-MRFC Cr interface.\nThe MRFC shall implement the control server role as described in RFC 6230 [146].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.4\tProcedures at the MRB",
                    "description": "",
                    "summary": "",
                    "text_content": "The MRB shall support:\na)\tthe in-line unaware MRB interface.\nas defined in RFC 5917 [192].\nThe MRB may support:\na)\tthe media server resource publish interface; and\nb)\tthe media server resource consumer interface;\nas defined in RFC 6917 [192].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.1\tProfiles",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.1.1\tRelationship to other specifications",
                    "description": "",
                    "summary": "",
                    "text_content": "This annex contains a profile to the IETF specifications which are referenced by this specification, and the PICS proformas underlying profiles do not add requirements to the specifications they are proformas for.\nThis annex provides a profile specification according to both the current IETF specifications for SIP, SDP and other protocols (as indicated by the \"RFC status\" column in the tables in this annex) which are referenced by this specification and to the 3GPP specifications using SIP (as indicated by the \"Profile status\" column in the tables in this annex.\nIn the \"RFC status\" column the contents of the referenced specification takes precedence over the contents of the entry in the column.\nIn the \"Profile status\" column, there are a number of differences from the \"RFC status\" column. Where these differences occur, these differences take precedence over any requirements of the IETF specifications. Where specification concerning these requirements exists in the main body of the present document, the main body of the present document takes precedence.\nWhere differences occur in the \"Profile status\" column, the \"Profile status\" normally gives more strength to a \"RFC status\" and is not in contradiction with the \"RFC status\", e.g. it may change an optional \"RFC status\" to a mandatory \"Profile status\". If the \"Profile status\" weakens the strength of a \"RFC status\" then additionally this will be indicated by further textual description in the present document.\nFor all IETF specifications that are not referenced by this document or that are not mentioned within the 3GPP profile of SIP and SDP, the generic rules as defined by RFC 3261 [26] and in addition the rules in clauses 5 and 6 of this specification apply, e.g.\n-\ta proxy which is built in accordance to this specification passes on any unknown method, unknown header field or unknown header field parameter after applying procedures such as filtering, insertion of P-Asserted-Identity header field, etc.;\n-\tan UA which is built in accordance to this specification will\n-\thandle received unknown methods in accordance to the procedures defined in RFC 3261 [26], e.g. respond with a 501 (Not Implemented) response; and\n-\thandle unknown header fields and unknown header field parameters in accordance to the procedures defined in RFC 3261 [26], e.g. respond with a 420 (Bad Extension) if an extension identified by an option-tag in the Require header field of the received request is not supported by the UA.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.2\tIntroduction to methodology within this profile",
                    "description": "",
                    "summary": "",
                    "text_content": "This subclause does not reflect dynamic conformance requirements but static ones. In particular, a condition for support of a PDU parameter does not reflect requirements about the syntax of the PDU (i.e. the presence of a parameter) but the capability of the implementation to support the parameter.\nIn the sending direction, the support of a parameter means that the implementation is able to send this parameter (but it does not mean that the implementation always sends it).\nIn the receiving direction, it means that the implementation supports the whole semantic of the parameter that is described in the main part of this specification.\nAs a consequence, PDU parameter tables in this subclause are not the same as the tables describing the syntax of a PDU in the reference specification, e.g. RFC 3261 [26] tables 2 and 3. It is not rare to see a parameter which is optional in the syntax but mandatory in subclause below.\nThe various statii used in this subclause are in accordance with the rules in table A.1.\nTable A.1: Key to status codes\n\nIn the context of this specification the \"i\" status code mandates that the implementation does not change the content of the parameter. It is an implementation option if the implementation acts upon the content of the parameter (e.g. by setting filter criteria to known or unknown parts of parameters in order to find out the route a message has to take).\nIt must be understood, that this 3GPP SIP profile does not list all parameters which an implementation will treat as indicated by the status code \"irrelevant\". In general an implementation will pass on all unknown messages, header fields and header field parameters, as long as it can perform its normal behaviour.\nThe following additional comments apply to the interpretation of the tables in this Annex.\nNOTE 1:\tThe tables are constructed according to the conventional rules for ICS proformas and profile tables.\nNOTE 2:\tThe notation (either directly or as part of a conditional) of \"m\" for the sending of a parameter and \"i\" for the receipt of the same parameter, may be taken as indicating that the parameter is passed on transparently, i.e. without modification. Where a conditional applies, this behaviour only applies when the conditional is met.\nAs an example, the profile for the MGCF is found by first referring to clause 4.1, which states \"The MGCF shall provide the UA role\". Profiles are divided at the top level into the two roles in table A.2, user agent and proxy. The UA role is defined in subclause A.2.1 and the proxy role is defined in subclause A.2.2. More specific roles are listed in table A.3, table A.3A, table A.3B and table A.3C. The MGCF role is item 6 in table A.3 (the MGCF role is not found in table A.3A or table A.3B). Therefore, all profile entries for the MGCF are found by searching for A.3/6 in subclause A.2.1.\nAs a further example, to look up support of the Reason header field, table A.4 item 38 lists the Resaon header field as a major capability that is optional for the user agent role. A subsequent search for A.4/38 in subclause A.2.1 shows that the Reason header field is optional for a user agent role to send and receive for ACK, BYE, CANCEL, INVITE, MESSAGE, NOTIFY, OPTIONS, PRACK, PUBLISH, REFER, REGISTER, SUBSCRIBE, and UPDATE requests. Also, table A.162 item 48 lists the Reason header field as a major capability that is optional for the proxy role. A subsequent search for A.162/48 in subclause A.2.2 shows that, if supported, the Reason header field is mandatory to send and irrelevant to receive for ACK, BYE, CANCEL, INVITE, MESSAGE, NOTIFY, OPTIONS, PRACK, PUBLISH, REFER, REGISTER, SUBSCRIBE, and UPDATE requests.\n",
                    "tables": [
                        {
                            "description": "Table A.1: Key to status codes",
                            "table number": 15,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.3\tRoles",
                    "description": "",
                    "summary": "",
                    "text_content": "Table A.2: Roles\n\nTable A.3: Roles specific to this profile\n\nTable A.3A: Roles specific to additional capabilities\n\nTable A.3B: Roles with respect to access technology\n\nTable A.3C: Modifying roles\n\nTable A.3D: Roles with respect to security mechanism\n\n",
                    "tables": [
                        {
                            "description": "Table A.2: Roles",
                            "table number": 16,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table A.3: Roles specific to this profile",
                            "table number": 17,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table A.3A: Roles specific to additional capabilities",
                            "table number": 18,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table A.3B: Roles with respect to access technology",
                            "table number": 19,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table A.3C: Modifying roles",
                            "table number": 20,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table A.3D: Roles with respect to security mechanism",
                            "table number": 21,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.2\tProfile definition for the Session Initiation Protocol as used in the present document",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.2.1\tUser agent role",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "A.2.1.1\tIntroduction",
                            "text_content": "This subclause contains the ICS proforma tables related to the user role. They need to be completed only for UA implementations:\nPrerequisite: A.2/1 - - user agent role.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "A.2.1.2\tMajor capabilities",
                            "text_content": "Table A.4: Major capabilities\n\nPrerequisite A.4/20 - - SIP specific event notification\nTable A.4A: Supported event packages\n\nPrerequisite A.4/13 - - SIP INFO method and package framework.\nTable A.4B: Supported info packages\n\nTable A.4C: Supported media control packages\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.4: Major capabilities",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.4A: Supported event packages",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.4B: Supported info packages",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.4C: Supported media control packages",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "A.2.1.3\tPDUs",
                            "text_content": "Table A.5: Supported methods\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.5: Supported methods",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "A.2.1.4\tPDU parameters",
                            "text_content": "Table A.6: Supported status-codes\n\nPrerequisite A.5/1 – ACK request\nTable A.7: Supported header fields within the ACK request\n\nPrerequisite A.5/1 – ACK request\nTable A.8: Supported message bodies within the ACK request\n\nPrerequisite A.5/2 - - BYE request\nTable A.9: Supported header fields within the BYE request\n\nPrerequisite A.5/2 - - BYE request\nTable A.10: Supported message bodies within the BYE request\n\nTableA.11: Void\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.11A: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response for all remaining status-codes\nTable A.12: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.13: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.13A: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/103 OR A.6/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.14: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.15: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.16: Supported header fields within the BYE response\n\nTable A.17: Void\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/19 - - Additional for 407 (Proxy Authentication Required) response\nTable A.18: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response\nPrerequisite A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.19: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.19A: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.20: Supported header fields within the BYE response\n\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.20A: Supported header fields within the BYE response\n\nTable A.21: Void\nPrerequisite A.5/3 - - BYE response\nPrerequisite: A.6/6 - - Additional for 200 (OK) response\nTable A.22: Supported message bodies within the BYE response\n\nPrerequisite A.5/4 - - CANCEL request\nTable A.23: Supported header fields within the CANCEL request\n\nPrerequisite A.5/4 - - CANCEL request\nTable A.24: Supported message bodies within the CANCEL request\n\nPrerequisite A.5/5 - - CANCEL response for all status-codes\nTable A.25: Supported header fields within the CANCEL response\n\nPrerequisite A.5/5 - - CANCEL response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.26: Supported header fields within the CANCEL response\n\nPrerequisite A.5/5 - - CANCEL response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.26A: Supported header fields within the CANCEL response\n\nTable A.27: Void\nPrerequisite A.5/5 - - CANCEL response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.28: Supported header fields within the CANCEL response\n\nTable A.29: Void\nTable A.30: Void\nPrerequisite A.5/5 - - CANCEL response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.30A: Supported header fields within the CANCEL response\n\nPrerequisite A.5/5 - - CANCEL response\nTable A.31: Supported message bodies within the CANCEL response\n\nPrerequisite A.5/6 - - INFO request\nTable A.32: Supported header fields within the INFO request\n\nPrerequisite A.5/6 - - INFO request\nTable A.33: Supported message bodies within the INFO request\n\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.34: Supported header fields within the INFO response\n\nPrerequisite A.5/7 - - INFO response for all remaining status-codes\nTable A.35: Supported header fields within the INFO response\n\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.36: Supported header fields within the INFO response\n\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.37: Supported header fields within the INFO response\n\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/103 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.37A: Void\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.38: Supported header fields within the INFO response\n\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480 (Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.39: Supported header fields within the INFO response\n\nTable A.40: Void\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.41: Supported header fields within the INFO response\n\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.41A: Supported header fields within the INFO response\n\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.42: Supported header fields within the INFO response\n\nPrerequisite A.5/7 - - INFO response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.42A: Supported header fields within the INFO response\n\nTable A.43: Void\nTable A.44: Void\nPrerequisite A.5/7 - - INFO response\nTable A.45: Supported message bodies within the INFO response\n\nPrerequisite A.5/8 - - INVITE request\nTable A.46: Supported header fields within the INVITE request\n\nPrerequisite A.5/8 - - INVITE request\nTable A.47: Supported message bodies within the INVITE request\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.48: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response for all remaining status-codes\nTable A.49: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/101A - - Additional for 18x response\nTable A.50: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/2 - - Additional for 180 (Ringing) response\nTable A.50A: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/5A - - Additional for 199 (Early Dialog Terminated) response\nTable A.50B: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.51: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.51A: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/103 OR A.6/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.52: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.53: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/16 - - Additional for 403 (Forbidden) response\nTable A.53A: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 600 (Busy Everywhere), 603 (Decline) response\nTable A.54: Supported header fields within the INVITE response\n\nTable A.55: Void\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.56: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/21 - - Additional for 408 (Request timeout) response\nTable A.56A: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.57: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.57A: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.58: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.58A: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/28A - - Additional for 422 (Session Interval Too Small) response\nTable A.58B: Supported header fields within the INVITE response\n\nTable A.59: Void\nTable A.60: Void\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/29H - - Additional for 470 (Consent Needed) response\nTable A.60A: Supported header fields within the INVITE response\n\nPrerequisite A.5/9 - - INVITE response\nPrerequisite: A.6/45 - - 503 (Service Unavailable)\nTable A.61: Supported header fields within the INVITE response\n\nTable A.61A: Void\nPrerequisite A.5/9 - - INVITE response\nTable A.62: Supported message bodies within the INVITE response\n\nPrerequisite A.5/9A - - MESSAGE request\nTable A.62A: Supported header fields within the MESSAGE request\n\nPrerequisite A.5/9A - - MESSAGE request\nTable A.62B: Supported message bodies within the MESSAGE request\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.62BA: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response for all remaining status-codes\nTable A.62C: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.62D: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.62DA: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/103 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.62E: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.62F: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.62G: Supported header fields within the MESSAGE response\n\nTable A.62H: Void\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.62I: Supported header fields within the MESSAGE response\n\nTable A.62IA: Void\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.62J: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.62JA: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.62K: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.62L: Supported header fields within the MESSAGE response\n\nTable A.62M: Void\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/29H - - Additional for 470 (Consent Needed) response\nTable A.62MA: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nPrerequisite: A.6/46 - - Additional for 504 (Server Time-out) response\nTable A.62MB: Supported header fields within the MESSAGE response\n\nPrerequisite A.5/9B - - MESSAGE response\nTable A.62N: Supported message bodies within the MESSAGE response\n\nPrerequisite A.5/10 - - NOTIFY request\nTable A.63: Supported header fields within the NOTIFY request\n\nPrerequisite A.5/10 - - NOTIFY request\nTable A.64: Supported message bodies within the NOTIFY request\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.64A: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response for all remaining status-codes\nTable A.65: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.66: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.66A: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/103 - - Additional for 3xx response\nTable A.67: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.68: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.69: Supported header fields within the NOTIFY response\n\nTable A.70: Void\nTable A.71: Void\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/21 - - Additional for 408 (Request timeout) response\nTable A.71A: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.72: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.72A: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/27 - - Addition for 420 (Bad Extension) response\nTable A.73: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.73A: Supported header fields within the NOTIFY response\n\nTable A.74: Void\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/35 - - Additional for 485 (Ambigious) response\nTable A.74A: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/39 - - Additional for 489 (Bad Event) response\nTable A.75: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nPrerequisite: A.6/46 - - Additional for 504 (Server Time-out) response\nTable A.75A: Supported header fields within the NOTIFY response\n\nPrerequisite A.5/11 - - NOTIFY response\nTable A.76: Supported message bodies within the NOTIFY response\n\nPrerequisite A.5/12 - - OPTIONS request\nTable A.77: Supported header fields within the OPTIONS request\n\nPrerequisite A.5/12 - - OPTIONS request\nTable A.78: Supported message bodies within the OPTIONS request\n\nTable A.79: Void\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.79A: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response for all remaining status-codes\nTable A.80: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.81: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.81A: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/103 OR A.6/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.82: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.83: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response.\nTable A.84: Supported header fields within the OPTIONS response\n\nTable A.85: Void\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.86: Supported header fields within the OPTIONS response\n\nTable A.86A: Void\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.87: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.87A: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.88: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/28 OR A.6/41A - - Additional 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.88A: Supported header fields within the OPTIONS response\n\nTable A.89: Void\nPrerequisite A.5/13 - - OPTIONS response\nPrerequisite: A.6/46 - - Additional for 504 (Server Time-out) response\nTable A.89A: Supported header fields within the OPTIONS response\n\nPrerequisite A.5/13 - - OPTIONS response\nTable A.90: Supported message bodies within the OPTIONS response\n\nPrerequisite A.5/14 - - PRACK request\nTable A.91: Supported header fields within the PRACK request\n\nPrerequisite A.5/14 - - PRACK request\nTable A.92: Supported message bodies within the PRACK request\n\nTable A.93: Void\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.93A: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response for all remaining status-codes\nTable A.94: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.95: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.95A: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/103 OR A.6/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.96: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.97: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response.\nTable A.98: Supported header fields within the PRACK response\n\nTable A.99: Void\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.100: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.101: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.101A: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.102: Supported header fields within the PRACK response\n\nPrerequisite A.5/15 - - PRACK response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.102A: Supported header fields within the PRACK response\n\nTable A.103: Void\nPrerequisite A.5/15 - - PRACK response\nTable A.104: Supported message bodies within the PRACK response\n\nPrerequisite A.5/15A – PUBLISH request\nTable A.104A: Supported header fields within the PUBLISH request\n\nPrerequisite A.5/15A - - PUBLISH request\nTable A.104B: Supported message bodies within the PUBLISH request\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.104BA: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response for all remaining status-codes\nTable A.104C: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.104D: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/6 - - Additional for 200 (OK) response\nTable A.104DAA: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.104DA: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/103 OR A.6/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.104E: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/8 OR A.6/9 OR A.6/10 OR A.6/11OR A.6/12 – Additional for 401 (Unauthorized) response\nTable A.104F: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.104G: Supported header fields within the PUBLISH response\n\nTable A.104H: Void\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.104I: Supported header fields within the PUBLISH response\n\nTable A.104IA: Void\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.104J: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.104JA: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.104K: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.104L: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/29 - - Additional for 423 (Interval Too Brief) response\nTable A.104M: Supported header fields within the PUBLISH response\n\nTable A.104N: Void\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/39 - - Additional for 489 (Bad Event) response\nTable A.104O: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nPrerequisite: A.6/46 - - Additional for 504 (Server Time-out) response\nTable A.104OA: Supported header fields within the PUBLISH response\n\nPrerequisite A.5/15B - - PUBLISH response\nTable A.104P: Supported message bodies within the PUBLISH response\n\nPrerequisite A.5/16 - - REFER request\nTable A.105: Supported header fields within the REFER request\n\nPrerequisite A.5/16 - - REFER request\nTable A.106: Supported message bodies within the REFER request\n\nTable A.107: Void\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.107A: Supported header fields within the REFER response\n\nPrerequisite A.5/17 - - REFER response for all remaining status-codes\nTable A.108: Supported header fields within the REFER response\n\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.109: Supported header fields within the REFER response\n\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.109A: Supported header fields within the REFER response\n\nTable A.110: Void\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.111: Supported header fields within the REFER response\n\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.112: Supported header fields within the REFER response\n\nTable A.113: Void\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.114: Supported header fields within the REFER response\n\nTable A.114A: Void\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.115: Supported header fields within the REFER response\n\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.115A: Supported header fields within the REFER response\n\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.116: Supported header fields within the REFER response\n\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.116A: Supported header fields within the REFER response\n\nTable A.117: Void\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/29H - - Additional for 470 (Consent Needed) response\nTable A.117A: Supported header fields within the REFER response\n\nPrerequisite A.5/17 - - REFER response\nPrerequisite: A.6/46 - - Additional for 504 (Server Time-out) response\nTable A.117B: Supported header fields within the REFER response\n\nPrerequisite A.5/17 - - REFER response\nTable A.118: Supported message bodies within the REFER response\n\nPrerequisite A.5/18 - - REGISTER request\nTable A.119: Supported header fields within the REGISTER request\n\nPrerequisite A.5/18 - - REGISTER request\nTable A.120: Supported message bodies within the REGISTER request\n\nTable A.121: Void\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.121A: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response for all remaining status-codes\nTable A.122: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.123: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.123A: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/103 OR A.6/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.124: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.125: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.126: Supported header fields within the REGISTER response\n\nTable A.127: Void\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.128: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.129: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.129A: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.130: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.130A: Supported header fields within the REGISTER response\n\nPrerequisite A.5/19 - - REGISTER response\nPrerequisite: A.6/29 - - Additional for 423 (Interval Too Brief) response\nTable A.131: Supported header fields within the REGISTER response\n\nTable A.132: Void\nPrerequisite A.5/19 - - REGISTER response\nTable A.133: Supported message bodies within the REGISTER response\n\nPrerequisite A.5/20 - - SUBSCRIBE request\nTable A.134: Supported header fields within the SUBSCRIBE request\n\nPrerequisite A.5/20 - - SUBSCRIBE request\nTable A.135: Supported message bodies within the SUBSCRIBE request\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.135A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response for all remaining status-codes\nTable A.136: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.137: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.137A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/103 OR A.6/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.138: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.139: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480 (Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.140: Supported header fields within the SUBSCRIBE response\n\nTable A.141: Void\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.142: Supported header fields within the SUBSCRIBE response\n\nTable A.142A: Void\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.143: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.143A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.144: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.144A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/29 - - Additional for 423 (Interval Too Brief) response\nTable A.145: Supported header fields within the SUBSCRIBE response\n\nTable A.146: Void\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/29H - - Additional for 470 (Consent Needed) response\nTable A.146A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/39 - - Additional for 489 (Bad Event) response\nTable A.147: Supported header fields within the SUBSCRIBE response\n\nTable A.148: Void\nPrerequisite A.5/21 - - SUBSCRIBE response\nPrerequisite: A.6/46 - - Additional for 504 (Server Time-out) response\nTable A.148A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.5/21 - - SUBSCRIBE response\nTable A.149: Supported message bodies within the SUBSCRIBE response\n\nPrerequisite A.5/22 - - UPDATE request\nTable A.150: Supported header fields within the UPDATE request\n\nPrerequisite A.5/22 - - UPDATE request\nTable A.151: Supported message bodies within the UPDATE request\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/1 - - Additional for 100 (Trying) response\nTable A.151A: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response for all remaining status-codes\nTable A.152: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/102 - - Additional for 2xx response\nTable A.153: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/103 OR A.6/104 OR A.6/105 OR A.6/106 - - Additional for 3xx – 6xx response\nTable A.153A: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/103 OR A.6/35 - - Additional for 3xx, 485 (Ambiguous) response\nTable A.154: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/14 - - Additional for 401 (Unauthorized) response\nTable A.154A: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/17 OR A.6/23 OR A.6/30 OR A.6/36 OR A.6/42 OR A.6/45 OR A.6/50 OR A.6/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.155: Supported header fields within the UPDATE response\n\nTable A.156: Void\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.157: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.158: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.158A: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/27 - - Additional for 420 (Bad Extension) response\nTable A.159: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/28 OR A.6/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.159A: Supported header fields within the UPDATE response\n\nPrerequisite A.5/23 - - UPDATE response\nPrerequisite: A.6/28A - - Additional for 422 (Session Interval Too Small) response\nTable A.159B: Supported header fields within the UPDATE response\n\nTable A.160: Void\nPrerequisite A.5/23 - - UPDATE response\nTable A.161: Supported message bodies within the UPDATE response\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.6: Supported status-codes",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.7: Supported header fields within the ACK request",
                                    "table number": 28,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.8: Supported message bodies within the ACK request",
                                    "table number": 29,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.9: Supported header fields within the BYE request",
                                    "table number": 30,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.10: Supported message bodies within the BYE request",
                                    "table number": 31,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.11A: Supported header fields within the BYE response",
                                    "table number": 32,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.12: Supported header fields within the BYE response",
                                    "table number": 33,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.13: Supported header fields within the BYE response",
                                    "table number": 34,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.13A: Supported header fields within the BYE response",
                                    "table number": 35,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.14: Supported header fields within the BYE response",
                                    "table number": 36,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.15: Supported header fields within the BYE response",
                                    "table number": 37,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.16: Supported header fields within the BYE response",
                                    "table number": 38,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.18: Supported header fields within the BYE response",
                                    "table number": 39,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.19: Supported header fields within the BYE response",
                                    "table number": 40,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.19A: Supported header fields within the BYE response",
                                    "table number": 41,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.20: Supported header fields within the BYE response",
                                    "table number": 42,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.20A: Supported header fields within the BYE response",
                                    "table number": 43,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.22: Supported message bodies within the BYE response",
                                    "table number": 44,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.23: Supported header fields within the CANCEL request",
                                    "table number": 45,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.24: Supported message bodies within the CANCEL request",
                                    "table number": 46,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.25: Supported header fields within the CANCEL response",
                                    "table number": 47,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.26: Supported header fields within the CANCEL response",
                                    "table number": 48,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.26A: Supported header fields within the CANCEL response",
                                    "table number": 49,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.28: Supported header fields within the CANCEL response",
                                    "table number": 50,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.30A: Supported header fields within the CANCEL response",
                                    "table number": 51,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.31: Supported message bodies within the CANCEL response",
                                    "table number": 52,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.32: Supported header fields within the INFO request",
                                    "table number": 53,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.33: Supported message bodies within the INFO request",
                                    "table number": 54,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.34: Supported header fields within the INFO response",
                                    "table number": 55,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.35: Supported header fields within the INFO response",
                                    "table number": 56,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.36: Supported header fields within the INFO response",
                                    "table number": 57,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.37: Supported header fields within the INFO response",
                                    "table number": 58,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.37A: Void",
                                    "table number": 59,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.38: Supported header fields within the INFO response",
                                    "table number": 60,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.39: Supported header fields within the INFO response",
                                    "table number": 61,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.41: Supported header fields within the INFO response",
                                    "table number": 62,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.41A: Supported header fields within the INFO response",
                                    "table number": 63,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.42: Supported header fields within the INFO response",
                                    "table number": 64,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.42A: Supported header fields within the INFO response",
                                    "table number": 65,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.45: Supported message bodies within the INFO response",
                                    "table number": 66,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.46: Supported header fields within the INVITE request",
                                    "table number": 67,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.47: Supported message bodies within the INVITE request",
                                    "table number": 68,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.48: Supported header fields within the INVITE response",
                                    "table number": 69,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.49: Supported header fields within the INVITE response",
                                    "table number": 70,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.50: Supported header fields within the INVITE response",
                                    "table number": 71,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.50A: Supported header fields within the INVITE response",
                                    "table number": 72,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.50B: Supported header fields within the INVITE response",
                                    "table number": 73,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.51: Supported header fields within the INVITE response",
                                    "table number": 74,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.51A: Supported header fields within the INVITE response",
                                    "table number": 75,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.52: Supported header fields within the INVITE response",
                                    "table number": 76,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.53: Supported header fields within the INVITE response",
                                    "table number": 77,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.53A: Supported header fields within the INVITE response",
                                    "table number": 78,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.54: Supported header fields within the INVITE response",
                                    "table number": 79,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.56: Supported header fields within the INVITE response",
                                    "table number": 80,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.56A: Supported header fields within the INVITE response",
                                    "table number": 81,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.57: Supported header fields within the INVITE response",
                                    "table number": 82,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.57A: Supported header fields within the INVITE response",
                                    "table number": 83,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.58: Supported header fields within the INVITE response",
                                    "table number": 84,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.58A: Supported header fields within the INVITE response",
                                    "table number": 85,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.58B: Supported header fields within the INVITE response",
                                    "table number": 86,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.60A: Supported header fields within the INVITE response",
                                    "table number": 87,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.61: Supported header fields within the INVITE response",
                                    "table number": 88,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62: Supported message bodies within the INVITE response",
                                    "table number": 89,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62A: Supported header fields within the MESSAGE request",
                                    "table number": 90,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62B: Supported message bodies within the MESSAGE request",
                                    "table number": 91,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62BA: Supported header fields within the MESSAGE response",
                                    "table number": 92,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62C: Supported header fields within the MESSAGE response",
                                    "table number": 93,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62D: Supported header fields within the MESSAGE response",
                                    "table number": 94,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62DA: Supported header fields within the MESSAGE response",
                                    "table number": 95,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62E: Supported header fields within the MESSAGE response",
                                    "table number": 96,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62F: Supported header fields within the MESSAGE response",
                                    "table number": 97,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62G: Supported header fields within the MESSAGE response",
                                    "table number": 98,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62I: Supported header fields within the MESSAGE response",
                                    "table number": 99,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62J: Supported header fields within the MESSAGE response",
                                    "table number": 100,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62JA: Supported header fields within the MESSAGE response",
                                    "table number": 101,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62K: Supported header fields within the MESSAGE response",
                                    "table number": 102,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62L: Supported header fields within the MESSAGE response",
                                    "table number": 103,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62MA: Supported header fields within the MESSAGE response",
                                    "table number": 104,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62MB: Supported header fields within the MESSAGE response",
                                    "table number": 105,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.62N: Supported message bodies within the MESSAGE response",
                                    "table number": 106,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.63: Supported header fields within the NOTIFY request",
                                    "table number": 107,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.64: Supported message bodies within the NOTIFY request",
                                    "table number": 108,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.64A: Supported header fields within the NOTIFY response",
                                    "table number": 109,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.65: Supported header fields within the NOTIFY response",
                                    "table number": 110,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.66: Supported header fields within the NOTIFY response",
                                    "table number": 111,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.66A: Supported header fields within the NOTIFY response",
                                    "table number": 112,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.67: Supported header fields within the NOTIFY response",
                                    "table number": 113,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.68: Supported header fields within the NOTIFY response",
                                    "table number": 114,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.69: Supported header fields within the NOTIFY response",
                                    "table number": 115,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.71A: Supported header fields within the NOTIFY response",
                                    "table number": 116,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.72: Supported header fields within the NOTIFY response",
                                    "table number": 117,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.72A: Supported header fields within the NOTIFY response",
                                    "table number": 118,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.73: Supported header fields within the NOTIFY response",
                                    "table number": 119,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.73A: Supported header fields within the NOTIFY response",
                                    "table number": 120,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.74A: Supported header fields within the NOTIFY response",
                                    "table number": 121,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.75: Supported header fields within the NOTIFY response",
                                    "table number": 122,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.75A: Supported header fields within the NOTIFY response",
                                    "table number": 123,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.76: Supported message bodies within the NOTIFY response",
                                    "table number": 124,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.77: Supported header fields within the OPTIONS request",
                                    "table number": 125,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.78: Supported message bodies within the OPTIONS request",
                                    "table number": 126,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.79A: Supported header fields within the OPTIONS response",
                                    "table number": 127,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.80: Supported header fields within the OPTIONS response",
                                    "table number": 128,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.81: Supported header fields within the OPTIONS response",
                                    "table number": 129,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.81A: Supported header fields within the OPTIONS response",
                                    "table number": 130,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.82: Supported header fields within the OPTIONS response",
                                    "table number": 131,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.83: Supported header fields within the OPTIONS response",
                                    "table number": 132,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.84: Supported header fields within the OPTIONS response",
                                    "table number": 133,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.86: Supported header fields within the OPTIONS response",
                                    "table number": 134,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.87: Supported header fields within the OPTIONS response",
                                    "table number": 135,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.87A: Supported header fields within the OPTIONS response",
                                    "table number": 136,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.88: Supported header fields within the OPTIONS response",
                                    "table number": 137,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.88A: Supported header fields within the OPTIONS response",
                                    "table number": 138,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.89A: Supported header fields within the OPTIONS response",
                                    "table number": 139,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.90: Supported message bodies within the OPTIONS response",
                                    "table number": 140,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.91: Supported header fields within the PRACK request",
                                    "table number": 141,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.92: Supported message bodies within the PRACK request",
                                    "table number": 142,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.93A: Supported header fields within the PRACK response",
                                    "table number": 143,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.94: Supported header fields within the PRACK response",
                                    "table number": 144,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.95: Supported header fields within the PRACK response",
                                    "table number": 145,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.95A: Supported header fields within the PRACK response",
                                    "table number": 146,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.96: Supported header fields within the PRACK response",
                                    "table number": 147,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.97: Supported header fields within the PRACK response",
                                    "table number": 148,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.98: Supported header fields within the PRACK response",
                                    "table number": 149,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.100: Supported header fields within the PRACK response",
                                    "table number": 150,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.101: Supported header fields within the PRACK response",
                                    "table number": 151,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.101A: Supported header fields within the PRACK response",
                                    "table number": 152,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.102: Supported header fields within the PRACK response",
                                    "table number": 153,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.102A: Supported header fields within the PRACK response",
                                    "table number": 154,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104: Supported message bodies within the PRACK response",
                                    "table number": 155,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104A: Supported header fields within the PUBLISH request",
                                    "table number": 156,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104B: Supported message bodies within the PUBLISH request",
                                    "table number": 157,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104BA: Supported header fields within the PUBLISH response",
                                    "table number": 158,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104C: Supported header fields within the PUBLISH response",
                                    "table number": 159,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104D: Supported header fields within the PUBLISH response",
                                    "table number": 160,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104DAA: Supported header fields within the PUBLISH response",
                                    "table number": 161,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104DA: Supported header fields within the PUBLISH response",
                                    "table number": 162,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104E: Supported header fields within the PUBLISH response",
                                    "table number": 163,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104F: Supported header fields within the PUBLISH response",
                                    "table number": 164,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104G: Supported header fields within the PUBLISH response",
                                    "table number": 165,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104I: Supported header fields within the PUBLISH response",
                                    "table number": 166,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104J: Supported header fields within the PUBLISH response",
                                    "table number": 167,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104JA: Supported header fields within the PUBLISH response",
                                    "table number": 168,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104K: Supported header fields within the PUBLISH response",
                                    "table number": 169,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104L: Supported header fields within the PUBLISH response",
                                    "table number": 170,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104M: Supported header fields within the PUBLISH response",
                                    "table number": 171,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104O: Supported header fields within the PUBLISH response",
                                    "table number": 172,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104OA: Supported header fields within the PUBLISH response",
                                    "table number": 173,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.104P: Supported message bodies within the PUBLISH response",
                                    "table number": 174,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.105: Supported header fields within the REFER request",
                                    "table number": 175,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.106: Supported message bodies within the REFER request",
                                    "table number": 176,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.107A: Supported header fields within the REFER response",
                                    "table number": 177,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.108: Supported header fields within the REFER response",
                                    "table number": 178,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.109: Supported header fields within the REFER response",
                                    "table number": 179,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.109A: Supported header fields within the REFER response",
                                    "table number": 180,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.111: Supported header fields within the REFER response",
                                    "table number": 181,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.112: Supported header fields within the REFER response",
                                    "table number": 182,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.114: Supported header fields within the REFER response",
                                    "table number": 183,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.115: Supported header fields within the REFER response",
                                    "table number": 184,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.115A: Supported header fields within the REFER response",
                                    "table number": 185,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.116: Supported header fields within the REFER response",
                                    "table number": 186,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.116A: Supported header fields within the REFER response",
                                    "table number": 187,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.117A: Supported header fields within the REFER response",
                                    "table number": 188,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.117B: Supported header fields within the REFER response",
                                    "table number": 189,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.118: Supported message bodies within the REFER response",
                                    "table number": 190,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.119: Supported header fields within the REGISTER request",
                                    "table number": 191,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.120: Supported message bodies within the REGISTER request",
                                    "table number": 192,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.121A: Supported header fields within the REGISTER response",
                                    "table number": 193,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.122: Supported header fields within the REGISTER response",
                                    "table number": 194,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.123: Supported header fields within the REGISTER response",
                                    "table number": 195,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.123A: Supported header fields within the REGISTER response",
                                    "table number": 196,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.124: Supported header fields within the REGISTER response",
                                    "table number": 197,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.125: Supported header fields within the REGISTER response",
                                    "table number": 198,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.126: Supported header fields within the REGISTER response",
                                    "table number": 199,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.128: Supported header fields within the REGISTER response",
                                    "table number": 200,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.129: Supported header fields within the REGISTER response",
                                    "table number": 201,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.129A: Supported header fields within the REGISTER response",
                                    "table number": 202,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.130: Supported header fields within the REGISTER response",
                                    "table number": 203,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.130A: Supported header fields within the REGISTER response",
                                    "table number": 204,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.131: Supported header fields within the REGISTER response",
                                    "table number": 205,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.133: Supported message bodies within the REGISTER response",
                                    "table number": 206,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.134: Supported header fields within the SUBSCRIBE request",
                                    "table number": 207,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.135: Supported message bodies within the SUBSCRIBE request",
                                    "table number": 208,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.135A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 209,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.136: Supported header fields within the SUBSCRIBE response",
                                    "table number": 210,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.137: Supported header fields within the SUBSCRIBE response",
                                    "table number": 211,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.137A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 212,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.138: Supported header fields within the SUBSCRIBE response",
                                    "table number": 213,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.139: Supported header fields within the SUBSCRIBE response",
                                    "table number": 214,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.140: Supported header fields within the SUBSCRIBE response",
                                    "table number": 215,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.142: Supported header fields within the SUBSCRIBE response",
                                    "table number": 216,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.143: Supported header fields within the SUBSCRIBE response",
                                    "table number": 217,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.143A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 218,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.144: Supported header fields within the SUBSCRIBE response",
                                    "table number": 219,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.144A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 220,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.145: Supported header fields within the SUBSCRIBE response",
                                    "table number": 221,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.146A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 222,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.147: Supported header fields within the SUBSCRIBE response",
                                    "table number": 223,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.148A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 224,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.149: Supported message bodies within the SUBSCRIBE response",
                                    "table number": 225,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.150: Supported header fields within the UPDATE request",
                                    "table number": 226,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.151: Supported message bodies within the UPDATE request",
                                    "table number": 227,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.151A: Supported header fields within the UPDATE response",
                                    "table number": 228,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.152: Supported header fields within the UPDATE response",
                                    "table number": 229,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.153: Supported header fields within the UPDATE response",
                                    "table number": 230,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.153A: Supported header fields within the UPDATE response",
                                    "table number": 231,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.154: Supported header fields within the UPDATE response",
                                    "table number": 232,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.154A: Supported header fields within the UPDATE response",
                                    "table number": 233,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.155: Supported header fields within the UPDATE response",
                                    "table number": 234,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.157: Supported header fields within the UPDATE response",
                                    "table number": 235,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.158: Supported header fields within the UPDATE response",
                                    "table number": 236,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.158A: Supported header fields within the UPDATE response",
                                    "table number": 237,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.159: Supported header fields within the UPDATE response",
                                    "table number": 238,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.159A: Supported header fields within the UPDATE response",
                                    "table number": 239,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.159B: Supported header fields within the UPDATE response",
                                    "table number": 240,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.161: Supported message bodies within the UPDATE response",
                                    "table number": 241,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "A.2.2\tProxy role",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "A.2.2.1\tIntroduction",
                            "text_content": "This subclause contains the ICS proforma tables related to the proxy role. They need to be completed only for proxy implementations.\nPrerequisite: A.2/2 - - proxy role\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "A.2.2.2\tMajor capabilities",
                            "text_content": "Table A.162: Major capabilities\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.162: Major capabilities",
                                    "table number": 242,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "A.2.2.3\tPDUs",
                            "text_content": "Table A.163: Supported methods\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.163: Supported methods",
                                    "table number": 243,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "A.2.2.4\tPDU parameters",
                            "text_content": "Table A.164: Supported-status codes\n\nPrerequisite A.163/1 - - ACK request\nTable A.165: Supported header fields within the ACK request\n\nPrerequisite A.163/1 - - ACK request\nTable A.166: Supported message bodies within the ACK request\n\nPrerequisite A.163/2 - - BYE request\nTable A.167: Supported header fields within the BYE request\n\nPrerequisite A.163/2 - - BYE request\nTable A.168: Supported message bodies within the BYE request\n\nTable A.169: Void\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.169A: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - - BYE response\nTable A.170: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.171: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.171A: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - BYE response\nPrerequisite: A.164/103 OR A.164/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.172: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.173: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.174: Supported header fields within the BYE response\n\nTable A.175: Void\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.176: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.177: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.177A: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.178: Supported header fields within the BYE response\n\nPrerequisite A.163/3 - - BYE response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.178A: Supported header fields within the BYE response\n\nTable A.179: Void\nPrerequisite A163/3 - - BYE response\nPrerequisite: A.164/6 - - Additional for 200 (OK) response\nTable A.180: Supported message bodies within the BYE response\n\nPrerequisite A.163/4 - - CANCEL request\nTable A.181: Supported header fields within the CANCEL request\n\nPrerequisite A.163/4 - - CANCEL request\nTable A.182: Supported message bodies within the CANCEL request\n\nPrerequisite A.163/5 - - CANCEL response for all status-codes\nTable A.183: Supported header fields within the CANCEL response\n\nPrerequisite A.163/5 - - CANCEL response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.184: Supported header fields within the CANCEL response\n\nPrerequisite A.163/5 - - CANCEL response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.184A: Supported header fields within the CANCEL response\n\nTable A.185: Void\nPrerequisite A.163/5 - - CANCEL response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional 404 (Not Found), 413 (Request for Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.186: Supported header fields within the CANCEL response\n\nPrerequisite A.163/5 - - CANCEL response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.186A: Supported header fields within the CANCEL response\n\nTable A.187: Void\nTable A.188: Void\nPrerequisite A.163/5 - - CANCEL response\nTable A.189: Supported message bodies within the CANCEL response\n\nPrerequisite A.163/6 - - INFO request\nTable A.190: Supported header fields within the INFO request\n\nPrerequisite A.163/6 - - INFO request\nTable A.191: Supported message bodies within the INFO request\n\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.192: Supported header fields within the INFO response\n\nPrerequisite A.163/7 - - INFO response for all remaining status-codes\nTable A.193: Supported header fields within the INFO response\n\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.194: Supported header fields within the INFO response\n\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.195: Supported header fields within the INFO response\n\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/103 OR A.164/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.195A: Void\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.196: Supported header fields within the INFO response\n\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.197: Supported header fields within the INFO response\n\nTable A.198: Void\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type)\nTable A.199: Supported header fields within the INFO response\n\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.199A: Supported header fields within the INFO response\n\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.200: Supported header fields within the INFO response\n\nPrerequisite A.163/7 - - INFO response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.200A: Supported header fields within the INFO response\n\nTable A.201: Void\nTable A.202: Void\nPrerequisite A.163/7 - - INFO response\nTable A.203: Supported message bodies within the INFO response\n\nPrerequisite A.163/8 - - INVITE request\nTable A.204: Supported header fields within the INVITE request\n\nPrerequisite A.163/8 - - INVITE request\nTable A.205: Supported message bodies within the INVITE request\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.206: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response for all remaining status-codes\nTable A.207: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/101A - - Additional for 18x response\nTable A.208: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/2 - - Additional for 180 (Ringing) response\nTable A.208A: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/5A - - Additional for 199 (Early Dialog Terminated) response\nTable A.208B: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.209: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.209A: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/103 OR A.164/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.210: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.211: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.6/16 - - Additional for 403 (Forbidden) response\nTable A.211A: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 600 (Busy Everywhere), 603 (Decline) response\nTable A.212: Supported header fields within the INVITE response\n\nTable A.213: Void\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.214: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/21 - - Additional for 408 (Request timeout) response\nTable A.214A: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.215: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.215A: Supported header field\ts within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.216: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.216A: Supported header fields within the INVITE response\n\nPrerequisite A.16/9 - - INVITE response\nPrerequisite: A.164/28A - - Additional for 422 (Session Interval Too Small) response\nTable A.216B: Supported header fields within the INVITE response\n\nTable A.217: Void\nTable A.217A: Void\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/29H - - Additional for 470 (Consent Needed) response\nTable A.217AA: Supported header fields within the INVITE response\n\nPrerequisite A.163/9 - - INVITE response\nPrerequisite: A.164/45 - - 503 (Service Unavailable)\nTable A.217B: Supported header fields within the INVITE response\n\nTable A.217C: void\nPrerequisite A.163/9 - - INVITE response\nTable A.218: Supported message bodies within the INVITE response\n\nPrerequisite A.163/9A - - MESSAGE request\nTable A.218A: Supported header fields within the MESSAGE request\n\nPrerequisite A.163/9A - - MESSAGE request\nTable A.218B: Supported message bodies within the MESSAGE request\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.218BA: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response for all remaining status-codes\nTable A.218C: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.218D: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.218DA: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/103 OR A.164/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.218E: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.218F: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.218G: Supported header fields within the MESSAGE response\n\nTable A.218H: Void\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.218I: Supported header fields within the MESSAGE response\n\nTable 218IA: Void\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type)\nTable A.218J: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.218JA: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.218K: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.218L: Supported header fields within the MESSAGE response\n\nTable A.218M: Void\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/29H - - Additional for 470 (Consent Needed) response\nTable A.218MA: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nPrerequisite: A.164/46 - - Additional for 504 (Server Time-out) response\nTable A.218MB: Supported header fields within the MESSAGE response\n\nPrerequisite A.163/9B - - MESSAGE response\nTable A.218N: Supported message bodies within the MESSAGE response\n\nPrerequisite A.163/10 - - NOTIFY request\nTable A.219: Supported header fields within the NOTIFY request\n\nPrerequisite A.163/10 - - NOTIFY request\nTable A.220: Supported message bodies within the NOTIFY request\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.220A: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response for all remaining status-codes\nTable A.221: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.222: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.222A: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/103 - - Additional for 3xx response\nTable A.223: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.224: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.225: Supported header fields within the NOTIFY response\n\nTable A.226: Void\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.227: Supported header fields within the NOTIFY response\n\nTable A.227A: Void\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.228: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.228A: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.229: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.229A: Supported header fields within the NOTIFY response\n\nTable A.230: Void\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/35 - - Additional for 485 (Ambigious) response\nTable A.230A: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/39 - - Additional for 489 (Bad Event) response\nTable A.231: Supported header fields within the NOTIFY response\n\nPrerequisite A.163/11 - - NOTIFY response\nPrerequisite: A.164/46 - - Additional for 504 (Server Time-out) response\nTable A.231A: Supported header fields within the REFER response\n\nPrerequisite A.163/11 - - NOTIFY response\nTable A.232: Supported message bodies within the NOTIFY response\n\nPrerequisite A.163/12 - - OPTIONS request\nTable A.233: Supported header fields within the OPTIONS request\n\nPrerequisite A.163/12 - - OPTIONS request\nTable A.234: Supported message bodies within the OPTIONS request\n\nTable A.235: Void\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.235A: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response for all remaining status-codes\nTable A.236: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.237: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.237A: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/103 OR A.164/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.238: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.239: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.240: Supported header fields within the OPTIONS response\n\nTable A.241: Void\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.242: Supported header fields within the OPTIONS response\n\nTable A.242A: Void\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.243: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.243A: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.244: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.244A: Supported header fields within the OPTIONS response\n\nTable A.245: Void\nPrerequisite A.163/13 - - OPTIONS response\nPrerequisite: A.164/46 - - Additional for 504 (Server Time-out) response\nTable A.245A: Supported header fields within the OPTIONS response\n\nPrerequisite A.163/13 - - OPTIONS response\nTable A.246: Supported message bodies within the OPTIONS response\n\nPrerequisite A.163/14 - - PRACK request\nTable A.247: Supported header fields within the PRACK request\n\nPrerequisite A.163/14 - - PRACK request\nTable A.248: Supported message bodies within the PRACK request\n\nTable A.249: Void\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.249A: Supported header fields within the PRACK response\n\nPrerequisite A.163/15 - - PRACK response for all remaining status-codes\nTable A.250: Supported header fields within the PRACK response\n\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.251: Supported header fields within the PRACK response\n\nPrerequisite A.163/3 - - PRACK response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.251A: Supported header fields within the PRACK response\n\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/103 OR A.164/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.252: Supported header fields within the PRACK response\n\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.253: Supported header fields within the PRACK response\n\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.254: Supported header fields within the PRACK response\n\nTable A.255: Void\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.256: Supported header fields within the PRACK response\n\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.257: Supported header fields within the PRACK response\n\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.257A: Supported header fields within the PRACK response\n\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/27 - - Addition for 420 (Bad Extension) response\nTable A.258: Supported header fields within the PRACK response\n\nPrerequisite A.163/15 - - PRACK response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.258A: Supported header fields within the PRACK response\n\nTable A.259: Void\nPrerequisite A.163/15 - - PRACK response\nTable A.260: Supported message bodies within the PRACK response\n\nPrerequisite A.163/15A - - PUBLISH request\nTable A.260A: Supported header fields within the PUBLISH request\n\nPrerequisite A.163/15A - - PUBLISH request\nTable A.260B: Supported message bodies within the PUBLISH request\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.260BA: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response for all remaining status-codes\nTable A.260C: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.260D: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/6 - - Additional for 200 (OK) response\nTable A.260DAA: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.260DA: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/103 OR A.164/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.260E: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/8 OR A.164/9 OR A.164/10 OR A.164/11 OR A.164/12 - - Additional for 401 (Unauthorized) response\nTable A.260F: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.260G: Supported header fields within the PUBLISH response\n\nTable A.260H: Void\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.260I: Supported header fields within the PUBLISH response\n\nTable A.260IA: Void\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.260J: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.260JA: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.260K: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.260L: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/29 - - Additional for 423 (Interval Too Brief) response\nTable A.260M: Supported header fields within the PUBLISH response\n\nTable A.260N: Void\nPrerequisite A.163/15B - - PUBLISH response\nPrerequisite: A.164/39 - - Additional for 489 (Bad Event) response\nTable A.260O: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/17 - - PUBLISH response\nPrerequisite: A.164/46 - - Additional for 504 (Server Time-out) response\nTable A.260OA: Supported header fields within the PUBLISH response\n\nPrerequisite A.163/17 - - PUBLISH response\nTable A.260P: Supported message bodies within the PUBLISH response\n\nPrerequisite A.163/16 - - REFER request\nTable A.261: Supported header fields within the REFER request\n\nPrerequisite A.163/16 - - REFER request\nTable A.262: Supported message bodies within the REFER request\n\nTable A.263: Void\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.263A: Supported header fields within the REFER response\n\nPrerequisite A.163/17 - - REFER response for all remaining status-codes\nTable A.264: Supported header fields within the REFER response\n\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.265: Supported header fields within the REFER response\n\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.265A: Supported header fields within the REFER response\n\nTable A.266: Void\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/8 OR A.164/9 OR A.164/10 OR A.164/11 OR A.164/12 - - Additional for 401 (Unauthorized) response\nTable A.267: Supported header fields within the REFER response\n\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.268: Supported header fields within the REFER response\n\nTable A.269: Void\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.270: Supported header fields within the REFER response\n\nTable A.270A: Void\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.271: Supported header fields within the REFER response\n\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.271A: Supported header fields within the REFER response\n\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.272: Supported header fields within the REFER response\n\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.272A: Supported header fields within the REFER response\n\nTable A.273: Void\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/29H - - Additional for 470 (Consent Needed) response\nTable A.273A: Supported header fields within the REFER response\n\nPrerequisite A.163/17 - - REFER response\nPrerequisite: A.164/46 - - Additional for 504 (Server Time-out) response\nTable A.273AA: Supported header fields within the REFER response\n\nPrerequisite A.163/17 - - REFER response\nTable A.274: Supported message bodies within the REFER response\n\nPrerequisite A.163/18 - - REGISTER request\nTable A.275: Supported header fields within the REGISTER request\n\nPrerequisite A.163/18 - - REGISTER request\nTable A.276: Supported message bodies within the REGISTER request\n\nTable A.277: Void\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.277A: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response for all remaining status-codes\nTable A.278: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.279: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.279A: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/103 OR A.164/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.280: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.281: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.282: Supported header fields within the REGISTER response\n\nTable A.283: Void\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.284: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.285: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.285A: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.286: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.286A: Supported header fields within the REGISTER response\n\nPrerequisite A.163/19 - - REGISTER response\nPrerequisite: A.164/29 - - Additional for 423 (Interval Too Brief) response\nTable A.287: Supported header fields within the REGISTER response\n\nTable A.288: Void\nPrerequisite A.163/19 - - REGISTER response\nTable A.289: Supported message bodies within the REGISTER response\n\nPrerequisite A.163/20 - - SUBSCRIBE request\nTable A.290: Supported header fields within the SUBSCRIBE request\n\nPrerequisite A.163/20 - - SUBSCRIBE request\nTable A.291: Supported message bodies within the SUBSCRIBE request\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.291A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response for all remaining status-codes\nTable A.292: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.293: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.293A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/103 OR A.164/35 - - Additional for 3xx or 485 (Ambiguous) response\nTable A.294: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.295: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480 (Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.296: Supported header fields within the SUBSCRIBE response\n\nTable A.297: Void\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.298: Supported header fields within the SUBSCRIBE response\n\nTable A.298A: Void\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.299: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.299A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.300: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.300A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/29 - - Additional for 423 (Interval Too Brief) response\nTable A.301: Supported header fields within the SUBSCRIBE response\n\nTable A.302: Void\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/29H - - Additional for 470 (Consent Needed) response\nTable A.302A: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/39 - - Additional for 489 (Bad Event) response\nTable A.303: Supported header fields within the SUBSCRIBE response\n\nTable A.303A: Void\nPrerequisite A.163/21 - - SUBSCRIBE response\nPrerequisite: A.164/46 - - Additional for 504 (Server Time-out) response\nTable A.303B: Supported header fields within the SUBSCRIBE response\n\nPrerequisite A.163/21 - - SUBSCRIBE response\nTable A.304: Supported message bodies within the SUBSCRIBE response\n\nPrerequisite A.163/22 - - UPDATE request\nTable A.305: Supported header fields within the UPDATE request\n\nPrerequisite A.163/22 - - UPDATE request\nTable A.306: Supported message bodies within the UPDATE request\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/1 - - Additional for 100 (Trying) response\nTable A.306A: Supported header fields within the UPDATE response\n\nPrerequisite A.163/22 - - UPDATE response for all remaining status-codes\nTable A.307: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/102 - - Additional for 2xx response\nTable A.308: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/103 OR A.164/104 OR A.164/105 OR A.164/106 - - Additional for 3xx – 6xx response\nTable A.308A: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/103 or A.164/35 - - Additional for 3xx, 485 (Ambiguous) response\nTable A.309: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/14 - - Additional for 401 (Unauthorized) response\nTable A.309A: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/17 OR A.164/23 OR A.164/30 OR A.164/36 OR A.164/42 OR A.164/45 OR A.164/50 OR A.164/51 - - Additional for 404 (Not Found), 413 (Request Entity Too Large), 480(Temporarily not available), 486 (Busy Here), 500 (Internal Server Error), 503 (Service Unavailable), 600 (Busy Everywhere), 603 (Decline) response\nTable A.310: Supported header fields within the UPDATE response\n\nTable A.311: Void\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/20 - - Additional for 407 (Proxy Authentication Required) response\nTable A.312: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/25 - - Additional for 415 (Unsupported Media Type) response\nTable A.313: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/26A - - Additional for 417 (Unknown Resource-Priority) response\nTable A.313A: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/27 - - Additional for 420 (Bad Extension) response\nTable A.314: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/28 OR A.164/41A - - Additional for 421 (Extension Required), 494 (Security Agreement Required) response\nTable A.314A: Supported header fields within the UPDATE response\n\nPrerequisite A.163/23 - - UPDATE response\nPrerequisite: A.164/28A - - Additional for 422 (Session Interval Too Small) response\nTable A.314B: Supported header fields within the UPDATE response\n\nTable A.315: Void\nPrerequisite A.163/23 - - UPDATE response\nTable A.316: Supported message bodies within the UPDATE response\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.164: Supported-status codes",
                                    "table number": 244,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.165: Supported header fields within the ACK request",
                                    "table number": 245,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.166: Supported message bodies within the ACK request",
                                    "table number": 246,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.167: Supported header fields within the BYE request",
                                    "table number": 247,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.168: Supported message bodies within the BYE request",
                                    "table number": 248,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.169A: Supported header fields within the BYE response",
                                    "table number": 249,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.170: Supported header fields within the BYE response",
                                    "table number": 250,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.171: Supported header fields within the BYE response",
                                    "table number": 251,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.171A: Supported header fields within the BYE response",
                                    "table number": 252,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.172: Supported header fields within the BYE response",
                                    "table number": 253,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.173: Supported header fields within the BYE response",
                                    "table number": 254,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.174: Supported header fields within the BYE response",
                                    "table number": 255,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.176: Supported header fields within the BYE response",
                                    "table number": 256,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.177: Supported header fields within the BYE response",
                                    "table number": 257,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.177A: Supported header fields within the BYE response",
                                    "table number": 258,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.178: Supported header fields within the BYE response",
                                    "table number": 259,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.178A: Supported header fields within the BYE response",
                                    "table number": 260,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.180: Supported message bodies within the BYE response",
                                    "table number": 261,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.181: Supported header fields within the CANCEL request",
                                    "table number": 262,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.182: Supported message bodies within the CANCEL request",
                                    "table number": 263,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.183: Supported header fields within the CANCEL response",
                                    "table number": 264,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.184: Supported header fields within the CANCEL response",
                                    "table number": 265,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.184A: Supported header fields within the CANCEL response",
                                    "table number": 266,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.186: Supported header fields within the CANCEL response",
                                    "table number": 267,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.186A: Supported header fields within the CANCEL response",
                                    "table number": 268,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.189: Supported message bodies within the CANCEL response",
                                    "table number": 269,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.190: Supported header fields within the INFO request",
                                    "table number": 270,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.191: Supported message bodies within the INFO request",
                                    "table number": 271,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.192: Supported header fields within the INFO response",
                                    "table number": 272,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.193: Supported header fields within the INFO response",
                                    "table number": 273,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.194: Supported header fields within the INFO response",
                                    "table number": 274,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.195: Supported header fields within the INFO response",
                                    "table number": 275,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.195A: Void",
                                    "table number": 276,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.196: Supported header fields within the INFO response",
                                    "table number": 277,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.197: Supported header fields within the INFO response",
                                    "table number": 278,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.199: Supported header fields within the INFO response",
                                    "table number": 279,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.199A: Supported header fields within the INFO response",
                                    "table number": 280,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.200: Supported header fields within the INFO response",
                                    "table number": 281,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.200A: Supported header fields within the INFO response",
                                    "table number": 282,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.203: Supported message bodies within the INFO response",
                                    "table number": 283,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.204: Supported header fields within the INVITE request",
                                    "table number": 284,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.205: Supported message bodies within the INVITE request",
                                    "table number": 285,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.206: Supported header fields within the INVITE response",
                                    "table number": 286,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.207: Supported header fields within the INVITE response",
                                    "table number": 287,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.208: Supported header fields within the INVITE response",
                                    "table number": 288,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.208A: Supported header fields within the INVITE response",
                                    "table number": 289,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.208B: Supported header fields within the INVITE response",
                                    "table number": 290,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.209: Supported header fields within the INVITE response",
                                    "table number": 291,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.209A: Supported header fields within the INVITE response",
                                    "table number": 292,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.210: Supported header fields within the INVITE response",
                                    "table number": 293,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.211: Supported header fields within the INVITE response",
                                    "table number": 294,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.211A: Supported header fields within the INVITE response",
                                    "table number": 295,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.212: Supported header fields within the INVITE response",
                                    "table number": 296,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.214: Supported header fields within the INVITE response",
                                    "table number": 297,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.214A: Supported header fields within the INVITE response",
                                    "table number": 298,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.215: Supported header fields within the INVITE response",
                                    "table number": 299,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.215A: Supported header field\ts within the INVITE response",
                                    "table number": 300,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.216: Supported header fields within the INVITE response",
                                    "table number": 301,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.216A: Supported header fields within the INVITE response",
                                    "table number": 302,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.216B: Supported header fields within the INVITE response",
                                    "table number": 303,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.217AA: Supported header fields within the INVITE response",
                                    "table number": 304,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.217B: Supported header fields within the INVITE response",
                                    "table number": 305,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.217C: void",
                                    "table number": 306,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218: Supported message bodies within the INVITE response",
                                    "table number": 307,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218A: Supported header fields within the MESSAGE request",
                                    "table number": 308,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218B: Supported message bodies within the MESSAGE request",
                                    "table number": 309,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218BA: Supported header fields within the MESSAGE response",
                                    "table number": 310,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218C: Supported header fields within the MESSAGE response",
                                    "table number": 311,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218D: Supported header fields within the MESSAGE response",
                                    "table number": 312,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218DA: Supported header fields within the MESSAGE response",
                                    "table number": 313,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218E: Supported header fields within the MESSAGE response",
                                    "table number": 314,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218F: Supported header fields within the MESSAGE response",
                                    "table number": 315,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218G: Supported header fields within the MESSAGE response",
                                    "table number": 316,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218I: Supported header fields within the MESSAGE response",
                                    "table number": 317,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218J: Supported header fields within the MESSAGE response",
                                    "table number": 318,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218JA: Supported header fields within the MESSAGE response",
                                    "table number": 319,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218K: Supported header fields within the MESSAGE response",
                                    "table number": 320,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218L: Supported header fields within the MESSAGE response",
                                    "table number": 321,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218MA: Supported header fields within the MESSAGE response",
                                    "table number": 322,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218MB: Supported header fields within the MESSAGE response",
                                    "table number": 323,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.218N: Supported message bodies within the MESSAGE response",
                                    "table number": 324,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.219: Supported header fields within the NOTIFY request",
                                    "table number": 325,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.220: Supported message bodies within the NOTIFY request",
                                    "table number": 326,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.220A: Supported header fields within the NOTIFY response",
                                    "table number": 327,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.221: Supported header fields within the NOTIFY response",
                                    "table number": 328,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.222: Supported header fields within the NOTIFY response",
                                    "table number": 329,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.222A: Supported header fields within the NOTIFY response",
                                    "table number": 330,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.223: Supported header fields within the NOTIFY response",
                                    "table number": 331,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.224: Supported header fields within the NOTIFY response",
                                    "table number": 332,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.225: Supported header fields within the NOTIFY response",
                                    "table number": 333,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.227: Supported header fields within the NOTIFY response",
                                    "table number": 334,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.228: Supported header fields within the NOTIFY response",
                                    "table number": 335,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.228A: Supported header fields within the NOTIFY response",
                                    "table number": 336,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.229: Supported header fields within the NOTIFY response",
                                    "table number": 337,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.229A: Supported header fields within the NOTIFY response",
                                    "table number": 338,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.230A: Supported header fields within the NOTIFY response",
                                    "table number": 339,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.231: Supported header fields within the NOTIFY response",
                                    "table number": 340,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.231A: Supported header fields within the REFER response",
                                    "table number": 341,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.232: Supported message bodies within the NOTIFY response",
                                    "table number": 342,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.233: Supported header fields within the OPTIONS request",
                                    "table number": 343,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.234: Supported message bodies within the OPTIONS request",
                                    "table number": 344,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.235A: Supported header fields within the OPTIONS response",
                                    "table number": 345,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.236: Supported header fields within the OPTIONS response",
                                    "table number": 346,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.237: Supported header fields within the OPTIONS response",
                                    "table number": 347,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.237A: Supported header fields within the OPTIONS response",
                                    "table number": 348,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.238: Supported header fields within the OPTIONS response",
                                    "table number": 349,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.239: Supported header fields within the OPTIONS response",
                                    "table number": 350,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.240: Supported header fields within the OPTIONS response",
                                    "table number": 351,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.242: Supported header fields within the OPTIONS response",
                                    "table number": 352,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.243: Supported header fields within the OPTIONS response",
                                    "table number": 353,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.243A: Supported header fields within the OPTIONS response",
                                    "table number": 354,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.244: Supported header fields within the OPTIONS response",
                                    "table number": 355,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.244A: Supported header fields within the OPTIONS response",
                                    "table number": 356,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.245A: Supported header fields within the OPTIONS response",
                                    "table number": 357,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.246: Supported message bodies within the OPTIONS response",
                                    "table number": 358,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.247: Supported header fields within the PRACK request",
                                    "table number": 359,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.248: Supported message bodies within the PRACK request",
                                    "table number": 360,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.249A: Supported header fields within the PRACK response",
                                    "table number": 361,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.250: Supported header fields within the PRACK response",
                                    "table number": 362,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.251: Supported header fields within the PRACK response",
                                    "table number": 363,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.251A: Supported header fields within the PRACK response",
                                    "table number": 364,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.252: Supported header fields within the PRACK response",
                                    "table number": 365,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.253: Supported header fields within the PRACK response",
                                    "table number": 366,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.254: Supported header fields within the PRACK response",
                                    "table number": 367,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.256: Supported header fields within the PRACK response",
                                    "table number": 368,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.257: Supported header fields within the PRACK response",
                                    "table number": 369,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.257A: Supported header fields within the PRACK response",
                                    "table number": 370,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.258: Supported header fields within the PRACK response",
                                    "table number": 371,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.258A: Supported header fields within the PRACK response",
                                    "table number": 372,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260: Supported message bodies within the PRACK response",
                                    "table number": 373,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260A: Supported header fields within the PUBLISH request",
                                    "table number": 374,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260B: Supported message bodies within the PUBLISH request",
                                    "table number": 375,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260BA: Supported header fields within the PUBLISH response",
                                    "table number": 376,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260C: Supported header fields within the PUBLISH response",
                                    "table number": 377,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260D: Supported header fields within the PUBLISH response",
                                    "table number": 378,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260DAA: Supported header fields within the PUBLISH response",
                                    "table number": 379,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260DA: Supported header fields within the PUBLISH response",
                                    "table number": 380,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260E: Supported header fields within the PUBLISH response",
                                    "table number": 381,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260F: Supported header fields within the PUBLISH response",
                                    "table number": 382,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260G: Supported header fields within the PUBLISH response",
                                    "table number": 383,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260I: Supported header fields within the PUBLISH response",
                                    "table number": 384,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260J: Supported header fields within the PUBLISH response",
                                    "table number": 385,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260JA: Supported header fields within the PUBLISH response",
                                    "table number": 386,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260K: Supported header fields within the PUBLISH response",
                                    "table number": 387,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260L: Supported header fields within the PUBLISH response",
                                    "table number": 388,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260M: Supported header fields within the PUBLISH response",
                                    "table number": 389,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260O: Supported header fields within the PUBLISH response",
                                    "table number": 390,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260OA: Supported header fields within the PUBLISH response",
                                    "table number": 391,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.260P: Supported message bodies within the PUBLISH response",
                                    "table number": 392,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.261: Supported header fields within the REFER request",
                                    "table number": 393,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.262: Supported message bodies within the REFER request",
                                    "table number": 394,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.263A: Supported header fields within the REFER response",
                                    "table number": 395,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.264: Supported header fields within the REFER response",
                                    "table number": 396,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.265: Supported header fields within the REFER response",
                                    "table number": 397,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.265A: Supported header fields within the REFER response",
                                    "table number": 398,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.267: Supported header fields within the REFER response",
                                    "table number": 399,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.268: Supported header fields within the REFER response",
                                    "table number": 400,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.270: Supported header fields within the REFER response",
                                    "table number": 401,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.271: Supported header fields within the REFER response",
                                    "table number": 402,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.271A: Supported header fields within the REFER response",
                                    "table number": 403,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.272: Supported header fields within the REFER response",
                                    "table number": 404,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.272A: Supported header fields within the REFER response",
                                    "table number": 405,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.273A: Supported header fields within the REFER response",
                                    "table number": 406,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.273AA: Supported header fields within the REFER response",
                                    "table number": 407,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.274: Supported message bodies within the REFER response",
                                    "table number": 408,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.275: Supported header fields within the REGISTER request",
                                    "table number": 409,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.276: Supported message bodies within the REGISTER request",
                                    "table number": 410,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.277A: Supported header fields within the REGISTER response",
                                    "table number": 411,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.278: Supported header fields within the REGISTER response",
                                    "table number": 412,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.279: Supported header fields within the REGISTER response",
                                    "table number": 413,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.279A: Supported header fields within the REGISTER response",
                                    "table number": 414,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.280: Supported header fields within the REGISTER response",
                                    "table number": 415,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.281: Supported header fields within the REGISTER response",
                                    "table number": 416,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.282: Supported header fields within the REGISTER response",
                                    "table number": 417,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.284: Supported header fields within the REGISTER response",
                                    "table number": 418,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.285: Supported header fields within the REGISTER response",
                                    "table number": 419,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.285A: Supported header fields within the REGISTER response",
                                    "table number": 420,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.286: Supported header fields within the REGISTER response",
                                    "table number": 421,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.286A: Supported header fields within the REGISTER response",
                                    "table number": 422,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.287: Supported header fields within the REGISTER response",
                                    "table number": 423,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.289: Supported message bodies within the REGISTER response",
                                    "table number": 424,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.290: Supported header fields within the SUBSCRIBE request",
                                    "table number": 425,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.291: Supported message bodies within the SUBSCRIBE request",
                                    "table number": 426,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.291A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 427,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.292: Supported header fields within the SUBSCRIBE response",
                                    "table number": 428,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.293: Supported header fields within the SUBSCRIBE response",
                                    "table number": 429,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.293A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 430,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.294: Supported header fields within the SUBSCRIBE response",
                                    "table number": 431,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.295: Supported header fields within the SUBSCRIBE response",
                                    "table number": 432,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.296: Supported header fields within the SUBSCRIBE response",
                                    "table number": 433,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.298: Supported header fields within the SUBSCRIBE response",
                                    "table number": 434,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.299: Supported header fields within the SUBSCRIBE response",
                                    "table number": 435,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.299A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 436,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.300: Supported header fields within the SUBSCRIBE response",
                                    "table number": 437,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.300A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 438,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.301: Supported header fields within the SUBSCRIBE response",
                                    "table number": 439,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.302A: Supported header fields within the SUBSCRIBE response",
                                    "table number": 440,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.303: Supported header fields within the SUBSCRIBE response",
                                    "table number": 441,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.303B: Supported header fields within the SUBSCRIBE response",
                                    "table number": 442,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.304: Supported message bodies within the SUBSCRIBE response",
                                    "table number": 443,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.305: Supported header fields within the UPDATE request",
                                    "table number": 444,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.306: Supported message bodies within the UPDATE request",
                                    "table number": 445,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.306A: Supported header fields within the UPDATE response",
                                    "table number": 446,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.307: Supported header fields within the UPDATE response",
                                    "table number": 447,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.308: Supported header fields within the UPDATE response",
                                    "table number": 448,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.308A: Supported header fields within the UPDATE response",
                                    "table number": 449,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.309: Supported header fields within the UPDATE response",
                                    "table number": 450,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.309A: Supported header fields within the UPDATE response",
                                    "table number": 451,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.310: Supported header fields within the UPDATE response",
                                    "table number": 452,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.312: Supported header fields within the UPDATE response",
                                    "table number": 453,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.313: Supported header fields within the UPDATE response",
                                    "table number": 454,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.313A: Supported header fields within the UPDATE response",
                                    "table number": 455,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.314: Supported header fields within the UPDATE response",
                                    "table number": 456,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.314A: Supported header fields within the UPDATE response",
                                    "table number": 457,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.314B: Supported header fields within the UPDATE response",
                                    "table number": 458,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.316: Supported message bodies within the UPDATE response",
                                    "table number": 459,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "A.3\tProfile definition for the Session Description Protocol as used in the present document",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.3.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "Void.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.3.2\tUser agent role",
                    "description": "",
                    "summary": "",
                    "text_content": "This subclause contains the ICS proforma tables related to the user agent role. They need to be completed only for UA implementations.\nPrerequisite: A.2/1 -- user agent role\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "A.3.2.1\tMajor capabilities",
                            "text_content": "Table A.317: Major capabilities\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.317: Major capabilities",
                                    "table number": 460,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "A.3.2.2\tSDP types",
                            "text_content": "Table A.318: SDP types\n\nPrerequisite A.318/14 OR A.318/20 - - a= (zero or more session/media attribute lines)\nTable A.319: zero or more session / media attribute lines (a=)\n\nPrerequisite A.319/80 - - a= generic header extension map definition (a=extmap)\nTable A.319A:  header extensions\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.318: SDP types",
                                    "table number": 461,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.319: zero or more session / media attribute lines (a=)",
                                    "table number": 462,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.319A:  header extensions",
                                    "table number": 463,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "A.3.2.3\tVoid",
                            "text_content": "Table A.320: Void\nTable A.321: Void\nTable A.322: Void\nTable A.323: Void\nTable A.324: Void\nTable A.325: Void\nTable A.326: Void\nTable A.327: Void\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "A.3.2.4\tVoid",
                            "text_content": "Table A.327A: Void\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "A.3.3\tProxy role",
                    "description": "",
                    "summary": "",
                    "text_content": "This subclause contains the ICS proforma tables related to the user role. They need to be completed only for proxy implementations.\nPrerequisite: A.2/2 -- proxy role\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "A.3.3.1\tMajor capabilities",
                            "text_content": "Table A.328: Major capabilities\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.328: Major capabilities",
                                    "table number": 464,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "A.3.3.2\tSDP types",
                            "text_content": "Table A.329: SDP types\n\nPrerequisite A.329/14 OR A.329/20 - - a= (zero or more session/media attribute lines)\nTable A.330: zero or more session / media attribute lines (a=)\n\nPrerequisite A.330/80 - - a= generic header extension map definition (a=extmap)\nTable A.330A:  header extensions\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table A.329: SDP types",
                                    "table number": 465,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.330: zero or more session / media attribute lines (a=)",
                                    "table number": 466,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table A.330A:  header extensions",
                                    "table number": 467,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "A.3.3.3\tVoid",
                            "text_content": "Table A.331: Void\nTable A.332: Void\nTable A.333: Void\nTable A.334: Void\nTable A.335: Void\nTable A.336: Void\nTable A.337: Void\nTable A.338: Void\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "A.3.3.4\tVoid",
                            "text_content": "Table A.339: Void\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "A.4\tProfile definition for other message bodies as used in the present document",
            "description": "Void.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is General Packet Radio Service (GPRS). The GPRS IP-CAN has a core network:\n-\twith SGSN connected to GGSN providing a UE with a PDP context for the IM CN subsystem-related signalling and media; or\n-\twith SGSN connected to S-GW and S-GW connected to P-GW providing the UE with a PDP context for the IM CN subsystem-related signalling and media.\nNOTE:\tThe UE is unaware of how the network provides the UE with a PDP context for the IM CN subsystem-related signalling and media.\nThe core network can be supported by GERAN and UTRAN radio access networks.\nThe present annex also defines procedures for invoking CS domain services.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.2\tGPRS aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by the core network to provide packet-mode communication between the UE and the IM CN subsystem.\nRequirements for the UE on the use of these packet-mode services are specified in this clause. Requirements for the core network in support of this communication are specified in 3GPP TS 29.061 [11], 3GPP TS 29.207 [12] and 3GPP TS 29.212 [13B].\nWhen using the GPRS IP-CAN, each IP-CAN bearer is provided by a PDP context.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "B.2.2.1\tPDP context activation and P-CSCF discovery",
                            "text_content": "Prior to communication with the IM CN subsystem, the UE shall:\na)\tif not attached for GPRS services yet, perform a GPRS attach procedure as specified in 3GPP TS 24.008 [8];\nb)\tensure that a PDP context used for SIP signalling according to the  and GGSN or P-GW selection criteria described in 3GPP TS 23.060 [4] and 3GPP TS 27.060 [10A] is available. This PDP context shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration. As a result, the PDP context provides the UE with information that makes the UE able to construct an IPv4 or an IPv6 address;\nNOTE 1:\tDuring the PDP context activation procedure, the UE and the core network negotiate whether the UE or the GPRS IP-CAN is responsible for the resource reservation applicable to all PDP contexts within the activated PDP address/ pair, as described in 3GPP TS 24.008 [8].\nWhen the bearer establishment is controlled by the UE, the UE shall choose one of the following options when performing establishment of this PDP context:\nI.\tA dedicated PDP context for SIP signalling:\nThe UE shall indicate to the core network that this is a PDP context intended to carry IM CN subsystem-related signalling only by setting the IM CN Subsystem Signalling Flag. The UE may also use this PDP context for DNS and DHCP signalling according to the static packet filters as described in 3GPP TS 29.061 [11]. The UE can also set the Signalling Indication attribute within the QoS information element;\nII.\tA general-purpose PDP context:\nThe UE may decide to use a general-purpose PDP Context to carry IM CN subsystem-related signalling. The UE shall indicate to the core network that this is a general-purpose PDP context by not setting the IM CN Subsystem Signalling Flag. The UE may carry both signalling and media on the general-purpose PDP context. The UE can also set the Signalling Indication attribute within the QoS information element.\nNOTE 2:\tWhen the bearer establishment is controlled by the GPRS IP-CAN, the core network follows the procedures described in 3GPP TS 29.061 [11] in order to establish a dedicated PDP context for SIP signalling.\nIf the UE supports the optional configuration parameter \"Access_Point_Name_Parameter_Reading_Rule\", as defined in 3GPP TS 24.167 [8G] and has been configured with this parameter, then the UE shall use it to retrieve the access point name to use in the PDP context activation procedure.\nThe UE indicates the IM CN Subsystem Signalling Flag within the Protocol Configuration Options information element of the ACTIVATE PDP CONTEXT REQUEST message or ACTIVATE SECONDARY PDP CONTEXT REQUEST message. Upon successful signalling PDP context establishment the UE receives an indication in the form of IM CN Subsystem Signalling Flag within the Protocol Configuration Options information element. If the flag is not received, the UE shall consider the PDP context as a general-purpose PDP context.\nThe encoding of the IM CN Subsystem Signalling Flag within the Protocol Configuration Options information element is described in 3GPP TS 24.008 [8].\nThe UE can indicate a request for prioritised handling over the radio interface by setting the Signalling Indication attribute (see 3GPP TS 23.107 [4A]). The general QoS negotiation mechanism and the encoding of the Signalling Indication attribute within the QoS information element are described in 3GPP TS 24.008 [8]; and\nNOTE 3:\tA general-purpose PDP Context can carry both IM CN subsystem signalling and media, in case the media does not need to be authorized by Policy and Charging control mechanisms as defined in 3GPP TS 29.212 [13B] and Service Based Local Policy mechanisms defined in 3GPP TS 29.207 [12] and the media stream is not mandated by the P-CSCF to be carried in a separate PDP Context.\nc)\tacquire a P-CSCF address(es).\nThe methods for P-CSCF discovery are:\nI.\tWhen using IPv4, employ the Dynamic Host Configuration Protocol (DHCP) RFC 2132 [20F], the DHCPv4 options for SIP servers RFC 3361 [35A], and RFC 3263 [27A] as described in subclause 9.2.1. When using IPv6, employ Dynamic Host Configuration Protocol for IPv6 (DHCPv6) RFC 3315 [40], the DHCPv6 options for SIP servers RFC 3319 [41] and DHCPv6 options for Domain Name Servers (DNS) RFC 3646 [56C] as described in subclause 9.2.1.\nII.\tTransfer P-CSCF address(es) within the PDP context activation procedure.\nThe UE shall indicate the request for a P-CSCF address within the Protocol Configuration Options information element of the ACTIVATE PDP CONTEXT REQUEST message or ACTIVATE SECONDARY PDP CONTEXT REQUEST message.\nIf the UE is provided with a list of P-CSCF IPv4 or IPv6 addresses in the ACTIVATE PDP CONTEXT ACCEPT message or ACTIVATE SECONDARY PDP CONTEXT ACCEPT message, the UE shall assume that the list is ordered top-down with the first P-CSCF address within the Protocol Configuration Options information element as the P-CSCF address having the highest preference and the last P-CSCF address within the Protocol Configuration Options information element as the P-CSCF address having the lowest preference.\nIII.\tThe UE selects a P-CSCF from the list (see 3GPP TS 31.103 [15B]) stored in the ISIM.\nIV.\tThe UE selects a P-CSCF from the list in IMS management object.\nThe UE shall use method IV to select a P-CSCF, if:\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming; and\n-\tthe IMS management object contains the P-CSCF list.\nThe UE shall use method III to select the P-CSCF, if:\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming;\n-\teither the UE does not contain the IMS management object, or the UE contains the IMS management object, but the IMS management object does not contain the P-CSCF list; and\n-\tthe ISIM residing in the UICC supports the P-CSCF list.\nThe UE can freely select method I or II for P-CSCF discovery, if:\n-\tthe UE is in the home network; or\n-\tthe UE is roaming and the P-CSCF is to be discovered in the visited network.\nThe UE can select method IV, if:\n-\tthe UE is in the home network; and\n-\tthe IMS management object contains the P-CSCF list.\nIn case method I is selected and several P-CSCF addresses or FQDNs are provided to the UE, the selection of P-CSCF address or FQDN shall be performed as indicated in RFC 3361 [35A] when using IPv4 or RFC 3319 [41] when using IPv6. If sufficient information for P-CSCF address selection is not available, selection of the P-CSCF address by the UE is implementation specific.\nNOTE 4:\tThe UE decides whether the P-CSCF is to be discovered in the serving network or in the home network based on local configuration, e.g. whether the application on the UE is permitted to use local breakout.\nIf the UE is designed to use I above, but receives P-CSCF address(es) according to II, then the UE shall either ignore the received address(es), or use the address(es) in accordance with II, and not proceed with the DHCP request according to I.\nIf the UE is configured to use Option II above and detects that all P-CSCFs known by the UE have been used when the UE selects a different P-CSCF as a result of:\n-\treceiving 305 (Use Proxy) to the REGISTER request;\n-\treceiving 504 (Server Time-out); or\n-\texpiration of the timer F at the UE,\nthen the UE should:\n-\trelease IP-CAN bearer that\tis used only for the transport of SIP signalling and that are not used for other non-IMS applications, except emergency IP-CAN bearers;\n-\tperform a new P-CSCF discovery procedure as described in subslause 9.2.1; and\n-\tperform the procedures for initial registration as described in subclause 5.1.1.2.\nNOTE 5:\tThe UE may not be able to release the IP-CAN bearer if the IP-CAN bearer is in use by other applications.\nWhen using IPv4, the UE may request a DNS Server IPv4 address(es) via RFC 2132 [20F] or by the Protocol Configuration Options information element when activating a PDP context according to 3GPP TS 27.060 [10A].\nWhen using IPv6, the UE may request a DNS Server IPv6 address(es) via RFC 3315 [40] and RFC 3646 [56C] or by the Protocol Configuration Options information element when activating a PDP context according to 3GPP TS 27.060 [10A].\nThe encoding of the request and response for IPv4 or IPv6 address(es) for DNS server(s) and list of P-CSCF address(es) within the Protocol Configuration Options information element is described in 3GPP TS 24.008 [8].\nWhen:\n-\tthe UE obtains a PDP context used for SIP signalling by performing handover of the connection from another IP-CAN;\n-\tthe IP address of the UE is not changed during the handover; and\n-\tthe UE already communicates with the IM CN subsystem via the connection with the other IP-CAN, e.g. the UE determines that its contact with host portion set to the UE IP address (or FQDN of the UE) associated with the connection with the other IP-CAN has been bound to a public user identity;\nthe UE shall continue using the P-CSCF address(es) acquired in the other IP-CAN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.2.1A\tModification of a PDP context used for SIP signalling",
                            "text_content": "The PDP context shall not be modified from a dedicated PDP context for SIP signalling to a general-purpose PDP context or vice versa. The IM CN Subsystem Signalling Flag shall not be set in the Protocol Configuration Options information element of the MODIFY PDP CONTEXT REQUEST message.\nThe UE shall not indicate the request for a P-CSCF address within the Protocol Configuration Options information element of the MODIFY PDP CONTEXT REQUEST message. The UE shall ignore P-CSCF address(es) if received in the Protocol Configuration Options information element of the MODIFY PDP CONTEXT RESPONSE message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.2.1B\tRe-establishment of the PDP context for SIP signalling",
                            "text_content": "If the UE registered a public user identity with an IP address allocated for the  of the PDP context used for SIP signalling, the PDP context used for SIP signalling is deactivated as result of signalling from the core network (e.g. no longer available as a result of a successful GPRS routeing area update procedure) and:\ni)\tif the signalling from the core network results in requiring the UE to initiate activation of the PDP context used for SIP signalling; or\nii)\tif the UE needs to continue having a public user identity registered with an IP address allocated for the ;\nand the UE is allowed to send:\n-\tACTIVATE PDP CONTEXT REQUEST message; or\n-\tACTIVATE SECONDARY PDP CONTEXT REQUEST message,\nto activate the PDP context for SIP signalling, the UE shall:\nA)\tif the non-access stratum is performing the PDP context activation procedure for the  triggered as result of the signalling from the core network, wait until the PDP context activation procedure for the  finishes; and\nB)\tperform the procedures in subclause B.2.2.1, bullets a), b) and c).\nIf:\n-\tnone of the bullets i) and ii) of this subclause evaluate to true;\n-\tthe UE is not allowed to send the ACTIVATE (SECONDARY) PDP CONTEXT REQUEST message;\n-\tthe procedures in bullet B) of this subclause were unable to ensure that the PDP context used for SIP signalling is available; or\n-\tthe procedures in bullet B) of this subclause were unable to acquire any P-CSCF address(es);\nand if the PDP context used for SIP signalling was a dedicated PDP context for SIP signalling as described in subclause B.2.2.1, the UE shall deactivate all PDP contexts established as a result of SIP signalling according to the 3GPP TS 24.008 [8].\nNOTE:\t3GPP TS 24.008 [8] specifies conditions that prevent the UE from sending an ACTIVATE (SECONDARY) PDP CONTEXT REQUEST message.\nIf all PDP contexts for the  were deactivated at the start of this subclause and the procedures in bullet B) of this subclause ensured that the PDP context used for SIP signalling is available and acquired the P-CSCF address(es), the UE shall perform a new initial registration according to subclause 5.1.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "A UE supporting the P-CSCF restoration procedure performs one of the following procedures:\nA.\tif the UE used method II for P-CSCF discovery and if the UE receives one or more P-CSCF address(es) in the Protocol Configuration Options information element of a MODIFY PDP CONTEXT REQUEST message and the one or more P-CSCF addresse(s) do not include the address of the currently used P-CSCF, then the UE shall acquire a different P-CSCF address from the one or more P-CSCF addresse(s) in the MODIFY PDP CONTEXT REQUEST message. If more than one P-CSCF address with the same container identifier (i.e. \"P-CSCF IPv6 Address\" or \"P-CSCF IPv4 Address\") are included, then the UE shall assume that the more than one P-CSCF addresses with the same container identifier are prioritised with the first P-CSCF address with the same container identifier within the Protocol Configuration Options information element as the P-CSCF address with the highest priority.\nIf the UE used method II for P-CSCF discovery and if the UE has previously sent the \"P-CSCF Re-selection support\"  indicator at PDP Context Activation and if the UE receives one or more P-CSCF address(es) in the Protocol Configuration Options information element of a MODIFY PDP CONTEXT REQUEST message, then the UE shall acquire a P-CSCF address from the one or more P-CSCF addresse(s) in the MODIFY PDP CONTEXT REQUEST message. If more than one P-CSCF address with the same container identifier (i.e. \"P-CSCF IPv6 Address\" or \"P-CSCF IPv4 Address\") are included, then the UE shall assume that the more than one P-CSCF addresses with the same container identifier are prioritised with the first P-CSCF address with the same container identifier within the Protocol Configuration Options information element as the P-CSCF address with the highest priority;\nB.\tif the UE uses RFC 6223 [143] as part of P-CSCF restoration procedures, and if the P-CSCF fails to respond to a keep-alive request, then the UE shall acquire a different P-CSCF address using one of the methods I, III and IV for P-CSCF discovery described in the subclause B.2.2.1.\nIf the UE has an ongoing session and acquired the new P-CSCF address by using procedure A described above, the UE may wait until the UE has detected that the ongoing session has ended before performing an initial registration as specified in subclause 5.1.\nIn all other cases, when the UE has acquired the P-CSCF address, the UE not having an ongoing session shall perform an initial registration as specified in subclause 5.1.\nNOTE 1:\tFor UEs using procedure A described above, the network ensures that P-CSCF address(es) in the Protocol Configuration Options information element of a MODIFY PDP CONTEXT REQUEST is sent only during P-CSCF restoration procedures as defined in subclause 5 of 3GPP TS 23.380 [7D].\nNOTE 2:\tThe P-CSCF can be completely unreachable, so it is up to UE implementation to detect the end of an ongoing session, e.g. using media plane inactivity detection. Services depending on signalling such as CW and MT calls will not work during this time.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.2.2\tSession management procedures",
                            "text_content": "The existing procedures for session management as described in 3GPP TS 24.008 [8] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.2.3\tMobility management procedures",
                            "text_content": "The existing procedures for mobility management as described in 3GPP TS 24.008 [8] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.2.4\tCell selection and lack of coverage",
                            "text_content": "The existing mechanisms and criteria for cell selection as described in 3GPP TS 25.304 [9] and 3GPP TS 44.018 [20] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.2.5\tPDP contexts for media",
                            "text_content": "The UE can establish media streams that belong to different SIP sessions on the same PDP context.\nDuring establishment of a session, the UE establishes data streams(s) for media related to the session. Such data stream(s) may result in activation of additional PDP context(s). Such additional PDP context(s) shall be established as secondary PDP contexts associated to the PDP context used for signalling. Such secondary PDP contexts for media can be established either by the UE or the core network.\nIf the bearer establishment is controlled by the UE, the UE starts reserving its local resources whenever it has sufficient information about the media streams, media authorization and used codecs available as specified in 3GPP TS 24.008 [8].\nNOTE 1:\tIf the bearer establishment is controlled by the GPRS IP-CAN, the resource reservation requests are initiated by the core network after the P-CSCF has authorised the respective IP flows and provided the QoS requirements over the Rx interface to the PCRF, as described in 3GPP TS 29.214 [13D].\nNOTE 2:\tWhen the UE has to allocate bandwidth for  and RTCP in a PDP context, the UE uses the rules as those outlined in 3GPP TS 29.213 [13C].\nIf the UE is configured not to initiate resource allocation for media according to 3GPP TS 24.167 [8G] and both UE and the core network are allowed to establish the secondary PDP contents, then the UE shall refrain from establishing the secondary PDP context(s) for media and from modifying existing PDP contexts for media until the UE considers that the network did not initiate resource allocation for the media.\nIf the UE receives indication within the SDP according to RFC 3524 [54] that media stream(s) belong to group(s), the media stream(s) shall be set up on separate PDP contexts according to the indication of grouping of media streams. The UE may freely group media streams to PDP context(s) in case no indication of grouping of media streams is received from the P-CSCF.\nIf the capabilities of the originating UE prevents it from establishment of additional PDP contexts according to the media grouping attributes given by the P-CSCF in accordance with RFC 3524 [54], the UE will not establish such grouping of media streams. Instead, the originating UE shall negotiate media parameters for the session according to RFC 3264 [27B].\nIf the capabilities of the terminating UE prevents it from establishment of additional PDP contexts according to the media grouping attributes given by the P-CSCF in accordance with RFC 3524 [54], the UE will not establish such grouping of media streams. Instead, the terminating UE shall the UE shall handle such SDP offers in accordance with RFC 3388 [53].\nThe UE can receive a media authorization token in the P-Media-Authorization header field from the P-CSCF according to RFC 3313 [31]. If a media authorization token is received in the P-Media-Authorization header field when a SIP session is initiated, the UE shall:\n-\teither use existing PDP context(s) where another media authorization token is already in use and no indication of grouping of media streams is required; or\n-\testablish separate PDP context(s) for the media; or\n-\tuse an existing PDP context where media authorization token is not in use and no indication of grouping of media streams is required.\nWhen a UE modifies a PDP context to indicate a new media authorization token:\n-\teither as a result of establishment of an additional SIP session; or\n-\tmodification of media streams for an ongoing SIP session;\nthe UE shall include all media authorization tokens and all flow identifiers for all ongoing SIP sessions that use this particular PDP context.\nIf a media authorization token is received in subsequent messages for the same SIP session, the UE shall:\n-\tuse the existing PDP context(s) for media;\n-\tmodify the existing PDP context(s) for media; or\n-\testablish additional PDP context(s) for media.\nIf either background or interactive QoS class is needed for the media, then the UE does not need to use the authorization token even if it receives one. In this case the UE may reuse an existing PDP context and it does not need to request PDP context modification unless it needs to modify the QoS.\nIf existing PDP context(s) where another media authorization token is already in use is re-used for the media, or separate PDP context(s) is established for the media, the UE shall proceed as follows:\n-\twhen a SIP session is terminated, the media authorization token is no longer valid and the UE shall not include it in future GPRS session management messages. The UE shall send a MODIFY PDP CONTEXT REQUEST message updating the binding information by deleting the media authorization token and the corresponding flow identifiers that are no longer valid. If a SIP session is terminated and no other SIP sessions are using the PDP context, the UE shall either update the binding information as described above or deactivate the PDP context;\n-\tthe UE shall transparently pass the media authorization token received from the P-CSCF in a response to an INVITE request at originating setup or in the INVITE request at terminating setup to the core network. The UE shall signal it by inserting it within the Traffic Flow Template information element in the ACTIVATE SECONDARY PDP CONTEXT REQUEST message or the MODIFY PDP CONTEXT REQUEST message;\n-\tto identify to the core network which flow(s) (identified by m-lines within the SDP) that are transferred within a particular PDP context, the UE shall set the flow identifier(s) within the Traffic Flow Template information element in the ACTIVATE SECONDARY PDP CONTEXT REQUEST message or the MODIFY PDP CONTEXT REQUEST message. Detailed description of how the flow identifiers are constructed is provided in 3GPP TS 29.207 [12];\n-\tif the UE receives several media authorization tokens from the P-CSCF within the same SIP request or response, the first instance of the media authorization token shall be sent to the core network, and subsequent instances are discarded by the UE; and\n-\tthe UE shall not include the IM CN Subsystem Signalling Flag when a PDP context for media is established or modified.\nThe encoding of the media authorization token and the flow identifiers within the Traffic Flow Template information element is described in 3GPP TS 24.008 [8].\nIf the UE receives an activation request for a PDP context which is associated with the PDP context used for signalling, the UE shall, based on the information contained in the Traffic Flow Template information element, correlate the media PDP context with a currently ongoing SIP session establishment or SIP session modification.\nIf the UE receives a modification request for a PDP context that is used for one or more media streams in an ongoing SIP session, the UE shall:\n1)\tmodify the related PDP context in accordance with the received modification request.\nWhen a data stream for media related to a session is released, if the PDP context transporting the data stream is no longer needed and if the PDP context has been activated by the UE, then the UE deactivates the PDP context.\nNOTE:\tThe PDP context can be needed e.g. for other data streams of a session or for other applications in the UE.\nNOTE 1:\tThe procedures in this subclause only apply when the UE requests activation and modification of media bearers. In the case where the core network activates and modifies the media bearers the network takes care of the handling of media bearers in the case of forking.\nSince the UE does not know that forking has occurred until a second, provisional response arrives, the UE sets up the PDP context(s) as required by the initial response received. If a subsequent provisional response is received, different alternative actions may be performed depending on the requirements in the SDP answer:\n1)\tthe bearer requirements of the subsequent SDP can be accommodated by the existing PDP context(s). The UE performs no activation or modification of PDP contexts.\n2)\tthe subsequent SDP introduces different QoS requirements or additional IP flows. The UE modifies the existing PDP context(s), if necessary, according to subclause B.2.2.5.1A.\n3)\tthe subsequent SDP introduces one or more additional IP flows. The UE establishes additional PDP context(s) according to subclause B.2.2.5.1A.\nNOTE 2: When several forked responses are received, the resources requested by the UE is are the \"logical OR\" of the resources indicated in the multiple responses to avoid allocation of unnecessary resources. The UE does not request more resources than proposed in the original INVITE request.\nNOTE 3: When service-based local policy is applied, the UE receives the same authorization token for all forked requests/responses related to the same SIP session.\nWhen a final answer is received for one of the early dialogs, the UE proceeds to set up the SIP session. The UE shall release all the unneeded radio/bearer resources. Therefore, upon the reception of the first final 200 (OK) response for the INVITE request (in addition to the procedures defined in RFC 3261 [26] subclause 13.2.2.4), the UE shall:\n1)\tin case PDP context(s) were established or modified as a consequence of the INVITE request and forked provisional responses that are not related to the accepted 200 (OK) response, delete the PDP context(s) or modify the delete the PDP context(s) back to their original state.\nOne of the Go, Gq, Rx and Gx interface related error codes can be received by the UE in the ACTIVATE SECONDARY PDP CONTEXT REJECT message or the MODIFY PDP CONTEXT REJECT message. If the UE receives a Go, Gq, Rx and Gx interface related error code, the UE shall either handle the resource reservation failure as described in subclause 6.1.1 or retransmit the message up to three times. The Go, Gq, Rx and Gx interface related error codes are further specified in 3GPP TS 29.207 [12], 3GPP TS 29.209 [13A], 3GPP TS 29.214 [13D] and 3GPP TS 29.212 [13B].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.2.6\tEmergency service",
                            "text_content": "Emergency bearers are defined for use in emergency calls in GPRS IP-CAN and core network support of these bearers is indicated to the UE in NAS signalling. Where the UE recognises that a call request is an emergency call and the core network supports emergency bearers, the UE shall use these bearers for both signalling and media on emergency calls made using the IM CN subsystem.\nSome jurisdictions allow emergency calls to be made when the UE does not contain an ISIM or USIM, or where the credentials are not accepted. Additionally, where the UE is in state GMM-REGISTERED.LIMITED-SERVICE and GMM-REGISTERED.PLMN-SEARCH, a normal ATTACH has been attempted but it can also be assumed that a registration in the IM CN subsystem will also fail. In such cases, subject to the lower layers indicating that the network does support emergency bearer services in limited service state (see 3GPP TS 25.331 [9A]), the procedures for emergency calls without registration can be applied, as defined in subclause 5.1.6.8.2. If the GPRS authentication procedure has already succeeded during the latest normal or emergency ATTACH procedure, the UE shall perform an initial emergency registration, as described in subclause 5.1.6.2 before attempting an emergency call as described in subclause 5.1.6.8.3.\nNOTE 1:\tThe UE can determine that GPRS authentication procedure has succeeded during the emergency ATTACH procedure when an integrity protection algorithm is received in the RRC signalling SECURITY MODE COMMAND message (see 3GPP TS 25.331 [9A]).\nWhen activating a PDP context to perform emergency registration, the UE shall request a PDP context for emergency bearer services as defined in 3GPP TS 24.008 [8]. The procedures for PDP context activation and P-CSCF discovery, as described in subclause B.2.2.1 of this specification apply accordingly.\nIn order to find out whether the UE is attached to the home PLMN or to the visited PLMN, the UE shall compare the  and  values derived from its  with the  and  of the PLMN the UE is attached to. If the  and  of the PLMN the UE is attached to donot match with the  and  derived from the , then for the purpose of emergency calls in the IM CN subsystem the UE shall consider to be attached to a VPLMN.\nNOTE 2:\tIn this respect an equivalent HPLMN, as defined in 3GPP TS 23.122 [4C] will be considered as a visited network.\nIf the dialled number is equal to an emergency number stored in the ME, in the USIM or in the Local Emergency Number List (as defined in 3GPP TS 24.008 [8]), then the UE shall recognize a number as for an emergency call and performs the procedures in subclause B.2.2.6.1A.\nNOTE 3:\tThe Extended Local Emergency Numbers List (see 3GPP TS 24.301 [8J]) does not apply in this IP-CAN.\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.2A.1.1 and subclause 5.1.3.1, if:\n-\tthe 380 (Alternate Service) response contains a Contact header field;\n-\tthe value of the Contact header field is a service URN; and\n-\tthe service URN has a top-level service type of \"sos\";\nthen the UE determines that \"emergency service information is included\" as described 3GPP TS 23.167 [4B].\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.3.1 if the 380 (Alternate Service) response does not contain a Contact header field with service URN that has a top-level service type of \"sos\", then the UE determines that \"no emergency service information is included\" as described 3GPP TS 23.167 [4B].\nIf the \"emergency service information is included\" as described 3GPP TS 23.167 [4B]:\n1)\tif the URN in the Contact header field matches an emergency service URN in table B.2.2.6.1, then the type of emergency service is the value corresponding to the matching entry in table B.2.2.6.1; and\n2)\tif the URN in the Contact header field does not match any emergency service URN in table B.2.2.6.1, then the type of emergency service is not identified.\nNOTE 4:\tIn bullet 2), the URN in the Contact header field either contains \"no emergency subservice type\" as described in 3GPP TS 23.167 [4B] triggering an emergency call, or contains an \"emergency subservice type that does not map into an emergency service category for the CS domain\" as described in 3GPP TS 23.167 [4B] triggering a normal call when the dialled number is available or triggering an emergency call when the dialled number is not available. The country specific URN is an example of a \"emergency subservice type that does not map into an emergency service category for the CS domain\".\nWhen the emergency registration expires, the UE should disconnect the PDP context for emergency bearer services as defined in 3GPP TS 24.008 [8].\nUpon receiving a 3xx other than 380 (Alternative service), 4xx, 5xx or 6xx response to an INVITE request for a UE detectable emergency call, the UE shall perform domain selection as specified in 3GPP TS 23.167 [4B] annex H, to re-attempt the emergency call.\nThe type of emergency service for an emergency number is derived from the settings of the emergency service category value (bits 1 to 5 of the emergency service category value as specified in subclause 10.5.4.33 of 3GPP TS 24.008 [8]). Table B.2.2.6.1 below specifies mappings between a type of emergency service and an emergency service URN. The UE shall use the mapping to match an emergency service URN and a type of emergency service. If a dialled number is an emergency number but does not map to a type of emergency service the service URN shall be \"urn:service:sos\".\nTable B.2.2.6.1: Mapping between type of emergency service and emergency service URN\n\nNOTE 1:\tIt is not possible for a UE to indicate more than one type of emergency service in an emergency service URN.\nIf an IP-CAN, capable of providing local emergency numbers, did not provide a local emergency number that matches the dialled number (see subclause 5.1.6.1) and multiple types of emergency service can be derived for a dialled number from the information configured on the USIM then:\n-\tif the UE is in the HPLMN, the UE shall map any one of these types of emergency service to an emergency service URN as specified in table B.2.2.6.1; and\n-\tif the UE is in the VPLMN, the UE shall select \"urn:service:sos\".\nNOTE 2:\tIf the Non-3GPP emergency number indicator within the Non-3GPP NW provided policies IE (see 3GPP TS 24.008 [8]) provided through registration procedures over 3GPP access is set to \"use of non-3GPP emergency numbers permitted\", the UE also considers WLAN provided local emergency numbers (see 3GPP TS 24.302 [8U], subclause 4.7). If the Non-3GPP NW provided policies IE provided through registration procedures over 3GPP access is set to \"use of non-3GPP emergency numbers not permitted\", the UE does not consider WLAN provided local emergency numbers. If the Non-3GPP NW provided policies IE is not provided through registration procedures over 3GPP access, the UE does not consider WLAN provided local emergency numbers.\nIf an IP-CAN, capable of providing local emergency numbers, provided a local emergency number that matches the dialled number (see subclause 5.1.6.1), and:\n-\tif the UE can derive one or more types of emergency service from the information received from the IP-CAN for the dialled number and the UE cannot derive types of emergency service from the information configured on the USIM for the dialled number; or\n-\tif the UE is able to derive identical types of emergency service from both the information received from the IP-CAN for the dialled number and from the information configured on the USIM for the dialled number,\nthen the UE shall map any one of these emergency service types to an emergency service URN as specified in table B.2.2.6.1.\nNOTE 3:\tHow the UE resolves clashes where an emergency number is associated with one or more different types of emergency service configured in the USIM and in information received from the core network, is implementation dependent.\nVoid\nThe UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table B.2.2.6.1: Mapping between type of emergency service and emergency service URN",
                                    "table number": 468,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "B.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "NOTE:\tWhen:\n-\testablishing a session which is not an emergency session; or\n-\tmodifying a session which is not an emergency session;\nand if the IMSVoPS indicator is received in the \"Network feature support\" Information Element (see 3GPP TS 24.008 [8]), the UE constructs SDP based on the restrictions indicated in the IMSVoPS indicator. Regardless whether the IMSVoPS indicator indicating voice is supported or not, m-lines can be set to \"audio\" and exclude voice codecs from the SDP answer or SDP offer.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2A.1\tImpact on SDP offer / answer of activation or modification of PDP contexts for media by the core network",
                    "description": "",
                    "summary": "",
                    "text_content": "If due to the activation of PDP context from the core network the related SDP media description needs to be changed the UE shall update the related SDP information by sending, within a SIP request, a new SDP offer for each of the existing SIP dialogs,\nIf the UE receives a modification request from the core network for a PDP context that is used for one or more media streams in an ongoing SIP session, the UE shall:\n1)\tif, due to the modification of the PDP context, the related SDP media description need to be changed, update the related SDP information by sending, with in a SIP request, a new SDP offer for each of the existing SIP dialogs , and respond to the PDP context modification request.\nNOTE:\tThe UE can decide to indicate additional media streams as well as additional or different codecs in the SDP offer than those used in the already ongoing session.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "If the UE receives an SDP offer where the SDP offer includes all media streams for which the originating side indicated its local preconditions as met, if the precondition mechanism is supported by the terminating UE and the IP-CAN performs network-initiated resource reservation for the terminating UE and the available resources are not sufficient for the received offer the terminating UE shall indicate its local preconditions and provide the SDP answer to the originating side without waiting for resource reservation.\nNOTE 1:\tIf the resource reservation is controlled by the GPRS IP-CAN, the resource reservation request is initiated by the core network after the P-CSCF has authorised the respective IP flows and provided the QoS requirements over the Rx interface to the PCRF as described in 3GPP TS 29.214 [13D].\nNOTE 2:\tDuring the PDP context activation procedure the UE and the core network negotiate whether the UE or the GPRS IP-CAN is responsible for the resource reservation applicable to all PDP contexts within the activated PDP address/ pair as described in 3GPP TS 24.008 [8].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "NOTE:\tWhen establishing an emergency session or when modifying an emergency session, the IMSVoPS indicator does not influence handling of SDP offer and SDP answer.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "B.3.1.0\tRegistration and authentication",
                            "text_content": "The UE shall perform reregistration of a previously registered public user identity bound to any one of its contact addresses when changing to an IP-CAN for which usage is specified in annex R. The reregistration is performed using the new IP-CAN.\nNOTE 1:\tThis document does not specify how the UE detects that the used IP-CAN has changed. The information that is forcing the reregistration is also used to generate the content for the P-Access-Network-Info header field.\nNOTE 2:\tThe UE will send the reregistration irrespective of whether it has a SIP dialog or not.\nIf the UE supports the 3GPP PS data off, then the UE shall in all REGISTER requests include the \"+g.3gpp.ps-data-off\" header field parameter defined in subclause 7.9.8 set to a value indicating the 3GPP PS data off status.\nWhen the UE sends a REGISTER request, if the 3GPP PS data off status is \"active\", then the UE shall only include media feature tags associated with services that are 3GPP PS data off exempt services in the g.3gpp.icsi-ref media feature tag, as defined in subclause 7.9.2 and RFC 3840 [62], for the IMS communication services it intends to use.\nIf the UE is registered, and the 3GPP PS data off status is changed or the UE is provided by the network with a new list of 3GPP PS data off exempt services while the 3GPP PS data off status is \"active\", then the UE shall perform a reregistration of the previously registered public user identity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "The IMS_Registration_handling policy indicates whether the UE deregisters from IMS after a configured amount of time after receiving an indication that the IMS Voice over PS Session is not supported.\nThe UE may support the IMS_Registration_handling policy.\nIf the UE supports the IMS_Registration_handling policy, the UE may support being configured with the IMS_Registration_handling policy using one or more of the following methods:\na)\tthe IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe IMS_Registration_Policy node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the IMS_Registration_Policy node of 3GPP TS 24.167 [8G] and the IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the IMS_Registration_Policy node of the EFIMSConfigData file shall take precedence.\nNOTE 1:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nIf the UE is registered with IMS and the IMSVoPS indicator, provided by the lower layers (see 3GPP TS 24.301 [8J]), indicates voice is not supported, the UE shall:\nA)\tif the Stay_Registered_When_VoPS_Not_Supported leaf indicates requirement to stay registered, the UE needs not to deregister and maintains the registration as required for IMS services; or\nNOTE 2:\tThe UE will periodically refresh the registration when needed.\nB)\tif the Stay_Registered_When_VoPS_Not_Supported leaf indicates requirement to deregister and the Deregistration_Timer leaf used to configure the NoVoPS-dereg timer defined in table 7.8.1 contains a timer value for the time to wait before deregistrerting from IMS, start a timer with the value indicated in the policy and:\na)\tif the timer expires before the UE receives an indication from the lower layers that IMS voice is supported:\n1)\tif there is no ongoing IMS session, either performs reregistration as specified in subclause 5.1.1.4 and shall only include feature tags associated with services that are independent of the IMSVoPS indicator or deregister from the IMS following the procedures specified in subclause 5.1.1.6; or\n2)\tif there is ongoing IMS session, and\ni)\tif the UE does not receive indication from the lower layer that the IMS voice is supported before the ongoing IMS session is terminated, either performs reregistration as specified in subclause 5.1.1.4 and shall only include feature tags associated with services that are independent of IMSVoPS indicator or deregister from the IMS following the procedures specified in subclause 5.1.1.6 as soon as the ongoing IMS based service is terminated ; or\nii)\tif the UE receives indication from the lower layer that the IMS voice is supported before the ongoing IMS session is terminated, cancel the timer; or\nNOTE 3:\tHow the UE selects reregistration or deregistration is implementation dependent (e.g., SMS service)\nb)\tif the UE receives an indication from the lower layers that IMS voice is supported before the timer expires, cancel the timer.\nIf the IMS_Registration_handling policy is not configured, the UE behaviour is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The UE shall always include the P-Access-Network-Info header field where indicated in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.2\tAvailability for calls",
                            "text_content": "The UE indicates to the non-access stratum the status of being available for voice over PS when:\n1)\tthe UE is capable of receiving any (but not necessarily all) of the media types which the CS domain supports, such that the media type can also be used when accessing the IM CN subsystem using the current IP-CAN;\n2)\tif the media type of item 1 is an \"audio\" media type, the UE supports codecs suitable for (conversational) speech, the \"audio\" media type is not restricted from inclusion in an SDP message according to the media type restriction policy as specified in subclause 6.1.1, and:\na)\t3GPP PS data off status is \"inactive\";\nb)\t3GPP PS data off status is \"active\", the UE is in the HPLMN or the EHPLMN, and MMTEL voice is a 3GPP PS data off exempt service; or\nc)\t3GPP PS data off status is \"active\", the UE is in the VPLMN, the UE is configured with an indication that MMTEL voice is a 3GPP PS data off exempt service in a VPLMN, and MMTEL voice is a 3GPP PS data off roaming exempt service; and\n3)\tthe UE determines a contact has been bound to a public user identity using the IP-CAN, such that this contact is expected to be used for the delivery of incoming requests in the IM CN subsystem relating to such media.\nThe UE indicates to the non-access stratum the status of being not available for voice over PS when these conditions are no longer met.\nNOTE:\tThe status of being not available for voice over PS is used for domain selection for UE originating sessions / calls specified in 3GPP TS 23.221 [6] subclause 7.2a.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.2A\tAvailability for SMS",
                            "text_content": "The UE determines that the UE is able to use SMS using IMS if the UE:\nI)\tis capable of using the MIME type \"application/vnd.3gpp.sms\" (see 3GPP TS 24.341 [8L]), such that the MIME type can also be used when accessing the IM CN subsystem using the current IP-CAN;\nII)\tsupports the role of an SM-over-IP sender (see 3GPP TS 24.341 [8L]);\nIIA)\tdetermines the PDP context used for SIP signalling exists;\nIII)\tdetermines a contact has been bound to a public user identity using the IP-CAN, such that this contact is expected to be used for the delivery of incoming requests in the IM CN subsystem relating to such media;\nIV)\tthe UE does not determine that SMS over IP is restricted in 3GPP TS 24.341 [8L] subclause 5.2.1.3; and\nV)\tthe 3GPP PS data off status is:\n-\t\"inactive\";\n-\t\"active\", the UE is in the HPLMN or the EHPLMN, and SMS over IMS is a 3GPP PS data off exempt service; or\n-\t\"active\", the UE is in the VPLMN, the UE is configured with an indication that SMS over IMS is a 3GPP PS data off exempt service in a VPLMN, and SMS over IMS is a 3GPP PS data off roaming exempt service.\nWhen above criteria are not matched, the UE determines that SMS using IMS is unavailable.\nNOTE:\tThe status that SMS using IMS is unavailable is used for domain selection for UE originating SMS specified in 3GPP TS 23.221 [6] subclause 7.2c.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.3\tAuthorization header field",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Upon receiving an INVITE request not including the \"precondition\" option-tag in the Supported header field and not including the \"precondition\" option-tag in the Require header field, and the IP-CAN performs network-initiated resource reservation for the UE, the UE:\n1)\tif the INVITE request contains an SDP offer and the local resources required at the terminating UE for the received SDP offer are not available:\na)\tshall not alert the user; and\nb)\tshall send 183 (Session Progress) response to the INVITE request without waiting for resource reservation and without alerting the user. If the INVITE request includes a Supported header field indicating support of reliable provisional responses, the UE shall send the 183 (Session Progress) response reliably. In the 183 (Session Progres) response, the UE shall include an SDP answer; and\n2)\tif the INVITE request does not contain an SDP offer and the INVITE request includes a Supported header field indicating support of reliable provisional responses:\na)\tshall generate an SDP offer; and\nb)\tif the local resources required at the terminating UE for the generated SDP offer are not available:\nA)\tshall not alert the user; and\nB)\tshall reliably send 183 (Session Progress) response to the INVITE request without waiting for resource reservation and without alerting the user. In the 183 (Session Progres) response, the UE shall include the generated SDP offer.\nUpon successful reservation of local resources, if the precondition mechanism is not used by the terminating UE, the UE can send 180 (Ringing) response to the INVITE request and can alert the user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.5\t3GPP PS data off",
                            "text_content": "If the 3GPP PS data off status is \"active\" the UE shall only send initial requests that:\n1)\tare associated with a 3GPP IMS service which enforces 3GPP PS data off;\nNOTE:\tThese services are specified in 3GPP TS 22.011 [1C], and enforcement of 3GPP PS data off is described in the respective service specifications.\n2)\tare associated with an emergency service; or\n3)\tare associated with 3GPP PS data off exempt services configured in the UE using one or more of the following methods:\n-\tthe non_3GPP_ICSIs_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G] is not configured;\n-\tthe non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the VPLMN;\n-\tthe non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] is not configured; or\n-\tthe non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the VPLMN.\nIf the UE is configured with both the non_3GPP_ICSIs_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\nIf the UE is configured with both the non_3GPP_ICSIs_roaming_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\nIf the 3GPP PS data off status changes from \"inactive\" to \"active\" the UE shall release all dialogs that\n1)\tare not associated with a 3GPP IMS service which enforces 3GPP PS data off;\nNOTE:\tThese services are specified in 3GPP TS 22.011 [1C], and enforcement of 3GPP PS data off is described in the respective service specifications.\n2)\tare not associated with an emergency service; and\n3)\tare not associated with 3GPP data off exempt services configured in the UE using one or more of the following methods:\n-\tthe non_3GPP_ICSIs_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G] is not configured;\n-\tthe non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the VPLMN;-\tthe non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] is not configured; or\n-\tthe non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the VPLMN.\nIf the UE is configured with both the non_3GPP_ICSIs_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\nIf the UE is configured with both the non_3GPP_ICSIs_roaming_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.6\tTransport mechanisms",
                            "text_content": "No additional requirements are defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.1.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "B.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "B.3.2.0\tRegistration and authentication",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "In order to determine from which network the request was originated the P-CSCF shall check the  and  fields received in the P-Access-Network-Info header field.\nNOTE:\tThe above check can be against more than one  code stored in the P-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.2.2\tLocation information handling",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.2.3\tProhibited usage of PDN connection for emergency bearer services",
                            "text_content": "If the P-CSCF detects that a UE uses a PDN connection for emergency bearer services for a non-emergency REGISTER request, the P-CSCF shall reject that request by a 403 (Forbidden) response.\nNOTE:\tBy assigning specific IP address ranges for a PDN connection for emergency bearer services and configuring those ranges in P-CSCF, the P-CSCF can detect based on the registered Contact address if UE uses an emergency PDN connection for initial registration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.2.6\tResource sharing",
                            "text_content": "If P-CSCF supports resource sharing,  is supported for this access technology and if according to local policy, the P-CSCF shall apply the procedures in subclause L.3.2.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.2.7\tPriority sharing",
                            "text_content": "If P-CSCF supports priority sharing,  is supported for this access technology and if according to operator policy, the P-CSCF shall apply the procedures in subclause L.3.2.7.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.2.8\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "B.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "B.3.3.1\tNotification of AS about registration status",
                            "text_content": "Not applicable\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "B.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.5\tUse of circuit-switched domain",
            "description": "When an emergency call is to be set up over the CS domain, the UE shall attempt it according to the procedures described in 3GPP TS 24.008 [8].\nNOTE:\t3GPP TS 24.301 [8J] specifies additional requirements for the UE in determining the type of setup message the UE sends to the network when an emergency call is to be set up over the CS domain.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.1\tScope",
            "description": "This clause describes the UICC and USIM aspects for access to the IM CN subsystem. Additional requirements related to UICC usage for access to the IM CN subsystem are described in 3GPP TS 33.203 [19].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.2\tDerivation of IMS parameters from USIM",
            "description": "In case the UE is loaded with a UICC that contains a USIM but does not contain an ISIM, the UE shall:\n-\tgenerate a private user identity;\n-\tgenerate a temporary public user identity; and\n-\tgenerate a home network domain name to address the SIP REGISTER request to.\nAll these three parameters are derived from the  parameter in the USIM, according to the procedures described in 3GPP TS 23.003 [3]. Also in this case, the UE shall derive new values every time the UICC is changed, and shall discard existing values if the UICC is removed.\nNOTE:\tIf there is an ISIM and a USIM on a UICC, the ISIM is used for authentication to the IM CN subsystem, as described in 3GPP TS 33.203 [19]. See also subclause 5.1.1.1A.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.3\tISIM Location in 3GPP Systems",
            "description": "For 3GPP systems, if ISIM is present, it is contained in UICC.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.3A\tUICC access to IMS",
            "description": "If the UE supports the UICC access to IMS USAT feature defined in 3GPP TS 31.111 [15D] the following procedures in addition to the UE procedures in this specification apply.\nIf the EFUICCIARI contains a list of IARIs associated with active applications installed on the UICC in either the USIM or the ISIM, then when performing the user-initiated registration procedure as described in subclause 5.1.1.2 the UE shall include in the REGISTER request the list of IARIs associated with active applications installed on the UICC in addition to any IARI values for active applications installed on the ME in g.3gpp.iari-ref media feature tag(s) in the Contact header field of the REGISTER request as defined in subclause 7.9.3 and RFC 3840 [62].\nIf the UE receives from the UICC an initial request for a dialog or a standalone transaction then after decapsulating the request as specified in 3GPP TS 31.111 [15D] the UE shall send the request to the IM CN subsystem as specified in subclause 5.1.2A. When the UE receives from the UICC subsequent requests or responses related to dialogs or transactions already established for UICC applications then after decapsulating the request or response as specified in 3GPP TS 31.111 [15D] the UE shall send the request or response to the IM CN subsystem as specified in subclause 5.1.2A.\nNOTE:\tThe encapsulated requests and responses transferred between the UICC and UE are complete and valid SIP requests and responses compliant with RFC 3261 [26].\nWhen sending requests or responses received from the UICC to the IM CN subsystem the UE shall modify or include any header fields necessary (such as Route, Via, Contact) in order to conform with the procedures in this specification.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.4\tUpdate of IMS parameters on the UICC",
            "description": "3GPP TS 31.102 [15C] and 3GPP TS 31.103 [15B] specify the file structure and contents for the preconfigured parameters stored on the USIM and ISIM, respectively, necessary to initiate the registration to the IM CN subsystem. Any of these parameters can be updated via Data Download or a USAT application, as described in 3GPP TS 31.111 [15D]. If one ore more EFs are changed and a REFRESH command is issued by the UICC, then the UE reads the updated parameters from the UICC as specified for the REFRESH command in 3GPP TS 31.111 [15D].\nIf the UE supports the UICC access to IMS USAT feature defined in 3GPP TS 31.111 [15D] and the EFUICCIARI changes in either the USIM or the ISIM, the UE shall perform the user-initiated reregistration procedure as described in subclause 5.1.1.4 with the new values of the IARI parameter(s) residing on the UICC.\nIn case of changes to EFs other than the EFUICCIARI, the UE is not required to perform deregistration but it shall wait for the network-initated deregistration procedures to occur as described in subclause 5.4.1.5 unless the user initiates deregistration procedures as described in subclause 5.1.1.6. From this point onwards the normal initial registration procedures can occur.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is xDSL, Fiber or Ethernet.\nNOTE:\tFixed-broadband access in this Annex refers to xDSL, Fiber and Ethernet accesses.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.2\tFixed broadband aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "E.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by the fixed-broadband access network to provide packet-mode communication between the UE and the IM CN subsystem.\nRequirements for the IP Edge node, defined in ETSI ES 282 001 [138]in support of this communication are outside the scope of this document and specified elsewhere.\nFrom the UEs perspective, it is assumed that one or more IP-CAN bearer(s) are provided, in the form of connection(s) managed by the layer 2 (e.g.  modem supporting the UE).\nIn the first instance, it is assumed that the IP-CAN bearer(s) is (are) statically provisioned between the UE and the IP Edge node, defined in ETSI ES 282 001 [138], according to the user's subscription.\nIt is out of the scope of the current Release to specify whether a single IP-CAN bearer is used to convey both signalling and media flows, or whether several PVC connections are used to isolate various types of IP flows (signalling flows, conversational media, non conversational media…).\nThe end-to-end characteristics of the fixed-broadband IP-CAN bearer depend on the type of access network, and on network configuration. The description of the network PVC termination (e.g., located in the DSLAM, in the BRAS…) is out of the scope of this annex.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "E.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "E.2.2.1\tActivation and P-CSCF discovery",
                            "text_content": "Fixed-broadband bearer(s) is (are) statically provisioned in the current Release.\nUnless a static IP address is allocated to the UE, prior to communication with the IM CN subsystem, the UE shall perform a Network Attachment procedure depending on the used fixed-broadband access type. When using a fixed-broadband access, both IPv4 and IPv6 UEs may access the IM CN subsystem. The UE may request a DNS Server IPv4 address(es) via RFC 2132 [20F] or a DNS Server IPv6 address(es) via RFC 3315 [40].\nThe methods for P-CSCF discovery are:\nI.\tWhen using IPv4, employ the Dynamic Host Configuration Protocol (DHCP) RFC 2132 [20F], the DHCPv4 options for SIP servers RFC 3361 [35A], and RFC 3263 [27A] as described in subclause 9.2.1. When using IPv6, employ Dynamic Host Configuration Protocol for IPv6 (DHCPv6) RFC 3315 [40], the DHCPv6 options for SIP servers RFC 3319 [41] and DHCPv6 options for Domain Name Servers (DNS) RFC 3646 [56C] as described in subclause 9.2.1. In case the DHCP server provides several P-CSCF addresses or FQDNs to the UE, the UE shall select the P-CSCF address or FQDN as indicated in RFC 3319 [41]. If sufficient information for P-CSCF address selection is not available, selection of the P-CSCF address by the UE is implementation specific.\nII.\tThe UE selects a P-CSCF from the list in the IMS management object as specified in 3GPP TS 24.167 [8G].\nThe UE shall use method II to select a P-CSCF if the IMS management object contains the P-CSCF list. Otherwise, the UE shall use method I to select a P-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.2.2.1A\tModification of a fixed-broadband connection used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.2.2.1B\tRe-establishment of a fixed-broadband connection used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "A UE supporting the P-CSCF restoration procedure uses the keep-alive procedures described in RFC 6223 [143].\nIf the P-CSCF fails to respond to keep-alive requests the UE shall acquire a different P-CSCF address using any of the methods described in the subclause E.2.2.1 and perform an initial registration as specified in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.2.2.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.2.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.2.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.2.2.5\tFixed-broadband bearer(s) for media",
                            "text_content": "The UE can establish media streams that belong to different SIP sessions on the same fixed-broadband bearer.\nIf the UE receives indication within the SDP according to RFC 3524 [54] that media stream(s) belong to group(s), and if several fixed-broadband bearers are available to the UE for the session, the media stream(s) may be sent on separate fixed-broadband bearers according to the indication of grouping. The UE may freely group media streams to fixed-broadband bearers in case no indication of grouping is received from the P-CSCF.\nIf the UE receives media grouping attributes in accordance with RFC 3524 [54] that it cannot provide within the available fixed-broadband bearer(s), then the UE shall handle such SDP offers in accordance with RFC 3388 [53].\nThe UE can receive a media authorization token in the P-Media-Authorization header field from the P-CSCF according to RFC 3313 [31]. If a media authorization token is received in the P-Media-Authorization header field when a SIP session is initiated, the UE shall reuse the existing fixed-broadband bearer(s) and ignore the media authorization token.\nNot applicable.\nNot applicable.\nSince the UE is unable to perform bearer modification, forked responses place no special requirements on the UE.\nNot applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.2.2.6\tEmergency service",
                            "text_content": "If attached to network via fixed-broadband access technology, the UE shall always consider being attached to its home operator's network for the purpose of emergency calls.\nNOTE:\tIn fixed-broadband the UE is unable to receive any indication from the network, that would allow the UE to determine, whether it is currently attached to its home operator's network or to a different network, so the UE assumes itself always attached to the home operator's network when connected via fixed-broadband access technology.\nNot applicable.\nNot applicable.\nThe UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "E.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "E.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "E.2A.1\tImpact on SDP offer / answer of activation or modification of xDSL bearer for media by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "E.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "E.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "No additional procedures defined.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "E.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "E.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "E.3.1.0\tRegistration and authentication",
                            "text_content": "In order to reach IMS in some access networks, the UE may support:\n-\taddress and/or port number conversions provided by a (P)T or (P)T-PT as described in annex F and annex K; and\n-\tUE requested FTT-IMS establishment procedure specified in 3GPP TS 24.322 [8Y].\nIf a UE supports one or both of these capabilities then a UE may progressively try them to overcome failure to reach the IMS. Use of these capabilities shall have the following priority order:\n1)\tUE uses neither capability because reaching the IMS without an intervening (P)T, (P)T-PT, or tunnel is preferred.\n2)\tUE may use address and/or port number conversions provided by a (P)T or (P)T-PT as described in either annex F or annex K.\n3)\tUE may use the UE requested FTT-IMS establishment procedure specified in 3GPP TS 24.322 [8Y]. If the UE uses the UE-requested FTT-IMS establishment procedure specified in 3GPP TS 24.322 [8Y], the UE considers itself to:\n-\tbe configured to send keep-alives;\n-\tbe directly connected to an IP-CAN for which usage of  is defined; and\n-\tbe behind a .\nOptional procedures apply when the UE is supporting traversal of restrictive non-3GPP access network using STUN/TURN/ICE, as follows:\na)\tthe protection of SIP messages is provided by utilizing  as defined in 3GPP TS 33.203 [19];\nb)\tthe mechanisms specified in this annex shall only be applicable when the IP traffic to the IMS core does not traverse through the Evolved Packet Core ();\nc)\tthe UE shall establish the  connection to the P-CSCF on port 443 as defined in 3GPP TS 33.203 [19]. The UE shall use SIP digest with  for registration as specified in subclause 5.1. If the  connection is established successfully, the UE sends SIP signalling over the  connection to the P-CSCF;\nd)\tthe UE shall support the keep-alive procedures described in RFC 6223 [143];\nNOTE 1:\tIf the UE is configured to use an HTTP proxy, the UE use the HTTP CONNECT method specified in RFC 2817 [220] to request the HTTP proxy to establish the  connection with the P-CSCF. Once the UE has received a positive reply from the proxy that the  connection has been established, the UE initiates the  handshake with the P-CSCF and establishes the  connection.\ne)\tthe procedures described in subclause K.5.2 apply with the additional procedures described in the present subclause;\nf)\twhen using the ICE procedures for traversal of restrictive non-3GPP access network, the UE shall support the ICE  as specified in RFC 6544 [131] and TURN  as specified in RFC 6062 [221].\ng)\tif the UE is configured to use TURN over  on port 80, the UE shall establish the  connection to TURN server on port 80. If the UE is configured to use TURN over  on port 443, the UE shall establish the  connection to the TURN server on port 443 as defined in 3GPP TS 33.203 [19]. If the UE is configured to use both, the UE should prefer to use TURN over  on port 80 to avoid  overhead;\nh)\tif the connection is established successfully, the UE sends TURN control messages and media packets over the connection as defined in RFC 5766 [101].\nNOTE 2:\tIf the UE is configured to use an HTTP proxy, the UE use the HTTP CONNECT method specified in RFC 2817 [220] to request the HTTP proxy to establish the  connection with the TURN server. Then, if the UE is configured to use TURN over  on port 443 and the UE has received a positive reply from the proxy that the  connection has been established, the UE initiates the  handshake with the TURN server and establishes the  connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The UE may, but need not, include the P-Access-Network-Info header field where indicated in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.2\tAvailability for calls",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.2A\tAvailability for SMS",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.3\tAuthorization header field",
                            "text_content": "When using SIP digest or SIP digest without , the UE need not include an Authorization header field on sending a REGISTER request, as defined in subclause 5.1.1.2.1.\nNOTE:\tIn case the Authorization header field is absent, the mechanism only supports that one public user identity is associated with only one private user identity. The public user identity is set so that it is possible to derive the private user identity from the public user identity by removing SIP  scheme and the following parts of the SIP  if present: port number,  parameters, and To header field parameters. Therefore, the public user identity used for registration in this case cannot be shared across multiple UEs. Deployment scenarios that require public user identities to be shared across multiple UEs that don't include an private user identity in the initial REGISTER request can be supported as follows:\n- Assign each sharing UE a unique public user identity to be used for registration,\n- Assign the shared public user identitiess to the implicit registration set of the unique registering public user identities assigned to each sharing UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.5\t3GPP PS data off",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.6\tTransport mechanisms",
                            "text_content": "No additional requirements are defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.1.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "E.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "E.3.2.0\tRegistration and authentication",
                            "text_content": "The P-CSCF may support UEs connected via restrictive non-3GPP access network.\nIf the P-CSCF supports UEs connected via restrictive non-3GPP access network, when the P-CSCF receives a 200 (OK) response to a REGISTER request, if the contact address of REGISTER request contains an IP address assigned by the EFTF, and the UE's Via header field contains a \"keep\" header field parameter, then the P-CSCF shall add a value to the \"keep\" header field parameter of the UE's Via header field of the 200 (OK) response as defined in RFC 6223 [143].\nOptional procedures apply when the P-CSCF is supporting traversal of restrictive non-3GPP access network using STUN/TURN/ICE, as follows:\nNOTE:\tIn this scenario, the restrictive non-3GPP access network coexists with (P)T device located in the customer premises domain:\na)\tthe protection of SIP messages is provided by utilizing  as defined in 3GPP TS 33.203 [19];\nb)\tthe P-CSCF supporting these additional procedures should use SIP digest with  as defined in subclause 5 and the P-CSCF should inserts an IMS- on the media plane;\nc)\tthe mechanisms specified in this annex shall only be applicable when the IP traffic to the IMS core does not traverse through the Evolved Packet Core ();\nd)\tthe P-CSCF shall support the procedures defined in subclause 5.2, with the exception that the P-CSCF shall use SIP over  on port 443 as defined in 3GPP TS 33.203 [19];\ne)\twhen the UE has indicated support of the keep-alive mechanism defined in RFC 6223 [143], the P-CSCF shall indicate to the UE that it supports the keep-alive mechanism; and\nf)\tthe IMS- in the P-CSCF shall support ICE procedures, as defined in subclause 6.7.2.7.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "In order to determine from which network the request was originated the P-CSCF shall check if the location information received in the network provided and/or UE provided \"dsl-location\", \"eth-location\" or \"fiber-location\" parameter in the P-Access-Network-Info header field(s) belongs to a location in the same country.\nNOTE 1:\tIf local policy does not require the insertion of P-Access-Network-Info header field in the P-CSCF even if it is missing in the received initial request, the P-CSCF can assume that the request is initiated by fixed broadband UE in the same country.\nNOTE 2:\tIf the location information in the network provided and UE provided \"dsl-location\", \"eth-location\" or \"fiber-location\" parameters (in a request that includes two P-Access-Network-Info header fields) is contradictory, or the two P-Access-Network-Info header fields indicate different access types the P-CSCF ignores either the network provided or the UE provided information according to operator policy.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.2.2\tLocation information handling",
                            "text_content": "Upon receipt of an initial request for a dialog or standalone transaction or an unknown method, the P-CSCF based on local policy may include a P-Access-Network-Info header field.The value of the \"dsl-location\", \"eth-location\" or \"fiber-location\" parameter shall be the value as received in the Location-Information header in the User-Data Answer command as specified in ETSI ES 283 035 [98].\nNOTE:\tThe way the P-CSCF deduce that the request comes from a UE connected through xDSL access is implementation dependent.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.2.6\tResource sharing",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.2.7\tPriority sharing",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.2.8\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "E.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "E.3.3.1\tNotification of AS about registration status",
                            "text_content": "Not applicable\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "E.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "E.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "E.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "E.5\tUse of circuit-switched domain",
            "description": "There is no CS domain in this access technology.\nNOTE:\tThis subclause describes the mechanism for support of the hosted  scenario. This does not preclude other mechanisms but they are out of the scope of this annex.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.1\tScope",
            "description": "This annex describes the UE and P-CSCF procedures in support of hosted . In this scenario, both the media flows and the SIP signalling both traverse a (P)T device located in the customer premises domain. The term \"hosted \" is used to address this function.\nWhen receiving an initial SIP REGISTER request without integrity protection, the P-CSCF can, determine whether to perform the hosted  procedures for the user identified by the REGISTER request by comparing the address information in the top-most SIP Via header field with the IP level address information from where the request was received. The P-CSCF will use the hosted  procedure only when the address information do not match.\nNOTE:\tThere is no need for the P-CSCF to resolve a domain name in the Via header field when UDP encapsulated tunnel mode for IPsec is used. The resolution of a domain name in the Via header field is not required by RFC 3261 [26].\nIn order to provide hosted  traversal for SIP REGISTER requests without integrity protection and the associated responses, the P-CSCF makes use of the \"received\" header field parameter as described in RFC 3261 [26] and, in addition, if UDP is used, makes use of the \"rport\" header field parameter as described in RFC 3581 [56A]. The hosted  traversal for protected SIP messages is provided by applying UDP encapsulation to IPSec packets in accordance with RFC 3948 [63A].\nAlternativly to the procedures defined in subclause F.2 which are employed to support the hosted  scenario where the security solution is based on UDP encapsulated IPSec as defined in 3GPP TS 33.203 [19], subclause F.4 provides procedures for  traversal for security solutions that are not defined in 3GPP TS 33.203 [19]. Use of such security solutions is outside the scope of this document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.2\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.2.1\tUE usage of SIP",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "F.2.1.1\tGeneral",
                            "text_content": "This subclause describes the UE SIP procedures for supporting hosted  scenarios. The description enhances the procedures specified in subclause 5.1.\nThe UE shall support the symmetric response routeing mechanism according to RFC 3581 [56A].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "F.2.1.2\tRegistration and authentication",
                            "text_content": "The text in subclause 5.1.1.1 applies without changes\nThe text in subclause 5.1.1.1A applies without changes\nThe text in subclause 5.1.1.1B applies without changes.\nThe procedures described in subclause 5.1.1.2.1 apply with the additional procedures described in the present subclause.\nNOTE 1:\tIn accordance with the definitions given in subclause 3.1 the IP address acquired initially by the UE in a hosted  scenario is the UE private IP address.\nOn sending a REGISTER request, the UE shall populate the header fields as indicated in subclause 5.1.1.2.1 with the exceptions of subitems c) and d) which are modified as follows\nThe UE shall populate:\nc)\ta Contact header field according to the following rules: if the REGISTER request is sent without integrity protection, the Contact header field shall be set to include SIP (s) containing the private IP address of the UE in the hostport parameter or FQDN. If the UE supports GRUU, the UE shall include a \"+sip.instance\" header field parameter containing the instance ID. If the REGISTER request is integrity protected, the UE shall include the public IP address or FQDNin the hostport parameter. The UE shall only use a FQDN in a protected REGISTER request, if it is ensured that the FQDN resolves to the public IP address of the . If the UE supports GRUU, the UE shall include a \"+sip.instance\" header field parameter containing the instance ID. The UE shall include all supported ICSI values (coded as specified in subclause 7.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 and RFC 3840 [62] for the IMS communication services it intends to use, and IARI values (coded as specified in subclause 7.2A.9.2), for the IMS applications it intends to use in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3840 [62];\nNOTE 2:\tThe UE will learn its public IP address from the \"received\" header field parameter in the topmost Via header field in the 401 (Unauthorized) response to the unprotected REGISTER request.\nd)\ta Via header field according to the following rules: if the REGISTER request is sent without integrity protection, the Via header field shall be set to include the private IP address or FQDN of the UE in the sent-by field. If the REGISTER request is integrity protected, the UE shall include the public IP address or FQDN in the sent-by field. The UE shall only use a FQDN in a protected REGISTER request, if it is ensured that the FQDN resolves to the public IP address of the . Unless the UE has been configured to not send keep-alives, it shall include a \"keep\" header field parameter with no value in the Via header field, in order to indicate support of sending keep-alives associated with, the registration, as described in RFC 6223 [143];\nNOTE 3:\tIf the UE specifies a FQDN in the host parameter in the Contact header field and in the sent-by field in the Via header field of an unprotected REGISTER request, this FQDN will not be subject to any processing by the P-CSCF or other entities within the IM CN subsystem. The means to ensure that the FQDN resolves to the public IP address of the  are outside of the scope of this specification. One option for resolving this is local configuration.\nIf IMS AKA is used as a security mechanism, on sending a REGISTER request, as defined in subclause 5.1.1.2.1, the UE shall additionally populate the header fields as defined in subclause 5.1.1.2.2, with the exceptions of subitems c), and d) which are modified as follows:\nd)\tthe Security-Client header field set to specify the security mechanisms the UE supports, the IPsec layer algorithms the UE supports and the parameters needed for the security association setup. The UE shall support the setup of two pairs of security associations as defined in 3GPP TS 33.203 [19]. The syntax of the parameters needed for the security association setup is specified in Annex H of 3GPP TS 33.203 [19]. The UE shall support the \"ipsec-3gpp\" security mechanism, as specified in RFC 3329 [48]. The UE shall support the IPSec layer algorithms for integrity protection and for encryption as defined in 3GPP TS 33.203 [19], and shall announce support for them according to the procedures defined in RFC 3329 [48]. In addition to transport mode the UE shall support UDP encapsulated tunnel mode as per RFC 3948 [63A] and shall announce support for both modes as described in TS 33.203 [19];\nWhen a 401 (Unauthorized) response to a REGISTER is received and this response is received without integrity protection, the procedures described in subclause 5.1.1.2.1 apply with the following additions:\nThe UE shall compare the IP address in the \"received\" header field parameter with the corresponding value in the sent-by parameter in the topmost Via header field to detect if the UE is behind a . If the comparison indicates that the respective values are the same, the UE concludes that it is not behind a .\n-\tIf the UE is not behind a , the UE shall proceed with the procedures described in subclause 5.1 of the main body of this specification;\n-\tIf the UE is behind a , the UE shall verify using the Security-Server header field that mode \"UDP-enc-tun\" is selected. If the verification succeeds the UE shall store the IP address contained in the \"received\" header field parameter as the UE public IP address. If the verification does not succeed the UE shall abort the registration. When the UE detects that it is behind a , the UE may include a transport=tcp  parameter in the Contact header when it sends a protected REGISTER.\nNOTE 4:\tThe UE includes a transport=tcp parameter to ensure that P-CSCF uses  connection when it receives an initial request for a dialog or a request for a standalone transaction destined for the UE.\nIn addition, when a 401 (Unauthorized) response to a REGISTER is received (with or without integrity protection) the UE shall behave as described in subclause F.2.1.2.5.\nWhen the UE, that is behind a , receives a 400 (Bad Request) response with 301 Warning header field indicating \"incompatible network address format\" to the unprotected REGISTER request, the UE shall randomly select new values for the protected server port and the protected client port, and perform new initiate registration procedure by sending an unprotected REGISTER request containing the new values in the Security-Client header field.\nNOTE 5:\tThis release of the present document does not specify any specific procedures for bulk number registration according to RFC 6140 [191]for hosted NAT scenarios.\nThe procedures described in subclause 5.1.1.3 apply with the additional procedures described in subclause F.2.1.4.1.\nThe procedures described in subclause 5.1.1.4.1 apply with the additional procedures described in the present subclause.\nOn sending a REGISTER request that does not contain a challenge response, the UE shall populate the header fields as indicated in subclause 5.1.1.4.1 with the exception of subitems c) and d) which are modified as follows.\nThe UE shall populate:\nc)\ta Contact header field set to include SIP (s) that contain(s) in the hostport parameter the public IP address of the UE or FQDN, and containing the instance ID of the UE in the \"+sip.instance\" header field parameter, if the UE supports GRUU. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the . The UE shall include all supported ICSI values (coded as specified in subclause 7.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 and RFC 3840 [62] for the IMS communication services it intends to use, and IARI values (coded as specified in subclause 7.2A.9.2), for the IMS applications it intends to use in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3840 [62]. If the UE has detected it is behind a , the UE may include a transport=tcp  parameter in the Contact header;\nd)\ta Via header field set to include the public IP address or FQDN of the UE in the sent-by field. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the . For the , the response is received on the  connection on which the request was sent. If the UE previously has previously negotiated sending of keep-alives associated with the registration, it shall include a \"keep\" header field parameter with no value in the Via header field, in order to indicate continous support to send keep-alives, as described in RFC 6223 [143];\nNOTE 1:\tThe means to ensure that the FQDN resolves to the public IP address of the  are outside of the scope of this specification. One option for resolving this is local configuration.\nWhen the UE, that is behind a , receives a 400 (Bad Request) response with 301 Warning header field indicating \"incompatible network address format\" to the REGISTER request that does not contain a challenge response, the UE shall randomly select a new value for the protected client port, and send the REGISTER request containing the new values in the Security-Client header field.\nNOTE 2:\tThe protected server port stays fixed for a UE until all public user identities of the UE have been de-registered.\nNOTE 3:\tThis release of the present document does not specify any specific procedures for bulk number re-registration according to RFC 6140 [191] for hosted NAT scenarios.\nThe procedures of subclause 5.1.1.5.1 apply with with the additional procedures described in the present subclause.\nOn receiving a 401 (Unauthorized) response to the REGISTER request and the response is deemed to be valid, the UE shall behave as of subclause 5.1.1.5.1 with the exception of subitem 3) which is modified as follows.\nThe UE shall:\n3)\tsend another REGISTER request using the temporary set of security associations to protect the message. The header fields are populated as defined for the initial request (see subclause F.2.1.2.2), with the addition that the UE shall include an Authorization header field containing the private user identity and the authentication challenge response calculated by the UE using  and other parameters, as described in RFC 3310 [49] when AKAv1 is used or as described in RFC 4169 [227] when AKAv2 is used. The UE shall also insert the Security-Client header field that is identical to the Security-Client header field that was included in the previous REGISTER request (i.e. the REGISTER request that was challenged with the received 401 (Unauthorized) response). The UE shall also insert the Security-Verify header field into the request, by mirroring in it the content of the Security-Server header field received in the 401 (Unauthorized) response. The UE shall set the Call-ID of the integrity protected REGISTER request which carries the authentication challenge response to the same value as the Call-ID of the 401 (Unauthorized) response which carried the challenge.\nWhenever the 200 (OK) response is not received before the temporary SIP level lifetime of the temporary set of security associations expires or a 403 (Forbidden) response is received, the UE shall consider the registration to have failed. The UE shall delete the temporary set of security associations it was trying to establish, and use the old set of security associations. The UE should send an unprotected REGISTER request according to the procedure specified in subclause F.2.1.2.2 if the UE considers the old set of security associations to be no longer active at the P-CSCF.\nThe text in subclause 5.1.1.5.3 applies without changes.\nNot applicable.\nNot applicable.\nNot applicable.\nNot applicable.\nThe text in subclause 5.1.1.5.8 applies without changes.\nThe text in subclause 5.1.1.5A applies without changes.\nThe text in subclause 5.1.1.5B applies without changes.\nThe procedures of subclause 5.1.1.6.1 apply with with the additional procedures described in the present subclause.\nOn sending a REGISTER request, the UE shall populate the header fields as indicated in subclause 5.1.1.6 with the exception of subitems d) and e) which are modified as follows.\nThe UE shall populate:\nc)\ta Contact header field set to either the value of \"*\" or SIP (s) that contain(s) in the hostport parameter the IP address of the UE or FQDN; and containing the instance ID of the UE in the \"+sip.instance\" header field parameter, if the UE supports GRUU. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the ;\nd)\ta Via header field set to include the IP address or FQDN of the UE in the sent-by field. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the ;\nNOTE 1: In case of hosted  traversal only the UE public IP addresses are bound to security associations.\nNOTE 2:\tThe means to ensure that the FQDN resolves to the public IP address of the  are outside of the scope of this specification. One option for resolving this is local configuration.\nNOTE 3:\tThis release of the present document does not specify any specific procedures for bulk number re-registration according to RFC 6140 [191] for hosted NAT scenarios.F.2.1.2.7\tNetwork-initiated deregistration\nThe procedures of subclause 5.1.1.7 apply with with the additional procedures described in the present subclause.\nUpon receipt of a NOTIFY request on the dialog which was generated during subscription to the reg event package as described in subclause 5.1.1.3, including one or more <registration> element(s) which were registered by this UE with:\n-\tthe state attribute set to \"terminated\" and the event attribute set to \"rejected\" or \"deactivated\"; or\n-\tthe state attribute set to \"active\" and the state attribute within the <contact> element belonging to this UE set to \"terminated\", and associated event attribute element to \"rejected\" or \"deactivated\";\nthe UE shall remove all registration details relating to these public user identities. In case of a \"deactivated\" event attribute, the UE shall start the initial registration procedure as described in subclause F.2.1.2.2. In case of a \"rejected\" event attribute, the UE shall release all dialogs related to those public user identities.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "F.2.1.3\tSubscription and notification",
                            "text_content": "The text in subclause 5.1.2 applies without changes.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "F.2.1.4\tGeneric procedures applicable to all methods excluding the REGISTER method",
                            "text_content": "The procedures described in subclause 5.1.2A.1 apply with the additional procedures described in the present subclause.\nWhen the UE sends any request, the requirements in subclause 5.1.2A.1 are replaced by the following requirements. The UE shall include:\n-\ta Via header field set to include the public IP address of the UE or FQDN and the protected server port in the sent-by field. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the ; and if this is a request for a new dialog, and the request includes a Contact header field, then the UE should populate the Contact header field as follows:\n1)\tif a public GRUU value (\"pub-gruu\" header field parameter) has been saved associated with the public user identity to be used for this request, and the UE does not indicate privacy of the P-Asserted-Identity, then insert the public GRUU (\"pub-gruu\" header field parameter) value in the Contact header field as specified in RFC 5627 [93]; or\n2)\tif a temporary GRUU value (\"temp-gruu\" header field parameter) has been saved associated with the public user identity to be used for this request, and the UE does indicate privacy of the P-Asserted-Identity, then insert the temporary GRUU (\"temp-gruu\" header field parameter) value in the Contact header field as specified in RFC 5627 [93].\nIf this is a request within an existing dialog, and the request includes a Contact header field, and the contact address previously used in the dialog was a GRUU, then the UE should insert the previously used GRUU value in the Contact header field as specified in RFC 5627 [93].\nIf the UE did not insert a GRUU in the Contact header field, then the UE shall include the public IP address of the UE or FQDN and the protected server port in the hostport parameter in any Contact header field that is otherwise included. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the .\nNOTE:\tThe means to ensure that the FQDN resolves to the public IP address of the  are outside of the scope of this specification. One option for resolving this is local configuration.\nThe UE shall discard any SIP response that is not integrity protected and is received from the P-CSCF outside of the registration and authentication procedures. The requirements on the UE within the registration and authentication procedures are defined in subclause F.2.1.2.4.\nWhen a SIP transaction times out, i.e. timer B, timer F or timer H expires at the UE, the UE may behave as if timer F expired, as described in subclause F.2.1.2.3.\nThe procedures described in subclause 5.1.2A.2 apply with the additional procedures described in the present subclause.\nWhen the UE sends any response, the requirements in subclause 5.1.2A.1 are replaced by the following requirement.\nIf the response includes a Contact header field, and the response is not sent within an existing dialog, then the UE should populate the Contact header field as follows:\n1)\tif a public GRUU value (\"pub-gruu\" header field parameter) has been saved associated with the public user identity from the P-Called-Party-ID header field, and the UE does not indicate privacy of the P-Asserted-Identity, then insert the public GRUU (\"pub-gruu\" header field parameter) value in the Contact header field as specified in RFC 5627 [93]; and\n2)\tif a temporary GRUU value (\"temp-gruu\" header field parameter) has been saved associated with the public user identity from the P-Called-Party-ID header field, and the UE does indicate privacy of the P-Asserted-Identity, then the UE should insert the temporary GRUU (\"temp-gruu\" header field parameter) value in the Contact header field as specified in RFC 5627 [93].\nIf the UE did not insert a GRUU in the Contact header field, then the UE shall:\n-\tinclude the public IP address of the UE or FQDN and the protected server port in the hostport parameter in any Contact header field that is otherwise included. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the .\nNOTE:\tThe means to ensure that the FQDN resolves to the public IP address of the  are outside of the scope of this specification. One option for resolving this is local configuration.\nThe UE shall discard any SIP request that is not integrity protected and is received from the P-CSCF outside of the registration and authentication procedures. The requirements on the UE within the registration and authentication procedures are defined in subclause F.2.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "F.2.2\tP-CSCF usage of SIP",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "F.2.2.1\tIntroduction",
                            "text_content": "This subclause describes the SIP procedures for supporting hosted  scenarios.\nThe description enhances the procedures specified in subclause 5.2.\nThe P-CSCF shall support the symmetric response routeing mechanism according to RFC 3581 [56A].\nNOTE:\tSymmetric response routeing is used to support hosted  and applicable only to initial, unprotected REGISTER requests and corresponding responses.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "F.2.2.2\tRegistration",
                            "text_content": "The procedures described in subclause 5.2.2 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives a REGISTER request from the UE, the P-CSCF shall behave as of subclause 5.2.2.1.\nIf IMS AKA is the security mechanism, when the P-CSCF receives a REGISTER request from the UE, the P-CSCF shall perform the procedures of subclause 5.2.2.2 with the following exception to items 2) and 3):\n2)\tin case the REGISTER request was received without integrity protection, then:\na)\tcheck the existence of the Security-Client header field. If the Security-Client header field is not present, then the P-CSCF shall return a suitable 4xx response. If the Security-Client header field is present the P-CSCF shall:\n-\tin case the UE indicated support for \"UDP-enc-tun\" then remove and store it.\n-\tin case the UE does not indicate support for \"UDP-enc-tun\" then:\n-\tif the host portion of the sent-by field in the topmost Via header field contains an IP address that differs from the source address of the IP packet, silently drop the REGISTER;\n-\totherwise continue with procedures as of subclause 5.2.2.\nNOTE 1:\tIf the UE does not indicate support for \"UDP-enc-tun\" and the P-CSCF detects that the UE is located behind a  device, then the P-CSCF can just drop the REGISTER to avoid unnecessary signalling traffic.\nb)\tif the host portion of the sent-by field in the topmost Via header field contains a FQDN, or if it contains an IP address that differs from the source address of the IP packet, the P-CSCF shall:\n-\tadd a \"received\" header field parameter in accordance with the procedure defined in RFC 3581 [56A]. If the \"rport\" header field parameter is included in the Via header field, the P-CSCF shall also set the value of the \"rport\" header field parameter to the source port of the requestin accordance with the procedure defined in RFC 3581 [56A]; and\n-\tcheck that no any previously registered UE has either the same public IP address (allocated by the  and indicated in the Via header field) and the protected server port (specified in the Security-Client header field) or the same public IP address and the protected client port (specified in the Security-Client header field). If there is such UE, the P-CSCF shall return a 400 (Bad Request) response with 301 Warning header field indicating \"incompatible network address format\" to the unprotected REGISTER request. Otherwise, the P-CSCF shall forward the REGISTER request.\nNOTE 2:\tIf two UEs are behind the same , the  can assign to them the same public IP address (but different 's port). Hence, the two respective UE will have different protected server port numbers, and different protected client port numbers.\n3)\tin case the REGISTER request was received integrity protected, then the P-CSCF shall:\na)\tcheck the security association which protected the request. If the security association is a temporary one, the P-CSCF shall:\n-\tin case the host parameter in the Contact address is in the form of a FQDN, ensure that the given FQDN will resolve (e.g., by reverse DNS lookup) to the IP address bound to the security association;\n-\tin case the P-CSCF has detected earlier that the UE is located behind a , retrieve port_Uenc from the encapsulating UDP header of the packet received and complete configuration of the temporary set of security associations by configuring port_Uenc in each of the temporary security associations;\n-\tcheck whether the request contains a Security-Verify header field in addition to a Security-Client header field. If there are no such header fields, then the P-CSCF shall return a suitable 4xx response. If there are such header fields, then the P-CSCF shall compare the content of the Security-Verify header field with the content of the Security-Server header field sent earlier and the content of the Security-Client header field with the content of the Security-Client header field received in the challenged REGISTER. If those do not match, then there is a potential man-in-the-middle attack. The request should be rejected by sending a suitable 4xx response. If the contents match, the P-CSCF shall remove the Security-Verify and the Security-Client header field;\nb)\tif the security association the REGISTER request was received on, is an already established one, then the P-CSCF shall:\n-\tremove the Security-Verify header field if it is present;\n-\tcheck if the Security-Client header field containing new parameter values is present, and:\n-\tif this header field or any required parameter is missing, then the P-CSCF shall return a suitable 4xx response.\n-\tif this header field and the required parameters are present, then the P-CSCF shall check that no any previously registered UE has the same public IP address and the protected client port (specified in the Security-Client header field). If there is such UE, the P-CSCF shall return a 400 (Bad Request) response with 301 Warning header field indicating \"incompatible network address format\" to the REGISTER request. Otherwise, the P-CSCF shall remove and store the Security-Client header field before forwarding the request to the S-CSCF;\nNOTE 3:\tWhen sending the protected REGISTER request to the P-CSCF, the UE will not modify the protected server port value, since the protected server port value stays fixed for a UE until all public user identities of the UE have been de-registered.\nWhen the P-CSCF receives a 401 (Unauthorized) response to an unprotected REGISTER request:\n1)\tif this response contains a \"received\" header field parameter in the Via header field associated with the UE;\n2)\tif the request associated with the response was received:\nA)\tusing UDP and this response contains a \"rport\" header field parameter in the Via header field associated with the UE; or\nB)\tusing ; and\n3)\tthe UE indicated support for \"UDP-enc-tun\" IPsec mode;\nthe P-CSCF shall:\n1)\tdelete any temporary set of security associations established towards the UE;\n2)\tremove the \"ck\" and \"ik\" -Authenticate header field parameters contained in the 401 (Unauthorized) response and bind the values to the proper private user identity and to the temporary set of security associations which will be setup as a result of this challenge. The P-CSCF shall forward the 401 (Unauthorized) response to the UE if and only if the \"ck\" and \"ik\" header field parameters have been removed;\n3)\tinsert a Security-Server header field in the response, containing the P-CSCF security list and the parameters needed for the security association setup, as specified in Annex H of 3GPP TS 33.203 [19]. The P-CSCF shall support the \"ipsec-3gpp\" security mechanism, as specified in RFC 3329 [48]. The P-CSCF shall support the IPSec layer algorithms for integrity protection and for encryption as defined in 3GPP TS 33.203 [19]. The P-CSCF shall indicate \"UDP-enc-tun\" as the only IPsec mode;\n4)\tset up the temporary set of security associations with a temporary SIP level lifetime between the UE and the P-CSCF for the user identified with the private user identity. The P-CSCF shall select UDP encapsulated tunnel mode and shall leave the value for port-Uenc unspecified in each of the temporary security associations. For further details see 3GPP TS 33.203 [19] and RFC 3329 [48]. The P-CSCF shall set the temporary SIP level lifetime for the temporary set of security associations to the value of reg-await-auth timer; and\n5)\tsend the 401 (Unauthorized) response unprotected to the UE using the mechanisms described in RFC 3261 [26] and RFC 3581 [56A], i.e. in case UDP is used as transport protocol the P-CSCF shall send the response to the IP address indicated in the \"received\" header field parameter and to the port indicated in the \"rport\" header field parameter of the Via header field associated with the UE. In case UDP is used as transport protocol, the P-CSCF shall use the IP address and the port on which the REGISTER request was received as source IP address and the source port when sending the response back to the UE.\nWhen the P-CSCF receives a 401 (Unauthorized) response to a protected REGISTER request and that REGISTER request was protected by an old set of security associations that use UDP encapsulated tunnel mode, the P-CSCF shall:\n1)\tdelete any temporary set of security associations established towards the UE;\n2)\tremove the \"ck\" and \"ik\" -Authenticate header field parameters contained in the 401 (Unauthorized) response and bind the values to the proper private user identity and to the temporary set of security associations which will be setup as a result of this challenge. The P-CSCF shall forward the 401 (Unauthorized) response to the UE if and only if the \"ck\" and \"ik\" header field parameters have been removed;\n3)\tinsert a Security-Server header field in the response, containing the P-CSCF security list and the parameters needed for the security association setup, as specified in Annex H of 3GPP TS 33.203 [19]. The P-CSCF shall support the \"ipsec-3gpp\" security mechanism, as specified in RFC 3329 [48]. The P-CSCF shall support the IPsec layer algorithms for integrity protection and encryption as defined in 3GPP TS 33.203 [19]. The P-CSCF shall indicate \"UDP-enc-tun\" as the IPsec mode;\n4)\tset up the temporary set of security associations with a temporary SIP level lifetime between the UE and the P-CSCF for the user identified with the private user identity. The P-CSCF shall select UDP encapsulated tunnel mode and shall specify the same port_Uenc that was used in the old set of security associations. The P-CSCF shall set the temporary SIP level lifetime for the temporary set of security associations to the value of reg-await-auth timer; and\n5)\tsend the 401 (Unauthorized) response to the UE using the old set of security associations.\nOtherwise, when the P-CSCF receives a 401 (Unauthorized) response to an unprotected REGISTER request and:\n-\tthis response does not contain a \"received\" header field parameter in the Via header field associated with the UE;\n-\tthis response does not contain \"rport\" header field parameter in the Via header field associated with the UE and the request associated with the response was received using UDP; or\n-\twhen the P-CSCF receives a 401 (Unauthorized) response to a protected REGISTER request and that REGISTER request was protected by an old set of security associations that do not use UDP encapsulated tunnel mode;\nthe P-CSCF shall proceed as described in subclause 5.2.2.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "F.2.3\tS-CSCF usage of SIP",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "F.2.3.1\tS-CSCF usage of SIP",
                            "text_content": "The procedures at the S-CSCF described in subclause 5.4.1.2.2 apply.\nNOTE:\tWhen two UEs that are behind the same  register their contact addresses, the  can assign to them the same public IP address (but different 's ports). If these two UEs select the same protected server port number, and register via different P-CSCFs, then they will have the same contact addresses (i.e. same IP address and protected server port). However, any request targeted to either UE will be sent to the respective P-CSCF, hence not causing any ambiguity at the P-CSCF when forwarding the request via .\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "F.3\tVoid",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.4\tP-CSCF usage of SIP in case UDP encapsulated IPsec is not employed",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.4.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "The subclause F.4 describes the SIP procedures for supporting hosted  scenarios in case UDP encapsulated IPsec is not employed. In these scenarios the procedures for  traversal must take into account that all SIP requests and responses are not protected by an IPsec security association. This subclause also assumes that the UE transmits the SIP messages from the same IP address and port on which the UE expects to receive SIP messages.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.4.2\tRegistration",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures described in subclause 5.2.2 apply with the additional procedures described in the present clause.\nWhen the P-CSCF receives a REGISTER request from the UE, the P-CSCF shall add the \"received\" header field parameter to the Via header field set to the source IP address of the packet header in accordance with the procedure defined in RFC 3261 [26] and RFC 3581 [56A]. If the \"rport\" header field parameter is included in the Via header field, the P-CSCF shall also set the value of the \"rport\" header field parameter to the source port of the request, in accordance with the procedure defined in RFC 3581 [56A].\nWhen the P-CSCF detects that the UE is behind a :\n-\tif the UE has indicated in the received REGISTER request support of the keep-alive mechanism defined in SIP outbound (RFC 5626 [92]) according to RFC 6223 [143], the P-CSCF shall indicate to the UE that it supports the keep-alive mechanism; and\n-\tif the UE has not indicated in the received REGISTER request support of the keep-alive mechanism defined in SIP outbound (RFC 5626 [92]) according to RFC 6223 [143]:\na)\tif a P-CSCF registration timer is running, the P-CSCF should not forward the REGISTER request if received half of the time before expiry of the S-CSCF registration timer, unless the request is intended to update the UE's capabilities according to RFC 3840 [62] or to modify the ICSI values or IARI values that the UE intends to use in the g.ims.app-ref feature tag. If the P-CSCF decides to not forward the REGISTER request, the P-CSCF shall build a 200 (OK) response based on the contents of the 200 (OK) response to the previous REGISTER request and send this response to the UE. If the P-CSCF decides to forward the REGISTER request, the P-CSCF shall set the registration expiration interval to the registration expiration interval value indicated in the received 200 (OK) response to the previous REGISTER request; and\nb)\twhen the P-CSCF receives a 200 (OK) response to the REGISTER request, the P-CSCF shall modify the value of the Expires header field and/or Expires parameter in the Contact header according to the transport protocol. In order to minimize the number of REGISTER requests to the S-CSCF, the P-CSCF may also start a P-CSCF registration timer with a value of 600 seconds if the value received from the S-CSCF was for greater than 1200 seconds, or to half of the time otherwise.\nIf, upon receiving a REGISTER request from an unregistered user and the P-CSCF discovers that the UE is behind a , the P-CSCF performs the following actions on the Contact header field depending on its content:\n-\tif the Contact header field contains a contact address in the form of an IP address (NOTE), the P-CSCF shall save (for the duration of the registration) this IP address (i.e. the private IP address of the UE) and associated port number (i.e. the private port of the UE) and bind them to the source IP address (i.e. the public IP address of the ) and the source port number (i.e. the port number of the ) of the IP packet that contained the REGISTER request and forward the REGISTER request;\n-\tif the Contact header field contains more than one contact addresses in the form of an IP address, the P-CSCF shall apply the above procedure to one of those contact addresses by choosing the one with the highest qvalue parameter) and delete any other contact addresses containing an IP address. If the P-CSCF was unable to choose a contact address based on the qvalue, the P-CSCF shall choose one based on local policy and delete any other contact addresses containing an IP address.\nNOTE:\tWhen the host parameter in the Contact address is in the form of a FQDN, the P-CSCF will resolve the given FQDN (by DNS lookup) to the IP address of the UE. When including the FQDN in the Contact header field the UE insures that the FQDN resolves to the IP address that the UE uses to send the REGISTER request.\nWhen the P-CSCF received a response to the above request, the P-CSCF shall forward the response to the UE using the mechanisms described in RFC 3581 [56A]. In case UDP is used, the P-CSCF shall send the response to the IP address indicated in the \"received\" header field parameter and to the port indicated in the \"rport\" header field parameter of the Via header field in the response. If the REGISTER request received from the UE was received over a  connection, the P-CSCF shall send the response to the UE over the same  connection over which the request was received. The P-CSCF shall transmit the IP packet (containing the response) from the same IP address and port on which the REGISTER request was received.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.4.3\tGeneral treatment for all dialogs and standalone transactions excluding the REGISTER method",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "F.4.3.1\tIntroduction",
                            "text_content": "The procedures described in subclause 5.2.6 apply with the additional procedures described in subclause F.4.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "F.4.3.2\tRequest initiated by the UE",
                            "text_content": "When the P-CSCF receives, from the UE that is behind a , an initial request for a dialog or a request for a standalone transaction, the P-CSCF shall:\na)\tif the \"rport\" header field parameter is included in the Via header field, set the value of the \"rport\" header field parameter in the Via header field to the source port of the received IP packet that contained the request;\naa)\tinsert the \"received\" header field parameter in the Via header field containing the source IP address of the received IP packet (that contained the request), as defined in RFC-3581 [56A];\nb)\tif the request is a dialog-forming request that was received over UDP, bind the source IP address (i.e. the public IP address of the ) and associated source port number (i.e. the port number of the ) of the received IP packet (that contained the initial dialog-forming request) to:\n-\tthe IP address (i.e. the private IP address of the UE) and associated port number (i.e. the private port of the UE) contained in the Contact header field of the received dialog-forming request, if the Contact header field contained an IP address and associated port number, and save the binding; or\n-\tthe saved IP address (i.e. the private IP address of the UE) and associated port number (i.e. the private port of the UE) contained in the Contact header field of the REGISTER request, if the Contact header field of the received dialog-forming request contained a GRUU, and save the binding; and\nc)\tif the dialog-forming request was received over  connection, keep this  connection up during the entire duration of the dialog;\nbefore forwarding the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26].\nWhen the P-CSCF receives a response to the above request, the P-CSCF shall forward the response to the UE using the mechanisms described in RFC 3581 [56A]. In case UDP is used, the P-CSCF shall send the response to the IP address indicated in the \"received\" header field parameter and to the port indicated in the \"rport\" header field parameter of the Via header field of the response. If the dialog-forming request received from the UE was received over the  connection, the P-CSCF shall send the response to the UE over the same  connection over which the dialog-forming request was received. The P-CSCF shall transmit the IP packet (containing the response) from the same IP address and port on which the initial dialog-forming request was received.\nFor all subsequent requests belonging to the dialog, received from the UE, the P-CSCF shall:\n-\tinsert the \"received\" header field parameter in the Via header field as described in RFC 3261 [26];\n-\tif the \"rport\" header field parameter is included in the Via header field, set the value of the \"rport\" header field parameter in the Via header field as defined in RFC 3581 [56A]; and\n-\tforward the request as described in RFC 3261 [26].\nFor all subsequent responses belonging to the dialog, destined for the UE, the P-CSCF shall forward the responses using the \"received\" header field parameter and if UDP is used, set the value of the \"rport\" header field parameter in the Via header field of the response as defined in RFC 3581 [56A].\nFor all subsequent requests belonging to the dialog and destined for the UE (that contains the private IP address and associated private port number in the Request-), the P-CSCF shall send the requests to the UE either:\n-\tover the  connection that was established when the initial INVITE request was received; or\n-\tuse UDP. When sending the request using UDP, the P-CSCF shall insert the request in an IP packet, and send the IP packet to the saved IP address (i.e. the public IP address of the ) and associated port number (i.e. the port number of the ). The P-CSCF shall transmit the IP packet (containing the request) from the same IP address and port on which the REGISTER request was received.\nNOTE:\tWhen inserting its SIP  in the Record-Route header field of the dialog-forming request received from the UE, the P-CSCF can include a pointer in the user part of its SIP  that points to the saved binding used to route the in-dialog requests to the UE. The Route header field of the in-dialog requests will contain the respective pointer in the user part of the P-CSCF's SIP .\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "F.4.3.3\tRequest terminated by the UE",
                            "text_content": "When the P-CSCF receives an initial request for a dialog or a request for a standalone transaction destined for the UE (it contains the private IP address and associated private port number in the Request-), the P-CSCF shall send the requests to the UE either:\n-\tover the  connection for the related registration or registration flow (if the multiple registrations mechanism is used), if available (e.g.  connection was established during the registration procedure); or\n-\tuse UDP. When sending the request using UDP, the P-CSCF shall send the request to the saved IP address (i.e. the public IP address of the ) and associated port number (i.e. the port number of the ) for the related registration or registration flow (if the multiple registrations mechanism is used) that is bound to the private IP address and associated private port number indicated in the Request- and saved during the registration procedure. The P-CSCF shall transmit the IP packet (containing the request) from the same IP address and port on which the REGISTER request was received.\nNOTE 1:\tIf the Contact bound to the terminating UE's registration state includes a transport=tcp  parameter, for the terminating requests, the P-CSCF follows the procedures specified in RFC 3261 [26] subclause 7 and RFC 3263 [27A] subclause 4.1 for selection of the transport, which recommend to use the  connection.\nFor all subsequent requests belonging to the dialog that are received from the UE, the P-CSCF shall:\n-\tinsert the \"received\" header field parameter in the Via header field as defined in RFC 3261 [26];\n-\tif the \"rport\" header field parameter is included in the Via header field, set the value of the \"rport\" header field parameter in the Via header field as defined in RFC 3581 [56A]; and\n-\tforward the request as described in RFC 3261 [26].\nFor all subsequent responses belonging to the dialog, destined or the UE, the P-CSCF shall forward the responses using the \"received\" header field parameter and if UDP is used, set the value of the \"rport\" header field parameter in the Via header field of the response as defined in RFC 3581 [56A].\nFor all subsequent requests belonging to the dialog and destined for the UE (that contains the private IP address and associated private port number in the Request-), the P-CSCF shall send the requests to the UE either:\n-\tover the  connection, if available; or\n-\tuse UDP. When sending the request using UDP, the P-CSCF shall insert the request in an IP packet, and send the IP packet to the saved IP address (i.e. the public IP address of the ) and associated port number (i.e. the port number of the ). The P-CSCF shall transmit the IP packet (containing the request) from the same IP address and port on which the REGISTER request was received.\nNOTE 2:\tWhen inserting its SIP  in the Record-Route header field in a response to the dialog-forming request received from the UE, the P-CSCF can include a pointer in the user part of its SIP  that points to the saved binding used to route the in-dialog requests to the UE. The Route header field of the in-dialog requests will contain the respective pointer in the user part of the P-CSCF's SIP .\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "F.5\t traversal for media flows",
            "description": "To allow the IMS access gateway to perform address latching, for a given UDP-based media stream, the UE shall use the same port number for sending and receiving packets.\nTo allow early media flows, the UE shall send keepalive messages for each UDP-based media stream as soon as an SDP offer or answer is received in order to allow the IMS access gateway to perform address latching before the call is established.\nTo keep  bindings and firewall pinholes open for the UDP-based media streams, and enable the IMS access gateway to perform address latching, the UE shall send keepalive messages for each media stream as defined in subclause K.5.2.1.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is a DOCSIS cable access network.\nDOCSIS (Data Over Cable Service Interface Specification) is a term referring to the Recommendation ITU-T J112 [87] Annex B standard for cable modem systems.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.2\tDOCSIS aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "H.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by the DOCSIS cable access network to provide packet-mode communication between the UE and the IM CN subsystem.\nFrom the perspective of the UE, the necessary IP-CAN bearer for signalling is transparently available to the UE.\nThe UE is not directly involved in requests for IP-CAN bearer(s) for media flow(s). The IM CN interacts with the PCRF in the DOCSIS IP-CAN to establish IP-CAN bearer(s) for media flow(s), on behalf of the UE.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "H.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "H.2.2.1\tActivation and P-CSCF discovery",
                            "text_content": "Prior to communication with the IM CN subsystem, the UE shall perform a Network Attachment procedure as defined in the CableLabs PacketCable specifications PKT-TR-ARCH-FRM [88]. When using DOCSIS, both IPv4 and IPv6 UEs may access the IM CN subsystem. The procedures for P-CSCF discovery defined in subclause 9.2.1 of this document apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.2.2.1A\tModification of IP-CAN used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.2.2.1B\tRe-establishment of the IP-CAN used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "A UE supporting the P-CSCF restoration procedure uses the keep-alive procedures described in RFC 6223 [143].\nIf the P-CSCF fails to respond to the keep-alive request the UE shall acquire a different P-CSCF address using any of the methods described in the subclause H.2.2.1 and perform an initial registration as specified in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.2.2.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.2.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.2.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.2.2.5\tHandling of the IP-CAN for media",
                            "text_content": "The UE does not directly request resources for media flow(s).\nNot applicable.\nNot applicable.\nNot applicable.\nThe UE does not directly request resources for media flow(s). As a result there are no special UE requirements applying to forked responses.\nNot applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.2.2.6\tEmergency service",
                            "text_content": "If attached to network via DOCSIS access technology, the UE shall always consider being attached to its home operator's network for the purpose of emergency calls.\nNOTE:\tIn DOCSIS the UE is unable to receive any indication from the network, that would allow the UE to determine, whether it is currently attached to its home operator's network or to a different network, so the UE assumes itself always attached to the home operator's network when connected via DOCSIS access technology.\nNot applicable.\nNot applicable.\nThe UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "H.2A\tUsage of SDP",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "H.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "H.2A.1\tImpact on SDP offer / answer of activation or modification of IP-CAN for media by the network",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "H.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "No additional procedures defined.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "H.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "H.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "H.3.1.0\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "If the UE is aware of the access technology, the UE shall include the P-Access-Network-Info header field where indicated in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.2\tAvailability for calls",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.2A\tAvailability for SMS",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.3\tAuthorization header field",
                            "text_content": "When using SIP digest or SIP digest without , the UE need not include an Authorization header field on sending a REGISTER request, as defined in subclause 5.1.1.2.1.\nNOTE:\tIn case the Authorization header field is absent, the mechanism only supports that one public user identity is associated with only one private user identity. The public user identity is set so that it is possible to derive the private user identity from the public user identity by removing SIP  scheme and the following parts of the SIP  if present: port number,  parameters, and To header field parameters. Therefore, the public user identity used for registration in this case cannot be shared across multiple UEs. Deployment scenarios that require public user identities to be shared across multiple UEs that don't include an private user identity in the initial REGISTER request can be supported as follows:\n- Assign each sharing UE a unique public user identity to be used for registration,\n- Assign the shared public user identitiess to the implicit registration set of the unique registering public user identities assigned to each sharing UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.5\t3GPP PS data off",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.6\tTransport mechanisms",
                            "text_content": "No additional requirements are defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.1.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "H.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "H.3.2.0\tRegistration and authentication",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "If the access-type field in the P-Access-Network-Info header field indicated DOCSIS access the P-CSCF shall assume that the initial request for a dialog or standalone transaction or an unknown method destined for a PSAP is initiated in the same country.\nNOTE 1:\tIf local policy does not require the insertion of P-Access-Network-Info header field in the P-CSCF even if it is missing in the received initial request, the P-CSCF can assume that the request is initiated by fixed broadband UE in the same country.\nNOTE 2:\tIf the network provided and UE provided P-Access-Network-Info header fields indicate different access types the P-CSCF ignores the information in either the network provided or the UE provided P-Access-Network-Info header field according to operator policy.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.2.2\tLocation information handling",
                            "text_content": "Upon receipt of an initial request for a dialog or standalone transaction or an unknown method, the P-CSCF based on local policy may include a P-Access-Network-Info header field.\nNOTE:\tThe way the P-CSCF deduces that the request comes from a UE connected through DOCSIS access is implementation dependent.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.2.6\tResource sharing",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.2.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "H.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "H.3.3.1\tNotification of AS about registration status",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "H.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "H.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "H.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "H.5\tUse of circuit-switched domain",
            "description": "There is no CS domain in this access technology.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.1\tScope",
            "description": "Additional routeing functionality is necessary for support of:\n-\ttransit traffic as operators may use the IM CN subsystem as a transit network to provide transit functionality for their own CS networks, enterprise networks, or other network operators;\n-\tother traffics such as roaming traffic and incoming traffic destined to CSI UEs (Combining Circuit Switched (CS) and IP Multimedia Subsystem (IMS) services) traffics;\n-\ttraffic for the roaming architecture for voice over IMS with local breakout; and\n-\toriginating traffic if required by local policy as specified in subclause 5.4.3.2.\nDepending on the additional routeing functionalities, the required specific functions may reside in a stand-alone entity or may be collocated with an MGCF, a BGCF, an I-CSCF, an S-CSCF, or an IBCF as appropriate for the specific scenario.\nWhen colocated with an I-CSCF, the additional routeing capabilities may be performed in advance of I-CSCF procedures as specified in subclause 5.3, or after I-CSCF procedures have failed to identify an S-CSCF supporting the user identified by the Request-.\nWhen colocated with an MGCF, the generated requests can be routed to an I-CSCF or to possible targets of the routeing procedures defined in subclause I.2.\nThe BGCF procedures specified in subclause 5.6 are a subset of the more general routeing procedures provided in this annex.\nNOTE:\tDepending on the host entity for the additional routeing functions, the functionality can be accessed as:\na)\tthe last set of functions on the host before forwarding a request (e.g., on an MGCF, an S-CSCF or an IBCF);\nb)\tthe first set of functions performed by the host entity when receiving a request at the host entity's entry point (e.g., on a BGCF, I-CSCF or IBCF);\nc)\ta specified point in the logic of the host (e.g., on the I-CSCF at failure to identify an S-CSCF for the Request-); or\nd)\ta set of functions associated with a separate entry point (e.g., at a separate entry point associated with a BGCF, I-CSCF, IBCF or stand-alone entity).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.1A\tGeneral",
            "description": "For all SIP transactions identified, if priority is supported, as containing an authorised Resource-Priority header field, or, if such an option is supported, relating to a dialog which previously contained an authorised Resource-Priority header field. The additional routeing functionality shall give priority over other transactions or dialogs. This allows special treatment of such transactions or dialogs. If priority is supported, the priority treatment of transactions or dialogs shall be adjusted according to the most recently received authorized Resource-Priority header field or backwards indication value.\nNOTE 1:\tThe special treatment can include filtering, higher priority processing, routeing, call gapping. The exact meaning of priority is not defined further in this document, but is left to national regulation and network configuration.\nNOTE 2:\tThese SIP transactions are exempt from network management controls.\nIf logging is in progress for this dialog, check whether a trigger for stopping logging of SIP signalling has occurred, as described in RFC 8497 [140] and configured in the trace management object defined in 3GPP TS 24.323 [8K]. If a stop trigger event has occurred then stop logging of signalling, else determine, by checking its debug configuration, whether to log the response.\nWith the exception of 305 (Use Proxy) responses, the additional routeing functionality shall not recurse on 3xx responses.\nIf the additional routeing functionality inserts its own Record-Route header field, then the additional routeing functionality may require the periodic refreshment of the session to avoid hung states. If the network element requires the session to be refreshed, the additional routeing functionality shall apply the procedures described in RFC 4028 [58] clause 8.\nNOTE 3:\tRequesting the session to be refreshed requires support by at least one of the UEs. This functionality cannot automatically be granted, i.e. at least one of the involved UEs needs to support it.\nBased on local policy the additional routeing function shall add in requests and in responses in the P-Charging-Vector header field a \"transit-ioi\" header field parameter with an entry which identifies the operator network which the request or response is transitting or with a void entry.\nBased on local policy the additional routeing function shall delete or void in requests and in responses in the P-Charging-Vector header field any received \"transit-ioi\" header field parameter value.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.2\tOriginating, transit and interconnection routeing procedures",
            "description": "The additional routeing functionality, or associated functional entity, performing these additional routeing procedures should analyse the destination address, and determine whether to route to another network, directly, or via the IBCF, or to the BGCF, the MGCF or the I-CSCF in its own network. This analysis may use public (e.g., DNS, ENUM) and/or private database lookups, and/or locally configured data and may, based on operator policy, modify the Request- (e.g. to remove number prefixes, to translate local numbers to global numbers, to update the Request-URI with the URI including an obtained ported-to routeing number, etc).\nIn addition, and based upon local policy, the analysis may include the carrier identified by the \"cic\" tel- parameter of the Request- and other signalling information from the incoming request as part of the route determination. Examples of other signalling information are: the content of the P-Access-Network-Info header field, the value of the \"cpc\" tel  parameter of the P-Asserted-Identity header field, the value of the \"phone-context\" Tel  parameter of the Request-, the SDP content, the ICSI values in the Contact header field and the content of the P-Asserted-Service header field.\nIf the additional routeing functionality decides that the request shall be routed via a specific entity (e.g. IBCF), it shall insert the  of this entity in the Route header of the request.\nWhen provided as a stand-alone entity, the network element performing these functions need not Record-Route the INVITE request.\nWhen provided as a stand-alone entity, the network element performing these functions shall not apply the procedures of RFC 3323 [33] relating to privacy.\nIf overlap signalling using the multiple-INVITE method is supported as a network option, several INVITE requests with the same Call ID and same From header field (including \"tag\" header field parameter) can be received outside of an existing dialog. Such INVITE requests relate to the same call and the additional routeing function shall route such INVITE request received during a certain period of timeto the same next hop.\nWhen colocated with a MGCF, based on local policy for calls originated from circuit-switched networks, if the circuit-switched is a transit network the additional routeing function shall add in requests in the P-Charging-Vector header field a \"transit-ioi\" header field parameter with an entry which identifies the PSTN network which the request was transitting or with a void entry.\nNOTE 1:\tOnly one \"transit-ioi\" header field parameter entry is added per transit network.\nNOTE 2:\tThe local policy can take bilateral agreements between operators into consideration.\nThe entity implementing the additional routeing functionality shall remove the P-Served-User header field prior to forwarding the request.\nIf\na)\tthe additional routeing functionality supports indicating the traffic leg as specified in RFC 7549 [225];\nb)\tthe Request- does not already include an \"iotl\" SIP  parameter, and\nNOTE 3:\tIf an \"iotl\" SIP  parameter is included it contains the value \"visitedA-homeB\" inserted by the TRF in the roaming architecture for voice over IMS with local breakout scenario.\nc)\trequired by local policy;\nthen the additional routeing functionality shall:\na)\tif the Request- contains a SIP , append the \"iotl\" SIP  parameter set to \"homeA-homeB\" to the Request-; and\nb)\tif the Request- contains a tel :\n-\tconvert the tel  in the Request- to the form of a SIP  with user=phone; and\n-\tappend an \"iotl\" SIP  parameter with a value set to \"homeA-homeB\" in the Request-.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.3\tProviding IMS application services in support of transit & interconnection traffics",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "I.3.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "When the IM CN subsystem provides transit functionality to other operator networks or enterprise networks, it may also provide IMS applications services to the operator network or enterprise network.\nThe transit service invocation, performed by a transit function, is performed based on local configured transit invocation criteria that are provided for the specific transit scenario.\nNOTE:\tThe transit invocation criteria for invocation is intended to be per served network basis, for which transit functionality is provided, and not per subscriber basis.\nSimilar to the initial filter criteria for a user profile, the transit invocation criteria may have service point triggers, used to generate an ordered list of transit invocation criteria to be applied to a request, based on different information in the request, SIP method, SIP header field, and SIP body. The service invocation procedure shall support suppression/avoidance of conflicting services, multiple invocations of the same service and loopback scenarios.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "I.3.2\tProcedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "I.3.2.1\tTreatment for dialog and standalone transactions",
                            "text_content": "When the transit function receives an initial request for a dialog, or a request for a standalone transaction, and the request is received either from a functional entity within the same trust domain or contains a valid original dialog identifier (see step 3) or the dialog identifier (From, To and Call-ID header fields) relates to an existing request processed by the transit function, then prior to forwarding the request, the transit function shall:\n1)\tcheck if an original dialog identifier that the transit function previously placed in a Route header field is present in the topmost Route header field of the incoming request.\n-\tIf not present, the transit function shall build an ordered list of transit invocation criteria.\n-\tIf present, the request has been sent from an AS in response to a previously sent request, an ordered list of transit invocation criteria already exists and the transit function shall not change the ordered list of transit invocation criteria.\n2)\tremove its own SIP  from the topmost Route header field;\n3)\tcheck whether the initial request matches any unexecuted transit invocation criteria. If there is a match, then the transit function shall select the first matching unexecuted transit invocation criteria from the ordered list of transit invocation criteria and the transit function shall insert the AS  to be contacted into the Route header field as the topmost entry followed by its own  populated;\nNOTE:\tDepending on the result of processing the transit invocation criteria the transit function can contact one or more AS(s) before processing the outgoing Request-.\n4)\tif the request is not forwarded to an AS and if local policy requires the application of other additional routeing capabilities, handled by entities other than the transit function, the transit function shall apply the additional routeing capabilities if they are locally available or forward the request to an entity that implements the additional routeing capabilities;\n5)\tdetermine the destination address (e.g. DNS access) using the  placed in the topmost Route header field if present, otherwise based on the Request-. If the destination requires interconnect functionalities (e.g. the destination address is of an IP address type other than the IP address type used in the IM CN subsystem), the transit function shall forward the request to the destination address via an IBCF in the same network;\n6)\tin case of an initial request for a dialog, based on local policy record-route; and\n7)\troute the request based on SIP routeing procedures.\nWhen the transit function receives a target refresh request, or a a subsequent request other than target refresh request, for a dialog, prior to forwarding the request, the transit function shall:\n1)\tremove its own  from the topmost Route header field; and\n2)\tforward the request based on the topmost Route header field.\nWith the exception of 305 (Use Proxy) responses, the transit function shall not recurse on 3xx responses.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.3.2.1A\tHandling of header fields related to charging",
                            "text_content": "When the transit function receives a request from a functional entity that is not an AS and if the request is forwarded to an AS the transit function shall:\n-\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present;\nNOTE 1:\tAny received \"orig-ioi\" header field parameter will be a type 2 IOI. The type 2 IOI identifies the service provider from which the request was sent.\n-\tremove the \"orig-ioi\" header field parameter from the P-Charging-Vector header field, if present;\n-\tstore the value of the \"transit-ioi\" header field parameter and remove the \"transit-ioi\" header field parameter, if present; and\n-\tinsert in the P-Charging-Vector header field an IOI type 3 value in an \"orig-ioi\" header field parameter identifying the network sending the request and based on operator option a Relayed-Charge header field with contents set to the value of the received \"transit-ioi\" header field parameter.\nWhen forwarding the request from an AS to a functional entity that is not an AS the transit function shall:\n-\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field if present;\nNOTE 2:\tAny received \"orig-ioi\" header field parameter will be a type 3 IOI. The type 3 IOI identifies the service provider from which the request was sent.\n-\tremove the \"orig-ioi\" header field parameter from the P-Charging-Vector header field, if present; and\n-\tinsert in the P-Charging-Vector header field the \"orig-ioi\" header field parameter with the IOI type 2 value stored when the initial request for a dialog or the request for a standalone transaction was received from an entity that was not an AS;\n-\tinsert the \"transit-ioi\" header field parameter if previously stored; and\n-\tremove the Relayed-Charge header field, if present.\nWhen the transit function receives a 1xx or 2xx response to a request from a functional entity that is not an AS and if the response is forwarded to an AS the transit function shall:\n-\tstore the values of the \"orig-ioi\", the \"term-ioi\" and the \"transit-ioi\" header field parameter received in the P-Charging-Vector header field if present;\nNOTE 3:\tAny received \"term-ioi\" header field parameter will be a type 2 IOI. The type 2 IOI identifies the service provider from which the response was sent.\n-\tremove the \"orig-ioi\", the \"term-ioi\", and the \"transit-ioi\" header field parameters from the P-Charging-Vector header field, if present; and\n-\tinsert in the P-Charging-Vector header field an IOI type 3 value in a \"term-ioi\" header field parameter identifying the network sending the response, an IOI type 3 value in an \"orig-ioi\" header field parameter stored when the request was received from an AS, and based on operator option a Relayed-Charge header field with contents set to the value of the received \"transit-ioi\" header field parameter.\nWhen forwarding any response to a request from an AS to a functional entity that is not an AS the transit function shall remove the Relayed-Charge header field, if present.\nWhen forwarding the 1xx or 2xx response to a request from an AS to a functional entity that is not an AS the transit function shall:\n-\tremove the \"orig-ioi\" and the \"term-ioi\" header field parameter from the P-Charging-Vector header field, if present; and\nNOTE 4:\tAny received \"term-ioi\" and \"orig-ioi\" header field parameter will be a type 3 IOI. The type 3 IOI identifies the service provider from which the response was sent.\n-\tinsert in the P-Charging-Vector header field an \"orig-ioi\" header field parameter with the IOI type 2 value, an \"term-ioi\" header field parameter with the IOI type 2 value received in the 1xx or 2xx response to the request from a functional entity that was not an AS, insert the \"transit-ioi\" header field parameter if previously stored.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.3.2.2\tOriginal dialog identifier for transit function",
                            "text_content": "The original dialog identifier is an implementation specific token that the transit function encodes into the own transit function  in a Route header field, prior to forwarding the request to an AS. This is possible because the transit function is the only entity that creates and consumes the value.\nThe token may identify the original dialog of the request, so in case an AS acting as a B2BUA changes the dialog, the transit function is able to identify the original dialog when the request returns to the transit function. In a case of a standalone transaction, the token indicates that the request has been sent to the transit function from an AS in response to a previously sent request. The token can be encoded in different ways, such as e.g., a character string in the user-part of the transit function , a parameter in the transit function  or port number in the transit function .\nThe transit function shall ensure that the value chosen is unique, in order for the transit function to recognize the value when received in a subsequent message of one or more dialogs and make the proper association between related dialogs that pass through an AS.\nAn original dialog identifier is sent to each AS invoked due to transit invocation criteria evaluation such that the transit function can associate requests as part of the same sequence that trigger transit invocation criteria evaluation in priority order (and not rely on SIP dialog information that may change due to B2BUA AS).\nNOTE:\tIf the same original dialog identifier is included in more than one request from a particular AS (based on service logic in the AS), then the transit function will continue the transit invocation criteria evaluation sequence. If the AS wants transit invocation criteria evaluation to start from the beginning for a request, then AS does not include an original dialog identifier.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "I.4\tLoopback routeing procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "I.4.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "In order to support traffics for the roaming architecture for voice over IMS with local breakout the additional routeing functionality will perform the procedures described in this subclause. An additional routeing functionality performing the procedures in this subclause is always located in the visited PLMN and is referred to as Transit and Roaming Function (TRF).\nThe TRF performs local break out and routes the INVITE request via a specific entity e.g. IBCF or BGCF.\nLoopback routeing requires support in the visited network and the home network. If the visited network supports loopback routeing then the P-CSCF will, based on local policy, express this support by adding a g.3gpp.trf feature-capability indicator value to the  of the desired TRF.\nThe home network decides based on local operator policy if loopback routeing shall be applied. If loopback routeing is applied, the home network routes the INVITE request back to the TRF located in the visited network indicating that loopback routeing is used by including the g.3gpp.loopback feature-capability indicator in a Feature-Caps header field.\nIn the loopback scenario OMR as specified in 3GPP TS 29.079 [11D] is used to determine the optimal media path between the visited network and the terminating network without passing through the home network.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "I.4.2\tTRF procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "When the TRF receives an initial request for a dialog, the TRF shall:\n1)\tretain the \"icid-value\" header field parameter in the P-Charging-Vector header field;\n2)\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field, if present, and remove the \"orig-ioi\" header field parameter from the P-Charging-Vector header field. Insert a type 2 \"orig-ioi\" header field parameter into the P-Charging-Vector header field. Set the type 2 \"orig-ioi\" header field parameter to a value that identifies the sending network in which the TRF resides. The TRF shall not include the \"term-ioi\" header field parameter. Store the value of a \"transit-ioi\" header field parameter received in the P-Charging-Vector header field, if present, and remove the \"transit-ioi\" header field parameter from the P-Charging-Vector header field before forwarding the request;\n3)\tif required by local policy, perform number normalization and enum translation in the same way as performed by S-CSCF in subclause 5.4.3.2 step 10);\n4)\tif the P-Access-Network header field is available, determine the entity for local break out (e.g. IBCF or BGCF) using:\na)\tthe location of the originating user; and\nb)\tthe destination address,\nthen include a Route header field set to the  associated with the determined entity in the forwarded request;\n5)\tcreate a Record-Route header field containing the TRF own SIP ;\n6)\tremove the \"+g.3gpp.loopback\" header field parameter from the Feature-Caps header field of the outgoing request;\n6A)\tif the TRF supports indicating the traffic leg as specified in RFC 7549 [225] and required by local policy:\na)\tif the Request- in the INVITE request contains a SIP , append an \"iotl\" SIP  parameter set to \"visitedA-homeB\" to the Request-; and\nb)\tif the Request- in the INVITE request contains a tel :\n-\tconvert the tel  in the Request- to the form of a SIP  with user=phone; and\n-\tappend the \"iotl\" SIP  parameter set to \"visitedA-homeB\" in the Request-; and\n7)\troute the request based on SIP routeing procedures.\nWhen the TRF receives a 1xx or 2xx response to the INVITE request above, the TRF shall:\n-\tstore the value of the \"transit-ioi\" header field parameter received in the P-Charging-Vector header field and remove the \"transit-ioi\" header field parameter from the P-Charging-Vector header field, if present;\n-\tremove the \"orig-ioi\" header field parameter and the \"term-ioi\" header field parameter from the P-Charging-Vector header field before forwarding the response; and\nNOTE:\tAny received \"term-ioi\" header field parameter will be a type 2 IOI identifying the sending network of the response.\n-\tinsert in the P-Charging-Vector header field the \"orig-ioi\" header field parameter, if received in the request, and the type 1 \"term-ioi\" header field parameter in the response. The TRF shall set the type 1 \"term-ioi\" header field parameter to a value that identifies the network in which the TRF resides and the type 1 \"orig-ioi\" header field parameter is set to the previously received value of the type 1 \"orig-ioi\" header field parameter.\nWhen the TRF receives subsequent requests or responses to subsequent requests containing the \"+g.3gpp.loopback\" header field parameter from the Feature-Caps header field, the TRF shall remove the \"+g.3gpp.loopback\" header field parameter from the Feature-Caps header field of the outgoing request or the outgoing response.\nWhen the TRF receives responses to initial or subsequent requests from the terminating side, the TRF shall insert in the P-Charging-Vector header field, if present, the \"loopback\" header field parameter to the outgoing response.\nWhen the TRF receives subsequent requests from the terminating side, the TRF shall insert in the P-Charging-Vector header field, if present, the \"loopback\" header field parameter to the outgoing request.\nWhen the TRF receives a subsequent request, the TRF shall:\n1)\tretain the \"icid-value\" header field parameter in the P-Charging-Vector header field;\n2)\tstore the value of the \"orig-ioi\" header field parameter received in the P-Charging-Vector header field, if present, and remove the \"orig-ioi\" header field parameter from the P-Charging-Vector header field;\n3)\tif the subsequent request is:\na)\treceived from originating home network and forwarded to terminating home network, insert a type 2 \"orig-ioi\" header field parameter into the P-Charging-Vector header field, and set the type 2 \"orig-ioi\" header field parameter to a value that identifies the sending network in which the TRF resides. The TRF shall not include the \"term-ioi\" header field parameter; or\nb)\treceived from terminating home network and forwarded to originating home network, insert a type 1 \"orig-ioi\" header field parameter into the P-Charging-Vector header field, and set the type 1 \"orig-ioi\" header field parameter to a value that identifies the sending network in which the TRF resides. The TRF shall not include the \"term-ioi\" header field parameter; and\n4)\tstore the value of a \"transit-ioi\" header field parameter received in the P-Charging-Vector header field, if present, and remove the \"transit-ioi\" header field parameter from the P-Charging-Vector header field before forwarding the request.\nWhen the TRF receives a response to a subsequent request, the TRF shall:\n1)\tstore the value of the \"transit-ioi\" header field parameter received in the P-Charging-Vector header field and remove the \"transit-ioi\" header field parameter from the P-Charging-Vector header field, if present;\n2)\tremove the \"orig-ioi\" header field parameter and the \"term-ioi\" header field parameter from the P-Charging-Vector header field before forwarding the response; and\n3)\tif the response to the subsequent request is:\na)\treceived from terminating home network and forwarded to originating home network, insert in the P-Charging-Vector header field the \"orig-ioi\" header field parameter, if received in the request, and the type 1 \"term-ioi\" header field parameter in the response. The TRF shall set the type 1 \"term-ioi\" header field parameter to a value that identifies the network in which the TRF resides and the type 1 \"orig-ioi\" header field parameter is set to the previously received value of the type 1 \"orig-ioi\" header field parameter; and\nb)\treceived from originating home network and forwarded to terminating home network, insert in the P-Charging-Vector header field the \"orig-ioi\" header field parameter, if received in the request, and the type 2 \"term-ioi\" header field parameter in the response. The TRF shall set the type 2 \"term-ioi\" header field parameter to a value that identifies the network in which the TRF resides and the type 2 \"orig-ioi\" header field parameter is set to the previously received value of the type 2 \"orig-ioi\" header field parameter.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "I.5\tOverload control",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "I.5.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "The additional routeing functionality, or associated functional entity, performing additional routeing procedures described in I.3 may support the event-based overload control mechanism.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "I.5.2\tOutgoing subscriptions to load-control event",
                    "description": "",
                    "summary": "",
                    "text_content": "Based on operator policy, the additional routeing functionality may subscribe to the load-control event package with one ore more target SIP entities. The list of target SIP entities is provisioned.\nSubscription to the load-control event package is triggered by internal events (e.g. the physical device hosting the SIP entity is power-cycled) or through a management interface.\nThe AS shall perform subscriptions to the load-control event package to a target entity in accordance with RFC 6665 [28] and with RFC 7200 [201]. When subscribing to the load-control event, additional routeing functionality shall:\n1)\tSend a SUBSCRIBE request in accordance with RFC 6665 [28] and with RFC 7200 [201] to the target entity, with the following elements:\n-\tan Expires header field set to a network specific value;\n2)\tIf the target entity is located in a different network and local policy requires the application of IBCF capabilities, forward the request to an IBCF acting as an exit point.\nThe additional routeing functionalit shall automatically refresh ongoing subscriptions to the load-control event package either 600 seconds before the expiration time if the initial subscription was for greater than 1200 seconds, or when half of the time has expired if the initial subscription was for 1200 seconds or less.\nThe additional routeing functionality can terminate a subscription according to RFC 6665 [28].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "K.1\tScope",
            "description": "This annex describes the UE, P-CSCF, and S-CSCF procedures in support of UE managed  traversal. For ICE, the IBCF procedures are also described. In this scenario, both the media flows and the SIP signalling both traverse a (P)T device located in the customer premises domain. The term \"hosted \" is used to address this function. This annex does not consider the case where the  is behind the P-CSCF as different  traversal procedures are necessary for this architectural scenario.\nThe procedures described in this subclause of this annex rely on the UE to manage the  traversal process. As part of the UE management process, the UE can learn whether it is behind a  or not, and choose whether the proceedures in this annex are applied or not.\nThe protection of SIP messages is provided by applying either UDP encapsulation to IPSec packets in accordance with RFC 3948 [63A] and as defined in 3GPP TS 33.203 [19] or by utilizing  as defined in 3GPP TS 33.203 [19].\nNOTE 1:\tThis annex describes the mechanism for support of UE managed  traversal scenario defined in 3GPP TS 23.228 [7]. This does not preclude other mechanisms but they are out of the scope of this annex.\nNOTE 2:\tIt is recognized that outbound can be useful for capabilities beyond  traversal (e.g. multiple registrations) however this annex does not consider such capabilities at this time. Such capabilites can require additional information elements in the REGISTER request so that the P-CSCF and S-CSCF can distinguish whether to apply procedures as of annex F or annex K.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "K.2\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "K.2.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "K.2.1.1\tGeneral",
                            "text_content": "This subclause describes the UE SIP procedures for supporting a UE managed hosted  traversal approach. The description enhances the procedures specified in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.1.2\tRegistration and authentication",
                            "text_content": "The text in subclause 5.1.1.1 applies without changes.\nThe text in subclause 5.1.1.1A applies without changes.\nThe text in subclause 5.1.1.1B applies without changes.\nThe procedures described in subclause 5.1.1.2.1 apply with the additional procedures described in the present subclause.\nNOTE 1:\tIn accordance with the definitions given in subclause 3.1 the IP address acquired initially by the UE in a hosted  scenario is the UE private IP address.\nOn sending a REGISTER request, the UE shall populate the header fields as indicated in subitems a) through j) of subclause 5.1.1.2 with the exceptions of subitems c) and d) which are modified as follows.\nThe UE shall populate:\nc)\ta Contact header field according to the following rules: the Contact header field shall be set to include SIP (s) containing the private IP address or FQDN of the UE in the hostport parameter. The UE shall also include an instance ID (\"+sip.instance\" header field parameter) and \"reg-id\" header field parameter as described in RFC 5626 [92]. The UE shall include all supported ICSI values (coded as specified in subclause 7.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 and RFC 3840 [62] for the IMS communication services it intends to use, and IARI values (coded as specified in subclause 7.2A.9.2), for theIMS applications it intends to use in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3840 [62];\nd)\ta Via header field set to include the private IP address or FQDN of the UE in the sent-by field. For , the response is received on the  connection on which the request was sent. For UDP, the UE shall include the \"rport\" header field parameter as defined in RFC 3581 [56A].\nNOTE 2:\tThe UE will learn its public IP address from the \"received\" header field parameter in the topmost Via header field in the 401 (Unauthorized) response to the unprotected REGISTER request.\nNOTE 3:\tIf the UE specifies a FQDN in the hostport parameter in the Contact header field and in the sent-by field in the Via header field of an unprotected REGISTER request, this FQDN will not be subject to any processing by the P-CSCF or other IMS entities.\nWhen a 401 (Unauthorized) response to a REGISTER request is received with integrity protection the UE shall behave as described in subclause K.2.1.2.5.\nWhen a 401 (Unauthorized) response to a REGISTER request is received and this response is received without integrity protection, the procedures described in subclause 5.1.1.2 apply with the following additions:\nThe UE shall compare the IP address in the \"received\" header field parameter with the corresponding value in the sent-by parameter in the topmost Via header field to detect if the UE is behind a . If the comparison indicates that the respective values are the same, the UE concludes that it is not behind a .\n-\tif the UE is not behind a  the UE shall proceed with the procedures described in subclause 5.1;\n-\tif the UE is behind a  the UE shall verify using the Security-Server header field that either the mechanism-name \"tls\" or \"ipsec-3gpp\" and the mode \"UDP-enc-tun\" is selected. If the verification succeeds the UE shall behave as described in subclause K.2.1.2.5 and store the IP address contained in the \"received\" header field parameter as the UE's public IP address. If the verification does not succeed the UE shall abort the registration.\nOn receiving the 200 (OK) response to the REGISTER request, the procedures described in subclause 5.1.1.2 apply with the following additions:\nThe UE shall determine the P-CSCFs ability to support the keep-alive procedures as described in RFC 5626 [92] by checking whether the \"outbound\" option-tag is present in the Require header field:\n-\tif no \"outbound\" option-tag is present, the UE may use some other explicit indication in order to find out whether the P-CSCF supports the outbound edge proxy functionality. Such indication may be acomplished either through UE local configuration means or the UE can examine the 200 (OK) response to its REGISTER request for Path header fields, and if such are present check whether the bottommost Path header field contains the \"ob\" SIP  parameter. If the UE determines that the P-CSCF supports the outbound edge proxy functionality, the UE can use the keep-alive techniques defined in subclause K.2.1.5 and RFC 5626 [92] towards the P-CSCF; or\n-\tif an \"outbound\" option-tag is present, the UE shall initiate keep-alive mechanisms as defined in subclause K.2.1.5 and RFC 5626 [92] towards the P-CSCF.\nNOTE 4:\tPresence of the \"outbound\" option-tag in the Require header field indicates that both the P-CSCF and S-CSCF fully support the outbound procedures. The number of subsequent outbound registrations for the same private user identity but with a different reg-id value is based on operator policy.\nThe procedures described in subclause 5.1.1.2.2 apply with the additional procedures described in the present subclause.\nOn sending a REGISTER request, the UE shall populate the header fields as indicated in subclause 5.1.1.2.2 with the exceptions of the subitems which are modified as follows:\nc)\tadditionally for the Via header field, for UDP, if the REGISTER request is protected by a security association, include the public IP address or FQDN and the protected server port value in the sent-by field. For , if the REGISTER request is protected by a security association, the UE shall include the public IP address or FQDN;\nd)\tthe Security-Client header field set to specify the security mechanisms the UE supports, the IPsec layer algorithms the UE supports and the parameters needed for the security association setup. The UE shall support the setup of two pairs of security associations as defined in 3GPP TS 33.203 [19]. The syntax of the parameters needed for the security association setup is specified in annex H of 3GPP TS 33.203 [19]. The UE shall support the \"ipsec-3gpp\" security mechanism, as specified in RFC 3329 [48]. The UE shall support the IPsec layer algorithms for integrity and confidentiality protection as defined in 3GPP TS 33.203 [19], and shall announce support for them according to the procedures defined in RFC 3329 [48]. In addition to transport mode, the UE shall support UDP encapsulated tunnel mode as per RFC 3948 [73A] and shall announce support for both modes as described in 3GPP TS 33.203 [19];\nThe procedures described in subclause 5.1.1.2.3 apply without modification.\nThe procedures described in subclause 5.1.1.2.4 apply without modification.\nThe procedures described in subclause 5.1.1.2.5 apply without modification.\nThe procedures described in subclause 5.1.1.3 apply with the additional procedures described in subclause K.2.1.4.1.\nThe procedures described in subclause 5.1.1.4 apply with the additional procedures described in the present subclause.\nOn sending a REGISTER request that does not contain a challenge response, the UE shall populate the header fields as indicated in subclause 5.1.1.4.1 with the exception of subitems c) and d) which are modified as follows.\nThe UE shall populate:\nc)\ta Contact header field set to include SIP (s) that contain(s) in the hostport parameter the private IP address of the UE or FQDN, its instance ID (\"+sip.instance\" header field parameter) along with the same \"reg-id\" header field parameter used for the initial, successful, registration for the given P-CSCF public identity combination as described in RFC 5626 [92]. The UE shall include all supported ICSI values (coded as specified in subclause 7.2A.8.2) in a g.3gpp.icsi-ref media feature tag as defined in subclause 7.9.2 and RFC 3840 [62] for the IMS communication services it intends to use, and IARI values (coded as specified in subclause 7.2A.9.2), for the IMS applications it intends to use in a g.3gpp.iari-ref media feature tag as defined in subclause 7.9.3 and RFC 3840 [62]; and\nd)\ta Via header field according to the following rules:\n-\tFor UDP, the UE shall include the public IP address or FQDN in the sent-by field. The UE shall also include the \"rport\" header field parameter as defined in RFC 3581 [56A]. The UE shall only use an FQDN, if it is ensured that the FQDN resolves to the public IP address of the ; or\n-\tFor , the UE shall include the public IP address or FQDN of the UE in the sent-by field. The UE shall only use an FQDN, if it is ensured that the FQDN resolves to the public IP address of the ;\nWhen the timer F expires at the UE, the UE shall:\n1)\tstop processing of all ongoing dialogs and transactions associated with that, if any (i.e. no further SIP signalling will be sent by the UE on behalf of these transactions or dialogs); and\n2)\tafter releasing all IP-CAN bearers used for the transport of media according to the procedures in subclause 9.2.2, the UE shall follow the procedures in RFC 5626 [92] to form a new flow to replace the failed one. When registering to create a new flow to replace the failed one, procedures in subclause 5.1.1.2 apply.\nNOTE:\tThese actions can also be triggered as a result of the failure of a STUN keep-alive. It is an implementation option whether these actions are also triggered by other means than expiration of timer F, e.g., based on ICMP messages.\nIf failed registration attempts occur in the process of creating a new flow, the flow recovery procedures defined in RFC 5626 [92] shall apply.\nThe procedures described in subclause 5.1.1.4.2 apply without modification.\nThe procedures described in subclause 5.1.1.4.3 apply without modification.\nThe procedures described in subclause 5.1.1.4.4 apply without modification.\nThe procedures described in subclause 5.1.1.4.5 apply without modification.\nThe procedures of subclause 5.1.1.5.1 apply with the additional procedures described in the present subclause.\nOn receiving a 401 (Unauthorized) response to the REGISTER request and the response is deemed to be valid and signalling security is to be used, the UE shall behave as of subclause 5.1.1.5.1 with the exception of subitem 3) which is modified as follows.\nThe UE shall:\n3)\tsend another REGISTER request using the temporary set of security associations to protect the message. The header fields are populated as defined for the initial registration (see subclause K.2.1.2.2), with the addition that the UE shall include an Authorization header field containing the private user identity and if the \"algorithm\" header field parameter is \"AKAv1-MD5\" or \"AKAv2-SHA-256\", the authentication challenge response shall be calculated by the UE using  and other parameters, as described in RFC 3310 [49] when AKAv1 is used or as described in RFC 4169 [227] when AKAv2 is used. If the \"algorithm\" header field parameter is \"MD5\" or \"SHA2-256\", the UE shall calculate SIP digest-response parameters as indicated in RFC 7616 [286] and RFC 8760 [287] and shall build an Authorization header field based on these parameters. The UE shall also insert the Security-Client header field that is identical to the Security-Client header field that was included in the previous REGISTER request (i.e. the REGISTER request that was challenged with the received 401 (Unauthorized) response). The UE shall also insert the Security-Verify header field into the request, by mirroring in it the content of the Security-Server header field received in the 401 (Unauthorized) response. The UE shall set the Call-ID of the integrity-protected REGISTER request which carries the authentication challenge response to the same value as the Call-ID of the 401 (Unauthorized) response which carried the challenge.\nNOTE:\tThe \"AKAv1-MD5\" and \"MD5\" algorithms are only supported for backward compatibility.\nFor IPsec, if the 200 (OK) response is not received before the temporary SIP level lifetime of the temporary set of security associations expires or a 403 (Forbidden) response is received, the UE shall consider the registration to have failed. The UE shall delete the temporary set of security associations it was trying to establish, and use the old set of security associations. The UE should send an unprotected REGISTER request according to the procedure specified in subclause K.2.1.2.2 if the UE considers the old set of security associations to be no longer active at the P-CSCF.\nThe text in subclause 5.1.1.5.3 applies without changes.\nThe text in subclause 5.1.1.5.4 applies without changes.\nThe procedures of subclause 5.1.1.5.5 apply with the additional procedures described in the present subclause.\nOn receiving a 403 (Forbidden) response, the UE shall consider the registration to have failed. If performing SIP digest with , the UE should send an initial REGISTER according to the procedure specified in subclause K.2.1.2.2 if the UE considers the  session to be no longer active at the P-CSCF.\nThe text in subclause 5.1.1.5.6 applies without changes.\nThe text in subclause 5.1.1.5.7 applies without changes.\nThe text in subclause 5.1.1.5.8 applies without changes.\nThe text in subclause 5.1.1.5.9 applies without changes.\nThe text in subclause 5.1.1.5.10 applies without changes.\nThe procedures of subclause 5.1.1.5A apply with the additional procedures described in the present subclause.\nOn starting the re-authentication procedure sending a REGISTER request that does not contain a challenge response, the UE shall behave as of subclause 5.1.1.5A with the exception of subitem 2) which is modified as follows.\nThe UE shall:\n2)\tstart the re-authentication procedures at the appropriate time (as a result of the S-CSCF procedure described in subclause 5.4.1.6) by initiating a reregistration as described in subclause K.2.1.2.4, if required.\nThe text in subclause 5.1.1.5B applies without changes.\nThe procedures of subclause 5.1.1.6.1 apply with the additional procedures described in the present subclause.\nOn sending a REGISTER request, the UE shall populate the header fields as indicated in subclause 5.1.1.6.1 with the exception of subitems c) and d) which are modified as follows.\nThe UE shall populate:\nc)\ta Contact header field set to either the value of \"*\" or SIP (s) that contain(s) in the hostport parameter the IP address of the UE or FQDN, its instance ID (\"+sip.instance\" header field parameter) along with the same \"reg-id\" header field parameter used for the initial, successful, registration for the given P-CSCF public identity combination as described in RFC 5626 [92];. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the ;\nd)\ta Via header field according to the following rules:\n-\tFor UDP, the UE shall include the public IP address or FQDN. The UE shall also include the \"rport\" header field parameter as defined in RFC 3581 [56A]. The UE shall only use an FQDN, if it is ensured that the FQDN resolves to the public IP address of the ; or\n-\tFor , the UE shall include the public IP address or FQDN of the UE in the sent-by field. The UE shall only use an FQDN, if it is ensured that the FQDN resolves to the public IP address of the ;\nNOTE:\tIn case of hosted  traversal only the UE public IP addresses are bound to security associations or  session.\nThe text in subclause 5.1.1.6.2 applies without changes.\nThe text in subclause 5.1.1.6.3 applies without changes.\nThe text in subclause 5.1.1.6.4 applies without changes.\nThe text in subclause 5.1.1.6.5 applies without changes.\nThe procedures of subclause 5.1.1.7 apply with the additional procedures described in the present subclause.\nUpon receipt of a NOTIFY request on the dialog which was generated during subscription to the reg event package as described in subclause 5.1.1.3, including one or more <registration> element(s) which were registered by this UE with:\n-\tthe state attribute set to \"terminated\" and the event attribute set to \"rejected\" or \"deactivated\"; or\n-\tthe state attribute set to \"active\" and the state attribute within the <contact> element belonging to this UE set to \"terminated\", and associated event attribute element to \"rejected\" or \"deactivated\";\nThe UE shall remove all registration details relating to these public user identities. In case of a \"deactivated\" event attribute, the UE shall start the initial registration procedure as described in subclause K.2.1.2.2. In case of a \"rejected\" event attribute, the UE shall release all dialogs related to those public user identities.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.1.3\tSubscription and notification",
                            "text_content": "The text in subclause 5.1.2 applies without changes.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.1.4\tGeneric procedures applicable to all methods excluding the REGISTER method",
                            "text_content": "The procedures described in subclause 5.1.2A.1 apply with the additional procedures described in the present subclause.\nWhen the UE sends any request, the requirements in subclause 5.1.2A.1 are extended by the following requirements. The UE shall include:\n-\ta Via header field according to the following rules:\n-\tFor UDP, the UE shall include the public IP address or FQDN and the protected server port value in the sent-by field. The UE shall also include the \"rport\" header field parameter as defined in RFC 3581 [56A]. The UE shall only use an FQDN, if it is ensured that the FQDN resolves to the public IP address of the ; or\n-\tFor , the UE shall include the public IP address or FQDN of the UE in the sent-by field. The UE shall only use an FQDN, if it is ensured that the FQDN resolves to the public IP address of the ; and\n-\tif the request contains a Contact header field, include a Contact header field according to the following rules:\n-\tif this is a request for a new or existing dialog, and the UE did insert a GRUU in the Contact header field, then the UE shall also include its instance ID (\"+sip.instance\" header field parameter), and an \"ob\" SIP  parameter as described in RFC 5626 [92]; or\n-\tif this is a request for a new or existing dialog, and the UE did not insert a GRUU in the Contact header field, then the UE shall include the public IP address of the UE or FQDN and the protected server port value bound to the security association or  session in the hostport parameter along with its instance ID (\"+sip.instance\" header field parameter), and an \"ob\" SIP  parameter as described in RFC 5626 [92]. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the .\nNOTE:\tThe means to ensure that the FQDN resolves to the public IP address of the  are outside of the scope of this specification. One option for resolving this is local configuration.\nWhere a security association or  session exists, the UE shall discard any SIP response that is not protected by the security association or  session and is received from the P-CSCF outside of the registration and authentication procedures. The requirements on the UE within the registration and authentication procedures are defined in subclause K.2.1.2.\nWhen a SIP transaction times out, i.e. timer B, timer F or timer H expires at the UE, the UE may behave as if timer F expired, as described in subclause K.2.1.2.4.\nThe procedures described in subclause 5.1.2A.2 apply with the additional procedures described in the present subclause.\nWhen the UE sends any response, the requirements in subclause 5.1.2A.2 are extended by the following requirement. If the UE did not include a GRUU in the Contact header field, then the UE shall:\n-\tinclude the public IP address of the UE or FQDN and the protected server port value bound to the security association or  session in the hostport parameter in any Contact header field that is otherwise included. The UE shall only use a FQDN, if it is ensured that the FQDN resolves to the public IP address of the .\nThe UE shall discard any SIP request that is not integrity protected and is received from the P-CSCF outside of the registration and authentication procedures. The requirements on the UE within the registration and authentication procedures are defined in subclause K.2.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.1.5\tMaintaining flows and detecting flow failures",
                            "text_content": "STUN Binding Requests are used by the UE as a keep-alive mechanism to maintain  bindings for signalling flows over connectionless transport (for dialogs outside a registration as well as within a registration) as well as to determine whether a flow (as described in RFC 5626 [92]) is still valid (e.g. a  reboot could cause the transport parameters to change). As such, the UE acts as a STUN client and shall follow the requirements defined by RFC 8489 [291]. Further, when using UDP encapsulated IPsec, the keep-alive capabilities defined within should not be used.\nCRLF as defined in RFC 5626 [92] is used by the UE as a keep-alive mechanism to maintain  bindings for signalling flows over connection oriented transports (for dialogs outside a registration as well as within a registration) as well as to determine whether a flow (as described in RFC 5626 [92]) is still valid (e.g. a  reboot could cause the transport parameters to change). As such, the UE shall follow the requirements defined by RFC 5626 [92].\nIf the UE determines that the flow to a given P-CSCF is no longer valid (the UE does not receive a STUN reply (or CRLF) or the reply indicates a new public IP Address) the UE shall consider the flow and any associated security associations invalid and perform the initial registration procedures defined in subclause K.2.1.2.2.\nWhen a  is not present, it may not be desirable to send keep-alive requests (i.e. given battery considerations for wireless UEs). As such, if a UE can reliably determine that a  is not present (i.e. by comparing the \"received\" header field parameter in the Via header field in the response to the initial un-protected REGISTER request with the locally assigned IP address) then the UE may not perform the keep-alive procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.1.6\tEmergency services",
                            "text_content": "In addition to the procedures in subclause 5.1.6.1, the following additional procedures apply. When receiving and sending requests unprotected, the UE shall transmit and receive all SIP messages using the same IP port.\nWhen a UE performs an initial emergency registration the UE shall perform the actions as specified in subclause K.2.1.2.2. The remaining procedures described in subclause 5.1.6.2 apply without modification.\nThe text in subclause 5.1.6.2A applies without changes.\nThe text in subclause 5.1.6.3 applies without changes.\nThe UE shall perform user-initiated emergency reregistration as specified in subclause K.2.1.2.4. The remaining procedures described in subclause 5.1.6.4 apply without modification.\nThe UE shall perform the authentication procedures as specified in subclause K.2.1.2.5. The remaining procedures described in subclause 5.1.6.5 apply without modification.\nThe text in subclause 5.1.6.6 applies without changes.\nThe text in subclause 5.1.6.7 applies without changes.\nThe text in subclause 5.1.6.8.1 applies without changes.\nThe text in subclause 5.1.6.8.2 applies without changes.\nAfter a successful initial emergency registration, the UE shall apply the procedures as specified in subclause K.2.1.4, subclause 5.1.3, and subclause 5.1.4. The remaining procedures described in subclause 5.1.6.8.3 apply without modification.\nThe UE shall apply the procedures as specified in subclause K.2.1.4, subclause 5.1.3, and subclause 5.1.4. The remaining procedures described in subclause 5.1.6.8.4 apply without modification.\nThe text in subclause 5.1.6.9 applies without changes.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "K.2.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "K.2.2.1\tIntroduction",
                            "text_content": "This subclause describes the SIP procedures for supporting hosted  scenarios.\nThe description enhances the procedures specified in subclause 5.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.2.2\tRegistration",
                            "text_content": "The procedures described in subclause 5.2.2.1 apply without changes.\nThe procedures described in subclause 5.2.2.2 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives a REGISTER request from the UE, the P-CSCF shall behave as in subclause 5.2.2.2 with the exception of subitems 2) and 3) which are modified as follows.\n2)\tin case the REGISTER request was received without protection, then:\na)\tcheck the existence of the Security-Client header field. If the Security-Client header field is not present and signalling security is used, then the P-CSCF shall return a suitable 4xx response. If the Security-Client header field is present the P-CSCF shall:\n-\tin case the UE indicated support for \"UDP-enc-tun\" then remove and store it; or\n-\tin case the UE does not indicate support for \"UDP-enc-tun\" then:\n-\tif the host portion of the sent-by field in the topmost Via header field contains an IP address that differs from the source address of the IP packet, silently drop the REGISTER request;\n-\totherwise continue with procedures as of subclause 5.2.2.2;\nNOTE 2:\tIf the UE does not indicate support for \"UDP-enc-tun\" and the P-CSCF detects that the UE is located behind a  device, then the P-CSCF can just drop the REGISTER request to avoid unnecessary signalling traffic.\n3)\tin case the REGISTER request was received integrity protected, then the P-CSCF shall:\na)\tcheck the security association which protected the request. If IPsec is used and the security association is a temporary one the P-CSCF shall:\n-\tin case the hostport parameter in the Contact address is in the form of a FQDN, ensure that the given FQDN will resolve (e.g., by reverse DNS lookup) to the IP address bound to the security association;\n-\tin case the P-CSCF has detected earlier that the UE is located behind a  and IPsec is being used, retrieve port_Uenc from the encapsulating UDP header of the packet received and complete configuration of the temporary set of security associations by configuring port_Uenc in each of the temporary security associations;\n-\tcheck whether the request contains a Security-Verify header field in addition to a Security-Client header field. If there are no such header fields, then the P-CSCF shall return a suitable 4xx response. If there are such header fields, then the P-CSCF shall compare the content of the Security-Verify header field with the content of the Security-Server header field sent earlier and the content of the Security-Client header field with the content of the Security-Client header field received in the challenged REGISTER request. If those do not match, then there is a potential man-in-the-middle attack. The request should be rejected by sending a suitable 4xx response. If the contents match, the P-CSCF shall remove the Security-Verify and the Security-Client header field;\nWhen the P-CSCF receives a 401 (Unauthorized) response to an unprotected REGISTER request and the P-CSCF previously determined that the UE is behind a  and the UE indicated support for \"UDP-enc-tun\" IPsec mode, the P-CSCF shall:\n1)\tdelete any temporary set of security associations established towards the UE;\n2)\tfor IPsec, remove the \"ck\" and \"ik\" -Authenticate header field parameters contained in the 401 (Unauthorized) response and bind the values to the proper private user identity and to the temporary set of security associations which will be setup as a result of this challenge. The P-CSCF shall forward the 401 (Unauthorized) response to the UE if and only if the \"ck\" and \"ik\" header field parameters have been removed;\n3)\tinsert a Security-Server header field in the response, containing the P-CSCF security list and the parameters needed.The P-CSCF shall support the setup of two pairs of security associations, as defined in 3GPP TS 33.203 [19]. The syntax of the parameters needed of the IPsec security association setup is specified in annex H of 3GPP TS 33.203 [19]. The P-CSCF shall support the \"ipsec-3gpp\" security mechanism, as specified in RFC 3329 [48]. The P-CSCF shall support the IPSec layer algorithms for integrity protection and for encryption as defined in 3GPP TS 33.203 [19]. The P-CSCF shall indicate \"UDP-enc-tun\" as the only IPsec mode.\n4)\tset up the temporary set of security associations with a temporary SIP level lifetime between the UE and the P-CSCF for the user identified with the private user identity. The P-CSCF shall select UDP encapsulated tunnel mode and shall leave the value for port-Uenc unspecified in each of the temporary security associations. For further details see 3GPP TS 33.203 [19] and RFC 3329 [48]. The P-CSCF shall set the temporary SIP level lifetime for the temporary set of security associations to the value of reg-await-auth timer; and\n5)\tsend the 401 (Unauthorized) response unprotected to the UE using the mechanisms described in RFC 3261 [26] and RFC 3581 [56A], i.e. the P-CSCF shall send the response to the IP address indicated in the \"received\" header field parameter and, in case UDP is used, to the port indicated in the \"rport\" header field parameter (if present) of the Via header field associated with the UE. In case  is used as transport protocol, the P-CSCF shall use the port on which the REGISTER request was received as client port for sending the response back to the UE.\nWhen the P-CSCF receives a 401 (Unauthorized) response to a protected REGISTER request and the P-CSCF previously determined that the UE is behind a  and that REGISTER request was protected by an old set of security associations that use UDP encapsulated tunnel mode, the P-CSCF shall:\n1)\tdelete any temporary set of security associations established towards the UE;\n2)\tremove the \"ck\" and \"ik\" -Authenticate header field parameters contained in the 401 (Unauthorized) response and bind the values to the proper private user identity and to the temporary set of security associations which will be setup as a result of this challenge. The P-CSCF shall forward the 401 (Unauthorized) response to the UE if and only if the \"ck\" and \"ik\" header field parameters have been removed;\n3)\tinsert a Security-Server header field in the response, containing the P-CSCF security list and the parameters needed for the security association setup, as specified in Annex H of 3GPP TS 33.203 [19]. The P-CSCF shall support the \"ipsec-3gpp\" security mechanism, as specified in RFC 3329 [48]. The P-CSCF shall support the IPsec layer algorithms for integrity protection and encryption as defined in 3GPP TS 33.203 [19]. The P-CSCF shall indicate \"UDP-enc-tun\" as the IPsec mode;\n4)\tset up the temporary set of security associations with a temporary SIP level lifetime between the UE and the P-CSCF for the user identified with the private user identity. The P-CSCF shall select UDP encapsulated tunnel mode and shall specify the same port_Uenc that was used in the old set of security associations. The P-CSCF shall set the temporary SIP level lifetime for the temporary set of security associations to the value of reg-await-auth timer; and\n5)\tsend the 401 (Unauthorized) response to the UE using the old set of security associations and using the rules for sending responses as described in RFC 3261 [26] and RFC 3581 [56A], i.e. the P-CSCF shall send the response to the IP address indicated in the \"received\" header field parameter and if UDP is used, to the port indicated in the \"rport\" header field parameter (if present) of the Via header field associated with the UE. Otherwise, when the P-CSCF receives a 401 (Unauthorized) response to an unprotected REGISTER request and:\n-\tthis response does not contain a \"received\" header field parameter in the Via header field associated with the UE;\n-\tthis response does not contain \"rport\" header field parameter in the Via header field associated with the UE and the request associated with the response was received using UDP; or\n-\twhen the P-CSCF receives a 401 (Unauthorized) response to a protected REGISTER request and that REGISTER request was protected by an old set of security associations that do not use UDP encapsulated tunnel mode;\nthe P-CSCF shall proceed as described in subclause 5.2.2.2 of the main body of this specification.\nThe text in subclause 5.2.2.3 applies without changes.\nThe procedures described in subclause 5.2.2.4 apply without changes.\nThe text in subclause 5.2.2.5 applies without changes.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.2.3\tGeneral treatment for all dialogs and standalone transactions excluding the REGISTER method",
                            "text_content": "The procedures described in subclause 5.2.6.3.1 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives from the UE an initial request for a dialog or a request for a standalone transaction, the requirements are extended by the following requirements.\nBefore forwarding the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26], the P-CSCF shall ensure that all signalling during the lifetime of the dialogue is sent over the same IMS flow set as the dialogue initiating request.\nNOTE:\tThe suggested way to ensure all signalling is sent over the same IMS flow set is to form an IMS flow token in the same way that a P-CSCF would form this for the Path header field and insert this IMS flow token in the user portion of the  used in the record route header field value.\nThe procedures in subclause 5.2.6.3.2 apply without changes.\nThe text in subclause 5.2.6.3.2A applies without changes.\nThe text in subclause 5.2.6.3.3 applies without changes.\nThe text in subclause 5.2.6.3.4 applies without changes.\nThe text in subclause 5.2.6.3.5 applies without changes.\nThe text in subclause 5.2.6.3.6 applies without changes.\nThe text in subclause 5.2.6.3.7 applies without changes.\nThe text in subclause 5.2.6.3.8 applies without changes.\nThe text in subclause 5.2.6.3.9 applies without changes.\nVoid\nThe text in subclause 5.2.6.3.11 applies without changes.\nVoid\nVoid\nVoid\nThe procedures described in subclause 5.2.6.4.3 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives, destined for the UE, a request, the requirements are extended by the following requirements. The P-CSCF shall:\n-\tforward the request to the terminating UE over the appropriate flow within the denoted IMS flow set.\nThe text in subclause 5.2.6.4.4 applies without changes.\nThe procedures described in subclause 5.2.6.4.5 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives, destined for the UE, a request, the requirements are extended by the following requirements. The P-CSCF shall:\n-\tforward the request to the terminating UE over the appropriate flow within the denoted IMS flow set.\nThe text in subclause 5.2.6.4.6 applies without changes.\nThe procedures described in subclause 5.2.6.4.7 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives, destined for the UE, a request, the requirements are extended by the following requirements. The P-CSCF shall:\n-\tforward the request to the terminating UE over the appropriate flow within the denoted IMS flow set.\nThe text in subclause 5.2.6.4.8 applies without changes.\nThe procedures described in subclause 5.2.6.4.9 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives, destined for the UE, a request, the requirements are extended by the following requirements. The P-CSCF shall:\n-\tforward the request to the terminating UE over the appropriate flow within the denoted IMS flow set.\nThe text in subclause 5.2.6.4.10 applies without changes.\nVoid\nVoid\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.2.5\tEmergency services",
                            "text_content": "The procedures described in subclause 5.2.10.1 apply without changes.\nThe procedures described in subclause 5.2.10.2 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives from the UE an initial request for a dialog or a request for a standalone transaction, the requirements are extended by the following requirements.\nBefore forwarding the request, based on the topmost Route header field, in accordance with the procedures of RFC 3261 [26], the P-CSCF shall ensure that all signalling during the lifetime of the dialogue is sent over the same IMS flow set as the dialogue initiating request.\nNOTE:\tThe suggested way to ensure all signalling is sent over the same IMS flow set is to form an IMS flow token in the same way that a P-CSCF would form this for the Path header field and insert this IMS flow token in the user portion of the  used in the Record-Route header field value.\nThe procedures described in subclause 5.2.10.3 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives from the UE an initial request for a dialog, or a standalone transaction, or an unknown method, the following requirements:\n1)\tinclude in the Request- an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69], if necessary, and execute the procedure described in step 4, 5, 6, and 7, in subclause 5.2.6.3.3, subclause 5.2.6.3.7, subclause 5.2.6.3.11, subclause 5.2.7.2 and subclause K.2.2.3.1, as appropriate. An additional sub-service type can be added if information on the type of emergency service is known. The entry in the Request- that the P-CSCF includes may either be:\n-\tas received from the UE in the Request- in accordance with RFC 5031 [69]; or\n-\tas deduced from the Request- received from the UE.\nThe procedures described in subclause 5.2.10.4 apply with the additional procedures described in the present subclause.\nWhen the P-CSCF receives from the UE an initial request for a dialog, or a standalone transaction, or an unknown method, the following requirements are extended:\n1)\tinclude in the Request- an emergency service URN, i.e. a service URN with a top-level service type of \"sos\" as specified in RFC 5031 [69], if necessary, and execute the procedure described in step 3, 4, 5, 6, and 7, in subclause 5.2.6.3.3, subclause 5.2.6.3.7, subclause 5.2.6.3.11 subclause 5.2.7.2 and subclause K.2.2.3.1, as appropriate. An additional sub-service type can be added if information on the type of emergency service is known. The entry in the Request- that the P-CSCF includes may either be:\n-\tas received from the UE in the Request- in accordance with RFC 5031 [69]; or\n-\tas deduced from the Request- received from the UE; and\nThe text in subclause 5.2.10.5 applies without changes.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "K.2.3\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "K.2.4\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "K.3\tApplication usage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "K.3.1\tUE usage of SDP",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures as of subclause 6.1 apply.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "K.3.2\tP-CSCF usage of SDP",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures as of subclause 6.2 apply.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "K.4\tVoid",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "K.5\tApplication usage of ICE",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "K.5.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "The following subclauses describe the usage of the Interactive Connectivity Establishment (ICE) procedures as documented in RFC 8445 [289] and RFC 8839 [290].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "K.5.2\tUE usage of ICE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "K.5.2.1\tGeneral",
                            "text_content": "bindings also need to be kept alive for media. RFC 8445 [289] provides requirements for STUN based keepalive mechanisms. UEs that do not implement the ICE procedures as defined in RFC 8445 [289] should implement the keepalive procedures defined in RFC 8445 [289]. In the case where keepalives are required and the other end does not support ICE (such that STUN cannot be used for a keepalive) or the UE can not discover STUN or TURN servers to gather candidates, the UE shall send an empty (no payload)  packet with a payload type of 20 as a keepalive as long as the other end has not negotiated the use of this value. If this value has already been negotiated, then some other unused static payload type from table 5 of RFC 3551 [55A] shall be used. When sending an empty  packet, the UE shall continue using the sequence number (SSRC) and timestamp as the negotiated  steam.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.5.2.2\tCall initiation – UE-origination case",
                            "text_content": "The UE should support the agent requirements for ICE as defined by RFC 8445 [289] when sending the initial INVITE request. RFC 8445 [289] and RFC 8839 [290] provide procedures for:\n1)\tGathering candidate addresses for  and RTCP prior to sending the INVITE;\n2)\tEncoding the candidate addresses in the SDP that is included with the INVITE;\n3)\tActing as a STUN server to receive binding requests from the remote client when it does connectivity checks;\n4)\tPerforming connectivity checks on received candidate addresses for  and RTCP;\n5)\tDetermining and possibly selecting a better active address based on the requirements in RFC 8445 [289] and RFC 8839 [290];\n6)\tSubsequent offer/answer exchanges; and\n7)\tSending media.\nWhen supporting the ICE procedures, the UE shall also support the STUN agent requirements as described in RFC 8489 [291] in order to gather STUN addresses, the TURN client requirements as described in RFC 8656 [292] in order to gather TURN Server addresses and the STUN Server requirements defined in RFC 8445 [289] as well as the requirements for STUN Servers defined in RFC 8489 [291] for responding to connectivity checks.\nRFC 8445 [289] provides an algorithm for determining the priority of a particular candidate. The following additional requirements are provided to the UE:\n1)\tThe type preference assigned for each type of candidate from least to highest should be: Relayed Transport Address, STUN address, local address; and\n2)\tIf the UE has a dual IPv4/IPv6 stack, IPv6 addresses may be assigned a higher local preference than IPv4 addresses based on the operator's policy.\nRFC 8445 [289] provides guidance on choosing the in-use candidate and recommends that a UE choose relayed candidates as the in-use address. The following additional requirements are provided to the UE:\n1)\tIf a TURN server is available, the Relayed Transport Address should be used as the initial active transport address (i.e. as advertised in the m/c lines of the SDP); and\n2)\tIf a TURN server is not available, an address obtained via STUN should be used as the initial active transport address.\nRegardless of whether the UE supports the above procedures, the UE shall, upon receipt of an SDP answer with candidate addresses, perform connectivity checks on the candidate addresses as described in RFC 8445 [289] and RFC 8839 [290]. In order to perform connectivity checks, the UE shall act as a STUN client as defined in RFC 8489 [291]. Further, the UE shall also follow the procedures in RFC 8445 [289] and RFC 8839 [290] when sending media.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.5.2.3\tCall termination – UE-termination case",
                            "text_content": "The UE should support agent requirements for ICE as defined by RFC 8445 [289] when receiving an initial INVITE request. RFC 8445 [289] and RFC 8839 [290] provide procedures for:\n1)\tGathering candidate addresses for  and RTCP prior to sending the answer as described in RFC 8445 [289];\n2)\tEncoding the candidate addresses in the SDP answer as described in RFC 8839 [290];\n3)\tActing as a STUN server to receive binding requests from the remote client when it does connectivity checks;\n4)\tPerforming connectivity checks on received candidate addresses for  and RTCP;\n5)\tDetermining and possibly selecting a better active address based on the requirements in RFC 8445 [289] and RFC 8839 [290];\n6)\tSubsequent offer/answer exchanges; and\n7)\tSending media.\nWhen supporting the ICE procedures, the UE shall also support the STUN agent requirements as described in RFC 8489 [291] in order to gather STUN addresses, the TURN client requirements as described in RFC 8656 [292] in order to gather TURN Server addresses and the STUN Server requirements defined in RFC 8445 [289] as well as the requirements for STUN Servers defined in RFC 8489 [291] for responding to connectivity checks.\nRFC 8445 [289] provides an algorithm for determining the priority of a given candidate. The additional requirements for the UE:\n1)\tThe priority of candidate addresses from least to highest should be: Relayed Transport Address, STUN address, local address; and\n2)\tIf the UE has a dual IPv4/IPv6 stack, IPv6 addresses  be placed at a higher priority than IPV4 addresses based on the operator's policy.\nRFC 8445 [289] provides guidance on choosing the in-use candidate and recommends that a UE choose relayed candidates as the in-use address. The following additional requirements are provided to the UE:\n1)\tIf a TURN server is available, the Relayed Transport Address should be used as the initial active transport address (i.e. as advertised in the m/c lines of the SDP); and\n2)\tIf a TURN server is not available, an address obtained via STUN should be used as the initial active transport address.\nRegardless of whether the UE supports the above procedures, the UE shall, upon receipt of an SDP offer with candidate addresses, perform connectivity checks on the candidate addresses as described in RFC 8445 [289] and RFC 8839 [290]. In order to perform connectivity checks, the UE shall act as a STUN client as defined in RFC 8489 [291]. Further, the UE shall also follow the procedures in RFC 8445 [289] and RFC 8839 [290] when sending media.\nWhen receiving an SDP offer which does not indicate support for ICE, the UE aborts the ICE procedures and reverts to RFC 3264 [27B] offer/answer procedures; per RFC 8445 [289] and RFC 8839 [290]. However, if the terminating UE is behind a (P)T device this may result in the inability to pass media for the session as the terminating UE will respond with its locally assigned IP address which is unreachable. In order to ensure successful media exchange, the terminating UE shall provide either a STUN derived IP address and port or a TURN provided IP address and port in the m/c lines of the SDP answer. If the provided address and port is a TURN address and port, the policy charging and control framework will be unable to establish proper filter criteria as the address is that of the TURN server and not that of the UE or  in front of the UE; see RFC 8445 [289] subclause B.3 for further details. To rectify this issue, the terminating UE shall also include a candidate attribute as described in RFC 8445 [289] and RFC 8839 [290] identifying the server reflexive IP address and port (i.e. the IP address and port on the public side of the ) used when a TURN provided address and port is provided in the m/c line of the SDP answer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "K.5.3\tP-CSCF support of ICE",
                    "description": "",
                    "summary": "",
                    "text_content": "The P-CSCF procedures to support ICE as specified in RFC 8445 [289] and RFC 8839 [290] are defined in subclause 6.7.2.7.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "K.5.4\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "L.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is Evolved Packet System (EPS). The EPS IP-CAN has an EPS core network which can be supported by an E-UTRAN radio access network.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "L.2\tEPS aspects when connected to the IM CN subsystem via E-UTRAN",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "L.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by EPS to provide packet-mode communication between the UE and the IM CN subsystem.\nRequirements for the UE on the use of these packet-mode services are specified in this clause. Requirements for the P-GW in support of this communication are specified in 3GPP TS 29.061 [11], and 3GPP TS 29.212 [13B].\nWhen using the EPS, each IP-CAN bearer is provided by an EPS bearer.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "L.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "L.2.2.1\tEPS bearer context activation and P-CSCF discovery",
                            "text_content": "The policy on the PDN connection established during the EPS attach procedure identifies parameters for composing the ESM messages sent during the EPS attach procedure as specified in 3GPP TS 24.301 [8J], when the UE performs the EPS attach procedure in order to communicate with IM CN subsystem.\nThe UE may support the policy on the PDN connection established during the EPS attach procedure.\nIf the UE supports the optional configuration parameter \"Access_Point_Name_Parameter_Reading_Rule\", as defined in 3GPP TS 24.167 [8G] and has been configured with this parameter, then the UE shall use it to retrieve the access point name to use in the EPS bearer context activation procedure.\nIf the UE supports the policy on the PDN connection established during the EPS attach procedure, the UE may support being configured with the policy on the PDN connection established during the EPS attach procedure using one or more of the following methods:\na)\tthe EPS_initial_attach_ConRefs node of EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe EPS_initial_attach_ConRefs node of EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe EPS_initial_attach_ConRefs node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the EPS_initial_attach_ConRefs node of 3GPP TS 24.167 [8G] and the EPS_initial_attach_ConRefs node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the EPS_initial_attach_ConRefs node of the EFIMSConfigData file shall take precedence.\nNOTE 1:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nPrior to communication with the IM CN subsystem, the UE shall:\na)\tif not attached for EPS services yet, perform a EPS attach procedure as specified in 3GPP TS 24.301 [8J]. If the UE requests establishment of a PDN connection during the EPS attach procedure, and the UE supports and is configured with the policy on the PDN connection established during the EPS attach procedure, the UE shall compose the ESM messages sent during the EPS attach procedure, according to the policy on the PDN connection established during the EPS attach procedure;\nb)\tensure that a EPS bearer context used for SIP signalling according to the  and P-GW selection criteria described in 3GPP TS 23.401 [7B], is available. This EPS bearer context shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration. As a result, the EPS bearer context provides the UE with information that makes the UE able to construct an IPv4 or an IPv6 address;\nNOTE 2:\tThe default EPS bearer context can also be used for SIP signalling as well as any other EPS bearer context.\nWhen the EPS bearer context establishment procedure for the SIP signalling is initiated by the UE:\nI.\tif a default EPS bearer context is not available with the selected P-GW, the UE shall indicate to the network in the PDN CONNECTIVITY REQUEST that the request is for SIP signalling. If the request is authorized, the network establishes a bearer with the appropriate QCI as described in 3GPP TS 24.301 [8J]. The UE may also use this EPS bearer context for DNS and DHCP signalling;\nII.\tif the default EPS bearer context is available with the selected P-GW, and is to be used for SIP signalling no additional steps are needed; and\nIII.\tif the default EPS bearer context is available with the selected P-GW and an EPS bearer for SIP signalling with the correct QCI and TFT is to be established, the UE shall indicate to the network, by setting the IM CN Subsystem Signalling Flag in the Protocol Configuration Options information element in the BEARER RESOURCE ALLOCATION REQUEST message, that the request is for SIP signalling. If the request is authorized, the network either establishes a new dedicated bearer or modifies an exisiting bearer with the appropriate QCI and TFT as described in 3GPP TS 24.301 [8J]. The general QoS negotiation mechanism is described in 3GPP TS 24.301 [8J]; and\nNOTE 3:\tAn EPS bearer with a QCI value other than the one for signalling can carry both IM CN subsystem signalling and media, in case the media does not need to be authorized by Policy and Charging control mechanisms as defined in 3GPP TS 29.212 [13B] and the media stream is not mandated by the P-CSCF to be carried in a separate EPS bearer.\nc)\tacquire a P-CSCF address(es).\nThe methods for P-CSCF discovery are:\nI.\tWhen using IPv4, employ the Dynamic Host Configuration Protocol (DHCP) RFC 2132 [20F], the DHCPv4 options for SIP servers RFC 3361 [35A], and RFC 3263 [27A] as described in subclause 9.2.1. When using IPv6, employ Dynamic Host Configuration Protocol for IPv6 (DHCPv6) RFC 3315 [40], the DHCPv6 options for SIP servers RFC 3319 [41] and DHCPv6 options for Domain Name Servers (DNS) RFC 3646 [56C] as described in subclause 9.2.1.\nII.\tTransfer P-CSCF address(es) within the EPS bearer context activation procedure.\nThe UE shall indicate the request for a P-CSCF address to the network within the Protocol Configuration Options information element of the PDN CONNECTIVITY REQUEST message or BEARER RESOURCE ALLOCATION REQUEST message.\nIf the network provides the UE with a list of P-CSCF IPv4 or IPv6 addresses in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall assume that the list is ordered top-down with the first P-CSCF address within the Protocol Configuration Options information element as the P-CSCF address having the highest preference and the last P-CSCF address within the Protocol Configuration Options information element as the P-CSCF address having the lowest preference.\nIII.\tThe UE selects a P-CSCF from the list (see 3GPP TS 31.103 [15B]) stored in the ISIM.\nIV.\tThe UE selects a P-CSCF from the list in IMS management object.\nThe UE shall use method IV to select a P-CSCF, if\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming; and\n-\tthe IMS management object contains the P-CSCF list.\nThe UE shall use method III to select the P-CSCF, if:\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming;\n-\teither the UE does not contain the IMS management object, or the UE contains the IMS management object but the IMS management object does not contain the P-CSCF list; and\n-\tthe ISIM residing in the UICC supports the P-CSCF list.\nThe UE can freely select method I or II for P-CSCF discovery, if:\n-\tthe UE is in the home network; or\n-\tthe UE is roaming and the P-CSCF is to be discovered in the visited network.\nThe UE can select method IV, if:\n-\tthe UE is in the home network; and\n-\tthe IMS management object contains the P-CSCF list.\nIn case method I is selected and several P-CSCF addresses or FQDNs are provided to the UE, the selection of P-CSCF address or FQDN shall be performed as indicated in RFC 3361 [35A] when using IPv4 or RFC 3319 [41] when using IPv6. If sufficient information for P-CSCF address selection is not available, selection of the P-CSCF address by the UE is implementation specific.\nNOTE 4:\tThe UE decides whether the P-CSCF is to be discovered in the serving network or in the home network based on local configuration, e.g. whether the application on the UE is permitted to use local breakout.\nIf the UE is designed to use I above, but receives P-CSCF address(es) according to II, then the UE shall either ignore the received address(es), or use the address(es) in accordance with II, and not proceed with the DHCP request according to I.\nIf the UE is configured to use Option II above and detects that all P-CSCFs known by the UE have been used when the UE selects a different P-CSCF as a result of:\n-\treceiving 305 (Use Proxy) to the REGISTER request;\n-\treceiving 504 (Server Time-out); or\n-\texpiration of the timer F at the UE,\nthen if there are more than one PDN connection that UE is connected to and unless the IP-CAN bearer is in use by other applications, the UE shall:\n1)\trelease IP-CAN bearer that is used only for the transport of SIP signalling and that are not used for other non-IMS applications, but shall not release emergency IP-CAN bearers; and\n2)\tunless the UE decides the service is no longer needed,\na)\tperform a new P-CSCF discovery procedure as described in subslause 9.2.1; and\nb)\tperform the procedures for initial registration as described in subclause 5.1.1.2.\nWhen using IPv4, the UE may request a DNS Server IPv4 address(es) via RFC 2132 [20F] or by the Protocol Configuration Options information element when activating a EPS bearer context according to 3GPP TS 24.301 [8J].\nWhen using IPv6, the UE may request a DNS Server IPv6 address(es) via RFC 3315 [40] and RFC 3646 [56C] or by the Protocol Configuration Options information element when activating a EPS bearer context according to 3GPP TS 24.301 [8J].\nThe encoding of the request and response for IPv4 or IPv6 address(es) for DNS server(s) and list of P-CSCF address(es) within the Protocol Configuration Options information element is described in 3GPP TS 24.301 [8J].\nWhen:\n-\tthe UE obtains an EPS bearer context used for SIP signalling by performing handover of the connection from another IP-CAN;\n-\tIP address of the UE is not changed during the handover; and\n-\tthe UE already communicates with the IM CN subsystem via the connection with the other IP-CAN, e.g. the UE determines that its contact with host portion set to the UE IP address (or FQDN of the UE) associated with the connection with the other IP-CAN has been bound to a public user identity;\nthe UE shall continue using the P-CSCF address(es) acquired in the other IP-CAN.\nThe UE may support the policy on when a UE roaming in a VPLMN is allowed to transfer the PDN connection providing access to IMS between EPC via WLAN and EPS. If the UE roams in the EPS IP-CAN, has a session and the policy indicates \"roaming in a VPLMN and having an ongoing session, is not allowed to transfer the PDN connection providing access to IMS between EPC via WLAN and EPS\", the UE shall not handover the PDN connection providing access to IMS from EPC via WLAN to EPS.\nIf the UE roams in the EPS IP-CAN, has a session and the policy indicates \"roaming in a VPLMN and having an ongoing session, is allowed to transfer the PDN connection providing access to IMS between EPC via WLAN and EPS\", the UE shall, if not prevented by other rules or policies, handover the PDN connection providing access to IMS from EPC via WLAN to EPS.\nIf the UE roams in the EPS IP-CAN and the policy indicates \"roaming in a VPLMN is not allowed to transfer the PDN connection providing access to IMS between EPC via WLAN and EPS, irrespective of if the UE is in a session or not\", the UE shall not handover the PDN connection providing access to IMS from EPC via WLAN to EPS. The UE can re-establish a new PDN connection to another IP-CAN type in idle mode, e.g. due to UE domain preference.\nIf the UE supports the policy on whether a roaming UE when in a session is allowed to transfer the PDN connection providing access to IMS between EPC via WLAN and EPS, the UE may support being configured with the policy on whether a roaming UE when in a session is allowed to transfer the PDN connection providing access to IMS between EPC via WLAN EPS using one or more of the following methods:\na)\tthe Allow_Handover_PDN_connection_WLAN_And_EPS node of EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Allow_Handover_PDN_connection_WLAN_And_EPS node of EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Allow_Handover_PDN_connection_WLAN_And_EPS node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the Allow_Handover_PDN_connection_WLAN_And_EPS node of 3GPP TS 24.167 [8G] and the Allow_Handover_PDN_connection_WLAN_And_EPS node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the Allow_Handover_PDN_connection_WLAN_And_EPS node of the EFIMSConfigData file shall take precedence.\nNOTE 5:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.2.2.1A\tModification of a EPS bearer context used for SIP signalling",
                            "text_content": "The EPS bearer context shall not be modified from being used exclusively for SIP signalling to a general purpose EPS bearer. After the establishment of an EPS bearer context used for SIP signalling, the UE shall not set the IM CN Subsystem Signalling Flag in the Protocol Configuration Options information element of any subsequent BEARER RESOURCE MODIFICATION REQUEST message for that . The UE shall ignore the IM CN Subsystem Signalling Flag if received from the network in the Protocol Configuration Options information element.\nAfter the establishment of a EPS bearer context used for SIP signalling, the UE shall not indicate the request for a P-CSCF address to the network within the Protocol Configuration Options information element of any subsequent BEARER RESOURCE MODIFICATION REQUEST message for that . The UE shall ignore P-CSCF address(es) if received from the network in the Protocol Configuration Options information element.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.2.2.1B\tRe-establishment of the EPS bearer context for SIP signalling",
                            "text_content": "If the UE registered a public user identity with an IP address allocated for the  of the EPS bearer context used for SIP signalling, the EPS bearer context used for SIP signalling is deactivated as result of signalling from the network and:\ni)\tif the UE is required to perform an initial registration according to subclause L.3.1.2;\nii)\tif the signalling from the network results in requiring the UE to initiate activation of the PDN connection of the EPS bearer context used for SIP signalling; or\niii)\tif the UE needs to continue having a public user identity registered with an IP address allocated for the ;\nthe UE shall:\nA)\tif the non-access stratum is performing the UE requested PDN connectivity procedure and the EPS bearer context activation procedure(s) for the  triggered as result of the signalling from the network, wait until the UE requested PDN connectivity procedure and the EPS bearer context activation procedure(s) for the  finish; and\nB)\tperform the procedures in subclause L.2.2.1, bullets a), b) and c).\nIf none of the bullets i), ii) and iii) of this subclause evaluate to true, or the procedures in bullet B) of this subclause were unable to ensure that the EPS bearer context used for SIP signalling is available or were unable to acquire any P-CSCF address(es):\n1)\tif the SIP signalling was carried over a dedicated EPS bearer context, the UE shall release all resources established as a result of SIP signalling by sending to the network either:\na)\ta BEARER RESOURCE MODIFICATION REQUEST message, if there are EPS bearer contexts to this PDN that are not related SIP sessions; or\nb)\ta PDN DISCONNECT REQUEST message if all the EPS bearer contexts to this PDN are related to SIP sessions.\nNOTE:\tIf the SIP signalling was carried over the default EPS bearer context, all the resources established as a result of SIP signalling are released without any explicit NAS signalling.\nIf the default EPS bearer context of the PDN connection of the EPS bearer context used for SIP signalling was deactivated at the start of this subclause, and the procedures in bullet B) of this subclause ensured that the EPS bearer context used for SIP signalling is available and acquired the P-CSCF address(es), the UE shall perform a new initial registration according to subclause 5.1.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "A UE supporting the P-CSCF restoration procedure performs one of the following procedures:\nA\tif the UE used method II for P-CSCF discovery and if the UE receives one or more P-CSCF address(es) in the Protocol Configuration Options information element of a Modify EPS Bearer Context Request message the one or more P-CSCF addresse(s) do not include the address of the currently used P-CSCF, then the UE shall acquire a different P-CSCF address from the one or more P-CSCF addresse(s) in the Modify EPS Bearer Context Request message. If more than one P-CSCF address with the same container identifier (i.e. \"P-CSCF IPv6 Address\" or \"P-CSCF IPv4 Address\") are included, then the UE shall assume that the more than one P-CSCF addresses with the same container identifier are prioritised with the first P-CSCF address with the same container identifier within the Protocol Configuration Options information element as the P-CSCF address with the highest priority.\nIf the UE used method II for P-CSCF discovery and if the UE has previously sent the \"P-CSCF Re-selection support\"  indicator at PDN creation and if the UE receives one or more P-CSCF address(es) in the Protocol Configuration Options information element of a Modify EPS Bearer Context Request message, then the UE shall acquire a P-CSCF address from the one or more P-CSCF addresse(s) in the Modify EPS Bearer Context Request message. If more than one P-CSCF address with the same container identifier (i.e. \"P-CSCF IPv6 Address\" or \"P-CSCF IPv4 Address\") are included, then the UE shall assume that the more than one P-CSCF addresses with the same container identifier are prioritised with the first P-CSCF address with the same container identifier within the Protocol Configuration Options information element as the P-CSCF address with the highest priority;\nB\tif the UE uses RFC 6223 [143] as part of P-CSCF restoration procedures, and if the P-CSCF fails to respond to a keep-alive request, then the UE shall acquire a different P-CSCF address using one of the methods I, III and IV for P-CSCF discovery described in the subclause L.2.2.1.\nIf the UE has an ongoing session and acquired the new P-CSCF address by using procedure A described above, the UE may wait until the UE has detected that the ongoing session has ended before performing an initial registration as specified in subclause 5.1.\nIn all other cases, when the UE has acquired the P-CSCF address, the UE not having an ongoing session shall perform an initial registration as specified in subclause 5.1.\nNOTE 1:\tFor UEs using procedure A described above, the network ensures that P-CSCF address(es) in the Protocol Configuration Options information element of a Modify EPS Bearer Context Request message is sent only during P-CSCF restoration procedures as defined in subclause 5 of 3GPP TS 23.380 [7D].\nNOTE 2:\tThe P-CSCF can be completely unreachable, so it is up to UE implementation to detect the end of an ongoing session, e.g. using media plane inactivity detection. Services depending on signalling such as CW and MT calls will not work during this time.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.2.2.2\tSession management procedures",
                            "text_content": "The existing procedures for session management as described in 3GPP TS 24.301 [8J] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.2.2.3\tMobility management procedures",
                            "text_content": "The existing procedures for mobility management as described in 3GPP TS 24.301 [8J] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.2.2.4\tCell selection and lack of coverage",
                            "text_content": "The existing mechanisms and criteria for cell selection as described in 3GPP TS 36.304 [19B] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.2.2.5\tEPS bearer contexts for media",
                            "text_content": "NOTE 1:\tIn EPS, the UE cannot control whether media streams belonging to different SIP sessions are established on the same EPS bearer context or not. During establishment of a session, the UE establishes data streams(s) for media related to the session. Such data stream(s) can result in activation of additional EPS bearer context(s). Either the UE or the network can request for resource allocations for media, but the establishment and modification of the EPS bearer is controlled by the network as described in 3GPP TS 24.301 [8J].\nNOTE 2:\tWhen the UE wishes to allocate bandwidth for  and RTCP, the UE uses the rules as those outlined in 3GPP TS 29.213 [13C].\nIf the resource allocation is initiated by the UE, the UE starts reserving resources whenever it has sufficient information about the media streams, and used codecs available as specified in 3GPP TS 24.301 [8J].\nNOTE 3:\tIf the resource reservation requests are initiated by the EPS IP CAN, then the bearer establishment is initiated by the network after the P-CSCF has authorised the respective IP flows and provided the QoS requirements over the Rx interface to the PCRF as described in 3GPP TS 29.214 [13D].\nIf the UE is configured not to initiate resource allocation for media according to 3GPP TS 24.167 [8G], then the UE shall refrain from requesting additional EPS bearer context(s) for media until the UE considers that the network did not initiate resource allocation for the media.\nIf the UE receives an activation request from the network for a EPS bearer context which is associated with the EPS bearer context used for signalling, the UE shall, based on the information contained in the Traffic Flow Template information element, correlate the media EPS bearer context with a currently ongoing SIP session establishment or SIP session modification.\nIf the UE receives a modification request from the network for a EPS bearer context that is used for one or more media streams in an ongoing SIP session, the UE shall:\n1)\tmodify the related EPS bearer context in accordance with the request received from the network.\nWhen a data stream for media related to a session is released, if the EPS bearer resource transporting the data stream is no longer needed and allocation of the EPS bearer resource was requested by the UE, then the UE releases the EPS bearer resource.\nNOTE:\tThe EPS bearer resource can be needed e.g. for other data streams of a session or for other applications in the UE.\nThe default EPS bearer context usage restriction policy consists of zero or more default EPS bearer context usage restriction policy parts.\nThe default EPS bearer context usage restriction policy part consists of a mandatory media type condition and an optional ICSI condition.\nThe default EPS bearer context usage restriction policy does not apply to UE detected emergency calls.\nSending media is restricted according to the default EPS bearer context usage restriction policy, if sending media is restricted according to at least one default EPS bearer context usage restriction policy part of the default EPS bearer context usage restriction policy or if the UE is roaming.\nSending media is restricted according to the default EPS bearer context usage restriction policy part if:\n1)\tthe media is to be sent for a media stream negotiated in a session offered or established by SIP signalling;\n2)\tthe media stream is of a media type indicated in the media type condition of the EPS bearer context usage restriction policy part;\n3)\tthe following is true:\na)\tthe default EPS bearer context usage restriction policy part does not have the ICSI condition; or\nb)\tthe session is offered or established by SIP signalling related to an IMS communication service identified in the ICSI condition of the default EPS bearer context usage restriction policy part; and\n4)\tthe media is to be sent via the default EPS bearer context of the PDN connection for SIP signalling.\nThe UE may support the default EPS bearer context usage restriction policy.\nIf the UE supports the default EPS bearer context usage restriction policy:\n1)\tthe UE shall not send media restricted according to the default EPS bearer context usage restriction policy; and\n2)\tthe UE may support being configured with the default EPS bearer context usage restriction policy using one or more of the following methods:\na)\tthe Default_EPS_bearer_context_usage_restriction_policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Default_EPS_bearer_context_usage_restriction_policy node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tDefault_EPS_bearer_context_usage_restriction_policy node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the the Default_EPS_bearer_context_usage_restriction_policy node of Default_EPS_bearer_context_usage_restriction_policy node of 3GPP TS 24.167 [8G] and the Ethe Default_EPS_bearer_context_usage_restriction_policy node of FIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the EFIMSConfigData file shall take precedence.\nNOTE:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nNOTE 1:\tThe procedures in this subclause only apply when the UE requests activation and modification of media bearers. In the case where the network activates and modifies the media bearers the network takes care of the handling of media bearers in the case of forking.\nSince the UE does not know that forking has occurred until a second, provisional response arrives, the UE requests resource allocation as required by the initial response received. If a subsequent provisional response is received, different alternative actions may be performed depending on the requirements in the SDP answer:\n1)\tthe bearer requirements of the subsequent SDP can be accommodated by the existing resources requested. The UE performs no further resource requests.\n2)\tthe subsequent SDP introduces different QoS requirements or additional IP flows. The UE requests further resource allocation according to subclause L.2.2.5.1.\n3)\tthe subsequent SDP introduces one or more additional IP flows. The UE requests further resource allocation according to subclause L.2.2.5.1.\nNOTE 2: When several forked responses are received, the resources requested by the UE are the \"logical OR\" of the resources indicated in the multiple responses to avoid allocation of unnecessary resources. The UE does not request more resources than proposed in the original INVITE request.\nWhen a final answer is received for one of the early dialogs, the UE proceeds to set up the SIP session. The UE shall release all the unneeded IP-CAN resources. Therefore, upon the reception of the first final 200 (OK) response for the INVITE request (in addition to the procedures defined in RFC 3261 [26] subclause 13.2.2.4), the UE shall:\n1)\tin case resources were established or modified as a consequence of the INVITE request and forked provisional responses that are not related to the accepted 200 (OK) response, send release request to release the unneeded resources.\nOne of the Rx and Gx interface related error codes can be received by the UE in either the PDN CONNECTIVITY REJECT message, the BEARER RESOURCE MODIFICATION REJECT message, or the BEARER RESOURCE ALLOCATION REJECT message. If the UE receives a Rx and Gx interface related error code, the UE shall either handle the resource reservation failure as described in subclause 6.1.1 or retransmit the message up to three times. The Rx and Gx interface related error codes are further specified in 3GPP TS 29.214 [13D] and 3GPP TS 29.212 [13B].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.2.2.6\tEmergency service",
                            "text_content": "Emergency bearers are defined for use in emergency calls in EPS and core network support of these bearers is indicated to the UE in NAS signalling. Where the UE recognises that a call request is an emergency call and the core network supports emergency bearers, the UE shall use these EPS bearer contexts for both signalling and media for emergency calls made using the IM CN subsystem.\nSome jurisdictions allow emergency calls to be made when the UE does not contain an ISIM or USIM, or where the credentials are not accepted. Additionally, where the UE is in state EMM-REGISTERED.LIMITED-SERVICE and EMM-REGISTERED.PLMN-SEARCH, a normal ATTACH has been attempted but it can also be assumed that a registration in the IM CN subsystem will also fail. In such cases, subject to the lower layers indicating that the network does support emergency bearer services in limited service state (see 3GPP TS 36.331 [19F]), the procedures for emergency calls without registration can be applied, as defined in subclause 5.1.6.8.2. If the EPS authentication procedure has already succeeded during the latest normal or emergency ATTACH procedure, the UE shall perform an initial emergency registration, as described in subclause 5.1.6.2 before attempting an emergency call as described in subclause 5.1.6.8.3.\nNOTE 1:\tThe UE can determine that EPS authentication procedure has succeeded during the emergency ATTACH procedure when a non-null integrity protection algorithm (i.e. other than EIA0 algorithm) is received in the NAS signalling SECURITY MODE COMMAND message.\nWhen activating an EPS bearer context to perform emergency registration, the UE shall request a PDN connection for emergency bearer services as described in 3GPP TS 24.301 [8J]. The procedures for EPS bearer context activation and P-CSCF discovery, as described in subclause L.2.2.1 of this specification apply accordingly.\nIn order to find out whether the UE is attached to the home PLMN or to the visited PLMN, the UE shall compare the  and  values derived from its  with the  and  of the PLMN the UE is attached to. If the  and  of the PLMN the UE is attached to do not match with the  and  derived from the , then for the purpose of emergency calls in the IM CN subsystem the UE shall consider to be attached to a VPLMN.\nNOTE 2:\tIn this respect an equivalent HPLMN, as defined in 3GPP TS 23.122 [4C] will be considered as a visited network.\nNOTE 3:\tThe UE verifies if a detected emergency number is still present in the Extended Local Emergency Number List after attach to a different PLMN. It is possible for the number to no longer be present in the Extended Local Emergency Number List if:\n-\tthe PLMN attached to relies on the Local Emergency Number List for deriving a URN; or\n-\tthe previously received Extended Emergency Number List Validity field indicated \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\".\nIf the UE detected an emergency number, the UE subsequently performs an attach procedure or an emergency attach procedure with a different PLMN than the PLMN from which the UE received the last Extended Local Emergency Number List, the dialled number is not stored in the ME, in the USIM and in the Local Emergency Number List; and\n-\tthe ATTACH ACCEPT message received from the different PLMN contains the Extended Local Emergency Number List and the emergency number is present in the updated Extended Local Emergency Number List then the UE uses the updated Extended Local Emergency Number List when it performs the procedures in subclause L.2.2.6.1B; and\n-\tthe ATTACH ACCEPT message received from the different PLMN contains no Extended Local Emergency Number List or the emergency number is no longer present in the updated Extended Local Emergency Number List then the UE shall attempt UE procedures for SIP that relate to emergency using emergency service URN \"urn:service:sos\".\nIf the dialled number is equal to a local emergency number stored in the Extended Local Emergency Number List (as defined in 3GPP TS 24.301 [8J]), then the UE shall recognize such a number as for an emergency call and:\n-\tif the dialled number is equal to an emergency number stored in the ME, or in the USIM, then the UE shall perform either procedures in the subclause L.2.2.6.1B or the procedures in subclause L.2.2.6.1A; and\n-\tif the dialled number in not equal to an emergency number stored in the ME, or in the USIM, then the UE shall perform procedures in the subclause L.2.2.6.1B.\nIf the dialled number is not equal to a local emergency number stored in the Extended Local Emergency Number List (as defined in 3GPP TS 24.301 [8J]) and:\n-\tif the dialled number is equal to an emergency number stored in the ME, in the USIM or in the Local Emergency Number List (as defined in 3GPP TS 24.008 [8]), then the UE shall recognize such a number as for an emergency call and performs the procedures in subclause L.2.2.6.1A.\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.2A.1.1 and subclause 5.1.3.1, if:\n-\tthe 380 (Alternate Service) response contains a Contact header field;\n-\tthe value of the Contact header field is a service URN; and\n-\tthe service URN has a top-level service type of \"sos\";\nthen the UE determines that \"emergency service information is included\" as described 3GPP TS 23.167 [4B].\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.3.1 if the 380 (Alternate Service) response does not contain a Contact header field with service URN that has a top-level service type of \"sos\", then the UE determines that \"no emergency service information is included\" as described 3GPP TS 23.167 [4B].\nIf the \"emergency service information is included\" as described 3GPP TS 23.167 [4B]:\n1)\tif the URN in the Contact header field matches an emergency service URN in table L.2.2.6.1, then the type of emergency service is the value corresponding to the matching entry in table L.2.2.6.1; and\n2)\tif the URN in the Contact header field does not match any emergency service URN in table L.2.2.6.1, then the type of emergency service is not identified.\nNOTE 4:\tIn bullet 2), the URN in the Contact header field either contains \"no emergency subservice type\" as described in 3GPP TS 23.167 [4B] triggering an emergency call, or contains an \"emergency subservice type that does not map into an emergency service category for the CS domain\" as described in 3GPP TS 23.167 [4B] triggering a normal call when the dialled number is available or triggering an emergency call when the dialled number is not available. The country specific URN is an example of a \"emergency subservice type that does not map into an emergency service category for the CS domain\".\nWhen the emergency registration expires, the UE should disconnect the PDN connection for emergency bearer services as described in 3GPP TS 24.301 [8J].\nUpon receiving a 3xx other than 380 (Alternative service), 4xx, 5xx or 6xx response to an INVITE request for a UE detectable emergency call, the UE shall perform domain selection as specified in 3GPP TS 23.167 [4B] annex H, to re-attempt the emergency call.\nThe type of emergency service for an emergency number is derived from the settings of the emergency service category value (bits 1 to 5 of the emergency service category value as specified in subclause 10.5.4.33 of 3GPP TS 24.008 [8]). Table L.2.2.6.1 below specifies mappings between a type of emergency service and an emergency service URN. The UE shall use the mapping to match an emergency service URN and a type of emergency service. If a dialled number is an emergency number but does not map to a type of emergency service the service URN shall be \"urn:service:sos\".\nTable L.2.2.6.1: Mapping between type of emergency service and emergency service URN\n\nNOTE 1:\tIt is not possible for a UE to indicate more than one type of emergency service in an emergency service URN.\nIf an IP-CAN, capable of providing local emergency numbers, did not provide a local emergency number that matches the dialled number (see subclause 5.1.6.1) and multiple types of emergency service can be derived for a dialled number from the information configured on the USIM then:\n-\tif the UE is in the HPLMN, the UE shall map any one of these types of emergency service to an emergency service URN as specified in table L.2.2.6.1; and\n-\tif the UE is in the VPLMN, the UE shall select \"urn:service:sos\".\nNOTE 2:\tIf the Non-3GPP emergency number indicator within the Non-3GPP NW provided policies IE (see 3GPP TS 24.008 [8]) provided through registration procedures over 3GPP access is set to \"use of non-3GPP emergency numbers permitted\", the UE also considers WLAN provided local emergency numbers (see 3GPP TS 24.302 [8U], subclause 4.7). If the Non-3GPP NW provided policies IE provided through registration procedures over 3GPP access is set to \"use of non-3GPP emergency numbers not permitted\", the UE does not consider WLAN provided local emergency numbers. If the Non-3GPP NW provided policies IE is not provided through registration procedures over 3GPP access, the UE does not consider WLAN provided local emergency numbers.\nIf an IP-CAN, capable of providing local emergency numbers, provided a local emergency number that matches the dialled number (see subclause 5.1.6.1), and:\n-\tif the UE can derive one or more types of emergency service from the information received from the IP-CAN for the dialled number and the UE cannot derive types of emergency service from the information configured on the USIM for the dialled number; or\n-\tif the UE is able to derive identical types of emergency service from both the information received from the IP-CAN for the dialled number and from the information configured on the USIM for the dialled number,\nthen the UE shall map any one of these emergency service types to an emergency service URN as specified in table L.2.2.6.1.\nNOTE 3:\tHow the UE resolves clashes where an emergency number is associated with one or more different types of emergency service configured in the USIM and in information received from the access network, is implementation dependent.\nThe Extended Local Emergency Number List (defined in 3GPP TS 24.301 [8J]) can contain sub-services of the associated emergency service URN for the detected emergency number.\nIf:\n-\tthe length of sub-services field is greater than \"0\", the UE shall construct the emergency service URN using \"urn:service:sos\" followed by adding a dot followed by the content of the sub-services field; and\n-\tthe length of sub-services field is \"0\", the UE shall use the emergency service URN \"urn:service:sos\".\nEXAMPLE 1:\tFor a detected number, if the sub-service is \"gas\", then the UE constructs \"urn:service:sos.gas\" as the associated emergency service URN.\nEXAMPLE 2:\tFor a detected number, if no sub-service is provided, then the UE uses \"urn:service:sos\" as the associated emergency service URN.\nIf the IP-CAN indicates the eCall support indication or the CS domain is not available to the UE, the UE can send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nIf the IP-CAN does not indicates the eCall support indication and the CS domain is available to the UE, the UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table L.2.2.6.1: Mapping between type of emergency service and emergency service URN",
                                    "table number": 469,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "L.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "L.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "NOTE 1:\tWhen:\n-\testablishing a session which is not an emergency session; or\n-\tmodifying a session which is not an emergency session;\nand if the IMSVoPS indicator is received in the EPS network feature support information element (see 3GPP TS 24.301 [8J]) and no persistent EPS bearer context exists at the UE, the UE constructs SDP based on the restrictions indicated in the IMSVoPS indicator. Regardless whether the IMSVoPS indicator indicating voice is supported or not, m-lines can be set to \"audio\" and exclude voice codecs from the SDP answer or SDP offer. When a persistent EPS bearer context exists, m-lines can be set to \"audio\" and include voice codecs in the SDP answer or SDP offer.\nNOTE 2:\tWhen the UE is accessing the IM CN subsystem via E-UTRAN, the appropriate specification for access domain selection is 3GPP TS 23.221 [6].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "L.2A.1\tImpact on SDP offer / answer of activation or modification of EPS bearer context for media by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "If, due to the activation of EPS bearer context from the network the related SDP media description needs to be changed, the UE shall update the related SDP information by sending, within a SIP request, a new SDP offer for each of the existing SIP dialogs,\nIf the UE receives a modification request from the network for a EPS bearer context that is used for one or more media streams in an ongoing SIP session, the UE shall:\n1)\tif, due to the modification of the EPS bearer context, the related SDP media description need to be changed, update the related SDP information by sending, within a SIP request, a new SDP offer for each of the existing SIP dialogs, and respond to the EPS bearer context modification request.\nNOTE:\tThe UE can decide to indicate additional media streams as well as additional or different codecs in the SDP offer than those used in the already ongoing session.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "L.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "If the UE receives an SDP offer where the SDP offer includes all media streams for which the originating side indicated its local preconditions as met, if the precondition mechanism is supported by the terminating UE and the IP-CAN performs network-initiated resource reservation for the terminating UE and the available resources are not sufficient for the received offer, the terminating UE shall indicate its local preconditions and provide the SDP answer to the originating side without waiting for resource reservation.\nNOTE:\tIf the resource reservation is controlled by the EPS IP-CAN, the resource reservation request is initiated by the network after the P-CSCF has authorised the respective IP flows and provided the QoS requirements over the Rx interface to the PCRF as described in 3GPP TS 29.214 [13D].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "L.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "NOTE:\tWhen establishing an emergency session or when modifying an emergency session, the IMSVoPS indicator does not influence handling of SDP offer and SDP answer.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "L.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "L.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "L.3.1.0\tRegistration and authentication",
                            "text_content": "The UE shall perform reregistration of a previously registered public user identity bound to any one of its contact addresses when changing to an IP-CAN for which usage is specified in annex R or annex W. The reregistration is performed using the new IP-CAN.\nNOTE 1:\tThis document does not specify how the UE detects that the used IP-CAN has changed. The information that is forcing the reregistration is also used to generate the content for the P-Access-Network-Info header field.\nNOTE 2:\tThe UE will send the reregistration irrespective of whether it has a SIP dialog or not.\nIf the UE supports the 3GPP PS data off, then the UE shall in all REGISTER requests include the \"+g.3gpp.ps-data-off\" header field parameter defined in subclause 7.9.8 set to a value indicating the 3GPP PS data off status.\nWhen the UE sends a REGISTER request, if the 3GPP PS data off status is \"active\", then the UE shall only include media feature tags associated with services that are 3GPP PS data off exempt services in the g.3gpp.icsi-ref media feature tag, as defined in subclause 7.9.2 and RFC 3840 [62], for the IMS communication services it intends to use.\nIf the UE is registered, and the 3GPP PS data off status is changed or the UE is provided by the network with a new list of 3GPP PS data off exempt services while the 3GPP PS data off status is \"active\", then the UE shall perform a reregistration of the previously registered public user identity.\nA UE supporting ANBR as specified in 3GPP TS 26.114 [9B] shall also support RAN-assisted codec adaptation as specified in 3GPP TS 36.300 [268] and 3GPP TS 36.321 [269].\nIf the UE supports ANBR, upon receiving a 200 (OK) response to the REGISTER request and if the 200 (OK) response contains a Feature-Caps header field with the g.3gpp.anbr feature-capability indicator the UE shall assume that the network supports RAN-assisted codec adaptation as specified in 3GPP TS 36.300 [268] and 3GPP TS 36.321 [269]. The UE is allowed to include the SDP ‘anbr’ attribute during session establishment as specified in 3GPP TS 26.114 [9B].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "The IMS_Registration_handling policy indicates whether the UE deregisters from IMS after a configured amount of time after receiving an indication that the IMS Voice over PS Session is not supported.\nThe UE may support the IMS_Registration_handling policy.\nIf the UE supports the IMS_Registration_handling policy, the UE may support being configured with the IMS_Registration_handling policy using one or more of the following methods:\na)\tthe IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe IMS_Registration_Policy node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the IMS_Registration_Policy node of 3GPP TS 24.167 [8G] and the IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the IMS_Registration_Policy node of the EFIMSConfigData file shall take precedence.\nNOTE 1:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nIf the UE is registered with IMS and the IMSVoPS indicator, provided by the lower layers (see 3GPP TS 24.301 [8J]), indicates voice is not supported, the UE shall:\nA)\tif the Stay_Registered_When_VoPS_Not_Supported leaf indicates requirement to stay registered, the UE needs not to deregister and maintains the registration as required for IMS services; or\nNOTE 2:\tThe UE will periodically refresh the registration when needed.\nB)\tif the Stay_Registered_When_VoPS_Not_Supported leaf indicates requirement to deregister and the Deregistration_Timer leaf used to configure the NoVoPS-dereg timer defined in table 7.8.1 contains a timer value for the time to wait before deregistrerting from IMS, start a timer with the value indicated in the policy and:\na)\tif the timer expires before the UE receives an indication from the lower layers that IMS voice is supported:\n1)\tif there is no ongoing IMS session, the UE either performs reregistration as specified in subclause 5.1.1.4 and shall only include feature tags associated with services that are independent of IMSVoPS indicator or deregister from the IMS following the procedures specified in subclause 5.1.1.6; or\n2)\tif there is ongoing IMS session, and\ni)\tif the UE does not receive indication from the lower layer that the IMS voice is supported before the ongoing IMS session is terminated, the UE either performs reregistration as specified in subclause 5.1.1.4 and shall only include feature tags associated with services that are independent of IMSVoPS indicator or deregister from the IMS following the procedures specified in subclause 5.1.1.6 as soon as the ongoing IMS based service is terminated; or\nii)\tif the UE receives indication from the lower layer that the IMS voice is supported before the ongoing IMS session is terminated, cancel the timer; or\nNOTE 3:\tHow the UE selects reregistration or deregistration is implementation dependent (e.g., SMS service)\nb)\tif the UE receives an indication from the lower layers that IMS voice is supported before the timer expires, cancel the timer.\nIf the IMS_Registration_handling policy is not configured, the UE behaviour is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The UE shall always include the P-Access-Network-Info header field where indicated in subclause 5.1.\nNOTE:\tIf the P-Access-Network-Info header field includes radio cell identity, the P-Access-Network-Info header field populated by the UE that supports Multi-RAT Dual Connectivity with the EPC as described in 3GPP TS 37.340 [264] will contain the information about the radio cell identity of the Master RAN node that is serving the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.2\tAvailability for calls",
                            "text_content": "This subclause documents the minimal requirements for being available for voice communication services when using EPS.\nA UE shall perform an initial registration as specified in subclause 5.1.1.2 using an EPS bearer context for SIP signalling (see annex L.2.2.1), if all the following conditions are met:\n1)\tif the UE is operating in one of the following modes of operation (see 3GPP TS 24.301 [8J]):\na)\tPS mode 1;\nb)\tCS/PS mode 1 and the UE is attached for EPS-Services only;\n2)\tif the UE is capable of receiving any (but not necessarily all) of the media types which the CS domain supports, such that the media type can also be used when accessing the IM CN subsystem using the current IP-CAN;\n3)\tif:\na)\tthe media type of item 2 is an \"audio\" media type\nb)\tthe UE supports codecs suitable for (conversational) speech; and\nc)\tthe \"audio\" media type is not restricted from inclusion in an SDP message according to the media type restriction policy as specified in subclause 6.1.1\nand one of the following is true:\na)\t3GPP PS data off status is \"inactive\";\nb)\t3GPP PS data off status is \"active\", the UE is in the HPLMN or the EHPLMN, and MMTEL voice is a 3GPP PS data off exempt service; or\nc)\t3GPP PS data off status is \"active\", the UE is in the VPLMN, the UE is configured with an indication that MMTEL voice is a 3GPP PS data off exempt service in a VPLMN, and MMTEL voice is a 3GPP PS data off roaming exempt service.\n4)\tif the UE determines that its contact has not been bound to a public user identity using the IP-CAN, such that the contact is expected to be used for the delivery of incoming requests in the IM CN subsystem relating to the media of item 2 and item 3;\n5)\tif the IMSVoPS indicator, provided by the lower layers (see 3GPP TS 24.301 [8J]), indicates voice is supported;\n6)\tif the procedures to perform the initial registration are enabled (see 3GPP TS 24.305 [8T]); and\n7)\tif the EPS bearer context used for SIP signalling is:\na)\tavailable; or\nb)\tnot available, and the UE:\ni.\tis allowed to send a PDN CONNECTIVITY REQUEST message to establish an EPS bearer context that is needed for performing the initial registration; or\nii.\tis allowed to send a BEARER RESOURCE ALLOCATION REQUEST message, wishes to establish an EPS bearer with the correct QCI and TFT for performing the initial registration, and a default EPS bearer context for the  exists.\nNOTE 1:\t3GPP TS 24.301 [8J] specifies conditions that prevent the UE from sending a PDN CONNECTIVITY REQUEST message or a BEARER RESOURCE ALLOCATION REQUEST message.\nNOTE 2:\tRegardless of any of the above conditions, a UE might attempt to register with the IM CN subsystem at any time.\nEXAMPLE:\tAs an example of the note, a UE configured to preferably attempt to use the EPS to access IM CN subsystem can perform an initial registration as specified in subclause 5.1.1.2, if the conditions in items 2, 3, 4, 5, 6 and 7 in this subclause, evaluate to true.\nThe UE indicates to the non-access stratum the status of being available for voice over PS when:\nI)\tthe UE is capable of receiving any (but not necessarily all) of the media types which the CS domain supports, such that the media type can also be used when accessing the IM CN subsystem using the current IP-CAN;\nII)\tif the media type of item I is an \"audio\" media type, the UE supports codecs suitable for (conversational) speech, the \"audio\" media type is not restricted from inclusion in an SDP message according to the media type restriction policy as specified in subclause 6.1.1, and:\na)\t3GPP PS data off status is \"inactive\";\nb)\t3GPP PS data off status is \"active\", the UE is in the HPLMN or the EHPLMN, and MMTEL voice is a 3GPP PS data off exempt service; or\nc)\t3GPP PS data off status is \"active\", the UE is in the VPLMN, the UE is configured with an indication that MMTEL voice is a 3GPP PS data off exempt service in a VPLMN, and MMTEL voice is a 3GPP PS data off roaming exempt service; and\nIII)\tthe UE determines a contact has been bound to a public user identity using the IP-CAN, such that this contact is expected to be used for the delivery of incoming requests in the IM CN subsystem relating to such media.\nThe UE indicates to the non-access stratum the status of being not available for voice over PS when:\nI)\tin response to receiving the IMSVoPS indicator indicating voice is supported, the UE:\n-\tinitiated an initial registration as specified in subclause 5.1.1.2, received a final response to the REGISTER request sent, but the conditions for indicating the status of being available for voice over PS are not met; or\n-\tdid not initiate an initial registration as specified in subclause 5.1.1.2 and, these conditions for indicating the status of being available for voice over PS are not met; or\nII)\tthe conditions for indicating the status of being available for voice over PS are no longer met.\nNOTE 3:\tThe status of being not available for voice over PS is used for domain selection for UE originating sessions / calls specified in 3GPP TS 23.221 [6] subclause 7.2a.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.2A\tAvailability for SMS",
                            "text_content": "The UE determines that the UE is able to use SMS using IMS if the UE:\nI)\tis capable of using the MIME type \"application/vnd.3gpp.sms\" (see 3GPP TS 24.341 [8L]), such that the MIME type can also be used when accessing the IM CN subsystem using the current IP-CAN;\nII)\tsupports the role of an SM-over-IP sender (see 3GPP TS 24.341 [8L]);\nIIA)\tdetermines the EPS bearer context used for SIP signalling exists;\nIII)\tdetermines a contact has been bound to a public user identity using the IP-CAN, such that this contact is expected to be used for the delivery of incoming requests in the IM CN subsystem relating to such media;\nIV)\tthe UE does not determine that SMS over IP is restricted in 3GPP TS 24.341 [8L] subclause 5.2.1.3; and\nV)\tthe 3GPP PS data off status is:\n-\t\"inactive\";\n-\t\"active\", the UE is in the HPLMN or the EHPLMN, and SMS over IMS is a 3GPP PS data off exempt service; or\n-\t\"active\", the UE is in the VPLMN, the UE is configured with an indication that SMS over IMS is a 3GPP PS data off exempt service in a VPLMN, and SMS over IMS is a 3GPP PS data off roaming exempt service.\nWhen above criteria are not matched, the UE determines that SMS using IMS is unavailable.\nNOTE:\tThe status that SMS using IMS is unavailable is used for domain selection for UE originating SMS specified in 3GPP TS 23.221 [6] subclause 7.2c.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.3\tAuthorization header field",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Upon receiving an INVITE request not including the \"precondition\" option-tag in the Supported header field and not including the \"precondition\" option-tag in the Require header field, and the IP-CAN performs network-initiated resource reservation for the UE, the UE:\n1)\tif the INVITE request contains an SDP offer and the local resources required at the terminating UE for the received SDP offer are not available:\na)\tshall not alert the user; and\nb)\tshall send 183 (Session Progress) response to the INVITE request without waiting for resource reservation and without alerting the user. If the INVITE request includes a Supported header field indicating support of reliable provisional responses, the UE shall send the 183 (Session Progress) response reliably. In the 183 (Session Progres) response, the UE shall include an SDP answer; and\n2)\tif the INVITE request does not contain an SDP offer and the INVITE request includes a Supported header field indicating support of reliable provisional responses:\na)\tshall generate an SDP offer;\nb)\tif the local resources required at the terminating UE for the generated SDP offer are not available:\nA)\tshall not alert the user; and\nB)\tshall reliably send 183 (Session Progress) response to the INVITE request without waiting for resource reservation and without alerting the user. In the 183 (Session Progres) response, the UE shall include the generated SDP offer.\nUpon successful reservation of local resources, if the precondition mechanism is not used by the terminating UE, the UE can send 180 (Ringing) response to the INVITE request and can alert the user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.5\t3GPP PS data off",
                            "text_content": "If the 3GPP PS data off status is \"active\" the UE shall only send initial requests that:\n1)\tare associated with a 3GPP IMS service which enforces 3GPP PS data off;\nNOTE:\tThese services are specified in 3GPP TS 22.011 [1C], and enforcement of 3GPP PS data off is described in the respective service specifications.\n2)\tare associated with an emergency service;\n3)\tare associated with access to RLOS; or\n4)\tare associated with 3GPP PS data off exempt services configured in the UE using one or more of the following methods:\n-\tthe non_3GPP_ICSIs_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G] is not configured;\n-\tthe non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the VPLMN;\n-\tthe non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] is not configured; or\n-\tthe non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the VPLMN.\nIf the UE is configured with both the non_3GPP_ICSIs_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\nIf the UE is configured with both the non_3GPP_ICSIs_roaming_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\nIf the 3GPP PS data off status changes from \"inactive\" to \"active\" the UE shall release all dialogs that\n1)\tare not associated with a 3GPP IMS service which enforces 3GPP PS data off;\nNOTE:\tThese services are specified in 3GPP TS 22.011 [1C], and enforcement of 3GPP PS data off is described in the respective service specifications.\n2)\tare not associated with an emergency service; and\n3)\tare not associated with 3GPP data off exempt services configured in the UE using one or more of the following methods:\n-\tthe non_3GPP_ICSIs_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G] is not configured;\n-\tthe non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the VPLMN;\n-\tthe non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] is not configured; or\n-\tthe non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the VPLMN.\nIf the UE is configured with both the non_3GPP_ICSIs_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\nIf the UE is configured with both the non_3GPP_ICSIs_roaming_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.6\tTransport mechanisms",
                            "text_content": "No additional requirements are defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.1.7\tRLOS",
                            "text_content": "The support for RLOS as described in this subclause is optional for the UE.\nA UE containing a UICC on sending an unprotected REGISTER request for RLOS,  shall perform the actions as specified in subclause 5.1.1.2 wih the following additions:\na)\tthe UE shall in the REGISTER request include a \"+g.3gpp.rlos\" Contact header field parameter, as defined in subclause 7.9.9.\nNOTE:\tThe UE can choose to use initial registration using IMS AKA or initial registration using GPRS-IMS bundled authentication.\nA UE not containing a UICC on sending an uprotected REGISTER request for RLOS shall perform the actions as specified in subclause 5.1.1.2 for registration using GPRS-IMS bundled authentication with the following additions:\na)\tthe UE shall generate a home network domain name according to the rules specified in 3GPP TS 23.003 [3] using the PLMN to which the UE is currently attached and set the Request- to the SIP  of the so generated home network domain name;\nb)\tthe UE shall include a To header field set to \"\" (specified in 3GPP TS 23.003 [3]);\nc)\tthe UE shall include a From header field set to \"\" (specified in 3GPP TS 23.003 [3]); and\nd)\tthe UE shall in the REGISTER request include a \"+g.3gpp.rlos\" Contact header field parameter, as defined in subclause 7.9.9\nOn reception of a 200 (OK) response to the REGISTER request for RLOS, the UE shall perform the actions as specified in subclause 5.1.1.2 and shall locally store an indication that RLOS session setup is possible. The indication is valid for an implementation specific time.\nOn receiving a 403 (Forbidden) response containing a Response-Source header field with a \"fe\" header field parameter set to \"<urn:3gpp:fe:s-cscf>\" for an initial registration that included a \"+g.3gpp.rlos\" Contact header field parameter in the REGISTER request, then the UE shall locally store an indication that setup of a RLOS session is possible. The indication is stored for an implementation dependent time.\nL.3.1.7.3\tSession Setup\nThe UE shall establish a RLOS session as described in this sub-clause only after it has initiated a RLOS registration and has received a 403 (Forbidden) response sent from an S-CSCF.\nWhen establishing a RLOS session in case of an unregistered user, the UE is allowed to receive responses to RLOS requests and requests inside an established RLOS session on the unprotected ports. The UE shall reject or silently discard all other messages. Additionally, the UE shall transmit signalling packets pertaining to the RLOS session from the same IP address and unprotected port on which it expects to receive signalling packets containing the responses to RLOS requests and the requests inside the established RLOS session.\nWhen establishing a RLOS session for an unregistered user, the UE shall use the local IP address and P-CSCF address as used when sending the RLOS registration. The UE shall send only the initial INVITE requests to the port advertised to the UE during the P-CSCF discovery procedure. If the UE does not receive any specific port information during the P-CSCF discovery procedure, the UE shall send the initial INVITE request to the SIP default port values as specified in RFC 3261 [26].\nThe UE shall apply the procedures as specified in subclause 5.1.2A.1 and subclause 5.1.3 with the following additions:\n1)\tthe UE shall set the From header field of the INVITE request to the public user identity as used in the RLOS registration;\n2)\tthe UE shall:\na)\tif a dial string for a specific RLOS service is available in the UE, use the dial string to build the Request-URI as specified in subclause 5.1.2A.1.3; and\nb)\tif no dial string for a specific RLOS service is available in the UE use the dummy MSISDN value as defined in 3GPP TS 23.003 [3] to build the Request-URI as specified in subclause 5.1.2A.1.3;\n3)\tthe UE shall insert in the INVITE request, a To header field with the same value as in the Request-;\n4)\tThe UE shall insert a P-Preferred-Service header field according to RFC 6050 [121] set to \"urn:urn-7:3gpp-service.ims.icsi.rlos\";\n5)\tThe UE shall insert an Accept-Contact header field field containing the \"+g.3gpp.icsi-ref\" header field parameter containing an ICSI value set to \"urn:urn-7:3gpp-service.ims.icsi.rlos\";\n6)\tthe UE shall include in the P-Access-Network-Info header field in any request for a dialog, any subsequent request (except CANCEL requests) or response (except CANCEL responses) within a dialog or any request. Insertion of the P-Access-Network-Info header field into the ACK request is optional. The UE shall populate the P-Access-Network-Info header field with the current point of attachment to the IP-CAN as specified for the access network technology (see subclause 7.2A.4).;\n7)\tThe UE shall populate the P-Preferred-Identity header field in the INVITE request with an IMEI based identity in the form of a SIP URI as specified in 3GPP TS 23.003 [3] subclause 13.13;\n8)\ta Contact header field set to include SIP  that contains in the hostport parameter the IP address of the UE and an unprotected port where the UE will receive incoming requests belonging to this dialog. The UE shall also include a \"sip.instance\" media feature tag containing Instance ID as described in RFC 5626 [92]. The UE shall also include the \"+g.3gpp. icsi-ref\" header field parameter containing an ICSI value set to \"urn:urn-7:3gpp-service.ims.icsi.rlos\" . The UE shall not include either the public or temporary GRUU in the Contact header field;\n9)\ta Via header field set to include the IP address of the UE in the sent-by field and for the UDP the unprotected server port value where the UE will receive responses, while for the , the response is received on the  connection on which the RLOS request was sent. For the UDP, the UE shall also include \"rport\" header field parameter with no value in the top Via header field.;\nNOTE 1:\tThe UE inserts the same IP address and port number into the Contact header field and the Via header field, and sends all IP packets to the P-CSCF from this IP address and port number.\n10)\tif the UE has its location information available, or a  that points to the location information, the UE shall include a Geolocation header field in the INVITE request in the following way:\n-\tif the UE is aware of the  that points to where the UE's location is stored, include the  as the Geolocation header field value, as described in RFC 6442 [89]; or\n-\tif the UE is aware of its location information, include the location information in a PIDF location object, in accordance with RFC 4119 [90], include the location object in a message body with the content type application/pidf+xml, and include a Content ID URL, referring to the message body, as the Geolocation header field value, as described RFC 6442 [89], and include a Content-Disposition header field with a disposition type \"render\" value and a \"handling\" header field parameter with an \"optional\" value, as described in RFC 3261 [26];\nNOTE 2:\tIf the location information is old or inaccurate, the UE does not consider location information to be available.\n11)\tif the UE includes a Geolocation header field, the UE shall also include a Geolocation-Routing header field with a \"yes\" header field value, which indicates that the location of the UE can be used by other entities to make routing decisions, as described in RFC 6442 [89]; and\n12)\tif the UE has neither geographical location information available, nor a  that points to the location information, the UE shall not insert a Geolocation header field in the INVITE request.\nThe UE shall build a proper preloaded Route header field value for all new dialogs. The UE shall build a Route header field value containing only the P-CSCF  which was used in the RLOS registration.\nWhen a SIP transaction times out, i.e. timer B, timer F or timer H expires at the UE, the UE may behave as if timer F expired, as described in subclause 5.1.1.4.\nIf the response for the initial INVITE request indicates that the UE is behind , and the INVITE request was sent over  connection, the UE shall keep the  connection during the entire duration of the emergency session. In this case the UE will receive all responses to the emergency requests and the requests inside the established emergency session over this  connection.\nIf the Via header field of any provisional response, or of the final 200 (OK) response, for the initial INVITE request contains a \"keep\" header field parameter with a value, unless the UE detects that it is not behind a , the UE shall start to send keep-alives associated with the session towards the P-CSCF, as described in RFC 6223 [143].\nThe UE shall apply the procedures as specified in subclauses 5.1.2A and 5.1.3 with the following additions:\n1)\tthe UE shall include in the Request- of the initial INVITE request the dummy MSISDN value as defined in 3GPP TS 23.003 [3];\n2)\tthe UE shall insert in the INVITE request, a To header field with the same value as in the Request-;\n3)\tThe UE shall insert a P-Preferred-Service header field according to RFC 6050 [121] set to \"urn:urn-7:3gpp-service.ims.icsi.rlos\"; and\n4)\tThe UE shall insert an Accept-Contact header field field containing the \"+g.3gpp.icsi-ref\" header field parameter containing an ICSI value set to \"urn:urn-7:3gpp-service.ims.icsi.rlos\";\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "L.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "L.3.2.0\tRegistration and authentication",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "If the P-CSCF is configured to handle emergency requests, in order to determine from which network the request was originated the P-CSCF shall check the  and  fields received:\n-\tduring the registration procedure from the Rx interface as defined in 3GPP°TS°29.214 [13D] (e.g. used for deployments without IMS-level roaming interfaces where the P-CSCF is located in the home network); or\n-\tfrom the P-Access-Network-Info header field.\nNOTE:\tThe above check can be against more than one  code stored in the P-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.2.2\tLocation information handling",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.2.3\tProhibited usage of PDN connection for emergency bearer services",
                            "text_content": "If the P-CSCF detects that a UE uses a PDN connection for emergency bearer services for a non-emergency REGISTER request, the P-CSCF shall reject that request by a 403 (Forbidden) response.\nNOTE:\tBy assigning specific IP address ranges for a PDN connection for emergency bearer services and configuring those ranges in P-CSCF, the P-CSCF can detect based on the registered Contact address if UE uses an emergency PDN connection for initial registration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.2.4\tSupport for paging policy differentiation",
                            "text_content": "The P-CSCF may support paging policy differentiation by marking packet(s) to be sent towards the UE related to that IMS capability. A specific  (IPv4) value and/or a specific Traffic Class (IPv6) value are assigned by local configuration in the P-CSCF.\nIf local policy requires to provide such marking, the P-CSCF shall identify terminating requests which:\na)\tcontain SDP with an \"audio\" media line and which are related to a IMS multimedia telephony service session specified in TS 24.173 [8H]; or\nb)\tdo not contain an SDP offer but some indication, e.g. a feature capability indicator, indicates that an \"audio\" media line that would meet network policy for such differentiation, could form part of the subsequent SDP offer.\nNOTE 1:\tPrecise details of such indications, if any, are subject to operator policy. Alternatively the operator policy can be to not preferentially page requests without an SDP offer.\nFor such identified requests:\na)\twhere an unreliable transport mechanism is used as the transport protocol for SIP, the P-CSCF shall mark packets containing an INVITE request; and\nb)\tif a reliable transport mechanism is used as the transport protocol for SIP:\n1)\tif a new reliable transport connection needs to be established, the P-CSCF shall turn on the marking of packets within the reliable transport connection in advance of sending an INVITE request; and\n2)\tif there is an existing reliable transport connection, the P-CSCF may turn on the marking of packets within the reliable transport connection in advance of sending an INVITE request.\nIn both these cases for a reliable transport connection, the P-CSCF shall turn off the marking of packets within the reliable transport connection at an appropriate time.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.2.6\tResource sharing",
                            "text_content": "If  is supported for this access technology a P-CSCF supporting resource sharing shall insert a Resource-Share header field with the value set to \"supported\" as described in subclause 7.2.13 and perform the actions in the following subclauses.\nUpon receiveing an initial INVITE request from a served UE, if the P-CSCF supports resource sharing and local policy requires that resources are reserved already on the SDP offer in the initial INVITE request, the P-CSCF can:\n1)\tfor each m-line in the SDP offer, internally generate a set of temporary resource sharing rules where:\na)\tif the media line is not subject to resouce sharing according to local policies, each resource sharing rule contains a sharing key with a value that is unique and not used by any another media stream in any ongoing session involving the UE;\nb)\tdirectionality is included according to local policy; and\nc)\tif the media line is subject to resouce sharing according to local policies, each resource sharing rule contains a sharing key with the value as assigned to other ongoing media stream(s) of some ongoing session(s) involving the UE that also use the shared resources; and\n2)\tapply resource-sharing as specified in 3GPP TS 29.214 [13D] using the temporary resource sharing rules.\nWhen the P-CSCF supporting resource receives a 18x response or a 2xx response containing the initial SDP answer, a Resource-Share header field with the value \"media-sharing\" and the \"origin\" header field parameter set to \"session-initiator\", the P-CSCF:\n1)\tshall store resource sharing rules and the value of the corresponding sharing key as described in subclause 7.2.13.5 and use the stored sharing keys to identify resource sharing rules for the media streams in this session; and\n2)\twill apply resource sharing as specified in 3GPP TS 29.214 [13D] using the stored sharing rules.\nNOTE 1:\tIf a Resource-Share header field containing the same stored sharing key values and updated resource sharing rules are received in any other session involving the served UE, the updated resource sharing rules overrides the resource sharing rules received in this session.\nIf P-CSCF supports resource sharing and when the first response to the initial INVITE request (with the exception of the 100 (Trying) response) contains a Resource-Share header field with the value \"no-media-sharing\" and the \"origin\" header field parameter set to the value \"session-initiator\", the P-CSCF shall not share media in this session.\nNOTE 2:\tWhen resource sharing is not possible, sharing keys identifying the temporary set of resource sharing rules used over the Rx interface if resources were reserved using the SDP offer can still be kept but can never be used in any other session involving this UE as long as this session is ongoing.\nIf P-CSCF supports resource sharing and when the first response to the initial INVITE request (with the exception of the 100 (Trying) response) containing the initial SDP answer does not contain a Resource-Share header field, the P-CSCF may apply resource sharing using local configuration.\nIf P-CSCF supports resource sharing and when P-CSCF receives an initial INVITE request destined to the served user containg the Resource-Share header field parameter with the value \"media-sharing\" and the \"origin\" header field parameter set to the value \"session-receiver\" and if local policy requires resource reservation using the initial SDP offer the P-CSCF shall:\n1)\tstore resource sharing rules and corresponding sharing key values as described in subclause 7.2.13.5 and use each stored sharing key to identify resource sharing rules for media streams in this session; and\n2)\tapply resource sharing as specified in 3GPP TS 29.214 [13D] using the stored resource sharing rules.\nNOTE:\tIf a Resource-Share header field containing the stored sharing key are received in any other session involving the served UE, the updated resource sharing rules overrides the resource sharing rules received in this session.\nUpon receiving a response to the above INVITE request containing an initial SDP answer, if the initial INVITE request containging the initial SDP offer contained the Resource-Share header field set to the value \"media-sharing\" and the \"origin\" header field parameter set to \"session-receiver\" and if local policy requires resource reservation on the initial SDP answer, the P-CSCF shall:\n1)\tstore resource sharing rules and corresponding sharing key values as described in subclause 7.2.13.5 and use the stored sharing keys to identify resource sharing rules for media streams in this session; and\n2)\tapply resource sharing as specified in 3GPP TS 29.214 [13D] using the stored resource sharing rules.\nIf P-CSCF supports resource sharing and when P-CSCF receives an initial INVITE request containg the Resource-Share header field with the value \"no-media-sharing\" and the \"origin\" header field parameter set to the value \"session-receiver\", the P-CSCF shall not share media in this session.\nIf P-CSCF supports resource sharing and when P-CSCF receives an initial INVITE request not containing a Resource-Share header field, the P-CSCF may apply resource sharing using local configuration.\nIf the P-CSCF supporting resource sharing receives a request or response from the home network destined to the served user containing a Resource-Share header field with the \"origin\" header field parameter set to the value \"session-initiator\" or without the \"origin header field parameter, the P-CSCF shall not use the content of the header field and remove the header field from the outgoing response or request.\nWhen the P-CSCF supporting resource sharing receives an 18x response or a 2xx response from a served UE and the response contains an initial SDP offer and local policy requires resource reservation using the initial SDP offer, the P-CSCF shall :\n1)\tfor each m-line in the SDP offer, internally generate a set of temporary resource sharing rules where:\n-\teach resource sharing rule contains a sharing key with a value that is unique and not used by any another media stream in any ongoing session involving the UE; and\n-\tdirectionality is included according to local policy; and\n2)\tapply resource-sharing as specified in 3GPP TS 29.214 [13D] using the temporary resource sharing rules.\nUpon receiving a PRACK request or an ACK request containing the initial SDP answer and a Resource-Share header field with the value \"media-sharing\" and the \"origin\" header field parameter set to \"session-receiver\", the P-CSCF shall:\n1)\tstore resource sharing rules and the value of the corresponding sharing key as described in subclause 7.2.13.5 and use stored sharing key to identify resource sharing rules for the media streams in this session; and\n2)\tapply resource sharing rules as specified in 3GPP TS 29.214 [13D] using the stored sharing rules.\nUpon receiving a PRACK request or an ACK request containing the initial SDP answer and a Resource-Share header field with the value \"no-media-sharing\", the P-CSCF shall not share resources in this session.\nNOTE:\tIf resources can't be shared the temporary set of resource sharing rules used over Rx interface when reserving resources using the initial SDP offer can still be kept but can never be used in any other session involving this UE as long as this dialog is ongoing.\nUpon receiving a PRACK request or an ACK request containing the initial SDP answer and the response does not contain a Resource-Share header field, the P-CSCF may apply resource sharing using local configuration.\nIf P-CSCF receives a request or response from the served UE and there is a conflict with the given instructions over Rx and the UE behaviour, the P-CSCF shall:\n-\timmediately stop resource sharing for all media streams in this session as described in 3GPP TS 29.214 [13D]; and\n-\tif resource sharing options is determined by an AS, include the Resource-Share header field set to the value \"no-media-sharing\" along with the \"origin\" header field set to \"session-initiator\" or \"session-receiver\" as appropriate in the outgoing request or response.\nNOTE 1:\tHow P-CSCF detects that there is a conflict with the given instruction over Rx and the UE behaviour is implementation dependent and not further described.\nNOTE 2:\tA typical example of a conflict between a given instruction over Rx and the UE behaviour is if media sharing is allowed in both uplink and downlink direction and if in the communication waiting use case, the UE sends a 200 (OK) response to the INVITE request without putting the first call on hold. The UE's behaviour is then regarded as unpredictable and resource sharing cannot be used for any session using the stored sharing key value involving that UE.\nThe P-CSCF shall remove the Resource-Share header field from the request or response received from a served user.\nAt any point in an ongoing session the AS in the home network can include in an subsequent request or response a Resource-Share header field containing updated resource sharing options and when such an update is received the P-CSCF shall store the new sharing rules as described in subclause 7.2.13.8.4 and apply any change as described in 3GPP TS 29.214 [13D].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.2.7\tPriority sharing",
                            "text_content": "If P-CSCF supports priority sharing,  is supported for this access technology and if according to operator policy, the P-CSCF shall apply the procedures in the following subclauses.\nIf P-CSCF supports priority sharing, the P-CSCF shall remove the Priority-Share header field from outgoing requests or responses destined to the served UE.\nThe P-CSCF supporting priority sharing and if according to operator policy shall include the g.3gpp.priority-share feature-capability indicator defined in subclause 7.9A.10 in a Feature-Caps header field in the SIP REGISTER request.\nWhen receiving the Priority-Share header field defined in subclause 7.2.16 in an initial INVITE request or in a 18x or a 2xx response to the initial INVITE request destined to the served UE and if according to operator policy, the P-CSCF shall apply priority sharing according to 3GPP TS 29.214 [13D] based on the value of the Priority-Share header field.\nWhen receiving the Priority-Share header field in a re-INVITE request, in a18x or in a 2xx responses to the re-INVITE request destined to the served UE and if according to operator policy, the P-CSCF shall apply priority sharing according to 3GPP TS 29.214 [13D] based on the value of the Priority-Share header field.\nWhen receiving the Priority-Share header field in an subsequent request or in a 2xx responses to the subsequent request destined to the served UE and if according to operator policy, the P-CSCF shall apply priority sharing according to 3GPP TS 29.214 [13D], based on the value of the Priority-Share header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.2.8\tRLOS",
                            "text_content": "The support for RLOS as described in this subclause is optional for the P-CSCF.\nA P-CSCF supporting RLOS shall perform the procedures as specified in subclause 5.2.2 and in addition shall perform the procedures specified in this sublclause.\nWhen the P-CSCF receives a REGISTER request from the UE and the REGISTER request contains a \"+g.3gpp.rlos\" Contact header field parameter, and:\n1)\tif:\na)\tthe P-Access-Network-Info header field in REGISTER request indicates an IP-CAN for which procedures are defined in an Annex different than Annex L; or\nb)\tthe IP address and APN check, as defined in section Z3.3 of 3GPP TS 23.228 [7] fail;\nthen the P-CSCF shall reject the REGISTER request by sending a 403 response including a Response-Source header field with an \"fe\" header field parameter set to \"<urn:3gpp:fe:p-cscf.orig>\"; or\n2)\tif the public user identity in the REGISTER request indicates a user for which the operator of the P-CSCF does not have a roaming agreement, then the P-CSCF shall select a preconfigured S-CSCF and insert a Route header field with the S-CSCF URI for originating requests and forward the request to the selected S-CSCF.\nWhen the P-CSCF receives a 403 (Forbidden) response to a REGISTER request that contained a \"+g.3gpp.rlos\" Contact header field parameter, the P-CSCF shall:\n1)\tcreate a temporary unauthenticated subscriber record for the registered public user identity;\n2)\tassociate the S-CSCF with the registered public user identity and associated contact address;\n3)\tstore the registered public user identity as a default public user identity for use with procedures for the P-Asserted-Identity header field for requests received from the UE;\n4)\tstore the values received in the P-Charging-Function-Addresses header field;\n5)\tif a \"term-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"term-ioi\" header field parameter; and\nNOTE:\tAny received \"term-ioi\" header field parameter will contain a type 1 IOI. The type 1 IOI identifies the home network of the registered user.\n6)\tvoid.\nL.3.2.8.3\tSession Setup\nIf the P-CSCF supports RLOS, the P-CSCF shall accept unprotected requests on the IP address and the unprotected port advertised to the UE during the P-CSCF discovery or the SIP default port.\nWhen the P-CSCF sends unprotected responses to the UE, it shall use the same IP address and port where the corresponding request was received.\nIf the P-CSCF receives an initial request for a dialog or standalone transaction, or an unknown method from an unregistered user on the IP address and the unprotected port advertised to the UE during the P-CSCF discovery or the SIP default port,\nThe P-CSCF shall inspect the Request- independent of values of possible entries in the received Route header fields for the presence of the dummy MSISDN or a RLOS service specific dial string. The P-CSCF shall consider the Request  of the initial request as indicating RLOS, if the Request-URI contains the dummy URI or a RLOS service specific dial string and if the request contains a P-Preferred-Service header field according to RFC 6050 [121] set to \"urn:urn-7:3gpp-service.ims.icsi.rlos\".\nIf the P-CSCF detects that the initial request for a dialog or a standalone transaction, or an unknown method indicates RLOS, and the P-CSCF has previously stored a temporary unauthenticated subscriber record for the public user identity contained in the From header field of the request:\n1)\tshall include a topmost Route header field set to the  of the S-CSCF as stored in the unauthenticated subscriber record;\nNOTE 2:\tHow the list of E-CSCF is obtained by the P-CSCF is implementation dependent.\n2)\tshall execute the procedure described in subclause 5.2.6.3.3, subclause 5.2.6.3.7, subclause 5.2.6.3.11 and subclause 5.2.7.2, as appropriate except for:\n-\tverifying the preloaded route against the received Service-Route header field;\n-\trouting to IBCF; and\n-\tinserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field;\n3)\tshall insert a P-Asserted-Identity header field set to the public user identity as stored in the unauthenticated subscriber record; and\n4)\tif the P-CSCF detects that the UE is behind a , and the UE's Via header field contains a \"keep\" header field parameter, shall add a value to the parameter, to indicate that it is willing to receive keep-alives associated with the dialog from the UE, as defined in RFC 6223 [143].\nWhen the P-CSCF receives any 1xx or 2xx response to the above requests, the P-CSCF shall execute the appropriate procedure for the type of request described in subclause 5.2.6.3.4, subclause 5.2.6.3.8, and subclause 5.2.6.3.12, except that the P-CSCF may rewrite the port number of its own Record-Route entry to an unprotected port where the P-CSCF wants to receive the subsequent incoming requests from the UE belonging to this dialog.\nWhen the P-CSCF receives a target refresh request from the UE for a dialog, the P-CSCF shall execute the procedure described in subclause 5.2.6.3.5, except for inserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field.\nWhen the P-CSCF receives from the UE subsequent requests other than a target refresh request (including requests relating to an existing dialog where the method is unknown), the P-CSCF shall execute the procedure described in subclause 5.2.6.3.9, except for inserting a type 1 \"orig-ioi\" header field parameter in the P-Charging-Vector header field.\nWhen the P-CSCF receives any 1xx or 2xx response to the above requests, the P-CSCF shall execute the appropriate procedure for the type of request described in subclause 5.2.6.3.5 or subclause 5.2.6.3.9.\nThe P-CSCF shall follow procedures specified subclause 5.2.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.2.9\tSupport of ANBR and RAN-assisted codec adaptation",
                            "text_content": "If the network supports ANBR as specified in 3GPP TS 26.114 [9B] and RAN-assisted codec adaptation as specified in 3GPP TS 36.300 [268] and 3GPP TS 36.321 [269], then the P-CSCF might be configured to indicate ANBR support.\nIf the P-CSCF is configured to indicate ANBR support, when the P-CSCF receives the 200 (OK) response to the REGISTER request the P-CSCF shall include the \"g.3gpp.anbr\" feature-capability indicator in the Feature-Caps header field of the 200 (OK) response to the REGISTER request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "L.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "L.3.3.1\tNotification of AS about registration status",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "L.3.3.2\tRLOS",
                            "text_content": "The support for RLOS as described in this subclause is optional.\nA S-CSCF supporting RLOS shall perform the procedures as specified in subclause 5.4.1.2 and in addition shall perform the procedures specified in this subclause.\nUpon receipt of a REGISTER request that is part of an initial registration as described in subclause 5.4.1.2.1\n1)\tif REGISTER request contains a \"+g.3gpp.rlos\" Contact header field parameter, the S-CSCF:\na)\tif the S-CSCF supports GPRS-IMS-Bundled authentication and the public user identity in the REGISTER request indicates a user for which the operators of the S-CSCF does not have a roaming agreement with the home network operator, shall reject the request by returning a 420 (Bad Extension) response in which the Unsupported header field contains the value \"sec-agree\"; and\nb)\tif the S-CSCF does not support GPRS-IMS-Bundled authentication and the public user identity in the REGISTER request indicates a user for which the operators of the S-CSCF does not have a roaming agreement with the home network operator, shall reject the request by returning a 403 (Forbidden) response and include a Response-Source header field with a \"fe\" header field parameter set to \"<urn:3gpp:fe:s-cscf>\". The S-CSCF shall create a temporary record for the public user identity which is registered with a default service profile which is valid for an implementation specific time; and\nUpon receipt of a REGISTER request without an Authorization header field as described in subclause 5.4.1.2.1E and the REGISTER request contains a \"+g.3gpp.rlos\" Contact header field paramete, the S-CSCF shall skip the procedures in subclause 5.4.1.2.1E and shall\n1)\tidentify the user by the public user identity as received in the To header field of the REGISTER request. The S-CSCF shall derive the private user identity from the public user identity being registered by removing  scheme and the following parts of the  if present: port number,  parameters, and To header field parameters;\n2)\tcheck if the P-Visited-Network-ID header field is included in the REGISTER request, and if it is included identify the visited network by the value of this header field;\n3)\tcheck whether a \"received\" header field parameter exists in the Via header field provided by the UE. If a \"received\" header field parameter exists, the S-CSCF shall compare the IP address recorded in the \"received\" header field parameter against the UE's IP address stored during registration. In case of IPv6 stateless autoconfiguration, the S-CSCF shall compare the prefix of the IP address recorded in the \"received\" header field parameter against the UE's IP address prefix stored during registration. If no \"received\" header field parameter exists in the Via header field provided by the UE, then the S-CSCF shall compare IP address recorded in the \"sent-by\" parameter against the stored UE IP address. In case of IPv6 stateless autoconfiguration, S-CSCF shall compare the prefix of the IP address recorded in the \"sent-by\" parameter against the UE's IP address prefix stored during registration. In any case, if the stored IP address (or prefix) and the (prefix of the) IP address recorded in the Via header field provided by the UE do not match, the S-CSCF shall query the HSS as described in 3GPP TS 29.228 [14] with the derived private user identity and the public user identity as input and store the received IP address (or prefix) of the UE. If the stored IP address (or prefix) and the (prefix of the) IP address recorded in the Via header field provided by the UE still do not match the S-CSCF shall reject the registration with a 403 (Forbidden) response and skip the following steps;\n4)\tdetermine the duration of the registration by checking the registration expiration interval value in the received REGISTER request and bind it either to the respective contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used). Based on local policy, the S-CSCF may reduce the duration of the registration or send back a 423 (Interval Too Brief) response specifying the minimum allowed time for registration;\n5)\tupdate registration bindings;\n6)\tcreate a temporary record for the public user identity being registered with a default service profile;\n7)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n8)\tif an \"orig-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"orig-ioi\" header field parameter;\n9)\tcheck whether a Path header field was included in the REGISTER request and construct a list of preloaded Route header fields from the list of entries in the received Path header field. The S-CSCF shall preserve the order of the preloaded Route header fields and bind them either to the contact address of the UE and the contact information that was received in the REGISTER request; and\n10)\tcreate and send a 200 (OK) response for the REGISTER request as specified in subclause 5.4.1.2.2F;\nIn case the timer reg-await-auth is running for this user, S-CSCF supports RLOS as specified in TS 23.228 [7] and the REGISTER request contains a \"+g.3gpp.rlos\" Contact header field parameter, the S-CSCF shall:\n1)\tcheck if the Call-ID of the request matches with the Call-ID of the 401 (Unauthorized) response which carried the last challenge. The S-CSCF shall only proceed further if the Call-IDs match;\n2)\tstop timer reg-await-auth;\n3)\tcheck whether an Authorization header field is included, containing:\na)\tthe private user identity of the user in the \"username\" header field parameter;\nb)\tif the \"integrity-protected\" header field parameter is set to \"yes\", the \"algorithm\" header field parameter set to \"AKAv1-MD5\" or \"AKAv2-SHA-256\";\nNOTE:\tThe \"AKAv1-MD5\" algorithm is only supported for backward compatibility.\nc)\tif the \"integrity-protected\" header field parameter is set to \"tls-connected\", the \"algorithm\" header field parameter set to \"AKAv2-SHA-256\" if the S-CSCF supports the IMS AKA using HTTP Digest AKAv2 without IPSec security association; and\nd)\tthe authentication challenge response needed for the authentication procedure in the \"response\" header field parameter.\nThe S-CSCF shall only proceed with the following steps in this paragraph if the authentication challenge response was included;\n4)\tcheck whether the received authentication challenge response and the expected authentication challenge response (calculated by the S-CSCF using XRES and other parameters as described in RFC 3310 [49] when AKAv1 is used or as described in RFC 4169 [227] when AKAv2 is used) match. The XRES parameter was received from the HSS as part of the Authentication Vector. The S-CSCF shall only proceed with the following steps if the challenge response received from the UE and the expected response calculated by the S-CSCF do not match;\n5)\tif there are public user identities (including the public user identity being registered, if previously registered) that belong to this user that have been previously registered with the same private user identity, and with an old contact address different from the one received in the REGISTER request and if the previous registrations have not expired:\na)\tterminate all dialogs, associated with the previously registered public user identities (including the public user identity being registered, if previously registered), with a status code 480 (Temporarily Unavailable) in the Reason header field of the BYE request, as specified in subclause 5.4.5.1.2;\nb)\tsend a NOTIFY request, to the subscribers to the registration event package of the previously registered public user identities, that indicates that all previously registered public user identities (excluding the public user identity being registered) belonging to this user identified with its private user identity, have been deregistered, as described in subclause 5.4.2.1.2. For the public user identity being registered, the NOTIFY request contains the new contact information; and\nc)\tdelete all information associated with the previously registered public user identities;\n6)\tstore the following information in the local data:\na)\tthe public user identities due to the received REGISTER request which is set to the public user identity as received in the REGISTER request. The public user identity is identified as non-barred;\nb)\ta default service profile that indicates that the public user identity is registered for RLOS;\nc)\tif S-CSCF restoration procedures are supported, the restoration information if received as specified in 3GPP TS 29.228 [14]; and\nd)\tif PCRF based P-CSCF restoration procedures are supported, all the user profile(s) corresponding to the public user identities being registered (explicitly or implicitly), including the , if available;\n7)\tupdate registration bindings and\na)\tbind to each non-barred registered public user identity the registered contact information including all header field parameters contained in the Contact header field and all associated SIP  parameters, and\nb)\tif the Contact header field of the REGISTER request contained a \"+sip.instance\" and a \"reg-id\" header field parameter, and the SIP  in the Path header field inserted by the P-CSCF contained an \"ob\" SIP  parameter header field, and:\n-\tif the public user identity has not previously been registered with the same \"+sip.instance\" and \"reg-id\" Contact header field parameter values, then create the registration flow in addition to any existing registration flow; or\n-\tif the public user identity has previously been registered with the same \"+sip.instance\" and \"reg-id\" header field parameter values, then determine whether the request refreshes or replaces an existing registration flow. If the request:\ni)\trefreshes an existing registration flow, then the S-CSCF shall leave the flow intact; or\nii)\treplaces the existing registration flow with a new flow, then the S-CSCF shall:\na)\tterminate any dialog, as specified in subclause 5.4.5.1.2, with a status code 480 (Temporarily Unavailable) in the Reason header field of the BYE request, associated with the registration flow being replaced; and\nb)\tsend a NOTIFY request to the subscribers to the registration event package for the public user identity indicated in the REGISTER request, as described in subclause 5.4.2.1.2;\n8)\tcheck whether a Path header field was included in the REGISTER request and construct a list of preloaded Route header fields from the list of entries in the received Path header field. The S-CSCF shall preserve the order of the preloaded Route header fields and bind them either to the contact address of the UE or the registration flow and the associated contact address (if the multiple registration mechanism is used) and the contact information that was received in the REGISTER request;\n9)\tdetermine the duration of the registration by checking the value of the registration expiration interval value in the received REGISTER request and bind it either to the respective contact address of the UE or to the registration flow and the associated contact address (if the multiple registration mechanism is used). Based on local policy, the S-CSCF may reduce the duration of the registration or send back a 423 (Interval Too Brief) response specifying the minimum allowed time for registration.;\n10)\tstore the \"icid-value\" header field parameter received in the P-Charging-Vector header field;\n11)\tif an \"orig-ioi\" header field parameter is received in the P-Charging-Vector header field, store the value of the received \"orig-ioi\" header field parameter; and\n12)\tcreate a 403 (Forbidden) response for the REGISTER request including a Response-Source header field with a \"fe\" header field parameter set to \"<urn:3gpp:fe:s-cscf >\" and send the so generated response.\nA S-CSCF supporting RLOS shall perform the procedures as specified in subclause 5.4.3.2 and in addition shall perform the procedures specified in this subclause.\nWhen the S-CSCF receives from the served user from an initial request for a dialog or a request for a standalone transaction and performing the procedures in subclause 5.4.3.2 and:\n1)\tif there is no original dialog identifier that the S-CSCF previously placed in a Route header field is present in the topmost Route header field of the incoming request; and\n2)\tif the Request- contains the dummy MSISDN value as defined in 3GPP TS 23.003 [3] or a RLOS service specific dial string and a P-Preferred-Service header set to \"urn:urn-7:3gpp-service.ims.icsi.rlos\" is included in the request;\nthe S-CSCF shall build an ordered list of initial filter criteria based on the temporary unauthenticated subscriber record for the public user identiy of the served user instead of building the ordered list of initial filter criteria as described in bullet 3).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "L.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "L.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "L.5\tUse of circuit-switched domain",
            "description": "There is no CS domain in this access technology.\nNOTE 1:\tIf the UE sends an INVITE request including voice codecs which is not successful due to a failure from the lower layers indicating that access is barred for originating calls but not specific to CSFB (see 3GPP TS 24.301 [8J]) and if the CS domain is supported and available, the UE can attempt the voice call via the CS domain.\nNOTE 2:\tIf the UE has sent an INVITE request including voice codecs, receives a 500 (Server Internal Error) response to this INVITE request containing no Retry-After header field, including a Reason header field with a protocol value set to \"FAILURE_CAUSE\" including a cause value header field parameter set to \"1\" as specified in subclause 7.2A.18.12.2, a Response-Source header field with a \"fe\" header field parameter set to \"<urn:3gpp:fe:p-cscf.orig>\", and the UE is attached to both PS and CS domains, the UE can attempt the voice call via the CS domain, e.g. by initiating a service request for CS fallback (see 3GPP TS 24.301 [8J]).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "M.1\tScope",
            "description": "This annex defines IP-CAN specific requirements for call control protocol for use in the IM CN subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is the cdma2000® packet data subsystem. It also defines procedures for invoking CS domain services.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "M.2\tcdma2000® packet data subsystem aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "M.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by the cdma2000® packet data subsystem to provide packet-mode communication between the UE and the IM CN subsystem.\nRequirements for the UE on the use of these packet-mode services are specified in this subclause. Requirements for the IP-CAN bearer control point (i.e. the point where the UE has attached itself to the cdma2000® packet data subsystem) support of this communication are specified in 3GPP2 X.S0011-E [127].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "M.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "M.2.2.1\tEstablishment of IP-CAN bearer and P-CSCF discovery",
                            "text_content": "Prior to communication with the IM CN subsystem, the UE shall:\na)\testablish a connection with the cdma2000® wireless IP network specified in 3GPP2 X.S0011-E [127]. Upon establishment a connection with the cdma2000® wireless IP network, the UE can have an IPv4 address only, an IPv6 address only, or both IPv4 and IPv6 addresses simultaneously;\nb)\tensure that an IP-CAN bearer used for SIP signalling is available. This IP-CAN bearer shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the last deregistration;\nThe UE shall choose one of the following options when performing establishment of this IP-CAN bearer:\nI.\tA dedicated IP-CAN bearer for SIP signalling:\nThe UE shall indicate to the IP-CAN bearer control point that this is an IP-CAN bearer intended to carry IM CN subsystem-related signalling only. The UE may also use this IP-CAN bearer for DNS and DHCP access.\nII.\tA general-purpose IP-CAN bearer:\nThe UE may decide to use a general-purpose IP-CAN bearer to carry IM CN subsystem-related signalling. The UE may carry both signalling and media on the general-purpose IP-CAN bearer; and\nc)\tdiscover a P-CSCF.\nThe methods for P-CSCF discovery are:\nI.\tUse DHCP mechanism\nII\tRetrieve the list of P-CSCF address(es) stored in the\nIII\tObtain the list of P-CSCF address(es) from the IMS management object\nThe UE can freely select method I, II, or III for P-CSCF discovery. If DHCP is used, the following procedures apply:\nUpon establishing an IP-CAN bearer, the UE may use the Dynamic Host Configuration Protocol (DHCP) specified in RFC 2131 [40A] or Dynamic Host Configuration Protocol for IPv6 (DHCPv6) specified in RFC 3315 [40] to discover the P-CSCF.\nPrior to accessing the DHCP server, the UE will have obtained an IP address via means other than DHCP and DHCPv6, see 3GPP2 X.S0011-E [127].\nIf the UE uses DHCP for P-CSCF discovery and the UE is unaware of the address of the DHCP server, the UE shall send the DHCPINFORM using the limited broadcast IP address (i.e., 255.255.255.255) and UDP port 67. If the UE knows the IP address of the DHCP server, the UE shall send the DHCPINFORM to the DHCP server's unicast IP address and UDP port 67. The DHCP server shall send the DHCPACK on the IP address specified in the Client IP Address field of the DHCPINFORM. The DHCP server may include, in the DHCPACK, the SIP Server DHCP Option specified in RFC 3361 [35A], which carries either a list of IPv4 address(es) of the P-CSCF(s) or a list of DNS fully qualified domain name(s) that can be mapped to one or more P-CSCF(s). If the UE uses DHCPv6 for P-CSCF discovery and the UE is unaware of the address of the DHCP Server, the UE shall send an Information Request using the IPv6 multicast address FF02::1:2 and the UDP port 547. If the UE knows the IP address of the DHCPv6 server, the UE shall send the Information Request message to the DHCPv6 server's IP address and UDP port 547. In the Information Request, the UE may request either one or both the SIP Servers Domain Name List option and the SIP Servers IPv6 Address List option specified in RFC 3319 [41]. The DHCP server shall send the Reply to the IP address specified in the Information Request. The DHCP server may include in the Reply either one or both the SIP Servers Domain Name List option and the SIP Servers IPv6 Address List option, as requested by the UE.\nIn case several P-CSCF's IP addresses or domain names are provided to the UE, the UE shall perform P-CSCF selection according to RFC 3361 [35A] or RFC 3319 [41]. The UE shall perform the procedure for the resolution of domain name according to RFC 3263 [27A].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.2.2.1A\tModification of IP-CAN used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.2.2.1B\tRe-establishment of the IP-CAN used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "A UE supporting the P-CSCF restoration procedure uses the keep-alive procedures described in RFC 6223 [143].\nIf the P-CSCF fails to respond to the keep-alive request the UE shall acquire a different P-CSCF address using any of the methods described in the subclause M.2.2.1 and perform an initial registration as specified in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.2.2.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.2.2.3\tIP-CAN bearer control point support of DHCP based P-CSCF discovery",
                            "text_content": "The IP-CAN bearer control point, or Home Agent in case of Mobile IP with reverse tunneling, may forward the packet to one or more local DHCP servers, or relay the packet to a specific DHCP server. The IP-CAN bearer control point, or Home Agent in case of Mobile IP with reverse tunnelling, shall not forward the DHCPINFORM (or Information-Request) to any UE.\nNOTE 1:\tFor forwarding the DHCPINFORM or Information-Request, the IP-CAN bearer control point, or Home Agent in case of Mobile IP with reverse tunnelling, does not change the destination IP address of the packet.\nNOTE 2:\tFor relaying the DHCPINFORM or Information-Request, the IP-CAN bearer control point, or Home Agent in case of Mobile IP with reverse tunnelling inserts a DHCP server's IP address in the destination IP address field of the packet.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.2.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.2.2.5\tHandling of the IP-CAN for media",
                            "text_content": "Not applicable.\nNot applicable.\nNot applicable.\nNot applicable.\nNot applicable.\nNot applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.2.2.6\tEmergency service",
                            "text_content": "When establishing an HRPD session to perform emergency registration, the UE shall follow the procedures defined in 3GPP2 X.S0060 [86B].\nTo determine whether the HRPD UE is attached to the home network or to the visited network, the UE shall compare the Carrier ID values obtained per 3GPP2 X.S0060 [86B]. If the Carrier ID of the network the UE is attached to does not match with the provisioned Carrier ID, then for the purpose of emergency calls in the IM CN subsystem the UE shall consider to be attached to a visited network.\nNOTE:\tFor 3GPP2-1X and 3GPP2-UMB, no IP-CAN specific support is provided in the current release. No carrier identification is provided for 3GPP2-1X or 3GPP2-UMB in the P-Access-Network-Info header field, and thus there is no IMS specific procedure for identifying that the UE is in the home network.\nNot applicable.\nNot applicable.\nThe UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "M.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "M.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "M.2A.1\tImpact on SDP offer / answer of activation or modification of IP-CAN for media by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "M.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "M.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "No additional procedures defined.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "M.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "M.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "M.3.1.0\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The UE shall always include the P-Access-Network-Info header field where indicated in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.2\tAvailability for calls",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.2A\tAvailability for SMS",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.3\tAuthorization header field",
                            "text_content": "When using SIP digest or SIP digest without , the UE need not include an Authorization header field on sending a REGISTER request, as defined in subclause 5.1.1.2.1.\nNOTE:\tIn case the Authorization header field is absent, the mechanism only supports that one public user identity is associated with only one private user identity. The public user identity is set so that it is possible to derive the private user identity from the public user identity by removing SIP  scheme and the following parts of the SIP  if present: port number,  parameters, and To header field parameters. Therefore, the public user identity used for registration in this case cannot be shared across multiple UEs. Deployment scenarios that require public user identities to be shared across multiple UEs that don't include an private user identity in the initial REGISTER request can be supported as follows:\n- Assign each sharing UE a unique public user identity to be used for registration,\n- Assign the shared public user identitiess to the implicit registration set of the unique registering public user identities assigned to each sharing UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.5\t3GPP PS data off",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.6\tTransport mechanisms",
                            "text_content": "No additional requirements are defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.1.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "M.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "M.3.2.0\tRegistration and authentication",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "For an HRPD UE, after the initial request for a dialog or standalone transaction or an unknown method is received the P-CSCF shall check the Carrier ID field received in the P-Access-Network-Info header field to determine from which network the request was originated.\nNOTE:\tFor 3GPP2-1X and 3GPP2-UMB, no IP-CAN specific support is provided in the current release. No carrier identification is provided for 3GPP2-1X or 3GPP2-UMB in the P-Access-Network-Info header field, and thus there is no IMS specific procedure for identifying that the UE is in the home network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.2.2\tLocation information handling",
                            "text_content": "Void\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.2.6\tResource sharing",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.2.7\tPriority sharing",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.2.8\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "M.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "M.3.3.1\tNotification of AS about registration status",
                            "text_content": "The procedures described in subclause 5.4.1.7 apply with the additional procedures described in the present subclause:\n1)\tin case the received REGISTER request contained a Timestamp header field, the S-CSCF shall insert a Timestamp header field with the value of the Timestamp header field from the received REGISTER request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "M.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "M.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "M.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "M.5\tUse of circuit switched domain",
            "description": "When an emergency call is to be set up over the CS domain, the UE shall attempt it according to the procedures described in 3GPP2 C.S0005-D [85].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "N.1\tScope",
            "description": "This annex defines the procedures performed by network entities within the IM CN subsystem to support overlap signalling.\nThe support of overlap signalling within the IM CN subsystem is optional, and is depended on the network policy.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "N.2\tDigit collection function",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "N.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The digit collection function is invoked if an entity requires additional digits for a decision where to route a INVITE request.\nNOTE 1:\tThe digit collection function is only applicable for the in-dialog method of overlap signalling. Further information about digit collection is provided in subclause 4.9.3.3.\nThe digit collection function may interact with a routeing database, to reach this decision. The digit collection function shall be performed by an entity acting as a B2BUA. The digit collection function requires the ability to recognise incomplete numbers. The digit collection function may be implemented in different network nodes depending on the operator's deployment strategy (e.g. AS, IBCF).\nNOTE 2:\tAn HSS does not support the recognition of incomplete numbers. A routeing database being queried by ENUM also does not support the recognition of incomplete numbers.\nNOTE 3:\tA private routeing database to support the recognition of incomplete numbers e.g. for transit calls or ported numbers can be used.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "N.2.2\tCollection of digits",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "N.2.2.1\tInitial INVITE request",
                            "text_content": "Upon receiving an initial INVITE request carrying an SDP offer, the digit collection function shall:\n1)\tif the request contains enough digits to forward the request, forward the request towards it's destination;\n2)\tif the digit collection function chooses to collect additional digits in INFO requests, in order to forward the request, and the sender of the INVITE request has indicated support of reliable responses, store the received digits and send a reliable 183 (Session Progress) provisional response in order to establish an early dialog with the sender of the INVITE request. The response shall not contain an SDP answer; or\n3)\tif it is determined that the en-bloc will not be able to forward the request even if additional digits are received,, send a 404 (Not Found) response.\nUpon receiving an initial INVITE request without an SDP offer, the digit collection function shall:\n1)\tif the request contains enough digits to forward the request, forward the request towards it's destination; or\n2)\tsend a 404 (Not Found) response.\nNOTE 1:\tIf the initial INVITE request does not contain an SDP offer, a reliable 18x provisional response generated by the en-bloc conversion function would have to contain an SDP offer. In this case digit collection needs to be performed by the originating SIP entity (e.g. MGCF).\nWhen the digit collection function sends the reliable 183 (Session Progress) provisional response, in order to establish an early dialog with the sender of the INVITE request, the digit collection function shall start a digit collection timer. If the timer expires, the digit collection function shall terminate the call setup by sending a sending a 484 (Address Incomplete) response towards the sender of the INVITE request.\nNOTE 2:\tThe digit collection timer is similar to the protection timer used in PSTN/ISDN. The timer value range is between 5 and 15 seconds, and the default value is 10 seconds.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "N.2.2.2\tCollection of additional digits",
                            "text_content": "Upon receiving an INFO request carrying additional digits, and if an early dialog towards the destination of the initial INVITE request for the call does not exist, the digit collection function shall:\n1)\tsend a 200 (OK) response to the INFO request;\n2)\tadd the received digits to the previously stored digits for the call;\n3)\trestart the digit collection timer; and\n4)\tcheck if enough digits have been received in order to forward the initial INVITE request.\nWhen enough digits for the call have been received in order to forward the initial INVITE request, the digit collection function shall add all stored digits to the request  and forward the request towards its destination and stop the digit collection timer.\nUpon receiving an INFO request carrying additional digits, and the initial INVITE request has been forwarded towards its destination, but an early dialog towards the destination of the initial INVITE request for the call does not exist, the digit collection function shall:\n1)\tsend a 200 (OK) response to the INFO request; and\n2)\tadd the received digits to the previously stored, but yet not forwarded, digits for the call;\nWhen the digit collection function receives a provisional response from the destination of the initial INVITE request, and the digit collection function has received additional digits in INFO requests, the digit collection shall generate and send an INFO request towards the destination of the initial INVITE request. The Request- shall contain all digits which have been received and stored since the initial INVITE request was forwarded.\nUpon receiving an INFO request carrying additional digits, and if an early dialog towards the destination of the initial INVITE request for the call does exist, the digit collection function shall forward the INFO request on the early dialog towards the destination of the initial SIP INVITE request.\nUpon receiving an INFO request carrying additional digits, and if a 180 (Ringing) or a 200 (OK) response to the initial INVITE request for the call has been received, or the digit collection function has received some other indication that enough digits have been forwarded in order for the INVITE request to reach the terminating SIP user, the digit collection function shall, based on operator policy:\n1)\tsend a 200 (OK) response to the INFO request and not forward the INFO request; or\n2)\tforward the INFO request on the early dialog towards the destination of the initial SIP INVITE request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "N.2.2.3\tHandling of 404 (Not Found) / 484 (Address Incomplete) responses",
                            "text_content": "Upon receiving a 404/484 response to the initial INVITE request, the digit collection function shall acknowledge the response and shall start the digit collection timer. The digit collection function shall not forward the response towards the sender of the INVITE request.\nNOTE:\tIf the digit collection function has received a 404/484 response, it will send a new initial INVITE request when it has received additional digits as described above, in order to establish an early dialog towards the destination of the INVITE request. The digit collection timer will re-start if an INFO request with additional digits is received. At timer expiry, the digit collection function will terminate the call as described above\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "N.2.3\tForwarding of SIP messages by the digit collection function",
                    "description": "",
                    "summary": "",
                    "text_content": "Apart from 404/484 responses to the initial INVITE request, and INFO requests carrying additional digits received after a 180 (Ringing) or a 200 (OK) response to the initial INVITE request has been received, the digit collection function shall forward all SIP messages. When forwarding SIP messages, the digit collection function shall modify the SIP messages to comply with SIP procedures on both call legs as specified below:\n1)\tThe digit collection function will receive a \"tag\" To header field parameter value from the receiver of the initial INVITE request, which is different from the \"tag\" To header field parameter value that the digit collection function inserted in the 183 (Session Progress) response that it sent when it received the initial INVITE request. The digit collection function shall modify the \"tag\" header field parameter value accordingly when forwarding mid-dialog SIP messages.\n2)\tThe digit collection function will return a Contact header field in the initial 183 (Session Progress) provisional response to the originating side, which contains a SIP- of the digit collection function. The contact information is used in the Request- of subsequent mid-dialog SIP requests sent by the originating side, until the digit collection function has received, and forwarded to the originating side, a 183 (Session Progress) provisional response from the destination of the INVITE request. If the Request- of the received mid-dialog SIP request contains the SIP- of the digit collection function, and the digit collection function forwards the request, the digit collection function shall modify the Request- before forwarding the SIP request.\n3)\tThe digit collection function will return the Record-Route header fields, which it received in the initial INVITE request, in the initial 183 (Session Progress) provisional response to the originating side. The information is used in the Route header fields of subsequent mid-dialog SIP requests sent by the originating side, until the digit collection function has received, and forwarded to the originating side, a 183 (Session Progress) provisional response from the destination of the INVITE request. If the Route header fields of the received mid-dialog SIP request are based on the Record-Route headers fields which the digit collection function returned in the initial 183 (Session Progress) provisional response, and the digit collection function forwards the request, the digit collection function shall modify the Route header fields before forwarding the SIP request.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "N.3\tEn-bloc conversion function",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "N.3.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The en-bloc conversion function may be performed in an entity acting as B2BUA. The en-bloc conversion function may be implemented in different network nodes depending on the operator's deployment strategy (e.g. AS, IBCF).\nIf the initial INVITE request is to be forwarded towards a network, or towards a network entity, that does not support overlap signalling, the en-bloc conversion function shall determine the end of address signalling.\nThe following methods can be used to determine the end of the address signalling:\n1)\tthe maximum number of digits used in a national numbering plan has been received;\n2)\tnumber analysis, e.g. using a provisioned dial plan, is used to determinte that the complete number of digits has been received; or\n3)\tan inter digit timer expires, and the minimum number of digits required for routeing the call have been received. The timer is started when the initial INVITE request is received, and re-started every time new digit(s) are received.\nNOTE:\tThe inter digit timer is similar to the protection timer used in PSTN/ISDN. The timer value range is between 5 and 15 seconds, and the default value is 10 seconds.\nThe procedures for collecting additional digits are described in subclauses N.3.2 and N.3.3. When end of address signalling has been determined, the en-bloc conversion function shall generate an INVITE request, add all digits to the request and forwards the request towards its destination.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "N.3.2 Multiple-INVITE method",
                    "description": "",
                    "summary": "",
                    "text_content": "Upon reception of an INVITE request, the en-bloc conversion function shall:\n1)\tif an inter digit timer is running for a previously received INVITE request with the same Call-ID and From header, and\na)\tif the number of digits within that previous INVITE request is below the number of digits received in the new INVITE request (or as an equivalent test if the CSeqID of the previous INVITE request is below the CSeqID of the new INVITE request), stop the inter-digit timer for that previous INVITE request and send a 484 (Address Incomplete) response for it; and\nb)\tif the number of digits with the previous INVITE request is above or equal to the number of digits received in the new INVITE request (or as an equivalent test if the CSeqID of the previous INVITE request is below the CSeqID of the new INVITE request), send a 484 (Address Incomplete) response for the new INVITE request; and\n2)\tif the en-bloc conversion function determines that the number received in the INVITE request is complete, forward the INVITE request; and\n3)\tif the en-bloc conversion function determines that it will not be able to forward the request even if additional digits are received, send a 404 (Not Found) response; and\n4)\tif the en-bloc conversion function chooses to collect additional digits, store the INVITE request and start an inter-digit timer to wait for possible INVITE requests with the same Call ID and From header.\nWhen the inter-digit timer expires the en-bloc conversion function shall:\n1)\tif it determines that the number received in the stored INVITE request is incomplete (e. g. by number analysis), terminate the call setup by sending a sending a 484 (Address Incomplete) response towards the sender of the INVITE request; and\n2)\tif it does not determines that the number received in the last INVITE request is incomplete, forward the corresponding stored INVITE request to the next hop.\nAfter forwarding an INVITE request, the en-bloc conversion function shall apply SIP proxy procedures for all subsequent SIP messages within the corresponding dialogue, unless other functionality not related to en-bloc conversion allocated in the same physical norde requires a different behaviour.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "N.3.3\tIn-dialog method",
                    "description": "",
                    "summary": "",
                    "text_content": "Upon receiving an initial INVITE request carrying an SDP offer, the en-bloc conversion function shall:\n1)\tif it determines that the request contains a complete number, forward the request towards it's destination;\n2)\tif the en-bloc conversion function chooses to collect additional digits in INFO requests before forwarding the request, and the sender of the INVITE request has indicated support of reliable responses, store the received digits, send a reliable 183 (Session Progress) provisional response without an SDP answer in order to establish an early dialog with the sender of the INVITE request, and start an inter digit timer; or\n3)\tif the en-bloc conversion function determines that it will not be able to forward the request even if additional digits are received, send a 404 (Not Found) response.\nUpon receiving an initial INVITE request without an SDP offer, the en-bloc conversion function shall:\n1)\tif it is determined that the request contains a complete number, forward the request towards it's destination; or\n2)\tsend a 404 (Not Found) response.\nNOTE:\tIf the initial INVITE request does not contain an SDP offer, a reliable 18x provisional response generated by the en-bloc conversion function would have to contain an SDP offer. The en-bloc conversion function for the in-dialog method specified here does not support en-bloc conversion for calls with an initial INVITE request that does not contain an SDP offer in the present release. However, en-bloc conversion for an initial INVITE request that does not contain an SDP offer can be performed by the originating SIP entity (e.g. MGCF).\nUpon receiving an INFO request carrying additional digits, and an early dialog towards the destination of the initial SIP INVITE request for the call has not been created, the en-bloc conversion function shall:\n1)\tsend a 200 (OK) response to the INFO request;\n2)\tadd the received digits to the previously stored digits for the call;\n3)\tre-start the inter digit timer; and\n4)\tcheck if it can determine that a complete number for the call has been received.\nWhen the en-bloc conversion function determines that a complete number for the call has been received, it shall add all stored digits to the initial INVITE request and forward the request towards its destination and stop the inter digit timer.\nWhen the inter-digit timer expires the en-bloc conversion function shall\n1)\tif it determines that the number so far is incomplete (e. g. by number analysis), terminate the call setup by sending a sending a 484 (Address Incomplete) response towards the sender of the INVITE request; or\n2)\tif it does not determines that the number received in the last INVITE request is incomplete, forward the INVITE request to the next hop, including all received digits.\nUpon receiving an INFO request carrying additional digits, if the en-bloc conversion function has forwarded the initial INVITE request towards its destination, the en-bloc conversion function shall send a 200 (OK) response to the INFO request and not forward the INFO request.\nApart from INFO requests carrying additional digits received after the initial INVITE request has been forwarded, the en-bloc conversion function shall forward all SIP messages.\nThe en bloc conversion function will receive a \"tag\" To header field parameter value from the receiver of the initial INVITE request, which is different from the \"tag\" To header field parameter value that the digit collection function inserted in the 183 (Session Progress) response that it sent when it received the initial INVITE request. The digit collection function shall modify the \"tag\" To header field parameter value accordingly when forwarding in-dialog SIP messages.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "O.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is the Evolved Packet Core () via a cdma2000® HRPD access network.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "O.2\tIP-CAN aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "O.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by the  and cdma2000® HRPD access network as specified by 3GPP2 X.P0057 [86C] to provide packet-mode communication between the UE and the IM CN subsystem.\nRequirements for the UE on the use of these packet-mode services are specified in this clause. Requirements for the P-GW in support of this communication are specified in 3GPP TS 29.061 [11] and 3GPP TS 29.212 [13B].\nRequirements for the use of the  via packet cdma2000® HRPD as an IP-CAN are specified in 3GPP2 X.P0057 [86C].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "O.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "O.2.2.1\tIP-CAN bearer context activation and P-CSCF discovery",
                            "text_content": "Prior to communication with the IM CN subsystem, the UE shall:\na)\testablish a connection with the IP-CAN via the cdma2000® HRPD wireless IP network specified in 3GPP2 X.P0057 [86C]. Upon establishing a connection with the cdma2000® eHRPD wireless IP network, the UE can have an IPv4 address only, an IPv6 address only, or both IPv4 and IPv6 addresses simultaneously;\nb)\tensure that a IP-CAN bearer context used for SIP signalling is available, according to the  and P-GW selection criteria described in 3GPP TS 23.402 [7E]. This IP-CAN bearer context shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration; and\nNOTE 1:\tAny IP-CAN bearer can carry both IM CN subsystem signalling and media if the media does not need to be authorized by Policy and Charging control mechanisms as defined in 3GPP TS 29.212 [13B], and the media stream is not mandated by the P-CSCF to be carried in a separate IP-CAN bearer.\nNOTE 2:\tIP-CAN PDN connection and bearer management procedures are specified in 3GPP2 X.P0057 [86C].\nc)\tacquire a P-CSCF address(es).\nThe methods for P-CSCF discovery are:\nI.\tUse DHCP mechanism\nII\tRetrieve the list of P-CSCF address(es) stored in the\nIII\tObtain the list of P-CSCFaddress(es) from the IMS management object\nIV.\tTransfer P-CSCF address(es) within the IP-CAN bearer context activation procedure.\nThe UE shall indicate the request for a P-CSCF address to the network within the Protocol Configuration Options information element of the during PDN connectivity establishment as specified in 3GPP2 X.P0057 [86C].\nIf the network provides the UE with a list of P-CSCF IPv4 or IPv6 addresses, the UE shall assume that the list is prioritised with the first address within the Protocol Configuration Options information element as the P-CSCF address with the highest priority.\nThe UE can freely select method I, II, III, or IV for P-CSCF discovery. If DHCP is used, the following procedures apply:\nUpon establishing an IP-CAN bearer, the UE may use the Dynamic Host Configuration Protocol (DHCP) specified in RFC 2131 [40A] or Dynamic Host Configuration Protocol for IPv6 (DHCPv6) specified in RFC 3315 [40] to discover the P-CSCF.\nPrior to accessing the DHCP server, the UE will have obtained an IP address via means other than DHCP and DHCPv6.\nIf the UE uses DHCP for P-CSCF discovery and the UE is unaware of the address of the DHCP server, the UE shall send the DHCPINFORM using the limited broadcast IP address (i.e., 255.255.255.255) and UDP port 67. If the UE knows the IP address of the DHCP server, the UE shall send the DHCPINFORM to the DHCP server's unicast IP address and UDP port 67. The DHCP server shall send the DHCPACK on the IP address specified in the Client IP Address field of the DHCPINFORM. The DHCP server may include, in the DHCPACK, the SIP Server DHCP Option specified in RFC 3361 [35A], which carries either a list of IPv4 address(es) of the P-CSCF(s) or a list of DNS fully qualified domain name(s) that can be mapped to one or more P-CSCF(s). If the UE uses DHCPv6 for P-CSCF discovery and the UE is unaware of the address of the DHCP Server, the UE shall send an Information Request using the IPv6 multicast address FF02::1:2 and the UDP port 547. If the UE knows the IP address of the DHCPv6 server, the UE shall send the Information Request message to the DHCPv6 server's IP address and UDP port 547. In the Information Request, the UE may request either one or both the SIP Servers Domain Name List option and the SIP Servers IPv6 Address List option specified in RFC 3319 [41]. The DHCP server shall send the Reply to the IP address specified in the Information Request. The DHCP server may include in the Reply either one or both the SIP Servers Domain Name List option and the SIP Servers IPv6 Address List option, as requested by the UE.\nIf the UE supports the optional configuration parameter \"Access_Point_Name_Parameter_Reading_Rule\", as defined in 3GPP TS 24.167 [8G] and has been configured with this parameter, then the UE shall use it to retrieve the access point name to use in the IP CAN bearer context activation procedure.\nIn case several P-CSCF's IP addresses or domain names are provided to the UE, the UE shall perform P-CSCF selection according to RFC 3361 [35A] or RFC 3319 [41]. The UE shall perform the procedure for the resolution of domain name according to RFC 3263 [27A].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.2.2.1A\tModification of an IP-CAN bearer context used for SIP signalling",
                            "text_content": "The UE shall not modify the IP-CAN bearer from being used exclusively for SIP signalling to a general purpose IP-CAN bearer and vice versa.\nAfter the establishment of a SIP bearer context used for SIP signalling, the UE shall not indicate the request for a P-CSCF address to the network when requesting an IP-CAN bearer modification for that . The UE shall ignore P-CSCF address(es) if received from the network as part of the bearer modification procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.2.2.1B\tRe-establishment of the IP-CAN bearer context for SIP signalling",
                            "text_content": "If the IP-CAN bearer context for SIP signalling is lost and cannot be re-established:\na.\tif the SIP signalling was carried over a dedicated IP-CAN bearer, the UE shall release all resources established as a result of SIP signalling by either:\n-\trequesting an IP-CAN bearer modification if there are IP-CAN bearers to this PDN that are not related SIP sessions; or\n-\tinitiating disconnection of the PDN connection if all the bearers to this PDN are related to SIP sessions.\nNOTE:\tIf the SIP signalling was carried over the default IP-CAN bearer, all the resources established as a result of SIP signalling are released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "A UE supporting the P-CSCF restoration procedure performs one of the following procedures:\nA\tif the UE used method II for P-CSCF discovery and if the UE receives one or more P-CSCF address(es) in an VSNCP Configure-Request message and the one or more P-CSCF addresse(s) do not include the address of the currently used P-CSCF, then the UE shall acquire a different P-CSCF address from the one or more P-CSCF addresse(s) in the VSNCP Configure-Request message. The UE shall assume that the more than one P-CSCF address are prioritised with the first P-CSCF address within the Protocol Configuration Options information element as the P-CSCF address with the highest priority;\nB\tif the UE uses RFC 6223 [143] as part of P-CSCF restoration procedures, and if the P-CSCF fails to respond to a keep-alive request, then the UE shall acquire a different P-CSCF address using one of the methods I, II and III for P-CSCF discovery described in the subclause O.2.2.1.\nWhen a different P-CSCF address is acquired the UE shall perform an initial registration as specified in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.2.2.2\tSession management procedures",
                            "text_content": "The existing procedures for session management as described in 3GPP2 X.P0057 [86C] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.2.2.3\tMobility management procedures",
                            "text_content": "The existing procedures for mobility management as described in 3GPP2 X.P0057 [86C] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.2.2.4\tCell selection and lack of coverage",
                            "text_content": "The existing mechanisms and criteria for cell selection as described in 3GPP2 C.S0014-C [86D] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.2.2.5\tIP-CAN bearer contexts for media",
                            "text_content": "NOTE 1:\tThe UE cannot control whether media streams belonging to different SIP sessions are established on the same IP-CAN bearer context or not. During establishment of a session, the UE establishes data streams(s) for media related to the session. Such data stream(s) can result in activation of additional IP-CAN bearer context(s). Either the UE or the network can request for resource allocations for media, but the establishment and modification of the IP-CAN bearer is controlled by the network as described in 3GPP2 X.P0057 [86C].\nNOTE 2:\tWhen the UE wishes to allocate bandwidth for  and RTCP, the rules as outlined in 3GPP TS 29.213 [13C] apply. Application of QoS to when using an  IP-CAN with cdma2000® HRPD is described in 3GPP2 X.P0057 [86C].\nNo additional clarifications are needed for the use of the  via cdma2000® HRPD as an IP-CAN.\nIf the UE receives an activation request from the network for an IP-CAN bearer context which is associated with the IP-CAN bearer context used for signalling, the UE shall, based on the information contained in the Traffic Flow Template provided by the network, correlate the media IP-CAN bearer context with a currently ongoing SIP session establishment or SIP session modification.\nIf the UE receives a modification request from the network for an IP-CAN bearer context that is used for one or more media streams in an ongoing SIP session, the UE shall modify the related IP-CAN bearer context in accordance with the request received from the network.\nNot applicable\nNOTE 1:\tThe procedures in this subclause only apply when the UE requests activation and modification of media bearers. In the case where the network activates and modifies the media bearers the network takes care of the handling of media bearers in the case of forking.\nSince the UE does not know that forking has occurred until a second, provisional response arrives, the UE requests resource allocation as required by the initial response received. If a subsequent provisional response is received, different alternative actions may be performed depending on the requirements in the SDP answer:\n1)\tthe bearer requirements of the subsequent SDP can be accommodated by the existing resources requested. The UE performs no further resource requests.\n2)\tthe subsequent SDP introduces different QoS requirements or additional IP flows. The UE requests further resource allocation according to subclause O.2.2.5.1.\n3)\tthe subsequent SDP introduces one or more additional IP flows. The UE requests further resource allocation according to subclause O.2.2.5.1.\nNOTE 2: When several forked responses are received, the resources requested by the UE are the \"logical OR\" of the resources indicated in the multiple responses to avoid allocation of unnecessary resources. The UE does not request more resources than proposed in the original INVITE request.\nWhen a final answer is received for one of the early dialogs, the UE proceeds to set up the SIP session. The UE shall release all the unneeded IP-CAN resources. Therefore, upon the reception of the first final 200 (OK) response for the INVITE request (in addition to the procedures defined in RFC 3261 [26] subclause 13.2.2.4), the UE shall:\n1)\tin case resources were established or modified as a consequence of the INVITE request and forked provisional responses that are not related to the accepted 200 (OK) response, send release request to release the unneeded resources.\nNot applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.2.2.6\tEmergency service",
                            "text_content": "Emergency services is not supported when the IP-CAN is the  via a cdma2000® HRPD access network.\nNot applicable.\nNot applicable.\nThe UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "O.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "O.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "O.2A.1\tImpact on SDP offer / answer of activation or modification of IP-CAN bearer context for media by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "If, due to the activation of an IP-CAN bearer context from the network the related SDP media description needs to be changed the UE shall update the related SDP information by sending a new SDP offer within a SIP request, which is sent over the existing SIP dialog,\nIf the UE receives a modification request from the network for an IP-CAN bearer context that is used for one or more media streams in an ongoing SIP session, the UE shall:\n1)\tif, due to the modification of the IP-CAN bearer context, the related SDP media description need to be changed, update the related SDP information by sending a new SDP offer within a SIP request, that is sent over the existing SIP dialog, and respond to the IP-CAN bearer context modification request.\nNOTE:\tThe UE can decide to indicate additional media streams as well as additional or different codecs in the SDP offer than those used in the already ongoing session.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "O.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "If the UE receives an SDP offer where the SDP offer includes all media streams for which the originating side indicated its local preconditions as met, if the precondition mechanism is supported by the terminating UE and the IP-CAN performs network-initiated resource reservation for the terminating UE and the available resources are not sufficient for the received offer the terminating UE shall indicate its local preconditions and provide the SDP answer to the originating side without waiting for resource reservation.\nNOTE:\tIf the resource reservation is controlled by the network, the resource reservation request is initiated by the network after the P-CSCF has authorised the respective IP flows and provided the QoS requirements over the Rx interface to the PCRF as described in 3GPP TS 29.214 [13D].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "O.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "No additional procedures defined.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "O.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "O.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "O.3.1.0\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The UE shall always include the P-Access-Network-Info header field where indicated in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.2\tAvailability for calls",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.2A\tAvailability for SMS",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.3\tAuthorization header field",
                            "text_content": "When using SIP digest or SIP digest without , the UE need not include an Authorization header field on sending a REGISTER request, as defined in subclause 5.1.1.2.1.\nNOTE:\tIn case the Authorization header field is absent, the mechanism only supports that one public user identity is associated with only one private user identity. The public user identity is set so that it is possible to derive the private user identity from the public user identity by removing SIP  scheme and the following parts of the SIP  if present: port number,  parameters, and To header field parameters. Therefore, the public user identity used for registration in this case cannot be shared across multiple UEs. Deployment scenarios that require public user identities to be shared across multiple UEs that don't include an private user identity in the initial REGISTER request can be supported as follows:\n- Assign each sharing UE a unique public user identity to be used for registration,\n- Assign the shared public user identitiess to the implicit registration set of the unique registering public user identities assigned to each sharing UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.5\t3GPP PS data off",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.6\tTransport mechanisms",
                            "text_content": "No additional requirements are defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.1.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "O.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "O.3.2.0\tRegistration and authentication",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "The P-CSCF handling is as defined in subclause M.3.2.\nNOTE:\tEmergency call support for the  IP-CAN is not specified in this release. A common P-Access-Network-Info header field value is used for both cdma2000® HRPD based IP-CANs (i.e. HRPD access specified by 3GPP2 X.S0011-E [127], and HRPD access as specified by 3GPP2 X.P0057 [86C]). The result of this is that in both cases the handling in the P-CSCF will be identical. If an operator deploys an IM CN subsystem with both cdma2000® HRPD based IP-CANs, the P-CSCF has no means of distinguishing one from the other. The emergency call handling for the  IP-CAN using cdma2000® HRPD access as specified by 3GPP2 X.P0057 [86C] is out of scope for this release of this specification, and therefore all identified emergency calls with a P-Access-Network-Info header field value of \"3GPP2-1X-HRPD\" will be handled with a 380 (Alternative Service) response when HRPD IP-CAN emergency support is not active.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.2.2\tLocation information handling",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.2.6\tResource sharing",
                            "text_content": "If the P-CSCF supports resource sharing,  is supported for this access technology and if according to local policy, the P-CSCF shall apply the procedures in subclause L.3.2.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.2.7\tPriority sharing",
                            "text_content": "If the P-CSCF supports priority sharing,  is supported for this access technology and if according to operator policy, the P-CSCF shall apply the procedures in subclause L.3.2.7.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.2.8\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "O.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "O.3.3.1\tNotification of AS about registration status",
                            "text_content": "The S-CSCF handling is as defined in subclause M.3.3.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "O.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "O.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "O.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "O.5\tUse of circuit-switched domain",
            "description": "There is no CS domain in this access technology.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "Q.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is an IP network as incorporated into the cdma2000® 1x femtocell network subsystem [86E].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "Q.2\tcdma2000® 1x Femtocell Network aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "Q.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "In the cdma2000® 1x femtocell network subsystem, the cdma2000® 1x Mobile Station (MS) accesses the IM CN subsystem by utilising the services provided by the cdma2000® 1x Femtocell Access Point (FAP) [86E].\nNOTE:\tProtocol between the cdma2000® 1x MS and the cdma2000® 1x FAP is out of scope of this document.\nThe cdma2000® 1x FAP 3GPP2 X.P0059-200 [86E] acts as a UE toward the IM CN subsystem.\nFrom the perspective of the FAP, it is assumed that one or more IP-CAN bearer(s) are provided, in the form of connection(s) managed by the layer 2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "Q.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "Q.2.2.1\tActivation and P-CSCF discovery",
                            "text_content": "Unless a static IP address is allocated to the cdma2000® 1x FAP, prior to communication with the IM CN subsystem, the cdma2000® 1x FAP shall perform a Network Attachment procedure depending on the used cdma2000® 1x FAP access type. When using a cdma2000® 1x FAP access, both IPv4 and IPv6 may be used to access the IM CN subsystem. The cdma2000® 1x FAP may request a DNS Server IPv4 address(es) via RFC 2132 [20F] or a DNS Server IPv6 address(es) via RFC 3315 [40].\nWhen using IPv4, the cdma2000® 1x FAP may acquires a P-CSCF address(es) by using the DHCP (see RFC 2132 [20F]), the DHCPv4 options for SIP servers (see RFC 3361 [35A]), and RFC 3263 [27A].\nIn case the DHCP server provides several P-CSCF addresses or FQDNs to the cdma2000® 1x FAP, the cdma2000® 1x FAP shall select the P-CSCF address or FQDN as indicated in RFC 3361 [35A]. If sufficient information for P-CSCF address selection is not available, selection of the P-CSCF address by the cdma2000® 1x FAP is implementation specific.\nWhen using IPv6, the cdma2000® 1x FAP may acquires a P-CSCF address(es) by using the DHCPv6 (see RFC 3315 [40] and RFC 3646 [56C]), the DHCPv6 options for SIP servers (see RFC 3319 [41]), and RFC 3263 [27H].\nIn case the DHCP server provides several P-CSCF addresses or FQDNs to the cdma2000® 1x FAP, the cdma2000® 1x FAP shall select the P-CSCF address or FQDN as indicated in RFC 3319 [41]. If sufficient information for P-CSCF address selection is not available, selection of the P-CSCF address by the cdma2000® 1x FAP is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.2.2.1A\tModification of IP-CAN used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.2.2.1B\tRe-establishment of IP-CAN used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.2.2.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.2.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.2.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.2.2.5\tHandling of the IP-CAN for media",
                            "text_content": "The cdma2000® 1x FAP uses the bearer used for signalling also for transmission of media.\nNot applicable.\nNot applicable.\nNot applicable\nNot applicable.\nNot applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.2.2.6\tEmergency service",
                            "text_content": "Emergency calls are perceived as regular calls from the perspective of the IM CN subsystem. Entities outside the IM CN subsystem identify and route such calls to PSAP.\nNot applicable.\nNot applicable.\nThe UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "Q.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "Q.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "Q.2A.1\tImpact on SDP offer / answer of activation or modification of IP-CAN for media by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "Q.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "Q.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "No additional procedures defined.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "Q.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "Q.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "Q.3.1.0\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The cdma2000® 1x FAP shall include the P-Access-Network-Info header field where indicated in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.2\tAvailability for calls",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.2A\tAvailability for SMS",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.3\tAuthorization header field",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.5\t3GPP PS data off",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.6\tTransport mechanisms",
                            "text_content": "No additional requirements are defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.1.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "Q.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "Q.3.2.0\tRegistration and authentication",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "If access-type field in the P-Access-Network-Info header field indicated 3GPP2-1X-Femto access the P-CSCF shall assume that an initial request for a dialog or standalone transaction or an unknown method destined for a PSAP is initiated in the same country.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.2.2\tLocation information handling",
                            "text_content": "Not applicable\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.2.6\tResource sharing",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.2.7\tPriority sharing",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.2.8\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "Q.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "Q.3.3.1\tNotification of AS about registration status",
                            "text_content": "Not applicable\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Q.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "Q.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "Q.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "Q.5\tUse of circuit-switched domain",
            "description": "Not applicable\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "R.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IM CN subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is the Evolved Packet Core () via Wireless Local Access Network (WLAN).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "R.2\tIP-CAN aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "R.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by the  and the WLAN to provide packet-mode communication between the UE and the IM CN subsystem.\nRequirements for the UE on the use of these packet-mode services are specified in this clause.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "R.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "R.2.2.1\tEstablishment of IP-CAN bearer and P-CSCF discovery",
                            "text_content": "Prior to communication with the IM CN subsystem:\nNOTE 1:\tThe UE performs access network discovery and selection procedures as specified in 3GPP TS 24.302 [8U] and executes access authentication signalling for access to the  between the UE and 3GPP  server, if applicable, as described in 3GPP TS 24.302 [8U] prior to perform the procedure to obtain a local IP address;\na)\tthe UE establishes an IP-CAN bearer for SIP signalling as follows:\n1)\tif the UE attaches to the  via S2b using untrusted WLAN IP access:\nA)\tthe UE shall obtain a local IP address using the WLAN IP access;\nB)\tif the UE does not support procedures for access to the  via restrictive non-3GPP access network or unless the UE determines that the WLAN used is a restrictive non-3GPP access network, then the UE shall establish an IKEv2 security association and an IPsec  security association with ePDG as described in 3GPP TS 24.302 [8U]. If the UE supports the Fixed Access Broadband interworking, the UE shall apply the establishment of tunnel specified in 3GPP TS 24.139 [8X];\nNOTE 2:\tUE can determine that the WLAN used is a restrictive non-3GPP access network if no IKEv2 response is received for the IKEv2 IKE_SA_ request, or using means out of scope of this specification.\nC)\tif the UE supports procedures for access to the  via restrictive non-3GPP access network, and if the UE determines that the WLAN used is a restrictive non-3GPP access network, then the UE may perform procedures for access to the  via restrictive non-3GPP access network as described in 3GPP TS 24.302 [8U], and may establish an IKEv2 security association and an IPsec  security association with ePDG via the firewall traversal tunnel;\nD)\tthe IKEv2 security association and the IPsec  security association (tunnel) shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration; and\nE)\tthe UE may carry both signalling and media on an IPsec  security association;\n2)\tif the UE attaches to the  via S2c using the WLAN IP access:\nA)\tthe UE shall obtain a local IP address;\nB)\tthe UE shall establish an IKEv2 security association and an IPsec  security association as described in 3GPP TS 24.302 [8U] and 3GPP TS 24.303 [8V]. If the UE supports the Fixed Access Broadband interworking, the UE shall apply the establishment of tunnel specified in 3GPP TS 24.139 [8X];\nC)\tthe IKEv2 security association and the IPsec  security association (tunnel) shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration; and\nD)\tthe UE may carry both signalling and media on an IPsec  security association.\n3)\tif the UE attaches to the  via S2a using a trusted WLAN IP access:\nA)\tthe IPv4 address and/or IPv6 prefix is allocated as specified in 3GPP TS 24.302 [8U]; and\nB)\tthe UE IP address shall remain valid throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration;\nThe UE can determine trust relationship of a non-3GPP IP access network as specified in 3GPP TS 24.302 [8U]; and\nb)\tthe UE shall aquire a P-CSCF address(es).\nThe methods for P-CSCF discovery are:\nI.\tUse DHCP mechanism\nII.\tUse DNS\nWhen using IPv4, the UE may request a DNS Server IPv4 address(es) via RFC 2132 [20F]. When using IPv6, the UE may request a DNS Server IPv6 address(es) via RFC 3315 [40] and RFC 3646 [56C].\nIII.\tObtain the list of P-CSCF address(es) from the IMS management object\nIV.\tObtain P-CSCF address(es) using signalling for access to the  via WLAN.\nIf the UE attaches to the  via S2b using untrusted WLAN IP access, the UE shall request P-CSCF IPv4 address(es), P-CSCF IPv6 address(es) or both using the P_CSCF_IP4_ADDRESS attribute, the P_CSCF_IP6_ADDRESS attribute or both in the CFG_REQUEST configuration payload as described in 3GPP TS 24.302 [8U]. The network can provide the UE with the P-CSCF IPv4 address(es), P-CSCF IPv6 address(es) or both using the P_CSCF_IP4_ADDRESS attribute, the P_CSCF_IP6_ADDRESS attribute or both in the CFG_REPLY configuration payload as described in 3GPP TS 24.302 [8U]. If the UE receives multiple P-CSCF IPv4 or IPv6 addresses, the UE shall assume that the list is ordered top-down with the first P-CSCF address within the CFG_REPLY configuration payload as the P-CSCF address having the highest preference and the last P-CSCF address within the CFG_REPLY configuration payload as the P-CSCF address having the lowest preference.\nIf the UE attaches to the  via S2a using trusted WLAN IP access using single-connection mode, the UE shall indicate request for P-CSCF IPv4 address(es), P-CSCF IPv6 address(es) or both within the PROTOCOL_CONFIGURATION_OPTIONS item of the message with _REQUEST message type as described in 3GPP TS 24.302 [8U]. The network can provide the UE with the P-CSCF IPv4 address(es), P-CSCF IPv6 address(es) or both within the PROTOCOL_CONFIGURATION_OPTIONS item of the message with _RESPONSE message type as described in 3GPP TS 24.302 [8U]. If the UE receives multiple P-CSCF IPv4 or IPv6 addresses, the UE shall assume that the list is ordered top-down with the first P-CSCF address within the PROTOCOL_CONFIGURATION_OPTIONS item as the P-CSCF address having the highest preference and the last P-CSCF address within the PROTOCOL_CONFIGURATION_OPTIONS item as the P-CSCF address having the lowest preference.\nIf the UE attaches to the  via S2a using trusted WLAN IP access using multi-connection mode, the UE shall indicate request for P-CSCF IPv4 address(es), P-CSCF IPv6 address(es) or both within the Protocol Configuration Options information element of the PDN CONNECTIVITY REQUEST message as described in 3GPP TS 24.244 [8ZB]. The network can provide the UE with the P-CSCF IPv4 address(es), P-CSCF IPv6 address(es) or both within the Protocol Configuration Options information element of the PDN CONNECTIVITY ACCEPT message as described in 3GPP TS 24.244 [8ZB]. If the UE receives multiple P-CSCF IPv4 or IPv6 addresses, the UE shall assume that the list is ordered top-down with the first P-CSCF address within the Protocol Configuration Options information element as the P-CSCF address having the highest preference and the last P-CSCF address within the Protocol Configuration Options information element as the P-CSCF address having the lowest preference.\nThe UE shall use method III to select a P-CSCF, if a P-CSCF is to be discovered in the home network and the WLAN, to which the UE is attached, is connected to a visited network.\nThe UE can freely select method I, II, III or IV for P-CSCF discovery if:\n-\tthe UE is in the home network; or\n-\tthe WLAN, to which the UE is attached, is connected to a visited network and the P-CSCF is to be discovered in the visited network.\nIf DHCP is used, the following procedures apply:\nUpon establishing an IP-CAN, the UE may use the Dynamic Host Configuration Protocol (DHCP) specified in RFC 2131 [40A] or Dynamic Host Configuration Protocol for IPv6 (DHCPv6) specified in RFC 3315 [40] to discover the P-CSCF.\nPrior to accessing the DHCP server, the UE will have obtained an IP address via means other than DHCP and DHCPv6.\nIf the UE uses DHCP for P-CSCF discovery and the UE is unaware of the address of the DHCP server, the UE sends the DHCPINFORM using the limited broadcast IP address (i.e., 255.255.255.255) and UDP port 67. If the UE knows the IP address of the DHCP server, the UE shall send the DHCPINFORM to the DHCP server's unicast IP address and UDP port 67. The DHCP server sends the DHCPACK on the IP address specified in the Client IP Address field of the DHCPINFORM. The DHCP server can include, in the DHCPACK, the SIP Server DHCP Option specified in RFC 3361 [35A], which carries either a list of IPv4 address(es) of the P-CSCF(s) or a list of DNS fully qualified domain name(s) that can be mapped to one or more P-CSCF(s). If the UE uses DHCPv6 for P-CSCF discovery and the UE is unaware of the address of the DHCP Server, the UE shall send an Information Request using the IPv6 multicast address FF02::1:2 and the UDP port 547. If the UE knows the IP address of the DHCPv6 server, the UE shall send the Information Request message to the DHCPv6 server's IP address and UDP port 547. In the Information Request, the UE can request either one or both the SIP Servers Domain Name List option and the SIP Servers IPv6 Address List option specified in RFC 3319 [41]. The DHCP server sends the Reply to the IP address specified in the Information Request. The DHCP server can include in the Reply either one or both the SIP Servers Domain Name List option and the SIP Servers IPv6 Address List option, as requested by the UE.\nIf the UE supports the optional configuration parameter \"Access_Point_Name_Parameter_Reading_Rule\", as defined in 3GPP TS 24.167 [8G] and has been configured with this parameter, then the UE shall use it to retrieve the access point name to use in the establishment of IP-CAN bearer.\nIn case several P-CSCF's IP addresses or domain names are provided to the UE, the UE shall perform P-CSCF selection according to RFC 3361 [35A] or RFC 3319 [41]. The UE shall perform the procedure for the resolution of domain name according to RFC 3263 [27A]. If sufficient information for P-CSCF address selection is not available, selection of the P-CSCF address by the UE is implementation specific.\nWhen:\n-\tthe UE obtains an IP-CAN bearer for SIP signalling by performing handover of the connection from another IP-CAN;\n-\tIP address of the UE is not changed during the handover; and\n-\tthe UE already communicates with the IM CN subsystem via the connection with the other IP-CAN, e.g. the UE determines that its contact with host portion set to the UE IP address (or FQDN of the UE) associated with the connection with the other IP-CAN has been bound to a public user identity;\nthe UE shall continue using the P-CSCF address(es) acquired in the other IP-CAN.\nThe UE may support the policy on when a UE roaming in a VPLMN is allowed to transfer the PDN connection providing access to IMS between EPC via WLAN and EPS as specified in subclause L.2.1.1. If the UE roams in the EPS IP-CAN, has a session and the policy indicates \"roaming in a VPLMN and having an ongoing session, is not allowed to transfer the PDN connection providing access to IMS between EPC via WLAN and EPS\", the UE shall not handover the PDN connection providing access to IMS from EPS to EPC via WLAN.\nIf the UE roams in the EPS IP-CAN, has a session and the policy indicates \"roaming in a VPLMN and having an ongoing session, is allowed to transfer the PDN connection providing access to IMS between EPC via WLAN and EPS\", the UE shall, if not prevented by other rules or policies, handover the PDN connection providing access to IMS from EPS to EPC via WLAN.\nIf the UE roams in the EPS IP-CAN and the policy indicates \"roaming in a VPLMN is not allowed to transfer the PDN connection providing access to IMS between EPC via WLAN and EPS, irrespective of if the UE is in a session or not\", the UE shall not handover the PDN connection providing access to IMS from EPS to EPC via WLAN. The UE can re-establish a new PDN connection to another IP-CAN type in idle mode, e.g. due to UE domain preference.\nThe UE may support the policy on when a UE is allowed to transfer a PDN connection providing access to IMS between EPC via WLAN and 5GS as specified in subclause U.2.1.1. If the UE is in a session and the policy indicates \"is not allowed to transfer the PDN connection providing access to IMS between EPC via non-3GPP access and 5GCN via NG-RAN\" or if the UE is roaming when in a session and the policy indicates \"a UE roaming in a VPLMN and having an ongoing IMS session, is not allowed to transfer the PDN connection providing access to IMS between EPC via non-3GPP access and 5GCN via NG-RAN\" the UE shall not handover the PDN connection providing access to IMS from 5GS to EPC via WLAN.\nIf the UE is in a seesion in the EPS IP-CAN and the policy indicates \"a UE having an ongoing IMS session, is allowed to transfer the PDN connection providing access to IMS between EPC via non-3GPP access and 5GCN via NG-RAN\" or the UE is roaming in an EPS IP-CAN and the policy indicates \"a UE roaming in a VPLMN and having an ongoing IMS session, is allowed to transfer the PDN connection providing access to IMS between EPC via non-3GPP access and 5GCN via NG-RAN\" the UE shall, if not prevented by other rules or policies, handover the PDN connection providing access to IMS from 5GS to EPC via WLAN.\nIf the UE is in a 5GS IP-CAN and the policy indicates \"a UE is not allowed to transfer a PDN connection providing access to IMS, if any, between EPC via non-3GPP access and 5GCN via NG-RAN, irrespective of if the UE has an ongoing IMS session or not\" or the UE is roaming in a 5GS IP-CAN and the policy indicates \"a UE roaming in a VPLMN is not allowed to transfer a PDN connection providing access to IMS, if any, between EPC via non-3GPP access and 5GCN via NG-RAN, irrespective of if the UE has an ongoing IMS session or not\" the UE shall not handover the PDU session providing access to IMS from 5GS to EPC via WLAN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.2.2.1A\tModification of an IP-CAN used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.2.2.1B\tRe-establishment of the IP-CAN used for SIP signalling",
                            "text_content": "If the UE registered a public user identity with an IP address allocated for the  of the IP-CAN bearer for SIP signalling, the IP-CAN bearer for SIP signalling is deactivated as result of signalling from the network, and:\ni)\tthe signalling from the network results in requiring the UE to initiate activation of the IP-CAN bearer for SIP signalling; or\nii)\tthe UE needs to continue having a public user identity registered with an IP address allocated for the ;\nand the UE is allowed to activate the IP-CAN bearer for SIP signalling, the UE shall:\nA)\tif the non-access stratum is performing activation of the IP-CAN bearer for SIP signalling for the  triggered as result of the signalling from the network, wait until the activation of the IP-CAN bearer for SIP signalling for the APN finishes;\nB)\tif the non-access stratum is not performing activation of the IP-CAN bearer for SIP signalling for the , perform the procedures in subclause R.2.2.1, bullet a); and\nC)\tif the IP-CAN bearer for SIP signalling is available:\n-\tperform the procedures in subclause R.2.2.1, bullet b); and\n-\tif a P-CSCF address was acquired, perform a new initial registration according to subclause 5.1.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "A UE supporting the P-CSCF restoration procedure performs one of the following procedures:\nA)\tif the UE used method IV for P-CSCF discovery, the UE has previously sent the \"P-CSCF Re-selection support\"  indicator (in trusted non-3GPP access network) or the P-CSCF_RESELECTION_SUPPORT IKEv2 attribute (in untrusted non-3GPP access network) during the PDN connection establishment, and the UE receives one or more P-CSCF address(es) during the TWAG initiated PDN connectivity modification procedure (in trusted non-3GPP access network) or the ePDG initiated modification (in untrusted non-3GPP access network), then the UE shall acquire a P-CSCF address from the one or more P-CSCF addresse(s). If more than one P-CSCF addresses of the same IP address type are included, then the UE shall assume that the more than one P-CSCF addresses of the same IP address type are prioritised with the first P-CSCF address within the Protocol Configuration Options information element or within the IKEv2 configuration payload as the P-CSCF address having the highest priority; and\nB)\tif the UE uses RFC 6223 [143] as part of P-CSCF restoration procedures, and the P-CSCF fails to respond to keep-alive requests, then the UE shall acquire a different P-CSCF address using any of the methods described in the subclause R.2.2.1.\nWhen the UE has acquired the P-CSCF address, the UE shall perform an initial registration as specified in subclause 5.1.\nNOTE:\tFor UEs using procedure A described above, the network ensures that P-CSCF address(es) received in the Protocol Configuration Options information element during TWAG initiated PDN connectivity modification procedure (in trusted non-3GPP access network), and P-CSCF address(es) received in the P-CSCF_IP6_ADDRESS attribute, the P-CSCF_IP4_ADDRESS attribute or both during ePDG initiated modification (in untrusted non-3GPP access network) are sent only during P-CSCF restoration procedures as defined in subclause 5 of 3GPP TS 23.380 [7D].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.2.2.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.2.2.3\tIP-CAN support of DHCP based P-CSCF discovery",
                            "text_content": "When using WLAN IP access via S2c to access the EPC, the Home Agent (HA) in case of Mobile IP with reverse tunneling, can forward the packet to one or more local DHCP servers, or relay the packet to a specific DHCP server. The HA in case of Mobile IP with reverse tunnelling, does not forward the DHCPINFORM (or Information-Request) to any UE.\nNOTE 1:\tFor forwarding the DHCPINFORM or Information-Request, the HA in case of Mobile IP with reverse tunnelling, does not change the destination IP address of the packet.\nNOTE 2:\tFor relaying the DHCPINFORM or Information-Request, the HA in case of Mobile IP with reverse tunnelling inserts a DHCP server's IP address in the destination IP address field of the packet.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.2.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.2.2.5\tTunnel procedures for media",
                            "text_content": "The UE can establish media streams that belong to different SIP sessions on the same tunnel when accessing the  via untrusted WLAN.\nDuring establishment of a session, the UE establishes data streams(s) for media related to the session. When using untrusted WLAN IP access via S2c to access the EPC, such data stream(s) may result in activation of additional IPsec  security associations (tunnels).\nIf the capabilities of the originating UE, or operator policy at the ePDG prevents the originating UE from establishment of additional IPsec  security associations (tunnels) according to the media grouping attributes given by the P-CSCF in accordance with RFC 3524 [54], the UE will not establish such grouping of media streams. Instead, the originating UE shall negotiate media parameters for the session according to RFC 3264 [27B].\nIf the capabilities of the terminating UE or operator policy at the ePDG prevents the originating UE from establishment of additional IPsec  security associations (tunnels) according to the media grouping attributes given by the P-CSCF in accordance with RFC 3524 [54], the UE will not establish such grouping of media streams. Instead, the terminating UE shall handle such SDP offers in accordance with RFC 3388 [53].\nThe UE can receive a media authorization token in the P-Media-Authorization header field from the P-CSCF according to RFC 3313 [31]. If a media authorization token is received in the P-Media-Authorization header field when a SIP session is initiated, the UE shall reuse the existing tunnel and ignore the media authorization token.\nThe tunnel modification procedure for the UE shall follow the procedures specified in 3GPP TS 24.302 [8U]. If the UE supports the Fixed Access Broadband interworking, the modification of tunnel specified in 3GPP TS 24.139 [8X] shall be applied.\nThe UE shall follow the procedure specified in 3GPP TS 24.302 [8U] for the modification of tunnel. If the UE supports the Fixed Access Broadband interworking, the modification of tunnel specified in 3GPP TS 24.139 [8X] shall be applied.\nIf the UE attaches to the EPC via S2b using untrusted WLAN IP access, and IKEv2 multiple bearer PDN connectivity is used in the PDN connection according to 3GPP TS 24.302 [8U], then:\n1)\tif:\nA)\tan additional IPSec ESP tunnel is established according to 3GPP TS 24.302 [8U]; or\nB)\tan IPSec ESP tunnel is modified according to 3GPP TS 24.302 [8U];\nthe UE shall, based on the information contained in the TFT Notify payload, correlate the media IPSec ESP tunnel with SDP media descriptions of a currently ongoing SIP session establishment or SIP session modification.\nNot applicable.\nSince the UE is unable to perform bearer modification, forked responses place no special requirements on the UE.\nNot applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.2.2.6\tEmergency service",
                            "text_content": "In this release of the specification, a WLAN, conforming to the requirements in this annex, defines emergency bearers. Emergency session is supported over the WLAN access if the UE has failed or has not been able to use 3GPP access to set up an emergency session as described in 3GPP TS 23.167 [4B] annex J.\nIMS emergency session is also supported for UEs with unavailable IMSI (i.e. a UE without USIM) or unauthenticated IMSI. Some jurisdictions allow emergency calls to be made when the UE does not contain an ISIM or USIM, or where the credentials are not accepted.\nWhen the UE is attached over a WLAN access and detects an emergency call attempt, if the UE supports the emerg-non3gpp timer defined in table 7.8.1, the UE shall start the emerg-non3gpp timer when starting a domain selection searching for a 3GPP access usable to establish an emergency call. The UE shall stop the timer when a 3GPP access supporting emergency call is found. When the emerg-non3gpp timer expires, the UE shall consider that it has failed to use 3GPP access to setup the emergency call and shall attempt to setup the emergency call over the available WLAN access.\nThe UE may support being configured for the emerg-non3gpp timer using one or more of the following methods:\na)\tthe Timer_Emerg_non3gpp leaf of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Timer_Emerg_non3gpp leaf of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Timer_Emerg_non3gpp leaf of 3GPP TS 24.167 [8G].\nEPC procedures for emergency session using WLAN are defined for both trusted WLAN access via S2a, depending on the TWAN usage mode, and untrusted WLAN access via S2b to access EPC.\nWhen the IM CN subsystem is selected as the domain for the emergency call attempt, and the UE uses:\n-\tuntrusted WLAN access via S2b, the UE determines that the EPC supports emergency bearer services by selecting or using an ePDG that has indicated its capability of support for emergency services, as specified in subclause 7.2.1A of 3GPP TS 24.302 [8U]; or\n-\ttrusted WLAN access via S2a, the UE determines that the EPC, accessed in usage modes multi-connection mode or single-connection mode, supports emergency bearer services if the CONNECTION_MODE_CAPABILITY item in the EAP-Request/AKA'-Challenge message indicates support of emergency services, as specified in 3GPP TS 24.302 [8U].\nWhen the IM CN subsystem is selected as the domain for the emergency call attempt, and the UE uses untrusted WLAN access via S2b, the UE determines whether it is currently attached to its home operator's network (e.g. HPLMN) or not (e.g. VPLMN) after it has determined that the core network supports emergency bearer services.\nWhen establishing an IMS emergency session using trusted WLAN access via S2a, the UE shall establish an IMS emergency session over trusted WLAN access depending on the usage mode used to access EPC. When using the usage mode single-connection mode, subclause 6.4.2.6.2A of 3GPP TS 24.302 [8U] applies. When using the usage mode multi-connection mode, subclause 6.4.2.6.3A of 3GPP TS 24.302 [8U] applies. The procedures for attaching to the  via S2a using a trusted WLAN IP access, as described in subclause R.2.2.1 of this specification apply accordingly.\nWhen establishing an IMS emergency session using untrusted WLAN access via S2b, the UE shall establish an IMS emergency session over untrusted non-3GPP access as specified in 3GPP TS 24.302 [8U]. The procedures for attaching to the  via S2b using untrusted WLAN IP access, as described in subclause R.2.2.1 of this specification apply accordingly.\nIf the ME is equipped with a UICC, in order to find out whether the UE is attached to the home PLMN or to the visited PLMN, the UE shall compare the  and  values derived from its  with the  and  of the PLMN the UE is attached to. If the  and  of the PLMN the UE is attached to do not match with the  and  derived from the , then for the purposes of emergency calls in the IM CN subsystem the UE shall consider to be attached to a VPLMN. If the ME is not equipped with a UICC, the procedure to find d out whether the UE is attached to the home PLMN or to the visited PLMN for the purpose of emergency calls in the IM CN subsystem, is implementation specific.\nNOTE 1:\tThe UE verifies if a detected emergency number is still present in the Extended Local Emergency Number List applicable to the PLMN it is currently using. It is possible for the number to no longer be present in the Extended Local Emergency Number List if:\n-\tthe PLMN attached to relies on the Local Emergency Number List for deriving a URN; or\n-\tthe previously received Extended Emergency Number List Validity field indicated \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\".\nIf the UE detected an emergency number, the UE subsequently uses a different PLMN than the PLMN from which the UE received the last Extended Local Emergency Number List:\nNOTE 2:\tThe UE has either attached to or authenticated (e.g. due to EAP-3GPP-LimitedService based access authentication, see 3GPP TS 24.302 [8U]) with a PLMN via WLAN prior to detecting the emergency number or because of detecting the emergency number.\n-\tthe dialled number is not stored in the ME, in the USIM and in the Local Emergency Number List;\nthen:\na)\tif the UE supports provision and handling of local emergency numbers as defined in 3GPP TS 24.302 [8U], the UE has received the local emergency numbers using any of the methods defined in subclause 4.7 in 3GPP TS 24.302 [8U], the dialled number matches a received local emergency number, then the UE derives a URN as defined in 3GPP TS 24.302 [8U] or using the procedures in subclause R.2.2.6.1A, depending on the method used to provision the local emergency number;\nb)\totherwise, the UE shall attempt UE procedures for SIP that relate to emergency using emergency service URN \"urn:service:sos\".\nIf the dialled number is equal to a local emergency number stored in the Extended Local Emergency Number List (as defined in 3GPP TS 24.301 [8J]), then the UE shall recognize such a number as for an emergency call and:\n-\tif the dialled number is equal to an emergency number stored in the ME, or in the USIM, then the UE shall perform either procedures in the subclause R.2.2.6.1B or the procedures in subclause R.2.2.6.1A; and\n-\tif the dialled number in not equal to an emergency number stored in the ME, or in the USIM, then the UE shall perform procedures in the subclause R.2.2.6.1B.\nIf the dialled number is not equal to a local emergency number stored in the Extended Local Emergency Number List (as defined in 3GPP TS 24.301 [8J]) and:\n-\tif the dialled number is equal to an emergency number stored in the ME, in the USIM or in the Local Emergency Number List (as defined in 3GPP TS 24.008 [8]), then the UE shall recognize such a number as for an emergency call and performs the procedures in subclause R.2.2.6.1A.\nOnce IPsec tunnel setup is completed, the UE shall follow the procedures described in subclause R.2.2.1 of this specification for establishment of IP-CAN bearer and P-CSCF discovery accordingly.\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.2A.1.1 and subclause 5.1.3.1, if:\n-\tthe 380 (Alternate Service) response contains a Contact header field;\n-\tthe value of the Contact header field is a service URN; and\n-\tthe service URN has a top-level service type of \"sos\";\nthen the UE determines that \"emergency service information is included\" as described 3GPP TS 23.167 [4B].\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.3.1, if the 380 (Alternate Service) response does not contain a Contact header field with service URN that has a top-level service type of \"sos\", then the UE determines that \"no emergency service information is included\" as described 3GPP TS 23.167 [4B].\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.2A.1.1 and subclause 5.1.3.1, the UE shall proceed as follows:\n1)\tif a 3GPP access network is available and the UE has not already attempted to use a 3GPP access network to set up an emergency session as described in 3GPP TS 23.167 [4B] annex J, when the UE selects a domain in accordance with the conventions and rules specified in 3GPP TS 22.101 [1A] and 3GPP TS 23.167 [4B], the UE shall attempt to select a domain of the 3GPP access network, and:\n-\tif the CS domain is selected, the UE behaviour is defined in subclause 7.1.2 of 3GPP TS 23.167 [4B] and in annex B, annex L or annex U; and\n-\tif the IM CN subsystem is selected, the UE shall apply the procedures in subclause 5.1.6 with the exception of selecting a domain for the emergency call attempt;\nIn addition, when the UE determines that \"it has not been able to use 3GPP access to set up an emergency session\" in accordance with subclause J.1 of 3GPP TS 23.167 [4B], the UE shall apply the procedures in subclause 5.1.6 using WLAN, with the exception of selecting a domain for the emergency call attempt; and\n2)\tif a 3GPP access network is not available, then the UE shall apply the procedures in subclause 5.1.6 using WLAN, with the exception of selecting a domain for the emergency call attempt.\nWhen the emergency session ends, the UE:\n1)\tshall release the tunnel as described in 3GPP TS 24.302 [8U]; and\n2)\tif EPC via WLAN is the preferred IP-CAN to access IM CN subsystem or if no 3GPP access is available:\na)\tif the UE did not select the currently selected ePDG using procedures for selection of ePDG for non-emergency services, shall select an ePDG for non-emergency services as described in 3GPP TS 24.302 [8U];\nb)\tif the UE does not have an IP-CAN bearer for non-emergency SIP signalling, shall follow the procedures described in subclause R.2.2.1 for establishment of an IP-CAN bearer for SIP signalling and P-CSCF discovery; and\nc)\tif the UE determines that its contact associated with the IP-CAN bearer for non-emergency SIP signalling is not bound to a public user identity, shall perform an initial registration as specified in subclause 5.1.1.2 using the IP-CAN bearer for SIP signalling.\nThe type of emergency service for an emergency number is derived from the settings of the emergency service category value (bits 1 to 5 of the emergency service category value as specified in subclause 10.5.4.33 of 3GPP TS 24.008 [8]). Table R.2.2.6.1 below specifies mappings between a type of emergency service and an emergency service URN. The UE shall use the mapping to match an emergency service URN and a type of emergency service. If a dialled number is an emergency number but does not map to a type of emergency service the service URN shall be \"urn:service:sos\".\nTable R.2.2.6.1: Mapping between type of emergency service and emergency service URN\n\nNOTE 1:\tIt is not possible for a UE to indicate more than one type of emergency service in an emergency service URN.\nIf:\n-\tthe UE considers itself in the country of the HPLMN;\nNOTE 2:\tIt is out of scope of the present annex to define how the UE determines whether it considered itself in the country of the HPLMN. When the UE is in coverage of a 3GPP RAT, it can, for example, use the information derived from the available PLMN(s). In this case, the UE can match the MCC broadcasted on the BCCH of the 3GPP access against the UE's IMSI to determine if they belong to the same country, as defined in 3GPP TS 23.122 [4C]. If the UE is not in coverage of a 3GPP RAT, the UE can use other techniques, including user-provided location, for determining whether it is located in its home country or not.\n-\tmultiple types of emergency services can be derived for a dialled number from the information configured on the USIM; and\n-\tno IP-CAN provided a local emergency number that matches the dialled number (see subclause 5.1.6.1);\nNOTE 3:\tIf the Non-3GPP emergency number indicator within the Non-3GPP NW provided policies IE (see 3GPP TS 24.008 [8]) provided through registration procedures over 3GPP access is set to \"use of non-3GPP emergency numbers permitted\", the UE also considers WLAN provided local emergency numbers (see 3GPP TS 24.302 [8U], subclause 4.7). If the Non-3GPP NW provided policies IE provided through registration procedures over 3GPP access is set to \"use of non-3GPP emergency numbers not permitted\", the UE does not consider WLAN provided local emergency numbers. If the Non-3GPP NW provided policies IE is not provided through registration procedures over 3GPP access, the UE does not consider WLAN provided local emergency numbers.\nNOTE 4:\tA UE, only connected to a PLMN through non-3GPP access, considers the WLAN provided local emergency numbers if the applicable conditions in subclause 4.7 of 3GPP TS 24.302 [8U], are met.\nthen the UE shall map any one of these types of emergency service to an emergency service URN as specified in table R.2.2.6.1.\nIf the UE considers itself in the country of the HPLMN and an IP-CAN provided a local emergency number that matches the dialled number (see subclause 5.1.6.1), and if the UE:\n-\tcan derive one or more types of emergency service from the information received from the IP-CAN for the dialled number and the UE cannot derive types of emergency service from the information configured on the USIM for the dialled number; or\n-\tderives identical types of emergency service from both the information received from the IP-CAN for the dialled number and from the information configured on the USIM for the dialled number;\nthen the UE shall map any one of these emergency service types to an emergency service URN as specified in table R.2.2.6.1.\nNOTE 5:\tHow the UE resolves clashes where an emergency number is associated with one or more different types of emergency service configured in the USIM and in information received from an IP-CAN, is implementation dependent.\nThe Extended Local Emergency Number List (defined in 3GPP TS 24.301 [8J]) can contain sub-services of the associated emergency service URN for the detected emergency number.\nIf:\n-\tthe length of sub-services field is greater than \"0\", the UE shall construct the emergency service URN using \"urn:service:sos\" followed by adding a dot followed by the content of the sub-services field; and\n-\tthe length of sub-services field is \"0\", the UE shall use the emergency service URN \"urn:service:sos\".\nEXAMPLE 1:\tFor a detected number, if the sub-service is \"gas\", then the UE constructs \"urn:service:sos.gas\" as the associated emergency service URN.\nEXAMPLE 2:\tFor a detected number, if no sub-service is provided, then the UE uses \"urn:service:sos\" as the associated emergency service URN.\nThe UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nThe UE may support the current location discovery during an emergency call specified in subclause 5.1.6.8.2, subclause 5.1.6.8.3, subclause 5.1.6.8.4, and subclause 5.1.6.12.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table R.2.2.6.1: Mapping between type of emergency service and emergency service URN",
                                    "table number": 470,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "R.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "R.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "R.2A.1\tImpact on SDP offer / answer of activation or modification of IP-CAN for media by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "If the UE is attached to the EPC via S2b using untrusted WLAN IP access, and IKEv2 multiple bearer PDN connectivity is used in the PDN connection according to 3GPP TS 24.302 [8U], then:\n1)\tif an additional IPSec ESP tunnel is established according to 3GPP TS 24.302 [8U] and the related SDP media description needs to be changed, the UE shall update the related SDP information by sending a new SDP offer within a SIP request, which is sent over the existing SIP dialog; and\n2)\tif an IPSec ESP tunnel is modified according to 3GPP TS 24.302 [8U] and the related SDP media description need to be changed, the UE shall update the related SDP information by sending a new SDP offer within a SIP request, that is sent over the existing SIP dialog.\nNOTE:\tThe UE can decide to indicate additional media streams as well as additional or different codecs in the SDP offer than those used in the already ongoing session.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "R.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "R.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "No additional procedures defined.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "R.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "R.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "R.3.1.0\tRegistration and authentication",
                            "text_content": "Editor's note: [WID: TURAN-CT, CR#4993]: Best usage of this FTT-IMS establishment is when the UE does not establish the IKEv2 security association which is an option not specified in subclause R.2.2.1. This requires further study.\nIn order to reach the IM CN subsystem in some untrusted access networks, the UE may support:\n-\taddress and/or port number conversions provided by a (P)T or (P)T-PT as described in annex F and annex K; or\n-\tthe IP UE requested FTT-IMS establishment procedure specified in 3GPP TS 24.322 [8Y], which is applicable to direct access to an external IP network and not applicable to access through a PLMN.\nIf a UE supports one or both of these capabilities then a UE may progressively try them to overcome failure to reach the IPM CN subsystem. Use of these capabilities shall have the following priority order:\n1)\tUE does not use capability because reaching the IMS without an intervening (P)T, (P)T-PT, or tunnel is preferred.\n2)\tUE may use address and/or port number conversions provided by a (P)T or (P)T-PT as described in either annex F or annex K.\n3)\tUE may use the UE requested FTT-IMS establishment procedure specified in 3GPP TS 24.322 [8Y]. If the UE uses the UE-requested FTT-IMS establishment procedure specified in 3GPP TS 24.322 [8Y], the UE considers itself to:\n-\tbe configured to send keep-alives;\n-\tbe directly connected to an IP-CAN for which usage of  is defined; and\n-\tbe behind a .\nOptional procedures apply when the UE is supporting traversal of restrictive non-3GPP access network using STUN/TURN/ICE, as follows:\na)\tthe protection of SIP messages is provided by utilizing  as defined in 3GPP TS 33.203 [19];\nb)\tthe mechanisms specified in this annex shall only be applicable when the IP traffic to the IMS core does not traverse through the Evolved Packet Core ();\nc)\tthe UE shall establish the  connection to the P-CSCF on port 443 as defined in 3GPP TS 33.203 [19]. The UE shall use SIP digest with  for registration as specified in subclause 5.1. If the  connection is established successfully, the UE sends SIP signalling over the  connection to the P-CSCF;\nd)\tthe UE shall support the keep-alive procedures described in RFC 6223 [143];\nNOTE 1:\tIf the UE is configured to use an HTTP proxy, the UE use the HTTP CONNECT method specified in RFC 2817 [220] to request the HTTP proxy to establish the  connection with the P-CSCF. Once the UE has received a positive reply from the proxy that the  connection has been established, the UE initiates the  handshake with the P-CSCF and establishes the  connection.\ne)\tthe procedures described in subclause K.5.2 apply with the additional procedures described in the present subclause;\nf)\twhen using the ICE procedures for traversal of restrictive non-3GPP access network, the UE shall support the ICE  as specified in RFC 6544 [131] and TURN  as specified in RFC 6062 [221].\ng)\tif the UE is configured to use TURN over  on port 80, the UE shall establish the  connection to TURN server on port 80. If the UE is configured to use TURN over  on port 443, the UE shall establish the  connection to the TURN server on port 443 as defined in 3GPP TS 33.203 [19]. If the UE is configured to use both, the UE should prefer to use TURN over  on port 80 to avoid  overhead;\nh)\tif the connection is established successfully, the UE sends TURN control messages and media packets over the connection as defined in RFC 5766 [101].\nNOTE 2:\tIf the UE is configured to use an HTTP proxy, the UE use the HTTP CONNECT method specified in RFC 2817 [220] to request the HTTP proxy to establish the  connection with the TURN server. Then, if the UE is configured to use TURN over  on port 443 and the UE has received a positive reply from the proxy that the  connection has been established, the UE initiates the  handshake with the TURN server and establishes the  connection.\nThe UE shall perform reregistration of a previously registered public user identity bound to any one of its contact addresses when changing to an IP-CAN for which usage is specified in annex B, annex L or annex U. The reregistration is performed using the new IP-CAN.\nNOTE 3:\tThis document does not specify how the UE detects that the used IP-CAN has changed. The information that is forcing the reregistration is also used to generate the content for the P-Access-Network-Info header field.\nNOTE 4:\tThe UE will send the reregistration irrespective of whether it has a SIP dialog or not.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The UE shall always include the P-Access-Network-Info header field where indicated in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "The UE:\n1)\tusing the Evolved Packet Core (EPC) via Untrusted Wireless Local Access Network (WLAN) as IP-CAN to access the IM CN subsystem; and\n2)\tsupporting one or more cellular radio access technology (e.g. E-UTRAN);\nshall always include the Cellular-Network-Info header field specified in subclause 7.2.15, if the information is available, in every request or response in which the P-Access-Network-Info header field is present.\nNOTE:\tIf the Cellular-Network-Info header field includes radio cell identity, then the Cellular-Network-Info header field populated by the UE that supports Multi-RAT Dual Connectivity with the EPC as described in 3GPP TS 37.340 [264] will contain the information about the radio cell identity of the Master RAN node that is serving the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.2\tAvailability for calls",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.2A\tAvailability for SMS",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.3\tAuthorization header field",
                            "text_content": "When using SIP digest or SIP digest without , the UE need not include an Authorization header field on sending a REGISTER request, as defined in subclause 5.1.1.2.1.\nNOTE:\tIn case the Authorization header field is absent, the mechanism only supports that one public user identity is associated with only one private user identity. The public user identity is set so that it is possible to derive the private user identity from the public user identity by removing SIP  scheme and the following parts of the SIP  if present: port number,  parameters, and To header field parameters. Therefore, the public user identity used for registration in this case cannot be shared across multiple UEs. Deployment scenarios that require public user identities to be shared across multiple UEs that don't include an private user identity in the initial REGISTER request can be supported as follows:\n-\tAssign each sharing UE a unique public user identity to be used for registration,\n-\tAssign the shared public user identitiess to the implicit registration set of the unique registering public user identities assigned to each sharing UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.5\t3GPP PS data off",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.6\tTransport mechanisms",
                            "text_content": "The transport mechansims as defined in subclause 4.2A are used with an additional requirement:\na)\tIf the UE has attached to the EPC via untrusted non-3gpp access and uses IPSec tunnel mode, in order to reduce the risk of UDP fragmentation, the UE shall decrement the IPSec tunnel overhead from the path MTU between the UE and the ePDG prior applying the transport selection for SIP requests as defined in RFC 3261 [26] subclause 18.1.1.\nNOTE: The method for discovering the maximum transmission unit for non-3GPP is implementation dependent and out of scope of 3GPP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.1.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "R.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "R.3.2.0\tRegistration and authentication",
                            "text_content": "The P-CSCF may support UEs connected via restrictive non-3GPP access network.\nIf the P-CSCF supports UEs connected via restrictive non-3GPP access network, when the P-CSCF receives a 200 (OK) response to a REGISTER request, if the contact address of REGISTER request contains an IP address assigned by the EFTF, and the UE's Via header field contains a \"keep\" header field parameter, then the P-CSCF shall add a value to the \"keep\" header field parameter of the UE's Via header field of the 200 (OK) response as defined in RFC 6223 [143].\nOptional procedures apply when the P-CSCF is supporting traversal of restrictive non-3GPP access network using STUN/TURN/ICE, as follows:\nNOTE:\tIn this scenario, the restrictive non-3GPP access network coexists with (P)T device located in the customer premises domain:\na)\tthe protection of SIP messages is provided by utilizing  as defined in 3GPP TS 33.203 [19];\nb)\tthe P-CSCF supporting these additional procedures should use SIP digest with  as defined in subclause 5 and the P-CSCF should inserts an IMS- on the media plane;\nc)\tthe mechanisms specified in this annex shall only be applicable when the IP traffic to the IMS core does not traverse through the Evolved Packet Core ();\nd)\tthe P-CSCF shall support the procedures defined in subclause 5.2, with the exception that the P-CSCF shall use SIP over  on port 443 as defined in 3GPP TS 33.203 [19];\ne)\twhen the UE has indicated support of the keep-alive mechanism defined in RFC 6223 [143], the P-CSCF shall indicate to the UE that it supports the keep-alive mechanism; and\nf)\tthe IMS- in the P-CSCF shall support ICE procedures, as defined in subclause 6.7.2.7.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "If the P-CSCF is configured to handle emergency requests, in order to determine from which network the request was originated the P-CSCF shall,\n-\tif PCRF is used for this UE and 3GPP-User-Location-Info as specified in 3GPP TS 29.214 [13D] is available (see subclause 5.2.1), check the MCC and MNC received in 3GPP-User-Location-Info; and\n-\tif PCRF is not used for this UE or 3GPP-User-Location-Info is not available, check the MCC and MNC fields received in the Cellular-Network-Info header field in the emergency request.\nNOTE 1:\tThe Cellular-Network-Info header field includes the MCC and the MNC of the cellular radio access network on which the UE most recently camped. The UE is not necessarily attached to a network via that cell or still camped on that cell.\nNOTE 2:\tThe above check can be against more than one MNC code stored in the P-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.2.2\tLocation information handling",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.2.3\tProhibited usage of PDN connection for emergency bearer services",
                            "text_content": "If the P-CSCF detects that a UE uses a PDN connection for emergency bearer services for a non-emergency REGISTER request, the P-CSCF shall reject that request by a 403 (Forbidden) response.\nNOTE:\tBy assigning specific IP address ranges for a PDN connection for emergency bearer services and configuring those ranges in P-CSCF, the P-CSCF can detect based on the registered Contact address if UE uses an emergency PDN connection for initial registration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.2.6\tResource sharing",
                            "text_content": "If  is supported for this access technology a P-CSCF supporting resource sharing shall apply the procedures in subclause L.3.2.6.\nNOTE:\tResource sharing has in this version of the specification no meaning in the WLAN IP CAN. However, since transfer to EPS IP CAN is seamless from P-CSCF point of view the resource sharing options used over the Rx interface when the UE is attached to the WLAN IP CAN could be used when the UE moves to EPS IP CAN and since Rx requires the resource sharing options to be included in the initial AAR the resource sharing options need to be included also when the UE attached to the WLAN IP CAN initiates or receives a INVITE request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.2.7\tPriority sharing",
                            "text_content": "If  is supported for this access technology a P-CSCF supporting priority sharing and if according to operator policy shall apply the procedures in subclause L.3.2.7.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.2.8\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "R.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "R.3.3.1\tNotification of AS about registration status",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "R.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "R.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "R.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "R.5\tUse of circuit-switched domain",
            "description": "Void.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "S.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is DVB-RCS2 satellite access network.\nDVB-RCS2 (Second Generation DVB Interactive Satellite System) is a term referring to the ETSI standard ETSI TS 101 454-1 [193], ETSI EN 301 545-2 [194], ETSI TS 101 545-3 [195] for 2nd generation DVB satellite based access network technology with a return channel for two-way communication.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "S.2\tDVB-RCS2 aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "S.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by the DVB-RCS2 satellite access network to provide packet-mode communication between the UE and the IM CN subsystem.\nFrom the perspective of the UE, the necessary IP-CAN bearer for signalling is transparently available to the UE.\nThe UE is not directly involved in requests for IP-CAN bearer(s) for media flow(s). The IM CN interacts with the PCRF in the DVB-RCS2 IP-CAN to establish IP-CAN bearer(s) for media flow(s), on behalf of the UE.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "S.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "S.2.2.1\tActivation and P-CSCF discovery",
                            "text_content": "Prior to communication with the IM CN subsystem, the UE shall:\na)\testablish a connection to a DVB-RCS2 RCST depending on local configuration; the RCST shall have completed the RCST commissioning and initialization procedures as described in ETSI TS 101 545-3 [195], and thus have achieved IP connectivity to the  of an SVN;\nb)\tobtain an IP address using the standard IETF protocols (e.g., DHCP or IPCP). The UE shall fix the obtained IP address throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the last deregistration; and\nc)\tacquire a P-CSCF address(es), according to one of the methods described in subclause 9.2.1; the method available to the UE is determined by the SVN to which the RCST is connected.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.2.2.1A\tModification of IP-CAN bearer used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.2.2.1B\tRe-establishment of IP-CAN bearer used for SIP signalling",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "A UE supporting the P-CSCF restoration procedure uses the keep-alive procedures described in RFC 6223 [143].\nIf the P-CSCF fails to respond to keep-alive requests the UE shall acquire a different P-CSCF address using any of the methods described in the subclause S.2.2.1 and perform an initial registration as specified in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.2.2.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.2.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.2.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.2.2.5\tHandling of the IP-CAN for media",
                            "text_content": "The UE does not directly request resources for media flow(s).\nNot applicable.\nNot applicable.\nNot applicable.\nThe UE does not directly request resources for media flow(s). As a result there are no special UE requirements applying to forked responses.\nNot applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.2.2.6\tEmergency service",
                            "text_content": "Emergency service is not supported when the IP-CAN is a DVB-RCS2 satellite access network.\nNot applicable.\nNot applicable.\nThe UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "S.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "S.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "S.2A.1\tImpact on SDP offer / answer of activation or modification of satellite bearer for media by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "S.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "S.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "No additional procedures defined.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "S.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "S.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "S.3.1.0\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The UE may, but need not, include the P-Access-Network-Info header field where indicated in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.2\tAvailability for calls",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.2A\tAvailability for SMS",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.3\tAuthorization header field",
                            "text_content": "Void\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.5\t3GPP PS data off",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.6\tTransport mechanisms",
                            "text_content": "No additional requirements are defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.1.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "S.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "S.3.2.0\tRegistration and authentication",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "In order to determine from which network the request was originated the P-CSCF shall check if the location information received in the network provided and/or UE provided \"dvb-rcs2-node-id\" parameter in the P-Access-Network-Info header field(s) indicates that the UE is connected to the same network as the P-CSCF or not.\nNOTE 1:\tIf local policy does not require the insertion of P-Access-Network-Info header field in the P-CSCF even if it is missing in the received initial request, the P-CSCF can assume that the request is initiated by a UE in the same network as the P-CSCF.\nNOTE 2:\tIf the location information in the network provided and UE provided \"dvb-rcs2-node-id\" parameters (in a request that includes two P-Access-Network-Info header fields) is contradictory, or the two P-Access-Network-Info header fields indicate different access types the P-CSCF ignores either the network provided or the UE provided information according to operator policy.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.2.2\tLocation information handling",
                            "text_content": "Upon receipt of an initial request for a dialog or standalone transaction or an unknown method, the P-CSCF based on local policy may include a P-Access-Network-Info header field. The value of the \"dvb-rcs2-node-id\" parameter shall be provided by the IP-CAN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.2.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.2.4\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.2.6\tResource sharing",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.2.7\tPriority sharing",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.2.8\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "S.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "S.3.3.1\tNotification of AS about registration status",
                            "text_content": "Not applicable\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "S.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "S.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "S.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "S.5\tUse of circuit-switched domain",
            "description": "There is no CS domain in this access technology.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "T.1\tScope",
            "description": "This annex details areas where network policy is subject to additional requirements to those specified in the main part of this document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "T.2\tApplication of network policy for the support of transcoding",
            "description": "When providing transcoding functions at the P-CSCF, at the IBCF and at an AS, the set of codecs to be forwarded as the SDP offer to the remote user is subject to network policy. In order to give support to the codecs and media quality originally requested by the offerer, the network policy shall meet the following requirements.\nNOTE 1:\tRFC 3264 [27B] recommends to list codecs in priority order, so by adding network inserted codecs to the end of the codec list will give higher priority to previous codecs that might have been inserted by the originating UE.\nA)\tAn intermediate entity should attempt to support the original request for codecs from the UE.\nB)\tAn intermediate entity should only remove a codec from the codec list to meet policy requirements of the local access of the user.\nC)\tA modification (i.e. any combination of reordering, removal or addition) to the codec list should only be made, such that the resultant SDP offer / answer exchange results in media of equal or better end-to-end quality than if the modification had not been made, subject to policy restrictions of the access of the local user.\nNOTE 2:\tTranscoding between codecs of higher quality can provide better end-to-end quality than using a common codec of lower quality.\nD)\tA modification (i.e. any combination of reordering, removal or addition) to the codec list should only be made, such that the resultant SDP offer / answer exchange prefers solutions that do not use a transcoder rather than ones that do use transcoder, subject to meeting the policy restrictions in B) and meeting the best end-to-end media quality in C) above.\nE)\tAdditions to the codec list that are provided by the network entity shall be supported by transcoding between at least one of the offered codecs contained in the SDP offer and the added codecs.\nF)\tAn intermediate entity shall not insert a codec to the codec list if end-to-end media security mechanism is required for the related media.\nG)\tIf an intermediate entity performs transcoding during an ongoing session and receives a SIP message containing a subsequent SDP offer including the codec that is currently in use on the incoming call leg, the entity should include the codec that is currently in use on the outgoing call leg when forwarding the SIP message.\nH)\tIf an intermediate entity performs transcoding during an ongoing session and receives a SIP message containing a subsequent SDP offer not including the codec that is currently in use on the incoming call leg, the entity should include the codec that is currently in use on the outgoing call leg when forwarding the SIP message, subject to meeting the policy restrictions in E).\nI)\tIf an intermediate entity does not perform transcoding during an ongoing session and receives a SIP message containing a subsequent SDP offer including the codec that is currently in use, the entity should not add any codecs in the subsequent SDP offer.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "U.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is 5G System (5GS). The 5GS IP-CAN has a 5GS core network which can be supported by a NG-RAN.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "U.2\tIP-CAN aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "U.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by 5GS to provide packet-mode communication between the UE and the IM CN subsystem.\nRequirements for the UE on the use of these packet-mode services are specified in this clause.\nWhen using the 5GS, each IP-CAN bearer is provided by a 5GS QoS flow.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "U.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "U.2.2.1\tEstablishment of IP-CAN bearer and P-CSCF discovery",
                            "text_content": "Prior to communication with the IM CN subsystem, the UE shall:\na)\tif not registered for 5GS services, perform a registration procedure in 5GS as specified in 3GPP TS 24.501 [258];\nb)\tensure that a 5GS PDU session and a QoS flow used for SIP signalling of that PDU session is available. This 5GS QoS flow shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration. As a result, the 5GS PDU session provides the UE with information that makes the UE able to construct an IPv4 or an IPv6 address;\nwhen establishing a 5GS PDU session, if a service which requires service continuity provided by SSC mode 1 as specified in 3GPP TS 23.501 [257], (e.g. IMS Multimedia Telephony Service as specified in 3GPP TS 24.173 [8H]), is to be used within that PDU session, the UE shall set SSC mode 1 for that PDU session;\nwhen establishing a 5GS PDU session with a QoS flow used for SIP signaling, the UE shall indicate to the network, by setting the IM CN Subsystem Signalling Flag in the extended Protocol Configuration Options information element specified in 3GPP TS 24.501 [258] in the PDU SESSION ESTABLISHMENT REQUEST message, that the request is for SIP signalling;\nc)\tuse the QoS flow associated with the default QoS rule for SIP signalling. The UE may also use this 5GS QoS flow for Domain Name Server (DNS) and Dynamic Host Configuration Protocol (DHCP) signalling; and\nd)\tacquire a P-CSCF address(es).\nThe methods for P-CSCF discovery are:\nI.\tWhen using IPv4, employ the DHCP RFC 2132 [20F], the DHCPv4 options for SIP servers RFC 3361 [35A], and RFC 3263 [27A] as described in subclause 9.2.1. When using IPv6, employ Dynamic Host Configuration Protocol for IPv6 (DHCPv6) RFC 3315 [40], the DHCPv6 options for SIP servers RFC 3319 [41] and DHCPv6 options for DNS RFC 3646 [56C] as described in subclause 9.2.1.\nII.\tTransfer P-CSCF address(es) within the 5GS PDU session establishement procedure.\nThe UE shall indicate the request for a P-CSCF address to the network within the extended Protocol Configuration Options information element of the PDU SESSION ESTABLISHMENT REQUEST message.\nIf the network provides the UE with a list of P-CSCF IPv4 or IPv6 addresses in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall assume that the list is ordered top-down with the first P-CSCF address within the extended Protocol Configuration Options information element as the P-CSCF address having the highest preference and the last P-CSCF address within the extended Protocol Configuration Options information element as the P-CSCF address having the lowest preference.\nIII.\tThe UE selects a P-CSCF from the list (see 3GPP TS 31.103 [15B]) stored in the ISIM.\nIV.\tThe UE selects a P-CSCF from the list in IMS management object.\nThe UE shall use method IV to select a P-CSCF, if\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming; and\n-\tthe IMS management object contains the P-CSCF list.\nThe UE shall use method III to select the P-CSCF, if:\n-\ta P-CSCF is to be discovered in the home network;\n-\tthe UE is roaming;\n-\teither the UE does not contain the IMS management object, or the UE contains the IMS management object but the IMS management object does not contain the P-CSCF list; and\n-\tthe ISIM residing in the UICC supports the P-CSCF list.\nThe UE can freely select method I or II for P-CSCF discovery, if:\n-\tthe UE is in the home network; or\n-\tthe UE is roaming and the P-CSCF is to be discovered in the visited network.\nThe UE can select method IV, if:\n-\tthe UE is in the home network; and\n-\tthe IMS management object contains the P-CSCF list.\nIn case method I is selected and several P-CSCF addresses or FQDNs are provided to the UE, the selection of P-CSCF address or FQDN shall be performed as indicated in RFC 3361 [35A] when using IPv4 or RFC 3319 [41] when using IPv6. If sufficient information for P-CSCF address selection is not available, selection of the P-CSCF address by the UE is implementation specific.\nNOTE:\tThe UE decides whether the P-CSCF is to be discovered in the serving network or in the home network based on local configuration, e.g. whether the application on the UE is permitted to use local breakout.\nIf the UE is designed to use I above, but receives P-CSCF address(es) according to II, then the UE shall either ignore the received address(es), or use the address(es) in accordance with II, and not proceed with the DHCP request according to I.\nIf the UE is configured to use Option II above and detects that all P-CSCFs known by the UE have been used when the UE selects a different P-CSCF as a result of:\n-\treceiving 305 (Use Proxy) to the REGISTER request;\n-\treceiving 504 (Server Time-out); or\n-\texpiration of the timer F at the UE,\nthen unless the PDU session is in use by other applications, the UE shall:\n1)\trelease the PDU session of the 5GS QoS flow that is used only for the transport of SIP signalling and that are not used for other non-IMS applications, but shall not release emergency PDU session; and\n2)\tunless the UE decides the service is no longer needed,\na)\tperform a new P-CSCF discovery procedure as described in subslause 9.2.1; and\nb)\tperform the procedures for initial registration as described in subclause 5.1.1.2.\nWhen using IPv4, the UE may request a DNS Server IPv4 address(es) via RFC 2132 [20F] or by the extended Protocol Configuration Options information element when establishing the PDU session according to 3GPP TS 24.501 [258].\nWhen using IPv6, the UE may request a DNS Server IPv6 address(es) via RFC 3315 [40] and RFC 3646 [56C] or by the extended Protocol Configuration Options information element when establishing the PDU session according to 3GPP TS 24.501 [258].\nWhen:\n-\tthe UE obtains a 5GS QoS flow used for SIP signalling by performing handover of the connection from another IP-CAN;\n-\tIP address of the UE is not changed during the handover; and\n-\tthe UE already communicates with the IM CN subsystem via the connection with the other IP-CAN, e.g. the UE determines that its contact with host portion set to the UE IP address (or FQDN of the UE) associated with the connection with the other IP-CAN has been bound to a public user identity;\nthe UE shall continue using the P-CSCF address(es) acquired in the other IP-CAN.\nThe UE may support the policy on whether a roaming UE when in a session is allowed to handover the PDN connection providing access to IMS between EPC via WLAN and 5GS, or is allowed to handover a PDU session providing access to IMS via non 3GPP access, the UE may support being configured with the policy on whether UE when in a session is allowed to transfer the PDN connection or PDU session providing access to IMS between EPC via WLAN using one or more of the following methods:\na)\tthe Allow_Handover_PDU_session_non-3GPP_and_NG-RAN node of EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Allow_Handover_PDU_session_non-3GPP_and_NG-RANnode of EFIMSConfigData file described in 3GPP TS 31.103 [15B];\nc)\tthe Allow_Handover_PDU_session_non-3GPP_and_NG-RAN node of 3GPP TS 24.167 [8G];\nd)\tthe Allow_Handover_PDN_connection_non-3GPP_and_NG-RAN node of EFIMSConfigData file described in 3GPP TS 31.102 [15C];\ne)\tthe Allow_Handover_PDN_connection_non-3GPP_and_NG-RAN node of EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nf)\tthe Allow_Handover_PDN_connection_non-3GPP_and_NG-RAN node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the Allow_Handover_PDU_session_non-3GPP_and_NG-RAN node of 3GPP TS 24.167 [8G] and the Allow_Handover_PDU_session_non-3GPP_and_NG-RAN node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the Allow_Handover_PDU_session_non-3GPP_and_NG-RAN node of the EFIMSConfigData file shall take precedence.\nIf the UE is configured with both the Allow_Handover_PDN_connection_non-3GPP_and_NG-RAN node of 3GPP TS 24.167 [8G] and the Allow_Handover_PDN_connection_non-3GPP_and_NG-RAN node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the Allow_Handover_PDN_connection_non-3GPP_and_NG-RAN node of the EFIMSConfigData file shall take precedence.\nNOTE 5:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.2.2.1A\tModification of the PDU session of the 5GS QoS flow used for SIP signalling",
                            "text_content": "The UE shall not modify the 5GS QoS flow from being used exclusively for SIP signalling.\nWhen a 5GS QoS flow used for SIP signalling is established, the UE shall not set the IM CN Subsystem Signalling Flag in the extended Protocol Configuration Options information element specified in 3GPP TS 24.501 [258] of any subsequent PDU SESSION MODIFICATION REQUEST message for that DNN.\nThe UE shall ignore the IM CN Subsystem Signalling Flag if received from the network in the extended Protocol Configuration Options information element.\nAfter the establishment of a 5GS QoS flow used for SIP signalling, the UE shall not indicate the request for a P-CSCF address to the network within the extended Protocol Configuration Options information element of any subsequent PDU SESSION MODIFICATION REQUEST message for that DNN.\nThe UE shall ignore P-CSCF address(es) if received from the network in the extended Protocol Configuration Options information element of a PDU SESSION MODIFICATION COMMAND message which is triggered by a PDU SESSION MODIFICATION REQUEST message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.2.2.1B\tRe-establishment of the PDU session with the 5GS QoS flow used for SIP signalling",
                            "text_content": "If the UE registered a public user identity with an IP address allocated for the DNN of the PDU session with the 5GS QoS flow used for SIP signalling, the PDU session with the 5GS QoS flow used for SIP signalling is deactivated as result of signalling from the network and:\ni)\tif the UE is required to perform an initial registration according to subclause U.3.1.2;\nii)\tif the signalling from the network results in requiring the UE to initiate activation of the PDU session of the 5GS QoS flow used for SIP signalling; or\niii)\tif the UE needs to continue having a public user identity registered with an IP address allocated for the DNN;\nthe UE shall:\nA)\tif the non-access stratum is performing the UE requested PDU session establishment procedure for the DNN triggered as result of the signalling from the network, wait until the UE requested PDU session establishment procedure for the DNN finish; and\nB)\tperform the procedures in subclause U.2.2.1, bullets a), b) and c).\nIf none of the bullets i), ii) and iii) of this subclause evaluate to true, or the procedures in bullet B) of this subclause were unable to ensure that the 5GS QoS flow used for SIP signalling is available or were unable to acquire any P-CSCF address(es):\n1)\tif the SIP signalling was carried over a 5GS QoS flow not associated with the default QoS rule, the UE shall release all resources established as a result of SIP signalling by sending to the network either:\na)\ta PDU SESSION MODIFICATION REQUEST message, if there are 5GS QoS flows of this PDU session that are not related SIP sessions; or\nb)\ta PDU SESSION RELEASE REQUEST message if all the 5GS QoS flows of this PDU session are related to SIP sessions.\nIf the 5GS QoS flow associated with default QoS rule used for SIP signalling was deactivated as described at the start of this subclause, and the procedures in bullet B) of this subclause ensured that the 5GS QoS flow used for SIP signalling is available and acquired the P-CSCF address(es), the UE shall perform a new initial registration according to subclause 5.1.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "A UE supporting the P-CSCF restoration procedure performs one of the following procedures:\nA\tif the UE used method II for P-CSCF discovery and if the UE receives one or more P-CSCF address(es) in the extended Protocol Configuration Options information element of a PDU SESSION MODIFICATION COMMAND message and the one or more P-CSCF addresse(s) do not include the address of the currently used P-CSCF, then the UE shall acquire a different P-CSCF address from the one or more P-CSCF addresse(s) in the PDU SESSION MODIFICATION COMMAND message. If more than one P-CSCF address with the same container identifier (i.e. \"P-CSCF IPv6 Address\" or \"P-CSCF IPv4 Address\") are included, then the UE shall assume that the more than one P-CSCF addresses with the same container identifier are prioritised with the first P-CSCF address with the same container identifier within the Protocol Configuration Options information element as the P-CSCF address with the highest priority.\nIf the UE used method II for P-CSCF discovery and if the UE has previously sent the \"P-CSCF Re-selection support\" PCO indicator at PDU session creation and if the UE receives one or more P-CSCF address(es) in the extended Protocol Configuration Options information element of a PDU SESSION MODIFICATION COMMAND message, then the UE shall acquire a P-CSCF address from the one or more P-CSCF addresse(s) in the PDU SESSION MODIFICATION COMMAND message. If more than one P-CSCF address with the same container identifier (i.e. \"P-CSCF IPv6 Address\" or \"P-CSCF IPv4 Address\") are included, then the UE shall assume that the more than one P-CSCF addresses with the same container identifier are prioritised with the first P-CSCF address with the same container identifier within the Protocol Configuration Options information element as the P-CSCF address with the highest priority;\nB\tif the UE uses RFC 6223 [143] as part of P-CSCF restoration procedures, and if the P-CSCF fails to respond to a keep-alive request, then the UE shall acquire a different P-CSCF address using one of the methods I, III and IV for P-CSCF discovery described in the subclause U.2.2.1.\nIf the UE has an ongoing session and acquired the new P-CSCF address by using procedure A described above, the UE may wait until the UE has detected that the ongoing session has ended before performing an initial registration as specified in subclause 5.1.\nIn all other cases, when the UE has acquired the P-CSCF address, the UE not having an ongoing session shall perform an initial registration as specified in subclause 5.1.\nNOTE 1:\tFor UEs using procedure A described above, the network ensures that P-CSCF address(es) in the extended Protocol Configuration Options information element of a PDU SESSION MODIFICATION COMMAND message is sent only during P-CSCF restoration procedures as defined in subclause 5 of 3GPP TS 23.380 [7D].\nNOTE 2:\tThe P-CSCF can be completely unreachable, so it is up to UE implementation to detect the end of an ongoing session, e.g. using media plane inactivity detection. Services depending on signalling such as CW and MT calls will not work during this time.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.2.2.2\tSession management procedures",
                            "text_content": "The procedures for session management as described in 3GPP TS 24.501 [258] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.2.2.3\tMobility management procedures",
                            "text_content": "The procedures for mobility management as described in 3GPP TS 24.501 [258] shall apply while the UE is connected to the IM CN subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.2.2.4\tCell selection and lack of coverage",
                            "text_content": "The existing mechanisms and criteria for cell selection as described in 3GPP TS 38.304 [260] or 3GPP TS 36.304 [19B] shall apply while the UE is connected to the IM CN Subsystem.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.2.2.5\t5GS QoS flow for media",
                            "text_content": "NOTE 1:\tDuring establishment of a session, the UE establishes data streams(s) for media related to the session. Either the UE or the network can request for resource allocations for media, but the establishment and modification of the 5GS QoS flow is controlled by the network as described in 3GPP TS 24.501 [258].\nIf the resource allocation is initiated by the UE, the UE starts reserving resources whenever it has sufficient information about the media streams, and used codecs available as specified in 3GPP TS 24.501 [258].\nNOTE 2:\tIf the resource reservation requests are initiated by the network, then the establishment of 5GS QoS flow for media is initiated by the network after the P-CSCF has authorised the respective 5GS QoS flows and provided the QoS requirements to the PCF.\nIf the UE is configured not to initiate resource allocation for media according to 3GPP TS 24.167 [8G], then the UE shall refrain from requesting additional 5GS QoS flow(s) for media until the UE considers that the network did not initiate resource allocation for the media.\nIf the UE receives an activation request from the network for a 5GS QoS flow for media which is associated with the 5GS QoS flow used for signalling, the UE shall correlate the media 5GS QoS flow with a currently ongoing SIP session establishment or SIP session modification.\nIf the UE receives a modification request from the network for a 5GS QoS flow that is used for one or more media streams in an ongoing SIP session, the UE shall:\n1)\tmodify the related PDU session context in accordance with the request received from the network.\nWhen a data stream for media related to a session is released, if the 5GS QoS flow transporting the data stream is no longer needed and allocation of the 5GS QoS flow was requested by the UE, then the UE releases the 5GS QoS flow.\nNOTE:\tThe 5GS QoS flow can be needed e.g. for other data streams of a session or for other applications in the UE.\nThe default QoS flow usage restriction policy consists of zero or more default QoS flow usage restriction policy parts.\nThe default QoS flow usage restriction policy part consists of a mandatory media type condition and an optional ICSI condition.\nThe default QoS flow usage restriction policy does not apply to UE detected emergency calls.\nSending media is restricted according to the default QoS flow usage restriction policy, if sending media is restricted according to at least one default QoS flow usage restriction policy part of the default QoS flow usage restriction policy or if the UE is roaming.\nSending media is restricted according to the default QoS flow usage restriction policy part if:\n1)\tthe media is to be sent for a media stream negotiated in a session offered or established by SIP signalling;\n2)\tthe media stream is of a media type indicated in the media type condition of the QoS flow usage restriction policy part;\n3)\tthe following is true:\na)\tthe default QoS flow usage restriction policy part does not have the ICSI condition; or\nb)\tthe session is offered or established by SIP signalling related to an IMS communication service identified in the ICSI condition of the default QoS flow usage restriction policy part; and\n4)\tthe media is to be sent via the default QoS flow of the PDU session for SIP signalling.\nThe UE may support the default QoS flow usage restriction policy.\nIf the UE supports the default QoS flow usage restriction policy:\n1)\tthe UE shall not send media restricted according to the default QoS flow usage restriction policy; and\n2)\tthe UE may support being configured with the default QoS flow usage restriction policy using one or more of the following methods:\na)\tthe Default_QoS_Flow_usage_restriction_policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Default_QoS_Flow_usage_restriction_policy node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Default_QoS_Flow_usage_restriction_policy node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the Default_QoS_Flow_usage_restriction_policy node of 3GPP TS 24.167 [8G] and the Default_QoS_Flow_usage_restriction_policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the Default_QoS_Flow_usage_restriction_policy node of the EFIMSConfigData file shall take precedence.\nNOTE:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nNOTE 1:\tThe procedures in this subclause only apply when the UE requests activation and modification of 5GS QoS flows for media . In the case where the network activates and modifies the 5GS QoS flows for media the network takes care of the handling of 5GS QoS flows in the case of forking.\nSince the UE does not know that forking has occurred until a second, provisional response arrives, the UE requests resource allocation as required by the initial response received. If a subsequent provisional response is received, different alternative actions may be performed depending on the requirements in the SDP answer:\n1)\tThe resource requirements of the subsequent SDP can be accommodated by the existing resources requested. The UE performs no further resource requests.\n2)\tThe subsequent SDP introduces different QoS requirements or additional IP flows. The UE requests further resource allocation according to subclause U.2.2.5.1.\n3)\tThe subsequent SDP introduces one or more additional IP flows. The UE requests further resource allocation according to subclause U.2.2.5.1.\nNOTE 2:\tWhen several forked responses are received, the resources requested by the UE are the \"logical OR\" of the resources indicated in the multiple responses to avoid allocation of unnecessary resources. The UE does not request more resources than proposed in the original INVITE request.\nWhen a final answer is received for one of the early dialogs, the UE proceeds to set up the SIP session. The UE shall release all the unneeded IP-CAN resources. Therefore, upon the reception of the first final 200 (OK) response for the INVITE request (in addition to the procedures defined in RFC 3261 [26] subclause 13.2.2.4), the UE shall:\n1)\tin case resources were established or modified as a consequence of the INVITE request and forked provisional responses that are not related to the accepted 200 (OK) response, send release request to release the unneeded resources.\nThe UE can receive resource reservation related error codes in a PDU SESSION MODIFICATION REJECT as described in 3GPP TS 24.501 [258]. If the UE receives a resource reservation related error code, the UE shall either handle the resource reservation failure as described in subclause 6.1.1 or retransmit the message up to three times.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.2.2.6\tEmergency service",
                            "text_content": "For the purposes of this document, an emergency PDU session is the equivalent of emergency bearers; i.e. the 5GS defines emergency bearers for the support of emergency calls. Emergency PDU session is defined for use in emergency calls in 5GS and core network support of emergency PDU session is indicated to the UE in NAS signalling. Where the UE recognises that a call request is an emergency call and the core network supports emergency PDU session, the UE shall use emergency PDU session for both signalling and media for emergency calls made using the IM CN subsystem.\nSome jurisdictions allow emergency calls to be made when the UE does not contain an UICC, or where the credentials are not accepted. Additionally, where the UE is in state 5GMM-REGISTERED.LIMITED-SERVICE or 5GMM-REGISTERED.PLMN-SEARCH, a normal registration in 5GS has been attempted but it can also be assumed that a registration in the IM CN subsystem will also fail. In such cases, subject to the lower layers indicating that the network does support emergency bearer services in limited service state (see 3GPP TS 36.331 [19F] or 3GPP TS 38.331 [19G]), the procedures for emergency calls without registration can be applied, as defined in subclause 5.1.6.8.2. If the 5GS primary authentication procedure has already succeeded during the latest normal or emergency registration procedure in 5GS, the UE shall perform an initial emergency registration, as described in subclause 5.1.6.2 before attempting an emergency call as described in subclause 5.1.6.8.3.\nNOTE 1:\tThe UE can determine that 5GS primary authentication procedure has succeeded during the emergency registration procedure in 5GS when a non-null integrity protection algorithm (i.e. other than 5G-IA0 algorithm) is received in the NAS signalling SECURITY MODE COMMAND message.\nTo perform emergency registration, the UE shall request to establish an emergency PDU session as described in 3GPP TS 24.501 [258]. The procedures for PDU session establishment and P-CSCF discovery, as described in subclause U.2.2.1 of this specification apply accordingly.\nIn the present document, \"EMS is Y\" as described in 3GPP TS 23.167 [4B] refers to one of the following conditions:\na)\tif the UE is in an NR cell connected to 5GCN, the network indicates in the REGISTRATION ACCEPT message that EMC is set to either \"Emergency services supported in NR connected to 5GCN only\" or \"Emergency services supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" as described in 3GPP TS 24.501 [258]; or\nb)\tif the UE is in an E-UTRA cell connected to 5GCN, the network indicates in the REGISTRATION ACCEPT message that EMC is set to either \"Emergency services supported in E-UTRA connected to 5GCN only\" or \"Emergency services supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" as described in 3GPP TS 24.501 [258].\nIn the present document, \"EMS is N\" as described in 3GPP TS 23.167 [4B] refers to one of the following conditions:\na)\tif the UE is in an NR cell connected to 5GCN, the network indicates in the REGISTRATION ACCEPT message that EMC is set to either \"Emergency services not supported\" or \"Emergency services supported in E-UTRA connected to 5GCN only\" as described in 3GPP TS 24.501 [258]; or\nb)\tif the UE is in an E-UTRA cell connected to 5GCN, the network indicates in the REGISTRATION ACCEPT message that EMC is set to either \"Emergency services not supported\" or \"Emergency services supported in NR connected to 5GCN only\" as described in 3GPP TS 24.501 [258].\nIn the present document, \"ESFB is Y\" as described in 3GPP TS 23.167 [4B] refers to one of the following conditions:\na)\tif the UE is in an NR cell connected to 5GCN, the network indicates in the REGISTRATION ACCEPT message that EMF is set to either \"Emergency service fallback supported in NR connected to 5GCN only\" or \"Emergency service fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" as described in 3GPP TS 24.501 [258]; or\nb)\tif the UE is in an E-UTRA cell connected to 5GCN, the network indicates in the REGISTRATION ACCEPT message that EMF is set to either \"Emergency service fallback supported in E-UTRA connected to 5GCN only\" or \"Emergency service fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" as described in 3GPP TS 24.501 [258].\nIn the present document, \"ESFB is N\" as described in 3GPP TS 23.167 [4B] refers to one of the following conditions:\na)\tif the UE is in an NR cell connected to 5GCN, the network indicates in the REGISTRATION ACCEPT message that EMF is set to either \"Emergency service fallback not supported\" or \"Emergency service fallback supported in E-UTRA connected to 5GCN only\" as described in 3GPP TS 24.501 [258]; or\nb)\tif the UE is in an E-UTRA cell connected to 5GCN, the network indicates in the REGISTRATION ACCEPT message that EMF is set to either \"Emergency service fallback not supported\" or \"Emergency service fallback supported in NR connected to 5GCN only\" as described in 3GPP TS 24.501 [258].\nEmergency services fallback is defined to direct or redirect the UE towards either E-UTRA connected to 5GCN or EPS and support of emergency service fallback is indicated to the UE in NAS signalling.\nIn order to find out whether the UE is attached to the home PLMN or to a visited PLMN, the UE shall compare the  and  values derived from its  with the  and  of the PLMN the UE is attached to. If the  and  of the PLMN the UE is attached to do not match with the  and  derived from the , then for the purpose of emergency calls in the IM CN subsystem the UE shall consider to be attached to a VPLMN.\nNOTE 2:\tIn this respect an equivalent HPLMN, as defined in 3GPP TS 23.122 [4C] will be considered as a visited network.\nIf the UE selected an entry of the \"list of subscriber data\" in the SNPN access mode as specified in 3GPP TS 23.122 [4C], in order to find out whether the UE is attached to a subscribed SNPN or to a non-subscribed SNPN , the UE shall compare the SNPN identity of the selected entry of the \"list of subscriber data\" with the SNPN identity of the SNPN the UE is attached to. If the SNPN identity of the SNPN the UE is attached to does not match the SNPN identity of the selected entry of the \"list of subscriber data\", then for the purpose of emergency calls in the IM CN subsystem the UE shall consider to be attached to a non-subscribed SNPN.\nIf the UE selected the PLMN subscription in the SNPN access mode as specified in 3GPP TS 23.122 [4C], then for the purpose of emergency calls in the IM CN subsystem the UE shall consider to be attached to a non-subscribed SNPN.\nIf the dialled number is equal to a local emergency number stored in the Extended Local Emergency Number List (as defined in 3GPP TS 24.301 [8J]), then the UE shall recognize such a number as for an emergency call and:\n-\tif the dialled number is equal to an emergency number stored in the ME, or in the USIM, then the UE shall perform either procedures in the subclause U.2.2.6.1B or the procedures in subclause U.2.2.6.1A; and\n-\tif the dialled number in not equal to an emergency number stored in the ME, or in the USIM, then the UE shall perform procedures in the subclause U.2.2.6.1B.\nIf the dialled number is not equal to a local emergency number stored in the Extended Local Emergency Number List (as defined in 3GPP TS 24.301 [8J]) and:\n-\tif the dialled number is equal to an emergency number stored in the ME, in the USIM or in the Local Emergency Number List (as defined in 3GPP TS24.008 [8]), then the UE shall recognize such a number as for an emergency call and performs the procedures in subclause U.2.2.6.1A.\nNOTE 3:\tThe UE verifies if a detected emergency number is still present in the Extended Local Emergency Number List after registering to a different PLMN. It is possible for the number to no longer be present in the Extended Local Emergency Number List if:\n-\tthe PLMN attached to relies on the Local Emergency Number List for deriving a URN; or\n-\tthe previously received Extended Emergency Number List Validity field indicated \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\".\nIf the UE detected an emergency number, the UE subsequently performs a registration procedure or an emergency registration procedure with a different PLMN than the PLMN from which the UE received the last Extended Local Emergency Number List, the dialled number is not stored in the ME, in the USIM and in the Local Emergency Number List, and:\n-\tthe REGISTRATION ACCEPT message received from the different PLMN contains the Extended Local Emergency Number List and the emergency number is present in the updated Extended Local Emergency Number List then the UE uses the updated Extended Local Emergency Number List when it performs the procedures in subclause U.2.2.6.1B; and\n-\tthe REGISTRATION ACCEPT message received from the different PLMN contains no Extended Local Emergency Number List or the emergency number is no longer present in the updated Extended Local Emergency Number List then the UE shall attempt UE procedures for SIP that relate to emergency using emergency service URN \"urn:service:sos\".\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.2A.1.1 and subclause 5.1.3.1, if:\n-\tthe 380 (Alternate Service) response contains a Contact header field;\n-\tthe value of the Contact header field is a service URN; and\n-\tthe service URN has a top-level service type of \"sos\";\nthen the UE determines that \"emergency service information is included\" as described 3GPP TS 23.167 [4B].\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.3.1 if the 380 (Alternate Service) response does not contain a Contact header field with service URN that has a top-level service type of \"sos\", then the UE determines that \"no emergency service information is included\" as described 3GPP TS 23.167 [4B].\nIf the \"emergency service information is included\" as described 3GPP TS 23.167 [4B]:\n1)\tif the URN in the Contact header field matches an emergency service URN in table U.2.2.6.1, then the type of emergency service is the value corresponding to the matching entry in table U.2.2.6.1; and\n2)\tif the URN in the Contact header field does not match any emergency service URN in table U.2.2.6.1, then the type of emergency service is not identified.\nNOTE 4:\tIn bullet 2), the URN in the Contact header field either contains \"no emergency subservice type\" as described in 3GPP TS 23.167 [4B] triggering an emergency call, or contains an \"emergency subservice type that does not map into an emergency service category for the CS domain\" as described in 3GPP TS 23.167 [4B] triggering a normal call when the dialled number is available or triggering an emergency call when the dialled number is not available. The country specific URN is an example of a \"emergency subservice type that does not map into an emergency service category for the CS domain\".\nWhen the emergency registration expires, the UE should disconnect the emergency PDU session.\nUpon receiving a 3xx other than 380 (Alternative service), 4xx, 5xx or 6xx response to an INVITE request for a UE detectable emergency call, the UE shall perform domain selection as specified in 3GPP TS 23.167 [4B] annex H, to re-attempt the emergency call.\nThe type of emergency service for an emergency number is derived from the settings of the emergency service category value (bits 1 to 5 of the emergency service category value as specified in subclause 10.5.4.33 of 3GPP TS 24.008 [8]). Table U.2.2.6.1 below specifies mappings between a type of emergency service and an emergency service URN. The UE shall use the mapping to match an emergency service URN and a type of emergency service. If a dialled number is an emergency number but does not map to a type of emergency service the service URN shall be \"urn:service:sos\".\nTable U.2.2.6.1: Mapping between type of emergency service and emergency service URN\n\nNOTE 1:\tIt is not possible for a UE to indicate more than one type of emergency service in an emergency service URN.\nIf an IP-CAN, capable of providing local emergency numbers, did not provide a local emergency number that matches the dialled number (see subclause 5.1.6.1) and multiple types of emergency service can be derived for a dialled number from the information configured on the UICC then:\n-\tif the UE is in the HPLMN or a subscribed SNPN, the UE shall map any one of these types of emergency service to an emergency service URN as specified in table U.2.2.6.1; and\n-\tif the UE is in a VPLMN or a non-subscribed SNPN, the UE shall select \"urn:service:sos\".\nIf an IP-CAN, capable of providing local emergency numbers, provided a local emergency number that matches the dialled number (see subclause 5.1.6.1), and:\n-\tif the UE can derive one or more types of emergency service from the information received from the IP-CAN for the dialled number and the UE cannot derive types of emergency service from the information configured on the UICC for the dialled number; or\n-\tif the UE is able to derive identical types of emergency service from both the information received from the IP-CAN for the dialled number and from the information configured on the UICC for the dialled number,\nthen the UE shall map any one of these emergency service types to an emergency service URN as specified in table U.2.2.6.1.\nNOTE 2:\tHow the UE resolves clashes where an emergency number is associated with one or more different types of emergency service configured in the USIM and in information received from the core network, is implementation dependent.\nThe Extended Local Emergency Number List (defined in 3GPP TS 24.301 [8J]) can contain sub-services of the associated emergency service URN for the detected emergency number.\nIf:\n-\tthe length of sub-services field is greater than \"0\", the UE shall construct the emergency service URN using \"urn:service:sos\" followed by adding a dot followed by the content of the sub-services field; and\n-\tthe length of sub-services field is \"0\", the UE shall use the emergency service URN \"urn:service:sos\".\nEXAMPLE 1:\tFor a detected number, if the sub-service is \"gas\", then the UE constructs \"urn:service:sos.gas\" as the associated emergency service URN.\nEXAMPLE 2:\tFor a detected number, if no sub-service is provided, then the UE uses \"urn:service:sos\" as the associated emergency service URN.\nIf the IP-CAN indicates the eCall support indication or the CS domain is not available to the UE, the UE can send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nIf the IP-CAN does not indicate the eCall support indication and the CS domain is available to the UE, the UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nVoid.\nNOTE:\tThis subclause covers only the case where the UE selects the IM CN subsystem in accordance with the conventions and rules specified in 3GPP TS 23.167 [4B] and describes the IP-CAN specific procedure. It does not preclude the use of CS domain. When a CS system based on 3GPP TS 24.008 [8] is to be used, clause B.5 applies.\nWhen the UE operates in single-registration mode as described in 3GPP TS 24.501 [258] and the UE recognises that a call request is an emergency call, if:\n1)\tthe IM CN subsystem is selected in accordance with the conventions and rules specified in 3GPP TS 23.167 [4B]; and\n2)\tthe UE is currently registered to the 5GS services while the UE is in an NR cell connected to 5GCN;\nthen the following treatment is applied:\n1)\tif the EMC indicates \"Emergency services not supported\":\na)\tif the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257] and the emergency services fallback is available (i.e., \"ESFB is Y\" as described in 3GPP TS 23.167 [4B]), the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258]. If the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may behave as described in bullet b) below assuming that the emergency services fallback is not available;\nb)\tif the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257] and the emergency services fallback is not available (i.e., \"ESFB is N\" as described in 3GPP TS 23.167 [4B]) and if:\ni)\tthe EMF is set to \"Emergency services fallback supported in E-UTRA connected to 5GCN only\" and the UE is capable of accessing 5GCN via E-UTRA, the UE shall either:\nA)\tattempt to select an E-UTRA cell connected to 5GCN. If the UE finds a suitable E-UTRA cell connected to 5GCN, the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258] via E-UTRA connected to 5GCN. If the UE does not find a suitable E-UTRA cell connected to 5GCN or the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; or\nB)\tattempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; or\nii)\tthe EMF is set to \"Emergency services fallback not supported\" or the UE is not capable of accessing 5GCN via E-UTRA, the UE shall request the lower layers to disable the N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [257] and attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; and\nc)\tif the UE does not support emergency services fallback as specified in 3GPP TS 23.501 [257], the UE shall request the lower layers to disable the N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [257] and attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration;\n2)\tif the EMC indicates \"Emergency services supported in E-UTRA connected to 5GCN only\":\na)\tif the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257] and the emergency services fallback is available (i.e., \"ESFB is Y\" as described in 3GPP TS 23.167 [4B]), the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258]. If the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may behave as described in bullet b) below assuming that the emergency services fallback is not available; and\nb)\tif the UE does not support emergency services fallback as specified in 3GPP TS 23.501 [257] or the emergency services fallback is not available (i.e., \"ESFB is N\" as described in 3GPP TS 23.167 [4B]) and if:\ni)\tthe UE is capable of accessing 5GCN via E-UTRA, the UE shall attempt to select an E-UTRA cell connected to 5GCN. If the UE finds a suitable E-UTRA cell connected to 5GCN, the UE shall trigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258] via E-UTRA connected to 5GCN. If the UE does not find a suitable E-UTRA cell connected to 5GCN, the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; or\nii)\tthe UE is not capable of accessing 5GCN via E-UTRA, the UE shall request the lower layers to disable the N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [257] and attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; and\n3)\tif the EMC indicates \"Emergency services supported in NR connected to 5GCN only\" or \"Emergency services supported in NR connected to 5GCN and E-UTRA connected to 5GCN\", the UE shall trigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258].\nWhen the UE operates in single-registration mode as described in 3GPP TS 24.501 [258] and the UE recognises that a call request is an emergency call, if:\n1)\tthe IM CN subsystem is selected in accordance with the conventions and rules specified in 3GPP TS 23.167 [4B]; and\n2)\tthe UE is currently registered to the 5GS services while the UE is in an E-UTRA cell connected to 5GCN;\nthen the following treatment is applied:\n1)\tif the EMC indicates \"Emergency services not supported\":\na)\tif the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257] and the emergency services fallback is available (i.e., \"ESFB is Y\" as described in 3GPP TS 23.167 [4B]), the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258]. If the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may behave as described in bullet b) below assuming that the emergency services fallback is not available;\nb)\tif the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257] and the emergency services fallback is not available (i.e., \"ESFB is N\" as described in 3GPP TS 23.167 [4B]) and if:\ni)\tthe EMF is set to \"Emergency services fallback supported in NR connected to 5GCN only\" and the UE is capable of accessing 5GCN via NR, the UE shall either:\nA)\tattempt to select an NR cell connected to 5GCN. If the UE finds a suitable NR cell connected to 5GCN, the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258] via NR connected to 5GCN. If the UE does not find a suitable NR cell connected to 5GCN or the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; or\nB)\tattempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; or\nii)\tthe EMF is set to \"Emergency services fallback not supported\" or the UE is not capable of accessing 5GCN via NR, the UE shall request the lower layers to disable the N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [257] and attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; and\nc)\tif the UE does not support emergency services fallback as specified in 3GPP TS 23.501 [257], the UE shall request the lower layers to disable the N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [257] and attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration;\n2)\tif the EMC indicates \"Emergency services supported in NR connected to 5GCN only\":\na)\tif the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257] and the emergency services fallback is available (i.e., \"ESFB is Y\" as described in 3GPP TS 23.167 [4B]), the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258]. If the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may behave as described in bullet b) below assuming that the emergency services fallback is not available; and\nb)\tif the UE does not support emergency services fallback as specified in 3GPP TS 23.501 [257] or the emergency services fallback is not available (i.e., \"ESFB is N\" as described in 3GPP TS 23.167 [4B]) and if:\ni)\tthe UE is capable of accessing 5GCN via NR, the UE shall attempt to select an NR cell connected to 5GCN. If the UE finds a suitable NR cell connected to 5GCN, the UE shall trigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258] via NR connected to 5GCN. If the UE does not find a suitable NR cell connected to 5GCN, the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; or\nii)\tthe UE is not capable of accessing 5GCN via NR, the UE shall request the lower layers to disable the N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [257] and attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; and\n3)\tif the EMC indicates \"Emergency services supported in E-UTRA connected to 5GCN only\" or \"Emergency services supported in NR connected to 5GCN and E-UTRA connected to 5GCN\", the UE shall trigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258].\nNOTE 1:\tThis subclause covers only the case where the UE selects the IM CN subsystem in accordance with the conventions and rules specified in 3GPP TS 23.167 [4B] and describes the IP-CAN specific procedure. It does not preclude the use of CS domain. When a CS system based on 3GPP TS 24.008 [8] is to be used, clause B.5 applies.\nWhen the UE operates in dual-registration mode as described in 3GPP TS 24.501 [258] and the UE recognises that a call request is an emergency call, if:\n1)\tthe IM CN subsystem is selected in accordance with the conventions and rules specified in 3GPP TS 23.167 [4B]; and\n2)\tthe UE currently camps on an NR cell connected to 5GCN;\nthen the following treatment is applied:\n1)\tif the EMC indicates \"Emergency services not supported\" and:\na)\tif the UE is attached for EPS services and the network provided the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; or\nb)\tif the UE is not attached for EPS services, and:\ni)\tif emergency services fallback is available (i.e. \"ESFB is Y\" as described in 3GPP TS 23.167 [4B]) and the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257], the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258]. If the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may behave as described in bullet ii) below assuming that the emergency services fallback is not available; or\nii)\tif emergency services fallback is not available (i.e. \"ESFB is N\" as described in 3GPP TS 23.167 [4B]) or the UE does not support emergency services fallback as specified in 3GPP TS 23.501 [257], the UE shall attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration;\n2)\tif the EMC indicates \"Emergency services supported in E-UTRA connected to 5GCN only\" and:\na)\tif the UE is attached for EPS services and:\ni)\tif the network provided the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; or\nii)\tif the network provided the UE with the EMC BS set to \"emergency bearer services in S1 mode not supported\" as described in 3GPP TS 24.301 [8J] and the UE is capable of accessing 5GCN via E-UTRA, the UE shall be locally detached for EPS services and the UE shall attempt to select an E-UTRA cell connected to 5GCN. If the UE finds a suitable E-UTRA cell connected to 5GCN, the UE shall trigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258] via E-UTRA connected to 5GCN; or\nb)\tif the UE is not attached for EPS services and:\ni)\tif emergency services fallback is available (i.e., \"ESFB is Y\" as described in 3GPP TS 23.167 [4B]) and the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257], the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258]. If the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may behave as described in bullet ii) below assuming that the emergency services fallback is not available; or\nii)\tif emergency services fallback is not available (i.e., \"ESFB is N\" as described in 3GPP TS 23.167 [4B]) or the UE does not support emergency services fallback as specified in 3GPP TS 23.501 [257], and:\nA)\tif the UE is capable of accessing 5GCN via E-UTRA, the UE shall attempt to select an E-UTRA cell connected to 5GCN. If the UE finds a suitable E-UTRA cell connected to 5GCN, the UE shall trigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258] via E-UTRA connected to 5GCN. If the UE does not find a suitable E-UTRA cell connected to 5GCN, the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; or\nB)\tif the UE is not capable of accessing 5GCN via E-UTRA, the UE shall attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; and\n3)\tif the EMC indicates \"Emergency services supported in NR connected to 5GCN only\" or \"Emergency services supported in NR connected to 5GCN and E-UTRA connected to 5GCN\", and:\na)\tif the UE is not attached for EPS services or the UE is attached for EPS services but the network provided the UE with the EMC BS set to \"emergency bearer services in S1 mode not supported\" as described in 3GPP TS 24.301 [8J], the UE shall trigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258]; or\nb)\tif the UE is attached for EPS services and the network provided the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall either:\ni)\ttrigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258]; or\nii)\tperform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration.\nNOTE 2:\tIn the above case, the UE chooses between items i) and ii) based on UE implementation.\nWhen the UE operates in dual-registration mode as described in 3GPP TS 24.501 [258] and the UE recognises that a call request is an emergency call, if:\n1)\tthe IM CN subsystem is selected in accordance with the conventions and rules specified in 3GPP TS 23.167 [4B]; and\n2)\tthe UE currently camps on an E-UTRA cell connected to 5GCN and the UE is not attached for EPS services;\nthen the following treatment is applied:\n1)\tif the EMC indicates \"Emergency services not supported\" and:\na)\tif emergency services fallback is available (i.e. \"ESFB is Y\" as described in 3GPP TS 23.167 [4B]) and the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257], the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258]. If the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may behave as described in bullet b) below assuming that the emergency services fallback is not available; or\nb)\tif emergency services fallback is not available (i.e. \"ESFB is N\" as described in 3GPP TS 23.167 [4B]) or the UE does not support emergency services fallback as specified in 3GPP TS 23.501 [257], the UE shall attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC, the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; and\n2)\tif the EMC indicates \"Emergency services supported in NR connected to 5GCN only\" and:\na)\tif emergency services fallback is available (i.e., \"ESFB is Y\" as described in 3GPP TS 23.167 [4B]) and the UE supports emergency services fallback as specified in 3GPP TS 23.501 [257], the UE shall attempt emergency services fallback as specified in 3GPP TS 24.501 [258]. If the UE receives from the lower layers an indication that the emergency services fallback attempt failed, the UE may behave as described in bullet b) below assuming that the emergency services fallback is not available; or\nb)\tif emergency services fallback is not available (i.e., \"ESFB is N\" as described in 3GPP TS 23.167 [4B]) or the UE does not support emergency services fallback as specified in 3GPP TS 23.501 [257] and:\ni)\tif the UE is capable of accessing 5GCN via NR, the UE shall attempt to select an NR cell connected to 5GCN. If the UE finds a suitable NR cell connected to 5GCN, the UE shall trigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258] via NR connected to 5GCN. If the UE cannot find a suitable NR cell connected to 5GCN, the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; and\nii)\tif the UE is not capable of accessing 5GCN via NR, the UE shall attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC and the network provides the UE with the EMC BS set to \"emergency bearer services in S1 mode supported\" as described in 3GPP TS 24.301 [8J], the UE shall perform the procedures as described in subclause L.2.2.6 to activate an EPS bearer context to perform emergency registration; and\n3)\tif the EMC indicates \"Emergency services supported in E-UTRA connected to 5GCN only\" or \"Emergency services supported in NR connected to 5GCN and E-UTRA connected to 5GCN\", the UE shall trigger establishment of an emergency PDU session as specified in 3GPP TS 24.501 [258].\nIf the UE operating in dual-registration mode and camping on an E-UTRA cell connected to 5GCN, is also attached for EPS service, the domain selection is out of the scope of the specification.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table U.2.2.6.1: Mapping between type of emergency service and emergency service URN",
                                    "table number": 471,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "U.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "U.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "No additional procedures defined.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "U.2A.1\tImpact on SDP offer / answer of activation or modification of IP-CAN for media by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "If, due to the activation of 5GS QoS flow from the network the related SDP media description needs to be changed, the UE shall update the related SDP information by sending a new SDP offer within a SIP request, which is sent over the existing SIP dialog.\nIf the UE receives a modification request from the network for a 5GS QoS flow that is used for one or more media streams in an ongoing SIP session, the UE shall:\n1)\tif, due to the modification of the 5GS QoS flow, the related SDP media description need to be changed, update the related SDP information by sending a new SDP offer within a SIP request, that is sent over the existing SIP dialog, and respond to the 5GS QoS flow modification request.\nNOTE:\tThe UE can decide to indicate additional media streams as well as additional or different codecs in the SDP offer than those used in the already ongoing session.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "U.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "If the UE receives an SDP offer where the SDP offer includes all media streams for which the originating side indicated its local preconditions as met, if the precondition mechanism is supported by the terminating UE and the IP-CAN performs network-initiated resource reservation for the terminating UE and the available resources are not sufficient for the received offer, the terminating UE shall indicate its local preconditions and provide the SDP answer to the originating side without waiting for resource reservation.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "U.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "NOTE:\tWhen establishing an emergency session or when modifying an emergency session, the IMSVoPS indicator does not influence handling of SDP offer and SDP answer.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "U.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "U.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "U.3.1.0\tRegistration and authentication",
                            "text_content": "The UE shall perform reregistration of a previously registered public user identity bound to any one of its contact addresses when changing to an IP-CAN for which usage is specified in annex R or annex W. The reregistration is performed using the new IP-CAN.\nNOTE 1:\tThis document does not specify how the UE detects that the used IP-CAN has changed. The information that is forcing the reregistration is also used to generate the content for the P-Access-Network-Info header field.\nNOTE 2:\tThe UE will send the reregistration irrespective of whether it has a SIP dialog or not.\nIf the UE supports the 3GPP PS data off, then the UE shall in all REGISTER requests include the \"+g.3gpp.ps-data-off\" header field parameter defined in subclause 7.9.8 set to a value indicating the 3GPP PS data off status.\nWhen the UE sends a REGISTER request, if the 3GPP PS data off status is \"active\", then the UE shall only include media feature tags associated with services that are 3GPP PS data off exempt services in the g.3gpp.icsi-ref media feature tag, as defined in subclause 7.9.2 and RFC 3840 [62], for the IMS communication services it intends to use.\nIf the UE is registered, and the 3GPP PS data off status is changed, then the UE shall perform a reregistration of the previously registered public user identity.\nA UE supporting ANBR as specified in 3GPP TS 26.114 [9B] shall also support RAN-assisted codec adaptation as specified in 3GPP TS 38.300 [270] and 3GPP TS 38.321 [271].\nIf the UE supports ANBR, upon receiving a 200 (OK) response to the REGISTER request and if the 200 (OK) response contains a Feature-Caps header field with the g.3gpp.anbr feature-capability indicator the UE shall assume that the Network supports RAN-assisted codec adaptation as specified in 3GPP TS 38.300 [270] and 3GPP TS 38.321 [271]. The UE is allowed to include the SDP ‘anbr’ attribute during session establishment as specified in 3GPP TS 26.114 [9B].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.0A\tIMS_Registration_handling policy",
                            "text_content": "The IMS_Registration_handling policy indicates whether the UE deregisters from IMS after a configured amount of time after receiving an indication that the IMS Voice over PS Session is not supported.\nThe UE may support the IMS_Registration_handling policy.\nIf the UE supports the IMS_Registration_handling policy, the UE may support being configured with the IMS_Registration_handling policy using one or more of the following methods:\na)\tthe IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe IMS_Registration_Policy node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the IMS_Registration_Policy node of 3GPP TS 24.167 [8G] and the IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the IMS_Registration_Policy node of the EFIMSConfigData file shall take precedence.\nNOTE 1:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nIf the UE is registered with IMS and the IMSVoPS indicator, provided by the lower layers (see 3GPP TS 24.501 [258]), indicates voice is not supported, the UE shall:\nA)\tif the Stay_Registered_When_VoPS_Not_Supported leaf indicates requirement to stay registered, the UE needs not to deregister and maintains the registration as required for IMS services; or\nNOTE 2:\tThe UE will periodically refresh the registration when needed.\nB)\tif the Stay_Registered_When_VoPS_Not_Supported leaf indicates requirement to deregister and the Deregistration_Timer leaf used to configure the NoVoPS-dereg timer defined in table 7.8.1 contains a timer value for the time to wait before deregistrerting from IMS, start a timer with the value indicated in the policy and:\na)\tif the timer expires before the UE receives an indication from the lower layers that IMS voice is supported:\n1)\tif there is no ongoing IMS session, the UE either performs reregistration as specified in subclause 5.1.1.4 and shall only include feature tags associated with services that are independent of IMSVoPS indicator or deregister from the IMS following the procedures specified in subclause 5.1.1.6; or\n2)\tif there is ongoing IMS session, and\ni)\tif the UE does not receive indication from the lower layer that the IMS voice is supported before the ongoing IMS session is terminated, the UE either performs reregistration as specified in subclause 5.1.1.4 and shall only include feature tags associated with services that are independent of IMSVoPS indicator or deregister from the IMS following the procedures specified in subclause 5.1.1.6 as soon as the ongoing IMS based service is terminated; or\nii)\tif the UE receives indication from the lower layer that the IMS voice is supported before the ongoing IMS session is terminated, cancel the timer; or\nNOTE 3:\tHow the UE selects reregistration or deregistration is implementation dependent (e.g., SMS service)\nb)\tif the UE receives an indication from the lower layers that IMS voice is supported before the timer expires, cancel the timer.\nIf the IMS_Registration_handling policy is not configured, the UE behaviour is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The UE shall always include the P-Access-Network-Info header field where indicated in subclause 5.1.\nNOTE:\tIf the P-Access-Network-Info header field includes radio cell identity, the P-Access-Network-Info header field populated by the UE that supports Multi-RAT Dual Connectivity with the 5GCN as described in 3GPP TS 37.340 [264] will contain the information about the radio cell identity of the Master RAN node that is serving the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.2\tAvailability for calls",
                            "text_content": "This subclause documents the minimal requirements for being available for voice communication services when using 5GS.\nA UE shall perform an initial registration as specified in subclause 5.1.1.2 using a QoS flow for SIP signalling (see annex U.2.2.1), if all the following conditions are met:\n1)\tif the UE is operating in the \"voice centric\" way;\n2)\tif the UE is capable of receiving any (but not necessarily all) of the media types which the CS domain supports, such that the media type can also be used when accessing the IM CN subsystem using:\na)\tthe 5GS IP-CAN via NR;\nb)\tthe 5GS IP-CAN via E-UTRA; or\nNOTE 1:\tThe use of 5GS IP-CAN via E-UTRA can also be the result of an inter-RAT fallback during setup of the IMS voice call. This can occur, for example, when a UE not supporting the media type in 5GS IP-CAN via NR initiates an IMS voice call in 5GS IP-CAN via NR.\nc)\tthe EPS IP-CAN;\nNOTE 2:\tEPS can be used as IP-CAN as the result of an EPS fallback during setup of the IMS voice call. This can occur, for example, when a UE not supporting the media type in 5GS IP-CAN via NR initiates an IMS voice call in 5GS IP-CAN via NR, or when a UE not supporting the media type in 5GS IP-CAN via E-UTRA initiates an IMS voice call in 5GS IP-CAN via E-UTRA.\n3)\tif:\na)\tthe media type of item 2 is an \"audio\" media type;\nb)\tthe UE supports codecs suitable for (conversational) speech; and\nc)\tthe \"audio\" media type is not restricted from inclusion in an SDP message according to the media type restriction policy as specified in subclause 6.1.1;\nand one of the following is true:\na)\t3GPP PS data off status is \"inactive\";\nb)\t3GPP PS data off status is \"active\", the UE is in the HPLMN or EHPLMN or a subscribed SNPN, and MMTEL voice is a 3GPP PS data off exempt service; or\nc)\t3GPP PS data off status is \"active\", the UE is in a VPLMN or a non-subscribed SNPN, the UE is configured with an indication that MMTEL voice is a 3GPP PS data off roaming exempt service in the VPLMN or MMTEL voice is a 3GPP data off non-subscribed exempt service in the non-subscribed SNPN;\n4)\tif the UE determines that its contact has not been bound to a public user identity using the IP-CAN, such that the contact is expected to be used for the delivery of incoming requests in the IM CN subsystem relating to the media of item 2 and item 3;\n5)\tif the IMSVoPS indicator, provided by the lower layers indicates voice is supported;\n6)\tif the procedures to perform the initial registration are enabled (see 3GPP TS 24.305 [8T]); and\n7)\tif the PDU session used for IMS is:\na)\tavailable; or\nb)\tnot available, and the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message to establish a PDU session with 5GS QoS flow that is needed for performing the initial registration as described in U.2.2.1.\nNOTE 3:\tRegardless of any of the above conditions, a UE might attempt to register with the IM CN subsystem at any time.\nEXAMPLE:\tAs an example of the note, a UE configured to preferably attempt to use the 5GS to access IM CN subsystem can perform an initial registration as specified in subclause 5.1.1.2, if the conditions in items 2, 3, 4, 5, 6 and 7 in this subclause, evaluate to true.\nThe UE indicates to the non-access stratum the status of being available for voice over PS when:\nI)\tthe UE is capable of receiving any (but not necessarily all) of the media types which the CS domain supports, such that the media type can also be used when accessing the IM CN subsystem using:\na)\tthe 5GS IP-CAN via NR;\nb)\tthe 5GS IP-CAN via E-UTRA; or\nNOTE 4:\tThe use of 5GS IP-CAN via E-UTRA can also be the result of an inter-RAT fallback during setup of the IMS voice call. This can occur, for example, when a UE not supporting the media type in 5GS IP-CAN via NR initiates an IMS voice call in 5GS IP-CAN via NR.\nc)\tthe EPS IP-CAN;\nNOTE 5:\tEPS can be used as IP-CAN as the result of an EPS fallback during setup of the IMS voice call. This can occur, for example, when a UE not supporting the media type in 5GS IP-CAN via NR initiates an IMS voice call in 5GS IP-CAN via NR, or when a UE not supporting the media type in 5GS IP-CAN via E-UTRA initiates an IMS voice call in 5GS IP-CAN via E-UTRA.\nII)\tif the media type of item I is an \"audio\" media type, the UE supports codecs suitable for (conversational) speech, the \"audio\" media type is not restricted from inclusion in an SDP message according to the media type restriction policy as specified in subclause 6.1.1; and:\na)\t3GPP PS data off status is \"inactive\";\nb)\t3GPP PS data off status is \"active\", the UE is in the HPLMN, the EHPLMN or a subscribed SNPN, and MMTEL voice is a 3GPP PS data off exempt service; or\nc)\t3GPP PS data off status is \"active\", the UE is in a VPLMN or a non-subscribed SNPN, the UE is configured with an indication that MMTEL voice is a 3GPP PS data off roaming exempt service in the VPLMN or MMTEL voice is a 3GPP PS data off non-subscribed exempt service in the non-subscribed SNPN; and\nIII)\tthe UE determines a contact has been bound to a public user identity using the IP-CAN, such that this contact is expected to be used for the delivery of incoming requests in the IM CN subsystem relating to such media.\nThe UE indicates to the non-access stratum the status of being not available for voice over PS when:\nI)\tin response to receiving the IMSVoPS indicator indicating voice is supported, the UE:\n-\tinitiated an initial registration as specified in subclause 5.1.1.2, received a final response to the REGISTER request sent, but the conditions for indicating the status of being available for voice over PS are not met; or\n-\tdid not initiate an initial registration as specified in subclause 5.1.1.2 and, these conditions for indicating the status of being available for voice over PS are not met; or\nII)\tthe conditions for indicating the status of being available for voice over PS are no longer met.\nNOTE 6:\tThe status of being not available for voice over PS is used for domain selection for UE originating sessions / calls specified in 3GPP TS 23.501 [257] subclause 5.16.3.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.2A\tAvailability for SMS",
                            "text_content": "The UE determines that the UE is able to use SMS using IMS if the UE:\nI)\tis capable of using the MIME type \"application/vnd.3gpp.sms\" (see 3GPP TS 24.341 [8L]), such that the MIME type can also be used when accessing the IM CN subsystem using the current IP-CAN;\nII)\tsupports the role of an SM-over-IP sender (see 3GPP TS 24.341 [8L]);\nIIA)\tdetermines the PDU session used for IMS exists;\nIII)\tdetermines a contact has been bound to a public user identity using the IP-CAN, such that this contact is expected to be used for the delivery of incoming requests in the IM CN subsystem relating to such media; and\nIV)\tthe UE does not determine that SMS over IP is restricted in 3GPP TS 24.341 [8L] subclause 5.2.1.3; and\nV)\tthe 3GPP PS data off status is:\n-\t\"inactive\";\n-\t\"active\", the UE is in the HPLMN, the EHPLMN or a subscribed SNPN, and SMS over IMS is a 3GPP PS data off exempt service; or\n-\t\"active\", the UE is in a VPLMN or a non-subscribed SNPN, the UE is configured with an indication that SMS over IMS is a 3GPP PS data off roaming exempt service in the VPLMN or SMS over IMS is a 3GPP PS data off non-subscribed exempt service in the non-subscribed SNPN.\nWhen above criteria are not met, the UE determines that SMS using IMS is unavailable.\nNOTE:\tThe status that SMS using IMS is unavailable is used for domain selection for UE originating SMS specified in 3GPP TS 23.501 [257] subclause 5.16.3.8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.3\tAuthorization header field",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Upon receiving an INVITE request not including the \"precondition\" option-tag in the Supported header field and not including the \"precondition\" option-tag in the Require header field, and the IP-CAN performs network-initiated resource reservation for the UE, the UE:\n1)\tif the INVITE request contains an SDP offer and the local resources required at the terminating UE for the received SDP offer are not available:\na)\tshall not alert the user; and\nb)\tshall send 183 (Session Progress) response to the INVITE request without waiting for resource reservation and without alerting the user. If the INVITE request includes a Supported header field indicating support of reliable provisional responses, the UE shall send the 183 (Session Progress) response reliably. In the 183 (Session Progres) response, the UE shall include an SDP answer; and\n2)\tif the INVITE request does not contain an SDP offer and the INVITE request includes a Supported header field indicating support of reliable provisional responses:\na)\tshall generate an SDP offer;\nb)\tif the local resources required at the terminating UE for the generated SDP offer are not available:\nA)\tshall not alert the user; and\nB)\tshall reliably send 183 (Session Progress) response to the INVITE request without waiting for resource reservation and without alerting the user. In the 183 (Session Progres) response, the UE shall include the generated SDP offer.\nUpon successful reservation of local resources, if the precondition mechanism is not used by the terminating UE, the UE can send 180 (Ringing) response to the INVITE request and can alert the user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.5\t3GPP PS data off",
                            "text_content": "If the 3GPP PS data off status is \"active\" the UE shall only send initial requests that:\n1)\tare associated with a 3GPP IMS service which enforces 3GPP PS data off;\nNOTE 1:\tThese services are specified in 3GPP TS 22.011 [1C], and enforcement of 3GPP PS data off is described in the respective service specifications.\n2)\tare associated with an emergency service; or\n3)\tare associated with 3GPP PS data off exempt services configured in the UE using one or more of the following methods:\n-\tthe non_3GPP_ICSIs_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G] is not configured;\n-\tthe non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the VPLMN;\n-\tthe non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] is not configured;\n-\tthe non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the VPLMN;\n-\tthe /<X>/SNPN_Configuration/<X>/3GPP_PS_data_off/non_3GPP_ICSIs_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the subscribed SNPN, or if the UE is in a non-subscribed SNPN and the non_3GPP_ICSIs_non-subscribed_exempt node specified in 3GPP TS 24.167 [8G] is not configured; or\n-\tthe non_3GPP_ICSIs_non-subscribed_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in a non-subscribed SNPN.\nIf the UE is configured with both the non_3GPP_ICSIs_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\nIf the UE is configured with both the non_3GPP_ICSIs_roaming_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\nIf the 3GPP PS data off status changes from \"inactive\" to \"active\" the UE shall release all dialogs that\n1)\tare not associated with a 3GPP IMS service which enforces 3GPP PS data off;\nNOTE 2:\tThese services are specified in 3GPP TS 22.011 [1C], and enforcement of 3GPP PS data off is described in the respective service specifications.\n2)\tare not associated with an emergency service; and\n3)\tare not associated with 3GPP data off exempt services configured in the UE using one or more of the following methods:\n-\tthe non_3GPP_ICSIs_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G] is not configured;\n-\tthe non_3GPP_ICSIs_roaming_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in a VPLMN;\n-\tthe non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the VPLMN;\n-\tthe non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the HPLMN or the EHPLMN, or if the UE is in the VPLMN and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] is not configured; or\n-\tthe non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], if the UE is in the VPLMN.\n-\tthe /<X>/SNPN_Configuration/<X>/3GPP_PS_data_off/non_3GPP_ICSIs_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in the subscribed SNPN, or if the UE is in a non-subscribed SNPN and the non_3GPP_ICSIs_non-subscribed_exempt node specified in 3GPP TS 24.167 [8G] is not configured;\n-\tthe non_3GPP_ICSIs_non-subscribed_exempt node specified in 3GPP TS 24.167 [8G], if the UE is in a non-subscribed SNPN.\nIf the UE is configured with both the non_3GPP_ICSIs_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\nIf the UE is configured with both the non_3GPP_ICSIs_roaming_exempt node of 3GPP TS 24.167 [8G] and the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C], then the non_3GPP_ICSIs_roaming_exempt node in the EF3GPPPSDATAOFFservicelist file described in 3GPP TS 31.102 [15C] shall take precedence.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.6\tRLOS",
                            "text_content": "Not applicable.\nWhen a failure occurs in the process of redirecting the UE from NG-RAN to E-UTRAN and the UE is aware of the failure, the UE shall send out a CANCEL request to cancel the INVITE request that includes a Reason header field with a protocol value set to \"RELEASE_CAUSE\" and a \"cause\" header field parameter with the value of \"7\" as specified in subclause 7.2A.18.11.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.8\tUnified Access Control",
                            "text_content": "The following information is provided to the non-access stratum:\n-\tMO-IMS-registration-related-signalling-started; and\n-\tMO-IMS-registration-related-signalling-ended;\nPrior to sending a REGISTER request which is not for emergency registration, the UE sends the MO-IMS-registration-related-signalling-started to the non-access stratum and\na)\tif the barring result is \"not-barred\", continues with registration procedure as described in subclause 5.1.1; and\nb)\tif the barring result is \"barred\", aborts the registration procedure. In this case, upon receiving an indication from the lower layers that the barring is alleviated, the registration procedure may be initiated, if still needed.\nWhen the UE needs to send SUBSCRIBE request for the reg event package, then the UE sends the MO-IMS-registration-related-signalling-started to the non-access stratum before sending SUBSCRIBE request and\na)\tif the barring result is \"not-barred\", continues with subscribe procedure as described in subclause 5.1.1.3; and\nb)\tif the barring result is \"barred\", aborts the subscribe procedure. In this case, upon receiving an indication from the lower layers that the barring is alleviated, the subscribe procedure may be initiated, if still needed.\nWhen a procedure for MO IMS registration related signalling ends, i.e.\n-\ta final response to the REGISTER request which is not for emergency registration is received;\n-\ta final response to the SUBSCRIBE request for the reg event package is received;\n-\ttimer F expires at the UE; or\n-\ta fatal transport error for sending the REGISTER request or the SUBSCRIBE request is reported by the transport layer, as desribed in IETF RFC 3261 [26];\nthe UE sends the MO-IMS-registration-related-signalling-ended to the non-access stratum.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.1.9\tAbnormal cases",
                            "text_content": "Upon sending MO-IMS-registration-related-signalling-started indication to the non-access stratum as described in subclause U.3.1.8, if:\na)\tthe UE receives, from the lower layers, a notification that the service request\n1)\twas not accepted due to congestion; or\n2)\tresulted in starting timer T3525 (see 3GPP TS 24.501 [258]); and\nb)\ta procedure for MO IMS registration related signalling has not ended;\nthen:\na)\tthe UE shall abort the procedure for MO-IMS-registration-related-signalling and send MO-IMS-registration-related-signalling-ended indication to the non-access stratum; and\nb)\tif an alternative radio access network is available, the UE may attempt the procedure for MO-IMS-registration-related signalling on the alternative radio access network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "U.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "U.3.2.0\tRegistration and authentication",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "If the P-CSCF is configured to handle emergency requests, in order to determine from which network the request was originated the P-CSCF shall check the  and  fields received:\n-\tduring the registration procedure from the Rx interface as defined in 3GPP TS 29.214 [13D] (e.g. used for deployments without IMS-level roaming interfaces where the P-CSCF is located in the home network); or\n-\tfrom the P-Access-Network-Info header field.\nNOTE:\tThe above check can be against more than one  code stored in the P-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.2.2\tLocation information handling",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.2.3\tProhibited usage of PDU session for emergency services",
                            "text_content": "If the P-CSCF detects that a UE uses a PDU session for emergency services for a non-emergency REGISTER request, the P-CSCF shall reject that request by a 403 (Forbidden) response.\nNOTE:\tBy assigning specific IP address ranges for a PDU session for emergency bearer services and configuring those ranges in P-CSCF, the P-CSCF can detect based on the registered Contact address if UE uses an emergency PDU session for initial registration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.2.4\tSupport for paging policy differentiation",
                            "text_content": "The P-CSCF may support paging policy differentiation by marking packet(s) to be sent towards the UE related to that IMS capability. A specific  (IPv4) value and/or a specific Traffic Class (IPv6) value are assigned by local configuration in the P-CSCF.\nIf local policy requires to provide such marking, the P-CSCF shall identify terminating requests which:\na)\tcontain SDP with an \"audio\" media line and which are related to a IMS multimedia telephony service session specified in 3GPP TS 24.173 [8H]; or\nb)\tdo not contain an SDP offer but some ication, e.g. a feature capability icator, icates that an \"audio\" media line that would meet network policy for such differentiation, could form part of the subsequent SDP offer.\nNOTE 1:\tPrecise details of such indications, if any, are subject to operator policy. Alternatively the operator policy can be to not preferentially page requests without an SDP offer.\nFor such identified requests:\na)\twhere an unreliable transport mechanism is used as the transport protocol for SIP, the P-CSCF shall mark packets containing an INVITE request; and\nb)\tif a reliable transport mechanism is used as the transport protocol for SIP:\n1)\tif a new reliable transport connection needs to be established, the P-CSCF shall turn on the marking of packets within the reliable transport connection in advance of sending an INVITE request; and\n2)\tif there is an existing reliable transport connection, the P-CSCF may turn on the marking of packets within the reliable transport connection in advance of sending an INVITE request.\nIn both these cases for a reliable transport connection, the P-CSCF shall turn off the marking of packets within the reliable transport connection at an appropriate time.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.2.6\tResource sharing",
                            "text_content": "This feature is not supported in this release.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.2.7\tPriority sharing",
                            "text_content": "This feature is not supported in this release.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.2.8\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.2.9\tSupport of ANBR and RAN-assisted codec adaptation",
                            "text_content": "If the network supports ANBR as specified in 3GPP TS 26.114 [9B] and RAN-assisted codec adaptation as specified in 3GPP TS 38.300 [270] and 3GPP TS 38.321 [271], then the P-CSCF might be configured to indicate ANBR support.\nIf the P-CSCF is configured to indicate ANBR support, when the P-CSCF receives the 200 (OK) response to the REGISTER request the P-CSCF shall include the \"g.3gpp.anbr\" feature-capability indicator in the Feature-Caps header field of the 200 (OK) response to the REGISTER request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "U.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "U.3.3.1\tNotification of AS about registration status",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "U.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "U.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "U.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "U.5\tUse of circuit-switched domain",
            "description": "There is no CS domain in this access technology.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "V.1\tScope",
            "description": "The present annex defines the HTTP messages and data types sent over reference points specified in the present document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "V.2\tMs reference point",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "V.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Ms reference point is used to request signing of an Identity header field or request verification of a signed assertion in an Identity header field.\nHTTP POST method is used for the verification request.\nHTTP 200 (OK) is used when the AS for verification has successfully processed the verification request.\nHTTP POST method is used for the signing request.\nHTTP 200 (OK) is used when the AS for signing has successfully processed the signing request.\nHTTP POST method is used for the diversion signing request.\nHTTP 200 (OK) is used when the AS for signing has successfully processed the diversion signing request.\nHTTP POST method is used for the Resource-Priority header field signing request.\nHTTP 200 (OK) is used when the AS for signing has successfully processed the Resource-Priority header field signing request.\nHTTP POST method is used for the Resource-Priority and Priority header fields signing request.\nHTTP 200 (OK) is used when the AS for signing has successfully processed the Resource-Priority and Priority header field signing request.\nThe figure depicts the usage of the Ms reference point in a 5G network, illustrating how it is used to measure the signal strength at the receiver. The Ms reference point is a crucial component in 5G technology, enabling accurate signal measurements and improving network performance.\nFigure V.2.1-1: Usage of the Ms reference point\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "V.2.2\tResource structure",
                    "description": "",
                    "summary": "",
                    "text_content": "API resources are defined with respect to a \"server root\". The server root is a URI:\n-\t{hostname}:{port}/{RoutingPath},\nThe resource URI structure is:\nThe figure depicts a resource structure for the resource exposed over the Ms reference point, illustrating the various components and their relationships.\nFigure V.2.2-1: Resource structure for the resource exposed over the Ms reference point\nNOTE:\tv1 is the version number of the API.\nTable V.2.2-1: Variables for the server root\n\n",
                    "tables": [
                        {
                            "description": "Table V.2.2-1: Variables for the server root",
                            "table number": 472,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "V.2.3\tRequest requirements",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "V.2.3.1\tGeneral",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "V.2.3.2 Request header requirements",
                            "text_content": "Table V.2.3.2-1 lists request header field requirements.\nTable V.2.3.2-1: Header fields included in the requests\n\nThe JSON object in a request starts with the name of the request.\nFor the signingRequest, the JSON object starts with:\n{\n\"signingRequest\": {\nFor the verificationRequest, the JSON object starts with:\n{\n\"verificationRequest\": {\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table V.2.3.2-1: Header fields included in the requests",
                                    "table number": 473,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "V.2.4\tResponse requirements",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "V.2.4.1\tGeneral",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "V.2.4.2\tResponse header requirements",
                            "text_content": "Table V.2.4.2-1: Header fields included in the responses\n\nThe JSON object in a response starts with the name of the response.\nFor the signingResponse, the JSON object starts with:\n{\n\"signingResponse\": {\nFor the verificationResponse, the JSON object starts with:\n{\n\"verificationResponse\": {\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table V.2.4.2-1: Header fields included in the responses",
                                    "table number": 474,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "V.2.4.3\tError response requirements",
                            "text_content": "If the server cannot process the request, the server provides an HTTP error response. The error response contains a JSON object specifying the error type.\nThe server provides a service error when the server is unable to process the request.\nThe server provides a policy error when the server is able to process the request, but not able to complete the service execution due to a policy restriction.\nTable V.2.4.3.2-1:\tService failure descriptions\n\nTable V.2.4.3.3-1:\tPolicy failure descriptions\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table V.2.4.3.2-1:\tService failure descriptions",
                                    "table number": 475,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table V.2.4.3.3-1:\tPolicy failure descriptions",
                                    "table number": 476,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "V.2.5\tsigning",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "V.2.5.1\tGeneral",
                            "text_content": "To construct a PASSporT SHAKEN object specified in RFC 8588 [261], a PASSporT rph object specified in RFC 8443 [279] and RFC 9027 [278], or a PASSporT div object, specified in RFC 8946 [265], the client sends an HTTP POST request to the AS for signing containing the SIP request information plus any additional claim information to be signed by the target PASSporT type. If the request was successfully processed, then the received signingResponse contains an Identity header field value populated with a signed PASSporT of the requested type along with the appropriate Identity header field parameters.\nUnsuccessful requests are responded with an HTTP 4xx or 5xx response.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "V.2.5.2\tData types",
                            "text_content": "Table V.2.5.2-1 specifies the data types included in the signing request. The signing request contains the claims included in:\n-\ta PASSporT SHAKEN JSON Web Token, specified in RFC 8588 [261];\n-\ta PASSporT div JSON Web Token specified in RFC 8946 [265]; or\n-\ta PASSporT rph JSON Web Token specified in RFC 8443 [279] and RFC 9027 [278].\nTable V.2.5.2-1:\tData types for the signingRequest\n\nThe signing request provides the following two options for identifying the PASSporT type to be constructed:\n-\tthe PASSporT type is indicated by invoking the signing resource associated with that PASSporT type, as defined in subclause V.2.2; or\n-\tthe PASSporT type is identified by including a ppt parameter when invoking the /signing resource defined in subclause V.2.2.\nTable V.2.5.2-1a indicates representative signingRequest parameter inclusion rules per PASSporT type.\nTable V.2.5.2-1a:\tsigningRequest parameters per PASSporT Type\n\n\nTable V.2.5.2-2 further specifies the data types contained in the signing request parameters.\nTable V.2.5.2-2:\tData types for the signingRequest parameters\n\nTable V.2.5.2-3 specifies the data types included in the signing response.\nTable V.2.5.2-3:\tData types for the signingResponse\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table V.2.5.2-1:\tData types for the signingRequest",
                                    "table number": 477,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table V.2.5.2-1a:\tsigningRequest parameters per PASSporT Type",
                                    "table number": 478,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table V.2.5.2-2:\tData types for the signingRequest parameters",
                                    "table number": 479,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table V.2.5.2-3:\tData types for the signingResponse",
                                    "table number": 480,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "V.2.6\tverification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "V.2.6.1\tGeneral",
                            "text_content": "To verify one or more received PASSporTs, the client sends a verification request in the form of an HTTP POST request to the AS for verification containing the Identity header field(s) populated with the PASSporT object(s) to be verified. The verification request also contains the following information:\n-\tthe originating identity and optionally all the  diverting identities; and/or\n-\tthe Resource-Priority header field value and optionally the header field value \"psap-callback\" of the Priority header field.\nThe verificationResponse contains the outcome of the verification in a verstat claim with values as specified for the verstat tel URI parameter in subclause 7.2A.20 and in a verstatPriority claim with values as specified for the Priority-Verstat header field in subclause 7.2.21. The verificationResponse can optionally contain the claims of PASSporT(s) that passed verification.\nThe verificationResponse can also contain verification results information for each verified PASSporT, as follows:\n-\tif verification passed, then verificationResponse contains the validated claims of the PASSporT;\n-\tif verification failed, then verificationResponse contains information describing the reason for the failure.\nUnsuccessful requests are responded with an HTTP 4xx or 5xx response.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "V.2.6.2\tData types",
                            "text_content": "Table V.2.6.2-1 specifies the data types included in the verification request.\nTable V.2.6.2-1:\tData types for the verificationRequest\n\nInvocation of the verification request results in the verification of the Identity header fields in the identityHeader and identityHeaders parameters. In addition, a verification request invocation can verify the integrity of SIP header fields protected by the \"div\" and \"rph\" PASSporTs. When verification of SIP header field integrity is required, the protected SIP header field(s) information shall be conveyed in the protectedHeaders parameter.\nThe dest parameter is included when the verification request includes a div claim, and when the verification service is required to distinguish between a legitimately retargeted request and a maliciously replayed request.\nTable V.2.6.2-1a indicates representative inclusion rules for the verification request identityHeader and identityHeaders parameters for the different combinations of PASSporT types to be verified.\nTable V.2.6.2-1a:\tVerification request identityHeader and identityHeaders parameter inclusion rules\n\nTable V.2.6.2-2 specifies the data types included in the verification response.\nTable V.2.6.2-2:\tData types for the verificationResponse\nTable V.2.6.2-3 specifies the mandatory data types of the verifyResult parameter included in the verification response.\nTable V.2.6.2-3:\tData types for mandatory verifyResult parameters\n\nEach verifyResult entry of the verifyResults array conveys the verification results of an Identity header field contained in the identityHeader parameter or contained in an entry of the identityHeaders array of the verification request.\nAdditional verifyResult parameters are returned based on the value of the status parameter as follows:\n-\ta status parameter with a value of \"fail\" returns the parameters shown in table V.2.6.2-4;\n-\ta status parameter with a value of \"pass\" returns the parameter shown in table V.2.6.2-5; and\n-\ta status parameter with a value of \"none\" returns no additional parameters.\nA status parameter with a value of \"none\" indicates that the PASSporT type is not supported.\nTable V.2.6.2-4 specifies the optional data types of the verifyResult parameter included in the verification response.\nTable V.2.6.2-4:\tData types of optional verifyResult parameters\n\n\nTable V.2.6.2-5 specifies the additional data types included in the verification response when the status parameter contains a value of \"pass\".\nTable V.2.6.2-5:\tData types of additional verifyResults parameter for status of \"pass\"\n\nThe validClaims parameter can be used:\n-\tto verify the integrity of SIP header field information associated with the validated claims, where a mismatch results in a verification failure; or\n-\tto ensure that SIP header field contents contain the information authorized by the validated claims, where a mismatch is resolved by updating the SIP header field to match the validated claims.\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table V.2.6.2-1:\tData types for the verificationRequest",
                                    "table number": 481,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table V.2.6.2-1a:\tVerification request identityHeader and identityHeaders parameter inclusion rules",
                                    "table number": 482,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table V.2.6.2-2:\tData types for the verificationResponse",
                                    "table number": 483,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table V.2.6.2-3:\tData types for mandatory verifyResult parameters",
                                    "table number": 484,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table V.2.6.2-4:\tData types of optional verifyResult parameters",
                                    "table number": 485,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table V.2.6.2-5:\tData types of additional verifyResults parameter for status of \"pass\"",
                                    "table number": 486,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "W.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for a call control protocol for use in the IM CN subsystem based on the Session Initiation Protocol (SIP), and the associated Session Description Protocol (SDP), where the IP-CAN is the 5GCN via Wireless Local Access Network (WLAN).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "W.2\tIP-CAN aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "W.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE accessing the IM CN subsystem, and the IM CN subsystem itself, utilise the services provided by the 5GCN and the WLAN to provide packet-mode communication between the UE and the IM CN subsystem.\nRequirements for the UE on the use of these packet-mode services are specified in this clause.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "W.2.2\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "W.2.2.1\tEstablishment of IP-CAN bearer and P-CSCF discovery",
                            "text_content": "NOTE:\tThe UE performs access network discovery and selection procedures as specified in 3GPP TS 24.502 [263] and executes access authentication signalling as described in 3GPP TS 24.502 [263] prior to perform the procedure to obtain a local IP address;\nThe UE handles an IP-CAN bearer for SIP signalling as follows:\n1)\tthe UE shall obtain a local IP address;\n2)\tthe UE shall establish an IKEv2 security association and an IPsec  security association as described in 3GPP TS 24.502 [263]; and\n3)\tthe IKEv2 security association and the IPsec  security association (tunnel) shall remain active throughout the period the UE is connected to the IM CN subsystem, i.e. from the initial registration and at least until the deregistration; and\nIn addition the procedures specified in Annex U.2.2.1 apply\nThe UE may support the policy on when a UE is allowed to transfer a PDU session providing access to IMS between 5GC via non-3GPP access and 5GS as specified in subclause U.2.1.1. If the UE is in a session and the policy indicates \"a UE having an ongoing IMS session, is not allowed to transfer the PDU session providing access to IMS between 5GCN via non-3GPP access and 5GCN via NG-RAN\" or if the UE is roaming when in a session and the policy indicates \"a UE roaming in a VPLMN and having an ongoing IMS session, is not allowed to transfer the PDU session providing access to IMS between 5GCN via non-3GPP access and 5GCN via NG-RAN\" the UE shall not handover the PDU session providing access to IMS from 5GC via non-3GPP access to 5GS.\nIf the UE is in a seesion in the EPS IP-CAN and the policy indicates \"a UE is not allowed to transfer a PDU session providing access to IMS, if any, between 5GCN via non-3GPP access and 5GCN via NG-RAN\" or the UE is roaming in an EPS IP-CAN and the policy indicates \"a UE roaming in a VPLMN and having an ongoing IMS session, is allowed to transfer the PDU session providing access to IMS between 5GCN via non-3GPP access and 5GCN via NG-RAN\" the UE shall, if not prevented by other rules or policies, handover the PDU session providing access to IMS from 5GC via non-3GPP access to 5GS.\nIf the UE is in a 5GS IP-CAN and the policy indicates \"a UE is not allowed to transfer a PDU session providing access to IMS, if any, between 5GCN via non-3GPP access and 5GCN via NG-RAN, irrespective of if the UE has an ongoing IMS session or not\" or the UE is roaming in a 5GS IP-CAN and the policy indicates \"a UE roaming in a VPLMN is not allowed to transfer a PDU session providing access to IMS, if any, between 5GCN via non-3GPP access and 5GCN via NG-RAN, irrespective of if the UE has an ongoing IMS session or not\" the UE shall not handover the PDU session providing access to IMS from 5GC via non-3GPP access to 5GS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.2.2.1A\tModification of an IP-CAN used for SIP signalling",
                            "text_content": "The procedures specified in Annex U.2.2.1A apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.2.2.1B\tRe-establishment of the IP-CAN used for SIP signalling",
                            "text_content": "The procedures specified in Annex U.2.2.1B apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.2.2.1C\tP-CSCF restoration procedure",
                            "text_content": "The procedures specified in Annex U.2.2.1C apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.2.2.2\tSession management procedures",
                            "text_content": "The procedures specified in Annex U.2.2.2 apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.2.2.3\tMobility management procedures",
                            "text_content": "The procedures specified in Annex U.2.2.3 apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.2.2.4\tCell selection and lack of coverage",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.2.2.5\t5GS QoS flow for media",
                            "text_content": "NOTE 1:\tDuring establishment of a session, the UE establishes data streams(s) for media related to the session. Either the UE or the network can request for resource allocations for media, but the establishment and modification of the 5GS QoS flow is controlled by the network as described in 3GPP TS 24.501 [258].\nIf the resource allocation is initiated by the UE, the UE starts reserving resources whenever it has sufficient information about the media streams, and used codecs available as specified in 3GPP TS 24.501 [258] and 3GPP TS 24.502 [263].\nNOTE 2:\tIf the resource reservation requests are initiated by the network, then the establishment of 5GS QoS flow for media is initiated by the network after the P-CSCF has authorised the respective 5GS QoS flows and provided the QoS requirements to the PCF.\nIf the UE is configured not to initiate resource allocation for media according to 3GPP TS 24.167 [8G], then the UE shall refrain from requesting additional 5GS QoS flow(s) for media until the UE considers that the network did not initiate resource allocation for the media.\nIf the UE receives an activation request from the network for a 5GS QoS flow for media which is associated with the 5GS QoS flow used for signalling, the UE shall correlate the media 5GS QoS flow with a currently ongoing SIP session establishment or SIP session modification.\nIf the UE receives a modification request from the network for a 5GS QoS flow that is used for one or more media streams in an ongoing SIP session, the UE shall:\n1)\tmodify the related PDU session context in accordance with the request received from the network.\nWhen a data stream for media related to a session is released, if the 5GS QoS flow transporting the data stream is no longer needed and allocation of the 5GS QoS flow was requested by the UE, then the UE releases the 5GS QoS flow.\nNOTE:\tThe 5GS QoS flow can be needed e.g. for other data streams of a session or for other applications in the UE.\nThe procedures specified in Annex U.2.2.5.2 apply.\nNot applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.2.2.6\tEmergency service",
                            "text_content": "Emergency session is supported over the WLAN access if the UE has failed or has not been able to use 3GPP access to set up an emergency session as described in 3GPP TS 23.167 [4B] annex L. IMS emergency session is also supported for UEs with unavailable IMSI (i.e. a UE without USIM) or unauthenticated IMSI.\nSome jurisdictions allow emergency calls to be made when the UE does not contain an ISIM or USIM, or where the credentials are not accepted.\nThe UE determines that the 5GCN supports emergency services via WLAN when the Emergency service support for non-3GPP (EMCN3) access indicator in the REGISTRATION ACCEPT message indicates emergency services are supported over non-3GPP access as defined in subclause 9.11.3.5 of 3GPP TS 24.501 [258].\nWhen the UE is registered over a WLAN access and detects an emergency call attempt, if the UE supports the emerg-non3gpp timer defined in table 7.8.1 and has determined that 5GCN supports emergency services via WLAN the UE shall start the emerg-non3gpp timer when starting a domain selection searching for a 3GPP access usable to establish an emergency call. The UE shall stop the timer when a 3GPP access supporting emergency call is found. When the emerg-non3gpp timer expires the UE shall consider that it has failed to use 3GPP access to setup the emergency call and shall attempt to setup the emergency call over the available WLAN access.\nThe UE may support being configured for the emerg-non3gpp timer using one or more of the following methods:\na)\tthe Timer_Emerg_non3gpp leaf of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe Timer_Emerg_non3gpp leaf of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe Timer_Emerg_non3gpp leaf of 3GPP TS 24.167 [8G].\nWhen the IM CN subsystem is selected as the domain for the emergency call attempt, the UE determines whether it is currently attached to its home operator's network (e.g. HPLMN) or not (e.g. VPLMN) after it has determined that the 5GCN supports emergency services via WLAN.\nTo perform emergency registration, the UE shall request to establish an emergency PDU session as described in 3GPP TS 24.501 [258]. The procedures for PDU session establishment and P-CSCF discovery, as described in subclause W.2.2.1 of this specification apply accordingly.\nIf the ME is equipped with a UICC, in order to find out whether the UE is attached to the home PLMN or to the visited PLMN, the UE shall compare the  and  values derived from its  with the  and  of the PLMN the UE is attached to. If the MCC and  of the PLMN the UE is attached to do not match with the  and  derived from the , then for the purposes of emergency calls in the IM CN subsystem the UE shall consider to be attached to a VPLMN. If the ME is not equipped with a UICC, the procedure to find d out whether the UE is attached to the home PLMN or to the visited PLMN for the purpose of emergency calls in the IM CN subsystem, is implementation specific.\nNOTE:\tThe UE verifies if a detected emergency number is still present in the Extended Local Emergency Number List applicable to the PLMN it is currently using. It is possible for the number to no longer be present in the Extended Local Emergency Number List if:\n-\tthe PLMN attached to relies on the Local Emergency Number List for deriving a URN; or\n-\tthe previously received Extended Emergency Number List Validity field indicated \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\".\nIf the UE detected an emergency number, the UE subsequently uses a different PLMN than the PLMN from which the UE received the last Extended Local Emergency Number List, the dialled number is not stored in the ME, in the USIM and in the Local Emergency Number List, and:\n-\tthe REGISTRATION ACCEPT message received from the different PLMN contains the Extended Local Emergency Number List and the emergency number is present in the updated Extended Local Emergency Number List then the UE uses the updated Extended Local Emergency Number List when it performs the procedures in subclause W.2.2.6.1B; and\n-\tthe REGISTRATION ACCEPT message received from the different PLMN contains no Extended Local Emergency Number List or the emergency number is no longer present in the updated Extended Local Emergency Number List then the UE shall attempt UE procedures for SIP that relate to emergency using emergency service URN \"urn:service:sos\".\nIf the dialled number is equal to a local emergency number stored in the Extended Local Emergency Number List (as defined in 3GPP TS 24.301 [8J]), then the UE shall recognize such a number as for an emergency call and:\n-\tif the dialled number is equal to an emergency number stored in the ME, or in the USIM, then the UE shall perform either procedures in the subclause W.2.2.6.1B or the procedures in subclause W.2.2.6.1A; and\n-\tif the dialled number in not equal to an emergency number stored in the ME, or in the USIM, then the UE shall perform procedures in the subclause W.2.2.6.1B.\nIf the dialled number is not equal to a local emergency number stored in the Extended Local Emergency Number List (as defined in 3GPP TS 24.301 [8J]) and:\n-\tif the dialled number is equal to an emergency number stored in the ME, in the USIM or in the Local Emergency Number List (as defined in 3GPP TS 24.008 [8]), then the UE shall recognize such a number as for an emergency call and performs the procedures in subclause W.2.2.6.1A.\nOnce IPsec tunnel setup is completed, the UE shall follow the procedures described in subclause W.2.2.1 of this specification for establishment of IP-CAN bearer and P-CSCF discovery accordingly.\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.2A.1.1 and subclause 5.1.3.1, if:\n-\tthe 380 (Alternate Service) response contains a Contact header field;\n-\tthe value of the Contact header field is a service URN; and\n-\tthe service URN has a top-level service type of \"sos\";\nthen the UE determines that \"emergency service information is included\" as described 3GPP TS 23.167 [4B].\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.3.1, if the 380 (Alternate Service) response does not contain a Contact header field with service URN that has a top-level service type of \"sos\", then the UE determines that \"no emergency service information is included\" as described 3GPP TS 23.167 [4B].\nUpon reception of a 380 (Alternative Service) response to an INVITE request as defined in subclause 5.1.2A.1.1 and subclause 5.1.3.1, the UE shall proceed as follows:\n1)\tif a 3GPP access network is available and the UE has not already attempted to use a 3GPP access network to set up an emergency session as described in 3GPP TS 23.167 [4B] annex L, when the UE selects a domain in accordance with the conventions and rules specified in 3GPP TS 22.101 [1A] and 3GPP TS 23.167 [4B], the UE shall attempt to select a domain of the 3GPP access network, and:\n-\tif the CS domain is selected, the UE behaviour is defined in subclause 7.1.2 of 3GPP TS 23.167 [4B] and in annex B; and\n-\tif the IM CN subsystem is selected, the UE shall apply the procedures in subclause 5.1.6 with the exception of selecting a domain for the emergency call attempt;\nIn addition, when the UE determines that \"it has not been able to use 3GPP access to set up an emergency session\" in accordance with subclause L.1 of 3GPP TS 23.167 [4B], the UE shall apply the procedures in subclause 5.1.6 using WLAN, with the exception of selecting a domain for the emergency call attempt; and\n2)\tif a 3GPP access network is not available, then the UE shall apply the procedures in subclause 5.1.6 using WLAN, with the exception of selecting a domain for the emergency call attempt.\nWhen the emergency registration expires, the UE should disconnect the emergency PDU session.\nAnnex U.2.2.6.1A applies.\nAnnex U.2.2.6.1B applies.\nThe UE shall not send an INVITE request with Request-URI set to \"urn:service:sos.ecall.manual\" or \"urn:service:sos.ecall.automatic\".\nThe UE may support the current location discovery during an emergency call specified in subclause 5.1.6.8.2, subclause 5.1.6.8.3, subclause 5.1.6.8.4, and subclause 5.1.6.12.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "W.2A\tUsage of SDP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "W.2A.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "W.2A.1\tImpact on SDP offer / answer of activation or modification of IP-CAN for media by the network",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures specified in Annex U.2A.1 apply.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "W.2A.2\tHandling of SDP at the terminating UE when originating UE has resources available and IP-CAN performs network-initiated resource reservation for terminating UE",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "W.2A.3\tEmergency service",
                    "description": "",
                    "summary": "",
                    "text_content": "No additional procedures defined.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "W.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "W.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "W.3.1.0\tRegistration and authentication",
                            "text_content": "The procedures specified in Annex U.3.1.0 apply with the following clarification:\n-\tthe UE shall perform reregistration of a previously registered public user identity bound to any one of its contact addresses when changing to an IP-CAN for which usage is specified in annex U or annex L.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.0a\tIMS_Registration_handling policy",
                            "text_content": "The IMS_Registration_handling policy indicates whether the UE deregisters from IMS after a configured amount of time after receiving an indication that the IMS Voice over PS Session is not supported.\nThe UE may support the IMS_Registration_handling policy.\nIf the UE supports the IMS_Registration_handling policy, the UE may support being configured with the IMS_Registration_handling policy using one or more of the following methods:\na)\tthe IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C];\nb)\tthe IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.103 [15B]; and\nc)\tthe IMS_Registration_Policy node of 3GPP TS 24.167 [8G].\nIf the UE is configured with both the IMS_Registration_Policy node of 3GPP TS 24.167 [8G] and the IMS_Registration_Policy node of the EFIMSConfigData file described in 3GPP TS 31.102 [15C] or 3GPP TS 31.103 [15B], then the IMS_Registration_Policy node of the EFIMSConfigData file shall take precedence.\nNOTE 1:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [15B].\nIf the UE is registered with IMS and the IMSVoPS indicator, provided by the lower layers (see 3GPP TS 24.501 [258]), indicates voice is not supported, the UE shall:\nA)\tif the Stay_Registered_When_VoPS_Not_Supported leaf indicates requirement to stay registered, the UE needs not to deregister and maintains the registration as required for IMS services; or\nNOTE 2:\tThe UE will periodically refresh the registration when needed.\nB)\tif the Stay_Registered_When_VoPS_Not_Supported leaf indicates requirement to deregister and the Deregistration_Timer leaf used to configure the NoVoPS-dereg timer defined in table 7.8.1 contains a timer value for the time to wait before deregistrerting from IMS, start a timer with the value indicated in the policy and:\na)\tif the timer expires before the UE receives an indication from the lower layers that IMS voice is supported:\n1)\tif there is no ongoing IMS session, the UE either performs reregistration as specified in subclause 5.1.1.4 and shall only include feature tags associated with services that are independent of IMSVoPS indicator or deregister from the IMS following the procedures specified in subclause 5.1.1.6; or\n2)\tif there is ongoing IMS session, and\ni)\tif the UE does not receive indication from the lower layer that the IMS voice is supported before the ongoing IMS session is terminated, the UE either performs reregistration as specified in subclause 5.1.1.4 and shall only include feature tags associated with services that are independent of IMSVoPS indicator or deregister from the IMS following the procedures specified in subclause 5.1.1.6 as soon as the ongoing IMS based service is terminated; or\nii)\tif the UE receives indication from the lower layer that the IMS voice is supported before the ongoing IMS session is terminated, cancel the timer; or\nNOTE 3:\tHow the UE selects reregistration or deregistration is implementation dependent (e.g., SMS service)\nb)\tif the UE receives an indication from the lower layers that IMS voice is supported before the timer expires, cancel the timer.\nIf the IMS_Registration_handling policy is not configured, the UE behaviour is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.1\tP-Access-Network-Info header field",
                            "text_content": "The UE shall always include the P-Access-Network-Info header field where indicated in subclause 5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.1A\tCellular-Network-Info header field",
                            "text_content": "The UE:\n1)\tusing the 5GCN via Wireless Local Access Network (WLAN) as IP-CAN to access the IM CN subsystem; and\n2)\tsupporting one or more cellular radio access technology (e.g. NR);\nshall always include the Cellular-Network-Info header field specified in subclause 7.2.15, if the information is available, in every request or response in which the P-Access-Network-Info header field is present.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.2\tAvailability for calls",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.2A\tAvailability for SMS",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.3\tAuthorization header field",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.4\tSIP handling at the terminating UE when precondition is not supported in the received INVITE request, the terminating UE does not have resources available and IP-CAN performs network-initiated resource reservation for the terminating UE",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.5\t3GPP PS data off",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.6\tTransport mechanisms",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.1.7\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "W.3.2\tProcedures at the P-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "W.3.2.0\tRegistration and authentication",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.2.1\tDetermining network to which the originating user is attached",
                            "text_content": "The procedures specified in Annex U.3.2.1 apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.2.2\tLocation information handling",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.2.3\tProhibited usage of PDU session for emergency bearer services",
                            "text_content": "The procedures specified in Annex U.3.2.3 apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.2.4\tSupport for paging policy differentiation",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.2.5\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.2.6\tResource sharing",
                            "text_content": "The feature is not supported in this release of the specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.2.7\tPriority sharing",
                            "text_content": "The feature is not supported in this release of the specificaiton\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.2.8\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "W.3.3\tProcedures at the S-CSCF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "W.3.3.1\tNotification of AS about registration status",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "W.3.3.2\tRLOS",
                            "text_content": "Not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "W.4\t3GPP specific encoding for SIP header field extensions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "W.4.1\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "W.5\tUse of circuit-switched domain",
            "description": "Void.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "X.1\tScope",
            "description": "This annex describes support for SBA for IMS nodes.\nIMS nodes can use the SBA interfaces described in the present Annex as an alternative to the Diameter Rx and Cx and Sh reference points and Mr'/Cr reference points based on configuration. To support co-existence of IMS nodes supporting SBA services and IMS nodes not supporting SBA services SBI, enabled IMS nodes can support both SBI and non-SBI interfaces.\nWhile the main body of the present document only describes usage of Diameter Rx and Cx and Sh reference points and Mr'/Cr reference points, the usage of the equivalent SBA services is a valid option.\nNOTE 1:\tThis version of the specification does not specify the details for usage of SBIs by P-CSCF, S-CSCF, I-CSCF and AS in the main body of the specification.\nNOTE 2:\tThis annex is intended to be used in conjunction with 5GC, see Annex U and Annex W.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "X.2\tReference points to support SBA in IMS",
            "description": "The following IMS related reference points are realized by service-based interfaces:\n-\tN5: Reference point between the PCF and an AF.\nNOTE 1:\tThe P-CSCF acts as an AF from the PCF point of view. The N5 Reference point is defined in 3GPP TS 23.501 [257] and the related protocol specification is in 3GPP TS 29.514 [273]. It provides equivalent functionality to the Diameter-based Rx reference point.\n-\tN70: Reference point between an SBI capable I/S-CSCF and an SBI capable HSS.\nNOTE 2:\tThe N70 Reference point is defined in 3GPP TS 23.228 [7] and the related protocol specification is in 3GPP TS 29.562 [274]. It provides equivalent functionality to the Diameter-based Cx reference point.\n-\tN71: Reference point between an SBI capable IMS AS and an SBI capable HSS.\nNOTE 3:\tThe N71 Reference point is defined in 3GPP TS 23.228 [7] and the related protocol specification is in 3GPP TS 29.562 [274]. It provides equivalent functionality to the Diameter-based Sh reference point.\n-\tDC2: Reference point between an SBI capable IMS AS and MF.\nNOTE 4:\tThe DC2 Reference point is defined in 3GPP TS 23.228 [7] and the related protocol specification is in 3GPP TS 29.176 [298].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "X.3\tServices to support SBA in IMS",
            "description": "If a P-CSCF uses the Npcf_PolicyAuthorization service, it will apply Npcf_PolicyAuthorization service operations (defined in 3GPP TS 29.514[273]) instead of Rx procedures (defined in 3GPP TS 29.214[13D]) and will interact with the PCF instead of the PCRF.\n-\tNpcf_PolicyAuthorization: This service is provided by the PCF. This service is to authorise an AF request and to create policies as requested by the authorized AF for the PDU Session to which the AF session is bound. This service also allows the NF service consumer to subscribe/unsubscribe the notification of events.\nNOTE 1:\tThe P-CSCF acts as an AF from the PCF point of view. The Npcf_PolicyAuthorization service is defined in 3GPP TS 23.502 [275] and the related protocol specification is in 3GPP TS 29.514 [273]. It provides equivalent functionality to the Diameter-based Rx reference point.\nIf an I-CSCF or an S-CSCF uses the Nhss_ims services, it will apply Nhss_ims service operations instead of Cx procedures mentioned throughout the present document and will interact with an SBI capable HSS.\n-\tNhss_imsUEContextManagement: This service is provided by an SBI capable HSS. It enables service operations related to the management of a UE context.\n-\tNhss_imsSubscriberDataManagement: This service is provided by an SBI capable HSS. It enables service operations related to subscriber data management.\n-\tNhss_imsUEAuthentication: This service is provided by an SBI capable HSS. It enables a service operation related to the authentication between the end user and the home IMS network.\nNOTE 2:\tThe Nhss_imsUEContextManagement, Nhss_imsSubscriberDataManagement, and Nhss_imsUEAuthentication services are defined in annex AA of 3GPP TS 23.228 [7] and the related protocol specification is in 3GPP TS 29.562 [274]. They provide equivalent functionality to the Diameter-based Cx and Sh reference point.\nNOTE 3:\tThe Nhss_imsUEAuthentication service is not consumed by I-CSCF.\nNOTE 4:\tThe Nhss_imsUEAuthentication and Nhss_imsUEContextManagement services are not consumed by AS.\nIf an I-CSCF or an S-CSCF uses the Nnrf_NFDiscovery service, it will apply Nnrf_NFDiscovery service operations instead of Cx procedures mentioned throughout the present document and will interact with an SBI capable NRF.\nNOTE 5:\tThe Nnrf_NFDiscovery service is defined in 3GPP TS 23.502 [275] and the related protocol specification is in 3GPP TS 29.510 [288].\nIf an IMS AS uses MF services, it will apply Nmf service operations (defined in 3GPP TS 29.176 [298]).\n-\tNmf_MediaResourceManagement (MRM): This service is provided by an MF. It enables an IMS AS to create, update and delete media resources related to IMS Data Channel.\n\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "",
                    "table number": 487,
                    "summary": "",
                    "name": ""
                },
                {
                    "description": "",
                    "table number": 488,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        }
    ]
}