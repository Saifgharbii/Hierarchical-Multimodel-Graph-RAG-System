{
    "document_name": "24502-i40.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document specifies non-3GPP access network discovery and selection procedures, the access authorization procedure used for accessing non-3GPP access networks. These non-3GPP access networks can be trusted non-3GPP access networks, untrusted non-3GPP access networks or wireline access networks.\nThe present document also specifies the security association management procedures used for establishing IKEv2 and IPsec security associations:\n-\tbetween the UE and the N3IWF and the procedures for transporting messages between the UE and the N3IWF over the non-3GPP access networks; and\n-\tbetween the UE and the TNGF and the procedures for transporting messages between the UE and the TNGF over the non-3GPP access networks.\nThe present document also specifies the EAP-5G procedures used for exchange of NAS messages via trusted non-3GPP access before the UE is authenticated and authorized to use the trusted non-3GPP access.\nThe present document is applicable to the UE, the 5G-RG, the W-AGF acting on behalf of the FN-RG or the W-AGF acting on behalf of the N5GC device and the network. In this technical specification the network refers to the 3GPP 5GCN and the trusted non-3GPP access, untrusted non-3GPP access, or wireline access network.\nNOTE 1:\tThe present document is not applicable to the FN-RG.\nNOTE 2:\tThe W-AGF acting on behalf of the FN-BRG, accessing an SNPN is not defined in the present version of the present document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[3]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[4]\t3GPP TS 24.501: \"Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[4A]\t3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS); Stage 3\".\n[5]\t3GPP TS 33.501: \"Security architecture and procedures for 5G System\".\n[6]\tIETF RFC 7296: \"Internet Key Exchange Protocol Version 2 (IKEv2)\".\n[7]\t3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via non-3GPP access networks; Stage 3\".\n[8]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[9]\tIETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".\n[10]\t3GPP TS 33.402: \"3GPP System Architecture Evolution (SAE); Security aspects of non-3GPP accesses.\"\n[11]\tIETF RFC 4303: \"IP Encapsulating Security Payload (ESP)\".\n[12]\tIETF RFC 4301: \"Security Architecture for the Internet Protocol\".\n[13]\t3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile Station (MS) in idle mode\".\n[14]\tIETF RFC 2784: \"Generic Routing Encapsulation (GRE)\".\n[15]\tIETF RFC 2890: \"Key and Sequence Number Extensions to GRE\".\n[16]\t3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System\".\n[17]\t3GPP TS 24.526: \"User Equipment (UE) policies for 5G System (5GS); Stage 3\".\n[18]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[19]\tIEEE Std 802.11-2016: \"IEEE Standard for Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Specific requirements - Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".\n[20]\tWi-Fi Alliance: \"Hotspot 2.0 (Release 2) Technical Specification, version 1.0.0\", 2014-08-08.\n[21]\tITU-T Recommendation E.212: \"The international identification plan for public networks and subscriptions\", 2016-09-23.\n[22]\t3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General aspects\".\n[23]\tIETF RFC 4555: \"IKEv2 Mobility and Multihoming Protocol (MOBIKE)\".\n[24]\tIETF RFC 791: \"INTERNET PROTOCOL\".\n[25]\tIETF RFC 8200: \"Internet Protocol, Version 6 (IPv6) Specification\".\n[26]\tIETF RFC 2474: \"Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers\".\n[27]\tIETF RFC 793: \"Transmission Control Protocol\".\n[28]\t3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core network protocols; Stage 3\".\n[29]\t3GPP TS 38.413: \"NG Application Protocol (NGAP)\".\n[30]\tIEEE Std 802.1X™-2010: \"IEEE Standard for Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Port-based Network Access Control\".\n[31]\tIETF RFC 4284 (January 2006): \"Identity Selection Hints for the Extensible Authentication Protocol (EAP)\".\n[32]\tIETF RFC 1661: \"The Point-to-Point Protocol (PPP)\".\n[33]\tIETF RFC 1570: \"PPP LCP Extensions\".\n[34]\tIETF RFC 2410: \" The NULL Encryption Algorithm and Its Use With IPsec\".\n[35]\t3GPP TS 31.102: \"Characteristics of the Universal Subscriber Identity Module (USIM) application\".\n[36]\tCableLabs WR-TR-5WWC-ARCH-V02-200430: \"5G Wireless Wireline Converged Core Architecture Technical Report\".\n[37]\tIETF RFC 7542: \"The Network Access Identifier\".\n[38]\t3GPP TS 24.368: \"Non-Access Stratum (NAS) configuration Management Object (MO)\".\n[39]\t3GPP TS 29.413: \"Application of the NG Application Protocol (NGAP) to non-3GPP access\".\n[40]\t3GPP TS 23.316: \"Wireless and wireline convergence access support for the 5G System (5GS)\".\n[41]\t3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System (5GS); Stage 2\".\n[42]\tBBF TR-456 issue 2 (March 2022): \"AGF Functional Requirements\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\nSNPN access operation mode for 5G NSWO: A UE operating in SNPN access operation mode for 5G NSWO only selects SNPNs for 5G NSWO. The UE using 5G NSWO authenticates using credentials in the selected entry of \"list of subscriber data\" or using credentials in the USIM, if PLMN subscription is selected.\nMTU: Maximum transmission unit (MTU) is the largest PDU size which can be transmitted and received by a network entity in one single IP packet without any need for IP fragmentation.\nNWt: NWt is the reference point between the UE and the TNGF for establishing secure tunnel(s) between the UE and the TNGF so that control-plane and user-plane exchanged between the UE and the 5G core network is transferred securely over trusted non-3GPP access.\nNWu: NWu is the reference point between the UE and the N3IWF for establishing secure tunnel(s) between the UE and the N3IWF so that control-plane and user-plane exchanged between the UE and the 5G core network is transferred securely over untrusted non-3GPP access.\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.501 [2] apply:\n5G Access Network\n5G Core Network\n5G NSWO\n5G QoS flow\n5G QoS identifier\n5G System\n5G-RG\nCredentials Holder (CH)\nFN-RG\nNetwork identifier (NID)\nPDU Session\nStand-alone Non-Public Network\nON-SNPN\nTNGF\nW-AGF\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.003 [8] apply:\nGlobal Line Identifier (GLI)\nGlobal Cable Identifier (GCI)\nNAI\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 33.501 [5] apply:\nSUPI\nSUCI\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.302 [7] apply:\nS2a connectivity\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.501 [4] apply:\nNon 5G capable over WLAN (N5CW) device\nSNPN access operation mode\nW-AGF acting on behalf of the N5GC device\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.316 [40] apply:\nAuthenticable Non-3GPP device (AUN3)\nNon-Authenticable Non-3GPP device (NAUN3)\nWireline access control plane protocol (W-CP)\nWireline access user plane protocol (W-UP)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.122 [13] apply:\nRegistered SNPN\nSubscribed SNPN\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\n5GCN\t5G Core Network\n5GS\t5G System\n5G-AN\t5G Access Network\n5G-RG\t5G Residential Gateway\n5QI\t5G QoS Identifier\nAMF\tAccess and Mobility Management Function\nAN\tAccess Network\nANDS\tAccess Network Discovery and Selection\nANDSP\tAccess Network Discovery and Selection Policy\nANQP\tAccess Network Query Protocol\nAUSF\tAuthentication Server Function\nCH\tCredentials Holder\nCP\tControl Plane\nCRG\tCable Residential Gateway\nDHCP\tDynamic Host Configuration Protocol\nDL\tDownlink\nDNS\tDomain Name System\nDSCP\tDifferentiated Services Code Point\nePDG\tEvolved Packet Data Gateway\nESP\tEncapsulating Security Payload\nFN-BRG\tFixed Network Broadband Residential Gateway\nFN-CRG\tFixed Network Cable Residential Gateway\nFN-RG\tFixed Network Residential Gateway\nFQDN\tFully Qualified Domain Name\nH-PCF\tA PCF in the HPLMN\nIP\tInternet Protocol\nIPsec\tInternet Protocol Security\nMPS\tMultimedia Priority Service\nN3AN\tNon-3GPP Access Network\nN3IWF\tNon-3GPP InterWorking Function\nN5CW\tNon 5G Capable over WLAN\nN5GC\tNon-5G Capable\nNAI\tNetwork Access Identifier\nNAPTR\tNaming Authority Pointer\nNAS\tNon Access Stratum\nNID\tNetwork Identifier\nNSWO\tNon-Seamless WLAN Offload\nNSWOF\tNon-Seamless WLAN Offload Function\nPCF\tPolicy control Function\nPDU\tProtocol Data Unit\nQFI\tQoS Flow Identifier\nRQI\tReflective QoS Indicator\nSA\tSecurity Association\nSNPN\tStand-alone Non-Public Network\nSPI\tSecurity Parameters Index\nSSID\tService Set Identifier\nSUPI\tSubscription Permanent Identifier\nSUCI\tSubscription Concealed Identifier\nTCP\tTransmission Control Protocol\nTNAN\tTrusted Non-3GPP Access Network\nTNAP\tTrusted Non-3GPP Access Point\nTNGF\tTrusted Non-3GPP Gateway Function\nTWAN\tTrusted WLAN Access Network\nTWAP\tTrusted WLAN Access Point\nTWIF\tTrusted WLAN Interworking Function\nUL\tUplink\nUP\tUser Plane\nUPF\tUser Plane Function\nV-PCF\tA PCF in the VPLMN\nW-AGF\tWireline Access Gateway Function\nWLAN\tWireless Local Area Network\nWLANSP\tWLAN Selection Policy\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tGeneral",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "The 5G core network (5GCN) supports the connectivity of the UE via non-3GPP access networks. These non-3GPP access networks can be trusted non-3GPP access networks, untrusted non-3GPP access networks or wireline access networks. A trusted or untrusted non-3GPP access network can advertise the PLMNs for which it supports trusted connectivity and the type of supported trusted connectivity. Different types of trusted connectivity can be advertised so that the UE can discover the non-3GPP access networks that can provide trusted connectivity to one or more PLMNs:\na)\tinformation about PLMN list with 5G connectivity using trusted non-3GPP access;\nb)\tinformation about PLMN list with 5G connectivity without NAS using trusted non-3GPP access;\nc)\tinformation about PLMN list with S2a connectivity using trusted non-3GPP access (access via non-3GPP access to EPC); or\nd)\tinformation about SNPN list with 5G connectivity using trusted non-3GPP access.\nNOTE 1:\tA wireline access network does not indicate PLMNs or SNPNs for which it supports connectivity.\nIn wireline access, the 5G-RG can provide connectivity for:\na)\ta UE behind the 5G-RG to access the 5GCN via untrusted non-3GPP access network or trusted non-3GPP access network;\nNOTE 2:\tFor a UE behind the 5G-RG, the 5G-RG can also be connected to the 5GC through 3GPP access, i.e. not only through wireline access.\nb)\t an AUN3 device behind the 5G-RG to access the 5GCN via wireline access network; and\nc)\tan NAUN3 device behind the 5G-RG to access the 5GCN via wireline access.\nNOTE 3:\tFor an NAUN3 device behind the 5G-RG, the 5G-RG can also be connected to the 5GC through 3GPP access, i.e. not only through wireline access.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tUntrusted access",
                    "description": "",
                    "summary": "",
                    "text_content": "For an untrusted non-3GPP access network, the communication between the UE and the 5GCN is not trusted to be secure.\nFor an untrusted non-3GPP access network, to secure communication between the UE and the 5GCN, a UE establishes secure connection to the 5G core network over untrusted non-3GPP access via the N3IWF. The UE performs registration to the 5G core network during the IKEv2 SA establishment procedure as specified in 3GPP TS 24.501 [4] and IETF RFC 7296 [6]. After the registration, the UE supports NAS signalling with 5GCN using the N1 reference point as specified in 3GPP TS 24.501 [4]. The N3IWF interfaces the 5GCN CP function via the N2 interface to the AMF and the 5GCN UP functions via N3 interface to the UPF as described in 3GPP TS 23.501 [2].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.3\tIdentities",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.3.1\tUser identities",
                            "text_content": "When the UE accesses the 5GCN over non-3GPP access networks, the same permanent identities for 3GPP access are used to identify the subscriber for non-3GPP access authentication, authorization and accounting services.\nThe Subscription Permanent Identifier (SUPI) is defined in 3GPP TS 33.501 [5]. The SUPI can contain an IMSI, a network specific identifier, a GCI or a GLI as specified in 3GPP TS 23.501 [2]. A SUPI containing an IMSI is defined in 3GPP TS 23.003 [8]. A SUPI containing a network specific identifier, a GCI or a GLI always takes the form of a NAI as defined in 3GPP TS 23.003 [8].\nThe Subscription Concealed Identifier (SUCI) is a privacy preserving identifier containing the concealed SUPI as specified in 3GPP TS 33.501 [5]. SUCI is calculated from SUPI. When the SUPI contains an IMSI, the corresponding SUCI is derived as specified in 3GPP TS 23.003 [8]. When the SUPI contains a network specific identifier, a GCI or a GLI, the corresponding SUCI in NAI format is derived as specified in 3GPP TS 23.003 [8].\nUser identification in non-3GPP accesses can require additional identities that are out of the scope of 3GPP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.2\tFQDN for N3IWF Selection",
                            "text_content": "An N3IWF FQDN is either provisioned by the home operator or constructed by the UE in:\na)\tthe Operator Identifier FQDN format or the Tracking Area Identity FQDN format; or\nb)\tthe Prefixed Operator Identifier FQDN format or the Prefixed Tracking Area Identity FQDN format if the UE is configured with slice-specific N3IWF prefix configuration,\nas specified in clause 6.3.6.2 in 3GPP TS 23.501 [2].\nThe N3IWF FQDN for onboarding services in SNPN is pre-configured in the UE to select an N3IWF to register the onboarding SNPN via untrusted non-3GPP access.\nThe detailed format of the N3IWF FQDN is specified in clause 28.3.2.2 of 3GPP TS 23.003 [8].\nThe N3IWF FQDN is used as input to the DNS mechanism for N3IWF selection.\nIn order to access PLMN services via an SNPN, a UE operating in SNPN access operation mode registered to an SNPN has the following restrictions on N3IWF FQDN:\na)\tthe UE shall only use TAIs from a PLMN to construct a Tracking Area Identity based N3IWF FQDN; and\nb)\tthe UE shall not consider an N3IWF FQDN for N3IWF selection configured by an SNPN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.4\tQuality of service support",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.4.1\tGeneral",
                            "text_content": "When the UE accesses the 3GPP 5G System (5GS) via non-3GPP access networks, the same QoS flow based 5G QoS model and principles are followed as described in 3GPP TS 23.501 [2]. For PDU sessions that were established over non-3GPP access, the QoS flow remains to be the finest granularity of QoS differentiation in the PDU Session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.2\tQoS differentiation in non-3GPP access",
                            "text_content": "For untrusted non-3GPP access, the N3IWF is the access network node that provides QoS signalling to support QoS differentiation and mapping of QoS flows to non-3GPP access resources.\nFor trusted non-3GPP access, the TNGF is the access network node that provides QoS signalling to support QoS differentiation and mapping of QoS flows to non-3GPP access resources.\nFor wireline access, the W-AGF serving the 5G-RG is the access network node that provides QoS signalling to support QoS differentiation and mapping of QoS flows to non-3GPP access resources. For QoS differentiation in the non-3GPP access network behind the 5G-RG, 5G-RG provides QoS signalling to support QoS differentiation and mapping of QoS flows to non-3GPP access resources behind the 5G-RG.\nA QoS flow is controlled by the SMF and can be preconfigured, or established via the UE requested PDU Session establishment via non-3GPP access procedure, the UE or network requested PDU session modification via non-3GPP access procedure (see 3GPP TS 23.502 [3]).\nDuring PDU session establishment, based on local policies, pre-configuration and the QoS profiles received:\na)\tthe N3IWF or the TNGF (depending on whether the UE is connected to untrusted non-3GPP access or trusted non-3GPP access, respectively):\n1)\tshall determine the number of IPsec child SAs to establish and the QoS profiles associated with each IPsec child SA; and\n2)\tshall then initiate IPsec SA creation procedure to establish child SAs associating to the QoS flows of the PDU session; or\nb)\tthe W-AGF serving the 5G-RG:\n1)\tshall determine the number of W-UP resources to establish and the QoS profiles associated with each W-UP resource; and\n2)\tshall initiate creation of one or more W-UP resources using means out of scope of the present document. The W-AGF serving the 5G-RG shall associate each W-UP resource with a PDU session, zero or more QFIs, and optionally an indication of whether the W-UP resource is the default W-UP resource. For each W-UP resource, the 5G-RG becomes aware using means out of scope of the present document about association of the W-UP resource and the PDU session, the zero or more QFIs, and optionally the indication of whether the W-UP resource is the default W-UP resource; or\nDuring PDU session establishment procedure or PDU session modification procedure as specified in 3GPP TS 24.501 [4], the 5G-RG may use the Authorized QoS flow descriptions and the N3QAI to reserve the resources in the non-3GPP access network behind the 5G-RG.\nNOTE:\tHow the 5G-RG reserves the resources in the non-3GPP access network behind the 5G-RG is out of scope of this specification.\nIn order to support QoS differentiation in the case of access to PLMN services via an SNPN and access to SNPN services via a PLMN, the N3IWF is preconfigured with one or more QoS profiles requiring a dedicated IPsec child SA which can be associated with a DSCP value.\nIn order to support QoS differentiation in the case of access to PLMN services via 5G ProSe layer-3 UE-to-network relay with N3IWF as specified in clause 5.6.2.2 of 3GPP TS 23.304 [41], the N3IWF is preconfigured with one or more QoS profiles requiring a dedicated IPsec child SA which can be associated with a DSCP value.\nIn order to support QoS differentiation in the case of access to PLMN services via a WLAN, the N3IWF and TNGF behaviour is as specified in clause 4.4.2.3, with one or more QoS profiles requiring an IPsec child SA which can be associated with a downlink DSCP value determined by taking into account, according to operator policy, the establishment cause, the 5QI, the Priority Level (if explicitly signalled) and optionally, the ARP priority level.\nFor uplink of trusted and untrusted non-3GPP accesses, the UE associates an uplink user data packet with a QFI as specified in 3GPP TS 24.501 [4]. In both cases of untrusted non-3GPP access and trusted non-3GPP access, the UE shall then encapsulate the uplink user data packet and the QFI associated with the uplink user data packet in the GRE header and select IPsec child SA based on PDU session and QFI associated with the uplink user data packet as specified in clause 8.3. In case of trusted non-3GPP access, the UE shall reserve non-3GPP access network QoS resources for the IPsec child SA according to the received Additional QoS Information when the selected IPsec child SA is established. In case of untrusted non-3GPP access, the UE may receive an Additional QoS Information from the N3IWF during IPsec child SA establishment. If the UE receives the Additional QoS Information from the N3IWF, the UE may reserve non-3GPP access network QoS resources for the IPsec child SA according to the received Additional QoS Information when the selected IPsec child SA is established.\nFor uplink of wireline access, the 5G-RG associates an uplink user data packet with a QFI as specified in 3GPP TS 24.501 [4], shall select a W-UP resource based on the PDU session and the QFI associated with the uplink user data as specified in clause 8.3 and shall transport the uplink user data packet via the selected W-UP resource using means out of scope of the present specification.\nFor downlink of trusted and untrusted non-3GPP accesses, the UPF maps the user data packet to a QoS flow. In case of untrusted non-3GPP access, the N3IWF shall determine the IPsec child SA to use for sending of the downlink user data packet over NWu based on mapping of the QoS flow to the IPsec child SA based on QFI of the QoS flow of the user data packet and the identity of the PDU session of the user data packet. In case of trusted non-3GPP access, the TNGF shall determine the IPsec child SA to use for sending of the downlink user data packet over NWt based on mapping of the QoS flow to the IPsec child SA based on QFI of the QoS flow of the user data packet and the identity of the PDU session of the user data packet. Furthermore, TNGF may reserve non-3GPP access network QoS resources for the IPsec child SA.\nFor downlink of wireline access, the UPF maps the user data packet to a QoS flow. In case of wireline access, the W-AGF serving the 5G-RG shall select a W-UP resource for a downlink user data packet based on mapping of the QoS flow to the W-UP resources, based on QFI of the QoS flow of the user data packet and the identity of the PDU session of the user data packet, and shall transport the downlink user data packet and the QFI associated with the downlink user data packet via the selected W-UP resource using means out of scope of the present specification.\nFor QoS differentiation in the non-3GPP access network behind the 5G-RG, if the network during PDU session establishment or PDU session modification procedure provides the QoS rules, the network may additionally provide Non-3GPP QoS Assistance Information (N3QAI) for each QoS flow to aid in reserving resources in the non-3GPP access network behind the 5G-RG. How the 5G-RG uses the Authorized QoS flow descriptions to reserve the resources in the non-3GPP access network behind the 5G-RG, is out of scope of this specification.\nReflective QoS is also supported when the UE accesses the 5GCN via non-3GPP access network as specified in 3GPP TS 23.502 [3]. If the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access receives a downlink user packet associated with Reflective QoS Indicator (RQI), the N3IWF or the TNGF shall set the RQI in the GRE header when encapsulating the downlink user data packet into a GRE encapsulated user data packet as specified in clause 8.3. If the W-AGF serving the 5G-RG receives a downlink user packet associated with Reflective QoS Indicator (RQI), the W-AGF shall transport the RQI together with the downlink user data packet and the QFI associated with the downlink user data packet via the selected W-UP resource over NWu, as described in clause 4.4.2.3.\nIf the UE is provided with maximum flow bit rate (MFBR) for UL for a QFI as specified in 3GPP TS 24.501 [4], the UE should send user data packets associated with the QFI with a bitrate lower than or equal to the maximum flow bit rate (MFBR) for UL.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.5\tTrusted access",
                    "description": "",
                    "summary": "",
                    "text_content": "For a trusted non-3GPP access network, the communication between the UE and the 5GCN is secure. A trusted non-3GPP access network is connected to the 5GCN via a trusted non-3GPP gateway function (TNGF) as specified in 3GPP 23.501 [2]. The TNGF interfaces the 5GCN CP function via the N2 interface to the AMF and the 5GCN UP functions via N3 interface to the UPF as described in 3GPP TS 23.501 [2].\nFor a trusted non-3GPP access network, the UE establishes secure connection to the 5GCN over trusted non-3GPP access to the TNGF. The UE uses 3GPP-based authentication for connecting to a non-3GPP access and establishes an IPsec Security Association (SA) with the TNGF in order to register to the 5GCN by using the registration procedure as specified in 3GPP TS 24.501 [4]. After the registration, the UE supports NAS signalling with the 5GCN using the N1 reference point as specified in 3GPP TS 24.501 [4].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.6\tForbidden PLMNs for non-3GPP access to 5GCN",
                    "description": "",
                    "summary": "",
                    "text_content": "A list of \"forbidden PLMNs for non-3GPP access to 5GCN\" contains a list of VPLMNs, 5GCN of which the UE is forbidden to access via non-3GPP access.\nThe HPLMN (if the equivalent HPLMN list is not present or is empty) or an equivalent HPLMN (if equivalent HPLMN list is present) shall not be stored on the list of \"forbidden PLMNs for non-3GPP access\".\n3GPP TS 24.501 [4] specifies when a VPLMN is added to the list of \"forbidden PLMNs for non-3GPP access to 5GCN\".\nWhen the UE is configured to use timer T3245 (see 3GPP TS 24.368 [38] or 3GPP TS 31.102 [35]), the UE adds a PLMN identity to the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" and timer T3245 (see 3GPP TS 24.008 [28]) is not running, then the UE shall start timer T3245 as specified in 3GPP TS 24.008 [28], clause 4.1.1.6.\nIf the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" is stored in a non-volatile memory in the ME together with the SUPI from the USIM, this list can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory; else the UE shall delete this list.\nA VPLMN is removed from the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" if:\n-\tthere is a successful registration as specified in 3GPP TS 24.501 [4] over a non-3GPP access after a manual selection of the VPLMN for non-3GPP access connected to 5GCN;\n-\tthe UE is not configured to use timer T3245, and the value of the PLMN-specific attempt counter for non-3GPP access for the PLMN has a value greater than zero and less than the UE implementation-specific maximum value as defined in clause 5.3.20 in 3GPP TS 24.501 [4] and T3247 expires;\n-\tupon expiry of the timer T3245 if the UE is configured to use timer T3245; or\n-\tthe UE is not configured to use timer T3245, and the value of the PLMN-specific attempt counter for non-3GPP access for the PLMN has a value greater than zero and less than the UE implementation-specific maximum value as defined in clause 5.3.20 in 3GPP TS 24.501 [4] when the MS is switched off or the UICC containing the USIM is removed.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "5\tNetwork discovery and selection",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The following aspects are included when selecting a 5GC network and routing traffic via the 5GC network:\na)\taccess network discovery procedures as defined in clause 5.2;\nb)\taccess network selection procedures as defined in clause 5.3; and\nc)\taccess network reselection procedures as defined in clause 5.4.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tAccess network discovery procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tGeneral",
                            "text_content": "When the UE is not operating in SNPN access operation mode, if PLMN selection specified in 3GPP TS 23.122 [13] is applicable (e.g., at switch-on, recovery from lack of 3GPP coverage, or user selection of applicable 3GPP access technology), the PLMN selection to select the highest priority PLMN according to these specifications is performed before any access network discovery.\nWhen the UE is operating in SNPN access operation mode over non-3gpp access, if SNPN selection specified in 3GPP TS 23.122 [13] is applicable (e.g., at switch-on, recovery from lack of 3GPP coverage, or user selection of applicable 3GPP access technology), the SNPN selection to select a highest priority SNPN according to these specifications is performed before any access network discovery.\nIn the access network discovery procedure, the UE can get ANDSP information on available access networks in its vicinity and can use this information when determining the presence of operator preferred access networks. Determination of the presence of access networks requires using radio access specific procedures, which are not further described here.\nNOTE:\tThe procedure for the automatic mode WLAN selection by using ANDSP rules as defined in clause 5.3.2.3 does not apply to an N5CW device that is not registered or cannot register via NG-RAN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tDiscovering availability of WLAN access networks",
                            "text_content": "The UE may obtain WLAN Selection Policy (WLANSP) rules information by pre-configuration or by downloading the policy information from the PCF as specified in 3GPP TS 23.503 [16]. The policy contains the UE access network discovery and selection related policy information to help the UE in discovering and selecting a WLAN access network (see 3GPP TS 24.526 [17]).\nThe UE may receive multiple valid WLANSP rules from PLMNs to be used when not operating in SNPN access operation mode. When the UE is in the home PLMN, the UE uses the valid WLANSP rules from the home PLMN to select an available WLAN. When the UE is roaming and the UE has valid rules from several of the home PLMN, a visited PLMN and a PLMN equivalent to the visited PLMN, the UE uses the WLANSP rules in the following order of decreasing priority:\na)\tthe valid WLANSP rules from the visited PLMN;\nb)\tthe valid WLANSP rules from the equivalent PLMN in which the UE last received WLANSP; and\nc)\tthe valid WLANSP rules from the home PLMN.\nThe UE may be provisioned with multiple valid WLANSP rules to be used when operating in SNPN access operation mode over non-3gpp access:\na)\tpre-configured from the subscribed SNPN or CH with AAA server and stored in the selected entry of the \"list of subscriber data\", if selected or HPLMN (associated with the PLMN subscription, if selected);\nb)\treceived from the PCF of the subscribed SNPN associated with the selected entry of the \"list of subscriber data\" if selected) or HPLMN (associated with the PLMN subscription, if selected); or\nc)\treceived from the PCF of a non-subscribed SNPN.\nIf the UE is in the subscribed SNPN, the UE uses the valid WLANSP rules from the subscribed SNPN. If the UE is in a non-subscribed SNPN and has valid WLANSP rules both from:\na)\tthe subscribed SNPN, the CH with AAA server or the HPLMN; and\nb)\tthe non-subscribed SNPN;\nthe UE uses the WLANSP rules in the following order of decreasing priority:\na)\tthe valid WLANSP rules from the non-subscribed SNPN; and\nb)\tthe valid WLANSP rules from the subscribed SNPN, the CH with AAA server or the HPLMN.\nA WLANSP rule is valid if it meets the validity conditions included in the WLANSP rule (if provided).\nThe UE may apply the techniques specific to the WLAN access technologies to discover available WLAN access networks. Such techniques will not be further described here.\nIn addition, the UE may obtain information on operator preferred WLAN access networks via ANDSP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3\tAccess network selection procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tGeneral",
                            "text_content": "In this release of the specification, only selection of WLAN access network is supported. The ANDSP policy contains WLANSP rules for the UE to select a WLAN access network. Rules for selecting other types of non-3GPP access networks are not specified.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.2\tWLAN selection procedure",
                            "text_content": "The purpose of the WLAN selection procedure is to create a prioritized list of selected WLAN(s).\nThe UE shall perform WLAN selection based on the user preferences and WLANSP rules. The UE may be provisioned with WLANSP rules from multiple PLMNs to be used when not operating in SNPN access operation mode.\nThe UE may be provisioned with multiple WLANSP rules to be used when operating in SNPN access operation mode over non-3gpp access.\na)\tpre-configured from the subscribed SNPN or CH with AAA server and stored in the selected entry of the \"list of subscriber data\", if selected or HPLMN (associated with the PLMN subscription, if selected);\nb)\treceived from the PCF of the subscribed SNPN associated with the selected entry of the \"list of subscriber data\" if selected) or HPLMN (associated with the PLMN subscription, if selected); or\nc)\treceived from the PCF of a non-subscribed SNPN.\nUser preferences take precedence over the WLANSP rules.\nThe user preferences are used to select between the automatic WLAN selection procedure or the manual WLAN selection procedure:\na)\tif user preferences are present, the UE shall determine the prioritized list of selected WLAN(s) using the manual mode WLAN selection procedure (see clause 5.3.2.2); or\nb)\tif user preferences are not present or if there is no user-preferred WLAN access network available, the UE shall determine the prioritized list of selected WLAN(s) using the automatic mode WLAN selection procedure (see clause 5.3.2.3).\nThe UE creates a prioritized list of available WLAN(s). The creation of the prioritized list is implementation specific.\nThe UE shall first determine valid WLANSP rules for WLAN selection.\nIf the UE is not operating in SNPN access operation mode:\na)\tif the UE is not roaming over 3GPP access, the UE shall use the valid WLANSP rules from the HPLMN; or\nb)\tif the UE is roaming over 3GPP access, the UE may have valid WLANSP rules from several of the visited PLMN, a PLMN equivalent to the visited PLMN and the home PLMN. The UE uses the WLANSP rules in the following order of decreasing priority:\n1)\tthe valid WLANSP rules from the visited PLMN;\n2)\tthe valid WLANSP rules from the equivalent PLMN in which the UE last received WLANSP; and\n3)\tthe valid WLANSP rules from the home PLMN.\nIf the UE is operating in SNPN access operation mode over non-3gpp access:\na)\tthe UE shall select one entry in the \"list of subscriber data\", if any, or the PLMN subscription, if any, to be used for automatic mode WLAN selection. How the UE selects the entry in the \"list of subscriber data\" or the PLMN subscription is UE implementation specific;\nb)\tthe UE uses the valid WLANSP rules:\n1)\tpre-configured from the subscribed SNPN or CH with AAA server and stored in the selected entry of the \"list of subscriber data\", if selected or HPLMN (associated with the PLMN subscription, if selected);\n2)\treceived from the PCF of the subscribed SNPN associated with the selected entry of the \"list of subscriber data\" if selected) or HPLMN (associated with the PLMN subscription, if selected); or\n3)\treceived from the PCF of a non-subscribed SNPN;\nc)\tif the UE is in the subscribed SNPN, the UE shall use the valid WLANSP rules from the subscribed SNPN; and\nd)\tif the UE is in a non-subscribed SNPN and has valid WLANSP rules both from:\n1)\tthe subscribed SNPN, the CH with AAA server or the HPLMN; and\n2)\tthe non-subscribed SNPN;\nthe UE shall use the WLANSP rules in the following order of decreasing priority:\n1)\tthe valid WLANSP rules from the non-subscribed SNPN; and\n2)\tthe valid WLANSP rules from the subscribed SNPN, the CH with AAA server or the HPLMN.\nThe UE shall then determine the selected WLAN(s) according to the following steps:\na)\tuse the procedures specified in the IEEE 802.11 [19] to discover the available WLANs. The UE may perform ANQP procedures as specified in the IEEE 802.11 [19] or the Hotspot 2.0 [20] to discover the attributes and capabilities of available WLANs. If the UE supports ANQP procedures, the UE may send an ANQP request for lists of service providers (i.e. ANQP-elements “Domain Name”, see IEEE 802.11 [19]), PLMN identities or SNPN identities or both (i.e. ANQP-element \"3GPP Cellular Network\", see 3GPP TS 24.302 [7] annex H); and\nb)\tif the UE has performed ANQP procedures to discover the attributes and capabilities of available WLANs, compare the attributes and capabilities of the available WLANs with the group of selection criteria of the valid WLANSP rules and construct a prioritized list of available WLANs that fulfill the selection criteria.\n1)\twhen there are multiple valid WLANSP rules the UE evaluates the valid WLANSP rules in priority order. The UE evaluates first if an available WLAN access meets the selection criteria of the highest priority valid WLANSP rule. The UE then evaluates if an available WLAN access meets the selection criteria of the next priority valid WLANSP rule;\nNOTE 1:\tEach WLANSP rule can include one or more groups of selection criteria in priority order. If there are multiple highest priority groups of selection criteria in the valid WLANSP rule, it is up to the UE implementation which one to use.\n2)\tif the Home network ind bit is not set to \"1\" in the group of selection criteria (see 3GPP TS 24.526 [17]), the WLAN(s) that match the group of selection criteria with the highest priority are considered as the most preferred WLANs, the WLAN(s) that match the group of selection criteria with the second highest priority are considered as the second most preferred WLANs;\n3)\tif the Home network ind bit is set to \"1\" in the group of selection criteria (see 3GPP TS 24.526 [17]), then the UE shall create a list of available WLANs and shall apply the group of selection criteria to all the WLANs in this list. A WLAN is included in this list, if\ni)\tthe other selection criteria in the active WLANSP rule are met; and\nii)\tthe UE is not operating in SNPN access operation mode and the UE received a lists of service providers (i.e. ANQP-elements \"Domain Name\") and PLMN identities (i.e. ANQP-element \"3GPP Cellular Network\"), and:\nI)\tif the list with PLMNs that can be selected from the WLAN (see 3GPP TS 24.302 [7]) includes:\nA)\tthe HPLMN derived from its IMSI; or\nB)\ta PLMN matching an entry in the UE's list of equivalent PLMNs; or\nII)\tif the domain name list (see IEEE 802.11 [19]) includes:\nA)\tthe home domain name derived from its IMSI; or\nB)\tthe domain name derived from its list of equivalent PLMNs; and\niii)\tthe UE is operating in SNPN access operation mode over non-3gpp access and the UE received a lists of service providers (i.e. ANQP-elements \"Domain Name\") and SNPN identities (i.e. ANQP-element \"3GPP Cellular Network\"), and:\nI)\tif the UE is registered over 3GPP access and the list with SNPNs that can be selected from the WLAN (see 3GPP TS 24.302 [7]) includes the registered SNPN;\nII)\tif the UE is not registered over 3GPP access and the list with SNPNs that can be selected from the WLAN (see 3GPP TS 24.302 [7]) includes an SNPN identity of the subscribed SNPN in the selected entry of the \"list of subscriber data\" or associated with the PLMN subscription; or\nIII)\tif the domain name list (see IEEE 802.11 [19]) includes the home network domain of an SNPN identity as defined in TS 23.003 [16] clause 28.2 included in the selected entry of the \"list of subscriber data\" or associated with the PLMN subscription;\nNOTE 2:\tIf the Home network ind bit is set to \"1\" in a group of selection criteria then this group of selection criteria is not expected to include the preferred roaming partner list and the preferred SSID list.\nNOTE 3:\tWLAN advertises PLMN(s) towards which the AAA connectivity to EPC or the S2a connectivity is supported by using the ANQP-element \"3GPP Cellular Network\" with the PLMN List IE or the PLMN List with S2a Connectivity IE in the payload (see annex H in 3GPP TS 24.302 [7]).\nNOTE 4:\tWLAN advertises SNPN(s) towards which the 5G connectivity using trusted non-3GPP access is supported by using the ANQP-element \"3GPP Cellular Network\" with the SNPN List with trusted 5G connectivity IE or the SNPN List with trusted 5G connectivity-without-NAS IE in the payload (see annex H in 3GPP TS 24.302 [7]). The SNPN List with trusted 5G connectivity-without-NAS IE is only used by N5CW devices.\nNOTE 5:\tWLAN advertises PLMN(s) towards which the 5G connectivity using trusted non-3GPP access or the AAA connectivity to 5GC is supported by using the ANQP-element \"3GPP Cellular Network\" with the PLMN List with trusted 5G connectivity IE, the PLMN List with trusted 5G connectivity-without-NAS IE or PLMN List with AAA connectivity to 5GC IE in the payload (see annex H in 3GPP TS 24.302 [7]). The PLMN List with trusted 5G connectivity-without-NAS IE is only used by N5CW devices.\nNOTE 6:\tIf the UE selects a PLMN over WLAN included in both the PLMN List with S2a Connectivity IE and the PLMN List with trusted 5G connectivity IE, the UE requests the PLMN with trusted 5G connectivity (see clause 6.3.12.2 in 3GPP TS 23.501 [2]).\niv)\tthe UE is in SNPN access operation mode for 5G NSWO, the UE received the List of SNPNs with AAA connectivity to 5GC via WLAN (see 3GPP TS 24.302 [7]) and:\nI)\tthe UE is registered over 3GPP access and the List of SNPNs with AAA connectivity to 5GC received via the WLAN includes the registered SNPN;\nII)\tthe List of SNPNs with AAA connectivity to 5GC received via the WLAN includes an SNPN identity of the subscribed SNPN in the selected entry of the \"list of subscriber data\"; or\nIII)\tthe UE supports access to an SNPN using credentials from a credentials holder and the List of SNPNs with AAA connectivity to 5GC received via the WLAN includes an SNPN identity of any one of:\n-\tan SNPN in the user controlled prioritized list of preferred SNPNs or in the credentials holder controlled prioritized list of preferred SNPNs associated with the selected entry in the \"list of subscriber data\", respectively; or\n-\ta GIN in the credentials holder controlled prioritized list of GINs associated with the selected entry in the \"list of subscriber data\"\nNOTE 7:\tWLAN advertises SNPN(s) towards which the AAA connectivity to 5GC is supported by using the ANQP-element \"3GPP Cellular Network\" with the SNPN List with AAA connectivity to 5GC IE in the payload (see annex H in 3GPP TS 24.302 [7]).\n4)\tThe priority of a WLAN in the available WLANs list is set to the WLAN priority defined in the preferredSSIDlist of the matching group of selection criteria. There may be one or more selected WLANs in the list; and\n5)\tWhen the selection criteria is set to slice-based TNAN list and the UE supports slice-based TNGF selection, the UE:\ni)\tshall select a selection criteria sub entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access;\nii)\tshall not add in the prioritized list of available WLANs the WLAN(s) whose SSID(s) are not in the SSID list of the selected selection criteria sub entry; and\niii)\tshall consider the TNGF ID that exists in the selected selection criteria sub entry while constructing the NAI used for EAP authentication as specified in clause 28.7.6 of 3GPP TS 23.003 [8] when the TNGF ID is used for constructing the NAI.\nNOTE 8:\tUE implementation can optimize the steps described above, e.g. by combining the ANQP procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3A\tPLMN selection procedures using trusted non-3GPP access",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3A.1\tGeneral",
                            "text_content": "When the UE is not operating in SNPN access operation mode, there are two modes of PLMN selection, namely, manual PLMN selection and automatic PLMN selection.\nThe UE follows one of the following two procedures defined in clause 5.3.2.2 and clause 5.3.2.3 depending on its implementation. The N5CW device that is not registered or cannot register via NG-RAN performs manual mode WLAN selection procedure as defined in clause 5.3.2.2.\nThe PLMN selected in accordance with these procedures determines the WLAN that is selected. When the selected WLAN is a trusted non-3GPP IP access and the UE decides to access 5GC via trusted non-3GPP IP access, the UE shall derive a NAI from the identity of the selected PLMN and use the NAI as the identity for authentication and authorization with the PLMN and usage of the WLAN.\nThe procedures described in this clause 5.3A shall apply to the UE and the N5CW device.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3A.2\tPLMN solicitation",
                            "text_content": "The UE not operating in SNPN access operation mode shall determine which PLMNs are available from each WLAN on the list of available WLANs constructed using the WLAN selection procedure described in clause 5.3.2 using the following procedures:\ni)\tthe UE selects a WLAN from the list of selected WLAN(s) constructed using the WLAN selection procedure described in clause 5.3.2;\nNOTE 1:\tAn N5CW device that is not registered or cannot register via NG-RAN uses only the manual mode WLAN selection procedure described in clause 5.3.2.\nii)\tif both the WLAN selected in step i) and the UE support ANQP specified in IEEE Std 802.11 [19] and if the UE did not obtain a list of realms using ANQP in clause 5.3.2.3 item 1, the UE shall send an ANQP request for a list of realms (i.e. ANQP-elements \"NAI Realm\"), PLMN identities (i.e. ANQP-element \"3GPP Cellular Network\"), or both; and\nNOTE 2:\tThe UE uses procedures defined in IEEE Std 802.11 [19] to determine if the WLAN supports ANQP and to send the ANQP request for ANQP-elements \"NAI Realm\", \"3GPP Cellular Network\", or both, as specified in IEEE Std 802.11 [19].\niii)\tif either the WLAN selected in step i) or the UE does not support ANQP (see IEEE Std 802.11 [19]) or the UE does not receive a list of realms in item ii), an EAP-Request/Identity is received and the EAP-Request/Identity does not include one or more of realms, PLMN identities, or both (encoded in accordance with IETF RFC 4284 [31]), the UE supports IEEE 802.1x authentication (see IEEE Std 802.1X™ [30]), the UE shall request a list of realms, PLMN identities, or both interworking with that WLAN by sending the EAP-Response/Identity message including as identity the alternative NAI; and\niv)\tthe UE repeats this procedure for all WLANs from the available list of WLANs as constructed using the WLAN selection procedure described in clause 5.3.2.\nNOTE 3:\tThe list with realms, PLMN identities, or both received in accordance with procedures in IETF RFC 4284 [31], is of limited size and might not contain all the realms, PLMN identities, or both available via the WLAN.\nThe UE shall convert any received PLMN identities into realms of the PLMNs using the rules defined in clause 19 and clause 28 of 3GPP TS 23.003 [8]. The N5CW device shall convert any received PLMN identities into realms of the PLMNs using the rules defined in clause 28 of 3GPP TS 23.003 [8].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3A.3\tManual PLMN selection mode procedure",
                            "text_content": "The UE not operating in SNPN access operation mode indicates to the user the PLMNs which are available via the WLAN. The UE may obtain the PLMNs available for WLAN access using procedures as described in clause 5.3A.2. The UE selects the PLMN based on the user preference.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3A.4\tAutomatic mode PLMN selection procedure",
                            "text_content": "The purpose of this procedure is for a UE not operating in SNPN access operation mode to:\n-\tselect a PLMN over WLAN; and\n-\tconstruct a NAI for use with authentication signalling with the selected PLMN in order for the UE to be authorised to use the WLAN.\nUntil the highest priority PLMN is found, the UE shall verify if a PLMN available over a WLAN of the selected WLAN(s) is the highest priority PLMN:\n1)\tusing the PLMNs which are available for WLAN as described in clause 5.3A.2, the UE uses the realms of the PLMN in the remaining steps of this clause;\n2)\tif the UE is registered over 3GPP access, the realm of the RPLMN of the 3GPP access is included in the list of realms created in clause 5.3A.2 and the realm of the RPLMN of the 3GPP access does not match a realm converted from any PLMN ID in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall select the RPLMN of the 3GPP access;\n3)\tif the UE is registered over 3GPP access, the realm of the RPLMN of the 3GPP access is not included in the list of realms created in clause 5.3A.2, the PLMN is in the \"N3AN node selection information\" (see 3GPP TS 24.526 [17]) and the PLMN is not in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" then the UE shall select the RPLMN of the 3GPP access and performs N3AN node selection with the RPLMN as defined in clause 7.2;\n4)\tif the condition in steps 2) and 3) are not satisfied, the UE shall select a PLMN in the following order:\ni)\tif the UE used the procedures in IETF RFC 4284 [31] (see clause 5.3A.2) to obtain a list of realms, then the UE is only required to select the realm of the HPLMN (if available);\nii)\tif the UE can determine the country it is located in (see clause 7.2.3) and the UE determines it is located in the home country, the UE follows the procedures in clause 5.3A.4.2;\niii)\tif the UE can determine the country it is located in (see clause 7.2.3) and the UE determines it is located in a visited country, the UE determines whether it is mandatory to select a PLMN in the visited country.\nIf the UE determines that it is not mandatory to select a PLMN in the visited country, the UE shall follow the procedures in clause 5.3A.4.2;\nIf the UE determines that it is mandatory to select a PLMN in the visited country, the UE shall select, in priority order, a PLMN from the list of realms created in clause 5.3A.2, if:\nI)\tthe PLMN is in the User Controlled PLMN Selector list (see 3GPP TS 31.102 [35]); or\nII)\tthe PLMN is in the Operator Controlled PLMN Selector list (see 3GPP TS 31.102 [35]).\nIf no match is found in either of the lists, the UE may perform N3AN node selection as defined in clause 7.2.\nThe UE shall construct a NAI for authentication with the highest priority PLMN as follows:\n1)\tif the PLMN selected was selected from:\ni)\ta list of realms obtained using IETF RFC 4284 [31]; or\nii)\ta list of PLMNs obtained from the PLMN List IE (see annex H of 3GPP TS 24.302 [7]), and the PLMN was neither present in the PLMN List with S2a Connectivity IE, in the PLMN List with trusted 5G Connectivity IE nor the PLMN List with trusted 5G connectivity-without-NAS IE;\nthen the UE constructs a NAI as specified in clause 5.2.3.2.3 of 3GPP TS 24.302 [7] for the case when the NAI is used for access via non-3GPP access to EPC and in accordance to the rules of 3GPP TS 23.003 [8] and the UE proceeds processing as defined in 3GPP TS 24.302 [7];\n2)\tif the PLMN selected was selected from a list of PLMNs obtained from the PLMN List with trusted 5G Connectivity IE or the PLMN List with trusted 5G connectivity-without-NAS IE (see annex H of 3GPP TS 24.302 [7]) then the UE constructs a NAI as specified in:\ni)\tclause 28.7.6 of 3GPP TS 23.003 [8] (when the TNGF ID is not used for constructing the NAI or when the TNGF ID is used for constructing the NAI) if the selected type of trusted connectivity is 5G connectivity using trusted non-3GPP access; or\nii)\tclause 28.7.7 of 3GPP TS 23.003 [8] if the selected type of trusted connectivity is 5G connectivity without NAS using trusted non-3GPP access; or\n3)\tif the PLMN selected was selected from a list of PLMNs obtained from the PLMN List with S2a Connectivity IE (see annex H of 3GPP TS 24.302 [7]) for the case when the NAI is used for access via trusted non-3GPP access to EPC, then the UE constructs a NAI as specified in clause 5.2.3.2.3 of 3GPP TS 24.302 [7] and the UE proceeds processing as defined in 3GPP TS 24.302 [7].\nNOTE 1:\tUE implementations can optimize the steps described above, e.g. by combining the ANQP procedures described in clause 5.3A.2 with the ANQP procedures in clause 5.3.2.3.\nNOTE 2:\tSelecting a WLAN from multiple WLANs advertising support for the selected PLMN is UE implementation specific.\nNOTE 3:\tThe N5CW device which is not registered or cannot register via NG-RAN only uses the PLMN List with trusted 5G connectivity-without-NAS IE, and the PLMN List with trusted 5G connectivity-without-NAS IE is only used by the N5CW devices.\nIf the realm of the HPLMN is included in the list of realms created in clause 5.3A.2 then the UE shall select the HPLMN.\nIf the realm of the HPLMN is not included in the list of realms created in clause 5.3A.2, but a realm of an equivalent HPLMN is included, then the UE shall select the equivalent HPLMN.\nIf neither realm is included in the list of realms created in clause 5.3A.2, then the UE aborts its attempt to use trusted non-3GPP IP access.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3B\tPLMN selection procedures using wireline access",
                    "description": "",
                    "summary": "",
                    "text_content": "Roaming support for wireline access is not defined in the present version of the present document.\nThe 5G-RG, the W-AGF acting on behalf of the FN-RG and the W-AGF acting on behalf of the N5GC device shall consider that the HPLMN is available on each wireline access network and shall select HPLMN on the wireline access network.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.3C\tPLMN selection procedures for NSWO in 5GS",
                    "description": "",
                    "summary": "",
                    "text_content": "The UE shall select a PLMN to authenticate with for NSWO by performing the following steps:\na)\tselect a WLAN using the procedure specified in subclause 5.3.2; and\nb)\tselect:\n1)\tthe HPLMN, if the HPLMN is in the PLMN list with AAA connectivity to 5GC IE (annex H in 3GPP TS 24.302 [7]) provided by the selected WLAN; and\n2)\tone of the PLMNs in the PLMN list with AAA connectivity to 5GC IE provided by the selected WLAN, if the HPLMN is not in the PLMN list with AAA connectivity to 5GC IE provided by the selected WLAN.\nNOTE:\tUEs supporting NSWO in 5GS only use the PLMN list with AAA connectivity to 5GC IE for NSWO in 5GS, and the PLMN list with AAA connectivity to 5GC IE is only used by UEs supporting NSWO in 5GS.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.3D\tSNPN selection procedures using trusted non-3GPP access",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3D.1\tGeneral",
                            "text_content": "When the UE is operating in SNPN access operation mode there are two modes of SNPN selection, namely, manual SNPN selection and automatic SNPN selection.\nThe UE follows one of the following two procedures defined in clause 5.3.2.2 and clause 5.3.2.3 depending on its implementation. The N5CW device that is not registered or cannot register via NG-RAN performs manual mode WLAN selection procedure as defined in clause 5.3.2.2.\nThe SNPN is selected in accordance with these procedures determines the WLAN that is selected. When the selected WLAN is a trusted non-3GPP IP access and the UE decides to access 5GC via trusted non-3GPP IP access, the UE shall derive a NAI from the identity of the selected SNPN and use the NAI as the identity for authentication and authorization with the SNPN and usage of the WLAN.\nThe procedures described in this clause 5.3D shall apply to the UE and the N5CW device.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3D.2\tSNPN solicitation",
                            "text_content": "The UE operating in SNPN access operation mode shall determine which SNPNs are available from each WLAN on the list of available WLANs constructed using the WLAN selection procedure described in clause 5.3.2 using the following procedures:\ni)\tthe UE selects a WLAN from the list of selected WLAN(s) constructed using the WLAN selection procedure described in clause 5.3.2;\nNOTE 1:\tAn N5CW device that is not registered or cannot register via NG-RAN uses only the manual mode WLAN selection procedure described in clause 5.3.2.2.\nii)\tif both the WLAN selected in step i) and the UE support ANQP specified in IEEE Std 802.11 [19] and if the UE did not obtain a list of realms using ANQP in clause 5.3.2.3 item 1, the UE shall send an ANQP request for a list of realms (i.e. ANQP-elements \"NAI Realm\"), SNPN identities (i.e. ANQP-element \"3GPP Cellular Network\"), or both; and\nNOTE 2:\tThe UE uses procedures defined in IEEE Std 802.11 [19] to determine if the WLAN supports ANQP and to send the ANQP request for ANQP-elements \"NAI Realm\", \"3GPP Cellular Network\", or both, as specified in IEEE Std 802.11 [19].\niii)\tif either the WLAN selected in step i) or the UE does not support ANQP (see IEEE Std 802.11 [19]) or the UE does not receive a list of realms in item ii), an EAP-Request/Identity is received and the EAP-Request/Identity does not include one or more of realms and SNPN identities (encoded in accordance with IETF RFC 4284 [31]), the UE supports IEEE 802.1x authentication (see IEEE Std 802.1X™ [30]), the UE shall request a list of realms, SNPN identities, or both interworking with that WLAN by sending the EAP-Response/Identity message including as identity the alternative NAI; and\niv)\tthe UE repeats this procedure for all WLANs from the available list of WLANs as constructed using the WLAN selection procedure described in clause 5.3.2.\nNOTE 3:\tThe list with realms, SNPN identities, or both received in accordance with procedures in IETF RFC 4284 [31], is of limited size and might not contain all the realms, SNPN identities, or both available via the WLAN.\nThe UE shall convert any received SNPN identities into realms of the SNPNs using the rules defined in clause 19 and clause 28 of 3GPP TS 23.003 [8]. The N5CW device shall convert any received SNPN identities into realms of the SNPNs using the rules defined in clause 28 of 3GPP TS 23.003 [8].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3D.3\tManual SNPN selection mode procedure",
                            "text_content": "The UE operating in SNPN access operation mode:\ni)\tselect one entry in the \"list of subscriber data\", if any, or the PLMN subscription, if any, to be used for manual mode SNPN selection. How the UE selects the entry in the \"list of subscriber data\" or the PLMN subscription is UE implementation specific; and\nii)\tindicate to the user the SNPNs which are available via the WLAN. The UE may obtain the SNPNs available for WLAN access using procedures as described in clause 5.3D.2. The UE selects the SNPN based on the user preference.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3D.4\tAutomatic mode SNPN selection procedure",
                            "text_content": "The purpose of this procedure is for the UE operating in SNPN access operation mode to:\n-\tselect an SNPN over WLAN; and\n-\tconstruct a NAI for use with authentication signalling with the selected SNPN in order for the UE to be authorised to use the WLAN.\nThe UE shall select one entry in the \"list of subscriber data\", if any, or the PLMN subscription, if any, to be used for automatic mode SNPN selection. How the UE selects the entry in the \"list of subscriber data\" or the PLMN subscription is UE implementation specific.\nUntil the highest priority SNPN is found, the UE shall verify if a SNPN available over a WLAN of the selected WLAN(s) is the highest priority SNPN:\n1)\tusing the SNPNs which are available for WLAN as described in clause 5.3D.2, the UE uses the realms of the SNPN in the remaining steps of this clause;\n2)\tif the UE is registered over 3GPP access, the realm of the RSNPN of the 3GPP access is included in the list of realms created in clause 5.3D.2, if the realm of the RSNPN of the 3GPP access does not match a realm converted from any SNPN ID in the \"temporarily forbidden SNPNs\" list for non-3GPP access or \"permanently forbidden SNPNs\" list for non-3GPP access associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, then the UE shall select the RSNPN of the 3GPP access;\n3)\tif the condition in step 2) is not satisfied, the UE shall select, in priority order, an SNPN from the list of realms created in clause 5.3D.2, if:\ni)\tthe SNPN identified by an SNPN identity of the subscribed SNPN in the selected entry of the \"list of subscriber data\";\nii)\tif the UE supports access to an SNPN using credentials from a credentials holder, using the SNPN selection parameters in the selected entry of the \"list of subscriber data\" or associated with the selected PLMN subscription:\nI)\teach SNPN indicating that access using credentials from a credentials holder is supported and which is identified by an SNPN identity contained in the user controlled prioritized list of preferred SNPNs (in priority order);\nII)\teach SNPN indicating that access using credentials from a credentials holder is supported and which is identified by an SNPN identity contained in the credentials holder controlled prioritized list of preferred SNPNs (in priority order);\nIII)\teach SNPN indicating that access using credentials from a credentials holder is supported and indicating a GIN contained in the credentials holder controlled prioritized list of GINs (in priority order). If more than one such SNPN indicate the same GIN, the priority order is UE implementation specific;\nIII)\teach SNPN identified by an SNPN identity which is included neither in the SNPN selection parameters of the entries of the \"list of subscriber data\" nor in the SNPN selection parameters associated with the PLMN subscription, which does not indicate a GIN which is included in the credentials holder controlled prioritized list of GINs, and which indicates that the SNPN allows registration attempts from UEs that are not explicitly configured to select the SNPN. If more than one such SNPN is available, the order in which the UE attempts registration on those SNPNs is UE implementation specific.\nThe UE shall construct a NAI for authentication with the highest priority SNPN as follows:\n1)\tif the selected type of trusted connectivity is 5G connectivity using trusted non-3GPP access and:\ni)\tthe selected SNPN is from a list of SNPNs obtained from the SNPN List with trusted 5G Connectivity IE (see annex H of 3GPP TS 24.302 [7]); or\nii)\t the selected SNPN is from a list of realms obtained using IETF RFC 4284 [31];\nthen the UE constructs a NAI as specified in clause 28.7.6 of 3GPP TS 23.003 [8]; or\n2)\tif the selected type of trusted connectivity is 5G connectivity without NAS using trusted non-3GPP access and:\ni)\tthe selected SNPN is from a list of SNPNs obtained from the SNPN List with trusted 5G Connectivity-without-NAS IE (see annex H of 3GPP TS 24.302 [7]); or\nii)\tthe selected SNPN is from a list of realms obtained using IETF RFC 4284 [31];\nthen the UE constructs a NAI as specified in clause 28.7.7 of 3GPP TS 23.003 [8].\nNOTE 1:\tUE implementations can optimize the steps described above, e.g. by combining the ANQP procedures described in clause 5.3C.2 with the ANQP procedures in clause 5.3.2.3.\nNOTE 2:\tSelecting a WLAN from multiple WLANs advertising support for the selected SNPN is UE implementation specific.\nNOTE 3:\tThe N5CW device which is not registered or cannot register via NG-RAN only uses the SNPN List with trusted 5G Connectivity-without-NAS IE, and the SNPN List with trusted 5G Connectivity-without-NAS IE is only used by the N5CW devices.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3D.5\tAutomatic SNPN selection procedure for onboarding services in SNPN over trusted non-3GPP access",
                            "text_content": "If the UE is operating in SNPN access operation mode over trusted non-3GPP access, the UE shall follow these steps:\n1.\tuse procedures defined in subclause 5.3.2.3 to discover available WLANs;\nNOTE:\tThe available WLANs advertise the SNPN(s) towards which the 5G connectivity using trusted non-3GPP access is supported as described in subclause 5.3.2.3. If an SNPN supports onboarding services in SNPN (i.e. the SNPN can be used as ON-SNPN) the WLAN providing access to the SNPN provides an indication (e.g. via ANQP) that onboarding is allowed as described in 3GPP TS 24.302 [7] annex H.\n2.\tselect an SNPN if the SNPN indicates that onboarding is allowed and the SNPN matches the optional pre-configured onboarding SNPN selection information. The contents of the onboarding SNPN selection information are UE implementation specific; and\n3.\tperforms initial registration for onboarding services in the SNPN. If the registration fails, the UE may select and can attempt to perform initial registration for onboarding services in a different SNPN that indicates onboarding is allowed and the SNPN matches the optional pre-configured onboarding SNPN selection information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3E\tPLMN selection procedures using untrusted non-3GPP access",
                    "description": "",
                    "summary": "",
                    "text_content": "Selection of a PLMN over untrusted non-3GPP access is documented in subclause 7.2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.3F\tSNPN selection procedures using untrusted non-3GPP access",
                    "description": "",
                    "summary": "",
                    "text_content": "Selection of an SNPN over untrusted non-3GPP access is documented in subclause 7.2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.3G\tSNPN selection procedures using wireline access",
                    "description": "",
                    "summary": "",
                    "text_content": "Selection of non-subscribed SNPN over wireline access is not defined in the present version of the present document.\nThe 5G-RG and the W-AGF acting on behalf of the FN-CRG shall consider that the subscribed SNPN is available on each wireline access network and shall select the subscribed SNPN on the wireline access network.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.3H\tSNPN selection procedures for NSWO in 5GS",
                    "description": "",
                    "summary": "",
                    "text_content": "The UE operating in SNPN access operation mode for 5G NSWO shall select:\na)\tthe registered SNPN, if the WLAN is selected according to step b) 3) iv) I) of clause 5.3.2.3;\nb)\tthe subscribed SNPN, if the WLAN is selected according to step b) 3) iv) II) of clause 5.3.2.3; or\nc)\tthe SNPN corresponding to the SNPN identity used in step b) 3) iv) III) of clause 5.3.2.3, if the WLAN is selected according to step b) 3) iv) III) of clause 5.3.2.3.\nNOTE:\tThe SNPN identity of the selected SNPN is used to construct the NAI for the authentication procedure for NSWO.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.4\tAccess network reselection procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.4.1\tGeneral",
                            "text_content": "The access network reselection procedure can be triggered based on the user's request or the operator's policy. Such operator policy for supporting network reselection can be provided by the ANDSP or can be pre-provisioned in the UE.\nThe access network reselection procedure can also be triggered by the UE during periodical re-evaluation of ANDSP policies (see clause 6.4.2), or if the 'active' rule becomes invalid (conditions no longer fulfilled), or other manufacturer specific trigger.\nNOTE:\tHow frequently the UE performs the discovery and reselection procedure is UE implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.2\tWLAN reselection procedure",
                            "text_content": "For WLAN access network reselection, the UE configured with a WLANSP rule shall use the access network selection procedure as specified in clause 5.3.2. The UE first uses WLAN Selection Policy (WLANSP) to determine the active WLANSP rule. The UE selects the highest priority and valid WLANSP rule as the active WLANSP rule.\nThe access network reselection procedure can be in automatic mode or manual mode. The manual mode reselection shall follow the behaviour described in clause 5.3.2.3 and the automatic mode reselection shall follow the behaviour described in clause 5.3.2.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tUE - 5GC network protocols",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause specifies the related procedures performed between the UE and untrusted or trusted non-3GPP access network or wireline access network.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.2\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.3\tAuthentication and authorization for accessing 5GS via non-3GPP access network",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3.1\tGeneral",
                            "text_content": "In order to register to the 5G core network (5GCN) via untrusted non-3GPP IP access, the UE first needs to be configured with a local IP address from the untrusted non-3GPP access network (N3AN).\nOnce the UE is configured with a local IP address, the UE shall select the Non-3GPP InterWorking Function (N3IWF) as described in clause 7.2 and shall initiate the IKEv2 SA establishment procedure as described in clause 7.3. During the IKEv2 SA establishment procedure, authentication and authorization for access to 5GCN is performed.\nNOTE 1:\tThe trust relationship indicator (see 3GPP TS 24.302 [7]), which can be received during EAP extension authentication during IKEv2 SA, does not indicate the WLAN is a trusted non-3GPP access network connected to the 5GCN.\nIn a trusted non-3GPP access, a UE shall first connect to a TNAN using a link layer protocol and shall initiate EAP authentication. During EAP authentication, authentication and authorization for access to 5GCN is performed by exchange of EAP-5G message encapsulated in the link layer protocol between the UE and the TNAN, see clause 7.3A.2.1. Upon completion of EAP authentication, the UE shall be assigned an IP address by that TNAN. Once the UE is configured with an IP address, it shall initiate the IKEv2 SA establishment procedure as described in clause 7.3A.\nIn wireline access, the 5G-RG shall first establish connection using W-CP protocol stack with a W-AGF serving the 5G-RG using means out of scope of the present document.\nNOTE 2:\tFor establishment of connection using W-CP protocol stack, see BBF TR-456 issue 2 [42] and CableLabs WR-TR-5WWC-ARCH [36].\nIn wireline access, authentication and authorization of an N5GC device behind a CRG for access to 5GCN is performed as described in clause 6.3.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.2\tAuthentication of N5GC device behind a CRG over wireline access",
                            "text_content": "In order to register to 5GCN via wireline access, the N5GC device first establishes a layer-2 connection to W-AGF via the CRG as specified in CableLabs WR-TR-5WWC-ARCH- V02-200430 [36]. Once the layer-2 connection is established, authentication and authorization for access to 5GCN is performed.\nThe W-AGF initiates an exchange of EAP-Request/Identity message and EAP-Response/Identity message as specified in IETF RFC 3748 [9] for obtaining the identity of the N5GC device. In wireline access, the W-AGF and the N5GC device exchange EAP-Request/Identity message and EAP-Response/Identity message via the CRG, encapsulated in the link layer protocol packets.\nUpon reception of EAP-Request/Identity message, the N5GC device shall:\na)\tconstruct an EAP-Response/Identity message as described in IETF RFC 3748 [9] containing an NAI username@realm as specified in IETF RFC 7542 [37]; and\nNOTE:\tIf subscription identifier privacy protection is to be used, the \"username\" part is either omitted or set to \"anonymous\".\nb)\ttransmit the EAP-Response of identity type encapsulated in the link layer protocol packets towards the W-AGF.\nThe CRG conveys the information provided by the N5GC device to the W-AGF which initiates the registration on behalf of the N5GC device as described in 3GPP TS 24.501 [4]. The SUPI of the N5GC device contains a network specific identifier. For the registration, the W-AGF uses the NULL scheme as specified in 3GPP TS 33.501 [5], to construct a SUCI from the SUPI which was received as the NAI from the N5GC device in the EAP-Response/Identity message.\nAn exchange of the EAP request and EAP response as described in IETF RFC 3748 [9] occurs until the N5GC device is authenticated by the 5GCN with the EAP authentication described in 3GPP TS 33.501 [5].\nUpon completion of successful authentication and on reception of the authentication result from the AMF, the W-AGF serving the N5GC device shall complete the procedure by sending an EAP-Success message encapsulated in the link layer protocol packets.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.3a\tAuthentication for NSWO in 5GS",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE that supports NSWO in 5GS and is configured to use NSWO in 5GS, shall not perform NSWO in EPS. NSWO in 5GS capability can be enabled and disabled via configuration on the USIM (see 3GPP TS 31.102 [35]) or on the ME. Configuration on the USIM shall take precedence over the ME.\nIn order to use NSWO in 5GS, and if the WLAN access network requires 5GS-based authentication of a UE to connect to the WLAN, the UE shall perform:\na)\tthe EAP-AKA' authentication procedure as specified in 3GPP TS 33.501 [5] annex S.3, if the UE does not operate in SNPN access operation mode for 5G NSWO; or\nb)\tany key-generating EAP authentication method as specified in 3GPP TS 33.501 [5] subclause I.10.5, if the UE operates in SNPN access operation mode for 5G NSWO.\nThe UE shall use as its identity the SUCI in NAI format for NSWO in 5GS as defined in clause 28.7.12 of 3GPP TS 23.003 [8].\nNOTE 1:\tThe same NAI format is used over both trusted and untrusted non-3GPP access networks for NSWO in 5GS, which is different from the NAI format used for registration over trusted non-3GPP access specified in clause 28.7.6 of 3GPP TS 23.003 [8].\nIf:\na)\tthe UE operates in SNPN access operation mode for 5G NSWO;\nb)\tthe UE uses the \"null-scheme\" as specified in 3GPP TS 33.501 [5] to generate a SUCI; and\nc)\tan indication to use anonymous SUCI which is associated with the selected entry of the \"list of subscriber data\", is configured in the ME;\nNOTE 2:\tThe ME can be configured with an indication to use anonymous SUCI associated with an entry of \"list of subscriber data\" when the EAP method associated with the credentials of the entry supports SUPI privacy at the EAP layer.\nthen the UE shall use as its identity the anonymous SUCI in NAI format as specified in clause 28.7.12 of 3GPP TS 23.003 [8].\nUpon receipt of an EAP-Request/AKA'-Challenge message the UE shall apply the rules for comparison of the locally determined ANID \"5G:NSWO\" (see table 8.1.1.2-2 of 3GPP TS 24.302 [7]) and the Network Name field of the AT_KDF_INPUT attribute received in the EAP-Request/AKA'-Challenge message as specified in IETF RFC 5448 [38].\nA:\na)\troaming UE; or\nb)\tUE which selected a non-subscribed SNPN in the SNPN selection procedures for NSWO in 5GS;\nthat supports NSWO in 5GS and is configured to use NSWO in 5GS shall use as its identity the SUCI in decorated NAI format as specified for NSWO in 5GS in clause 28.7.9 of 3GPP TS 23.003 [8].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.3b\tNSWO in 5GS provided by 5G-RG",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3b.1\tGeneral",
                            "text_content": "The 5G-RG may support acting as the WLAN access network entity as defined in clause 4.2.15 and clause 5.42 of 3GPP TS 23.501 [2]. This clause applies in that case.\nThe 5G-RG shall register to 5GC before initiating the authentication for NSWO in 5GS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3b.2\tAuthentication for NSWO in 5GS provided by 5G-RG",
                            "text_content": "The 5G-RG shall handle the EAP messages:\na)\tfrom the UE behind the 5G-RG; or\nb)\tto the UE behind the 5G-RG,\nin the same way as the WLAN access network as specified in 3GPP TS 33.501 [5] annex S.3.\nThe 5G-RG shall handle messages of the Swa' reference point from the NSWOF or to the NSWOF in the same way as the WLAN access network as specified in 3GPP TS 33.501 [5] annex S.3. Messages of Swa' reference point are user data packets. The W-AGF serving the 5G-RG is not impacted by passing of the messages of Swa' reference point.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.4\tHandling of ANDSP Information",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.4.1\tGeneral",
                            "text_content": "The Access Network Discovery & Selection policy (ANDSP) is used to control UE behavior related to access network discovery and selection of trusted and untrusted non-3GPP access network.\nNOTE:\tANDSP does not influence access network discovery and selection of wireline access network.\nANDSP consists of:\n-\tWLAN Selection Policy (WLANSP); and\n-\tNon-3GPP access network (N3AN) node configuration information.\nThe UE uses the WLANSP for selecting the WLAN.\nThe UE uses the Non-3GPP access network (N3AN) node configuration information for selecting a N3AN node (i.e. N3IWF or ePDG).\nWhen roaming, the UE can receive ANDSP from H-PCF or V-PCF or both with following exception:\n-\tthe V-PCF only provides the N3AN node configuration information containing slice-specific N3IWF prefix configuration applicable for the visited PLMN (see clause 7.2.2).The UE shall ignore the N3AN node configuration information containing the information other than slice-specific N3IWF prefix configuration in the ANDSP if the ANDSP is provided by V-PCF.\nThe structure and the content of ANDSP are defined in 3GPP TS 24.526 [17].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.2\tUE procedures",
                            "text_content": "When ANDSP is modified based on information received from network as specified in 3GPP TS 24.501 [4] Annex D, the UE shall re-evaluate the ANDSP.\nThe received ANDSP information shall not impact the PLMN selection and reselection procedures specified in 3GPP TS 23.122 [13].\nThe UE shall periodically re-evaluate ANDSP. The value of the periodic re-evaluation timer is implementation dependent. The additional trigger for (re-)evaluating ANDSP is when the active WLANSP rule becomes invalid (conditions no longer fulfilled), or other manufacturer specific trigger.\nDuring automatic mode WLAN selection, the UE shall use the WLAN selection policy (WLANSP), if provided by the PCF, to determine the selected WLAN as described in clause 5.3.\nIf the UE accesses 5GCN via the non-3GPP access, the UE shall use the N3AN node configuration information to select an N3AN node as described in clause 7.2, to be used for establishing IKEv2 security association as described in clause 7.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.3\tANDSP information from the network",
                            "text_content": "ANDSP information is provided by the network to the UE using the UE policy delivery procedure described in Annex D of 3GPP TS 24.501 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tSecurity association management procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The purpose of the security association management procedures is to define the procedures for establishment or disconnection of end-to-end security association between the UE and the N3IWF via an IKEv2 protocol exchange specified in IETF RFC 7296 [6]. The IKE SA and child signalling IPsec SA establishment procedure is always initiated by the UE, whereas the child user plane IPsec SA creation procedures shall be initiated by the N3IWF as specified in 3GPP TS 23.502 [3].\nThe UE selects an N3IWF according to the procedure in clause 7.2. Once the N3IWF has been selected, the security associations are established managed according to the procedures in clause 7.3 to clause 7.7.\nIf a non-3GPP access network does not support transport of IP fragments, the maximum size of an IKEv2 message including the IP header is equal to the path MTU between the UE and N3IWF.\nEXAMPLE:\tIf a non-3GPP access network is an IPv6 only network which does not support transport of IP fragments and the path MTU between the UE and the N3IWF is 1280 octets then the maximum size of an IKEv2 message including IP header is 1280 octets.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2\tN3AN node selection procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.2.1\tGeneral",
                            "text_content": "The UE performs N3AN node selection procedure based on:\na)\tthe N3AN node configuration information provisioned to the UE by the HPLMN, based on the UE's knowledge of the country the UE is located in and the PLMN the UE is registered to via 3GPP access and based on the list of \"forbidden PLMNs for non-3GPP access to 5GCN\"; or\nb)\tthe N3IWF identifier information provided to the UE in the REGISTRATION REJECT message, if any, when the UE has indicated its support for slice-based N3IWF selection to the AMF as specified in 3GPP TS 24.501 [4].\nClauses 7.2.1, 7.2.2, 7.2.3, 7.2.4 and 7.2.6 are applicable to a UE selecting an N3AN node in a PLMN. For a UE accessing PLMN services via an SNPN, restrictions on N3IWF FQDN are specified in clause 4.3.2. As part of N3AN node selection, the UE also selects an PLMN for non-3GPP access.\nClause 7.2.5 is applicable to a UE selecting an N3AN node in an SNPN. As part of N3AN node selection, the UE also selects an SNPN for non-3GPP access.\nClause 7.2.7 is applicable to a UE selecting an N3AN node for case b) above.\nClause 7.2.8 is applicable to a UE selecting an N3IWF for onboarding SNPN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.2\tN3AN node configuration information",
                            "text_content": "The N3AN node configuration information is provisioned to the UE either by the H-PCF, V-PCF or via implementation specific means. The UE shall apply the N3AN node configuration information provisioned via implementation specific means only if the N3AN node configuration information provisioned by the H-PCF is not present in the UE.\nThe N3AN node configuration information shall consist of the following:\n-\tN3AN node selection information;\n-\toptionally, home N3IWF identifier configuration;\n-\toptionally, home ePDG identifier configuration;\n-\toptionally, extended home N3IWF identifier configuration; and\n-\toptionally, slice-specific N3IWF prefix configuration.\nNOTE 1:\tN3AN node configuration information provisioned by a VPLMN includes only slice-specific N3IWF prefix configuration.\nThe N3AN node selection information consists of N3AN node selection information entries. Each N3AN node selection information entry contains a PLMN ID and information for the PLMN ID. The N3AN node selection information contains at least an N3AN node selection information entry with information for the HPLMN and an N3AN node selection information entry for \"any_PLMN\".\nThe extended home N3IWF identifier configuration contains one or more tuples of a FQDN/IP address of the N3IWF in the HPLMN and S-NSSAIs supported by this N3IWF and subscribed by the UE.\nThe Slice-specific N3IWF prefix configuration consists of Slice-specific N3IWF prefix entries. Each Slice-specific N3IWF prefix entry contains a slice-specific N3IWF prefix and an S-NSSAI list. Slice-specific N3IWF prefix configuration is valid only in the PLMN that provisioned it.\nNOTE 2:\tAs an implementation option, the UE can store slice-specific N3IWF prefix configuration provisioned by a PLMN for later use.\nThe N3AN node configuration information provisioned by the H-PCF or the V-PCF is as specified in 3GPP TS 24.501 [4] annex D and 3GPP TS 24.526 [17].\nThe UE shall support the implementation of standard DNS mechanisms in order to retrieve the IP address(es) of the N3IWF or ePDG. The input to the DNS query is an N3IWF FQDN or ePDG FQDN as specified in 3GPP TS 23.003 [8].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.3\tDetermination of the country the UE is located in",
                            "text_content": "If the UE cannot determine whether it is located in the home country or in a visited country, as required by the N3AN node selection procedure, the UE shall stop the N3AN node selection. Once the UE determines the country the UE is located in, the UE shall proceed with N3AN node selection as specified in clause 7.2.4 for non-emergency services and as specified in clause 7.2.6 for emergency services.\nNOTE:\tIt is out of scope of the present specification to define how the UE determines whether it is located in the home country or in a visited country or in a location that does not belong to any country. When the UE is in coverage of a 3GPP RAT, it can, for example, use the information derived from the available PLMN(s). In this case, the UE can match the MCC of the PLMN to which a cell belongs, broadcast on the BCCH of the 3GPP access, against the UE's IMSI to determine if they belong to the same country, as defined in 3GPP TS 23.122 [13]. If the UE is not in coverage of a 3GPP RAT, the UE can use other techniques, including user-provided location.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.4\tN3AN node selection for non-emergency services",
                            "text_content": "When the UE supports connectivity with N3IWF but does not support connectivity with ePDG, the UE shall perform the procedure in clause 7.2.4.3 for selecting an N3IWF.\nWhen the UE supports connectivity with N3IWF and ePDG, the UE shall perform the procedure in clause 7.2.4.4 for selecting either an N3IWF or an ePDG.\nIn order to determine if the visited country mandates the selection of N3IWF in this country, the UE shall perform the DNS NAPTR query using Visited Country FQDN as specified in 3GPP TS 23.003 [8] via the non-3GPP access network.\nIf the result of this query is:\n-\ta set of one or more records containing the service instance names of the form \"n3iwf.5gc.mnc<MNC>.mcc<MCC>.pub.3gppnetwork.org\", the UE shall determine that the visited country mandates the selection of the N3IWF in this country; and\nNOTE:\tThe (<MCC>, <MNC>) pair in each record represents PLMN Id (see 3GPP TS 23.003 [8]) in the visited country which can be used for N3IWF selection in clause 7.2.4.3 and clause 7.2.4.4.\n-\tno records containing the service instance names of the form \"n3iwf.5gc.mnc<MNC>.mcc<MCC>.pub.3gppnetwork.org\", the UE shall determine that the visited country does not mandate the selection of the N3IWF in this country.\nIf the UE only supports connectivity with N3IWF and does not support connectivity with ePDG, the UE shall ignore the following ePDG related configuration parameters if available in the N3AN node configuration information when selecting an N3IWF:\n-\tthe home ePDG identifier configuration; and\n-\tthe preference parameter in each N3AN node selection information entry in the N3AN node selection information.\nThe UE shall proceed as follows:\na)\tif the UE is located in its home country:\n1)\tif the N3AN node configuration information is provisioned:\ni)\tif the extended home N3IWF identifier configuration is provisioned in the N3AN node configuration information, the UE shall use the IP address or the FQDN from the extended home N3IWF identifier entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access;\nii)\tif the extended home N3IWF identifier configuration is not provisioned in the N3AN node configuration information and the Slice-specific N3IWF prefix configuration is provisioned, the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry for the HPLMN whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the HPLMN's N3AN node selection information entry in the N3AN node selection information; and\niii)\tif neither the extended home N3IWF identifier configuration nor the Slice-specific N3IWF prefix configuration is provisioned in the N3AN node configuration information and:\na)\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information and contains an IP address, the UE shall use the IP address of the home N3IWF identifier configuration as the IP address of the N3IWF. The UE shall consider that the HPLMN is selected;\nb)\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information and does not contain an IP address, the UE shall use the FQDN of the home N3IWF identifier configuration as the N3IWF FQDN. The UE shall consider that the HPLMN is selected; and\nc)\tif the home N3IWF identifier configuration is not provisioned in the N3AN node configuration information, the UE shall construct an N3IWF FQDN based on the FQDN format of the HPLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the HPLMN stored on the USIM as specified in 3GPP TS 23.003 [8]. The UE shall consider that the HPLMN is selected; and\n2)\tif the N3AN node configuration information is not provisioned on the UE, the UE shall construct the N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the HPLMN stored on the USIM. The UE shall consider that the HPLMN is selected;\nand for the above cases constructing or using an N3IWF FQDN, the UE shall use the DNS server function to resolve the N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address. If the DNS response contains no records and the UE used an FQDN determined by following step a)-1)-i), the UE shall follow the procedure in bullet a)-1)-ii) assuming that the extended home N3IWF identifier configuration is not provisioned. If the DNS response contains no records and the UE used an FQDN determined by following step a)-1)-ii), the UE shall follow the procedure in bullet a)-1)-iii) assuming that neither the extended home N3IWF identifier configuration nor the Slice-specific N3IWF prefix configuration is provisioned; and\nb)\tif the UE is not located in its home country:\n1)\tif the Slice-specific N3IWF prefix configuration is provisioned for the VPLMN, the UE is registered to a VPLMN via 3GPP access, the PLMN ID of VPLMN is not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", and at least one Slice-specific N3IWF prefix entry is available in the Slice-specific N3IWF prefix configuration, the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access in the VPLMN. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the VPLMN's N3AN node selection information entry in the N3AN node selection information;\n2)\tif the Slice-specific N3IWF prefix configuration is not provisioned for the VPLMN and the N3AN node configuration information is provisioned, the UE is registered to a VPLMN via 3GPP access, the PLMN ID of VPLMN is not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", and an N3AN node selection information entry for the VPLMN is available in the N3AN node selection information of the N3AN node configuration information, the UE shall construct an N3IWF FQDN based on FQDN format of the VPLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the VPLMN as specified in 3GPP TS 23.003 [8].The UE shall consider that the VPLMN is selected;\nand for the above cases, the UE shall use the DNS server function to resolve the constructed N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address; and\n3)\tif one of the following is true:\n-\tthe UE is not registered to a PLMN via 3GPP access and the UE uses WLAN;\n-\tneither the N3AN node configuration information nor the Slice-specific N3IWF prefix configuration are provisioned; or\n-\tthe N3AN node configuration information or the Slice-specific N3IWF prefix configuration is provisioned, the UE is registered to a VPLMN via 3GPP access and:\nA)\tthe PLMN ID of VPLMN is included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\"; or\nB)\tthe N3AN node selection information entry for the VPLMN is not present in the N3AN node selection information or the Slice-specific N3IWF prefix configuration for the VPLMN is not present;\nthe UE shall perform a DNS query (see 3GPP TS 23.003 [8]) as specified in clause 7.2.4.2 to determine if the visited country mandates the selection of N3IWF in this country and:\ni)\tif selection of N3IWF in visited country is mandatory:\nA)\tif the UE is registered to a VPLMN via 3GPP access, the PLMN ID of VPLMN is included in one of the returned DNS records and is not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall construct an N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the VPLMN in 3GPP access as described in 3GPP TS 23.003 [8].The UE shall consider that the VPLMN in 3GPP access is selected; and\nB)\tif the UE is not registered to a PLMN via 3GPP access or the UE is registered to a VPLMN via 3GPP access and the PLMN ID of VPLMN is not included in any of the returned DNS records or is included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\":\n-\tif the UE has Slice-specific N3IWF prefix configuration for one or more PLMNs included in the DNS response excluding any VPLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the selected VPLMN's N3AN node selection information entry in the N3AN node selection information;\n-\tif the Slice-specific N3IWF prefix configuration is not provisioned and the N3AN node configuration information is provisioned, the UE shall select a PLMN included in the DNS response that has highest PLMN priority (see 3GPP TS 24.526 [17]) in the N3AN node selection information of the N3AN node configuration information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" and the UE shall construct an N3IWF FQDN based on the FQDN format of the selected PLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the selected PLMN as specified in 3GPP TS 23.003 [8]; and\n-\tif a) neither the Slice-specific N3IWF prefix configuration nor the N3AN node configuration information are provisioned or b) neither the Slice-specific N3IWF prefix configuration nor the N3AN node selection information of the N3AN node configuration information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" contain any of the PLMNs in the DNS response, then the selection of a PLMN of the visited country is UE implementation specific. If the UE does not select a PLMN, the UE shall terminate the N3AN node selection procedure. If the UE selects a PLMN, the UE shall construct an N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the selected PLMN as described in 3GPP TS 23.003 [8];\nand for the above cases, the UE shall use the DNS server function to resolve the constructed N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address;\nii)\tif the DNS response contains no records and the UE used Prefixed N3IWF FQDN in the DNS query, the UE shall repeat the DNS query using the same FQDN without the prefix label;\niii)\tif the DNS response contains no records and the UE did not use the Prefixed N3IWF FQDN in the DNS query, the UE shall further determine if the visited country mandates the selection of ePDG in the visited country using the procedure specified in clause 7.2.1.4 of 3GPP TS 24.302 [7].\nIf the UE determines that the visited country mandates the selection of ePDG in the visited country, the UE shall assume that the selection of N3IWF in the visited country is mandatory and shall terminate the N3AN node selection procedure.\n-\tIf the UE determines that the visited country does not mandate the selection of ePDG in the visited country, the UE shall assume that the selection of N3IWF in the visited country is not mandatory, then the UE shall proceed as below:\nA)\tif the UE has Slice-specific N3IWF prefix configuration the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the selected VPLMN's N3AN node selection information entry in the N3AN node selection information;\nB)\tif the Slice-specific N3IWF prefix configuration is not provisioned and the N3AN node configuration information is provisioned and the N3AN node selection information of the N3AN node configuration information contains one or more PLMNs in the visited country which are not in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall select a PLMN that has highest PLMN priority (see 3GPP TS 24.526 [17]) in the N3AN node selection information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" and the UE shall construct an N3IWF FQDN based on the FQDN format of the selected PLMN's N3AN node selection information entry in the N3AN node selection information as specified in 3GPP TS 23.003 [8] using the PLMN ID of the selected PLMN; and\nC)\tif a) neither the Slice-specific N3IWF prefix configuration nor the N3AN node configuration information is provisioned or b) the Slice-specific N3IWF prefix configuration is not provisioned and the N3AN node configuration information is provisioned and the N3AN node selection information of the N3AN node configuration information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" contains no PLMNs in the visited country:\n-\tif the extended home N3IWF identifier configuration is provisioned in the N3AN node configuration information, the UE shall use the IP address or the FQDN from the extended home N3IWF identifier entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access; and\n-\tif the extended home N3IWF identifier configuration is not provisioned in the N3AN node configuration information and:\n-\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information (see 3GPP TS 24.526 [17]) and contains an IP address, the UE shall use the IP address of the home N3IWF identifier configuration as the IP address of the N3IWF. The UE shall consider that the HPLMN is selected;\n-\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information (see 3GPP TS 24.526 [17]) and does not contain an IP address, the UE shall use the FQDN of the home N3IWF identifier configuration as the N3IWF FQDN. The UE shall consider that the HPLMN is selected; and\n-\tif the home N3IWF identifier configuration is not provisioned in the N3AN node configuration information, the UE shall construct an N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the HPLMN as described in 3GPP TS 23.003 [8]. The UE shall consider that the HPLMN is selected;\nand for the above cases constructing or using an N3IWF FQDN, the UE shall use the DNS server function to resolve the N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address; and\niv)\tif no DNS response is received, the UE shall terminate the N3AN node selection procedure.\nFollowing bullet a) and b) above, once the UE selected the IP address of the N3IWF, the UE shall initiate the IKEv2 SA establishment procedure as specified in clause 7.3.\nIf the IKEv2 SA establishment procedure towards an N3IWF in the HPLMN fails due to no response to an IKE_SA_INIT request message, and the selection of N3IWF in the HPLMN is performed using Extended home N3IWF identifier configuration or Home identifier configuration and there are more pre-configured N3IWFs in the HPLMN, the UE shall repeat the tunnel establishment attempt using the next FQDN or IP address(es) of the N3IWF in the HPLMN.\nIf the IKEv2 SA establishment procedure towards to any of the received IP addresses of the selected N3IWF fails due to no response to an IKE_SA_INIT request message, then the UE shall repeat the N3IWF selection as described in this clause, excluding the N3IWFs for which the UE did not receive a response to the IKE_SA_INIT request message.\nIf the UE constructed an N3IWF FQDN based on FQDN format of the VPLMN's N3AN node selection information entry (see item b).1)), and the IKEv2 SA establishment procedure towards to each of the received IP addresses of the selected N3IWF failed due to no response to an IKE_SA_INIT request message, the UE considers Slice-specific N3IWF prefix entry and the N3AN node selection information entry for the VPLMN as not present and the UE shall repeat the N3IWF selection as described in this clause.\nNOTE:\tThe time the UE waits before reattempting access to another N3IWF or to an N3IWF that it previously did not receive a response to an IKE_SA_INIT request message, is implementation specific.\nIf the UE can support connectivity with N3IWF and with ePDG, the UE shall:\n-\tif the N3AN node selection is required for an IMS service, follow steps specified in clause 7.2.4.4.2 for N3AN node selection; and\n-\tif the N3AN node selection is required for a non-IMS service, follow steps specified in clause 7.2.4.4.3 for N3AN node selection.\nNOTE:\tHow the UE determines node selection is required for an IMS service or for a non-IMS service is implementation-specific.\nIf the N3AN node selection is required for an IMS service, the UE shall use the preference parameter in the N3AN node selection information entries of the N3AN node selection information to determine whether selection of N3IWF or ePDG is preferred in a given PLMN.\nThe UE shall proceed as follows:\na)\tif the UE is located in its home country:\n1)\tif the N3AN node configuration information is provisioned:\ni)\tif the preference parameter in the HPLMN's N3AN node selection information entry of the N3AN node selection information indicates that N3IWF is preferred:\nI)\tif the extended home N3IWF identifier configuration is provisioned in the N3AN node configuration information, the UE shall use the IP address or the FQDN from the extended home N3IWF identifier entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access;\nII)\tif the extended home N3IWF identifier configuration is not provisioned in the N3AN node configuration information and the Slice-specific N3IWF prefix configuration is provisioned, the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry for the HPLMN whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration proceure over the untrusted non-3GPP access. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the HPLMN's N3AN node selection information entry in the N3AN node selection information; and\nNOTE 1: In this sub-clause, the Requested S-NSSAI(s) include the S-NSSAI corresponding to the IMS service.\nIII)\tif neither the extended home N3IWF identifier configuration nor the Slice-specific N3IWF prefix configuration is provisioned in the N3AN node configuration information and:\nA)\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information and contains an IP address, the UE shall use the IP address of the home N3IWF identifier configuration as the IP address of the N3IWF. The UE shall consider that the HPLMN is selected;\nB)\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information and does not contain an IP address, the UE shall use the FQDN of the home N3IWF identifier configuration as the N3IWF FQDN. The UE shall consider that the HPLMN is selected; and\nC)\tif the home N3IWF identifier configuration is not provisioned in the N3AN node configuration information, the UE shall construct an N3IWF FQDN based on the FQDN format of the HPLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the HPLMN stored on the USIM as specified in clause 28 of 3GPP TS 23.003 [8]. The UE shall consider that the HPLMN is selected; and\nii)\tif the preference parameter in the HPLMN's N3AN node selection information entry of the N3AN node selection information indicates that ePDG is preferred:\nA)\tif the home ePDG identifier configuration is provisioned in the N3AN node configuration information and contains an IP address, the UE shall use the IP address of the home ePDG identifier configuration as the IP address of the ePDG;\nB)\tif the home ePDG identifier configuration is provisioned in the N3AN node configuration information and does not contains an IP address, the UE shall use the FQDN of the home ePDG identifier configuration as the ePDG FQDN; and\nC)\tif the home ePDG identifier configuration is not provisioned in the N3AN node configuration information, the UE shall construct an ePDG FQDN based on the FQDN format of HPLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the HPLMN stored on the USIM as specified in clause 19 of 3GPP TS 23.003 [8]; and\n2)\tif the N3AN node configuration information is not provisioned on the UE, the UE shall construct the N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the HPLMN stored on the USIM. The UE shall consider that the HPLMN is selected;\nand for the above cases constructing or using an N3IWF FQDN or ePDG FQDN, the UE shall use the DNS server function to resolve the N3IWF FQDN or ePDG FQDN to the IP address(es) of the N3IWF(s) or ePDG(s). The UE shall select as the IP address of the N3IWF or of the ePDG a resolved IP address of an N3IWF or an ePDG with the same IP version as its local IP address. If the DNS response contains no records and the UE used an FQDN determined by following step a)-1)-i)-I), the UE shall follow the procedure in bullet a)-1)-i)-II) assuming that the extended home N3IWF identifier configuration is not provisioned. If the DNS response contains no records and the UE used an FQDN determined by following step a)-1)-i)-II), the UE shall follow the procedure in bullet a)-1)-i)-III) assuming that neither the extended home N3IWF identifier configuration nor the Slice-specific N3IWF prefix configuration is provisioned; and\nb)\tif the UE is not located in its home country:\n1)\tif the Slice-specific N3IWF prefix configuration is provisioned for the VPLMN, the UE is registered to a VPLMN via 3GPP access, the PLMN ID of VPLMN is not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", and at least one Slice-specific N3IWF prefix entry is available in the Slice-specific N3IWF prefix configuration, the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration proceure over the untrusted non-3GPP access in the VPLMN. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the VPLMN's N3AN node selection information entry in the N3AN node selection information;\n2)\tif the Slice-specific N3IWF prefix configuration is not provisioned for the VPLMN and the N3AN node configuration information is provisioned, the UE is registered to a VPLMN via 3GPP access and the PLMN ID of VPLMN is not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\":\ni)\tif an N3AN node selection information entry for the VPLMN is available in the N3AN node selection information of the N3AN node configuration information:\nA)\tif the preference parameter in the VPLMN's N3AN node selection information entry of the N3AN node configuration information indicates that N3IWF is preferred, the UE shall construct an N3IWF FQDN based on the FQDN format of the VPLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the VPLMN as specified in clause 28 of 3GPP TS 23.003 [8]. The UE shall consider that the VPLMN is selected; and\nB)\tif the preference parameter in the VPLMN's N3AN node selection information entry of the N3AN node configuration information indicates that ePDG is preferred, the UE shall construct an ePDG FQDN based on the FQDN format of the VPLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the VPLMN as specified in clause 19 of 3GPP TS 23.003 [8]. The UE shall consider that the VPLMN is selected;\nand for above case, the UE shall use the DNS server function to resolve the constructed N3IWF FQDN or ePDG FQDN to the IP address(es) of the N3IWF(s) or ePDG(s). The UE shall select as the IP address of the N3IWF or the ePDG a resolved IP address of an N3IWF or ePDG with the same IP version as its local IP address; and\n3)\tif one of the following is true:\n-\tthe UE is not registered to a PLMN via 3GPP access and the UE uses WLAN;\n-\tneither the N3AN node configuration information nor the Slice-specific N3IWF prefix configuration is provisioned; or\n-\tthe N3AN node configuration information or the Slice-specific N3IWF prefix configuration is provisioned, the UE is registered to a VPLMN via 3GPP access and:\nA)\tthe PLMN ID of VPLMN is included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\"; or\nB)\tthe N3AN node selection information entry for the VPLMN is not present in the N3AN node selection information or the Slice-specific N3IWF prefix configuration for the VPLMN is not present;\nthe UE shall perform a DNS query (see 3GPP TS 23.003 [8]) as specified in clause 7.2.4.2 to determine if the visited country mandates the selection of N3IWF in this country and:\ni)\tif selection of N3IWF in the visited country is mandatory:\nA)\tif the UE is registered to a VPLMN via 3GPP access, the PLMN ID of VPLMN is included in one of the returned DNS records and is not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall construct an N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the VPLMN as described in clause 28 of 3GPP TS 23.003 [8].The UE shall consider that the VPLMN is selected; and\nB)\tif the UE is not registered to a PLMN via 3GPP access, or the UE is registered to a VPLMN via 3GPP access and the PLMN ID of VPLMN is not included in any of the returned DNS records or is included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\":\n-\tif the UE has Slice-specific N3IWF prefix configuration for one or more PLMNs included in the DNS response excluding any VPLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration proceure over the untrusted non-3GPP access. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the selected VPLMN's N3AN node selection information entry in the N3AN node selection information\n-\tif the the Slice-specific N3IWF prefix configuration is not provisioned and the N3AN node configuration information is provisioned, the UE shall select an a PLMN included in the DNS response that has highest PLMN priority (see 3GPP TS 24.526 [17]) in the N3AN node selection information of the N3AN node configuration information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" and the UE shall construct an N3IWF FQDN based on the FQDN format of the selected PLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the selected PLMN as specified clause 28 of in 3GPP TS 23.003 [8]; and\n-\tif a) neither the Slice-specific N3IWF prefix configuration nor the N3AN node configuration information is provisioned or b) neither the Slice-specific N3IWF prefix configuration nor the N3AN node selection information of the N3AN node configuration information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" contains any of the PLMNs in the DNS response, then the selection of the PLMN is UE implementation specific. The UE shall construct an N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the selected PLMN as described clause 28 of in 3GPP TS 23.003 [8];\nand for the above cases, the UE shall use the DNS server function to resolve the constructed N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address;\nii)\tif the DNS response contains no records and the UE used Prefixed N3IWF FQDN in the DNS query, the UE shall repeat the DNS query using the same FQDN without the prefix label;\niii)\t\tif the DNS response contains no records and the UE did not use the Prefixed N3IWF FQDN in the DNS query, the UE shall further determine if the visited country mandates the selection of ePDG in the visited country using the procedure specified in clause 7.2.1.4 of 3GPP TS 24.302 [7].\nIf the UE determines that the visited country mandates the selection of ePDG in the visited country, the UE shall assume that the selection of N3IWF in the visited country is mandatory and shall continue the ePDG selection procedure in the visited country, specified in clause 7.2.1.3 of 3GPP TS 24.302 [7].\nIf the UE determines that the visited country does not mandate the selection of ePDG in the visited country, the UE shall assume that the selection of N3IWF in the visited country is not mandatory and the UE shall proceed as below:\nA)\tif the UE has Slice-specific N3IWF prefix configuration the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the selected VPLMN's N3AN node selection information entry in the N3AN node selection information;\nB)\tif the Slice-specific N3IWF prefix configuration is not provisioned and the N3AN node configuration information is provisioned and the N3AN node selection information of the N3AN node configuration information contains one or more PLMNs in the visited country which are not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall select a PLMN that has highest PLMN priority (see 3GPP TS 24.526 [17]) in the N3AN node selection information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" and the UE shall construct an N3IWF FQDN based on the FQDN format of the selected PLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the selected PLMN as specified in clause 28 of 3GPP TS 23.003 [8]; and\nC)\tif a) neither the Slice-specific N3IWF prefix configuration nor the N3AN node configuration information is provisioned or b) the Slice-specific N3IWF prefix configuration is not provisioned and the N3AN node configuration information is provisioned and the N3AN node selection information of the N3AN node configuration information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" contains no PLMN in the visited country:\n-\tif the extended home N3IWF identifier configuration is provisioned in the N3AN node configuration information, the UE shall use the IP address or the FQDN from the extended home N3IWF identifier entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration proceure over the untrusted non-3GPP access; and\n-\tif the extended home N3IWF identifier configuration is not provisioned in the N3AN node configuration information and:\n-\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information (see 3GPP TS 24.526 [17]) and contains an IP address, the UE shall use the IP address of the home N3IWF identifier configuration as the IP address of the N3IWF. The UE shall consider that the HPLMN is selected;\n-\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information (see 3GPP TS 24.526 [17]) and does not contains an IP address, the UE shall use the FQDN of the home N3IWF identifier configuration as N3IWF FQDN.The UE shall consider that the HPLMN is selected; and\n-\tif the home N3IWF identifier configuration is not provisioned in the N3AN node configuration information, the UE shall construct an N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the HPLMN as described in clause 28 of 3GPP TS 23.003 [8]. The UE shall consider that the HPLMN is selected;\nand for the above cases constructing or using an N3IWF FQDN, the UE shall use the DNS server function to resolve the N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address; and\niv)\tif no DNS response is received, the UE shall terminate the N3AN node selection procedure.\nFollowing bullet a) and b) above, once the UE selected the IP address of the N3IWF or the ePDG:\na)\tif the IP address of N3IWF is selected, the UE shall:\ni)\tinitiate the IKEv2 SA establishment procedure as specified in clause 7.3;\nii)\tif the IKEv2 SA establishment procedure towards an N3IWF in the HPLMN fails due to no response to an IKE_SA_INIT request message or the UE is informed during registration over non-3GPP access that the IMS voice over PS session is not supported over non-3GPP access, and the selection of N3IWF in the HPLMN is performed using Extended home N3IWF identifier configuration or Home identifier configuration and there are more pre-configured N3IWFs in the HPLMN, repeat the tunnel establishment attempt using the next FQDN or IP address(es) of the N3IWF in the HPLMN. The UE shall consider that the HPLMN is selected;\niii)\tif the IKEv2 SA establishment procedure towards any of the received IP addresses of the selected N3IWF fails due to no response to an IKE_SA_INIT request message or the UE is informed during registration over non-3GPP access that the IMS voice over PS session is not supported over non-3GPP access, attempt to select an ePDG in the same PLMN as specified in 3GPP TS 24.302 [7] instead;\niv)\tif the UE fails to connect to either N3IWF or ePDG in the same PLMN, repeat the N3AN node selection as described in this clause, excluding the N3IWFs for which the UE did not receive a response to the IKE_SA_INIT request message; and\nv)\tif the UE fails to connect to either N3IWF or ePDG in the VPLMN with which it is registered via 3GPP access, the UE considers the Slice-specific N3IWF prefix entry and the N3AN node selection information entry for the VPLMN as not present and the UE shall repeat the N3IWF selection as described in this clause;\nNOTE 2:\tThe time the UE waits before reattempting access to another N3IWF or to an N3IWF that it previously did not receive a response to an IKE_SA_INIT request message, is implementation specific.\nb)\tif the IP address of ePDG is selected, the UE shall:\ni)\tinitiate tunnel establishment as specified in 3GPP TS 24.302 [7];\nii)\tif tunnel establishment as specified in 3GPP TS 24.302 [7] towards an ePDG in the HPLMN fails due to no response to an IKE_SA_INIT request message, and the selection of ePDG in the HPLMN is performed using home ePDG identifier configuration and there are more pre-configured ePDG in the HPLMN, repeat the tunnel establishment attempt using the next FQDN or IP address(es) of the ePDG in the HPLMN;\niii)\tif tunnel establishment as specified in 3GPP TS 24.302 [7] towards any of the received IP addresses of the selected ePDG fails due to no response to an IKE_SA_INIT request message, attempt to select an N3IWF in the same PLMN instead. The UE shall consider the PLMN where N3IWF is, as selected;\niv)\tif the UE fails to connect to either ePDG or N3IWF in the same PLMN, repeat the N3AN node selection as described in this clause, excluding the ePDGs for which the UE did not receive a response to the IKE_SA_INIT request message; and\nv)\tif the UE fails to connect to either ePDG or N3IWF in the VPLMN with which it is registered via 3GPP access, the UE considers the N3AN node selection information entry for the VPLMN as not present in the N3AN node selection information and the UE shall repeat the N3IWF selection as described in this clause.\nNOTE 3:\tThe time the UE waits before reattempting access to another ePDG or to an ePDG that it previously did not receive a response to an IKE_SA_INIT request message, is implementation specific.\nIf the N3AN node selection is required for a non-IMS service, the UE shall ignore the preference parameter in the N3AN node selection information entries of the N3AN node selection information.\nThe UE shall proceed as follows:\na)\tif the UE is located in its home country:\n1)\tif the N3AN node configuration information is provisioned:\ni)\tif the extended home N3IWF identifier configuration is provisioned in the N3AN node configuration information, the UE shall use the IP address or the FQDN from the extended home N3IWF identifier entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access;\nii)\tif the extended home N3IWF identifier configuration is not provisioned in the N3AN node configuration information and the Slice-specific N3IWF prefix configuration is provisioned, the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry for the HPLMN whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the HPLMN's N3AN node selection information entry in the N3AN node selection information; and\niii)\tif neither the extended home N3IWF identifier configuration nor the Slice-specific N3IWF prefix configuration is provisioned in the N3AN node configuration information and:\na)\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information and contains an IP address, the UE shall use the IP address of the home N3IWF identifier configuration as the IP address of the N3IWF. The UE shall consider that the HPLMN is selected;\nb)\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information and does not contain an IP address, the UE shall use the FQDN of the home N3IWF identifier configuration as the N3IWF FQDN. The UE shall consider that the HPLMN is selected; and\nc)\tif the home N3IWF identifier configuration is not provisioned in the N3AN node configuration information, the UE shall construct an N3IWF FQDN based on the FQDN format of the HPLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the HPLMN stored on the USIM as specified in clause 28 of 3GPP TS 23.003 [8]. The UE shall consider that the HPLMN is selected; and\n2)\tif the N3AN node configuration information is not provisioned, the UE shall construct the N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the HPLMN stored on the USIM. The UE shall consider that the HPLMN is selected;\nand for the above cases constructing or using an N3IWF FQDN, the UE shall use the DNS server function to resolve the N3IWF FQDN to the IP address(es) of the N3IWF(s) or ePDG(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address. If the DNS response contains no records and the UE used an FQDN determined by following step a)-1)-i), the UE shall follow the procedure in bullet a)-1)-ii) assuming that the extended home N3IWF identifier configuration is not provisioned. If the DNS response contains no records and the UE used an FQDN determined by following step a)-1)-ii), the UE shall follow the procedure in bullet a)-1)-iii) assuming that neither the extended home N3IWF identifier configuration nor the Slice-specific N3IWF prefix configuration is provisioned; and\nb)\tif the UE is not located in its home country:\n1)\tif the Slice-specific N3IWF prefix configuration is provisioned for the VPLMN, the UE is registered to a VPLMN via 3GPP access, the PLMN ID of VPLMN is not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", and at least one Slice-specific N3IWF prefix entry is available in the Slice-specific N3IWF prefix configuration, the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access in the VPLMN. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the VPLMN's N3AN node selection information entry in the N3AN node selection information;\n2)\tif the Slice-specific N3IWF prefix configuration is not provisioned for the VPLMN and the N3AN node configuration information is provisioned, the UE is registered to a VPLMN via 3GPP access, the PLMN ID of VPLMN is not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", and an N3AN node selection information entry for the VPLMN is available in the N3AN node selection information of the N3AN node configuration information, the UE shall construct an N3IWF FQDN based on the FQDN format of the VPLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the VPLMN as specified in clause 28 of 3GPP TS 23.003 [8]. The UE shall consider that the VPLMN is selected;\nand for above case, the UE shall use the DNS server function to resolve the constructed N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address; and\n3)\tif one of the following is true:\n-\tthe UE is not registered to a PLMN via 3GPP access and the UE uses WLAN;\n-\tneither the N3AN node configuration information nor the Slice-specific N3IWF prefix configuration is provisioned; or\n-\tthe N3AN node configuration information or the Slice-specific N3IWF prefix configuration is provisioned, the UE is registered to a VPLMN via 3GPP access and:\nA)\tthe PLMN ID of VPLMN is included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\"; or\nB)\tthe N3AN node selection information entry for the VPLMN is not present in the N3AN node selection information or the Slice-specific N3IWF prefix configuration for the VPLMN is not present;\nthe UE shall perform a DNS query (see 3GPP TS 23.003 [8]) as specified in clause 7.2.4.2 to determine if the visited country mandates the selection of N3IWF in this country and:\ni)\tif selection of N3IWF in the visited country is mandatory:\nA)\tif the UE is registered to a VPLMN via 3GPP access, the PLMN ID of VPLMN is included in one of the returned DNS records and is not included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall construct an N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the VPLMN as described in clause 28 of 3GPP TS 23.003 [8]. The UE shall consider that the VPLMN is selected; and\nB)\tif the UE is not registered to a PLMN via 3GPP access or the UE is registered to a VPLMN via 3GPP access and the PLMN ID of VPLMN is not included in any of the returned DNS records or is included in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\":\n- \tif the UE has Slice-specific N3IWF prefix configuration for one or more PLMNs included in the DNS response excluding any VPLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration proceure over the untrusted non-3GPP access. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the selected VPLMN's N3AN node selection information entry in the N3AN node selection information;\n-\tif the Slice-specific N3IWF prefix configuration is not provisioned and the N3AN node configuration information is provisioned, the UE shall select an a PLMN included in the DNS response that has highest PLMN priority (see 3GPP TS 24.526 [17]) in the N3AN node selection information of the N3AN node configuration information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" and the UE shall construct an N3IWF FQDN based on the FQDN format of the selected PLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the selected PLMN as specified in clause 28 of 3GPP TS 23.003 [8]; and\n-\tif a) neither the Slice-specific N3IWF prefix configuration nor the N3AN node configuration information is provisioned or b) neither the Slice-specific N3IWF prefix configuration nor the N3AN node selection information of the N3AN node configuration information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" contains any of the PLMNs in the DNS response, then the selection of the PLMN is UE implementation specific. The UE shall construct an N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the selected PLMN as described in clause 28 of 3GPP TS 23.003 [8];\nand for the above cases, the UE shall use the DNS server function to resolve the constructed N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address;\nii)\tif the DNS response contains no records and the UE used Prefixed N3IWF FQDN in the DNS query, the UE shall repeat the DNS query using the same FQDN without the prefix label;\niii) if the DNS response contains no records and the UE did not use the Prefixed N3IWF FQDN in the DNS query, the UE shall further determine if the visited country mandates the selection of ePDG in the visited country using the procedure specified in clause 7.2.1.4 of 3GPP TS 24.302 [7].\nIf the UE determines that the visited country mandates the selection of ePDG in the visited country, the UE shall assume that the selection of N3IWF in the visited country is mandatory and shall continue the ePDG selection procedure in the visited country, specified in clause 7.2.1.3 of 3GPP TS 24.302 [7].\nIf the UE determines that the visited country does not mandate the selection of ePDG in the visited country, the UE shall assume that the selection of N3IWF in the visited country is not mandatory and the UE shall proceed as follows:\nA)\tif the UE has Slice-specific N3IWF prefix configuration the UE shall construct a Prefixed N3IWF FQDN (see 3GPP TS 23.003 [8]) using the prefix of the Slice-specific N3IWF prefix entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration procedure over the untrusted non-3GPP access. The FQDN format (operator identifier or tracking area identity based) is determined from the FQDN format of the selected VPLMN's N3AN node selection information entry in the N3AN node selection information;\nB)\tif the Slice-specific N3IWF prefix configuration is not provisioned and the N3AN node configuration information is provisioned and the N3AN node selection information of the N3AN node configuration information contains one or more PLMNs in the visited country which are not in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\", the UE shall select a PLMN that has highest PLMN priority (see 3GPP TS 24.526 [17]) in the N3AN node selection information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" and the UE shall construct an N3IWF FQDN based on the FQDN format of the selected PLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the selected PLMN as specified in clause 28 of 3GPP TS 23.003 [8]; and\nC)\tif a) neither the Slice-specific N3IWF prefix configuration nor the N3AN node configuration information is provisioned or b) the Slice-specific N3IWF prefix configuration is not provisioned and the N3AN node configuration information is provisioned and the N3AN node selection information of the N3AN node configuration information excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\" contains no PLMN in the visited country:\n-\tif the extended home N3IWF identifier configuration is provisioned in the N3AN node configuration information, the UE shall use the IP address or the FQDN from the extended home N3IWF identifier entry whose S-NSSAI list has the best match with the Requested S-NSSAI(s) that the UE is going to use in the registration proceure over the untrusted non-3GPP access; and\n-\tif the extended home N3IWF identifier configuration is not provisioned in the N3AN node configuration information and:\n-\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information (see 3GPP TS 24.526 [17]) and contains an IP address, the UE shall use the IP address of the home N3IWF identifier configuration as the IP address of the N3IWF.The UE shall consider that the HPLMN is selected;\n-\tif the home N3IWF identifier configuration is provisioned in the N3AN node configuration information (see 3GPP TS 24.526 [17]) and does not contain an IP address, the UE shall use the FQDN of the home N3IWF identifier configuration as N3IWF FQDN. The UE shall consider that the HPLMN is selected; and\n-\tif the home N3IWF identifier configuration is not provisioned in the N3AN node configuration information, the UE shall construct an N3IWF FQDN based on the Operator Identifier FQDN format using the PLMN ID of the HPLMN as described in clause 28 of 3GPP TS 23.003 [8]. The UE shall consider that the HPLMN is selected;\nand for the above cases constructing or using an N3IWF FQDN, the UE shall use the DNS server function to resolve the N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address; and\niv)\tif no DNS response is received, the UE shall terminate the N3AN node selection procedure.\nFollowing bullet a) and b) above, once the UE selected the IP address of the N3IWF:\na)\tif the IP address of N3IWF is selected, the UE shall:\n1)\tinitiate the IKEv2 SA establishment procedure as specified in clause 7.3;\n2)\tif the IKEv2 SA establishment procedure towards an N3IWF in the HPLMN fails due to no response to an IKE_SA_INIT request message, and the selection of N3IWF in the HPLMN is performed using Extended home N3IWF identifier configuration or Home identifier configuration and there are more pre-configured N3IWFs in the HPLMN, repeat the tunnel establishment attempt using the next FQDN or IP address(es) of the N3IWF in the HPLMN;\n3)\tif the IKEv2 SA establishment procedure towards any of the IP addresses of the N3IWF of the selected PLMN fails due to no response to an IKE_SA_INIT request message, repeat the N3AN node selection as described in this clause with N3IWF of another PLMN;\n4)\tif the IKEv2 SA establishment procedure towards any of the received IP addresses of the N3IWF of any fails due to no response to an IKE_SA_INIT request message, attempt to select an ePDG as specified in 3GPP TS 24.302 [7] and use tunnel establishment as specified in 3GPP TS 24.302 [7]; and\n5)\tif the UE fails to connect to either N3IWF or ePDG in the VPLMN with which it is registered via 3GPP access, the UE considers the Slice-specific N3IWF prefix entry and the N3AN node selection information entry for the VPLMN as not present in the N3AN node selection information and the UE shall repeat the N3IWF selection as described in this clause;\nNOTE 1:\tThe time the UE waits before reattempting access to another N3IWF or to an N3IWF that it previously did not receive a response to an IKE_SA_INIT request message, is implementation specific.\nb)\tif the IP address of ePDG is selected, the UE shall:\ni)\tinitiate tunnel establishment as specified in 3GPP TS 24.302 [7];\nii)\tif tunnel establishment as specified in 3GPP TS 24.302 [7] towards an ePDG in the HPLMN fails due to no response to an IKE_SA_INIT request message, and the selection of ePDG in the HPLMN is performed using home ePDG identifier configuration and there are more pre-configured ePDG in the HPLMN, repeat the tunnel establishment attempt using the next FQDN or IP address(es) of the ePDG in the HPLMN;\niii)\tif tunnel establishment as specified in 3GPP TS 24.302 [7] towards any of the received IP addresses of the selected ePDG fails due to no response to an IKE_SA_INIT request message, attempt to select an N3IWF in the same PLMN instead. The UE shall consider the PLMN where N3IWF is, as selected;\niv)\tif the UE fails to connect to either ePDG or N3IWF in the same PLMN, repeat the N3AN node selection as described in this clause, excluding the ePDGs for which the UE did not receive a response to the IKE_SA_INIT request message; and\nv)\tif the UE fails to connect to either ePDG or N3IWF in the VPLMN with which it is registered via 3GPP access, the UE considers the N3AN node selection information entry for the VPLMN as not present in the N3AN node selection information and the UE shall repeat the N3IWF selection as described in this clause.\nNOTE 2:\tThe time the UE waits before reattempting access to another ePDG or to an ePDG that it previously did not receive a response to an IKE_SA_INIT request message, is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.5\tSelection of an N3AN node in an SNPN",
                            "text_content": "In order to access SNPN services via a PLMN or via untrusted non-3GPP access network, an SNPN enabled UE is configured with an N3IWF FQDN for the SNPN and with an MCC of the country where the configured N3IWF is located. To select an N3IWF in an SNPN, the UE shall first determine the country in which the UE is located. If the UE cannot determine the country in which the UE is located, the UE shall stop the SNPN N3IWF selection. If the UE can determine the country in which the UE is located, the UE shall proceed as follows:\nNOTE 1:\tIt is up to UE implementation how the UE determines the country in which the UE is located.\na)\tif the UE is located in the country where the configured N3IWF is located, the UE shall use the configured N3IWF FQDN for the SNPN N3IWF selection. The UE shall consider that the subscribed SNPN is selected; or\nb)\tif the UE is located in a country different from the country where the configured N3IWF is located:\n1)\tthe UE shall construct a Visited Country FQDN for SNPN N3IWF selection as specified in 3GPP TS 23.003 [8]; and\n2)\tthe UE shall perform the DNS NAPTR query using the constructed Visited Country FQDN for SNPN N3IWF selection. If:\ni)\tthe result of this DNS query includes:\nA)\ta set of one or more records, the UE shall select an N3IWF FQDN included in the DNS response based on UE implementation means and use the selected N3IWF FQDN for the SNPN N3IWF selection. The UE shall consider that the subscribed SNPN is selected; or\nNOTE 2:\tIf the visited country mandates the selection of the N3IWF in this country and the SNPN does not have the N3IWF in this country, DNS resolution of the selected N3IWF FQDN provides no IP addresses, resulting into stop of the SNPN N3IWF selection.\nNOTE 3:\tThe identity (i.e. in the corresponding DNS record) of an SNPN's N3IWF in the visited country can be any FQDN and is not required to include the SNPN identity.\nB)\tno records, the UE shall use the configured N3IWF FQDN for the SNPN N3IWF selection. The UE shall consider that the subscribed SNPN is selected; or\nii)\tthere is no response to the DNS query, the UE shall stop the SNPN N3IWF selection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.6\tN3AN node selection for emergency services",
                            "text_content": "If the UE is connected to an N3IWF that is in the same country as the country in which the UE is currently in and the AMF has previously indicated support for emergency services over non-3GPP access (see 3GPP TS 24.501 [4]), the UE shall use the existing N3IWF connection for emergency services. Otherwise, the UE shall perform the IKEv2 deletion procedure for the existing N3IWF connection and initiate N3AN node selection procedure for emergency services as described below.\nWhen the UE supports connectivity with N3IWF but does not support connectivity with ePDG, the UE shall perform the procedure in clause 7.2.6.2 for selecting an N3IWF for emergency services.\nWhen the UE supports connectivity with N3IWF and ePDG, the UE shall perform the procedure in clause 7.2.6.3 for selecting either an N3IWF or an ePDG for emergency services.\nIf the UE is in the home country, the UE shall follow the procedure in clause 7.2.4.3 bullet a).\nIf the UE is in a visited country, the UE shall perform the DNS NAPTR query using Visited Country Emergency N3IWF FQDN as specified in 3GPP TS 23.003 [8] via the non-3GPP access network to determine PLMNs in the visited country that support emergency services in non-3GPP access via N3IWF. If the DNS response contains one or more records, the UE shall select a PLMN included in the DNS response that has highest PLMN priority (see 3GPP TS 24.526 [17]) in the N3AN node selection information, excluding any PLMN in the list of \"forbidden PLMNs for non-3GPP access to 5GCN\". The UE shall construct an N3IWF FQDN based on the FQDN format of the selected PLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the selected PLMN as specified in 3GPP TS 23.003 [8]. If none of the PLMNs included in the DNS response figures in the N3AN node selection information or the N3AN node selection information is not provisioned, the UE shall select any of the PLMNs included in the DNS response and shall construct an N3IWF FQDN based on the Operator Identifier based N3IWF FQDN format.\nIf the emergency registration procedure has failed for all attempted PLMNs, or the DNS response in the visited country does not contain any record, the UE shall abort the procedure.\nNOTE: The UE can notifiy the user that an emergency session cannot be established.\nThe UE operating in SNPN access operation mode with a selected entry of \"list of subscriber data\" shall perform following procedures:\na)\tif the selected entry is not considered as valid, the UE may:\n1)\tselect another valid entry of \"list of subscriber data\", if any, such that the UE is in the country where the configured N3IWF of the entry is located, which has not been tried yet, and proceed to bullet b) 1);\n2)\tselect another valid entry of \"list of subscriber data\", if any, such that the UE is not in the country where the configured N3IWF of the entry is located, which has not been tried yet, and proceed to bullet b) 2);\n3)\tstop operating in SNPN access operation mode and attempt to perform UE procedure as specified in clause 7.2.6.2; or\n4)\tabort the procedure; and\nNOTE:\tThe UE can notify the user that an emergency session cannot be established if the UE abort the procedure.\nb)\tif the selected entry is considered as valid and:\n1)\tthe UE is in the home country, i.e. in the country where the configured N3IWF of the selected entry of \"list of subscriber data\" is located, the UE shall follow the procedure in clause 7.2.5 bullet a). If the emergency registration procedure has failed, the UE may proceed to bullet a) 1), a) 2), a) 3) or a) 4); or\n2)\tthe UE is in a visited country, i.e. in a country other than the country where the configured N3IWF of the selected entry of \"list of subscriber data\" is located, the UE shall perform the DNS NAPTR query using Visited Country Emergency SNPN N3IWF FQDN as specified in 3GPP TS 23.003 [8] via the non-3GPP access network to determine SNPNs in the visited country that support emergency services in non-3GPP access via N3IWF:\ni)\tif the DNS response contains one or more records, the UE shall select an SNPN included in the DNS response via UE implementation means and construct an N3IWF FQDN based on the FQDN format of the selected SNPN as specified in 3GPP TS 23.003 [8] for N3IWF selection. The UE shall use the DNS server function to resolve the contructed SNPN N3IWF FQDN to the IP address(es) of the N3IWF:\nI)\tif the DNS response contains one or more IP addresses of N3IWF, the UE shall select an IP address of N3IWF with the same IP version as its local IP address, if any, and initiate the procedure as specified in clause 7.3; and\nII)\tif the DNS resolution of contructed SNPN N3IWF FQDN fails, or the the emergency registration procedure in the bullet above has failed, the UE shall select another SNPN, if any, included in the DNS response and repeat the procedure as specified in bullet b) 2) i); and\nii)\tif the DNS response contains no record, or no DNS response is received, or the emergency registration procedure has failed for all the SNPNs included in the DNS response as specified bullet b) 2) i), the UE may proceed to bullet a) 1), a) 2) or a) 3).\nIf the UE is in the home country, the UE shall follow the steps in clause 7.2.4.4.2 bullet a), except that:\n-\tin bullet a)1)i), if the emergency registration fails, the UE shall attempt to select an ePDG in the home country using the steps under bullet a)1)ii); and\n-\tin bullet a)1)ii):\n-\tEmergency ePDG FQDN shall be used instead of home ePDG identifier; and\n-\tIf the emergency registration fails, the UE shall attempt to select an N3IWF in the home country using the steps under bullet a)1)i).\nIf the UE is in a visited country, the UE shall perform the DNS NAPTR query using Visited Country Emergency N3IWF FQDN and Visited Country Emergency FQDN as specified in 3GPP TS 23.003 [8] via the non-3GPP access network to determine PLMNs in the visited country that support emergency services in non-3GPP access via N3IWF or ePDG. If the DNS response contains one or more records, the UE shall select a PLMN included in the DNS response that has highest PLMN priority (see 3GPP TS 24.526 [17]) in the N3AN node selection information.\n-\tIf the N3AN node selection information for the PLMN is available the UE selects first an N3IWF or ePDG based on the the preference parameter in the selected PLMN's N3AN node selection information entry of the N3AN node selection information. If N3IWF is preferred, the UE constructs the N3IWF FQDN based on the FQDN format of the selected PLMN's N3AN node selection information entry in the N3AN node selection information using the PLMN ID of the selected PLMN as specified in 3GPP TS 23.003 [8]. If ePDG is preferred, the UE constructs either the Tracking/Location Area Identity based Emergency ePDG FQDN or the Operator Identifier based Emergency ePDG FQDN as indicated by the FQDN format in the N3AN node selection information for the selected PLMN.\n-\tIf the N3AN node selection information is not available, the UE shall follow the procedure in clause 7.2.6.2, except that, instead of aborting the procedure in case of a failure, the UE shall perform the procedure for ePDG selection for emergency services specified in 3GPP TS 24.302 [7], by constructing the Operator Identifier based Emergency ePDG FQDN.\nIf the emergency registration procedure has failed for all attempted PLMNs, the UE shall abort the procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.7\tN3AN node selection based on N3IWF identifier information provided to the UE in the REGISTRATION REJECT message",
                            "text_content": "If the UE that supports slice-based N3IWF selection receives N3IWF identifier IE in the REGISTRATION REJECT message as specified in 3GPP TS 24.501 [4], and re-attempts the registration procedure with the same requested NSSAI over untrusted non-3GPP access, the UE shall proceed as follows:\na)\tif the N3IWF identifier IE contains an IP address, the UE shall use that IP address as the IP address of the N3IWF; or\nb)\tif the N3IWF identifier IE contains an FQDN, the UE shall use that FQDN as the FQDN of the N3IWF and shall use the DNS server function to resolve the N3IWF FQDN to the IP address(es) of the N3IWF(s). The UE shall select as the IP address of the N3IWF a resolved IP address of an N3IWF with the same IP version as its local IP address; and\nonce the UE has selected the IP address of the N3IWF, the UE shall initiate the IKEv2 SA establishment procedure as specified in clause 7.3.\nIf the IKEv2 SA establishment procedure towards the selected N3IWF fails due to no response to an IKE_SA_INIT request message, the UE shall repeat the N3AN node selection procedure but with considering the N3AN node configuration information provisioned to the UE as specified in clause 7.2.1.\nNOTE:\tThe time the UE waits before reattempting access to another N3IWF or to an N3IWF that it previously did not receive a response to an IKE_SA_INIT request message, is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.8\tN3IWF selection for onboarding SNPN",
                            "text_content": "In order to access SNPN for onboarding services via untrused non-3GPP access network, an SNPN enabled UE shall determine if it is located in the same country as the configured N3IWF for onboarding, called home country, and proceed as follows:\na)\tIf the UE determines that it is in the home country, the UE shall use the pre-configured N3IWF FQDN for onboarding services in SNPN to select an N3IWF supporting onboarding services in SNPN; and\nb)\tIf the UE determines that it is in not in the home country the UE shall consider itself as located in a visited country and perform a NAPTR DNS query using the Visited Country FQDN for N3IWF supporting Onboarding, as specified in 3GPP TS 23.003 [8]. Depending on the DNS response, the UE shall proceed as follows:\ni)\tIf no response is received, the UE shall stop the N3IWF selection for onboarding services in SNPN;\nii)\tIf the response is received but contains no records, the UE determines that the visited country does not mandate the selection of an N3IWF in the same country and perform actions specified under the home country scenario in bullet a); and\niii)\tOtherwise, the UE shall select one SNPN ID in implementation specific way from the record(s) received in the response and construct the Visited Country FQDN for SNPN N3IWF supporting Onboarding based on the selected SNPN ID, as specified in 3GPP TS 23.003 [8]. If the N3IWF selection for onboarding services in SNPN using the selected SNPN ID fails, the UE shall select another SNPN ID from the record(s) received in the response, if any, and re-attempt N3IWF selection. After the UE has unsuccessfully tried all the SNPN ID(s) from the record(s) received in the response, the UE shall stop the N3IWF selection for onboarding services in SNPN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.3\tIKE SA establishment procedure for untrusted non-3GPP access",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.3.1\tGeneral",
                            "text_content": "The purpose of this procedure is to establish a secure connection between the UE and the N3IWF over NWu, which is used to securely exchange the NAS signalling messages between the UE and the AMF via the N3IWF. The UE establishes the secure connection by establishing an IKE SA and first child SA to the N3IWF. The IKE SA and first child SA, called signalling IPsec SA, are created between the UE and the N3IWF after the IKE_SA_INIT exchange and after the IKE_AUTH exchange (see IETF RFC 7296 [6]). The signalling IPsec established is used to transfer NAS signalling traffic. Additional child SAs (user plane IPsec SAs) can be established between the UE and the N3IWF to transfer user-plane traffic (see clause 7.5).\nUpon completion of the N3IWF selection procedure (clause 7.2) the UE initiates an IKE_SA_INIT exchange as specified in IETF RFC 7296 [6]. Upon reception of the IKE_SA_INIT response the UE shall inform the upper layers that the access stratum connection is established.\nUpon establishment of the access stratum connection, the UE initiates IKE_AUTH exchange (see IETF RFC 7296 [6]) with EAP-5G encapsulation, as specified in clause 7.3.2.\nThe UE encapsulates the initial NAS message and the AN parameters using the EAP-5G procedure as described in clause 7.3.3. The signalling IPsec SA is established after completion of the EAP-5G procedure and IKE_AUTH exchange.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.2\tIKE SA and signalling IPsec SA establishment procedure",
                            "text_content": "The UE proceeds with the establishment of IKE SA and signalling IPsec SA with the selected N3IWF by initiating an IKE_SA_INIT exchange according to IETF RFC 7296 [6]. All the IKE messages following the IKE_SA_INIT exchange are encrypted and integrity protected using the cryptographic algorithms and keys negotiated in the IKE_SA_INIT exchange as specified in IETF RFC 7296 [6].\nUpon completion of the IKE_SA_INIT exchange, the UE shall initiate an IKE_AUTH exchange as specified in IETF RFC 7296 [6] to establish an IKE SA and first child SA (signalling IPsec SA). In the initial IKE_AUTH request message, the UE shall:\n-\tindicate the intention to use EAP by not including the AUTH payload;\n-\tinclude the IDi payload with the ID type set to ID_KEY_ID and value set to any random number;\n-\tinclude CERTREQ payload to request N3IWF's certificate if the UE is provisioned with the N3IWF root certificate; and\n-\tinclude the HPA_INFO Notify payload, as defined in 3GPP TS 24.302 [7], within the IKE_AUTH request message if the UE has a valid Access Identity 1 as specified in clause 4.5.2 of 3GPP TS 24.501 [4];\nas specified in IETF RFC 7296 [6].\nUpon reception of the IKE_AUTH request message, the N3IWF shall respond with an IKE_AUTH response message including:\n-\tan EAP-Request/5G-Start packet to inform the UE an EAP-5G session that will be used to convey the initial NAS messages (see the EAP-5G procedure described in clause 7.3.3);\n-\tthe IDr payload with the value set to N3IWF identifier; and\nNOTE:\tThe N3IWF identifier is the IP address or the FQDN of the N3IWF.\n-\tthe CERT payload containing the N3IWF's certificate if the CERTREQ payload is included in the IKE_AUTH request message.\nUpon reception of the IKE_AUTH request message containing an HPA_INFO Notify Payload, as defined in 3GPP TS 24.302 [7], with the HPA_INFO field indicating a UE configured for MPS access, the N3IWF may, if allowed by operator policy, treat further messages for the UE with MPS priority. Unless doing so would cause network instability, the N3IWF should not reject requests from UEs which the N3IWF is treating with MPS priority access.\nIf IKE SA and signalling IPsec SA establishment is accepted by the network, the UE receives from the N3IWF an IKE_AUTH response message containing an EAP-Success message (as shown in figure 7.3.2-1), which completes the EAP-5G session. No further EAP-5G packets are exchanged.\nThe UE completes the IKE SA and signalling IPsec SA (first child SA) establishment procedure by initiating an IKE_AUTH exchange including an AUTH payload computed based on the N3IWF key as described in 3GPP TS 33.501 [5].\nIn the initial IKE_AUTH request message the UE shall include:\n-\tthe INTERNAL_IP4_ADDRESS attribute, the INTERNAL_IP6_ADDRESS attribute, or both, indicating the type of IP address to be used for the IP tunnels, in the CFG_REQUEST configuration payload. The INTERNAL_IP4_ADDRESS attribute shall contain no value and the length field shall be set to 0. The INTERNAL_IP6_ADDRESS attribute shall contain no value and the length field shall be set to 0; and\n-\tthe MOBIKE_SUPPORTED notify payload as specified in IETF RFC 4555 [23] if the UE supports IETF RFC 4555 [23].\nThe N3IWF shall include in the IKE_AUTH response message containing the AUTH payload:\n-\ta single CFG_REPLY Configuration Payload including the INTERNAL_IP4_ADDRESS attribute with an IPv4 address assigned to the UE, the INTERNAL_IP6_ADDRESS attribute with an IPv6 address assigned to the UE, or both;\n-\tthe NAS_IP4_ADDRESS notify payload with an N3IWF IPv4 address assigned to transport of NAS messages, if the initial IKE_AUTH request message contained a CFG_REQUEST configuration payload with the INTERNAL_IP4_ADDRESS attribute and NAS messages are to be transmitted using IPv4 based inner IP tunnel;\n-\tthe NAS_IP6_ADDRESS notify payload with an N3IWF IPv6 address assigned to transport of NAS messages if the initial IKE_AUTH request message contained a CFG_REQUEST configuration payload with the INTERNAL_IP6_ADDRESS attribute and NAS messages are to be transmitted using IPv6 based inner IP tunnel;\n-\tthe NAS_TCP_PORT notify payload with an N3IWF TCP port number assigned to transport of NAS messages; and\n-\tthe MOBIKE_SUPPORTED notify payload as specified in IETF RFC 4555 [23], if the initial IKE_AUTH request message contained a MOBIKE_SUPPORTED configuration payload with the INTERNAL_IP4_ADDRESS attribute.\nThe UE may support the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as specified in 3GPP TS 24.302 [7] clause 8.2.4.2. If the UE supports the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute, the UE shall include the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute indicating support of receiving timeout period for liveness check in the CFG_REQUEST configuration payload within the IKE_AUTH request message.\nThe N3IWF may include the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as specified in 3GPP TS 24.302 [7] clause 8.2.4.2 indicating the timeout period for liveness check in the CFG_REPLY configuration payload of the IKE_AUTH response message containing the AUTH payload. Presence of the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute in the IKE_AUTH request can be used as input for decision on whether to include the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute in the IKE_AUTH response message containing the AUTH payload.\nIf the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as specified in 3GPP TS 24.302 [7] clause 8.2.4.2 indicating the timeout period for the liveness check is included in the CFG_REPLY configuration payload within the IKE_AUTH response message containing the AUTH payload or the UE has a pre-configured or configured timeout period, the UE shall perform the liveness check procedure as described in clause 7.8.\nNOTE:\tThe timeout period for liveness check is pre-configured in the UE in implementation specific way.\nThis completes the establishment of the IKE SA and signalling IPsec SA (first child SA) between the UE and the N3IWF. Upon completion of the IKE SA and signalling IPsec SA (first child SA) establishment between the UE and the N3IWF, the UE and the N3IWF shall send further NAS messages over the TCP connection within the signalling IPsec SA (first child SA) (see example in figure 7.3.2.2-1).\nAn example of an IKE SA and first child SA establishment procedure is shown in figure 7.3.2.2-1.\nThe given telecommunication figure depicts a 3GPP-based setup for the establishment of a first-child SA (Service Access) for a UE (User Equipment) over an untrusted non-3GPP access network. The figure illustrates the process of establishing a first-child SA, which is a crucial step in ensuring secure communication over an untrusted network. The figure includes various components such as the 3GPP-based network, the first-child SA, and the UE, all of which are essential for the successful establishment of the first-child SA.\nFigure 7.3.2.2-1: IKE SA and first child SA establishment procedure for UE registration over untrusted non-3GPP access\nIf IKE SA and signalling IPsec SA establishment is not accepted by the network, the UE receives from the N3IWF an IKE_AUTH response message including a Notify payload with an error type.\nUpon receiving the IKE_AUTH response message with a Notify payload with an error type other than a CONGESTION Notify payload, the UE shall pass the error indication to the upper layer along with the encapsulated NAS messages, if any, within EAP/5G-NAS packet.\nAfter the N3IWF receives from the UE an IKE_AUTH request message, the N3IWF shall construct an IKE_AUTH response message including a CONGESTION Notify payload as defined in clause 9.2.4.2 and a N3GPP_BACKOFF_TIMER Notify payload as defined in clause 9.3.1.7. if the N3IWF decides to not accept the IKE SA and signalling IPsec SA establishment based on the OVERLOAD START message received from the AMF(s) as specified in 3GPP TS 29.413 [39].\nNOTE:\tThe N3IWF can also due to internal congestion construct an IKE_AUTH response message including a CONGESTION Notify payload as defined in clause 9.2.4.2 and a N3GPP_BACKOFF_TIMER Notify payload as defined in clause 9.3.1.7 and send it to the UE.\nBased on regional/national requirements and network operator policy, unless doing so would cause network instability, the N3IWF may exempt a UE that is being treated with MPS priority (e.g., as identified in clause 7.3.2.1 or 7.3A.2.2) from congestion controls.\nThe N3IWF shall send the IKE_AUTH response message to the UE. Upon reception of the IKE_AUTH response message including:\na)\ta CONGESTION Notify payload as defined in clause 9.2.4.2; and\nb)\ta N3GPP_BACKOFF_TIMER Notify payload as defined in clause 9.3.1.7; and\nafter the UE authenticates the network or the N3IWF as specified in 3GPP TS 33.501 [5], the UE shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA as specified in IETF RFC 7296 [6]. In addition, the UE shall inform the upper layers that the access stratum connection has been released, and:\na)\tif the back-off timer value in N3GPP_BACKOFF_TIMER Notify payload indicates neither zero nor deactivated, the UE shall start the Tw3 timer with the value provided and the UE shall not retry the IKE SA and signalling IPsec SA establishment procedure to the same N3IWF until:\n-\ttimer Tw3 expires;\n-\tthe UE is switched off;\n-\tthe UICC containing the USIM is removed;\n-\tan access attempt occurs due to emergency services; or\n-\tthe UE needs to request one or more S-NSSAIs that were not included in the requested NSSAI provided to the N3IWF previously;\nb)\tif the back-off timer value in N3GPP_BACKOFF_TIMER Notify payload indicates that this timer is deactivated, the UE shall not retry the IKE SA and signalling IPsec SA establishment procedure to the same N3IWF until:\n-\tthe UE is switched off;\n-\tthe UICC containing the USIM is removed;\n-\tan access attempt occurs due to emergency services; or\n-\tthe UE needs to request one or more S-NSSAIs that were not included in the requested NSSAI provided to the N3IWF previously; and\nc)\tif the back-off timer value in N3GPP_BACKOFF_TIMER Notify payload indicates zero, the UE may retry the IKE SA and signalling IPsec SA establishment procedure to an N3IWF from the same PLMN.\nUpon receiving the IKE_AUTH response message with a Notify payload with an error type, if the EAP-5G session establishment has already been started, the UE shall perform a local termination of the EAP-5G session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.3\tEAP-5G session over non-3GPP access",
                            "text_content": "A vendor-specific EAP method (EAP-5G) is used to encapsulate NAS messages between the UE and the N3IWF. The EAP-5G packets utilize the \"Expanded\" EAP type and the existing 3GPP Vendor-Id registered with IANA under the SMI Private Enterprise Code registry (i.e. 10415). The EAP-5G method is utilized only for encapsulating the NAS messages. The EAP-5G method is not utilized to authenticate the UE in untrusted non-3GPP network.\nThe UE and the N3IWF shall exchange EAP-5G messages within IKE_AUTH request and IKE_AUTH response messages. The N3IWF on reception of an IKE_AUTH request with no AUTH payload shall start an EAP-5G session by sending an EAP-Request/5G-Start message.\nThe UE acknowledges start of the EAP-5G session by sending an EAP-Response/5G-NAS message which shall include:\na)\ta NAS-PDU field containing a NAS message, for example, a REGISTRATION REQUEST message; and\nb)\tan AN-parameters field containing access network parameters, such as GUAMI, selected PLMN ID, requested NSSAI, establishment cause, selected NID if the UE is accessing SNPN services via a PLMN or the UE is accessing SNPN services via untrusted non-3GPP access network, and onboarding indication if the UE is accessing SNPN for onboarding services in SNPN via untrusted non-3GPP access network (see 3GPP TS 23.502 [3]).\nNOTE 1:\tIf and how the UE includes the requested NSSAI as a part of the access type depends on the NSSAI inclusion mode IE as specified in 3GPP TS 24.501 [4].\nThe N3IWF handles access attempts with the establishment cause \"mps-PriorityAccess\" with high priority and rejects these access attempts only in extreme network load conditions that may threaten network stability.\nThe N3IWF, on reception of NAS messages from the UE within an EAP-Response/5G-NAS message, shall forward the NAS message to the AMF.\nThe N3IWF, on reception of NAS messages from the AMF, shall include the NAS message within an EAP-Request/5G-NAS message. The N3IWF shall transmit the EAP-Request/5G-NAS message to the UE.\nNOTE 2:\tThe N3IWF is transparent to the NAS messages and as an intermediate network entity only conveys transparently the NAS messages between the UE and the AMF.\nThe EAP-Request/5G-NAS message shall include a NAS-PDU field that contains a NAS message.\nFurther NAS messages between the UE and the AMF, via the N3IWF, shall be inserted in NAS-PDU field of an EAP-Response/5G-NAS (UE to N3IWF direction) and EAP-Request/5G-NAS (N3IWF to UE direction) message.\nUpon completion of successful authentication and on reception of the N3IWF key from the AMF, the N3IWF shall complete the EAP-5G session by sending an EAP-Success message.\nOn reception of the EAP-Success message from the N3IWF, the UE proceeds to establish an IKE SA and signalling IPsec SA as described in clause 7.3.2.\nAn example of an EAP-5G session after successful authentication is shown in figure 7.3.3.2-1.\nThe figure depicts a 3GPP-compliant EAP-5G session for successful UE registration over an untrusted non-3GPP access. The session includes a secure channel for secure communication, a non-secure channel for non-secure communication, and a fallback channel for fallback communication. The figure illustrates the use of encryption, authentication, and other security measures to ensure the secure communication of the UE.\nFigure 7.3.3.2-1: EAP-5G session for successful UE registration over untrusted non-3GPP access\nUpon receiving indication from the upper layer that no 5G-NAS messages need to be transmitted between the UE and N3IWF, the UE shall terminate the EAP-5G session by sending an EAP-Response/5G-Stop message to the N3IWF.\nOn reception of EAP-Response/5G-Stop message, the N3IWF shall complete the EAP-5G session by sending an EAP-Failure message to the UE.\nOn reception of the EAP-Failure message from the N3IWF, the UE shall delete any context related to IKE SA without requiring an explicit INFORMATIONAL exchange carrying a Delete payload as specified in IETF RFC 7296 [6].\nFigure 7.3.3.3-1 shows an example the EAP-5G session completion after registration reject.\nThe figure depicts a scenario where an EAP-5G session is initiated when the UE's registration over an untrusted non-3GPP access is rejected. The figure shows the UE's registration process, including the steps taken to authenticate the UE and the network's response to the registration. The figure also highlights the importance of network security and the need for a secure connection to ensure the integrity of the data being transmitted.\nFigure 7.3.3.3-1: EAP-5G session when the UE's registration over untrusted non-3GPP access is rejected\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.4\tAbnormal cases in the UE",
                            "text_content": "Apart from the cases specified in IETF RFC 7296 [6], no abnormal cases have been identified.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.5\tAbnormal cases in the N3IWF",
                            "text_content": "Apart from the cases specified in IETF RFC 7296 [6], no abnormal cases have been identified.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.6\tProcedures for UE behind the 5G-RG accessing 5GC via untrusted non-3GPP access network",
                            "text_content": "In wireline access, the UE behind the 5G-RG can access 5GC via untrusted non-3GPP access network.\nNOTE:\tThe UE behind the 5G-RG can also access the 5GC directly through 3GPP access.\nFor the 5G-RG to provide connectivity to the UE behind it to access the 5GC via untrusted non-3GPP access network, the 5G-RG registers to the 5GC and establishes a PDU session as described in 3GPP TS 23.316 [40]. In order to achieve that:\na)\tif the 5G-RG is connected to the 5GC through W-AGF, the 5G-RG shall first establish signalling connection using the W-CP protocol as described in clause 6.3.1, before proceeding with the registration procedure and the PDU session establishment procedure using the procedures specified in 3GPP TS 24.501 [4]; or\nb)\tif the 5G-RG is connected to the 5GC through NG-RAN, the 5G-RG proceeds directly with the registration procedure and the PDU session establishment procedure using the procedures specified in 3GPP TS 24.501 [4].\nThe EAP messages, control and user plane packets of the UE behind the 5G-RG are transported using the 5G-RG established PDU session as user data packets as described in 3GPP TS 23.316 [40].\nThe exchange of EAP messages between the UE behind the 5G-RG and the N3IWF is handled as specified from clause 7.3.1 till clause 7.3.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.3A\tIKE SA establishment procedure for trusted non-3GPP access",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.3A.1\tGeneral",
                            "text_content": "A trusted non-3GPP access network (TNAN) includes a trusted non-3GPP access point (TNAP) and a trusted non-3GPP gateway function (TNGF). The TNAN and a UE initiate an exchange of EAP-Request and EAP-Response messages including Identity as specified in IETF RFC 3748 [9] for link layer authentication of the UE by the TNAP. Upon completion of the EAP-Request/Response messages, an exchange of the EAP-5G messages are initiated once the UE receives an EAP-Request/5G-Start from the TNGF. The UE also at that time informs the upper layers that the access stratum connection is established.\nAn exchange of the NAS messages which are encapsulated in EAP-5G messages occur until the UE is authenticated by the 5GCN. Upon completion of the UE authentication and reception of the EAP-Success by the UE, the UE and the TNAP employs the TNAP key to establish access specific layer-2 security such as 4-way handshake in case IEEE 802.11 [19] is used between the TNAP and the UE.\nUpon completion of successful establishment of access specific layer-2 security, the UE is configured with an IP address by TNAN by e.g. DHCP and the UE initiates an IKE_SA_INIT exchange as specified in IETF RFC 7296 [6].\nThe UE establishes the IP based secure connection by establishing an IKE SA and first child SA for NAS signalling traffic to the TNGF over NWt. Once the UE establishes the IKE SA and the signalling IPsec SA with the TNGF, the UE initiates establishment of a TCP connection for transport of NAS message with TNGF, secured using the signalling IPsec SA. The UE and the TNGF exchanges NAS messages over the TCP connection once it is established. Additional child SAs (user plane IPsec SAs) can be established to transfer user plane traffic (see clause 7.5).\nAn example of an IKE SA and first child SA establishment procedure is shown in figure 7.3A.1-1.The figure illustrates that EAP messages are employed for the communication between the UE and the TNAP while the TNAP is transparent to the communication between the UE and the TNGF when employing EAP-5G messages. Link layer protocol is used to exchange these messages between the UE and the TNAN. The internal protocol used for the communications between the TNAP and the TNGF, is illustrated as dashed lines in this figure and is out of the scope of 3GPP.\nThe figure depicts the establishment procedure for the first child SA (Service Access) in the IKE SA (Internet Key Exchange Security Association) protocol, which is used for secure communication over a trusted non-3GPP access network. The figure shows the steps involved in establishing the first child SA, including the establishment of the IKE SA, the establishment of the first child SA, and the establishment of the first child SA.\nFigure 7.3A.1-1: IKE SA and first child SA establishment procedure for UE registration over trusted non-3GPP access\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3A.2\tEAP session over non-3GPP access",
                            "text_content": "The UE and the TNAN establishes a connection depending on the access link between the UE and the TNAP. For instance if the TNAP is a trusted WLAN access point, IEEE 802.11 [19] describes the connection between the UE and the TNAP. If the access link between the UE and the TNAP is Point-to-Point Protocol (PPP) as specified in IETF RFC 1661 [32], the Link Control Protocol (LCP) as specified in IETF RFC 1570 [33] describes the connection between the UE and the TNAP.\nIn the trusted non-3GPP access network:\na)\tthe TNAP and the UE exchange EAP-request/Identity message and EAP-response/Identity message; and\nb)\tthe TNGF and the UE exchange EAP messages of EAP-5G method,\nencapsulated in the link layer protocol packets such as IEEE 802.11/802.1x packets or PPP packets until successful authentication of the UE by the AMF. The link layer protocol packets are transmitted between the UE and the TNAN.\nThe EAP-5G method is utilized for encapsulating the NAS message to initiate the UE registration to the AMF via the TNGF. As described in clause 7.3.3, the EAP-5G packets utilize the \"Expanded\" EAP type and the existing 3GPP Vendor-Id registered with IANA under the SMI Private Enterprise Code registry (i.e. 10415).\nUpon reception of EAP-Request/Identity message (as described in IETF RFC 3748 [9]), encapsulated in the link layer protocol packets from the TNAP, the UE shall:\na)\tconstruct an EAP-Response/Identity message as described in IETF RFC 3748 [9] containing a NAI as specified in clause 28.7.6 of 3GPP TS 23.003 [8] (when the TNGF ID is not used for constructing the NAI or when the TNGF ID is used for constructing the NAI) to request a PLMN or SNPN when the trusted connectivity is 5G connectivity using trusted non-3GPP access;\nb)\tif the UE has a valid Access Identity 1 as specified in clause 4.5.2 of 3GPP TS 24.501 [4], include the MPS indicator appended to the NAI as specified in 3GPP TS 23.003 [8]; and\nc)\ttransmit the EAP-Response of identity type encapsulated in the link layer protocol packets towards the TNAP.\nUpon reception of the EAP Response/Identity message containing an MPS indication appended to the NAI (see 3GPP TS 23.003 [8] for NAI details), if allowed by operator policy, the TNAN may treat the message with MPS priority. If authentication is successful, the TNAN may treat subsequent messages to and from the UE with MPS priority. Unless doing so would cause network instability, the TNAN should not reject requests from UEs which the TNAN is treating with MPS priority access.\nEditor’s note (CR#0281, MPS_WLAN): The NAI definition in 3GPP TS 23.003 [8] needs to be specified in CT4.\nThe UE and the TNGF shall exchange EAP-5G messages. The TNGF on reception of the NAI by TNAP and passed on to TNGF, shall initiate EAP-5G session by sending an EAP-Request/5G-Start message. Upon reception of an EAP-Request/5G-Start message, the UE shall send an EAP-Response/5G-NAS message encapsulated in link layer protocol packets. In the EAP-Response/5G-NAS message, the UE:\na)\tshall include a NAS-PDU field containing a NAS message, for example, a REGISTRATION REQUEST message;\nb)\tshall include an AN-parameters field containing access network parameters, such as UE identity, selected PLMN ID or SNPN, requested NSSAI and establishment cause, selected NID if the UE is accessing SNPN services via trusted non-3GPP access network, and onboarding indication if the UE is accessing SNPN for onboarding services in SNPN via trusted non-3GPP access network, see 3GPP TS 23.502 [3], each of which is up to 255 (decimal) octets long; and\nNOTE 1:\tIf and how the UE includes the requested NSSAI as a part of the access type depends on the NSSAI inclusion mode IE as specified in 3GPP TS 24.501 [4].\nc)\tif at least one access network parameter is longer than 255 (decimal) octets, shall include an extended-AN-parameters field containing one or more access network parameters, such as UE identity, see 3GPP TS 23.502 [3], each of which is longer than 255 (decimal) octets.\nThe UE identity shall be 5GS mobile identity of type 5G-GUTI, if available, otherwise it shall be the 5GS mobile identity of type SUCI. The 5GS mobile identities of type 5G-GUTI and of type SUCI are specified in 3GPP TS 24.501 [4].\nThe TNGF on reception of EAP-Response/5G-NAS message, forwards the NAS message to the AMF.\nNOTE 2:\tThe TNGF is transparent to the NAS messages and as an intermediate network entity only conveys transparently the NAS messages to the AMF.\nThe TNAN, on reception of the NAS messages from the AMF, shall send an EAP-Request/5G-NAS message encapsulated in the link layer protocol packets towards the UE via the TNAP.\nThe TNGF handles access attempts with the establishment cause \"mps-PriorityAccess\" with high priority and rejects these access attempts only in extreme network load conditions that may threaten network stability.\nThe EAP-Request/5G-NAS message shall include a NAS-PDU field that contains a NAS message. Further NAS messages between the UE and the AMF, via the TNGF, shall be inserted in NAS-PDU field of an EAP-Response/5G-NAS (UE to TNGF direction) and EAP-Request/5G-NAS (TNGF to UE direction) message.\nThe UE, on reception of the EAP-Request/5G-NAS message including a NAS-PDU field containing a NAS message e.g. for security establishment, shall send a response with EAP-Response/5G-NAS message including a NAS-PDU field containing a NAS message related to the NAS security context to the TNGF.\nThe TNGF, on reception of the TNGF key shall construct an EAP-Request/5G-Notification message that includes an AN-parameters field containing the access network parameters, such as TNGF IPv4 contact information, TNGF IPv6 contact information, or both, see 3GPP TS 23.502 [3]. The TNGF shall send the EAP-Request/5G-Notification message encapsulated in the link layer protocol packets towards the UE via the TNAP. The UE shall acknowledge by sending an EAP-Response/5G-Notification message encapsulated in the link layer protocol packets.\nUpon completion of successful authentication and on reception of the acknowledgement from the UE that it had received the access network parameters, the TNAN shall send an EAP-Success message encapsulated in the link layer protocol packets towards the UE via the TNAP.\nFor trusted non-3GPP access, the procedure for when the EAP-5G session completion initiated by the UE, is the same as that of untrusted non-3GPP access as described in clause 7.3.3.3 with the difference that the N3IWF shall be replaced by the TNGF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3A.3\tIKE SA and signalling IPsec SA establishment procedure",
                            "text_content": "In a trusted non-3GPP access network, once the EAP- 5G authentication is successfully complete and the UE is configured with a local IP address, the UE shall use the TNGF IP address received in the EAP-Request/5G-Notification message (see clause 7.3A.2.3) to establish a secure connection between the UE and the TNGF over NWt to exchange NAS signalling messages with the AMF. The UE shall establish the secure connection by establishing an IKE SA and signalling IPsec SA (first child SA) by initiating the IKE_SA_INIT exchange and then IKE_AUTH exchange for mutual authentication with the TNGF and NULL encryption as specified in IETF RFC 2410 [34]. The UE shall set the IDi payload of the IKE_AUTH request message in the IKE_AUTH exchange (see IETF RFC 7296 [6]) to the NAI format of 5G-GUTI or the NAI format of SUCI as specified in 3GPP TS 23.003 [8], depending on the employed UE identity in the EAP-Response/5G-NAS message at the time of EAP-5G session initiation according to clause 7.3A.2.3.\nThe UE shall establish the IKE SA and signalling IPsec SA (first child SA) according to clause 7.3.2.2 with the difference that the N3IWF is replaced by the TNGF.\nUpon completion of the IKE SA and signalling IPsec SA (first child SA) establishment between the UE and the TNGF, the UE and the TNGF shall send further NAS messages over the TCP connection within the signalling IPsec SA (first child SA).\nFor trusted non-3GPP access, the procedure for when the IKE SA and signalling IPsec SA establishment are not accepted by the network, is the same as that of the untrusted non-3GPP access as described in clause 7.3.2.3 with the difference that the N3IWF shall be replaced by the TNGF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3A.4\tProcedure for devices without NAS support",
                            "text_content": "A trusted non-3GPP access network (TNAN) may be implemented as a trusted WLAN access network (TWAN) which supports a WLAN access technology such as the one described in IEEE 802.11 [19]. A non 5G capable over WLAN (N5CW) device does not support NAS signalling with the 5GCN over WLAN, but may access 5GCN via a TWAN supporting a trusted WLAN interworking function (TWIF). An N5CW device may be a UE with capability for NAS signalling with the 5GCN using the N1 reference point as specified in 3GPP TS 24.501 [4] over 3GPP access although it lacks capability of NAS signalling over WLAN.\nA trusted WLAN access network (TWAN) includes a trusted WLAN access point (TWAP) and a trusted WLAN interworking function (TWIF) as illustrated in figure 7.3A.4.2-1.\nFigure 7.3A.4.2-1: Trusted WLAN Access Network\nThe EAP-AKA' authentication procedure is executed for connecting the N5CW device to a TWAN according to 3GPP TS 33.501 [5] clause 7A.2.4.\nThe TWAN and an N5CW device initiate an exchange of EAP-Request/Identity message and EAP-Response/Identity message as specified in IETF RFC 3748 [9] for link layer authentication of the UE by the TWAP. In the trusted WLAN access network, the TWAP and the N5CW device exchange EAP-Request/Identity message and EAP-Response/Identity message, encapsulated in the link layer protocol packets i.e. IEEE 802.11/802.1x packets.\nUpon reception of EAP-Request/Identity message encapsulated in the IEEE 802.11/802.1x packets from the TWAP, the N5CW device shall:\na)\tconstruct an EAP-Response/Identity message as described in IETF RFC 3748 [9] containing an NAI as specified in clause 28.7.7 of 3GPP TS 23.003 [8] to request a PLMN or SNPN when the trusted connectivity is 5G connectivity without NAS using trusted non-3GPP access. A roaming N5CW device shall use:\n1)\ta decorated NAI taking the form as specified in subclause 28.7.7.1 of 3GPP TS 23.003 [8] to indicate to the TWAN the selected VPLMN; or\n2)\ta decorated NAI taking the form as specified in subclause 28.7.7.2 of 3GPP TS 23.003 [8] to indicate to the TWAN the selected non-subscribed SNPN; and\nNOTE 1:\tThe NAI includes the 5G-GUTI assigned to the N5CW device over 3GPP access, if the N5CW device is also a UE and is already registered to 5GCN over 3GPP access. If the N5CW device is not registered to the 5GCN over 3GPP access, the NAI includes the SUCI. The NAI includes the SUCI if the N5CW device is also a 5G UE and has not registered to 5GCN over 3GPP access.\nNOTE 2:\tWhen the N5CW device is accessing SNPN services, and the construction of SUCI as described in clause 6.12 of 3GPP TS 33.501 [5] cannot be used, the N5CW device determines to use the NAI including anonymous SUCI as specified in 3GPP TS 33.501 [5] based on N5CW device configuration.\nb)\ttransmit the EAP-Response of identity type encapsulated in the link layer protocol packets towards the TWAP.\nThe TWAP conveys the information provided by the N5CW device to the TWIF which initiates a registration procedure followed by a PDU session establishment procedure to obtain an IP address, on behalf of the N5CW device to an AMF according to 3GPP TS 24.501 [4].\nNOTE 3:\tThe communication protocol between the TWAP and the TWIF is outside of the scope of 3GPP.\nAn exchange of the EAP request and EAP response as described in IETF RFC 3748 [9] occurs until the N5CW device is authenticated by the 5GCN with the EAP authentication described in 3GPP TS 33.501 [5]. Upon completion of the N5CW device authentication and reception of the EAP-Success by the N5CW device, the N5CW device and the TWAP use the TWAP key to establish access specific layer-2 security 4-way handshake according to IEEE 802.11 [19].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "A trusted WLAN access network (TWAN) includes a trusted WLAN access point (TWAP) and a trusted WLAN interworking function (TWIF) as illustrated in figure 7.3A.4.2-1.",
                                    "table number": 1,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.3A.5\tTNAN selection based on TNAN information provided to the UE in the REGISTRATION REJECT message",
                            "text_content": "If the UE that supports slice-based TNGF selection receives TNAN information IE in the REGISTRATION REJECT message as specified in 3GPP TS 24.501 [4], and re-attempts the registration procedure with the same requested NSSAI over trusted non-3GPP access, the UE shall proceed as follows:\na)\tif the SSID is included in the received TNAN information IE, the UE shall connect to a TNAN based on the received SSID; otherwise, the UE shall not change the previously used SSID; and\nb)\tif the TNGF ID is included in the received TNAN information IE, the UE shall construct a NAI taking the received TNGF ID into account as specified in clause 28.7.6 of 3GPP TS 23.003 [8]; otherwise, the UE shall construct the NAI as specified in clause 28.7.6 of 3GPP TS 23.003 [8] when the TNGF ID is not used for constructing the NAI.\nThen the UE shall proceed with the EAP authentication as specified in clause 7.3A.2 and by using the new constructed NAI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3A.6\tProcedures for UE behind the 5G-RG accessing 5GC via trusted non-3GPP access network",
                            "text_content": "In wireline access, the UE behind the 5G-RG can access 5GC via trusted non-3GPP access network, where the 5G-RG provides the connectivity to the TNGF. The 5G-RG acts as TNAP with respect to the TNGF.\nNOTE:\tThe UE behind the 5G-RG can also access the 5GC directly through 3GPP access.\nFor the 5G-RG to provide connectivity to the UE behind it to access the 5GC via trusted non-3GPP access network, the 5G-RG registers to the 5GC and establishes a PDU session as described in 3GPP TS 23.316 [40]. In order to achieve that:\na)\tif the 5G-RG is connected to the 5GC through W-AGF, the 5G-RG shall first establish signalling connection using the W-CP protocol as described in clause 6.3.1, before proceeding with the registration procedure and the PDU session establishment procedure using the procedures specified in 3GPP TS 24.501 [4]; or\nb)\tif the 5G-RG is connected to the 5GC through NG-RAN, the 5G-RG proceeds directly with the registration procedure and the PDU session establishment procedure using the procedures specified in 3GPP TS 24.501 [4].\nThe EAP messages, control and user plane packets of the UE behind the 5G-RG are transported using the 5G-RG established PDU session as user data packets as described in 3GPP TS 23.316 [40].\nThe exchange of EAP messages and control plane packets between the UE behind the 5G-RG and the TNGF is handled as specified in clause 7.3A.1, clause 7.3A.2 and clause 7.3A.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.4\tIKEv2 SA deletion procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.4.1\tGeneral",
                            "text_content": "The purpose of the IKE SA deletion procedure via untrusted non-3GPP access and trusted non-3GPP access is to close the IKE SA between the UE and the N3IWFfor untrusted non-3GPP access and the TNGF for trusted non-3GPP access. In addition, deleting the IKE SA implicitly closes any remaining signalling IPsec child SAs and user plane IPsec child SAs associated with IKE SA.\nThis procedure shall be initiated either by the N3IWF, TNGF or by the UE.\nThe N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access initiate this procedure in the following cases:\na)\tN1 NAS signalling connection release;\nb)\tN3IWF-initiated and TNGF-initiated IKE SA rekeying procedure failure;\nc)\tN3IWF-initiated and TNGF-intiated IKE SA rekeying procedure completion\nd)\tupon receipt of an INITIAL_CONTACT notification as specified in IETF RFC 7296 [6]; and\ne)\tupon detecting an error in a response packet as specified in IETF RFC 7296 [6].\nThe UE initiates this procedure in the following cases:\na)\tUE-initiated IKE SA rekeying procedure failure;\nb)\tUE-initiated IKE SA rekeying procedure completion;\nc)\tupon receipt of an INITIAL_CONTACT notification as specified in IETF RFC 7296 [6]; and\nd)\tupon detecting an error in a response packet as specified in IETF RFC 7296 [6].\nNOTE:\tUE can also initiate the IKE SA deletion procedure, based on implementation, in abnormal scenarios e.g. a local release of N1 NAS signalling connection upon expiry of T3540 and UE fails to receive INFORMATIONAL request for IKE SA deletion from the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.4.2\tIKE SA deletion procedure initiated by the N3IWF and the TNGF",
                            "text_content": "The N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall initiate the IKE SA deletion procedure by sending an INFORMATIONAL request message including a Delete payload to the UE as specified in IETF RFC 7296 [6].\nThe Delete payload shall be defined with the Protocol ID set to \"1\" and no SPIs included in the Security Parameter Index field in the Delete payload. This indicates that the IKE security association and all IPsec ESP security associations that were negotiated within the IKE security association between:\na)\tthe N3IWF for untrusted non-3GPP access; and\nb)\tthe TNGF for trusted non-3GPP access;\nand the UE shall be deleted.\nUpon reception of the INFORMATIONAL request message from the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access for deletion of the IKE SA, if the UE accepts the IKE SA deletion request, the UE shall send an empty INFORMATIONAL response message to the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access as specified in IETF RFC 7296 [6].\nAfter sending the empty INFORMATIONAL response message, the UE shall close IKE SA and delete all IPsec child SAs associated with the IKE SA. In addition, the UE shall inform the upper layers that the access stratum connection has been released.\nUpon receiving the empty INFORMATIONAL response message, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall close IKE SA and delete all IPsec child SAs associated with the IKE SA. In addition, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall inform the AMF that the access stratum connection has been released.\nIf the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access does not receive any empty INFORMATIONAL response message from the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA. In addition, the N3IWF for untrusted non-3GPP access and the TNGF for untrusted non-3GPP access shall inform the AMF that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.4.3\tIKE SA deletion procedure initiated by the UE",
                            "text_content": "The UE shall initiate the IKE SA deletion procedure by sending an INFORMATIONAL request message including a Delete payload to the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access as specified in IETF RFC 7296 [6].\nThe Delete payload shall be defined with the Protocol ID set to \"1\" and no SPIs included in the Security Parameter Index field in the Delete payload. This indicates that the IKE security association and all IPsec ESP security associations that were negotiated within the IKE security association between:\na)\tthe N3IWF for untrusted non-3GPP access; and\nb)\tthe TNGF for trusted non-3GPP access;\nand the UE shall be deleted.\nUpon reception of the INFORMATIONAL request message from the UE for deletion of the IKE SA, if the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access accepts the IKE SA deletion request, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall send an empty INFORMATIONAL response message to the UE as specified in IETF RFC 7296 [6].\nAfter sending the empty INFORMATIONAL response message, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall close the IKE SA and delete all IPsec child SAs associated with the IKE SA. In addition, the N3IWF for untrusted non-3GPP access and theTNGF for trusted non-3GPP access shall inform the AMF that the access stratum connection has been released.\nUpon receiving the empty INFORMATIONAL response message, the UE shall close the IKE SA and delete all IPsec child SAs associated with the IKE SA. In addition, the UE shall inform the upper layers that the access stratum connection has been released.\nIf the UE does not receive any empty INFORMATIONAL response message from the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access, the UE shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA. In addition, the UE shall inform the upper layers that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.5\tUser plane IPsec SA creation procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.5.1\tGeneral",
                            "text_content": "The purpose of the user plane IPsec SA creation procedure is to establish a child SA associating to the QoS flows of the PDU session. This procedure shall be initiated by the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access.\nOne user plane IPsec SA can be associated with one or more QoS flows of the PDU session. During PDU session establishment or PDU session modification via:\na)\tuntrusted non-3GPP access, the N3IWF; or\nb)\ttrusted non-3GPP access, the TNGF,\nshall determine the number of user plane IPsec child SAs to establish and the QoS profiles associated with each child SA based on local policies, configuration and the QoS profiles received from the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.2\tChild SA creation procedure initiation",
                            "text_content": "The N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall initiate the child SA creation procedure by sending a CREATE_CHILD_SA request message to the UE as specified in IETF RFC 7296 [6].\nThe CREATE_CHILD_SA request message shall include:\na)\ta UP_IP4_ADDRESS notify payload or a UP_IP6_ADDRESS notify payload;\nb)\t5G_QOS_INFO Notify payload as specified in clause 9.3.1.1, which contains:\n1)\tPDU session ID;\n2)\tzero or more QFIs;\n3)\toptionally a DSCP value;\n4)\toptionally an indication of whether the child SA is the default child SA. For a given PDU session ID, there can be only up to one child SA which is the default child SA; and\n5)\tif trusted non-3GPP access, Additional QoS Information or if untrusted non-3GPP access, optionally Additional QoS Information; and\nc)\tthe Traffic Selector (TS) set to match all packets as specified in IETF RFC 7296 [6].\nNOTE:\tBecause the TS is set to match all packets, the network does not need to update the TS due to modifying the corresponding QoS rules or the association between QoS flows and child SAs.\nThe IKE CREATE_CHILD_SA request message also contains the SA payload for the requested child SA.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.3\tChild SA creation procedure accepted by the UE",
                            "text_content": "If the UE accepts the CREATE_CHILD_SA request message with a 5G_QOS_INFO Notify payload:\na)\tthe UE shall send a CREATE_CHILD_SA response message as specified in IETF RFC 7296 [6]; and\nb)\tthe UE shall associate the created child SA with the:\n1)\tPDU session ID;\n2)\tzero or more QFIs (if indicated);\n3)\tDSCP value (if indicated); and\n4)\tindication of whether the child SA is the default child SA (if indicated);\nin the 5G_QOS_INFO Notify payload; and\nc)\tthe UE:\n1)\tin case of trusted non-3GPP access, shall reserve non-3GPP access QoS resources for the created child SA based on the received Additional QoS Information; or\n2)\tin case of untrusted non-3GPP access, may reserve non-3GPP access QoS resources for the created child SA if the UE has received Additional QoS Information.\nAny IKEv2 Notify payload indicating an error shall not be included in the CREATE_CHILD_SA response message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.4\tChild SA creation procedure not accepted by the UE",
                            "text_content": "If a user plane IPsec SA establishment for a PDU session is not accepted by the UE, the UE shall send a CREATE_CHILD_SA response message to the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access with a Notify payload with error type.\nFor trusted non-3GPP access, if the UE fails to reserve QoS resources over non-3GPP access for the child SA associated with the QoS flows according to the Additional QoS information in the 5G_QOS_INFO Notify payload, the UE shall include a Notify payload with a Private Notify Message Error Type \"NO_RESOURCES_OVER_N3GPP\" as defined in clause 9.2.4.2 in the CREATE_CHILD_SA response message.\nFor untrusted non-3GPP access, if the UE attempts to reserve QoS resources over non-3GPP access for the child SA associated with the QoS flows according to the Additional QoS information in the 5G_QOS_INFO Notify payload but fails the reservation, the UE shall include a Notify payload with a Private Notify Message Error Type \"NO_RESOURCES_OVER_N3GPP\" as defined in clause 9.2.4.2 in the CREATE_CHILD_SA response message.\nUpon receiving the CREATE_CHILD_SA response message with a Notify payload of error type:\n-\tif PDU session establishment over non-3GPP access requires single user plane SA IPsec SA creation, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall stop user plane SA IPsec SA creation procedure and indicate the failure for PDU session establishment over non-3GPP access.\n-\tif PDU session establishment or PDU session modification over non-3GPP access requires multiple user plane SA IPsec SA creation, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access may choose to continue user plane SA IPsec SA creation procedure for other user plane IPsec SAs, or stop user plane SA IPsec SA creation procedure and indicate the failure for PDU session establishment or PDU session modification over non-3GPP access.\n-\tIf the UE is being treated as a UE with MPS priority (e.g., as identified in clause 7.3.2.1 or 7.3A.2.2) based on operator policy, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access may retry the Child SA creation without the Additional QoS Information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.5\tAbnormal cases in the UE",
                            "text_content": "If the UE receives a CREATE_CHILD_SA request message containing a USE_TRANSPORT_MODE notification, the UE shall send a CREATE_CHILD_SA response message to the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access without including the USE_TRANSPORT_MODE notification as specified in IETF RFC 7296 [6].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.6\tAbnormal cases in the N3IWF and the TNGF",
                            "text_content": "Apart from the cases specified in IETF RFC 7296 [6], no abnormal cases have been identified.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.6\tIPsec SA modification procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.6.1\tGeneral",
                            "text_content": "The user plane IPsec child SA modification procedure is to update a child SA associating to the QoS flows of the PDU session. The procedure may be initiated by the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access. The IPsec child SA modification may be accepted or rejected by the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.2\tN3IWF and TNGF procedure for IPsec child SA modification",
                            "text_content": "The N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall perform the IPsec child SA modification by sending an INFORMATIONAL request message as specified in IETF RFC 7296 [6] to the UE with an UP_SA_INFO Notify payload identifying the IPsec child SA and a 5G_QOS_INFO Notify payload indicating modified content associated with the IPsec child SA.\nIf the UE is being treated as a UE with MPS priority (e.g., as identified in clause 7.3.2.1 or 7.3A.2.2), based on operator policy, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access may retry the Child SA modification without the Additional QoS Information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.3\tUE procedure for IPsec child SA modification",
                            "text_content": "Upon receipt of an INFORMATIONAL request message containing an 5G_QOS_INFO Notify payload and an UP_SA_INFO Notify payload:\na)\tif the content of the 5G_QOS_INFO Notify payload is accepted by the UE, the UE shall:\ni)\tsend an empty INFORMATIONAL response message to the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access to acknowledge the reception of the INFORMATIONAL request message; and\nii)\tupdate locally the IPsec child SA according to the content of the INFORMATIONAL request message; or\nb)\tif the content of the 5G_QOS_INFO Notify payload is not accepted by the UE, the UE shall:\ni)\tsend the reason for rejecting the IPsec SA modification in the content of an INFORMATIONAL response message; and\nii)\tnot update locally the IPsec child SA according to the content of the INFORMATIONAL request message.\nFor trusted non-3GPP access, if the UE fails to reserve QoS resources over non-3GPP access for the child SA associated with the QoS flows according to the Additional QoS information in the 5G_QOS_INFO Notify payload, the UE shall include a Notify Payload with a Private Notify Message Error Type \"NO_RESOURCES_OVER_N3GPP\" as defined in clause 9.2.4.2 in the INFORMATIONAL response message.\nFor untrusted non-3GPP access, if the UE attempts to reserve QoS resources over non-3GPP access for the child SA associated with the QoS flows according to the Additional QoS information in the 5G_QOS_INFO Notify payload but fails the reservation, the UE shall include a Notify Payload with a Private Notify Message Error Type \"NO_RESOURCES_OVER_N3GPP\" as defined in clause 9.2.4.2 in the INFORMATIONAL response message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.7\tIPSec SA deletion procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.7.1\tGeneral",
                            "text_content": "The purpose of the child SA deletion procedure for PDU session release is to delete all the child SAs associated with the PDU session. This procedure shall be initiated either by the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access or by the UE.\nThe N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access initiates this procedure in the following cases:\na)\tupon PDU session release;\nb)\tN3IWF-initiated and TNGF-intiated IPsec SA rekeying procedure failure;\nc)\tN3IWF-initiated and TNGF-intiated IPsec SA rekeying procedure completion; and\nd)\tupon detecting an error in a response packet as specified in IETF RFC 7296 [6].\nThe UE initiates this procedure in the following cases:\na)\tUE-initiated IPsec SA rekeying procedure failure;\nb)\tUE-initiated IPsec SA rekeying procedure completion; and\nc)\tupon detecting an error in a response packet as specified in IETF RFC 7296 [6].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.7.2\tN3IWF-initated and TNGF-initiated child SA deletion procedure",
                            "text_content": "The N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall initiate the child SA deletion procedure by sending an INFORMATIONAL request message including a Delete payload to the UE as specified in IETF RFC 7296 [6]. The Delete payload shall include:\na)\tthe Protocol ID set to \"3\" for ESP; and\nb)\tall the N3IWF's ESP SPI(s) for untrusted non-3GPP access and all the TNGF's EPS SPI(s) for trusted non-3GPP access, associated to the released PDU session.\nIf the UE accepts the INFORMATIONAL request message for deletion of the child SAs, the UE shall send the INFORMATIONAL response message to the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access including the Delete payload received in the corresponding INFORMATIONAL request message as specified in IETF RFC 7296 [6].\nAny IKEv2 Notify payload indicating an error shall not be included in the INFORMATIONAL response message.\nIf the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access does not receive any INFORMATIONAL response message including a Delete payload from the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA. In addition, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall inform the AMF that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.7.3\tUE-initiated child SA deletion procedure",
                            "text_content": "The UE shall initiate the child SA deletion procedure by sending an INFORMATIONAL request message including a Delete payload as specified in IETF RFC 7296 [6], to the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access. The Delete payload shall include:\na)\tthe Protocol ID set to \"3\" for ESP; and\nb)\tall the UE's ESP SPI(s) associated to the released PDU session.\nIf the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access accepts the INFORMATIONAL request message for deletion of the child SAs, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall send the INFORMATIONAL response message to the UE including the Delete payload received in the corresponding INFORMATIONAL request message as specified in IETF RFC 7296 [6].\nAny IKEv2 Notify payload indicating an error shall not be included in the INFORMATIONAL response message.\nIf the UE does not receive any INFORMATIONAL response message including a Delete payload from the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access, the UE shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA. In addition, the UE shall inform the upper layers that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.7.4\tAbnormal cases in the UE",
                            "text_content": "Apart from the cases specified in IETF RFC 7296 [6] and clause 7.7.3.3, no abnormal cases have been identified.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.7.5\tAbnormal cases in the N3IWF and the TNGF",
                            "text_content": "Apart from the cases specified in IETF RFC 7296 [6] and clause 7.7.2.3, no abnormal cases have been identified.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.8\tUE-initiated liveness check procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.8.1\tGeneral",
                            "text_content": "The UE-initiated liveness check procedure enables the UE to detect whether the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access is alive.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.8.2\tUE-initiated liveness check procedure initiation",
                            "text_content": "If the UE supports the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as specified in 3GPP TS 24.302 [7] clause 8.2.4.2 and the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as specified in 3GPP TS 24.302 [7] clause 8.2.4.2 was included in the CFG_REPLY configuration payload within the IKE_AUTH response message received in clause 7.3 the UE shall set the timeout period for the liveness check to the value of the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute.\nIf the UE does not support the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as specified in 3GPP TS 24.302 [7] clause 8.2.4.2 or the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute as specified in 3GPP TS 24.302 [7] clause 8.2.4.2 was not included in the CFG_REPLY configuration payload within the IKE_AUTH response message received in clause 7.3, then the UE shall use the pre-configured value of the timeout period for liveness check.\nNOTE:\tThe timeout period is pre-configured in the UE in implementation-specific way.\nIf the UE has not received any cryptographically protected IKEv2 or IPsec message for the duration of the timeout period for liveness check, the UE shall send an INFORMATIONAL request with no payloads as per IETF RFC 7296 [6].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.8.3\tUE-initiated liveness check procedure completion",
                            "text_content": "The N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall handle the INFORMATIONAL request with no payloads as per IETF RFC 7296 [6] and shall send an INFORMATIONAL response.\nIf an INFORMATIONAL response is received, the UE shall consider the UE-initiated liveness check procedure as successfully completed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.8.4\tAbnormal cases",
                            "text_content": "If an INFORMATIONAL response is not received, the UE shall deem the IKEv2 security association to have failed.\nThe UE shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA as specified in IETF RFC 7296 [6]. In addition, the UE shall inform the upper layers that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.9\tNetwork-initiated liveness check procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.9.1\tGeneral",
                            "text_content": "The network-initiated liveness check procedure enables the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access to detect whether the UE is alive.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.2\tNetwork-initiated liveness check procedure initiation",
                            "text_content": "If the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access has not received any cryptographically protected IKEv2 or IPsec message for the duration of the timeout period for liveness check selected according to the local policy, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall send an INFORMATIONAL request with no payloads IETF RFC 7296 [6].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.3\tNetwork-initiated liveness check procedure completion",
                            "text_content": "The UE shall handle the INFORMATIONAL request with no payloads as per IETF RFC 7296 [6] and shall send an INFORMATIONAL response.\nIf an INFORMATIONAL response is received, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall consider the liveness check procedure as successfully completed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.9.4\tAbnormal cases",
                            "text_content": "If an INFORMATIONAL response is not received, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall deem the IKEv2 security association to have failed.\nThe N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA as specified in IETF RFC 7296 [6]. In addition, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall inform the AMF that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.10\tIKE SA rekeying procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.10.1\tGeneral",
                            "text_content": "The N3IWF for untrusted non-3GPP access, the TNGF for trusted non-3GPP access and the UE may support the IKE SA rekeying procedure as specified in IETF RFC 7296 [6]. If the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access and the UE support the IKE SA rekeying procedure, the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall proactively rekey the IKE SA. Upon rekeying of an IKE SA, the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall maintain the old SA for the incoming data while establishing the new one. The old SA shall be deleted upon the completion of the establishment of the new one by both the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access. The UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access are separately responsible for enforcing their time expiration policies to rekey the SA when needed. IETF RFC 7296 [6] describes how to avoid the simultaneous IPsec SA and IKE SA rekeying.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.10.2\tN3IWF-initiated and TNGF-initiated IKE SA rekeying procedure",
                            "text_content": "The N3IWF for untrusted non-3GPP access, the TNGF for trusted non-3GPP access shall initiate the IKE SA rekeying procedure by sending a CREATE_CHILD_SA request message with a REKEY_SA Notify payload indicating an N3IWF's SPI for untrusted non-3GPP access or an TNGF's SPI for trusted non-3GPP access.\nUpon reception of the CREATE_CHILD_SA request message in the IKE SA with a REKEY_SA Notify payload indicating an N3IWF's SPI for untrusted non-3GPP access or an TNGF's SPI for trusted non-3GPP access, if the UE accepts the IKE SA rekeying request, the UE shall send a CREATE_CHILD_SA response message without an IKEv2 notify payload indicating an error, shall set the UE's SPI to the SPI created by the CREATE_CHILD_SA request/response pair and shall set:\na)\tthe N3IWF's SPI for untrusted non-3GPP access to the N3IWF's SPI; or\nb)\tthe TNGF's SPI for trusted non-3GPP access to the TNGF's SPI;\ncreated by the CREATE_CHILD_SA request/response pair.\nIf the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access receive a CREATE_CHILD_SA response message with an IKEv2 notify payload indicating an error from the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall delete the IKE SA and any associated child SAs as specified in clause 7.4.\nIf the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access do not receive any CREATE_CHILD_SA response message from the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA. In addition, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall inform the AMF that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.10.3\tUE-initiated IKE SA rekeying procedure",
                            "text_content": "The UE shall initiate the IKE SA rekeying procedure by sending a CREATE_CHILD_SA request message with a REKEY_SA Notify payload indicating a UE's SPI.\nUpon reception of the CREATE_CHILD_SA request message in the IKE SA with a REKEY_SA Notify payload indicating a UE's SPI, if the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access accept the IKE SA rekeying request, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall send a CREATE_CHILD_SA response message without an IKEv2 notify payload indicating an error, shall set the N3IWF's SPI for untrusted non-3GPP access and the TNGF's SPI for trusted non-3GPP access to the SPI created by the CREATE_CHILD_SA request/response pair and shall set the UE's SPI to the UE's SPI created by the CREATE_CHILD_SA request/response pair.\nIf the UE receives a CREATE_CHILD_SA response message with an IKEv2 notify payload indicating an error from the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access, the UE shall delete the IKE SA and any associated child SAs as specified in clause 7.4.\nIf the UE does not receive any CREATE_CHILD_SA response message from the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access, the UE shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA. In addition, the UE shall inform the upper layers that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.11\tIPsec SA rekeying procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.11.1\tGeneral",
                            "text_content": "The N3IWF for untrusted non-3GPP access, the TNGF for trusted non-3GPP access and the UE may support the IPsec SA rekeying procedure as specified in IETF RFC 7296 [6]. If the N3IWF for untrusted non-3GPP access, the TNGF for trusted non-3GPP access and the UE support the IPsec SA rekying procedure, the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall proactively rekey the IPsec SA. Upon rekeying of an IPsec SA, the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall maintain the old IPsec for the incoming data while establishing the new one. The old IPsec shall be deleted upon the completion of the establishement of the new one by the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access. The UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access are separately responsible for enforcing their time expiration policies to rekey the IPsec when needed. IETF RFC 7296 [6] describes how to avoid the simultaneous IPsec SA and IKE SA rekeying.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.11.2\tN3IWF-initiated and TNGF-initiated IPsec SA rekeying procedure",
                            "text_content": "The N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall initiate the IPsec SA rekeying procedure by sending a CREATE_CHILD_SA request message with a REKEY_SA Notify payload including a Protocol ID set to \"3\" and the N3IWF's ESP SPI for untrusted non-3GPP access and the TNGF's ESP SPI for trusted non-3GPP access for the IPsec SA.\nUpon reception of the CREATE_CHILD_SA request message with a REKEY_SA Notify payload including a Protocol ID set to \"3\" and the N3IWF's ESP SPI for untrusted non-3GPP access or the TNGF's ESP SPI for trusted non-3GPP access for the IPsec SA, if the UE accepts the IPsec SA rekeying request, the UE shall send a CREATE_CHILD_SA response message without an IKEv2 notify payload indicating an error, shall set the UE's ESP SPI to the ESP SPI created by the CREATE_CHILD_SA request/response pair and shall set;\na)\tthe N3IWF's ESP SPI for untrusted non-3GPP access; or\nb)\tthe TNGF's ESP SPI for trsuted non-3GPP access;\nto the N3IWF's ESP SPI created by the CREATE_CHILD_SA request/response pair.\nIf the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access receive a CREATE_CHILD_SA response message with an IKEv2 notify payload indicating an error from the UE, the N3IWF shall delete the IPsec SA as specified in clause 7.7. Additionally, if the IPsec SA is the signalling IPsec SA, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall delete the IKE SA as specified in clause 7.4.\nIf the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access do not receive any CREATE_CHILD_SA response message from the UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA. In addition, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall inform the AMF that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.11.3\tUE-initiated IPsec SA rekeying procedure",
                            "text_content": "The UE shall initiate the IPsec SA rekeying procedure by sending a CREATE_CHILD_SA request message with a REKEY_SA Notify payload including a Protocol ID set to \"3\" and the UE's ESP SPI for the IPsec SA.\nUpon reception of the CREATE_CHILD_SA request message with a REKEY_SA Notify payload including a Protocol ID set to \"3\" and the UE's ESP SPI for the IPsec SA, if the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access accept the IPsec SA rekeying request, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall send a CREATE_CHILD_SA response message without an IKEv2 notify payload indicating an error, shall set:\na)\tthe N3IWF's ESP SPI for untrusted non-3GPP access; and\nb)\tthe TNGF's ESP SPI for trusted non-3GPP access;\nto the ESP SPI created by the CREATE_CHILD_SA request/response pair and shall set the UE's ESP SPI to the UE's ESP SPI created by the CREATE_CHILD_SA request/response pair.\nIf the UE receives a CREATE_CHILD_SA response message with an IKEv2 notify payload indicating an error from the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access, the UE shall delete the IPsec SA as specified in clause 7.7. Additionally, if the IPsec SA is the signalling IPsec SA, the UE shall delete the IKE SA as specified in clause 7.4.\nIf the UE does not receive any CREATE_CHILD_SA response message from the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access, the UE shall discard all states associated with the IKE SA and any child SAs that were negotiated using that IKE SA. In addition, the UE shall inform the upper layers that the access stratum connection has been released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7A\tvoid",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "8\tMessage transport procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "In trusted and untrusted non-3GPP access, the UE establishes IKE SA and signalling IPsec SA i.e. the first child SA for NAS message exchange. Thereafter the UE establishes other child SAs for exchange of the user data packets. IPsec tunnel mode is employed for all the established child SAs including the first child SA for the signalling, to protect and encrypt the original IP user data packets, the original IP signalling packets and the port numbers used for communications of such IP packets. This clause is to list the parameters and the procedures for such IP tunneling mode of the signalling IPsec SA and the user data child SAs.\nIn wireline access, the 5G-RG establishes signalling connection using W-CP protocol stack as described in clause 6.3.1. Thereafter the W-AGF serving the 5G-RG and the 5G-RG establish W-UP bearers for exchange of the user data packets as specified in clause 4.4.2.2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.2\tTransport of NAS messages over control plane",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.2.1\tGeneral",
                            "text_content": "In trusted and untrusted non-3GPP access, after the completion of IKE SA and establishment of signalling IPsec SA as specified in clause 7.3 for untrusted non-3GPP access and clause 7.3A for trusted non-3GPP access, the UE establishes with the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access a TCP connection for transport of NAS messages over the inner IP layer and the signalling IPsec SA as specified in clause 8.2.3. Once the TCP connection for transport of NAS messages is established, the UE performs NAS procedures over the TCP connection for transport of NAS messages. All uplink and downlink NAS mobility management messages and NAS session management messages are relayed between the UE and the AMF via N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access using the TCP connection for transport of NAS messages as specified in clause 8.2.4. Once the TCP connection is established and upon detection of a TCP connection failure, the UE and the N3IWF for untrusted non-3GPP access or the UE and the TNGF for trusted non-3GPP access re-establish the TCP connection as specified in clause 8.2.3A. When the TCP connection for transport of NAS messages is no longer needed, the UE, the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access release the TCP connection as specified in clause 8.2.5.\nIn wireline access, all uplink and downlink NAS mobility management messages and NAS session management messages are relayed between the 5G-RG and the AMF via W-AGF serving the 5G-RG using the signalling connection using W-CP protocol stack. If access network parameters, such as GUAMI, selected PLMN ID, requested NSSAI, establishment cause, and selected NID if the 5G-RG is accessing an SNPN, are provided along with an uplink NAS message, the access network parameters are relayed along the NAS message from the 5G-RG to the W-AGF serving the 5G-RG using the signalling connection using W-CP protocol stack. Transport using the signalling connection using W-CP protocol stack is out of scope of the present document.\nNOTE 1:\tIf and how the 5G-RG includes the requested NSSAI as a part of the access type depends on the NSSAI inclusion mode IE as specified in 3GPP TS 24.501 [4].\nNOTE 2:\tIf the 5G-RG is acting on behalf of one or more AUN3 devices, the W-AGF serving the 5G-RG can distinguish whether the signalling connection using W-CP protocol stack is for the 5G-RG itself or for any of the AUN3 devices, and the way to achieve this is out of scope of this specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.2\tTCP packet encapsulation",
                            "text_content": "NOTE 1:\tThis clause is used for encapsulating of TCP packets when establishing TCP connection as described in clause 8.2.3, when re-establishing TCP connection as described in clause 8.2.3A, when transporting NAS messages over TCP connection as described in clause 8.2.4, and when releasing TCP connection as described in clause 8.2.5.\nIf a TCP packet is transported between the UE and the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access, and:\na)\tif the IKE_AUTH response message contained the INTERNAL_IP4_ADDRESS attribute and the NAS_IP4_ADDRESS notify payload, an inner IPv4 datagram shall be constructed where:\n1)\tthe TCP packet shall be encapsulated in the inner IPv4 datagram with IPv4 header where:\nA)\tif the UE constructs the inner IPv4 datagram:\n-\tthe source address field shall be set to the IPv4 address in the INTERNAL_IP4_ADDRESS attribute;\n-\tthe source port number shall be set to the UE's TCP port number;\n-\tthe destination address field shall be set to the IPv4 address in the NAS_IP4_ADDRESS notify payload; and\n-\tthe destination port number shall be set to the NAS_TCP_PORT notify payload;\nB)\tif the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access constructs the inner IPv4 datagram:\n-\tthe source address field shall be set to the IPv4 address in the NAS_IP4_ADDRESS notify payload;\n-\tthe source port number shall be set to the NAS_TCP_PORT notify payload;\n-\tthe destination address field shall be set to the IPv4 address in the INTERNAL_IP4_ADDRESS attribute; and\n-\tthe destination port number shall be set to the UE's TCP port number; and\nNOTE 2:\tSince the UE always initiates the NAS message exchange with the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access receive the UE's TCP port number in the TCP SYN packet exchange and use it when sending NAS messages towards the UE or when re-establishing the TCP connection upon failure.\nC)\tthe protocol field shall be set to 06H;\n2)\tthe inner IPv4 datagram shall be protected employing the ESP protocol in tunnel mode as specified in IETF RFC 4303 [11] where:\nA)\tthe SPI field in the ESP packet shall be set to the SPI of the signalling IPsec SA; and\nB)\tthe next header field in the ESP packet shall be set to 04H; and\n3)\tthe IP packet encapsulating the ESP protected inner IPv4 datagram shall be sent to the peer for the SPI of the signalling IPsec SA; or\nb)\tif the IKE_AUTH response message contained the INTERNAL_IP6_ADDRESS attribute and the NAS_IP6_ADDRESS notify payload, an inner IPv6 datagram shall be constructed where:\n1)\tthe TCP packet shall be encapsulated in the inner IPv6 datagram with IPv6 header where:\nA)\tif the UE constructs the inner IPv6 datagram:\n-\tthe source address field shall be set to the IPv6 address in the INTERNAL_IP6_ADDRESS attribute;\n-\tthe source port number shall be set to the UE's TCP port number;\n-\tthe destination address field shall be set to the IPv6 address in the NAS_IP6_ADDRESS notify payload; and\n-\tthe destination port number shall be set to the NAS_TCP_PORT notify payload;\nB)\tif the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access constructs the inner IPv6 datagram:\n-\tthe source address field shall be set to the IPv6 address in the NAS_IP6_ADDRESS notify payload;\n-\tthe source port number shall be set to the NAS_TCP_PORT notify payload;\n-\tthe destination address field shall be set to the IPv6 address in the INTERNAL_IP6_ADDRESS attribute; and\n-\tthe destination port number shall be set to the UE's TCP port number; and\nNOTE 3:\tSince the UE always initiates the NAS message exchange with the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access receive the UE's TCP port number in the TCP SYN packet exchange and use it when sending NAS messages towards the UE or when re-establishing the TCP connection upon failure.\nC)\tthe next header field shall be set to 06H;\n2)\tthe inner IPv6 datagram shall be protected employing the ESP protocol in tunnel mode as specified in IETF RFC 4303 [11] where:\nA)\tthe SPI field in the ESP packet shall be set to the SPI of the signalling IPsec SA; and\nB)\tthe next header field in the ESP packet shall be set to 29H, and\n3)\tthe IP packet encapsulating the ESP protected inner IPv6 datagram shall be sent to the peer for the SPI of the signalling IPsec SA.\nIf the UE receives an IKE_AUTH response message containing both NAS_IP4_ADDRESS and NAS_IP6_ADDRESS notify payload, the UE:\na)\tshall select and use either NAS_IP4_ADDRESS or NAS_IP6_ADDRESS;\nb)\tshall not switch between NAS_IP4_ADDRESS and NAS_IP6_ADDRESS for TCP packet transport during the lifetime of the IKE SA; and\nc)\tshall not switch between NAS_IP4_ADDRESS and NAS_IP6_ADDRESS when rekeying any child SA or IKE SA.\nThe ESP packet format is shown in figure 8.2.2-1 and figure 8.2.2-2:\nFigure 8.2.2-1: ESP packet format for TCP packet (re-)establishing or releasing TCP connection\nFigure 8.2.2-2: ESP packet format for TCP packet encapsulating NAS message or partial NAS message\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The ESP packet format is shown in figure 8.2.2-1 and figure 8.2.2-2:",
                                    "table number": 2,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Figure 8.2.2-1: ESP packet format for TCP packet (re-)establishing or releasing TCP connection",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.3\tEstablishment of TCP connection for transport of NAS messages",
                            "text_content": "For transport of NAS messages, the UE shall initiate establishment of a TCP connection as defined in IETF RFC793 [27]. The UE and the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall construct and transport TCP packets according to clause 8.2.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.3A\tRe-establishment of TCP connection for transport of NAS messages",
                            "text_content": "The UE, the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access upon detection that the transport of a NAS message over the TCP connection is unsuccessful due to TCP connection failure, e.g. as indicated by the reception of a TCP error message, shall re-establish the TCP connection as defined in IETF RFC793 [27]. The UE and the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall construct and transport TCP packets according to clause 8.2.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.4\tTransport of NAS messages over TCP connection",
                            "text_content": "In order to transport a NAS message over the untrusted non-3GPP access between the UE and the N3IWF or over the trusted non-3GPP access between the UE and the TNGF:\na)\tthe NAS message shall be framed in a NAS message envelope as defined in clause 9.4;\nb)\tthe NAS message envelope shall be transported as a payload of one or more TCP packets using the TCP connection; and\nc)\tthe UE and the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall transport the one or more TCP packets encapsulating the NAS message envelope according to clause 8.2.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.5\tRelease of TCP connection for transport of NAS messages",
                            "text_content": "In order to release the TCP connection for transport of NAS messages, the UE, the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access shall initiate release of the TCP connection as defined in IETF RFC 793 [27]. The UE, the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access shall construct and transport TCP packets according to clause 8.2.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "8.3\tTransport of messages over user plane",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.3.1\tGeneral",
                            "text_content": "In trusted and untrusted non-3GPP access, after the completion of PDU session establishment via non-3GPP access, user plane IPsec SAs are established as specified in clause 7.5. The UE is able to send and receive GRE encapsulated user data packets over non-3GPP access network via N3IWF in untrusted non-3GPP access and TNGF in trusted non-3GPP access. GRE encapsulation of user plane data packets is described in clause 8.3.2.\nIn wireline access, after the completion of PDU session establishment via wireline access, one or more W-UP resources are established as specified in clause 4.4.2.2. The 5G-RG is able to send and receive the user data packet, the QFI associated with the downlink user data packet, and RQI (in downlink direction only) via the selected W-UP resource and the W-AGF serving the 5G-RG as specified in clause 4.4.2.2.\nNOTE:\tIf the 5G-RG is acting on behalf of one or more AUN3 devices, the W-AGF serving the 5G-RG can distinguish whether the W-UP resource is for the 5G-RG itself or for any of the AUN3 devices, and the way to achieve this is out of scope of this specification.\nFor an uplink user data packet associated with a PDU session ID and a QFI:\na)\tif there is a user plane IPsec SA or a W-UP resource:\n1)\tassociated with a PDU session ID matching the PDU session ID associated with the uplink user data packet; and\n2)\tassociated with a QFI matching the QFI associated with the uplink user data packet;\nthe UE or the 5G-RG shall select that user plane IPsec SA or that W-UP resource, respectively;\nb)\totherwise, the UE or the 5G-RG shall select the user plane IPsec SA or the W-UP resource, respectively:\n1)\tassociated with a PDU session ID matching the PDU session ID associated with the uplink user data packet; and\n2)\tassociated with the indication that the child SA is the default child SA.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.2\tGeneric routing encapsulation (GRE)",
                            "text_content": "If a user data packet message is transmitted over non-3GPP access between the UE and the N3IWF for untrusted non-3GPP access and the TNGF for the trusted non-3GPP access, the user data packet message shall be encapsulated as a GRE user data packet with a GRE header as specified in clause 9.3.3. In the GRE encapsulated user data packet:\na0)\tthe protocol type field is set to zero;\na)\tthe payload packet field is set to the user data packet;\nb)\tthe QFI field of the key field of the GRE header field is set to the QFI associated with the user data packet;\nc)\tif the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access:\n1)\tneeds to send RQI for a downlink user data packet, the RQI field of the key field of the GRE header is set to \"RQI is indicated\" as defined in table 9.3.3-3; or\n2)\tdoes not need to send RQI for a downlink user data packet, the RQI field of the key field of the GRE header is set to \"RQI is not indicated\" as defined in table 9.3.3-3; and\nd)\tif the UE sends an uplink user data packet, the RQI field of the key field of the GRE header is set to \"RQI is not indicated\" as defined in table 9.3.3-3.\nIf the IKE_AUTH response message contains:\na)\tthe INTERNAL_IP4_ADDRESS attribute and the CREATE_CHILD_SA request message creating the user plane IPsec SA contains the UP_IP4_ADDRESS notify payload in clause 7.5.4, an inner IPv4 datagram shall be constructed where:\n1)\tthe GRE user data packet shall be encapsulated as the payload of the inner IPv4 datagram with IPv4 header where:\nA)\tif the UE constructs the inner IPv4 datagram, the source address field shall be set to the IPv4 address in the INTERNAL_IP4_ADDRESS attribute and the destination address field shall be set to the IPv4 address in the UP_IP4_ADDRESS notify payload;\nB)\tif the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access constructs the inner IPv4 datagram, the source address field shall be set to the IPv4 address in the UP_IP4_ADDRESS notify payload and the destination address field shall be set to the IPv4 address in the INTERNAL_IP4_ADDRESS attribute; and\nC)\tthe protocol field shall be set to 2FH;\n2)\tthe inner IPv4 datagram shall be protected employing the ESP protocol in tunnel mode as specified in IETF RFC 4303 [11] where:\nA)\tthe SPI field in the ESP packet shall be set to the SPI of the user plane IPsec SA; and\nB)\tthe next header field in the ESP packet shall be set to 04H,\nand the inner IPv4 datagram encapsulating the GRE encapsulated user data can be fragmented as described in IETF RFC 791 [24] before being protected by ESP protocol;\n3)\tif the DSCP field is associated with the user plane IPsec SA, the DSCP field as specified in IETF RFC 2474 [26] of the IP packet encapsulating the ESP protected inner IPv4 datagram shall be set to the value of the DSCP field included in the 5G_QOS_INFO Notify payload; and\nNOTE 1:\tThe IP packet encapsulating the ESP protected inner IPv4 datagram is the outer IP datagram.\n4)\tthe IP packet encapsulating the ESP protected inner IPv4 datagram shall be sent to the peer for the SPI of the user plane IPsec SA; or\nb)\tthe INTERNAL_IP6_ADDRESS attribute and the CREATE_CHILD_SA request message creating the user plane IPsec SA contains the UP_IP6_ADDRESS notify payload in clause 7.5.4, an inner IPv6 datagram shall be constructed where:\n1)\tthe GRE user data packet shall be encapsulated as the payload of the inner IPv6 datagram with IPv6 header where:\nA)\tif the UE constructs the inner IPv6 datagram, the source address field shall be set to the IPv6 address in the INTERNAL_IP6_ADDRESS attribute and the destination address field shall be set to the IPv6 address in the UP_IP6_ADDRESS notify payload;\nB)\tif the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access constructs the inner IPv6 datagram, the source address field shall be set to the IPv6 address in the UP_IP6_ADDRESS notify payload and the destination address field shall be set to the IPv6 address in the INTERNAL_IP6_ADDRESS attribute; and\nC)\tthe next header field shall be set to 2FH;\n2)\tthe inner IPv6 datagram shall be protected employing the ESP protocol in tunnel mode as specified in IETF RFC 4303 [11] where:\nA)\tthe SPI field in the ESP packet shall be set to the SPI of the user plane IPsec SA; and\nB)\tthe next header field in the ESP packet shall be set to 29H;\nand the inner IPv6 datagram encapsulating the GRE encapsulated user data can be fragmented as described in IETF RFC 8200 [25] before being protected by ESP protocol; and\n3)\tif the DSCP field is associated with the user plane IPsec SA, the DSCP field as specified in IETF RFC 2474 [26] of the IP packet encapsulating the ESP protected inner IPv6 datagram shall be set to the value of the DSCP field included in the 5G_QOS_INFO Notify payload; and\nNOTE 2:\tThe IP packet encapsulating the ESP protected inner IPv4 datagram is the outer IP datagram.\n4)\ttheIP packet encapsulating the ESP protected inner IPv6 datagram shall be sent to the peer for the SPI of the user plane IPsec SA.\nIf a user data packet message is transmitted over non-3GPP access between the UE and the N3IWF for untrusted non-3GPP access and the TNGF for trusted non-3GPP access, the user data packet message shall be encapsulated in the payload of an inner IP datagram which is further encapsulated by ESP protocol in tunnel mode as specified in IETF RFC 4303 [11]. In order to avoid any IP fragmentation by the sending entity over the non-3GPP access network, the maximum inner IP datagram length shall be set by the sending entity such that the length of the resulting outer IP datagram does not exceed the MTU of the non-3GPP access network. If the length of the user data packet message exceeds the payload size corresponding to the maximum inner IP datagram length and IP fragmentation is needed:\na)\tthe inner IP IPv4 datagram or inner IP IPv6 datagram shall be fragmented; and\nb)\tthe IP packet encapsulating the ESP protected inner IPv4 datagram and the IP packet encapsulating the ESP protected inner IPv6 datagram shall not be fragmented.\nNOTE 3:\tAs an implementation option, if no DSCP value is indicated in the 5G_QOS_INFO Notify payload for the user plane IPsec SA, the DSCP field of the outer IP datagram can be set to the DSCP value of the IP header of the user plane PDU.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "9\tParameters and coding",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "9.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the encoding of the parameters which are exchanged between the UE and the network. This clause is further divided into three clauses; 3GPP specific coding information, IETF specific coding information and NAS message envelope.\nThe clauses for the 3GPP specific coding information and IETF specific coding information describe how to encode the messages and parameters belonging to 3GPP and IETF. The clause for NAS message envelope describes how to encode the NAS message envelope in order to frame a NAS message prior to its encapsulation within a TCP payload.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.2\t3GPP specific coding information",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.2.1\tGUAMI",
                            "text_content": "The purpose of the GUAMI information element is to provide the globally unique AMF ID.\nThe GUAMI information element is coded as shown in figure 9.2.1-1 and table 9.2.1-1.\nThe GUAMI is a type 3 information element with a length of 7 octets.\nFigure 9.2.1-1: GUAMI information element\nTable 9.2.1-1: GUAMI information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The GUAMI is a type 3 information element with a length of 7 octets.",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.1-1: GUAMI information element",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.2.2\tEstablishment cause for non-3GPP access",
                            "text_content": "The purpose of the Establishment cause for non-3GPP access information element is to provide the establishment cause for non-3GPP access.\nThe Establishment cause for non-3GPP access information element is coded as shown in figure 9.2.2-1 and table 9.2.2-1.\nThe Establishment cause for non-3GPP access is a type 3 information element with length of 2 octets.\nFigure 9.2.2-1: Establishment cause for non-3GPP access information element\nTable 9.2.2-1: Establishment cause for non-3GPP access information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The Establishment cause for non-3GPP access is a type 3 information element with length of 2 octets.",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.2-1: Establishment cause for non-3GPP access information element",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.2.3\tPLMN ID",
                            "text_content": "The purpose of the PLMN ID information element is to indicate the PLMN identity of the selected PLMN.\nThe PLMN ID is a type 4 information element with a length of 5 octets.\nThe PLMN ID information element is coded as shown in figure 9.2.3-1 and table 9.2.3-1.\n\nFigure 9.2.3-1: PLMN ID information element\nTable 9.2.3-1: PLMN ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The PLMN ID information element is coded as shown in figure 9.2.3-1 and table 9.2.3-1.",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.3-1: PLMN ID information element",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.2.4\tIKEv2 Notify Message Type value",
                            "text_content": "The IKEv2 Notify Message Type is specified in IETF RFC 7296 [6].\nThe Notify Message Type with a value (in decimal) in the range 0 - 16383 is intended for reporting errors, where:\n-\tvalue range between 0 and 8191 is defined in IETF RFC 7296 [6]; and\n-\tvalue range between 8192 and 16383 is reserved for private error usage.\nThe Notify Message Type with a value (in decimal) in the range 16384 - 65535 is intended for reporting status, where:\n-\tvalue range between 16384 and 40959 is defined in IETF RFC 7296 [6]; and\n-\tvalue range between 40960 and 65535 is reserved for private status usage.\nThe Private Notify Message Error Types defined in table 9.2.4.2-1 are error notifications which indicate an error while negotiating an IKEv2 SA or IPsec SA. Refer to table 9.2.4.2-1 for more details on what each error type means.\nTable 9.2.4.2-1: Private Error Types\n\nIn the present specification, only the private notify message error type values between 15500 and 15599 shall be allocated to a Notify payload.\nThe private notify message error type values:\n-\tbetween 9950 and 9999;\n-\tbetween 10950 and 10999;\n-\tbetween 11950 and 11999;\n-\tbetween 12950 and 12999;\n-\tbetween 13950 and 13999; and\n-\tbetween 14950 and 14999;\nshall not be allocated to a Notify payload defined in the present specification.\nThe Private Notify Message Status Types defined in table 9.2.4.3-1 are used to indicate status notifications or additional information in a Notify payload which may be added to an IKEv2 message or IKE_AUTH request or IKE_AUTH response message according to the procedures described in the present document. Refer to table 9.2.4.3-1 for more details on what each status type means.\nTable 9.2.4.3-1: Private Status Types\n\nIn the present specification, only the private notify message status type values between 55500 and 55599 shall be allocated to a Notify payload.\nThe private notify message status type values:\n-\tbetween 49950 and 49999;\n-\tbetween 50950 and 50999;\n-\tbetween 51950 and 51999;\n-\tbetween 52950 and 52999;\n-\tbetween 53950 and 53999; and\n-\tbetween 54950 and 54999;\nshall not be allocated to a Notify payload defined in the present specification.\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 9.2.4.2-1: Private Error Types",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.4.3-1: Private Status Types",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.2.5\tTNGF IPv4 contact info",
                            "text_content": "The purpose of the TNGF IPv4 contact info information element is to indicate the IPv4 address of the TNGF to be used for IKE SA establishment over trusted non-3GPP access network.\nThe TNGF IPv4 contact info is a type 4 information element with a length of 6 octets.\nThe TNGF IPv4 contact info information element is coded as shown in figure 9.2.5-1 and table 9.2.5-1.\n\nFigure 9.2.5-1: TNGF IPv4 contact info information element\nTable 9.2.5-1: TNGF IPv4 contact info information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The TNGF IPv4 contact info information element is coded as shown in figure 9.2.5-1 and table 9.2.5-1.",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.5-1: TNGF IPv4 contact info information element",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.2.6\tTNGF IPv6 contact info",
                            "text_content": "The purpose of the TNGF IPv6 contact info information element is to indicate the IPv6 address of the TNGF to be used for IKE SA establishment.\nThe TNGF IPv6 contact info is a type 4 information element with a length of 18 octets.\nThe TNGF IPv6 contact info information element is coded as shown in figure 9.2.6-1 and table 9.2.6-1.\n\nFigure 9.2.6-1: TNGF IPv6 contact info information element\nTable 9.2.6-1: TNGF IPv6 contact info information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The TNGF IPv6 contact info information element is coded as shown in figure 9.2.6-1 and table 9.2.6-1.",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.6-1: TNGF IPv6 contact info information element",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.2.7\tNID",
                            "text_content": "The purpose of the NID information element is to indicate the NID of the selected SNPN.\nThe NID is a type 4 information element with a length of 8 octets.\nThe NID information element is coded as shown in figure 9.2.7-1, figure 9.2.7-2, table 9.2.7-1 and table 9.2.7-2.\nFigure 9.2.7-1: NID information element\nTable 9.2.7-1: NID information element\n\n\nFigure 9.2.7-2: NID\nTable 9.2.7-2: NID\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The NID information element is coded as shown in figure 9.2.7-1, figure 9.2.7-2, table 9.2.7-1 and table 9.2.7-2.",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.7-1: NID information element",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.7-2: NID",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "9.3\tIETF RFC coding information",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.3.1\tIKEv2 Notify payloads",
                            "text_content": "\nThe 5G_QOS_INFO Notify payload is used to indicate:\na)\tthe PDU session identity;\nb)\tzero or more QFIs;\nc)\toptionally a DSCP value associated with the child SA;\nd)\twhether the child SA is the default child SA; and\ne)\tif trusted non-3GPP access, Additional QoS Information or if untrusted non-3GPP access, optionally Additional QoS Information.\nThe 5G_QOS_INFO Notify payload is coded according to figure 9.3.1.1-1 and table 9.3.1.1-1.\n\nFigure 9.3.1.1-1: 5G_QOS_INFO Notify payload format\nFigure 9.3.1.1-2: Additional QoS Information\nFigure 9.3.1.1-3: Parameters list\nFigure 9.3.1.1-4: Parameter\nTable 9.3.1.1-1: 5G_QOS_INFO Notify payload value\n\nTable 9.3.1.1-2: Additional QoS Information\n\nThe NAS_IP4_ADDRESS Notify payload is used to indicate the inner IPv4 address of the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access for NAS message transport.\nThe NAS_IP4_ADDRESS Notify payload is coded according to figure 9.3.1.2-1 and table 9.3.1.2-1.\n\n\nFigure 9.3.1.2-1: NAS_IP4_ADDRESS Notify payload format\nTable 9.3.1.2-1: NAS_IP4_ADDRESS Notify payload value\n\nThe NAS_IP6_ADDRESS Notify payload is used to indicate the inner IPv6 address of the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access for NAS message transport.\nThe NAS_IP6_ADDRESS Notify payload is coded according to figure 9.3.1.3-1 and table 9.3.1.3-1.\n\n\nFigure 9.3.1.3-1: NAS_IP6_ADDRESS Notify payload format\nTable 9.3.1.3-1: NAS_IP6_ADDRESS Notify payload value\n\nThe UP_IP4_ADDRESS Notify payload is used to indicate the inner IPv4 address of the N3IWF for untrusted non-3GPP access or the TNGF for trusted on-3GPP access for GRE user data packet transport.\nThe UP_IP4_ADDRESS Notify payload is coded according to figure 9.3.1.4-1 and table 9.3.1.4-1.\n\n\nFigure 9.3.1.4-1: UP_IP4_ADDRESS Notify payload format\nTable 9.3.1.4-1: UP_IP4_ADDRESS Notify payload value\n\nThe UP_IP6_ADDRESS Notify payload is used to indicate the inner IPv6 address of the N3IWF for untrusted non-3GPP access or the TNGF for trusted non-3GPP access for GRE user data packet transport.\nThe UP_IP6_ADDRESS Notify payload is coded according to figure 9.3.1.5-1 and table 9.3.1.5-1.\n\n\nFigure 9.3.1.5-1: UP_IP6_ADDRESS Notify payload format\nTable 9.3.1.5-1: UP_IP6_ADDRESS Notify payload value\n\nThe NAS_TCP_PORT Notify payload is used to indicate the port number for the connection of the inner TCP transport protocol for the NAS message transport.\nThe NAS_TCP_PORT Notify payload is coded according to figure 9.3.1.6-1 and table 9.3.1.6-1.\nFigure 9.3.1.6-1: NAS_TCP_PORT Notify payload format\nTable 9.3.1.6-1: NAS_TCP_PORT Notify payload value\n\nThe N3GPP_BACKOFF_TIMER Notify payload is used to indicate the value of the back-off timer.\nThe N3GPP_BACKOFF_TIMER Notify payload is coded according to figure 9.3.1.7-1 and table 9.3.1.7-1.\n\n\nFigure 9.3.1.7-1: N3GPP_BACKOFF_TIMER Notify payload format\nTable 9.3.1.7-1: N3GPP_BACKOFF_TIMER Notify payload value\n\nThe UP_SA_INFO Notify payload is used to indicate the SPI of the inbound ESP packets of the user plane IPsec SA.\nThe UP_SA_INFO Notify payload is coded according to figure 9.3.1.8 and table 9.3.1.8.\n\nFigure 9.3.1.8: UP_SA_INFO Notify payload format\nTable 9.3.1.8: UP_SA_INFO Notify payload value\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Figure 9.3.1.1-1: 5G_QOS_INFO Notify payload format",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Figure 9.3.1.1-2: Additional QoS Information",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Figure 9.3.1.1-3: Parameters list",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.1.1-1: 5G_QOS_INFO Notify payload value",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.1.1-2: Additional QoS Information",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.1.2-1: NAS_IP4_ADDRESS Notify payload value",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 28,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.1.3-1: NAS_IP6_ADDRESS Notify payload value",
                                    "table number": 29,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 30,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.1.4-1: UP_IP4_ADDRESS Notify payload value",
                                    "table number": 31,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 32,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.1.5-1: UP_IP6_ADDRESS Notify payload value",
                                    "table number": 33,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The NAS_TCP_PORT Notify payload is coded according to figure 9.3.1.6-1 and table 9.3.1.6-1.",
                                    "table number": 34,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.1.6-1: NAS_TCP_PORT Notify payload value",
                                    "table number": 35,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 36,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.1.7-1: N3GPP_BACKOFF_TIMER Notify payload value",
                                    "table number": 37,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 38,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.1.8: UP_SA_INFO Notify payload value",
                                    "table number": 39,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.3.2\tEAP-5G method",
                            "text_content": "The messages of EAP-5G method are EAP requests and EAP responses as specified in IETF RFC 3748 [9] clause 4.1 and use coding of the expanded method type as described in IETF RFC 3748 [9] clause 5.7.\nThe sending entity shall set the value of a spare bit to zero. The receiving entity shall ignore the value of a spare bit.\nEAP-Request/5G-Start message is coded as specified in figure 9.3.2.2.1-1 and table 9.3.2.2.1-1.\nFigure 9.3.2.2.1-1: EAP-Request/5G-Start message\nTable 9.3.2.2.1-1: EAP-Request/5G-Start message\n\nEAP-Response/5G-NAS message is coded as specified in figure 9.3.2.2.2-1 and table 9.3.2.2.2-1.\nFigure 9.3.2.2.2-1: EAP-Response/5G-NAS message\nTable 9.3.2.2.2-1: EAP-Response/5G-NAS message\n\nFigure 9.3.2.2.2-2: AN-parameters field\nTable 9.3.2.2.2-2: AN-parameters field\n\nFigure 9.3.2.2.2-3: AN-parameter field\nTable 9.3.2.2.2-3: AN-parameter field\n\nFigure 9.3.2.2.2-4: Extended-AN-parameters field\nTable 9.3.2.2.2-4: Extended-AN-parameters field\n\nFigure 9.3.2.2.2-5: Extended-AN-parameter field\nTable 9.3.2.2.2-5: AN-parameter field\n\nEAP-Request/5G-NAS message is coded as specified in figure 9.3.2.2.3-1and table 9.3.2.2.3-1.\nFigure 9.3.2.2.3-1: EAP-Request/5G-NAS message\nTable 9.3.2.2.3-1: EAP-Request/5G-NAS message\n\nEAP-Response/5G-Stop message is coded as specified in figure 9.3.2.2.4-1 and table 9.3.2.2.4-1.\nFigure 9.3.2.2.4-1: EAP-Response/5G-Stop message\nTable 9.3.2.2.4-1: EAP-Response/5G-Stop message\n\nEAP-Request/5G-Notification message is coded as specified in figure 9.3.2.2.5-1 and table 9.3.2.2.5-1.\nFigure 9.3.2.2.5-1: EAP-Request/5G-Notification message\nTable 9.3.2.2.5-1: EAP-Request/5G-Notification message\n\nFigure 9.3.2.2.5-2: AN-parameters field\nTable 9.3.2.2.5-2: AN-parameters field\n\nFigure 9.3.2.2.5-3: AN-parameter field\nTable 9.3.2.2.5-3: AN-parameter field\n\nEAP-Response/5G-Notification message is coded as specified in figure 9.3.2.2.6-1 and table 9.3.2.2.6-1.\nFigure 9.3.2.2.6-1: EAP-Response/5G-Notification message\nTable 9.3.2.2.6-1: EAP-Response/5G-Notification message\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "EAP-Request/5G-Start message is coded as specified in figure 9.3.2.2.1-1 and table 9.3.2.2.1-1.",
                                    "table number": 40,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.1-1: EAP-Request/5G-Start message",
                                    "table number": 41,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "EAP-Response/5G-NAS message is coded as specified in figure 9.3.2.2.2-1 and table 9.3.2.2.2-1.",
                                    "table number": 42,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.2-1: EAP-Response/5G-NAS message",
                                    "table number": 43,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 44,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.2-2: AN-parameters field",
                                    "table number": 45,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 46,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.2-3: AN-parameter field",
                                    "table number": 47,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 48,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.2-4: Extended-AN-parameters field",
                                    "table number": 49,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 50,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.2-5: AN-parameter field",
                                    "table number": 51,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "EAP-Request/5G-NAS message is coded as specified in figure 9.3.2.2.3-1and table 9.3.2.2.3-1.",
                                    "table number": 52,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.3-1: EAP-Request/5G-NAS message",
                                    "table number": 53,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "EAP-Response/5G-Stop message is coded as specified in figure 9.3.2.2.4-1 and table 9.3.2.2.4-1.",
                                    "table number": 54,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.4-1: EAP-Response/5G-Stop message",
                                    "table number": 55,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "EAP-Request/5G-Notification message is coded as specified in figure 9.3.2.2.5-1 and table 9.3.2.2.5-1.",
                                    "table number": 56,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.5-1: EAP-Request/5G-Notification message",
                                    "table number": 57,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 58,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.5-2: AN-parameters field",
                                    "table number": 59,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 60,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.5-3: AN-parameter field",
                                    "table number": 61,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "EAP-Response/5G-Notification message is coded as specified in figure 9.3.2.2.6-1 and table 9.3.2.2.6-1.",
                                    "table number": 62,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.2.2.6-1: EAP-Response/5G-Notification message",
                                    "table number": 63,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.3.3\tGRE encapsulated user data packet",
                            "text_content": "GRE encapsulated user data packet is coded according to figure 9.3.3-1 and table 9.3.3-1.\nFigure 9.3.3-1: GRE encapsulated user data packet\nTable 9.3.3-1: GRE encapsulated user data packet\n\nFigure 9.3.3-2: GRE header field\nTable 9.3.3-2: GRE header field\n\nFigure 9.3.3-3: Key field of GRE header\nTable 9.3.3-3: Key field of GRE header\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "GRE encapsulated user data packet is coded according to figure 9.3.3-1 and table 9.3.3-1.",
                                    "table number": 64,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.3-1: GRE encapsulated user data packet",
                                    "table number": 65,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 66,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.3-2: GRE header field",
                                    "table number": 67,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 68,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.3.3-3: Key field of GRE header",
                                    "table number": 69,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "9.4\tNAS message envelope",
                    "description": "",
                    "summary": "",
                    "text_content": "NAS message envelope is used to frame the NAS message prior to its encapsulation as the TCP payload in the inner IP datagram.\nNAS message envelope is encoded according to figure 9.4-1 and table 9.4-1.\nFigure 9.4-1: NAS message envelope format\nTable 9.4-1: NAS message envelope value\n\n\n",
                    "tables": [
                        {
                            "description": "NAS message envelope is encoded according to figure 9.4-1 and table 9.4-1.",
                            "table number": 70,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table 9.4-1: NAS message envelope value",
                            "table number": 71,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "",
                            "table number": 72,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}