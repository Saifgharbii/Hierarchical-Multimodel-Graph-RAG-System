{
    "document_name": "24341-i00.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document provides the protocol details for SMS over IP within the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP) and SIP Events as defined in 3GPP TS 24.229 [10].\nThe present document provides the protocol details for SMS over IP within the IP Multimedia (IM) Core Network (CN) subsystem based on the SMS layer as defined in 3GPP TS 24.011 [8].\nWhere possible the present document specifies the requirements for this protocol by reference to specifications produced by the IETF within the scope of SIP and SIP Events, either directly, or as modified by 3GPP TS 24.229 [10].\nThe present document is applicable to Application Servers (ASs) and User Equipment (UE) providing SMS over IP functionality.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.002: \"Network Architecture\".\n[3]\t3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS)\".\n[4]\t3GPP TS 23.140: \"Multimedia Messaging Service (MMS); Functional description; Stage 2\".\n[5]\t3GPP TS 23.204: \"Support of SMS over generic 3GPP IP access; Stage 2\".\n[6]\t3GPP TS 23.218: \"IP Multimedia (IM) session handling; IM call model; Stage 2\".\n[7]\t3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".\n[8]\t3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support on mobile radio interface\".\n[8A]\t3GPP TS 24.167: \"3GPP IMS Management Object (MO)\".\n[9]\t3GPP TS 24.228 Release 5: \"Signalling flows for the IP multimedia call control based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[10]\t3GPP TS 24.229: \"Internet Protocol (IP) multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[11]\t3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".\n[12]\tRFC 3261 (June 2002): \"SIP: Session Initiation Protocol\".\n[13]\tRFC 3325 (November 2002): \"Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks\".\n[14]\tRFC 3428 (December 2002): \"Session Initiation Protocol (SIP) Extension for Instant Messaging\".\n[15]\tRFC 3680 (March 2004): \"A Session Initiation Protocol (SIP) Event Package for Registrations\".\n[16]\tRFC 3840 (August 2004): \"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)\".\n[17]\tRFC 3841 (August 2004): \"Caller Preferences for the Session Initiation Protocol (SIP)\".\n[18]\t3GPP TS 31.103: \"Characteristics of the IP Multimedia Services Identity Module (ISIM) Application\".\n[19]\t3GPP TS 31.102: \"Characteristics of the Universal Subscriber Identity Module (USIM) Application\".\n[20]\t3GPP TS 51.011 Release 4: \"Specification of the Subscriber Identity Module, Mobile Equipment (SIM - ME) interface\".\n[21]\t3GPP TS 31.111: \"Universal Subscriber Identity Module (USIM) Application Toolkit (USAT)\".\n[22]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[23]\t3GPP TS 29.311: \"Service Level Interworking (SLI) for messaging services\".\n[24]\tRFC 6809 (November 2012): \"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)\".\n[25]\tRFC 5621 (September 2009): \"Message Body Handling in the Session Initiation Protocol (SIP)\".\n[26]\tRFC 4288 (December 2005): \"Media Type Specifications and Registration Procedures\".\n[27]\tRFC 6665 (July 2012): \"SIP-Specific Event Notification\".\n[28]\t3GPP TS 22.011: \"Service accessibility\".\n[29]\t3GPP TS 23.221: \"Architectural requirements\".\n[30]\t3GPP TS 24.216: \"Communication Continuity Management Object (MO)\".\n[31]\t3GPP TS 23.122: \"Non-Access-Stratum functions related to Mobile Station (MS) in idle mode\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\nMSISDN less operation: Operation of SMS over IP for subscriber without MSISDN in the subscription profile as defined in 3GPP TS 23.204 [5] in clause 6.0a.\nSM-over-IP sender: the A party that sends an SM using a SIP MESSAGE request including a vnd.3gpp.sms payload (introduced in 3GPP TS 23.140 [4]).\nSM-over-IP receiver: the B party that receives an SM encapsulated in the vnd.3gpp.sms payload of a SIP MESSAGE request.\nFor the purposes of the present document, the following terms and definitions given in RFC 3261 [12] apply.\nHeader\nHeader field\nMethod\nRequest\nResponse\n(SIP) transaction\nStatus-code (see RFC 3261 [12], clause 7.2)\nTag (see RFC 3261 [12], clause 19.3)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.002 [2], clauses 4.1.1.1 and 4a.7 apply:\nCall Session Control Function (CSCF)\nHome Subscriber Server (HSS)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.218 [6], clause 3.1 apply:\nFilter criteria\nInitial filter criteria\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.228 [7], clauses 4.3.3.1, 4.3.6 and 4.6 apply:\nInterrogating-CSCF (I-CSCF)\nPublic Service Identity (PSI)\nProxy-CSCF (P-CSCF)\nServing-CSCF (S-CSCF)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 22.011 [28] apply:\n3GPP PS data off\n3GPP PS data off exempt service\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.229 [10] apply:\n3GPP PS data off status\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.122 [31] apply:\nEquivalent Home PLMN (EHPLMN)\nHome PLMN (HPLMN)\nVisited PLMN (VPLMN)\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1], TS 23.040 [3] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\nAS\tApplication Server\nIP-SM-GW\tIP-Short-Message-Gateway\nPS\tPacket Switched\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tOverview of SMS over IP functionality",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "SMS over IP functionality provides the UE with the capability of sending traditional short messages over IMS network. The architecture for SMS is specified in 3GPP TS 23.040 [3] and for SMS over IP functionality in 3GPP TS 23.204 [5].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tSMS over IP",
                    "description": "",
                    "summary": "",
                    "text_content": "In order to guarantee SMS interoperability the SM-over-IP sender, the SM-over-IP receiver and the IP-SM-GW shall support encapsulation of RPDUs defined in 3GPP TS 24.011 [8], clause 7.3. The SM-over-IP sender, the SM-over-IP receiver and the IP-SM-GW shall use the MIME type \"application/vnd.3gpp.sms\" for this purpose.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.3\tApplication utilisation of SMS over IP",
                    "description": "",
                    "summary": "",
                    "text_content": "SMS over generic IP access can be used to support all applications and services that use SMS.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.4\tSMS over IP and subscription without MSISDN",
                    "description": "",
                    "summary": "",
                    "text_content": "When SMS over IP is to be delivered to a subscriber where the subscription profile does not contain an MSISDN, then there is a need for the IP-SM-GW to become aware of the IMSI during IMS registration for later correlation of short messages. In order to do so the IP-SM-GW derives the IMSI from the private user identity of the user that the UE includes in the REGISTER request at registration or if the private user identity is not available, derives the IMSI from the public user identity.\n3GPP TS 23.003 [22] defines the relationship between the private user identity and the IMSI and the relationship between the public user identity and the IMSI.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "5\tSIP related procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tFunctional entities",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tUser Equipment (UE)",
                            "text_content": "To be compliant with short message over IP in this document, a UE shall implement:\na)\tthe role of an SM-over-IP sender as specified in clause 5.3.1.1, clause 5.3.1.2, and clause 5.3.1.3;\nb)\tthe role of an SM-over-IP receiver as specified in clause 5.3.2.1, clause 5.3.2.2, clause 5.3.2.3, clause 5.3.2.4, and clause 5.3.2.5; or\nc)\tthe roles described in item a) and item b).\nTo be compliant with short message over IP in MSISDN less operation in this document, a UE shall implement:\na)\tthe role of an SM-over-IP sender as specified in clause 5.3.1.4.1, clause 5.3.1.4.2, and clause 5.3.1.4.3;\nb)\tthe role of an SM-over-IP receiver as specified in clause 5.3.2.6.1, clause 5.3.2.6.2, clause 5.3.2.6.3, and clause 5.3.2.6.4; or\nc)\tthe roles described in item a) and item b).\nNOTE:\tThe capability of sending short messages over IP does not affect current limitations, thus the UE is limited to send at most one UE originated SM and to receive at most one UE terminated SM at a time.\nParameters such as the PSI of the SC of the SM-over-IP sender can be obtained from the UICC as per 3GPP TS 31.103 [18] and 3GPP TS 31.102 [19] if used or from the SIM as per 3GPP TS 51.011 [20] if used.\nThe network operator's preference for selection of the domain to be used for short message service originated by the UE indicates the domain for originating short messages.\nThe network operator's preference for selection of the domain to be used for short message service originated by the UE can be set to one of the following values:\na)\tthe SMS service is not to be invoked over the IP networks; and\nb)\tthe SMS service is preferred to be invoked over the IP networks.\nThe UE shall support the network operator's preference for selection of the domain to be used for short message service originated by the UE.\nThe UE may support being configured with the network operator's preference for selection of the domain to be used for short message service originated by the UE in the SMS_Over_IP_Networks_Indication of 3GPP TS 24.167 [8A].\nEditor's note [CR#0086, IOC_UE_conf]: Handling of any configuration on UICC related to the network operator's preference for selection of the domain to be used for short message service originated by the UE is FFS.\nIf the network operator's preference for selection of the domain to be used for short message service originated by the UE is set to \"the SMS service is not to be invoked over the IP networks\", the UE shall not perform the procedures in clause 5.3.1.\nThe policy on usage of SMS over IP indicates when the UE is allowed to use SMS over IP.\nThe policy on usage of SMS over IP can be set to one of the following values:\na)\tSMS over IP is used only if voice over PS is available and only on the IP-CAN bearer that is used for the transport of SIP signalling associated with voice over PS;\nb)\tSMS over IP is used only if voice over PS is available and on any IP-CAN bearer; and\nc)\tSMS over IP is used irrespective of whether voice over PS is available and on any IP-CAN bearer.\nThe UE may support the policy on usage of SMS over IP.\nIf the UE supports the policy on usage of SMS over IP and the network operator's preference for selection of the domain to be used for short message service originated by the UE is set to \"the SMS service is preferred to be invoked over the IP networks\":\na)\tthe UE may support being configured with SMSoIP usage policy using one or more of the following methods:\n1)\tthe SMSoIP usage policy leaf of the EFIMSConfigData file described in 3GPP TS 31.102 [19];\n2)\tthe SMSoIP usage policy leaf of the EFIMSConfigData file described in 3GPP TS 31.103 [18]; and\n3)\tthe SMSoIP usage policy leaf of 3GPP TS 24.167 [8A].\nIf the UE is configured with both the SMSoIP usage policy leaf of 3GPP TS 24.167 [8A] and the SMSoIP usage policy leaf of the EFIMSConfigData file described in 3GPP TS 31.102 [19] or the SMSoIP usage policy leaf of the EFIMSConfigData file described in 3GPP TS 31.103 [18], then the SMSoIP usage policy leaf of the EFIMSConfigData file shall take precedence.\nNOTE 1:\tPrecedence for files configured on both the USIM and ISIM is defined in 3GPP TS 31.103 [18].\nb)\tif the policy on usage of SMS over IP is set to \"SMS over IP is used only if voice over PS is available and only on the IP-CAN bearer that is used for the transport of SIP signalling associated with voice over PS\":\n1)\tif the domain selection for originating voice calls specified in 3GPP TS 23.221 [29] determines that the UE does not use the IMS to originate voice call then the UE shall not perform the procedures in clause 5.3.1 and clause 5.3.2 and determines that SMS over IP is restricted (see 3GPP TS 24.229 [10]); and\n2)\tif:\nA)\tthe domain selection for originating voice calls specified in 3GPP TS 23.221 [29] determines that the UE uses the IMS to originate voice calls;\nB)\tthe UE supports multiple registrations as specified in 3GPP TS 24.229 [10];\nC)\tthe UE registered several registration flows; and\nD)\tat least one of the registration flow was registered via an IP-CAN different than the remaining registration flows;\nthen the UE shall not perform the procedures in clause 5.3.1 and clause 5.3.2 and determines that SMS over IP is restricted (see 3GPP TS 24.229 [10]) over access technology where the audio is restricted or not preferred according to 3GPP TS 24.216 [30]; and\nc)\tif the policy on usage of SMS over IP is set to \"SMS over IP is used only if voice over PS is available and on any IP-CAN bearer\" and the domain selection for originating voice calls specified in 3GPP TS 23.221 [29] determines that the UE does not use the IMS to originate voice call then the UE shall not perform the procedures in clause 5.3.1 and clause 5.3.2 and determines that SMS over IP is restricted (see 3GPP TS 24.229 [10]).\nNOTE 2:\tIf the network operator's preference for selection of the domain to be used for short message service originated by the UE is set to \"the SMS service is not to be invoked over the IP networks\", the policy on usage of SMS over IP has no effect.\nNOTE 3:\tIf the policy on usage of SMS over IP is set to \"SMS over IP is used irrespective of whether voice over PS is available and on any IP-CAN bearer\", there is no restriction regarding how SMS over IP is used.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tApplication Server (AS)",
                            "text_content": "To be compliant with short message over IP in this document, an AS shall implement the role of an IP-SM-GW as specified in clause 5.3.3.1, clause 5.3.3.2, clause 5.3.3.3, and clause 5.3.3.4.\nTo be compliant with short message over IP in MSISDN less operation in this document, an AS shall implement the role of an IP-SM-GW as specified in clause 5.3.3.1, clause 5.3.3.2, clause 5.3.3.3, and clause 5.3.3.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3\tRoles",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tSM-over-IP sender",
                            "text_content": "In addition to the procedures specified in clause 5.3.1, the SM-over-IP sender shall support the procedures specified in 3GPP TS 24.229 [10] appropriate to the functional entity in which the SM-over-IP sender is implemented. The SM-over-IP sender shall build and populate RP-DATA message, containing all the information that a mobile station submitting an SM according to 3GPP TS 24.011 [8] would place, for successful delivery. The SM-over-IP sender shall parse and interpret RP- DATA, RP-ACK and RP-ERROR messages, containing all the information that a mobile station receiving an SM according to 3GPP TS 24.011 [8] would see, in a SM submission or status report.\nNOTE 1:\tIf the SM-over-IP sender uses SMR entity timers as specified in 3GPP TS 24.011 [8], then TR1M is set to a value greater than timer F (see 3GPP TS 24.229 [10]).\nNOTE 2:\tIf the SM-over-IP sender expects to receive a SM submit report will include the \"+g.3gpp.smsip\" parameter in the Contact header field when sending a REGISTER request.\nWhen an SM-over-IP sender wants to submit an SM over IP, the SM-over-IP sender shall send a SIP MESSAGE request with the following information:\na)\tthe Request-URI, which shall contain the PSI of the SC of the SM-over-IP sender;\nNOTE 1:\tThe PSI of the SC can be SIP URI or tel URI based on operator policy. The PSI of the SC can be obtained using one of the following methods in the priority order listed below:\n1)\tprovided by the user;\n2)\tif UICC is used, then:\n-\tif an ISIM is present, then the PSI of the SC is obtained from the EFPSISMSC in DF_TELECOM as per 3GPP TS 31.103 [18];\n-\tif an ISIM is not present, then the PSI of the SC is obtained from the EFPSISMSC in DF_TELECOM as per 3GPP TS 31.102 [19]; or\n-\tif the PSI of the SC is not available in EFPSISMSC in DF_TELECOM, then the PSI of the SC contains the TS-Service-Centre-Address stored in the EFSMSP in DF_TELECOM as per 3GPP TS 31.102 [19]. If the PSI of the SC is based on the E.164 number from the TS-Service-Centre-Address stored in the EFSMSP in DF_TELECOM then the URI constructed can be either a tel URI or a SIP URI (using the \"user=phone\" SIP URI  parameter format).\n3)\tif SIM is used instead of UICC, then the PSI of the SC contains the TS-Service Centre Address stored in the EFSMSP in DF_TELECOM as per 3GPP TS 51.011 [20]. If the PSI of the SC is based on the E.164 number from the TS-Service-Centre-Address stored in the EFSMSP in DF_TELECOM then the URI constructed can be either a tel URI or a SIP URI (using the \"user=phone\" SIP URI  parameter format); or\n4)\tif neither the UICC nor SIM is used, then how the PSI of the SC is configured and obtained is through means outside the scope of this specification.\nb)\tthe From header, which shall contain a public user identity of the SM-over-IP sender;\nNOTE 2:\tThe IP-SM-GW will have to use an address of the SM-over-IP sender that the SC can process (i.e. an E.164 number). This address will come from a tel URI in a P-Asserted-Identity header (as defined in RFC 3325 [13]) placed in the SIP MESSAGE request by the P-CSCF or S-CSCF.\nNOTE 3:\tThe SM-over-IP sender has to store the Call-ID of the SIP MESSAGE request, so it can associate the appropriate SIP MESSAGE request including a submit report with it.\nc)\tthe To header, which shall contain the PSI of the SC of the SM-over-IP sender;\nd)\tthe Content-Type header, which shall contain \"application/vnd.3gpp.sms\"; and\ne)\tthe body of the request shall contain an RP-DATA message as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3].\nNOTE 4:\tThe address of the SC is included in the RP-DATA message content. The address of the SC included in the RP-DATA message content is stored in the EFSMSP in DF_TELECOM of the (U)SIM of the SM-over-IP sender.\nNOTE 5:\tThe SM-over-IP sender will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nNOTE 6:\tBoth the address of the SC and the PSI of the SC can be configured in the EFPSISMSC in DF_TELECOM of the USIM and ISIM respectively using the USAT as per 3GPP TS 31.111 [21].\nThe SM-over-IP sender may request the SC to return the status of the submitted message. The support of status report capabilities is optional for the SC.\nWhen a SIP MESSAGE request including a submit report in the \"vnd.3gpp.sms\" payload is received, the SM-over-IP sender shall:\n-\tif SM-over-IP sender supports In-Reply-To header usage and the In-Reply-To header indicates that the request corresponds to a short message submitted by the SM-over-IP sender, generate a 200 (OK) SIP response according to RFC 3428 [14].\nif SM-over-IP sender supports In-Reply-To header usage and the In-Reply-To header indicates that the request does not correspond to a short message submitted by the SM-over-IP sender, a 488 (Not Acceptable here) SIP response according to RFC 3428 [14].\n-\tif SM-over-IP sender does not support In-Reply-To header usage, generate a 200 (OK) SIP response according to RFC 3428 [14]; and extract the payload encoded according to 3GPP TS 24.011 [8] for RP-ACK or RP-ERROR.\nWhen a SIP MESSAGE request including a status report in the \"vnd.3gpp.sms\" payload is delivered, the SM-over-IP sender shall:\n-\tgenerate a SIP response according to RFC 3428 [14];\n-\textract the payload encoded according to 3GPP TS 24.011 [8] for RP-DATA; and\n-\tcreate a delivery report for the status report as described in clause 5.3.2.4. The content of the delivery report is defined in 3GPP TS 24.011 [8].\nThis clause specifies the procedures for the SM-over-IP sender to support the MSISDN less.\nAn SM-over-IP sender supporting the procedures in this clause shall support:\na)\tprocedures specified in clause 5.3.1.1; and\nb)\tthe In-Reply-To header field.\nWhen an SM-over-IP sender wants to submit an SM over IP and the destination side is addressed with a SIP URI, then the SM-over-IP sender shall perform the actions as specified in clause 5.3.1.2 with the following additions and modifications:\na)\tthe Content-Type header field, which shall contain \"multipart/mixed\";\nb)\tan application/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <To> element which contains the URI of the receiver of the short message; and\nc)\tan application/vnd.3gpp.sms MIME body containing the RP-DATA message as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3] with a TP-DA field set to the dummy MSISDN value as defined in 3GPP TS 23.003 [22].\nThe SM-over-IP sender can  request the IP-SM-GW to return the status of submitted messages.\nWhen a SIP MESSAGE request including a submit report in the \"vnd.3gpp.sms\" payload is received, the SM-over-IP sender shall:\n1)\tif the In-Reply-To header field indicates that the request corresponds to a short message submitted by the SM-over-IP sender, generate a 200 (OK) SIP response according to RFC 3428 [14]; or\n2)\tif the In-Reply-To header field indicates that the request does not correspond to a short message submitted by the SM-over-IP sender, generate a 488 (Not Acceptable here) SIP response according to RFC 3428 [14].\nWhen a SIP MESSAGE request including a \"vnd.3gpp.sms\" payload is received in response to a short message sent according to the procedures in clause 5.3.1.4.2 then the SM-over-IP sender shall:\n-\tgenerate a SIP response according to RFC 3428 [14];\n-\textract the payload encoded according to 3GPP TS 24.011 [8] for RP-DATA; and\n-\tcreate a delivery report for the received SMS-STATUS-REPORT. In order to do so send a SIP MESSAGE as follows:\na)\tthe Request-URI, which shall contain the address of the IP-SM-GW;\nNOTE 1:\tThe address of the IP-SM-GW is received in the P-Asserted-Identity header field in the received SIP MESSAGE request.\nb)\tthe From header field which shall contain a public user identity of the SM-over-IP sender.\nc)\tthe To header field which shall contain the address of the IP-SM-GW;\nd)\tthe In-Reply-To header field which shall contain the Call-Id of the received SIP MESSAGE request;\ne)\tthe Content-Type header field shall contain \"application/vnd.3gpp.sms\"; and\nf)\tthe body of the request shall contain the RP-ACK or RP-ERROR message for the SM delivery report, as defined in 3GPP TS 24.011 [8].\nNOTE 2:\tThe SM-over-IP sender will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.2\tSM-over-IP receiver",
                            "text_content": "In addition to the procedures specified in clause 5.3.2, the SM-over-IP receiver shall support the procedures specified in 3GPP TS 24.229 [10] appropriate to the functional entity in which the SM-over-IP receiver is implemented. The SM-over-IP receiver shall build and populate RP-SMMA, RP-ACK, and RP-ERROR messages, containing all the information that a mobile station according to 3GPP TS 24.011 [8] would place, for a notification for availability of memory and a delivery report. The SM-over-IP receiver shall parse and interpret RP- DATA message, containing all the information that a mobile station receiving an SM according to 3GPP TS 24.011 [8] would see, in a SM delivery.\nOn sending a REGISTER request, the SM-over-IP receiver shall indicate its capability to receive traditional short messages over IMS network by including a \"+g.3gpp.smsip\" parameter into the Contact header according to RFC 3840 [16].\nWhen a SIP MESSAGE request including a short message in the \"vnd.3gpp.sms\" payload is delivered, the SM-over-IP receiver shall:\n-\tgenerate a SIP response according to RFC 3428 [14];\n-\textract the payload encoded according to 3GPP TS 24.011 [8] for RP-DATA; and\n-\tcreate a delivery report as described in clause 5.3.2.4. The content of the report is defined in 3GPP TS 24.011 [8].\nWhen an SM-over-IP receiver wants to send an SM delivery report over IP, the SM-over-IP receiver shall send a SIP MESSAGE request with the following information:\na)\tthe Request-URI, which shall contain the IP-SM-GW;\nNOTE 1:\tThe address of the IP-SM-GW is received in the P-Asserted-Identity header in the SIP MESSAGE request including the delivered short message.\nb)\tthe From header, which shall contain a public user identity of the SM-over-IP receiver.\nc)\tthe To header, which shall contain the IP-SM-GW;\nd)\tthe In-Reply-To header which shall contain the Call-Id of the SIP MESSAGE request that was received in the received short message;\ne)\tthe Content-Type header shall contain \"application/vnd.3gpp.sms\"; and\nf)\tthe body of the request shall contain the RP-ACK or RP-ERROR message for the SM delivery report, as defined in 3GPP TS 24.011 [8].\nNOTE 2:\tThe SM-over-IP sender will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nWhen an SM-over-IP receiver wants to send a notification about UE having memory available, the SM-over-IP receiver shall send a SIP MESSAGE request with the following information:\na)\tthe Request-URI, which shall contain the IP-SM-GW address, if available, and shall contain PSI of the SC otherwise;\nNOTE 1:\tThe address of the IP-SM-GW is received in the P-Asserted-Identity in the SIP MESSAGE request that included the short message the UE could not store.\nb)\tthe From header, which shall contain a public user identity of the SM-over-IP receiver;\nc)\tthe To header, which shall contain the IP-SM-GW address, if available, and shall contain PSI of the SC, otherwise;\nd)\tthe Content-Type header shall contain \"application/vnd.3gpp.sms\"; and\ne)\tthe body of the request shall contain an RP-SMMA message, see 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3].\nNOTE 2:\tThe SM-over-IP receiver will use content transfer encoding of type \"binary\" for the encoding of the SMS in the body of the SIP MESSAGE request.\nNOTE 3:\tAccording to 3GPP TS 23.204 [5], the IP-SM-GW routes SIP MESSAGE requests containing a notification of UE having memory available (containing RP-SMMA as the body) towards the HSS and  routes other SIP MESSAGE requests (containing RP-DATA, RP-ACK or RP-ERROR as the body) towards SMS-IWMSC.\nThis clause specifies the procedures for the SM-over-IP receiver to support the MSISDN less operation.\nAn SM-over-IP receiver supporting the procedures in this clause shall support:\na)\tprocedures specified in clause 5.3.2.1; and\nb)\tthe In-Reply-To header field.\nOn sending a REGISTER request, a SM-over-IP receiver that supports the MSISDN less operation shall include a \"+g.3gpp.smsip-msisdnless\" media feature tag into the Contact header field according to RFC 3840 [16]..\nNOTE:\tWhen in MSISDN less operation the SM-over-IP receiver gets the address of the originating side from the received XML document that is included in the body of the SIP MESAGE request.\nWhen a SIP MESSAGE request including a \"vnd.3gpp.sms\" MIME body is received then the SM-over-IP receiver shall:\n1)\tgenerate a SIP response according to RFC 3428 [14];\n2)\textract the payload encoded according to 3GPP TS 24.011 [8] for RP-DATA;\n3)\tcheck if the received short message contains a TP-OA field is set to the dummy MSISDN value as defined in 3GPP TS 23.003 [22]. If the TP-OA does not contain the dummy MSISDN value, then continue with the procedures in clause 5.3.2.4. If the TP-OA contains the dummy MSISDN value, then continue with the next steps;\n4)\tcheck if the received SIP MESSAGE contains a Feature-Caps header field with a \"+g.3gpp.smsip-msisdn-less\" header field parameter. If it is present then continue with the following steps, otherwise discard the received SIP MESSAGE and skip the following steps; and\n5)\tcreate a delivery report for the received short message. In order to do so send a SIP MESSAGE as follows:\na)\tthe Request-URI, which shall contain the address of the IP-SM-GW;\nNOTE 1:\tThe address of the IP-SM-GW is received in the P-Asserted-Identity header field in the received SIP MESSAGE request.\nb)\tthe From header field, which shall contain a public user identity of the SM-over-IP receiver;\nc)\tthe To header field, which shall contain the address of IP-SM-GW;\nd)\tthe In-Reply-To header field which shall contain the Call-Id of the received SIP MESSAGE;\ne)\tthe Content-Type header, which shall contain \"multipart/mixed\";\nf)\tapplication/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <To> element which contains the URI of the receiver of the short message delivery report; and\nNOTE 2:\tThe address of the receiver of the delivery report is taken from the <From> element of the xml document that has been received in the related SIP MESSAGE request.\ng)\tapplication/vnd.3gpp.sms MIME body containing the RP-ACK or RP-ERROR message for the SM delivery report as defined in 3GPP TS 24.011 [8].\nNOTE 3:\tThe SM-over-IP sender will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nWhen an SM-over-IP receiver wants to send a notification about UE having memory available, then the SM-over-IP receiver shall implement the procedures of clause 5.3.2.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.3\tIP-Short-Message-Gateway (IP-SM-GW)",
                            "text_content": "An IP-SM-GW for transport layer interworking provides the protocol interworking for the submission of short messages from the SM-over-IP sender to the SC, for the delivery of short messages from the SC to the SM-over-IP receiver, and for the SMS-Status Reports from the SC to the SM-over-IP sender.\nAn IP-SM-GW in MSISDN less operation provides for SIP MESSAGE based submission of short messages from the SM-over-IP sender to the SM-over-IP receiver, of SMS Submit Reports to the SM-over-IP sender and SMS-Status Reports to the SM-over-IP sender.\nIn addition to the procedures specified in clause 5.3.3, the IP-SM-GW shall support the procedures specified in clause 5.7 in 3GPP TS 24.229 [10].\nNOTE 1: If operator policy does not require the indication the availability status of public user identity for receiving SMS over IP messages, then IP-SM-GW will not receive third-party REGISTER request.\nUpon receipt of a third-party REGISTER request, the IP-SM-GW shall:\n-\tsend a 200 (OK) response for the REGISTER request;\n-\tif an MSISDN is received in the message body of the third party REGISTER request within the <service-info> XML element, store the MSISDN sent in the message body of the REGISTER request within the <service-info> XML element.\n-\tif no MSISDN is received,\na)\tif an Authorization header field was contained in the REGISTER request received from the UE that is contained in a \"message/sip\" MIME body of the third party REGISTER request, derive the IMSI from the private user identity obtained from the \"username\" header field parameter of  the Authorization header field in the REGISTER request received from the UE that is contained in a \"message/sip\" MIME body of the third party REGISTER request; or\nb)\tif no Authorization header field was contained in the REGISTER request received from the UE that is contained in a \"message/sip\" MIME body of the third party REGISTER request derive the IMSI from the public user identity obtained from the \"To\" header field in the REGISTER request received from the UE that is contained in a \"message/sip\" MIME body of the third party REGISTER request; and\nNOTE 2: The actual format of the <service-info> element is transparent to the S-CSCF.\nNOTE 3: The relation between private user identity and the IMSI is defined in 3GPP TS 23.003 [22].\nNOTE 4: 3GPP TS 24.229 [10] specifies how the REGISTER request from the UE can be included in the third party REGISTER request.\n-\tsubscribe to the reg event package for the public user identity registered at the user's registrar (S-CSCF) as described in RFC 3680 [15] and RFC 6665 [27].\nUpon receipt of a NOTIFY request the IP-SM-GW shall check the availability status for receiving SMS over IP messages, i.e. if the public user identity has a contact registered with the ability to receive SMS over IP messages. If the availability status of the public user identity for receiving SMS over IP messages has changed, the IP-SM-GW shall start a data update procedure to the HSS as specified in 3GPP TS 29.002 [11] to indicate that either the MSISDN or IMSI registered with it is available/unavailable for delivery of SMS.\nIf a routing information query is received from the HSS/HLR, the IP-SM-GW shall extract the MSISDN of the SM-over-IP receiver (destination UE) from the received message. If the IP-SM-GW has information about a public user identity associated with the MSISDN, the IP-SM-GW shall return its own address to the SMS-GMSC that originated the routing information query.\nIf the IP-SM-GW has no information related to the MSISDN of the SM-over-IP receiver (destination UE), the IP-SM-GW shall query the HSS/HLR for routing information. If the query results in an error response, the IP-SM-GW shall return the error response to the SMS-GMSC; otherwise the IP-SM-GW shall return its own address to the SMS-GMSC that originated the routing information query.\nNOTE:\tThe address of the SMS-GMSC is available in the received routing information query.\nNOTE 1:\tThe SIP MESSAGE received from the SM-over-IP sender/receiver will include a P-Asserted-Identity header (as defined in RFC 3325 [13]) containing a tel URI of the SM-over-IP sender/receiver and will contain either a short message (RP-DATA), or a notification for availability of memory (RP-SMMA), or a delivery report (RP-ACK or RP-ERROR).\nIf a SIP MESSAGE request including \"vnd.3gpp.sms\" payload is received from the SM-over-IP sender/receiver and the IP-SM-GW does not support the In-Reply-To header usage, the IP-SM-GW shall:\n1)\trespond with a 202 (Accepted) response;\n2)\textract and validate the format of the SC address from the received payload as defined in 3GPP TS 24.011 [8] and 3GPP TS 23.040 [3];\n3)\textract the RPDU type (see 3GPP TS 24.011 [8]) from the received payload;\n4)\tadd the MSISDN of the SM-over-IP receiver to the RP International Mobile Subscriber Identity field if the received payload is a notification for availability of memory. If the MSISDN of the SM-over-IP receiver is not available then insert the tel URI received in a P-Asserted-Identity header (as defined in RFC 3325 [13]) placed in the SIP MESSAGE request by the P-CSCF or S-CSCF; and\nNOTE 2:\tThe MSISDN is not available if the registration is not required according to the operator policy.\n5)\tinclude the RPDU type in the appropriate message to\n-\tthe SC via SMS-IWMSC in case of a short message;\n-\tthe SC via SMS-GMSC in case of a delivery report; or\n-\tthe HSS in case of a notification for availability of memory.\nIf step 2) or 3) above fails for message that contains RPDU with RP-DATA or RP-SMMA content, the IP-SM-GW shall send a SIP MESSAGE request with the following information:\na)\tthe Request-URI, containing the sending user's URI;\nb)\tthe Content-Type header, set to \"application/vnd.3gpp.sms\"; and\nc)\tthe body of the request containing an RP-ERROR message including an appropriate error code as defined in 3GPP TS 24.011 [8].\nNOTE 3:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nIf a SIP MESSAGE request including \"vnd.3gpp.sms\" payload is received from the sender/receiver, and the IP-SM-GW supports the In-Reply-To header, the IP-SM-GW shall:\n1)\tif the SIP MESSAGE does not include the In-Reply-To header:\na)\trespond with a 202 (Accepted) response;\nb)\textract and validate the format of the SC address from the received payload as defined in 3GPP TS 24.011 [8] and 3GPP TS 23.040 [3];\nc)\textract the RPDU type (see 3GPP TS 24.011 [8]) from the received payload;\nd)\tthe MSISDN of the SM-over-IP receiver to the RP International Mobile Subscriber Identity field if the received payload is a notification for availability of memory. If the MSISDN of the SM-over-IP receiver is not available then insert the tel URI received in a P-Asserted-Identity header (as defined in RFC 3325 [13]) placed in the SIP MESSAGE request by the P-CSCF or S-CSCF; and\nNOTE 4:\tThe MSISDN is not available if the registration is not required according to the operator policy.\ne)\tinclude the RPDU type in the appropriate message to\n-\tthe SC via SMS-IWMSC in case of a short message;\n-\tthe SC via SMS-GMSC in case of a delivery report; or\n-\tthe HSS in case of a notification for availability of memory.\nIf step b) or c) above fails for message that contains RPDU with RP-DATA or RP-SMMA content, the IP-SM-GW shall send a SIP MESSAGE request with the following information:\n-\tthe Request-URI, containing the sending user's URI;\n-\tthe Content-Type header, set to \"application/vnd.3gpp.sms\"; and\n-\tthe body of the request containing an RP-ERROR message including an appropriate error code as defined in 3GPP TS 24.011 [8].\nNOTE 5:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\n1)\tif the SIP MESSAGE includes the In-Reply-To header:\na)\tif the In-Reply-To header indicates that the request does not correspond to a short message submitted by the IP-SM-GW, send a 488 (Not Acceptable here) SIP response according to RFC 3428 [14];\nb)\tif the In-Reply-To header indicates that the request corresponds to a short message submitted by the IP-SM-GW:\n-\tgenerate a 202 (Accepted) SIP response according to RFC 3428 [14];\n-\textract and validate the format of the SC address from the received payload as defined in 3GPP TS 24.011 [8] and 3GPP TS 23.040 [3];\n-\textract the RPDU type (see 3GPP TS 24.011 [8]) from the received payload;\n-\tadd the MSISDN of the SM-over-IP receiver to the RP International Mobile Subscriber Identity field if the received payload is a notification for availability of memory. If the MSISDN of the SM-over-IP receiver is not available then insert the tel URI received in a P-Asserted-Identity header (as defined in RFC 3325 [13]) placed in the SIP MESSAGE request by the P-CSCF or S-CSCF; and\nNOTE 6:\tThe MSISDN is not available if the registration is not required according to the operator policy.\n-\tinclude the RPDU type in the appropriate message within the same MAP dialog delivering the short message to\n-\tthe SC via SMS-GMSC in case of a delivery report; or\n-\tthe HSS in case of a notification for availability of memory.\nNOTE 7:\tThe IP-SM-GW finding the MAP dialog using the SIP session identified by the Call-ID contained in the In-Reply-To header.\nif step 2) or 3) above fails for message that contains RPDU with RP-SMMA content, the IP-SM-GW shall send a SIP MESSAGE request with the following information:\n-\tthe Request-URI, containing the sending user's URI;\n-\tthe Content-Type header, set to \"application/vnd.3gpp.sms\"; and\n-\tthe body of the request containing an RP-ERROR message including an appropriate error code as defined in 3GPP TS 24.011 [8].\nNOTE 8:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nIf a short message is received from the SMS-GMSC, the IP-SM-GW shall extract the IMSI of the SM-over-IP receiver from the received message. Then the IP-SM-GW shall send a SIP MESSAGE request with the following information:\na)\tthe Request-URI, which shall contain a public user identity of the SM-over-IP receiver associated with the received IMSI;\nb)\tthe Accept-Contact header, which shall contain a \"+g.3gpp.smsip\" parameter and the \"explicit\" and \"require\" tags according to RFC 3841 [17];\nc)\tthe Request-Disposition header which shall contain the \"no-fork\" directive;\nd)\tthe P-Asserted-Identity header which shall contain the SIP URI of the IP-SM-GW;\ne)\tthe Content-Type header which shall contain \"application/vnd.3gpp.sms\"; and\nf)\tthe body of the request which shall contain an RP-DATA message as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3].\nNOTE 1:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nIf the IP-SM-GW cannot deliver the short message successfully in a SIP MESSAGE request and cannot deliver the short message via SGSN or MSC, then the IP-SM-GW will apply the procedures defined in 3GPP TS 29.311 [23] clause 6.1.4.4.1 to send a delivery report to SC via SMS-GMSC.\nNOTE 2:\tIf routing information is available (SGSN or MSC address or both), the IP-SM-GW can also attempt the delivery of a short message via SGSN or MSC or both before sending a delivery report to SC via SMS-GMSC. The priority order of these attempts (i.e., SMS over IP, SMS over CS, SMS over PS) is subject to operator policy. However, if no MSISDN is present in the short message then no routing information is obtainable by the IP-SM-GW, and attempting delivery of the short message via other domains (e.g. MSC, SGSN) by the IP-SM-GW is not possible.\nIf an SM submit report is received from the SMS-IWMSC, the IP-SM-GW shall retrieve the IMSI of the SM-over-IP sender from the existing MAP context. Then the IP-SM-GW shall obtain a corresponding public user identity and send a SIP MESSAGE request with the following information:\na)\tthe Request-URI, which shall contain a public user identity of the SM-over-IP sender;\nb)\tthe Accept-Contact header, which shall contain a \"+g.3gpp.smsip\" parameter and the \"explicit\" and \"require\" tags according to RFC 3841 [17];\nc)\tthe Request-Disposition header which shall contain the \"fork\" and optionally the \"parallel\" directives;\nd)\tthe In-Reply-To header which shall contain the Call-Id of the SIP MESSAGE request that included the submitted short message;\ne)\tthe P-Asserted-Identity header which shall contain the SIP URI of the IP-SM-GW;\nf)\tthe Content-Type header which shall contain \"application/vnd.3gpp.sms\"; and\ng)\tthe body of the request which shall contain an RP-ACK or RP-ERROR message as defined in 3GPP TS 24.011 [8].\nNOTE:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nIf a status report is received from the SMS-GMSC, the IP-SM-GW shall extract the IMSI of the SM-over-IP sender from the received message. Then the IP-SM-GW shall send a SIP MESSAGE request with the following information:\na)\tthe Request-URI, which shall contain a public user identity of the SM-over-IP sender associated with the received IMSI;\nb)\tthe Accept-Contact header, which shall contain a \"+g.3gpp.smsip\" parameter and the \"explicit\" and \"require\" tags according to RFC 3841 [17];\nc)\tthe Request-Disposition header which shall contain the \"no-fork\" directive;\nNOTE 1:\tThe status report is always sent to the SMS capable UE that registered with the highest q value.\nd)\tthe Content-Type header which shall contain \"application/vnd.3gpp.sms\"; and\ne)\tthe body of the request which shall contain an RP-DATA message as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3].\nNOTE 2:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nIf the IP-SM-GW cannot deliver the status report successfully in a SIP MESSAGE request and cannot deliver the short message via SGSN or MSC, then the IP-SM-GW will apply the procedures defined in 3GPP TS 29.311 [23] clause 6.1.4.4.1 to send a delivery report to SC via SMS-GMSC.\nNOTE 3:\tIf routing information is available (SGSN or MSC address or both), the IP-SM-GW can also attempt the delivery of a short message via SGSN or MSC or both before sending a delivery report to SC via SMS-GMSC. The priority order of these attempts (i.e., SMS over IP, SMS over CS, SMS over PS) is subject to operator policy.\nNOTE 4:\tThe SM-over-IP sender will acknowledge the status report with a delivery report.\nThis clause specifies the procedures for the IP-SM-GW to support the MSISDN less operation.\nAn IP-SM-GW supporting the procedures in this clause shall support the In-Reply-To header field.\nIf a SIP MESSAGE request is received from the sender/receiver including a\"vnd.3gpp.sms\" MIME body; then the IP-SM-GW shall:\n1)\tif the SIP MESSAGE request does not include the In-Reply-To header field:\na)\trespond with a 202 (Accepted) response according to RFC 3428 [14];\nb)\textract and validate the format of the SC address from the received payload as defined in 3GPP TS 24.011 [8] and 3GPP TS 23.040 [3];\nc)\textract the RPDU type (see 3GPP TS 24.011 [8]) from the received payload. If the received payload is a notification for availability of memory then include the RPDU in the appropriate message to the HSS an skip the following steps; and\nd)\textract the TP-DA field and check if the the TP-DA field it is set to the dummy MSISDN as defined in 3GPP TS 23.003 [22]. If the value is not set to the dummy MSISDN then continue with the procedures specified in clause 5.3.3.4.1. Otherwise the IP-SM-GW shall based on local policy determine whether the procedures in this clause are to be employed and shall:\nNOTE 1:\tLocal policy can e.g. include subscriber specific authorization and can include information support in the terminating side network.\nA)\tconstruct a SMS-DELIVER from the received SMS-SUBMIT. The TP-OA field shall be set to the dummy MSISDN value as defined in 3GPP TS 23.003 [22];\nB)\tset the Request-URI for the MESSAGE to be sent to what has been received in the <To> element in the received XML document;\nC)\tset the To header field to the same value as contained in the Request-URI;\nD)\tset the P-Asserted-Identity header field to its own SIP URI;\nE)\tset the From header field to its own SIP URI;\nG)\tinclude a Feature-Caps header field with a \"+g.3gpp.smsip-msisdn-less\" header field parameter;\nH)\tset the Content-Type header, which shall contain \"multipart/mixed\";\nI)\tinclude an application/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <From> element which contains the URI of the sender of the short message. The URI of the sender is taken from the P-Asserted-Identity header field of the related received SIP MESSAGE request;\nJ)\tinclude an application/vnd.3gpp.sms MIME body containing the RP-DATA message as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3] with a TP-DA field set to the dummy MSISDN value as defined in 3GPP TS 23.003 [22]; and\nK)\tsend the so created SIP MESSAGE request towards the terminating side IP-SM-GW.\nIf step b) or c) above fails for message that contains RPDU with RP-DATA content, the IP-SM-GW shall send a SIP MESSAGE request with the following information:\nA)\tthe Request-URI, containing the sending user's URI;\nB)\tthe Content-Type header, which shall contain \"multipart/mixed\";\nC)\tinclude a Feature-Caps header field with a \"+g.3gpp.smsip-msisdn-less\" header field parameter;\nD)\tinclude an application/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <From> element which contains the URI of the sender of the short message; and\nE)\tinclude an application/vnd.3gpp.sms MIME body containing the RP-ERROR message including an appropriate error code as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3].\nNOTE 2:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nIf the IP-SM-GW decides to not forward the received SIP MESSAGE request, the IP-SM-GW shall send a SIP MESSAGE request with the following information:\nA)\tthe Request-URI, containing the sending user's URI;\nB)\tthe Content-Type header, which shall contain \"multipart/mixed\";\nC)\tinclude a Feature-Caps header field with a \"+g.3gpp.smsip-msisdn-less\" header field parameter;\nD)\tinclude an application/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <From> element which contains the URI of the sender of the short message; and\nE)\tinclude an application/vnd.3gpp.sms MIME body containing the RP-ERROR message including an appropriate error code as defined in 3GPP TS 24.011  [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3]; or\nNOTE 3:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\n2)\tif the SIP MESSAGE request includes the In-Reply-To header field:\na)\tif the In-Reply-To header field indicates that the request does not correspond to a short message submitted by the IP-SM-GW, send a 488 (Not Acceptable here) SIP response according to RFC 3428 [14];\nb)\tif the In-Reply-To header field indicates that the request corresponds to a short message submitted by the IP-SM-GW and the IP-SM-GW has used clause 5.3.3.5.3 procedures for delivery of the short message:\nA)\tgenerate a 202 (Accepted) SIP response according to RFC 3428 [14];\nB)\textract and validate the format of the SC address from the received payload as defined in 3GPP TS 24.011 [8] and 3GPP TS 23.040 [3];\nC)\textract the RPDU type (see 3GPP TS 24.011 [8]) from the received payload;\nD)\tconstruct a new new payload based on the received payload;\nE)\tset the R-URI of the SIP MESSAGE request to the address of the entity that has sent the related SIP MESSAGE request identified via the context that relates to the In-Reply-To header field;\nF)\tset the To header field to the same value as contained in the Request-URI;\nG)\tset the P-Asserted-Identity header field to its own SIP URI;\nH)\tset the From header field to its own SIP URI;\nI)\tinclude a Feature-Caps header field with a \"+g.3gpp.smsip-msisdn-less\" header field parameter;\nI)\tset the Content-Type header, which shall contain \"multipart/mixed\";\nJ)\tinclude an application/vnd.3gpp.sms MIME body containing the the RPDU type in the SIP MESSAGE request ;\nNOTE 4:\tThe RPDU contains a delivery report.\nK)\tinclude an application/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <From> element which contains the URI of the sender of the short message. The URI of the sender is taken from the P-Asserted-Identity header field of the related received SIP MESSAGE request; and\nL)\tsend the so created SIP MESSAGE request.\nIf a short message contained in a SIP MESSAGE request is received that has been sent by the originating side IP-SM-GW as specified in clause 5.3.3.5.2, the IP-SM-GW shall send a SIP MESSAGE request with the following information:\n1)\tthe Request-URI, which shall contain a public user identity as received from the originating side;\n2)\tthe Accept-Contact header field, which shall contain a \"+g.3gpp.smsip-msisdn-less\" parameter and the \"explicit\" and \"require\" tags according to RFC 3841 [17];\n3)\tthe Request-Disposition header field which shall contain the \"no-fork\" directive;\n4)\tthe From header field which shall contain the SIP URI of the IP-SM-GW;\n5)\tthe P-Asserted-Identity header field which shall contain the SIP URI of the IP-SM-GW;\n6)\tinclude a Feature-Caps header field with a \"+g.3gpp.smsip-msisdn-less\" header field parameter;\n7)\tset the Content-Type header, which shall contain \"multipart/mixed\";\n8)\tinclude an application/vnd.3gpp.sms MIME body containing the RP-DATA message as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3] as received in the incoming SIP MESSAGE request; and\nNOTE 1:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\n9)\tinclude an application/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <From> element which contains the URI of the sender of the short message.\nWhen the IP-SM-GW receives any 4xx, 5xx, or 6xx response to a SIP MESSAGE, the IP-SM-GW shall send a SIP MESSAGE with the following information:\n1)\ta Request-URI, which shall contain the identity as received in the P-Asserted-Identity in the related SIP MESSAGE request from the originating side;\n2)\ta From header field which shall contain the SIP URI of the IP-SM-GW;\n3)\ta P-Asserted-Identity header field which shall contain the SIP URI of the IP-SM-GW;\n4)\ta Feature-Caps header field with a \"+g.3gpp.smsip-msisdn-less\" header field parameter;\n5)\ta Content-Type header as specified in RFC 5621 [25], which shall contain \"multipart/mixed\";\n6)\tan application/vnd.3gpp.sms MIME body containing the RP-ERROR message as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3] as received in the incoming SIP MESSAGE request; and\nNOTE 3:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\n7)\tan application/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <Correlation-ID> element and a single <Delivery-Outcome> element set to \"SMDeliveryFailure\" as defined in annex C.1.3.\nIf a deliver report contained in a SIP MESSAGE request is received that has been sent by the terminating side IP-SM-GW as specified in clause 5.3.3.5.2 and the IP-SM-GW decides to send a status report to the SM-over-IP-sender as specified in 3GPP TS 23.040 [3], the IP-SM-GW shall send a SIP MESSAGE request with the following information:\n1)\tthe Request-URI, which shall contain a public user identity as received in the related SIP MESSAGE request;\n2)\tthe Accept-Contact header field, which shall contain a \"+g.3gpp.smsip-msisdn-less\" media feature tag and the \"explicit\" and \"require\" tags according to RFC 3841 [17];\n3)\tthe Request-Disposition header field which shall contain the \"no-fork\" directive;\n4)\tthe From header field which shall contain the content of the P-Asserted-Identity header field\n5)\tthe P-Asserted-Identity header field which shall contain the SIP URI of the IP-SM-GW;\n6)\tthe Content-Type header, which shall contain \"multipart/mixed\";\n7)\tinclude a Feature-Caps header field with a \"+g.3gpp.smsip-msisdn-less\" header field parameter;\n8)\tconstruct an SMS-STATUS-REPORT based on the received SMS-DELIVER-REPORT;\n9)\tan application/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <From> element which contains the URI of the sender of the short message; and\n10)\tinclude an application/vnd.3gpp.sms MIME body containing the RP-DATA message as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3] as received in the related SIP MESSAGE request.\nNOTE 1:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\nIf a delivery report indicating no success contained in a SIP MESSAGE request is received that has been sent by the terminating side IP-SM-GW, the IP-SM-GW shall:\n1)\textract the received payload from the \"vnd.3gpp.sms\" payload; and\n2)\textract the received payload from the \"vnd.3gpp.sms+xml\" payload;\nThe IP-SM-GW will update the SC with the appropriate message as defined in 3GPP TS 29.002 [11]. The IP-SM-GW shall treat an unknown value in the <Delivery-Outcome> element as it treats the value \"SMDeliveryFailure\".\nNOTE 2:\tThe IP-SM-GW will send a MO_FORWARD_SM to the SC.\nThe IP-SM-GW may support sending of SM submit report. When the IP-SM-GW sends a SM submit report, the IP-SM-GW shall support the procedures as specified in clause 5.3.3.4.3 starting with item a.\nIf a SIP MESSAGE request is received from another IP-SM-GW containing a\"vnd.3gpp.sms\" MIME body; then the IP-SM-GW shall:\nNOTE 1:\tIt is configuration specific how the IP-SM-GW finds out that a SIP MESSAGE request is received from another IP-SM-GW\n1)\tsend a SIP 202 (Accepted) response according to RFC 3428 [14];\n2)\tsave the SIP URI of the sending IP-SM-GW, contained in the P-Asserted-Identity header field of the received SIP MESSAGE request; and\n3)\tdeliver the received content to the SM-over-IP-receiver as described in clause 5.3.3.5.3 or SM-over-IP-sender as described in clause 5.3.3.5.4\nIf the IP-SM-GW cannot deliver the short message in a SIP MESSAGE request then the IP-SM-GW shall send a delivery report encapsulated in a SIP MESSAGE request to the originating side with the following information:\n1)\ta Request-URI, which shall contain the identity as received in the P-Asserted-Identity in the related SIP MESSAGE request from the originating side;\n2)\ta From header field which shall contain the SIP URI of the IP-SM-GW;\n3)\ta P-Asserted-Identity header field which shall contain the SIP URI of the IP-SM-GW;\n4)\ta Feature-Caps header field with a \"+g.3gpp.smsip-msisdn-less\" header field parameter;\n5)\ta Content-Type header as specified in RFC 5621 [25], which shall contain \"multipart/mixed\";\n6)\tan application/vnd.3gpp.sms MIME body containing the RP-ERROR message as defined in 3GPP TS 24.011 [8], including the SMS headers and the SMS user information encoded as specified in 3GPP TS 23.040 [3] as received in the incoming SIP MESSAGE request; and\nNOTE 2:\tThe IP-SM-GW will use content transfer encoding of type \"binary\" for the encoding of the SM in the body of the SIP MESSAGE request.\n7)\tan application/vnd.3gpp.sms+xml MIME body as described in clause D.1 with a Content-Disposition header field set to \"render\" and with \"handling\" header field parameter set to \"optional\". The XML document shall contain a single <Correlation-ID> element and a single <Delivery-Outcome> element populated as defined in annex C.1.3.\nWhen initiating a SIP failure response to any received SIP request, depending on operator policy, the IP-SM-GW may insert a SIP Response-Source header field in accordance with the procedures in clause 5.7.1.0 of 3GPP TS 24.229 [10], where the \"role\" header field parameter is set to \"ip-sm-gw\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "A.1\tGeneral",
            "description": "This clause describes the media feature tag definitions that are applicable for the 3GPP IM CN Subsystem for the realisation of SMS over IP.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.2\tDefinition of media feature tag g.3gpp.smsip",
            "description": "Media feature tag name: g.3gpp.smsip\nASN.1 Identifier: 1.3.6.1.8.2.3\nSummary of the media feature indicated by this tag: This feature-tag indicates that the device is capable of accepting SMS messages via SIP.\nValues appropriate for use with this media feature tag: Boolean.\nThe media feature tag is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This media feature tag is most useful within SIP for noting the SMS capabilities of a device, such as a phone or PDA.\nExamples of typical use: Indicating that a mobile phone can receive short message encapsulated in a SIP MESSAGE request.\nRelated standards or documents: 3GPP TS 24.341: \"Support of SMS over IP networks, stage 3\"\nSecurity Considerations: Security considerations for this media feature tag are discussed in clause 11.1 of RFC 3840 [16].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.3\tDefinition of media feature tag g.3gpp.smsip-msisdn-less",
            "description": "Media feature-tag name: g.3gpp.smsip-msisdn-less\nASN.1 Identifier: .1.8.2.25\nSummary of the media feature indicated by this tag: This media feature-tag when used in a Contact header field of a SIP request or a SIP response indicates that the functional entity sending the SIP message supports MSISDN less operation of SMS via SIP MESSAGE request.\nValues appropriate for use with this feature-tag: Boolean\nThe feature-tag is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-tag is most useful in a communications application, for describing the capabilities of a device, such as a phone or PDA.\nExamples of typical use: Indicating that a user equipment supports MSISDN less operation of SMS via SIP MESSAGE request..\nRelated standards or documents: 3GPP TS 24.341: \"Support of SMS over IP networks, stage 3\", Relese 12, available via http://www.3gpp.org/specs/numbering.htm\nSecurity Considerations: Security considerations for this media feature-tag are discussed in clause 12.1 of IETF RFC 3840 [53].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.1\tScope of signalling flows",
            "description": "This annex gives examples of signalling flows for the SMS over IP within the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP) and SIP Events.\nThese signalling flows provide detailed signalling flows, which expand on the overview information flows provided in 3GPP TS 23.204 [5].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.2\tIntroduction",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The signalling flows provided in this annex follow the methodology developed in 3GPP TS 24.228 [9]. The following additional considerations apply:\na)\t3GPP TS 24.228 [9] shows separate signalling flows with no configuration hiding between networks, and with configuration hiding between networks. There is no SMS over IP specific functionality associated with this hiding, and therefore such separate signalling flows are not show in the present document; and\nb)\t3GPP TS 24.228 [9] does not show the functionality between the S-CSCF and the AS. As the SMS over IP functionality depends on the functionality provided by an AS, the signalling flows between S-CSCF and AS are shown in the present document.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2.2\tKey required to interpret signalling flows",
                    "description": "",
                    "summary": "",
                    "text_content": "The key to interpret signalling flows specified in 3GPP TS 24.228 [9] clauses 4.1 and 4.2 applies with the additions specified below.\n-\tipsmgw.home1.net, ipsmgw.home2.net: IP-SM-GW in the home network of the SM-over-IP sender/receiver;\n-\tsc.home1.net: PSI of the SC of the SM-over-IP sender\n-\tuser1_public1@home1.net: SM-over-IP sender; and\n-\tuser2_public2@home2.net: SM-over-IP receiver.\nAs in 3GPP TS 24.228 [9], in order to differentiate between SIP methods and other protocol messages, the message name is preceded with the associated protocol for all non-SIP messages.\nEach signalling flow table contains descriptions for headers where the content of the header is new to that signalling flow, as is already performed in 3GPP TS 24.228 [9].\nHowever, 3GPP TS 24.228 [9] includes extensive descriptions for the contents of various headers following each of the tables representing the contents of the signalling flows. Where the operation of the header is identical to that shown in 3GPP TS 24.228 [9], then such text is not reproduced in the present document.\nAdditional text may also be found on the contents of headers within 3GPP TS 24.228 [9] in addition to the material shown in the present document.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.3\tSignalling flows demonstrating how IP-SM-GW indicates to HSS the availability of public user identity for delivery of short messages",
            "description": "\nThe figure depicts the registration signalling of IP-SM-GWs in a 3GPP network. It illustrates the process of registering IP-SM-GWs with the network, highlighting the use of registration keys and the need for network management.\nFigure B.3-1: IP-SM-GW registration signalling\nFigure B.3-1 shows the registration signalling flow for the scenario when IP-SM-GW registers to HSS. The details of the signalling flows are as follows:\n1.\tSee 3GPP TS 24.228 [9], clause 6.2 steps 1 through 22\nNOTE 1:\t3GPP TS 24.228 [9] contains Rel-5 registration; additional parameters might appear in Rel-7 registration.\n2.\tInitial filter criteria\nThe S-CSCF analyses the incoming request against the initial filter criteria and decides to send a third-party REGISTER request to the IP-SM-GW. Initial Filter Criteria for IP-SM-GW includes a Service Information that contains the MSISDN belonging to \"sip:user1_public1@home1.net\".\n3.\tREGISTER request (S-CSCF to IP-SM-GW) - see example in table B.3-1\nThis signalling flow forwards the REGISTER request from the S-CSCF to the IP-SM-GW.\nTable B.3-1: REGISTER request (S-CSCF to IP-SM-GW)\nREGISTER sip:ipsmgw.home1.net SIP/2.0\nVia: SIP/2.0/UDP sip:scscf1.home1.net\nMax-Forwards: 70\nP-Access-Network-Info:\nP-Visited-Network-ID:\nP-Charging-Vector:\nP-Charging-Function-Addresses:\nFrom: <sip:scscf1.home1.net>;tag=14142\nTo: <sip:user1_public1@home1.net>\nContact: <sip:scscf1.home1.net>\nExpires: 600000\nCall-ID: apb03a0s09dkjdfglkj49112\nCSeq: 43 REGISTER\nContent-Type: application/3gpp-ims+xml\nContent-Length: (...)\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<ims-3gpp version=\"1\">\n<service-info>11111111</service-info>\n</ims-3gpp>\n\n4.\t200 OK response (IP-SM-GW to S-CSCF) - see example in table B.3-2\nThe IP-SM-GW sends a 200 (OK) response to the S-CSCF indicating that registration was successful.\nTable B.3-2: 200 OK response (IP-SM-GW to S-CSCF)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP sip:scscf1.home1.net\nFrom:\nTo:\nCall-ID:\nContact: <sip:scscf1.home1.net>;expires=600000\nCSeq:\nDate: Wed, 11 July 2001 08:49:37 GMT\nContent-Length:\n\n5.\tSUBSCRIBE request (IP-SM-GW to S-CSCF) – see example in table B.3-3\nThe IP-SM-GW subscribes to the S-CSCF for the registration status of the registered subscriber.\nTable B.3-3 SUBSCRIBE request (IP-SM-GW to S-CSCF)\nSUBSCRIBE sip:user1_public1@home1.net SIP/2.0\nMax-Forwards: 70\nRoute: <sip:scscf1.home1.net;lr>\nP-Asserted-Identity: <sip:ipsmgw.home1.net>\nP-Charging-Vector: icid-value=\"gwrg65hy35gw5hfrD46=583735358\"; orig-ioi=\"type-3home1.net\"\nP-Charging-Function-Addresses: ccf=[5555:c88:d77::c66]; ecf=[5555:c88:d77::e67]\nFrom: <sip:ipsmgw.home1.net>;tag=31415286\nTo: <sip: user1_public1@home1.net>\nCall-ID: 56uher6y5hrwy5wseg5y4w\nCSeq: 111 SUBSCRIBE\nEvent: reg\nExpires: 600000\nAccept: application/reginfo+xml\nContact: <sip:ipsmgw.home1.net>\nContent-Length: 0\n\nRequest-URI:\tPublic user identity whose registration status event the IP-SM-GW subscribes to.\n6.\t200 (OK) response (S-CSCF to IP-SM-GW) - see example in table B.3-4\nThe S-CSCF sends a 200 (OK) response to the IP-SM-GW.\nTable B.3-4: 200 (OK) response (S-CSCF to IP-SM-GW)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK240tfe2\nP-Asserted-Identity:\nFrom: <sip:ipsmgw.home1.net>;tag=31415286\nTo: <sip:scscf1.home1.net>;tag=14142\nCall-ID:\nCSeq:\nContact:\nExpires:\nContent-Length:\n\n7.\tNOTIFY request (S-CSCF to IP-SM-GW) - see example in table B.3-5\nThe S-CSCF sends a first NOTIFY request to the IP-SM-GW. The notification indicates that the monitored public user identity registered using an SMS capable UE.\nTable B.3-5: NOTIFY request (S-CSCF to IP-SM-GW)\nNOTIFY sip:ipsmgw.home1.net SIP/2.0\nMax-Forwards: 70\nFrom: <sip: user1_public1@home1.net>;tag=14142\nTo: <sip:ipsmgw.home1.net>;tag=31415286\nCall-ID: 56uher6y5hrwy5wseg5y4w\nCSeq: 222 NOTIFY\nSubscription-State: active;expires=600000\nEvent: reg\nContent-Type: application/reginfo+xml\nContact: <sip:scscf1.home1.net>\nContent-Length: (...)\n\n<?xml version=\"1.0\"?>\n<reginfo xmlns=\"urn:ietf:params:xml:ns:reginfo\" version=\"1\" state=\"full\">\n<registration aor=\"sip:user1_public1@home1.net\" id=\"a7\" state=\"active\">\n<contact id=\"76\" state=\"active\" event=\"registered\">\n<uri>sip:[5555::aaa:bbb:ccc:ddd]</uri>\n<unknown-param name=\"+g.3gpp.smsip\"/>\n</contact>\n</registration>\n</reginfo>\n\n8.\t200 (OK) response (IP-SM-GW to S-CSCF) - see example in table B.3-6\nIP-SM-GW sends a 200 (OK) response to the S-CSCF.\nTable B.3-6: 200 (OK) response (IP-SM-GW to S-CSCF)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK240tfe2\nFrom:\nTo:\nCall-ID:\nCSeq:\nContent-Type:\nContent-Length: 0\n\n9.\tMAP: AnyTimeModification\nThe IP-SM-GW sends the request to inform the HSS/HLR that the user with MSISDN \"11111111\" is ready to receive short messages for delivery via IP via the sender of the request.\nFor detailed message flows and coding see 3GPP TS 29.002 [11].\nTable B.3-7 provides the parameters in the AnyTimeModification request, which are sent to the HSS/HLR.\nTable B.3-7: Data update procedure (IP-SM-GW to HSS/HLR)\n\n10.\tMAP: AnyTimeModification response\nThe HSS/HLR acknowledges the request.\nNOTE 2:\tThe positive ATM response (Result message) does not contain any result code, negative response (Error message) contains an error code.\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table B.3-7: Data update procedure (IP-SM-GW to HSS/HLR)",
                    "table number": 1,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.4\tSignalling flows demonstrating how IP-SM-GW indicates to HSS the unavailability of UE for delivery of short messages",
            "description": "The figure depicts a simplified representation of IP-SM-GW deregistration signalling, which is a crucial process in the IP-based network architecture. The figure illustrates the deregistration process, including the deregistration request, deregistration request response, and deregistration confirmation. The deregistration request is sent to the IP-SM-GW, which then sends a response indicating that the deregistration request has been received and processed. The deregistration confirmation is then sent back to the IP-SM-GW, confirming that the deregistration process has been completed. This figure provides a clear and concise visual representation of the deregistration process, making it easier to understand and follow in a network management context.\nFigure B.4-1: IP-SM-GW deregistration signalling\nFigure B.4-1 shows the registration signalling flow for the scenario when IP-SM-GW deregisters to HSS. The details of the signalling flows are as follows:\n1.\tSee 3GPP TS 24.228 [9], clause 6.2 steps 1 through 22\nExpires header set to zero. Public user identity deregisters its last SMS capable contact.\nNOTE 1: A flow for deregistration is not provided in 3GPP TS 24.228 [9]. However, deregistration is similar to a registration with the Expires header set to zero. Compared to a Rel-5 deregistration additional parameters might appear in a later release.\n2.\tNOTIFY request (S-CSCF to IP-SM-GW) - see example in table B.4-1\nThe S-CSCF sends a first NOTIFY request to the IP-SM-GW. The notification indicates that the monitored public user identity is not registered any more with an SMS capable UE.\nTable B.4-1: NOTIFY request (S-CSCF to IP-SM-GW)\nNOTIFY sip:ipsmgw.home1.net SIP/2.0\nMax-Forwards: 70\nFrom: <sip: user1_public1@home1.net>;tag=14142\nTo: <sip:ipsmgw.home1.net>;tag=31415286\nCall-ID: 56uher6y5hrwy5wseg5y4w\nCSeq: 222 NOTIFY\nSubscription-State: active;expires=234546\nEvent: reg\nContent-Type: application/reginfo+xml\nContact: <sip:scscf1.home1.net>\nContent-Length: (...)\n\n<?xml version=\"1.0\"?>\n<reginfo xmlns=\"urn:ietf:params:xml:ns:reginfo\" version=\"1\" state=\"full\">\n<registration aor=\"sip:user1_public1@home1.net\" id=\"a7\" state=\"terminated\">\n<contact id=\"77\" state=\"terminated\" event=\"unregistered\">\n<uri>sip:[5555::aaa:bbb:ccc:ddd]</uri>\n</contact>\n</registration>\n<registration aor=\"sip:user1_public2@home1.net\" id=\"a8\" state=\"active\">\n<contact id=\"77\" state=\"active\" event=\"registered\">\n<uri>sip:[5555::aaa:bbb:ccc:eee]</uri>\n</contact>\n</registration>\n</reginfo>\n\n3.\t200 (OK) response (IP-SM-GW to S-CSCF) - see example in table B.4-2\nIP-SM-GW sends a 200 (OK) response to the S-CSCF.\nTable B.4-2: 200 (OK) response (IP-SM-GW to S-CSCF)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK240tfe2\nFrom:\nTo:\nCall-ID:\nCSeq:\nContent-Type:\nContent-Length: 0\n\n4.\tMAP: AnyTimeModification\nThe IP-SM-GW sends the request to inform the HSS/HLR that the user with MSISDN \"11111111\" is not available to receive short messages for delivery via IP via the sender of the request.\nFor detailed message flows and coding see 3GPP TS 29.002 [11].\nTable B.4-3 provides the parameters in the AnyTimeModification request, which are sent to the HSS/HLR.\nTable B.4-3: MAP: AnyTimeModification request (IP-SM-GW to HSS/HLR)\n\n5.\tMAP: AnyTimeModification response\nThe HSS/HLR acknowledges the request.\nNOTE 2:\tThe positive ATM response (Result message) does not contain any result code; negative response (Error message) contains an error code.\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table B.4-3: MAP: AnyTimeModification request (IP-SM-GW to HSS/HLR)",
                    "table number": 2,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.5\tSignalling flows demonstrating successful UE originated SM submit procedure over IP",
            "description": "The figure depicts a simplified process for an UE (User Equipment) to initiate a 5-1-1 SM (Service Mobility) request over IP signalling. The figure illustrates the steps involved in the request, including the submission of the request, the transmission of the request, and the response from the network. The figure is a simplified representation of the actual process, and the complexity of the process is not depicted.\nFigure B.5-1: UE originated SM submit procedure over IP signalling\nFigure B.5-1 shows a successful UE originated SM over IP submission. For simplicity it is assumed that IP-SM-GW has direct access to SC. The details of the signalling flows are as follows:\n1.\tMESSAGE request (UE to P-CSCF) - see example in table B.5-1\nThis request includes a vnd.3gpp.sms payload that includes the short message and routing information for the IP-SM-GW to forward the short message.\nTable B.5-1: MESSAGE request (UE to P-CSCF)\nMESSAGE sip:sc.home1.net SIP/2.0\nVia: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nMax-Forwards: 70\nRoute: <sip:pcscf1.visited1.net:7531;lr;comp=sigcomp>, <sip:orig@scscf1.home1.net;lr>\nP-Preferred-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nFrom: <sip:user1_public1@home1.net>; tag=171828\nTo: <sip:sc.home1.net.net>\nCall-ID: cb03a0s09a2sdfglkj490333\nCseq: 666 MESSAGE\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\nRequest-URI:\tPSI of the SC of user1_public1@home1.net.\nThe payload includes an RP-DATA message (see 3GPP TS 24.011 [8]). It includes:\n-\tAddress of the originating UE: this field includes the length indicator only;\n-\tAddress of the destination SC, which is configured in the UE; and\n-\tRP-User-Data (see 3GPP TS 24.011 [8]), which includes SMS-SUBMIT (see 3GPP TS 23.040 [3]) as type indicator.\n2.\tMESSAGE request (P-CSCF to S-CSCF) - see example in table B.5-2\nTable B.5-2: MESSAGE request (P-CSCF to S-CSCF)\nMESSAGE sip:sc.home1.net SIP/2.0\nVia: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f341, SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nMax-Forwards: 69\nRoute: <sip:orig@scscf1.home1.net;lr>\nP-Asserted-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nFrom: <sip:user1_public1@home1.net>; tag=171828\nTo: <sip:sc.home1.net>\nCall-ID: cb03a0s09a2sdfglkj490333\nCseq: 666 MESSAGE\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\n3.\tInitial filter criteria\nThe S-CSCF analyses the incoming request against the initial filter criteria and decides to send the SIP MESSAGE request to the IP-SM-GW.\n4.\tMESSAGE request (S-CSCF to IP-SM-GW) - see example in table B.5-3\nTable B.5-3: MESSAGE request (S-CSCF to IP-SM-GW)\nMESSAGE sip:sc.home1.net SIP/2.0\nVia: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK344a651, SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f341, SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nMax-Forwards: 68\nRoute: <sip:ipsmgw.home1.net;lr>, <sip:cb03a0s09a2sdfglkj490333@scscf1.home1.net;lr>\nP-Asserted-Identity: \"John Doe\" <sip:user1_public1@home1.net>\nP-Asserted-Identity: tel:+12125551111\nFrom: <sip:user1_public1@home1.net>; tag=171828\nTo: <sip:sc.home1.net>\nCall-ID: cb03a0s09a2sdfglkj490333\nCseq: 666 MESSAGE\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\n5.\t202 (Accepted) response (IP-SM-GW to S-CSCF) - see example in table B.5-4\nTable B.5-4: 202 (Accepted) response (IP-SM-GW to S-CSCF)\nSIP/2.0 202 Accepted\nVia: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK344a651, SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f341, SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nFrom:\nTo:\nCall-ID:\nCseq:\n\n6.\t202 (Accepted) response (S-CSCF to P-CSCF) - see example in table B.5-5\nTable B.5-5: 202 (Accepted) response (S-CSCF to P-CSCF)\nSIP/2.0 202 Accepted\nVia: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK240f341, SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nFrom:\nTo:\nCall-ID:\nCseq:\n\n7.\t202 (Accepted) response (P-CSCF to UE) - see example in table B.5-6\nTable B.5-6: 202 (Accepted) response (P-CSCF to UE)\nSIP/2.0 202 Accepted\nVia: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nFrom:\nTo:\nCall-ID:\nCseq:\n\n8.\tExtracting and forwarding the short message, waiting and processing report\nThe IP-SM-GW forwards the short message TPDU (SMS-SUBMIT) to the SC. The SC returns a submit report which includes SMS-SUBMIT-REPORT as type indicator.\n9.\tMESSAGE request (IP-SM-GW to S-CSCF) - see example in table B.5-7\nThis request includes a vnd.3gpp.sms payload that includes the short message submission report and routing information for the IP-SM-GW to forward the submission report.\nTable B.5-7: MESSAGE request (IP-SM-GW to S-CSCF)\nMESSAGE sip:user1_public1@home1.net SIP/2.0\nVia: SIP/2.0/UDP ipsmgw.home1.net; branch=z9hG4bK876ffa3\nMax-Forwards: 70\nRoute: <sip:scscf1.home1.net;lr>\nFrom: <sip:ipsmgw.home1.net>; tag=583558\nTo: <sip:user1_public1@home1.net>\nCall-ID: fy365h43g3f36f3f6fth74g3\nCseq: 888 MESSAGE\nP-Asserted-Identity: <sip:ipsmgw.home1.net>\nIn-Reply-to: cb03a0s09a2sdfglkj490333\nRequest-Disposition:fork,parallel\nAccept-Contact: *;+g.3gpp.smsip;require;explicit\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\nRequest-URI:\tPublic user identity receiving the submission report.\nThe payload includes an RP-ACK message (see 3GPP TS 24.011 [8]). It includes RP-User-Data (see 3GPP TS 24.011 [8]), which includes SMS-SUBMIT-REPORT (see 3GPP TS 23.040 [3]) as type indicator.\n10.\tMESSAGE request (S-CSCF to P-CSCF) - see example in table B.5-8\nTable B.5-8: MESSAGE request (S-CSCF to P-CSCF)\nMESSAGE sip:[5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp SIP/2.0\nVia: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK344a651, SIP/2.0/UDP ipsmgw.home1.net; branch=z9hG4bK876ffa3\nMax-Forwards: 69\nRoute: <sip:pcscf1.visited1.net:7531;lr;comp=sigcomp>\nFrom: <sip:ipsmgw.home1.net>; tag=583558\nTo: <sip:user1_public1@home1.net>\nCall-ID: fy365h43g3f36f3f6fth74g3\nCseq: 888 MESSAGE\nP-Asserted-Identity: <sip:ipsmgw.home1.net>\nP-Called-Party-ID: <sip:user1_public1@home1.net>\nIn-Reply-to: cb03a0s09a2sdfglkj490333\nRequest-Disposition:fork,parallel\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\n11.\tMESSAGE request (P-CSCF to UE) - see example in table B.5-9\nTable B.5-9: MESSAGE request (P-CSCF to UE)\nMESSAGE sip:[5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp SIP/2.0\nVia: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK2524fd2, SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK344a651, SIP/2.0/UDP ipsmgw.home1.net; branch=z9hG4bK876ffa3\nMax-Forwards: 68\nFrom: <sip:ipsmgw.home1.net>; tag=583558\nTo: <sip:user1_public1@home1.net>\nCall-ID: fy365h43g3f36f3f6fth74g3\nCseq: 888 MESSAGE\nP-Called-Party-ID: <sip:user1_public1@home1.net>\nIn-Reply-to: cb03a0s09a2sdfglkj490333\nRequest-Disposition:fork,parallel\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\n12.\t200 (OK) response (UEto P-CSCF) - see example in table B.5-10\nTable B.5-10: 200 (OK) response (UE to P-CSCF)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP pcscf1.visited1.net;branch=z9hG4bK2524fd2, SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK344a651, SIP/2.0/UDP ipsmgw.home1.net; branch=z9hG4bK876ffa3\nFrom:\nTo:\nCall-ID:\nCseq:\n\n13.\t200 (OK) response (P-CSCF to S-CSCF) - see example in table B.5-11\nTable B.5-11: 200 (OK) response (P-CSCF to S-CSCF)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP scscf1.home1.net;branch=z9hG4bK344a651, SIP/2.0/UDP ipsmgw.home1.net; branch=z9hG4bK876ffa3\nFrom:\nTo:\nCall-ID:\nCseq:\n\n14.\t200 (OK) response (S-CSCF to IP-SM-GW) - see example in table B.5-12\nTable B.5-12: 200 (OK) response (S-CSCF to IP-SM-GW)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP ipsmgw.home1.net; branch=z9hG4bK876ffa3\nFrom:\nTo:\nCall-ID:\nCseq:\n\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.6\tSignalling flows demonstrating successful UE terminated SM deliver procedure over IP (including delivery report)",
            "description": "The figure depicts the UE-originated SM delivery procedure over IP signalling, illustrating the steps involved in delivering a signal from an originating source to a destination. The figure includes various components such as the source, the destination, the IP network, and the IP signalling protocol. The figure is a visual representation of the complex process of data transmission, highlighting the importance of IP signalling in modern communication systems.\nFigure B.6-1: UE originated SM deliver procedure over IP signalling\nIt is assumed that \"sip:user2_public2@home2.net\" associated with MSISDN=11111111 is registered at ipsmgw.home2.net using an SMS capable UE.\nFigure B.6-1 shows a successful UE terminated SM over IP delivery. The details of the signalling flows are as follows:\n1.\tReceiving SM from SC\nThe IP-SM-GW receives a short message from SC (sc.home1.net) which includes SMS-DELIVER as type indicator and MSISDN=11111111 as destination UE.\n2.\tMESSAGE request (IP-SM-GW to S-CSCF) - see example in table B.6-1\nThis request includes a vnd.3gpp.sms payload that includes the short message and routing information for the S-CSCF to forward the short message.\nTable B.6-1: MESSAGE request (IP-SM-GW to S-CSCF)\nMESSAGE sip:user2_public2@home2.net SIP/2.0\nVia: SIP/2.0/UDP ipsmgw.home2.net; branch=z9hG4bK876ffa3\nMax-Forwards: 70\nRoute: <sip:scscf1.home2.net;lr>\nFrom: <sip:ipsmgw.home2.net>; tag=583558\nTo: <sip:user2_public2@home2.net>\nCall-ID: fy365h43g3f36f3f6fth74g3\nCseq: 888 MESSAGE\nP-Asserted-Identity: sip:ipsmgw.home2.net\nRequest-Disposition: no-fork\nAccept-Contact: *;+g.3gpp.smsip;require;explicit\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\nRequest-URI:\tPublic user identity receiving the delivery report.\nThe payload includes the RP-DATA message (see 3GPP TS 24.011 [8]). Its RP-User-Data information element includes a TPDU of type SMS-DELIVER.\n3.\tMESSAGE request (S-CSCF to P-CSCF) - see example in table B.6-2\nS-CSCF performs the caller preferences to callee capabilities matching and builds the Request-URI with the selected contact.\nTable B.6-2: MESSAGE request (S-CSCF to P-CSCF)\nMESSAGE sip:[5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp SIP/2.0\nVia: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK344a651, SIP/2.0/UDP ipsmgw.home2.net; branch=z9hG4bK876ffa3\nMax-Forwards: 69\nRoute: <sip:pcscf2.visited2.net:7531;lr;comp=sigcomp>\nFrom: <sip:ipsmgw.home2.net>; tag=583558\nTo: <sip:user2_public2@home2.net>\nCall-ID: fy365h43g3f36f3f6fth74g3\nCseq: 888 MESSAGE\nP-Asserted-Identity: sip:ipsmgw.home2.net\nP-Called-Party-ID: <sip:user2_public2@home2.net>\nRequest-Disposition: no-fork\nAccept-Contact: *;+g.3gpp.smsip;require;explicit\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\nRequest-URI:\tSMS capable contact of the public user identity.\n\n4.\tMESSAGE request (P-CSCF to UE) - see example in table B.6-3\nTable B.6-3: MESSAGE request (P-CSCF to UE)\nMESSAGE sip:[5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp SIP/2.0\nVia: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK2524fd2, SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK344a651, SIP/2.0/UDP ipsmgw.home2.net; branch=z9hG4bK876ffa3\nMax-Forwards: 68\nFrom: <sip:ipsmgw.home2.net>; tag=583558\nTo: <sip:user2_public2@home2.net>\nCall-ID: fy365h43g3f36f3f6fth74g3\nCseq: 888 MESSAGE\nP-Called-Party-ID: <sip:user2_public2@home2.net>\nRequest-Disposition: no-fork\nAccept-Contact: *;+g.3gpp.smsip;require;explicit\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\n5.\t200 (OK) response (UE to P-CSCF) - see example in table B.6-4\nTable B.6-4: 200 (OK) response (UE to P-S-CSCF)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK2524fd2, SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK344a651, SIP/2.0/UDP ipsmgw.home2.net; branch=z9hG4bK876ffa3\nFrom:\nTo:\nCall-ID:\nCseq:\n\n6.\t200 (OK) response (P-CSCF to S-CSCF) - see example in table B.6-5\nTable B.6-5: 200 (OK) response (P-CSCF to S-CSCF)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK344a651, SIP/2.0/UDP ipsmgw.home2.net; branch=z9hG4bK876ffa3\nFrom:\nTo:\nCall-ID:\nCseq:\n\n7.\t200 (OK) response (S-CSCF to IP-SM-GW) - see example in table B.6-6\nTable B.6-6: 200 (OK) response (S-CSCF to IP-SM-GW)\nSIP/2.0 200 OK\nVia: SIP/2.0/UDP ipsmgw.home2.net; branch=z9hG4bK876ffa3\nFrom:\nTo:\nCall-ID:\nCseq:\n\n8.\tMESSAGE request (UE to P-CSCF) - see example in table B.6-7\nThis request includes a vnd.3gpp.sms payload that includes the SMS-DELIVER-REPORT and routing information for the IP-SM-GW to forward the delivery report.\nTable B.6-7: MESSAGE request (UE to P-CSCF)\nMESSAGE sip:ipsmgw.home2.net SIP/2.0\nVia: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nMax-Forwards: 70\nRoute: <sip:pcscf2.visited2.net:7531;lr;comp=sigcomp>, <sip:orig@scscf2.home2.net;lr>\nP-Preferred-Identity: \"John Doe\" <sip:user2_public2@home2.net>\nFrom: <sip:user2_public2@home2.net>; tag=171828\nTo: <sip:ipsmgw.home2.net>\nCall-ID: cb03a0s09a2sdfglkj490333\nIn-Reply-to: fy365h43g3f36f3f6fth74g3\nCseq: 999 MESSAGE\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\nRequest-URI:\tThe IP-SM-GW that sent the SIP MESSAGE request including the delivered short message to the SM-over-IP receiver.\nThe payload includes an RP-ACK message (see 3GPP TS 24.011 [8]). Its RP-User-Data information element includes a TPDU of type SMS-DELIVER-REPORT.\n9.\tMESSAGE request (P-CSCF to S-CSCF) - see example in table B.6-8\nTable B.6-8: MESSAGE request (P-CSCF to S-CSCF)\nMESSAGE sip:ipsmgw.home2.net SIP/2.0\nVia: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK240f341, SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nMax-Forwards: 69\nRoute: <sip:orig@scscf2.home2.net;lr>\nP-Asserted-Identity: \"John Doe\" <sip:user2_public2@home1.net>\nFrom: <sip:user2_public2@home2.net>; tag=171828\nTo: <sip:ipsmgw.home2.net>\nCall-ID: cb03a0s09a2sdfglkj490333\nIn-Reply-to: fy365h43g3f36f3f6fth74g3\nCseq: 999 MESSAGE\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\n10.\tInitial filter criteria\nThe S-CSCF analyses the incoming request against the initial filter criteria and decides to send the SIP MESSAGE request to the IP-SM-GW.\n11.\tMESSAGE request (S-CSCF to IP-SM-GW) - see example in table B.6-9\nTable B.6-9: MESSAGE request (S-CSCF to IP-SM-GW)\nMESSAGE sip:ipsmgw.home2.net SIP/2.0\nVia: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK344a651, SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK240f341, SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nMax-Forwards: 68\nRoute: <sip:ipsmgw.home2.net;lr>, <sip:cb03a0s09a2sdfglkj490333@scscf2.home2.net;lr>\nP-Asserted-Identity: \"John Doe\" <sip:user2_public2@home2.net>\nP-Asserted-Identity: tel:+12125552222\nFrom: <sip:user2_public2@home2.net>; tag=171828\nTo: <sip:ipsmgw.home2.net>\nCall-ID: cb03a0s09a2sdfglkj490333\nIn-Reply-to: fy365h43g3f36f3f6fth74g3\nCseq: 666 MESSAGE\nContent-Type: application/vnd.3gpp.sms\nContent-Length: (…)\n\n12.\t202 (Accepted) response (IP-SM-GW to S-CSCF) - see example in table B.6-10\nTable B.6-10: 202 (Accepted) response (IP-SM-GW to S-CSCF)\nSIP/2.0 202 Accepted\nVia: SIP/2.0/UDP scscf2.home2.net;branch=z9hG4bK344a651, SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK240f341, SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nFrom:\nTo:\nCall-ID:\nCseq:\n\n13.\t202 (Accepted) response (S-CSCF to P-CSCF) - see example in table B.6-11\nTable B.6-11: 202 (Accepted) response (S-CSCF to P-CSCF)\nSIP/2.0 202 Accepted\nVia: SIP/2.0/UDP pcscf2.visited2.net;branch=z9hG4bK240f341, SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nFrom:\nTo:\nCall-ID:\nCseq:\n\n14.\t202 (Accepted) response (P-CSCF to UE) - see example in table B.6-12\nTable B.6-12: 202 (Accepted) response (P-CSCF to UE)\nSIP/2.0 202 Accepted\nVia: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd]:1357;comp=sigcomp; branch=z9hG4bKnashds7\nFrom:\nTo:\nCall-ID:\nCseq:\n\n15.\tExtracting and forwarding the delivery report\nThe IP-SM-GW forwards the short message TPDU (SMS-DELIVER-REPORT) to the SC.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.7\tSignalling flow demonstrating successful procedures for SM over IP in case terminating side is addressed with SIP URI",
            "description": "\nThe figure depicts the steps involved in terminating an Unicast Session Mark (USM) over IP (IP) when the session is addressed with a SIP URI. It illustrates the process of initiating a session, configuring the session, and terminating it. The figure includes a flowchart and a list of steps, providing a clear and concise visual representation of the procedure.\nFigure B.7-1: SM over IP procedures when terminating UE is addressed with SIP URI\nIt is assumed that \"sip:user1_public1@home1.net\" is registered at ipsmgw.home1.net using an SMS capable UE and addresses UE 2 with . \"sip:user2_public2@home2.net\" is registered at ipsmgw.home2.net using an SMS capable UE.\n1.\tReceiving SM from UE\nThe IP-SM-GW receives a SIP MESSAGE request containing a short message from UE-1 which includes SMS-SUBMIT as type indicator and TP-DA field set to the dummy MSISDN.\nThe destination address of the short message is include in a XML body include in the received SIP MESSAGE request. The IP-SM-GW will include this URI in the Request-URI of the outgoing SIP MESSAGE request\n-\tThe IP-SM-GW analysis of the destination address and local policy indicates that the terminating side can be addressed with SIP URI for delivery of SM.\n-\tThe IP-SM-GW constructs a RP DATA with SMS-DELIVER as type indicator. The TP-OA field is set to the dummy MSISDN value as defined in 3GPP TS 23.003 [22]\n-\tThe IP-SM-GW will include the SIP URI of user1 received in the P-Asserted-Identity header field in the short-message-info XML body that is included in the outgoing SIP MESSAGE request.\n2.\tMESSAGE request (IP-SM-GW to S-CSCF) - see example in table B.7-1\nThis request includes a vnd.3gpp.sms payload that includes the short message and routing information for the S-CSCF to forward the short message.\nTable B.7-1: MESSAGE request (IP-SM-GW to S-CSCF)\nMESSAGE sip:user2_public2@home2.net SIP/2.0\nVia: SIP/2.0/UDP ipsmgw.home1.net; branch=z9hG4bK876ffa3\nFeature-Caps: *;+g.3gpp.smsip-msisdn-less\nMax-Forwards: 70\nRoute: <sip:scscf1.home1.net;lr>\nFrom: <sip:ipsmgw.home1.net>; tag=583558\nTo: <sip:user2_public2@home2.net>\nCall-ID: cb03a0s09a2sdfglkj490333\nCseq: 888 MESSAGE\nP-Asserted-Identity: sip:ipsmgw.home1.net\nRequest-Disposition: no-fork\nContent-Type: multipart/mixed; boundary=outer\nContent-Length: (…)\n\n--outer\nContent-Type: application/vnd.3gpp.sms\n\n--outer\nContent-Type: application/vnd.3gpp.sms+xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<short-message-info>\n<From>sip:user1_public1@home1.net</From>\n</short-messsage-info>\n\n--outer—\n\n\nRequest-URI:\tPublic user identity of the receiving UE.\nP-Asserted-ID:\tvalue of the originating side IP-SM-GW.\nFeature-Caps:\tg. 3gpp.smsip-msisdn-less indicator indicating that an IP-SM-GW supporting MISDSN less operation is in the signalling chain for the SIP MESSAGE.\n3.\tMESSAGE request (S-CSCF to terminating side)\n-\tThe S-CSCF serving ipsmgw.home1.net forwards the SIP MESSAGE request based on the R-URI.\n4.\tMESSAGE request (I-CSCF to S-CSCF)\n-\tThe I-CSCF forwards the SIP MESSAGE request to the S-CSCF that hosts the subscriber that is indicated in the R-URI as per normal IMS procedures.\n5.\tMESSAGE request (S-CSCF to IP-SM-GW)\n-\tThe S-CSCF serving ipsmgw.home1.net forwards the SIP MESSAGE request based on iFC to the IP-SM-GW hosting the service for the subscriber.\n6.\t202 (Accepted) response (IP-SM-GW to S-CSCF)\n7.\t202 (Accepted) response (S-CSCF to I-CSCF)\n8.\t202 (Accepted) response (I-CSCF to S-CSCF)\n9.\t202 (Accepted) response (S-CSCF to IP-SM-GW)\n10.\tDelivery of Short Message via SIP MESSAGE\n-\tThe IP-SM-GW delivers the SIP MESSAGE to the user that is indicted in the R-URI of the incoming SIP MESSAGE.\n11.\tShort Message Deliver Report\n-\tThe IP-SM-GW receives a SIP MESSAGE request containing a DELIVER REPORT to a previously sent short message.\n12.\tMESSAGE request (IP-SM-GW to S-CSCF) - see example in table B.7-2\nThe SIP MESSAGE request includes a vnd.3gpp.sms payload that includes the DELIVER REPORT and routing information for the S-CSCF to forward the short message.\n-\tThe destination address for the delivery report is included in a XML body include in the received SIP MESSAGE request. The IP-SM-GW will include this URI in the Request-URI of the outgoing SIP MESSAGE request\n-\tThe IP-SM-GW will include the SIP URI of user2 received in the P-Asserted-Identity header field in the short-message-info XML body that is included in the outgoing SIP MESSAGE request.\nTable B.7-2: MESSAGE request (IP-SM-GW to S-CSCF)\nMESSAGE sip:user1_public1@home1.net SIP/2.0\nVia: SIP/2.0/UDP ipsmgw.home1.net; branch=z9hG4bK876ffa3\nFeature-Caps: *;+g.3gpp.smsip-msisdn-less\nMax-Forwards: 70\nRoute: <sip:scscf2.home2.net;lr>\nFrom: <sip:ipsmgw.home2.net >; tag=583558\nTo: <sip:user1_public1@home1.net>\nCall-ID: fy365h43g3f36f3f6fth74g3\nCseq: 888 MESSAGE\nP-Asserted-Identity: sip:ipsmgw.home2.net\nIn-Reply-to: cb03a0s09a2sdfglkj490333\nContent-Type: multipart/mixed; boundary=outer\nContent-Length: (…)\n\n--outer\nContent-Type: application/vnd.3gpp.sms\n\n--outer\nContent-Type: application/vnd.3gpp.sms+xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<short-message-info>\n<From>sip:user2_public1@home2.net</From>\n</short-messsage-info>\n\n--outer—\n\nRequest-URI:\tPublic user identity of the receiving UE.\nP-Asserted-ID:\tvalue of the terminating side IP-SM-GW.\nFeature-Caps:\tg. 3gpp.smsip-msisdn-less indicator indicating that an IP-SM-GW supporting MISDSN less operation is in the signalling chain for the SIP MESSAGE.\n13.\tMESSAGE request (S-CSCF to terminating side)\n-\tThe S-CSCF serving ipsmgw.home1.net.net forwards the SIP MESSAGE request based on the R-URI.\n14.\tMESSAGE request (I-CSCF to S-CSCF)\n-\tThe I-CSCF forwards the SIP MESSAGE request to the S-CSCF that hosts the subscriber that is indicated in the R-URI as per normal IMS procedures.\n15.\tMESSAGE request (S-CSCF to IP-SM-GW)\n-\tThe S-CSCF serving user1_public1@home1.net forwards the SIP MESSAGE request based on iFC to the IP-SM-GW hosting the service for the subscriber.\n16.\t202 (Accepted) response (IP-SM-GW to S-CSCF)\n17.\t202 (Accepted) response (S-CSCF to I-CSCF)\n18.\t202 (Accepted) response (I-CSCF to S-CSCF)\n19.\t202 (Accepted) response (S-CSCF to IP-SM-GW)\n12.\tShort Message Deliver Report\n-\tThe IP-SM-GW sends a SIP MESSAGE containing the DELIVER REPORT to the user indicated in the Request-URI received in message 15.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.1\tShort-messsage-info XML schema",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "C.1.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines XML schema and MIME type related to SMS over IP MSISDN less operation.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "C.1.2\tapplication/vnd.3gpp.sms+xml",
                    "description": "",
                    "summary": "",
                    "text_content": "The MIME type is used to carry information related to the MSISDN less operation for SMS over IP. It is coded as an XML document and contains one or more of the following information:\n-\tTo\n-\tFrom\n-\tCorrelation-ID\n-\tDelivery-Outcome\nNOTE:\tThe information elements cannot be present twice in the XML body.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "C.1.3\tData semantics",
                    "description": "",
                    "summary": "",
                    "text_content": "The <short-message-info> element is the root element of the XML document and contains one or more of the following elements:\n1)\ta <To> element which contains the identity of the receiver of the short message, it is coded as a SIP URI;\n2)\ta <From> element which contains the identity of the sender of the short message, it is coded as a SIP URI;\n3)\ta <Correlation-ID> element which contains the Correlation Identifier to be used for interworking with the short message service center. The <Correlation-ID> consists of:\na)\ta <Sender> element containing the SIP URI of the sender of the short message that needs to be delivered via the short message centre, it is coded as SIP URI;\nb)\ta <Receiver> element containing the SIP URI of the receiver of the short message that needs to be delivered via the short message centre, it is coded as SIP URI; and\nc)\ta <HLR-ID> element containing the identifier of the HLR to be used for short message delivery reattempts. It is coded as string;\n4)\ta <Delivery-Outcome> element which indicates the status for short message transfer, it is coded as a string. In the present document, it can only have the values specified in table C.1.3-1 for Delivery-Outcome-Values. The usage and semantics of the error indications is described in 3GPP TS 23.040 [3]\nTable C.1.3-1: ABNF syntax of values of the <state-info> element\nDelivery-Outcome-Values = SuccessfullTransfer-value / AbsentSubscriber-value / UserBusyForMTSMS-value / IllegalUser-value / IllegalEquipment-value -value / SMDeliveryFailure-value / ServiceBarred-value / TeleserviceNotProvisioned-value\nSuccessfullTransfer-value = %x53.75.63.63.65.73.73.66.75.6c.6c.54.72.61.6e.73.66.65.72 ; \"SuccessfullTransfer\"\nAbsentSubscriber-value = %x41.62.73.65.6e.74.53.75.62.73.63.72.69.62.65.72 ; \"AbsentSubscriber\"\nUserBusyForMTSMS-value = %x55.73.65.72.42.75.73.79.46.6f.72.4d.54.53.4d.53 ; \"UserBusyForMTSMS\"\nIllegalUser-value = %x49.6c.6c.65.67.61.6c.55.73.65.72; \"IllegalUser\"\nIllegalEquipment-value = %x49.6c.6c.65.67.61.6c.45.71.75.69.70.6d.65.6e.74 ; \"IlegalEquipment\"\nSMDeliveryFailure = %x53.4d.44.65.6c.69.76.65.72.79.46.61.69.6c.75.72.65 ; \"SMDeliveryFailure\"\nServiceBarred-value = %x53.65.72.76.69.63.65.42.61.72.72.65.64 ; \"ServiceBarred\"\nTeleserviceNotProvisioned-value = %x54.65.6c.65.73.65.72.76.69.63.65.4e.6f.74.50.72.6f.76.69.73.69.6f.6e.65.64 ; \"TeleserviceNotProvisioned\"\n\n<anyExt> element contains optional elements defined by future version of this document.\nAn entity receiving the XML body ignores any unknown XML element and any unknown XML attribute.\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "C.1.4\tXML schema",
                    "description": "",
                    "summary": "",
                    "text_content": "Implementations in compliance with the present document shall implement the XML schema defined below.\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nelementFormDefault=\"qualified\"\nattributeFormDefault=\"unqualified\">\n<xs:annotation>\n<xs:documentation>\nInfo for MSISDN less short messsage service\n</xs:documentation>\n</xs:annotation>\n\n<xs:element name=\"short-message-info\" type=\"Tshort-message-info\"/>\n\n<xs:complexType name=\"Tshort-message-info\">\n<xs:sequence>\n<xs:element name=\"To\" type=\"xs:anyURI\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:element name=\"From\" type=\"xs:anyURI\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:element name=\"Correlation-ID\" type=\"Tcorrelation-id\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:element name=\"Delivery-Outcome\" type=\"xs:string\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\" />\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Tcorrelation-id\">\n<xs:sequence>\n<xs:element name=\"Sender\" type=\"xs:anyURI\" minOccurs=\"1\" maxOccurs=\"1\"/>\n<xs:element name=\"Receiver\" type=\"xs:anyURI\" minOccurs=\"1\" maxOccurs=\"1\"/>\n<xs:element name=\"HLR-ID\" type=\"xs:string\" minOccurs=\"1\" maxOccurs=\"1\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\" />\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n\n</xs:schema>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "C.1.5\tIANA registration",
                    "description": "",
                    "summary": "",
                    "text_content": "NOTE:\tRFC 4288 [26], clause 9, states the process that applies in case of changes to the registry of media types. Any changes to the format or to clause 5.1.3.5 after the registration with IANA would invoke this procedure.\n\nApplication\nVendor Tree – vnd.3gpp.sms+xml\nNone\nNone\nBinary.\nSame as general security considerations for application/xml as specified in section 10 of IETF RFC 3023 [21]. In addition, this content type provides a format for exchanging information in SIP, so the security considerations from IETF RFC 3261 [19] apply.\nThe information transported in this MIME media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP  TS24.229 [10].\nThe MIME type allows interoperability of short message information between mobile networks and other systems.\n3GPP TS 24.341\n()\nn/a\nn/a\n1. Magic number(s):\tn/a\n2. File extension(s):\tn/a\n3. Macintosh file type code:\tn/a\n4. Object Identifiers:\tn/a\nCommon.\nShort Message Service is supported in mobile networks. The registration of the associated MIME type allows MSISDN less operation of the Short Message Service.\nn/a\n1. Name:\tTBD\n2. Email:\tTBD\n3. Author/Change controller:\tTBD\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "D.1\tGeneral",
            "description": "This clause describes the feature-capability indicators definitions, according to RFC 6809 [xxx], that are applicable for the realisation of SMS over IP.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.2\tDefinition of feature-capability indicator g.3gpp.smsip-msisdn-less",
            "description": "Editor's note: [WID SMSMI-CT, CR#0052] this feature tag is to be registered with IANA after the freezing of Rel-12.\nFeature-capability indicator name: g.3gpp.smsip-msisdn-less.\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator, when included in a Feature-Caps header field as specified in RFC 6809 [24] in a SIP MESSAGE request, indicates the support of the MSISDN-less operation for SMS over IP.\nFeature-capability indicator specification reference: 3GPP TS 24.341: \"Support of SMS over IP networks, stage 3\"\nValues appropriate for use with this feature-capability indicator:\nNone.\nThe feature-capability indicator is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This feature-capability indicator is used to indicate support of the MSISDN less operation of SMS over IP and that the MESSAGE request has traversed an IP-SM-GW.\nExamples of typical use: Indicating capability to support MSISDN less operation for a SIP MESSAGE request including a \"vnd.3gpp.sms\" payload.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of RFC 6809 [24].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for SMS services in the IP Multimedia (IM) Core Network (CN) subsystem, where the IP-CAN is Evolved Packet System (EPS).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.2\tEPS aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "E.2.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "E.2.1.1\tSmart Congestion Mitigation",
                            "text_content": "The following information is provided to the non-access stratum layer:\n-\tMO-SMSoIP-attempt-started;\n-\tMO-SMSoIP-attempt-ended;\n-\tMT-SMSoIP-attempt-started; and\n-\tMT-SMSoIP-attempt-ended.\nUpon request from the user to submit an originating SM over IP as described in clause 5.3.1 and no other originating SM over IP as described in clause 5.3.1 exists, the UE sends the MO-SMSoIP-attempt-started indication to the non-access stratum and continue with SM over IP submission as described in clause 5.3.1.\nWhen a terminating SM over IP submission is started and no other terminating SM over IP submission as described in clause 5.3.2 exists, the UE sends the MT-SMSoIP-attempt-started indication to the non-access stratum.\nWhen an originating SM over IP submission is completed and no other originating SM over IP as described in clause 5.3.1 exists, the UE sends the MO-SMSoIP-attempt-ended indication to the non-access stratum.\nWhen a terminating SM over IP submission is started and no other terminating SM over IP submission as described in clause 5.3.2 exists, the UE sends the MT-SMSoIP-attempt-started indication to the non-access stratum.\nNOTE:\tIf the UE supports other 3GPP specific mechanisms for communicating with the non-access stratum protocol implementation, e.g. DHCP discovery via PCO, then the UE is expected to support the transfer of information elements needed for the smart congestion mitigation enforcement.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "E.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "E.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "E.3.1.1\t3GPP PS data off",
                            "text_content": "The UE may support the 3GPP PS data off.\nIf the UE supports the 3GPP PS data off:\na)\tthe UE can be configured with up to two indications whether SMS over IP is a 3GPP PS data off exempt service, one indication is valid for the UE camping in the HPLMN or the EHPLMN, and the other indication is valid for any VPLMN the UE is roaming in; and\nb)\tthe UE may support being configured with the indication whether SMS over IP is a 3GPP PS data off exempt service using one or more of the following methods:\n1)\tthe EF3GPPPSDATAOFF file described in 3GPP TS 31.102 [19];\n2)\tthe SMSoIP_exempt node of 3GPP TS 24.167 [8A], if the UE is in the HPLMN or the EHPLMN; and\n3)\tthe SMSoIP_roaming_exempt node of 3GPP TS 24.167 [8A], if the UE is in the VPLMN.\nIf the UE is configured with both the SMSoIP_exempt node of 3GPP TS 24.167 [8A] and the EF3GPPPSDATAOFF file described in 3GPP TS 31.102 [19], then the EF3GPPPSDATAOFF file described in 3GPP TS 31.102 [19] shall take precedence.\nIf the UE is configured with both the SMSoIP_roaming_exempt node of 3GPP TS 24.167 [8A] and the EF3GPPPSDATAOFF file described in 3GPP TS 31.102 [19], then the EF3GPPPSDATAOFF file described in 3GPP TS 31.102 [19] shall take precedence.\nWhen the UE is only configured with the indication valid for the UE camping in the HPLMN or the EHPLMN, the UE shall use this indication also when the UE is in the VPLMN.\nIf the 3GPP PS data off status is \"active\" and the UE is not configured with indication that SMS over IP is a 3GPP PS data off exempt service:\na)\tthe UE shall not invoke the procedures in clause 5.3.1 or clause 5.3.2 with a UE's contact address containing an IP address associated with an EPS IP-CAN bearer; and\nNOTE 1:\tIf the UE doesn't invoke the procedures in clause 5.3.1 or clause 5.3.2 due to conditions as described in bullet a, the UE can attempt a request for an equivalent service via the CS domain – if supported and available – and, otherwise, the UE can attempt the service according to 3GPP TS 24.229 [13] and as described in clause 5.3.1 or clause 5.3.2 via non-3GPP access.\nb)\tif the UE registered a binding with IM CN subsystem, such that:\n1)\tthe contact address of the binding contains an IP address associated with an EPS IP-CAN bearer; and\n2)\tthe Contact header field of the binding contains the g.3gpp.smsip media feature tag, the g.3gpp.smsip-msisdn-less media feature tag or both;\nthen:\n1)\tthe UE shall de-register the binding of a UE's contact address containing an IP address associated with an EPS IP-CAN bearer from IM CN subsystem according to 3GPP TS 24.229 [10]; or\n2)\tthe UE shall re-register the binding of a UE's contact address containing an IP address associated with an EPS IP-CAN bearer with IM CN subsystem with a Contact header field not including the g.3gpp.smsip media feature tag and the g.3gpp.smsip-msisdn-less media feature tag according to 3GPP TS 24.229 [10].\nNOTE 2:\tWhich of the bullets 1), and 2) the UE performs is influenced by other 3GPP PS data off exempt services.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "E.3.2\tProcedures at the AS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "E.3.2.1\t3GPP PS data off",
                            "text_content": "An AS supporting the 3GPP PS data off can be configured with up to two indications whether SMS over IP is a 3GPP PS Data Off exempt service, one indication is valid for non-roaming users, and the other indication is valid for users roaming in the various VPLMNs with whom roaming agreements exist.\nWhen the AS is only configured with the indication whether SMS over IP is a 3GPP PS Data Off exempt service for the UE camping in the HPLMN or the EHPLMN, the AS shall use this indication also when the UE is in the VPLMN.\nIf the AS supports the 3GPP PS data off, the AS shall support obtaining registration state information from a received third-party SIP REGISTER request including information contained in the body of the third-party SIP REGISTER request as specified in 3GPP TS 24.229 [10], of the served UE.\nIf a received registration state information of the served UE indicates a Contact header field with the g.3gpp.ps-data-off media feature tag with the \"active\" value, and the AS is not configured with indication that SMS over IP is a 3GPP PS data off exempt service for the served UE then the AS shall not invoke the procedures in clause 5.3.3 which send a SIP request towards a contact address (or via a registration flow) of the served UE such that the contact address (or the registration flow) was registered or re-registered by a SIP REGISTER request with a P-Access-Network-Info header field with \"3GPP-GERAN\", \"3GPP-UTRAN\", \"3GPP-E-UTRAN\" or \"3GPP-NR\" access class and with the \"network-provided\" header field parameter.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "F.1\tScope",
            "description": "The UE may support the present annex.\nThe present annex defines IP-CAN specific requirements for SMS services in the IP Multimedia (IM) Core Network (CN) subsystem, where the IP-CAN is General Packet Radio Service (GPRS) .\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.2\tGPRS (Iu mode only) aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.2.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "F.2.1.1\tGeneral",
                            "text_content": "The UE may support any of the procedures of clause F.2.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "F.2.1.2\tApplication specific Congestion control for Data Communication (ACDC) procedure",
                            "text_content": "The following information is provided to the non-access stratum layer:\n-\tMO-SMSoIP-attempt-started; and\n-\tMO-SMSoIP-attempt-ended.\nUpon request from the user to submit an originating SM over IP as described in clause 5.3.1 and no other originating SM over IP as described in clause 5.3.1 exists, the UE sends the MO-SMSoIP-attempt-started indication to the non-access stratum and continue with SM over IP submission as described in clause 5.3.1.\nWhen an originating SM over IP submission is completed and no other originating SM over IP as described in clause 5.3.1 exists, the UE sends the MO-SMSoIP-attempt-ended indication to the non-access stratum.\nNOTE:\tIf the UE supports other 3GPP specific mechanisms for communicating with the non-access stratum protocol implementation, e.g. DHCP discovery via PCO, then the UE is expected to support the transfer of information elements needed for the application specific congestion control for data communication enforcement.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "F.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "F.3.1.1\t3GPP PS data off",
                            "text_content": "The requirements in clause E.3.1.1.1 apply.\nIf the 3GPP PS data off status is \"active\" and the UE is not configured with indication that SMS over IP is a 3GPP PS data off exempt service:\na)\tthe UE shall not invoke the procedures in clause 5.3.1 or clause 5.3.2 with a UE's contact address containing an IP address associated with a GPRS IP-CAN bearer; and\nNOTE 1:\tIf the UE doesn't invoke the procedures in clause 5.3.1 or clause 5.3.2 due to conditions as described in bullet a, the UE can attempt a request for an equivalent service via the CS domain – if supported and available – and, otherwise, the UE can attempt the service according to 3GPP TS 24.229 [13] and as described in clause 5.3.1 or clause 5.3.2 via non-3GPP access.\nb)\tif the UE registered a binding with IM CN subsystem, such that:\n1)\tthe contact address of the binding contains an IP address associated with a GPRS IP-CAN bearer; and\n2)\tthe Contact header field of the binding contains the g.3gpp.smsip media feature tag, the g.3gpp.smsip-msisdn-less media feature tag or both;\nthen:\n1)\tthe UE shall de-register the binding of a UE's contact address containing an IP address associated with a GPRS IP-CAN bearer from IM CN subsystem according to 3GPP TS 24.229 [10]; or\n2)\tthe UE shall re-register the binding of a UE's contact address containing an IP address associated with a GPRS IP-CAN bearer with IM CN subsystem with a Contact header field not including the g.3gpp.smsip media feature tag and the g.3gpp.smsip-msisdn-less media feature tag according to 3GPP TS 24.229 [10].\nNOTE 2:\tWhich of the bullets 1), and 2) the UE performs is influenced by other 3GPP PS data off exempt services.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "F.3.2\tProcedures at the AS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "F.3.2.1\t3GPP PS data off",
                            "text_content": "The requirements in clause E.3.2.1 apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "G.1\tScope",
            "description": "The present annex defines IP-CAN specific requirements for SMS services in the IP Multimedia (IM) Core Network (CN) subsystem, where the IP-CAN is 5G System (5GS).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.2\t5GS aspects when connected to the IM CN subsystem",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "G.2.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "G.2.1.1\tIndications to lower layers about start and stop of SMSoIP",
                            "text_content": "The following information is provided to the non-access stratum:\n-\tMO-SMSoIP-attempt-started;\n-\tMO-SMSoIP-attempt-ended;\n-\tMT-SMSoIP-attempt-started;\n-\tMT-SMSoIP-attempt-ended; and\n-\tfor 3GPP access only, handover of ongoing SMSoIP from non-3GPP access.\nUpon request from the user to submit an originating SM over IP as described in clause 5.3.1 and no other originating SM over IP as described in clause 5.3.1 exists, the UE sends the MO-SMSoIP-attempt-started indication to the non-access stratum. The UE shall:\na)\tif the barring result is \"not-barred\", continue with SM over IP submission as described in clause 5.3.1; and\nb)\tif the barring result is \"barred\", reject the SM over IP submission.\nWhen a terminating SM over IP submission is started and no other terminating SM over IP submission as described in clause 5.3.2 exists, the UE sends the MT-SMSoIP-attempt-started indication to the non-access stratum.\nWhen an originating SM over IP submission is completed and no other originating SM over IP submission as described in clause 5.3.1 exists, the UE sends the MO-SMSoIP-attempt-ended indication to the non-access stratum.\nWhen a terminating SM over IP submission is completed and no other terminating SM over IP submission as described in clause 5.3.2 exists, the UE sends the MT-SMSoIP-attempt-ended indication to the non-access stratum.\nWhen an ongoing originating SMS service over IP network is handed over from non-3GPP access to 3GPP access, the UE sends the MO-SMSoIP-attempt-started indication and the handover of ongoing SMSoIP from non-3GPP access indication to the non-access stratum.\nWhen an ongoing terminating SMS service over IP network is handed over from non-3GPP access to 3GPP access, the UE sends the MT-SMSoIP-attempt-started indication and the handover of ongoing SMSoIP from non-3GPP access indication to the non-access stratum.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "G.3\tApplication usage of SIP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "G.3.1\tProcedures at the UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "G.3.1.1\t3GPP PS data off",
                            "text_content": "The requirements in clause E.3.1.1.1 apply.\nAdditionally, the following requirements apply.\nIn case of SNPN, if the UE supports the 3GPP PS data off:\na)\tthe UE can be configured with:\n1)\tup to two indications of whether SMS over IP is a 3GPP PS data off exempt service for each subscribed SNPN whose entry exists in the \"list of subscriber data\", one indication is valid for the UE camping in the subscribed SNPN, and the other indication is valid for any non-subscribed SNPN the UE is camping in using the subscribed SNPN's credentials; and\n2)\tan indication of whether the SMS over IP is a 3GPP PS data off exempt service for PLMN subscription, valid for any non-subscribed SNPN the UE is camping in using the PLMN subscription; and\nb)\tfor a subscribed SNPN whose entry exists in the \"list of subscriber data\", the UE may support being configured with the indication of whether SMS over IP is a 3GPP PS data off exempt service using one or more of the following methods:\n1)\tthe SMSoIP_exempt node of 3GPP TS 24.167 [8A], if the UE is in the subscribed SNPN; and\n2)\tthe SMSoIP_exempt_non_subscribed_SNPN node of 3GPP TS 24.167 [8A], if the UE is in the non-subscribed SNPN.\nFor PLMN subscription, the UE may support being configured with the indication of whether the SMS over IP is a 3GPP PS data off exempt service using the following method:\n1)\tthe SMSoIP_exempt_non_subscribed_SNPN node of 3GPP TS 24.167 [8A], if the UE is in the non-subscribed SNPN.\nWhen the UE is only configured with the indication valid for the UE camping in the subscribed SNPN, the UE shall use this indication also when the UE is in the non-subscribed SNPN.\nIf the 3GPP PS data off status is \"active\" and the UE is not configured with indication that SMS over IP is a 3GPP PS data off exempt service:\na)\tthe UE shall not invoke the procedures in clause 5.3.1 or clause 5.3.2 with a UE's contact address containing an IP address associated with an 5GS QoS flow using NG-RAN; and\nNOTE 1:\tIf the UE doesn't invoke the procedures in clause 5.3.1 or clause 5.3.2 due to conditions as described in bullet a, the UE can attempt a request for an equivalent service via the CS domain – if supported and available – and, otherwise, the UE can attempt the service according to 3GPP TS 24.229 [13] and as described in clause 5.3.1 or clause 5.3.2 via non-3GPP access.\nb)\tif the UE registered a binding with IM CN subsystem, such that:\n1)\tthe contact address of the binding contains an IP address associated with an 5GS QoS flow using NG-RAN; and\n2)\tthe Contact header field of the binding contains the g.3gpp.smsip media feature tag, the g.3gpp.smsip-msisdn-less media feature tag or both;\nthen:\n1)\tthe UE shall de-register the binding of a UE's contact address containing an IP address associated with an 5GS QoS flow using NG-RAN from IM CN subsystem according to 3GPP TS 24.229 [10]; or\n2)\tthe UE shall re-register the binding of a UE's contact address containing an IP address associated with an 5GS QoS flow using NG-RAN with IM CN subsystem with a Contact header field not including the g.3gpp.smsip media feature tag and the g.3gpp.smsip-msisdn-less media feature tag according to 3GPP TS 24.229 [10].\nNOTE 2:\tWhich of the bullets 1), and 2) the UE performs is influenced by other 3GPP PS data off exempt services.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "G.3.2\tProcedures at the AS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "G.3.2.1\t3GPP PS data off",
                            "text_content": "The requirements in clause E.3.2.1 apply.\nAdditionally, the following requirements apply.\nWhen serving a UE in an SNPN using an entry of \"list of subscriber data\", an AS supporting the 3GPP PS data off can be configured with up to two indications of whether SMS over IP is a 3GPP PS data off exempt service, one indication is valid for the UE camping in the subscribed SNPN, and the other indication is valid for the UE camping in the non-subscribed SNPNs with whom service agreements exist.\nWhen the AS is only configured with the indication of whether SMS over IP is a 3GPP PS data off exempt service for the UE camping in the subscribed SNPN, the AS shall use this indication also when the UE is in the non-subscribed SNPN.\nWhen serving a UE in an SNPN using PLMN subscription, an AS supporting the 3GPP PS data off can be configured with an indication of whether SMS over IP is a 3GPP PS data off exempt service, valid for the UE camping in the non-subscribed SNPNs with whom service agreements exist.\n\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}