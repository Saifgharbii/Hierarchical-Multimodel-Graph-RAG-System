{
    "document_name": "24301-i50.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, modal verbs have the following meanings:\nshall\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions, and do not appear in Technical Reports.\nThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible, and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\tindicates permission to do something\nneed not\tindicates permission not to do something\nThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\tindicates that something is possible\ncannot\tindicates that something is impossible\nThe constructions \"can\" and \"cannot\" are not substitutes for \"may\" and \"need not\".\nwill\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document specifies the procedures used by the protocols for mobility management and session management between User Equipment (UE) and Mobility Management Entity (MME) in the Evolved Packet System (EPS). These protocols belong to the non-access stratum (NAS).\nThe EPS Mobility Management (EMM) protocol defined in the present document provides procedures for the control of mobility when the User Equipment (UE) is using the Evolved UMTS Terrestrial Radio Access Network (E-UTRAN). The EMM protocol also provides control of security for the NAS protocols.\nThe EPS Session Management (ESM) protocol defined in the present document provides procedures for the handling of EPS bearer contexts. Together with the bearer control provided by the access stratum, this protocol is used for the control of user plane bearers.\nFor both NAS protocols the present document specifies procedures for the support of inter-system mobility between E-UTRAN and other 3GPP or non-3GPP access networks:\n-\tFor inter-system mobility between E-UTRAN and GERAN, UTRAN or NG-RAN, this includes rules for a mapping between parameters and procedures used by the NAS protocols defined in the present document and the NAS protocols specified in 3GPP TS 24.008 [13] for GERAN and UTRAN, and 3GPP TS 24.501 [54] for NG-RAN.\n-\tFor inter-system mobility between E-UTRAN and generic non-3GPP access networks, this includes specific NAS procedures to maintain IP connectivity to the PDN Gateway and to provide parameters needed by the UE when using mobility management based on Dual-Stack Mobile IPv6 (see 3GPP TS 24.303 [14]) or MIPv4 (see 3GPP TS 24.304 [15]).\nThe present document is applicable to the UE and to the Mobility Management Entity (MME) in the EPS.\nThe present document is also applicable to the relay node in the EPS (see 3GPP TS 23.401 [10]).\nThe present document also specifies NAS signalling enhancement for the support of efficient transport of IP, non-IP, Ethernet and SMS data of CIoT capable devices.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[1A]\t3GPP TS 22.011: \"Service accessibility\".\n[1B]\tVoid.\n[1C]\t3GPP TS 22.278: \"Service requirements for the Evolved Packet System (EPS)\".\n[2]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[3]\t3GPP TS 23.038: \"Alphabets and language-specific information\".\n[4]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service Description; Stage 2\".\n[5]\t3GPP TS 23.107: \"Quality of Service (QoS) concept and architecture\".\n[6]\t3GPP TS 23.122: \"Non-Access-Stratum functions related to Mobile Station (MS) in idle mode\".\n[7]\t3GPP TS 23.203: \"Policy and charging control architecture\".\n[8]\t3GPP TS 23.216: \"Single Radio Voice Call Continuity (SRVCC); Stage 2\".\n[8A]\t3GPP TS 23.221: \"Architectural requirements\".\n[8B]\t3GPP TS 23.251: \"Network Sharing; Architecture and Functional Description\".\n[9]\t3GPP TS 23.272: \"Circuit Switched Fallback in Evolved Packet System; Stage 2\".\n[10]\t3GPP TS 23.401: \"GPRS enhancements for E-UTRAN access\".\n[11]\t3GPP TS 23.402: \"GPRS architecture enhancements for non-3GPP accesses\".\n[11A]\t3GPP TS 23.682: \"Architecture enhancements to facilitate communications with packet data networks and applications\".\n[12]\t3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General aspects\".\n[13]\t3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core Network Protocols; Stage 3\".\n[13A]\t3GPP TS 24.011: \"Point-to-Point Short Message Service (SMS) support on mobile radio interface\".\n[13B]\t3GPP TS 24.167: \"3GPP IMS Management Object (MO); Stage 3\".\n[13C]\t3GPP TS 24.171: \"NAS Signalling for Control Plane LCS in Evolved Packet System (EPS)\".\n[13D]\t3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[13E]\t3GPP TS 24.173: \"IMS Multimedia telephony communication service and supplementary services; Stage 3\".\n[13F]\t3GPP TS 24.174: \"Support of multi-device and multi-identity in the IP Multimedia Subsystem (IMS); Stage 3\".\n[14]\t3GPP TS 24.303: \"Mobility Management based on DSMIPv6; User Equipment (UE) to network protocols; Stage 3\".\n[15]\t3GPP TS 24.304: \"Mobility management based on Mobile IPv4; User Equipment (UE) - foreign agent interface; Stage 3\".\n[15A]\t3GPP TS 24.368: \"Non-Access Stratum (NAS) configuration Management Object (MO)\".\n[15B]\t3GPP TS 25.304: \"User Equipment (UE) procedures in idle mode and procedures for cell reselection in connected mode\".\n[15C]\t3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".\n[15D]\t3GPP TS 24.341: \"Support of SMS over IP networks; Stage 3\".\n[16]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting packet based services and Packet Data Networks (PDN)\".\n[]\t3GPP TS 29.118: \"Mobility Management Entity (MME) – Visitor Location Register (VLR) SGs interface specification\".\n[16B]\t3GPP TS 29.212: \"Policy and Charging Control (PCC); Reference points\".\n[16C]\t3GPP TS 29.272: \"Evolved Packet System (EPS); Mobility Management Entity (MME) and Serving GPRS Support Node (SGSN) related interfaces based on Diameter protocol\".\n[16D]\t3GPP TS 29.274: \"Evolved Packet System (EPS); Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3\".\n[17]\t3GPP TS 31.102: \"Characteristics of the Universal Subscriber Identity Module (USIM) application\".\n[18]\t3GPP TS 33.102: \"3G security; Security architecture\".\n[19]\t3GPP TS 33.401: \"3GPP System Architecture Evolution; Security architecture\".\n[20]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description\".\n[21]\t3GPP TS 36.304: \"Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) procedures in idle mode\".\n[22]\t3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC) protocol specification\".\n[22A]\t3GPP TS 36.355: \"Evolved Universal Terrestrial Radio Access (E-UTRA); LTE Positioning Protocol (LPP)\".\n[23]\t3GPP TS 36.413: \"Evolved Universal Terrestrial Access Network (E-UTRAN); S1 Application Protocol (S1AP)\".\n[23A]\t3GPP TS 45.008: \"Radio Access Network; Radio subsystem link control\".\n[24]\tVoid.\n[24A]\tIETF RFC 3633: \"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6\".\n[25]\tVoid.\n[26]\tVoid.\n[27]\tVoid.\n[28]\tVoid.\n[29]\tISO/IEC 10646: \"Information technology – Universal Multiple-Octet Coded Character Set (UCS)\".\n[30]\tITU-T Recommendation E.212: \"The international identification plan for mobile terminals and mobile users\".\n[31]\t3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".\n[32]\t3GPP TS 24.334: \"Proximity-services (ProSe) User Equipment (UE) to Proximity-services (ProSe) Function Protocol aspects; Stage 3\".\n[33]\t3GPP TS 23.380: \"IMS restoration procedures\".\n[34]\t3GPP TS 23.161: \"Network-Based IP Flow Mobility (NBIFOM); Stage 2\".\n[35]\t3GPP TS 24.105: \"Application specific Congestion control for Data Communication (ACDC) Management Object (MO)\".\n[36]\t3GPP TS 24.161: \"Network-Based IP Flow Mobility (NBIFOM); Stage 3\".\n[37]\tIETF RFC 5795: \"The RObust Header Compression (ROHC) Framework\".\n[38]\t3GPP TS 36.323: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Packet Data Convergence Protocol (PDCP) specification\".\n[39]\tIETF RFC 6846: \"RObust Header Compression (ROHC): A Profile for TCP/IP (ROHC-TCP)\".\n[40]\tIETF RFC 3095: \"RObust Header Compression (ROHC): Framework and four profiles: RTP, UDP, ESP and uncompressed\".\n[41]\tIETF RFC 3843: \"RObust Header Compression (ROHC): A Compression Profile for IP\".\n[42]\tIETF RFC 4815: \"RObust Header Compression (ROHC): Corrections and Clarifications to RFC 3095\".\n[43]\tIETF RFC 5225: \"RObust Header Compression (ROHC) Version 2: Profiles for RTP, UDP, IP, ESP and UDP Lite\".\n[44]\t3GPP TS 36.306: \"Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) radio access capabilities\".\n[45]\t3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".\n[46]\t3GPP TS 22.101: \"Service aspects; Service principles\".\n[47]\t3GPP TS 23.285: \"Architecture enhancements for V2X services\".\n[48]\t3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via non-3GPP access networks; Stage 3\".\n[49]\t3GPP TS 36.321: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Medium Access Control (MAC) protocol specification\".\n[50]\t3GPP TS 24.623: \"Extensive Markup Language (XML) Configuration Access Protocol (XCAP) over the Ut interface for Manipulating Supplementary Services\".\n[51]\t3GPP TS 24.250: \"Protocol for Reliable Data Service; Stage 3\".\n[52]\t3GPP TR 38.913: \"Study on Scenarios and Requirements for Next Generation Access Technologies\".\n[53]\t3GPP TS 38.323: \"NR; Packet Data Convergence Protocol (PDCP) specification\".\n[54]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[55]\tIETF RFC 5031: \"A Uniform Resource Name (URN) for Emergency and Other Well-Known Services\".\n[56]\t3GPP TS 33.501: \"Security architecture and procedures for 5G System\".\n[57]\t3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS)\".\n[58]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[59]\t3GPP TS 23.502: \"Procedures for the 5G System\".\n[60]\t3GPP TS 23.256: \"Support of Uncrewed Aerial Systems (UAS) connectivity, identification and tracking; Stage 2\".\n[61]\t3GPP TS 24.193: \"Access Traffic Steering, Switching and Splitting; Stage 3\".\n[62]\tIETF RFC 7542: \"The Network Access Identifier\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\nThe term \"mobile station\" (MS) in the present document is synonymous with the term \"user equipment\" (UE) as defined in 3GPP TR 21.905 [1].\n1x CS fallback capable UE: A UE that uses a CS infrastructure for a voice call and other CS-domain services by falling back to cdma2000® 1x access network if the UE is served by E-UTRAN when a CS service is requested.\nAggregate maximum bit rate: The maximum bit rate that limits the aggregate bit rate of a set of non-GBR bearers of a UE. Definition derived from 3GPP TS 23.401 [10].\nAPN based congestion control: Congestion control in session management where the network can reject session management requests from UEs or deactivate PDN connections when the associated APN is congested.\nAttached for emergency bearer services: A UE is attached for emergency bearer services if it has only a PDN connection for emergency bearer services established.\nAttached for access to RLOS: A UE is attached for access to RLOS if the UE requested access to RLOS during the attach procedure and has a PDN connection for RLOS established after completion of attach procedure.\nCurrent TAI: A TAI of a selected PLMN broadcast in the cell on which the UE is camping. If the cell is a satellite E-UTRA cell broadcasting multiple TAIs of the selected PLMN, the UE NAS layer selects the TAI from these multiple TAIs as specified in clause 5.3.xx.\nNOTE 1:\tFor the purpose of this definition, the selected PLMN can either be the registered PLMN or a PLMN selected according to PLMN selection rules as specified in 3GPP TS 23.122 [5].\nAttached for EPS services with CP-CIoT EPS optimization: A UE supporting CIoT EPS optimizations is attached for EPS services, and control plane CIoT EPS optimization along with one or more other CIoT EPS optimizations have been accepted by the network.\nAttached for EPS services with User plane CIoT EPS optimization: A UE supporting CIoT EPS optimizations is attached for EPS services, and user plane CIoT EPS optimization along with one or more other CIoT EPS optimizations have been accepted by the network.\nAttached for EPS services with CIoT EPS optimization: A UE is attached for EPS services with CP-CIoT EPS optimization or attached for EPS services with user plane CIoT EPS optimization.\nChosen PLMN: The same as selected PLMN as specified in 3GPP TS 23.122 [6].\nControl plane CIoT EPS optimization: signalling optimizations to enable efficient transport of user data (IP, non-IP, Ethernet or SMS) over control plane via the MME including optional header compression of IP data.\nCS fallback cancellation request: A request received from the MM sublayer to cancel a mobile originating CS fallback.\nCS fallback capable UE: A UE that uses a CS infrastructure for a voice call and other CS-domain services by falling back to A/Gb or Iu mode if the UE is served by E-UTRAN when a CS service is requested.\nCSG cell: A cell in which only members of the CSG can get normal service. Depending on local regulation, the CSG cell can provide emergency bearer services also to subscribers who are not member of the CSG. Definition derived from 3GPP TS 23.401 [10].\nCSG ID: A CSG ID is a unique identifier within the scope of one PLMN defined in 3GPP TS 23.003 [2] which identifies a Closed Subscriber Group (CSG) in the PLMN associated with a cell or group of cells to which access is restricted to members of the CSG.\nCSG selection: A UE supporting CSG selection selects CSG cell either automatically based on the list of allowed CSG identities or manually based on user selection of CSG on indication of list of available CSGs. Definition derived from 3GPP TS 23.122 [6].\nNOTE 1:\tVoid.\nDedicated bearer: An EPS bearer that is associated with uplink packet filters in the UE and downlink packet filters in the PDN GW where the filters only match certain packets. Definition derived from 3GPP TS 23.401 [10].\nDefault bearer: An EPS bearer that gets established with every new PDN connection. Its context remains established throughout the lifetime of that PDN connection. A default EPS bearer is a non-GBR bearer. Definition derived from 3GPP TS 23.401 [10].\nEmergency EPS bearer context: A default EPS bearer context activated with request type \"emergency\" or \"handover of emergency bearer services\", or any dedicated EPS bearer context associated to this default EPS bearer context.\nEMM context: An EMM context is established in the UE and the MME when an attach procedure is successfully completed.\nEMM-CONNECTED mode: A UE is in EMM-CONNECTED mode when a NAS signalling connection between UE and network is established or after indication from the lower layers that the RRC connection has been resumed when the UE was in EMM-IDLE mode with suspend indication. The term EMM-CONNECTED mode used in the present document corresponds to the term ECM-CONNECTED state used in 3GPP TS 23.401 [10].\nEMM-IDLE mode: A UE is in EMM-IDLE mode when no NAS signalling connection between UE and network exists or when RRC connection suspend has been indicated by lower layers. The term EMM-IDLE mode used in the present document corresponds to the term ECM-IDLE state used in 3GPP TS 23.401 [10].\nEPS security context: In the present specification, EPS security context is used as a synonym for EPS NAS security context specified in 3GPP TS 33.401 [19].\nEPS services: Services provided by PS domain. Within the context of this specification, EPS services is used as a synonym for GPRS services in 3GPP TS 24.008 [13].\nEvolved packet core network: The successor to the 3GPP Release 7 packet-switched core network, developed by 3GPP within the framework of the 3GPP System Architecture Evolution (SAE).\nEvolved packet system: The evolved packet system (EPS) or evolved 3GPP packet-switched domain consists of the evolved packet core network and the evolved universal terrestrial radio access network. Definition derived from 3GPP TS 23.401 [10].\nGBR bearer: An EPS bearer that uses dedicated network resources related to a guaranteed bit rate (GBR) value, which are permanently allocated at EPS bearer establishment/modification. Definition derived from 3GPP TS 23.401 [10].\nGeneral NAS level mobility management congestion control: The type of congestion control that is applied at a general overload or congestion situation in the network, e.g. lack of processing resources.\nGroup specific session management congestion control: Type of congestion control at session management level that is applied to reject session management requests from UEs belonging to a particular group when one or more group congestion criteria as specified in 3GPP TS 23.401 [10] are met.\nHighest ranked ACDC category: The ACDC category with the lowest value as defined in 3GPP TS 24.105 [35].\nInitial NAS message: A NAS message is considered as an initial NAS message, if this NAS message can trigger the establishment of a NAS signalling connection. For instance, the ATTACH REQUEST message is an initial NAS message.\nIn NB-S1 mode: Indicates this paragraph applies only to a system which operates in NB-S1 mode. For a multi-access system this case applies if the current serving radio access network or the current serving satellite access network provides access to network services via E-UTRA by NB-IoT (see 3GPP TS 36.300 [20], 3GPP TS 36.331 [22], 3GPP TS 36.306 [44]).\nIn WB-S1 mode: Indicates this paragraph applies only to a system which operates in WB-S1 mode. For a multi-access system this case applies if the system operates in S1 mode, but not in NB-S1 mode. WB-S1 mode also includes satellite access.\nIn WB-S1/CE mode: Indicates this paragraph applies only when a UE, which is a CE mode B capable UE (see 3GPP TS 36.306 [44]), is operating in CE mode A or B in WB-S1 mode.\nIPv4v6 capability: Capability of the IP stack associated with a UE to support a dual stack configuration with both an IPv4 address and an IPv6 address allocated.\nKilobit: 1000 bits.\nLast Visited Registered TAI: A TAI which is contained in the TAI list that the UE registered to the network and which identifies the tracking area last visited by the UE. If the cell is a satellite cell broadcasting multiple TAIs, a TAI which is contained in the TAI list that the UE registered to the network and last selected by the UE as the current TAI.\nLinked Bearer Identity: This identity indicates to which default bearer the additional bearer resource is linked.\nLIPA PDN connection: A PDN connection, for which the default EPS bearer context or default PDP context was activated with an APN authorized to use LIPA. The network authorizes an APN for using LIPA based on the subscription profile (see 3GPP TS 29.272 [16C]) and subsequently the network considers this PDN connection a LIPA PDN connection.\nLower layer failure: A failure reported by the AS to the NAS that cannot be corrected on AS level. When the AS indicates a lower layer failure to NAS, the NAS signalling connection is not available.\nMapped EPS security context: A mapped security context to be used in EPS. Definition derived from 3GPP TS 33.401 [19].\nMapped GUTI: A GUTI which is mapped from a P-TMSI and an RAI allocated previously by an SGSN or a 5G-GUTI previously allocated by an AMF. Mapping rules are defined in 3GPP TS 23.003 [2]. Definition derived from 3GPP TS 23.401 [10].\nMegabit: 1,000,000 bits.\nMessage header: A standard L3 message header as defined in 3GPP TS 24.007 [12].\nMME area: An area containing tracking areas served by an MME.\nMO MMTEL voice call is started: the MO-MMTEL-voice-started indication was received from upper layers (see 3GPP TS 24.173 [13E]) and after reception of the MO-MMTEL-voice-started indication, the MO-MMTEL-voice-ended indication has not been received.\nMO MMTEL video call is started: the MO-MMTEL-video-started indication was received from upper layers (see 3GPP TS 24.173 [13E]) and after reception of the MO-MMTEL-video-started indication, the MO-MMTEL-video-ended indication has not been received.\nMT MMTEL voice call is started: the MT-MMTEL-voice-started indication was received from upper layers (see 3GPP TS 24.173 [13E]) and after reception of the MT-MMTEL-voice-started indication, the MT-MMTEL-voice-ended indication has not been received.\nMT MMTEL video call is started: the MT-MMTEL-video-started indication was received from upper layers (see 3GPP TS 24.173 [13E]) and after reception of the MT-MMTEL-video-started indication, the MT-MMTEL-video-ended indication has not been received.MO SMSoIP is started: the MO-SMSoIP-attempt-started indication was received from upper layers (see 3GPP TS 24.341 [15D]) and after reception of the MO-SMSoIP-attempt-started indication, the MO-SMSoIP-attempt-ended indication has not been received.\nMT SMSoIP is started: the MT-SMSoIP-attempt-started indication was received from upper layers (see 3GPP TS 24.341 [15D]) and after reception of the MT-SMSoIP-attempt-started indication, the MT-SMSoIP-attempt-ended indication has not been received.\nMUSIM UE: A UE with multiple valid USIMs, capable of initiating and maintaining simultaneous separate registration states with PLMN(s) using identities and credentials associated with those USIMs and supporting one or more of the NAS signalling connection release, the paging indication for voice services, the reject paging request, the paging restriction and the paging timing collision control.\nNAS level mobility management congestion control: Congestion control mechanism in the network in mobility management. \"NAS level mobility management congestion control\" consists of \"subscribed APN based congestion control\" and \"general NAS level mobility management congestion control\".\nNAS signalling connection: A peer to peer S1 mode connection between UE and MME. A NAS signalling connection consists of the concatenation of an RRC connection via the \"LTE-Uu\" interface and an S1AP connection via the S1 interface. Additionally, for the purpose of optimized handover or idle mode mobility from cdma2000® HRPD access to E-UTRAN (see 3GPP TS 23.402 [11]), the NAS signalling connection can consist of a concatenation of an S101-AP connection and a signalling tunnel over a cdma2000® HRPD access network.\nNOTE 2:\tcdma2000® is a registered trademark of the Telecommunications Industry Association (TIA-USA).\nNAS signalling connection recovery: A mechanism initiated by the NAS to restore the NAS signalling connection on indication of \"RRC connection failure\" by the lower layers.\nNative GUTI: A GUTI previously allocated by an . Definition derived from 3GPP TS 23.401 [10].\nNon-access stratum protocols: The protocols between UE and MSC or SGSN that are not terminated in the UTRAN, and the protocols between UE and MME that are not terminated in the E-UTRAN. Definition derived from 3GPP TR 21.905 [1].\nNon-emergency EPS bearer context: Any EPS bearer context which is not an emergency EPS bearer context.\nNon-EPS services: Services provided by CS domain. Within the context of this specification, non-EPS services is used as a synonym for non-GPRS services in 3GPP TS 24.008 [13]. A UE which camps on E-UTRAN can attach to both EPS services and non-EPS services.\nNon-GBR bearer: An EPS bearer that uses network resources that are not related to a guaranteed bit rate (GBR) value. Definition derived from 3GPP TS 23.401 [10].\nPDN address: An IP address assigned to the UE by the Packet Data Network Gateway (PDN GW).\nPDN connection for emergency bearer services: A PDN connection with an emergency EPS bearer context or with a default PDP context activated with request type \"emergency\" or \"handover of emergency bearer services\".\nPDN connection for RLOS: A PDN connection for which the default EPS bearer context was activated with request type \"RLOS\".\nPlain NAS message: A NAS message with a header including neither a message authentication code nor a sequence number.\nPersistent EPS bearer context: either a non-emergency EPS bearer context representing a GBR bearer with QoS equivalent to QoS of teleservice 11 and where there is a radio bearer associated with that context, or an emergency EPS bearer context where there is a radio bearer associated with that context.\nNOTE 3:\tAn example of a persistent EPS bearer context is a non-emergency EPS bearer context with QCI = 1 where there is a radio bearer associated with that context.\nProcedure Transaction Identity: An identity which is dynamically allocated by the UE for the UE requested ESM procedures. The procedure transaction identity is released when the procedure is completed.\nRAT-related TMSI: When the UE is camping on an E-UTRAN cell, the RAT-related TMSI is the GUTI; when it is camping on a GERAN or UTRAN cell, the RAT-related TMSI is the P-TMSI.\nRegistered PLMN: The PLMN on which the UE is registered. The identity of the registered PLMN is provided to the UE within the GUTI.\nRelay node: A network element in the E-UTRAN, wirelessly connected to an eNode B and providing relaying function to UEs served by the E-UTRAN. Definition derived from 3GPP TS 23.401 [10].\nRemoval of eCall only mode restriction: All the limitations as described in 3GPP TS 22.101 [46] for the eCall only mode do not apply any more.\nRLOS EPS bearer context: A default RLOS EPS bearer context which was activated with request type \"RLOS\", or any dedicated EPS bearer context associated to this default EPS bearer context.\nThe label (S1 mode only) indicates that this clause or paragraph applies only to a system which operates in S1 mode, i.e. with a functional division that is in accordance with the use of an S1 interface between the radio access network and the core network. The S1 mode includes WB-S1 mode and NB-S1 mode. In a multi-access system this case is determined by the current serving radio access network or the current serving satellite access network.\nSatellite E-UTRAN RAT type: In case of satellite E-UTRAN access, RAT types are used to distinguish different types of satellite E-UTRAN access, as defined in 3GPP TS 38.413 [31]. In this version of the specification, the defined satellite E-UTRAN RAT types are \"WB-E-UTRAN(LEO)\", \"WB-E-UTRAN(MEO)\", \" WB-E-UTRAN(GEO)\", \"NB-IoT(LEO)\", \"NB-IoT(MEO)\", \"NB-IoT(GEO)\", \"LTE-M(LEO)\", \"LTE-M(MEO)\" and \"LTE-M(GEO)\".\nSCEF PDN Connection: A PDN connection established between the UE and the Service Capability Exposure Function (SCEF) for transmitting the UE's non-IP data related to a specific application.\nSGi PDN Connection: A PDN connection established between the UE and the Packet Gateway (P-GW) for transmitting the UE's IP, non-IP or Ethernet data related to a specific application.\nS101 mode: Applies to a system that operates with a functional division that is in accordance with the use of an S101 interface. For the definition of the S101 reference point, see 3GPP TS 23.402 [11].\nSIPTO at the local network PDN connection: A PDN connection, for which the default EPS bearer context or default PDP context was activated with an APN authorized to use SIPTO at the local network and it was activated such that the traffic of the PDN connection will be using an L-GW. The network authorizes an APN for using SIPTO at the local network based on the subscription profile (see 3GPP TS 29.272 [16C]) and subsequently the network considers this PDN connection a SIPTO at the local network PDN connection. SIPTO at the local network PDN connection can be of IP, non-IP or Ethernet PDN type.\nSIPTO at the local network PDN connection with a collocated L-GW: A SIPTO at the local network PDN connection which is established to a L-GW function collocated with the (H)(e)NodeB. The core-network entity (i.e. the MME or the SGSN) can be aware of whether the SIPTO at the local network PDN connection with a collocated L-GW is used when the PDN connection is established.\nSIPTO at the local network PDN connection with a stand-alone GW: A SIPTO at the local network PDN connection which is established to a stand-alone GW (with collocated L-GW and S-GW). The core-network entity (i.e. the MME or the SGSN) can be aware of whether the SIPTO at the local network PDN connection with a stand-alone GW is used when the PDN connection is established.\n\"SMS only\": A subset of services which includes only Short Message Service. A UE camping on E-UTRAN can attach to both EPS services and \"SMS only\".\nSMS over NAS: refers to SMS in MME or SMS over SGs.\nSMS over S102: refers to SMS which uses 1xCS procedures in EPS as defined in 3GPP TS 23.272 [9].\nSubscribed APN based congestion control: Congestion control in mobility management where the network can reject attach requests from UEs with a certain APN in the subscription.\nTAI list: A list of TAIs that identify the tracking areas that the UE can enter without performing a tracking area updating procedure. The TAIs in a TAI list assigned by an MME to a UE pertain to the same MME area.\nTraffic flow aggregate: A temporary aggregate of packet filters that are included in a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure and that is inserted into a traffic flow template (TFT) for an EPS bearer context by the network once the UE requested bearer resource allocation procedure or UE requested bearer resource modification procedure is completed.\nUE configured for dual priority: A UE which provides dual priority support is configured for NAS signalling low priority and also configured to override the NAS signalling low priority indicator (see 3GPP TS 24.368 [15A], 3GPP TS 31.102 [17]).\nUE configured to use AC11 – 15 in selected PLMN: A UE configured with at least one access class in the range 11-15 on the USIM, and the access class is applicable in the selected PLMN according to 3GPP TS 22.011 [1A].\nUE's availability for voice calls in the IMS: The indication of this availability or non-availability is provided by the upper layers of the UE as specified in 3GPP TS 24.229 [13D] in the annex relevant to the IP-Connectivity Access Network in use or determined in the NAS layer, as specified in clause 4.3.1. If availability is indicated, the UE uses the IM CN Subsystem and can terminate or originate requests for SIP sessions including an audio component with codecs suited for voice.\nUE's usage setting: This is a UE setting that indicates whether the UE has preference for voice services over data services or vice-versa. If a UE has preference for voice services, then the UE's usage setting is \"voice centric\". If a UE has preference for data services, then the UE's usage setting is \"data centric\". A UE whose setting is \"data centric\" may still require access to voice services. A UE whose setting is \"voice centric\" may still require access to data services. This definition is derived from 3GPP TS 23.221 [8A] and it applies to voice capable UEs. If the UE is capable of both S1 mode and N1 mode, there is a single UE's usage setting which applies to both 5GS and EPS (see 3GPP TS 24.501 [54]).\nUE supporting CIoT EPS optimizations: A UE that supports control plane CIoT EPS optimization or user plane CIoT EPS optimization and one or more other CIoT EPS optimizations when the UE is in S1 mode.\nUE using EPS services with control plane CIoT EPS optimization: A UE that is attached for EPS services with the control plane CIOT EPS optimization accepted by the network.\nUser plane CIoT EPS optimization: Signalling optimizations to enable efficient transport of user data (IP, non-IP or Ethernet) over the user plane.\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.221 [8A] apply:\nRestricted local operator services\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.401 [10] apply:\nAPN rate control status\nCellular IoT (CIoT)\nDCN-ID\neCall only mode\nNarrowBand-IoT\nDedicated core network\nPDN connection\nService Gap Control\nUE paging probability information\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.272 [9] apply:\nCS fallback\nSMS in MME\nSMS over SGs\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.682 [11A] apply:\nSCEF\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.008 [13] apply:\nA/Gb mode\nAccess domain selection\nDefault PDP context\nExtended idle-mode DRX cycle\nIu mode\nNative P-TMSI\nPower saving mode\nPS signalling connection\nRR connection\nTFT\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 33.102 [18] apply:\nUMTS security context\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 33.401 [19] apply:\nCurrent EPS security context\nFull native EPS security context\nKASME\nK'ASME\nMapped security context\nNative EPS security context\nNon-current EPS security context\nPartial native EPS security context\nData via MME\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.122 [6] apply:\nCountry\nDiscontinuous Coverage\nEHPLMN\nHPLMN\nShared Network\nSuitable Cell\nVPLMN\nLimited Service State\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.216 [8] apply:\nSRVCC\nvSRVCC\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 22.011 [1A] apply:\nExtended Access Barring\nApplication specific Congestion control for Data Communication (ACDC)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.003 [10] apply:\nLocal Home Network Identifier\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.303 [31] apply:\nProSe direct communication\nProSe direct discovery\nProSe UE-to-Network Relay\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.161 [36] apply:\nMulti-access PDN connection\nNBIFOM\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.167 [45] apply:\neCall over IMS\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.501 [54] apply:\n5G-EA\n5G-IA\n5GMM-CONNECTED mode\n5GMM-DEREGISTERED\n5GMM-DEREGISTERED-INITIATED\n5GMM-IDLE mode\n5GMM-NULL\n5GMM-REGISTERED\n5GMM-REGISTERED-INITIATED\n5GMM-SERVICE-REQUEST-INITIATED\nApplicable UE radio capability ID for the current UE radio configuration in the selected network\nControl plane CIoT 5GS optimization\nN1 mode\nNB-N1 mode\nNative 5G-GUTI\nService-level-AA\nUE operating in single-registration mode in a network supporting N26 interface\nUE supporting UAS services\nUser plane CIoT 5GS optimization\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 36.413 [23] apply:\nUser Location Information\nFor the purposes of the present document, the following terms and its definitions given in 3GPP TS 23.256 [60] apply:\n3GPP UAV ID\nCAA (Civil Aviation Administration)-Level UAV Identity\nCommand and Control (C2) Communication\nUAV controller (UAV-C)\nUAS Services\nUAS Service Supplier (USS)\nUncrewed Aerial System (UAS)\nUSS communication\nUUAA\nUUAA-SM\nDirect C2 communication\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\n5G-GUTI\t5G-Globally Unique Temporary Identifier\n5GMM\t5GS Mobility Management\n5GS\t5G System\nACDC\tApplication specific Congestion control for Data Communication\nAKA\tAuthentication and Key Agreement\nAMBR\tAggregate Maximum Bit Rate\nAPN\tAccess Point Name\nAPN-AMBR\tAPN Aggregate Maximum Bit Rate\nARP\tAllocation Retention Priority\nATSSS\tAccess Traffic Steering, Switching and Splitting\nBCM\tBearer Control Mode\nCIoT\tCellular IoT\nCP-CIoT\tControl Plane CIoT\nCP-EDT\tControl Plane EDT\nCSG\tClosed Subscriber Group\nE-UTRA\tEvolved Universal Terrestrial Radio Access\nE-UTRAN\tEvolved Universal Terrestrial Radio Access Network\nEAB\tExtended Access Barring\nECM\tEPS Connection Management\neDRX\tExtended idle-mode DRX cycle\nEDT\tEarly Data Transmission\nEENLV\tExtended Emergency Number List Validity\neKSI\tKey Set Identifier for E-UTRAN\nEMM\tEPS Mobility Management\neNode B\tEvolved Node B\nEPC\tEvolved Packet Core Network\nEPS\tEvolved Packet System\nEPS-UPIP\tUser-plane integrity protection in EPS\nESM\tEPS Session Management\nFQDN\tFully Qualified Domain Name\nGBR\tGuaranteed Bit Rate\nGEO\tGeostationary Orbit\nGUMMEI\tGlobally Unique MME Identifier\nGUTI\tGlobally Unique Temporary Identifier\nHeNB\tHome eNode B\nHRPD\tHigh Rate Packet Data\nIoT\tInternet of Things\nIP-CAN\tIP-Connectivity Access Network\nISR\tIdle mode Signalling Reduction\nkbps\tKilobits per second\nKSI\tKey Set Identifier\nL-GW\tLocal PDN Gateway\nLEO\tLow Earth Orbit\nLHN-ID\tLocal Home Network Identifier\nLIPA\tLocal IP Access\nM-TMSI\tM-Temporary Mobile Subscriber Identity\nMAC\tMessage Authentication Code\nMA PDU\tMulti-Access PDU\nMbps\tMegabits per second\nMBR\tMaximum Bit Rate\nMEO\tMedium Earth Orbit\nMME\tMobility Management Entity\nMMEC\tMME Code\nMT-EDT\tMobile Terminated-Early Data Transmission\nMUSIM\tMulti-USIM\nNB-IoT\tNarrowband IoT\nNR\tNew Radio\nNSSAI\tNetwork Slice Selection Assistance Information\nPD\tProtocol Discriminator\nPDN GW\tPacket Data Network Gateway\nProSe\tProximity-based Services\nPSM\tPower Saving Mode\nPTI\tProcedure Transaction Identity\nQCI\tQoS Class Identifier\nQoS\tQuality of Service\nRACS\tRadio Capability Signalling Optimisation\nRLOS\tRestricted Local Operator Services\nROHC\tRObust Header Compression\nRRC\tRadio Resource Control\nS-NSSAI\tSingle NSSAI\nS-TMSI\tS-Temporary Mobile Subscriber Identity\nS101-AP\tS101 Application Protocol\nS1AP\tS1 Application Protocol\nSAE\tSystem Architecture Evolution\nSCEF\tService Capability Exposure Function\nSDNAEPC\tSecondary DN authentication and authorization over EPC\nSGC\tService Gap Control\nSIPTO\tSelected IP Traffic Offload\nTA\tTracking Area\nTAC\tTracking Area Code\nTAI\tTracking Area Identity\nTFT\tTraffic Flow Template\nTI\tTransaction Identifier\nTIN\tTemporary Identity used in Next update\nUAS\tUncrewed Aerial System\nUAV\tUncrewed Aerial Vehicle\nURN\tUniform Resource Name\nURSP\tUE Route Selection Policy\nUSS\tUAS Service Supplier\nUUAA\tUSS UAV Authorization/Authentication\nV2X\tVehicle-to-Everything\nWUS\tWake-Up Signal\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tGeneral",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "The non-access stratum (NAS) described in the present document forms the highest stratum of the control plane between UE and MME at the radio interface (reference point \"LTE-Uu\"; see 3GPP TS 23.401 [10]).\nMain functions of the protocols that are part of the NAS are:\n-\tthe support of mobility of the user equipment (UE); and\n-\tthe support of session management procedures to establish and maintain IP connectivity between the UE and a packet data network gateway (PDN GW).\nNAS security is an additional function of the NAS providing services to the NAS protocols, e.g. integrity protection and ciphering of NAS signalling messages.\nFor the support of the above functions, the following procedures are supplied within this specification:\n-\telementary procedures for EPS mobility management in clause 5; and\n-\telementary procedures for EPS session management in clause 6.\nComplete NAS transactions consist of specific sequences of elementary procedures. Examples of such specific sequences can be found in 3GPP TS 23.401 [10].\nThe NAS for EPS follows the protocol architecture model for layer 3 as described in 3GPP TS 24.007 [12]; however, due to the objective of EPS to provide the subscriber with a \"ready-to-use\" IP connectivity and an \"always-on\" experience, the protocol supports a linkage between mobility management and session management procedures during the attach procedure (see clause 4.2).\nSignalling procedures for the control of NAS security are described as part of the EPS mobility management in clause 5. In addition to that, principles for the handing of EPS security contexts and for the activation of ciphering and integrity protection, when a NAS signalling connection is established, are provided in clause 4.4.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tLinkage between the protocols for EPS mobility management and EPS session management",
                    "description": "",
                    "summary": "",
                    "text_content": "During the EPS attach procedure, the network can activate a default EPS bearer context (i.e. if the UE requests PDN connectivity in the attach request). Additionally, the network can activate one or several dedicated EPS bearer contexts in parallel for PDN connections of IP or Ethernet PDN type. To this purpose the EPS session management messages for the default EPS bearer context activation can be transmitted in an information element in the EPS mobility management messages. In this case, the UE and the network execute the attach procedure, the default EPS bearer context activation procedure, and the dedicated EPS bearer context activation procedure in parallel. The UE and network shall complete the combined default EPS bearer context activation procedure and the attach procedure before the dedicated EPS bearer context activation procedure is completed. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the success of the attach procedure is dependent on the success of the default EPS bearer context activation procedure. If the attach procedure fails, then the ESM procedures also fail.\nA UE using EPS services with control plane CIoT EPS optimization can initiate transport of user data via the control plane. For this purpose a UE in EMM-IDLE mode can initiate the service request procedure and transmit the ESM DATA TRANSPORT message in an information element in the CONTROL PLANE SERVICE REQUEST message.\nExcept for the attach procedure and the service request procedure, during EMM procedures the MME shall suspend the transmission of ESM messages. During the service request procedure the MME may suspend the transmission of ESM messages.\nExcept for the attach procedure and the service request procedure for UE initiated transport of user data via the control plane, during EMM procedures the UE shall suspend the transmission of ESM messages.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2A\tHandling of NAS signalling low priority indication",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE configured for NAS signalling low priority (see 3GPP TS 24.368 [15A], 3GPP TS 31.102 [17]) indicates this by including the Device properties IE in the appropriate NAS message and setting the low priority indicator to \"MS is configured for NAS signalling low priority\", except for the following cases in which the UE shall set the low priority indicator to \"MS is not configured for NAS signalling low priority\":\n-\tthe UE is performing an attach for emergency bearer services;\n-\tthe UE has a PDN connection for emergency bearer services established and is performing EPS mobility management procedures, or is establishing a PDN connection for emergency bearer services;\n-\tthe UE configured for dual priority is requested by the upper layers to establish a PDN connection with the low priority indicator set to \"MS is not configured for NAS signalling low priority\";\n-\tthe UE configured for dual priority is performing EPS session management procedures related to the PDN connection established with low priority indicator set to \"MS is not configured for NAS signalling low priority\";\n-\tthe UE configured for dual priority has a PDN connection established by setting the low priority indicator to \"MS is not configured for NAS signalling low priority\" and is performing EPS mobility management procedures;\n-\tthe UE is performing a service request procedure for a CS fallback emergency call or 1xCS fallback emergency call;\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN; or\n-\tthe UE is responding to paging.\nThe network may use the NAS signalling low priority indication for NAS level mobility management congestion control and APN based congestion control.\nIf the NAS signalling low priority indication is provided in a PDN CONNECTIVITY REQUEST message, the MME stores the NAS signalling low priority indication within the default EPS bearer context activated due to the PDN connectivity request procedure.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.3\tUE mode of operation",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.3.1\tGeneral",
                            "text_content": "A UE attached for EPS services shall operate in one of the following operation modes:\n-\tPS mode 1 of operation: the UE registers only to EPS services, and UE's usage setting is \"voice centric\";\n-\tPS mode 2 of operation: the UE registers only to EPS services, and UE's usage setting is \"data centric\";\n-\tCS/PS mode 1 of operation: the UE registers to both EPS and non-EPS services, and UE's usage setting is \"voice centric\"; and\n-\tCS/PS mode 2 of operation: the UE registers to both EPS and non-EPS services, and UE's usage setting is \"data centric\".\nA UE configured to use CS fallback, shall operate in CS/PS mode 1 or CS/PS mode 2. Such UE may also be configured to use IMS, in which case the voice domain preference for E-UTRAN as defined in 3GPP TS 24.167 [13B] shall be used for the selection of the domain for originating voice communication services.\nNOTE 1:\tThe domain selected for originating voice communication services can be ignored by attempting a CS emergency call.\nUpon request from upper layers to establish a CS emergency call:\n-\tif the UE needs to initiate a CS fallback emergency call but it is unable to perform CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology, and a UE with \"IMS voice not available\" should disable the E-UTRA capability (see clause 4.5) to allow a potential callback, and then progress the CS emergency call establishment;\n-\tif the UE needs to initiate a 1xCS fallback emergency call but it is unable to perform 1xCS fallback, the UE shall attempt to select cdma2000® 1x radio access technology to establish the call.\nNOTE 2:\tUnable to perform CS fallback or 1xCS fallback means that either the UE was not allowed to attempt CS fallback or 1xCS fallback, or CS fallback or 1xCS fallback attempt failed.\nA UE configured to use SMS over SGs shall operate in CS/PS mode 1 or CS/PS mode 2.\nThe behaviour of the UE in CS/PS mode 1 of operation, upon failure to access the CS domain or upon reception of a \"CS fallback not preferred\" or \"SMS only\" indication, will depend on the availability of voice over IMS. In the present document, \"IMS voice not available\" refers to one of the following conditions:\na)\tthe UE is not configured to use IMS;\nb)\tthe UE is not configured to use IMS voice, i.e. when the voice domain preference for E-UTRAN, as defined in 3GPP TS 24.167 [13B], indicates that voice communication services are allowed to be invoked only over the CS domain;\nc)\tthe UE is configured to use IMS voice, but the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are not supported; or\nd)\tthe UE is configured to use IMS voice, the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are supported, but the upper layers:\n-\tprovide no indication that the UE is available for voice call in the IMS within a manufacturer determined period of time; or\n-\tindicate that the UE is not available for voice calls in the IMS.\nNOTE 3:\tIf conditions a, b and c evaluate to false, the upper layers need time to attempt IMS registration. In the event an indication from the upper layers that the UE is available for voice calls in the IMS takes longer than the manufacturer determined period of time (e.g. due to delay when attempting IMS registration or due to delay obtaining an EPS bearer context for SIP signalling), the NAS layer assumes the UE is not available for voice calls in the IMS.\nOther conditions may exist but these are implementation specific.\nIn the present document, \"IMS voice available\" refers to the conditions a, b, c and d, and other implementation specific conditions for \"IMS voice not available\" evaluate to false.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.2\tChange of UE mode of operation",
                            "text_content": "The UE mode of operation can change as a result of e.g.:\n-\ta change of UE's usage setting for a CS voice capable UE;\n-\ta change of voice domain preference for E-UTRAN as defined in 3GPP TS 24.167 [13B] for a CS voice capable UE;\n-\ta change in the UE's availability for voice calls in the IMS; or\n-\ta change in UE configuration regarding the use of SMS as defined in 3GPP TS 24.167 [13B].\nFigure 4.3.2.1.1 and figure 4.3.2.1.2 illustrate the transitions between different UE mode of operations when UE's usage settings, voice domain preference for E-UTRAN or configuration regarding SMS changes.\nThe figure depicts a 5G network signal path, illustrating the multi-path signal propagation in a 5G network. Key components include the base station (gNB), user equipment (UE), and scatterers. The diagram highlights beamforming techniques to mitigate interference.\nNOTE 1:\tThe UE may transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2 to PS mode 2 if \"CS domain not available\" is received. After the transition to PS mode 1 or PS mode 2 due to \"CS domain not available\", the UE can transit back to CS/PS mode 1 or CS/PS mode 2, e.g. due to change of PLMN which is not in the list of the equivalent PLMNs.\nNOTE 2:\tNot all possible transitions are shown in this figure.\n\nFigure 4.3.2.1.1: Change of UE mode of operation for a CS voice capable UE\nThe figure depicts a simplified representation of a 5G network signal path, illustrating the various paths through which signals can propagate. It highlights the importance of beamforming techniques to mitigate interference and the use of redundancy paths to ensure reliability. The figure is a schematic representation, not a detailed diagram, and does not include all possible transitions.\nNOTE:\tNot all possible transitions are shown in this figure.\n\nFigure 4.3.2.1.2: Change of UE mode of operation for a UE with no CS voice capability\nWhenever the UE's usage setting changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.2.1 and table 4.3.2.2.2:\na)\tThe UE is operating in PS mode 1 or PS mode 2\nTable 4.3.2.2.1: Change of UE's usage setting for a UE in PS mode 1 or PS mode 2\n\nb)\tThe UE is operating in CS/PS mode 1 or CS/PS mode 2\nTable 4.3.2.2.2: Change of UE's usage setting for a UE in CS/PS mode 1 or CS/PS mode 2\n\nWhenever the voice domain preference for E-UTRAN changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.3.1 and table 4.3.2.3.2:\na)\tThe UE is operating in PS mode 1 or PS mode 2\nTable 4.3.2.3.1: Change of voice domain preference for E-UTRAN for a UE in PS mode 1 or PS mode 2\n\nb)\tThe UE is operating in CS/PS mode 1 or CS/PS mode 2\nTable 4.3.2.3.2: Change of voice domain preference for E-UTRAN for a UE in CS/PS mode 1 or CS/PS mode 2\n\nWhenever the UE's availability for voice calls in the IMS is determined or changes (e.g. whenever the IMS registration status is determined or changes), the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.4.1, 4.3.2.4.2 or 4.3.2.4.3:\na)\tThe UE is operating in PS mode 1\nTable 4.3.2.4.1: Change of IMS registration status for a UE in PS mode 1\n\nNOTE 1:\tIf the UE in PS mode 1 transits to CS/PS mode 1 according to table 4.3.2.4.1, then the UE can return to PS mode 1 when the upper layer indicates the status of being available for voice over PS.\nb)\tThe UE is operating in PS mode 2\nTable 4.3.2.4.2: Change of IMS registration status for a UE in PS mode 2\n\nNOTE 2:\tIf the UE in PS mode 2 transits to CS/PS mode 2 according to table 4.3.2.4.2, then the UE can return to PS mode 2 when the upper layer indicates the status of being available for voice over PS.\nc)\tThe UE is operating in CS/PS mode 1\nTable 4.3.2.4.3: Change of IMS registration status for a UE in CS/PS mode 1\n\nWhenever the UE's configuration on use of SMS changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.5.1 and table 4.3.2.5.2:\na)\tThe UE is operating in PS mode 1 or PS mode 2\nTable 4.3.2.5.1: Change of configuration regarding the use of SMS in PS mode 1 or PS mode 2\n\nb)\tThe UE is operating in CS/PS mode 1 or CS/PS mode 2\nTable 4.3.2.5.2: Change of configuration regarding the use of SMS in CS/PS mode 1 or CS/PS mode 2\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.3.2.2.1: Change of UE's usage setting for a UE in PS mode 1 or PS mode 2",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.3.2.2.2: Change of UE's usage setting for a UE in CS/PS mode 1 or CS/PS mode 2",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.3.2.3.1: Change of voice domain preference for E-UTRAN for a UE in PS mode 1 or PS mode 2",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.3.2.3.2: Change of voice domain preference for E-UTRAN for a UE in CS/PS mode 1 or CS/PS mode 2",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.3.2.4.1: Change of IMS registration status for a UE in PS mode 1",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.3.2.4.2: Change of IMS registration status for a UE in PS mode 2",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.3.2.4.3: Change of IMS registration status for a UE in CS/PS mode 1",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.3.2.5.1: Change of configuration regarding the use of SMS in PS mode 1 or PS mode 2",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.3.2.5.2: Change of configuration regarding the use of SMS in CS/PS mode 1 or CS/PS mode 2",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "4.4\tNAS security",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.4.1\tGeneral",
                            "text_content": "This clause describes the principles for the handling of EPS security contexts in the UE and in the MME and the procedures used for the security protection of EPS NAS messages between UE and MME. Security protection involves integrity protection and ciphering of the EMM and ESM NAS messages.\nThe signalling procedures for the control of NAS security are part of the EMM protocol and are described in detail in clause 5.\nNOTE:\tThe use of ciphering in a network is an operator option. In this clause, for the ease of description, it is assumed that ciphering is used, unless explicitly indicated otherwise. Operation of a network without ciphering is achieved by configuring the MME so that it always selects the \"null ciphering algorithm\", EEA0.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.2\tHandling of EPS security contexts",
                            "text_content": "The security parameters for authentication, integrity protection and ciphering are tied together in an EPS security context and identified by a key set identifier for E-UTRAN (eKSI). The relationship between the security parameters is defined in 3GPP TS 33.401 [19].\nBefore security can be activated, the MME and the UE need to establish an EPS security context. Usually, the EPS security context is created as the result of an EPS authentication procedure between MME and UE. Alternatively:\n-\tduring inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, the MME and the UE derive a mapped EPS security context from a UMTS security context that has been established while the UE was in A/Gb mode or Iu mode; or\n-\tduring CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, the MME and the UE derive a mapped EPS security context from a CS UMTS security context that has been established while the UE was in A/Gb mode or Iu mode.\nThe EPS security context is taken into use by the UE and the MME, when the MME initiates a security mode control procedure or during the inter-system handover procedure from A/Gb mode to S1 mode or Iu mode to S1 mode. The EPS security context which has been taken into use by the network most recently is called current EPS security context. This current EPS security context can be of type native or mapped, i.e. originating from a native EPS security context or mapped EPS security context.\nThe key set identifier eKSI is assigned by the MME either during the EPS authentication procedure or, for the mapped EPS security context, during the inter-system handover procedure. The eKSI consists of a value and a type of security context parameter indicating whether an EPS security context is a native EPS security context or a mapped EPS security context. When the EPS security context is a native EPS security context, the eKSI has the value of KSIASME, and when the current EPS security context is of type mapped, the eKSI has the value of KSISGSN.\nThe EPS security context which is indicated by an eKSI can be taken into use to establish the secure exchange of NAS messages when a new NAS signalling connection is established without executing a new EPS authentication procedure (see clause 4.4.2.3) or when the MME initiates a security mode control procedure. For this purpose the initial NAS messages (i.e. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, DETACH REQUEST, SERVICE REQUEST, EXTENDED SERVICE REQUEST, and CONTROL PLANE SERVICE REQUEST) and the SECURITY MODE COMMAND message contain an eKSI in the NAS key set identifier IE or the value part of eKSI in the KSI and sequence number IE indicating the current EPS security context used to integrity protect the NAS message.\nIn the present document, when the UE is required to delete an eKSI, the UE shall set the eKSI to the value \"no key is available\" and consider also the associated keys KASME or K'ASME, EPS NAS ciphering key and EPS NAS integrity key invalid (i.e. the EPS security context associated with the eKSI as no longer valid).\nNOTE:\tIn some specifications the term ciphering key sequence number might be used instead of the term Key Set Identifier (KSI).\nThe UE and the MME need to be able to maintain two EPS security contexts simultaneously, i.e. a current EPS security context and a non-current EPS security context, since:\n-\tafter an EPS re-authentication, the UE and the MME can have both a current EPS security context and a non-current EPS security context which has not yet been taken into use (i.e. a partial native EPS security context); and\n-\tafter an inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE and the MME can have both a mapped EPS security context, which is the current EPS security context, and a non-current native EPS security context that was created during a previous access in S1 mode or S101 mode.\nThe number of EPS security contexts that need to be maintained simultaneously by the UE and the MME is limited by the following requirements:\n-\tAfter a successful EPS (re-)authentication, which creates a new partial native EPS security context, the MME and the UE shall delete the non-current EPS security context, if any.\n-\tWhen a partial native EPS security context is taken into use through a security mode control procedure, the MME and the UE shall delete the previously current EPS security context.\n-\tWhen the MME and the UE create an EPS security context using null integrity and null ciphering algorithm during an attach procedure for emergency bearer services, or a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services (see clause 5.4.3.2), the MME and the UE shall delete the previous current EPS security context. The UE shall not update the USIM and non-volatile ME memory with the current EPS security context and shall delete the current EPS security context when the UE is detached from emergency services (e.g. before attaching for normal service).\n-\tWhen a new mapped EPS security context or EPS security context created using null integrity and null ciphering algorithm is taken into use during the inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall not delete the previously current native EPS security context, if any. Instead, the previously current native EPS security context shall become a non-current native EPS security context, and the MME and the UE shall delete any partial native EPS security context.\nIf no previously current native EPS security context exists, the MME and the UE shall not delete the partial native EPS security context, if any.\n-\tWhen the MME and the UE derive a new mapped EPS security context during inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall delete any existing current mapped EPS security context.\n-\tWhen a non-current full native EPS security context is taken into use by a security mode control procedure, then the MME and the UE shall delete the previously current mapped EPS security context.\n-\tWhen the UE or the MME moves from EMM-REGISTERED to EMM-DEREGISTERED state, if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, then the non-current EPS security context shall become the current EPS security context. Furthermore, the UE and the MME shall delete any mapped EPS security context or partial native EPS security context.\nThe UE shall mark the EPS security context on the USIM or in the non-volatile memory as invalid when the UE initiates an attach procedure as described in clause 5.5.1 or when the UE leaves state EMM-DEREGISTERED for any other state except EMM-NULL.\nThe UE shall store the current native EPS security context as specified in annex C and mark it as valid only when the UE enters state EMM-DEREGISTERED from any other state except EMM-NULL or when the UE aborts the attach procedure without having left EMM-DEREGISTERED.\nIn order for the UE to derive a mapped EPS security context for an inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode, the MME shall generate a KSISGSN, create a nonceMME and generate the K'ASME using the created nonceMME as indicated in 3GPP TS 33.401 [19]. The MME shall include the selected NAS algorithms, nonceMME and generated KSISGSN (associated with the K'ASME) in the NAS security transparent container for handover to E-UTRAN. The MME shall derive the EPS NAS keys from K'ASME.\nWhen the UE receives the command to perform handover to E-UTRAN, the UE shall derive K'ASME, as indicated in 3GPP TS 33.401 [19], using the nonceMME received in the NAS security transparent container. Furthermore, the UE shall associate the derived K'ASME with the received KSISGSN and derive the EPS NAS keys from K'ASME.\nWhen the UE has a PDN connection for emergency bearer services and has no current UMTS security context, the MME shall set EIA0 and EEA0 as the selected NAS security algorithms in the NAS security transparent container for handover to E-UTRAN. The MME shall create a locally generated K'ASME. The MME shall set the KSI value of the associated security context to \"000\" and the type of security context flag to \"mapped security context\" in the NAS security transparent container for handover to E-UTRAN.\nWhen the UE receives the command to perform handover to E-UTRAN and has a PDN connection for emergency bearer services, if EIA0 and EEA0 as the selected NAS security algorithms are included in the NAS security transparent container for handover to E-UTRAN, the UE shall create a locally generated K'ASME. The UE shall set the KSI value of the associated security context to the KSI value received.\nIf the inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode is not completed successfully, the MME and the UE shall delete the new mapped EPS security context.\nThe establishment of a mapped EPS security context during inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode is specified in 3GPP TS 24.501 [54] clause 4.4.2.4.\nSecure exchange of NAS messages via a NAS signalling connection is usually established by the MME during the attach procedure by initiating a security mode control procedure. After successful completion of the security mode control procedure, all NAS messages exchanged between the UE and the MME are sent integrity protected using the current EPS security algorithms, and except for the messages specified in clause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the current EPS security algorithms.\nDuring inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, secure exchange of NAS messages is established between the MME and the UE by:\n-\tthe transmission of NAS security related parameters encapsulated in the AS signalling from the MME to the UE triggering the inter-system handover (see 3GPP TS 33.401 [19]). The UE uses these parameters to generate the mapped EPS security context; and,\n-\tafter the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, and except for the messages specified in clause , all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context.\nDuring inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, secure exchange of NAS messages is established between the MME and the UE by:\n-\tthe transmission of NAS security related parameters encapsulated in the AS signalling from the AMF to the UE triggering the inter-system handover (see 3GPP TS 33.501 [56]). The UE uses these parameters to generate the mapped EPS security context (see clause 8.6.1 of 3GPP TS 33.501 [56]); and\n-\tafter the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, and except for the messages specified in clause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context.\nDuring inter-system change from N1 mode to S1 mode in EMM-IDLE mode, if the UE is operating in the single-registration mode and:\n1)\tif the tracking area updating procedure is initiated as specified in 3GPP TS 24.501 [54], the UE shall transmit a TRACKING AREA UPDATE REQUEST message integrity protected with the current 5G NAS security context and the UE shall derive a mapped EPS security context (see clause 8.6.1 of 3GPP TS 33.501 [56]). The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively. The UE shall include the eKSI indicating the 5G NAS security context value in the TRACKING AREA UPDATE REQUEST message.\nAfter receiving the TRACKING AREA UPDATE REQUEST message including the eKSI, the MME forwards the TRACKING AREA UPDATE REQUEST message to the source AMF, if possible, to obtain the mapped EPS security context from the AMF as specified in 3GPP TS 33.501 [56]. The MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The MME re-establishes the secure exchange of NAS messages by either:\n-\treplying with a TRACKING AREA UPDATE ACCEPT message that is integrity protected and ciphered using the mapped EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or\n-\tinitiating a security mode control procedure. This can be used by the MME to take a non-current EPS security context into use or to modify the current EPS security context by selecting new NAS security algorithms; or\n2)\tif the attach procedure is initiated as specified in 3GPP TS 24.501 [54] and:\na)\tif the UE has received an \"interworking without N26 interface not supported\" indication from the network and the UE has a valid 5G NAS security context, the UE shall send an ATTACH REQUEST message integrity protected with the current 5G NAS security context and the UE shall derive a mapped EPS security context (see clause 8.6.1 of 3GPP TS 33.501 [56]). The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively. The UE shall include the eKSI indicating the 5G NAS security context value in the ATTACH REQUEST message.\nAfter receiving the ATTACH REQUEST message including the eKSI, the MME forwards the ATTACH REQUEST message to the source AMF, if possible, to obtain the mapped EPS security context from the AMF as specified in 3GPP TS 33.501 [56]. The MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The MME re-establishes the secure exchange of NAS messages by either:\n-\treplying with an ATTACH ACCEPT message that is integrity protected and ciphered using the mapped EPS NAS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or\n-\tinitiating a security mode control procedure. This can be used by the MME to modify the current EPS security context by selecting new NAS security algorithms; or\nb)\totherwise:\ni)\tif the UE has a valid native EPS security context, the UE shall send an ATTACH REQUEST message integrity protected with the native EPS security context. The UE shall include the eKSI indicating the native EPS security context value in the ATTACH REQUEST message.\nAfter receiving the ATTACH REQUEST message including the eKSI, the MME shall check whether the eKSI included in the initial NAS message belongs to an EPS security context available in the MME, and shall verify the MAC of the NAS message. If the verification is successful, the MME re-establishes the secure exchange of NAS messages by either:\n-\treplying with an ATTACH ACCEPT message that is integrity protected and ciphered using the current EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause , all NAS messages exchanged between the UE and the MME are sent ciphered; or\n-\tinitiating a security mode control procedure. This can be used by the MME to modify the current EPS security context by selecting new NAS security algorithms; or\nii)\tif the UE has no valid native EPS security context, the UE shall send an ATTACH REQUEST message without integrity protection and encryption.\nThe secure exchange of NAS messages shall be continued after S1 mode to S1 mode handover. It is terminated after inter-system handover from S1 mode to A/Gb mode or Iu mode or when the NAS signalling connection is released.\nWhen a UE in EMM-IDLE mode establishes a new NAS signalling connection and has a valid current EPS security context, secure exchange of NAS messages can be re-established in the following ways:\n1)\tExcept for the cases described in items 3 and 4 below, the UE shall transmit the initial NAS message integrity protected with the current EPS security context, but unciphered. The UE shall include the eKSI indicating the current EPS security context value in the initial NAS message. The MME shall check whether the eKSI included in the initial NAS message belongs to an EPS security context available in the MME, and shall verify the MAC of the NAS message. If the verification is successful, the MME may re-establish the secure exchange of NAS messages:\n-\tby replying with a NAS message that is integrity protected and ciphered using the current EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause , all NAS messages exchanged between the UE and the MME are sent ciphered; or\n-\tby initiating a security mode control procedure. This can be used by the MME to take a non-current EPS security context into use or to modify the current EPS security context by selecting new NAS security algorithms; or\n2)\tIf the initial NAS message was a SERVICE REQUEST message or EXTENDED SERVICE REQUEST message, secure exchange of NAS messages is triggered by the indication from the lower layers that the user plane radio bearers are successfully set up. After successful completion of the procedure, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause , all NAS messages exchanged between the UE and the MME are sent ciphered.\n3)\tIf the UE has no current EPS security context and performs a tracking area updating procedure after an inter-system change in idle mode from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE shall send the TRACKING AREA UPDATE REQUEST message without integrity protection and encryption. The UE shall include a nonce and a GPRS ciphering key sequence number for creation of a mapped EPS security context. The MME creates a fresh mapped EPS security context and takes this context into use by initiating a security mode control procedure and this context becomes the current EPS security context in both the UE and the MME. This re-establishes the secure exchange of NAS messages.\n4)\tIf the initial NAS message is a CONTROL PLANE SERVICE REQUEST message, the UE shall send the message integrity protected. If an ESM message container information element or a NAS message container information element is included the message shall be sent partially ciphered (see clause 4.4.5), otherwise the message shall be sent unciphered. Secure exchange of NAS messages is re-established in the UE:\n-\tby the indication from the lower layers that the user plane radio bearers are successfully set up;\n-\tupon receipt of a NAS message (e.g. a SERVICE ACCEPT message or ESM DATA TRANSPORT message) that is integrity protected and ciphered using the current EPS security context; or\n-\tupon receipt of a SECURITY MODE COMMAND message that has successfully passed the integrity check.\nWhen the MME initiates a re-authentication to create a new EPS security context, the messages exchanged during the authentication procedure are integrity protected and ciphered using the current EPS security context, if any.\nBoth UE and MME shall continue to use the current EPS security context, until the MME initiates a security mode control procedure. The SECURITY MODE COMMAND message sent by the MME includes the eKSI of the new EPS security context to be used. The MME shall send the SECURITY MODE COMMAND message integrity protected with the new EPS security context, but unciphered. When the UE responds with a SECURITY MODE COMPLETE, it shall send the message integrity protected and ciphered with the new EPS security context.\nThe MME can also modify the current EPS security context or take the non-current native EPS security context, if any, into use, by sending a SECURITY MODE COMMAND message including the eKSI of the EPS security context to be modified and including a new set of selected NAS security algorithms. In this case the MME shall send the SECURITY MODE COMMAND message integrity protected with the modified EPS security context, but unciphered. When the UE replies with a SECURITY MODE COMPLETE message, it shall send the message integrity protected and ciphered with the modified EPS security context.\nAt change from A/Gb mode to S1 mode or from Iu mode to S1 mode due to CS to PS SRVCC handover (see 3GPP TS 23.216 [8]), the UE shall derive a mapped EPS security context for the PS domain from the UMTS security context for the CS domain.\nAt change from A/Gb mode to S1 mode due to CS to PS SRVCC handover, ciphering may be started and integrity protection shall be started (see 3GPP TS 36.331 [22]) without any new authentication procedure.\nNOTE 1:\tCS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode is not supported if the current CS security context is a GSM security context.\nNOTE 2:\tFor emergency calls, CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode is not supported.\nIn order to derive a mapped EPS security context for a CS to PS SRVCC handover from A/Gb mode or Iu mode to S1 mode, the MSC creates a NONCEMSC and generates the CK'PS and IK'PS using the CS UMTS integrity key, the CS UMTS ciphering key and the created NONCEMSC as specified in annex B.6 in 3GPP TS 33.102 [18]. The MSC associates the CK'PS and IK'PS with a KSI'PS. The KSI'PS is set to the value of the KSICS associated with the CS UMTS integrity key and the CS UMTS ciphering key. The MSC transfers the CK'PS, IK'PS and the KSI'PS to the MME. The MME shall create a mapped EPS security context by setting the K'ASME to the concatenation of the CK'PS and IK'PS received from the MSC (i.e. CK'PS || IK'PS). The MME shall associate the K'ASME with a KSISGSN. The MME shall set KSISGSN to the value of the KSI'PS received from the MSC. The MME shall include the selected NAS algorithms, NONCEMME and generated KSISGSN (associated with the K'ASME) in the NAS security transparent container for the handover to E-UTRAN. The MME shall derive the EPS NAS keys from K'ASME.\nWhen the UE receives the command to perform CS to PS SRVCC handover to S1 mode, the ME shall generate the CK'PS and IK'PS using the CS UMTS integrity key, the CS UMTS ciphering key and the received NONCEMSC value in the transparent container in the CS to PS SRVCC handover command as specified in annex B.6 in 3GPP TS 33.102 [18]. The ME shall ignore the NONCEMME value received in the NAS Security Transparent Container in the CS to PS SRVCC handover command.\nNOTE 3:\tThe NONCEMME value received in the NAS Security Transparent Container for the handover to E-UTRAN is not used by the ME or MME in any key derivation in this handover.\nThe ME shall create the key K'ASME by concatenating the derived CK'PS and IK'PS (i.e. CK'PS || IK'PS.). The ME shall associate the derived key K'ASME with a KSISGSN. The ME shall set the KSISGSN associated to K'ASME to the KSISGSN value received in the NAS Security Transparent Container from the network.\nNOTE 4:\tAlthough this case is related to the MSC server enhanced for SRVCC, the name KSISGSN is kept to avoid introducing a new name for the same domain.\nThe ME shall derive the EPS NAS keys (CK' and IK') from the K'ASME as specified in 3GPP TS 33.401 [19]. The ME shall apply these derived EPS NAS security keys (CK' and IK'), reset the uplink and downlink NAS COUNT values for the mapped EPS security context (i.e. to the value 0), and replace an already established mapped EPS security context for the PS domain, if any, in the ME, when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. If the already established current EPS security context is of type native, then it shall become the non-current native EPS security context and overwrite any existing non-current native EPS security context in the ME.\nThe network shall replace an already established mapped EPS security context for the PS domain, if any, when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. If the already established current EPS security context is of type native, then it shall become the non-current native EPS security context and overwrite any existing non-current native EPS security context in the MME.\nIf the CS to PS SRVCC handover from A/Gb mode or Iu mode has not been completed successfully, the UE and the network shall delete the new derived mapped EPS security context for the PS domain. Additionally, the network shall delete an already established mapped EPS security context for the PS domain, if any, if the eKSI of the already established EPS security context is equal to the KSISGSN of the new derived EPS security context for the PS domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.3\tHandling of NAS COUNT and NAS sequence number",
                            "text_content": "Each EPS security context shall be associated with two separate counters NAS COUNT: one related to uplink NAS messages and one related to downlink NAS messages. The NAS COUNT counters use 24 bit internal representation and are independently maintained by UE and MME. The NAS COUNT shall be constructed as a NAS sequence number (8 least significant bits) concatenated with a NAS overflow counter (16 most significant bits).\nWhen NAS COUNT is input to NAS ciphering or NAS integrity algorithms it shall be considered to be a 32-bit entity which shall be constructed by padding the 24-bit internal representation with 8 zeros in the most significant bits.\nThe value of the uplink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex C, is the value that shall be used in the next NAS message.\nThe value of the downlink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex C, is the largest downlink NAS COUNT used in a successfully integrity checked NAS message.\nThe value of the uplink NAS COUNT stored in the MME is the largest uplink NAS COUNT used in a successfully integrity checked NAS message.\nThe value of the downlink NAS COUNT stored in the MME is the value that shall be used in the next NAS message.\nThe NAS sequence number part of the NAS COUNT shall be exchanged between the UE and the MME as part of the NAS signalling. After each new or retransmitted outbound security protected NAS message, the sender shall increase the NAS COUNT number by one, except for the initial NAS messages if the lower layers indicated the failure to establish the RRC connection (see 3GPP TS 36.331 [22]). Specifically, on the sender side, the NAS sequence number shall be increased by one, and if the result is zero (due to wrap around), the NAS overflow counter shall also be incremented by one (see clause 4.4.3.5). The receiving side shall estimate the NAS COUNT used by the sending side. Specifically, if the estimated NAS sequence number wraps around, the NAS overflow counter shall be incremented by one.\nNOTE 0:\tWhen estimating a NAS COUNT, the receiver is required to ensure that a given NAS COUNT value is accepted at most one time, as specified in clause 4.4.3.2.\nAfter the derivation of a NAS token due to an inter-system change from S1mode to A/Gb mode or Iu mode in idle mode as specified in 3GPP TS 24.008 [13], the UE shall increase the uplink NAS COUNT by one.\nWhen the MME receives a NAS token via SGSN during an idle mode inter-system change from S1 mode to A/Gb mode or Iu mode, the MME shall check the NAS token as specified in 3GPP TS 33.401 [19], clause 9.1.1, and update its uplink NAS COUNT with the uplink NAS COUNT value used for the successful check of the NAS token.\nNOTE 1:\tThe MME does not check the NAS token if it is received via SGSN during a connected mode inter-system change from S1 mode to A/Gb mode or Iu mode.\nDuring the handover from UTRAN/GERAN to E-UTRAN, when a mapped EPS security context is derived and taken into use, the MME shall set both the uplink and downlink NAS COUNT counters of this EPS security context to zero. The UE shall set both the uplink and downlink NAS COUNT counters to zero.\nWhen a mapped EPS security context is derived as specified in 3GPP TS 33.501 [56] and taken into use in the following cases:\n-\tduring the inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode; or\n-\tduring the inter-system change from N1 mode to S1 mode in EMM-IDLE mode for the UE operating in single-registration mode in a network supporting N26 interface,\nthe MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively.\nDuring the handover from E-UTRAN to UTRAN/GERAN the MME signals the current downlink NAS COUNT value in a NAS security transparent container (see clause 9.9.2.6).\nDuring handover to or from E-UTRAN, the MME shall increment downlink NAS COUNT by one after it has created a NAS security transparent container (see clause 9.9.2.6 and 9.9.2.7).\nNOTE 2:\tDuring the handover from UTRAN/GERAN to E-UTRAN, the NAS security transparent container (see clause 9.9.2.7) is treated as an implicit SECURITY MODE COMMAND message for the UE and the MME, and therefore the MME regards the sending of the NAS security transparent container as the sending of an initial SECURITY MODE COMMAND message in order to derive and take into use a mapped EPS security context for the purpose of the NAS COUNT handling.\nIn some NAS messages only 5 of the 8 NAS sequence number bits are transmitted. When this is the case, the receiver shall estimate the remaining 3 most significant bits of the sequence number.\nReplay protection shall be supported for received NAS messages both in the MME and the UE. However, since the realization of replay protection does not affect the interoperability between nodes, no specific mechanism is required for implementation.\nReplay protection must assure that one and the same NAS message is not accepted twice by the receiver. Specifically, for a given EPS security context, a given NAS COUNT value shall be accepted at most one time and only if message integrity verifies correctly.\nReplay protection is not applicable when EIA0 is used.\nThe sender shall use its locally stored NAS COUNT as input to the integrity protection algorithm.\nThe receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in clause 4.4.3.1 to form the NAS COUNT input to the integrity verification algorithm.\nThe algorithm to calculate the integrity protection information is specified in 3GPP TS 33.401 [19], and the integrity protection shall include octets 6 to n of the security protected NAS message, i.e. the sequence number IE and the NAS message IE. The integrity protection of the SERVICE REQUEST message is defined in clause 9.9.3.28. In addition to the data that is to be integrity protected, the constant BEARER ID, DIRECTION bit, NAS COUNT and NAS integrity key are input to the integrity protection algorithm. These parameters are described in 3GPP TS 33.401 [19].\nAfter successful integrity protection validation, the receiver shall update its corresponding locally stored NAS COUNT with the value of the estimated NAS COUNT for this NAS message.\nIntegrity verification is not applicable when EIA0 is used.\nThe sender shall use its locally stored NAS COUNT as input to the ciphering algorithm.\nThe receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in clause 4.4.3.1 to form the NAS COUNT input to the deciphering algorithm.\nThe input parameters to the NAS ciphering algorithm are the constant BEARER ID, DIRECTION bit, NAS COUNT, NAS encryption key and the length of the key stream to be generated by the encryption algorithm. When an initial plain NAS message for transport of user data via control plane (i.e. CONTROL PLANE SERVICE REQUEST message) is to be partially ciphered, the length of the key stream is set to the length of the part of the initial plain NAS message (i.e. the value part of the ESM message container IE or the value part of the NAS message container) that is to be ciphered.\nIf, when increasing the NAS COUNT as specified above, the MME detects that either its downlink NAS COUNT or the UE's uplink NAS COUNT is \"close\" to wrap around, (close to 224), the MME shall take the following actions:\n-\tIf there is no non-current native EPS security context with sufficiently low NAS COUNT values, the MME shall initiate a new AKA procedure with the UE, leading to a new established EPS security context and the NAS COUNT being reset to 0 in both the UE and the MME when the new EPS security context is activated;\n-\tOtherwise, the MME can activate a non-current native EPS security context with sufficiently low NAS COUNT values or initiate a new AKA procedure as specified above.\nIf for some reason a new KASME has not been established using AKA before the NAS COUNT wraps around, the node (MME or UE) in need of sending a NAS message shall instead release the NAS signalling connection. Prior to sending the next uplink NAS message, the UE shall delete the eKSI indicating the current EPS security context.\nWhen the EIA0 is used as the NAS integrity algorithm, the UE and the MME shall allow NAS COUNT wrap around. If NAS COUNT wrap around occurs, the following requirements apply:\n-\tthe UE and the MME shall continue to use the current security context;\n-\tthe MME shall not initiate the EPS AKA procedure;\n-\tthe MME shall not release the NAS signalling connection; and\n-\tthe UE shall not perform a local release of the NAS signalling connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.4\tIntegrity protection of NAS signalling messages",
                            "text_content": "For the UE, integrity protected signalling is mandatory for the NAS messages once a valid EPS security context exists and has been taken into use. For the network, integrity protected signalling is mandatory for the NAS messages once a secure exchange of NAS messages has been established for the NAS signalling connection. Integrity protection of all NAS signalling messages is the responsibility of the NAS. It is the network which activates integrity protection.\nThe use of \"null integrity protection algorithm\" EIA0 (see clause 9.9.3.23) in the current security context is only allowed for an unauthenticated UE for which establishment of emergency bearer services or access to RLOS is allowed. For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the \"null integrity protection algorithm\" or any other integrity protection algorithm is indicated in the security context.\nIf the \"null integrity protection algorithm\" EIA0 has been selected as an integrity protection algorithm, the receiver shall regard the NAS messages with the security header indicating integrity protection as integrity protected.\nDetails of the integrity protection and verification of NAS signalling messages are specified in 3GPP TS 33.401 [19].\nWhen a NAS message needs to be sent both ciphered and integrity protected, the NAS message is first ciphered and then the ciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC. The same applies when an initial NAS message needs to be sent partially ciphered and integrity protected.\nNOTE:\tNAS messages that are ciphered or partially ciphered with the \"null ciphering algorithm\" EEA0 are regarded as ciphered or partially ciphered, respectively (see clause 4.4.5).\nWhen a NAS message needs to be sent only integrity protected and unciphered, the unciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC.\nWhen during the EPS attach procedure or service request procedure an ESM message is piggybacked in an EMM message, there is only one sequence number IE and one message authentication code IE, if any, for the combined NAS message.\nExcept the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the UE or forwarded to the ESM entity, unless the network has established secure exchange of NAS messages for the NAS signalling connection:\n-\tEMM messages:\n-\tIDENTITY REQUEST (if requested identification parameter is IMSI);\n-\tAUTHENTICATION REQUEST;\n-\tAUTHENTICATION REJECT;\n-\tATTACH REJECT (if the EMM cause is not #25 or #78);\n-\tDETACH ACCEPT (for non switch off);\n-\tTRACKING AREA UPDATE REJECT (if the EMM cause is not #25 or #78);\n-\tSERVICE REJECT (if the EMM cause is not #25 or #78).\nNOTE:\tThese messages are accepted by the UE without integrity protection, as in certain situations they are sent by the network before security can be activated.\nAll ESM messages are integrity protected.\nOnce the secure exchange of NAS messages has been established, the receiving EMM or ESM entity in the UE shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If NAS signalling messages, having not successfully passed the integrity check, are received, then the NAS in the UE shall discard that message. The processing of the SECURITY MODE COMMAND message that has not successfully passed the integrity check is specified in clause 5.4.3.5. If any NAS signalling message is received as not integrity protected even though the secure exchange of NAS messages has been established by the network, then the NAS shall discard this message.\nExcept the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the MME or forwarded to the ESM entity, unless the secure exchange of NAS messages has been established for the NAS signalling connection:\n-\tEMM messages:\n-\tATTACH REQUEST;\n-\tIDENTITY RESPONSE (if requested identification parameter is IMSI);\n-\tAUTHENTICATION RESPONSE;\n-\tAUTHENTICATION FAILURE;\n-\tSECURITY MODE REJECT;\n-\tDETACH REQUEST;\n-\tDETACH ACCEPT;\n-\tTRACKING AREA UPDATE REQUEST.\nNOTE 1:\tThe TRACKING AREA UPDATE REQUEST message is sent by the UE without integrity protection, if the tracking area updating procedure is initiated due to an inter-system change in idle mode and no current EPS security context is available in the UE. The other messages are accepted by the MME without integrity protection, as in certain situations they are sent by the UE before security can be activated.\nNOTE 2:\tThe DETACH REQUEST message can be sent by the UE without integrity protection, e.g. if the UE is attached for emergency bearer services or access to RLOS and there is no shared EPS security context available, or if due to user interaction an attach procedure is cancelled before the secure exchange of NAS messages has been established. For these cases the network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic tracking area updating or still responding to paging) before marking the UE as EMM-DEREGISTERED.\nAll ESM messages are integrity protected except a PDN CONNECTIVITY REQUEST message if it is sent piggybacked in ATTACH REQUEST message and NAS security is not activated.\nOnce a current EPS security context exists, until the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving EMM entity in the MME shall process the following NAS signalling messages, even if the MAC included in the message fails the integrity check or cannot be verified, as the EPS security context is not available in the network:\n-\tATTACH REQUEST;\n-\tIDENTITY RESPONSE (if requested identification parameter is IMSI);\n-\tAUTHENTICATION RESPONSE;\n-\tAUTHENTICATION FAILURE;\n-\tSECURITY MODE REJECT;\n-\tDETACH REQUEST;\n-\tDETACH ACCEPT;\n-\tTRACKING AREA UPDATE REQUEST;\n-\tSERVICE REQUEST;\n-\tEXTENDED SERVICE REQUEST;\n-\tCONTROL PLANE SERVICE REQUEST.\nNOTE 3:\tThese messages are processed by the MME even when the MAC that fails the integrity check or cannot be verified, as in certain situations they can be sent by the UE protected with an EPS security context that is no longer available in the network.\nIf an ATTACH REQUEST message is received without integrity protection or fails the integrity check and it is not an attach request for emergency bearer services and it is not an attach request for access to RLOS, the MME shall authenticate the subscriber before processing the attach request any further. Additionally, if the MME initiates a security mode control procedure, the MME shall include a HASHMME IE in the SECURITY MODE COMMAND message as specified in clause 5.4.3.2. If authentication procedure is not successful the MME shall maintain, if any, the EMM-context and EPS security context unchanged. For the case when the attach procedure is for emergency bearer services see clause 5.5.1.2.3 and clause 5.4.2.5.\nIf a DETACH REQUEST message fails the integrity check, the MME shall proceed as follows:\n-\tIf it is not a detach request due to switch off, and the MME can initiate an authentication procedure, the MME should authenticate the subscriber before processing the detach request any further.\n-\tIf it is a detach request due to switch off, or the MME does not initiate an authentication procedure for any other reason, the MME may ignore the detach request and remain in state EMM-REGISTERED.\nNOTE 4:\tThe network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic tracking area updating or still responding to paging) before marking the UE as EMM-DEREGISTERED.\nIf a TRACKING AREA UPDATE REQUEST message is received without integrity protection or fails the integrity check and the UE provided a nonceUE, GPRS ciphering key sequence number, P-TMSI and RAI in the TRACKING AREA UPDATE REQUEST message, the MME shall initiate a security mode control procedure to take a new mapped EPS security context into use; otherwise, if the UE has only a PDN connection for non-emergency bearer services established and the PDN connection is not for RLOS, the MME shall initiate an authentication procedure. Additionally, if the MME initiates a security mode control procedure, the MME shall include a HASHMME IE in the SECURITY MODE COMMAND message as specified in clause 5.4.3.2. If authentication procedure is not successful the MME shall maintain, if any, the EMM-context and EPS security context unchanged. For the case when the UE has a PDN connection for emergency bearer services or for RLOS see clause 5.5.3.2.3 and clause 5.4.2.5.\nIf a SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message fails the integrity check and the UE has only PDN connections for non-emergency bearer services established and the PDN connections are not for RLOS, the MME shall send the SERVICE REJECT message with EMM cause #9 \"UE identity cannot be derived by the network\" and keep the EMM-context and EPS security context unchanged. For the case when the UE has a PDN connection for emergency bearer services or RLOS and integrity check fails, the MME may skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in clause . After successful completion of the service request procedure, the network shall deactivate all non-emergency EPS bearers locally which are not EPS bearers for RLOS. The emergency EPS bearers shall not be deactivated. The network may deactivate the EPS bearers for RLOS.\nOnce the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving EMM or ESM entity in the MME shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If any NAS signalling message, having not successfully passed the integrity check, is received, then the NAS in the MME shall discard that message. If any NAS signalling message is received, as not integrity protected even though the secure exchange of NAS messages has been established, then the NAS shall discard this message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.5\tCiphering of NAS signalling messages",
                            "text_content": "The use of ciphering in a network is an operator option subject to MME configuration. When operation of the network without ciphering is configured, the MME shall indicate the use of \"null ciphering algorithm\" EEA0 (see clause 9.9.3.23) in the current security context for all UEs. For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the \"null ciphering algorithm\" or any other ciphering algorithm is indicated in the security context.\nWhen the UE establishes a new NAS signalling connection, it shall send the initial NAS message\n-\tpartially ciphered, if it is a CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element; and\n-\tunciphered, if it is any other initial NAS message.\nThe UE shall partially cipher the CONTROL PLANE SERVICE REQUEST message by ciphering the value part of the ESM message container IE or the value part of the NAS message container, using the ciphering algorithm of the current EPS security context.\nThe UE shall send the ATTACH REQUEST message always unciphered.\nThe UE shall send the TRACKING AREA UPDATE REQUEST message always unciphered.\nExcept for the CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element, the UE shall start the ciphering and deciphering of NAS messages when the secure exchange of NAS messages has been established for a NAS signalling connection. From this time onward, unless explicitly defined, the UE shall send all NAS messages ciphered until the NAS signalling connection is released, or the UE performs intersystem handover to A/Gb mode or Iu mode.\nThe MME shall start ciphering and deciphering of NAS messages as described in clause 4.4.2.3. From this time onward, except for the SECURITY MODE COMMAND message, the MME shall send all NAS messages ciphered until the NAS signalling connection is released, or the UE performs intersystem handover to A/Gb mode or Iu mode.\nOnce the encryption of NAS messages has been started between the MME and the UE, the receiver shall discard the unciphered NAS messages which shall have been ciphered according to the rules described in this specification. The MME shall discard any CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element which has not been partially ciphered according to the rules described above.\nIf the \"null ciphering algorithm\" EEA0 has been selected as a ciphering algorithm, the NAS messages with the security header indicating ciphering are regarded as ciphered.\nDetails of ciphering and deciphering of NAS signalling messages are specified in 3GPP TS 33.401 [19].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.5\tDisabling and re-enabling of UE's E-UTRA capability",
                    "description": "",
                    "summary": "",
                    "text_content": "The UE shall only disable the E-UTRA capability when in EMM-IDLE mode.\nWhen the UE supports both N1 mode and S1 mode then the UE's capability to access the 5GCN via E-UTRA shall not be affected, if the UE's E-UTRA capability is disabled or enabled.\nWhen the UE is disabling the E-UTRA capability not due to redirection to 5GCN required, it should proceed as follows:\na)\tselect another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [54]) of the registered PLMN or a PLMN from the list of equivalent PLMNs;\nb)\tif another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, or the UE does not have a registered PLMN, then perform PLMN selection as specified in 3GPP TS 23.122 [6]. As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN. If disabling of E-UTRA capability was not due to UE initiated detach procedure for EPS services only, the UE may re-enable the E-UTRA capability for this PLMN selection; or\nc)\tif no other allowed PLMN and RAT combinations are available, then the UE may re-enable the E-UTRA capability and remain registered for EPS services in E-UTRAN of the registered PLMN. If the UE chooses this option, then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. How this periodic scanning is done, is UE implementation dependent.\nWhen the UE is disabling the E-UTRA capability upon receiving reject cause #31 \"Redirection to 5GCN required\" as specified in clauses 5.5.1.2.5, 5.5.1.3.5, 5.5.3.2.5, 5.5.3.3.5 and 5.6.1.5, it should proceed as follows:\ni)\tIf the UE is in NB-S1 mode:\n1)\tif lower layers do not provide an indication that the current E-UTRA cell is connected to 5GCN or lower layers do not provide an indication that the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, search for a suitable NB-IoT cell connected to 5GCN according to 3GPP TS 36.304 [21];\n2)\tif lower layers provide an indication that the current E-UTRA cell is connected to 5GCN and the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE then perform a core network selection to select 5GCN as specified in 3GPP TS 24.501 [54] clause 4.8.4A.1; or\n3)\tif lower layers cannot find a suitable NB-IoT cell connected to 5GCN or there is no suitable NB-IoT cell connected to 5GCN which supports CIoT 5GS optimizations that are supported by the UE, the UE, as an implementation option, may indicate to lower layers to remain camped in E-UTRA cell connected to EPC, may then start an implementation-specific timer and enter the state EMM-REGISTERED.LIMITED-SERVICE the UE may re-enable the E-UTRA capability for 3GPP access at expiry of the implementation-specific timer, if the timer had been started, and may then, proceed with the appropriate EMM procedure.\nii)\tIf the UE is in WB-S1 mode:\n1)\tif lower layers do not provide an indication that the current E-UTRA cell is connected to 5GCN or lower layers do not provide an indication that the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, search for a suitable E-UTRA cell connected to 5GCN according to 3GPP TS 36.304 [21];\n2)\tif lower layers provide an indication that the current E-UTRA cell is connected to 5GCN and the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, then perform a core network selection to select 5GCN as specified in 3GPP TS 24.501 [54] clause 4.8.4A.1; or\n3)\tif lower layers cannot find a suitable E-UTRA cell connected to 5GCN or there is no suitable E-UTRA cell connected to 5GCN which supports CIoT 5GS optimizations that are supported by the UE, the UE, as an implementation option, may indicate to lower layers to remain camped in E-UTRA cell connected to EPC, may then start an implementation-specific timer and enter the state EMM-REGISTERED.LIMITED-SERVICE the UE may re-enable the E-UTRA capability for 3GPP access at expiry of the implementation-specific timer, if the timer had been started, and may then, proceed with the appropriate EMM procedure.\nThe UE shall re-enable the E-UTRA capability when performing a PLMN selection unless:\n-\tthe disabling of E-UTRA capability was due to UE initiated detach procedure for EPS services only; or\n-\tthe UE has already re-enabled the E-UTRA capability when performing bullets b) or c) above.\nIf due to handover, the UE moves to a new PLMN in A/Gb, Iu, or N1 mode which is not in the list of equivalent PLMNs and not a PLMN memorized by the UE for which E-UTRA capability was disabled, and the disabling of E-UTRA capability was not due to UE initiated detach procedure for EPS services only, the UE shall re-enable the E-UTRA capability after the RR/RRC connection is released.\nIf UE that has disabled its E-UTRA capability due to IMS voice not available and CS fallback not available re-enables it when PLMN selection is performed, then it should memorize the identity of the PLMNs where E-UTRA capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 [6].\nThe UE may support \"E-UTRA Disabling for EMM cause #15\" and implement the following behaviour:\n-\tif the \"E-UTRA Disabling Allowed for EMM cause #15\" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; and\n-\tif the UE receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message including both EMM cause #15 \"no suitable cells in tracking area\" and an Extended EMM cause IE with value \"E-UTRAN not allowed\";\nthen the UE shall disable the E-UTRA capability, memorize the identity of the PLMN where the E-UTRA capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 [6].\nWhen the UE supporting the A/Gb and/or Iu mode together with the S1 mode needs to stay in A/Gb or Iu mode, in order to prevent unwanted handover or cell reselection from UTRAN/GERAN to E-UTRAN, the UE shall disable the E-UTRA capability and:\n-\tThe UE shall not set the E-UTRA support bits of the MS Radio Access capability IE (see 3GPP TS 24.008 [13], clause 10.5.5.12a), the E-UTRA support bits of Mobile Station Classmark 3 IE (see 3GPP TS 24.008 [13], clause 10.5.1.7), the PS inter-RAT HO from GERAN to E-UTRAN S1 mode capability bit and the ISR support bit of the MS network capability IE (see 3GPP TS 24.008 [13], clause 10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message after it selects GERAN or UTRAN;\n-\tthe UE shall use the same value of the EPC capability bit of the MS network capability IE (see 3GPP TS 24.008 [13], clause 10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message; and\n-\tthe UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability.\nWhen the UE supporting N1 mode together with S1 mode needs to stay in N1 mode, in order to prevent unwanted handover or cell reselection from NG-RAN to E-UTRAN, the UE shall disable the E-UTRA capability and:\n-\tthe UE shall set the S1 mode bit to \"S1 mode not supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message (see 3GPP TS 24.501 [54]);\n-\tthe UE shall not include the S1 UE network capability IE in the REGISTRATION REQUEST message (see 3GPP TS 24.501 [54]); and\n-\tthe UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability.\nIf the UE is disabling its E-UTRA capability before selecting to GERAN, UTRAN or NG-RAN radio access technology, the UE shall not perform the detach procedure of clause 5.5.2.1.\nIf the UE is required to disable the E-UTRA capability and select GERAN, UTRAN or NG-RAN radio access technology, and the UE is in the EMM-CONNECTED mode:\n-\tif the UE has a persistent EPS bearer context and the ongoing procedure is not a detach procedure, then the UE shall wait until the radio bearer associated with the persistent EPS bearer context has been released;\n-\totherwise, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN, UTRAN or NG-RAN radio access technology.\nIf the E-UTRA capability was disabled due to the attempt to select GERAN or UTRAN radio access technology progressing the CS emergency call establishment (see clause 4.3.1), the criteria to enable the E-UTRA capability again is UE implementation specific.\nIf the E-UTRA capability was disabled due to the UE initiated detach procedure for EPS services only (see clause 5.5.2.2.2), upon request of the upper layers to re-attach for EPS services the UE shall enable the E-UTRA capability again. If the E-UTRA capability was disabled due to receipt of EMM cause #14 \"EPS services not allowed in this PLMN\", then the UE shall enable the E-UTRA capability when the UE powers off and powers on again or the USIM is removed. If E-UTRA capability was disabled for any other reason, the UE shall enable the E-UTRA capability in the following cases:\n-\tthe UE mode of operation changes from CS/PS mode 1 of operation to CS/PS mode 2 of operation;\n-\tthe UE mode of operation changes from PS mode 1 of operation to PS mode 2 of operation; or\n-\tthe UE powers off and powers on again or the USIM is removed;\nAs an implementation option, the UE may start a timer for enabling E-UTRA when the UE's attach attempt counter or tracking area updating attempt counter reaches 5 and the UE disables E-UTRA capability for cases described in clauses 5.5.1.2.6, 5.5.1.3.4.3, 5.5.1.3.6, 5.5.3.2.6, 5.5.3.3.4.3 and 5.5.3.3.6. The UE should memorize the identity of the PLMNs where E-UTRA capability was disabled. On expiry of this timer:\n-\tif the UE is in Iu mode or A/Gb mode and is in idle mode as specified in 3GPP TS 24.008 [13], the UE should enable the E-UTRA capability;\n-\tif the UE is in Iu mode or A/Gb mode and an RR connection exists, the UE shall delay enabling E-UTRA capability until the RR connection is released;\n-\tif the UE is in Iu mode and a PS signalling connection exists but no RR connection exists, the UE may abort the PS signalling connection before enabling E-UTRA capability; or\n-\tif the UE is in N1 mode and is in 5GMM-IDLE mode as specified in 3GPP TS 24.501 [54], the UE should enable the E-UTRA capability; and\n-\tif the UE is in N1 mode and is in 5GMM-CONNECTED mode as specified in 3GPP TS 24.501 [54], the UE shall delay enabling the E-UTRA capability until the N1 NAS signalling connection is released.\nWhen the UE enables E-UTRA capability, the UE shall delete the PLMN from the memorized identity of the PLMNs where E-UTRA capability was disabled.\nNOTE 1:\tAs described 3GPP TS 23.122 [6], if the UE is in automatic PLMN selection mode, the UE does not consider the memorized PLMNs as PLMN selection candidates for E-UTRA access technology till the timer expires.\nIf the UE attempts to establish an emergency bearer service or to access RLOS in a PLMN where the E-UTRA capability was disabled due to the UE's attach attempt counter or tracking area updating attempt counter have reached 5, the UE may enable the E-UTRA capability for that PLMN memorized by the UE.\nThe UE may support being configured for No E-UTRA Disabling In 5GS (see 3GPP TS 24.368 [50] or 3GPP TS 31.102 [17]). If the UE supports being configured for No E-UTRA Disabling in 5GS, No E-UTRA Disabling In 5GS is enabled if the corresponding configuration parameter is present and set to enabled. Otherwise, No E-UTRA Disabling In 5GS is disabled. If No E-UTRA Disabling In 5GS is enabled at the UE and the UE selects an NG-RAN cell in a PLMN where the E-UTRA capability was disabled due to the UE's attach attempt counter or tracking area updating attempt counter having reached 5, the UE shall enable the E-UTRA capability for that PLMN.\nFor other cases, it is up to the UE implementation when to enable the E-UTRA capability.\nNOTE 2:\tIf the UE is not operating in CS/PS mode 1 operation, the value of the timer for enabling E-UTRA capability is recommended to be not larger than the default value of T3402.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.6\tApplicability of procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.6.1\tRelay nodes",
                            "text_content": "A relay node shall support all procedures that are mandatory for a UE supporting S1 mode only.\nThere is also functionality which is only applicable to a relay node, in which case the specification uses the term \"relay node\" instead of \"UE\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.7\tEPS mobility management and EPS session management in NB-S1 mode",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE in NB-S1 mode (see 3GPP TS 36.331 [22]) shall calculate the value of the applicable NAS timer:\n-\tindicated in table 10.2.1 plus 240s; and\n-\tindicated in table 10.3.1 plus 180s.\nThe timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.\nWhen an MME that supports NB-S1 mode performs NAS signalling with a UE, which is using NB-S1 mode, the MME shall calculate the value of the applicable NAS timer:\n-\tindicated in table 10.2.2 plus 240s; and\n-\tindicated in table 10.3.2 plus 180s.\nThe timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.\nNOTE 1:\tIf the tracking area updating procedure is initiated in EMM-CONNECTED mode, the MME can stop any running implementation specific supervision timer if it is started when sending an ESM DATA TRANSPORT message to the UE.\nNOTE 2:\tAs NB-S1 mode includes the case when satellite access is used in EPS, the values for applicable NAS timers specified in this clause apply also for satellite access.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.8\tEPS mobility management and EPS session management in WB-S1 mode for IoT",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.8.1\tUE not using satellite E-UTRAN access",
                            "text_content": "In WB-S1 mode, a UE operating in category CE can operate in either CE mode A or CE mode B (see 3GPP TS 36.306 [44]). If a UE that supports CE mode B and operates in WB-S1 mode not using satellite E-UTRAN access, the UE's usage setting is not set to \"voice centric\" (see 3GPP TS 23.401 [10]), and\na)\tthe use of enhanced coverage is not restricted for the UE; or\nb)\tCE mode B is not restricted for the UE (see 3GPP TS 23.401 [10]);\nthe UE shall apply the value of the applicable NAS timer indicated in tables 10.2.1 and indicated in table 10.3.1 for WB-S1/CE mode.\nA UE that supports CE mode B and operates in WB-S1 mode not using satellite E-UTRAN access shall not apply the value of the applicable NAS timer indicated in table 10.2.1 and table 10.3.1 for WB-S1/CE mode before receiving an indication from the network that the use of enhanced coverage is not restricted as described in this clause.\nThe NAS timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure, and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\nThe support of CE mode B by a UE is indicated to the MME by lower layers and shall be stored by the MME. When an MME that supports WB-S1 mode performs NAS signalling with a UE not using satellite E-UTRAN access, which supports CE mode B and operates in WB-S1 mode and the MME determines that:\na)\tthe use of enhanced coverage is not restricted for the UE; or\nb)\tCE mode B is not restricted for the UE (see 3GPP TS 23.401 [10]);\nthe MME shall calculate the value of the applicable NAS timer indicated in tables 10.2.2 and indicated in table 10.3.2 for WB-S1/CE mode.\nThe NAS timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.8.2\tUE using satellite E-UTRAN access",
                            "text_content": "In WB-S1 mode via satellite E-UTRAN access, the UE shall apply the value of the applicable NAS timer indicated in tables 10.2.1 and indicated in table 10.3.1 for WB-S1/CE mode.\nThe NAS timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\nWhen an MME that supports WB-S1 mode performs NAS signalling with a UE via satellite E-UTRAN access, the MME shall calculate the value of the applicable NAS timer indicated in tables 10.2.2 and indicated in table 10.3.2 for WB-S1/CE mode.\nThe NAS timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\nNOTE:\tWhen using satellite E-UTRAN access, the restriction on use of enhanced coverage indication from the network is not considered when applicable NAS timers are determined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.9\tDisabling and re-enabling of UE's NB-IoT capability",
                    "description": "",
                    "summary": "",
                    "text_content": "If the UE supports disabling and re-enabling of UE's NB-IoT capability and the UE in NB-S1 mode is disabling the NB-IoT capability, it should proceed as follows:\na)\tselect E-UTRAN, or for the UE which supports CIoT EPS optimization select satellite E-UTRAN via \"WB-E-UTRAN(LEO)\", \"WB-E-UTRAN(MEO)\", or \"WB-E-UTRAN(GEO)\", of the registered PLMN or a PLMN from the list of equivalent PLMNs;\nb)\tif E-UTRAN, or for the UE which supports CIoT EPS optimization if satellite E-UTRAN via \"WB-E-UTRAN(LEO)\", \"WB-E-UTRAN(MEO)\", or \"WB-E-UTRAN(GEO)\", of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, select another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [54]) of the registered PLMN or a PLMN from the list of equivalent PLMNs;\nc)\tif another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, or the UE does not have a registered PLMN, then perform PLMN selection as specified in 3GPP TS 23.122 [6]. As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN; or\nd)\tif no other allowed PLMN and RAT combinations are available, then the UE may re-enable the NB-IoT capability and remain registered for EPS services in NB-IoT of the registered PLMN. If the UE chooses this option, then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. How this periodic scanning is done, is UE implementation dependent.\nIf the NB-IoT capability is disabled, the UE shall re-enable the NB-IoT capability when:\n-\tperforming a PLMN selection unless the UE has already re-enabled the NB-IoT capability when performing bullet c) or d) above; or\n-\tthe UE powers off and powers on again or the USIM is removed.\nIf the UE in NB-S1 mode receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message including both EMM cause #15 \"no suitable cells in tracking area\" and an Extended EMM cause IE with value \"NB-IoT not allowed\" after the UE requests access to the NB-IoT, in order to prevent unwanted cell reselection from GERAN, UTRAN, E-UTRAN or NG-RAN to NB-IoT, the UE may:\n-\tdisable the NB-IoT capability:\n-\tindicate the access stratum layer(s) of disabling of the NB-IoT capability; and\n-\tmemorize the identity of the PLMN where the NB-IoT capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 [6].\nNOTE:\tThe UE can only disable the NB-IoT capability when in EMM-IDLE mode.\nIf the UE in NB-S1 mode is required to disable the NB-IoT capability and select E-UTRAN radio access technology, and the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting E-UTRAN radio access technology.\nAs an implementation option, the UE may start a timer for enabling the NB-IoT capability. On expiry of this timer, the UE may enable the NB-IoT capability.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.10\tSupport of MUSIM features",
                    "description": "",
                    "summary": "",
                    "text_content": "A network and a MUSIM UE may support one or more of the MUSIM features (i.e. the NAS signalling connection release, the paging indication for voice services, the reject paging request, the paging restriction and the paging timing collision control).\nIf MUSIM UE supports one or more MUSIM features, the UE indicates support of one or more MUSIM features during the attach procedure and the normal tracking area updating procedure. If the UE has indicated support of the NAS signalling connection release or the reject paging request or both and the UE supports the paging restriction, the UE indicates support of the paging restriction.\nIf the UE indicates support of one or more MUSIM features and the network decides to accept one or more MUSIM features, the network indicates the support of one or more MUSIM features during the attach procedure and the normal tracking area updating procedure. The network only indicates the support of the paging restriction together with the support of either NAS signalling connection release or the reject paging request.\nThe network does not indicate support for any MUSIM feature to the UE during the attach for emergency bearer services.\nIf a UE stops fulfilling the condition to be considered a MUSIM UE as defined in subclause 3.1, and the UE has negotiated support of one or more MUSIM features, then the UE shall initiate a normal tracking area update procedure to indicate that all the MUSIM features are not supported as specified in clause 5.5.3.2.\nA MUSIM UE operating in NB-S1 mode or in WB-S1 mode CE mode B does not indicate the support for paging indication for voice services during the attach procedure or the normal tracking area update procedure towards the network.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.11\tSatellite access for CIoT",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.11.1\tGeneral",
                            "text_content": "The UE and the network may support a satellite E-UTRAN access in WB-S1 mode or NB-S1 mode with CIoT EPS optimization. Support for satellite E-UTRAN access is specified in 3GPP TS 36.300 [20].\nAn MME can determine a UE is accessing the network using a satellite E-UTRAN access and may enforce mobility restriction for the UE as specified in 3GPP TS 23.401 [10].\nIf unavailability period is activated due to discontinuous coverage (see 3GPP TS 23.401 [10]), all NAS timers are stopped and associated procedures aborted except for T3412, T3346, T3396, T3447, T3448, any backoff timers, T3245, T3247, the timer T controlling the periodic search for HPLMN or EHPLMN (if EHPLMN list is present) or higher prioritized PLMNs, and the timer TSENSE controlling the periodic search for PLMNs satisfying the operator controlled signal level threshold (see 3GPP TS 23.122 [6]) and the UE may deactivate access stratum.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.11.2\tHandling list of \"PLMNs not allowed to operate at the present UE location\"",
                            "text_content": "The UE may be rejected with EMM cause #78 in ATTACH REJECT message, TRACKING AREA UPDATE REJECT message or DETACH REQUEST message. The EMM cause #78 is applicable for the UE only when the UE is accessing a PLMN using a satellite E-UTRAN access.\nFor the satellite E-UTRAN access the UE shall store a list of \"PLMN not allowed to operate at the present UE location\". Each entry in the list consists of:\na)\tPLMN identity of the PLMN which sent a message including EMM cause value #78 \"PLMN not allowed to operate at the present UE location\" via the satellite E-UTRAN access technology;\nb)\tgeographical location, if known by the UE, where the EMM cause value #78 was received over the satellite E-UTRAN access technology; and\nc)\tif the geographical location exists, a UE implementation specific distance value.\nBefore storing a new entry in the list, the UE shall delete any existing entry with the same PLMN identity. Upon storing a new entry, the UE starts a timer instance associated with the entry with an implementation specific value that shall not be set to a value smaller than the timer value indicated by the network in the Lower bound timer value IE, if any. If the Lower bound timer value IE was not provided by the network, the value of the timer shall be set based on the UE implementation. An entry in the list is deleted if the timer associated to the entry expires or the UE successfully registers to the PLMN stored in the entry.\nThe UE is allowed to attempt to access a PLMN via the satellite E-UTRAN access technology which is part of the list of \"PLMNs not allowed to operate at the present UE location\" if:\na)\tthe current UE location is known, a geographical location is stored for the entry of this PLMN, and the distance from location where EMM cause value #78 was received to the current UE location is larger than a UE implementation specific value; or\nb)\tthe access is for emergency services (see 3GPP TS 23.122 [5] for further details).\nNOTE:\tWhen the UE is accessing network for emergency services, it is up to operator and regulatory policies whether the network needs to determine if the UE is in a location where network is not allowed to operate.\nThe list shall accommodate three or more entries. The maximum number of entries is an implementation decision. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.\nEach entry shall be removed if for the entry:\na)\tthe UE successfully registers via the satellite E-UTRAN access technology to the PLMN stored in the entry except when the UE is attached for emergency bearer services; or\nb)\tthe timer instance associated with the entry expires.\nThe UE may remove an entry in the list, if the UE's current location is known, a geographical is stored for the entry of this PLMN, and the distance from location where EMM cause value #78 was received to the current UE location is larger than the UE implementation specific value.\nIf the UE is in EMM-DEREGISTERED.LIMITED-SERVICE state and an entry from the list of \"PLMNs not allowed to operate at the present UE location\" is removed, the UE shall perform PLMN selection according to 3GPP TS 23.122 [6].\nWhen the UE is switched off, the UE shall keep the list of \"PLMNs not allowed to operate at the present UE location\" in its non-volatile memory together with the SUPI from the USIM. The UE shall delete the list of \"PLMNs not allowed to operate at the present UE location\" if the USIM is removed.\nIf the UE is switched off when the timer instance associated with the entry in the list is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:\nlet t1 be the time remaining for timer instance associated with the entry in the list to timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted and considered expired. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.11.3\tHandling multiple tracking area codes from the lower layers",
                            "text_content": "When a UE camps on a satellite E-UTRAN cell, the UE may receive multiple TACs from the lower layers. The UE shall construct TAIs from the multiple TACs (i.e. concatenate the identity of the current PLMN and each of the TACs) and select a TAI as follows:\na)\tif at least one TAI belongs to the TAI list of the UE, the UE shall select a TAI which belongs to the TAI list. If there are multiple TAIs which belong to the TAI list the UE shall consider each of these TAIs equal and:\n-\tif the UE can determine a TAI which represents the best the tracking area of the UE's geographical location, the UE shall select a TAI which represents the best the tracking area of the UE's geographical location; and\n-\totherwise, the UE shall select a TAI in an implementation-specific way.\nb)\tif no TAI belongs to the TAI list of the UE and:\n1)\tthere is a TAI which belongs to neither the list of \"forbidden tracking areas for roaming\" nor the list of \"forbidden tracking areas for regional provision of service\", the UE shall select a TAI which belongs to neither the list of \"forbidden tracking areas for roaming\" nor the list of \"forbidden tracking areas for regional provision of service\". In this case, if there are multiple TAIs which belong to neither the list of \"forbidden tracking areas for roaming\" nor the list of \"forbidden tracking areas for regional provision of service\", then the UE shall consider each of these TAIs equal and:\n-\tif the UE can determine a TAI which represents the best the tracking area of the UE's geographical location, the UE shall select a TAI which represents the best the tracking area of the UE's geographical location; and\n-\totherwise, the UE shall select a TAI in an implementation-specific way.\n2)\tall TAIs belong to the list of \"forbidden tracking areas for roaming\" or the list of \"forbidden tracking areas for regional provision of service\", then the UE shall consider each of these TAIs equal and:\n-\tif the UE can determine a TAI which represents the best the tracking area of the UE's geographical location, the UE shall select a TAI which represents the best the tracking area of the UE's geographical location; and\n-\totherwise, the UE shall select a TAI in an implementation-specific way.\nThe UE shall consider the selected TAI as the current TAI. The UE shall select a TAI as described above when:\na)\tthe UE receives multiple TACs from the lower layers; or\nb)\tthe UE has received multiple TACs from the lower layers upon starting to camping on the current cell and the TAI list, the list of \"forbidden tracking areas for roaming\", or the list of \"forbidden tracking areas for regional provision of service\" is updated.\nHandling of the list of \"forbidden tracking areas for roaming\" and the list of \"forbidden tracking areas for regional provision of service\" is specified in clause 5.3.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.11.4\tSupport for enhanced discontinuous coverage",
                            "text_content": "If the UE and network support enhanced discontinuous coverage, the UE may provide unavailability information to the network in the tracking area updating procedure if the UE is registered over satellite E-UTRAN access (see 3GPP TS 23.401 [10]). The unavailability information includes the unavailability period duration if known, and the start of the unavailability period if known. The support for the enhanced discontinuous coverage is negotiated in the attach procedure or the tracking area updating procedure. The MME may consider the unavailability period duration if provided by the UE to determine the unavailability period duration of the UE. The MME may provide the unavailability period duration to the UE in the TRACKING AREA UPDATE ACCEPT message. The MME may consider the unavailability period duration if provided by the UE to determine the unavailability period duration of the UE.\nIf the UE provided unavailability information in the last tracking area updating procedure, the MME considers the UE unreachable until the UE registers for normal service without providing unavailability information. If the UE did not include a start of the unavailability period, the MME shall consider the start of the unavailability period to be the time at which MME received the TRACKING AREA UPDATE REQUEST message to the UE. The MME may determine the value of the periodic tracking area update timer (T3412) provided to the UE based on the unavailability period duration and the start of the unavailability period, if available. The MME releases the NAS signalling connection after the completion of the attach procedure or the tracking area updating procedure in which the UE provided unavailability information.\nIf for discontinuous coverage the UE has stored a discontinuous coverage maximum time offset, upon returning in coverage after being out of coverage due to discontinuous coverage, the UE sets the discontinuous coverage maximum time offset value to a random value up to and including the stored discontinuous coverage maximum time offset for this PLMN and satellite E-UTRAN access and starts this timer. The UE shall not initiate any NAS signalling on that satellite E-UTRAN access and PLMN combination while the discontinuous coverage maximum time offset timer is running. The UE shall stop the discontinuous coverage maximum time offset timer and initiate NAS signalling if the UE receives a paging message, has pending emergency services, is establishing an emergency PDN connection, is performing emergency services fallback procedure or when the UE enters a new tracking area.\nWhen the unavailability period is activated, all NAS timers are stopped and associated procedures aborted except for timers T3412, T3346, T3447, T3396, any back-off timers, T3247, and the timer T controlling the periodic search for HPLMN or EHPLMN or higher prioritized PLMNs (see 3GPP TS 23.122 [6]).\nWhen the UE provides unavailability information using the tracking area updating procedure without providing the start of the unavailability period, then after successful completion of the procedure the UE may deactivate the access stratum and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE. Otherwise, if the UE provided the start of unavailability period, the UE may deactivate the access stratum and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE only after the start of the unavailability period.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "5\tElementary procedures for EPS mobility management",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.1.1\tGeneral",
                            "text_content": "This clause describes the procedures used for mobility management for EPS services (EMM) at the radio interface (reference point \"LTE-Uu\").\nThe main function of the mobility management sublayer is to support the mobility of a user equipment, such as informing the network of its present location and providing user identity confidentiality.\nA further function of the mobility management sublayer is to provide connection management services to the session management (SM) sublayer and the short message services (SMS) entity of the connection management (CM) sublayer.\nAll the EMM procedures described in this clause can only be performed if a NAS signalling connection has been established between the UE and the network. Else, the EMM sublayer has to initiate the establishment of a NAS signalling connection (see 3GPP TS 36.331 [22]).\nNOTE:\tIn a satellite E-UTRAN access, a GNSS fix time in lower layers can delay transmission of an initial UL NAS message by up to 100 seconds (GNSS cold state).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2\tTypes of EMM procedures",
                            "text_content": "Depending on how they can be initiated, three types of EMM procedures can be distinguished:\n1)\tEMM common procedures:\nAn EMM common procedure can always be initiated whilst a NAS signalling connection exists. The procedures belonging to this type are:\nInitiated by the network:\n-\tGUTI reallocation;\n-\tauthentication;\n-\tsecurity mode control;\n-\tidentification;\n-\tEMM information.\n2)\tEMM specific procedures:\nAt any time only one UE initiated EMM specific procedure can be running. The procedures belonging to this type are:\nInitiated by the UE and used to attach the IMSI in the network for EPS services and/or non-EPS services, and to establish an EMM context and if requested by the UE, a default bearer:\n-\tattach and combined attach.\nInitiated by the UE and used to attach the IMSI or IMEI for emergency bearer services, and to establish an EMM context and a default bearer to a PDN that provides emergency bearer services:\n-\tattach.\nInitiated by the UE and used to attach the IMSI or IMEI for access to RLOS, and to establish an EMM context and a default bearer to a PDN connection for RLOS:\n-\tattach.\nInitiated by the UE or the network and used to detach the IMSI in the network for EPS services and/or non-EPS services and to release an EMM context and all bearers, if any:\n-\tdetach and combined detach.\nInitiated by the UE and used to detach the IMSI in the network for EPS services or non-EPS services and to release an EMM context and all bearers, if any:\n-\teCall inactivity procedure.\nInitiated by the UE when an EMM context has been established:\n-\tnormal tracking area updating and combined tracking area updating (S1 mode only);\n-\tperiodic tracking area updating (S1 mode only).\nThe tracking area updating procedure can be used to request also the resource reservation for sending data.\n3)\tEMM connection management procedures (S1 mode only):\nInitiated by the UE and used to establish a secure connection to the network or to request the resource reservation for sending data, or both:\n-\tservice request.\nThe service request procedure can only be initiated if no UE initiated EMM specific procedure is ongoing.\nInitiated by the network and used to request the establishment of a NAS signalling connection or to prompt the UE to re-attach if necessary as a result of a network failure:\n-\tpaging procedure.\nInitiated by the UE or the network and used to transport NAS messages:\n-\ttransport of NAS messages;\n-\tgeneric transport of NAS messages.\nThe transport of NAS messages procedure and the generic transport of NAS messages procedure cannot be initiated while an EMM specific procedure or a service request procedure is ongoing.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.3\tEMM sublayer states",
                            "text_content": "In the following clauses, the EMM protocol of the UE and the network is described by means of two different state machines. In clause 5.1.3.2, the states of the EMM entity in the UE are introduced. The behaviour of the UE depends on an EPS update status that is described in clause 5.1.3.3. The states for the MME side are described in clause 5.1.3.4.\nIn the following clauses, the possible EMM states of an EMM entity in the UE are described. Clause 5.1.3.2.2 summarizes the main states of an EMM entity. The substates that have been defined are described in clause 5.1.3.2.3 and clause 5.1.3.2.4.\nIt should be noted, however, that this clause does not include a description of the detailed behaviour of the UE in the single states and does not cover abnormal cases. A detailed description of the behaviour of the UE is given in clause 5.2. For the behaviour of the UE in abnormal cases refer to the description of the elementary EMM procedures in clauses 5.4, 5.5, 5.6 and 5.7.\nEPS services are disabled in the UE. No EPS mobility management function shall be performed in this state.\nIn the state EMM-DEREGISTERED, no EMM context has been established and the UE location is unknown to an MME and hence it is unreachable by an MME. In order to establish an EMM context, the UE shall start the attach or combined attach procedure (see clause 5.5.1).\nA UE enters the state EMM-REGISTERED-INITIATED after it has started the attach or the combined attach procedure and is waiting for a response from the MME (see clause 5.5.1).\nIn the state EMM-REGISTERED an EMM context has been established. Additionally a default EPS bearer context has been activated in the UE:\n-\tif EMM-REGISTERED without PDN connection is not supported by the UE or the MME; or\n-\tif EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE has requested connectivity to a PDN and a default EPS bearer context is successfully established.\nWhen the UE is in EMM-IDLE mode, the UE location is known to the MME with an accuracy of a list of tracking areas containing a certain number of tracking areas. When the UE is in EMM-CONNECTED mode, the UE location is known to the MME with an accuracy of a serving eNodeB. The UE may initiate sending and receiving user data and signalling information and reply to paging. Additionally, tracking area updating or combined tracking area updating procedure is performed (see clause 5.5.3).\nA UE enters the state EMM-DEREGISTERED-INITIATED after it has requested release of the EMM context by starting the detach or combined detach procedure and is waiting for a response from the MME (see clause 5.5.2).\nA UE enters the state EMM-TRACKING-AREA-UPDATING-INITIATED after it has started the tracking area updating or combined tracking area updating procedure and is waiting for a response from the MME (see clause 5.5.3).\nA UE enters the state EMM-SERVICE-REQUEST-INITIATED after it has started the service request procedure and is waiting for a response from the MME (see clause 5.6.1).\nThe figure depicts a simplified representation of a 5G network signal path, illustrating the various paths through which signals can propagate. It highlights the importance of beamforming techniques to mitigate interference and the use of redundancy paths to ensure reliability. The figure is a schematic representation, not a detailed diagram, and does not include all possible transitions.\nNOTE:\tNot all possible transitions are shown in this figure.\n\nFigure 5.1.3.2.2.7.1: EMM main states in the UE\nThe state EMM-DEREGISTERED is subdivided into a number of substates as described in this clause. Valid subscriber data are available for the UE before it enters the substates, except for the substate EMM-DEREGISTERED.NO-IMSI.\nThe substate EMM-DEREGISTERED.NORMAL-SERVICE is chosen in the UE when a suitable cell has been found and the PLMN or tracking area is not in the forbidden list.\nThe substate EMM-DEREGISTERED.LIMITED-SERVICE is chosen in the UE, when it is known that a selected cell is unable to provide normal service (e.g. the selected cell is in a forbidden PLMN, is in a forbidden tracking area or the selected cell is a CSG cell whose CSG ID and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG List).\nThe substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH is chosen in the UE if the attach or combined attach procedure failed due to a missing response from the network or due to the circumstances described in clauses 5.5.1.2.5, 5.5.1.2.6, 5.5.1.3.5 and 5.5.2.3.4.\nThe substate EMM-DEREGISTERED.PLMN-SEARCH is chosen in the UE, if the UE is searching for PLMNs. This substate is left either when a cell has been selected (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) or when it has been concluded that no cell is available at the moment (the new substate is NO-CELL-AVAILABLE).\nThe substate EMM-DEREGISTERED.NO-IMSI is chosen in the UE, if the UE has no valid subscriber data available (SIM/USIM not available, or the SIM/USIM is considered invalid by the UE) and a cell has been selected.\nValid subscriber data are available for the UE and for some reason an attach must be performed as soon as possible. This substate can be entered if the access class is blocked due to access class control, or if the network rejects the NAS signalling connection establishment.\nNo E-UTRAN cell can be selected. This substate is entered either after a first intensive search failed when in substate EMM-DEREGISTERED.PLMN-SEARCH or while the access stratum is de-activated due to discontinuous coverage (see 3GPP TS 23.401 [10]). Cells are searched for at a low rhythm. No EPS services are offered.\nThe substate EMM-DEREGISTERED.eCALL-INACTIVE is chosen in the UE when:\n-\tthe UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17];\n-\ttimer T3444 and timer T3445 have expired or are not running;\n-\ta PLMN has been selected as specified in 3GPP TS 23.122 [6];\n-\tthe UE does not need to perform an eCall over IMS; and\n-\tthe UE does not need to perform a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.\nIn this substate, the UE shall not initiate any signalling towards the network, except to originate an eCall over IMS, or a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.\nThe state EMM-REGISTERED is subdivided into a number of substates as described in this clause.\nThe substate EMM-REGISTERED.NORMAL-SERVICE is chosen by the UE as the primary substate when the UE enters the state EMM-REGISTERED.\nThe substate EMM-REGISTERED.ATTEMPTING-TO-UPDATE is chosen by the UE if the tracking area updating or combined tracking area updating procedure failed due to a missing response from the network or due to the circumstances described in clauses 5.3.9, 5.5.3.2.5, 5.5.3.2.6, 5.5.3.3.5, 5.6.1.5 and 5.6.1.6. No EMM procedure except the tracking area updating or combined tracking area updating procedure shall be initiated by the UE in this substate. No data shall be sent or received.\nThe substate EMM-REGISTERED.LIMITED-SERVICE is chosen in the UE, if the cell the UE selected is known not to be able to provide normal service.\nThe substate EMM-REGISTERED.PLMN-SEARCH is chosen in the UE, while the UE is searching for PLMNs.\nThe UE has to perform a tracking area updating or combined tracking area updating procedure, but access to the current cell is barred. This state can be entered if the access class is blocked due to access class control, or if the network rejects the NAS signalling connection establishment.\nNo EMM procedure except:\n-\ttracking area updating;\n-\tcombined tracking area updating; or\n-\tservice request as a response to paging\nshall be initiated by the UE in this substate.\nE-UTRAN coverage has been lost, PSM is active in the UE or the access stratum is de-activated due to discontinuous coverage (see 3GPP TS 23.401 [10]). If PSM is active, the UE can deactivate PSM at any time by activating the AS layer when the UE needs to send mobile originated signalling or user data. Otherwise, the UE shall not initiate any EMM procedure except for cell and PLMN reselection.\nA combined attach procedure or a combined tracking area updating procedure was successful for EPS services only. User data and signalling information may be sent and received.\nThe UE performs a combined detach procedure for non-EPS services only (detach type \"IMSI detach\"). This substate is entered if the UE is attached for EPS and non-EPS services and wants to detach for non-EPS services only. User data and signalling information may be sent and received.\nIn order to describe the detailed UE behaviour, the EPS update (EU) status pertaining to a specific subscriber is defined.\nThe EPS update status is stored in a non-volatile memory in the USIM if the corresponding file is present in the USIM, else in the non-volatile memory in the ME, as described in annex C.\nThe EPS update status value is changed only after the execution of an attach or combined attach, network initiated detach, authentication, tracking area update or combined tracking area update, service request or paging for EPS services using IMSI procedure or due to change in TAI which is not part of TAI list while timer T3346 is running.\nEU1: UPDATED\nThe last attach or tracking area updating attempt was successful.\nEU2: NOT UPDATED\nThe last attach, service request or tracking area updating attempt failed procedurally, e.g. no response or reject message was received from the MME.\nEU3: ROAMING NOT ALLOWED\nThe last attach, service request or tracking area updating attempt was correctly performed, but the answer from the MME was negative (because of roaming or subscription restrictions).\nIn the state EMM-DEREGISTERED, the MME has no EMM context or the EMM Context is marked as detached. The UE is detached. The MME may answer to an attach or a combined attach procedure initiated by the UE (see clause 5.5.1). The MME may also answer to a tracking area updating procedure or combined tracking area updating procedure initiated by a UE if the EMM context is marked as detached. The MME may also answer to a detach procedure initiated by the UE (see clause 5.5.1.2.7).\nIf ISR is not activated or ISR is deactivated during a routing area updating or combined routing area updating procedure or an inter-system handover to A/Gb mode or Iu mode, the MME enters the state EMM-DEREGISTERED after the successful completion of the procedure.\nThe MME enters the state EMM-COMMON-PROCEDURE-INITIATED, after it has started a common EMM procedure (see clause 5.4) and is waiting for a response from the UE.\nIn the state EMM-REGISTERED, an EMM context has been established. Additionally a default EPS bearer context has been activated in the MME:\n-\tif EMM-REGISTERED without PDN connection is not supported by the UE or the MME; or\n-\tif EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE has requested connectivity to a PDN and a default EPS bearer context is successfully established.\nThe MME enters the state EMM-DEREGISTERED-INITIATED after it has started a detach procedure and is waiting for a response from the UE (see clause 5.5.2).\nThe figure depicts the main states of the EMM (Energy Management Module) in a 5G network, illustrating the various states that the module can be in during the energy management process. The figure includes a legend to help understand the different states and their corresponding actions.\nFigure 5.1.3.4.4.1: EMM main states in the MME\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.4\tCoordination between EMM and GMM",
                            "text_content": "If GMM and EMM are both enabled, a UE capable of S1 mode and A/Gb mode or Iu mode or both shall maintain one common registration for GMM and EMM indicating whether the UE is registered for packet services or not.\nA UE that is not registered shall be in state GMM-DEREGISTERED and in state EMM-DEREGISTERED.\nIf the UE performs a successful attach or combined attach procedure in S1 mode, it shall enter substates GMM-REGISTERED.NO-CELL-AVAILABLE and EMM-REGISTERED.NORMAL-SERVICE. The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP TS 24.008 [13]).\nIf the UE performs a successful GPRS attach or combined GPRS attach procedure in A/Gb or Iu mode, it shall enter substates GMM-REGISTERED.NORMAL-SERVICE and EMM-REGISTERED.NO-CELL-AVAILABLE. The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP TS 24.008 [13]).\nAt intersystem change from A/Gb or Iu mode to S1 mode when no PDP context is active, if EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall move to state EMM-DEREGISTERED and state GMM-DEREGISTERED and then initiate an attach procedure. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall enter substates EMM-REGISTERED.NORMAL-SERVICE and GMM-REGISTERED.NO-CELL-AVAILABLE and initiate a tracking area updating procedure.\nAfter successful completion of routing area updating or combined routing area updating and tracking area updating or combined tracking area updating procedures in both S1 mode and A/Gb or Iu mode, if the network has indicated that ISR is activated, the UE shall maintain registration and related periodic update timers in both GMM and EMM.\nNOTE:\tAs specified in clause 5.5.3.2.4 of this document or clause 4.7.5.1.3 of 3GPP TS 24.008 [13], the UE does not activate the ISR even if the network has indicated that the ISR is activated e.g. in the tracking area updating procedure triggered due to a change in UE network capability. In these scenarios, the UE only maintains one registration and related periodic update timer in GMM or EMM.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.5\tCoordination between EMM and MM",
                            "text_content": "UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation shall use the combined EPS/IMSI attach procedure in order to attach to both EPS and non-EPS services.\nUEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall use the combined tracking area updating and periodic tracking area updating procedures.\nUEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall perform a combined detach procedure in order to detach for non-EPS services.\nUEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation should not use any MM timers related to MM specific procedures (e.g. T3210, T3211, T3212, T3213) while camped on E-UTRAN, unless the re-activation of these timers is explicitly described. If the MM timers are already running, the UE should not react on the expiration of the timers.\nIf the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17] and moves from GERAN/UTRAN to E-UTRAN, the UE shall:\n-\tif timer T3242 is running, start timer T3444 with the time left on T3242 and stop timer T3242;\n-\tif timer T3243 is running, start timer T3445 with the time left on T3243 and stop timer T3243;\n-\tif the UE is attached for both EPS services and non-EPS services and timer T3242 or timer T3243 is running, perform a combined tracking area updating procedure; and\nNOTE 1:\tA UE configured for eCall only mode as specified in 3GPP TS 31.102 [17] being attached for both EPS services and non-EPS services upon moving from GERAN/UTRAN to E-UTRAN is only possible in the case when the UE has performed a combined attach in E-UTRAN, subsequently moved to GERAN/UTRAN and returned to E-UTRAN before timer T3242 or timer T3243 expires.\n-\tif the UE is attached for non-EPS services only and timer T3242 or timer T3243 is running, perform a combined attach procedure.\nNOTE 2:\tTimers T3242 and T3243 are specified in 3GPP TS 24.008 [13].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.2\tBehaviour of the UE in state EMM-DEREGISTERED and state EMM-REGISTERED",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tGeneral",
                            "text_content": "In this clause, the detailed behaviour of the UE in the states EMM-DEREGISTERED and EMM-REGISTERED is described.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tUE behaviour in state EMM-DEREGISTERED",
                            "text_content": "The state EMM-DEREGISTERED is entered in the UE, when:\n-\tthe detach or combined detach is performed either by the UE or by the MME (see clause 5.5.2);\n-\tthe attach request is rejected by the MME (see clause 5.5.1);\n-\tthe tracking area update request is rejected by the MME (see clause 5.5.3);\n-\tthe service request procedure is rejected by the MME (see clause 5.6.1);\n-\tthe UE deactivates all EPS bearer contexts locally (see clause 6.4.4.6);\n-\tthe UE is switched on;\n-\tan inter-system change from S1 mode to non-3GPP access is completed and the non-3GPP access network provides PDN connectivity to the same EPC; or\n-\tthe UE attached for emergency bearer services is in EMM-IDLE mode and its periodic tracking area update timer expires (see clause ).\nIn state EMM-DEREGISTERED, the UE shall behave according to the substate as explained in clause 5.2.2.3.\nFor a UE configured for eCall only mode as specified in 3GPP TS 31.102 [17], timers T3444 and T3445 are considered to have expired at power on. When the UE is switched on, the substate shall be PLMN-SEARCH if the USIM is available and valid. See 3GPP TS 23.122 [6] for further details.\nThe substate chosen after PLMN-SEARCH, following power on is:\n-\tif no cell can be selected, the substate shall be NO-CELL-AVAILABLE;\n-\tif no USIM is present, the substate shall be NO-IMSI;\n-\tif a suitable cell has been found and the PLMN or tracking area is not in the forbidden list, then the substate shall be NORMAL-SERVICE;\n-\tif the selected cell is known not to be able to provide normal service, then the UE shall enter the substate LIMITED-SERVICE;\n-\tif the UE is in manual network selection mode and no cell of the selected PLMN has been found, the UE shall enter the substate NO-CELL-AVAILABLE;\n-\tif the selected cell is a non-3GPP cell, the substate shall be NO-CELL-AVAILABLE; and\n-\tif the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17], the substate shall be eCALL-INACTIVE.\nThe UE shall initiate an attach or combined attach procedure if timer T3346 is not running. If timer T3346 is running, the UE shall initiate an attach or combined attach procedure on the expiry of timer T3346.\nThe UE may initiate attach for emergency bearer services even if timer T3346 is running.\nThe UE shall initiate an attach or combined attach procedure when entering a cell which provides normal service.\nThe UE may initiate attach for emergency bearer services.\nThe UE may initiate attach for access to RLOS.\nThe UE:\n-\tshall initiate an attach or combined attach procedure on the expiry of timers T3411, T3402 or T3346 (see 3GPP TS 24.008 [13]);\n-\tmay initiate an attach for emergency bearer services even if timer T3346 is running;\n-\tmay initiate an attach if the UE is a UE configured to use AC11 - 15 in the selected PLMN, even if timer T3402, T3346 or timer T3447 is running;\n-\tshall initiate an attach or combined attach procedure when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area is not in one of the lists of forbidden tracking areas;\n-\tshall initiate an attach or combined attach procedure when the tracking area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area of the new cell is not in one of the lists of forbidden tracking areas;\n-\tshall use requests for non-EPS services for non-emergency call from CM layers to trigger a combined attach procedure, if timer T3346 is not running (see clause 5.5.1.3), or to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures;\n-\tshall use requests for non-EPS services for emergency call from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures;\n-\tmay initiate an attach procedure upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A]) if timer T3346 is not already running for \"MO exception data\" and even if timer T3402 or timer T3411 is running;\n-\tmay initiate an attach procedure upon request of the upper layers to establish a PDN connection for emergency bearer services; and\n-\tmay initiate an attach procedure upon request of the upper layers to establish a PDN connection for RLOS, if timer T3346 is not running.\nThe UE shall perform PLMN selection. If a new PLMN is selected, the UE shall reset the attach attempt counter and initiate the attach or combined attach procedure (see clause 5.5.1).\nIf the selected cell is known not to be able to provide normal service:\n-\tthe UE may initiate attach for emergency bearer services; or\n-\tthe UE may initiate attach for access to RLOS.\nThe UE shall perform cell selection according to 3GPP TS 36.304 [21].\nThe UE may initiate attach for emergency bearer services.\nThe UE may initiate attach for access to RLOS.\nThe UE shall initiate the attach or combined attach procedure, if still needed, as soon as the access is allowed in the selected cell for one of the access classes of the UE.\nThe UE may initiate attach for emergency bearer services.\nThe UE may initiate attach for access to RLOS.\nThe UE shall perform cell selection according to 3GPP TS 36.304 [21] and choose an appropriate substate when a cell is found. When the lower layers indicate to prepare for an S101 mode to S1 mode handover and the PLMN identity of the target cell provided with this indication is not in one of forbidden PLMN lists, the UE shall enter substate NORMAL-SERVICE.\nNOTE:\tIt is assumed that the UE can determine the PLMN identity of networks supporting cdma2000® HRPD access from the information broadcast over the radio interface. For the purpose of S101 mode to S1 mode handover, the UE can use the PLMN identity of the visited cdma2000® HRPD network also as PLMN identity of the target cell.\nThe UE camps on a suitable cell or an acceptable cell in a PLMN selected as specified in 3GPP TS 23.122 [6] but initiates no EMM signalling with the network and ignores any paging requests.\nThe UE shall leave substate EMM-DEREGISTERED.eCALL-INACTIVE state only when one of the following events occur:\n-\tif the USIM is removed, the UE enters substate EMM-DEREGISTERED.NO-IMSI;\n-\tif coverage is lost, the UE enters substate EMM-DEREGISTERED.PLMN-SEARCH;\n-\tif the UE is deactivated (e.g. powered off) by the user, the UE enters state EMM-NULL;\n-\tif the UE receives a request from upper layers to establish an eCall over IMS, the UE enters state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. The UE then uses the relevant EMM and ESM procedures to establish the eCall over IMS at the earliest opportunity; or\n-\tif the UE receives a request from upper layers to establish a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, the UE enters state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. Once the attach procedure is completed, the UE uses the relevant EMM and ESM procedures to establish the non-emergency call.\nWhen returning to state EMM-DEREGISTERED, the UE shall select a cell as specified in 3GPP TS 36.304 [21].\nThe substate depends on the result of the cell selection procedure, the outcome of the previously performed EMM specific procedures, on the EPS update status of the UE, on the tracking area data stored in the UE, on the presence of the USIM, on the UE configuration and on the reason for moving to EMM-DEREGISTERED:\n-\tIf no cell has been found, the substate is NO-CELL-AVAILABLE, until a cell is found.\n-\tIf no USIM is present or if the inserted USIM is considered invalid by the UE, the substate shall be NO-IMSI.\n-\tIf a suitable cell has been found and the PLMN or tracking area is not in the forbidden list, the substate shall be NORMAL-SERVICE.\n-\tIf an attach shall be performed (e.g. network requested re-attach), the substate shall be ATTEMPTING-TO-ATTACH.\n-\tIf a PLMN reselection (according to 3GPP TS 23.122 [6]) is needed, the substate shall be PLMN-SEARCH.\n-\tIf the selected cell is known not to be able to provide normal service, the substate shall be LIMITED-SERVICE;\n-\tIf the selected cell is a non-3GPP cell, the substate shall be NO-CELL-AVAILABLE; and\n-\tIf the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17], T3444 and T3445 have expired or are not running, and substate PLMN-SEARCH is not required, the substate shall be eCALL-INACTIVE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3\tUE behaviour in state EMM-REGISTERED",
                            "text_content": "The state EMM-REGISTERED is entered at the UE, when:\n-\tthe attach or combined attach procedure is performed by the UE (see clause 5.5.1).\nIn state EMM-REGISTERED, the UE shall behave according to the substate as explained in clause 5.2.3.2.\nThe UE:\n-\tshall initiate normal and combined tracking area updating (according to conditions given in clause 5.5.3);\n-\tshall perform periodic tracking area updating (see clause 5.5.3) except when attached for emergency bearer services (see clause 5.3.5);\n-\tshall initiate a tracking area updating on the expiry of timer T3411;\n-\tshall respond to paging; and\nNOTE:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\n-\tif configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause 5.5.4).\nThe UE:\n-\tshall not send any user data;\n-\tshall initiate tracking area updating on the expiry of timers T3411, T3402 or T3346;\n-\tshall initiate tracking area updating when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists, and the tracking area is not in one of the lists of forbidden tracking areas;\n-\tshall initiate tracking area updating when the tracking area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area is not in one of the lists of forbidden tracking areas;\n-\tmay initiate a tracking area updating procedure upon request of the upper layers to establish a PDN connection for emergency bearer services;\n-\tshall initiate tracking area updating procedure upon request of the upper layers to establish a PDN connection without the NAS signalling low priority indication as specified in clause 5.5.3.2.6, item l), if timer T3346 is running due to a NAS request message (TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to \"MS is configured for NAS signalling low priority\" and timer T3402 and timer T3411 are not running;\n-\tmay detach locally and initiate an attach for emergency bearer services even if timer T3346 is running;\n-\tshall use requests for non-EPS services from CM layers to trigger a combined tracking area updating procedure, if timer T3346 is not running (see clause 5.5.3.3), or to attempt to select GERAN, UTRAN or cdma2000® 1xRTT radio access technology and proceed with the appropriate MM and CC specific procedures;\n-\tmay use requests for an MMTEL voice call or MMTEL video call from the upper layers to initiate tracking area updating, if timer T3346 is not running;\n-\tshall initiate tracking area updating when the UE performs inter-system change from N1 mode to S1 mode, even if timer T3402 is running;\n-\tshall initiate tracking area updating in response to paging with S-TMSI or paging with IMSI and domain indicator set to ″CS″;\nNOTE:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\n-\tshall initiate tracking area updating if the EPS update status is set to EU2 NOT UPDATED, and timers T3411, T3402 and T3346 are not running;\n-\tif configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause 5.5.4);\n-\tmay initiate tracking area updating upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A]) if timer T3346 is not already running for \"MO exception data\" and even if timer T3402 or timer T3411 is running;\n-\tmay initiate tracking area updating if the UE is a UE configured to use AC11 – 15 in the selected PLMN, even if timer T3402, T3346 or timer T3447 is running; and\n-\tshall not initiate the detach signalling procedure unless the current TAI is part of the TAI list.\nThe UE:\n-\tshall perform cell selection/reselection according to 3GPP TS 36.304 [21];\n-\tmay respond to paging (with IMSI);\nNOTE:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\n-\tmay detach locally and initiate attach for emergency bearer services;\n-\tmay detach locally and may initiate attach for access to RLOS; and\n-\tif configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause 5.5.4).\nThe UE may enter this substate when it is in automatic network selection mode and the maximum allowed number of subsequently unsuccessful tracking area updating have been performed. The UE may also enter this substate as a result of a tracking area update rejected by the network (see clause 5.5.3) or as a result of a service request rejected by the network (see clause 5.6.1). If a new PLMN is selected, the UE shall reset the tracking area updating attempt counter and initiate the tracking area updating or combined tracking area updating procedure (see clause 5.5.3).\nIf the selected cell is known not to be able to provide normal service:\n-\tthe UE may detach locally and initiate attach for emergency bearer services; or\n-\tthe UE may detach locally and initiate attach for access to RLOS.\nThe UE:\n-\tshall not send any user data;\n-\tshall not send signalling information, unless it is a service request a tracking area updating or combined tracking area updating procedure which is triggered:\na)\tas a response to paging;\nNOTE:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\nb)\tupon request by the upper layers to establish a PDN connection for emergency bearer services; or\nc)\tupon a request from the upper layers for an MMTEL voice call, MMTEL video call, SMSoIP, SMS over NAS or SMS over S102;\n-\tshall perform cell selection/reselection according to 3GPP TS 36.304 [21];\n-\tshall enter the appropriate new substate as soon as the access is allowed in the selected cell for one of the access classes of the UE; and\n-\tif configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause 5.5.4).\nThe UE shall perform cell selection/reselection according to 3GPP TS 36.304 [21].\nThe UE:\n-\tshall perform cell selection/reselection according to 3GPP TS 36.304 [21];\n-\tshall be able to receive and transmit user data and signalling information;\n-\tshall initiate combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" on the expiry of timers T3411 or T3402 or when the UE enters a tracking area not in the list of registered tracking areas and not in one of the lists of forbidden tracking areas;\n-\tshall respond to paging with IMSI or S-TMSI for the PS domain;\nNOTE:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\n-\tshall use requests for non-EPS services from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures, unless T3402 is running due to receipt of an ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message with EMM cause #22 \"congestion\";\n-\tshall use requests for non-EPS services due to emergency call from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures, even if T3402 is running due to receipt of an ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message with EMM cause #22 \"congestion\"; and\n-\tif configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause 5.5.4).\nThe UE:\n-\tshall be able to receive and transmit user data and signalling information;\n-\tshall initiate combined tracking area updating procedure (according to conditions given in clause 5.5.3.3 or clause 5.5.2.2.4); and\n-\tif configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause 5.5.4).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3\tGeneral on elementary EMM procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tEMM modes and NAS signalling connection",
                            "text_content": "When the UE is in EMM-IDLE mode without suspend indication and needs to transmit an initial NAS message, the UE shall request the lower layer to establish a RRC connection. In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type as specified in annex D of this specification and, for the case specified in clause 5.6.1.2.2, shall also provide the initial NAS message, otherwise NAS may also provide the initial NAS message.\nInitial NAS messages are:\n-\tATTACH REQUEST;\n-\tDETACH REQUEST;\n-\tTRACKING AREA UPDATE REQUEST;\n-\tSERVICE REQUEST;\n-\tEXTENDED SERVICE REQUEST; and\n-\tCONTROL PLANE SERVICE REQUEST.\nWhen the UE is in EMM-IDLE mode with suspend indication, the UE shall proceed the behaviour as specified in clauses 5.3.1.3.\nFor the routing of the initial NAS message to the appropriate MME, the UE NAS provides the lower layers with either the S-TMSI, the registered globally unique MME identifier (GUMMEI) that consists of the PLMN ID, the MME group ID, and the MME code (see 3GPP TS 23.003 [2]), or none of them according to the following rules:\n-\tIf the UE has received the interworking without N26 interface indicator set to \"interworking without N26 interface not supported\" from the network, the UE holds a valid 5G-GUTI and:\na)\tthe UE performs an initial EPS attach procedure or tracking area updating procedure following an inter-system change from N1 mode to S1 mode; or\nb)\tthe UE which was previously registered in N1 mode before entering state 5GMM-DEREGISTERED, performs an initial EPS attach procedure,\nthen the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the 5G-GUTI as specified in 3GPP TS 23.003 [4], an indication that the identifier is a native GUMMEI and an indication that the identifier is mapped from 5GS;\n-\tIf the TIN indicates \"GUTI\" or \"RAT-related TMSI\", or the TIN is not available, and the UE holds a valid GUTI:\na)\tWhen the UE in EMM-IDLE mode initiates a tracking area updating or combined tracking area updating procedure for load balancing purposes, the UE NAS shall provide the lower layers with neither S-TMSI nor registered MME identifier;\nb)\tWhen the tracking area of the current cell is in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, the UE NAS shall provide the lower layers with the S-TMSI, but shall not provide the registered MME identifier to the lower layers; or\nc)\tWhen the tracking area of the current cell is not in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, the UE NAS shall provide the lower layers with the MME identifier part of the valid GUTI with an indication that the identifier is a native GUMMEI.\n-\tIf the TIN indicates \"P-TMSI\", or the TIN is not available, and the UE holds a valid P-TMSI and RAI, the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the P-TMSI and RAI with an indication that the identifier is a mapped GUMMEI; or\n-\tOtherwise, the UE NAS does not provide the lower layers with the S-TMSI, the registered GUMMEI and the mapped GUMMEI.\nThe UE NAS also provides the lower layers with the identity of the selected PLMN (see 3GPP TS 36.331 [22]). In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [6].\nWhen an ATTACH REQUEST message, or a TRACKING AREA UPDATE REQUEST message when the current TAI of the current cell is not included in the TAI list, is sent to establish a signalling connection, the UE NAS also provides the lower layers with the DCN-ID according to the following rules:\na)\tif a DCN-ID for the PLMN code of the selected PLMN is available in the UE, the UE NAS shall provide this DCN-ID to the lower layers; or\nb)\tif no DCN-ID for the PLMN code of the selected PLMN is available but a Default_DCN_ID value is available in the UE, as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], the UE NAS shall provide this DCN-ID to the lower layers.\nIf a relay node is attaching for relay node operation (see 3GPP TS 23.401 [10]), the NAS in the relay node shall indicate to the lower layers that the establishment of the NAS signalling connection is for a relay node.\nIf a UE operating as an IAB-node performs an attach procedure, tracking area updating procedure, or service request procedure (see 3GPP TS 23.401 [10]), the UE NAS shall indicate to the lower layers that the establishment of the NAS signalling connection is for a UE operating as an IAB-node.\nIn S1 mode, when the RRC connection has been established successfully, the UE shall enter EMM-CONNECTED mode and consider the NAS signalling connection established.\nIn S101 mode, when the cdma2000® HRPD access network resources are available for tunnelled NAS signalling, the UE shall enter EMM-CONNECTED mode and consider the S101 mode NAS signalling connection established.\nThe signalling procedure for the release of the NAS signalling connection is initiated by the network.\nIn S1 mode, when the RRC connection has been released, the UE shall enter EMM-IDLE mode and consider the NAS signalling connection released.\nIf the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17] then:\n-\tif the NAS signalling connection that was released had been established for eCall over IMS, the UE shall start timer T3444; and\n-\tif the NAS signalling connection that was released had been established for a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, the UE shall start timer T3445.\nThe UE shall start the SGC timer T3447 with the service gap time value available in the UE when the NAS signalling connection is released if:\n-\tthe UE supports SGC feature, and the service gap timer value is available in the UE and does not indicate zero; and\n-\tthe NAS signalling connection that was released had been established for mobile originated request for transfer of uplink data.\nIf the UE receives the \"Extended wait time\" from the lower layers when no attach, tracking area updating or service request procedure is ongoing, the UE shall ignore the \"Extended wait time\".\nTo allow the network to release the NAS signalling connection, the UE:\na)\tshall start the timer T3440 if the UE receives any of the EMM cause values #11, #12, #13, #14 (not applicable to the service request procedure), #15, #25, #31, #35, 42 or #78;\na1)\tmay start timer T3440 if the UE receives a SERVICE REJECT message, case e) in clause 5.6.1.6 is applicable and the procedure was started from EMM-IDLE mode;\nb)\tshall start the timer T3440 if:\n-\tthe UE receives a TRACKING AREA UPDATE ACCEPT message which does not include a UE radio capability ID deletion indication IE;\n-\tthe UE has not set the \"active\" flag in the TRACKING AREA UPDATE REQUEST message;\n-\tthe UE has not set the \"signalling active\" flag in the TRACKING AREA UPDATE REQUEST message;\n-\tthe tracking area updating or combined tracking area updating procedure has been initiated in EMM-IDLE mode, or the UE has set Request type to \"NAS signalling connection release\" in the UE request type IE in the TRACKING AREA UPDATE REQUEST message and the NAS signalling connection release bit is set to \"NAS signalling connection release supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message; and\n-\tthe user plane radio bearers have not been set up;\nc)\tshall start the timer T3440 if the UE receives a DETACH ACCEPT message and the UE has set the detach type to \"IMSI detach\" in the DETACH REQUEST message and user plane radio bearers have not been set up;\nd)\tshall start the timer T3440 if the UE receives a TRACKING AREA UPDATE REJECT message indicating:\n-\tany of the EMM cause values #9 or #10 and the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending; or\n-\tthe EMM cause values #40, the TRACKING AREA UPDATE message was not triggered due to receiving a paging for CS fallback or a paging for 1xCS fallback, and the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending;\ne)\tshall start the timer T3440 if the UE receives a SERVICE REJECT message indicating any of the EMM cause values #9, #10 or #40 as a response to a SERVICE REQUEST message CONTROL PLANE SERVICE REQUEST message, or an EXTENDED SERVICE REQUEST message with service type set to \"packet services via S1\";\nf)\tmay start the timer T3440 if the UE receives any of the EMM cause values #3, #6, #7 or #8 or if it receives an AUTHENTICATION REJECT message;\ng)\tshall start the timer T3440 if the UE receives a SERVICE REJECT message indicating the EMM cause value #39 and the UE has initiated EXTENDED SERVICE REQUEST in EMM-IDLE and the user plane radio bearers have not been set up;\nh)\tshall start the timer T3440 if the UE receives a SERVICE REJECT, SERVICE ACCEPT, ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message with control plane data back-off timer;\ni)\tshall start the timer T3440 if the UE receives the EMM cause value #22 along with a T3346 value, and the value indicates that the timer T3346 is neither zero nor deactivated;\nj)\tshall start the timer T3440 if the UE receives a SERVICE ACCEPT message and the UE has set Request type to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE in the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message;\nk)\tshall start the timer T3440 if the UE receives a SERVICE ACCEPT message, the UE has set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to \"mobile terminating request\" and the \"active\" flag in the Control plane service type IE to 0, the user plane radio bearers have not been set up, and the CONTROL PLANE SERVICE REQUEST message was sent from EMM-IDLE mode;\nl)\tshall start the timer T3440 if the UE receives a DETACH ACCEPT message and the UE has set the detach type to \"EPS detach\" or \"combined EPS/IMSI detach\" in the DETACH REQUEST message; or\nm)\tshall start the timer T3440 after the completion of the DETACH procedure, if the UE receives a DETACH REQUEST message and the detach type indicates \"re-attach required\".\nUpon expiry of T3440,\n-\tin cases a, a1, b, c, f, h, i, j and l, the UE shall locally release the established NAS signalling connection;\n-\tin cases d and e, the UE shall locally release the established NAS signalling connection and the UE shall initiate the attach procedure as described in clause 5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5; or\n-\tin case m), the UE shall locally release the established NAS signalling connection and initiate the attach procedure as described in clause 5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5.\nIn cases b, c and g,\n-\tupon an indication from the lower layers that the user plane radio bearers are set up, the UE shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection or user data via the user plane bearers. If the uplink signalling is for CS fallback for emergency call, or for establishing a PDN connection for emergency bearer services, the UE shall send the uplink signalling via the existing NAS signalling connection; or\nIn cases b, c, g and j,\n-\tupon receipt of a DETACH REQUEST message, the UE shall stop timer T3440 and respond to the network initiated detach as specified in clause 5.5.2.3.\nIn case b, j and k,\n-\tupon receiving a request from upper layers to send NAS signalling not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, the UE shall wait for the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding;\n-\tupon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause 5.6.1;\n-\tupon receipt of ESM DATA TRANSPORT message, as an implementation option, the UE may reset and restart timer T3440;\n-\tupon receipt of a DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, the UE which is in EMM-REGISTERED without PDN connections shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection;\n-\tupon receipt of an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, MODIFY EPS BEARER CONTEXT REQUEST, DEACTIVATE EPS BEARER CONTEXT REQUEST, DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, if the UE is using control plane CIoT EPS optimization, the UE shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection; or\n-\tupon initiation of tracking area updating procedure or combined tracking area updating procedure due to detecting the current TAI is not in the TAI list as specified in clause 5.5.3.2.6 for cases e, i, j, clause 5.5.3.2.2 for case a or clause 5.5.3.3.2 for case a, the UE shall stop timer T3440.\nIn case c,\n-\tupon receiving a request from upper layers to send NAS signalling not associated with establishing a PDN connection for emergency bearer services, the UE shall wait for the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding; or\n-\tupon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause 5.6.1.\nIn cases d and e,\n-\tupon an indication from the lower layers that the RRC connection has been released, the UE shall stop timer T3440 and perform a new attach procedure as specified in clause 5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5; or\n-\tupon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause 5.5.1.\nIn cases a and f,\n-\tupon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause 5.5.1.\nIn case g,\n-\tupon receiving a request from upper layers to send NAS signalling not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, the UE shall wait for the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding; or\n-\tupon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause 5.6.1.\nIn case h,\n-\tupon an indication from the lower layers that the user plane radio bearers are set up or upon receiving a request from upper layers to send NAS signalling not associated with ESM DATA TRANSPORT, the UE shall stop timer T3440; or\n-\tthe UE shall not send ESM DATA TRANSPORT message until expiry of timer T3440 or times T3440 being stopped.\nIn EMM-CONNECTED mode, if the UE moves to EMM-SERVICE-REQUEST-INITIATED state upon receipt of a CS SERVICE NOTIFICATION message, the UE shall stop timer T3440.\nIn S101 mode, when the cdma2000® HRPD radio access connection has been released, the UE shall enter EMM-IDLE mode and consider the S101 mode NAS signalling connection released.\nIf the timer T3440 is not running when the UE enters state EMM-DEREGISTERED.PLMN-SEARCH or EMM-REGISTERED.PLMN-SEARCH, the UE may locally release the NAS signalling connection.\nUpon receipt of the indication from the ESM layer to release the NAS signalling connection (see clause 6.6.4.2), unless the MME has additional downlink user data or signalling pending, the MME shall initiate release of the NAS signalling connection.\nSuspend of the NAS signalling connection can be initiated by the network in EMM-CONNECTED mode when user plane CIoT EPS optimization is used. Resume of the suspended NAS signalling connection is initiated by the UE.\nIn the UE, when user plane CIoT EPS optimization is used:\n-\tUpon indication from the lower layers that the RRC connection has been suspended, the UE shall enter EMM-IDLE mode with suspend indication, shall not consider the NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated (see clause 4.4.2.3 and 4.4.5). Based on further indications provided by the lower layers, the UE shall update the status of the suspend indication for the EMM-IDLE mode;\n-\tUpon trigger of a procedure using an initial NAS message when in EMM-IDLE mode with suspend indication, the UE shall:\ni)\tif the initial NAS message is a TRACKING AREA UPDATE REQUEST message which includes a UE radio capability information update needed IE, enter EMM-IDLE mode without suspend indication and proceed with the tracking area updating procedure; and\nii)\totherwise, request the lower layer to resume the RRC connection. In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type according to annex D of this document;\nNOTE 1:\tIn NB-S1 mode, in the request to the lower layer the data volume information of the initial NAS message is provided to the lower layers. Interactions between the NAS and the lower layers in order to obtain the data volume information of the initial NAS message (see 3GPP TS 36.321 [49], 3GPP TS 36.331 [22]) is left to implementations.\n-\tUpon indication from the lower layers that the RRC connection has been resumed when in EMM-IDLE mode with suspend indication, the UE shall enter EMM-CONNECTED mode. If the pending NAS message is:\ni)\ta SERVICE REQUEST message;\nii)\ta CONTROL PLANE SERVICE REQUEST message, and the UE did not include any ESM message container, NAS message container, EPS bearer context status information element, or UE request type information element; or\niii)\tan EXTENDED SERVICE REQUEST message, and the Service type information element indicates \"packet services via S1\" and the UE did not include any EPS bearer context status information element, or UE request type information element;\nthe message shall not be sent. Otherwise the UE shall cipher the message as specified in clause 4.4.5 and send the pending initial NAS message upon entering EMM-CONNECTED mode;\nNOTE 2:\tIf a NAS message is discarded and not sent to the network, the uplink NAS COUNT value corresponding to that message is reused for the next uplink NAS message to be sent.\n-\tUpon fallback indication from the lower layers at RRC connection resume when in EMM-IDLE mode with suspend indication, the UE shall enter EMM-IDLE mode without suspend indication, send any pending initial NAS message and proceed as if RRC connection establishment had been requested;\n-\tUpon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is suspended, the UE shall enter EMM-IDLE mode with suspend indication and restart the ongoing NAS procedure if required; and\n-\tUpon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is not suspended, the UE shall enter EMM-IDLE mode without suspend indication and restart the ongoing NAS procedure if required.\nIn the network, when user plane CIoT EPS optimization is used:\n-\tUpon indication from the lower layers that the RRC connection has been suspended, the network shall enter EMM-IDLE mode with suspend indication, shall not consider the NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated; and\n-\tUpon indication from the lower layers that the RRC connection has been resumed when in EMM-IDLE mode with suspend indication, the network shall enter EMM-CONNECTED mode.\nFor the case that not all suspended bearers are resumed, see clause 6.4.4.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.2\tLists of forbidden tracking areas",
                            "text_content": "The UE shall store a list of \"forbidden tracking areas for roaming\", as well as a list of \"forbidden tracking areas for regional provision of service\". These lists shall be erased when the UE is switched off or when the UICC containing the USIM is removed, and periodically (with a period in the range 12 to 24 hours). When the lists are erased, the UE performs cell selection according to 3GPP TS 36.304 [21]. One or more tracking areas is removed from the list of \"forbidden tracking areas for roaming\" in the UE, as well as the list of \"forbidden tracking areas for regional provision of service\" if, after a subsequent procedure e.g. attach procedure, tracking area updating procedure and GUTI reallocation procedure, one or more tracking areas in the lists is received from the network. If the UE has only one PDN connection established which is for emergency bearer services, the tracking areas shall not be removed from these lists if one or more tracking areas in the lists are received from the network.\nIn S1 mode, the UE shall update the suitable list whenever an ATTACH REJECT, TRACKING AREA UPDATE REJECT, SERVICE REJECT or DETACH REQUEST message is received with the EMM cause #12 \"tracking area not allowed\", #13 \"roaming not allowed in this tracking area\", or #15 \"no suitable cells in tracking area\" or an ATTACH ACCEPT or a TRACKING AREA UPDATE ACCEPT message is received with the forbidden TAI(s).\nIn S1 mode, if the UE receives the \"forbidden tracking areas for roaming\" IE or the \"forbidden tracking areas for regional provision of service\" IE in the ATTACH REJECT, ATTACH ACCEPT, TRACKING AREA UPDATE REJECT, TRACKING AREA UPDATE ACCEPT , SERVICE REJECT or DETACH REQUEST message, the UE shall update the suitable list with the TAI(s) included in the IEs which are belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s).\nEach list shall accommodate 40 or more TAIs. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.3\tList of forbidden PLMNs for attach in S101 mode",
                            "text_content": "A UE supporting S101 mode shall store a list of \"forbidden PLMNs for attach in S101 mode\". The UE shall erase this list when the UE is switched off or when the USIM is removed.\nIn S101 mode, the UE shall add to the \"forbidden PLMNs for attach in S101 mode\" list the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover whenever an ATTACH REJECT message is received with the EMM cause #11 \"PLMN not allowed\", #12 \"tracking area not allowed\", #13 \"roaming not allowed in this tracking area\", #14 \"EPS services not allowed in this PLMN\", #15 \"no suitable cells in tracking area\", or #35 \"Requested service option not authorized in this PLMN\" as specified in clause 5.5.1.2.5.\nThe maximum number of possible entries in the \"forbidden PLMNs for attach in S101 mode\" list is implementation dependent, but the list shall accommodate at least one PLMN identity. When the list is full and a new PLMN identity has to be inserted, the UE shall delete the oldest PLMN identity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.3a\tForbidden PLMNs for EPS services",
                            "text_content": "The forbidden PLMNs for EPS services are contained in the \"forbidden PLMNs for GPRS service\" list, as defined in 3GPP TS 24.008 [13]. The UE updates this list as part of the attach procedure, tracking area updating procedure and network initiated detach procedure as described respectively in clauses 5.5.1, 5.5.3 and 5.5.2.3.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.4\tEquivalent PLMNs list",
                            "text_content": "The UE shall store a list of equivalent PLMNs. These PLMNs shall be regarded by the UE as equivalent to each other for PLMN selection and cell selection/re-selection. The same list is used by 5GMM, EMM, GMM and MM.\nThe UE shall update or delete this list at the end of each attach or combined attach or tracking area updating or combined tracking area updating procedure. The stored list consists of a list of equivalent PLMNs as downloaded by the network plus the PLMN code of the registered PLMN that downloaded the list. When the UE is switched off, it shall keep the stored list so that it can be used for PLMN selection after switch on. The UE shall delete the stored list if the USIM is removed or when the UE attached for emergency bearer services or access to RLOS enters the state EMM-DEREGISTERED. The maximum number of possible entries in the stored list is 16.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.5\tHandling of the periodic tracking area update timer and mobile reachable timer (S1 mode only)",
                            "text_content": "The periodic tracking area updating procedure is used to periodically notify the availability of the UE to the network. The procedure is controlled in the UE by timer T3412. The value of timer T3412 is sent by the network to the UE in the ATTACH ACCEPT message and can be sent in the TRACKING AREA UPDATE ACCEPT message. The UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE until a new value is received.\nIf timer T3412 received by the UE in an ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message contains an indication that the timer is deactivated or the timer value is zero, then timer T3412 is deactivated and the UE shall not perform the periodic tracking area updating procedure.\nTimer T3412 is reset and started with its initial value, when the UE changes from EMM-CONNECTED to EMM-IDLE mode. Timer T3412 is stopped when the UE enters EMM-CONNECTED mode or the EMM-DEREGISTERED state.\nIf the UE is attached for emergency bearer services, and timer T3412 expires, the UE shall not initiate a periodic tracking area updating procedure, but shall locally detach from the network. When the UE is camping on a suitable cell, it may re-attach to regain normal service.\nWhen a UE is not attached for emergency bearer services, and timer T3412 expires, the periodic tracking area updating procedure shall be started and the timer shall be set to its initial value for the next start.\nIf the UE is not attached for emergency bearer services, and is in a state other than EMM-REGISTERED.NORMAL-SERVICE when timer T3412 expires, the periodic tracking area updating procedure is delayed until the UE returns to EMM-REGISTERED.NORMAL-SERVICE.\nNOTE 1:\tWhen the UE returns to EMM-REGISTERED.NORMAL-SERVICE and it needs to initiate other EMM procedure than the periodic tracking area updating procedure then, based on UE implementation, the EMM procedure can take precedence.\nIf ISR is activated, the UE shall keep both timer T3412 and timer T3312. The two separate timers run in the UE for updating MME and SGSN independently. The UE shall start timer T3423, if timer T3412 expires, and timer T3346 is running or the UE is in one of the following states:\n-\tEMM-REGISTERED.NO-CELL-AVAILABLE;\n-\tEMM-REGISTERED.PLMN-SEARCH;\n-\tEMM-REGISTERED.UPDATE-NEEDED; or\n-\tEMM-REGISTERED.LIMITED-SERVICE.\nThe UE shall initiate the tracking area updating procedure and stop timer T3423 when it enters state EMM-REGISTERED.NORMAL-SERVICE before timer T3423 expires. After expiry of timer T3423 the UE shall set its TIN to \"P-TMSI\".\nIf timer T3423 expires the UE shall memorize that it has to initiate a tracking area updating procedure when it returns to state EMM-REGISTERED.NORMAL-SERVICE.\nIf the UE is attached to both EPS and non-EPS services, and if timer T3412 expires or timer T3423 expires when the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE state, then the UE shall initiate the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" when the UE returns to EMM-REGISTERED.NORMAL-SERVICE state.\nWhen the network includes T3412 extended value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message, the network uses timer T3412 extended value IE as the value of timer T3412.\nThe network supervises the periodic tracking area updating procedure of the UE by means of the mobile reachable timer.\nIf the UE is not attached for emergency bearer services, the mobile reachable timer shall be longer than T3412. In this case, by default, the mobile reachable timer is 4 minutes greater than timer T3412.\nIf ISR is not activated, the network behaviour upon expiry of the mobile reachable timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.\nIf the UE is attached for emergency bearer services, the MME shall set the mobile reachable timer with a value equal to timer T3412. When the mobile reachable timer expires, the MME shall locally detach the UE.\nThe mobile reachable timer shall be reset and started with the value as indicated above, when the MME releases the NAS signalling connection for the UE. The mobile reachable timer shall be stopped when a NAS signalling connection is established for the UE.\nUpon expiry of the mobile reachable timer the network shall start the implicit detach timer. The value of the implicit detach timer is network dependent. If ISR is activated, the default value of the implicit detach timer is 4 minutes greater than timer T3423. If the implicit detach timer expires before the UE contacts the network, the network shall implicitly detach the UE. If the MME includes timer T3346 in the TRACKING AREA UPDATE REJECT message or the SERVICE REJECT message and timer T3346 is greater than timer T3412, the MME sets the mobile reachable timer and the implicit detach timer such that the sum of the timer values is greater than timer T3346.\nIf the network includes the T3324 value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message, and if the UE is not attached for emergency bearer services and has no PDN connection for emergency bearer services the MME shall set the active timer to a value equal to the value of timer T3324.\nNOTE 2:\tTimer T3324 is specified in 3GPP TS 24.008 [13].\nIf the UE has established a PDN connection for emergency services after receiving the timer T3324 value IE in the ATTACH ACCEPT message or the last TRACKING AREA UPDATE ACCEPT message, the active timer shall not be started.\nThe active timer shall be reset and started with the value as indicated above, when the MME releases the NAS signalling connection for the UE. The active timer shall be stopped when an NAS signalling connection is established for the UE.\nThe network behaviour upon expiry of the active timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.\nNOTE 3:\tISR is not activated when the network includes the T3324 value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message.\nThe implicit detach timer shall be stopped when a NAS signalling connection is established for the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.6\tHandling of timer T3402",
                            "text_content": "The value of timer T3402 can be sent by the network to the UE in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. If the value is different from \"deactivated\", the UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE, until a new value is received.\nThe value of timer T3402 can be sent by the network to the UE in the ATTACH REJECT message. If an ATTACH REJECT message including timer T3402 value different from \"deactivated\", was received integrity protected, the UE shall apply this value until a new value is received with integrity protection or a new PLMN is selected. Otherwise, the default value of this timer is used.\nThe default value of this timer is also used by the UE in the following cases:\n-\tATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message is received without a value specified, and the EPS update type in the TRACKING AREA UPDATE REQUEST message is not set to \"periodic updating\";\n-\tthe network indicates that the timer is \"deactivated\";\n-\tthe UE does not have a stored value for this timer;\n-\ta new PLMN which is not in the list of equivalent PLMNs has been entered, the tracking area updating fails and the tracking area updating attempt counter is equal to 5; or\n-\ta new PLMN which is not in the list of equivalent PLMNs has been entered, the attach procedure fails, the attach attempt counter is equal to 5 and no ATTACH REJECT message was received from the new PLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.7\tHandling of the Local Emergency Numbers List and the Extended Local Emergency Numbers List",
                            "text_content": "The Local Emergency Numbers List and the Extended Local Emergency Numbers list contain additional local emergency numbers used by the serving network. These lists can be downloaded by the network to the UE at successful registration and subsequent registration updates. There is only one Local Emergency Numbers List and only one Extended Local Emergency Numbers list in the UE. The Local Emergency Numbers List can be updated with EMM procedures if the UE is in S1 mode, with GMM and MM procedures if the UE is in A/Gb or Iu mode, and with 5GMM procedures, as specified in 3GPP TS 24.501 [54], if UE is in N1 mode. The Extended Local Emergency Numbers List can be updated with EMM procedures if the UE is in S1 mode and with 5GMM procedures, as specified in 3GPP TS 24.501 [54], if UE is in N1 mode.\nThe UE shall use the stored Local Emergency Numbers List and the stored Extended Local Emergency Numbers List received from the network in addition to the emergency numbers stored on the USIM or user equipment to detect that the number dialled is an emergency number.\nIf the UE determines that the number dialled is an emergency number, the procedures specified in 3GPP TS 23.167 [45] and 3GPP TS 24.229 [13D] are utilised to select a domain for the emergency session attempt.\nIf the domain selected for the emergency session attempt is the PS domain, then the UE shall perform the session establishment procedures specified in 3GPP TS 24.229 [13D] to initiate an emergency session.\nIf the domain selected for the emergency session attempt is the CS domain (e.g. the UE has selected GERAN or UTRAN radio access technology), then the UE shall use the stored Local Emergency Numbers List, in addition to the emergency numbers stored on the USIM and the ME, to determine if:\n-\tthe UE is to send an EXTENDED SERVICE REQUEST message:\n1)\tfor CS fallback, indicating \"mobile originating CS fallback or 1xCS fallback\"; or\n2)\tfor CS fallback for emergency call, indicating \"mobile originating CS fallback emergency call or 1xCS fallback emergency call\"; and\n-\tthe call control entity of the UE specified in 3GPP TS 24.008 [13] is to send an EMERGENCY SETUP message or a SETUP message to the network.\nNOTE 1:\tThe checking of whether the dialled number is an emergency number and the determination of whether an emergency call is to be initiated in the CS domain, can end once a match is found. The Extended Local Emergency Numbers List does not apply when the CS domain is selected.\nNOTE 2:\tThe user equipment can use the emergency numbers in each of the stored lists to assist the end user in determining whether the dialled number is intended for an emergency service or for another destination, e.g. a local directory service. The possible interactions with the end user are implementation specific.\nNOTE 3:\tA UE that supports procedures specified in 3GPP TS 24.302 [48], can get additional local emergency numbers through those procedures, which can be used based on operator policy, see 3GPP TS 24.302 [48].\nThe network may send a Local Emergency Numbers List or an Extended Local Emergency Numbers List or both, in the ATTACH ACCEPT message or in the TRACKING AREA UPDATE ACCEPT message, by including the Emergency number list IE and the Extended emergency number list IE, respectively. The user equipment shall store the Local Emergency Numbers List and the Extended Local Emergency Numbers List, as provided by the network. The Local Emergency Numbers List stored in the user equipment shall be replaced on each receipt of the Emergency number list IE. The Extended Local Emergency Numbers List stored in the user equipment shall be replaced on each receipt of the Extended emergency number list IE. The received Local Emergency Numbers List or the received Extended Local Emergency Numbers list or both shall be provided to the upper layers.\nThe emergency number(s) received in the Emergency number list IE are valid only in networks in the same country as the PLMN from which this IE is received. If no Local Emergency Numbers List is contained in the ATTACH ACCEPT message or in the TRACKING AREA UPDATE ACCEPT message, then the stored Local Emergency Numbers List in the user equipment shall be kept, except if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.\nThe emergency number(s) received in the Extended emergency number list IE are valid only in:\n-\tnetworks in the same country as the PLMN from which this IE is received, if the Extended Emergency Number List Validity (EENLV) field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received\"; and\n-\tthe PLMN from which this IE is received, if the EENLV field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\".\nIf no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT message or in the TRACKING AREA UPDATE ACCEPT message, and the registered PLMN has not changed, then the stored Extended Local Emergency Numbers List in the user equipment shall be kept. If no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT message or in the TRACKING AREA UPDATE ACCEPT message, but the registered PLMN has changed, then:\n-\tif the last received indication in the EENLV field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\", the stored Extended Local Emergency Numbers List in the user equipment shall be deleted; and\n-\tif the last received indication in the EENLV field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received\" the list shall be kept except if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.\nNOTE:\tTo prevent the misrouting of emergency calls, all operators within a country need to follow the regulation or agree on the setting of the Extended emergency number list IE in accordance to national agreement – either to indicate validity within a country or to indicate validity only within the PLMN.\nThe Local Emergency Numbers List and the Extended Local Emergency Numbers List shall be deleted at switch off and removal of the USIM. The user equipment shall be able to store up to ten entries in the Local Emergency Numbers List and up to twenty entries in the Extended Local Emergency Numbers List, received from the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.7a\tSpecific requirements for UE configured to use timer T3245",
                            "text_content": "The following requirement applies for an UE that is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]):\nWhen the UE adds a PLMN identity to the \"forbidden PLMN list\", the \"forbidden PLMNs for attach in S101 mode\" list, or the \"forbidden PLMNs for GPRS service\" list or sets the USIM as invalid for non-EPS services or EPS services or both, and timer T3245 (see 3GPP TS 24.008 [13]) is not running, the UE shall start timer T3245 as specified in 3GPP TS 24.008 [13], clause 4.1.1.6.\nUpon expiry of the timer T3245, the UE shall erase the \"forbidden PLMN list\", the \"forbidden PLMNs for GPRS service\" list, and the \"forbidden PLMNs for attach in S101 mode\" list and set the USIM to valid for non-EPS and EPS services. When the lists are erased, the UE performs cell selection according to 3GPP TS 36.304 [21].\nIf the UE is switched off when the timer T3245 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:\n-\tlet t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the UE will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.7b\tSpecific requirements for UE when receiving non-integrity protected reject messages",
                            "text_content": "This clause specifies the requirements for a UE that is not configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) and receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with specific EMM causes.\nNOTE 1:\tAdditional UE requirements for this case, requirements for other EMM causes, and requirements for the case when the UE receives an integrity protected reject message are specified in clauses 5.5.1, 5.5.3 and 5.6.1.\nThe UE may maintain a list of PLMN-specific attempt counters and a list of PLMN-specific PS-attempt counters (see 3GPP TS 24.008 [13]). The maximum number of possible entries in each list is implementation dependent.\nAdditionally, the UE may maintain one counter for \"SIM/USIM considered invalid for non-GPRS services\" events and one counter for \"SIM/USIM considered invalid for GPRS services\" events (see 3GPP TS 24.008 [13]).\nIf the UE maintains the above lists of attempt counters and the event counters, a UE supporting N1 mode, shall store them in its non-volatile memory. The UE shall erase the lists and reset the event counters to zero when the UICC containing the USIM is removed. The counter values shall not be affected by the activation or deactivation of power saving mode or MICO mode (see 3GPP TS 24.501 [54]).\nIf the UE receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with EMM cause value #3, #6, #7, #8, #11, #12, #13, #14, #15, #31 or #35 before the network has established secure exchange of NAS messages for the NAS signalling connection, the UE shall start timer T3247 (see 3GPP TS 24.008 [13]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and take the following actions:\n1)\tif the EMM cause value received is #3, #6, #7 or #8, and\na)\tif the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter has a value less than a UE implementation-specific maximum value, the UE shall:\ni)\tset the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI;\n-\tif the EMM cause value received is #3, #6 or #8, delete the list of equivalent PLMNs if any;\n-\tincrement the counter for \"SIM/USIM considered invalid for GPRS services\" events;\n-\tif the EMM cause value received is #3, #6 or #8, and if the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" and the counter has a value less than a UE implementation-specific maximum value, increment the counter;\n-\tif an attach, tracking area updating or a service request procedure was performed, reset the attach attempt counter, the tracking area updating attempt counter or the service request attempt counter, respectively;\n-\tif A/Gb mode or Iu mode is supported by the UE, handle the GMM parameters GPRS attach attempt counter, routing area updating attempt counter or service request attempt counter, GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the GPRS attach, routing area updating or service request procedure is rejected with the GMM cause of the same value in a NAS message without integrity protection;\n-\tif the UE is operating in single-registration mode and the EMM cause value received is #3, #6 or #7, handle the 5GMM parameters 5GMM state, 5GS update status, registration attempt counter or service request attempt counter, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration request or service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value in a NAS message without integrity protection;\n-\tif the UE is operating in single-registration mode and the EMM cause value received is #8, set the 5GMM state to 5GMM-DEREGISTERED, the 5GS update status to 5U3 ROAMING NOT ALLOWED, shall reset the registration attempt counter and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI for 3GPP access;\n-\tstore the current TAI in the list of \"forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message and enter the state EMM-DEREGISTERED.LIMITED-SERVICE; and\n-\tsearch for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21]; or\nii)\tproceed as specified in clauses 5.5.1, 5.5.3 and 5.6.1;\n-\tincrement the counter for \"SIM/USIM considered invalid for GPRS services\" events; and\n-\tif the EMM cause value received is #3, #6 or #8, and if the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" and the counter has a value less than a UE implementation specific maximum value, increment the counter; and\nb)\telse the UE shall proceed as specified in clauses 5.5.1, 5.5.3 and 5.6.1;\n2)\tif the EMM cause value received is #12, #13 or #15, the UE shall additionally proceed as specified in clauses 5.5.1, 5.5.3 and 5.6.1;\n3)\tif the EMM cause value received is #11, #14 or #35 and the UE is in its HPLMN or EHPLMN (if the EHPLMN list is present),\n-\tthe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs. Additionally, if an attach, tracking area updating or service request procedure was performed, the UE shall reset the attach attempt counter or the tracking area updating attempt counter or the service request attempt counter, respectively;\n-\tfor the EMM cause #11 and #14, if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter or routing area updating attempt counter or service request attempt counter as specified in 3GPP TS 24.008 [13] for the case when the procedure is rejected with the GMM cause with the same value in a NAS message without integrity protection;\n-\tfor the EMM cause #35, if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter or routing area updating attempt counter or service request attempt counter as specified in 3GPP TS 24.008 [13] for the case when the procedure is rejected with the GMM cause value #11 in a NAS message without integrity protection;\n-\tif the UE is operating in single-registration mode and the EMM cause value received is #11, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, registration attempt counter or service request attempt counter, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration request procedure or service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value in a NAS message without integrity protection;\n-\tif the UE is operating in single-registration mode and the EMM cause value received is #14 or #35, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, the 5GS update status to 5U3 ROAMING NOT ALLOWED, shall reset the registration attempt counter or service request attempt counter, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI for 3GPP access;\n-\tthe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message and enter the state EMM-DEREGISTERED.LIMITED-SERVICE; and\n-\tthe UE shall search for a suitable cell in another tracking area or in another location area in the same PLMN according to 3GPP TS 36.304 [21];\n4)\tif the EMM cause value received is #11 or #35 and the UE is not in its HPLMN or EHPLMN (if the EHPLMN list is present), in addition to the UE requirements specified in clause 5.5.1, 5.5.3 and 5.6.1,\nif the UE maintains a list of PLMN-specific attempt counters and the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PLMN-specific attempt counter for the PLMN;\n5)\tif the EMM cause value received is #14 and the UE is not roaming in its HPLMN or EHPLMN (if the EHPLMN list is present), in addition to the UE requirements specified in clause5.5.1, 5.5.3 and 5.6.1,\nif the UE maintains a list of PLMN-specific PS-attempt counter and the PLMN-specific PS-attempt counter of the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PS-attempt counter of the PLMN; and\n6)\tif the EMM cause value received is #31 for a UE that has indicated support for CIoT optimizations, the UE may discard the message or alternatively the UE should:\n-\tset the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3);\n-\tstore the current TAI in the list of \"forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message; and\n-\tsearch for a suitable cell in another tracking area according to 3GPP TS 36.304 [21].\nUpon expiry of timer T3247, the UE shall\n-\tremove all tracking areas from the list of \"forbidden tracking areas for regional provision of service\" and the list of \"forbidden tracking areas for roaming\", which were stored in these lists for non-integrity protected NAS reject message;\n-\tset the USIM to valid for EPS services, if\n-\tthe UE does not maintain a counter for \"SIM/USIM considered invalid for GPRS services\" events; or\n-\tthe UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\" events and this counter has a value less than a UE implementation-specific maximum value;\n-\tset the USIM to valid for non-EPS services, if\n-\tthe UE does not maintain a counter for \"SIM/USIM considered invalid for non-GPRS services\" events; or\n-\tthe UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" events and this counter has a value less than a UE implementation-specific maximum value;\n-\tif the UE maintains a list of PLMN-specific attempt counters, for each PLMN-specific attempt counter that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the extension of the \"forbidden PLMNs\" list;\n-\tif the UE maintains a list of PLMN-specific PS-attempt counters, for each PLMN-specific PS-attempt counter that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the \"forbidden PLMNs for GPRS service\" list. If the resulting \"forbidden PLMNs for GPRS service\" list is empty, the UE shall re-enable the E-UTRA capability (see clause 4.5);\n-\tif the UE is supporting A/Gb mode or Iu mode, perform the actions as specified in 3GPP TS 24.008 [13] for the case when timer T3247 expires;\n-\tif the UE is supporting N1 mode, perform the actions as specified in 3GPP TS 24.501 [54], clause 5.3.20.2 for the case when timer T3247 expires; and\n-\tinitiate an EPS attach procedure or tracking area updating procedure, if still needed, dependent on EMM state and EPS update status, or perform PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE maintains a list of PLMN-specific attempt counters and PLMN-specific PS-attempt counters, when the UE is switched off, the UE shall, for each PLMN-specific attempt counter that has a value greater than zero and less than the UE implementation-specific maximum value, remove the respective PLMN from the forbidden PLMN list. When the USIM is removed, the UE should perform this action.\nNOTE 2:\tIf the respective PLMN was stored in the extension of the \"forbidden PLMNs\" list, then according to 3GPP TS 23.122 [6] the UE will delete the contents of this extension when the UE is switched off or the USIM is removed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.8\tAbnormal cases in the UE",
                            "text_content": "The following abnormal case can be identified:\na)\tEMM uplink message transmission failure indication by lower layers\nWhen it is specified in the relevant procedure that it is up to the UE implementation to rerun the ongoing procedure that triggered that procedure, the procedure can typically be re-initiated using a retransmission mechanism of the uplink message (the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to restart the whole procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.9\tHandling of NAS level mobility management congestion control",
                            "text_content": "The network may detect EMM signalling congestion and perform NAS level mobility management congestion control. NAS level mobility management congestion control consists of general NAS level mobility management congestion control and subscribed APN based congestion control.\nUnder general overload conditions the network may reject mobility management signalling requests from UEs as specified in 3GPP TS 23.401 [10]. The network should not reject the following requests:\n-\trequests for emergency bearer services;\n-\tDETACH REQUEST message;\n-\tservice request or tracking area update request triggered by paging;\n-\trequests from UEs that were received via NAS signalling connections established with RRC establishment cause \"High priority access AC 11 – 15\";\n-\trequests for attach, normal tracking area updating or periodic tracking area updating, when emergency is indicated by lower layers;\n-\trequests for CS fallback emergency call or 1xCS fallback emergency call; and\n-\trequests for tracking area update when the UE is reporting unavailability information due to enhanced discontinuous coverage.\nWhen subscribed APN based mobility management congestion control is active for a particular APN, the network may reject attach requests from UEs with a subscription to this APN.\nIn mobility management the network may detect NAS signalling congestion and start or stop performing the subscribed APN based congestion control based on mobility management level criteria such as:\n-\trate of mobility management NAS messages from a group of UEs with a subscription to a particular APN exceeds or falls below certain thresholds; and/or\n-\tsetting in network management.\nWhen the NAS level mobility management congestion control is active, the network may include a value for the mobility management back-off timer T3346 in the reject messages. The UE starts the timer T3346 with the value received in the mobility management reject messages. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the timer T3346 for the rejected UEs so that timeouts are not synchronised.\nFor subscribed APN based congestion control the value of timer T3346 for a particular APN may be APN dependent.\nIf the timer T3346 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3346 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3346 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:\n-\tlet t1 be the time remaining for T3346 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1; and\n-\tif prior to switch off, timer T3346 was started due to a NAS request message (ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to \"MS is configured for NAS signalling low priority\", then if timer T3346 is restarted at switch on, the UE configured for dual priority shall handle mobility management requests as indicated in clauses 5.5.1.2.6, 5.5.3.2.6 and 5.6.1.6.\nIf the UE enters a new PLMN while timer T3346 is running, and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the UE shall stop timer T3346 when initiating mobility management procedures in the new PLMN.\nAfter change in TAI which is not part of TAI list, if the timer T3346 is running and EMM update status is EU1 UPDATED then UE shall set the EMM update status to EU2 NOT UPDATED and enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.9A\tHandling of congestion control for transport of user data via the control plane",
                            "text_content": "The network may activate congestion control for transport of user data via the control plane, as specified in 3GPP TS 23.401 [10].\nIf the congestion control for transport of user data via the control plane is active and if the UE has indicated support for the control plane data back-off timer, the network shall include a value for the control plane data back-off timer T3448 in ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT, SERVICE ACCEPT or SERVICE REJECT message, and shall store a control plane data back-off time on a per UE basis. The UE starts the timer T3448 with the value informed in the message. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the timer T3448 for the informed UEs so that timeouts are not synchronised.\nThe network sends TRACKING AREA UPDATE ACCEPT message or SERVICE ACCEPT message without T3448 value IE to stop the timer T3448 running in the UE as specified in clause 5.5.3.2.4 and clause 5.6.1.4.2.\nBased on the stored control plane data back-off time for the UE, the network may reject the transfer of user data via the control plane initiated by the UE.\nWhile the timer T3448 is running, the UE in EMM-IDLE mode shall not initiate the transport of user data via the control plane procedure (see clause 6.6.4), except if the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]) and the user data is related to an exceptional event.\nUpon entering the state EMM-DEREGISTERED or a new PLMN which is not equivalent to the PLMN where the UE started the timer T3448, or upon being switched off while the timer T3448 is running, the UE shall stop the timer T3448. For further criteria to stop of timer T3448, refer to clause 5.5.3.2.4 and clause 5.6.1.4.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.10\tAccess class control",
                            "text_content": "The network can restrict the access for certain groups of UEs by means of barring their access class.\nThe UE shall evaluate the access control information as specified in 3GPP TS 36.331 [22] for:\n-\tAccess Class Barring;\n-\tAccess Control for CSFB and Extended Access Barring (EAB);\n-\tAccess Control for Application specific Congestion control for Data Communication (ACDC), if the UE supports ACDC; and\n-\tAccess Barring.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.11\tPower saving mode",
                            "text_content": "The UE can request the use of power saving mode (PSM) during an attach or tracking area updating procedure (see 3GPP TS 23.682 [11A] and 3GPP TS 23.401 [10]). The UE shall not request the use of PSM during:\n-\tan attach for emergency bearer services procedure;\n-\tan attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to \"EPS emergency attach\";\n-\ta tracking area updating procedure for initiating a PDN connection for emergency bearer services;\n-\ta tracking area updating procedure when the UE has a PDN connection established for emergency bearer services; or\n-\tan attach for access to RLOS.\nThe network accepts the use of PSM by providing a specific value for timer T3324 when accepting the attach or tracking area updating procedure. The UE may use PSM only if the network has provided the T3324 value IE during the last attach or tracking area updating procedure with a value different from \"deactivated\".\nNOTE:\tTimer T3324 is specified in 3GPP TS 24.008 [13].\nUpon expiry of the timer T3324 or if the T3324 value provided by the network is zero, the UE may deactivate the AS layer and activate PSM by entering the state EMM-REGISTERED.NO-CELL-AVAILABLE if:\na)\tthe UE is not attached for emergency bearer services;\nb)\tthe UE has no PDN connection for emergency bearer services;\nc)\tthe UE is in EMM-IDLE mode;\nd)\tin the EMM-REGISTERED.NORMAL-SERVICE state; and\ne)\tthe UE is not attached for access to RLOS.\nIf conditions a, b, c and e are fulfilled, but the UE is in a state other than EMM-REGISTERED.NORMAL-SERVICE when timer T3324 expires, the UE may activate PSM when the MS returns to state EMM-REGISTERED.NORMAL-SERVICE.\nA UE that has already been allocated timer T3324 with a value different from \"deactivated\" and the timer T3324 has expired, may activate PSM if it receives an \"Extended wait time\" from lower layers.\nWhen PSM is activated all NAS timers are stopped and associated procedures aborted except for T3412, T3346, T3396, T3447, any backoff timers, and the timer T controlling the periodic search for HPLMN or EHPLMN (if the EHPLMN list is present) or higher prioritized PLMNs (see 3GPP TS 23.122 [6]).\nIf the UE is attached for emergency bearer services or has a PDN connection for emergency bearer services, the UE shall not activate PSM.\nIf the UE is attached for access to RLOS, the UE shall not activate PSM.\nThe UE may deactivate PSM and activate the AS layer at any time. Upon deactivating PSM, the UE may initiate EMM procedures (e.g. for the transfer of mobile originated signalling or user data).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.12\tExtended idle-mode DRX cycle",
                            "text_content": "The UE may request the use of extended idle-mode DRX cycle (eDRX) during an attach or tracking area updating procedure by including the extended DRX parameters IE (see 3GPP TS 23.682 [11A] and 3GPP TS 23.401 [10]). The UE shall not request the use of eDRX during:\n-\tan attach for emergency bearer services procedure;\n-\ta tracking area updating procedure for the UE attached for emergency bearer services; or\n-\tan attach for access to RLOS.\nThe UE and the network may negotiate eDRX parameters during a tracking area updating procedure when the UE has a PDN connection for emergency bearer services.\nThe network accepts the request to use the eDRX by providing the extended DRX parameters IE when accepting the attach or the tracking area updating procedure. The UE shall use eDRX only if it received the extended DRX parameters IE during the last attach or tracking area updating procedure and the UE does not have a PDN connection for emergency bearer services.\nNOTE:\tIf the UE wants to keep using eDRX, the UE includes the extended DRX parameters IE in each attach or tracking area updating procedure.\nIf the UE received the extended DRX parameters IE during the last attach or tracking area updating procedure, upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, the UE shall resume eDRX.\nIf the network has provided the extended DRX parameters IE during the last attach or tracking area updating procedure, upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, the network shall resume eDRX.\nIf the UE or the network locally releases the PDN connection for emergency bearer service, the UE or the network shall not use eDRX until the UE receives eDRX parameters during a tracking area updating procedure with EPS bearer context synchronization or upon successful completion of a service request procedure.\nIf the UE did not receive the extended eDRX parameters IE, or if the UE has a PDN connection for emergency bearer services, the UE shall use the stored UE specific DRX parameter, if available.\nIf the network did not accept the request to use eDRX, or if the UE has a PDN connection for emergency bearer services, the network shall use the stored UE specific DRX parameter, if available.\nIf the network provided the extended DRX parameters IE and also assigned a new GUTI for the UE as described in clause 5.5.3.2.4 during the last tracking area updating procedure, the network shall use the stored UE specific DRX parameter, if available, with the old GUTI and use the eDRX provided by the network with the new GUTI until the old GUTI can be considered as invalid by the network (see clause 5.4.1.4).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.13\tInteraction between power saving mode and extended idle mode DRX cycle",
                            "text_content": "The UE can request the use of both PSM and eDRX during an attach or tracking area updating procedure but it is up to the network to decide to enable none, one of them or both (see 3GPP TS 23.682 [11A] and 3GPP TS 23.401 [10]).\nIf the network accepts the use of both PSM (see clause 5.3.11) and eDRX (see clause 5.3.12), the extended DRX parameters IE provided to the UE should allow for multiple paging occasions before the active timer expires.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.14\tDedicated core network",
                            "text_content": "The network may reject mobility management signalling requests from UEs due to dedicated core network as specified in 3GPP TS 23.401 [10]. When the network rejects mobility management signalling requests due to dedicated core network, the mechanism for general NAS level mobility management congestion control as specified in clause 5.3.9 shall be followed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.15\tCIoT EPS optimizations",
                            "text_content": "CIoT EPS optimizations provide improved support of small data and SMS transfer. A UE supporting CIoT EPS optimizations can indicate the CIoT network behaviour the UE can support and prefers to use during attach or tracking area updating procedure (see 3GPP TS 23.401 [10]). The UE may indicate the support for control plane CIoT EPS optimization, user plane CIoT EPS optimization, EMM-REGISTERED without PDN connection, S1-U data transfer and header compression (see clause 9.9.3.34). The UE may also request to use SMS transfer without combined attach procedure during the attach procedure. Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT EPS optimization or user plane CIoT EPS optimization (see clause 9.9.3.0B). The indication of preference is also considered as the request to use. A UE supporting CIoT 5GS optimizations can also indicate the 5GS CIoT network behaviour the UE can support during attach or tracking area updating procedure. Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT 5GS optimization or user plane CIoT 5GS optimization.\nNOTE 1:\tThe UE supporting control plane CIoT EPS optimization and S1-U data transfer but not user plane CIoT EPS optimization does not indicate preference for user plane CIoT EPS optimization.\nThe UE can be in NB-S1 mode or WB-S1 mode when requesting the use of CIoT EPS optimizations during an attach or tracking area updating procedure. A UE in NB-S1 mode always indicates support for control plane CIoT EPS optimization. A UE in NB-S1 mode can also request SMS transfer without combined procedure by using the normal attach or tracking area updating procedure (see clause 5.5.1 and 5.5.3).\nIn NB-S1 mode, the UE, when requesting the use of CIoT EPS optimization, does not:\n-\trequest an attach for emergency bearer services procedure;\n-\trequest an attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to \"EPS emergency attach\";\n-\tindicate voice domain preference and UE's usage setting; or\n-\trequest an attach for access to RLOS.\nThe network does not indicate to the UE support of emergency bearer services when the UE is in NB-S1 mode (see clause 5.5.1.2.4 and 5.5.3.2.4).\nThe control plane CIoT EPS optimization enables support of efficient transport of user data (IP, non-IP, Ethernet) or SMS messages over control plane via the MME without triggering data radio bearer establishment. The support of control plane CIoT EPS optimization is mandatory for the network in NB-S1 mode and optional in WB-S1 mode. Optional header compression of IP data can be applied to IP PDN type PDN connections that are configured to support header compression.\nThe user plane CIoT EPS optimization enables support for change from EMM-IDLE mode to EMM-CONNECTED mode without the need for using the service request procedure (see clause 5.3.1.3).\nIf the UE indicates support of EMM-REGISTERED without PDN connection in the attach request, the UE may include an ESM DUMMY MESSAGE instead of a PDN CONNECTIVITY REQUEST message as part of the attach procedure. If the EMM-REGISTERED without PDN connection is supported by the network, the UE and the network can at any time release all the PDN connections and the UE still remains EPS attached.\nNOTE 2:\tFor both the UE and the network, the term \"EMM-REGISTERED without PDN connection\" is equivalent to the term \"EPS attach without PDN connectivity\" as specified in 3GPP TS 23.401 [10].\nIn NB-S1 mode, if the UE indicates \"SMS only\" during a normal attach or tracking area updating procedure, the MME supporting CIoT EPS optimisations provides SMS so that the UE is not required to perform a combined attach or tracking area updating procedure.\nIf the UE supports user plane CIoT EPS optimization, it shall also support S1-U data transfer.\nIf the UE indicates support of one or more CIoT EPS optimizations and the network supports one or more CIoT EPS optimizations and decides to accept the attach or tracking area update request, the network indicates the supported CIoT EPS optimizations to the UE per TAI list when accepting the UE request. Network indication of support is interpreted by the UE as the acceptance to use the respective feature. After completion of the attach or tracking area updating procedure, the UE and the network can then use the accepted CIoT EPS optimizations for the transfer of user data (IP, non-IP, Ethernet and SMS).\nThe UE supporting control plane CIoT EPS optimization may indicate support for control plane MT-EDT during the attach or tracking area updating procedure. For a UE that supports control plane MT-EDT and for which the network has accepted the use of control plane CIoT EPS optimization, the network may trigger the delivery of downlink data to the UE, when available, using procedures for control plane MT-EDT as specified in 3GPP TS 23.401 [10].\nThe UE supporting user plane CIoT EPS optimization may indicate support for user plane MT-EDT during the attach or tracking area updating procedure. For a UE that supports user plane MT-EDT and for which the network has accepted the use of user plane CIoT EPS optimization, the network may trigger the delivery of downlink data to the UE, when available, using procedures for user plane MT-EDT as specified in 3GPP TS 23.401 [10].\nIf the UE and the network support both the control plane CIoT EPS optimization and S1-U data transfer, then when receiving the UE's request for a PDN connection, the MME decides whether the PDN connection should be SCEF PDN connection or SGi PDN connection as specified in 3GPP TS 23.401 [10]:\n-\tif SCEF PDN connection is to be established for non-IP data type, the MME shall include Control plane only indication for the requested PDN connection;\n-\tif SGi PDN connection is to be established and existing SGi PDN connections for this UE were established with Control plane only indication, the MME shall include Control plane only indication for the newly requested SGi PDN connection;\n-\tif SGi PDN connection is to be established and existing SGi PDN connections for this UE were established without Control plane only indication, the MME shall not include Control plane only indication for the newly requested SGi PDN connection; and\n-\tif SGi PDN connection is to be established and no SGi PDN connection for this UE exists, the MME determine whether to include Control plane only indication for the requested SGi PDN connection based on local policies, the UE's preferred CIoT network behaviour and the supported CIoT network behaviour.\nIf the network supports user plane CIoT EPS optimization, it shall also support S1-U data transfer.\nBroadcast system information may provide information about support of CIoT EPS optimizations (see 3GPP TS 36.331 [22]). At reception of new broadcast system information, the lower layers deliver it to the EMM layer in the UE. The information provided by lower layers is per PLMN and used by the UE to determine whether certain CIoT EPS optimizations are supported in the cell.\nThe UE shall not attempt to use CIoT EPS optimizations which are indicated as not supported.\nIn NB-S1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of EMM-REGISTERED without PDN connection or user plane CIoT EPS optimization, the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers. If the UE requests the use of S1-U data transfer without user plane CIoT optimization, then the UE shall also pass an indication of user plane CIoT EPS optimization to lower layers.\nIn WB-S1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of EMM-REGISTERED without PDN connection, control plane CIoT EPS optimization or user plane CIoT EPS optimization, the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.16\tRestriction on use of enhanced coverage",
                            "text_content": "In order to deal with use of extensive resources from the network, the operator may prevent specific subscribers from using enhanced coverage (see 3GPP TS 23.401 [10]). When in NB-S1 mode, the UE shall indicate support for restriction on use of enhanced coverage. When in WB-S1 mode, the UE supporting either CE mode A or CE mode B shall indicate support for restriction on use of enhanced coverage. The UE supporting restriction on use of enhanced coverage indicates its support for restriction on use of enhanced coverage in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. If the UE supports restriction on use of enhanced coverage, the MME indicates whether the use of enhanced coverage is restricted or not in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see clause 5.5.1.2 and clause 5.5.3.2). If the use of enhanced coverage is restricted, the UE shall not use enhanced coverage in the registered PLMN and in any PLMN which is in the list of equivalent PLMNs.\nIf the UE supports CE mode B and the network determines that\n-\tthe use of enhanced coverage is not restricted for the UE; or\n-\tCE mode B is not restricted for the UE;\nthe applicable NAS timer values shall be calculated by the network as described in clause 4.8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.17\tService Gap Control",
                            "text_content": "The network may control the frequency UEs can transit from EMM-IDLE mode to EMM-CONNECTED mode via the service gap control (SGC) as specified in 3GPP TS 23.401 [10]. If the network supports service gap control (SGC) feature and the service gap time value is available in the EMM context of the UE, the MME shall consider SGC as active for the UE.\nThe UE and the network negotiate usage of the service gap control (SGC) feature during the attach and tracking area updating procedures:\n-\tthe UE supporting service gap control indicates its support for service gap control in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. If the UE supports service gap control and the SGC is active for the UE, the MME shall include service gap timer T3447 value in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see clause 5.5.1.2 and clause 5.5.3.2). The UE shall store the service gap time value; and\n-\tfor UEs that do not support the optional SGC feature when the network rejects mobility management signalling requests due to service gap control is active in the network, the mechanism for general NAS level mobility management congestion control as specified in clause 5.3.9 applies.\nThe UE shall start the SGC timer T3447 when the NAS signalling connection is released and if:\n-\tthe UE supports SGC feature, and the service gap timer value is available in the UE and does not indicate zero; and\n-\tthe NAS signalling connection released was not established for:\n-\tpaging;\n-\tattach requests without PDN connection request; or\n-\ttracking area update requests without \"active\" or \"signalling active\" flag set.\nIf the SGC is active in the network, after the UE transitions from EMM-CONNECTED mode to EMM-IDLE mode except when the UE was in EMM-CONNECTED mode due to:\n-\tpaging;\n-\tattach requests without PDN connection request; or\n-\ttracking area update requests without \"active\" or \"signalling active\" flag set,\nthe network shall start the SGC timer T3447:\n-\twith the service gap time value available in the EMM context minus 4 minutes, if the UE supports SGC feature and the service gap time value has been sent to the UE with a non-zero value; or\n-\twith the service gap time value available in the EMM context if the UE does not support SGC feature.\nWhen the SGC timer T3447 is running, the network allows:\n-\trequests for emergency bearer services;\n-\trequests for exception data reporting;\n-\tattach requests without PDN connection request;\n-\ttracking area update requests without \"active\" or \"signalling active\" flag set;\n-\trequests from UEs that were received via NAS signalling connections established with RRC establishment cause \"High priority access AC 11 – 15\"; and\n-\tmobile terminated service requests triggered by paging and subsequent MO signalling or MO data, if any, until the UE enters EMM-IDLE mode.\nIf the MME determines that the UE operating in single-registration mode has performed an inter-system change from S1 mode to N1 mode and the timer T3447 is running in the MME, the MME stops the T3447.\nUpon inter-system change from N1 mode to S1 mode, if the UE supports service gap control, T3447 is running in the UE, and the T3447 value is included in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message received from the MME (see clause 5.5.1.2 and clause 5.5.3.2), the UE shall keep T3447 running. Additionally, the UE shall store and replace the currently stored T3447 value with the received T3447 value. Upon expiry of the running T3447 timer, the UE shall use the new value when starting T3447 again.\nThe UE or the network with a running service gap timer shall keep the timer running when the UE transits from EMM-IDLE mode to EMM-CONNECTED mode.\nNOTE:\tIf the UE transitions from EMM-IDLE mode to EMM-CONNECTED mode due to attach request without PDN connection request or tracking area update request without \"active\" or \"signalling active\" flag set, the UE initiates no further MO signalling except for tracking area update request without \"active\" or \"signalling active\" flag set until the UE receives network-initiated signalling (e.g. DOWNLINK NAS TRANSPORT message for MT SMS) or MT data over user plane, or after the UE has moved to EMM-IDLE state and the service gap timer is not running.\nIf the timer T3447 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3447 is kept running until it expires.\nIf the UE is switched off when the timer T3447 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:\n-\tlet t1 be the time remaining for T3447 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.18\tRestricted local operator services",
                            "text_content": "Restricted local operator services (RLOS) is an optional feature that enables operators to offer access to restricted local operator services to the unauthenticated UEs in limited service state (see 3GPP TS 23.401 [10]). Authenticated UEs in limited service state may also be able to access restricted local operator services. The UE requests access to RLOS during the attach procedure by setting the attach type to \"EPS RLOS attach\" in the ATTACH REQUEST message. Subject to regulation and local operator policy, if the MME is configured to support access to RLOS, the MME accepts the UE's attach request regardless of the authentication result or skips the authentication procedure.\nWhen the UE requests the lower layer to establish an RRC connection for access to RLOS, the UE indicates in the RRC signalling that the RRC connection is for access to RLOS to the lower layers.\nThe UE supporting access to RLOS shall perform PLMN selection according to 3GPP TS 23.122 [6]. Broadcast system information may provide information about support of access to RLOS (see 3GPP TS 36.331 [22]). At reception of new broadcast system information, the lower layers deliver it to the EMM layer in the UE. The information provided by lower layers is per PLMN and used by the UE to determine whether the PLMN is configured to support access to RLOS. The UE shall not attempt to request access to RLOS if the PLMN does not support access to RLOS.\nNOTE:\tOnly authorized applications on the UE are allowed to trigger the initiation of RLOS connection (see 3GPP TS 33.401 [19]).\nFor UE attached for access to RLOS, only UE originated access to RLOS requests are supported. Mobile terminated access to RLOS request and network triggered service request are not allowed. The UE is not allowed to initiate UE requested PDN connectivity for any additional PDN connection. In addition, intersystem change to other RAT including GERAN and UTRAN and handover between 3GPP and non-3GPP accesses are not supported.\nAccess to RLOS is applicable to the UEs in WB-S1 mode only. The UEs in NB-S1 mode shall not request access to RLOS.\nLocation service does not apply to access to RLOS.\nIf a UE attached for access to RLOS needs to initiate an emergency call, the UE shall first perform a local detach prior to initiating an attach procedure for emergency bearer services.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.19\tCore Network selection and redirection for UEs using CIoT optimizations",
                            "text_content": "A UE that supports CIoT optimizations performs core network selection as specified in clause 4.8.4A.1 of 3GPP TS 24.501 [54].\nThe network that supports CIoT optimizations can redirect a UE between EPC and 5GCN as specified in clause 5.31.3 of 3GPP TS 23.501 [58]. The network can take into account the UE's N1 mode capability or S1 mode capability, the CIoT network behaviour supported and preferred by the UE or the CIoT network behaviour supported by the network to determine the redirection.\nNOTE:\tIt is assumed that the network would avoid redirecting the UE back and forth between EPC and 5GCN.\nThe network redirects the UE to 5GCN by rejecting the attach request, or tracking area update request, or service request with the EMM cause #31 \"Redirection to 5GCN required\" as specified in clause 5.5.1.2.5, 5.5.1.3.5, 5.5.3.2.5, 5.5.3.3.5 and 5.6.1.5. Upon receipt of reject message, the UE disables the E-UTRA capability as specified in clause 4.5 and enables the N1 mode capability if it was disabled in order to move to 5GCN.\nThe network that supports CIoT optimizations can also redirect a UE from 5GCN to EPC as specified in clause 4.8.4A.2 of 3GPP TS 24.501 [54].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.20\tUE radio capability signalling optimisation",
                            "text_content": "UE radio capability signalling optimisation (RACS) is a feature that is optional at both the UE and the network and which aims to optimise the transmission of UE radio capability over the radio interface (see 3GPP TS 23.401 [10]). RACS works by assigning an identifier to represent a set of UE radio capabilities. This identifier is called the UE radio capability ID. A UE radio capability ID can be either manufacturer-assigned or network-assigned. The UE radio capability ID is an alternative to the signalling of the radio capabilities container over the radio interface.\nIn this release of the specification, RACS is not applicable to NB-S1 mode.\nIf the UE supports RACS:\n-\tthe UE shall indicate support for RACS by setting the RACS bit to \"RACS supported\" in the UE network capability IE of the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST messages;\n-\tif the UE performs an attach procedure and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include the UE radio capability ID availability IE in the ATTACH REQUEST message and set the IE to \"UE radio capability ID available\";\n-\tif the UE performs a tracking area updating procedure and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message and set the IE to \"UE radio capability ID available\";\n-\tIf the UE is requested to provide the UE radio capability ID by the network during a security mode control procedure, the UE shall include the UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message according to the rules in clause 5.4.3.3.;\n-\tif the radio configuration at the UE changes (for instance because the UE has disabled a specific radio capability) then:\na)\tif the UE has an applicable UE radio capability ID for the new UE radio configuration, the UE shall initiate a tracking area updating procedure, include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message and set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message; and\nb)\tif the UE does not have an applicable UE radio capability ID for the new UE radio configuration, the UE shall initiate a tracking area updating procedure and shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message;\nNOTE:\tPerforming the tracking area updating procedure with the UE radio capability information update needed IE included in the TRACKING AREA UPDATE REQUEST message and without the UE radio capability ID availability IE set to \"UE radio capability ID available\" in the TRACKING AREA UPDATE REQUEST message as specified in b) above can trigger the network to assign a new UE radio capability ID to the UE.\n-\tupon receiving a network-assigned UE radio capability ID in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message, the UE shall store the network-assigned UE radio capability ID and the PLMN ID of the serving network along with a mapping to the current UE radio configuration in its non-volatile memory as specified in annex C. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs with the associated PLMN ID and the mapping to the corresponding UE radio configuration;\n-\tthe UE shall not use a network-assigned UE radio capability ID in PLMNs equivalent to the PLMN which assigned it; and\n-\tupon receiving a UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\" in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message, the UE shall delete all network-assigned UE radio capability IDs stored at the UE for the serving network and initiate a tracking area updating procedure. If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include a UE radio capability ID availability IE set to \"UE radio capability ID available\" in the TRACKING AREA UPDATE REQUEST message.\nIf the network supports RACS:\n-\tif the UE has included the UE radio capability ID availability IE in the ATTACH REQUEST message and set the IE to \"UE radio capability ID available\", the network shall initiate a security mode control procedure to retrieve the UE radio capability ID from the UE;\n-\tif the UE has included the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message and set the IE to \"UE radio capability ID available\", the network may initiate a security mode control procedure to retrieve the UE radio capability ID from the UE;\n-\tif the UE has included the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message, set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE and no UE radio capability ID is available in the UE context in the MME, the network shall initiate a security mode control procedure to retrieve the UE radio capability ID from the UE;\n-\tthe network may assign a network-assigned UE radio capability ID to a UE which supports RACS by including a UE radio capability ID IE in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message; and\n-\tthe network may trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving network by including a UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\" in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.21\tWake-up signal assistance",
                            "text_content": "A UE supporting wake-up signal (WUS) assistance can indicate its WUS assistance capability during attach or tracking area updating procedure (see 3GPP TS 23.401 [10]). The UE supporting WUS assistance may include its UE paging probability information in the Requested WUS assistance information IE during an attach or tracking area updating procedure (see 3GPP TS 23.401 [10]). The UE shall not include its UE paging probability information during:\n-\tan attach for emergency bearer services procedure;\n-\tan attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to \"EPS emergency attach\";\n-\ta tracking area updating procedure for initiating a PDN connection for emergency bearer services; or.\n-\ta tracking area updating procedure when the UE has a PDN connection established for emergency bearer services.\nThe UE and the network may negotiate the UE paging probability information during an attach or tracking area updating procedure when the UE is not attached for emergency bearer services. The UE paging probability information is an assistance information used to determine the WUS group for paging UE (see 3GPP TS 23.401 [10], 3GPP TS 36.300 [20]).\nNOTE:\tThe determination of UE paging probability information is up to UE implementation.\nIf the UE is not attached for emergency bearer services and the network accepts the use of the WUS assistance for the UE, the network determines the negotiated UE paging probability information for the UE based on the requested UE paging probability information, if any, local configuration or previous statistical information for the UE, and then indicates the negotiated UE paging probability information in the Negotiated WUS assistance information IE to the UE when accepting the attach or the tracking area updating procedure. The network shall store the negotiated UE paging probability information in the EMM context of the UE for paging.\nThe UE shall use WUS assistance only if it received the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure. If the UE did not receive the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure, the UE shall delete any existing WUS assistance information received from the network.\nIf the network did not accept the request to use WUS assistance, the network shall delete the stored negotiated UE paging probability information for the UE, if available.\nWhen a PDN connection for emergency bearer service is successfully established after the UE received the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure, the UE and the network shall not use WUS assistance information until:\n-\tthe successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, or\n-\tthe UE receives WUS assistance information during a tracking area updating procedure with EPS bearer context synchronization or upon successful completion of a service request procedure, if the UE or the network locally releases the PDN connection for emergency bearer service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.22\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.4\tEMM common procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.4.1\tGUTI reallocation procedure",
                            "text_content": "The purpose of the GUTI reallocation procedure is to allocate a GUTI and optionally to provide one or more of the following to a particular UE:\n-\ta new TAI list;\n-\ta new DCN-ID; and\n-\tin WB-S1 mode, if the UE supports RACS, either a UE radio capability ID deletion indication or a UE radio capability ID.\nThe reallocation of a GUTI is performed by the unique procedure defined in this clause. This procedure can only be initiated by the MME in state EMM-REGISTERED.\nThe GUTI can also be implicitly reallocated at attach or tracking area updating procedures. The implicit reallocation of a GUTI is described in the clauses which specify these procedures (see clause 5.5.1 and 5.5.3).\nThe PLMN identity in the GUTI indicates the current registered PLMN.\nNOTE 1:\tThe GUTI reallocation procedure is usually performed in ciphered mode.\nNOTE 2:\tNormally, the GUTI reallocation will take place in conjunction with another mobility management procedure, e.g. as part of tracking area updating.\nThe MME shall initiate the GUTI reallocation procedure by sending a GUTI REALLOCATION COMMAND message to the UE and starting the timer T3450 (see example in figure 5.4.1.2.1).\nThe GUTI REALLOCATION COMMAND message shall include a GUTI and may include one or more of the following:\n-\ta TAI list;\n-\ta DCN-ID; and\n-\tin WB-S1 mode, if the UE supports RACS, either a UE radio capability ID deletion indication or a UE radio capability ID.\nThe figure depicts a reallocation procedure for GUTI (Gutierrez-Urquiza-Trujillo-Ibarra) in a telecommunications network. The diagram illustrates the steps involved in the reallocation process, including the identification of the affected nodes, the initiation of the reallocation process, and the completion of the reallocation. The figure is a visual representation of the complex process, providing a clear and concise overview of the reallocation procedure.\nFigure 5.4.1.2.1: GUTI reallocation procedure\nUpon receipt of the GUTI REALLOCATION COMMAND message, the UE shall:\n-\tstore the GUTI;\n-\tstore the TAI list, if provided;\n-\tstore the DCN-ID, if provided;\n-\tin WB-S1 mode, if the UE supports RACS and the GUTI REALLOCATION COMMAND message includes:\na)\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE, then the UE shall, after the completion of the ongoing GUTI reallocation procedure, initiate a tracking area updating procedure as specified in clause 5.5.3. If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration, the UE shall include the UE radio capability ID availability IE set to \"UE radio capability ID available\" in the TRACKING AREA UPDATE REQUEST message; or\nb)\ta UE radio capability ID IE, store the UE radio capability ID as specified in annex C; and\n-\tsend a GUTI REALLOCATION COMPLETE message to the MME.\nThe UE considers the new GUTI as valid and the old GUTI as invalid. If the UE receives a new TAI list in the GUTI REALLOCATION COMMAND message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid.\nIf the GUTI REALLOCATION COMMAND message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C.\nUpon receipt of the GUTI REALLOCATION COMPLETE message, the MME shall stop the timer T3450 and consider the new GUTI as valid and the old GUTI as invalid. If a new TAI list is provided in the GUTI REALLOCATION COMMAND message, the MME shall consider the new TAI list as valid and the old TAI list as invalid.\nThe following abnormal cases can be identified:\na)\tTransmission failure of GUTI REALLOCATION COMPLETE message indication with TAI change from lower layers\nIf the current TAI is not in the TAI list, the GUTI reallocation procedure shall be aborted and a tracking area updating procedure shall be initiated.\nIf the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure.\nb)\tTransmission failure of GUTI REALLOCATION COMPLETE message indication without TAI change from lower layers\nIt is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure.\nThe following abnormal cases can be identified:\na)\tLower layer failure\nIf a lower layer failure is detected before the GUTI REALLOCATION COMPLETE message is received, the old and the new GUTI shall be considered as valid until the old GUTI can be considered as invalid by the network. If a new TAI list was provided in the GUTI REALLOCATION COMMAND message, the old and new TAI list shall also be considered as valid until the old TAI list can be considered as invalid by the network.\nDuring this period the network:\n-\tmay first use the old S-TMSI from the old GUTI for paging within the area defined by the old TAI list for an implementation dependent number of paging attempts for network originated transactions. If a new TAI list was provided with old GUTI in the GUTI REALLOCATION COMMAND message, the new TAI list should also be used for paging. Upon response from the UE, the network may re-initiate the GUTI reallocation. If the response is received from a tracking area within the old and new TAI list, the network shall re-initiate the GUTI reallocation. If no response is received to the paging attempts, the network may use the new S-TMSI from the new GUTI for paging for an implementation dependent number of paging attempts. In this case, if a new TAI list was provided with new GUTI in the GUTI REALLOCATION COMMAND message, the new TAI list shall be used instead of the old TAI list. Upon response from the UE the network shall consider the new GUTI as valid and the old GUTI as invalid. If no response is received to the paging attempts, the network may use the IMSI for paging for an implementation dependent number of paging attempts;\nNOTE 1:\tPaging with IMSI causes the UE to re-attach as described in clause .2.2.\n-\tshall consider the new GUTI as valid if it is used by the UE and, additionally, the new TAI list as valid if it was provided with this GUTI in the GUTI REALLOCATION COMMAND message;\n-\tmay use the identification procedure followed by a new GUTI reallocation if the UE uses the old GUTI; and\n-\tif the network accepted to use eDRX for the UE, may determine the next paging window from both old GUTI and new GUTI, and may first use the S-TMSI from the GUTI which led the first eDRX for paging. If no response is received to the paging attempts for the first eDRX, the network may use the other S-TMSI from the other GUTI which led the second eDRX for paging. For this paging procedure, the network shall start timer T3415 long enough to care the paging attempts for both eDRXs.\nNOTE 2:\tIf the second eDRX comes during the first eDRX ongoing, the paging attempts for the second eDRX can be initiated with stopping further paging attempts for the first eDRX.\nb)\tExpiry of timer T3450\nThe GUTI reallocation procedure is supervised by the timer T3450. The network shall, on the first expiry of timer T3450, reset and restart timer T3450 and shall retransmit the GUTI REALLOCATION COMMAND. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3450, the network shall abort the reallocation procedure and shall follow the rules described for case a above.\nc)\tGUTI reallocation and attach procedure collision\nIf the network receives an ATTACH REQUEST message before the ongoing GUTI reallocation procedure has been completed the network shall proceed with the attach procedure after deletion of the EMM context.\nd)\tGUTI reallocation and UE initiated detach procedure collision\nIf the network receives a DETACH REQUEST message before the ongoing GUTI reallocation procedure has been completed, the network shall abort the GUTI reallocation procedure and shall progress the detach procedure.\ne)\tGUTI reallocation and tracking area updating procedure collision\nIf the network receives a TRACKING AREA UPDATE REQUEST message before the ongoing GUTI reallocation procedure has been completed, the network shall abort the GUTI reallocation procedure and shall progress the tracking area updating procedure. The network may then perform a new GUTI reallocation.\nf)\tGUTI reallocation and service request procedure collision\nIf the network receives an EXTENDED SERVICE REQUEST message for CS fallback or 1xCS fallback before the ongoing GUTI reallocation procedure has been completed, the network shall progress both procedures.\ng)\tLower layer indication of non-delivered NAS PDU due to handover\nIf the GUTI REALLOCATION COMMAND message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the GUTI REALLOCATION COMMAND message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the GUTI REALLOCATION COMMAND message.\nIf there is a different new GUTI and optionally a new TAI list included in a subsequent GUTI REALLOCATION COMMAND message, the UE always regards the newest GUTI and the newest TAI list as valid for the recovery time.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.2\tAuthentication procedure",
                            "text_content": "The purpose of the EPS authentication and key agreement (AKA) procedure is to provide mutual authentication between the user and the network and to agree on a key KASME (see 3GPP TS 33.401 [19]). The cases when the EPS AKA procedure should be used are defined in 3GPP TS 33.401 [19].\nThe EPS AKA procedure is always initiated and controlled by the network. However, the UE can reject the EPS authentication challenge sent by the network.\nThe UE shall proceed with an EPS authentication challenge only if a USIM is present.\nA partial native EPS security context is established in the UE and the network when an EPS authentication is successfully performed. During a successful EPS authentication procedure, the CK and IK are computed by the USIM. CK and IK are then used by the ME as key material to compute a new key, KASME. KASME is stored in the EPS security contexts (see 3GPP TS 33.401 [19]) of both the network and in the volatile memory of the ME while attached to the network, and is the root for the EPS integrity protection and ciphering key hierarchy.\nWhen a NAS signalling connection exists, the network can initiate an authentication procedure at any time. For restrictions applicable after handover or inter-system handover to S1 mode see clause 5.5.3.2.3.\nThe network initiates the authentication procedure by sending an AUTHENTICATION REQUEST message to the UE and starting the timer T3460 (see example in figure 5.4.2.2.1). The AUTHENTICATION REQUEST message contains the parameters necessary to calculate the authentication response (see 3GPP TS 33.401 [19]).\nIf an eKSI is contained in an initial NAS message during an EMM procedure, the network shall include a different eKSI value in the AUTHENTICATION REQUEST message when it initiates an authentication procedure.\nThe figure depicts the authentication procedure in a 5G network, illustrating the steps involved in verifying the identity of a user. It includes the use of physical security elements such as biometric sensors and access control systems. The figure also highlights the importance of network security protocols like Secure Element (SE) and Secure Element Management (SEAM) in ensuring the integrity and confidentiality of data.\nFigure 5.4.2.2.1: Authentication procedure\nThe UE shall respond to an AUTHENTICATION REQUEST message. With the exception of the cases described in clauses 5.4.2.6 and 5.4.2.7 case k, the UE shall process the authentication challenge data and respond with an AUTHENTICATION RESPONSE message to the network.\nUpon a successful EPS authentication challenge, the UE shall determine the PLMN identity to be used for the calculation of the new KASME from the authentication challenge data according to the following rules:\na)\tWhen the UE moves from EMM-IDLE mode to EMM-CONNECTED mode, until the first handover, the UE shall use the PLMN identity of the selected PLMN; and\nb)\tAfter handover or inter-system handover to S1 mode,\n-\tif the target cell is not a shared network cell, the UE shall use the PLMN identity received as part of the broadcast system information;\n-\tif the target cell is a shared network cell and the UE has a valid GUTI, the UE shall use the PLMN identity that is part of the GUTI; and\n-\tif the target cell is a shared network cell, the UE does not have a valid GUTI and,\n-\tthe EPS authentication challenge is performed after inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode and the UE has a valid P-TMSI and RAI, the UE shall use the PLMN identity that is part of the RAI; or\n-\tthe EPS authentication challenge is performed after inter-system handover from N1 mode to S1 mode and the UE has a valid 5G-GUTI, the UE shall use the PLMN identity that is part of the 5G-GUTI.\nUpon a successful EPS authentication challenge, the new KASME calculated from the authentication challenge data shall be stored in a new EPS security context in the volatile memory of the ME.\nThe USIM will compute the authentication response (RES) using the authentication challenge data received from the ME, and pass RES to the ME.\nIn order to avoid a synchronisation failure, when the UE receives an AUTHENTICATION REQUEST message, the UE shall store the received RAND together with the RES returned from the USIM in the volatile memory of the ME. When the UE receives a subsequent AUTHENTICATION REQUEST message, if the stored RAND value is equal to the new received value in the AUTHENTICATION REQUEST message, then the ME shall not pass the RAND to the USIM, but shall send the AUTHENTICATION RESPONSE message with the stored RES. If there is no valid stored RAND in the ME or the stored RAND is different from the new received value in the AUTHENTICATION REQUEST message, the ME shall pass the RAND to the USIM, shall override any previously stored RAND and RES with the new ones and start, or reset and restart timer T3416.\nThe RAND and RES values stored in the ME shall be deleted and timer T3416, if running, shall be stopped:\n-\tupon receipt of a\n-\tSECURITY MODE COMMAND,\n-\tSERVICE REJECT,\n-\tSERVICE ACCEPT,\n-\tTRACKING AREA UPDATE REJECT,\n-\tTRACKING AREA UPDATE ACCEPT, or\n-\tAUTHENTICATION REJECT message;\n-\tupon expiry of timer T3416;\n-\tif the UE enters the EMM state EMM-DEREGISTERED or EMM-NULL; or\n-\tif the UE enters EMM-IDLE mode.\nUpon receipt of an AUTHENTICATION RESPONSE message, the network stops the timer T3460 and checks the correctness of RES (see 3GPP TS 33.401 [19]).\nIf the authentication procedure has been completed successfully and the related eKSI is stored in the EPS security context of the network, the network shall include a different eKSI value in the AUTHENTICATION REQUEST message when it initiates a new authentication procedure.\nUpon receipt of an AUTHENTICATION FAILURE message, the network stops the timer T3460. In the case where the EMM cause #21 \"synch failure\" is received, the core network may renegotiate with the HSS/AuC and provide the UE with new authentication parameters.\nIf the authentication response (RES) returned by the UE is not valid, the network response depends upon the type of identity used by the UE in the initial NAS message, that is:\n-\tif the GUTI was used; or\n-\tif the IMSI was used.\nIf the GUTI was used, the network should initiate an identification procedure. If the IMSI given by the UE during the identification procedure differs from the IMSI the network had associated with the GUTI, the authentication should be restarted with the correct parameters. Otherwise, if the IMSI provided by the UE is the same as the IMSI stored in the network (i.e. authentication has really failed), the network should send an AUTHENTICATION REJECT message to the UE.\nIf the IMSI was used for identification in the initial NAS message, or the network decides not to initiate the identification procedure after an unsuccessful authentication procedure, the network should send an AUTHENTICATION REJECT message to the UE. The network shall maintain, if any, the EMM-context and EPS security context unchanged.\nUpon receipt of an AUTHENTICATION REJECT message,\na)\tif the message has been successfully integrity checked by the NAS, the UE shall set the update status to EU3 ROAMING NOT ALLOWED, delete the stored GUTI, TAI list, last visited registered TAI and KSIASME. The USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed. If the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value. If the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf A/Gb or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the authentication and ciphering procedure is not accepted by the network.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the authentication procedure performed over 3GPP access is not accepted by the network; and\nb)\tif the message is received without integrity protection and if timer T3416, T3418 or T3420 is running, the UE shall start timer T3247 (see 3GPP TS 24.008 [13]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see clause 5.3.7b). Additionally, the UE shall:\n-\tif the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter has a value less than a UE implementation-specific maximum value, proceed as specified in clause 5.3.7b, list item 1a for the case that the EMM cause value received is #3; and\n-\totherwise proceed as specified under list item a above for the case that the message has been successfully integrity checked.\nIf the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any EMM signalling procedure, stop any of the timers T3410, T3416, T3417, T3430, T3421, T3418 or T3420 (if they were running) and enter state EMM-DEREGISTERED.\nDepending on local requirements or operator preference for emergency bearer services, if the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services, the MME need not follow the procedures specified for the authentication failure in the present clause. The MME may continue a current EMM specific procedure or PDN connectivity request procedure. Upon completion of the authentication procedure, if not initiated as part of another procedure, or upon completion of the EMM procedure or PDN connectivity request procedure, the MME shall deactivate all non-emergency EPS bearers, if any, by initiating an EPS bearer context deactivation procedure. The network shall consider the UE to be attached for emergency bearer services only.\nDepending on local regulation and operator policy, if the UE is requesting attach for access to RLOS, the MME need not follow the procedures specified for the authentication failure in the present clause. The MME may continue a current EMM specific procedure.\nIn an EPS authentication challenge, the UE shall check the authenticity of the core network by means of the AUTN parameter received in the AUTHENTICATION REQUEST message. This enables the UE to detect a false network.\nDuring an EPS authentication procedure, the UE may reject the core network due to an incorrect AUTN parameter (see 3GPP TS 33.401 [19]). This parameter contains three possible causes for authentication failure:\na)\tMAC code failure:\nIf the UE finds the MAC code (supplied by the core network in the AUTN parameter) to be invalid, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #20 \"MAC failure\". The UE shall then follow the procedure described in clause 5.4.2.7, item c.\nb)\tNon-EPS authentication unacceptable:\nIf the UE finds that the \"separation bit\" in the AMF field of AUTN supplied by the core network is 0, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #26 \"non-EPS authentication unacceptable\" (see clause 6.1.1 in 3GPP TS 33.401 [19]). The UE shall then follow the procedure described in clause 5.4.2.7, item d.\nc)\tSQN failure:\nIf the UE finds the SQN (supplied by the core network in the AUTN parameter) to be out of range, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #21 \"synch failure\" and a re-synchronization token AUTS provided by the USIM (see 3GPP TS 33.102 [18]). The UE shall then follow the procedure described in clause 5.4.2.7, item e.\nIf the UE returns an AUTHENTICATION FAILURE message to the network, the UE shall delete any previously stored RAND and RES and shall stop timer T3416, if running.\nIf the UE has a PDN connection for emergency bearer services established or is establishing such a PDN connection, additional UE requirements are specified in clause 5.4.2.7, under \"for items c, d, e\".\nIf the UE is attached for access to RLOS and has a PDN connection for RLOS established or is establishing such a PDN connection, additional UE requirements are specified in clause 5.4.2.7, under \"for items c, d, e\".\na)\tLower layer failure:\nUpon detection of lower layer failure before the AUTHENTICATION RESPONSE message is received, the network shall abort the procedure.\nb)\tExpiry of timer T3460:\nThe network shall, on the first expiry of the timer T3460, retransmit the AUTHENTICATION REQUEST message and shall reset and start timer T3460. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3460, the network shall abort the authentication procedure and any ongoing EMM specific procedure and release the NAS signalling connection.\nc)\tAuthentication failure (EMM cause #20 \"MAC failure\"):\nThe UE shall send an AUTHENTICATION FAILURE message, with EMM cause #20 \"MAC failure\" according to clause 5.4.2.6, to the network and start timer T3418 (see example in figure 5.4.2.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #20 \"MAC failure\", the network may initiate the identification procedure described in clause 5.4.4. This is to allow the network to obtain the IMSI from the UE. The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall send the IDENTITY RESPONSE message.\nNOTE 1:\tUpon receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #20 \"MAC failure\", the network may also terminate the authentication procedure (see clause 5.4.2.5).\nIf the GUTI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3418, if running, and then process the challenge information as normal. If the GUTI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message (see clause 5.4.2.5).\nIf the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid SQN and MAC is received), the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.\nIf the UE receives the second AUTHENTICATION REQUEST message while T3418 is running, and the MAC value cannot be resolved, the UE shall follow the procedure specified in this clause, item c, starting again from the beginning, or if the message contains a UMTS authentication challenge, the UE shall follow the procedure specified in item d. If the SQN is invalid, the UE shall proceed as specified in item e.\nThe given telecommunication figure, labeled as \"Figure 5.4.2.7.1: Authentication failure procedure (EMM cause #20 \"MAC failure\" or \n#26 \"non-EPS authentication unacceptable\"), depicts a detailed process for resolving authentication failures in an Ethernet Media Access Control (MAC) network. The figure illustrates the steps involved in the authentication process, including the steps to check for MAC failure and non-EPS authentication. The figure also includes a legend to help users understand the different colors and symbols used in the process.\nFigure 5.4.2.7.1: Authentication failure procedure (EMM cause #20 \"MAC failure\" or\n#26 \"non-EPS authentication unacceptable\")\nd)\tAuthentication failure (EMM cause #26 \"non-EPS authentication unacceptable\"):\nThe UE shall send an AUTHENTICATION FAILURE message, with EMM cause #26 \"non-EPS authentication unacceptable\", to the network and start the timer T3418 (see example in figure 5.4.2.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #26 \"non-EPS authentication unacceptable\", the network may initiate the identification procedure described in clause 5.4.4. This is to allow the network to obtain the IMSI from the UE. The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall send the IDENTITY RESPONSE message.\nNOTE 2:\tUpon receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #26 \"non-EPS authentication unacceptable\", the network may also terminate the authentication procedure (see clause 5.4.2.5).\nIf the GUTI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3418, if running, and then process the challenge information as normal. If the GUTI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message (see clause 5.4.2.5).\ne)\tAuthentication failure (EMM cause #21 \"synch failure\"):\nThe UE shall send an AUTHENTICATION FAILURE message, with EMM cause #21 \"synch failure\", to the network and start the timer T3420 (see example in figure 5.4.2.7.2). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with the EMM cause #21 \"synch failure\", the network shall use the returned AUTS parameter from the authentication failure parameter IE in the AUTHENTICATION FAILURE message, to re-synchronise. The re-synchronisation procedure requires the MME to delete all unused authentication vectors for that IMSI and obtain new vectors from the HSS. When re-synchronisation is complete, the network shall initiate the authentication procedure. Upon receipt of the AUTHENTICATION REQUEST message, the UE shall stop the timer T3420, if running.\nNOTE 3:\tUpon receipt of two consecutive AUTHENTICATION FAILURE messages from the UE with EMM cause #21 \"synch failure\", the network may terminate the authentication procedure by sending an AUTHENTICATION REJECT message.\nIf the network is validated successfully (a new AUTHENTICATION REQUEST message is received which contains a valid SQN and MAC) while T3420 is running, the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.\nIf the UE receives the second AUTHENTICATION REQUEST message while T3420 is running, and the MAC value cannot be resolved, the UE shall follow the procedure specified in item c or if the message contains a UMTS authentication challenge, the UE shall proceed as specified in item d; if the SQN is invalid, the UE shall follow the procedure specified in this clause, item e, starting again from the beginning.\nThe given telecommunication figure, labeled as \"Figure 5.4.2.7.2: Authentication failure procedure (EMM cause #21 \"synch failure\"),\" depicts a detailed process for resolving an authentication failure in an Ethernet Media Access Control (MAC) protocol. The figure illustrates the steps taken to troubleshoot and resolve the issue, including the steps to check the network interface card (NIC) and the steps to reset the network interface controller (NIC). The figure also includes a diagram of the network interface card (NIC) and the steps to reset the network interface controller (NIC).\nFigure 5.4.2.7.2: Authentication failure procedure (EMM cause #21 \"synch failure\")\nUpon receipt of an AUTHENTICATION REJECT message, the UE shall perform the actions as specified in clause 5.4.2.5.\nf)\tNetwork failing the authentication check:\nIf the UE deems that the network has failed the authentication check, then it shall request RRC to locally release the RRC connection and treat the active cell as barred (see 3GPP TS 36.304 [21]). The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), if they were running and stopped when the UE received the first AUTHENTICATION REQUEST message containing an incorrect authentication challenge data causing the authentication failure.\ng)\tTransmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication from lower layers (if the authentication procedure is triggered by a tracking area updating procedure or an attach procedure)\nThe UE shall stop any of the timers T3418 and T3420, if running, and re-initiate the tracking area updating procedure if the authentication procedure is triggered by a tracking area updating procedure.\nThe UE shall stop any of the timers T3418 and T3420, if running, and re-initiate the attach procedure if the authentication procedure is triggered by an attach procedure.\nh)\tTransmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication with TAI change from lower layers (if the authentication procedure is triggered by a service request procedure)\nThe UE shall stop any of the timers T3418 and T3420, if running.\nIf the current TAI is not in the TAI list, the authentication procedure shall be aborted and a tracking area updating procedure shall be initiated.\nIf the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the authentication procedure.\ni)\tTransmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication without TAI change from lower layers (if the authentication procedure is triggered by a service request procedure)\nThe UE shall stop any of the timers T3418 and T3420, if running. It is up to the UE implementation how to re-run the ongoing procedure that triggered the authentication procedure.\nj)\tLower layers indication of non-delivered NAS PDU due to handover\nIf the AUTHENTICATION REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the AUTHENTICATION REQUEST message. If a failure of handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the AUTHENTICATION REQUEST message.\nk)\tChange of cell into a new tracking area\nIf the UE detects the current TAI is not in the TAI list occurs before the AUTHENTICATION RESPONSE message is sent, the UE may discard sending the AUTHENTICATION RESPONSE message to the network and continue with the initiation of tracking area updating procedure as described in clause 5.5.3.\nl)\tAUTHENTICATION REJECT message is received without integrity protection and none of the timers T3416, T3418 and T3420 is running\nIf an AUTHENTICATION REJECT message is received and if none of the timers T3416, T3418 and T3420 is running, then the UE shall discard the AUTHENTICATION REJECT message. Additionally, the UE may request RRC to locally release the RRC connection and treat the active cell as barred (see 3GPP TS 36.304 [21]).\nFor items c, d, and e if the UE does not have a PDN connection for emergency bearer services established, is not establishing a PDN connection for emergency bearer services, does not have a PDN connection for RLOS established and is not establishing a PDN connection for RLOS:\nThe UE shall stop any of the timers T3418 and T3420, if running, and the UE enters EMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the NAS signalling connection, or as the result of an inter-system handover to A/Gb mode, Iu mode or N1 mode.\nThe UE shall deem that the network has failed the authentication check or that the source of the authentication challenge is not genuine and proceed as described in item f if any of the following occurs:\n-\tthe timer T3418 or T3420 expires;\n-\tthe UE detects any combination of the authentication failures: EMM cause #20 \"MAC failure\", #21 \"synch failure\", or #26 \"non-EPS authentication unacceptable\", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only if the authentication challenges causing the second and third authentication failure are received by the UE while the timer T3418 or T3420 started after the previous authentication failure is running.\nFor items c, d, and e if the UE has a PDN connection for emergency bearer services established, is establishing a PDN connection for emergency bearer services, has a PDN connection for RLOS established, or is establishing a PDN connection for RLOS:\n1)\tThe UE shall stop any of the timers T3418 and T3420, if running, and the UE enters EMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the NAS signalling connection, or as the result of an inter-system handover to A/Gb mode, Iu mode or N1 mode.\n2)\tDepending on local requirements or operator preference for emergency bearer services, if the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services, the MME need not follow the procedures specified for the authentication failure specified in the present clause. The MME may respond to the AUTHENTICATION FAILURE message by initiating the security mode control procedure selecting the \"null integrity protection algorithm\" EIA0, \"null ciphering algorithm\" EEA0 or may abort the authentication procedure and continue using the current security context, if any. The MME shall deactivate all non-emergency EPS bearer contexts, if any, by initiating an EPS bearer context deactivation procedure. If there is an ongoing PDN connectivity procedure, the MME shall deactivate all non-emergency EPS bearer contexts upon completion of the PDN connectivity procedure. The network shall consider the UE to be attached for emergency bearer services only.\nIf a UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services and sends an AUTHENTICATION FAILURE message to the MME with the EMM cause appropriate for these cases (#20, #21, or #26, respectively) and receives the SECURITY MODE COMMAND message before the timeout of timer T3418 or T3420, the UE shall deem that the network has passed the authentication check successfully, stop timer T3418 or T3420, respectively, and execute the security mode control procedure.\nIf a UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services when timer T3418 or T3420 expires, the UE shall not deem that the network has failed the authentication check and not behave as described in item f. Instead the UE shall continue using the current security context, if any, deactivate all non-emergency EPS bearer contexts, if any, by initiating UE requested PDN disconnect procedure. If there is an ongoing PDN connectivity procedure, the UE shall deactivate all non-emergency EPS bearer contexts upon completion of the PDN connectivity procedure.\nThe UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if:\n-\tthey were running and stopped when the UE received the AUTHENTICATION REQUEST message and detected an authentication failure; and\n-\tthe procedures associated with these timers have not yet been completed.\nThe UE shall consider itself to be attached for emergency bearer services only.\n3)\tDepending on local regulation and operator policy, if the UE has a PDN connection for RLOS established or is establishing a PDN connection for RLOS, the MME need not follow the procedures specified for the authentication failure specified in the present clause. The MME may respond to the AUTHENTICATION FAILURE message by initiating the security mode control procedure selecting the \"null integrity protection algorithm\" EIA0, \"null ciphering algorithm\" EEA0 or may abort the authentication procedure and continue using the current security context, if any. The network shall consider the UE to be attached for access to RLOS.\nIf a UE has a PDN connection for RLOS established or is establishing a PDN connection for RLOS and sends an AUTHENTICATION FAILURE message to the MME with the EMM cause appropriate for these cases (#20, #21, or #26, respectively) and receives the SECURITY MODE COMMAND message before the timeout of timer T3418 or T3420, the UE shall deem that the network has passed the authentication check successfully, stop timer T3418 or T3420, respectively, and execute the security mode control procedure.\nIf a UE has a PDN connection for RLOS established or is establishing a PDN connection for RLOS when timer T3418 or T3420 expires, the UE shall not deem that the network has failed the authentication check and not behave as described in item f. Instead the UE shall continue using the current security context, if any.\nThe UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if:\n-\tthey were running and stopped when the UE received the AUTHENTICATION REQUEST message and detected an authentication failure; and\n-\tthe procedures associated with these timers have not yet been completed.\nThe UE shall consider itself to be attached for access to RLOS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.3\tSecurity mode control procedure",
                            "text_content": "The purpose of the NAS security mode control procedure is to take an EPS security context into use, and initialise and start NAS signalling security between the UE and the MME with the corresponding EPS NAS keys and EPS security algorithms.\nFurthermore, the network may also initiate the security mode control procedure in the following cases:\n-\tin order to change the NAS security algorithms for a current EPS security context already in use;\n-\tin order to change the value of uplink NAS COUNT used in the latest SECURITY MODE COMPLETE message as described in 3GPP TS 33.401 [19], clause 7.2.9.2; and\n-\tin order to request the UE radio capability ID from the UE.\nFor restrictions concerning the concurrent running of a security mode control procedure with other security related procedures in the AS or inside the core network see 3GPP TS 33.401 [19], clause .\nThe MME initiates the NAS security mode control procedure by sending a SECURITY MODE COMMAND message to the UE and starting timer T3460 (see example in figure 5.4.3.2.1).\nThe MME shall reset the downlink NAS COUNT counter and use it to integrity protect the initial SECURITY MODE COMMAND message if the security mode control procedure is initiated:\n-\tto take into use the EPS security context created after a successful execution of the EPS authentication procedure;\n-\tupon receipt of TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME wishes to create a mapped EPS security context (i.e. the type of security context flag is set to \"mapped security context\" in the NAS key set identifier IE included in the SECURITY MODE COMMAND message).\nThe MME shall send the SECURITY MODE COMMAND message unciphered, but shall integrity protect the message with the NAS integrity key based on KASME or mapped K'ASME indicated by the eKSI included in the message. The MME shall set the security header type of the message to \"integrity protected with new EPS security context\".\nThe MME shall create a locally generated KASME and send the SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to \"000\" and EIA0 and EEA0 as the selected NAS security algorithms only when the security mode control procedure is initiated:\n-\tduring an attach procedure for emergency bearer services if no shared EPS security context is available;\n-\tduring an attach procedure for access to RLOS if no valid EPS security context is available;\n-\tduring a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available;\n-\tduring a tracking area updating procedure for a UE that has a PDN connection for access to RLOS if no valid EPS security context is available;\n-\tduring a service request procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available;\n-\tduring a service request procedure for a UE that has a PDN connection for access to RLOS if no valid EPS security context is available;\n-\tafter a failed authentication procedure for a UE that has a PDN connection for emergency bearer services or that is establishing a PDN connection for emergency bearer services, if continued usage of a shared security context is not possible; or\n-\tafter a failed authentication procedure for a UE that has a PDN connection for access to RLOS or that is establishing a PDN connection for access to RLOS, if continued usage of a valid security context is not possible.\nThe UE shall process a SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to \"000\" and EIA0 and EEA0 as the selected NAS security algorithms and, if accepted, create a locally generated KASME when the security mode control procedure is initiated:\n-\tduring an attach procedure for emergency bearer services;\n-\tduring an attach procedure for access to RLOS;\n-\tduring a tracking area updating procedure when the UE has a PDN connection for emergency bearer services;\n-\tduring a tracking area updating procedure when the UE has a PDN connection for access to RLOS;\n-\tduring a service request procedure when the UE has a PDN connection for emergency bearer services;\n-\tduring a service request procedure when the UE has a PDN connection for access to RLOS;\n-\tafter an authentication procedure when the UE has a PDN connection for emergency bearer services or is establishing a PDN connection for emergency bearer services; or\n-\tafter an authentication procedure when the UE has a PDN connection for access to RLOS or is establishing a PDN connection for access to RLOS.\nNOTE 1:\tThe process for creation of the locally generated KASME by the MME and the UE is implementation dependent.\nUpon receipt of a TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME does not have the valid current EPS security context indicated by the UE, the MME shall either:\n-\tindicate the use of the new mapped EPS security context to the UE by setting the type of security context flag in the NAS key set identifier IE to \"mapped security context\" and the KSI value related to the security context of the source system; or\n-\tset the KSI value \"000\" in the NAS key set identifier IE if the MME sets EIA0 and EEA0 as the selected NAS security algorithms for a UE that has a PDN connection for emergency bearer services.\nWhile having a current mapped EPS security context with the UE, if the MME wants to take the native EPS security context into use, the MME shall include the eKSI that indicates the native EPS security context in the SECURITY MODE COMMAND message.\nThe MME shall include the replayed security capabilities of the UE (including the security capabilities with regard to NAS, RRC and UP (user plane) ciphering as well as NAS and RRC integrity, and other possible target network security capabilities, i.e. UTRAN/GERAN if the UE included them in the message to network), the replayed nonceUE when creating a mapped EPS security context and if the UE included it in the message to the network, the selected NAS ciphering and integrity algorithms and the Key Set Identifier (eKSI). If the MME supports handling of UE additional security capabilities and the UE included a UE additional security capability IE in the message to the network, the MME shall include the replayed additional security capabilities of the UE.\nThe MME shall include both the nonceMME and the nonceUE when creating a mapped EPS security context during inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode.\nThe MME may initiate a SECURITY MODE COMMAND in order to change the NAS security algorithms for a current EPS security context already in use. The MME re-derives the NAS keys from KASME with the new NAS algorithm identities as input and provides the new NAS algorithm identities within the SECURITY MODE COMMAND message. The MME shall set the security header type of the message to \"integrity protected with new EPS security context\".\nIf, during an ongoing attach or tracking area updating procedure, the MME is initiating a SECURITY MODE COMMAND (i.e. after receiving the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, but before sending a response to that message) and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message is received without integrity protection or does not successfully pass the integrity check at the MME, the MME shall calculate the HASHMME of the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message as described in 3GPP TS 33.401 [19] and shall include the HASHMME in the SECURITY MODE COMMAND message.\nAdditionally, the MME may request the UE to include its IMEISV in the SECURITY MODE COMPLETE message.\nNOTE 2:\tThe AS and NAS security capabilities will be the same, i.e. if the UE supports one algorithm for NAS, the same algorithm is also supported for AS.\nIf:\n-\tthe NAS security mode control procedure is initiated during an ongoing attach procedure in WB-S1 mode;\n-\tthe network supports RACS;\n-\tthe UE has set the RACS bit to \"RACS supported\" in the UE network capability IE of the ATTACH REQUEST message; and\n-\tthe UE has set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE of the ATTACH REQUEST message,\nthen the MME shall request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message.\nIf:\n-\tthe NAS security mode control procedure is initiated during an ongoing tracking area updating procedure in WB-S1 mode;\n-\tthe network supports RACS;\n-\tthe UE has set the RACS bit to \"RACS supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message; and\n-\tthe UE has set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message,\nthen the MME may request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message.\nIf:\n-\tthe NAS security mode control procedure is initiated during an ongoing tracking area updating procedure in WB-S1 mode;\n-\tthe network supports RACS;\n-\tthe UE has set the RACS bit to \"RACS supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message;\n-\tthe UE has set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message; and\n-\tno UE radio capability ID is available in the UE context in the MME,\nthen the MME shall request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message.\nThe figure depicts a security mode control procedure, illustrating the steps involved in managing security modes in a network. The diagram includes various components such as security mode switches, security mode controllers, and security mode registers. The figure provides a visual representation of the complex process, highlighting the importance of proper security management in network operations.\nFigure 5.4.3.2.1: Security mode control procedure\nUpon receipt of the SECURITY MODE COMMAND message, the UE shall check whether the security mode command can be accepted or not. This is done by performing the integrity check of the message and by checking that the received replayed UE security capabilities, the received replayed UE additional security capabilities, if included in the SECURITY MODE COMMAND message, and the received nonceUE have not been altered compared to the latest values that the UE sent to the network. However, the UE is not required to perform the checking of the received nonceUE if the UE does not want to re-generate the K'ASME (i.e. the SECURITY MODE COMMAND message is to derive and take into use a mapped EPS security context and the eKSI matches the current EPS security context, if it is a mapped EPS security context). When the UE has a PDN connection for emergency bearer services established or the UE is establishing a PDN connection for emergency bearer services or the UE is requesting attach for access to RLOS, the UE is not required to locally re-generate the KASME (i.e. the SECURITY MODE COMMAND message is used to derive and take into use a native EPS security context where the KSI value \"000\" is included in the NAS key set identifier IE and the EIA0 and EEA0 are included as the selected NAS security algorithms).\nThe UE shall accept a SECURITY MODE COMMAND message indicating the \"null integrity protection algorithm\" EIA0 as the selected NAS integrity algorithm only if the message is received for a UE that has a PDN connection for emergency bearer services established, or a UE that is attached for access to RLOS, or a UE that is establishing a PDN connection for emergency bearer services or a UE that is requesting attach for access to RLOS.\nIf the type of security context flag included in the SECURITY MODE COMMAND message is set to \"native security context\" and if the KSI matches a valid non-current native EPS security context held in the UE while the UE has a mapped EPS security context as the current EPS security context, the UE shall take the non-current native EPS security context into use which then becomes the current native EPS security context and delete the mapped EPS security context.\nIf the SECURITY MODE COMMAND message can be accepted, the UE shall take the EPS security context indicated in the message into use. The UE shall in addition reset the uplink NAS COUNT counter if:\n-\tthe SECURITY MODE COMMAND message is received in order to take an EPS security context into use created after a successful execution of the EPS authentication procedure;\n-\tthe SECURITY MODE COMMAND message received includes the type of security context flag set to \"mapped security context\" in the NAS key set identifier IE the eKSI does not match the current EPS security context, if it is a mapped EPS security context.\nIf the SECURITY MODE COMMAND message can be accepted and a new EPS security context is taken into use and SECURITY MODE COMMAND message does not indicate the \"null integrity protection algorithm\" EIA0 as the selected NAS integrity algorithm, the UE shall:\n-\tif the SECURITY MODE COMMAND message has been successfully integrity checked using an estimated downlink NAS COUNT equal 0, then the UE shall set the downlink NAS COUNT of this new EPS security context to 0;\n-\totherwise the UE shall set the downlink NAS COUNT of this new EPS security context to the downlink NAS COUNT that has been used for the successful integrity checking of the SECURITY MODE COMMAND message.\nIf the SECURITY MODE COMMAND message can be accepted, the UE shall send a SECURITY MODE COMPLETE message integrity protected with the selected NAS integrity algorithm and the EPS NAS integrity key based on the KASME or mapped K'ASME if the type of security context flag is set to \"mapped security context\" indicated by the eKSI. When the SECURITY MODE COMMAND message includes the type of security context flag set to \"mapped security context\" in the NAS key set identifier IE, the nonceMME and the nonceUE, then the UE shall either:\n-\tgenerate K'ASME from both the nonceMME and the nonceUE as indicated in 3GPP TS 33.401 [19]; or\n-\tcheck whether the SECURITY MODE COMMAND message indicates the eKSI of the current EPS security context, if it is a mapped EPS security context, in order not to re-generate the K'ASME.\nFurthermore, if the SECURITY MODE COMMAND message can be accepted, the UE shall cipher the SECURITY MODE COMPLETE message with the selected NAS ciphering algorithm and the EPS NAS ciphering key based on the KASME or mapped K'ASME indicated by the eKSI. The UE shall set the security header type of the message to \"integrity protected and ciphered with new EPS security context\".\nFrom this time onward the UE shall cipher and integrity protect all NAS signalling messages with the selected NAS ciphering and NAS integrity algorithms.\nIf the MME indicated in the SECURITY MODE COMMAND message that the IMEISV is requested, the UE shall include its IMEISV in the SECURITY MODE COMPLETE message.\nIn WB-S1 mode, if the MME indicated in the SECURITY MODE COMMAND message that the UE radio capability ID is requested, the UE shall:\n-\tif the UE has an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN, include the applicable network-assigned UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message; and\n-\tif the UE:\na)\tdoes not have an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN; and\nb)\thas an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration,\ninclude the applicable manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message.\nIf, during an ongoing attach or tracking area updating procedure, the SECURITY MODE COMMAND message includes a HASHMME, the UE shall compare HASHMME with a hash value locally calculated as described in 3GPP TS 33.401 [19] from the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message that the UE had sent to initiate the procedure. If HASHMME and the locally calculated hash value are different, the UE shall include the complete ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message which the UE had previously sent in the Replayed NAS message container IE of the SECURITY MODE COMPLETE message.\nThe MME shall, upon receipt of the SECURITY MODE COMPLETE message, stop timer T3460. From this time onward the MME shall integrity protect and encipher all signalling messages with the selected NAS integrity and ciphering algorithms.\nIf the SECURITY MODE COMPLETE message contains a Replayed NAS container message IE with an ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, the MME shall complete the ongoing attach or tracking area updating procedure by considering the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message contained in the Replayed NAS message container IE as the message that triggered the procedure.\nIf the security mode command cannot be accepted, the UE shall send a SECURITY MODE REJECT message. The SECURITY MODE REJECT message contains an EMM cause that typically indicates one of the following cause values:\n#23:\tUE security capabilities mismatch;\n#24:\tsecurity mode rejected, unspecified.\nUpon receipt of the SECURITY MODE REJECT message, the MME shall stop timer T3460. The MME shall also abort the ongoing procedure that triggered the initiation of the NAS security mode control procedure.\nBoth the UE and the MME shall apply the EPS security context in use before the initiation of the security mode control procedure, if any, to protect the SECURITY MODE REJECT message and any other subsequent messages according to the rules in clauses 4.4.4 and 4.4.5.\nThe following abnormal cases can be identified:\na)\tTransmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication from lower layers (if the security mode control procedure is triggered by a tracking area updating procedure or an attach procedure)\nThe UE shall abort the security mode control procedure and re-initiate the tracking area updating procedure if the security mode control procedure is triggered by a tracking area updating procedure.\nThe UE shall abort the security mode control procedure and re-initiate the attach procedure if the security mode control procedure is triggered by an attach procedure.\nb)\tTransmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication with TAI change from lower layers (if the security mode control procedure is triggered by a service request procedure)\nIf the current TAI is not in the TAI list, the security mode control procedure shall be aborted and a tracking area updating procedure shall be initiated.\nIf the current TAI is still part of the TAI list, the security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.\nc)\tTransmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication without TAI change from lower layers (if the security mode control procedure is triggered by a service request procedure)\nThe security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.\nThe following abnormal cases can be identified:\na)\tLower layer failure before the SECURITY MODE COMPLETE or SECURITY MODE REJECT message is received\nThe network shall abort the security mode control procedure.\nb)\tExpiry of timer T3460\nThe network shall, on the first expiry of the timer T3460, retransmit the SECURITY MODE COMMAND message and shall reset and start timer T3460. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3460, the procedure shall be aborted.\nNOTE:\tIf the SECURITY MODE COMMAND message was sent to create a mapped EPS security context during inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode, then the network does not generate new values for the nonceMME and the nonceUE, but includes the same values in the SECURITY MODE COMMAND message (see the clause 7.2.4.4 in 3GPP TS 33.401 [19]).\nc)\tCollision between security mode control procedure and attach, service request, tracking area updating procedure or detach procedure not indicating switch off\nThe network shall abort the security mode control procedure and proceed with the UE initiated procedure.\nd)\tCollision between security mode control procedure and other EMM procedures than in item c\nThe network shall progress both procedures.\ne)\tLower layers indication of non-delivered NAS PDU due to handover\nIf the SECURITY MODE COMMAND message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the SECURITY MODE COMMAND message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the SECURITY MODE COMMAND message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.4\tIdentification procedure",
                            "text_content": "The identification procedure is used by the network to request a particular UE to provide specific identification parameters, e.g. the International Mobile Subscriber Identity (IMSI) or the International Mobile Equipment Identity (IMEI). IMEI and IMSI definition and structure are specified in 3GPP TS 23.003 [2].\nFor mobile device supporting both 3GPP access and cdma2000® access a single IMEI is used to identify the device as specified in 3GPP TS 22.278 [1C]. If the UE is a MUSIM UE, the UE uses a separate IMEI for each USIM the UE operates.\nThe network initiates the identification procedure by sending an IDENTITY REQUEST message to the UE and starting the timer T3470 (see example in figure 5.4.4.2.1). The IDENTITY REQUEST message specifies the requested identification parameters in the Identity type information element.\nThe figure depicts a detailed identification procedure for a specific type of telecommunication device, with a focus on the steps involved in identifying the device's unique identifier. The figure includes a flowchart that outlines the steps, such as checking the device's serial number, verifying the device's model, and ensuring the device is powered on. The figure also includes a legend to help users understand the different symbols used in the identification process. Overall, the figure provides a clear and concise visual representation of the identification procedure, making it easy for users to understand and follow the steps.\nFigure 5.4.4.2.1: Identification procedure\nA UE shall be ready to respond to an IDENTITY REQUEST message at any time whilst in EMM-CONNECTED mode.\nUpon receipt of the IDENTITY REQUEST message the UE shall send an IDENTITY RESPONSE message to the network. The IDENTITY RESPONSE message shall contain the identification parameters as requested by the network.\nUpon receipt of the IDENTITY RESPONSE the network shall stop the timer T3470.\nThe following abnormal cases can be identified:\na)\tRequested identity is not available\nIf the UE cannot encode the requested identity in the IDENTITY RESPONSE message, e.g. because no valid USIM is available, then it shall encode the identity type as \"no identity\".\nb)\tTransmission failure of IDENTITY RESPONSE message indication from lower layers (if the identification procedure is triggered by a tracking area updating procedure or an attach procedure)\nThe UE shall abort the identification procedure and re-initiate the tracking area updating procedure if the identification procedure is triggered by a tracking area updating procedure.\nThe UE shall abort the identification procedure and re-initiate the attach procedure if the identification procedure is triggered by an attach procedure.\nc)\tTransmission failure of IDENTITY RESPONSE message indication with TAI change from lower layers (if the identification procedure is triggered by a service request procedure)\nIf the current TAI is not in the TAI list, the identification procedure shall be aborted and a tracking area updating procedure shall be initiated.\nIf the current TAI is still part of the TAI list, the identification procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure.\nd)\tTransmission failure of IDENTITY RESPONSE message indication without TAI change from lower layers (if the identification procedure is triggered by a service request procedure)\nThe identification procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure.\nThe following abnormal cases can be identified:\na)\tLower layer failure\nUpon detection of a lower layer failure before the IDENTITY RESPONSE is received, the network shall abort any ongoing EMM procedure.\nb)\tExpiry of timer T3470\nThe identification procedure is supervised by the network by the timer T3470. The network shall, on the first expiry of the timer T3470, retransmit the IDENTITY REQUEST message and reset and restart the timer T3470. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3470, the network shall abort the identification procedure and any ongoing EMM procedure.\nc)\tCollision of an identification procedure with an attach procedure\nIf the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and no attach procedure is pending on the network (i.e. no ATTACH ACCEPT/REJECT message has still to be sent as an answer to an ATTACH REQUEST message), the network shall proceed with the attach procedure.\nd)\tCollision of an identification procedure with an attach procedure when the identification procedure has been caused by an attach procedure\nIf the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and an attach procedure is pending (i.e. an ATTACH ACCEPT/REJECT message has to be sent as an answer to an earlier ATTACH REQUEST message), then:\n-\tIf one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, the network shall proceed with the new attach procedure; or\n-\tIf the information elements do not differ, then the network shall not treat any further this new ATTACH REQUEST.\ne)\tCollision of an identification procedure with a UE initiated detach procedure\nDetach containing cause \"switch off\" within the Detach type IE:\nIf the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall abort the identification procedure and shall progress the detach procedure.\nDetach containing other causes than \"switch off\" within the Detach type IE:\nIf the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall complete the identification procedure and shall respond to the detach procedure as described in clause 5.5.2.\nf)\tCollision of an identification procedure with a tracking area updating procedure\nIf the network receives a TRACKING AREA UPDATE REQUEST message before the ongoing identification procedure has been completed, the network shall progress both procedures.\ng)\tCollision of an identification procedure with a service request procedure\nIf the network receives an EXTENDED SERVICE REQUEST message for CS fallback or 1xCS fallback before the ongoing identification procedure has been completed, the network shall progress both procedures.\nh)\tLower layers indication of non-delivered NAS PDU due to handover\nIf the IDENTITY REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the IDENTITY REQUEST message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the IDENTITY REQUEST message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.5\tEMM information procedure",
                            "text_content": "The purpose of sending the EMM INFORMATION message is to allow the network to provide information to the UE. The message implementation is optional in the network. The UE may use the received information if the UE supports implementing this message.\nThe EMM information procedure may be invoked by the network at any time during an established EMM context.\nThe EMM information procedure consists only of the EMM INFORMATION message sent from the network to the UE (see example in figure 5.4.5.2.1). During an established EMM context, the network may send none, one, or more EMM INFORMATION messages to the UE. If more than one EMM INFORMATION message is sent, the messages need not have the same content.\nThe figure depicts the EMM (Enhanced Mobile Broadband) information processing procedure, illustrating the steps involved in managing and processing the data generated by the 5G network. The figure includes various components such as the EMM controller, EMM processing units, and the EMM data processing system. The EMM controller manages the EMM data, while the EMM processing units process the data and generate the necessary information for the network. The EMM data processing system processes the EMM data and generates the necessary information for the network.\nFigure 5.4.5.2.1: EMM information procedure\nWhen the UE (supporting the EMM information message) receives an EMM INFORMATION message, it shall accept the message and optionally use the contents to update appropriate information stored within the UE.\nIf the UE does not support the EMM information message the UE shall ignore the contents of the message and return an EMM STATUS message with EMM cause #97 \"message type non-existent or not implemented\".\nThe following abnormal case can be identified:\na)\tLower layers indication of non-delivered NAS PDU due to handover\nIf the EMM INFORMATION message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the EMM INFORMATION message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the EMM INFORMATION message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.5\tEMM specific procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.5.1\tAttach procedure",
                            "text_content": "The attach procedure is used to attach to an EPC for packet services in EPS.\nThe attach procedure is used for the following purposes:\n-\tby a UE in PS mode of operation to attach for EPS services only;\n-\tby a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services;\n-\tby a UE supporting NB-S1 mode only in PS mode of operation to attach for EPS services and \"SMS only\";\n-\tto attach for emergency bearer services;\n-\tan attach for access to RLOS; or\n-\tthe UE has initiated a GPRS attach procedure while in A/Gb mode or Iu mode or an initial registration procedure while in N1 mode and moves to E-UTRAN coverage.\nThe lower layers indicate to NAS that the network does not support emergency bearer services for the UE in limited service state (3GPP TS 36.331 [22]). This information is taken into account when deciding whether to initiate attach for emergency bearer services in WB-S1 mode.\nIf the MME does not support an attach for emergency bearer services, the MME shall reject any request to attach with an attach type set to \"EPS emergency attach\".\nIf the MUSIM UE initiates the attach procedure and sets the attach type to \"EPS emergency attach\" in the ATTACH REQUEST message, the network shall not indicate the support of:\n-\tthe NAS signalling connection release;\n-\tthe paging indication for voice services;\n-\tthe reject paging request;\n-\tthe paging restriction; or\n-\tthe paging timing collision control;\nin the ATTACH ACCEPT message.\nThe lower layers may indicate to NAS whether the network supports access to RLOS (3GPP TS 36.331 [22]). This information is taken into account when deciding whether to initiate attach for access to RLOS in WB-S1 mode.\nWith a successful attach procedure, a context is established for the UE in the MME. Furthermore, if the UE requested PDN connectivity, a default bearer is established between the UE and the PDN GW, thus enabling always-on IP connectivity to the UE. In WB-S1 mode, the network may also initiate the activation of dedicated bearers as part of the attach procedure. In NB-S1 mode the network shall not initiate the activation of dedicated bearers.\nWith a successful attach procedure in NB-S1 mode, a context is established for the UE in the MME. If the attach request included information to request PDN connectivity, a default bearer is also established between the UE and the PDN.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, a default bearer need not be requested by the UE during the attach procedure. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the UE shall request establishment of a default bearer.\nDuring the attach procedure with default bearer establishment, the UE may also obtain the home agent IPv4 or IPv6 address or both.\nIn a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity as part of the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP TS 36.331 [22]). Whenever an ATTACH REJECT message with the EMM cause #11 \"PLMN not allowed\" is received by the UE, the chosen PLMN identity shall be stored in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. Whenever an ATTACH REJECT message with the EMM cause #14 \"EPS services not allowed in this PLMN\" is received by the UE, the chosen PLMN identity shall be stored in the \"forbidden PLMNs for GPRS service\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. Whenever an ATTACH REJECT message is received by the UE with the EMM cause #12 \"tracking area not allowed\", #13 \"roaming not allowed in this tracking area\", or #15 \"no suitable cells in tracking area\", the constructed TAI shall be stored in the suitable list.\nAn attach attempt counter is used to limit the number of subsequently rejected attach attempts. The attach attempt counter shall be incremented as specified in clause 5.5.1.2.6. Depending on the value of the attach attempt counter, specific actions shall be performed. The attach attempt counter shall be reset when:\n-\tthe UE is powered on;\n-\ta USIM is inserted;\n-\tan attach or combined attach procedure is successfully completed;\nNOTE:\tThe attach procedure can be initiated in S1 or S101 mode as described in clause 5.5.1.\n-\ta GPRS attach or combined GPRS attach procedure is successfully completed in A/Gb or Iu mode;\n-\ta registration procedure for initial registration performed over 3GPP access is successfully completed in N1 mode and the UE is operating in single-registration mode;\n-\ta combined attach procedure is completed for EPS services only with cause #2, #16, #17, #18 or #22;\n-\tan attach or combined attach procedure is rejected with cause #11, #12, #13, #14, #15, #25 or #35:\n-\ta network initiated detach procedure is completed with cause #11, #12, #13, #14, #15 or #25; or\n-\ta new PLMN is selected.\nAdditionally the attach attempt counter shall be reset when the UE is in substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and:\n-\ta new tracking area is entered;\n-\ttimer T3402 expires; or\n-\ttimer T3346 is started.\nThis procedure can be used by a UE to attach for:\n-\tEPS services only; or\n-\tEPS services and \"SMS only\" if the UE supports NB-S1 mode only.\nWhen the UE initiates the attach procedure for normal service, the UE shall indicate \"EPS attach\" in the EPS attach type IE.\nWhen the UE initiates the attach procedure for emergency bearer services, the UE shall indicate \"EPS emergency attach\" in the EPS attach type IE. The attach procedure for emergency bearer services is not applicable for NB-S1 mode (see 3GPP TS 23.401 [10]).\nThis procedure can also be used by a UE in limited service state to attach for access to RLOS.\nWhen the UE initiates the attach procedure for access to RLOS, the UE shall indicate \"EPS RLOS attach\" in the EPS attach type IE. The attach procedure for access to RLOS is not applicable for NB-S1 mode (see 3GPP TS 23.401 [10]).\nIn state EMM-DEREGISTERED, the UE initiates the attach procedure by sending an ATTACH REQUEST message to the MME, starting timer T3410 and entering state EMM-REGISTERED-INITIATED (see example in figure 5.5.1.2.2.1). If timer T3402 is currently running, the UE shall stop timer T3402. If timer T3411 is currently running, the UE shall stop timer T3411.\nThe UE shall include the IMSI in the EPS mobile identity IE in the ATTACH REQUEST message if the selected PLMN is neither the registered PLMN nor in the list of equivalent PLMNs and:\na)\tthe UE is configured for \"AttachWithIMSI\" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]; or\nb)\tthe UE is in NB-S1 mode.\nFor all other cases, the UE shall handle the EPS mobile identity IE in the ATTACH REQUEST message as follows:\na)\tif the UE operating in the single-registration mode is performing an inter-system change from N1 mode to S1 mode or the UE was previously registered in N1 mode before entering state 5GMM-DEREGISTERED and:\n1)\tthe UE has received the interworking without N26 interface indicator set to \"interworking without N26 interface supported\" from the network and:\ni)\tif the UE holds a valid GUTI, the UE shall include the valid GUTI into the EPS mobile identity IE, include Old GUTI type IE with GUTI type set to \"Native GUTI\" and include the UE status IE with a 5GMM registration status set to \"UE is not in 5GMM-REGISTERED state\".\nNOTE 1:Since MM context transfer is not possible between MME and AMF in a network that indicates \"interworking without N26 interface supported\", it is up to the UE implementation as to how to keep the 5GMM and EMM states in the UE in sync.\nii)\tif the UE does not hold a valid GUTI, the UE shall include the IMSI in the EPS mobile identity IE; or\n2)\tthe UE has received the interworking without N26 interface indicator set to \"interworking without N26 interface not supported\" from the network and:\ni)\tif the UE holds a valid native 5G-GUTI, the UE shall include a GUTI, mapped from the 5G-GUTI into the EPS mobile identity IE, include Old GUTI type IE with GUTI type set to \"Native GUTI\" and include the UE status IE with a 5GMM registration status set to \"UE is not in 5GMM-REGISTERED state\";\nii)\tif the UE holds a valid GUTI and does not hold a valid 5G-GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE and include Old GUTI type IE with GUTI type set to \"Native GUTI\"; or\niii)\tif the UE holds neither a valid GUTI nor a valid 5G-GUTI, the UE shall include the IMSI in the EPS mobile identity IE; or\nNOTE 2:\tThe value of the EMM registration status included by the UE in the UE status IE is not used by the MME.\nb)\totherwise:\n1)\tif the UE supports neither A/Gb mode nor Iu mode, the UE shall include in the ATTACH REQUEST message a valid GUTI together with the last visited registered TAI, if available. In addition, the UE shall include Old GUTI type IE with GUTI type set to \"Native GUTI\". If there is no valid GUTI available, the UE shall include the IMSI in the ATTACH REQUEST message; or\n2)\tIf the UE supports A/Gb mode or Iu mode or both and:\ni)\tif the TIN indicates \"P-TMSI\" and the UE holds a valid native P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to \"Mapped GUTI\". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE. Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE;\nNOTE 3:\tThe mapping of the P-TMSI and the RAI to the GUTI is specified in 3GPP TS 23.003 [2].\nii)\tif the TIN indicates \"GUTI\" or \"RAT-related TMSI\" and the UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to \"Native GUTI\";\niii)\tif the TIN is deleted and:\n-\tthe UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to \"Native GUTI\";\n-\tthe UE does not hold a valid GUTI but holds a valid native P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to \"Mapped GUTI\". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE; or\n-\tthe UE does not hold a valid GUTI, P-TMSI or RAI, the UE shall include the IMSI in the EPS mobile identity IE; or\niv)\totherwise the UE shall include the  in the EPS mobile identity IE.\nIf the UE is operating in the dual-registration mode and it is in 5GMM state 5GMM-REGISTERED, the UE shall include the UE status IE with the 5GMM registration status set to \"UE is in 5GMM-REGISTERED state\".\nNOTE 4:\tThe value of the EMM registration status included by the UE in the UE status IE is not used by the MME.\nIf the UE is attaching for emergency bearer services and does not hold a valid GUTI, P-TMSI or IMSI as described above, the IMEI shall be included in the EPS mobile identity IE.\nIf the UE in limited service state is attaching for access to RLOS and does not hold a valid GUTI, P-TMSI or IMSI as described above, the IMEI shall be included in the EPS mobile identity IE.\nIf the UE supports A/Gb mode or Iu mode or if the UE needs to indicate its UE specific DRX parameter to the network, the UE shall include the UE specific DRX parameter in the DRX parameter IE in the ATTACH REQUEST message. If the UE in NB-S1 mode needs to indicate the UE specific DRX parameter in NB-S1 mode to the network, it shall include the UE specific DRX parameter in NB-S1 mode in the DRX parameter in NB-S1 mode IE in the ATTACH REQUEST message.\nIf the UE supports eDRX and requests the use of eDRX, the UE shall include the extended DRX parameters IE in the ATTACH REQUEST message.\nIf the UE supports WUS assistance, then the UE shall set the WUSA bit to \"WUS assistance supported\" in the UE network capability IE, and if the UE is not attaching for emergency bearer services, the UE may include its UE paging probability information in the Requested WUS assistance information IE of the ATTACH REQUEST message.\nIf the UE supports SRVCC to GERAN/UTRAN, the UE shall set the SRVCC to GERAN/UTRAN capability bit to \"SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported\".\nIf the UE supports vSRVCC from S1 mode to Iu mode, then the UE shall set the H.245 after handover capability bit to \"H.245 after SRVCC handover capability supported\" and additionally set the SRVCC to GERAN/UTRAN capability bit to \"SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported\" in the ATTACH REQUEST message.\nIf the UE supports PSM and requests the use of PSM, then the UE shall include the T3324 value IE with a requested timer value in the ATTACH REQUEST message. When the UE includes the T3324 value IE and the UE indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3412 extended value IE to request a particular T3412 value to be allocated.\nIf the UE supports ProSe direct discovery, then the UE shall set the ProSe bit to \"ProSe supported\" and set the ProSe direct discovery bit to \"ProSe direct discovery supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports ProSe direct communication, then the UE shall set the ProSe bit to \"ProSe supported\" and set the ProSe direct communication bit to \"ProSe direct communication supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports acting as a ProSe UE-to-network relay, then the UE shall set the ProSe bit to \"ProSe supported\" and set the ProSe UE-to-network relay bit to \"acting as a ProSe UE-to-network relay supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports NB-S1 mode, Non-IP or Ethernet PDN type, N1 mode, UAS services, URSP provisioning in EPS or if the UE supports DNS over (D)TLS (see 3GPP TS 33.501 [24]), then the UE shall support the Extended protocol configuration options IE.\nNOTE 5:\tSupport of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.501 [24].\nIf the UE supports the Extended protocol configuration options IE, then the UE shall set the ePCO bit to \"extended protocol configuration options supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports providing PDU session ID in the Protocol configuration options IE or the Extended protocol configuration options IE when its N1 mode capability is disabled, then the UE shall set the ePCO bit to \"extended protocol configuration options supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports the restriction on use of enhanced coverage, then the UE shall set the RestrictEC bit to \"Restriction on use of enhanced coverage supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports the control plane data back-off timer T3448, the UE shall set the CP backoff bit to \"back-off timer for transport of user data via the control plane supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports EPS-UPIP, the UE shall set the EPS-UPIP bit to \"EPS-UPIP supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE is in NB-S1 mode, then the UE shall set the Control plane CIoT EPS optimization bit to \"Control plane CIoT EPS optimization supported\" in the UE network capability IE of the ATTACH REQUEST message. If the UE is capable of NB-N1 mode, then the UE shall set the Control plane CIoT 5GS optimization bit to \"Control plane CIoT 5GS optimization supported\" in the N1 UE network capability IE of the ATTACH REQUEST message.\nIf the UE is in NB-S1 mode, supports NB-S1 mode only, and requests to attach for EPS services and \"SMS only\", the UE shall indicate the SMS only requested bit to \"SMS only\" in the additional update type IE and shall set the EPS attach type IE to \"EPS attach\" in the ATTACH REQUEST message.\nIf the UE supports CIoT EPS optimizations, it shall indicate in the UE network capability IE of the ATTACH REQUEST message whether it supports EMM-REGISTERED without PDN connection.\nIf the UE supports enhanced discontinuous coverage, then the UE shall set the EDC bit to \"Enhanced discontinuous coverage supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP TS 36.306 [44], 3GPP TS 36.331 [22]) in NB-S1 mode, then the UE shall set the Multiple DRB support bit to \"Multiple DRB supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports control plane MT-EDT, then the UE shall set the CP-MT-EDT bit to \"Control plane Mobile Terminated-Early Data Transmission supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports user plane MT-EDT, then the UE shall set the UP-MT-EDT bit to \"User plane Mobile Terminated-Early Data Transmission supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports V2X communication over E-UTRA-PC5, then the UE shall set the V2X PC5 bit to \"V2X communication over E-UTRA-PC5 supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports V2X communication over NR-PC5, then the UE shall set the V2X NR-PC5 bit to \"V2X communication over NR-PC5 supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports service gap control, then the UE shall set the SGC bit to \"service gap control supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports dual connectivity with New Radio (NR), then the UE shall set the DCNR bit to \"dual connectivity with NR supported\" in the UE network capability IE of the ATTACH REQUEST message and shall include the UE additional security capability IE in the ATTACH REQUEST message.\nIf the UE supports N1 mode for 3GPP access, the UE shall set the N1mode bit to \"N1 mode for 3GPP access supported\" in the UE network capability IE of the ATTACH REQUEST message and shall include the UE additional security capability IE in the ATTACH REQUEST message.\nIf the UE supports signalling for a maximum number of 15 EPS bearer contexts, then the UE shall set the 15 bearers bit to \"Signalling for a maximum number of 15 EPS bearer contexts supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the MUSIM UE supports the NAS signalling connection release, then the UE shall set the NAS signalling connection release bit to \"NAS signalling connection release supported\" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the NAS signalling connection release bit to \"NAS signalling connection release supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the MUSIM UE supports the paging indication for voice services, then the UE shall set the paging indication for voice services bit to \"paging indication for voice services supported\" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the paging indication for voice services bit to \"paging indication for voice services supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the MUSIM UE supports the reject paging request, then the UE shall set the reject paging request bit to \"reject paging request supported\" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the reject paging request bit to \"reject paging request supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the MUSIM UE sets:\n-\tthe reject paging request bit to \"reject paging request supported\";\n-\tthe NAS signalling connection release bit to \"NAS signalling connection release supported\"; or\n-\tboth of them;\nand supports the paging restriction, then the UE shall set the paging restriction bit to \"paging restriction supported\" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the paging restriction bit to \"paging restriction supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the MUSIM UE supports the paging timing collision control, then the UE shall set the paging timing collision control bit to \"paging timing collision control supported\" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the paging timing collision control bit to \"paging timing collision control supported\" in the UE network capability IE of the ATTACH REQUEST message.\nIf the UE supports ciphered broadcast assistance data and needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the ATTACH REQUEST message.\nFor MUSIM UE if the UE needs to indicate an IMSI offset value to the network, the UE shall include the IMSI offset value in the Requested IMSI offset IE in the ATTACH REQUEST message.\nIf EMM-REGISTERED without PDN connection is not supported by the UE or the MME, or if the UE wants to request PDN connection with the attach procedure, the UE shall send the ATTACH REQUEST message together with a PDN CONNECTIVITY REQUEST message contained in the ESM message container IE.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE does not want to request PDN connection with the attach procedure, the UE shall send the ATTACH REQUEST message together with an ESM DUMMY MESSAGE contained in the ESM message container information element.\nIn WB-S1 mode, if the UE supports RACS, the UE shall:\na)\tset the RACS bit to \"RACS supported\" in the UE network capability IE of the ATTACH REQUEST message; and\nb)\tif the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE of the ATTACH REQUEST message.\nIf the attach procedure is initiated following an inter-system change from N1 mode to S1 mode in EMM-IDLE mode or the UE which was previously registered in N1 mode before entering state 5GMM-DEREGISTERED initiates the attach procedure:\na)\tif the UE has received an \"interworking without N26 interface not supported\" indication from the network and a valid 5G NAS security context exists in the UE, the UE shall integrity protect the ATTACH REQUEST message combined with the message included in the ESM message container IE using the 5G NAS security context;\nb)\totherwise:\n1)\tif a valid EPS security context exists, the UE shall integrity protect the ATTACH REQUEST message combined with the message included in the ESM message container IE using the EPS security context; or\n2)\tif the UE does not have a valid EPS security context, the ATTACH REQUEST message combined with the message included in the ESM message container IE is not integrity protected.\nThe figure depicts a detailed process for attaching and combining optical fibers, illustrating the step-by-step procedure and the associated hardware components. The figure includes a diagram of the optical fiber, a schematic of the optical line terminal (OLT), and a flowchart of the combined attach procedure. This figure is crucial for understanding the process of fiber-optic network installation and maintenance.\nFigure 5.5.1.2.2.1: Attach procedure and combined attach procedure\nThe network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures during the attach procedure, depending on the information received in the ATTACH REQUEST message (e.g. IMSI, GUTI and KSI).\nIf the network receives an ATTACH REQUEST message containing the Old GUTI type IE and the EPS mobile identity IE with type of identity indicating \"GUTI\", and the network does not follow the use of the most significant bit of the < group id> as specified in 3GPP TS 23.003 [2], clause 2.8.2.2.2, the network shall use the Old GUTI type IE to determine whether the mobile identity included in the EPS mobile identity IE is a native GUTI or a mapped GUTI.\nDuring an attach for emergency bearer services or an attach for access to RLOS, the MME may choose to skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in clause 5.4.3.\nDuring an attach for emergency bearer services, if not restricted by local regulations, the MME shall not check for mobility and access restrictions, regional restrictions, subscription restrictions, or perform CSG access control when processing the ATTACH REQUEST message. The network shall not apply subscribed APN based congestion control during an attach procedure for emergency bearer services.\nDuring an attach for access to RLOS, the MME shall not check for access restrictions, regional restrictions and subscription restrictions when processing the ATTACH REQUEST message.\nIf the attach request is accepted by the network, the MME shall send an ATTACH ACCEPT message to the UE and start timer T3450.\nIf the attach request included the PDN CONNECTIVITY REQUEST message in the ESM message container information element to request PDN connectivity, the MME when accepting the attach request shall:\n-\tsend the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element and discard the ESM message container information element included in the attach request if:\n-\tthe UE indicated support of EMM-REGISTERED without PDN connection in the UE network capability IE of the ATTACH REQUEST message;\n-\tthe MME supports EMM-REGISTERED without PDN connection and PDN connection is restricted according to the user's subscription data;\n-\tthe attach type is not set to \"EPS emergency attach\" or \"EPS RLOS attach\"; and\n-\tthe request type of the UE requested PDN connection is not set to \"handover of emergency bearer services\", \"emergency\" or \"RLOS\";\n-\totherwise, send the ATTACH ACCEPT message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message contained in the ESM message container information element to activate the default bearer (see clause 6.4.1). In WB-S1 mode, the network may also initiate the activation of dedicated bearers towards the UE by invoking the dedicated EPS bearer context activation procedure (see clause 6.4.2). In NB-S1 mode the network shall not initiate the activation of dedicated bearers.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE included an ESM DUMMY MESSAGE in the ESM message container information element of the ATTACH REQUEST message, the MME shall send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element.\nIf the attach request is accepted by the network, the MME shall delete the stored UE radio capability information or the UE radio capability ID, if any.\nIn NB-S1 mode, if the attach request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the ATTACH ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.\nIf the UE has included the UE network capability IE or the MS network capability IE or both in the ATTACH REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.\nNOTE 1:\tThis information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.\nNOTE 2:\tFor further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP TS 23.401 [10].\nIf the UE specific DRX parameter was included in the DRX Parameter IE in the ATTACH REQUEST message, the MME shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data in WB-S1 mode.\nIn NB-S1 mode, if the DRX parameter in NB-S1 mode IE was included in the ATTACH REQUEST message, the MME shall provide to the UE the Negotiated DRX parameter in NB-S1 mode IE in the ATTACH ACCEPT message. The MME shall replace any stored UE specific DRX parameter in NB-S1 mode with the negotiated DRX parameter and use it for the downlink transfer of signalling and user data in NB-S1 mode.\nNOTE 3:\tIn NB-S1 mode, if a DRX parameter was included in the Negotiated DRX parameter in NB-S1 mode IE in the ATTACH ACCEPT message, then the UE stores and uses the received DRX parameter in NB-S1 mode (see 3GPP TS 36.304 [21]). If the UE did not receive a DRX parameter in the Negotiated DRX parameter in NB-S1 mode IE, or if the Negotiated DRX parameter in NB-S1 mode IE was not included in the ATTACH ACCEPT message, then the UE uses the cell specific DRX value in NB-S1 mode (see 3GPP TS 36.304 [21]).\nIn NB-S1 mode, if the UE requested \"SMS only\" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the attach request for EPS services and \"SMS only\", the MME shall indicate \"SMS only\" in the Additional update result IE and shall set the EPS attach result IE to \"EPS only\" in the ATTACH ACCEPT message.\nThe MME shall include the extended DRX parameters IE in the ATTACH ACCEPT message only if the extended DRX parameters IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of eDRX.\nIf\n-\tthe UE supports WUS assistance; and\n-\tthe MME supports and accepts the use of WUS assistance,\nthen the MME shall determine the negotiated UE paging probability information for the UE, store it in the EMM context of the UE, and if the UE is not attaching for emergency bearer services, the MME shall include it in the Negotiated WUS assistance information IE in the ATTACH ACCEPT message. The MME may take into account the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE.\nNOTE 4:\tBesides the UE paging probability information requested by the UE, the MME can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE (see 3GPP TS 23.401 [10]).\nThe MME shall assign and include the TAI list the UE is registered to in the ATTACH ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode. The UE, upon receiving an ATTACH ACCEPT message, shall delete its old TAI list and store the received TAI list.\nNOTE 5:\tWhen assigning the TAI list, the MME can take into account the eNodeB's capability of support of CIoT EPS optimization.\nThe MME may include T3412 extended value IE in the ATTACH ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the ATTACH REQUEST message.\nThe MME shall include the T3324 value IE in the ATTACH ACCEPT message only if the T3324 value IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of PSM.\nIf the MME supports and accepts the use of PSM, and the UE included the T3412 extended value IE in the ATTACH REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the ATTACH ACCEPT message.\nNOTE 6:\tBesides the value requested by the UE, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (3GPP TS 23.401 [10] clause 4.3.17.3).\nIf the UE indicates support for EMM-REGISTERED without PDN connection in the ATTACH REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate support for EMM-REGISTERED without PDN connection in the EPS network feature support IE of the ATTACH ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause 5 and in clause 6.\nIf the UE requests \"control plane CIoT EPS optimization\" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the attach request, the MME shall indicate \"control plane CIoT EPS optimization supported\" in the EPS network feature support IE.\nIf the UE indicates support for enhanced discontinuous coverage in the ATTACH REQUEST message, and the MME supports enhanced discontinuous coverage, the MME shall indicate \"Enhanced discontinuous coverage supported\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the MME supports NB-S1 mode, non-IP or Ethernet PDN type, inter-system change with 5GS, UAS services or the network wants to enforce the use of DNS over (D)TLS (see 3GPP TS 33.501 [24]), then the MME shall support the Extended protocol configuration options IE.\nNOTE 7:\tSupport of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.401 [19] and it is implemented based on the operator requirement.\nIf the MME supports the Extended protocol configuration options IE and the UE indicated support of the Extended protocol configuration options IE, then the MME shall set the ePCO bit to \"extended protocol configuration options supported\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the UE indicates support for restriction on use of enhanced coverage in the ATTACH REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the ATTACH ACCEPT message.\nIf the UE indicates support for dual connectivity with NR in the ATTACH REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to \"Use of dual connectivity with NR is restricted\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the UE indicates support for N1 mode in the ATTACH REQUEST message and the MME supports inter-system interworking with 5GS, the MME may set the IWK N26 bit to either:\n-\t\"interworking without N26 interface not supported\" if the MME supports N26 interface; or\n-\t\"interworking without N26 interface supported\" if the MME does not support N26 interface\nin the EPS network feature support IE in the ATTACH ACCEPT message.\nIf the UE requests ciphering keys for ciphered broadcast assistance data in the ATTACH REQUEST message and the MME has valid ciphering key data applicable to the UE's subscription, then the MME shall include the ciphering key data in the Ciphering key data IE of the ATTACH ACCEPT message.\nIf the UE indicates support of the NAS signalling connection release in the ATTACH REQUEST message and the network decides to accept the NAS signalling connection release, then the MME shall set the NAS signalling connection release bit to \"NAS signalling connection release supported\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the UE indicates support of the paging indication for voice services in the ATTACH REQUEST message and the network decides to accept the paging indication for voice services, then the MME shall set the paging indication for voice services bit to \"paging indication for voice services supported\" in the EPS network feature support IE of the ATTACH ACCEPT message. Upon receipt of ATTACH ACCEPT message with the paging indication for voice services bit set to \"paging indication for voice services supported\", the UE NAS layer informs the lower layers that paging indication for voice services is supported. Otherwise, the UE NAS layer informs the lower layers that paging indication for voice services is not supported.\nIf the UE indicates support of the reject paging request in the ATTACH REQUEST message and the network decides to accept the reject paging request, then the MME shall set the reject paging request bit to \"reject paging request supported\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the UE indicates support of the paging restriction in the ATTACH REQUEST message, and the MME sets:\n-\tthe reject paging request bit to \"reject paging request supported\";\n-\tthe NAS signalling connection release bit to \"NAS signalling connection release supported\"; or\n-\tboth of them;\nin the EPS network feature support IE of the ATTACH ACCEPT message, and the network decides to accept the paging restriction, then the MME shall set the paging restriction bit to \"paging restriction supported\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the UE indicates support of the paging timing collision control in the ATTACH REQUEST message and the network decides to accept the paging timing collision control, then the MME shall set the paging timing collision control bit to \"paging timing collision control supported\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nIf the MUSIM UE has included a Requested IMSI offset IE in the ATTACH REQUEST message and if the MME supports paging timing collision control, the MME shall include the Negotiated IMSI offset IE in the ATTACH ACCEPT message, and the MME shall set the IMSI offset value to:\n-\tA value that is different than what the UE has provided, if the MME has a different value; or\n-\tA value that is same as what the UE has provided, if the MME does not have a different value;\nand the MME shall calculate an alternative IMSI value using the IMSI offset value and store it in the UE context as specified in 3GPP TS 23.401 [10]. The alternative IMSI value is used for deriving the paging occasion as specified in 3GPP TS 36.304 [21].\nIf the MUSIM UE has not included a Requested IMSI offset IE in the ATTACH REQUEST message, the MME shall erase any stored alternative IMSI value for that UE, if available.\nThe MME shall set the redir-policy bit to \"Unsecured redirection to GERAN or UTRAN not allowed\" in the Network policy IE of the ATTACH ACCEPT message if unsecured redirection to a GERAN or UTRAN cell is not allowed in the current PLMN. Otherwise, the redir-policy bit shall be set to \"Unsecured redirection to GERAN or UTRAN allowed\".\nThe MME may include the T3447 value IE set to the service gap time value in the ATTACH ACCEPT message if:\n-\tthe UE has indicated support for service gap control; and\n-\ta service gap time value is available in the EMM context.\nIf the network supports signalling for a maximum number of 15 EPS bearer contexts and the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the ATTACH REQUEST message, then the MME shall set the 15 bearers bit to \"Signalling for a maximum number of 15 EPS bearer contexts supported\" in the EPS network feature support IE of the ATTACH ACCEPT message.\nUpon receiving the ATTACH ACCEPT message, the UE shall stop timer T3410.\nThe GUTI reallocation may be part of the attach procedure. When the ATTACH REQUEST message includes the IMSI or IMEI, or the MME considers the GUTI provided by the UE is invalid, or the GUTI provided by the UE was assigned by another MME, the MME shall allocate a new GUTI to the UE. The MME shall include in the ATTACH ACCEPT message the new assigned GUTI together with the assigned TAI list. In this case the MME shall enter state EMM-COMMON-PROCEDURE-INITIATED as described in clause 5.4.1.\nFor a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP TS 23.251 [8B]).\nIf the ATTACH ACCEPT message contains a GUTI, the UE shall use this GUTI as the new temporary identity. The UE shall delete its old GUTI and store the new assigned GUTI. If no GUTI has been included by the MME in the ATTACH ACCEPT message, the old GUTI, if any available, shall be kept.\nIf A/Gb mode or Iu mode is supported in the UE, the UE shall set its TIN to \"GUTI\" when receiving the ATTACH ACCEPT message.\nIf the ATTACH ACCEPT message contains the T3412 extended value IE, then the UE shall use the value in T3412 extended value IE as periodic tracking area update timer (T3412). If the ATTACH ACCEPT message does not contain T3412 extended value IE, then the UE shall use the value in T3412 value IE as periodic tracking area update timer (T3412).\nIf the ATTACH ACCEPT message contains the T3324 value IE, then the UE shall use the included timer value for T3324 as specified in 3GPP TS 24.008 [13], clause 4.7.2.8.\nIf the ATTACH ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C.\nIf the ATTACH ACCEPT message contains Negotiated IMSI offset IE, the MUSIM UE shall forward the IMSI offset value to lower layers. If the ATTACH ACCEPT message does not contain Negotiated IMSI offset IE, the MUSIM UE shall indicate to lower layers to erase any IMSI offset value, if available.\nThe MME may also include a list of equivalent PLMNs in the ATTACH ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if the attach procedure is neither for emergency bearer services nor for access to RLOS, the UE shall remove from the list any PLMN code that is already in the list of \"forbidden PLMNs\" or in the list of \"forbidden PLMNs for GPRS service\". In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the ATTACH ACCEPT message. If the ATTACH ACCEPT message does not contain a list, then the UE shall delete the stored list.\nIf the MME received the list of TAIs from the satellite E-UTRAN as described in 3GPP TS 23.401 [10], and determines that, by UE subscription and operator's preferences, any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service, the MME shall include the TAI(s) in:\na) \tthe Forbidden TAI(s) for the list of \"Forbidden tracking areas for roaming\" IE;\nb) \tthe Forbidden TAI(s) for the list of \"Forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth,\nin the ATTACH ACCEPT message.\nIf the attach procedure is neither for emergency bearer services nor for access to RLOS, and if the PLMN identity of the registered PLMN is a member of the list of \"forbidden PLMNs\" or the list of \"forbidden PLMNs for GPRS service\", any such PLMN identity shall be deleted from the corresponding list(s).\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP TS 23.221 [8A], clause 7.2a and clause 7.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE's application, those indicators are taken into account as specified in 3GPP TS 24.171 [13C].\nIf the RestrictDCNR bit is set to \"Use of dual connectivity with NR is restricted\" in the EPS network feature support IE of the ATTACH ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.\nThe UE supporting N1 mode shall operate in the mode for inter-system interworking with 5GS as follows:\n-\tif the IWK N26 bit in the EPS network feature support IE is set to \"interworking without N26 interface not supported\", the UE shall operate in single-registration mode;\n-\tif the IWK N26 bit in the EPS network feature support IE is set to \"interworking without N26 interface supported\" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or\nNOTE 9:\tThe registration mode used by the UE is implementation dependent.\n-\tif the IWK N26 bit in the EPS network feature support IE is set to \"interworking without N26 interface supported\" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.\nThe UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs. The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP TS 24.501 [54].\nIf the redir-policy bit is set to \"Unsecured redirection to GERAN or UTRAN not allowed\" in the Network policy IE of the ATTACH ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN or UTRAN for the current PLMN to \"Unsecured redirection to GERAN or UTRAN not allowed\" and indicate to the lower layers that unsecured redirection to a GERAN or UTRAN cell is not allowed. If the redir-policy bit is set to \"Unsecured redirection to GERAN or UTRAN allowed\" or if the Network policy IE is not included in the ATTACH ACCEPT message, the UE shall set the network policy for the current PLMN to \"Unsecured redirection to GERAN or UTRAN allowed\" and indicate to the lower layers that unsecured redirection to a GERAN or UTRAN cell is allowed. The UE shall set the network policy on unsecured redirection to GERAN or UTRAN to \"Unsecured redirection to GERAN or UTRAN not allowed\" and indicate this to the lower layers when any of the following events occurs:\n-\tthe UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;\n-\tthe UE is switched on; or\n-\tthe UICC containing the USIM is removed.\nIf the UE has initiated the attach procedure due to manual CSG selection and receives an ATTACH ACCEPT message; and the UE sent the ATTACH REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.\nWhen the UE receives the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to the ESM sublayer. Upon receipt of an indication from the ESM sublayer that the default EPS bearer context has been activated, the UE shall send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message contained in the ESM message container information element to the network.\nAdditionally, the UE shall reset the attach attempt counter, enter state EMM-REGISTERED, and set the EPS update status to EU1 UPDATED.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE receives the ATTACH ACCEPT message combined with an ESM DUMMY MESSAGE, the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network.\nIf the UE receives the ATTACH ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see clause 5.3.7b), then the UE shall reset these counters. If the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall reset this counter.\nWhen the UE receives any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) to the ESM sublayer. The UE shall send a response to the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) after successful completion of the attach procedure.\nIf the attach procedure was initiated in S101 mode, the lower layers are informed about the successful completion of the procedure.\nNOTE 10:\tFor the UE supporting non-IP or Ethernet PDN type or UAS services, if the UE receives the ATTACH ACCEPT message and the ePCO bit in the EPS network feature support IE is not set to \"extended protocol configuration options supported\", the UE can perform a PLMN selection according to 3GPP TS 23.122 [6] with the current PLMN considered as the lowest priority after the completion of the attach procedure.\nUpon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED and consider the GUTI sent in the ATTACH ACCEPT message as valid.\nIf the T3448 value IE is present in the received ATTACH ACCEPT message, the UE shall:\n-\tstop timer T3448 if it is running; and\n-\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the ATTACH ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.\nIf the UE has indicated \"service gap control supported\" in the ATTACH REQUEST message and:\n-\tthe ATTACH ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the T3447 timer next time it is started; or\n-\tthe ATTACH ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the T3447 timer if running.\nIn WB-S1 mode, if the UE has set the RACS bit to \"RACS supported\" in the UE network capability IE of the ATTACH REQUEST message, the MME may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the ATTACH ACCEPT message.\nIn WB-S1 mode, if the UE has set the RACS bit to \"RACS supported\" in the UE network capability IE of the ATTACH REQUEST message and the ATTACH ACCEPT message includes:\n-\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE, then the UE shall, after the completion of the ongoing attach procedure, initiate a tracking area updating procedure as specified in clause 5.5.3 over the existing NAS signalling connection; or\n-\ta UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex C.\nIf the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE in the ATTACH ACCEPT message, the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s), if not already stored, into the list of \"forbidden tracking areas for roaming\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s).\nIf the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE in the ATTACH ACCEPT message, the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s), if not already stored, into the list of \"forbidden tracking areas for regional provision of service\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s).\nIf for discontinuous coverage, the UE receives the Unavailability configuration IE in the ATTACH ACCEPT message and the End of unavailability report bit is set to \"UE does not need to report end of unavailability\", the UE is not required to trigger tracking area update procedure when the unavailability period duration has ended. If the UE does not receive the Unavailability configuration IE or the End of unavailability report bit is set to \"UE needs to report end of unavailability\", the UE should trigger tracking area update procedure when the unavailability period duration has ended.\nApart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in clause 5.5.1.2.4 shall be followed. In addition, the following description for attach for SMS services applies.\nIn NB-S1 mode, if the UE requested \"SMS only\" in the Additional update type IE and supports NB-S1 mode only, the MME decides to accept the attach request for EPS services only and:\n-\tthe location update for non-EPS services is not accepted by the VLR as specified in 3GPP TS 29.118 [16A]; or\n-\tthe MME decides to not accept the attach request for \"SMS only\",\nthe MME shall set the EPS attach result IE to \"EPS only\", shall not indicate \"SMS only\" in the Additional update result IE in the ATTACH ACCEPT message and shall include an appropriate SMS services status value.\nThe UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the value included in the SMS services status IE:\n\"SMS services not available\"\nThe UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. The USIM shall be considered as invalid for SMS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a.\n\"SMS services not available in this PLMN\"\nThe UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.\nThe UE may provide a notification to the user or the upper layers that the SMS services are not available.\nThe UE shall not attempt normal attach or tracking area updating procedures indicating \"SMS only\" with current PLMN until switching off the UE or the UICC containing the USIM is removed. Additionally, the UE may perform a PLMN selection according to 3GPP TS 23.122 [6].\n\"Network failure\"\nThe UE shall stop timer T3410 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.\nIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered.\nIf the tracking area updating attempt counter is equal to 5:\n-\tthe UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered.\n\"Congestion\"\nThe UE shall stop the timer T3410 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered.\nOther values are considered as abnormal cases. The attach procedure shall be considered as failed for SMS services. The behaviour of the UE in those cases is specified in clause 5.5.1.2.6A.\nIf the attach request cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value.\nIf EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the attach request included a PDN CONNECTIVITY REQUEST message, the attach procedure fails due to:\n-\ta default EPS bearer setup failure;\n-\tan ESM procedure failure; or\n-\toperator determined barring is applied on default EPS bearer context activation during attach procedure,\nthe MME shall:\n-\tcombine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19 \"ESM failure\"; or\n-\tsend the ATTACH REJECT message with the EMM cause set to #15 \"No suitable cells in tracking area\", if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP TS 29.274 [16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value \"E-UTRAN not allowed\".\nIf the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIn NB-S1 mode, if the attach request is rejected due to operator determined barring (see 3GPP TS 29.272 [16C]), the network shall set the EMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIf the attach request is rejected due to service gap control as specified in clause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 \"congestion\" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.\nIf the attach request is rejected due to incompatibility between the CIoT EPS optimizations supported by the UE and what the network supports and the network sets the EMM cause value to #15 \"no suitable cells in tracking area\", the network may additionally include the Extended EMM cause IE with value \"requested EPS optimization not supported\".\nNOTE 1:\tHow the UE uses the Extended EMM cause IE with value \"requested EPS optimization not supported\" is implementation specific. The UE still behaves according to the EMM cause value #15.\nBased on operator policy, if the attach request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 \"Redirection to 5GCN required\".\nNOTE 2:\tThe network can take into account the UE's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 \"Redirection to 5GCN required\".\nIn NB-S1 mode or WB-S1 mode via satellite E-UTRAN access, if the attach request is from a UE via a satellite E-UTRA cell and the network using the User Location Information provided by the eNodeB (see 3GPP TS 36.413 [23]), is able to determine that the UE is in a location where the network is not allowed to operate, the network shall set the EMM cause value in the ATTACH REJECT message to #78 \"PLMN not allowed to operate at the present UE location\".\nUpon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410.\nIf the ATTACH REJECT message with EMM cause #25 or #78 was received without integrity protection, then the UE shall discard the message.\nIf the MME received multiple TAIs from the satellite E-UTRAN as described in 3GPP TS 23.401 [10], and determines that, by UE subscription and operator's preferences, all of the received TAIs are forbidden for roaming or for regional provision of service, the MME shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE;\nb)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth,\nin the ATTACH REJECT message.\nRegardless of the EMM cause value received in the ATTACH REJECT message,\n-\tif the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE in the ATTACH REJECT message, the UE shall store the TAI(s) which are belonging to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"forbidden tracking areas for roaming\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s); and\n-\tif the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE in the ATTACH REJECT message, the UE shall store the TAI(s) which are belonging to the serving PLMN or equivalent PLMN(s)included in the IE, if not already stored, into the list of \"forbidden tracking areas for regional provision of service\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s)\nFurthermore, the UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.\n#3\t(Illegal UE);\n#6\t(Illegal ME); or\n#8\t(EPS services and non-EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and enter state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\nFor the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\nNOTE 3:\tThe possibility to configure a UE so that the radio transceiver for a specific RAT is not active, although it is implemented in the UE, is out of scope of the present specification.\n#7\t(EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. Additionally, the UE shall enter state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.\nIn S1 mode, the UE shall store the PLMN identity in the \"forbidden PLMN list\" and enter state EMM-DEREGISTERED.PLMN-SEARCH and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause value #11and no RR connection exists.\nFor the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n#12\t(Tracking area not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.\nIn S1 mode, the UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\" and enter the state EMM-DEREGISTERED.LIMITED-SERVICE. If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for regional provision of service\" for non-integrity protected NAS reject message.\nIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.\nIn S1 mode, the UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message. Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH. If the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 [54] clause 4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#14\t(EPS services not allowed in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.\nIn S1 mode, the UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list. Additionally, the UE shall enter state EMM-DEREGISTERED.PLMN-SEARCH and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n#15\t(No suitable cells in tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message. Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE and:\n-\tif the UE is in WB-S1 mode and the Extended EMM cause IE with value \"E-UTRAN not allowed\" is included in the ATTACH REJECT message, the UE supports \"E-UTRA Disabling for EMM cause #15\", and the \"E-UTRA Disabling Allowed for EMM cause #15\" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in clause 4.5 and search for a suitable cell in GERAN, UTRAN or NG-RAN radio access technology;\n-\tif the UE is in NB-S1 mode and the Extended EMM cause IE with value \"NB-IoT not allowed\" is included in the ATTACH REJECT message, then the UE may disable the NB-IoT capability as specified in clause 4.9 and search for a suitable cell in E-UTRAN radio access technology;\n-\totherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].\nIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#22\t(Congestion);\nIf the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause 5.5.1.2.6.\nThe UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\nThe UE shall stop timer T3346 if it is running.\nIf the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\nIf the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].\nThe UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#25\t(Not authorized for this CSG);\nEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.1.2.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause 5.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nIf the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\nIf the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] clause 3.1A.\nThe UE shall search for a suitable cell according to 3GPP TS 36.304 [21].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.\n#31\t(Redirection to 5GCN required);\nEMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for N1 mode is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.1.2.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.\nThe UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause 4.5) and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#36\t(IAB-node operation not authorized);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.\nIn S1 mode, the UE shall store the PLMN identity in the \"forbidden PLMN list\" and enter state EMM-DEREGISTERED.PLMN-SEARCH and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nIn S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of \"forbidden PLMNs for attach in S101 mode\" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#42\t(Severe network failure);\nThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n#78\t(PLMN not allowed to operate at the present UE location).\nThis cause value received from a non-satellite E-UTRA cell is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.1.2.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the registration attempt counter. The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of \"PLMNs not allowed to operate at the present UE location\", start a corresponding timer instance (see clause 4.11.2), enter state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\nOther values are considered as abnormal cases. The behaviour of the UE in those cases is specified in clause 5.5.1.2.6.\nIf the attach request for emergency bearer services cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including EMM cause #5 \"IMEI not accepted\" or one of the EMM cause values as described in clause 5.5.1.2.5.\nNOTE 1:\tIf EMM cause #11 is sent to a UE of a roaming subscriber attaching for emergency bearer services and the UE is in automatic network selection mode, it cannot obtain normal service provided by this PLMN.\nUpon receiving the ATTACH REJECT message including EMM cause #5, the UE shall enter the state EMM-DEREGISTERED.NO-IMSI.\nUpon receiving the ATTACH REJECT message including one of the other EMM cause values, the UE shall perform the actions as described in clause 5.5.1.2.5 with the following addition: the UE shall inform the upper layers of the failure of the procedure.\nNOTE 2:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nIf the attach request for emergency bearer services fails due to abnormal case a) in clause .2.6, the UE shall perform the actions as described in clause 5.5.1.2.6 and inform the upper layers of the failure to access the network.\nNOTE 3:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nIf the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in clause .2.6, the UE shall perform the actions as described in clause 5.5.1.2.6 with the following addition: the UE shall inform the upper layers of the failure of the procedure.\nNOTE 4:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nIn a shared network, upon receiving the ATTACH REJECT message, the UE shall perform the actions as described in clause 5.5.1.2.5, and shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE 5:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN .\nb)\tattempt to perform a PLMN selection in the shared network and, if an attach for emergency bearer services was not already attempted with the selected PLMN and the ATTACH REQUEST message:\n-\tdid not include a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\", initiate an attach for emergency bearer services to the selected PLMN; or\n-\tdid include a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\" and:\ni)\tthe selected PLMN is an equivalent PLMN, initiate an attach for emergency bearer services to the selected PLMN; and\nii)\tthe selected PLMN is not an equivalent PLMN, perform a PLMN selection and initiate an attach for emergency bearer services to the selected PLMN if an attach for emergency bearer services was not already attempted with the selected PLMN.\nIn a shared network, if the attach request for emergency bearer services fails due to abnormal case a) in clause .2.6, the UE shall perform the actions as described in clause 5.5.1.2.6 and shall:\na)\tinform the upper layers of the failure to access the network; or\nNOTE 6:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN .\nb)\tattempt to perform a PLMN selection in the shared network and, if an attach for emergency bearer services was not already attempted with the selected PLMN and the ATTACH REQUEST message:\n-\tdid not include a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\", initiate an attach for emergency bearer services to the selected PLMN; or\n-\tdid include a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\" and:\ni)\tthe selected PLMN is an equivalent PLMN, initiate an attach for emergency bearer services to the selected PLMN; and\nii)\tthe selected PLMN is not an equivalent PLMN, perform a PLMN selection and initiate an attach for emergency bearer services to the selected PLMN if an attach for emergency bearer services was not already attempted with the selected PLMN.\nIn a shared network, if the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in clause .2.6, the UE shall perform the actions as described in clause 5.5.1.2.6, and shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE 7:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN .\nb)\tattempt to perform a PLMN selection in the shared network and, if an attach for emergency bearer services was not already attempted with the selected PLMN and the ATTACH REQUEST message\n-\tdid not include a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\", initiate an attach for emergency bearer services to the selected PLMN; or\n-\tdid include a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\" and:\ni)\tthe selected PLMN is an equivalent PLMN, initiate an attach for emergency bearer services to the selected PLMN; and\nii)\tthe selected PLMN is not an equivalent PLMN, perform a PLMN selection and initiate an attach for emergency bearer services to the selected PLMN if an attach for emergency bearer services was not already attempted with the selected PLMN.\nIf the network cannot accept an attach request with attach type not set to \"EPS emergency attach\" and including a PDN CONNECTIVITY REQUEST message with request type set to \"emergency\", the UE shall perform the procedures as described in clause 5.5.1.2.5. If the attach request with attach type not set to \"EPS emergency attach\" for initiating a PDN connection for emergency bearer services fails due to receiving the AUTHENTICATION REJECT message, the UE shall perform the procedures as described in clause 5.4.2.5. Then if the UE is in the same selected PLMN where the last attach request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE 1:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nb)\tattempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.\nIf the network cannot accept an attach request with attach type not set to \"EPS emergency attach\" and including a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\", the UE shall perform the procedures as described in clause 5.5.1.2.5. Then if the UE is in the same selected PLMN or equivalent PLMN where the last attach request was attempted, the UE shall attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.\nIf the attach request with attach type not set to \"EPS emergency attach\" for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in clause .2.6, the UE shall perform the actions as described in clause 5.5.1.2.6 and inform the upper layers of the failure to access the network.\nNOTE 2:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nIf the attach request with attach type not set to \"EPS emergency attach\" and including a PDN CONNECTIVITY REQUEST message with request type set to \"emergency\" fails due to abnormal cases b), c) or d) as well as l) when the \"Extended wait time\" is ignored, and la) when the \"Extended wait time CP data\" is ignored in clause .2.6, the UE shall perform the procedures as described in clause 5.5.1.2.6. Then if the UE is in the same selected PLMN where the last attach request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE 3:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nb)\tattempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.\nIf the attach request with attach type not set to \"EPS emergency attach\" and including a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\" fails due to abnormal cases b), c), d) or o) in clause .2.6, the UE shall perform the procedures as described in clause 5.5.1.2.6. Then if the UE is in the same selected PLMN or equivalent PLMN where the last attach request was attempted, the UE shall attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.\nIf the network cannot accept attach request including a PDN CONNECTIVITY REQUEST message with request type set to \"handover\" and the UE also intends to transfer an emergency PDU session, the UE shall attempt EPS attach for emergency bearer services including a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\" for the emergency PDU session.\nIf the attach request, including a PDN CONNECTIVITY REQUEST message with request type set \"handover\", fails due to abnormal case a) in clause 5.5.1.2.6 and the UE intends to transfer an emergency PDU session, the UE shall attempt EPS attach including a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\" for the emergency PDU session.\nIf the attach request including a PDN CONNECTIVITY REQUEST message with request type set \"handover\" fails due to abnormal cases b), c), d) or o) in clause 5.5.1.2.6, the UE intends to transfer an emergency PDU session:\n-\tif an EMM cause set to #19 \"ESM failure\" is received, the UE shall attempt EPS attach; and\n-\totherwise, the UE shall attempt EPS attach for emergency bearer services,\nwith the ATTACH REQUEST message including a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\" for the emergency PDU session.\nIf the attach request for access to RLOS is received by the network and the UE requesting attach is not in limited service state, the MME shall reject the UE's attach request.\nIf the attach request for access to RLOS cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including EMM cause #35 \"Requested service option not authorized in this PLMN\" or one of the EMM cause values as described in clause 5.5.1.2.5.\nUpon receiving the ATTACH REJECT message including EMM cause #35, the UE shall enter the state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.\nUpon receiving the ATTACH REJECT message including one of the other EMM cause values, the UE shall perform the actions as described in clause 5.5.1.2.5. along with the following conditions:\na)\tif the action for the reject involves searching for a suitable cell in E-UTRAN radio access technology, the UE shall proceed with the action and shall attempt to attach for access to RLOS in the new tracking area, if found; and\nb)\tif the action for the reject involves attempting to select GERAN or UTRAN radio access technology or disabling the E-UTRA capability, the UE shall skip the action for as long as access to RLOS is still needed.\nNOTE:\tHow long the UE attempts to access RLOS is up to UE implementation.\nThen if the UE is in the same selected PLMN where the last attach procedure was attempted and rejected and if timer T3346 is not running, perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.\nIf the attach request for access to RLOS fails due to abnormal cases b), c) or d) in clause 5.5.1.2.6, the UE shall perform the procedures as described in clause 5.5.1.2.6 with the exception that the UE shall skip actions that involve attempting to select GERAN or UTRAN radio access technology and actions that involve disabling the E-UTRA capability, for as long as access to RLOS is still needed.\nThe following abnormal cases can be identified:\na)\tAccess barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without \"Extended wait time\" received from lower layers\nIn WB-S1 mode, if access is barred for \"originating signalling\" (see 3GPP TS 36.331 [22]), the attach procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started as soon as possible, i.e. when access for \"originating signalling\" is granted on the current cell or when the UE moves to a cell where access for \"originating signalling\" is granted.\nIn NB-S1 mode, if access is barred for \"originating signalling\" (see 3GPP TS 36.331 [22]), the attach procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the attach procedure is started again after an implementation dependent time.\nIn NB-S1 mode, if access is barred for \"originating signalling\" (see 3GPP TS 36.331 [22]), a request for an exceptional event is received from the upper layers, then the attach procedure shall be started.\nNOTE 1:\tIn NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 [22]).\nIf access is barred because of access class barring for \"originating signalling\" (see 3GPP TS 36.331 [22]), ACDC is applicable to the request from the upper layers and the UE supports ACDC, then the attach procedure shall be started.\nIf access is barred for a certain ACDC category (see 3GPP TS 36.331 [22]), a request with a higher ACDC category is received from the upper layers and the UE supports ACDC, then the attach procedure shall be started.\nIf an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 [22]), a request with a certain ACDC category is received from the upper layers and the UE supports ACDC, then the attach procedure shall be started.\naa)\tLower layer failure to establish the RRC connection and:\n-\tthe UE is in its HPLMN or in an EHPLMN (if the EHPLMN list is present);\n-\tthe attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to \"EPS emergency attach\";\n-\tthe UE supports being configured with CustomLLFailureRetry as specified in 3GPP TS 24.368 [15A]); and\n-\tCustomLLFailureRetry leaf is present as specified in 3GPP TS 24.368 [15A]);\nThe UE shall increment the UE implementation specific attempt counter. If the UE implementation specific attempt counter is less than the value of MaxMinRetry consecutive attempts, the UE shall start T3411 with the duration of MinRetryTimer. If the UE implementation specific attempt counter is equal to the value of MaxMinRetry, the UE shall start T3402 with the duration of MaxRetryTimer and set the attach attempt counter to 5.\nThe attach procedure shall be aborted, and the UE shall proceed as described below.\nb)\tLower layer failure not covered in case aa) or release of the NAS signalling connection without \"Extended wait time\" and without \"Extended wait time CP data\" received from lower layers before the ATTACH ACCEPT or ATTACH REJECT message is received\nThe attach procedure shall be aborted, and the UE shall proceed as described below.\nc)\tT3410 timeout\nThe UE shall abort the attach procedure. The NAS signalling connection, if any, shall be released locally.\nNOTE 2:\tThe NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in clause 5.4.2.7.\nThe UE shall proceed as described below.\nd)\tATTACH REJECT, other EMM cause values than those treated in clause 5.5.1.2.5, and cases of EMM cause values #22, #25, #31 and #78, if considered as abnormal cases according to clause 5.5.1.2.5\nUpon reception of the EMM cause #19 \"ESM failure\", if the UE is not configured for NAS signalling low priority and the ESM cause value received in the PDN CONNECTIVITY REJECT message is not #54 \"PDN connection does not exist\", the UE may set the attach attempt counter to 5. Subsequently, if the UE needs to retransmit the ATTACH REQUEST message to request PDN connectivity towards a different APN, the UE may stop T3411 or T3402, if running, and send the ATTACH REQUEST message. If the UE needs to attempt EPS attach to request transfer of a PDN connection for emergency bearer services by including a PDN CONNECTIVITY REQUEST message with request type set to \"handover of emergency bearer services\", the UE shall stop T3411 or T3402, if running, and send the ATTACH REQUEST message.\nNOTE 3:\tWhen receiving EMM cause #19 \"ESM failure\", coordination is required between the EMM and ESM sublayers in the UE to determine whether to set the attach attempt counter to 5.\nIf the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to \"EPS emergency attach\", upon reception of the EMM causes #95, #96, #97, #99 and #111 the UE should set the attach attempt counter to 5.\nThe UE shall proceed as described below.\ne)\tChange of cell into a new tracking area\nIf a cell change into a new tracking area occurs before the attach procedure is completed, the attach procedure shall be aborted and re-initiated immediately. If a tracking area border is crossed when the ATTACH ACCEPT message has been received but before an ATTACH COMPLETE message is sent, the attach procedure shall be re-initiated. If a GUTI was allocated during the attach procedure, this GUTI shall be used in the attach procedure.\nf)\tMobile originated detach required\nThe attach procedure shall be aborted, and the UE initiated detach procedure shall be performed.\ng)\tDetach procedure collision\nIf the UE receives a DETACH REQUEST message from the network in state EMM-REGISTERED-INITIATED and the detach type indicates \"re-attach not required\" and no EMM cause IE, or \"re-attach not required\" and the EMM cause value is not #2 \"IMSI unknown in HSS\", the detach procedure shall be progressed and the attach procedure shall be aborted. If the UE receives a DETACH REQUEST message from the network in state EMM-REGISTERED-INITIATED and the detach type indicates \"re-attach required\", the detach procedure shall be progressed and the UE shall locally release the NAS signalling connection, before re-initiating the attach procedure. Otherwise the attach procedure shall be progressed and the DETACH REQUEST message shall be ignored.\nh)\tTransmission failure of ATTACH REQUEST message indication from lower layers\nThe UE shall restart the attach procedure immediately.\ni)\tTransmission failure of ATTACH COMPLETE message indication from lower layers\nIf the current TAI is not in the TAI list, the UE shall restart the attach procedure.\nIf the current TAI is still in the TAI list, it is up to the UE implementation how to re-run the ongoing procedure. The EMM sublayer notifies the ESM sublayer that the ESM message in the ESM message container IE of the ATTACH COMPLETE has failed to be transmitted.\nj)\tIf EMM-REGISTERED without PDN connection is not supported by the UE or the MME, and the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE due to failure in the UE ESM sublayer, then the UE shall initiate the detach procedure by sending a DETACH REQUEST message to the network. Further UE behaviour is implementation specific.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE due to failure in the UE ESM sublayer, then the UE shall either send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT contained in the ESM message container information element to the network or initiate the detach procedure by sending a DETACH REQUEST message. Further UE behaviour is implementation specific.\nk)\tIndication from the lower layers that an S101 mode to S1 mode handover has been cancelled (S101 mode only)\nThe UE shall abort the attach procedure and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.\nl)\t\"Extended wait time\" from the lower layers\nIf the ATTACH REQUEST message contained the low priority indicator set to \"MS is configured for NAS signalling low priority\", the UE shall start timer T3346 with the \"Extended wait time\" value and reset the attach attempt counter.\nIf the ATTACH REQUEST message did not contain the low priority indicator set to \"MS is configured for NAS signalling low priority\", the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11 – 15 in selected PLMN, then the UE shall start timer T3346 with the \"Extended wait time\" value and reset the attach attempt counter.\nIn other cases the UE shall ignore the \"Extended wait time\".\nThe UE shall abort the attach procedure, stay in the current serving cell, change the state to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and apply the normal cell reselection process.\nThe UE shall proceed as described below.\nla)\t\"Extended wait time CP data\" from the lower layers\nIf the UE is operating in NB-S1 mode, the UE shall start the timer T3346 with the \"Extended wait time CP data\" value and reset the attach attempt counter.\nIn other cases the UE shall ignore the \"Extended wait time CP data\".\nThe UE shall abort the attach procedure, stay in the current serving cell, change the state to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and apply the normal cell reselection process.\nThe UE shall proceed as described below.\nm)\tTimer T3346 is running\nThe UE shall not start the attach procedure unless:\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE needs to attach for emergency bearer services;\n-\tthe UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and\ni)\tthe UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]); and\nii)\ttimer T3346 was not started when NAS signalling connection was established with RRC establishment cause set to \"MO exception data\"; or\n-\tthe UE needs to attach without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to \"MS is configured for NAS signalling low priority\".\nThe UE stays in the current serving cell and applies the normal cell reselection process.\nNOTE 4:\tIt is considered an abnormal case if the UE needs to initiate an attach procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.\nThe UE shall proceed as described below.\nn)\tIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, an ESM DUMMY MESSAGE is included in the ESM message container information element of the ATTACH REQUEST message and the UE receives the ATTACH ACCEPT message combined with a PDN CONNECTIVITY REJECT message, the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network. Further UE behaviour is implementation specific.\no)\tTimer T3447 is running\nThe UE shall not start the attach procedure unless:\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE attempts to attach for emergency bearer services; or\n-\tthe UE attempts to attach without PDN connection request.\nThe UE stays in the current serving cell and applies the normal cell reselection process. The attach request procedure is started, if still necessary, when timer T3447 expires.\nFor the cases aa, b, c, d, l, la and m:\n-\tTimer T3410 shall be stopped if still running.\n-\tFor the cases aa, b, c, d, l when the \"Extended wait time\" is ignored, and la when the \"Extended wait time CP data\" is ignored, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to \"EPS emergency attach\", the attach attempt counter shall be incremented, unless it was already set to 5.\n-\tIf the attach attempt counter is less than 5:\n-\tfor the cases l, la and m, the attach procedure is started, if still necessary, when timer T3346 expires or is stopped;\n-\tfor the cases aa, b, c, d, l when the \"Extended wait time\" is ignored, and la when the \"Extended wait time CP data\" is ignore, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to \"EPS emergency attach\", timer T3411 is started and the state is changed to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. When timer T3411 expires the attach procedure shall be restarted, if still required by ESM sublayer.\n-\tIf the attach attempt counter is equal to 5:\n-\tthe UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs and KSI, shall set the update status to EU2 NOT UPDATED, and shall start timer T3402 if he value of the timer as indicated by the network is not zero. The state is changed to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH or optionally to EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; and\n-\tif A/Gb mode, Iu mode or N1 mode is supported by the UE:\n-\tif A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the abnormal case when a normal attach procedure fails and the attach attempt counter is equal to 5;\n-\tif the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the abnormal case when an initial registration procedure performed over 3GPP access fails and the registration attempt counter is equal to 5; and\n-\texcept for case aa the UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate GMM or 5GMM specific procedures. For case aa the UE may attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate GMM or 5GMM specific procedures. Additionally, if the UE selects GERAN or UTRAN radio access technology, the UE may disable the E-UTRA capability as specified in clause 4.5. If No E-UTRA Disabling In 5GS is enabled at the UE (see 3GPP TS 24.368 [50] or 3GPP TS 31.102 [17]) and the UE selects NG-RAN radio access technology, it shall not disable the E-UTRA capability; otherwise, the UE may disable the E-UTRA capability as specified in clause 4.5.\n-\tif the value of T3402 as indicated by the network is zero, the UE shall perform the actions defined for the expiry of the timer T3402.\nNOTE 5:\tWhether the UE requests RRC to treat the active E-UTRA cell as barred (see 3GPP TS 36.304 [21]) is left to the UE implementation.\nThe UE shall proceed as follows:\n1)\tif the attach was successful for EPS services only and the ATTACH ACCEPT message contained a value included in the SMS services status IE not treated in clause 5.5.1.2.4A, the UE shall proceed as follows:\na)\tThe UE shall stop timer T3410 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;\nb)\tIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered;\nc)\tIf the tracking area updating attempt counter is equal to 5:\n-\tthe UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered; and\n2)\totherwise, the abnormal cases specified in clause 5.5.1.2.6 apply.\nThe following abnormal cases can be identified:\na)\tLower layer failure\nIf a lower layer failure occurs before the message ATTACH COMPLETE has been received from the UE, the network shall locally abort the attach procedure, enter state EMM-DEREGISTERED and shall not resend the message ATTACH ACCEPT. If a new GUTI was assigned to the UE in the attach procedure, the MME shall consider both the old and the new GUTI as valid until the old GUTI can be considered as invalid by the network or the EMM context which has been marked as detached in the network is released.\nIf the old GUTI was allocated by an MME other than the current MME, the current MME does not need to retain the old GUTI. If the old GUTI is used by the UE in a subsequent attach message, the network may use the identification procedure to request the UE's IMSI.\nb)\tProtocol error\nIf the ATTACH REQUEST message is received with a protocol error, the network shall return an ATTACH REJECT message with one of the following EMM cause values:\n#96:\tinvalid mandatory information;\n#99:\tinformation element non-existent or not implemented;\n#100:\tconditional IE error; or\n#111:\tprotocol error, unspecified.\nc)\tT3450 time-out\nOn the first expiry of the timer, the network shall retransmit the ATTACH ACCEPT message and shall reset and restart timer T3450.\nThis retransmission is repeated four times, i.e. on the fifth expiry of timer T3450, the attach procedure shall be aborted and the MME enters state EMM-DEREGISTERED. If a new GUTI was allocated in the ATTACH ACCEPT message, the network shall consider both the old and the new GUTI as valid until the old GUTI can be considered as invalid by the network or the EMM context which has been marked as detached in the network is released. If the old GUTI was allocated by an MME other than the current MME, the current MME does not need to retain the old GUTI.\nIf the old GUTI is used by the UE in a subsequent attach message, the network acts as specified for case a above.\nd)\tATTACH REQUEST received after the ATTACH ACCEPT message has been sent and before the ATTACH COMPLETE message is received\n-\tIf one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, the previously initiated attach procedure shall be aborted if the ATTACH COMPLETE message has not been received and the new attach procedure shall be progressed; or\n-\tif the information elements do not differ, then the ATTACH ACCEPT message shall be resent and the timer T3450 shall be restarted if an ATTACH COMPLETE message is expected. In that case, the retransmission counter related to T3450 is not incremented.\ne)\tMore than one ATTACH REQUEST received and no ATTACH ACCEPT or ATTACH REJECT message has been sent\n-\tIf one or more of the information elements in the ATTACH REQUEST message differs from the ones received within the previous ATTACH REQUEST message, the previously initiated attach procedure shall be aborted and the new attach procedure shall be executed;\n-\tif the information elements do not differ, then the network shall continue with the previous attach procedure and shall ignore the second ATTACH REQUEST message.\nf)\tATTACH REQUEST received in state EMM-REGISTERED\nIf an ATTACH REQUEST message is received in state EMM-REGISTERED the network may initiate the EMM common procedures; if it turned out that the ATTACH REQUEST message was sent by a genuine UE that has already been attached, the EMM context, EPS bearer contexts, if any, are deleted and the new ATTACH REQUEST is progressed, otherwise if network considers ATTACH REQUEST message was not sent by a genuine UE based on authentication procedure the network shall maintain the EMM-context, if any, unchanged.\nNOTE 1:\tThe network can determine that the UE is genuine by executing the authentication procedure as described in clause 5.4.2.\ng)\tTRACKING AREA UPDATE REQUEST message received before ATTACH COMPLETE message.\nTimer T3450 shall be stopped. The allocated GUTI in the attach procedure shall be considered as valid and the tracking area updating procedure shall be rejected with the EMM cause #10 \"implicitly detached\" as described in clause 5.5.3.2.5.\nh)\tDETACH REQUEST message received before ATTACH COMPLETE message.\nThe network shall abort the attach procedure and shall progress the detach procedure as described in clause 5.5.2.2.\ni)\tIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME receives an ATTACH REQUEST message with an ESM message included in the ESM message container information element, and the ESM sublayer in the MME detects a message error according to clause 7, the MME may decide to proceed with the attach procedure or to reject it. When sending the ATTACH ACCEPT or ATTACH REJECT message to the UE, the MME shall include the ESM message provide by the ESM layer in the ESM message container information element.\nj)\tUE security capabilities invalid or unacceptable\nIf the ATTACH REQUEST message is received with invalid or unacceptable UE security capabilities (e.g. no EPS encryption algorithms (all bits zero), no EPS integrity algorithms (all bits zero), mandatory EPS encryption algorithms not supported or mandatory EPS integrity algorithms not supported, etc.), the MME shall return an ATTACH REJECT message.\nNOTE 2:\tEMM cause value to be used in ATTACH REJECT message is up to the network implementation.\nThe combined attach procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services, or both EPS services and \"SMS only\".\nThe combined attach procedure is also used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for EPS services if it is already IMSI attached for non-EPS services.\nWhen the UE initiates a combined attach procedure, the UE shall indicate \"combined EPS/IMSI attach\" in the EPS attach type IE.\nThe combined attach procedure follows the attach procedure for EPS described in clause 5.5.1.2 with exception of clause 5.5.1.2.4A and clause 5.5.1.2.6A.\nIf the UE is in EMM state EMM-DEREGISTERED, the UE initiates the combined attach procedure by sending an ATTACH REQUEST message to the network, starting timer T3410 and entering state EMM-REGISTERED-INITIATED (see example in figure 5.5.1.2.2.1).\nThe UE shall include the TMSI status IE if no valid TMSI is available. Furthermore, if the UE has stored a valid location area identification, the UE shall include it in the Old location area identification IE in the ATTACH REQUEST message.\nIf the UE has stored a valid TMSI, the UE shall include the TMSI based NRI container IE in the ATTACH REQUEST message.\nIf the UE initiates a combined attach procedure for EPS services and \"SMS only\", the UE shall indicate \"SMS only\" in the Additional update type IE.\nThe network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures, depending on the received information such as IMSI, GUTI and KSI.\nDepending on the value of the EPS attach result IE received in the ATTACH ACCEPT message, the following different cases can be distinguished:\n1)\tThe EPS attach result IE value indicates \"combined EPS/IMSI attach\": attach for EPS and non-EPS services, or for EPS services and \"SMS only\" have been successful.\n2)\tThe EPS attach result IE value indicates \"EPS only\": attach for EPS services has been successful but attach for non-EPS services or \"SMS only\" has failed.\nThe description for attach for EPS services as specified in clause 5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services or \"SMS only\" applies.\nThe TMSI reallocation may be part of the combined attach procedure. The TMSI allocated is then included in the ATTACH ACCEPT message, together with the location area identification (LAI). In this case the MME shall start timer T3450 as described in clause 5.4.1.4, and enter state EMM-COMMON-PROCEDURE-INITIATED. If the MME does not indicate \"SMS only\" in the ATTACH ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.\nFor a shared network in CS domain, the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP TS 23.272 [9].\nThe UE, receiving an ATTACH ACCEPT message, stores the received location area identification, stops timer T3410, resets the location update attempt counter and sets the update status to U1 UPDATED. If the message contains an IMSI, the UE is not allocated any TMSI, and shall delete any TMSI accordingly. If the message contains a TMSI, the UE shall use this TMSI as the new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. If neither a TMSI nor an IMSI has been included by the network in the ATTACH ACCEPT message, the old TMSI, if any available, shall be kept.\nIf the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" events (see clause 5.3.7b), then the UE shall reset this counter.\nIf the UE requested \"SMS only\" in the Additional update type IE, or if the UE requested a combined attach for EPS and non-EPS services, but the network decides to accept the attach request for EPS services and \"SMS only\", the network shall indicate \"SMS only\" in the Additional update result IE. In addition, if the SMS services are provided via SMS in MME, the network shall provide a non-broadcast LAI in the ATTACH ACCEPT message. If a TMSI has to be allocated, then the network shall also provide a TMSI value which cannot cause any ambiguity with assigned TMSI values.\nIf the ATTACH ACCEPT message includes the Additional update result IE with value \"SMS only\", a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with \"IMS voice available\" shall not attempt to use CS fallback for mobile originating services.\nAs an implementation option, if the ATTACH ACCEPT message does not include the Additional update result IE with value \"SMS only\" and the UE is not configured for NAS signalling low priority then the UE may stop timer T3246 if running.\nIf the ATTACH ACCEPT message includes the Additional update result IE with value \"CS Fallback not preferred\", this indicates to a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with \"IMS voice available\" that it is attached for EPS and non-EPS services and that it can use CS fallback.\nIf the LAI contained in the ATTACH ACCEPT message is a member of the list of \"forbidden location areas for regional provision of service\" or the list of \"forbidden location areas for roaming\" then such entry shall be deleted.\nIf the PLMN identity for the CS domain which is provided as part of the LAI contained in the ATTACH ACCEPT message differs from the PLMN identity provided as part of the GUTI, the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the ATTACH ACCEPT message.\nThe UE, when having requested PDN connectivity as contained in the ATTACH REQUEST message and on receiving the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, shall send an ATTACH COMPLETE message combined with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message to the network.\nUpon transmission of the ATTACH COMPLETE message the UE shall enter state EMM-REGISTERED and MM state MM-IDLE and set the EPS update status to EU1 UPDATED.\nIf the ATTACH ACCEPT message includes the Additional update result IE with value \"SMS only\" or \"CS Fallback not preferred\", a UE operating in CS/PS mode 1 with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see clause 4.5).\nUpon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED.\nNOTE:\tUpon receiving an ATTACH COMPLETE message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP TS 29.118 [16A].\nAfter the UE performs intersystem change from N1 mode to S1 mode, if:\n-\tthe network supports SRVCC for IMS emergency sessions (see 3GPP TS 23.216 [8]);\n-\tthe UE has an emergency PDN connection;\n-\tthe UE has set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to \"SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported; and\n-\tthe MME has neither an IMEI nor an IMEISV for the UE;\nthen the MME shall initiate the identification procedure (see clause 5.4.4) or the security mode control procedure (see clause 5.4.3) with the UE.\nApart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in clause 5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services applies.\nIf, due to emergency services fallback (see 3GPP TS 23.502 [59], clause 4.13.4), there is a request for emergency services pending and the emergency bearer services indicator in the EPS network feature support IE indicates \"emergency bearer services in S1 mode not supported\", then the UE shall skip the requirements defined below in the present clause for the receipt of an ATTACH ACCEPT message including an EMM cause value, attempt to select GERAN or UTRAN radio access technology, select a setup message as defined in clause 5.3.7, proceed with appropriate MM specific procedures, and send the setup message.\nThe UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the EMM cause value:\n#2\t(IMSI unknown in HSS)\nThe UE shall stop T3410 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until the UE is switched off, the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. If the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf, due to emergency services fallback (see 3GPP TS 23.502 [59]), there is a request for CS fallback call pending (see clause 5.3.7), the UE shall attempt to select GERAN or UTRAN radio access technology and attempt emergency call setup.\nA UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" shall disable the E-UTRA capability (see clause 4.5).\n#16\t(MSC temporarily not reachable); or\n#17\t(Network failure)\nThe UE shall stop timer T3410 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.\nIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered.\nIf the tracking area updating attempt counter is equal to 5:\n-\ta UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered;\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see clause 4.5).\n#18\t(CS domain not available)\nThe UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.\nThe UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.\nA UE in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see clause 4.5).\nA UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" may provide a notification to the user or the upper layers that the CS domain is not available.\nThe UE shall not attempt combined attach or combined tracking area updating procedures with current PLMN until switching off the UE or the UICC containing the USIM is removed.\n#22\t(Congestion)\nThe UE shall stop the timer T3410 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and shall enter state MM IDLE.\nOther EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined attach procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in clause 5.5.1.3.6.\nIf the attach request can neither be accepted by the network for EPS nor for non-EPS services, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the attach request included a PDN CONNECTIVITY REQUEST message, and the attach procedure fails due to a default EPS bearer setup failure, an ESM procedure failure or operator determined barring, the MME shall:\n-\tcombine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19, \"ESM failure\"; or\n-\tsend the ATTACH REJECT message with the EMM cause set to #15 \"No suitable cells in tracking area\", if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP TS 29.274 [16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value \"E-UTRAN not allowed\".\nIf the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nIf the attach request is rejected due to service gap control as specified in clause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 \"congestion\" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.\nBased on operator policy, if the attach request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 \"Redirection to 5GCN required\".\nNOTE:\tThe network can take into account the UE's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 \"Redirection to 5GCN required\".\nUpon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410 and enter MM state MM IDLE.\nIf the ATTACH REJECT message with EMM cause #25 or #78 was received without integrity protection, then the UE shall discard the message.\nThe UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.\n#3\t(Illegal UE);\n#6\t(Illegal ME); or\n#8\t(EPS services and non-EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI.\nThe UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\nFor the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n#7\t(EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. Additionally, the UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nA UE which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.\nThe UE shall attempt to select GERAN or UTRAN radio access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI, and reset the attach attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause value #11 and no RR connection exists.\nFor the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n#12\t(Tracking area not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for regional provision of service\" for non-integrity protected NAS reject message.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter. Additionally the UE enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message.\nIf the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 [54] clause 4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#14\t(EPS services not allowed in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.\nA UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see clause 4.5).\nA UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6].\nA UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n#15\t(No suitable cells in tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message. Additionally, the UE shall proceed as follows:\n-\tif the UE is in WB-S1 mode and the Extended EMM cause IE with value \"E-UTRAN not allowed\" is included in the ATTACH REJECT message, the UE supports \"E-UTRA Disabling for EMM cause #15\", and the \"E-UTRA Disabling Allowed for EMM cause #15\" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled, then the UE shall disable the E-UTRA capability as specified in clause 4.5 and search for a suitable cell in another location area or 5GS tracking area;\n-\tif the UE is in NB-S1 mode and the Extended EMM cause IE with value \"NB-IoT not allowed\" is included in the ATTACH REJECT message, then the UE may disable the NB-IoT capability as specified in clause 4.9 and search for a suitable cell in E-UTRAN radio access technology;\n-\totherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#22\t(Congestion);\nIf the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause 5.5.1.3.6.\nThe UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\nThe UE shall stop timer T3346 if it is running.\nIf the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\nIf the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].\nThe UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#25\t(Not authorized for this CSG);\nEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.1.3.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause 5.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nIf the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\nIf the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] clause 3.1A.\nThe UE shall search for a suitable cell according to 3GPP TS 36.304 [21].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status and location update attempt counter, and GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.\n#31\t(Redirection to 5GCN required);\nEMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for N1 mode is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.1.3.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.\nThe UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause 4.5) and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#36\t(IAB-node operation not authorized);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI, and reset the attach attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#42\t(Severe network failure);\nThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED signature, RAI and GPRS ciphering key sequence number TMSI and ciphering key sequence number.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\nOther values are considered as abnormal cases. The behaviour of the UE in those cases is specified in clause 5.5.1.3.6.\nThe UE shall proceed as follows:\n1)\tif the UE requested the combined attach for EPS services and \"SMS only\" and the ATTACH ACCEPT message indicates a combined attach successful for EPS and non-EPS services, the UE shall behave as if the combined attach was successful for EPS services and \"SMS only\";\nNOTE 1:\tIn this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to \"CS\", as specified in clause 5.6.2.3.2.\n2)\tif the combined attach was successful for EPS services only and the ATTACH ACCEPT message contained an EMM cause value not treated in clause 5.5.1.3.4.3 or the EMM cause IE is not included in the message, the UE shall proceed as follows:\na)\tThe UE shall stop timer T3410 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;\nb)\tIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered;\nc)\tIf the tracking area updating attempt counter is equal to 5:\n-\ta UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" shall start timer T3402 if the value of the timer as indicated by the network is not zero, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM.\n-\tIf the value of T3402 as indicated by the network is zero, the UE shall perform the actions defined for the expiry of the timer T3402.\n-\tWhen timer T3402 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered; and\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate MM, GMM or 5GMM specific procedures. If the UE selects GERAN or UTRAN radio access technology, the UE may disable the E-UTRA capability (see clause 4.5). If No E-UTRA Disabling In 5GS is enabled at the UE (see 3GPP TS 24.368 [50] or 3GPP TS 31.102 [17]) and the UE selects NG-RAN radio access technology, it shall not disable the E-UTRA capability; otherwise, the UE may disable the E-UTRA capability as specified in clause 4.5; and\nNOTE 2:\tWhether the UE requests RRC to treat the active E-UTRA cell as barred (see 3GPP TS 36.304 [21]) is left to the UE implementation.\nd)\tIf there is a CS fallback emergency call pending or CS fallback call pending, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; and\n3)\totherwise, the abnormal cases specified in clause 5.5.1.2.6 apply with the following modification.\nIf the attach attempt counter is incremented according to clause 5.5.1.2.6 the next actions depend on the value of the attach attempt counter:\n-\tif the attach attempt counter is less than 5, the UE shall set the update status to U2 NOT UPDATED but shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs; or\n-\tif the attach attempt counter is equal to 5, then the UE shall delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and set the update status to U2 NOT UPDATED.\n-\tThe UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate MM, GMM or 5GMM specific procedures. Additionally, if the UE selects GERAN or UTRAN radio access technology, the UE may disable the E-UTRA capability as specified in clause 4.5. If No E-UTRA Disabling In 5GS is enabled at the UE (see 3GPP TS 24.368 [50] or 3GPP TS 31.102 [17]) and the UE selects NG-RAN radio access technology, it shall not disable the E-UTRA capability; otherwise, the UE may disable the E-UTRA capability as specified in clause 4.5.\nNOTE 3:\tWhether the UE requests RRC to treat the active E-UTRA cell as barred (see 3GPP TS 36.304 [21]) is left to the UE implementation.\nIf there is a CS fallback emergency call pending or CS fallback call pending, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.\nThe abnormal cases specified in clause 5.5.1.2.7 apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.2\tDetach procedure",
                            "text_content": "The detach procedure is used:\n-\tby the UE to detach for EPS services only;\n-\tby the UE to disconnect from the last remaining PDN it is connected to if EMM-REGISTERED without PDN connection is not supported by the UE or the MME;\n-\tby the UE in CS/PS mode 1 or CS/PS mode 2 of operation to detach for both EPS services and non-EPS services or for non-EPS services only via a combined detach procedure;\n-\tby the network to inform the UE that it is detached for EPS services or non-EPS services or both;\n-\tby the network to disconnect the UE from the last remaining PDN to which it is connected if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; and\n-\tby the network to inform the UE to re-attach to the network and re-establish all PDN connections.\nNOTE 1:\tAfter a successful completion of an inter-system change of the UE from S1 mode to non-3GPP access, if the non-3GPP network provides PDN connectivity to the same EPC and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the MME performs a local detach of the UE.\nNOTE 2:\tIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, the detach procedure is not triggered when disconnecting the UE from the last remaining PDN to which it is connected.\nThe detach procedure also applies to the UE which is IMSI attached for \"SMS only\".\nThe detach procedure with appropriate detach type shall be invoked by the UE if the UE is switched off, the USIM card is removed from the UE, the UE wishes to detach for EPS services, the UE wishes to detach for non-EPS services or as part of the eCall inactivity procedure defined in clause 5.5.4.\nIf the detach procedure is triggered due to USIM removal, the UE shall indicate \"switch off\" in the detach type IE.\nWhen upper layers indicate that emergency bearer services are no longer required, the UE if still attached for emergency bearer services, may perform a detach followed by a re-attach to regain normal services, if the UE is in or moves to a suitable cell.\nIf a detach is requested by the HSS for a UE that has bearers for emergency services, the MME shall not send a DETACH REQUEST message to the UE, and shall follow the procedures in clause 6.4.4.1 for a UE that has bearers for emergency services.\nIf the detach procedure for EPS services is performed, the EPS bearer context(s), if any, for this particular UE are deactivated locally without peer-to-peer signalling between the UE and the MME.\nIf the UE supports A/Gb mode or Iu mode or both, the UE shall store the TIN in the non-volatile memory in the ME, as described in annex C, for a subsequent attach procedure.\nThe UE is allowed to initiate the detach procedure even if the timer T3346 is running.\nThe network proceeds with the detach procedure even if NAS level mobility management congestion control is active.\nThe detach procedure is initiated by the UE by sending a DETACH REQUEST message (see example in figure 5.5.2.2.1.1). The Detach type IE included in the message indicates whether detach is due to a \"switch off\" or not. The Detach type IE also indicates whether the detach is for EPS services only, for non-EPS services only, or for both. If the UE has a mapped EPS security context as the current EPS security context, the UE shall set the type of security context flag to \"mapped security context\". Otherwise, the UE shall set the type of security context flag to \"native security context\".\nIf the UE has a valid GUTI, the UE shall populate the EPS mobile identity IE with the valid GUTI. If the UE does not have a valid GUTI, the UE shall populate the EPS mobile identity IE with its IMSI.\nIf the UE does not have a valid GUTI and it does not have a valid IMSI, then the UE shall populate the EPS mobile identity IE with its IMEI.\nNOTE:\tDuring the attach for emergency bearer services or attach for access to RLOS when the UE (with no USIM or invalid USIM) is in EMM-REGISTERED-INITIATED STATE, the UE has neither a valid GUTI nor a valid IMSI.\nIf the detach is not due to switch off and the UE is in the state EMM-REGISTERED or EMM-REGISTERED-INITIATED, timer T3421 shall be started in the UE after the DETACH REQUEST message has been sent. If the detach type indicates that the detach is for non-EPS services only the UE shall enter the state EMM-REGISTERED.IMSI-DETACH-INITIATED, otherwise the UE shall enter the state EMM-DEREGISTERED-INITIATED. If the detach type indicates that the detach is for non-EPS services or both EPS and non-EPS services, the UE shall enter the state MM IMSI DETACH PENDING.\nIf the UE to be switched off is not operating in NB-S1 mode and not operating in WB-S1 mode in any enhanced coverage CE mode, the UE shall try for a period of 5 seconds to send the DETACH REQUEST message. If the UE to be switched off:\n-\tis operating in NB-S1 mode, then the UE should try for at least a period of 85 seconds to send the DETACH REQUEST; or\n-\tis operating in WB-S1 mode in any enhanced coverage CE mode, then the UE should try for at least a period of 14 seconds to send the DETACH REQUEST.\nDuring this period, the UE may be switched off as soon as the DETACH REQUEST message has been sent.\nAfter the last DETACH REQUEST message is sent, the UE shall proceed as follows:\n-\tif the current EPS security context is a native EPS security context, then the UE shall store the current EPS security context as specified in annex C and mark it as valid;\n-\telse if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, then the UE shall store the non-current EPS security context as specified in annex C and mark it as valid, and finally the UE shall delete any mapped EPS security context or partial native EPS security context.\nThe figure depicts a user-initiated detach procedure in a 5G network, illustrating the steps taken by the user to disconnect from the network. The figure shows the user's device (UE) initiating the detach process, which involves initiating a disconnect request to the network. The process is depicted with a series of steps, including the user's device initiating the disconnect, the network responding with a disconnect request, and the user's device initiating the disconnect again. The figure provides a visual representation of the complex process involved in user-initiated detach procedures in 5G networks.\nFigure 5.5.2.2.1.1: UE initiated detach procedure\nWhen the DETACH REQUEST message is received by the network, the network shall send a DETACH ACCEPT message to the UE, if the Detach type IE does not indicate \"switch off\". Otherwise, the procedure is completed when the network receives the DETACH REQUEST message.\nThe network and the UE shall deactivate the EPS bearer context(s), if any, for this UE locally without peer-to-peer signalling between the UE and the MME.\nThe UE is marked as inactive in the network for EPS services. The network shall enter the state EMM-DEREGISTERED.\nThe UE, when receiving the DETACH ACCEPT message, shall stop timer T3421. Furthermore, if the UE is operating in PS mode of operation, or is operating in CS/PS mode of operation and supports S1 mode only then:\n-\tIf the detach procedure was performed due to disabling of EPS services, then the UE shall enter the EMM-NULL state.\n-\tOtherwise, the UE shall enter the EMM-DEREGISTERED state.\nThe UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, and supporting A/Gb mode or Iu mode, shall further set the update status to U2 NOT UPDATED, disable the E-UTRA capability (see clause 4.5) and attempt to select GERAN or UTRAN access technology.\nWhen the DETACH REQUEST message is received by the network, a DETACH ACCEPT message shall be sent to the UE, if the Detach type IE does not indicate \"switch off\". Otherwise, the procedure is completed when the network receives the DETACH REQUEST message.\nDepending on the value of the Detach type IE the following applies:\n-\tcombined EPS/IMSI detach:\nThe network and the UE shall deactivate the EPS bearer context(s) for this UE locally without peer-to-peer signalling between the UE and the MME. The UE is marked as inactive in the network for EPS and for non-EPS services. The states EMM-DEREGISTERED and MM-NULL are entered in both the UE and the network.\n-\tIMSI detach:\nThe UE is marked as inactive in the network for non-EPS services. The states MM-NULL and EMM-REGISTERED are entered in both the UE and the network.\nThe UE, when receiving the DETACH ACCEPT message, shall stop timer T3421.\nThe following abnormal cases can be identified:\na)\tAccess barred because of access class barring, EAB or NAS signalling connection establishment rejected by the network\nIn WB-S1 mode, if access is barred for \"originating signalling\" (see 3GPP TS 36.331 [22]), the detach signalling procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The detach signalling procedure is started as soon as possible and if still necessary, i.e. when access for \"originating signalling\" is granted on the current cell or when the UE moves to a cell where access for \"originating signalling\" is granted. The UE may perform a local detach either immediately or after an implementation dependent time.\nIn NB-S1 mode, if access is barred for \"originating signalling\" (see 3GPP TS 36.331 [22]), the detach signalling procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the detach signalling procedure is started again after an implementation dependent time.\nNOTE 1:\tIn NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 [22]).\nb)\tLower layer failure or release of the NAS signalling connection before reception of DETACH ACCEPT message\nThe detach procedure shall be aborted and the UE proceeds as follows:\n-\tif the detach procedure was performed due to disabling of EPS services, the UE shall enter the EMM-NULL state;\n-\tif \"EPS detach\" was requested for reasons other than disabling of EPS services, the UE shall enter the EMM-DEREGISTERED state;\n-\tif \"IMSI detach\" was requested, the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; or\n-\tif \"combined EPS/IMSI detach\" was requested, the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state.\nc)\tT3421 timeout\nOn the first four expiries of the timer, the UE shall retransmit the DETACH REQUEST message and shall reset and restart timer T3421. On the fifth expiry of timer T3421, the detach procedure shall be aborted and the UE proceeds as follows:\n-\tif the detach procedure was performed due to disabling of EPS services, the UE shall enter the EMM-NULL state;\n-\tif \"EPS detach\" was requested for reasons other than disabling of EPS services, the UE shall enter the EMM-DEREGISTERED state;\n-\tif \"IMSI detach\" was requested, the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; or\n-\tif \"combined EPS/IMSI detach\" was requested, the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state.\nd)\tDetach procedure collision\nDetach containing cause \"switch off\" within the Detach type IE:\n-\tIf the UE receives a DETACH REQUEST message before the UE initiated detach procedure has been completed, this message shall be ignored and the UE initiated detach procedure shall continue.\nDetach containing other causes than \"switch off\" within the Detach type IE:\n-\tIf the UE receives a DETACH REQUEST message before the UE initiated detach procedure has been completed, it shall treat the message as specified in clause 5.5.2.3.2 with the following modifications:\n-\tIf the DETACH REQUEST message received by the UE contains detach type \"re-attach required\", and the UE initiated detach procedure is with detach type \"EPS detach\" or \"combined EPS/IMSI detach\", the UE need not initiate the attach or combined attach procedure.\n-\tIf the DETACH REQUEST message received by the UE contains detach type \"IMSI detach\", and the UE initiated detach procedure is with detach type \"IMSI detach\", the UE need not re-attach to non-EPS services.\n-\tIf the DETACH REQUEST message received by the UE contains detach type \"IMSI detach\", and the UE initiated detach procedure is with detach type \"EPS detach\" or \"combined EPS/IMSI detach\", the UE shall progress both procedures. The UE need not re-attach to non-EPS services.\ne)\tDetach and EMM common procedure collision\nDetach containing cause \"switch off\":\n-\tIf the UE receives a message used in an EMM common procedure before the detach procedure has been completed, this message shall be ignored and the detach procedure shall continue.\nDetach containing other causes than \"switch off\" and containing detach type \"IMSI detach\":\n-\tIf the UE receives a message used in an EMM common procedure before the detach procedure has been completed, both the EMM common procedure and the detach procedure shall continue.\nDetach containing other causes than \"switch off\" and containing other detach types than \"IMSI detach\":\n-\tIf the UE receives a GUTI REALLOCATION COMMAND, an EMM STATUS or an EMM INFORMATION message before the detach procedure is completed, this message shall be ignored and the detach procedure shall continue.\n-\tIf the UE receives an AUTHENTICATION REQUEST, SECURITY MODE COMMAND or IDENTITY REQUEST message before the detach procedure has been completed, the UE shall respond to it as described in clause 5.4.2, 5.4.3 and 5.4.4 respectively and the detach procedure shall continue.\nf)\tChange of cell into a new tracking area\nIf the UE detects the current TAI is not in the stored TAI list occurs before the UE initiated detach procedure is completed, the UE proceeds as follows:\n1)\tIf the detach procedure was initiated for reasons other than removal of the USIM or the UE is to be switched off, the detach procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure; or\n2)\tIf the detach procedure was initiated due to removal of the USIM or the UE is to be switched off, the UE shall abort the detach procedure, perform a local detach and enter the state EMM-DEREGISTERED.\ng)\tTransmission failure of DETACH REQUEST message indication with TAI change from lower layers\nIf the current TAI is not in the TAI list, the UE proceeds as follows:\n1)\tIf the detach procedure was initiated for reasons other than removal of the USIM or the UE is to be switched off, the detach procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure; or\n2)\tIf the detach procedure was initiated due to removal of the USIM or the UE is to be switched off, the UE shall abort the detach procedure, perform a local detach and enter the state EMM-DEREGISTERED.\nIf the current TAI is still part of the TAI list, the UE shall restart the detach procedure.\nh)\tTransmission failure of DETACH REQUEST message indication without TAI change from lower layers\nThe UE shall restart the detach procedure.\ni)\tDetach and paging procedure collision\nIf the UE receives a CS SERVICE NOTIFICATION message before the UE initiated combined detach procedure with detach type \"IMSI detach\" or \"combined EPS/IMSI detach\" has been completed, then this message shall be ignored and the UE initiated combined detach procedure shall continue.\nFor the cases b, f and g:\n-\tTimer T3421 shall be stopped if still running.\nThe following abnormal cases can be identified:\na)\tDetach request received in a CSG cell for which the UE has no valid CSG subscription\nIf the UE initiates a detach procedure in a CSG cell the CSG ID of which is not valid for the UE, and the detach procedure is not due to \"switch off\", the network shall proceed as follows:\n-\tif the detach type is \"IMSI detach\" and the UE has a PDN connection for emergency bearer services active, the MME shall send a DETACH ACCEPT message and deactivate all non-emergency EPS bearers, if any, by initiating an EPS bearer context deactivation procedure;\n-\totherwise, the network shall initiate the detach procedure. The MME shall send a DETACH REQUEST message including the EMM cause #25,\"not authorized for this CSG\".\nb)\tLower layers indication of non-delivered NAS PDU due to handover\nIf the DETACH ACCEPT message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the DETACH ACCEPT message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the DETACH ACCEPT message.\nThe network initiates the detach procedure by sending a DETACH REQUEST message to the UE (see example in figure 5.5.2.3.1).\nNOTE:\tIf the MME performs a local detach, it will inform the UE with an EMM messages (e.g. SERVICE REJECT or TRACKING AREA UPDATE reject) with EMM cause #10 \"implicitly detached\" only when the UE initiates an EMM procedure.\nThe network may include an EMM cause IE to specify the reason for the detach request. The network shall start timer T3422. If the Detach type IE indicates \"re-attach required\" or \"re-attach not required\" and the EMM cause value is not #2 \"IMSI unknown in HSS\", or if the MME performs a local detach, the MME shall either store the current EPS security context if it is a native EPS security context, or the MME shall delete the current EPS security context if it is a mapped EPS security context. If the detach type IE indicates \"re-attach required\" or \"re-attach not required\" and the EMM cause value is not #2 \"IMSI unknown in HSS\", the network shall deactivate the EPS bearer context(s), if any, for the UE locally and enter state EMM-DEREGISTERED-INITIATED.\nIn NB-S1 mode or WB-S1 mode via satellite E-UTRAN access, if the network initiates the detach procedure because the network determines that the UE is in a location where the network is not allowed to operate (see 3GPP TS 23.401 [10]), the network shall set the EMM cause value in the DETACH REQUEST message to #78 \"PLMN not allowed to operate at the present UE location\".\nIf the network detach is triggered because the MME determines that, by UE subscription and operator's preferences, all of the TAIs received from the satellite E-UTRAN are forbidden for roaming or for regional provision of service, the MME shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE;\nb)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth,\nin the DETACH REQUEST message.\nThe figure depicts a network initiated detach procedure, illustrating the steps involved in initiating a detach from a network. The diagram shows the network interface, the initiator, and the responder, with the responder being the one initiating the detach. The figure also includes a diagram of the network interface, showing the various components such as the network interface controller (NIC), the network interface device (NID), and the network interface card (NIC). The responder is shown as the initiator, and the responder is connected to the network interface controller (NIC) and the network interface device (NID). The responder is also connected to the network interface card (NIC) and the network interface. The responder is shown as the initiator, and the responder is connected to the network interface controller (NIC) and the network interface card (NIC). The responder is also connected to the network interface. The responder is shown as the initiator, and the responder is connected to the network interface controller (NIC) and the network interface card (NIC). The responder is also connected to the network interface. The responder is shown as the initiator, and the responder is connected to the network interface controller (NIC) and the network interface card (NIC). The responder is also connected to the network interface. The\nFigure 5.5.2.3.1: Network initiated detach procedure\nWhen receiving the DETACH REQUEST message and the detach type indicates \"re-attach required\", the UE shall deactivate the EPS bearer context(s), if any, including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall stop the timer T3346, if it is running. The UE shall also stop timer(s) T3396 and ESM back-off timer(s) not related to congestion control (see clause 6.3.6), if running. If the UE is operating in single-registration mode, the UE shall also stop 5GSM back-off timer(s) not related to congestion control (see clause 6.2.12 in 3GPP TS 24.501 [54]), if running. The UE shall send a DETACH ACCEPT message to the network and enter the state EMM-DEREGISTERED. Furthermore, the UE shall, after the completion of the detach procedure, and the release of the existing NAS signalling connection, initiate an attach or combined attach procedure. The UE shall enable N1 mode capability for 3GPP access if it was previously disabled (see 3GPP TS 24.501 [54]) and the UE is configured with the \"Re_enable_N1_upon_reattach\" leaf of the NAS configuration MO which indicates the \"re-enabling N1 mode capability when performing re-attach\" is enabled (see 3GPP TS 24.368 [15A]). The UE should also re-establish any previously established PDN connection(s).\nNOTE 1:\tWhen the detach type indicates \"re-attach required\", user interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s), if any, automatically.\nA UE which receives a DETACH REQUEST message with detach type indicating \"re-attach required\" or \"re-attach not required\" and no EMM cause IE, is detached only for EPS services.\nWhen receiving the DETACH REQUEST message and the detach type indicates \"IMSI detach\", the UE shall not deactivate the EPS bearer context(s) including the default EPS bearer context. The UE shall set the MM update status to U2 NOT UPDATED. A UE may send a DETACH ACCEPT message to the network, and shall re-attach to non-EPS services by performing the combined tracking area updating procedure according to clause 5.5.3.3, sending a TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating \"combined TA/LA updating with IMSI attach\".\nIf the UE is attached for EPS and non-EPS services, then the UE shall set the update status to U2 NOT UPDATED if:\n-\tthe Detach type IE indicates \"re-attach required\"; or\n-\tthe Detach type IE indicates \"re-attach not required\" and no EMM cause IE is included.\nWhen receiving the DETACH REQUEST message and the detach type indicates \"re-attach not required\" and no EMM cause IE, or \"re-attach not required\" and the EMM cause value is not #2 \"IMSI unknown in HSS\", the UE shall deactivate the EPS bearer context(s), if any, including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall then send a DETACH ACCEPT message to the network and enter state EMM-DEREGISTERED.\nRegardless of the EMM cause value received in the DEREGISTRATION REQUEST message via satellite E-UTRAN,\n-\tif the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE in the DETACH REQUEST message, the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s), if not already stored, into the list of \"forbidden tracking areas for roaming\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s); and\n-\tif the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE in the DETACH REQUEST message, the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s), if not already stored, into the list of \"forbidden tracking areas for regional provision of service\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s).\nIf the detach type indicates \"IMSI detach\" or \"re-attach required\", then the UE shall ignore the EMM cause IE if received.\nIf the detach type indicates \"re-attach not required\", the UE shall take the following actions depending on the received EMM cause value:\n#2\t(IMSI unknown in HSS);\nThe UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. If the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nThe UE is still attached for EPS services in the network.\n#3\t(Illegal UE);\n#6\t(Illegal ME); or\n#8\t(EPS services and non-EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value. If the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". The USIM shall also be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a.\nFor the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to \"re-registration not required\" and with access type set to \"3GPP access\".\nFor the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\nNOTE 2:\tThe possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.\n#7\t(EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.\nIf the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to \"re-registration not required\" and with access type set to \"3GPP access\".\n#11\t(PLMN not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\nIf the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to \"re-registration not required\" and with access type set to \"3GPP access\".\n#12\t(Tracking area not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\".\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\nIf the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to \"re-registration not required\" and with access type set to \"3GPP access\".\n#13\t(Roaming not allowed in this tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, reset the attach attempt counter and shall change to state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\".\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter and as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\nIf the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to \"re-registration not required\" and with access type set to \"3GPP access\".\n#14\t(EPS services not allowed in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nA UE in PS mode 1 or PS mode 2 of operation shall delete the list of equivalent PLMNs and perform a PLMN selection according to 3GPP TS 23.122 [6].\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.\nA UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see clause 4.5).\nA UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6].\nA UE operating in CS/PS mode 1 of operation and supporting S1 mode only or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n#15\t(No suitable cells in tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\".\nThe UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\nIf the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to \"re-registration not required\" and with access type set to \"3GPP access\".\n#25\t(Not authorized for this CSG);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nIf the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\nIf the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] clause 3.1A.\nThe UE shall search for a suitable cell according to 3GPP TS 36.304 [21].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with GMM cause with the same value and with detach type set to \"re-attach not required\". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status and location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to \"re-attach not required\".\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.\n#78\t(PLMN not allowed to operate at the present UE location).\nThis cause value received from a non-satellite E-UTRA cell is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.2.3.4.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the registration attempt counter. The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of \"PLMNs not allowed to operate at the present UE location\", start a corresponding timer instance (see clause 4.11.2), enter state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n#36\t(IAB-node operation not authorized);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST over 3GPP access is received with the 5GMM cause with the same value , with de-registration type set to \"re-registration not required\" and with access type set to \"3GPP access\".\nOther EMM cause values or if no EMM cause IE is included is considered as abnormal cases. The behaviour of the UE in those cases is described in clause 5.5.2.3.4.\nThe network shall stop timer T3422 upon receipt of the DETACH ACCEPT message. If the Detach type IE indicates \"IMSI detach\", or \"re-attach not required\" and the EMM cause value is #2 \"IMSI unknown in HSS\", the network shall not change the current EMM state; otherwise the network shall enter state EMM-DEREGISTERED.\nThe following abnormal cases can be identified:\na)\tTransmission failure of DETACH ACCEPT message indication from lower layers\nThe detach procedure shall be progressed and the UE shall send the DETACH ACCEPT message.\nb)\tDETACH REQUEST, other EMM cause values than those treated in clause 5.5.2.3.2 or no EMM cause IE is included, and the Detach type IE indicates \"re-attach not required\"\nThe UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, KSI, shall set the update status to EU2 NOT UPDATED and shall start timer T3402.\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.\nA UE not supporting any of A/Gb mode, Iu mode or N1 mode may enter the state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; otherwise the UE shall enter the state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\nA UE supporting A/Gb mode, Iu mode or N1 mode shall\n-\tenter the state EMM-DEREGISTERED and attempt to select GERAN, UTRAN, or NR radio access technology and proceed with the appropriate MM, GMM or 5GMM specific procedures. In this case, the UE may disable the E-UTRA capability (see clause 4.5);\n-\tenter the state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; or\n-\tenter the state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall set the GPRS update status to GU2 NOT UPDATED and shall delete the GMM parameters P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and shall enter the state GMM-DEREGISTERED.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\nThe following abnormal cases can be identified:\na)\tT3422 time-out\nOn the first expiry of the timer, the network shall retransmit the DETACH REQUEST message and shall start timer T3422. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3422, the detach procedure shall be aborted. If the detach type is \"IMSI detach\", or \"re-attach not required\" and the EMM cause value is #2 \"IMSI unknown in HSS\", the network shall not change the current EMM state; otherwise the network shall change to state EMM-DEREGISTERED.\nb)\tLower layer failure\nThe detach procedure is aborted. If the detach type indicates \"IMSI detach\", or \"re-attach not required\" and the EMM cause value is #2 \"IMSI unknown in HSS\", the network shall not change the current EMM state; otherwise the network shall change to state EMM-DEREGISTERED.\nc)\tDetach procedure collision\nIf the network receives a DETACH REQUEST message with \"switch off\" indication, before the network initiated detach procedure has been completed, both procedures shall be considered completed.\nIf the network receives a DETACH REQUEST message without \"switch off\" indication, before the network initiated detach procedure has been completed, the network shall send a DETACH ACCEPT message to the UE.\nd)\tDetach and attach procedure collision\nIf the network receives an ATTACH REQUEST message before the network initiated detach procedure with detach type \"re-attach not required\" with no EMM cause IE, or \"re-attach not required\" and the EMM cause value not #2 \"IMSI unknown in HSS\", has been completed, the network shall ignore the ATTACH REQUEST message. If the Detach type IE, sent in the DETACH REQUEST message, indicates \"re-attach required\" the detach procedure is aborted and the attach procedure shall be progressed after the EPS bearer context(s) have been deleted. If the Detach type IE, sent in DETACH REQUEST message, indicates \"IMSI detach\", or \"re-attach not required\" and the EMM cause value is #2 \"IMSI unknown in HSS\", the detach procedure is aborted and the attach procedure shall be progressed.\ne)\tDetach and tracking area updating procedure collision\nIf the Detach type IE, sent in DETACH REQUEST message, indicates \"re-attach not required\" with no EMM cause IE, or \"re-attach not required\" with EMM cause other than #2 \"IMSI unknown in HSS\" or indicates \"re-attach required\", and the network receives a TRACKING AREA UPDATE REQUEST message before the network initiated detach procedure has been completed, the detach procedure shall be progressed, i.e. the TRACKING AREA UPDATE REQUEST message shall be ignored.\nIf the Detach type IE, sent in DETACH REQUEST message, indicates \"re-attach not required\" with EMM cause #2 \"IMSI unknown in HSS\" or indicates \"IMSI detach\" and the network receives a TRACKING AREA UPDATE REQUEST message before the network initiated detach procedure has been completed, the network shall abort the detach procedure, shall stop T3422 and shall progress the tracking area updating procedure.\nf)\tDetach and service request procedure collision\nIf the network receives a SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type \"re-attach not required\" with EMM cause #2 \"IMSI unknown in HSS\" or detach type \"IMSI detach\", the network shall progress both procedures. If the DETACH REQUEST message contains detach type \"re-attach not required\" with no EMM cause IE, or \"re-attach not required\" with EMM cause other than #2 \"IMSI unknown in HSS\" or detach type \"re-attach required\", the network shall progress the detach procedure.\nIf the network receives an EXTENDED SERVICE REQUEST message for CS fallback, but not for CS fallback for emergency call, before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type \"re-attach not required\" with EMM cause #2 \"IMSI unknown in HSS\" or detach type \"IMSI detach\", the network shall ignore the EXTENDED SERVICE REQUEST message and progress the detach procedure.\nIf the network receives an EXTENDED SERVICE REQUEST message for CS fallback for emergency call before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type \"re-attach not required\" with EMM cause #2 \"IMSI unknown in HSS\" or detach type \"IMSI detach\", the network shall progress both procedures.\ng)\tLower layers indication of non-delivered NAS PDU due to handover\nIf the DETACH REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the DETACH REQUEST message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the DETACH REQUEST message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.3\tTracking area updating procedure (S1 mode only)",
                            "text_content": "The tracking area updating procedure is always initiated by the UE and is used for the following purposes:\n-\tnormal tracking area updating to update the registration of the actual tracking area of a UE in the network;\n-\tcombined tracking area updating to update the registration of the actual tracking area for a UE in CS/PS mode 1 or CS/PS mode 2 of operation;\n-\tperiodic tracking area updating to periodically notify the availability of the UE to the network;\n-\tIMSI attach for non-EPS services when the UE is attached for EPS services. This procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation;\n-\tin various cases of inter-system change from Iu mode to S1 mode or from A/Gb mode to S1 mode;\n-\tin various cases of inter-system change from N1 mode to S1 mode if the UE operates in single-registration mode and as described in 3GPP TS 24.501 [54];\n-\tS101 mode to S1 mode inter-system change;\n-\tMME load balancing;\n-\tto update certain UE specific parameters in the network;\n-\trecovery from certain error cases;\n-\tto indicate that the UE enters S1 mode after CS fallback or 1xCS fallback;\n-\tto indicate to the network that the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;\n-\tto indicate the current radio access technology to the network for the support of terminating access domain selection for voice calls or voice sessions;\n-\tto indicate to the network that the UE has locally released EPS bearer context(s);\n-\tto indicate to the network that the MUSIM UE needs to use an IMSI Offset value as specified in 3GPP TS 23.401 [10] that is used for deriving the paging occasion as specified in 3GPP TS 36.304 [21];\n-\tto indicate to the network the unavailability information or a change in the unavailability information; and\n-\tto indicate to the network that the UE needs to come out of the unavailability period and resume normal services.\nDetails on the conditions for the UE to initiate the tracking area updating procedure are specified in clause 5.5.3.2.2 and clause 5.5.3.3.2.\nIf the MUSIM UE is attached for emergency bearer services and initiates a tracking area updating procedure, the network shall not indicate the support of:\n-\tthe NAS signalling connection release;\n-\tthe paging indication for voice services;\n-\tthe reject paging request;\n-\tthe paging restriction; or\n-\tthe paging timing collision control;\nin the TRACKING AREA UPDATE ACCEPT message.\nWhile a UE has a PDN connection for emergency bearer services, the UE shall not perform manual CSG selection.\nIf control plane CIoT EPS optimization is not used by the UE, a UE initiating the tracking area updating procedure in EMM-IDLE mode may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts during the procedure. If control plane CIoT EPS optimization is used by the UE, a UE initiating the tracking area updating procedure in EMM-IDLE mode may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without control plane only indication during the procedure.\nIn a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity on the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP TS 36.331 [22]). Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #11 \"PLMN not allowed\" is received by the UE, the chosen PLMN identity shall be stored in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #14 \"EPS services not allowed in this PLMN\" is received by the UE, the chosen PLMN identity shall be stored in the \"forbidden PLMNs for GPRS service\". Whenever a TRACKING AREA UPDATE REJECT message is received by the UE with the EMM cause #12 \"tracking area not allowed\", #13 \"roaming not allowed in this tracking area\", or #15 \"no suitable cells in tracking Area\", the constructed TAI shall be stored in the suitable list.\nIn a shared network, if TRACKING AREA UPDATE REJECT is received as a response to a tracking area updating procedure initiated in EMM-CONNECTED mode, the UE need not update forbidden lists.\nA tracking area updating attempt counter is used to limit the number of subsequently rejected tracking area update attempts. The tracking area updating attempt counter shall be incremented as specified in clause 5.5.3.2.6. Depending on the value of the tracking area updating attempt counter, specific actions shall be performed. The tracking area updating attempt counter shall be reset when:\n-\ta normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed;\n-\ta normal or periodic tracking area updating or a combined tracking area updating procedure is rejected with EMM cause #11, #12, #13, #14, #15, #25 or #35:\n-\ta combined attach procedure or a combined tracking area updating procedure is completed for EPS services only with cause #2 or #18; or\n-\ta new PLMN is selected.\nAdditionally the tracking area updating attempt counter shall be reset when the UE is in substate EMM-REGISTERED.ATTEMPTING-TO-UPDATE or EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and:\n-\ta new tracking area is entered;\n-\ttimer T3402 expires; or\n-\ttimer T3346 is started.\nThe periodic tracking area updating procedure is controlled in the UE by timer T3412. When timer T3412 expires and the UE is not registered for emergency services, the periodic tracking area updating procedure is started. Start and reset of timer T3412 is described in clause 5.3.5.\nThe UE in state EMM-REGISTERED shall initiate the tracking area updating procedure by sending a TRACKING AREA UPDATE REQUEST message to the MME,\na)\twhen the UE detects that the current TAI is not in the list of tracking areas that the UE previously registered in the MME, unless the UE is configured for \"AttachWithIMSI\" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;\nb)\twhen the periodic tracking area updating timer T3412 expires and the UE is not registered for emergency services (see subclause 5.3.5);\nc)\twhen the UE enters EMM-REGISTERED.NORMAL-SERVICE and the UE's TIN indicates \"P-TMSI\";\nd)\twhen the UE performs an inter-system change from S101 mode to S1 mode and has no user data pending;\ne)\twhen the UE receives an indication from the lower layers that the RRC connection was released with cause \"load balancing TAU required\";\nf)\twhen the UE deactivated EPS bearer context(s) locally while in EMM-REGISTERED, because it could not establish a NAS signalling connection, and then returns to EMM-REGISTERED.NORMAL-SERVICE and no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message with detach type is \"EPS detach\" or \"combined EPS/IMSI detach\" is pending to be sent by the UE;\ng)\twhen the UE changes any one of the UE network capability information, the MS network capability information or the N1 UE network capability information;\nh)\twhen the UE changes the UE specific DRX parameter (in WB-S1 mode or NB-S1 mode);\ni)\twhen the UE receives an indication of \"RRC Connection failure\" from the lower layers and has no signalling or user uplink data pending (i.e. when the lower layer requests NAS signalling connection recovery);\nj)\twhen the UE enters S1 mode after 1xCS fallback or 1xSRVCC;\nk)\twhen due to manual CSG selection the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;\nl)\twhen the UE reselects an E-UTRAN cell while it was in GPRS READY state or PMM-CONNECTED mode;\nm)\twhen the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN and changes the mobile station classmark 2 or the supported codecs, or the UE supports SRVCC to GERAN and changes the mobile station classmark 3;\nn)\twhen the UE changes the radio capability for GERAN, or cdma2000® or both;\no)\twhen the UE's usage setting or the voice domain preference for E-UTRAN change in the UE;\nNOTE 1:\tFor the change of UE's usage setting or the voice domain preference for E-UTRAN which results in disabling UE's E-UTRA capability, the UE can skip sending TRACKING AREA UPDATE REQUEST message and directly perform disabling of UE's E-UTRA capability.\np)\twhen the UE activates mobility management for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.2, and the TIN indicates \"RAT-related TMSI\";\nq)\twhen the UE performs an inter-system change from A/Gb mode to S1 mode and the TIN indicates \"RAT-related TMSI\", but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.4;\nr)\tupon reception of a paging indication using S-TMSI and the UE is in state EMM-REGISTERED.ATTEMPTING-TO-UPDATE;\nNOTE 2:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\ns)\twhen the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in clause 6.5.1.4A;\nt)\twhen the UE needs to request the use of PSM or needs to stop the use of PSM;\nu)\twhen the UE needs to request the use of eDRX or needs to stop the use of eDRX;\nv)\twhen a change in the eDRX usage conditions at the UE requires different extended DRX parameters;\nw)\twhen a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value;\nNOTE 3:\tA change in the PSM or eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.\nx)\twhen the CIoT EPS optimizations the UE needs to use, change in the UE;\ny)\twhen the Default_DCN_ID value changes, as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17];\nNOTE 4:\tThe tracking area updating procedure is initiated after deleting the DCN-ID list as specified in annex C.\nz)\twhen the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE operates in single-registration mode, and conditions specified in 3GPP TS 24.501 [54] apply;\nza)\twhen the UE in EMM-IDLE mode changes the radio capability for E-UTRAN;\nzb)\twhen the UE needs to request new ciphering keys for ciphered broadcast assistance data;\nzc)\twhen the UE in EMM-IDLE mode changes the radio capability for NG-RAN;\nzd)\twhen the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode;\nze)\tin WB-S1 mode, when the UE has received a UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\";\nzf)\twhen the UE needs to use the WUS assistance, stop to use the WUS assistance, or change the conditions for using the WUS assistance;\nzg)\twhen the MUSIM UE needs to request an IMSI Offset value as specified in 3GPP TS 23.401 [10] that is used for deriving the paging occasion as specified in 3GPP TS 36.304 [21]; or\nzh)\twhen the UE in EMM-IDLE mode needs to inform the network that a UE radio capability information update is required due to a cell change between E-UTRAN and satellite E-UTRAN cells.\nIf case b) is the only reason for initiating the normal and periodic tracking area updating procedure, the UE shall indicate \"periodic updating\" in the EPS update type IE; otherwise the UE shall indicate \"TA updating\".\nFor cases n, za, zc and zh the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.\nNOTE 4a:\tFor cases n, za, zc and zh if the UE supports RACS irrespective whether the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN the UE radio capability information update needed IE is included in the TRACKING AREA UPDATE REQUEST message.\nIf the UE is in the EMM-CONNECTED mode and the UE changes the radio capability for E-UTRAN or for NG-RAN, the UE may locally release the established NAS signalling connection and enter the EMM-IDLE mode. Then, the UE shall initiate the tracking area updating procedure including a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.\nFor case l, if the TIN indicates \"RAT-related TMSI\", the UE shall set the TIN to \"P-TMSI\" before initiating the tracking area updating procedure.\nFor case r, the \"active\" flag in the EPS update type IE shall be set to 1. If a UE is only using EPS services with control plane CIoT EPS optimization, the \"signalling active\" flag in the Additional update type IE shall be set to 1.\nIf the UE is using only control plane CIoT EPS optimization, the case i only applies to the case that the UE has indicated to the network that subsequent to the uplink data transmission a downlink data transmission is expected during the transport of uplink user data via the control plane procedure (see clause 6.6.4).\nIf the UE has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP TS 36.331 [22]), then the UE shall set the \"active\" flag to 1 in the TRACKING AREA UPDATE REQUEST message.\nIf the UE does not have any established PDN connection, and the inter-system change from N1 mode to S1 mode is not due to emergency services fallback, the \"active\" flag in the EPS update type IE shall be set to 0.\nWhen the UE has user data pending and performs an inter-system change from S101 mode to S1 mode to a tracking area included in the TAI list stored in the UE, the UE shall perform a service request procedure instead of a tracking area updating procedure.\nWhen initiating a tracking area updating procedure while in S1 mode, the UE shall use the current EPS NAS integrity key to integrity protect the TRACKING AREA UPDATE REQUEST message, unless the UE is performing inter-system change from N1 mode to S1 mode.\nIn order to indicate its UE specific DRX parameter for WB-S1 mode while in E-UTRAN coverage, the UE shall send the TRACKING AREA UPDATE REQUEST message containing the UE specific DRX parameter in the DRX parameter IE to the network, with the exception of the case if the UE had indicated its DRX parameter for WB-S1 mode (3GPP TS 24.008 [13]) to the network while in GERAN or UTRAN coverage. In this case, when the UE enters E-UTRAN coverage and initiates a tracking area updating procedure, the UE shall not include the UE specific DRX parameter in the DRX parameter IE in the TRACKING AREA UPDATE REQUEST message.\nIn NB-S1 mode, a UE that wishes to use or change a UE specific DRX parameter in NB-S1 mode shall include its requested value in every TRACKING AREA UPDATE REQUEST message except when initiating the periodic tracking area updating procedure.\nIf the UE supports eDRX and requests the use of eDRX, the UE shall include the extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message.\nIf the UE supports PSM and requests the use of PSM, the UE shall include the T3324 value IE with a requested timer value in the TRACKING AREA UPDATE REQUEST message. When the UE includes the T3324 value IE and the UE indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3412 extended value IE to request a particular T3412 value to be allocated.\nIf a UE supporting CIoT EPS optimizations in NB-S1 mode initiates the tracking area updating procedure for EPS services and \"SMS only\", the UE shall indicate \"SMS only\" in the Additional update type IE and shall set the EPS update type IE to \"TA updating\".\nIf the UE supports enhanced discontinuous coverage, then the UE shall set the EDC bit to \"Enhanced discontinuous coverage supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nIf the network has indicated support for enhanced discontinuous coverage and needs to indicate upcoming availability due to discontinuous coverage, the UE shall include the Unavailability information IE in the TRACKING AREA UPDATE REQUEST message. The UE shall set the unavailability type in the Unavailability information IE to \"unavailability due to discontinuous coverage\". The UE may include the unavailability period duration or the time to the start of the unavailability period or both in the Unavailability information IE.\nIf the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP TS 36.306 [44], 3GPP TS 36.331 [22]) in NB-S1 mode, then the UE shall set the Multiple DRB support bit to \"Multiple DRB supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nIf the UE is in NB-S1 mode, then the UE shall set the Control plane CIoT EPS optimization bit to \"Control plane CIoT EPS optimization supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. If the UE is capable of NB-N1 mode, then the UE shall set the Control plane CIoT 5GS optimization bit to \"Control plane CIoT 5GS optimization supported\" in the N1 UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nIf the UE supports control plane MT-EDT, then the UE shall set the CP-MT-EDT bit to \"Control plane Mobile Terminated-Early Data Transmission supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nIf the UE supports user plane MT-EDT, then the UE shall set the UP-MT-EDT bit to \"User plane Mobile Terminated-Early Data Transmission supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nIf the UE supports EPS-UPIP, the UE shall set the EPS-UPIP bit to \"EPS-UPIP supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nIf the UE has to request resources for V2X communication over PC5 (see 3GPP TS 23.285 [47]), then the UE shall set the \"active\" flag to 1 in the TRACKING AREA UPDATE REQUEST message.\nAfter sending the TRACKING AREA UPDATE REQUEST message to the MME, the UE shall start timer T3430 and enter state EMM-TRACKING-AREA-UPDATING-INITIATED (see example in figure 5.5.3.2.2.1). If timer T3402 is currently running, the UE shall stop timer T3402. If timer T3411 is currently running, the UE shall stop timer T3411. If timer T3442 is currently running, the UE shall stop timer T3442.\nFor all cases except cases z and zd:\n1)\tif the UE supports neither A/Gb mode nor Iu mode, the UE shall include a valid GUTI in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI type set to \"Native GUTI\"; or\n2)\tif the UE supports A/Gb mode or Iu mode or both, the UE shall handle the Old GUTI IE as follows:\n-\tIf the TIN indicates \"P-TMSI\" and the UE holds a valid native P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the Old GUTI IE, and include Old GUTI type IE with GUTI type set to \"Mapped GUTI\". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE. Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE.\nNOTE 5:\tThe mapping of the P-TMSI and RAI to the GUTI is specified in 3GPP TS 23.003 [2].\n-\tIf the TIN indicates \"GUTI\" or \"RAT-related TMSI\" and the UE holds a valid GUTI, the UE shall indicate the GUTI in the Old GUTI IE, and include Old GUTI type IE with GUTI type set to \"Native GUTI\".\nIf a UE has established PDN connection(s) and uplink user data pending to be sent via user plane when it initiates the tracking area updating procedure, or uplink signalling not related to the tracking area updating procedure when the UE does not support control plane CIoT EPS optimization, it may set the \"active\" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to establish the user plane to the network and to keep the NAS signalling connection after the completion of the tracking area updating procedure.\nIf a UE is using EPS services with control plane CIoT EPS optimization and has user data pending to be sent via control plane over MME but no user data pending to be sent via user plane, or uplink signalling not related to the tracking area updating procedure, the UE may set the \"signalling active\" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to keep the NAS signalling connection after the completion of the tracking area updating procedure.\nFor all cases except cases z and zd, if the UE has a current EPS security context, the UE shall include the eKSI (either KSIASME or KSISGSN) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. Otherwise, the UE shall set the NAS Key Set Identifier IE to the value \"no key is available\". If the UE has a current EPS security context, the UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context. Otherwise the UE shall not integrity protect the TRACKING AREA UPDATE REQUEST message.\nWhen the tracking area updating procedure is initiated in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode and the TIN is set to \"P-TMSI\", the UE shall include the GPRS ciphering key sequence number applicable for A/Gb mode or Iu mode and a nonceUE in the TRACKING AREA UPDATE REQUEST message.\nWhen the tracking area updating procedure is initiated in EMM-CONNECTED mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode, the UE shall derive the EPS NAS keys from the mapped K'ASME using the selected NAS algorithms, nonceMME and KSISGSN (to be associated with the mapped K'ASME) provided by lower layers as indicated in 3GPP TS 33.401 [19]. The UE shall reset both the uplink and downlink NAS COUNT counters of the mapped EPS security context which shall be taken into use. If the UE has a non-current native EPS security context, the UE shall include the KSIASME in the Non-current native NAS key set identifier IE and its associated GUTI, as specified above, either in the Old GUTI IE or in the Additional GUTI IE of the TRACKING AREA UPDATE REQUEST message. The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to \"native security context\".\nFor the case z, if upper layers have indicated that IMS signalling or IMS emergency signalling was already ongoing in N1 mode before performing the inter-system change from N1 mode to S1 mode, or if the inter-system change from N1 mode to S1 mode is due to emergency services fallback, the \"active\" flag in the EPS update type IE shall be set to 1.\nFor the case z, the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the 5G NAS security context available in the UE. If there is no valid 5G NAS security context available in the UE, the TRACKING AREA UPDATE REQUEST message shall be sent without integrity protection. The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP TS 23.501 [58] and 3GPP TS 23.003 [2]), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI set to \"Native GUTI\", and the UE shall include a UE status IE with a 5GMM registration status set to \"UE is in 5GMM-REGISTERED state\". Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE.\nNOTE 6:\tThe value of the EMM registration status included by the UE in the UE status IE is not used by the MME.\nFor the case zd, the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the mapped EPS security context as derived when triggering the handover to E-UTRAN (see clause 4.4.2.2). The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP TS 23.501 [58] and 3GPP TS 23.003 [2]), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI set to \"Native GUTI\", and the UE shall include a UE status IE with a 5GMM registration status set to \"UE is in 5GMM-REGISTERED state\". Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE. If the UE has a non-current native EPS security context, the UE shall include the KSIASME in the Non-current native NAS key set identifier IE of the TRACKING AREA UPDATE REQUEST message. The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to \"native security context\".\nNOTE 7:\tThe value of the EMM registration status included by the UE in the UE status IE is not used by the MME.\nWhen the tracking area updating procedure is initiated in EMM-IDLE mode, the UE may also include an EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message, indicating which EPS bearer contexts are active in the UE. The UE shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message:\na)\tfor the case f;\nb)\tfor the case s;\nc)\tfor the case z;\nd)\tif the UE has established PDN connection(s) of \"non IP\" or Ethernet PDN type; and\ne)\tif the UE:\n1)\tlocally deactivated at least one dedicated EPS bearer context upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode;\n2)\tlocally deactivated at least one dedicated EPS bearer context upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see clause 6.4.2.1); or\n3)\tlocally deactivated at least one default EPS bearer context upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see clause 6.5.0).\nIf the UE initiates the first tracking area updating procedure following an attach in A/Gb mode or Iu mode, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.\nIf the UE initiates the first tracking area updating procedure following an initial registration in N1 mode and the UE is operating in the single-registration mode, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports SRVCC to GERAN/UTRAN, the UE shall set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to \"SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported\".\nFor all cases except case b, if the UE supports vSRVCC from S1 mode to Iu mode, then the UE shall set the H.245 after handover capability bit in the UE network capability IE to \"H.245 after SRVCC handover capability supported\" and additionally set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to \"SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported\" in the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports ProSe direct discovery, then the UE shall set the ProSe bit to \"ProSe supported\" and set the ProSe direct discovery bit to \"ProSe direct discovery supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports ProSe direct communication, then the UE shall set the ProSe bit to \"ProSe supported\" and set the ProSe direct communication bit to \"ProSe direct communication supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports acting as a ProSe UE-to-network relay, then the UE shall set the ProSe bit to \"ProSe supported\" and set the ProSe UE-to-network relay bit to \"acting as a ProSe UE-to-network relay supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nIf the UE supports NB-S1 mode, Non-IP or Ethernet PDN type, N1 mode, UAS services, URSP provisioning in EPS or if the UE supports DNS over (D)TLS (see 3GPP TS 33.501 [24]), then the UE shall support the Extended protocol configuration options IE.\nNOTE 8:\tSupport of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.501 [24].\nFor all cases except case b, if the UE supports the Extended protocol configuration options IE, then the UE shall set the ePCO bit to \"extended protocol configuration options supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nIf the UE supports providing PDU session ID in the Protocol configuration options IE or the Extended protocol configuration option IE when its N1 mode capability is disabled, then the UE shall set the ePCO bit to \"extended protocol configuration options supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports V2X communication over E-UTRAN-PC5, then the UE shall set the V2X PC5 bit to \"V2X communication over E-UTRAN-PC5 supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports V2X communication over NR-PC5, then the UE shall set the V2X NR-PC5 bit to \"V2X communication over NR-PC5 supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports the restriction on use of enhanced coverage, then the UE shall set the RestrictEC bit to \"Restriction on use of enhanced coverage supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports the control plane data back-off timer T3448, the UE shall set the CP backoff bit to \"backoff timer for transport of user data via the control plane supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports dual connectivity with NR, then the UE shall set the DCNR bit to \"dual connectivity with NR supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports SGC, then the UE shall set the SGC bit to \"service gap control supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports signalling for a maximum number of 15 EPS bearer contexts, then the UE shall set the 15 bearers bit to \"Signalling for a maximum number of 15 EPS bearer contexts supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the MUSIM UE supports the NAS signalling connection release, then the UE shall set the NAS signalling connection release bit to \"NAS signalling connection release supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the NAS signalling connection release bit to \"NAS signalling connection release supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the MUSIM UE supports the paging indication for voice services, then the UE shall set the paging indication for voice services bit to \"paging indication for voice services supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the paging indication for voice services bit to \"paging indication for voice services supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the MUSIM UE supports the reject paging request, then the UE shall set the reject paging request bit to \"reject paging request supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the reject paging request bit to \"reject paging request supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the MUSIM UE sets:\n-\tthe reject paging request bit to \"reject paging request supported\";\n-\tthe NAS signalling connection release bit to \"NAS signalling connection release supported\"; or\n-\tboth of them;\nand supports the paging restriction, then the UE shall set the paging restriction bit to \"paging restriction supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the paging restriction bit to \"paging restriction supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the MUSIM UE supports the paging timing collision control, then the UE shall set the paging timing collision control bit to \"paging timing collision control supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the paging timing collision control bit to \"paging timing collision control supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except cases b and zb, if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the TRACKING AREA UPDATE REQUEST message.\nFor case ee, the UE shall include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the TRACKING AREA UPDATE REQUEST message.\nFor case a, if the UE supports ciphered broadcast assistance data and the UE detects entering a tracking area for which one or more ciphering keys stored at the UE is not applicable, the UE should include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the TRACKING AREA UPDATE REQUEST message.\nFor case b, if the UE supports ciphered broadcast assistance data and the remaining validity time for one or more ciphering keys stored at the UE is less than timer T3412, the UE should include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports N1 mode for 3GPP access, the UE shall set the N1mode bit to \"N1 mode for 3GPP access supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, in WB-S1 mode, if the UE supports RACS the UE shall set the RACS bit to \"RACS supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor cases n, za, zc and zh, in WB-S1 mode, if the UE supports RACS and the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except cases b, n, za, zc and zh, in WB-S1 mode, if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case b, if the UE supports WUS assistance, then the UE shall set the WUSA bit to \"WUS assistance supported\" in the UE network capability IE, and if the UE is not attaching for emergency bearer services, the UE may include its UE paging probability information in the Requested WUS assistance information IE in the TRACKING AREA UPDATE REQUEST message.\nFor all cases except case a, except case b, for a MUSIM UE if the UE needs to indicate an IMSI offset value to the network and the network has indicated to the UE that it supports paging timing collision control, the UE shall include the IMSI offset value in the Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message.\nFor case a, MUSIM UE may include the IMSI offset value in the Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message even if the network has not indicated that it supports paging timing collision control.\nIf the network supports the NAS signalling connection release and the MUSIM UE requests the network to release the NAS signalling connection, the UE shall set Request type to \"NAS signalling connection release\" in the UE request type IE and, if the network supports the paging restriction, may set the paging restriction preference in the Paging restriction IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall\n-\tset the \"active\" flag to 0 in the EPS update type IE; and\n-\tset the \"signalling active\" flag to 0 in the Additional update type IE, if the Additional update type IE is included.\nNOTE 9:\tIf the network has already indicated support for NAS signalling connection release in the current stored tracking area list and the UE doesn't have a PDN connection for emergency bearer services established, the MUSIM UE is allowed to request the network to release the NAS signalling connection during tracking area updating procedure that is due to mobility to a tracking area outside the current tracking area list even before detecting whether the network supports the NAS signalling connection release in the new tracking area.\nNOTE 10:\tIf the network has already indicated support for paging restriction in the current stored tracking area list and the UE doesn't have a PDN connection for emergency bearer services established, the MUSIM UE is allowed to include paging restriction together with the request to the network to release the NAS signalling connection during tracking area updating procedure that is due to mobility to a tracking area outside the current tracking area list even before detecting whether the network supports the paging restriction in the new tracking area.\nThe figure depicts a track- ing area updating procedure in a 5G network. It illustrates the steps involved in updating the track- ing area, including the identification of the current track- ing area, the generation of a new track- ing area, and the transmission of the updated information to the network. The figure also shows the use of radio frequency (RF) signals to transmit the track- ing information, and the use of optical signals to transmit the track- ing area information.\nFigure 5.5.3.2.2.1: Tracking area updating procedure\nIf the network receives a TRACKING AREA UPDATE REQUEST message containing the Old GUTI type IE, and the network does not follow the use of the most significant bit of the <MME group id> to distinguish the node type as specified in 3GPP TS 23.003 [2], clause 2.8.2.2.2, the network shall use the Old GUTI type IE to determine whether the mobile identity included in the Old GUTI IE is a native GUTI or a mapped GUTI.\nDuring the tracking area updating procedure, the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures.\nThe MME may be configured to skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in clause 5.4.3, during a tracking area updating procedure for a UE that has only a PDN connection for emergency bearer services or for RLOS.\nThe MME shall not initiate an EMM authentication procedure before completion of the tracking area updating procedure, if the following conditions apply:\na)\tthe UE initiated the tracking area updating procedure after handover or inter-system handover to S1 mode;\nb)\tthe target cell is a shared network cell; and\n-\tthe UE has provided its GUTI in the Old GUTI IE or the Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, and the PLMN identity included in the GUTI is different from the selected PLMN identity of the target cell; or\n-\tthe UE has mapped the P-TMSI and RAI into the Old GUTI IE and not included an Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, and the PLMN identity included in the RAI is different from the selected PLMN identity of the target cell.\nIf the tracking area update request has been accepted by the network, the MME shall send a TRACKING AREA UPDATE ACCEPT message to the UE. If the MME assigns a new GUTI for the UE, a GUTI shall be included in the TRACKING AREA UPDATE ACCEPT message. If the MME includes the GUTI IE in the TRACKING AREA UPDATE ACCEPT message, the MME shall start timer T3450 and enter state EMM-COMMON-PROCEDURE-INITIATED as described in clause 5.4.1. The MME may include a new TAI list for the UE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode.\nNOTE 1:\tWhen assigning the TAI list, the MME can take into account the eNodeB's capability of support of CIoT EPS optimization.\nIf the UE has included the UE network capability IE or the MS network capability IE or both in the TRACKING AREA UPDATE REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.\nNOTE 2:\tThis information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.\nNOTE 3:\tFor further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP TS 23.401 [10].\nIn NB-S1 mode, if the tracking area update request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the TRACKING AREA UPDATE ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.\nIf a UE radio capability information update needed IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall delete the stored UE radio capability information or the UE radio capability ID, if any.\nIf the UE specific DRX parameter was included in the DRX Parameter IE in the TRACKING AREA UPDATE REQUEST message, the network shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data in WB-S1 mode.\nIn NB-S1 mode, if the DRX parameter in NB-S1 mode IE was included in the TRACKING AREA UPDATE REQUEST message, the MME shall provide to the UE the Negotiated DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE ACCEPT message. The MME shall replace any stored UE specific DRX parameter in NB-S1 mode with the negotiated DRX parameter and use it for the downlink transfer of signalling and user data in NB-S1 mode.\nNOTE 4:\tIn NB-S1 mode, if a DRX parameter was included in the Negotiated DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE ACCEPT message, then the UE stores and uses the received DRX parameter in NB-S1 mode (see 3GPP TS 36.304 [21]). If the UE has included the DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE REQUEST message, but did not receive a DRX parameter in the Negotiated DRX parameter in NB-S1 mode IE, or if the Negotiated DRX parameter in NB-S1 mode IE was not included in the TRACKING AREA UPDATE ACCEPT message, then the UE uses the cell specific DRX value in NB-S1 mode (see 3GPP TS 36.304 [21]).If the UE requests \"control plane CIoT EPS optimization\" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the tracking area update request, the MME shall indicate \"control plane CIoT EPS optimization supported\" in the EPS network feature support IE.\nIn NB-S1 mode, if the UE requested \"SMS only\" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the tracking area update request for EPS services and \"SMS only\", the MME shall indicate \"SMS only\" in the Additional update result IE and shall set the EPS update type IE to \"TA updating\" in the TRACKING AREA UPDATE ACCEPT message.\nThe MME shall include the extended DRX parameters IE in the TRACKING AREA UPDATE ACCEPT message only if the extended DRX parameters IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of eDRX.\nIf:\n-\tthe UE supports WUS assistance; and\n-\tthe MME supports and accepts the use of WUS assistance,\nthen the MME shall determine the negotiated UE paging probability information for the UE, store it in the EMM context of the UE, and if the UE is not attaching for emergency bearer services, the MME shall include it in the Negotiated WUS assistance information IE and assign a new GUTI in the TRACKING AREA UPDATE ACCEPT message. The MME may take into account the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE. If the UE has not included Requested WUS assistance information IE in the TRACKING AREA UPDATE REQUEST message and the MME has stored a negotiated UE paging probability information for that UE, the MME shall erase the negotiated UE paging probability information and assign a new GUTI in the TRACKING AREA UPDATE ACCEPT message.\nNOTE 5:\tBesides the UE paging probability information requested by the UE, the MME can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE (see 3GPP TS 23.401 [10]).\nIf the UE indicates support for EMM-REGISTERED without PDN connection in the TRACKING AREA UPDATE REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate this in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause 5 and in clause 6.\nIf the UE indicates support for enhanced discontinuous coverage in the TRACKING AREA UPDATE REQUEST message and the MME supports enhanced discontinuous coverage, the MME shall indicate \"Enhanced discontinuous coverage supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the UE provided the Unavailability information IE in the TRACKING AREA UPDATE REQUEST message, then:\na)\tthe MME shall determine the unavailability period duration value as:\n-\ta value that was provided by the UE; or\n-\ta value that was determined by the MME based on satellite coverage availability information; and\nthe MME shall store the determined unavailability period duration and provide the determined unavailability period duration to the UE by including the Unavailability period duration IE in the TRACKING AREA UPDATE ACCEPT message;\nb)\tthe MME shall store the start of unavailability period value. If the UE did not include a start of the unavailability period, the MME shall consider the start of unavailability period to be the time at which MME received the TRACKING AREA UPDATE REQUEST message from the UE. The MME shall consider the UE as unreachable until the UE initiates the tracking area updating procedure for normal service again without providing an unavailability information; and\nc)\trelease the NAS signalling connection immediately after the completion of the tracking area updating procedure in which the UE provided unavailability information without providing the start of the unavailability period.\nThe MME should determine the periodic tracking area update timer, mobile reachable timer and implicit detach timer value based on:\na)\tthe stored value of the received unavailability period duration or based on a network determined unavailability period duration when the unavailability period duration is not provided by the UE;\nb)\tthe stored value of the received start of unavailability period or based on a network determined start of unavailability period when the start of unavailability period is not provided by the UE; or\nc)\tany combination of the above.\nIf the UE does not provide the Unavailability information IE in the TRACKING AREA UPDATE REQUEST message, the MME shall delete any stored value of the Unavailability information IE if exists.\nIf an EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the MME and the UE) which are in ESM state BEARER CONTEXT ACTIVE or BEARER CONTEXT MODIFY PENDING on the network side, but are indicated by the UE as being in ESM state BEARER CONTEXT INACTIVE. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE REQUEST message, and this default bearer is not associated with the last remaining PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default EPS bearer context of a PDN connection established as a user-plane resource of an MA PDU session as specified in clause 5.3 of 3GPP TS 24.193 [61] is deactivated locally and the MA PDU session does not have user plane resources established on non-3GPP access in N1 mode, the network shall perform a local release of the MA PDU session.\nIf the EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST, the MME shall include an EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message, indicating which EPS bearer contexts are active in the MME except for the case no EPS bearer context exists on the network side.\nIf the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates \"periodic updating\", and the UE was previously successfully attached for EPS and non-EPS services, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.\nThe MME shall indicate \"combined TA/LA updated\" or \"combined TA/LA updated and ISR activated\" in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message, if the following conditions apply:\n-\tthe EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates \"periodic updating\" and the UE was previously successfully attached for EPS and non-EPS services; and\n-\tlocation area updating for non-EPS services as specified in 3GPP TS 29.118 [] is successful.\nThe MME may include T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the TRACKING AREA UPDATE REQUEST message.\nThe MME shall include the T3324 value IE in the TRACKING AREA UPDATE ACCEPT message only if the T3324 value IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of PSM.\nIf the MME supports and accepts the use of PSM, and the UE included the T3412extended value IE in the TRACKING AREA UPDATE REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message.\nNOTE 6:\tBesides the value requested by the MS, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (see 3GPP TS 23.401 [10] clause 4.3.17.3).\nIf the MME includes the T3324 value IE indicating a value other than deactivated in the TRACKING AREA UPDATE ACCEPT message, then the MME shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.\nAlso, during the tracking area updating procedure without the \"active\" flag set, if the MME has deactivated EPS bearer context(s) locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.\nAlso, during the tracking area updating procedure with the \"active\" flag set, if the MME has deactivated EPS bearer context(s) associated with control plane only indication locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.\nIf the TRACKING AREA UPDATE ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C.\nIf due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA, but it has a PDN connection for emergency bearer services established, the MME may accept the TRACKING AREA UPDATE REQUEST message and deactivate all non-emergency EPS bearer contexts by initiating an EPS bearer context deactivation procedure when the tracking area updating procedure is initiated in EMM-CONNECTED mode. When the tracking area updating procedure is initiated in EMM-IDLE mode, the MME locally deactivates all non-emergency EPS bearer contexts and informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not deactivate the emergency EPS bearer contexts. The network shall consider the UE to be attached for emergency bearer services only and shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.\nIf a TRACKING AREA UPDATE REQUEST message is received from a UE with a LIPA PDN connection, and if:\n-\ta GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the LIPA PDN Connection is different from the provided GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or\n-\tno GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,\nthen the MME locally deactivates all EPS bearer contexts associated with the LIPA PDN connection. Furthermore, the MME takes one of the following actions:\n-\tif no active EPS bearer contexts remain for the UE, the MME shall not accept the tracking area update request as specified in clause 5.5.3.2.5;\n-\tif active EPS bearer contexts remain for the UE and the TRACKING AREA UPDATE REQUEST message is accepted, the MME informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message that EPS bearer contexts were locally deactivated.\nIf a TRACKING AREA UPDATE REQUEST message is received from a UE with a SIPTO at the local network PDN connection, is accepted by the network, the following different cases can be distinguished:\n1)\tIf the PDN connection is a SIPTO at the local network PDN connection with collocated L-GW and if:\n-\ta SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or\n-\tno SIPTO L-GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,\n2)\tIf the PDN connection is a SIPTO at the local network PDN connection with stand-alone GW and if:\n-\ta LHN-ID value is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the LHN-ID stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP TS 36.413 [23]); or\n-\tno LHN-ID value is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,\nthen the MME takes one of the following actions:\n-\tif the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the MME shall upon completion of the tracking area updating procedure detach the UE by using detach type \"re-attach required\" (see clause 5.5.2.3.1);\n-\tif the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, then the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 \"reactivation requested\" for the default EPS bearer context of the SIPTO at the local network PDN connection (see clause 6.4.4.2); and\n-\tif a PDN connection remains that is not SIPTO at the local network PDN connection, the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 \"reactivation requested\" for the default EPS bearer context of each SIPTO at the local network PDN connection (see clause 6.4.4.2);\nFor a SIPTO at the local network PDN connection with stand-alone GW, the conditions to deactivate ISR are specified in 3GPP TS 23.401 [10], clause 4.3.5.6.\nFor a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP TS 23.251 [8B]).\nIf the \"active\" flag is set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts. If the \"active\" flag is set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication.\nIf the \"signalling active\" flag is set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall not immediately release the NAS signalling connection after the completion of the tracking area updating procedure.\nIf the \"active\" flag is not set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts due to downlink pending data or downlink pending signalling, except for the case when the TRACKING AREA UPDATE REQUEST message includes the UE request type IE and the Request type is set to \"NAS signalling connection release\". If the \"active\" flag is not set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication due to downlink pending data or downlink pending signalling, except for the case when the TRACKING AREA UPDATE REQUEST message includes the UE request type IE and the Request type is set to \"NAS signalling connection release\".\nIf the MME supports NB-S1 mode, non-IP or Ethernet PDN type, inter-system change with 5GS, UAS services or the network wants to enforce the use of DNS over (D)TLS (see 3GPP TS 33.501 [24]), then the MME shall support the Extended protocol configuration options IE.\nNOTE 7:\tSupport of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.401 [19] and it is implemented based on the operator requirement.\nIf the MME supports the Extended protocol configuration options IE and the UE indicated support of the Extended protocol configuration options IE, then the MME shall set the ePCO bit to \"extended protocol configuration options supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the UE indicates support for restriction on use of enhanced coverage in the TRACKING AREA UPDATE REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nThe MME may indicate the header compression configuration status IE in the TRACKING AREA UPDATE ACCEPT message for each established EPS bearer context using control plane CIoT EPS optimisation.\nIf the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the TRACKING AREA UPDATE ACCEPT message.\nIf the UE indicates support for dual connectivity with NR in the TRACKING AREA UPDATE REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to \"Use of dual connectivity with NR is restricted\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the UE indicates support for N1 mode in the TRACKING AREA UPDATE REQUEST message and the MME supports inter-system interworking with 5GS, the MME may set the IWK N26 bit to either:\n-\t\"interworking without N26 interface not supported\" if the MME supports N26 interface; or\n-\t\"interworking without N26 interface supported\" if the MME does not support N26 interface\nin the EPS network feature support IE in the TRACKING AREA UPDATE ACCEPT message.\nIf the MME determines the UE's N1 mode capability for 3GPP access changes from \" N1 mode for 3GPP access not supported \" to \" N1 mode for 3GPP access supported \" and the network decides to enable the transfer of a PDN connection not supporting interworking to 5GS from S1 mode to N1 mode, the MME may upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure to deactivate the default EPS bearer context of the PDN connection by including ESM cause #39 \"reactivation requested\" in the DEACTIVATE EPS BEARER CONTEXT REQUEST message (see clause 6.4.4.2).\nThe MME shall set the redir-policy bit to \"Unsecured redirection to GERAN or UTRAN not allowed\" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message if unsecured redirection to a GERAN or UTRAN cell is not allowed in the current PLMN. Otherwise, the redir-policy bit shall be set to \"Unsecured redirection to GERAN or UTRAN allowed\".\nIf the UE has indicated support for service gap control, a service gap time value is available in the EMM context, the MME may include the T3447 value IE set to the service gap time value in the TRACKING AREA UPDATE ACCEPT message.\nIf the network supports signalling for a maximum number of 15 EPS bearer contexts and the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the TRACKING AREA UPDATE REQUEST message, then the MME shall set the 15 bearers bit to \"Signalling for a maximum number of 15 EPS bearer contexts supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the UE indicates support of the NAS signalling connection release in the TRACKING AREA UPDATE REQUEST message and the network decides to accept the NAS signalling connection release, then the MME shall set the NAS signalling connection release bit to \"NAS signalling connection release supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the UE indicates support of the paging indication for voice services in the TRACKING AREA UPDATE REQUEST message and the network decides to accept the paging indication for voice services, then the MME shall set the paging indication for voice services bit to \"paging indication for voice services supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. If the UE receives the TRACKING AREA UPDATE ACCEPT message with the paging indication for voice services bit set to \"paging indication for voice services supported\", the UE NAS layer informs the lower layers that paging indication for voice services is supported. Otherwise, the UE NAS layer informs the lower layers that paging indication for voice services is not supported.\nIf the UE indicates support of the reject paging request in the TRACKING AREA UPDATE REQUEST message and the network decides to accept the reject paging request, then the MME shall set the reject paging request bit to \"reject paging request supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the UE indicates support of the paging restriction in the TRACKING AREA UPDATE REQUEST message, and the MME sets:\n-\tthe reject paging request bit to \"reject paging request supported\";\n-\tthe NAS signalling connection release bit to \"NAS signalling connection release supported\"; or\n-\tboth of them;\nin the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message, and the network decides to accept the paging restriction, then the MME shall set the paging restriction bit to \"paging restriction supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the UE indicates support of the paging timing collision control in the TRACKING AREA UPDATE REQUEST message and the network decides to accept the paging timing collision control, then the MME shall set the paging timing collision control bit to \"paging timing collision control supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the UE requests ciphering keys for ciphered broadcast assistance data in the TRACKING AREA UPDATE REQUEST message and the MME has valid ciphering key data applicable to the UE's subscription, then the MME shall include the ciphering key data in the Ciphering key data IE of the TRACKING AREA UPDATE ACCEPT message.\nIf the MUSIM UE does not include the Paging restriction IE in the TRACKING AREA UPDATE REQUEST message, the MME shall delete any stored paging restriction for the UE and stop restricting paging.\nIf the MUSIM UE has included a Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message with the EPS update type IE not indicating \"periodic updating\" and if the MME supports paging timing collision control, the MME shall include the Negotiated IMSI offset IE and assign a new GUTI in the TRACKING AREA UPDATE ACCEPT message, and the MME shall set the IMSI offset value to:\n-\tA value that is different than what the UE has provided, if the MME has a different value; or\n-\tA value that is same as what the UE has provided, if the MME does not have a different value;\nand the MME shall calculate an alternative IMSI value using the IMSI offset value and store it in the UE context as specified in 3GPP TS 23.401 [10]. The alternative IMSI value is used for deriving the paging occasion as specified in 3GPP TS 36.304 [21].\nIf the MUSIM UE has not included a Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message with the EPS update type IE not indicating \"periodic updating\" and the MME has stored an alternative IMSI value for that UE, the MME shall erase the alternative IMSI value and assign a new GUTI in the TRACKING AREA UPDATE ACCEPT message.\nIf the MUSIM UE requests the release of the NAS signalling connection, by setting Request type to \"NAS signalling connection release\" in the UE request type IE in the TRACKING AREA UPDATE REQUEST message, and the MME supports the NAS signalling connection release, the MME shall initiate the release of the NAS signalling connection after the completion of the tracking area updating procedure. If the UE requests restriction of paging by including the Paging restriction IE in the TRACKING AREA UPDATE REQUEST message and the MME supports the paging restriction, the MME:\n-\tif accepts the paging restriction, shall include the EPS additional request result IE in the TRACKING AREA UPDATE ACCEPT message and set the Paging restriction decision to \"paging restriction is accepted\". The MME shall store the paging restriction of the UE and enforce these restrictions in the paging procedure as described in clause 5.6.2; or\n-\tif rejects the paging restriction, shall include the EPS additional request result IE in the TRACKING AREA UPDATE ACCEPT message and set the Paging restriction decision to \"paging restriction is rejected\", and shall discard the received paging restriction. The MME shall delete any stored paging restriction for the UE and stop restricting paging.\nUpon receiving a TRACKING AREA UPDATE ACCEPT message, the UE shall stop timer T3430, reset the service request attempt counter, tracking area updating attempt counter, enter state EMM-REGISTERED and set the EPS update status to EU1 UPDATED. If the message contains a GUTI, the UE shall use this GUTI as new temporary identity for EPS services and shall store the new GUTI. If no GUTI was included by the MME in the TRACKING AREA UPDATE ACCEPT message, the old GUTI shall be used. If the UE receives a new TAI list in the TRACKING AREA UPDATE ACCEPT message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid.\nIf the UE receives the TRACKING AREA UPDATE ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see clause 5.3.7b), then the UE shall reset these counters. If the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall reset this counter.\nIf the TRACKING AREA UPDATE ACCEPT message contains the T3412 extended value IE, then the UE shall use the T3412 extended value IE as periodic tracking area update timer (T3412). If the TRACKING AREA UPDATE ACCEPT contains T3412 value IE, but not T3412 extended value IE, then the UE shall use value in T3412 value IE as periodic tracking area update timer (T3412). If neither T3412 value IE nor T3412 extended value IE is included, the UE shall use the value currently stored, e.g. from a prior ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message.\nIf the TRACKING AREA UPDATE ACCEPT message contains the T3324 value IE, then the UE shall use the timer value for T3324 as specified in 3GPP TS 24.008 [13], clause 4.7.2.8.\nIf the UE had initiated the tracking area updating procedure in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode and the nonceUE was included in the TRACKING AREA UPDATE REQUEST message, the UE shall delete the nonceUE upon receipt of the TRACKING AREA UPDATE ACCEPT message.\nIf an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE ACCEPT message, and this default bearer is not associated with the last remaining PDN connection in the UE, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. If only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default EPS bearer context of a PDN connection established as a user-plane resource of an MA PDU session as specified in clause 5.3 of 3GPP TS 24.193 [61] is deactivated locally and the MA PDU session does not have user plane resources established on non-3GPP access in N1 mode, the UE shall perform a local release of the MA PDU session.\nIf an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE may choose to ignore all those EPS bearers which are indicated by the MME as being active but are inactive at the UE.\nIf the tracking area updating procedure is initiated following an inter-system change from N1 mode to S1 mode and only the PDN connection for emergency bearer services is established, the UE should consider itself attached for emergency bearer services only.\nIf a Negotiated IMSI offset IE is included in the TRACKING AREA UPDATE ACCEPT message, the MUSIM UE shall forward the IMSI offset value to lower layers. If a Negotiated IMSI offset IE is not included in the TRACKING AREA UPDATE ACCEPT message and the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message does not indicate \"periodic updating\", the MUSIM UE shall indicate to lower layers to erase any IMSI offset value, if available.\nThe MME may also include a list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if there is no PDN connection for emergency bearer services or PDN connection for RLOS established, the UE shall remove from the list any PLMN code that is already in the list of \"forbidden PLMNs\" or in the list of \"forbidden PLMNs for GPRS service\". If the UE is not attached for emergency bearer services and there is a PDN connection for emergency bearer services established, the UE shall remove from the list of equivalent PLMNs any PLMN code present in the list of forbidden PLMNs or in the list of \"forbidden PLMNs for GPRS service\" when the PDN connection for emergency bearer services is released. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the TRACKING AREA UPDATE ACCEPT message. If the TRACKING AREA UPDATE ACCEPT message does not contain a list, then the UE shall delete the stored list.\nIf the UE is neither attached for emergency bearer services nor attached for access to RLOS, and if the PLMN identity of the registered PLMN is a member of the list of \"forbidden PLMNs\" or the list of \"forbidden PLMNs for GPRS service\", any such PLMN identity shall be deleted from the corresponding list(s).\nThe network may also indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is active. If the UE is attached for emergency bearer services, the network shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated. If the TRACKING AREA UPDATE ACCEPT message contains:\ni)\tno indication that ISR is activated, the UE shall set the TIN to \"GUTI\" and shall stop the periodic routing area update timer T3312 or T3323, if running;\nii)\tan indication that ISR is activated, then:\n-\tif the UE is required to perform routing area updating for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.5, the UE shall set the TIN to \"GUTI\" and shall stop the periodic routing area update timer T3312 or T3323, if running;\n-\tif the UE had initiated the tracking area updating procedure due to a change in UE network capability or change in DRX parameters, the UE shall set the TIN to \"GUTI\" and shall stop the periodic routing area update timer T3312 or T3323, if running;\n-\tif the UE had initiated the tracking area updating procedure due to a change in the UE's usage setting or the voice domain preference for E-UTRAN, the UE shall set the TIN to \"GUTI\" and shall stop the periodic routing area update timer T3312 or T3323, if running; or\n-\tthe UE shall regard a previously assigned P-TMSI and RAI as valid and registered with the network. If the TIN currently indicates \"P-TMSI\" and the periodic routing area update timer T3312 is running or is deactivated, the UE shall set the TIN to \"RAT-related TMSI\". If the TIN currently indicates \"P-TMSI\" and the periodic routing area update timer T3312 has already expired, the UE shall set the TIN to \"GUTI\".\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP TS 23.221 [8A], clause 7.2a and clause 7.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in S1 mode, then the UE shall not locally release any persistent EPS bearer context. When the UE determines via the emergency bearer services indicator that the network does not support emergency bearer services in S1 mode, then the UE shall not locally release any emergency EPS bearer context if there is a radio bearer associated with that context. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE's application, those indicators are taken into account as specified in 3GPP TS 24.171 [13C].\nIf the MME received the list of TAIs from the satellite E-UTRAN as described in 3GPP TS 23.401 [10], and determines that, by UE subscription and operator's preferences, any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service as per operator's choice, the MME shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE;\nb)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth,\nin the TRACKING AREA UPDATE ACCEPT message.\nNOTE 8:\tVoid.\nIf the RestrictDCNR bit is set to \"Use of dual connectivity with NR is restricted\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.\nThe UE supporting N1 mode shall operate in the mode for inter-system interworking with 5GS as follows:\n-\tif the IWK N26 bit in the EPS network feature support IE is set to \"interworking without N26 interface not supported\", the UE shall operate in single-registration mode;\n-\tif the IWK N26 bit in the EPS network feature support IE is set to \"interworking without N26 interface supported\" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or\nNOTE 9:\tThe registration mode used by the UE is implementation dependent.\n-\tif the IWK N26 bit in the EPS network feature support IE is set to \"interworking without N26 interface supported\" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.\nThe UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs. The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP TS 24.501 [54].\nIf the redir-policy bit is set to \"Unsecured redirection to GERAN or UTRAN not allowed\" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to \"Unsecured redirection to GERAN or UTRAN not allowed\" and indicate to the lower layers that unsecured redirection to a GERAN or UTRAN cell is not allowed. If the redir-policy bit is set to \"Unsecured redirection to GERAN or UTRAN allowed\" or if the Network policy IE is not included in the TRACKING AREA UPDATE ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN or UTRAN for the current PLMN to \"Unsecured redirection to GERAN or UTRAN allowed\" and indicate to the lower layers that unsecured redirection to a GERAN or UTRAN cell is allowed. The UE shall set the network policy on unsecured redirection to GERAN or UTRAN to \"Unsecured redirection to GERAN or UTRAN not allowed\" and indicate this to the lower layers when any of the following events occurs:\n-\tthe UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;\n-\tthe UE is switched on; or\n-\tthe UICC containing the USIM is removed.\nIf the UE has initiated the tracking area updating procedure due to manual CSG selection and receives a TRACKING AREA UPDATE ACCEPT message, and the UE sent the TRACKING AREA UPDATE REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.\nIf the TRACKING AREA UPDATE ACCEPT message contained a GUTI, the UE shall return a TRACKING AREA UPDATE COMPLETE message to the MME to acknowledge the received GUTI or the received Negotiated IMSI offset IE. If the UE has a negotiated IMSI offset value stored at the lower layers and the TRACKING AREA UPDATE ACCEPT message does not contain the Negotiated IMSI offset IE, the UE shall return a TRACKING AREA UPDATE COMPLETE message to the MME, and the MME shall erase the stored alternative IMSI value for the UE upon receiving the TRACKING AREA UPDATE COMPLETE message.\nIf the UE which was previously successfully attached for EPS and non-EPS services receives the TRACKING AREA UPDATE ACCEPT message with EPS update result IE indicating \"combined TA/LA updated\" or \"combined TA/LA updated and ISR activated\" as the response of the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating \"periodic updating\", the UE shall behave as follows:\n-\tIf the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.\n-\tIf the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI.\n-\tIf neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.\nIf the header compression configuration status is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall stop using header compression and decompression for those EPS bearers using Control plane CIoT EPS optimisation for which the MME indicated that the header compression configuration is not used.\nIf the T3448 value IE is present in the received TRACKING AREA UPDATE ACCEPT message, the UE shall:\n-\tstop timer T3448 if it is running; and\n-\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the TRACKING AREA UPDATE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.\nIf the UE in EMM-IDLE mode initiated the tracking area updating procedure and the TRACKING AREA UPDATE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.\nIf the UE has indicated \"service gap control supported\" in the TRACKING AREA UPDATE REQUEST message and:\n-\tthe TRACKING AREA UPDATE ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the T3447 timer next time it is started; or\n-\tthe TRACKING AREA UPDATE ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the T3447 timer if running.\nUpon receiving a TRACKING AREA UPDATE COMPLETE message, the MME shall stop timer T3450 and change to state EMM-REGISTERED. The GUTI, the Negotiated IMSI offset, or both, if sent in the TRACKING AREA UPDATE ACCEPT message, shall be considered as valid.\nNOTE 10:\tUpon receiving a TRACKING AREA UPDATE COMPLETE message, if a new TMSI was included in the TRACKING AREA UPDATE ACCEPT message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP TS 29.118 [16A].\nFor inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a current EPS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, the MME shall take one of the following actions:\n-\tif the MME retrieves the current EPS security context as indicated by the eKSI and GUTI sent by the UE, the MME shall integrity check the TRACKING AREA UPDATE REQUEST message using the current EPS security context and integrity protect the TRACKING AREA UPDATE ACCEPT message using the current EPS security context;\n-\tif the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, and if the UE has included a valid GPRS ciphering key sequence number, the MME shall create a new mapped EPS security context as specified in 3GPP TS 33.401 [19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see clause 5.4.3.2); or\n-\tif the UE has not included an Additional GUTI IE, the MME may treat the TRACKING AREA UPDATE REQUEST message as in the previous item, i.e. as if it cannot retrieve the current EPS security context.\nNOTE 11:\tThe handling described above at failure to retrieve the current EPS security context or if no Additional GUTI IE was provided does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.\nFor inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has not included a valid eKSI in the NAS Key Set Identifier IE and has included a valid GPRS ciphering key sequence number in the TRACKING AREA UPDATE REQUEST message, the MME shall create a new mapped EPS security context as specified in 3GPP TS 33.401 [19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see clause 5.4.3.2).\nNOTE 12:\tThis does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.\nFor inter-system change from N1 mode to S1 mode in EMM-IDLE mode, if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a 5G NAS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, the MME shall take actions as specified in clause 4.4.2.3.\nFor inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-CONNECTED mode, the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K'ASME as derived when triggering the handover to E-UTRAN (see clause 4.4.2.2). The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. The MME shall then take one of the following actions:\n-\tif the TRACKING AREA UPDATE REQUEST does not contain a valid KSIASME in the Non-current native NAS key set identifier IE, the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K'ASME and take the mapped EPS security context into use; or\n-\tif the TRACKING AREA UPDATE REQUEST contains a valid KSIASME in the Non-current native NAS key set identifier IE, the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use.\nFor inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K'ASME as derived when triggering the handover to E-UTRAN (see clause 4.4.2.2). The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. The MME shall then take one of the following actions:\n-\tif the TRACKING AREA UPDATE REQUEST does not contain a valid KSIASME in the Non-current native NAS key set identifier IE, the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K'ASME and take the mapped EPS security context into use; or\n-\tif the TRACKING AREA UPDATE REQUEST contains a valid KSIASME in the Non-current native NAS key set identifier IE, the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use.\nIn WB-S1 mode, if the UE has set the RACS bit to \"RACS supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message, the MME may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the TRACKING AREA UPDATE ACCEPT message. In this case the MME shall enter state EMM-COMMON-PROCEDURE-INITIATED as described in clause 5.4.1.\nIn WB-S1 mode, if the UE has set the RACS bit to \"RACS supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and the TRACKING AREA UPDATE ACCEPT message includes:\n-\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall:\na)\tdelete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE;\nb)\tsend a TRACKING AREA UPDATE COMPLETE message to the network to acknowledge the received UE radio capability ID deletion indication IE; and\nc)\tafter the completion of the ongoing tracking area updating procedure, initiate a tracking area updating procedure as specified in clause 5.5.3 over the existing NAS signalling connection except if there is a pending service request procedure as response to paging for CS fallback; or\n-\ta UE radio capability ID IE, the UE shall:\na)\tstore the UE radio capability ID as specified in annex C; and\nb)\tsend a TRACKING AREA UPDATE COMPLETE message to the network to acknowledge the received UE radio capability ID IE.\nIf the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE in the TRACKING ARE UPDATE ACCEPT message and the TAI(s) included in the IE is not part of the list of \"forbidden tracking areas for roaming\", the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s) into the list of \"forbidden tracking areas for roaming\", ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) and remove the TAI(s) from the stored TAI list if present.\nIf the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE in the TRACKING AREA UPDATE ACCEPT message and the TAI(s) included in the IE is not part of the list of \"forbidden tracking areas for regional provision of service\", the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s) into the list of \"forbidden tracking areas for regional provision of service\", ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) and remove the TAI(s) from the stored TAI list if present.\nNOTE 13:\tFor the UE supporting non-IP or Ethernet PDN type or UAS services, if the UE receives the TRACKING AREA UPDATE ACCEPT message and the ePCO bit in the EPS network feature support IE is not set to \"extended protocol configuration options supported\", the UE can perform a PLMN selection according to 3GPP TS 23.122 [6] with the current PLMN considered as the lowest priority after the completion of the tracking area update procedure.\nIf for discontinuous coverage, the UE receives the Unavailability configuration IE in the TRACKING AREA UPDATE ACCEPT message and the End of unavailability report bit is set to \"UE does not need to report end of unavailability\", the UE is not required to trigger tracking area update procedure when the unavailability period duration has ended. If the UE does not receive the Unavailability configuration IE, or the End of unavailability report bit is set to \"UE needs to report end of unavailability\", the UE should trigger tracking area update procedure when the unavailability period duration has ended.\nIf the UE supports enhanced discontinuous coverage, the MME may include the Discontinuous coverage maximum time offset IE in the TRACKING ARE UPDATE ACCEPT message. If the UE receives, the Discontinuous coverage maximum time offset IE in the TRACKING ARE UPDATE ACCEPT message, the UE shall replace any previously received discontinuous coverage maximum time offset value on the same satellite E-UTRAN access and PLMN with the latest received timer value.\nApart from the actions on the tracking area updating attempt counter, the description for tracking area update for EPS services as specified in clause 5.5.3.2.4 shall be followed. In addition, the following description for tracking area updating for SMS services applies.\nIn NB-S1 mode, if the UE requested \"SMS only\" in the Additional update type IE and supports NB-S1 mode only, the MME decides to accept the tracking area update request for EPS services only and:\n-\tthe location update for non-EPS services is not accepted by the VLR as specified in 3GPP TS 29.118 [16A]; or\n-\tthe MME decides to not accept the tracking area update request for \"SMS only\",\nthe MME shall set the EPS update result IE to \"EPS only\", shall not indicate \"SMS only\" in the Additional update result IE in the TRACKING AREA UPDATE ACCEPT message and shall include an appropriate SMS services status value.\nThe UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the value included in the SMS services status IE:\n\"SMS services not available\"\nThe UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. The USIM shall be considered as invalid for SMS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a.\n\"SMS services not available in this PLMN\"\nThe UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.\nThe UE may provide a notification to the user or the upper layers that the SMS services are not available.\nThe UE shall not attempt normal attach or tracking area updating procedures indicating \"SMS only\" with current PLMN until switching off the UE or the UICC containing the USIM is removed. Additionally, the UE may perform a PLMN selection according to 3GPP TS 23.122 [6].\n\"Network failure\"\nThe UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.\nIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered.\nIf the tracking area updating attempt counter is equal to 5:\n-\tthe UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered.\n\"Congestion\"\nThe UE shall stop the timer T3430 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered.\nOther values are considered as abnormal cases. The tracking area updating procedure shall be considered as failed for SMS services. The behaviour of the UE in those cases is specified in clause 5.5.3.2.6A.\nIf the tracking area updating cannot be accepted by the network, the MME sends a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.\nIf a tracking area update request from a UE with a LIPA PDN connection is not accepted due to the reasons specified in clause 5.5.3.2.4, the MME shall send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 \"Implicitly detached\".\nIf the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIn NB-S1 mode, if the tracking area update request is rejected due to operator determined barring (see 3GPP TS 29.272 [16C]), the network shall set the EMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIf the tracking area request is rejected due to service gap control as specified in clause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 \"congestion\" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.\nIf the tracking area update request is rejected due to incompatibility between the CIoT EPS optimizations supported by the UE and what the network supports and the network sets the EMM cause value to #15 \"no suitable cells in tracking area\", the network may additionally include the Extended EMM cause IE with value \"requested EPS optimization not supported\".\nNOTE 1:\tHow the UE uses the Extended EMM cause IE with value \"requested EPS optimization not supported\" is implementation specific. The UE still behaves according to the EMM cause value #15.\nBased on operator policy, if the tracking area update request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 \"Redirection to 5GCN required\".\nNOTE 2:\tThe network can take into account the UE's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 \"Redirection to 5GCN required\".\nIf the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, and the MME does not support N26 interface, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 \"UE identity cannot be derived by the network\".\nWhen the UE performs inter-system change from N1 mode to S1 mode, if the MME is informed that verification of the integrity protection of the TRACKING AREA UPDATE REQUEST message has failed in the AMF, then:\na)\tIf the MME can retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, the MME shall proceed as specified in clause 5.5.3.2.4;\nb)\tif the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, or the eKSI or GUTI was not sent by the UE, the MME may initiate the identification procedure by sending the IDENTITY REQUEST message with the \"Type of identity\" of the Identity type IE set to \"IMSI\" before taking actions as specified in clause 4.4.4.3; or\nc)\tIf the MME needs to reject the tracking area updating procedure, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 \"UE identity cannot be derived by the network\".\nIn NB-S1 mode or WB-S1 mode via satellite E-UTRAN access, if the tracking area updating request is from a UE via a satellite E-UTRA cell and the network using the User Location Information provided by the eNodeB (see 3GPP TS 36.413 [23]), is able to determine that the UE is in a location where the network is not allowed to operate, the network shall set the EMM cause value in the TRACKING AREA UPDATE REJECT message to #78 \"PLMN not allowed to operate at the present UE location\".\nUpon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430 and stop any transmission of user data.\nIf the TRACKING AREA UPDATE REJECT message with EMM cause #25 or #78 was received without integrity protection, then the UE shall discard the message.\nIf the MME received multiple TAIs from the satellite E-UTRAN as described in 3GPP TS 23.401 [10], and determines that, by UE subscription and operator's preferences, all of the received TAIs are forbidden for roaming or for regional provision of service, the MME shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE;\nb)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth,\nin the TRACKING AREA UPDATE REJECT message.\nRegardless of the EMM cause value received in the TRACKING AREA UPDATE REJECT message via satellite E-UTRAN,\n-\tif the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE in the TRACKING AREA UPDATE REJECT message, the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s), if not already stored, into the list of \"forbidden tracking areas for roaming\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s); and\n-\tif the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE in the TRACKING AREA UPDATE REJECT message, the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s), if not already stored, into the list of \"forbidden tracking areas for regional provision of service\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s)\nFurthermore. the UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.\n#3\t(Illegal UE);\n#6\t(Illegal ME); or\n#8\t(EPS services and non-EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nFor the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\nNOTE 3:\tThe possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.\n#7\t(EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf the EPS update type is \"periodic updating\", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and shall proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#9\t(UE identity cannot be derived by the network);\nThe UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.\nIf the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.\nNOTE 4:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in the single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#10\t(Implicitly detached);\nIf the EPS update type is \"periodic updating\", a UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.\nThe UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.\nNOTE 5:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM state as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter, delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause value #11 and no RR connection exists.\nFor the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. In addition, the UE shall reset the registration attempt counter.\n#12\t(Tracking area not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for regional provision of service\" for non-integrity protected NAS reject message.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list if present. If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message.\nIf the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 [54] clause 4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#14\t(EPS services not allowed in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nIf the EPS update type is \"TA updating\", or the EPS update type is \"periodic updating\" and the UE is in PS mode 1 or PS mode 2 of operation, the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. In this case, the UE supporting S1 mode only shall delete the list of equivalent PLMNs before performing the procedure.\nIf the EPS update type is \"periodic updating\", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services and shall proceed as follows:\n-\ta UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED;\n-\ta UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see clause 4.5);\n-\ta UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6];\n-\ta UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. In addition, the UE shall reset the registration attempt counter.\n#15\t(No suitable cells in tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message. Additionally, the UE shall remove the current TAI from the stored TAI list if present and:\n-\tif the UE is in WB-S1 mode and the Extended EMM cause IE with value \"E-UTRAN not allowed\" is included in the TRACKING AREA UPDATE REJECT message, the UE supports \"E-UTRA Disabling for EMM cause #15\", and the \"E-UTRA Disabling Allowed for EMM cause #15\" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in clause 4.5 and search for a suitable cell in another location area or 5GS tracking area;\n-\tif the UE is in NB-S1 mode and the Extended EMM cause IE with value \"NB-IoT not allowed\" is included in the TRACKING AREA UPDATE REJECT message, then the UE may disable the NB-IoT capability as specified in clause 4.9 and search for a suitable cell in E-UTRAN radio access technology;\n-\totherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#22\t(Congestion);\nIf the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause 5.5.3.2.6.\nThe UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\nThe UE shall stop timer T3346 if it is running.\nIf the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.\nIf the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].\nThe UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\nIf the tracking area updating procedure was initiated for and MO MMTEL voice or MO MMTEL video call is started, then a notification that the request was not accepted due to network congestion shall be provided to upper layers.\nNOTE 6:\tThis can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 [13E]).\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#25\t(Not authorized for this CSG);\nEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.3.2.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\nIf the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\nIf the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] clause 3.1A.\nThe UE shall search for a suitable cell according to 3GPP TS 36.304 [21].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-REGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.\n#31\t(Redirection to 5GCN required);\nEMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for N1 mode is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.3.2.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\nThe UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause 4.5).\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#36\t(IAB-node operation not authorized);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter, delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#40\t(No EPS bearer context activated);\nThe UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.\nNOTE 7:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause value #10 \"Implicitly detached\".\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED.\n#42\t(Severe network failure);\nThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the tracking area update counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n#78\t(PLMN not allowed to operate at the present UE location).\nThis cause value received from a non-satellite E-UTRA cell is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.3.2.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the registration attempt counter. The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of \"PLMNs not allowed to operate at the present UE location\", start a corresponding timer instance (see subclause 4.11.2), enter state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in clause 5.5.3.2.6.\nIf the tracking area updating request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the UE shall perform the procedures as described in clause 5.5.3.2.5. If the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to receiving the AUTHENTICATION REJECT message, the UE shall perform the procedures as described in clause 5.4.2.5. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE 1:\tThis can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nb)\tdetach locally, if not detached already, attempt EPS attach for emergency bearer services.\nIf the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in clause 5.5.3.2.6, the UE shall perform the actions as described in clause 5.5.3.2.6 and inform the upper layers of the failure to access the network.\nNOTE 2:\tThis can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nIf the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c), d) or f) as well as k) when the \"Extended wait time\" is ignored, and ka) when the \"Extended wait time CP data\" is ignored in clause .2.6, the UE shall perform the procedures as described in clause 5.5.3.2.6. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE 3:\tThis can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nb)\tdetach locally, if not detached already, attempt EPS attach for emergency bearer services.\nIf the tracking area updating request for access to RLOS cannot be accepted by the network, the UE shall perform the procedures as described in clause 5.5.3.2.5 along with the following conditions:\na)\tif the action for the reject involves searching for a suitable cell in E-UTRAN radio access technology, the UE shall proceed with the action and shall attempt to perform a tracking area updating procedure or an attach procedure for access to RLOS in the new tracking area, if found, depending on the EMM state.\nb)\tif the action for the reject involves attempting to select GERAN or UTRAN radio access technology or disabling the E-UTRAN capability, the UE shall skip the action for as long as access to RLOS is still needed.\nNOTE:\tHow long the UE attempts to access RLOS is up to UE implementation.\nThen if\na)\tthe UE is in the same selected PLMN where the last tracking area updating procedure was attempted and rejected;\nb)\tthe tracking area updating procedure was rejected with an EMM cause value other than #9, #10 and #40; and\nc)\ttimer T3346 is not running,\nthe UE shall:\na)\tdetach locally, if not detached already, perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.\nIf the tracking area updating request for access to RLOS fails due to abnormal case a) in clause 5.5.3.2.6, the UE shall perform the actions as described in clause 5.5.3.2.6 and inform the upper layers of the failure to access the network.\nIf the tracking area updating request for access to RLOS fails due to abnormal cases b), c) or d) in clause .2.6, the UE shall perform the procedures as described in clause 5.5.3.2.6 with the exception that the UE shall skip actions that involve attempting to select GERAN or UTRAN radio access technology and actions that involve disabling of the E-UTRA capability, for as long as access to RLOS is still needed. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall:\na)\tdetach locally, if not detached already, perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.\nThe following abnormal cases can be identified:\na)\tAccess barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without \"Extended wait time\" received from lower layers\nIn WB-S1 mode, if the tracking area updating procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.\nIn NB-S1 mode, if the tracking area updating procedure is started in response to a paging request from the network, access barring is not applicable.\nIn WB-S1 mode, if access is barred for \"originating signalling\" (see 3GPP TS 36.331 [22]), the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started as soon as possible and if still necessary, e.g. when access for \"originating signalling\" is granted on the current cell or when the UE moves to a cell where access for \"originating signalling\" is granted.\nIn NB-S1 mode, if access is barred for \"originating signalling\" (see 3GPP TS 36.331 [22]), the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the tracking area updating procedure is started again after an implementation dependent time.\nIn NB-S1 mode, if access is barred for \"originating signalling\" (see 3GPP TS 36.331 [22]), a request for an exceptional event is received from the upper layers, then the tracking area updating procedure shall be started.\nNOTE 1:\tIn NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 [22]).\nIf access is barred because of access class barring for \"originating signalling\" (see 3GPP TS 36.331 [22]) and if:\n-\tone of the MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions is satisfied;\n-\tthe upper layers request to send a mobile originated SMS over NAS or SMS over S102; or\n-\tthe upper layers request user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.\nthen the tracking area updating procedure shall be started according to clause 5.5.3.2.2. The call type used shall be per annex D of this document.\nNOTE 2:\tIf more than one of MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions are satisfied, it is left to UE implementation to determine the call type based on Annex D of this document.\nIf access is barred for a certain ACDC category (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a higher ACDC category and the UE supports ACDC, then the tracking area updating procedure shall be started according to clause 5.5.3.2.2.\nIf an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a certain ACDC category and the UE supports ACDC, then the tracking area updating procedure shall be started according to clause 5.5.3.2.2.\nIf the trigger for the tracking area updating procedure is the response to a paging request from the network and the NAS signalling connection establishment is rejected by the network, the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The tracking area updating procedure may be started if it is still necessary when access for \"terminating calls\" is granted or because of a cell change.\naa)\tLower layer failure to establish the RRC connection and:\n-\tthe UE is in its HPLMN or in an EHPLMN (if the EHPLMN list is present);\n-\tthe tracking area updating request is not for initiating a PDN connection for emergency bearer services;\n-\tthe UE does not have a PDN connection for for emergency bearer services;\n-\tthe UE supports being configured with CustomLLFailureRetry as specified in 3GPP TS 24.368 [15A]); and\n-\tCustomLLFailureRetry leaf is present as specified in 3GPP TS 24.368 [15A]);\nThe UE shall increment the UE implementation specific attempt counter. If the UE implementation specific attempt counter is less than the value of MaxMinRetry, the UE shall start T3411 with the duration of MinRetryTimer. If the UE implementation specific attempt counter is equal to the value of MaxMinRetry, the UE shall start T3402 with the duration of MaxRetryTimer.\nThe tracking area updating procedure shall be aborted, and the UE shall proceed as described below.\nb)\tLower layer failure not covered in case aa) or release of the NAS signalling connection without \"Extended wait time\" and without \"Extended wait time CP data\" received from lower layers before the TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message is received\nThe tracking area updating procedure shall be aborted, and the UE shall proceed as described below.\nc)\tT3430 timeout\nThe UE shall abort the procedure. The NAS signalling connection, if any, shall be released locally.\nNOTE 3:\tThe NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in clause 5.4.2.7.\nThe UE shall proceed as described below.\nd)\tTRACKING AREA UPDATE REJECT, other causes than those treated in clause 5.5.3.2.5, and cases of EMM cause values #22, #25, #31 and #78, if considered as abnormal cases according to clause 5.5.3.2.5\nIf the tracking area updating request is not for initiating a PDN connection for emergency bearer services, upon reception of the EMM causes #95, #96, #97, #99 and #111 the UE should set the tracking area updating attempt counter to 5.\nThe UE shall proceed as described below.\ne)\tChange of cell into a new tracking area\nIf a cell change into a new tracking area occurs before the tracking area updating procedure is completed, the tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.\nThe UE shall proceed as described below.\nf)\tTracking area updating and detach procedure collision\nEPS detach containing detach type \"re-attach required\" or \"re-attach not required\":\nIf the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, the tracking area updating procedure shall be aborted and the detach procedure shall be progressed. If the DETACH REQUEST message contains detach type \"re-attach not required\" and EMM cause #2 \"IMSI unknown in HSS\", the UE will follow the procedure as described below for the detach type \"IMSI detach\".\nEPS detach containing detach type \"IMSI detach\":\nIf the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, the DETACH REQUEST message shall be ignored and tracking area updating procedure shall be progressed.\nThe UE shall proceed as described below.\ng)\tTracking area updating and GUTI reallocation procedure collision\nIf the UE receives a GUTI REALLOCATION COMMAND message before the tracking area updating procedure has been completed, this message shall be ignored and the tracking area updating procedure shall be progressed.\nh)\tTransmission failure of TRACKING AREA UPDATE REQUEST message indication from lower layers\nThe tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.\ni)\tTransmission failure of TRACKING AREA UPDATE COMPLETE message indication with TAI change from lower layers\nIf the current TAI is not in the TAI list, the tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.\nIf the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure.\nj)\tTransmission failure of TRACKING AREA UPDATE COMPLETE message indication without TAI change from lower layers\nIt is up to the UE implementation how to re-run the ongoing procedure.\nk)\t\"Extended wait time\" from the lower layers\nIf the TRACKING AREA UPDATE REQUEST message contained the low priority indicator set to \"MS is configured for NAS signalling low priority\", the UE shall start timer T3346 with the \"Extended wait time\" value and reset the tracking area updating attempt counter.\nIf the TRACKING AREA UPDATE REQUEST message did not contain the low priority indicator set to \"MS is configured for NAS signalling low priority\", the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11 – 15 in selected PLMN, then the UE shall start timer T3346 with the \"Extended wait time\" value and reset the tracking area updating attempt counter.\nIn other cases the UE shall ignore the \"Extended wait time\".\nThe UE shall abort the tracking area updating procedure, stay in the current serving cell, set the EPS update status to EU2 NOT UPDATED, change the state to EMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.\nIf the UE had used eDRX before initiating tracking area updating procedure, then the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure.\nThe UE shall proceed as described below.\nka)\t\"Extended wait time CP data\" from the lower layers\nIf the UE is operating in NB-S1 mode and supports the timer T3448, the UE shall start the timer T3448 with the \"Extended wait time CP data\" value. If the UE is operating in NB-S1 mode and does not support the timer T3448, the UE shall start the timer T3346 with the \"Extended wait time CP data\" value and reset the tracking area updating attempt counter.\nIn other cases the UE shall ignore the \"Extended wait time CP data\".\nThe UE shall abort the tracking area updating procedure, stay in the current serving cell, set the EPS update status to EU2 NOT UPDATED, change the state to EMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.\nIf the UE had used eDRX before initiating tracking area updating procedure, then the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure.\nThe UE shall proceed as described below.\nl)\tTimer T3346 is running\nThe UE shall not start the tracking area updating procedure unless:\n-\tthe UE is in EMM-CONNECTED mode;\n-\tthe UE received a paging;\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services;\n-\tthe UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call;\n-\tthe UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and\ni)\tthe UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]); and\nii)\ttimer T3346 was not started when NAS signalling connection was established with RRC establishment cause set to \"MO exception data\";\n-\tthe UE has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication, the timer T3402 and the timer T3411 are not running and the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to \"MS is configured for NAS signalling low priority\"; or\n-\tthe MUSIM UE needs to request an IMSI offset value as specified in clause 5.5.3.2.2.\nThe UE stays in the current serving cell and applies the normal cell reselection process.\nNOTE 4:\tIt is considered an abnormal case if the UE needs to initiate a tracking area updating procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.\nIf the TAI of the current serving cell is not included in the TAI list or the TIN indicates \"P-TMSI\", the UE shall set the EPS update status to EU2 NOT UPDATED and change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\nIf the tracking area updating procedure needs to be initiated for an MO MMTEL voice call or an MO MMTEL video call is started, then a notification that the procedure was not initiated due to network congestion shall be provided to upper layers.\nNOTE 5:\tThis can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 [13E]).\nThe UE shall proceed as described below.\nla)\tTimer T3448 is running\nThe UE shall not start the tracking area updating procedure with the \"signalling active\" flag set, unless:\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE which is only using EPS services with control plane CIoT EPS optimization received a paging; or\n-\tthe UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).\nThe UE stays in the current serving cell and applies the normal cell reselection process.\nThe UE shall proceed as described below.\nm)\tMobile originated detach required\nDetach due to removal of USIM or due to switch off:\nThe tracking area updating procedure shall be aborted, and the UE initiated detach procedure shall be performed.\nDetach not due to removal of USIM and not due to switch off:\nThe UE initiated detach procedure shall be initiated after successful completion of the tracking area updating procedure.\no)\tTimer T3447 is running\nThe UE shall not start the tracking area updating procedure with the \"signalling active\" flag set or the \"active\" flag set, unless:\n-\tthe UE received a paging;\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services; or\n-\tthe MUSIM UE needs to request an IMSI offset value as specified in clause 5.5.3.2.2.\nThe UE stays in the current serving cell and applies the normal cell reselection process. The tracking area update request procedure is started, if still necessary, when timer T3447 expires.\np)\tTracking area updating and paging procedure collision\nIf the UE receives a CS SERVICE NOTIFICATION message before the tracking area updating procedure has been completed, the UE shall progress the tracking area updating procedure and respond to the CS SERVICE NOTIFICATION upon successful completion of the tracking area updating procedure.\nFor the cases aa, b, c, d, e, f with detach type \"re-attach required\" or \"re-attach not required\" with EMM cause other than #2 \"IMSI unknown in HSS\", k and ka, the UE shall stop any ongoing transmission of user data.\nFor the cases aa, b, c, d, k, ka, l and la, the UE shall proceed as follows:\n1)\tTimer T3430 shall be stopped if still running.\n2)\tFor the cases aa, b, c, d, la k when the \"Extended wait time\" is ignored, and ka when the \"Extended wait time CP data\" is ignored, if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, the tracking area updating attempt counter shall be incremented, unless it was already set to 5.\n3)\tIf the tracking area updating attempt counter is less than 5, the TAI of the current serving cell is included in the TAI list, the EPS update status is equal to EU1 UPDATED, the TIN does not indicate \"P-TMSI\" and the tracking area updating procedure is performed not due to an inter-system change from N1 mode to S1 mode and the tracking area updating procedure is not performed due to cases g, m, n, za, zc in clause 5.5.3.2.2:\n-\tthe UE shall keep the EPS update status to EU1 UPDATED and enter state EMM-REGISTERED.NORMAL-SERVICE. The UE shall start timer T3411.\n-\tIf in addition the TRACKING AREA UPDATE REQUEST indicated \"periodic updating\" or if tracking area updating procedure was initiated to recover NAS signalling connection due to \"RRC Connection failure\" from the lower layers, none of the other reasons for initiating the tracking area updating procedure listed in clause 5.5.3.2.2 was applicable, and the TRACKING AREA UPDATE REQUEST message did not include T3324 value IE, T3412 extended value IE or Extended DRX parameters IE, the timer T3411 may be stopped when the UE enters EMM-CONNECTED mode.\n-\tIf timer T3411 expires the tracking area updating procedure is triggered again.\n4)\tIf the tracking area updating attempt counter is less than 5, and the TAI of the current serving cell is not included in the TAI list or the EPS update status is different to EU1 UPDATED or the TIN indicates \"P-TMSI\" or the tracking area updating procedure is performed due to an inter-system change from N1 mode to S1 mode or if the tracking area updating procedure is performed due to cases g, m, n, za, zc in clause 5.5.3.2.2:\n-\tfor the cases k and l, the tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n-\tfor the case ka, if timer T3346 is started, the tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\n-\tfor the case ka, if timer T3448 is started and the \"signalling active\" flag is set in the TRACKING AREA UPDATE REQUEST message, the tracking area updating procedure is started, if still necessary, when timer T3448 expires or is stopped.\n-\tfor the case la, if the \"signalling active\" flag is set in the TRACKING AREA UPDATE REQUEST message, the tracking area updating procedure is started, if still necessary, when timer T3448 expires or is stopped.\n-\tfor the cases aa, b, c, d, k when the \"Extended wait time\" is ignored, and ka when the \"Extended wait time CP data\" is ignored, if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, the UE shall start timer T3411, shall set the EPS update status to EU2 NOT UPDATED and change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE. When timer T3411 expires the tracking area updating procedure is triggered again.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GPRS update status as specified in 3GPP TS 24.008 [13] for the abnormal case when a normal or periodic routing area updating procedure fails and the routing area updating attempt counter is less than 5 and the GPRS update status is different from GU1 UPDATED.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GS update status as specified in 3GPP TS 24.501 [54] for the abnormal cases when a registration procedure for mobility and periodic registration fails and the registration attempt counter is less than 5 and the 5GS update status is different from 5U1 UPDATED.\n5)\tIf the tracking area updating attempt counter is equal to 5:\n-\tthe UE shall start timer T3402 if the value of the timer as indicated by the network is not zero, shall set the EPS update status to EU2 NOT UPDATED;\n-\tif the value of T3402 as indicated by the network is zero, the UE shall perform the actions defined for the expiry of the timer T3402;\n-\tthe UE shall delete the list of equivalent PLMNs and shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE or optionally to EMM-REGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; and\n-\tif A/Gb mode, Iu mode or N1 mode is supported by the UE:\n-\tif A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GPRS update status as specified in 3GPP TS 24.008 [13] for the abnormal case when a normal or periodic routing area updating procedure fails and the routing area updating attempt counter is equal to 5;\n-\tif the UE is operating in single-registration mode, the UE shall in addition handle the 5GS update status as specified in 3GPP TS 24.501 [54] for the abnormal case when a registration procedure for mobility or periodic registration update performed over 3GPP access fails and the registration attempt counter is equal to 5; and\n-\tif the UE does not change to state EMM-REGISTERED.PLMN-SEARCH, the UE shall\n-\texcept for case aa attempt to select GERAN, UTRAN or NG-RAN radio access technology. For case aa the UE may attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate GMM or 5GMM specific procedures. Additionally, if the UE selects GERAN or UTRAN radio access technology, the UE may disable the E-UTRA capability as specified in clause 4.5. If No E-UTRA Disabling In 5GS is enabled at the UE (see 3GPP TS 24.368 [50] or 3GPP TS 31.102 [17]) and the UE selects NG-RAN radio access technology, it shall not disable the E-UTRA capability; otherwise, the UE may disable the E-UTRA capability as specified in clause 4.5.\nNOTE 6:\tWhether the UE requests RRC to treat the active E-UTRA cell as barred (see 3GPP TS 36.304 [21]) is left to the UE implementation.\nIf a GERAN or UTRAN cell is selected:\n-\ta UE in PS mode 1 or PS mode 2 of operation shall proceed with appropriate GMM specific procedures;\n-\ta UE in CS/PS mode 1 or CS/PS mode 2 of operation shall proceed with appropriate MM or GMM specific procedures.\nIf an NG-RAN cell is selected, the UE shall proceed with appropriate 5GMM specific procedures.\nThe UE shall proceed as follows:\n1)\tif the tracking area update was successful for EPS services only and the TRACKING AREA UPDATE ACCEPT message contained a value included in the SMS services status IE not treated in clause 5.5.3.2.4A, the UE shall proceed as follows:\na)\tThe UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;\nb)\tIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered;\nc)\tIf the tracking area updating attempt counter is equal to 5:\n-\tthe UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and \"SMS only\" or the combined tracking area updating procedure for EPS services and \"SMS only\" is triggered; and\n2)\totherwise, the abnormal cases specified in clause 5.5.3.2.6 apply.\nThe following abnormal cases can be identified:\na)\tIf a lower layer failure occurs before the message TRACKING AREA UPDATE COMPLETE has been received from the UE and a GUTI has been assigned, the network shall abort the procedure, enter EMM-IDLE mode and shall consider both, the old and new GUTI as valid until the old GUTI can be considered as invalid by the network (see clause 5.4.1.4). During this period the network may use the identification procedure followed by a GUTI reallocation procedure if the old GUTI is used by the UE in a subsequent message.\nThe network may page with IMSI if paging with old and new S-TMSI fails. Paging with IMSI causes the UE to re-attach as described in clause 5.6.2.2.2.\nAdditionally, if the TRACKING AREA UPDATE ACCEPT message includes:\n1)\ta different negotiated IMSI offset value assigned to a UE that previously had another negotiated IMSI offset value assigned;\n2)\tno negotiated IMSI offset value assigned to a UE that previously had negotiated IMSI offset value assigned; or\n3)\ta negotiated IMSI offset value assigned to a UE that previously had no negotiated IMSI offset value assigned;\nfor case 1) the network shall use two alternative IMSI values and for case 2) and 3) the network shall use one alternative IMSI value and the IMSI value for paging the UE until one of the two (alternative) IMSI values can be considered as invalid by the network.\nNOTE 1:\tAs the network assigns a new GUTI when the alternative IMSI value is changed or deleted (see clause 5.5.3.2.4), the network can consider the alternative IMSI value associated with the old GUTI as invalid if the UE responds to the paging with the new GUTI.\nIf the UE supports WUS assistance, the MME supports and accepts the use of WUS assistance and if the TRACKING AREA UPDATE ACCEPT message includes:\n1)\ta different negotiated UE paging probability information for the UE assigned to a UE that previously had another negotiated UE paging probability information for the UE assigned;\n2)\tno negotiated UE paging probability information for the UE assigned to a UE that previously had negotiated UE paging probability information for the UE assigned; or\n3)\ta negotiated UE paging probability information for the UE assigned to a UE that previously had no negotiated UE paging probability information for the UE assigned;\nfor case 1) the network shall use two UE paging probability information for the UE values and for case 2) and 3) the network shall use one UE paging probability information for the UE value for paging the UE until one of the two UE paging probability information for the UE values can be considered as invalid by the network.\nNOTE 2:\tAs the network assigns a new GUTI when the UE paging probability information for the UE value is changed or deleted (see clause 5.5.3.2.4), the network can consider the UE paging probability information for the UE value associated with the old GUTI as invalid if the UE responds to the paging with the new GUTI.\nb)\tProtocol error\nIf the TRACKING AREA UPDATE REQUEST message has been received with a protocol error, the network shall return a TRACKING AREA UPDATE REJECT message with one of the following EMM cause values:\n#96:\tinvalid mandatory information element error;\n#99:\tinformation element non-existent or not implemented;\n#100:\tconditional IE error; or\n#111:\tprotocol error, unspecified.\nc)\tT3450 time-out\nOn the first expiry of the timer, the network shall retransmit the TRACKING AREA UPDATE ACCEPT message and shall reset and restart timer T3450. The retransmission is performed four times, i.e. on the fifth expiry of timer T3450, the tracking area updating procedure is aborted. Both, the old and the new GUTI shall be considered as valid until the old GUTI can be considered as invalid by the network (see clause 5.4.1.4). During this period the network acts as described for case a above.\nd)\tTRACKING AREA UPDATE REQUEST received after the TRACKING AREA UPDATE ACCEPT message has been sent and before the TRACKING AREA UPDATE COMPLETE message is received\nIf one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differ from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted if the TRACKING AREA UPDATE COMPLETE message has not been received and the new tracking area updating procedure shall be progressed; or\nIf the information elements do not differ for cases other than inter-system change from N1 mode to S1 mode in EMM-IDLE mode with the UE operating in the single-registration mode, then the TRACKING AREA UPDATE ACCEPT message shall be resent and the timer T3450 shall be restarted if a TRACKING AREA UPDATE COMPLETE message is expected. If the information elements do not differ for the case of inter-system change from N1 mode to S1 mode in EMM-IDLE mode with the UE operating in the single-registration mode, the MME should forward the new TRACKING AREA UPDATE REQUEST message which contains the same information elements as the previous TRACKING AREA UPDATE REQUEST message to the source AMF to run the integrity check, obtain the latest mapped EPS security context (to be used to protect any future NAS message sent to the UE) and continue with the new tracking area updating procedure. In these cases, the retransmission counter related to T3450 is not incremented.\nNOTE 3:\tInstead of forwarding the new TRACKING AREA UPDATE REQUEST message which contains the same information elements to the source AMF, the MME can decide to initiate an authentication procedure followed by a security mode control procedure to take the new partial native EPS security context into use if the new partial native EPS security context is taken into use successfully, then resend the same TRACKING AREA UPDATE ACCEPT message protected using this new EPS security context.\ne)\tMore than one TRACKING AREA UPDATE REQUEST received and no TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message has been sent\nIf one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differs from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted and the new tracking area updating procedure shall be progressed;\nif the information elements do not differ for cases other than inter-system change from N1 mode to S1 mode in EMM-IDLE mode with the UE operating in the single-registration mode, then the network shall continue with the previous tracking area updating procedure and shall not treat any further this TRACKING AREA UPDATE REQUEST message. If the information elements do not differ for the case of inter-system change from N1 mode to S1 mode in EMM-IDLE mode with the UE operating in the single-registration mode, the MME should forward the new TRACKING AREA UPDATE REQUEST message which contains the same information elements as the previous TRACKING AREA UPDATE REQUEST message to the source AMF to run the integrity check, obtain the latest mapped EPS security context (to be used to protect any future NAS message sent to the UE) and continue with the previous tracking area updating procedure.\nNOTE 4:\tInstead of forwarding the new TRACKING AREA UPDATE REQUEST message which contains the same information elements to the source AMF, the MME can decide to initiate an authentication procedure followed by a security mode control procedure to take the new partial native EPS security context into use and, if the new partial native EPS security context is taken into use successfully, use this new EPS security context to protect any future NAS message sent to the UE.\nf)\tLower layers indication of non-delivered NAS PDU due to handover\nIf the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message could not be delivered due to an intra MME handover and the TAI of the target cell and the TAI of the source cell are the same, then upon successful completion of the intra MME handover the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message.\ng)\tDETACH REQUEST message received before the TRACKING AREA UPDATE ACCEPT message is sent or before the TRACKING AREA UPDATE COMPLETE message (in case of GUTI and/or TMSI was allocated) is received.\nDetach containing cause \"switch off\":\nThe network shall abort the signalling for the tracking area updating procedure towards the UE and shall progress the detach procedure as described in clause 5.5.2.2.\nNOTE 5:\tInternally in the network, before processing the detach request, the MME can perform the necessary signalling procedures for the tracking area updating procedure before progressing the detach procedure.\nDetach containing other causes than \"switch off\":\nThe network shall proceed with the tracking area updating procedure and shall progress the detach procedure after successful completion of the tracking area updating procedure.\nh)\tIf the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating \"periodic updating\" is received by the new MME which does not have the EMM context data related to the subscription, the new MME may send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 \"Implicitly detached\"\nWithin a combined tracking area updating procedure the messages TRACKING AREA UPDATE ACCEPT and TRACKING AREA UPDATE COMPLETE carry information for the tracking area updating and the location area updating.\nThe combined tracking area updating procedure follows the normal tracking area updating procedure described in clause 5.5.3.2 with exception of clause 5.5.3.2.4A and clause 5.5.3.2.6A.\nThe UE operating in CS/PS mode 1 or CS/PS mode  state EMM-REGISTERED, shall initiate the combined tracking area updating procedure:\na)\twhen the UE that is attached for both EPS and non-EPS services detects that the current TAI is not in the list of tracking areas that the UE previously registered in the MME, unless the UE is configured for \"AttachWithIMSI\" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;\nb)\twhen the UE that is attached for EPS services wants to perform an attach for non-EPS services. In this case the EPS update type IE shall be set to \"combined TA/LA updating with IMSI attach\";\nc)\twhen the UE performs an intersystem change from A/Gb mode to S1 mode and the EPS services were previously suspended in A/Gb mode;\nd)\twhen the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the UE previously either performed a combined GPRS attach procedure, an IMSI attach procedure, a location area updating procedure or a combined routing area updating procedure, in A/Gb or Iu mode, or moved to A/Gb or Iu mode from S1 mode through an SRVCC handover or moved to Iu mode from S1 mode through an vSRVCC handover. In this case the EPS update type IE shall be set to \"combined TA/LA updating with IMSI attach\";\ne)\twhen the UE enters EMM-REGISTERED.NORMAL-SERVICE and the UE's TIN indicates \"P-TMSI\";\nf)\twhen the UE receives an indication from the lower layers that the RRC connection was released with cause \"load balancing TAU required\";\ng)\twhen the UE deactivated EPS bearer context(s) locally while in EMM-REGISTERED, because it was not able or not allowed to establish a NAS signalling connection, and then returns to EMM-REGISTERED.NORMAL-SERVICE and no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message is pending to be sent by the UE;\nh)\twhen the UE changes any one of the UE network capability information, the MS network capability information or the N1 UE network capability information;\ni)\twhen the UE changes the UE specific DRX parameter;\nj)\twhen the UE receives an indication of \"RRC Connection failure\" from the lower layers and has no signalling or user uplink data pending (i.e. when the lower layer requests NAS signalling connection recovery);\nk)\twhen due to manual CSG selection the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;\nl)\twhen the UE reselects an E-UTRAN cell while it was in GPRS READY state or PMM-CONNECTED mode;\nm)\twhen the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN, and changes the mobile station classmark 2 or the supported codecs, or the UE supports SRVCC to GERAN and changes the mobile station classmark 3;\nn)\twhen the UE changes the radio capability for GERAN or cdma2000® or both;\no)\twhen the UE's usage setting or the voice domain preference for E-UTRAN change in the UE;\np)\twhen the UE activates mobility management for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.2, and the TIN indicates \"RAT-related TMSI\";\nq)\twhen the UE performs an intersystem change from A/Gb mode to S1 mode and the TIN indicates \"RAT-related TMSI\", but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.4;\nr)\tupon reception of a paging indication, if the UE is in state EMM-REGISTERED.ATTEMPTING-TO-UPDATE and the paging indication uses S-TMSI or it uses IMSI with domain indicator set to ″CS″;\nNOTE 1:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\ns)\twhen the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in clause 6.5.1.4A;\nt)\twhen the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the UE has previously performed the MM connection establishment for CS fallback emergency calls (see 3GPP TS 24.008 [13], clause 4.5.1.5a) without performing a location area updating procedure or combined routing area updating procedure while camping on a location area which is different from the stored location area. In this case, the EPS update type IE shall be set to \"combined TA/LA updating with IMSI attach\";\nu)\twhen the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the MM update status is U2 NOT UPDATED. In this case the EPS update type IE shall be set to \"combined TA/LA updating with IMSI attach\";\nv)\twhen the UE needs to request the use of PSM or needs to stop the use of PSM;\nw)\twhen the UE needs to request the use of eDRX or needs to stop the use of eDRX;\nx)\twhen a change in the eDRX usage conditions at the UE requires different extended DRX parameters;\ny)\twhen a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value;\nNOTE 2:\tA change in the PSM or eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.\nz)\twhen the CIoT EPS optimizations the UE needs to use, change in the UE;\nza)\twhen the Default_DCN_ID value changes, as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17];\nNOTE 3:\tThe tracking area updating procedure is initiated after deleting the DCN-ID list as specified in annex C.\nzb)\twhen the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE operates in single-registration mode, and conditions specified in 3GPP TS 24.501 [54] apply;\nzc)\twhen the UE in EMM-IDLE mode changes the radio capability for E-UTRAN;\nzd)\twhen the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode;\nze)\twhen the UE in EMM-IDLE mode changes the radio capability for NG-RAN;\nzf)\tin WB-S1 mode, when the UE has received a UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\";\nzg)\twhen the UE needs to use the WUS assistance, stop to use the WUS assistance, or change the conditions for using the WUS assistance; or\nzh)\twhen the UE in EMM-IDLE mode needs to inform the network that a UE radio capability information update is required due to a cell change between E-UTRAN and satellite E-UTRAN cells.\nFor case c, if the TIN indicates \"RAT-related TMSI\" and the EPS services were not resumed before returning to S1 mode, the UE shall set the TIN to \"P-TMSI\" before initiating the combined tracking area updating procedure.\nFor cases n, zc, ze and zh the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.\nNOTE 3a:\tFor cases n, zc, ze and zh if the UE supports RACS irrespective whether the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN the UE radio capability information update needed IE is included in the TRACKING AREA UPDATE REQUEST message.\nIf the UE is in the EMM-CONNECTED mode and the UE changes the radio capability for E-UTRAN or for NG-RAN, the UE may locally release the established NAS signalling connection and enter the EMM-IDLE mode. Then, the UE shall initiate the combined tracking area updating procedure including a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.\nFor case l, if the TIN indicates \"RAT-related TMSI\", the UE shall set the TIN to \"P-TMSI\" before initiating the combined tracking area updating procedure.\nFor case r, the \"active\" flag in the EPS update type IE shall be set to 1. If the paging is received for CS fallback, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure. If the TRACKING AREA UPDATE ACCEPT message includes a UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall proceed with sending the EXTENDED SERVICE REQUEST message. To initiate a combined tracking area updating procedure the UE sends the message TRACKING AREA UPDATE REQUEST to the network, starts timer T3430 and changes to state EMM-TRACKING-AREA-UPDATING-INITIATED. The value of the EPS update type IE in the message shall indicate \"combined TA/LA updating\" unless explicitly specified otherwise.\nIf the UE initiates the combined tracking area updating procedure for EPS services and \"SMS only\", the UE shall indicate \"SMS only\" in the additional update type IE.\nThe UE shall include the TMSI status IE if no valid TMSI is available. Furthermore, if the UE has stored a valid location area identification, the UE shall include it in the Old location area identification IE in the TRACKING AREA UPDATE REQUEST message.\nIf the UE has stored a valid TMSI, the UE shall include the TMSI based NRI container IE in the TRACKING AREA UPDATE REQUEST message.\nThe UE shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message:\na)\tfor the case g;\nb)\tfor the case s;\nc)\tfor the case zb;\nd)\tif the UE has established PDN connection(s) of \"non IP\" or Ethernet PDN type; and\ne)\tif the UE:\n1)\tlocally deactivated at least one dedicated EPS bearer context upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode;\n2)\tlocally deactivated at least one dedicated EPS bearer context upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see clause 6.4.2.1); or\n3)\tlocally deactivated at least one default EPS bearer context upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see clause 6.5.0).\nIn WB-S1 mode, if the UE supports RACS the UE shall set the RACS bit to \"RACS supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.\nFor cases n, zc, ze and zh, in WB-S1 mode, if the UE supports RACS and the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.\nFor all cases except cases n, zc, ze and zh, in WB-S1 mode, if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to \"UE radio capability ID available\" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.\nDuring the combined tracking area updating procedure, the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures. For restrictions applicable after handover or inter-system handover to S1 mode see clause 5.5.3.2.3.\nDepending on the value of the EPS update result IE received in the TRACKING AREA UPDATE ACCEPT message, the following different cases can be distinguished:\n1)\tThe EPS update result IE value indicates \"combined TA/LA updated\": Tracking and location area updating is successful for EPS and non-EPS services, or for EPS services and \"SMS only\";\n2)\tThe EPS update result IE value indicates \"TA updated\": Tracking area updating is successful, but location area updating for non-EPS services or \"SMS only\" is not successful.\nA TRACKING AREA UPDATE COMPLETE message shall be returned to the network if the TRACKING AREA UPDATE ACCEPT message contains a GUTI or a TMSI or both.\nThe description for normal tracking area update as specified in clause 5.5.3.2.4 shall be followed. In addition, the following description for location area updating applies.\nThe TMSI reallocation may be part of the combined tracking area updating procedure. The TMSI allocated is then included in the TRACKING AREA UPDATE ACCEPT message together with the location area identification (LAI). In this case the MME shall change to state EMM-COMMON-PROCEDURE-INITIATED and shall start the timer T3450 as described in clause 5.4.1. The LAI may be included in the TRACKING AREA UPDATE ACCEPT message without TMSI. If the MME does not indicate \"SMS only\" in the TRACKING AREA UPDATE ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.\nFor a shared network in CS domain, the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP TS 23.272 [9].\nThe UE, receiving a TRACKING AREA UPDATE ACCEPT message, stores the received location area identification, resets the location update attempt counter, sets the update status to U1 UPDATED and enters MM state MM IDLE.\nIf the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\" events (see clause 5.3.7b), then the UE shall reset this counter.\nIf the LAI contained in the TRACKING AREA UPDATE ACCEPT message is a member of the list of \"forbidden location areas for regional provision of service\" or the list of \"forbidden location areas for roaming\" then such entry shall be deleted.\nIf the PLMN identity for the CS domain which is provided as part of the LAI contained in the TRACKING AREA UPDATE ACCEPT message differs from the PLMN identity provided as part of the GUTI, the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message.\nIf the UE requested \"SMS only\" in the Additional update type IE, or if the UE requested a combined tracking area updating for EPS and non-EPS services, but the network decides to accept the tracking area update request for EPS services and \"SMS only\", the network shall indicate \"SMS only\" in the Additional update result IE. In addition, if the SMS services are provided via SMS in MME, the network shall, in the TRACKING AREA UPDATE ACCEPT message, provide a non-broadcast LAI and may indicate in the EPS update result IE that ISR is activated. If a TMSI has to be allocated, then the network shall also provide a TMSI which cannot cause any ambiguity with assigned TMSI values.\nIf the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value \"SMS only\", a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with \"IMS voice available\" shall not attempt to use CS fallback for mobile originating services.\nAs an implementation option, if the TRACKING AREA UPDATE ACCEPT message does not include the Additional update result IE with value \"SMS only\" and the UE is not configured for NAS signalling low priority then the UE may stop timer T3246 if running.\nIf the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value \"CS Fallback not preferred\", this indicates to a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with \"IMS voice available\" that it is attached for EPS and non-EPS services and that it can use CS fallback.\nHow to handle the old TMSI stored in the UE depends on the mobile identity included in the TRACKING AREA UPDATE ACCEPT message.\n-\tIf the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.\n-\tIf the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI.\n-\tIf neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.\nNOTE 1:\tIt is possible for UEs compliant with earlier versions of this specification to send a TRACKING AREA UPDATE COMPLETE message even if TMSI reallocation is not part of the combined tracking area updating procedure.\nIf the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value \"SMS only\" or \"CS Fallback not preferred\", a UE operating in CS/PS mode 1 with \"IMS voice not available\" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see clause 4.5).\nThe network receiving a TRACKING AREA UPDATE COMPLETE message stops timer T3450, changes to state EMM-REGISTERED.\nNOTE 2:\tUpon receiving a TRACKING AREA UPDATE COMPLETE message, if a new TMSI was included in the TRACKING AREA UPDATE ACCEPT message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP TS 29.118 [16A].\nUnless the MME supporting N26 is in a deployment where it, after intersystem change from N1 mode to S1 mode, has an IMEI or an IMEISV for the UE, then after the UE performs intersystem change from N1 mode to S1 mode, if:\n-\tthe network supports SRVCC for IMS emergency sessions (see 3GPP TS 23.216 [8]);\n-\tthe UE has an emergency PDN connection;\n-\tthe UE has set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to \"SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported; and\n-\tthe MME has neither an IMEI nor an IMEISV for the UE;\nNOTE 3:\tThe AMF can receive an IMEI from the UE and pass it to the MME during the intersystem change if the UE is emergency registered and the UE doesn't have a valid USIM or the UE's IMSI remains unauthenticated.\nthen the MME shall initiate the identification procedure (see clause 5.4.4) or the security mode control procedure (see clause 5.4.3) with the UE.\nApart from the actions on the tracking area updating attempt counter, the description for tracking area for EPS services as specified in clause 5.5.3.2.4 shall be followed. In addition, the following description for location updating for non-EPS services applies.\nIf, due to emergency services fallback (see 3GPP TS 23.502 [59], clause 4.13.4), there is a request for emergency services pending and the emergency bearer services indicator in the EPS network feature support IE indicates \"emergency bearer services in S1 mode not supported\", then the UE shall skip the requirements defined below in the present clause for the receipt of a TRACKING AREA UPDATE ACCEPT message including an EMM cause value, attempt to select GERAN or UTRAN radio access technology, select a setup message as defined in clause 5.3.7, proceed with appropriate MM specific procedures, and send the setup message.\nThe UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the EMM cause value:\n#2\t(IMSI unknown in HSS)\nThe UE shall stop T3430 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described clause 5.3.7a. If the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf, due to emergency services fallback (see 3GPP TS 23.502 [59]), there is a request for CS fallback call pending (see clause 5.3.7), the UE shall attempt to select GERAN or UTRAN radio access technology and attempt emergency call setup.\nA UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" and without a persistent EPS bearer context shall disable the E-UTRA capability (see clause 4.5).\nA UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" and with a persistent EPS bearer context shall, after the radio bearer associated with the persistent EPS bearer context has been released, disable the E-UTRA capability (see clause 4.5).\n#16\t(MSC temporarily not reachable); or\n#17\t(Network failure)\nThe UE shall stop timer T3430 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.\nIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered again.\nIf the tracking area updating attempt counter is equal to 5:\n-\ta UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered again;\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" without a persistent EPS bearer context shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see clause 4.5);\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" and with a persistent EPS bearer context shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered again. When the radio bearer associated with the persistent EPS bearer context has been released and the UE is registered for EPS services only, operating in CS/PS mode 1 of operation with \"IMS voice not available\", then the UE shall stop timer T3402, if already running, attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see clause 4.5).\n#18\t(CS domain not available)\nThe UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.\nThe UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.\nA UE in CS/PS mode 1 of operation with \"IMS voice not available\" without a persistent EPS bearer context shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN and disable the E-UTRA capability (see clause 4.5).\nA UE in CS/PS mode 1 of operation with \"IMS voice not available\" and with a persistent EPS bearer context shall, after the radio bearer associated with the persistent EPS bearer context has been released, attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN and disable the E-UTRA capability (see clause 4.5).\nA UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" may provide a notification to the user or the upper layers that the CS domain is not available.\nThe UE shall not attempt combined attach or combined tracking area updating procedure with current PLMN until switching off the UE or the UICC containing the USIM is removed.\n#22\t(Congestion)\nThe UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, shall enter state MM IDLE.\nOther EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined tracking area updating procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in clause 5.5.3.3.6.\nIf the combined tracking area updating cannot be accepted by the network, the MME shall send a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.\nIf the MME locally deactivates EPS bearer contexts for the UE (see clause 5.5.3.2.4) and no active EPS bearer contexts remain for the UE, the MME shall send the TRACKING AREA UPDATE REJECT message including the EMM cause value #10 \"implicitly detached\".\nIf the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a back-off timer T3346.\nIf the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, and the MME does not support N26 interface, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 \"UE identity cannot be derived by the network\".\nWhen the UE performs inter-system change from N1 mode to S1 mode, if the MME is informed that verification of the integrity protection of the TRACKING AREA UPDATE REQUEST message has failed in the AMF, then:\na)\tIf the MME can retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, the MME shall proceed as specified in clause 5.5.3.2.4;\nb)\tif the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, or the eKSI or GUTI was not sent by the UE, the MME may initiate the identification procedure by sending the IDENTITY REQUEST message with the \"Type of identity\" of the Identity type IE set to \"IMSI\" before taking actions as specified in clause 4.4.4.3; or\nc)\tIf the MME needs to reject the tracking area updating procedure, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 \"UE identity cannot be derived by the network\".\nIf the tracking area request is rejected due to service gap control as specified in clause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 \"congestion\" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.\nBased on operator policy, if the tracking area update request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 \"Redirection to 5GCN required\".\nNOTE 1:\tThe network can take into account the UE's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 \"Redirection to 5GCN required\".\nUpon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430, stop any transmission of user data and enter state MM IDLE.\nIf the TRACKING AREA UPDATE REJECT message with EMM cause #25 or #78 was received without integrity protection, then the UE shall discard the message.\nThe UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.\n#3\t(Illegal UE);\n#6\t(Illegal ME); or\n#8\t(EPS services and non-EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI.\nThe UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nFor the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.#7\t(EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall consider then USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nA UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\nA UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure performed over 3GPP access and for mobility and periodic registration update indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#9\t(UE identity cannot be derived by the network);\nThe UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.\nIf there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.\nIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\nIf there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.\nNOTE 2:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nA UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\nA UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\nIf the UE is operating in the single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#10\t(Implicitly detached);\nA UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.\nThe UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.\nIf there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.\nIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\nIf there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.\nNOTE 3:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nA UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM state as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI, and reset the tracking area updating attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall then perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause value #11 and no RR connection exists.\nFor the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. In addition, the UE shall reset the registration attempt counter.\n#12\t(Tracking area not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for regional provision of service\" for non-integrity protected NAS reject message.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list if present. If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message.\nIf the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP TS 24.501 [54] clause 4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nThe UE shall indicate the Update type IE \"combined TA/LA updating with IMSI attach\" when performing the tracking area updating procedure following the PLMN selection.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#14\t(EPS services not allowed in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMNs for GPRS service\" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\nThe UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\nA UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see clause 4.5).\nA UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6].\nA UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. In addition, the UE shall reset the registration attempt counter.\n#15\t(No suitable cells in tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message. Additionally, the UE shall remove the current TAI from the stored TAI list if present and:\n-\tif the UE is in WB-S1 mode and the Extended EMM cause IE with value \"E-UTRAN not allowed\" is included in the TRACKING AREA UPDATE REJECT message, the UE supports \"E-UTRA Disabling for EMM cause #15\", and the \"E-UTRA Disabling Allowed for EMM cause #15\" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in clause 4.5 and search for a suitable cell in another location area or 5GS tracking area;\n-\tif the UE is in NB-S1 mode and the Extended EMM cause IE with value \"NB-IoT not allowed\" is included in the TRACKING AREA UPDATE REJECT message, then the UE may disable the NB-IoT capability as specified in clause 4.9 and search for a suitable cell in E-UTRAN radio access technology;\n-\totherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].\nThe UE shall indicate the Update type IE \"combined TA/LA updating with IMSI attach\" when performing the tracking area updating procedure.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#22\t(Congestion);\nIf the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause 5.5.3.3.6.\nThe UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\nThe UE shall stop timer T3346 if it is running.\nIf the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.\nIf the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].\nThe UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nIf the tracking area updating procedure was initiated for an MO MMTEL voice call or an MO MMTEL video call is started, then a notification that the request was not accepted due to network congestion shall be provided to upper layers.\nNOTE 4:\tThis can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 [13E]).\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#25\t(Not authorized for this CSG);\nEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.3.3.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\nIf the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\nIf the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] clause 3.1A.\nThe UE shall search for a suitable cell according to 3GPP TS 36.304 [21].\nThe UE shall indicate the Update type IE \"combined TA/LA updating with IMSI attach\" when performing the tracking area updating procedure.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-REGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.\n#31\t(Redirection to 5GCN required);\nEMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for N1 mode is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.3.3.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\nThe UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause 4.5).\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#36\t(IAB-node operation not authorized);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI, and reset the tracking area updating attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall then perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.\n#40\t(No EPS bearer context activated);\nThe UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.\nIf there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.\nIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\nIf there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected fallback request was not for initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.\nNOTE 5:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause value #10 \"Implicitly detached\".\nA UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\nA UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED.\n#42\t(Severe network failure);\nThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the tracking area updating attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, MM update status to U2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number, LAI, TMSI and ciphering key sequence number.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\nOther values are considered as abnormal cases. The behaviour of the UE in those cases is specified in clause 5.5.3.3.6.\nThe UE shall proceed as follows:\n1)\tif the UE requested the combined tracking area update for EPS services and \"SMS only\" and the TRACKING AREA UPDATE ACCEPT message indicates a combined tracking area updating procedure successful for EPS and non-EPS services, the UE shall behave as if the combined tracking area updating procedure was successful for EPS services and \"SMS only\";\nNOTE:\tIn this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to \"CS\", as specified in clause 5.6.2.3.2.\n2)\tif the combined tracking area update was successful for EPS services only and the TRACKING AREA UPDATE ACCEPT message contained an EMM cause value not treated in clause 5.5.3.3.4.3 or the EMM Cause IE is not included in the message, the UE shall proceed as follows:\na)\tThe UE shall stop timer T3430 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;\nb)\tIf the tracking area updating attempt counter is less than 5:\n-\tthe UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered again;\nc)\tIf the tracking area updating attempt counter is equal to 5:\n-\ta UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with \"IMS voice available\" shall start timer T3402 if the value indicated by the network is not zero, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM.\n-\tIf the value of T3402 as indicated by the network is zero, the UE shall perform the actions defined for the expiry of the timer T3402.\n-\tWhen timer T3402 expires the combined tracking area updating procedure indicating \"combined TA/LA updating with IMSI attach\" is triggered again; and\n-\ta UE operating in CS/PS mode 1 of operation with \"IMS voice not available\" shall attempt to select GERAN, UTRAN or NG-RAN radio access technology, proceed with appropriate MM, GMM or 5GMM specific procedures and disable the E-UTRA capability (see clause 4.5); and\nd)\tIf there is a CS fallback emergency call or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; and\n3)\totherwise, the abnormal cases specified in clause 5.5.3.2.6 apply with the following modification.\nIf the tracking area updating attempt counter is incremented according to clause 5.5.3.2.6 the next actions depend on the value of the tracking area updating attempt counter.\n-\tIf the tracking area updating attempt counter is less than 5, the UE shall set the update status to U2 NOT UPDATED, but shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and additionally if the tracking area updating procedure was performed due to cases h, m, n, z, zc in clause 5.5.3.3.2 the update status shall be changed to EU2; or\n-\tif the tracking area updating attempt counter is equal to 5, the UE shall delete any LAI, TMSI and ciphering key sequence number and set the update status to U2 NOT UPDATED.\nIf there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.\nThe abnormal cases specified in clause 5.5.3.2.7 apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.4\teCall inactivity procedure",
                            "text_content": "The eCall inactivity procedure is applicable only to a UE configured for eCall only mode as specified in 3GPP TS 31.102 [17]. The procedure shall be started when:\n-\tthe UE is in any EMM-REGISTERED substate except substates EMM-REGISTERED.PLMN-SEARCH or EMM-REGISTERED.NO-CELL-AVAILABLE;\n-\tthe UE is in EMM-IDLE mode; and\n-\tone of the following conditions applies:\n1)\ttimer T3444 expires or is found to have already expired and timer T3445 is not running;\n2)\ttimer T3445 expires or is found to have already expired and timer T3444 is not running; or\n3)\ttimers T3444 and T3445 expire or are found to have already expired.\nThe UE shall then perform the following actions:\n-\tstop other running timers (e.g. T3411, T3412);\n-\tif the UE is currently registered to EPS services only, perform a detach procedure for EPS services only;\n-\tif the UE is currently registered for both EPS services and non-EPS services, perform a combined detach procedure for EPS services and non-EPS services;\n-\tdelete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, and eKSI; and\n-\tenter EMM-DEREGISTERED.eCALL-INACTIVE state.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.5\tTracking area update request message (for N1 mode only)",
                            "text_content": "The tracking area updating procedure is used to construct a TRACKING AREA UPDATE REQUEST message for the inter-system change from S1 mode to N1 mode for further security verification by the MME.\nThe TRACKING AREA UPDATE REQUEST message is created by EMM by request of 5GMM which further includes the message in the REGISTRATION REQUEST message as described in 3GPP TS 24.501 [54].\nThe TRACKING AREA UPDATE REQUEST message shall contain only mandatory information elements.\nThe UE shall set the EPS update type IE in the TRACKING AREA UPDATE REQUEST message to \"TA updating\".\nThe UE shall include the eKSI (either KSIASME or KSISGSN) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. The UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context and increase the uplink NAS COUNT by one. The UE shall set associated GUTI in the Old GUTI IE.\nWhen the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE substate and needs to construct the TRACKING AREA UPDATE REQUEST message for inter-system change from S1 mode to N1 mode, the UE shall consider that the tracking area updating procedure is not initiated and the UE shall remain in EMM-REGISTERED.NO-CELL-AVAILABLE state.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.6\tAttach request message (for N1 mode only)",
                            "text_content": "The attach procedure is used to construct an ATTACH REQUEST message for a UE performing a registration procedure for initial registration when\na)\tthe UE:\n1)\tpreviously was registered in S1 mode before entering state EMM-DEREGISTERED; and\n2)\thas received an \"interworking without N26 interface not supported\" indication from the network; and\nb)\tEPS security context and a valid 4G-GUTI are available.\nThe ATTACH REQUEST message is created by EMM by request of 5GMM which further includes the message in the REGISTRATION REQUEST message as described in 3GPP TS 24.501 [54].\nThe ATTACH REQUEST message shall contain only mandatory information elements.\nThe UE shall set the EPS attach type IE in the ATTACH REQUEST message to \"EPS attach\".\nThe UE shall include the eKSI (KSIASME) in the NAS Key Set Identifier IE in the ATTACH REQUEST message. The UE shall integrity protect the ATTACH REQUEST message with the current EPS security context and increase the uplink NAS COUNT by one.\nThe UE shall set associated GUTI in the EPS mobile identity IE.\nThe UE shall set the UE network capability IE according to its capabilities.\nThe UE shall include an ESM DUMMY MESSAGE in the ESM message container IE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.6\tEMM connection management procedures (S1 mode only)",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.6.1\tService request procedure",
                            "text_content": "The purpose of the service request procedure is to transfer the EMM mode from EMM-IDLE to EMM-CONNECTED mode. If the UE is not using EPS services with control plane CIoT EPS optimization, this procedure is used to establish the radio and S1 bearers when user data or signalling is to be sent. If the UE is using EPS services with control plane CIoT EPS optimization, this procedure can be used for UE initiated transfer of user data via the control plane. Another purpose of this procedure is to invoke MO/MT CS fallback or 1xCS fallback procedures.\nThis procedure is used when:\n-\tthe network has downlink signalling pending;\n-\tthe UE has uplink signalling pending;\n-\tthe UE or the network has user data pending and the UE is in EMM-IDLE mode;\n-\tthe UE is in EMM-CONNECTED mode and has a NAS signalling connection only; the UE is using EPS services with control plane CIoT EPS optimization, and it has user data pending which is to be transferred via user plane radio bearers;\n-\tthe UE in EMM-IDLE or EMM-CONNECTED mode has requested to perform mobile originating/terminating CS fallback or 1xCS fallback;\n-\tthe network has downlink cdma2000® signalling pending;\n-\tthe UE has uplink cdma2000® signalling pending;\n-\tthe UE has to request resources for ProSe direct discovery or Prose direct communication;\n-\tthe UE has to request resources for V2X communication over PC5;\n-\tthe UE that is MUSIM UE and in EMM-IDLE mode requests the network to remove the paging restriction; or\n-\tto indicate to the network that the MUSIM UE requests the release of the NAS signalling connection or reject paging.\nThe service request procedure is initiated by the UE, however, for the downlink transfer of signalling, cdma2000® signalling or user data in EMM-IDLE mode, the trigger is given by the network by means of the paging procedure (see clause 5.6.2).\nThe UE shall invoke the service request procedure when:\na)\tthe UE in EMM-IDLE mode receives a paging request using S-TMSI with CN domain indicator set to \"PS\" from the network;\nNOTE:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\nb)\tthe UE, in EMM-IDLE mode, has pending user data to be sent;\nc)\tthe UE, in EMM-IDLE mode, has uplink signalling pending;\nd)\tthe UE in EMM-IDLE or EMM-CONNECTED mode is configured to use CS fallback and has a mobile originating CS fallback request from the upper layer;\ne)\tthe UE in EMM-IDLE mode is configured to use CS fallback and receives a paging request with CN domain indicator set to \"CS\", or the UE in EMM-CONNECTED mode is configured to use CS fallback and receives a CS SERVICE NOTIFICATION message;\nf)\tthe UE in EMM-IDLE or EMM-CONNECTED mode is configured to use 1xCS fallback and has a mobile originating 1xCS fallback request from the upper layer;\ng)\tthe UE in EMM-CONNECTED mode is configured to use 1xCS fallback and accepts cdma2000® signalling messages containing a 1xCS paging request received over E-UTRAN;\nh)\tthe UE, in EMM-IDLE mode, has uplink cdma2000® signalling pending to be transmitted over E-UTRAN;\ni)\tthe UE, in EMM-IDLE or EMM-CONNECTED mode, is configured to use 1xCS fallback, accepts cdma2000® signalling messages containing a 1xCS paging request received over cdma2000® 1xRTT, and the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP TS 36.331 [22]);\nj)\tthe UE, in EMM-IDLE or EMM-CONNECTED mode, has uplink cdma2000® signalling pending to be transmitted over cdma2000® 1xRTT, and the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP TS 36.331 [22]);\nk)\tthe UE performs an inter-system change from S101 mode to S1 mode and has user data pending;\nl)\tthe UE in EMM-IDLE mode has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP TS 36.331 [22]);\nm)\tthe UE, in EMM-CONNECTED mode and has a NAS signalling connection only, is using EPS services with control plane CIoT EPS optimization and has pending user data to be sent via user plane radio bearers;\nn)\tthe UE in EMM-IDLE mode has to request resources for V2X communication over PC5 (see 3GPP TS 23.285 [47]);\no)\tthe network supports the paging restriction and the UE that is MUSIM UE and in EMM-IDLE mode is requesting the network to remove the paging restriction;\np)\tthe network supports the NAS signalling connection release and the MUSIM UE in EMM-CONNECTED mode requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction; or\nq)\tthe network supports the reject paging request and the MUSIM UE, in EMM-IDLE mode when responding to paging rejects the paging request from the network, requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction.\nIf one of the above criteria to invoke the service request procedure is fulfilled, then the service request procedure may only be initiated by the UE when the following conditions are fulfilled:\n-\tits EPS update status is EU1 UPDATED, and the current TAI of the current serving cell is included in the TAI list; and\n-\tno EMM specific procedure is ongoing.\nThe MUSIM UE shall not initiate service request procedure for requesting the network to release the NAS signalling connection if the UE is attached for emergency bearer services or if the UE has a PDN connection for emergency bearer services established. To enable the emergency call back, the UE shall not initiate service request procedure for requesting the network to release the NAS signalling connection for a UE implementation-specific duration of time after the completion of the emergency bearer services.\nThe figure depicts a 5G network signal path, illustrating the multi-path signal propagation in a 5G network. Key components include the base station (gNB), user equipment (UE), and scatterers. The diagram highlights beamforming techniques to mitigate interference.\nNOTE 1:\tAS indications (indications from lower layers) are results of procedures triggered by MME in service request procedure. Triggered procedures could be e.g. RRC connection reconfiguration procedure (see 3GPP TS 36.331 [22]) and inter system PS handover to GERAN or UTRAN procedure as a result of CSFB procedure (see 3GPP TS 23.272 [9]).\nNOTE 2:\tFor 1xCS fallback, the UE sends the EXTENDED SERVICE REQUEST message and starts timer T3417. The procedure is considered completed upon receiving indication of system change from AS.\n\nFigure 5.6.1.1.1: Service request procedure (part 1)\nThe figure depicts a security-protected NAS message, which could be a command, service acceptance, or ESM data transport message. The message is encrypted and protected by security measures, ensuring confidentiality and integrity.\nNOTE 1:\tSecurity protected NAS message: this could be e.g. a SECURITY MODE COMMAND, SERVICE ACCEPT, or ESM DATA TRANSPORT message.\nNOTE 2:\tAS indications (indications from lower layers) are results of procedures triggered by MME in service request procedure. Triggered procedures could be e.g. an RRC connection release procedure or RRC connection reconfiguration procedure (see 3GPP TS 36.331 [22]).\n\nFigure 5.6.1.1.2: Service request procedure (part 2)\nA service request attempt counter is used to limit the number of service request attempts and no response from the network. The service request attempt counter shall be incremented as specified in clause 5.6.1.6.\nThe service request attempt counter shall be reset when:\n-\ta normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed;\n-\ta service request procedure in order to obtain packet services is successfully completed;\n-\ta service request procedure is rejected as specified in clause 5.6.1.5 or clause 5.3.7b; or\n-\tthe UE moves to EMM-DEREGISTERED state.\nFor cases a, b, c, h, k, l and o in clause 5.6.1.1:\n-\tif the UE is not configured for NAS signalling low priority, the UE initiates the service request procedure by sending a SERVICE REQUEST message to the MME;\n-\tif the UE is configured for NAS signalling low priority, and the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network indicated that the network supports use of EXTENDED SERVICE REQUEST for packet services, the UE shall send an EXTENDED SERVICE REQUEST message with service type set to \"packet services via S1\"; or\nNOTE:\tA UE configured for dual priority is configured for NAS signalling low priority indicator.\n-\tif the UE is configured for NAS signalling low priority and the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network did not indicate that the network supports use of EXTENDED SERVICE REQUEST for packet services, the UE shall instead send a SERVICE REQUEST message.\nFor cases a, b, c, h, k, l, and o in clause 5.6.1.1, after sending the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message with service type set to \"packet services via S1\", the UE shall start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.\nFor case d in clause 5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417ext and enter the state EMM-SERVICE-REQUEST-INITIATED.\nFor case e in clause 5.6.1.1:\n-\tif the UE is in EMM-IDLE mode, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417ext-mt and enter the state EMM-SERVICE-REQUEST-INITIATED;\n-\tif the UE is in EMM-CONNECTED mode and if the UE accepts the paging, the UE shall send an EXTENDED SERVICE REQUEST message with the CSFB response IE indicating \"CS fallback accepted by the UE\", start T3417ext-mt and enter the state EMM-SERVICE-REQUEST-INITIATED; or\n-\tif the UE is in EMM-CONNECTED mode and if the UE rejects the paging, the UE shall send an EXTENDED SERVICE REQUEST message with the CSFB response IE indicating \"CS fallback rejected by the UE\" and enter the state EMM-REGISTERED.NORMAL-SERVICE. The network shall not initiate CS fallback procedures.\nFor cases f, g, i and j in clause 5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.\nFor case o in clause 5.6.1.1, the UE may send an EXTENDED SERVICE REQUEST message with Service type set to \"packet services via S1\" and Request type set to \"NAS signalling connection release\" in the UE request type IE to remove the paging restriction and request the release of the NAS signalling connection at the same time. The UE shall start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED. The UE shall not include the Paging restriction IE in the EXTENDED SERVICE REQUEST message.\nFor cases p and q in clause 5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message,\n1)\tfor case p in clause 5.6.1.1, set Request type to \"NAS signalling connection release\" in the UE request type IE and Service type to \"packet services via S1\"; or\n2)\tfor case q in clause 5.6.1.1, set Request type to \"Rejection of paging\" in the UE request type IE and,\na)\tif the UE needs to reject PS paging, the UE shall set Service type to \"packet services via S1\"; or\nb)\tif the UE needs to reject CS paging, the UE shall set Service type to \"mobile terminating CS fallback or 1xCS fallback\" and the CSFB response IE to \"CS fallback rejected by the UE\"; and\nstart T3417, enter the state EMM-SERVICE-REQUEST-INITIATED and may include its paging restriction preference in the Paging restriction IE in the EXTENDED SERVICE REQUEST message.\nThe UE shall send a CONTROL PLANE SERVICE REQUEST message, start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.\nFor case a in clause 5.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate \"mobile terminating request\". The UE may include the ESM DATA TRANSPORT message. The UE shall not include any ESM message other than ESM DATA TRANSPORT message.\nFor case b in clause 5.6.1.1,\n-\tif the UE has pending IP, non-IP or Ethernet user data that is to be sent via the control plane radio bearers, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate \"mobile originating request\". The UE shall include an ESM DATA TRANSPORT message in the ESM message container IE. If the UE supports the CP-EDT (see 3GPP TS 36.300 [20]), the UE shall provide the CONTROL PLANE SERVICE REQUEST message in the NAS request to the lower layer to establish a RRC connection as specified in clause 5.3.1.1.\nFor cases b and m in clause 5.6.1.1,\n-\tif the UE has pending IP, non-IP or Ethernet user data that is to be sent via the user plane radio bearers, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to \"mobile originating request\" and the \"active\" flag in the Control plane service type IE to 1. The UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.\nFor case c in clause 5.6.1.1, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to \"mobile originating request\". If the CONTROL PLANE SERVICE REQUEST message is:\n-\tfor sending SMS, the UE shall include the SMS message in the NAS message container IE and shall not include any ESM message container IE in the CONTROL PLANE SERVICE REQUEST message; and\n-\tfor sending signalling different from SMS, the UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.\nFor cases p and q in clause 5.6.1.1, the UE shall send the CONTROL PLANE SERVICE REQUEST message,\n-\tfor case p in clause 5.6.1.1 set Request type to \"NAS signalling connection release\" in the UE request type IE and Control plane service type IE to \"mobile originating request\"; or\n-\tfor case q in clause 5.6.1.1 set Request type to \"Rejection of paging\" in the UE request type IE and Control plane service type IE to \"mobile terminating request\"; and\nstart T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED. Further, the UE may include its paging restriction preference in the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message and shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.\nFor case o in clause 5.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate \"mobile originating request\". The UE shall not include the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message. The UE may include the UE request type IE and set Request type to \"NAS signalling connection release\" to remove the paging restriction and request the release of the NAS signalling connection at the same time. If the UE requests the release of the NAS signalling connection, the UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.\nUpon receipt of the SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message, the MME may initiate the EMM common procedures, e.g. the authentication procedure and security mode control procedure.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME and the MME has no active EPS bearer contexts for the UE, for cases a, b, c and o in clause 5.6.1.1, upon receipt of the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, after completion of the EMM common procedures according to clause 5.6.1.3, if any, the MME shall send a SERVICE ACCEPT message.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME and the UE has no active EPS bearer contexts, for cases a, b, c and o in clause 5.6.1.1, the UE shall treat the receipt of a SERVICE ACCEPT message as successful completion of the procedure. Otherwise, for cases a, b, c, h, k, l and o in clause 5.6.1.1, the UE shall treat the indication from the lower layers that the user plane radio bearer is set up as successful completion of the procedure. The UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.\nIf the service type information element in the EXTENDED SERVICE REQUEST message indicates \"mobile terminating CS fallback or 1xCS fallback\" and the CSFB response IE, if included, indicates \"CS fallback accepted by the UE\", or if the service type information element in the EXTENDED SERVICE REQUEST message indicates \"mobile originating CS fallback or 1xCS fallback\" or \"mobile originating CS fallback emergency call or 1xCS fallback emergency call\", the network initiates CS fallback or 1xCS fallback procedures.\nIf the EPS bearer context status IE is included in the EXTENDED SERVICE REQUEST message, the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) which are active on the network side but are indicated by the UE as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the EXTENDED SERVICE REQUEST message, and this default bearer is not associated with the last remaining PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default EPS bearer context of a PDN connection established as a user-plane resource of an MA PDU session as specified in clause 5.3 of 3GPP TS 24.193 [61] is deactivated locally and the MA PDU session does not have user plane resources established on non-3GPP access in N1 mode, the network shall perform a local release of the MA PDU session.\nIf the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, was sent in a CSG cell and the CSG subscription has expired or was removed for a UE, but the UE has a PDN connection for emergency bearer services established, the network shall accept the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services and deactivate all non-emergency EPS bearers locally. The emergency EPS bearers shall not be deactivated.\nFor cases d in clause 5.6.1.1, and for case e in clause 5.6.1.1 when the CSFB response was set to \"CS fallback accepted by the UE\", the UE shall treat the indication from the lower layers that the inter-system change from S1 mode to A/Gb or Iu mode is completed as successful completion of the procedure. The EMM sublayer in the UE shall indicate to the MM sublayer that the CS fallback procedure has succeeded. The UE shall stop the timer T3417ext or T3417ext-mt, respectively, and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE.\nIf the service request procedure was initiated in EMM-IDLE mode and an EXTENDED SERVICE REQUEST message was sent in a CSG cell and the CSG subscription has expired or was removed for the UE, the network need not perform CSG access control if the service type information element indicates \"mobile originating CS fallback emergency call or 1xCS fallback emergency call\".\nFor cases f and g in clause 5.6.1.1:\n-\tif the UE receives the indication from the lower layers that the signalling connection is released with the redirection indication to cdma2000® 1x access network or the indication from the lower layers that a change to cdma2000® 1x access network for 1xCS fallback has started (see 3GPP TS 36.331 [22]), the UE shall consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE;\n-\tif the UE receives the dual Rx/Tx redirection indication from the lower layers (see 3GPP TS 36.331 [22]), the UE shall select cdma2000® 1x access network for 1xCS fallback, consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NORMAL-SERVICE; and\n-\tif the UE receives a cdma2000® signalling message indicating 1xCS fallback rejection by cdma2000® 1x access network, the UE shall abort the service request procedure, stop timer T3417 and enter the state EMM-REGISTERED.NORMAL-SERVICE.\nFor cases i and j in clause 5.6.1.1, if the UE receives the indication from the lower layers that the signalling connection is released, the UE shall consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE.\nFor cases o, p and q in clause 5.6.1.1, when the MUSIM UE in the EXTENDED SERVICE REQUEST message sets the Request type to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE, the UE shall treat the receipt of SERVICE ACCEPT message as the successful completion of the procedure and the UE shall reset the service request attempt counter, stop timer T3417 and enter the state EMM-REGISTERED.\nIf the SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services was used, the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established upon successful completion of the service request procedure, except for the case when the MUSIM UE in the EXTENDED SERVICE REQUEST message sets the Request type to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE.\nIf the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback and radio bearer establishment takes place during the procedure, the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established upon receiving a lower layer indication of radio bearer establishment. The UE does not perform local deactivation of EPS bearer contexts upon receiving an indication of inter-system change from lower layers.\nIf the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback and radio bearer establishment does not take place during the procedure, the UE does not perform local deactivation of the EPS bearer context. The UE does not perform local deactivation of EPS bearer contexts upon receiving an indication of inter-system change from lower layers.\nIf a service request is received from a UE with a LIPA PDN connection, and if:\n-\ta GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, and the P-GW address included in the EPS bearer context of the LIPA PDN connection is different from the provided GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or\n-\tno GW Transport Layer Address is provided together with the service request by the lower layer;\nthen the MME shall locally deactivate all EPS bearer contexts associated with any LIPA PDN connection. Furthermore, if no active EPS bearer contexts remain for the UE, the MME shall not accept the service request as specified in clause 5.6.1.5.\nIf a service request is received from a UE with a SIPTO at the local network PDN connection, and if the PDN connection is a:\n1)\tSIPTO at the local network PDN connection with stand-alone GW, and if:\n-\ta LHN-ID value is provided by the lower layer together with the service request, and the LHN-ID value stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP TS 36.413 [23]); or\n-\tno LHN-ID value is provided together with the service request by the lower layer; or\n2)\tSIPTO at the local network PDN connection with collocated L-GW, and if:\n-\ta SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, and the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or\n-\tno SIPTO L-GW Transport Layer Address is provided together with the service request by the lower layer;\nthen, the MME takes one of the following actions:\n-\tif all the remaining PDN connections are SIPTO at the local network PDN connections, the MME shall not accept the service request as specified in clause 5.6.1.5; and\n-\tif a PDN connection remains that is not SIPTO at the local network PDN connection and the network decides to set up the S1 and radio bearers, the MME shall upon completion of the setup of the S1 bearers initiate an EPS bearer context deactivation procedure with ESM cause #39 \"reactivation requested\" for the default EPS bearer context of each SIPTO at the local network PDN connection (see clause 6.4.4.2).\nNOTE:\tFor some cases of CS fallback or 1x CS fallback the network can decide not to set up any S1 and radio bearers.\nUpon receipt of the SERVICE REQUEST message, the MME shall delete any stored paging restriction for the UE and stop restricting paging.\nIf the MUSIM UE does not include the Paging restriction IE in the EXTENDED SERVICE REQUEST message, the MME shall delete any stored paging restriction for the UE and stop restricting paging.\nFor cases p and q in clause 5.6.1.1 when the MUSIM UE sets the Request type to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE in the EXTENDED SERVICE REQUEST message and if the UE requests restriction of paging by including the Paging restriction IE, the MME:\n-\tif accepts the paging restriction, shall include the EPS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to \"paging restriction is accepted\". The MME shall store the paging restriction of the UE and enforce these restrictions in the paging procedure as described in clause 5.6.2; or\n-\tif rejects the paging restriction, shall include the EPS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to \"paging restriction is rejected\", and shall discard the received paging restriction. The MME shall delete any stored paging restriction for the UE and stop restricting paging; and\n-\tshall initiate the release of the NAS signalling connection after the completion of the service request procedure.\nWhen the E-UTRAN fails to establish radio bearers for one or more EPS bearer contexts, then the MME shall locally deactivate the EPS bearer contexts corresponding to the failed radio bearers based on the lower layer indication from the E-UTRAN, without notifying the UE.\nIf the UE is not using EPS services with control plane CIoT EPS optimization, the network shall consider the service request procedure successfully completed in the following cases:\n-\twhen it receives an indication from the lower layer that the user plane is setup, if radio bearer establishment is required;\n-\totherwise when it receives an indication from the lower layer that the UE has been redirected to the other RAT (GERAN or UTRAN in CS fallback, or cdma2000® 1x access network for 1xCS fallback).\nFor case a in clause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating \"mobile terminating request\", after completion of the EMM common procedures according to clause 5.6.1.3:\n1)\tif the MME needs to perform an EPS bearer context status synchronization\n-\tfor an EPS bearer context associated with Control plane only indication; or\n-\tfor an EPS bearer context not associated with Control plane only indication, there is no downlink user data pending to be delivered via the user plane, and the UE did not set the \"active\" flag in the Control plane service type IE to 1;\n2)\tif the control plane data back-off time for the UE is stored in MME and the MME decides to deactivate congestion control for transport of user data via the control plane, or\n3)\tif the MME needs to provide the UE with Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE or Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE,\nthen the MME shall send a SERVICE ACCEPT message.\nFurthermore the MME may:\n1)\tinitiate the transport of user data via the control plane procedure or any other NAS signalling procedure;\n2)\tif supported by the UE and required by the network, initiate the setup of the user plane radio bearer(s); or\n3)\tsend a NAS signalling message not related to an EMM common procedure to the UE if downlink signalling is pending.\nFor case b in clause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating \"mobile originating request\", after completion of the EMM common procedures according to clause 5.6.1.3, if any, if the MME needs to provide the UE with Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE or Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE or to perform an EPS bearer context status synchronization\n-\tfor an EPS bearer context associated with Control plane only indication; or\n-\tfor an EPS bearer context not associated with Control plane only indication, there is no downlink user data pending to be delivered via the user plane, and the UE did not set the \"active\" flag in the Control plane service type IE to 1,\nthen the MME shall send a SERVICE ACCEPT message.\nFurthermore, the MME may:\n1)\tinitiate release of the NAS signalling connection upon receipt of an indication from the ESM layer (see clause 6.6.4.2), unless the MME has additional downlink user data or signalling pending;\n2)\tinitiate the setup of the user plane radio bearer(s), if downlink user data is pending to be delivered via the user plane or the UE has set the \"active\" flag in the Control plane service type IE to 1;\n3)\tsend an ESM DATA TRANSPORT message to the UE, if downlink user data is pending to be delivered via the control plane;\n4)\tsend a NAS signalling message not related to an EMM common procedure to the UE if downlink signalling is pending; or\n5)\tsend a SERVICE ACCEPT message to complete the service request procedure, if no NAS security mode control procedure was initiated, the MME did not send a SERVICE ACCEPT message as specified above to perform an EPS bearer context status synchronization, and the MME did not initiate any of the procedures specified in item 1 to 4 above.\nNOTE 1:\tThe MME can initiate the setup of the user plane radio bearer(s) if the MME decides to activate the congestion control for transport of user data via the control plane.\nFor case m in clause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating \"mobile originating request\" and the \"active\" flag in the Control plane service type IE set to 1:\n1)\tif the MME accepts the request, the MME shall initiate the setup of the user plane radio bearer(s) for all active EPS bearer contexts of SGi PDN connections that are established without control plane only indication.\n2)\tif the MME does not accept the request, the MME shall send a SERVICE ACCEPT message to complete the service request procedure.\nNOTE 2:\tThe MME takes into account the maximum number of user plane radio bearers supported by the UE, in addition to local policies and the UE's preferred CIoT network behaviour when deciding whether to accept the request to establish user plane bearer(s) as described in clause 5.3.15. If the MME accepts the request, all SGi PDN connections are considered as established without Control plane only indication.\nNOTE 3:\tIn this release of the specification, a UE in NB-S1 mode can support a maximum of 2 user plane radio bearers (see clause 6.5.0).\nFor case c in clause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating \"mobile originating request\" and without an ESM message container IE, after completion of the EMM common procedures according to clause 5.6.1.3, if any, the MME proceeds as follows:\nIf the MME needs to perform an EPS bearer context status synchronization\n-\tfor an EPS bearer context associated with Control plane only indication; or\n-\tfor an EPS bearer context not associated with Control plane only indication, and there is no downlink user data pending to be delivered via the user plane,\nthen the MME shall send a SERVICE ACCEPT message.\nFurthermore, the MME may:\n1)\tinitiate the setup of the user plane radio bearer(s), if downlink user data is pending to be delivered via the user plane;\n2)\tsend an ESM DATA TRANSPORT message to the UE, if downlink user data is pending to be delivered via the control plane;\n3)\tsend a NAS signalling message not related to an EMM common procedure to the UE, if downlink signalling is pending; or\n4)\tsend a SERVICE ACCEPT message to complete the service request procedure, if no NAS security mode control procedure was initiated, the MME did not send a SERVICE ACCEPT message as specified above to perform an EPS bearer context status synchronization, and the MME did not initiate any of the procedures specified in item 1 to 3 above.\nIf the MUSIM UE does not include the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message, the MME shall delete any stored paging restriction for the UE and stop restricting paging.\nFor cases p and q in clause 5.6.1.1 when the MUSIM UE sets the Request type to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE in the CONTROL PLANE SERVICE REQUEST message and if the UE requests restriction of paging by including the Paging restriction IE, the MME:\n-\tif accepts the paging restriction, shall include the EPS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to \"paging restriction is accepted\". The MME shall store the paging restriction of the UE, enforce these restrictions in the paging procedure as described in clause 5.6.2; or\n-\tif rejects the paging restriction, shall include the EPS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to \"paging restriction is rejected\", and shall discard the received paging restriction. The MME shall delete any stored paging restriction for the UE and stop restricting paging; and\n-\tshall initiate the release of the NAS signalling connection after the completion of the service request procedure.\nIn NB-S1 mode, for cases a, b, c and m in clause 5.6.1.1, if the MME needs to initiate the setup of user plane radio bearer(s), the MME shall check if the UE can support the establishment of additional user plane radio bearer based on the multiple DRB support indicated by UE in the UE network capability IE.\nFor cases a, b and c in clause 5.6.1.1, if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message, the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) which are active on the network side but are indicated by the UE as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the CONTROL PLANE SERVICE REQUEST message, and this default bearer is not associated with the last PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.\nIf the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST and the MME decides to respond with a SERVICE ACCEPT message, the MME shall include an EPS bearer context status IE, indicating which EPS bearer contexts are active in the MME, except for the case when no EPS bearer context exists on the network side.\nIf the MME needs to initiate an EPS bearer context status synchronization, the MME may include an EPS bearer context status IE in the SERVICE ACCEPT message also if no EPS bearer context status IE was included in the CONTROL PLANE SERVICE REQUEST message.\nIf the MME sends a SERVICE ACCEPT message upon receipt of the CONTROL PLANE SERVICE REQUEST message piggybacked with the ESM DATA TRANSPORT message:\n-\tif the Release assistance indication IE is set to \"No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected\" in the message;\n-\tif the UE has indicated support for the control plane data back-off timer; and\n-\tif the MME decides to activate the congestion control for transport of user data via the control plane,\nthen the MME shall include the T3448 value IE in the SERVICE ACCEPT message.\nIf the MME sends a SERVICE ACCEPT message and decides to deactivate congestion control for transport of user data via the control plane then the MME shall delete the stored control plane data back-off time for the UE and the MME shall not include timer T3448 value IE in SERVICE ACCEPT message.\nFor cases a, b, c and m in clause 5.6.1.1, if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message or the MME needs to initiate an EPS bearer context status synchronization, the MME shall consider the service request procedure successfully completed when it sends the SERVICE ACCEPT message. If the EPS bearer context status IE is not included in the CONTROL PLANE SERVICE REQUEST message and the MME does not need to initiate an EPS bearer context status synchronization, the MME shall consider the service request procedure successfully completed in the following cases:\n-\twhen it successfully completes a NAS security mode control procedure;\n-\twhen it receives an indication from the lower layer that the user plane is setup, if radio bearer establishment is required;\n-\tupon receipt of the CONTROL PLANE SERVICE REQUEST message and completion of the EMM common procedures, if any, if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked and the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, radio bearer establishment is not required, and the MME has downlink user data or signalling not related to an EMM common procedure pending; and\n-\twith the transmission of a SERVICE ACCEPT message or with the decision to initiate release of the NAS signalling connection, if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked and the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, radio bearer establishment is not required, and the MME does not have any downlink user data or signalling pending.\nIf the MME considers the service request procedure successfully completed the MME shall:\n1)\tforward the contents of the ESM message container IE, if any, to the ESM layer; and\n2)\tforward the contents of the NAS message container IE, if any.\nFor cases a, b and c in clause 5.6.1.1, the UE shall treat the receipt of any of the following as successful completion of the procedure:\n-\ta SECURITY MODE COMMAND message;\n-\ta security protected EMM message different from a SERVICE REJECT message and not related to an EMM common procedure;\n-\ta security protected ESM message; and\n-\treceipt of the indication from the lower layers that the user plane radio bearers are set up.\nUpon successful completion of the procedure, the UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.\nIf the CONTROL PLANE SERVICE REQUEST message was sent with the \"active\" flag in the Control plane service type IE set to \"Radio bearer establishment requested\", the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established upon successful completion of the service request procedure, except for the case when the MUSIM UE in the CONTROL SERVICE REQUEST message sets the Request type to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE.\nNOTE 4:\tThe security protected EMM message can be e.g. a SERVICE ACCEPT message and the ESM message an ESM DATA TRANSPORT message.\nFor case m in clause 5.6.1.1, the UE shall treat the indication from the lower layers that the user plane radio bearers are set up as successful completion of the procedure. The UE shall treat the receipt of a SERVICE ACCEPT message as completion of the procedure without the establishment of the user plane radio bearers. For both cases, the UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.\nFor case b in clause 5.6.1.1, the UE shall also treat the indication from the lower layers that the RRC connection has been released as successful completion of the procedure. The UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.\nFor cases a, c and m in clause 5.6.1.1, the UE shall treat the indication from the lower layers that the RRC connection has been released as an abnormal case and shall follow the procedure described in clause 5.6.1.6, item b.\nFor cases p and q in clause 5.6.1.1, when the MUSIM UE in the CONTROL PLANE SERVICE REQUEST message sets the Request type to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE, the UE shall treat the receipt of SERVICE ACCEPT message as the successful completion of the procedure and the UE shall reset the service request attempt counter, stop timer T3417, enter the state EMM-REGISTERED and not deactivate EPS bearer contexts locally.\nFor case o in clause 5.6.1.1, the UE shall treat the receipt of SERVICE ACCEPT message as the successful completion of the procedure. The UE shall reset the service request attempt counter, stop timer T3417 and enter the state EMM-REGISTERED.\nFor cases a, b and c in clause 5.6.1.1,\n-\tif the MME needs to initiate an EPS bearer context status synchronization or to provide the UE with Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE or Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\", the UE can receive a SERVICE ACCEPT message even after it received a SECURITY MODE COMMAND message or an indication from the lower layers that the user plane radio bearers are set up and determined successful completion of the service request procedure. Upon receipt of the SECURITY MODE COMMAND message or an indication from the lower layers that the user plane radio bearers are set up, the UE shall start timer T3449. If the UE receives a security protected ESM message or a security protected EMM message not related to an EMM common procedure, the UE shall stop the timer T3449. If the UE receives a SERVICE ACCEPT message while the timer T3449 is running, the UE shall treat the SERVICE ACCEPT message and stop the timer T3449. If the UE is not in state EMM-SERVICE-REQUEST-INITIATED and timer T3449 is not running, the receipt of the SERVICE ACCEPT message is considered as protocol error and the UE shall return EMM STATUS message as specified in clause 7.4; otherwise the UE shall treat the SERVICE ACCEPT message; and\n-\tif the UE treats the SERVICE ACCEPT message and an EPS bearer context status IE is included in the message, the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the SERVICE ACCEPT message, and this default bearer is not associated with the last remaining PDN connection in the UE, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME.\nIf the T3448 value IE is present in the received SERVICE ACCEPT message, the UE shall:\n-\tstop timer T3448 if it is running;\n-\tconsider the transport of user data via the control plane as successful; and\n-\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the SERVICE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.\nIf the UE in EMM-IDLE mode initiated the service request procedure by sending a CONTROL PLANE SERVICE REQUEST message and the SERVICE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.\nIf the MME received the list of TAIs from the satellite E-UTRAN as described in 3GPP TS 23.401 [10], and determines that, by UE subscription and operator's preference, any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service, the MME shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE;\nb)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth,\nin the SERVICE ACCEPT message.\nNOTE 5:\t\"Forbidden tracking areas for roaming\" corresponds to cause values #13 and #15, and \"forbidden tracking areas for regional provision of service\" corresponds cause value #12.\nIf the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE in the SERVICE ACCEPT message and the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s) is not part of the list of \"forbidden tracking areas for roaming\", the UE shall store the TAI(s) included in the IE into the list of \"forbidden tracking areas for roaming\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s).\nIf the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE in the SERVICE ACCEPT message and the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s) is not part of the list of \"forbidden tracking areas for regional provision of service\", the UE shall store the TAI(s) included in the IE into the list of \"forbidden tracking areas for regional provision of service\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s).\nIf the service request cannot be accepted, the network shall return a SERVICE REJECT message to the UE including an appropriate EMM cause value.\nNOTE 1:\tA service request can only be rejected before the network has initiated any procedure which will be interpreted by the UE as successful completion of the service request procedure (see clauses 5.6.1.4.1 and 5.6.1.4.2) and which will trigger a transition from state EMM-SERVICE-REQUEST-INITIATED to EMM-REGISTERED on the UE side.\nBased on local policies or configurations in the MME, if the MME determines to change the periodic tracking area update timer (T3412), or if the MME determines to change the PSM usage or the value of timer T3324 in the UE for which PSM is allowed by the MME, the MME may return a SERVICE REJECT with the cause #10 \"implicitly detached\" to the UE.\nBased on operator policy, if the service request procedure is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 \"Redirection to 5GCN required\".\nNOTE 2:\tThe network can take into account the UE's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 \"Redirection to 5GCN required\".\nThe MME may be configured to perform MME-based access control for mobile originating CS fallback calls for a certain area A by rejecting related service request with EMM cause #39 \"CS service temporarily not available\".\nNOTE 3:\tDependent on implementation and operator configuration the area A can be configured with the granularity of an MME area, tracking area or eNodeB service area.\nThe MME may further be configured for a certain area A' to exempt service requests for mobile originating CS fallback calls from this MME-based access control, if:\n-\tthe service request is initiated in EMM-IDLE mode; and\n-\tthe UE indicated support of eNodeB-based access control for mobile originating CS fallback calls during an attach or tracking area updating procedure.\nNOTE 4:\tThe operator can use this second option when the eNodeBs in area A' are supporting the eNodeB-based access control for CS fallback calls. The area A' can be part of area A or the whole area A. It is the responsibility of the operator to coordinate the activation of MME-based access control and eNodeB-based access control for mobile originating CS fallback calls.\nWhen the EMM cause value is #39 \"CS service temporarily not available\", the MME shall include a value for timer T3442 in the SERVICE REJECT message. If a mobile terminating CS fallback call is aborted by the network during call establishment as specified in 3GPP TS 29.118 [], the MME shall include the EMM cause value #39 \"CS service temporarily not available\" and set the value of timer T3442 to zero.\nIf a service request from a UE with only LIPA PDN connections is not accepted due to the reasons specified in clause 5.6.1.4, depending on the service request received, the MME shall include the following EMM cause value in the SERVICE REJECT message:\n-\tif the service request received is not due to CS fallback or 1xCS fallback, EMM cause value #10 \"implicitly detached\"; or\n-\tif the service request received is due to CS fallback or 1xCS fallback, EMM cause value #40 \"no EPS bearer context activated\".\nIf a service request from a UE with only remaining SIPTO at the local network PDN connections is not accepted due to the reasons specified in clause 5.6.1.4, depending on the service request received, the MME shall:\n-\tif the service request received is due to CS fallback or 1xCS fallback, include the EMM cause value #40 \"no EPS bearer context activated\" in the SERVICE REJECT message; or\n-\tif the service request received is not due to CS fallback or 1xCS fallback, abort the service request procedure and send a DETACH REQUEST message to the UE with detach type \"re-attach required\" (see clause 5.5.2.3.1).\nIf the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIn NB-S1 mode, if the service request for mobile originated services is rejected due to operator determined barring (see 3GPP TS 29.272 [16C]), the network shall set the EMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIf the service request for mobile originated services is rejected due to service gap control as specified in clause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 \"congestion\" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.\nIf the MME sends a SERVICE REJECT message upon receipt of the CONTROL PLANE SERVICE REQUEST message piggybacked with the ESM DATA TRANSPORT message:\n-\tif the Release assistance indication IE is not set to \"No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected\" in the message;\n-\tif the UE has indicated a support for the control plane data back-off timer; and\n-\tif the MME decides to activate the congestion control for transport of user data via the control plane,\nthen the MME shall set the EMM cause value to #22 \"congestion\" and assign a value for control plane data back-off timer T3448.\nIn NB-S1 mode or WB-S1 mode via satellite E-UTRAN access, if the service request is from a UE via a satellite E-UTRA cell and the network using the User Location Information provided by the eNodeB (see 3GPP TS 36.413 [23]), is able to determine that the UE is in a location where the network is not allowed to operate, the network shall set the EMM cause value in the SERVICE REJECT message to #78 \"PLMN not allowed to operate at the present UE location\".\nOn receipt of the SERVICE REJECT message, if the UE is in state EMM-SERVICE-REQUEST-INITIATED and the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall reset the service request attempt counter, stop timer T3417, T3417ext or T3417ext-mt, if running.\nIf the SERVICE REJECT message with EMM cause #25 or #78 was received without integrity protection, then the UE shall discard the message.\nIf the MME received multiple TAIs from the satellite E-UTRAN as described in 3GPP TS 23.501 [10], and determines that, by UE subscription and operator's preferences, all of the received TAIs are forbidden for roaming or for regional provision of service, the MME shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE;\nb)\tthe Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth,\nin the SERVICE REJECT message.\nRegardless of the EMM cause value received in the SERVICE REJECT message via satellite E-UTRAN,\n-\tif the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for roaming\" IE in the SERVICE REJECT message, the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s), if not already stored, into the list of \"forbidden tracking areas for roaming\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s); and\n-\tif the UE receives the Forbidden TAI(s) for the list of \"forbidden tracking areas for regional provision of service\" IE in the SERVICE REJECT message, the UE shall store the TAI(s) included in the IE which are belonging to the serving PLMN or equivalent PLMN(s), if not already stored, into the list of \"forbidden tracking areas for regional provision of service\" and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s).\nFurthermore, the UE shall take the following actions depending on the received EMM cause value in the SERVICE REJECT message.\n#3\t(Illegal UE);\n#6\t(Illegal ME); or\n#8\t(EPS services and non-EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nNOTE 5:\tThe possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.\nFor the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n#7\t(EPS services not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#9\t(UE identity cannot be derived by the network);\nThe UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\nIf the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.\nNOTE 6:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\nIf the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#10\t(Implicitly detached);\nA UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.\nThe UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\nIf the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.\nNOTE 7:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM state as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#11\t(PLMN not allowed); or\n#35\t(Requested service option not authorized in this PLMN);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in clause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause value #11.\nFor the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\nFor the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n#12\t(Tracking area not allowed);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for regional provision of service\". If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for regional provision of service\" for non-integrity protected NAS reject message.\nIf the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). The UE shall enter the state EMM-REGISTERED.PLMN-SEARCH.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message.\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#15\t(No suitable cells in tracking area);\nThe UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\nThe UE shall store the current TAI in the list of \"forbidden tracking areas for roaming\" and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"forbidden tracking areas for roaming\" for non-integrity protected NAS reject message.\nIf the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nIf the service request was not initiated for mobile originated CS fallback, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#18\t(CS domain not available);\nIf the request was related to CS fallback, the UE shall send an indication to the MM sublayer and shall not attempt CS fallback until combined tracking area updating procedure has been successfully completed. The UE shall enter the state EMM-REGISTERED.NORMAL-SERVICE.\nThe UE shall set the update status to U2 NOT UPDATED.\nIf the UE is in CS/PS mode 1 of operation with \"IMS voice not available\" and the request was related to CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see clause 4.5).\nIf the UE is in CS/PS mode 1 or CS/PS mode 2 mode of operation, the UE may provide a notification to the user or the upper layers that the CS domain is not available.\nIf the request was related to 1xCS fallback, the UE shall cancel upper layer actions related to 1xCS fallback and enter the state EMM-REGISTERED.NORMAL-SERVICE.\n#22\t(Congestion);\nIf the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause 5.6.1.6.\nIf the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall abort the service request procedure and enter state EMM-REGISTERED, and stop timer T3417, T3417ext or T3417ext-mt if still running.\nThe UE shall stop timer T3346 if it is running.\nIf the SERVICE REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\nIf the SERVICE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nNOTE 8:\tIf the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.\nIf the service request was initiated for CS fallback for emergency call and a CS fallback cancellation request was not received, the UE may attempt to select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.\nIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf the service request was initiated for 1xCS fallback for emergency call, the UE may select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf the service request was initiated in EMM-CONNECTED mode with Control plane service type \"mobile originating request\" and with the \"active\" flag set to 1, the UE shall abort the procedure.\nIf the service request procedure was initiated for an MO MMTEL voice call or an MO MMTEL video call is started, a notification that the service request was not accepted due to congestion shall be provided to the upper layers.\nNOTE 9:\tThis can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 [13E]).\nFor all other cases the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.\nIf the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:\n-\tstop timer T3448 if it is running;\n-\tconsider the transport of user data via the control plane as unsuccessful; and\n-\tstart timer T3448:\n-\twith the value provided in the T3448 value IE if the SERVICE REJECT message is integrity protected; or\n-\twith a random value from the default range specified in table 10.2.1 if the SERVICE REJECT message is not integrity protected.\nIf the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and-\tstop timer T3448 if it is running; and\n-\tconsider the transport of user data via the control plane as unsuccessful.\nIf the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is not present in the SERVICE REJECT message, it shall be considered as an abnormal case and the behaviour of UE for this case is specified in clause 5.6.1.6.\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters, 5GMM state and 5GS update status as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#25\t(Not authorized for this CSG);\nEMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause 5.6.1.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause 5.1.3.3). The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\nIf the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.\nIf the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] clause 3.1A.\nThe UE shall search for a suitable cell according to 3GPP TS 36.304 [21].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-REGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED.\n#31\t(Redirection to 5GCN required);\nEMM cause #31 received by a UE that has not indicated support for CIoT optimizations is considered as an abnormal case and the behaviour of the UE is specified in clause 5.6.1.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3). The UE shall reset the service request attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.\nThe UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause 4.5).\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters, 5GMM state, and 5GS update status as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#36\t(IAB-node operation not authorized);\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.\nThe UE shall store the PLMN identity in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.\nThe UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\n#39\t(CS service temporarily not available);\nIf the T3442 value received in the SERVICE REJECT message is not zero, the UE shall start timer T3442 and enter the state EMM-REGISTERED.NORMAL-SERVICE. If the T3442 value received in the SERVICE REJECT message is zero, the UE shall not start timer T3442.\nThe UE shall not try to send an EXTENDED SERVICE REQUEST message for mobile originating CS fallback to the network, except for mobile originating CS fallback for emergency calls, until timer T3442 expires or the UE sends a TRACKING AREA UPDATE REQUEST message.\n#40\t(No EPS bearer context activated);\nThe UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.\nIf the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.\nNOTE 10:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause value #10 \"Implicitly detached\".\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network.\nA UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED.\n#42\t(Severe network failure);\nThe UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, MM update status to U2 NOT UPDATED and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number, LAI, TMSI and ciphering key sequence number.\nIf the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n#78\t(PLMN not allowed to operate at the present UE location).\nThis cause value received from a non-satellite E-UTRA cell is considered as an abnormal case and the behaviour of the UE is specified in clause 5.5.6.1.6.\nThe UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the registration attempt counter. The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of \"PLMNs not allowed to operate at the present UE location\", start a corresponding timer instance (see subclause 4.11.2), enter state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP TS 23.122 [6].\nIf the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters, 5GMM state, and 5GS update status as specified in 3GPP TS 24.501 [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.\nOther values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in clause 5.6.1.6.\nIf the service request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the UE shall perform the procedures as described in clause 5.6.1.5. If the service request for initiating a PDN connection for emergency bearer services fails due to receiving the AUTHENTICATION REJECT message, the UE shall perform the procedures as described in clause 5.4.2.5. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE 1:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nb)\tdetach locally, if not detached already, attempt EPS attach for emergency bearer services.\nIf the service request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in clause 5.6.1.6, the UE shall perform the actions as described in clause 5.6.1.6 and inform the upper layers of the failure to access the network.\nNOTE 2:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nIf the service request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c), e), h) as well as l) when the \"Extended wait time\" is ignored, and la) when the \"Extended wait time CP data\" is ignored in clause .6, the UE shall perform the procedures as described in clause 5.6.1.6. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE 3:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nb)\tdetach locally, if not detached already, attempt EPS attach for emergency bearer services.\nIf the service request for UE attached for access to RLOS cannot be accepted by the network, the UE shall perform the procedures as described in clause 5.6.1.5.\nThen if:\na)\tthe UE is in the same selected PLMN where the last service request was attempted and rejected;\nb)\tthe service request procedure was rejected with an EMM cause value other than #9, #10 and #40; and\nc)\ttimer T3346 is not running,\nthe UE shall:\na)\tdetach locally, if not detached already, and perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.\nIf the service request for UE attached for access to RLOS fails due to abnormal cases a), b), c) or e) in clause 5.6.1.6, the UE shall perform the procedures as described in clause 5.6.1.6. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:\na)\tdetach locally, if not detached already, and perform a PLMN selection according to 3GPP TS 23.122 [6] to attempt EPS attach for access to RLOS via another PLMN.\nThe following abnormal cases can be identified:\na)\tAccess barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without \"Extended wait time\" received from lower layers\nIn WB-S1 mode, if the service request procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.\nIn NB-S1 mode, if the service request procedure is started in response to a paging request from the network, access barring is not applicable.\nIf the trigger for the service request procedure is the response to a paging request from the network and the NAS signalling connection establishment is rejected by the network, the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. During an implementation dependent time period, the service request procedure may be started when access for \"terminating calls\" is granted or upon a cell change.\nIf the service request was initiated for CS fallback and the access is barred for \"mobile originating CS fallback\" (see 3GPP TS 36.331 [22]) and the lower layer indicates \"the barring is due to CSFB specific access barring information\", the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started if it is still necessary, i.e. when access for \"mobile originating CS fallback\" is granted or because of a cell change.\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received and the access is barred for \"mobile originating CS fallback\" (see 3GPP TS 36.331 [22]) and the lower layer does not indicate \"the barring is due to CSFB specific access barring information\", the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nIf the service request was initiated for 1xCS fallback and the access is barred for \"originating calls\" (see 3GPP TS 36.331 [22]), the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf the lower layer indicated the access was barred because of access class barring for \"originating calls\" (see 3GPP TS 36.331 [22]) and if:\n-\tthe service request is initiated due to a request from upper layers for user plane radio resources, and the MO MMTEL voice call is started, the MO MMTEL video call is started or the MO SMSoIP is started;\n-\tthe service request is initiated due to a mobile originated SMS over NAS or SMS over S102; or\n-\tthe service request is initiated due to a request from upper layers for user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.\nthen the service request procedure shall be started. The call type used shall be per annex D of this document.\nNOTE 1:\tIf more than one of MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions are satisfied, it is left to UE implementation to determine the call type based on annex D of this document.\nIf access is barred for a certain ACDC category (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a higher ACDC category and the UE supports ACDC, then the service request procedure shall be started.\nIf an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a certain ACDC category and the UE supports ACDC, then the service request procedure shall be started.\nOtherwise:\n-\tIn WB-S1 mode, if access is barred for \"originating calls\" (see 3GPP TS 36.331 [22]), the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started if it is still necessary when access for \"originating calls\" is granted or because of a cell change.\n-\tIn NB-S1 mode, if access is barred for \"originating calls\" (see 3GPP TS 36.331 [22]), the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. Further UE behaviour is implementation specific, e.g. the service request procedure is started again after an implementation dependent time; or\nIn NB-S1 mode, if access is barred for \"originating calls\" (see 3GPP TS 36.331 [22]), and a request for an exceptional event is received from the upper layers, then the service request procedure shall be started.\nNOTE 2:\tIn NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 [22]).\nb)\tLower layer failure or release of the NAS signalling connection without \"Extended wait time\", without \"Extended wait time CP data\", and without redirection indication received from lower layers before the service request procedure is completed (see clause 5.6.1.4) or before SERVICE REJECT message is received\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was received, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\nIf the service request was initiated for 1xCS fallback, the UE shall either:\n-\tattempt to select cdma2000® 1x radio access technology and proceed with appropriate cdma2000® 1x CS procedures. If the UE fails to select cdma2000® 1x radio access technology, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE; or\n-\tset the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE, and perform cell selection according to 3GPP TS 36.304 [21].\nIf the service request was not initiated for CS fallback or 1xCS fallback, the UE shall enter state EMM-REGISTERED.\nThe UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure. For case o) in clause 5.6.1.1 the UE may retry the service request procedure a certain number of times (maximum re-attempts 5).\nc)\tT3417 expired\nThe UE shall enter the state EMM-REGISTERED.\nIf the UE triggered the service request procedure in EMM-IDLE mode in order to obtain packet services, then the EMM sublayer shall increment the service request attempt counter, abort the procedure and release locally any resources allocated for the service request procedure. The service request counter shall not be incremented, if:\n-\tthe service request procedure is initiated to establish a PDN connection for emergency bearer services;\n-\tthe UE has a PDN connection for emergency bearer services established;\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe service request is initiated in response to paging from the network; or\n-\tthe UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).\nIf the service request attempt counter is greater than or equal to 5, the UE shall start timer T3325 (see 3GPP TS 24.008 [13]). Additionally if the service request was initiated for an \"originating MMTEL voice\" call type or an \"originating MMTEL video\" call type, a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers.\nNOTE 3:\tThis can result in the upper layers requesting establishment of a CS voice call (if not already attempted in the CS domain), or other implementation specific mechanisms (see 3GPP TS 24.173 [13E]).\nThe UE shall not attempt service request until expiry of timer T3325 unless:\n-\tthe service request is initiated in response to paging from the network;\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe service request is initiated to establish a PDN connection for emergency bearer services;\n-\tthe UE has a PDN connection for emergency bearer services established;\n-\tthe UE is registered in a new PLMN; or\n-\tthe UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).\nIf the service request for \"originating MMTEL voice\" call type was triggered while T3325 is running, a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers.\nNOTE 4:\tThis can result in the upper layers requesting establishment of a CS voice call (if not already attempted in the CS domain), or other implementation specific mechanisms (see 3GPP TS 24.173 [13E]).\nNOTE 5:\tThe NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in clause 5.4.2.7.\nIf the UE triggered the service request procedure in order to obtain services other than packet services from EMM-IDLE mode, then the EMM sublayer shall abort the procedure and release locally any resources allocated for the service request procedure.\nIf the UE triggered the service request procedure in EMM-CONNECTED mode, the EMM sublayer shall abort the procedure and consider the service request procedure with \"active\" flag set or the 1xCS fallback procedure as failed. The UE shall stay in EMM-CONNECTED mode.\nd)\tT3417ext or T3417ext-mt expired\nIf a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\nIf a CS fallback cancellation request was received the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\ne)\tSERVICE REJECT received, other EMM cause values than those treated in clause 5.6.1.5, and cases of EMM cause values #22, #25, #31 and #78 if considered as abnormal cases according to clause 5.6.1.5.\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was received, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\nIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, then upon entering EMM-IDLE mode the UE shall perform tracking area updating procedure.\nIf the service request was not initiated for CS fallback or 1xCS fallback, the UE shall enter state EMM-REGISTERED.\nThe UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.\nf)\tTracking area updating procedure is triggered\nThe UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt if running and perform the tracking area updating procedure. The \"active\" flag or \"signalling active\" flag shall be set in the TRACKING AREA UPDATE REQUEST message as specified in clause 5.5.3.2.2. If the service request was initiated for CS fallback or 1xCS fallback, and the CS fallback cancellation request was not received, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure. If the TRACKING AREA UPDATE ACCEPT message includes a UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall not initiate a new tracking area update procedure, but shall proceed with sending the EXTENDED SERVICE REQUEST message by using the existing NAS signalling connection after the completion of the tracking area updating procedure.\ng)\tSwitch off\nIf the UE is in state EMM-SERVICE-REQUEST-INITIATED at switch off, the detach procedure shall be performed.\nh)\tDetach procedure collision\nEPS detach containing detach type \"re-attach required\":\nIf the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:\n-\tIf the service request was initiated for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM, CC and GMM specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer;\n-\tIf the service request was initiated for 1xCS fallback, the UE shall attempt to select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures; or\n-\tIf the service request was not initiated for CS fallback or 1xCS fallback, the detach procedure shall be progressed and the service request procedure shall be aborted.\nEPS detach containing detach type \"re-attach not required\":\nIf the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:\n-\tIf the DETACH REQUEST message contains an EMM cause other than #2 \"IMSI unknown in HSS\" or no EMM cause IE, the detach procedure shall be progressed and the service request procedure shall be aborted. Additionally, if the service request was initiated for CS fallback or 1xCS fallback, but not for CS fallback for emergency call or 1xCS fallback for emergency call, the EMM sublayer shall indicate to the MM sublayer or the cdma2000® upper layers that the CS fallback or 1xCS fallback procedure has failed; or\nIf the DETACH REQUEST message contains EMM cause #2 \"IMSI unknown in HSS\", the UE will follow the procedure as described below for the detach type \"IMSI detach\".\nEPS detach containing detach type \"IMSI detach\":\nIf the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:\n-\tif the service request was initiated for SMS over NAS or CS fallback, but not for CS fallback for emergency call, the UE shall abort the service request procedure and progress the detach procedure; or\n-\totherwise the UE shall progress both procedures.\ni)\tTransmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication with TAI change from lower layers\nIf the current TAI is not in the TAI list, the service request procedure shall be aborted to perform the tracking area updating procedure. The \"active\" flag or \"signalling active\" flag shall be set in the TRACKING AREA UPDATE REQUEST message as specified in clause 5.5.3.2.2. If the service request was initiated for CS fallback or 1xCS fallback, and the CS fallback cancellation request was not received, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure.\nIf the current TAI is still part of the TAI list, the UE shall restart the service request procedure unless the service request procedure is initiated for case p) or q) in clause 5.6.1.1. For case p) and q) in clause 5.6.1.1 the UE shall abort the service request procedure, enter state EMM-REGISTERED, stop timer T3417, and locally release the NAS signalling connection and any resources allocated for the service request procedure.\nj)\tTransmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication without TAI change from lower layers\nThe UE shall restart the service request procedure unless the service request procedure is initiated for case p) or q) in clause 5.6.1.1. For case p) and q) in clause 5.6.1.1 the UE shall abort the service request procedure, enter state EMM-REGISTERED, stop timer T3417, and locally release the NAS signalling connection and any resources allocated for the service request procedure.\nk)\tDefault or dedicated bearer set up failure\nIf the lower layers indicate a failure to set up a radio bearer, the UE shall locally deactivate the EPS bearer as described in clause 6.4.4.6.\nl)\t\"Extended wait time\" from the lower layers\nThe UE shall abort the service request procedure, enter state EMM-REGISTERED, and stop timer T3417, T3417ext or T3417ext-mt if still running.\nIf the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message contained the low priority indicator set to \"MS is configured for NAS signalling low priority\", the UE shall start timer T3346 with the \"Extended wait time\" value.\nIf the SERVICE REQUEST message was sent by a UE configured for NAS signalling low priority, the UE shall start timer T3346 with the \"Extended wait time\" value.\nIf the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message did not contain the low priority indicator set to \"MS is configured for NAS signalling low priority\" or if the SERVICE REQUEST message was sent by a UE not configured for NAS signalling low priority, the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11 – 15 in selected PLMN, then the UE shall start timer T3346 with the \"Extended wait time\" value.\nIn other cases the UE shall ignore the \"Extended wait time\".\nThe UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.\nIf the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nNOTE 5:\tIf the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.\nIf the service request was initiated for CS fallback for emergency call and a CS fallback cancellation request was not received, the UE may attempt to select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.\nIf the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf the service request was initiated for 1xCS fallback for emergency call, the UE may select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.\nIf the service request was initiated due to a request from the SMS entity to send an SMS and timer T3246 is not running, the UE, if operating in CS/PS mode 1 of operation, may select GERAN or UTRAN radio access technology. It then proceeds with the appropriate MM procedure.\nNOTE 6:\tIf the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.\nla)\t\"Extended wait time CP data\" from the lower layers\nThe UE shall abort the service request procedure for transfer of user data via the control plane, enter state EMM-REGISTERED, and stop timer T3417 if still running.\nIf the UE is operating in NB-S1 mode and supports the timer T3448, the UE shall start the timer T3448 with the \"Extended wait time CP data\" value. If the UE is operating in NB-S1 mode and does not support the timer T3448, the UE shall start the timer T3346 with the \"Extended wait time CP data\" value.\nIn other cases the UE shall ignore the \"Extended wait time CP data\".\nThe UE stays in the current serving cell and applies normal cell reselection process. The service request procedure for transfer of user data via the control plane is started, if still necessary, when the timer T3448 expires or is stopped.\nm)\tTimer T3346 is running\nThe UE shall not start the service request procedure unless:\n-\tthe UE receives a paging;\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services;\n-\tthe UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call;\n-\tthe UE has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST) which contained the low priority indicator set to \"MS is configured for NAS signalling low priority\";\n-\tthe UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and:\n-\tthe UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the\tNAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]); and\n-\ttimer T3346 was not started when NAS signalling connection was established with RRC establishment cause set to \"MO exception data\"; or\n-\tthe MUSIM UE is in EMM-CONNECTED mode and requests the network to release the NAS signalling connection (see case p in clause 5.6.1.1).\nIf the UE is in EMM-IDLE mode, the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.\nUpon upper layer's request for a mobile originated CS fallback which is not for emergency call, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.\nNOTE 7:\tIf the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.\nUpon upper layer's request for a CS fallback for emergency call, the UE may select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.\nUpon a request from the SMS entity to send an SMS and timer T3246 is not running, the UE, if operating in CS/PS mode 1 of operation, may select GERAN or UTRAN radio access technology. It then proceeds with the appropriate MM procedure.\nNOTE 8:\tIf the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.\nUpon upper layer's request for a mobile originated 1x CS fallback which is not for emergency call, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS call procedures.\nUpon upper layer's request for a 1xCS fallback for emergency call, the UE may select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS call procedures.\nIf the service request procedure was triggered for an MO MMTEL voice call is started, a notification that the service request procedure was not initiated due to congestion shall be provided to the upper layers.\nNOTE 9:\tThis can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP TS 24.173 [13E]).\nn)\tFailure to find a suitable GERAN or UTRAN cell, after release of the NAS signalling connection without \"Extended wait time\" and with redirection indication received from lower layers when the service request was initiated for CS fallback\nThe EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.\nThe UE shall abort the service request procedure, stop timer T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.\no)\tTimer T3448 is running\nThe UE in EMM-IDLE mode shall not initiate the service request procedure for transport of user data via the control plane unless:\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE which is only using EPS services with control plane CIoT EPS optimization received a paging; or\n-\tthe UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).\nThe UE stays in the current serving cell and applies the normal cell reselection process.\np)\tTimer T3447 is running\nThe UE shall not start any service request procedure unless:\n-\tthe UE receives a paging;\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services; or\n-\tthe MUSIM UE is in EMM-CONNECTED mode and requests the network to release the NAS signalling connection (see case p in clause 5.6.1.1).\nThe UE stays in the current serving cell and applies the normal cell reselection process. The service request procedure is started, if still necessary, when timer T3447 expires.\nThe following abnormal cases can be identified:\na)\tLower layer failure\nIf a lower layer failure occurs before a SERVICE REJECT message has been sent to the UE or the service request procedure has been completed by the network, the network enters/stays in EMM-IDLE.\nb)\tProtocol error\nIf the SERVICE REQUEST, EXTENDED SERVICE REQUEST or the CONTROL PLANE SERVICE REQUEST message is received with a protocol error, the network shall return a SERVICE REJECT message with one of the following EMM cause values:\n#96:\tinvalid mandatory information;\n#99:\tinformation element non-existent or not implemented;\n#100:\tconditional IE error; or\n#111:\tprotocol error, unspecified.\nThe network stays in the current EMM mode.\nc)\tMore than one SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST received before the procedure has been completed (i.e., before SERVICE REJECT message has been sent or service request procedure has been completed)\n-\tIf one or more of the information elements in the SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST for packet services differs from the ones received within the previous SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message for packet services, the previously initiated service request procedure shall be aborted and the new service request procedure shall be progressed;\nNOTE:\tThe network actions are implementation dependent for the case that more than one EXTENDED SERVICE REQUEST messages for CS fallback or 1xCS fallback are received and their information elements differ.\n-\tIf the information elements do not differ, then the network shall continue with the previous service request procedure and shall not treat any further this SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message.\nd)\tATTACH REQUEST received before a SERVICE REJECT message has been sent or the service request procedure has been completed\nIf an ATTACH REQUEST message is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. The network may e.g. after a successful EMM authentication procedure execution, abort the service request procedure, delete the EMM context, EPS bearer contexts, if any, and progress the new ATTACH REQUEST.\ne)\tTRACKING AREA UPDATE REQUEST message received before the service request procedure has been completed or a SERVICE REJECT message has been sent\nIf a TRACKING AREA UPDATE REQUEST message is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. The network may e.g. after a successful EMM authentication procedure execution, abort the service request procedure and progress the tracking area updating procedure.\nf)\tDefault or dedicated bearer set up failure\nIf the lower layers indicate a failure to set up a radio or S1 bearer, the MME shall locally deactivate the EPS bearer as described in clause 6.4.4.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.2\tPaging procedure",
                            "text_content": "The paging procedure is used by the network to request the establishment or resumption of a NAS signalling connection to the UE. Another purpose of the paging procedure is to prompt the UE to reattach if necessary as a result of a network failure. If the UE is not attached when it receives a paging for EPS services, the UE shall ignore the paging.\nAdditionally, the network can use the paging procedure to initiate the mobile terminating CS fallback procedure or SMS or user data transfer via the MME.\n5.6.2.2.1.1\tGeneral\nThe network shall initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to \"PS\" when:\n-\tNAS signalling messages, cdma2000® signalling messages or user data is pending to be sent to the UE;\n-\tno NAS signalling connection exists (see example in figure 5.6.2.2.1.1); and\n-\tthere is no paging restriction applied in the network for that paging.\nIf the network has downlink user data pending for a UE, the MME has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction is set to:\na)\t\"All paging is restricted\", the network should not initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to \"PS\" for the UE;\nb)\t\"All paging is restricted except for voice service\", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to \"PS\" for the UE only when:\n1)\tthe pending downlink user data for the UE is considered as voice service related by the network;\nc)\t\"All paging is restricted except for specified PDN connection(s)\", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to \"PS\" for the UE only when:\n1)\tfor PDN connection(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending; or\nd)\t\"All paging is restricted except for voice service and specified PDN connection(s)\", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to \"PS\" for the UE only when:\n1)\tthe pending downlink user data for the UE is considered as voice service related by the network; or\n2)\tfor PDN connection(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending.\nIf the network has downlink signalling pending for a UE and the MME has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction is set to:\na)\t\"All paging is restricted\", the network should not initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to \"PS\" for the UE;\nb)\t\"All paging is restricted except for voice service\", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to \"PS\" for the UE only when:\n1)\tthe pending downlink signalling for the UE is EMM signalling or ESM signalling of the PDN connection of voice service;\nc)\t\"All paging is restricted except for specified PDN connection(s)\", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to \"PS\" for the UE only when:\n1)\tthe pending downlink signalling for the UE is EMM signalling; or\n2)\tfor PDN connection(s) that paging is not restricted based on the stored paging restriction, the network has downlink ESM signalling pending; or\nd)\t\"All paging is restricted except for voice service and specified PDN connection(s)\", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to \"PS\" for the UE only when:\n1)\tthe pending downlink signalling for the UE is EMM signalling or ESM signalling of the PDN connection of voice service; or\n2)\tfor PDN connection(s) that paging is not restricted based on the stored paging restriction, the network has downlink ESM signalling pending.\nNOTE 1:\tIf the network pages the UE due to downlink signalling pending, the network initiates the release of the NAS signalling connection after network-requested procedure is completed.\nFor the UE using eDRX, the network initiates the paging procedure when NAS signalling messages, cdma2000® signalling messages or user data is pending to be sent to the UE within the paging time window. If NAS signalling messages, cdma2000® signalling messages or user data is pending to be sent to the UE outside the paging time window and the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), the network initiates the paging procedure at T time ahead of the beginning of the next paging time window.\nNOTE 2:\tT time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the CN and the UE into account when choosing T time.\nThe figure depicts a paging procedure using S-TMSI, which is a method used in telecommunication networks to manage the flow of data packets. The figure shows the steps involved in the paging process, including the use of S-TMSI to identify the paging request, the transmission of the paging request, and the response from the paging server. The figure provides a clear and concise visual representation of the paging procedure, making it easy to understand and follow.\nFigure 5.6.2.2.1.1: Paging procedure using S-TMSI\nTo initiate the procedure the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]) and shall start the timer:\n-\tT3415 for this paging procedure, if the network accepted to use eDRX for the UE and the UE does not have a PDN connection for emergency bearer services.\n-\tOtherwise, T3413 for this paging procedure.\nIf the network detects that the pending user data to be sent to the UE is related to the voice service as specified in 3GPP TS 23.401 [7] and the network decides to initiate the paging procedure based on the stored paging restriction information, if any, the EMM entity in the network should request the lower layer to include the Voice Service Indication in the Paging message when the UE and the network support the paging indication for voice services.\nIf the network starts timer T3415, the network shall set timer T3415 to a value smaller than the value of timer T3-RESPONSE (see 3GPP TS 29.274 [16D] for further details on timer T3-RESPONSE).\nThe EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. If there is a PDN connection for emergency bearer services established, the EMM entity in the network shall not provide the list of CSG IDs to the lower layer.\nIf the negotiated UE paging probability information is available in the EMM context of the UE, the EMM entity shall provide the lower layer with the negotiated UE paging probability information (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]).\nUpon reception of a paging indication, if control plane CIoT EPS optimization is not used by the UE, the UE shall stop the timer T3346, if running, and shall initiate:\n-\ta service request procedure to respond to the paging (see 3GPP TS 23.401 [10] and 3GPP TS 36.413 [23]); or\n-\ta tracking area updating procedure as specified in clauses 5.5.3.2.2 and 5.5.3.3.2.\nand additionally if the UE is in the EMM-IDLE mode with suspend indication, resume the suspended NAS signalling connection to the MME as specified in clause 5.3.1.3.\nUpon reception of a paging indication, if control plane CIoT EPS optimization is used by the UE, the UE shall stop the timer T3346, if running, and shall additionally:\n-\tinitiate a service request procedure as specified in clause 5.6.1.2.2 if the UE is in the EMM-IDLE mode without suspend indication;\n-\tinitiate a tracking area updating procedure as specified in clauses 5.5.3.2.2; or\n-\tproceed the behaviour as specified in clause 5.3.1.3 if the UE is in the EMM-IDLE mode with suspend indication.\nNOTE 3:\tIf the UE is in the EMM-IDLE mode without suspend indication and has an uplink user data to be sent to the network using control plane CIoT EPS optimization when receiving the paging indication, the UE can piggyback the uplink user data during the service request procedure initiated to respond to the paging, as specified in clause 5.6.1.2.2.\nUpon reception of a paging indication, if the network supports the reject paging request and the MUSIM UE decides not to accept the paging, the UE may initiate a service request procedure to reject the paging as specified in clause 5.6.1.1.\nNOTE 4:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\nIf the paging for EPS services was received during an ongoing UE-initiated EMM specific procedure or service request procedure, then the UE shall ignore the paging. The network shall proceed with the EMM specific procedure or the service request procedure, and stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415). If the network receives an ATTACH REQUEST message when the paging procedure is ongoing, it should be considered as an abnormal case, and the behaviour of the network for this case is specified in clause 5.6.2.2.1.2.\nThe network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415) when an integrity-protected response is received from the UE and successfully integrity checked by the network or when the EMM entity in the MME receives an indication from the lower layer that it has received the S1-AP UE context resume request message as specified in 3GPP TS 36.413 [23]. If the response received is not integrity protected, or the integrity check is unsuccessful, the timer for the paging procedure (i.e. either timer T3413 or timer T3415) shall be kept running unless:\n-\tthe UE has a PDN connection for emergency bearer services; or\n-\tthe response received is a TRACKING AREA UPDATE REQUEST message and the security mode control procedure or authentication procedure performed during tracking area updating procedure has completed successfully.\nUpon expiry of timer T3413, the network may reinitiate paging.\nIf the network, while waiting for a response to the paging sent without paging priority, receives downlink signalling or downlink data associated with priority EPS bearers, the network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415), and then initiate the paging procedure with paging priority.\nUpon expiry of timer T3415, the network shall abort the paging procedure and shall proceed as specified in 3GPP TS 23.401 [10].\n5.6.2.2.1.2\tAbnormal cases on the network side\nThe following abnormal case can be identified:\na)\tATTACH REQUEST message received when paging procedure is ongoing.\nIf an integrity-protected ATTACH REQUEST message is received from the UE and successfully integrity checked by the network, the network shall abort the paging procedure. If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, the paging procedure shall be progressed. The paging procedure shall be aborted when the EPS authentication procedure performed during attach procedure is completed successfully.\n5.6.2.2.1.3\tAbnormal cases in the UE\nThe following abnormal case can be identified:\na)\tThe paging indication received for a UE that is attached for access to RLOS\nA UE attached for access to RLOS shall ignore the paging indication from the network.\nb)\tThe paging indication received when UE-initiated EMM specific procedure or service request procedure is ongoing.\nThe UE shall ignore the paging indication from the network.\nPaging for EPS services using IMSI is an abnormal procedure used for error recovery in the network.\nThe network may initiate paging for EPS services using IMSI with CN domain indicator set to \"PS\" if the S-TMSI is not available due to a network failure (see example in figure 5.6.2.2.2.1).\nThe figure depicts a paging procedure using IMSI, illustrating the steps involved in managing a mobile user's data usage. The IMSI is a unique identifier assigned to each mobile device, which is used to identify the user and their data usage. The figure shows the steps from the user's perspective, including selecting the desired paging method, entering the IMSI, and confirming the selection. The figure also includes a visual representation of the paging process, such as the user's data usage graph and the paging status bar.\nFigure 5.6.2.2.2.1: Paging procedure using IMSI\nIn S1 mode, to initiate the procedure the EMM entity in the network requests the lower layer to start paging. If the TAI list is not available due to a network failure, the network may perform the paging within all tracking areas served by the MME (see 3GPP TS 36.331 [22] and 3GPP TS 36.413 [23]).\nWhen a UE receives a paging for EPS services using IMSI from the network before a UE initiated EMM specific procedure has been completed, then the UE shall abort the EMM specific procedure and proceed according to the description in this clause.\nUpon reception of a paging for EPS services using IMSI, the UE shall stop timer T3346, if it is running, locally deactivate any EPS bearer context(s), if any, and locally detach from EPS. Additionally the UE shall delete the following parameters: last visited registered TAI, TAI list, GUTI and KSIASME. The UE shall set the EPS update status to EU2 NOT UPDATED and change the state to EMM-DEREGISTERED. The UE shall stop all timers T3396 that are running.\nIf A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when a paging for GPRS services using IMSI is received.\nAfter performing the local detach, the UE shall then perform an attach procedure as described in clause 5.5.1.2. If the UE is operating in CS/PS mode 1 or CS/PS mode 2 of operation, then the UE shall perform a combined attach procedure as described in clause 5.5.1.3. For this attach procedure and its reattempts, if any, the MS shall ignore the contents of the list of \"forbidden tracking areas for roaming\", as well as the list of \"forbidden tracking areas for regional provision of service\".\nNOTE 1:\tIn some cases, user interaction can be required, thus the UE cannot activate the dedicated bearer context(s), if any, automatically.\nNOTE 2:\tThe UE does not respond to the paging except with the ATTACH REQUEST message, hence timers T3413 and T3415 in the network are not used when paging with IMSI.\nThe network may initiate the paging procedure for CS fallback when the UE is IMSI attached for non-EPS services (see example in figure 5.6.2.3.1.1).\nThe network should not initiate the paging procedure for CS fallback for a UE if the MME has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction preferences is set to:\na)\t\"All paging is restricted\"; or\nb)\t\"All paging is restricted except for specified PDN connection(s)\".\nThe figure depicts a paging procedure for CS fallback to A/Gb or Iu mode in a 5G network. It illustrates the steps taken to ensure that the network can continue to function even if a specific carrier fails. The figure shows the steps for both A/Gb and Iu mode, highlighting the importance of redundancy and failover mechanisms in ensuring network reliability.\nFigure 5.6.2.3.1.1: Paging procedure for CS fallback to A/Gb or Iu mode\nTo initiate the procedure when no NAS signalling connection exists and no paging restriction applied in the network for that paging, the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]). The EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. If there is a PDN connection for emergency bearer services established, the EMM entity in the network shall not provide the list of CSG IDs to the lower layer. The paging message includes a UE Paging Identity set to either the UE's S-TMSI or the UE's IMSI, and a CN domain indicator set to \"CS\" in order to indicate that this is paging for CS fallback.\nNOTE:\tThe timers T3413 and T3415 are not started in the network when the paging procedure is initiated for CS fallback.\nTo notify the UE about an incoming mobile terminating CS service excluding SMS over SGs when a NAS signalling connection exists, the EMM entity in the network shall send a CS SERVICE NOTIFICATION message. This message may also include CS service related parameters (e.g. Calling Line Identification, SS or LCS related parameters).\nUpon reception of a paging indication, a UE that is IMSI attached for non-EPS services shall initiate a service request procedure or combined tracking area updating procedure as specified in clause 5.5.3.3.2. If the paging is received in EMM-IDLE mode, the UE shall respond immediately.\nUpon reception of a paging indication, if the network supports the reject paging request feature and the MUSIM UE decides not to accept the paging the UE may initiate a service request procedure to reject the paging as specified in clause 5.6.1.1.\nIf the paging is received as a CS SERVICE NOTIFICATION message in EMM-CONNECTED mode, the UE may request upper layers input i.e. to accept or reject CS fallback before responding with an EXTENDED SERVICE REQUEST. The response is indicated in the CSFB response information element in the EXTENDED SERVICE REQUEST message in both EMM-IDLE and EMM-CONNECTED modes.\nA UE that requested \"SMS only\" in the combined attach procedure or combined tracking area updating procedure may ignore the CS SERVICE NOTIFICATION message or the paging indication with the CN domain indicator set to \"CS\".\nThe following abnormal case can be identified:\na)\tVoid\nb)\tATTACH REQUEST message received when paging procedure is ongoing.\nIf an integrity-protected ATTACH REQUEST message is received from the UE and successfully integrity checked by the network, the network shall abort the paging procedure. If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, the paging procedure shall be progressed. The paging procedure shall be aborted when the EPS authentication procedure performed during attach procedure is completed successfully.\nc)\tTRACKING AREA UPDATE REQUEST message received in response to a CS SERVICE NOTIFICATION message\nIf the network receives a TRACKING AREA UPDATE REQUEST message in response to a CS SERVICE NOTIFICATION message, the network shall progress the tracking area updating procedure.\nNOTE:\tAfter completion of the tracking area updating procedure the UE can accept or reject the CS fallback by sending an EXTENDED SERVICE REQUEST message.\nd)\tDETACH REQUEST message received in response to a CS SERVICE NOTIFICATION message\nIf the network receives a DETACH REQUEST message with detach type \"IMSI detach\" or \"combined EPS/IMSI detach\" in response to a CS SERVICE NOTIFICATION message, the network shall progress the detach procedure.\nThe network shall initiate the paging procedure when it receives an incoming mobile terminating SMS to the UE if\nthe UE is:\n1)\tIMSI attached for non-EPS services or for \"SMS only\"; or\n2)\tattached for EPS services with CIoT EPS optimization and the UE has requested \"SMS only\" and the UE is in NB-S1 mode,\n-\tno NAS signalling connection exists.\n-\tthere is no paging restriction applied in the network.\nFor the UE using eDRX, the network initiates the paging procedure when an incoming mobile terminating SMS is received within the paging time window. If an incoming mobile terminating SMS is received outside the paging time window and the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), the network initiates the paging procedure at T time ahead of the beginning of the next paging time window.\nNOTE:\tT time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the CN and the UE into account when choosing T time.\nTo initiate the procedure for SMS when no NAS signalling connection exists, the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.413 [23]). The paging message shall include a CN domain indicator set to \"PS\". If the paging message includes a UE Paging Identity set to the UE's S-TMSI, the paging procedure is performed according to clause 5.6.2.2.1. If the paging message includes a UE Paging Identity set to the UE's IMSI, the paging procedure is performed according to clause 5.6.2.2.2. The MME shall not start timers T3413 and T3415 for this procedure.\nIf the negotiated UE paging probability information is available in the EMM context of the UE, the EMM entity shall provide the lower layer with the negotiated UE paging probability information (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.3\tTransport of NAS messages procedure",
                            "text_content": "The purpose of the transport of NAS messages procedure is to carry SMS messages in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used when the UE is attached for EPS services and non-EPS services or for EPS services and \"SMS only\", and the UE is in EMM-CONNECTED mode.\nNOTE 1:\tIf the UE is in EMM-IDLE mode and is using EPS services with control plane CIoT EPS optimization, the UE transports the first SMS message by encapsulating it in the NAS message container IE in the Control Plane Service Request message.\nNOTE 2:\tWhen the UE is using EPS services with control plane CIoT EPS optimization, the network can initiate downlink transport of NAS messages procedure even if the UE does not have any PDN connections established.\nUpon request from the SMS entity to send an SMS message, the EMM entity in the UE initiates the procedure by sending an UPLINK NAS TRANSPORT message including the SMS message in the NAS message container IE.\nNOTE:\tWhen the UE is using for EPS services with control plane CIoT EPS optimization, the UE can initiate uplink transport of NAS messages procedure even if the UE does not any PDN connections established.\nThe network initiates the procedure by sending a DOWNLINK NAS TRANSPORT message. When receiving the DOWNLINK NAS TRANSPORT message, the EMM entity in the UE shall forward the contents of the NAS message container IE to the SMS entity.\nNOTE:\tWhen the UE is using for EPS services with control plane CIoT EPS optimization, the network can initiate downlink transport of NAS messages procedure even if the UE does not any PDN connections established.\nThe following abnormal case can be identified:\na)\tTimer T3346 is running\nThe UE shall not send an UPLINK NAS TRANSPORT message unless:\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE has a PDN connection for emergency bearer services established; or\n-\tthe UE is configured for dual priority and has a PDN connection established without low access priority but the timer T3346 was started in response to NAS signalling request with low access priority.\nThe UPLINK NAS TRANSPORT message can be sent, if still necessary, when timer T3346 expires or is stopped.\nb)\tTimer T3447 is running\nThe UE shall not send an UPLINK NAS TRANSPORT message when the UE is in EMM-CONNECTED mode after the UE attached without PDN connection, unless:\n-\tthe UE is a UE configured to use AC11 – 15 in the selected PLMN; or\n-\ta network initiated signalling message has been received.\nThe UPLINK NAS TRANSPORT message can be sent, if still necessary, when timer T3447 expires.\nThe following abnormal case can be identified:\na)\tLower layer indication of non-delivered NAS PDU\nIf the DOWNLINK NAS TRANSPORT message is not delivered for any reason, the MME may discard the message.\nb)\tUPLINK NAS TRANSPORT message received from a UE which is in a location where the PLMN is not allowed to operate\nIf the MME determines that the UE is in a location where the PLMN is not allowed to operate, the MME discards the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.4\tGeneric transport of NAS messages procedure",
                            "text_content": "The purpose of the generic transport of NAS messages procedure is to carry protocol messages from various applications (e.g., an LCS application to send an LPP message or a location service message) in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used when the UE is attached for EPS services and is in EMM-CONNECTED mode.\nUpon request from an application to send a message encapsulated in the generic transport of NAS message, the EMM entity in the UE initiates the procedure by sending an UPLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. The application may also request additional information to be included in the UPLINK GENERIC NAS TRANSPORT message in the Additional information IE. The content, coding and interpretation of this information element are dependent on the particular application.\nThe UE shall indicate the application protocol using the generic transport in the corresponding generic message container type. When receiving the UPLINK GENERIC NAS TRANSPORT message, the EMM entity in the MME shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. If included, the EMM entity in the MME shall also provide the contents of the Additional information IE.\nUpon request from an application to send a message encapsulated in the generic transport of NAS message, the EMM entity in the MME initiates the procedure by sending a DOWNLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. The application may also request additional information to be included in the DOWNLINK GENERIC NAS TRANSPORT message in the Additional information IE. The content, coding and interpretation of this information element are dependent on the particular application.\nThe MME shall indicate the application protocol using the generic transport in the corresponding generic message container type. When receiving the DOWNLINK GENERIC NAS TRANSPORT message, the EMM entity in the UE shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. If included, the EMM entity in the UE shall also provide the contents of the Additional information IE.\nThe following abnormal case can be identified:\na)\tTimer T3346 is running\nThe UE shall not send an UPLINK GENERIC NAS TRANSPORT message unless:\nthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE has a PDN connection for emergency bearer services established; or\nthe UE is configured for dual priority and has a PDN connection established without low access priority but the timer T3346 was started in response to NAS signalling request with low access priority.\nThe UPLINK GENERIC NAS TRANSPORT message can be sent, if still necessary, when timer T3346 expires or is stopped.\nb)\tTimer T3447 is running\nThe UE shall not send an UPLINK GENERIC NAS TRANSPORT message when the UE is in EMM-CONNECTED mode, unless:\n-\tthe UE is a UE configured to use AC11 – 15 in the selected PLMN;\n-\tthe UE has a PDN connection for emergency bearer services established; or\n-\ta network initiated signalling message has been received.\nThe UPLINK GENERIC NAS TRANSPORT message can be sent, if still necessary, when timer T3447 expires.\nThe following abnormal case can be identified:\na)\tLower layer indication of non-delivered NAS PDU\nIf the DOWNLINK GENERIC NAS TRANSPORT message is not delivered for any reason, the MME may discard the message.\nb)\tUPLINK GENERIC NAS TRANSPORT message received from a UE which is in a location where the PLMN is not allowed to operate\nIf the MME determines that the UE is in a location where the PLMN is not allowed to operate, the MME discards the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.7\tReception of an EMM STATUS message by an EMM entity",
                    "description": "",
                    "summary": "",
                    "text_content": "The purpose of the sending of the EMM STATUS message is to report at any time certain error conditions detected upon receipt of EMM protocol data. The EMM STATUS message can be sent by both the MME and the UE (see example in figure 5.7.1).\nOn receipt of an EMM STATUS message no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. The local actions to be taken by the MME or the UE on receipt of an EMM STATUS message are implementation dependent.\nThe figure depicts a step-by-step process for monitoring and managing Enhanced Mobile Broadband (EMB) status. It includes a series of steps, such as checking the EMM status, verifying the EMM status, and performing a test. The figure is crucial for ensuring the smooth operation of EMB services and maintaining network reliability.\nFigure 5.7.1: EMM status procedure\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "6\tElementary procedures for EPS session management",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tGeneral",
                            "text_content": "This clause describes the procedures used for EPS session management (ESM) at the radio interface (reference point \"LTE-Uu\").\nThe main function of the ESM sublayer is to support the EPS bearer context handling in the UE and in the MME.\nThe ESM comprises procedures for:\n-\tthe activation, deactivation and modification of EPS bearer contexts;\n-\tthe request for resources (IP connectivity to a PDN or dedicated bearer resources) by the UE; and\n-\tthe transport of user data via the control plane between the UE and the MME.\nEach EPS bearer context represents an EPS bearer between the UE and a PDN. EPS bearer contexts can remain activated even if the radio and S1 bearers constituting the corresponding EPS bearers between UE and MME are temporarily released.\nAn EPS bearer context can be either a default bearer context or a dedicated bearer context.\nA default EPS bearer context is activated when the UE requests a connection to a PDN.\nGenerally, ESM procedures can be performed only if an EMM context has been established between the UE and the MME, and the secure exchange of NAS messages has been initiated by the MME by use of the EMM procedures described in clause 5. The first default EPS bearer context, however, can be activated during the EPS attach procedure (see clause 4.2). Once the UE is successfully attached, and the first default EPS bearer context has been activated during or after the attach procedure, the UE can request the MME to set up connections to additional PDNs. For each additional connection, the MME will activate a separate default EPS bearer context. A default EPS bearer context remains activated throughout the lifetime of the connection to the PDN.\nA dedicated EPS bearer context is always linked to a default EPS bearer context and represents additional EPS bearer resources between the UE and the PDN. The network can initiate the activation of dedicated EPS bearer contexts together with the activation of the default EPS bearer context or at any time later, as long as the default EPS bearer context remains activated. However, the network shall not initiate a dedicated bearer context activation procedure for established PDN connection(s) of \"non IP\" PDN type.\nDefault and dedicated EPS bearer contexts can be modified. Dedicated EPS bearer contexts can be released without affecting the default EPS bearer context. When the default EPS bearer context is released, then all dedicated EPS bearer contexts linked to it are released too.\nThe UE can request the network to allocate, modify or release EPS bearer resources. The network can fulfil such a request from the UE by activating a new dedicated EPS bearer context, modifying an EPS bearer context or deactivating an EPS bearer context.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.2\tTypes of ESM procedures",
                            "text_content": "Two types of ESM procedures can be distinguished:\n1)\tProcedures related to EPS bearer contexts:\nThese procedures are initiated by the network and are used for the manipulation of EPS bearer contexts:\n-\tdefault EPS bearer context activation;\n-\tdedicated EPS bearer context activation;\n-\tEPS bearer context modification;\n-\tEPS bearer context deactivation.\nThis procedure is initiated by the network or by the UE and is used for the transport of user data via the control plane:\n-\ttransport of user data via the control plane procedure.\n2)\tTransaction related procedures:\nThese procedures are initiated by the UE to request for resources, i.e. a new PDN connection or dedicated bearer resources, or to release these resources:\n-\tPDN connectivity procedure;\n-\tPDN disconnect procedure;\n-\tbearer resource allocation procedure;\n-\tbearer resource modification procedure.\nThis procedure is initiated by the ProSe UE-to-network relay and is used for the manipulation of EPS bearer contexts:\n-\tremote UE report.\nWhen combined with the attach procedure, the PDN connectivity procedure can trigger the network to execute the following transaction related procedure:\n-\tESM information request procedure.\nWhen combined with the attach procedure, if EMM-REGISTERED without PDN connection is supported by the UE and the network and no PDN connectivity procedure is initiated during the attach procedure, the UE or the network executes the following transaction related procedure:\n-\tESM dummy message procedure.\nA successful transaction related procedure initiated by the UE triggers the network to execute one of the procedures related to EPS bearer contexts. The UE treats the start of the procedure related to the EPS bearer context as completion of the transaction related procedure.\nDuring procedures related to EPS bearer contexts, the MME and the UE shall not initiate the transport of user data via the control plane procedure until the ongoing procedure is completed.\nNOTE 1:\tThe UE determination of the completion of the transport of user data via the control plane procedure is left to the implementation.\nNOTE 2:\tNAS signalling prioritization with respect to the transport of user data via the control plane cannot be guaranteed in the downlink direction in this version of the specification.\nExcept for the remote UE report procedure and ESM information request procedure, during transaction related procedures, the MME and the UE shall not initiate the transport of user data via the control plane procedure until the ongoing procedure is completed.\nThe following ESM procedures can be related to an EPS bearer context or to a procedure transaction:\n-\tESM status procedure;\n-\tnotification procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.3\tESM sublayer states",
                            "text_content": "In this clause the possible states of EPS bearer contexts in the UE and on the network side are described. Each EPS bearer context is associated with an individual state.\nNo EPS bearer context exists.\nThe EPS bearer context is active in the UE.\nThe ESM sublayer states for EPS bearer context handling in the UE (overview) in Figure 6.1.3.2.2.1. This figure illustrates the sublayer states for EPS bearer context handling in the UE, providing a detailed overview of the ESM sublayer's functionality and its role in ensuring the proper handling of EPS bearer context in the UE.\nFigure 6.1.3.2.2.1: The ESM sublayer states for EPS bearer context handling in the UE (overview)\nNo procedure transaction exists.\nThe UE has initiated a procedure transaction towards the network.\n\nThe figure depicts the procedure transaction states in the UE (User Equipment) of a 5G network, illustrating the various steps and actions that occur during the communication process.\nFigure 6.1.3.2.4.1: The procedure transaction states in the UE (overview)\nNo EPS bearer context exists.\nThe network has initiated an EPS bearer context activation towards the UE.\nThe EPS bearer context is active in the network.\nThe network has initiated an EPS bearer context deactivation towards the UE.\nThe network has initiated an EPS bearer context modification towards the UE.\nThe ESM sublayer in Figure 6.1.3.3.5.1 of the network provides context handling for EPS bearer traffic, ensuring efficient and reliable communication.\nFigure 6.1.3.3.5.1: The ESM sublayer states for EPS bearer context handling in the network (overview)\nNo procedure transaction exists.\nThe network has initiated a procedure transaction towards the UE.\n\nThe figure depicts the procedure transaction states in the network, providing a comprehensive overview of the network's transaction processing.\nFigure 6.1.3.3.7.1: The procedure transaction states in the network (overview)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.4\tCoordination between ESM and SM",
                            "text_content": "For inter-system change from S1 mode to A/Gb mode or Iu mode, SM uses the following parameters from each active EPS bearer context:\n-\tEPS bearer identity to map to NSAPI;\nNOTE 1:\tIf the UE and the MME support signalling for a maximum number of 15 EPS bearer contexts, any active EPS bearer contexts using EPS bearer identity 1 to 4 are not mapped but deactivated locally before inter-system change to A/Gb mode or Iu mode.\n-\tlinked EPS bearer identity (if available) to map to linked TI;\n-\tPDN address and APN of the default EPS bearer context to map to PDP address and APN of the default PDP context;\n-\tTFT of the default EPS bearer context, if any, to map to the TFT of the default PDP context;\n-\tTFTs of the dedicated EPS bearer contexts to map to TFTs of the secondary PDP contexts; and\n-\tGERAN/UTRAN parameters as provided by the MME while on E-UTRAN access, i.e. R99 QoS, LLC SAPI, radio priority, packet flow identifier, transaction identifier and BCM (if available). If the MME also provided an Extended EPS QoS IE, then the bit rates signalled with this IE are also applicable to the R99 QoS.\nNOTE 2:\tSome networks not supporting mobility from S1 mode to A/Gb mode or Iu mode or both do not provide the UE with the GERAN/UTRAN parameters. However, for this case there is no need for the UE to perform mapping to GERAN/UTRAN parameters (i.e. the PDP contexts cannot be transferred to A/Gb mode or Iu mode).\nThe MME performs the mapping from EPS to R99 QoS parameters according to 3GPP TS 23.401 [10], annex E.\nAt inter-system change from S1 mode to A/Gb mode, SM shall not activate the PDP context(s) if SM does not have the following parameters from the active EPS bearer context(s):\n-\tLLC SAPI;\n-\tradio priority;\n-\ttransaction identifier; and\n-\tR99 QoS.\nAt inter-system change from S1 mode to Iu mode, SM shall not activate the PDP context(s) if SM does not have the following parameter from the active EPS bearer context(s):\n-\ttransaction identifier; and\n-\tR99 QoS.\nFor inter-system change from A/Gb mode or Iu mode to S1 mode, ESM uses the following parameters from each active PDP context:\n-\tNSAPI to map to EPS bearer identity;\n-\tNSAPI of the default PDP context to map to linked EPS bearer identity;\n-\tPDP address and APN of the default PDP context to map to PDN address and APN of the default EPS bearer context;\n-\tTFT of the default PDP context, if any, to map to the TFT of the default EPS bearer context; and\n-\tTFTs of the secondary PDP contexts to map to the TFTs of the dedicated EPS bearer contexts.\nThe MME and the UE perform the mapping from R99 to EPS QoS parameters according to 3GPP TS 23.401 [10], annex E. In particular the MME derives the APN-AMBR for the corresponding PDN connection from the MBR of the R99 subscribed QoS profile and the UE maps the MBR of its default PDP context to the APN-AMBR of the corresponding PDN connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.4A\tCoordination between ESM and 5GSM",
                            "text_content": "See clause 6.1.4 in 3GPP TS 24.501 [54].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.5\tCoordination between ESM and EMM for supporting ISR",
                            "text_content": "The UE with its TIN set as \"RAT-related TMSI\" for which ISR is activated shall change its TIN to \"GUTI\" to locally deactivate ISR and stop the periodic routing area update timer T3312 or T3323, if running:\n-\tupon modification of any EPS bearer context which was activated before the ISR is activated in the UE;\n-\tat the time when the UE changes from S1 mode to A/Gb mode or Iu mode not due to PS handover procedure (see 3GPP TS 24.008 [13]), if any EPS bearer context activated after the ISR was activated in the UE exists; or\n-\tupon deactivation of the last non-emergency EPS bearer context in the UE, if the UE has only a PDN connection for emergency bearer services remaining.\nISR remains activated on the network side in the above cases.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.2\tIP address allocation",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tGeneral",
                            "text_content": "The UE can configure an IPv4 address during the establishment of a default EPS bearer context. The UE can obtain an IPv4 address or an IPv6 prefix or both via an IETF-based IP address allocation mechanism once the default bearer is established.\nThe following IETF-based IP address/prefix allocation methods are specified for EPS (the corresponding procedures are specified in 3GPP TS 29.061 [16]):\na)\t/64 IPv6 default prefix allocation via IPv6 stateless address autoconfiguration. Optionally, allocation of additional IPv6 prefix(es) with length /64 or shorter via stateful DHCPv6 Prefix Delegation (see IETF RFC 3633 [24A]);\nb)\tIPv4 address allocation and IPv4 parameter configuration via DHCPv4;\nc)\tIPv6 parameter configuration via stateless DHCPv6.\nNOTE:\tFrom the perspective of the UE, the procedure used to allocate a static IP address via NAS signalling is the same as the procedure used to allocate a dynamic IP address specified in clause 6.2.2.\nUpon deactivation of the default bearer of a PDN connection, the UE shall locally release any IPv4 address or IPv6 prefix allocated to the UE for the corresponding PDN connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2\tIP address allocation via NAS signalling",
                            "text_content": "The UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message, based on its IP stack configuration if it requests IP connectivity (e.g. the per APN settings specified in 3GPP TS 23.401 [10]) as follows:\na)-\tA UE, which is IPv6 and IPv4 capable and\n-\thas not been allocated an IP address for this APN, shall set the PDN type IE to IPv4v6.\n-\thas been allocated an IPv4 address for this APN and received the ESM cause #52 \"single address bearers only allowed\", and is requesting an IPv6 address, shall set the PDN type IE to IPv6.\n-\thas been allocated an IPv6 address for this APN and received the ESM cause #52 \"single address bearers only allowed\", and is requesting an IPv4 address, shall set the PDN type IE to IPv4.\nb)\tA UE, which is only IPv4 capable, shall set the PDN type IE to IPv4.\nc)\tA UE, which is only IPv6 capable, shall set the PDN type IE to IPv6.\nd)\tWhen the IP version capability of the UE is unknown in the UE (as in the case when the MT and TE are separated and the capability of the TE is not known in the MT), the UE shall set the PDN type IE to IPv4v6.\nIf the UE wants to use DHCPv4 for IPv4 address assignment, it shall indicate that to the network within the Protocol configuration options IE in the PDN CONNECTIVITY REQUEST.\nIf the UE wants to get PDN connectivity for non-IP, the UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to \"non IP\". If the UE wants to get PDN connectivity for Ethernet, the UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to \"Ethernet\".\nOn receipt of the PDN CONNECTIVITY REQUEST message sent by the UE, the network when allocating an IP address shall take into account the PDN type IE, the operator policies of the home and visited network, and the user's subscription data and:\n-\tif the UE requests for PDN type IPv4v6, but the subscription is limited to IPv4 only or IPv6 only for the requested APN, the network shall override the PDN type requested by the UE to be limited to a single address PDN type (IPv4 or IPv6). In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either \"IPv4\" or \"IPv6\" and the ESM cause value to #50 \"PDN type IPv4 only allowed\", or #51 \"PDN type IPv6 only allowed\", respectively. The UE shall not subsequently initiate another UE requested PDN connectivity procedure to the same APN to obtain a PDN type different from the one allowed by the network until:\na)\tthe UE is registered to a new PLMN;\nb)\tvoid;\nc)\tthe UE is switched off; or\nd)\tthe USIM is removed.\nNOTE 1:\tRequest to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.\n-\tif the UE requests PDN type IPv4v6, but the PDN GW configuration dictates the use of IPv4 addressing only or IPv6 addressing only for this APN, the network shall override the PDN type requested by the UE to limit it to a single address PDN type (IPv4 or IPv6). In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either \"IPv4\" or \"IPv6\" and the ESM cause value to #50 \"PDN type IPv4 only allowed\", or #51 \"PDN type IPv6 only allowed\", respectively. The UE shall not subsequently initiate another UE requested PDN connectivity procedure to the same APN to obtain a PDN type different from the one allowed by the network until:\na)\tthe UE is registered to a new PLMN;\nb)\tvoid;\nc)\tthe UE is switched off; or\nd)\tthe USIM is removed.\nNOTE 2:\tRequest to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.\n-\tif the UE requests PDN type IPv4v6, but the operator uses single addressing per bearer, e.g. due to interworking with nodes of earlier releases, the network shall override the PDN type requested by the UE to a single IP version only. In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either \"IPv4\" or \"IPv6\" and the ESM cause value to #52 \"single address bearers only allowed\". The UE should subsequently request another PDN connection for the other IP version using the UE requested PDN connectivity procedure to the same APN with a single address PDN type (IPv4 or IPv6) other than the one already activated;\nNOTE 3:\tIf the MT and TE are separated, the UE might not be able to use ESM cause #52 \"single address bearers only allowed\" as a trigger for activating a second single-IP-stack EPS bearer context.\n-\tif the network sets the PDN type to IPv4 or IPv4v6, the network shall include an IPv4 address in the PDN address information. In this case, if the IPv4 address is to be configured using DHCPv4, the network shall set the IPv4 address to 0.0.0.0; and\n-\tif the network sets the PDN type to IPv6 or IPv4v6, the network shall include the interface identifier that the UE shall use for the link local address in the PDN address information.\nThe network shall include the PDN type and the PDN address information within the PDN address IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.2A\tIP header compression",
                    "description": "",
                    "summary": "",
                    "text_content": "The UE and the MME may support robust header compression (ROHC) framework (see IETF RFC 5795 [37]) for IP header compression if control plane CIoT EPS optimization is supported for PDN connections of IP PDN type. If IP header compression for control plane CIoT EPS optimization is supported, the ROHC profiles defined in 3GPP TS 36.323 [38] may be supported. The ROHC configuration is negotiated and established during the UE requested PDN connectivity procedure as specified in clause 6.5.1. Both the UE and the MME indicate whether IP header compression for control plane CIoT EPS optimization is supported during attach and tracking area updating procedures (see clauses 5.5.1 and 5.5.3). The ROHC configuration can be re-negotiated by using the UE requested bearer resource modification procedure or the EPS bearer context modification procedure as specified in clauses 6.4.3 and 6.5.4.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.3\tGeneral on elementary ESM procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3.1\tServices provided by lower layers",
                            "text_content": "Unless explicitly stated otherwise, the procedures described in the following clauses can only be executed whilst a NAS signalling exists between the UE and the MME.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.2\tPrinciples of address handling for ESM procedures",
                            "text_content": "Transaction related procedures use the procedure transaction identity as address parameter in the ESM message header. When the UE or the network initiates a transaction related procedure, it shall include a valid procedure transaction identity value in the message header and set the EPS bearer identity to \"no EPS bearer identity assigned\". When the ProSe UE-to-network relay initiates the transaction related procedure remote UE report, it shall include a valid procedure transaction identity value in the message header and set the EPS bearer identity to a valid EPS bearer identity value.\nIf the response message is again a transaction related message, e.g. a PDN CONNECTIVITY REJECT, PDN DISCONNECT REJECT, BEARER RESOURCE ALLOCATION REJECT, BEARER RESOURCE MODIFICATION REJECT, ESM INFORMATION REQUEST message or ESM DUMMY MESSAGE from the network or an ESM INFORMATION RESPONSE message or ESM DUMMY MESSAGE from the UE, the sending entity shall include the procedure transaction identity value received with the request message and set the EPS bearer identity to \"no EPS bearer identity assigned\" (see examples in figures 6.3.2.1, 6.3.2.1a and 6.3.2.2). If the response message is the transaction related message REMOTE UE REPORT RESPONSE message from the network, the network shall include the procedure transaction identity value received with the request message and set the EPS bearer identity to the EPS bearer identity value received from the ProSe UE-to-network relay (see example in figure 6.3.2.2a).\nIf an ESM DUMMY MESSAGE is sent in response to a received ESM DUMMY MESSAGE, the sending entity shall include the received procedure transaction identity value in the message header and set the EPS bearer identity to \"no EPS bearer identity assigned\".\nThe figure depicts a transaction related procedure initiated by the UE and rejected by the network. The UE initiates the transaction by sending a message to the network, which then rejects the message due to network congestion or other reasons. This process is crucial for ensuring the smooth operation of the network and preventing potential disruptions.\nFigure 6.3.2.1: Transaction related procedure initiated by the UE and rejected by the network\nThe figure depicts a transaction-related procedure initiated by the UE and responded by a network-initiated transaction-related request, illustrating the flow of data between the UE and the network.\nFigure 6.3.2.1a: Transaction related procedure initiated by the UE and responded by a network initiated transaction related request\nThe figure depicts a transaction-related procedure initiated by the network, illustrating the steps taken by the network to initiate a transaction. The figure includes various components such as the network interface controller (NIC), network management system (NMS), and network control plane (NCP). The figure also shows the network's response to the transaction, with the network interface controller (NIC) initiating the transaction and the network management system (NMS) and network control plane (NCP) responding accordingly. The figure provides a clear and concise representation of the network's transaction-related procedure, making it easy to understand the flow of information and the steps taken to initiate a transaction.\nFigure 6.3.2.2: Transaction related procedure initiated by the network\nThe figure depicts a transaction-related procedure initiated by the UE, illustrating the flow of data and signaling within a 5G network.\nFigure 6.3.2.2a: Transaction related procedure initiated by the UE\nEPS bearer context related procedures use the EPS bearer identity as address parameter in the ESM message header. When the network initiates an EPS bearer context related procedure, it shall include a valid EPS bearer identity value in the message header. The procedure transaction identity value shall be set as follows:\n-\tIf the EPS bearer context related procedure was triggered by the receipt of a transaction related request message from the UE, the network shall include the procedure transaction identity value received with the transaction related request message in the message header of the EPS bearer context related request message (see example in figure 6.3.2.3).\n-\tIf the procedure was triggered network-internally, the network shall set the procedure transaction identity value in the message header of the EPS bearer context related request message to \"no procedure transaction identity assigned\" (see example in figure 6.3.2.4).\n-\tIf the procedure was triggered by the transport of user data via the control plane, the network shall set the procedure transaction identity value in the message header of the EPS bearer context related request message to \"no procedure transaction identity assigned\" (see example in figure 6.3.2.5).\nIn the response message of the EPS bearer context related procedure, the UE shall include the EPS bearer identity value received from the network and set the procedure transaction identity value to \"no procedure transaction identity assigned\".\nWhen the UE initiates an EPS bearer context related procedure and the procedure was triggered by the transport of user data via the control plane, it shall include a valid EPS bearer identity value and set the procedure transaction identity value to \"no procedure transaction identity assigned\" in the message header (see example in figure 6.3.2.6).\nThe figure depicts the context related procedure triggered by a transaction-related request in an EPS bearer context. It illustrates the steps taken by the system to respond to the request, including the initiation of a transaction, the execution of the transaction, and the completion of the transaction. The figure provides a visual representation of the flow of information and the steps involved in the transaction process, making it easier to understand and follow.\nFigure 6.3.2.3: EPS bearer context related procedure triggered by a transaction related request\nThe figure depicts a network-internally triggered EPS bearer context related procedure, which is a crucial component of the network's security and management. The figure shows the various steps involved in the procedure, including the initiation of the procedure, the execution of the procedure, and the completion of the procedure. This figure is crucial for ensuring the smooth operation of the network and maintaining its security.\nFigure 6.3.2.4: EPS bearer context related procedure triggered network-internally\nThe figure depicts the context related procedure triggered by the network for the transport of user data via the control plane, specifically focusing on the EPS bearer context.\nFigure 6.3.2.5: EPS bearer context related procedure triggered by network for the transport of user data via the control plane\nThe figure depicts the context related procedure triggered by an UE for the transport of user data via the control plane, highlighting the importance of data integrity and security in the 5G network.\nFigure 6.3.2.6: EPS bearer context related procedure triggered by UE for the transport of user data via the control plane\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.3\tAbnormal cases in the UE",
                            "text_content": "The following abnormal case can be identified:\na)\tESM uplink message transmission failure indication by lower layers\nUnless the procedure descriptions in clause 6.6 specify a different behaviour, the following applies:\n-\tIf lower layers indicate a TAI change, but the current TAI is not in the TAI list, the ESM procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure.\n-\tIf lower layers indicate a TAI change, but the current TAI is still part of the TAI list, it is up to the UE implementation how the ESM procedure is re-initiated.\n-\tIf lower layers indicate the TAI has not changed, it is up to the UE implementation how the ESM procedure is re-initiated.\nNOTE 1:\tThe ESM procedure can typically be re-initiated using a retransmission mechanism of the uplink message (the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to restart the whole procedure.\nThe case a) above does not apply to the ESM INFORMATION RESPONSE message.\nNOTE 2:\tThe ESM INFORMATION RESPONSE message cannot be subjected to a transmission failure by lower layers due to handover as no handover message can be accepted by the UE prior to reception of the ATTACH ACCEPT message (see 3GPP TS 36.331 [22]).\nb)\tTransmission failure of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message indication from EMM sublayer when the UE received any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure\nIt is up to the UE implementation how the dedicated EPS bearer context activation procedure is re-initiated.\nNOTE 3:\tThe ESM procedure can typically be re-initiated using a retransmission mechanism of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message or ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with new sequence number and message authentication code information thus avoiding to restart the whole procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.4\tAbnormal cases in the network",
                            "text_content": "The following abnormal case can be identified:\na)\tLower layer indication of non-delivered NAS PDU due to handover\nUnless the procedure descriptions in clause 6.4, 6.5 or 6.6 specify a different behaviour, the following applies:\nIf the downlink ESM NAS message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the ESM message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the downlink ESM NAS message.\nb)\tLower layer indication of non-delivered NAS PDU due to inter-eNodeB connected mode mobility when the transport of user data via the control plane is used\nIf the downlink ESM NAS message could not be delivered due to inter-eNodeB connected mode mobility and the MME is not changed, then upon successful completion of inter-eNodeB connected mode mobility the MME shall retransmit the ESM message. If a failure of inter-eNodeB connected mode mobility is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the downlink ESM NAS message.\nNOTE:\tIf the downlink ESM NAS message could not be delivered due to inter-eNodeB connected mode mobility and the MME is changed, the retransmission of downlink ESM NAS message is not supported.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.5\tHandling of APN based congestion control",
                            "text_content": "The network may detect and start performing the APN based congestion control when one or more APN congestion criteria as specified in 3GPP TS 23.401 [10] are met. The network may store an APN congestion back-off time on a per UE and congested APN basis. If the UE does not provide an APN for a non-emergency PDN connection, then the MME uses the APN which is used in PDN GW selection procedure as congested APN. When APN based congestion control is active, the network may reject session management requests except the modification of bearer resources requests from UEs or disconnect existing PDN connections with ESM cause value #26 \"insufficient resources\".\nIn the UE, EPS session management timers T3396 for APN based congestion control are started and stopped on a per APN basis. The APN associated with T3396 is the APN provided by the UE when the PDN connection is established. If no APN is included in the PDN CONNECTIVITY REQUEST or, when applicable, in the ESM INFORMATION RESPONSE message, then T3396 is associated with no APN. For this purpose the UE shall memorize the APN provided to the network during the PDN connection establishment. The timer T3396 associated with no APN will never be started due to any ESM procedure related to an emergency PDN connection. If the timer T3396 associated with no APN is running or is deactivated, it does not affect the ability of the UE to request an emergency PDN connection.\nIf timer T3396 is running or is deactivated, the UE is allowed to indicate change of the 3GPP PS data off UE status, initiate PDN disconnection procedure, initiate bearer resource modification procedure to release of bearer resources for the respective APN, and if the UE is a UE configured to use AC11 – 15 in selected PLMN, then the UE is allowed to initiate an attach procedure or any EPS session management procedure for the respective APN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.5A\tHandling of group specific session management congestion control",
                            "text_content": "The network may detect and start performing the group specific session management congestion control when one or more group congestion criteria as specified in 3GPP TS 23.401 [10] are met. When group specific session management congestion control is active, the mechanism for APN based congestion control as specified in clause 6.3.5 shall be followed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.6\tHandling of network rejection not due to  based congestion control",
                            "text_content": "The network may include a back-off timer value in an EPS session management reject message to regulate the time interval at which the UE may retry the same procedure. For ESM cause values other than #26 \"insufficient resources\", the network may also include the re-attempt indicator to indicate whether the UE is allowed to re-attempt the corresponding session management procedure for the same  in A/Gb or Iu mode or N1 mode after inter-system change.\nNOTE 1:\tIf the network includes this back-off timer value, then the UE is blocked from sending another ESM request for the same procedure for the same PLMN and  combination for the specified duration. Therefore, the operator needs to exercise caution in determining the use of this timer value.\nNOTE 2:\tIf the re-attempt indicator is not provided by the network, a UE registered in its HPLMN or in an EHPLMN (if the EHPLMN list is present) can use the configured SM_RetryAtRATChange value specified in the NAS configuration MO or in the USIM NASCONFIG file to derive the re-attempt indicator as specified in clauses 6.5.1.4.3, 6.5.3.4.3, and 6.5.4.4.3.\nIf re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall consider the back-off timer to be applicable only to the EPS session management in S1 mode for the rejected EPS session management procedure and the given PLMN and  combination. If re-attempt in A/Gb and Iu mode and N1 mode is not allowed, the UE shall consider the back-off timer to be applicable to all three NAS protocols, i.e. applicable to the EPS session management in S1 mode for the rejected EPS session management procedure, to the GPRS session management in A/Gb and Iu mode for the corresponding session management procedure and the given PLMN and  combination and to the 5GS session management in N1 mode for the corresponding session management procedure and the given PLMN and APN combination.\nNOTE 3:\tIn the present clause the terms APN and DNN are referring to the same parameter.\nThe APN of the PLMN and APN combination associated with the back-off timer is the APN provided by the UE when the PDN connection is established. If no APN is included in the PDN CONNECTIVITY REQUEST or, when applicable, in the ESM INFORMATION RESPONSE message, then the back-off timer is associated with the combination of the PLMN and no APN. For this purpose the UE shall memorize the APN provided to the network during the PDN connection establishment. The back-off timer associated with the combination of a PLMN with no APN will never be started due to any ESM procedure related to an emergency PDN connection. If the back-off timer associated with the combination of a PLMN with no APN is running, it does not affect the ability of the UE to request an emergency PDN connection.\nThe network may additionally indicate in the re-attempt indicator that a command to back-off is applicable not only for the PLMN in which the UE received the EPS session management reject message, but for each PLMN included in the equivalent PLMN list at the time when the EPS session management reject message was received.\nIf the back-off timer is running or is deactivated for a given PLMN and APN combination, and the UE is a UE configured to use AC11 – 15 in selected PLMN, then the UE is allowed to initiate an attach procedure or any EPS session management procedure for this PLMN and APN combination.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.7\tHandling of WLAN offload control",
                            "text_content": "In networks that support offloading of traffic to WLAN, as specified in 3GPP TS 36.331 [22], a permission to offload is determined for the UE and the PDN connection in accordance with 3GPP TS 23.401 [10] clause 4.3.23.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.8\tHandling of serving PLMN rate control",
                            "text_content": "Serving PLMN rate control enables the serving PLMN to protect its MME and the signalling radio bearers in the E-UTRAN from load generated by NAS messages with user data over control plane. The MME can inform the UE of any local serving PLMN rate control during the default EPS bearer context activation procedure (see clause 6.4.1). If the serving PLMN rate control is enabled, the MME shall start the serving PLMN rate control for the PDN connection when the first NAS message with user data over control plane is received over the PDN connection. The UE shall limit the rate at which it generates uplink NAS messages with user data over control plane to comply with the serving PLMN policy provided by the network. The indicated rate in a NAS procedure applies to the PDN connection the NAS procedure corresponds to, and the indicated rate is valid until the PDN connection is released.\nServing PLMN rate control is applicable for PDN connections established for control plane CIoT EPS optimization only.\nAny serving PLMN rate control information provided by the network to the UE is only applicable for the PLMN which provided this information. This serving PLMN rate control information shall be discarded when the UE successfully registers to another PLMN.\nNOTE:\tThe serving PLMN can discard or delay NAS messages including user data over control plane that exceed the limit provided for serving PLMN rate control.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.9\tHandling of APN rate control",
                            "text_content": "APN rate control controls the maximum number of uplink user data messages including uplink exception data reporting sent by the UE in a time interval for the APN in accordance with 3GPP TS 23.401 [10]. The UE shall limit the rate at which it generates uplink user data messages to comply with the APN rate control policy. The NAS shall provide the indicated rates to upper layers for enforcement. The indicated rates in a NAS procedure applies to the APN the NAS procedure corresponds to, and the indicated rates are valid until a new value is indicated or the last PDN connection using this APN is released.\nIf the UE supports APN rate control, the UE shall provide the support indication of APN rate control and additional APN rate control for exception data reporting to the network. If the UE indicates support of additional APN rate control for exception data reporting, the network may provide the APN rate control parameters for exception data to the UE. If the UE does not indicate support of additional APN rate control for exception data reporting, the network shall not provide the APN rate control parameters for exception data to the UE.\nIf an allowed indication of additional exception reports is provided with the APN rate control parameters and:\n-\tthe additional APN rate control parameters for exception data is provided and the limit for additional rate for exception data reporting is not reached; or\n-\tthe additional APN rate control parameters for exception data is not provided,\nthe UE is allowed to send uplink exception reports even if the limit for the APN rate control has been reached.\nNOTE 1:\tThe HPLMN can discard or delay user data that exceeds the limit provided for APN rate control.\nUpon inter-system change from S1 mode to N1 mode, the UE shall store the current APN rate control status for each APN associated with PDN connection(s) to be transferred from S1 mode to N1 mode as specified in 3GPP TS 23.501 [58].\nNOTE 2:\tHow long the UE stores the current APN rate control status is implementation specific.\nUpon inter-system change from N1 mode to S1 mode, the UE shall use the stored APN rate control status, if any, to comply with the APN rate control policy for an APN as specified in 3GPP TS 23.501 [58] if:\na)\tthere is at least one PDN connection associated with this APN was transferred from N1 mode to S1 mode; and\nb)\tthe validity period of the stored APN rate control status has not expired.\nAfter inter-system change from S1 mode to N1 mode, if all the PDU sessions associated with the same APN that was used in S1 mode are released, the UE shall delete the stored APN rate control status for this APN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.10\tHandling of 3GPP PS data off",
                            "text_content": "A UE, which supports 3GPP PS data off (see 3GPP TS 23.401 [10]), can be configured with up to two lists of 3GPP PS data off exempt services as specified in 3GPP TS 24.368 [15A] or in the EF3GPPPSDATAOFF USIM file as specified in 3GPP TS 31.102 [17]:\n-\ta list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present); and\n-\ta list of 3GPP PS data off exempt services to be used in the VPLMN.\nIf only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) is configured at the UE, this list shall be also used in the VPLMN.\nIf the UE supports 3GPP PS data off, the UE shall provide the 3GPP PS data off UE status in the Protocol configuration options IE during attach, UE-requested PDN connectivity, and UE-requested bearer resource modification procedure (see clause 5.5.1, 6.5.1, and 6.5.4).\nNOTE 1:\tThe sending of the 3GPP PS data off UE status to the network happens also when the user activates or deactivates 3GPP PS data off while connected via WLAN access only, and then handover to 3GPP access occur.\nThe network informs the UE about the support of 3GPP PS data off during the activation of the default bearer of a PDN connection (see clause 6.4.1). If 3GPP PS data off support is not indicated in the Protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall not indicate any change of 3GPP PS data off UE status for the PDN connection established by the default EPS bearer context activation procedure; otherwise the UE shall indicate change of the 3GPP PS data off UE status for the PDN connection by using the UE-requested bearer resource modification procedure as specified in clause 6.5.4. If the network does not provide indication of support of 3GPP PS data off during default EPS bearer context activation procedure of the PDN connection, the UE behaviour for non-exempt service requests from the network is implementation dependent.\nWhen the 3GPP PS data off UE status is \"activated\":\na)\tthe UE does not send uplink IP packets except:\n-\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) as specified in 3GPP TS 24.368 [15A] when the UE is in its HPLMN or EHPLMN (if the EHPLMN list is present);\n-\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) when the UE is in the VPLMN, if only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) is configured to the UE as specified in 3GPP TS 24.368 [15A];\n-\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the VPLMN when the UE is in the VPLMN, if the list of 3GPP PS data off exempt services to be used in the VPLMN is configured to the UE as specified in 3GPP TS 24.368 [15A];\n-\tfor those services indicated in the EF3GPPPSDATAOFF USIM file as specified in 3GPP TS 31.102 [17];\n-\tany uplink traffic due to procedures specified in 3GPP TS 24.229 [13D]; and\n-\tany uplink traffic due to procedures specified in 3GPP TS 24.623 [50]; and\nb)\tthe UE does not send uplink non-IP or Ethernet user data packets.\nOtherwise the UE sends uplink user data packets without restriction.\nNOTE 2:\tIf the UE supports 3GPP PS data off, uplink IP packets are filtered as specified in 3GPP TS 24.229 [13D] in L.3.1.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.11\tHandling of Reliable Data Service",
                            "text_content": "If the UE supports Reliable Data Service (see 3GPP TS 24.250 [51]), the UE may request data transfer using Reliable Data Service for a PDN connection in the Extended protocol configuration options IE during attach and UE-requested PDN connectivity procedures (see clause 5.5.1 and 6.5.1).\nThe Reliable Data Service may only be used with PDN connections for which the \"Control plane only\" indicator is set or with PDN connections using the control plane CIoT EPS optimization when the MME does not move such PDN connections to the user plane.\nThe SCEF or P-GW shall inform the UE about the acceptance of UE's request for Reliable Data Service usage during the activation of the default bearer of a PDN connection (see clause 6.4.1) in the Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.\nIf the SCEF or P-GW accepts the use of Reliable Data Service to transfer data for the specified PDN connection, the UE shall use this PDN connection exclusively for data transfer using Reliable Data Service; otherwise the UE shall not use this PDN connection for data transfer using Reliable Data Service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.12\tHandling of Ethernet PDN type",
                            "text_content": "A UE may support the Ethernet PDN type. A network may support the Ethernet PDN type.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.13\tHandling of Uncrewed aerial vehicle identification, authentication, and authorization",
                            "text_content": "An EPS can support uncrewed aerial vehicle identification, authentication, and authorization (see 3GPP TS 23.256 [60]).\nBefore accessing EPS for UAS services, the UE supporting UAS services must have an assigned CAA-level UAV ID.\nThe UE supporting UAS services may request a PDN connection for USS communication during attach and UE-requested PDN connectivity procedures (see clause 5.5.1 and 6.5.1). In the request of the PDN connection for USS communication, the UE provides CAA-level UAV ID to the network via the protocol configuration options and the network may decide to perform UUAA-SM procedure. If provided by the upper layers, a UE supporting UAS services may provide to the network the USS address via the protocol configuration options during attach and UE-requested PDN connectivity procedures so that the network may use the information to discover the USS.\nAfter successful UUAA-SM procedure, the network may initiate the re-authentication or re-authorization procedure for the UE supporting UAS services as a part of network-initiated EPS bearer context modification procedure. If UUAA-SM fails during the re-authentication or a re-authorization procedure, or if the revocation of UUAA is initiated by the network, then the associated PDN connection for USS communication is released.\nThe network supports C2 communication authorization for pairing of UAV and UAV-C. The pairing of UAV and UAV-C needs to be authorized by USS successfully before the user plane connectivity for C2 communication (over Uu or over NR-PC5) is enabled. The UE supporting UAS services may provide the network with an identification information of UAV-C to pair with, if available, via the protocol configuration options as follows:\n-\tIf the UE uses a common PDN connectivity for both USS communication and C2 communication with a UAV-C, the C2 communication with the UAV-C can be authorized using UUAA-SM procedure during the PDN connectivity procedure or during the bearer resource modification procedure. If the pairing of UAV and UAV-C is revoked, the network shall disable C2 communication for the PDN connection.\nNOTE 1:\tThe network can disable C2 communication for the PDN connection e.g., by removing the packet filter(s) allocated for C2 communication during EPS bearer context modification procedure as specified in clause 6.4.3 or by deactivating the EPS bearer context for C2 communication during EPS bearer context deactivation procedure as specified in clause 6.4.4.\n-\tIf the UE uses separate PDN connectivity for, respectively, USS communication and C2 communication with a UAV-C, the C2 communication with the UAV-C is authorized using UUAA-SM during the PDN connectivity procedure. If the pairing of UAV and UAV-C is revoked, the PDN connectivity or C2 communication shall be released by the network.\nThe authorization of direct C2 communication can be performed during the C2 communication authorization procedure.\nNOTE 2:\tThe C2 authorization payload in the service-level-AA payload, sent to the network via the protocol configuration options, can include an indication of the request for direct C2 communication and pairing information for direct C2 communication (see subclauses 6.4.3.3 and 6.5.1.2).\nThe authorization of UAV flight can also be performed during the C2 communication authorization procedure. The UE supporting UAS services provides flight authorization information to the network via the protocol configuration options if the flight authorization information is already available in the UE.\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.14\tHandling of URSP provisioning",
                            "text_content": "The UE can perform the UE requested PDN connectivity procedure to transport the URSP provisioning in EPS support indicator as specified in 3GPP TS 24.008 [13] from the UE to the network and a related URSP provisioning in EPS support indicator from the network to the UE. The successful exchange of the URSP provisioning in EPS support indicators, if the extended protocol configuration options is supported by the network and the UE end-to-end for the PDN connection as specified in subclause 6.6.1.1, enables the UE to thereafter perform the UE requested bearer resource modification procedure to transport a UE policy container with the length of two octets as specified in 3GPP TS 24.008 [13] from the UE to the network to transfer the UE STATE INDICATION message as specified in 3GPP TS 24.501 [54] annex D.\nThereafter, the network can initiate the EPS bearer context modification procedure or the dedicated EPS bearer context activation procedure to transport UE policy container with the length of two octets as specified in 3GPP TS 24.008 [13] from the network to the UE. The UE can transport UE policy container with the length of two octets from the UE to the network using the EPS bearer context modification procedure or the dedicated EPS context activation procedure. The UE policy container with the length of two octets enable the transfer of the messages specified in 3GPP TS 24.501 [54] annex D.\nIf the UE while in N1 mode has indicated support for URSP provisioning in EPS as specified in 3GPP TS 24.501 [54] annex D, the UE performs inter-system change from N1 mode to S1 mode, the UE has not yet provided a UE policy container with the length of two octets to the network as specified in 3GPP TS 24.008 [13] during the dedicated EPS bearer context activation procedure, or EPS bearer context modification procedure, then the network can send a UE policy container with the length of two octets to the UE as specified in 3GPP TS 24.008 [13] during the dedicated EPS bearer context activation procedure, or EPS bearer context modification procedure on any PDN connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.4\tNetwork initiated ESM procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.4.1\tDefault EPS bearer context activation procedure",
                            "text_content": "The purpose of the default bearer context activation procedure is to establish a default EPS bearer context between the UE and the EPC. The default EPS bearer context activation procedure is initiated by the network as a response to the PDN CONNECTIVITY REQUEST message from the UE. The default bearer context activation procedure can be part of the attach procedure, and if the attach procedure fails, the UE shall consider that the default bearer activation has implicitly failed. The default EPS bearer context does not have any TFT assigned during the activation procedure. This corresponds to using a match-all packet filter. The network may at any time after the establishment of this bearer assign a TFT to the default EPS bearer and may subsequently modify the TFT or the packet filters of this default bearer.\nThe MME shall initiate the default bearer context activation procedure by sending an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and enter the state BEARER CONTEXT ACTIVE PENDING (see example in figure 6.4.1.2.1). When the default bearer is activated as part of the attach procedure, the MME shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message together with ATTACH ACCEPT and shall not start the timer T3485. When the default bearer is activated as the response to a stand-alone PDN CONNECTIVITY REQUEST message apart from the attach procedure, the MME shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message alone, and start the timer T3485.\nThe MME shall assign and include an EPS bearer identity in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message selecting a value as specified by clause 9.3.2. The MME shall retrieve the PTI from the PDN CONNECTIVITY REQUEST message and include it in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. Both the network identifier part and the operator identifier part shall be included in the Access Point Name IE.\nThe figure depicts the default EPS bearer context activation procedure, which is a crucial step in the EPS bearer context activation process. The figure shows the steps involved in activating the EPS bearer context, including the selection of the EPS bearer, the initiation of the context, and the completion of the context activation. This procedure is essential for ensuring the proper functioning of the EPS bearer context and is a critical component of the EPS bearer context activation process.\nFigure 6.4.1.2.1: Default EPS bearer context activation procedure\nUpon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396 if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop the timer T3396 associated with no APN if it is running. If the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message was received in response to a request for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then send an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message and enter the state BEARER CONTEXT ACTIVE. When the default bearer is activated as part of the attach procedure, the UE shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message together with ATTACH COMPLETE message. When the default bearer is activated as the response to the stand-alone PDN CONNECTIVITY REQUEST message, the UE shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message alone.\nIf a WLAN offload indication information element is included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the WLAN offload acceptability values for this PDN connection and use the E-UTRAN offload acceptability value to determine whether this PDN connection is offloadable to WLAN or not.\nThe UE checks the PTI in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to identify the UE requested PDN connectivity procedure to which the default bearer context activation is related (see clause 6.5.1).\nIf the UE receives a serving PLMN rate control IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the serving PLMN rate control IE value and use the stored serving PLMN rate control value as the maximum allowed limit of uplink User data container IEs included in ESM DATA TRANSPORT messages for the corresponding PDN connection in accordance with 3GPP TS 23.401 [10].\nIf the UE receives an APN rate control parameters container in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.\nIf the UE receives an additional APN rate control parameters for exception data container in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.\nIf the UE receives a small data rate control parameters container in the Protocol configuration options IE or the Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58].\nIf the UE receives an additional small data rate control parameters for exception data container in the Protocol configuration options IE or the Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58].\nIf the UE receives non-IP Link MTU parameter, Ethernet Frame Payload MTU parameter, IPv4 Link MTU parameter, or Unstructured Link MTU parameter of the Protocol configuration options IE or of the Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall pass the received Non-IP Link MTU size, Ethernet Frame Payload MTU size, or IPv4 Link MTU size, or Unstructured Link MTU size to the upper layer.\nNOTE 1:\tThe Non-IP Link MTU and the IPv4 Link MTU size correspond to the maximum length of user data that can be sent either in the user data container in the ESM DATA TRANSPORT message or via S1-U interface.\nNOTE 2:\tThe Ethernet frame payload MTU size corresponds to the maximum length of a payload of an Ethernet frame that can be sent either in the user data container in the ESM DATA TRANSPORT message or via S1-U interface.\nNOTE 3:\tA PDN connection of non-IP PDN type can be transferred to a PDU session of \"Unstructured\" PDU session type, thus the UE can request the unstructured link MTU parameter in the default EPS bearer context activation procedure. The unstructured link MTU size correspond to the maximum length of user data packet that can be sent either via the control plane or via N3 interface for a PDU session of the \"Unstructured\" PDU session type as specified in 3GPP TS 24.501 [54].\nIf the UE receives the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message containing the Uplink data not allowed parameter in the Extended protocol configuration options IE, then the UE shall not send any uplink user data over EPS bearer context(s) of the corresponding PDN connection.\nUpon receiving the DNS server security information, the UE shall pass it to the upper layer. The UE shall use this information to send the DNS over (D)TLS (See 3GPP TS 33.501 [24]).\nNOTE 4:\tSupport of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.501 [24].\nIf the UE supports provisioning of ECS configuration information to the EEC in the UE, then upon receiving:\n-\tat least one of ECS IPv4 address(es), ECS IPv6 address(es), ECS FQDN(s);\n-\tat least one associated ECSP identifier; and\n-\toptionally spatial validity conditions associated with the ECS address\nin the Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall pass them to the upper layers.\nNOTE 5:\tThe IP address(es) and/or FQDN(s) are associated with the ECSP identifier and replace previously provided ECS configuration information associated with the same ECSP identifier, if any.\nUpon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message, the MME shall enter the state BEARER CONTEXT ACTIVE and stop the timer T3485, if the timer is running. If the PDN CONNECTIVITY REQUEST message included a low priority indicator set to \"MS is configured for NAS signalling low priority\", the MME shall store the NAS signalling low priority indication within the default EPS bearer context.\nIf the UE indicated the URSP provisioning in EPS support indicator as specified in 3GPP TS 24.008 [13] in the UE requested PDN connectivity procedure establishing the PDN connection, and the Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message contains the URSP provisioning in EPS support indicator, then the UE shall perform the UE requested bearer resource modification procedure to provide a UE policy container with the length of two octets containing the UE STATE INDICATION message (see 3GPP TS 24.501 [54] annex D), otherwise the UE shall not perform the UE requested bearer resource modification procedure to provide a UE policy container with the length of two octets containing the UE STATE INDICATION message (see 3GPP TS 24.501 [54] annex D).\nIf the default EPS bearer context activation is part of the attach procedure, the ESM sublayer shall notify the EMM sublayer of an ESM failure. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the ESM sublayer shall additionally provide an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message to the EMM sublayer.\nIf the default EPS bearer context activation is not part of the attach procedure, the UE shall send an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message and enter the state BEARER CONTEXT INACTIVE.\nThe ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following cause values:\n#26:\tinsufficient resources;\n#31:\trequest rejected, unspecified; or\n#95 – 111:\tprotocol errors.\nUpon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message, the MME shall enter the state BEARER CONTEXT INACTIVE and stop the timer T3485, if the timer is running.\nThe following abnormal cases can be identified:\na)\tDefault EPS bearer context activation request for an already activated default EPS bearer context:\nIf the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, the UE shall locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, if any, and proceed with the requested default EPS bearer context activation.\nb)\tDefault EPS bearer context activation request for an already activated dedicated EPS bearer context:\nIf the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, the UE shall locally deactivate the existing dedicated EPS bearer context and proceed with the requested default EPS bearer context activation.\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3485:\nOn the first expiry of the timer T3485, the MME shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3485. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3485, the MME shall release possibly allocated resources for this activation and shall abort the procedure.\nb)\tLower layer indicates that the HeNB rejected the establishment of the default bearer (see 3GPP TS 36.413 [23]) for a LIPA PDN connection or SIPTO at the local network PDN connection due to a triggered handover:\nThe MME shall enter the state BEARER CONTEXT INACTIVE, stop timer T3485 and reject the PDN connectivity request procedure including the ESM cause value #34 \"service option temporarily out of order\" in the PDN CONNECTIVITY REJECT message. The MME shall release possibly allocated resources for this activation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.2\tDedicated EPS bearer context activation procedure",
                            "text_content": "The purpose of the dedicated EPS bearer context activation procedure is to establish an EPS bearer context with specific QoS and TFT between the UE and the EPC.\nThe network may initiate the dedicated EPS bearer context activation procedure to enable transport of a UE policy container with the length of two octets from the network to the UE and a related UE policy container with the length of two octets from the UE to the network. The UE policy containers with the length of two octets enable transfer of messages of the network-requested UE policy management procedure as specified in 3GPP TS 24.501 [54] annex D.\nIn WB-S1 mode, the dedicated EPS bearer context activation procedure is initiated by the network, but may be requested by the UE by means of the UE requested bearer resource allocation procedure (see clause 6.5.3) or the UE requested bearer resource modification procedure (see clause 6.5.4). The dedicated bearer context activation procedure can be part of the attach procedure or be initiated together with the default EPS bearer context activation procedure when the UE initiated stand-alone PDN connectivity procedure. If the attach procedure or the default EPS bearer context activation procedure fails, the UE shall consider that the dedicated bearer activation has implicitly failed. The network may initiate the dedicated EPS bearer context activation procedure together with the completion of the service request procedure.\nIn NB-S1 mode, the dedicated EPS bearer contexts activation procedure is not used.\nUpon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode, if the UE has at least one dedicated EPS bearer context in ESM state BEARER CONTEXT ACTIVE, the UE shall locally deactivate any such dedicated EPS bearer context and shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message.\nUpon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode, the UE shall set each mapped dedicated EPS bearer context, if any, to ESM state BEARER CONTEXT INACTIVE and shall then include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message.\nNOTE:\t3GPP TS 23.060 [74] clause 9.3 specifies that a packet filter applicable for the downlink direction is not mandatory in a TFT.\nIn WB-S1 mode, the MME shall initiate the dedicated bearer context activation procedure by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, start the timer T3485, and enter the state BEARER CONTEXT ACTIVE PENDING (see example in figure 6.4.2.2.1).\nThe MME allocates the EPS bearer identity selecting a value as specified by clause 9.3.2, and includes it in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. The MME shall include the EPS bearer identity of the associated default bearer as the linked EPS bearer identity in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. If this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST respectively.\nThe figure depicts the context activation procedure for a dedicated EPS bearer in a network. It illustrates the steps involved in activating an EPS bearer, including the selection of the appropriate bearer, the configuration of the bearer, and the activation of the bearer. The figure provides a clear and concise visual representation of the procedure, making it easy to understand and follow.\nFigure 6.4.2.2.1: Dedicated EPS bearer context activation procedure\nUpon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396, if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop the timer T3396 associated with no APN if it is running. If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then check the received TFT before taking it into use, send an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message and enter the state BEARER CONTEXT ACTIVE. The ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message shall include the EPS bearer identity.\nThe linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message indicates to the UE to which default bearer, IP address and PDN the dedicated bearer is linked.\nIf the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than \"no procedure transaction identity assigned\" and \"reserved\" (see 3GPP TS 24.007 [12]), the UE uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the dedicated bearer context activation is related.\nIf the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than \"no procedure transaction identity assigned\" and \"reserved\" (see 3GPP TS 24.007 [12]) and the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the UE shall release the traffic flow aggregate description associated to the PTI value provided.\nThe UE shall use the received TFT to apply mapping of uplink traffic flows to the radio bearer.\nThe UE shall treat any packet filter without explicit direction as being bi-directional.\nIf the UE receives an APN rate control parameters container in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.\nIf the UE receives an additional APN rate control parameters for exception data container in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.\nIf the UE receives a small data rate control parameters container in the Protocol configuration options IE or the Extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58]. If the UE has a previously stored small data rate control parameters value for this PDU session, the UE shall replace the stored small data rate control parameters value for this PDU Session with the received small data rate control parameters value.\nIf the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58]. If the UE has a previously stored additional small data rate control parameters for exception data value for this PDU session, the UE shall replace the stored additional small data rate control parameters for exception data value for this PDU session with the received additional small data rate control parameters for exception data value.\nIf the UE receives QoS rule(s) of the 5GS QoS flow(s), which corresponds to the dedicated EPS bearer being activated, in the Protocol configuration options IE or the Extended protocol configuration options IE of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE stores the QoS rule(s) for use during inter-system change from S1 mode to N1 mode.\nUpon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, if the UE indicated the URSP provisioning in EPS support indicator as specified in 3GPP TS 24.008 [13] in the UE requested PDN connectivity procedure establishing the PDN connection, and the UE policy container with the length of two octets as defined in 3GPP TS 24.008 [13] is included in the Extended protocol configuration options IE of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message:\na)\tthe UE shall forward the UE policy container with the length of two octets to the UE policy delivery service (see 3GPP TS 24.501 [54] annex D); and\nb)\tupon receipt of a UE policy container with the length of two octets from the UE policy delivery service, the UE shall include the UE policy container with the length of two octets from the UE policy delivery service in the Extended protocol configuration options IE of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nEditor's note:\t(WI: eUEPO, CR: 3936) URSP provisioning in EPS in a PDN connection interworked from a PDU session, is FFS.\nUpon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message, the MME shall stop the timerT3485 and enter the state BEARER CONTEXT ACTIVE.\nUpon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE may reject the request from the MME by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message. The message shall include the EPS bearer identity and an ESM cause value indicating the reason for rejecting the dedicated EPS bearer context activation request.\nThe ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following ESM cause values:\n#26:\tinsufficient resources;\n#31:\trequest rejected, unspecified;\n#41:\tsemantic error in the TFT operation;\n#42:\tsyntactical error in the TFT operation;\n#43:\tinvalid EPS bearer identity;\n#44:\tsemantic error(s) in packet filter(s);\n#45:\tsyntactical error(s) in packet filter(s); or\n#95 – 111:\tprotocol errors.\nThe UE shall check the TFT in the request message for different types of TFT IE errors as follows:\na)\tSemantic errors in TFT operations:\n1)\tWhen the TFT operation is an operation other than \"Create a new TFT\"\nThe UE shall reject the activation request with ESM cause #41 \"semantic error in the TFT operation\".\nb)\tSyntactical errors in TFT operations:\n1)\tWhen the TFT operation = \"Create a new TFT\" and the packet filter list in the TFT IE is empty.\n2)\tWhen there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.\nThe UE shall reject the activation request with ESM cause #42 \"syntactical error in the TFT operation\".\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\n2)\tWhen the resulting TFT does not contain any packet filter which applicable for the uplink direction.\nThe UE shall reject the activation request with ESM cause #44 \"semantic errors in packet filter(s)\".\nd)\tSyntactical errors in packet filters:\n1)\tWhen the TFT operation = \"Create a new TFT\" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.\n2)\tWhen the TFT operation = \"Create a new TFT\" and two or more packet filters in all TFTs associated with this PDN connection would have identical packet filter precedence values.\n3)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\nIn case 2, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error, shall further process the new activation request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, by means of explicit peer-to-peer signalling between the network and the UE, the UE shall perform a UE requested bearer resource modification procedure to delete the packet filters in the network corresponding to the packet filters it has deleted on the UE side.\nIn case 2, if one or more old packet filters belong to the default EPS bearer context, the UE shall release the relevant PDN connection. If the relevant PDN connection is the last one that the UE has and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall detach and re-attach to the network.\nIn cases 1 and 3 the UE shall reject the activation request with ESM cause #45 \"syntactical errors in packet filter(s)\".\nUpon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message in state BEARER CONTEXT ACTIVE PENDING, the MME shall stop the timer T3485, enter the state BEARER CONTEXT INACTIVE and abort the dedicated EPS bearer context activation procedure. The MME also requests the lower layer to release the radio resources that were established during the dedicated EPS bearer context activation procedure.\nThe following abnormal cases can be identified:\na)\tDedicated EPS bearer context activation request for an already activated default EPS bearer context:\nIf the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, the UE shall locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, if any, and proceed with the requested dedicated EPS bearer context activation.\nb)\tDedicated EPS bearer context activation request for an already activated dedicated EPS bearer context\nIf the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, the UE shall locally deactivate the existing dedicated EPS bearer context and proceed with the requested dedicated EPS bearer context activation.\nc)\tNo default EPS bearer context with linked EPS bearer identity activated\nIf the linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message does not match the EPS bearer identity of any activated default EPS bearer context, the UE shall reply with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #43 \"invalid EPS bearer identity\".\nd)\tDedicated EPS bearer context activation request when the PLMN's maximum number of EPS bearer contexts in S1 mode is reached at the UE:\nIf the PLMN's maximum number of EPS bearer contexts in S1 mode is reached at the UE and the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall clear the determination representing the PLMN's maximum number of EPS bearer contexts in S1 mode and proceed with the dedicated EPS bearer context activation procedure.\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3485:\nOn the first expiry of the timer T3485, the MME shall resend the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3485. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3485, the MME shall abort the procedure, release any resources allocated for this activation and enter the state BEARER CONTEXT INACTIVE.\nb)\tCollision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure:\nWhen the MME receives a PDN DISCONNECT REQUEST message during the dedicated EPS bearer context activation procedure, and the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, the MME shall terminate the dedicated bearer context activation procedure locally, release any resources related to this procedure and proceed with the PDN disconnect procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.3\tEPS bearer context modification procedure",
                            "text_content": "The purpose of the EPS bearer context modification procedure is to modify an EPS bearer context with a specific QoS and TFT, or re-negotiate header compression configuration associated to an EPS bearer context. The EPS bearer context modification procedure is initiated by the network, but it may also be initiated as part of the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure.\nThe network may also initiate the EPS bearer context modification procedure to update the APN-AMBR of the UE, for instance after an inter-system handover. See 3GPP TS 23.401 [10] annex E.\nThe MME may also initiate the EPS bearer context modification procedure to update the WLAN offload indication to the UE, for instance after the MME received an updated WLAN offload indication of a PDN Connection from HSS. See 3GPP TS 23.401 [10] clause 4.3.23.\nThe MME may also initiate the EPS bearer context modification procedure to update information required for inter-system change from S1 mode to N1 mode (e.g. session-AMBR, QoS rule(s)). See 3GPP TS 24.501 [54].\nThe network may initiate the EPS bearer context modification procedure together with the completion of the service request procedure.\nThe network may initiate the EPS bearer context modification procedure to initiate the procedure for the UUAA-SM for the UAS services.\nThe network may initiate the EPS bearer context modification procedure to enable transport of a UE policy container with the length of two octets from the network to the UE and a related UE policy container with the length of two octets from the UE to the network. The UE policy containers with the length of two octets enable transfer of messages of the network-requested UE policy management procedure as specified in 3GPP TS 24.501 [54] annex D.\nThe MME shall initiate the EPS bearer context modification procedure by sending a MODIFY EPS BEARER CONTEXT REQUEST message to the UE, starting the timer T3486, and entering the state BEARER CONTEXT MODIFY PENDING (see example in figure 6.4.3.2.1).\nThe MME shall include an EPS bearer identity that identifies the EPS bearer context to be modified in the MODIFY EPS BEARER CONTEXT REQUEST message.\nIf this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the MODIFY EPS BEARER CONTEXT REQUEST shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST message respectively.\nIf the UE indicated \"Control plane CIoT EPS optimization supported\" and \"Header compression for control plane CIoT EPS optimization supported\" in the UE network capability IE in the latest ATTACH REQUEST message or the TRACKING AREA UPDATE REQUEST message, and the MME supports Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization, the MME may include the Header compression configuration IE in the MODIFY EPS BEARER CONTEXT REQUEST message to re-negotiate header compression configuration associated to an EPS bearer context.\nThe figure depicts the context modification procedure for EPS bearer context in a network. It illustrates the steps involved in modifying the context of an EPS bearer, which is a type of bearer used in IP networks. The figure shows the process of changing the context of an EPS bearer, which is a crucial step in network management and troubleshooting. The figure provides a visual representation of the process, making it easier to understand and follow.\nFigure 6.4.3.2.1: EPS bearer context modification procedure\nUpon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396, if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop the timer T3396 associated with no APN if it is running. If the MODIFY EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then check the received TFT before taking it into use and send a MODIFY EPS BEARER CONTEXT ACCEPT message to the MME.\nIf the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value other than \"no procedure transaction identity assigned\" and \"reserved\" (see 3GPP TS 24.007 [12]), the UE uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the EPS bearer context modification is related (see clause 6.5.3 and clause 6.5.4).\nIf the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value other than \"no procedure transaction identity assigned\" and \"reserved\" (see 3GPP TS 24.007 [12]) and the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the UE shall release the traffic flow aggregate description associated to the PTI value provided.\nIf the EPS bearer context that is modified is a GBR bearer and the MODIFY EPS BEARER CONTEXT REQUEST message does not contain the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) values for uplink and downlink, the UE shall continue to use the previously received values for the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) for the corresponding bearer.\nThe UE shall use the received TFT to apply mapping of uplink traffic flows to the radio bearer if the TFT contains packet filters for the uplink direction.\nIf a WLAN offload indication information element is included in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the WLAN offload acceptability values for this PDN connection and use the E-UTRAN offload acceptability value to determine whether this PDN connection is offloadable to WLAN or not.\nIf the UE receives an APN rate control parameters container in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.\nIf the UE receives an additional APN rate control parameters for exception data container in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.\nIf the UE receives a small data rate control parameters container in the Protocol configuration options IE or the Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58]. If the UE has a previously stored small data rate control parameters value for this PDU session, the UE shall replace the stored small data rate control parameters value for this PDU Session with the received small data rate control parameters value.\nIf the UE receives an additional small data rate control parameters for exception data container in the Protocol configuration options IE or the Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP TS 23.501 [58]. If the UE has a previously stored additional small data rate control parameters for exception data value for this PDU session, the UE shall replace the stored additional small data rate control parameters for exception data value for this PDU session with the received additional small data rate control parameters for exception data value.\nUpon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s) in the Protocol configuration options IE or the Extended protocol configuration options IE, the UE stores the session-AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode.\nIf the UE receives the MODIFY EPS BEARER CONTEXT REQUEST message containing the Uplink data allowed parameter in the Extended protocol configuration options IE, then the UE may start transmitting uplink user data over EPS bearer context(s) of the corresponding PDN connection.\nThe MODIFY EPS BEARER CONTEXT REQUEST message as a part of authorization procedure for the C2 communication, can include an Extended protocol configuration options IE containing the service-level-AA container with the length of two octets. The service-level-AA container with the length of two octets:\na)\tcontains the service-level-AA response with the C2AR field set to the C2 authorization result informed by the UAS NF;\nb)\tcan contain the service-level-AA payload parameter set to the C2 authorization payload and the service-level-AA payload type parameter set to \"C2 authorization payload\"; and\nc)\tcan contain the service-level device ID with the value set to a new CAA-level UAV ID.\nNOTE 1:\tThe C2 authorization payload in the service-level-AA payload can include one, some or all of the pairing information for C2 communication, the C2 session security information, and the pairing information for direct C2 communication.\nIf the EPS bearer context being modified is associated with a PDN connection for UAS services and the MODIFY EPS BEARER CONTEXT REQUEST message includes the service-level-AA container with the length of two octets in the Extended protocol configuration options IE, the UE supporting UAS services shall forward the contents of the service-level-AA container with the length of two octets to the upper layers.\nIf the EPS bearer context being modified is associated with a PDN connection for UAS services, the MODIFY EPS BEARER CONTEXT REQUEST message includes the Extended protocol configuration options IE containing the service-level-AA container with the length of two octets containing the service-level-AA response parameter with the SLAR field set to \"Service level authentication and authorization was successful\", the UE supporting UAS services:\na)\tshall consider the UUAA procedure as successfully completed and provide the service-level-AA response to the upper layers;\nb)\tif the service-level-AA container with the length of two octets contains the service-level device ID parameter carrying a CAA-level UAV ID, shall provide the CAA-level UAV ID to the upper layers; and\nc)\tif the service-level-AA container with the length of two octets contains the service-level-AA payload type parameter with the value \"UUAA payload\" and the service-level-AA payload parameter carrying the UUAA payload, shall provide the UUAA payload to the upper layers.\nUpon reception of a service-level-AA payload from the upper layers, the UE supporting UAS services shall include the Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT ACCEPT message. In the Extended protocol configuration options IE, the UE shall include the service-level-AA container with the length of two octets. In the service-level-AA container with the length of two octets, the UE shall:\na)\tinclude the service-level-AA payload parameter set to the service-level-AA payload received from the upper layers; and\nb)\tset the service-level-AA payload type parameter to the type of the service-level-AA payload.\nUpon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, if the SDNAEPC EAP message with the length of two octets is included in the Extended protocol configuration options IE, the UE supporting secondary DN authentication and authorization over EPC shall forward the SDNAEPC EAP message with the length of two octets to the upper layers.\nUpon reception of an SDNAEPC EAP message with the length of two octets from the upper layers and if the UE has received an SDNAEPC EAP message with the length of two octets included in the Extended protocol configuration options IE of the MODIFY EPS BEARER CONTEXT REQUEST message from the network, the UE supporting secondary DN authentication and authorization over EPC shall include the Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT ACCEPT message and include the SDNAEPC EAP message with the length of two octets in the Extended protocol configuration options IE.\nIf the UE supports provisioning of ECS configuration information to the EEC in the UE, then upon receiving:\n-\tat least one of ECS IPv4 address(es), ECS IPv6 address(es), ECS FQDN(s);\n-\tat least one associated ECSP identifier; and\n-\toptionally spatial validity conditions associated with the ECS address\nin the Extended protocol configuration options IE of the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall pass them to the upper layers.\nNOTE 2:\tThe IP address(es) and/or FQDN(s) are associated with the ECSP identifier and replace previously provided ECS configuration information associated with the same ECSP identifier, if any.\nUpon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, if the UE indicated the URSP provisioning in EPS support indicator as specified in 3GPP TS 24.008 [13] in the UE requested PDN connectivity procedure establishing the PDN connection, and the UE policy container with the length of two octets as defined in 3GPP TS 24.008 [13] is included in the Extended protocol configuration options IE of the MODIFY EPS BEARER CONTEXT REQUEST message:\na)\tthe UE shall forward the UE policy container with the length of two octets to the UE policy delivery service (see 3GPP TS 24.501 [54] annex D); and\nb)\tupon receipt of a UE policy container with the length of two octets from the UE policy delivery service, the UE shall include the UE policy container with the length of two octets from the UE policy delivery service in the Extended protocol configuration options IE of the MODIFY EPS BEARER CONTEXT ACCEPT message.\nEditor's note:\t(WI: eUEPO, CR: 3934) URSP provisioning in EPS in a PDN connection interworked from a PDU session, is FFS.\nUpon receipt of the MODIFY EPS BEARER CONTEXT ACCEPT message, the MME shall stop the timer T3486 and enter the state BEARER CONTEXT ACTIVE.\nUpon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, the UE may reject the request from the MME by sending a MODIFY EPS BEARER CONTEXT REJECT message to the MME. The message shall include the EPS bearer identity and an ESM cause value indicating the reason for rejecting the EPS bearer context modification request.\nThe MODIFY EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following ESM cause values:\n#26:\tinsufficient resources;\n#41:\tsemantic error in the TFT operation;\n#42:\tsyntactical error in the TFT operation;\n#43:\tinvalid EPS bearer identity;\n#44:\tsemantic error(s) in packet filter(s);\n#45:\tsyntactical error(s) in packet filter(s); or\n#95 – 111:\tprotocol errors.\nThe UE shall check the TFT in the request message for different types of TFT IE errors as follows:\na)\tSemantic errors in TFT operations:\n1)\tTFT operation = \"Create a new TFT\" when there is already an existing TFT for the EPS bearer context.\n2)\tWhen the TFT operation is an operation other than \"Create a new TFT\", the EPS bearer context being modified is the default EPS bearer content and there is no TFT for the default EPS bearer context.\n3)\tTFT operation = \"Delete packet filters from existing TFT\" when it would render the TFT empty.\n4)\tTFT operation = \"Delete existing TFT\" for a dedicated EPS bearer context.\nIn case 4 the UE shall reject the modification request with ESM cause #41 \"semantic error in the TFT operation\".\nIn the other cases the UE shall not diagnose an error and perform the following actions to resolve the inconsistency:\nIn case 1 the UE shall further process the new activation request to create a new TFT and, if it was processed successfully, delete the old TFT.\nIn case 2 the UE shall:\n-\tprocess the new request and if the TFT operation is \"Delete existing TFT\" or \"Delete packet filters from existing TFT\", and if no error according to items b, c, and d was detected, consider the TFT as successfully deleted;\n-\tprocess the new request as an activation request, if the TFT operation is \"Add packet filters in existing TFT\" or \"Replace packet filters in existing TFT\".\nIn case 3, if the packet filters belong to a dedicated EPS bearer context, the UE shall process the new deletion request and, if no error according to items b, c, and d was detected, the UE shall reject the modification request with ESM cause #41 \"semantic error in the TFT operation\".\nIn case 3, if the packet filters belong to the default EPS bearer context, the UE shall process the new deletion request and if no error according to items b, c, and d was detected then delete the existing TFT, this corresponds to using match-all packet filter for the default EPS bearer context.\nb)\tSyntactical errors in TFT operations:\n1)\tWhen the TFT operation = \"Create a new TFT\", \"Add packet filters in existing TFT\", \"Replace packet filters in existing TFT\" or \"Delete packet filters from existing TFT\" and the packet filter list in the TFT IE is empty.\n2)\tTFT operation = \"Delete existing TFT\" or \"No TFT operation\" with a non-empty packet filter list in the TFT IE.\n3)\tTFT operation = \"Replace packet filters in existing TFT\" when the packet filter to be replaced does not exist in the original TFT.\n4)\tTFT operation = \"Delete packet filters from existing TFT\" when the packet filter to be deleted does not exist in the original TFT.\n5)\tVoid.\n6)\tWhen there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.\nIn case 3 the UE shall not diagnose an error, further process the replace request and, if no error according to items c and d was detected, include the packet filters received to the existing TFT.\nIn case 4 the UE shall not diagnose an error, further process the deletion request and, if no error according to items c and d was detected, consider the respective packet filter as successfully deleted.\nOtherwise the UE shall reject the modification request with ESM cause #42 \"syntactical error in the TFT operation\".\nNOTE:\tAn implementation that strictly follows packet filter list as defined in subclause 10.5.6.12 in 3GPP TS 24.008 [13] might not detect case 2).\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\n2)\tWhen the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction among the packet filters created on request from the network.\nThe UE shall reject the modification request with ESM cause #44 \"semantic errors in packet filter(s)\".\nd)\tSyntactical errors in packet filters:\n1)\tWhen the TFT operation = \"Create a new TFT\", \"Add packet filters to existing TFT\", or \"Replace packet filters in existing TFT\" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.\n2)\tWhen the TFT operation = \"Create a new TFT\", \"Add packet filters to existing TFT\" or \"Replace packet filters in existing TFT\", and two or more packet filters among all TFTs associated with this PDN connection would have identical packet filter precedence values.\n3)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\nIn case 1, if two or more packet filters with identical packet filter identifiers are contained in the new request, the UE shall reject the modification request with ESM cause #45 \"syntactical errors in packet filter(s)\". Otherwise, the UE shall not diagnose an error, further process the new request and, if it was processed successfully, delete the old packet filters which have the identical packet filter identifiers.\nIn case 2, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the UE shall perform a UE requested bearer resource modification procedure to delete the packet filters in the network corresponding to the packet filters it has deleted on the UE side.\nIn case 2, if one or more old packet filters belong to the default EPS bearer context, the UE shall release the relevant PDN connection. If the relevant PDN connection is the last one that the UE has and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall detach and re-attach to the network.\nOtherwise the UE shall reject the modification request with ESM cause #45 \"syntactical errors in packet filter(s)\".\nUpon receipt of the MODIFY EPS BEARER CONTEXT REJECT message with ESM cause value other than #43 \"invalid EPS bearer identity\" in state BEARER CONTEXT MODIFY PENDING, the MME shall stop the timer T3486, enter the state BEARER CONTEXT ACTIVE and abort the EPS bearer context modification procedure. If the network receives the MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #43 \"invalid EPS bearer identity\", the MME locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling. When the MME detects that after the failed EPS bearer context modification there is a misalignment between the EPS bearer configuration and the EPS bearer context configuration or between the QoS on NAS and AS level, the MME should initiate the necessary procedures to achieve a re-alignment.\nApart from the case described in clause 6.3.3, the following abnormal cases can be identified:\na)\tCollision of UE requested bearer resource modification procedure and EPS bearer context modification procedure:\nIf the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message during the UE requested bearer resource modification procedure, the Procedure transaction identity IE of the MODIFY EPS BEARER CONTEXT REQUEST message is set to \"No procedure transaction identity assigned\" and the EPS bearer indicated in the MODIFY EPS BEARER CONTEXT REQUEST message is the EPS bearer that the UE had requested to modify, the UE shall abort internally the UE requested bearer resource modification procedure, and:\n-\tif the UE had initiated resource release for all the traffic flows for the bearer and the UE still needs to release the bearer (e.g. the TFT is empty due to error cases described in subclause 6.4.2.4 or subclause 6.4.3.4), the UE may proceed with the EPS bearer context modification procedure (i.e. respond with a MODIFY EPS BEARER CONTEXT ACCEPT message or a MODIFY EPS BEARER CONTEXT REJECT message) and deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME. In order to synchronize the EPS bearer context status with the MME, the UE may send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME; or\n-\totherwise, the UE shall enter the state BEARER CONTEXT ACTIVE and proceed with the EPS bearer context modification procedure.\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3486:\nOn the first expiry of the timer T3486, the MME shall resend the MODIFY EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3486. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3486, the MME shall abort the procedure and enter the state BEARER CONTEXT ACTIVE.\nThe MME may continue to use the previous configuration of the EPS bearer context or initiate an EPS bearer context deactivation procedure.\nb)\tCollision of UE requested PDN disconnect procedure and EPS bearer context modification:\nWhen the MME receives a PDN DISCONNECT REQUEST message during an EPS bearer context modification procedure, and the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, the MME shall terminate the EPS bearer context modification procedure locally, release any resources related to this procedure and proceed with the PDN disconnect procedure.\nc)\tCollision of UE requested bearer resource modification procedure and EPS bearer context modification procedure:\nIf the MME receives a BEARER RESOURCE MODIFICATION REQUEST message during the EPS bearer context modification procedure and the EPS bearer indicated in the BEARER RESOURCE MODIFICATION REQUEST message is the EPS bearer that the network had requested to modify, the network shall ignore the BEARER RESOURCE MODIFICATION REQUEST message received in the state BEATER CONTEXT MODIFY PENDING. The network shall proceed with the EPS bearer modification procedure as if no BEARER RESOURCE MODIFICATION REQUEST message was received from the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.4\tEPS bearer context deactivation procedure",
                            "text_content": "The purpose of the EPS bearer context deactivation procedure is to deactivate an EPS bearer context or disconnect from a PDN by deactivating all EPS bearer contexts to the PDN. The EPS bearer context deactivation procedure is initiated by the network, and it may be triggered by the UE by means of the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure.\nIn the case of EPS bearer context deactivation with reactivation requested for a PDN connection, if no NAS signalling connection exists, the MME follows the procedures for re-establishing the NAS signalling connection and deactivating the EPS bearer contexts to the PDN with reactivation requested, as specified in 3GPP TS 23.401 [10] clauses 5.4.4.1 and 5.10.3 and 3GPP TS 23.380 [33] clause 5.4.2.1.\nIf a UE is receiving emergency bearer services from a CSG cell, and the CSG subscription expires or is removed, the MME shall deactivate all non-emergency EPS bearers if any. The MME shall not deactivate the emergency EPS bearers.\nIf a detach is requested by the HSS for a UE that has bearers for emergency services, the MME shall send a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE for all bearers that are not allocated for emergency services.\nIf a NAS signalling connection exists when the MME initiates the EPS bearer context deactivation procedure, the MME shall initiate the EPS bearer context deactivation procedure by sending a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE, start the timer T3495, and enter the state BEARER CONTEXT INACTIVE PENDING (see example in figure 6.4.4.2.1). The DEACTIVATE EPS BEARER CONTEXT REQUEST message contains an ESM cause typically indicating one of the following:\n#8:\toperator determined barring;\n#26:\tinsufficient resources;\n#29:\tuser authentication or authorization failed;\n#36:\tregular deactivation;\n#38:\tnetwork failure;\n#39:\treactivation requested;\n#112:\tAPN restriction value incompatible with active EPS bearer context; or\n#113:\tMultiple accesses to a PDN connection not allowed.\nIf the deactivation is triggered by a UE initiated bearer resource modification procedure or UE requested PDN disconnect procedure, the DEACTIVATE EPS BEARER CONTEXT REQUEST message shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE MODIFICATION REQUEST or PDN DISCONNECT REQUEST respectively.\nWhen the MME wants to deactivate all EPS bearer contexts of a PDN connection and thus disconnect the UE from the PDN, the MME shall include the EPS bearer identity of the default bearer associated to the PDN in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. In this case, the MME shall not include the WLAN offload indication in the DEACTIVATE EPS BEARER CONTEXT REQUEST message, and if the UE receives the WLAN offload indication, the UE shall ignore the indication.\nNOTE 1:\tIf the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains the UAS services not allowed indication in the Extended protocol configuration options IE, then the ESM cause value #29 \"user authentication or authorization failed\" is included in the DEACTIVATE EPS BEARER CONTEXT REQUEST message.\nIf no NAS signalling connection exists when the MME initiates the EPS bearer context deactivation, the ESM entity in the MME shall locally deactivate the EPS bearer context towards the UE without any peer-to-peer ESM signalling between the MME and the UE.\nNOTE 2:\tThe EPS bearer context state(s) can be synchronized between the UE and the MME at the next EMM-IDLE to EMM-CONNECTED transition, e.g. during a service request or tracking area updating procedure.\nThe figure depicts the context deactivation procedure for EPS bearer context in a network. It illustrates the steps involved in deactivating the EPS bearer context, which is a crucial component in network management and security. The figure includes a flowchart and a list of steps, providing a clear and concise visual representation of the procedure.\nFigure 6.4.4.2.1: EPS bearer context deactivation procedure\nUpon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message, the UE shall delete the EPS bearer context identified by the EPS bearer identity. After deactivating the identified EPS bearer context, the UE shall respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT.\nIf the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST is that of the default bearer to a PDN, the UE shall delete all EPS bearer contexts associated to the PDN. After deactivating all EPS bearer contexts, the UE shall respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT.\nUpon sending the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, the UE shall enter the state BEARER CONTEXT INACTIVE. If due to the EPS bearer context deactivation only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only.\nIf the DEACTIVATE EPS BEARER CONTEXT REQUEST includes ESM cause #39 \"reactivation requested\" and the EPS bearer context is a default EPS bearer context, and the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396 if it is running for the APN provided by the UE. The UE should then re-initiate the UE requested PDN connectivity procedure for the same APN as the deactivated default EPS bearer context to reactivate the EPS bearer context. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop the timer T3396 associated with no APN if it is running, and should re-initiate the UE requested PDN connectivity procedure without including an APN. Additionally, the UE should re-initiate the request(s) for dedicated bearer resources that have been activated on request of the UE and released as a result of this EPS bearer context deactivation procedure. If the DEACTIVATE EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. The UE should then re-initiate the UE requested PDN connectivity procedure for the emergency PDN connection.\nNOTE 1:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer context(s) automatically.\nNOTE 2:\tThe UE behaviour is not specified for the case where the DEACTIVATE EPS BEARER CONTEXT REQUEST includes ESM cause #39 \"reactivation requested\" and the deactivated EPS bearer context was a dedicated EPS bearer context.\nIf the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than \"no procedure transaction identity assigned\" and \"reserved\" (see 3GPP TS 24.007 [12]), the UE uses the PTI to identify the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure to which the EPS bearer context deactivation is related (see clause 6.5.4).\nIf the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than \"no procedure transaction identity assigned\" and \"reserved\" (see 3GPP TS 24.007 [12]), the UE shall release the traffic flow aggregate description associated to the PTI value provided.\nIf the ESM cause value is #26 \"insufficient resources\", the network may include a value for timer T3396 in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. The UE shall take different actions depending on the timer value received for timer T3396 (if the UE is configured for dual priority, exceptions are specified in clause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.5):\ni)\tif the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall start timer T3396 with received value and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or the timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop timer T3396 associated with no APN, if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;\nii)\tif the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 \"reactivation requested\" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE , until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 \"reactivation requested\" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; and\niii)\tif the timer value indicates zero, the UE:\n-\tshall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and\n-\tif the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.\nIf the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3396 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;\n-\tif prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause 6.5.5; and\n-\tif prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause 6.5.5.\nIf the T3396 IE is not included, the UE shall proceed with deactivation procedure and then send DEACTIVATE EPS BEARER CONTEXT ACCEPT message.\nUpon receipt of the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, the MME shall enter the state BEARER CONTEXT INACTIVE and stop the timer T3495.\nThe following abnormal case can be identified:\na)\tUE is requested to deactivate a default EPS bearer context of the last PDN connection:\nIf EMM-REGISTERED without PDN connection is not supported by the UE or the MME, and the UE determines that the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer of the last PDN connection that the UE has, then the UE shall respond by performing a detach procedure. Additionally, the UE should perform an attach procedure.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall proceed with the deactivation procedure as specified in clause 6.4.4.3.\nNOTE:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s), if any, automatically.\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3495:\nOn the first expiry of the timer T3495, the MME shall resend the DEACTIVATE EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3495. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3495, the MME shall abort the procedure and deactivate the EPS bearer context locally without any peer-to-peer ESM signalling between the MME and the UE.\nb)\tCollision of UE requested PDN disconnect procedure and EPS bearer context deactivation:\nWhen the MME receives a PDN DISCONNECT REQUEST message during the EPS bearer context deactivation procedure, and the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, the MME shall proceed with both procedures. If the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer, the MME shall proceed with the EPS bearer context deactivation procedure.\nThe UE and the MME deactivate EPS bearer contexts locally without peer-to-peer ESM signalling in the following cases:\n1)\tduring the service request procedure, if the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts, e.g. due to radio access control (see clause 5.6.1.4 for details);\n1a)\tduring the resume of NAS signalling connection procedure as specified in clause 5.3.1.3, if one or more but not all the suspended user plane radio bearers are resumed;\n2)\tduring the tracking area updating procedure but the network established the user plane radio bearers due to downlink pending data, if the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts indicated active by both UE and network;\nNOTE 1:\tThe synchronisation of the EPS bearers, for which the user plane radio bearers need to be established, indicated in EPS bearer context status information element in TRACKING AREA UPDATE ACCEPT message is not applicable in item 2.\n3)\tduring handover, if the target E-UTRAN does not establish all the user plane radio bearers for the UE;\n4)\tif the E-UTRAN releases one or more user plane radio bearers but not all the user plane radio bearers of the UE due to E-UTRAN specific reasons; or\n5)\tif triggered by an NBIFOM procedure (see 3GPP TS 24.161 [36]), for an NBIFOM multi-access PDN connection.\nFor cases 1) to 4), based on the indication from the lower layers, the UE and the MME shall locally deactivate the EPS bearer contexts for which no user plane radio bearers are set up.\nNOTE 2:\tThe above cases 1) to 4) do not apply for the UE when an RRC connection release occurs. The lower layers in the UE provide the user plane radio bearer context status to the ESM sublayer when a change in the user plane radio bearers is detected by the lower layers including establishment and release of user plane radio bearers for the UE in connected mode.\nNOTE 3:\tThe above cases 1) to 4) do not apply for the MME when the S1 release procedure occurs as specified in 3GPP TS 23.401 [10]).\nIf due to any of the cases described above the UE locally deactivates a default EPS bearer context, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context.\nIf the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall perform a local detach and enter state EMM-DEREGISTERED. If this occurs during a service request procedure for CS fallback, the UE shall reselect to GERAN or UTRAN and continue with the CS service, otherwise the UE shall initiate an attach procedure.\nIf the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall enter state EMM-REGISTERED.\nIf the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services and only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only.\nThe MME shall deactivate the GBR EPS bearer contexts locally without peer-to-peer ESM signalling, when the MME performs locally the release of the S1AP signalling connection due to the S1AP signalling connection is lost. All non-GBR EPS bearers established are preserved in the MME and in the PDN GW.\nIf the E-UTRAN requests the MME to release the S1AP signalling connection, the MME shall deactivate or preserve the GBR EPS bearer contexts according to 3GPP TS 23.401 [10], clause 5.3.5. All non-GBR EPS bearer contexts established are preserved in the MME and in the PDN GW.\nNOTE 4:\tThe UE and the MME will synchronize the EPS bearer contexts subsequently during the next service request procedure, tracking area updating procedure or routing area updating procedure.\nIf due to any of the cases described above the MME locally deactivates a default EPS bearer context, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.\nIf the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the MME shall perform a local detach and enter state EMM-DEREGISTERED.\nIf the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall enter state EMM-REGISTERED.\nFor EPS bearer context deactivation procedure initiated by the network, if no NAS signalling connection exists, the MME locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling In the case of reactivation requested, the MME can perform this local deactivation only when the EMM-entity in the network was unable to re-establish the NAS signalling connection. The EPS bearer context deactivation procedure is not initiated by the network when the MME disconnects the UE from the last remaining PDN to which it is connected and EMM-REGISTERED without PDN connection is not supported by the UE or the MME. In this case, the MME initiates a network initiated detach procedure.\nIf the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services and only the PDN connection for emergency bearer services remains established for the UE, the MME shall consider the UE to be attached for emergency bearer services only.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.5\tUE requested ESM procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.5.0\tGeneral",
                            "text_content": "The UE's maximum number of active EPS bearer contexts in a PLMN is determined by whichever is the lowest of the maximum number of EPS bearer identities allowed by the protocol (as specified in 3GPP TS 24.007 [12] clause 11.2.3.1.5), the PLMN's maximum number of EPS bearer contexts in S1 mode and the UE's implementation-specific maximum number of EPS bearer contexts.\nNOTE 1:\tClauses 6.5.1.4 and 6.5.3.4 specify how the UE determines the PLMN's maximum number of EPS bearer contexts in S1 mode.\nIn earlier versions of the protocol, the maximum number of simultaneously active EPS bearer contexts was limited by lower layer protocols to 8.\nIn the present version of the protocol, the UE and the network may support a maximum number of 15 EPS bearer contexts.\nA UE supporting signalling for a maximum number of 15 EPS bearer contexts shall support the extended range or EPS bearer identities from 0 to 15 (as specified in 3GPP TS 24.007 [12] clause 11.2.3.1.5). The UE indicates support of signalling for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the UE Network Capability IE.\nA network supporting signalling for a maximum number of 15 EPS bearer contexts shall support the extended range or EPS bearer identities from 0 to 15 (as specified in 3GPP TS 24.007 [12] clause 11.2.3.1.5). The network indicates support of signalling for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the EPS network feature support IE.\nNOTE 2:\tA UE and a network not supporting signalling for a maximum number of 15 EPS bearer contexts will treat the EPS bearer identity values 1 to 4 as 'reserved' values.\nFor a UE in NB-S1 mode, the UE's implementation-specific maximum number of active user plane radio bearers is 2 (as defined in 3GPP TS 36.300 [20]) when the UE sets the Multiple DRB support bit to \"Multiple DRB supported\" during attach or tracking area updating procedures, and 1 otherwise.\nUpon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode, if:\na)\tthe number of active default EPS bearer contexts in the UE is larger than the UE's implementation-specific maximum number of active user plane radio bearers; and\nb)\tthe UE is using user plane CIoT EPS optimization;\nthe UE shall locally deactivate at least one default EPS bearer context such that the total number of active default EPS bearer contexts that remained does not exceed the UE's implementation-specific maximum number of active user plane radio bearers. In this case, choosing which EPS bearer context to deactivate is implementation specific. The UE shall then include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message.\nUpon the inter-system change from A/Gb mode or Iu mode to S1 mode, for any PDN connection that has been transferred, if the PDN connection is not associated with a PDU session ID and the UE supporting N1 mode decides to enable the transfer of the PDN connection from S1 mode to N1 mode, the UE may first initiate the UE requested PDN disconnection procedure and then the UE requested PDN connectivity procedure for such PDN connection(s). As an implementation option, the UE may deactivate all EPS bearer contexts for such PDN connection(s) locally, and if the last PDN connection is not deactivated or the UE supports EMM-REGISTERED without PDN connection, the UE shall include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message of the tracking area updating procedure upon inter-system change from A/Gb mode or Iu mode to S1 mode, and then initiate UE requested PDN connectivity procedure for such PDN connection(s).\nNOTE 3:\tUpon the inter-system change from A/Gb mode or Iu mode to S1 mode, if a PDN connection does not support interworking with 5GS and the UE determines that the PLMN or the APN cannot support interworking with 5GS, it is recommended that a UE does not release and re-establish the PDN connection in order to enable interworking with 5GS for the PDN connection. Whether and how the UE determines the PLMN or the APN can support interworking with 5GS is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.1\tUE requested PDN connectivity procedure",
                            "text_content": "The purpose of the UE requested PDN connectivity procedure is for a UE to request the setup of a default EPS bearer to a PDN. The UE requests connectivity to a PDN by sending a PDN CONNECTIVITY REQUEST message to the network. If accepted by the network, this procedure initiates the establishment of a default EPS bearer context. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the procedure is used either to establish the first default bearer by including the PDN CONNECTIVITY REQUEST message into the initial attach message, or to establish subsequent default bearers to additional PDNs in order to allow the UE simultaneous access to multiple PDNs by sending the message stand-alone. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the procedure is used to establish the first or subsequent default bearers to a PDN or additional PDNs by sending the PDN CONNECTIVITY REQUEST message stand-alone.\nIf the UE requests PDN connectivity for emergency bearer services, the MME shall not check for regional restrictions or subscription restrictions when processing the PDN CONNECTIVITY REQUEST message.\nIf there is already a PDN connection for emergency bearer services established, the UE shall not request an additional PDN connection for emergency bearer services.\nA UE attached for emergency bearer services shall not request a PDN connection to any other PDN.\nA UE attached for access to RLOS shall not request any additional PDN connection for RLOS nor any PDN connection to any other PDN.\nThe UE may also initiate the UE requested PDN connectivity procedure to add 3GPP access to the PDN connection which is already established over WLAN as specified in the clause 6.2.2 of 3GPP TS 23.161 [34].\nThe UE may also initiate the UE requested PDN connectivity procedure to transfer an existing PDU session in the 5GS to EPS as specified in 3GPP TS 24.501 [54].\nIf the UE supports the device triggering short message as specified in 3GPP TS 23.040 [57] and supports non-IP PDN type, then upon receiving from ESMS entity as specified in 3GPP TS 24.007 [12] an indication requesting establishment of a PDN connection for non-IP PDN type using the default APN as specified in 3GPP TS 24.011 [13A], the UE shall initiate the UE requested PDN connectivity procedure in order to request connectivity to a PDN using the default APN and non-IP PDN type.\nIn order to request connectivity to a PDN, the UE shall send a PDN CONNECTIVITY REQUEST message to the MME, start timer T3482 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.1.2.1).\nWhen the PDN CONNECTIVITY REQUEST message is sent together with an ATTACH REQUEST message, the UE shall not start timer T3482 and shall not include the APN.\nNOTE 1:\tIf the UE needs to provide protocol configuration options which require ciphering or provide an APN, or both, during the attach procedure, the ESM information transfer flag is included in the PDN CONNECTIVITY REQUEST. The MME then at a later stage in the PDN connectivity procedure initiates the ESM information request procedure in which the UE can provide the MME with protocol configuration options or APN or both.\nIn order to request a PDN connection for emergency bearer services or for access to RLOS, the UE shall not include an APN in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message.\nIn order to request connectivity to a PDN using the default APN, the UE includes the access point name IE in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message, according to the following conditions:\n-\tif use of a PDN using the default APN requires PAP/CHAP, then the UE should include the Access point name IE; and\n-\tin all other conditions, the UE need not include the Access point name IE.\nIn order to request connectivity to an additional PDN using a specific APN, the UE shall include the requested APN in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message.\nNOTE 2:\tThe requested APN in the PDN CONNECTIVITY REQUEST or ESM INFORMATION RESPONSE message is for UAS services when the request to establish a PDN connection for UAS services is requested by the upper layers.\nNOTE 3:\tBy configuration provided by the operator, the UE supporting UAS services knows that an APN is for UAS services when the request to establish a PDN connection for UAS services is requested by the upper layers and how this UE configuration is achieved is implementation specific.\nIn the PDN type IE the UE shall either indicate the IP version capability of the IP stack associated with the UE or non IP or Ethernet as specified in clause 6.2.2.\nIf the PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6 and the UE indicates \"Control plane CIoT EPS optimization supported\" in the UE network capability IE of the ATTACH REQUEST message, the UE may include the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message.\nWhen the connectivity to a PDN is to be transferred from a non-3GPP access network to the 3GPP access network, the UE shall set the PDN type value of the PDN type IE to:\n-\tIPv4, if the previously allocated home address information consists of an IPv4 address only;\n-\tIPv6, if the previously allocated home address information consists of an IPv6 prefix only; or\n-\tIPv4v6, if the previously allocated home address information consists of both an IPv4 address and an IPv6 prefix.\nThe UE shall set the request type to \"initial request\" when the UE is establishing a new PDN connectivity to a PDN in an attach procedure or in a stand-alone PDN connectivity procedure or when the UE requests establishment of a PDN connection as a user-plane resource of an MA PDU session to be established. The UE shall set the request type to \"emergency\" when the UE is requesting a new PDN connectivity for emergency bearer services. The UE shall set the request type to \"handover\" when the connectivity to a PDN is to be transferred from a non-3GPP access network to the 3GPP access network, when the UE initiates the procedure to add 3GPP access to the PDN connection which is already established over WLAN, when the UE supporting N1 mode requests transfer of an existing non-emergency PDU session in 5GS or when the UE requests establishment of a PDN connection as a user-plane resource of an already established MA PDU session. The UE shall set the request type to \"handover of emergency bearer services\" when a PDN connection for emergency bearer services is to be transferred from a WLAN to the 3GPP access network or when the UE supporting N1 mode requests transfer of an existing emergency PDU session in 5GS. The UE shall set the request type to \"RLOS\" when the UE is requesting a new PDN connection for RLOS.\nIf the UE supports DSMIPv6, the UE may include a request for obtaining the IPv6 address and optionally the IPv4 address of the home agent in the Protocol configuration options IE in the PDN CONNECTIVITY REQUEST message. The UE may also include a request for obtaining the IPv6 Home Network Prefix. The UE shall request the IPv6 Home Network Prefix only if the UE has requested the home agent IPv6 address. The requested home agent address(es) and the Home Network Prefix are related to the APN the UE requested connectivity for.\nThe UE may set the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message to indicate that it has ESM information, i.e. protocol configuration options, APN, or both, that needs to be sent after the NAS signalling security has been activated between the UE and the MME.\nIf the UE supports A/Gb mode or Iu mode or both, the UE shall indicate the support of the network requested bearer control procedures (see 3GPP TS 24.008 [13]) in A/Gb mode or Iu mode in the Protocol configuration options IE.\nIf the UE supports N1 mode and the request type is:\na)\t\"initial request\" or \"emergency\", the UE shall generate a PDU session ID, associate the PDU session ID with the PDN connection that is being established, and include the PDU session ID in the Protocol configuration options IE or the Extended protocol configuration options IE;\nb)\t\"handover\" or \"handover of emergency bearer services\", and the UE requests:\n1)\ttransfer of an existing PDU session in 5GS or establishment of a PDN connection as a user-plane resource of an already established MA PDU session, the UE shall associate the PDU session ID of the PDU session with the PDN connection that is being established for the existing PDU session and include the PDU session ID in the Protocol configuration options IE or the Extended protocol configuration options IE; or\n2)\ttransfer of an existing PDN connection in a non-3GPP access connected to the EPC and a PDU session ID is associated with the existing PDN connection, the UE shall include the PDU session ID in the Protocol configuration options IE or the Extended protocol configuration options IE and associate the PDU session ID with the PDN connection that is being established. If the existing PDN connection is a non-emergency PDN connection and an S-NSSAI and a related PLMN ID are associated with the existing PDN connection, the UE shall in addition associate the S-NSSAI and the related PLMN ID with the PDN connection that is being established.\nNOTE 4:\tThe UE can also have an S-NSSAI and the related PLMN ID associated with the PDN connection, if the S-NSSAI and the related PLMN ID was associated with the existing PDN connection in a non-3GPP access connected to the EPC as specified in 3GPP TS 24.302 [48]. The UE stores this S-NSSAI and the related PLMN ID for later use during inter-system change from S1 mode to N1 mode.\nIf the N1 mode capability is disabled, the UE may apply a) and b.2) above for service continuity support at inter-system change from S1 mode to N1 mode once its N1 mode capability is enabled again.\nIf the UE supporting N1 mode supports receiving QoS rules with the length of two octets or QoS flow descriptions with the length of two octets via the Extended protocol configuration options IE, the UE shall include the QoS rules with the length of two octets support indicator or the QoS flow descriptions with the length of two octets support indicator, respectively, in the Protocol configuration options IE or the Extended protocol configuration options IE.\nIf the UE supports providing PDU session ID in the Protocol configuration options IE or the Extended protocol configuration options IE when its N1 mode capability is disabled, the UE shall include the QoS rules with the length of two octets support indicator or the QoS flow descriptions with the length of two octets support indicator, respectively, in the Protocol configuration options IE or the Extended protocol configuration options IE.\nProtocol configuration options provided in the ESM INFORMATION RESPONSE message replace any protocol configuration options provided in the PDN CONNECTIVITY REQUEST message.\nWhen the UE initiates the procedure to add 3GPP access to the PDN connection that is already established over WLAN, the UE shall provide the same APN as that of the PDN connection established over WLAN in the PDN connectivity procedure as specified in the clause 6.2.2 of 3GPP TS 23.161 [34].\nIf the UE supports APN rate control, the UE shall include an APN rate control support indicator and an additional APN rate control for exception data support indicator in the Protocol configuration options IE or Extended protocol configuration options IE.\nIf the UE supports DNS over (D)TLS (see 3GPP TS 33.501 [24]), the UE shall include the Protocol configuration options IE or the Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST or ESM INFORMATION RESPONSE message and include the DNS server security information indicator and optionally, if the UE wishes to indicate which security protocol type(s) are supported by the UE, it may include the DNS server security protocol support.\nNOTE 5:\tSupport of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.501 [24].\nWhen the UE supporting UAS services initiates a UE requested PDN connectivity procedure for UAS services during an attach procedure, the UE:\na)\tshall create the service-level-AA container with the length of two octets. In the service-level-AA container with the length of two octets, the UE:\n1)\tshall include the service-level device ID parameter set to the UE's CAA-level UAV ID;\n2)\tshall include the service-level-AA server address parameter set to the USS address, if it is provided by the upper layers;\n3)\tshall include the service-level-AA payload parameter set to the UUAA payload and the service-level-AA payload type parameter set to \"UUAA payload\", if the UUAA payload is provided by the upper layer; and\n4)\tshall include the service-level-AA payload parameter set to the C2 authorization payload and the service-level-AA payload type parameter set to \"C2 authorization payload\", if the C2 authorization procedure is requested; and\nNOTE 6:\tThe C2 authorization payload in the service-level-AA payload parameter can include one, some or all of the pairing information for C2 communication, an indication of the request for direct C2 communication, pairing information for direct C2 communication and the flight authorization information.\nb)\tshall include the created service-level-AA container with the length of two octets in the Extended protocol configuration options IE of the PDN CONNECTIVITY REQUEST or ESM INFORMATION RESPONSE message.\nWhen the UE supporting UAS services initiates a UE requested PDN connectivity procedure for C2 communication after the completion of the attach procedure, the UE:\na)\tshall create the service-level-AA container with the length of two octets. In the service-level-AA container with the length of two octets, the UE:\n1)\tshall include the service-level device ID parameter set to the UE's CAA-level UAV ID; and\n2)\tshall include the service-level-AA payload parameter set to the C2 authorization payload and the service-level-AA payload type parameter set to \"C2 authorization payload\"; and\nNOTE 7:\tThe C2 authorization payload in the service-level-AA payload parameter can include one, some or all of the pairing information for C2 communication, an indication of the request for direct C2 communication, pairing information for direct C2 communication and the flight authorization information.\nb)\tshall include the created service-level-AA container with the length of two octets in the Extended protocol configuration options IE of the PDN CONNECTIVITY REQUEST message.\nIf the UE supports provisioning of ECS configuration information to the EEC in the UE, then the UE may include the ECS configuration information provisioning support indicator in the Protocol configuration options IE or the Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message.\nIf the UE supports secondary DN authentication and authorization over EPC and has included the PDU session ID in the Protocol configuration options IE or the Extended protocol configuration options IE, the UE shall include the SDNAEPC support indicator in the Protocol configuration options IE or the Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message, and if the UE requests to establish a new non-emergency PDN connection with a DN, the UE may include the SDNAEPC DN-specific identity set to DN-specific identity of the UE complying with network access identifier (NAI) format as specified in IETF RFC 7542 [62] in the Protocol configuration options IE or the Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message.\nNOTE 8:\tThe UE can avoid including both the SDNAEPC DN-specific identity and the protocol configuration option parameters with PAP/CHAP protocol identifiers in the PDN CONNECTIVITY REQUEST message. The way to achieve this is implementation dependent.\nIf the UE supports URSP provisioning in EPS and the PDN CONNECTIVITY REQUEST message is sent together with an ATTACH REQUEST message, then the UE shall include the Protocol configuration options IE or the Extended protocol configuration options IE according to subclause 6.6.1.1 in the PDN CONNECTIVITY REQUEST or ESM INFORMATION RESPONSE message and shall include the URSP provisioning in EPS support indicator.\nIf the UE supports URSP provisioning in EPS, the PDN CONNECTIVITY REQUEST message was not sent together with an ATTACH REQUEST message, the UE requested PDN connectivity procedure is performed for the first PDN connection, and the MME supports the Extended protocol configuration options IE then the UE shall include the Protocol configuration options IE or the Extended protocol configuration options IE according to subclause 6.6.1.1 in the PDN CONNECTIVITY REQUEST message and shall include the URSP provisioning in EPS support indicator.\nThe figure depicts a user-requested PDN (Point-to-Point) connectivity procedure, illustrating the steps taken by the network to establish a reliable connection between the user's device and the network. The figure includes various components such as the network's infrastructure, the user's device, and the network's equipment, all of which are essential for ensuring a smooth and efficient connection.\nFigure 6.5.1.2.1: UE requested PDN connectivity procedure\nUpon receipt of the PDN CONNECTIVITY REQUEST message, the MME checks whether the ESM information transfer flag is included. If the flag is included the MME waits for completion of the ESM information request procedure before proceeding with the PDN connectivity procedure. The MME then checks if connectivity with the requested PDN can be established. If no requested APN is included in the PDN CONNECTIVITY REQUEST message or the ESM INFORMATION RESPONSE message and the request type is different from \"emergency\" and from \"handover of emergency bearer services\" and from \"RLOS\", the MME shall use the default APN as the requested APN. If the request type is \"emergency\" or \"handover of emergency bearer services\", the MME shall use the APN configured for emergency bearer services or select the statically configured PDN GW for unauthenticated UEs, if applicable. If the request type is \"RLOS\", the MME shall use the APN configured for RLOS.\nIf the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection, and multiple PDN connections for a given APN are allowed, the network retains the existing EPS bearer contexts for the PDN connection and proceeds with the requested PDN connectivity procedure.\nIf the lower layers provide a GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a LIPA PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the GW Transport Layer Address value as the P-GW address in the EPS bearer context of the LIPA PDN connection.\nIf the lower layers provide a SIPTO L-GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the SIPTO L-GW Transport Layer Address value as the P-GW address in the EPS bearer context of the SIPTO at the local network PDN connection.\nIf the lower layers provide a LHN-ID value together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the LHN-ID value in the EPS bearer context of the SIPTO at the local network PDN connection.\nNOTE 1:\tThe receipt of a LHN-ID value during the establishment of the PDN connection, during tracking area updating procedure or during inter-MME handover can be used as an indication by the MME that the SIPTO at the local network PDN connection is established to a stand-alone GW (see 3GPP TS 23.401 [10]).\nIf connectivity with the requested PDN is accepted by the network, the MME shall initiate the default EPS bearer context activation procedure (see clause 6.4.1).\nIf connectivity with the requested PDN is accepted and the network considers this PDN connection a LIPA PDN connection, then subject to operator policy the MME shall include in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message the Connectivity type IE indicating \"the PDN connection is considered a LIPA PDN connection\".\nIf connectivity with the requested PDN is accepted, but with a restriction of IP version (i.e. both an IPv4 address and an IPv6 prefix is requested, but only one particular IP version, or only single IP version bearers are supported/allowed by the network), ESM cause #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", or #52 \"single address bearers only allowed\", respectively, shall be included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.\nIf connectivity with the requested PDN is accepted and the UE provided the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message, the MME may include the Header compression configuration IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. Furthermore, if the MME decides that the associated PDN connection is only for control plane CIoT EPS optimization (see clause 5.3.15), the MME shall include the Control plane only indication in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.\nUpon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall stop timer T3482 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see clause 7.3.1).\nUpon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the Connectivity type IE indicating \"the PDN connection is considered a LIPA PDN connection\", the UE provides an indication to the upper layers that the connectivity is provided by a LIPA PDN connection.\nUpon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the 3GPP PS data off UE status is \"activated\", the UE behaves as described in clause 6.3.10.\nUpon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the SCEF or P-GW indicates acceptance of use of Reliable Data Service to transfer data for the PDN connection, the UE behaves as described in clause 6.3.11.\nUpon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if an S-NSSAI and the PLMN ID that this S-NSSAI relates to are provided in the Protocol configuration options IE or Extended protocol configuration options IE, the UE shall delete the stored S-NSSAI and the PLMN ID that this S-NSSAI relates to, if any, and shall store the S-NSSAI and the PLMN ID this S-NSSAI relates to provided in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and the associated PLMN ID along with the corresponding PDU session ID that the UE provided in the PDN CONNECTIVITY REQUEST message. The usage of the PDU session ID and the corresponding S-NSSAI with the associated PLMN ID is specified in 3GPP TS 24.501 [54]. Additionally, the UE shall remove the S-NSSAI, if present, from the rejected NSSAI as specified in 3GPP TS 24.501 [54] clause 4.6.2.2.\nUpon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s), which correspond to the default EPS bearer of the PDN connectivity being activated, in the Protocol configuration options IE or the Extended protocol configuration options IE, the UE stores the session-AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode.\nIf the UE requests the PDN type \"IPv4v6\", receives the selected PDN type set to \"IPv4\" and the ESM cause value #50 \"PDN type IPv4 only allowed\", the UE shall not automatically send another PDN CONNECTIVITY REQUEST message to the same APN (or no APN, if no APN was indicated by the UE) to obtain a PDN type different from the one allowed by the network until:\n-\tthe UE is registered to a new PLMN;\n-\tthe UE is switched off; or\n-\tthe USIM is removed.\nIf the UE requests the PDN type \"IPv4v6\", receives the selected PDN type set to \"IPv6\" and the ESM cause value #51 \"PDN type IPv6 only allowed\", the UE shall not automatically send another PDN CONNECTIVITY REQUEST message to the same APN (or no APN, if no APN was indicated by the UE) to obtain a PDN type different from the one allowed by the network until:\n-\tthe UE is registered to a new PLMN;\n-\tthe UE is switched off; or\n-\tthe USIM is removed.\nNOTE 2:\tFor the ESM cause values #50 \"PDN type IPv4 only allowed\" and #51 \"PDN type IPv6 only allowed\", re-attempt in A/Gb, Iu, or N1 mode for the same APN (or no APN, if no APN was indicated by the UE) is only allowed using the PDN type(s) indicated by the network.\nIf connectivity with the requested PDN cannot be accepted by the network, the MME shall send a PDN CONNECTIVITY REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested PDN connectivity.\nThe ESM cause IE typically indicates one of the following ESM cause values:\n#8:\toperator determined barring;\n#26:\tinsufficient resources;\n#27:\tmissing or unknown APN;\n#28:\tunknown PDN type;\n#29:\tuser authentication or authorization failed;\n#30:\trequest rejected by Serving GW or PDN GW;\n#31:\trequest rejected, unspecified;\n#32:\tservice option not supported;\n#33:\trequested service option not subscribed;\n#34:\tservice option temporarily out of order;\n#35:\tPTI already in use;\n#38:\tnetwork failure;\n#50:\tPDN type IPv4 only allowed;\n#51:\tPDN type IPv6 only allowed;\n#53:\tESM information not received;\n#54:\tPDN connection does not exist;\n#55:\tmultiple PDN connections for a given APN not allowed;\n#57:\tPDN type IPv4v6 only allowed;\n#58:\tPDN type non IP only allowed;\n#61:\tPDN type Ethernet only allowed;\n#65:\tmaximum number of EPS bearers reached;\n#66:\trequested APN not supported in current RAT and PLMN combination;\n#95 – 111:\tprotocol errors;\n#112:\tAPN restriction value incompatible with active EPS bearer context;\n#113:\tMultiple accesses to a PDN connection not allowed.\nThe network may include a Back-off timer value IE in the PDN CONNECTIVITY REJECT message. If the ESM cause value is #26 \"insufficient resources\" and the PDN CONNECTIVITY REQUEST message was received via a NAS signalling connection established with RRC establishment cause \"High priority access AC 11 – 15\" or the request type in the PDN CONNECTIVITY REQUEST message was set to \"emergency\" or \"handover of emergency bearer services\", the network shall not include a Back-off timer value IE.\nIf the ESM cause value is different from #26 \"insufficient resources\", #28 \"unknown PDN type\", #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #54 \"PDN connection does not exist\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\", #61 \"PDN type Ethernet only allowed\", #65 \"maximum number of EPS bearers reached\", and #66 \"requested APN not supported in current RAT and PLMN combination\", and the PDN CONNECTIVITY REQUEST message was received via a NAS signalling connection established with RRC establishment cause \"High priority access AC 11 – 15\", the network shall not include a Back-off timer value IE.\nIf the Back-off timer value IE is included and the ESM cause value is different from #26 \"insufficient resources\", #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\", #61 \"PDN type Ethernet only allowed\", and #65 \"maximum number of EPS bearers reached\", the network may include the Re-attempt indicator IE to indicate:\n-\twhether the UE is allowed to attempt a PDP context activation procedure in the PLMN for the same  in A/Gb or Iu mode or a PDU session establishment procedure in the PLMN for the same APN in N1 mode; and\n-\twhether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN.\nIf the ESM cause value is #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\" or #61 \"PDN type Ethernet only allowed\", the network may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode using the same PDN type.\nIf the ESM cause value is #66 \"requested APN not supported in current RAT and PLMN combination\", the network may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode.\nUpon receipt of the PDN CONNECTIVITY REJECT message, the UE shall stop timer T3482 and enter the state PROCEDURE TRANSACTION INACTIVE.\nIf the PDN CONNECTIVITY REJECT message is due to an ESM failure notified by EMM layer (i.e., EMM cause #19 \"ESM failure\" included in an ATTACH REJECT message), the UE may include a different APN in the PDN CONNECTIVITY REQUEST message.\nNOTE 1:\tWhen receiving EMM cause #19 \"ESM failure\", coordination is required between the EMM and ESM sublayers in the UE to notify the ESM failure.\nIf the PDN CONNECTIVITY REQUEST message was sent with request type set to \"emergency\" or \"handover of emergency bearer services\" in a stand-alone PDN connectivity procedure and the UE receives a PDN CONNECTIVITY REJECT message, then the UE may:\na)\tinform the upper layers of the failure to establish the emergency bearer; or\nNOTE 2:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nb)\tdetach locally, if not detached already, attempt EPS attach for emergency bearer services.\nIf the PDN CONNECTIVITY REQUEST message was sent with PDN type set to \"Ethernet\" and the UE receives a PDN CONNECTIVITY REJECT message with ESM cause #58 \"PDN type non IP only allowed\", then the UE may attempt a PDN connectivity procedure with the non-IP PDN type.\nIf the PDN CONNECTIVITY REJECT message contains the UAS services not allowed indication in the Extended protocol configuration options IE and the UE has not provided its CAA-level UAV ID to the network, the UE shall not send another PDN CONNECTIVITY REQUEST message for UAS services without providing its CAA-level UAV ID to the network.\nNOTE 3:\tIf the PDN CONNECTIVITY REJECT message contains the UAS services not allowed indication in the Extended protocol configuration options IE, the ESM cause value #29 \"user authentication or authorization failed\" is included in the PDN CONNECTIVITY REJECT message.\nNOTE 4:\tThe PDN CONNECTIVITY REJECT message contains the UAS services not allowed indication included in the Extended protocol configuration options IE, if the PDN connection is identified to be for UAS services based on the APN, and the CAA-level UAV ID is not provided by the UE in the request, or if the network is informed by the UAS NF that the UAS service is not allowed.\nNOTE 5:\tIf the PDN CONNECTIVITY REQUEST message does not contain the SDNAEPC support indicator in the Protocol configuration options IE or the Extended protocol configuration options IE and the secondary DN authentication and authorization over EPC is mandatory due to local policies, the ESM cause value #29 \"user authentication or authorization failed\" can be included in the PDN CONNECTIVITY REJECT message\".\nIf the ESM cause value is #26 \"insufficient resources\" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and behave as follows:\n1)\tif the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in clause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.5):\ni)\tif the timer value indicates neither zero nor deactivated and an APN was included in the PDN CONNECTIVITY REQUEST message, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. If the timer value indicates neither zero nor deactivated, no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with the value provided in the Back-off timer value IE and:\n-\tshall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and\n-\tshall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST for a non-emergency PDN connection established without an APN provided by the UE, if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", until timer T3396 expires or timer T3396 is stopped.\nThe UE shall not stop timer T3396 upon a PLMN change or inter-system change;\nii)\tif the timer value indicates that this timer is deactivated, the UE:\n-\tshall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 \"reactivation requested\" for a default EPS bearer context for the same APN from the network; and\n-\tshall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 \"reactivation requested\" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE.\nThe timer T3396 remains deactivated upon a PLMN change or inter-system change; and\niii)\tif the timer value indicates zero, the UE:\n-\tshall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and\n-\tif no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE; and\n2)\tif the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE and on the integrity protection of the ATTACH REJECT message (if the UE is configured for dual priority, exceptions are specified in clause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.5):\ni)\tif the ATTACH REJECT message is not integrity protected and an APN was sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with the corresponding APN if it is running. If the ATTACH REJECT message is not integrity protected, the request type was different from \"emergency\" and from \"handover of emergency bearer services\", and an APN was not sent by the UE, the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with a random value from a default range specified in table 11.2.3 defined in 3GPP TS 24.008 [13], and:\na)\tshall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and\nb)\tshall not initiate a new attach procedure without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", if the UE did not provide any APN during the attach procedure and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", until timer T3396 expires.\nThe UE shall not stop timer T3396 upon a PLMN change or inter-system change;\nii)\tif the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:\na)\tif the timer value indicates neither zero nor deactivated and an APN was sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with the corresponding APN if it is running. If the timer value indicates neither zero nor deactivated, the request type was different from \"emergency\" and from \"handover of emergency bearer services\", and an APN was not sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with the value provided in the Back-off timer value IE and:\n-\tshall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and\n-\tshall not initiate a new attach procedure without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", if the UE did not provide any APN during the attach procedure and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", until timer T3396 expires.\nThe UE shall not stop timer T3396 upon a PLMN change or inter-system change;\nb)\tif the timer value indicates that this timer is deactivated, the UE:\n-\tshall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for the same APN from the network; and\n-\tshall not initiate a new attach procedure without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", if the UE did not provide any APN during the attach procedure and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.\nThe timer T3396 remains deactivated upon a PLMN change or inter-system change; and\nc)\tif the timer value indicates that this timer is zero, the UE shall proceed as specified in clause 5.5.1.2.6 item d.\nIf the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, then the UE may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN.\nWhen the timer T3396 is running or the timer is deactivated, the UE is allowed to initiate an attach procedure or PDN connectivity procedure if the procedure is for emergency bearer services.\nIf the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE shall behave as follows:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;\n-\tif prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause 6.5.5; and\n-\tif prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause 6.5.5.\nIf the ESM cause value is different from #26 \"insufficient resources\", #28 \"unknown PDN type\", #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #54 \"PDN connection does not exist\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\", #61 \"PDN type Ethernet only allowed\", #65 \"maximum number of EPS bearers reached\", and #66 \"requested APN not supported in current RAT and PLMN combination\", and the Back-off timer value IE is included, the UE shall behave as follows:\n1)\tif the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.6):\ni)\tif the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and  combination, and the UE:\n-\tshall not send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and\n-\tshall not send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\" if no APN was included in the PDN CONNECTIVITY REQUEST message, until the back-off timer expires, the UE is switched off or the USIM is removed;\nii)\tif the timer value indicates that this timer is deactivated, the UE:\n-\tshall not send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN until the UE is switched off or the USIM is removed; and\n-\tshall not send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\" if no APN was included in the PDN CONNECTIVITY REQUEST message, until the UE is switched off or the USIM is removed; and\niii)\tif the timer value indicates zero, the UE:\n-\tmay send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN; and\n-\tmay send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN; and\n2)\tif the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received in the Back-off timer value IE and on the integrity protection of the ATTACH REJECT message (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.6):\ni)\tif the ATTACH REJECT message is not integrity protected, the UE shall start the back-off timer with a random value from a default range specified in table 11.2.3(see 3GPP TS 24.008 [13]), and the UE:\na)\tshall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and\nb)\tshall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", if the UE did not provide any APN during the attach procedure and the request type was different from \"emergency\", until the back-off timer expires, the UE is switched off or the USIM is removed; and\nii)\tif the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:\na)\tif the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and  combination, and the UE:\n-\tshall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and\n-\tshall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", if the UE did not provide any APN during the attach procedure and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", until the back-off timer expires, the UE is switched off or the USIM is removed;\nb)\tif the timer value indicates that this timer is deactivated, the UE:\n-\tshall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed; and\n-\tshall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", if the UE did not provide any APN during the attach procedure and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", until the UE is switched off or the USIM is removed; and\nc)\tif the timer value indicates that this timer is zero, the UE shall proceed as specified in clause 5.5.1.2.6 item d.\nIf the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, then the UE shall ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, if any.\n1)\tAdditionally, if the ESM cause value is #8 \"operator determined barring\", #27 \"missing or unknown APN\", #32 \"service option not supported\", or #33 \"requested service option not subscribed\", the UE shall proceed as follows:\n-\tif the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall behave as described above in the present clause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, as back-off timer value; and\nNOTE 0:\tThe way to choose one of the configured SM_RetryWaitTime values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM_RetryWaitTime value in ME as specified in 3GPP TS 24.368 [15A]; and\n-\tan SM_RetryWaitTime value in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17].\n-\totherwise, if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), or if the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present clause, using the default value of 12 minutes for the back-off timer.\n2)\tFor ESM cause values different from #8 \"operator determined barring\", #27 \"missing or unknown APN\", #32 \"service option not supported\", or #33 \"requested service option not subscribed\", the UE behaviour regarding the start of a back-off timer is unspecified.\nThe UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the PDN connectivity procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.\nNOTE 1:\tThis means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode or N1 mode to S1 mode. Thus the UE can still be prevented from sending another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN.\nIf the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent together with an ATTACH REQUEST, the UE shall ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, if any, and proceed as specified in clause 5.5.1.2.6, item d.\nIf the back-off timer is started upon receipt of a PDN CONNECTIVITY REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:\n1)\tafter a PLMN change the UE may send a PDN CONNECTIVITY REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the PDN connectivity procedure and the combination of new PLMN and APN.\nFurthermore as an implementation option, for the ESM cause values #8 \"operator determined barring\", #27 \"missing or unknown APN\", #32 \"service option not supported\" or #33 \"requested service option not subscribed\", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, or the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message included in an ATTACH REQUEST message without an APN using the same PDN type if the UE did not provide any APN in the PDN connectivity procedure, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs;\n2)\tif the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:\n-\tif the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, to determine whether the UE may attempt a PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session establishment procedure for the same PLMN and APN combination in N1 mode; and\nNOTE 2:\tThe way to choose one of the configured SM_RetryAtRATChange values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM_RetryAtRATChange value in ME as specified in 3GPP TS 24.368 [15A]; and\n-\tan SM_RetryAtRATChange value in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17].\n-\tif the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session establishment procedure for the same PLMN and APN combination in N1 mode are unspecified; and\n3)\tif the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the PDN connectivity procedure with the value provided by the network, or deactivate the respective back-off timer as follows:\n-\tif the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and\n-\totherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode.\nIf the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE PDP CONTEXT REJECT message (see 3GPP TS 24.008 [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.\nIf a back-off timer for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP TS 24.501 [54]) was started or deactivated in N1 mode upon receipt of a PDU SESSION ESTABLISHMENT REJECT message (see 3GPP TS 24.501 [54]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. If more than one back-off timers for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed and no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN until the UE is switched off or the USIM is removed.\nNOTE 3:\tThe back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.\nNOTE 4:\tReference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.\nWhen the back-off timer is running or the timer is deactivated, the UE is allowed to initiate an attach procedure or PDN connectivity procedure if the procedure is for emergency bearer services.\nIf the ESM cause value is #28 \"unknown PDN type\" and the PDN CONNECTIVITY REQUEST message contained a PDN type IE indicating a PDN connection type, the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. The UE may send another PDN CONNECTIVITY REQUEST message with the PDN type IE indicating another PDN connection type.\nIf the ESM cause value is #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\" or #61 \"PDN type Ethernet only allowed\", the UE shall ignore the Back-off timer value IE provided by the network, if any. The UE shall not automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE to obtain a PDN type different from the one allowed by the network until any of the following conditions is fulfilled:\n-\tthe UE is registered to a new PLMN, and either the network did not include a Re-attempt indicator IE in the PDN CONNECTIVITY REJECT message or the Re-attempt indicator IE included in the message indicated that re-attempt in an equivalent PLMN is allowed;\n-\tthe UE is registered to a new PLMN which was not in the list of equivalent PLMNs at the time when the PDN CONNECTIVITY REJECT message was received;\n-\tthe UE is switched off; or\n-\tthe USIM is removed.\nFor the ESM cause values #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\" and #61 \"PDN type Ethernet only allowed\", the UE shall ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any.\nNOTE 5:\tFor the ESM cause values #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\" and #61 \"PDN type Ethernet only allowed\", re-attempt in A/Gb, Iu, or N1 mode for the same APN (or no APN, if no APN was indicated by the UE) is only allowed using the PDN type(s) indicated by the network.\nFurthermore as an implementation option, for the SM cause values #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\" and #61 \"PDN type Ethernet only allowed\", if the network does not include a Re-attempt indicator IE the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.\nNOTE 6:\tRequest to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.\nIf the ESM cause value is #65 \"maximum number of EPS bearers reached\", the UE shall determine the PLMN's maximum number of EPS bearer contexts in S1 mode (see clause 6.5.0) as the number of active EPS bearer contexts it has. The UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any.\nNOTE 7:\tIn some situations, when attempting to establish multiple EPS bearer contexts, the number of active EPS bearer contexts that the UE has when ESM cause #65 is received is not equal to the maximum number of EPS bearer contexts reached in the network.\nNOTE 8:\tWhen the network supports emergency bearer services, it is not expected that ESM cause #65 is returned by the network when the UE requests a PDN connection for emergency bearer services.\nThe PLMN's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 \"maximum number of EPS bearers reached\" is received. When the UE is switched off, when the USIM is removed, or when there is a change in the value indicated by the network in the 15 bearers bit of the EPS network feature support IE, the UE shall clear all previous determinations representing PLMNs maximum number of EPS bearer contexts in S1 mode. Upon successful registration with a new PLMN, the UE may clear previous determinations representing any PLMN's maximum number(s) of EPS bearer contexts in S1 mode.\nIf the ESM cause value is #66 \"requested APN not supported in current RAT and PLMN combination\", the UE shall take different actions depending on the Back-off timer value IE and the Re-attempt indicator IE optionally included:\n1)\tIf the PDN CONNECTIVITY REQUEST message was sent standalone, the Back-off timer value IE is not included, and either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed;\n2)\tif the PDN CONNECTIVITY REQUEST message was sent standalone, the Back-off timer value IE is not included, and the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, the UE shall not send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode until the UE is switched off or the USIM is removed;\n3)\tif the PDN CONNECTIVITY REQUEST message was sent standalone and the Back-off timer value IE is included, the UE shall take different actions depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.6):\ni)\tif the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PLMN and APN combination and shall not send another PDN CONNECTIVITY REQUEST for the same  in the current PLMN in S1 mode until the back-off timer expires, the UE is switched off or the USIM is removed;\nii)\tif the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed; and\niii)\tif the timer value indicates that this timer is zero, the UE may send a PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN; and\n4)\tif the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the integrity protection of the ATTACH REJECT message (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.6):\ni)\tif the ATTACH REJECT message is not integrity protected, regardless whether the Back-off timer IE is included, the UE shall start the back-off timer with a random value from a default range specified in table 11.2.3(see 3GPP TS 24.008 [13]), and shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and\nii)\tif the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:\na)\tif the Back-off timer value IE is included and the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed;\nb)\tif the Back-off timer value IE is included and the timer value indicates that this timer is deactivated, the UE shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed;\nc)\tif the Back-off timer value IE is included and the timer value indicates that this timer is zero, the UE shall proceed as specified in clause 5.5.1.2.6 item d;\nd)\tif the Back-off timer value IE is not included, and either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, the UE shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed; and\ne)\tif the Back-off timer value IE is not included, and the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, the UE shall not initiate a new attach procedure or send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode until the UE is switched off or the USIM is removed.\nNOTE 9:\tReceiving ESM cause value #66 during an attach procedure without APN is not expected and the UE behaviour is implementation specific.\nIf the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then:\n-\tfor cases 3.i, 4.i and 4.ii.a the UE shall additionally start a back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN; and\n-\tfor cases 3.ii and 4.ii.b the UE shall deactivate the respective back-off timers for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN.\nFor the ESM cause value #66 \"requested APN not supported in current RAT and PLMN combination\" the UE shall ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any.\nAs an implementation option, for cases 1, 3.i, 3.ii, 4.iv, 4.v.a and 4.v.b, if the Re-attempt indicator IE is not included, the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN in a PLMN which is in the list of equivalent PLMNs.\nIf the ESM cause value is #54 \"PDN connection does not exist\", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any, and take different actions as follows:\n-\tif the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall set the request type to \"initial request\" in the subsequent PDN CONNECTIVITY REQUEST message to establish a PDN connectivity to the same APN;\n-\tif the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST message, the UE shall set the request type to \"initial request\" in the PDN CONNECTIVITY REQUEST message which is included in the subsequent ATTACH REQUEST message to establish a PDN connectivity to the same APN.\nNOTE 10:\tUser interaction is necessary in some cases when the UE cannot re-activate the EPS bearer context(s) automatically.\nIf the PDN connection is for UAS services, and the PDN CONNECTIVITY REJECT message includes the Extended protocol configuration options IE containing the service-level-AA container with the length of two octets , and the service-level-AA container with the length of two octets contains the service-level-AA response parameter with the SLAR field set to \"Service level authentication and authorization was not successful or service level authorization is revoked\", then the UE supporting UAS services shall consider the UUAA procedure as failed and not attempt to establish a PDN connection for UAS services.\nIf the maximum number of active EPS bearer contexts is reached at the UE (see clause 6.5.0) and the upper layers of the UE request connectivity to a PDN the UE shall not send a PDN CONNECTIVITY REQUEST message unless an active EPS bearer is deactivated. If the UE needs to de-activate an active EPS bearer context, choosing which EPS bearer context to de-activate is implementation specific, however the UE shall not deactivate an EPS bearer context for emergency.\nNOTE:\tClause 6.5.1.6 specifies that a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing, non-emergency PDN connection can be acceptable, in some cases. In these cases the UE does not need to de-activate an active EPS bearer context if the maximum number of active EPS bearer contexts is reached at the UE.\nIf the UE needs to de-activate an EPS bearer context in order to request an emergency EPS bearer context, it shall either de-activate an EPS bearer context locally or via explicit signalling. If the UE performs local de-activation, the UE shall perform tracking area updating procedure to indicate EPS bearer context status to the network.\nWhen the maximum number of active user plane radio bearers in NB-S1 mode is reached (see clause 6.5.0) and upper layers request for more DRBs for PDN connections other than PDN connections with those DRBs, the UE can choose to release one or more of the PDN connections to cater for the upper layer request. The choice of which PDN connection to be released is implementation specific.\nIf the maximum number of active user plane radio bearers in NB-S1 mode is reached and the upper layers of the UE request user-plane resources for exception data reporting, the UE shall release a PDN connection that has user-plane resources to cater for the request for exception data reporting. The choice of which PDN connection to be released is implementation specific.\nIf the UE needs to release a PDN connection for the reasons stated in this clause, a PDN connection that is used for exception data reporting shall not be released.\nIf the UE releases a PDN connection to cater for the upper layer request, the UE shall release the PDN connection via explicit ESM signalling.\nThe following abnormal cases can be identified:\na)\tT3482 expired\nOn the first expiry of the timer T3482:\n-\tif the PDN CONNECTIVITY REQUEST message was sent with request type set to \"emergency\" or \"handover of emergency bearer services\" in a stand-alone PDN connectivity procedure, then the UE shall:\na)\tinform the upper layers of the failure to establish the emergency bearer; or\nNOTE:\tThis can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.\nb)\tdetach locally, if not detached already, attempt EPS attach for emergency bearer services.\n-\totherwise, the UE shall resend the PDN CONNECTIVITY REQUEST and shall reset and restart timer T3482. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3482, the UE shall abort the procedure, release the PTI allocated for this invocation and enter the state PROCEDURE TRANSACTION INACTIVE.\nb)\tT3447 is running\nThe UE shall not send a PDN CONNECTIVITY REQUEST message when the UE is in EMM-CONNECTED mode after the UE attached without PDN connection, unless:\n-\testablishment of a PDN connection for emergency bearer services is requested;\n-\tthe UE is a UE configured to use AC11 – 15 in the selected PLMN; or\n-\ta network initiated signalling message has been received.\nThe PDN CONNECTIVITY REQUEST message can be sent, if still necessary, when timer T3447 expires.\nc)\tCollision of UE requested PDN connectivity procedure and NAS signalling connection release\nThe UE may immediately retransmit the PDN CONNECTIVITY REQUEST message and stop, reset and restart timer T3482, if the following conditions apply:\n1)\tthe original UE requested PDN connectivity procedure was initiated over an existing NAS signalling connection; and\n2)\tthe previous transmission of the PDN CONNECTIVITY REQUEST message was not initiated due to timer T3482 expiry.\nThe following abnormal cases can be identified:\na)\tUE initiated PDN connectivity request for an already existing PDN connection:\nIf the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection and:\n-\tthe information elements in the PDN CONNECTIVITY REQUEST message do not differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, and the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE, the network shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and continue the previous procedure.\n-\tone or more information elements in the PDN CONNECTIVITY REQUEST message differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, and multiple PDN connections for a given APN are not allowed, the network may deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure or may reject this PDN connectivity procedure including the ESM cause #55 \"multiple PDN connections for a given APN not allowed\", in the PDN CONNECTIVITY REJECT message.\nIf the network receives a PDN CONNECTIVITY REQUEST message with request type \"emergency\" and the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE for the previous PDN connectivity request for emergency bearer services, the network shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and continue the previous procedure. If there is already a PDN connection for emergency bearer services existing, the MME shall reject the request with ESM cause #55 \"multiple PDN connections for a given APN not allowed\" or deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure.\nb)\tUE initiated PDN connectivity request with request type \"handover\" for a PDN connection that does not exist:\nIf the network receives a PDN CONNECTIVITY REQUEST message for either a default APN or a specific APN with request type set to \"handover\" and the MME does not have any information about that PDN connection, then MME shall reject the PDN connectivity request procedure including the ESM cause #54 \"PDN connection does not exist\", in the PDN CONNECTIVITY REJECT message.\nc)\tESM information not received:\nIf the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message has been set and the ESM information is not received before the final expiry of timer T3489 as described in clause 6.6.1.2.6, the MME shall reject the PDN connectivity request procedure including the ESM cause #53 \"ESM information not received\", in the PDN CONNECTIVITY REJECT message.\nd)\tAdditional UE initiated PDN connectivity request received from a UE that is attached for emergency bearer services:\nThe MME shall reject the request with ESM cause #31 \"request rejected, unspecified\".\ne)\tA PDN CONNECTIVITY REQUEST message with request type \"handover of emergency bearer services\" received from a UE and the MME does not have any information about a P-GW currently providing emergency bearer services for the UE or the MME is not configured with an address of a P-GW in the MME emergency configuration data:\nMME shall reject the PDN connectivity request procedure including the ESM cause #54 \"PDN connection does not exist\", in the PDN CONNECTIVITY REJECT message.\nf)\tAdditional UE initiated PDN connectivity request received from a UE that is attached for access to RLOS:\nThe MME shall reject the request with ESM cause #31 \"request rejected, unspecified\".\ng)\tPDN CONNECTIVITY REQUEST message received from a UE which is in a location where the PLMN is not allowed to operate\nIf the MME determines that the UE is in a location where the PLMN is not allowed to operate, the MME discards the message.\nIf a PDN connection exists that was established due to a request including a low priority indicator set to \"MS is configured for NAS signalling low priority\" and the upper layers of the UE request to establish a PDN connection with the same APN and a low priority indicator set to \"MS is not configured for NAS signalling low priority\", when initiating the PDN connectivity request procedure, the UE shall:\n-\tsend a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as the existing PDN connection. If the UE receives a PDN CONNECTIVITY REJECT message with ESM cause #55 \"multiple PDN connections for a given APN not allowed\", the upper layers are informed of this; or\n-\tsend a PDN CONNECTIVITY REQUEST message with the same APN after the successful deactivation of the existing PDN connection.\nNOTE:\tThe above list of options also apply for the case when the existing PDN connection was established due to a request including a low priority indicator set to \"MS is not configured for NAS signalling low priority\" and the new request to establish a PDN connection with the same APN contains a low priority indicator set to \"MS is configured for NAS signalling low priority\".\nAs an alternative the upper layers of the UE can request to establish a PDN connection with a different APN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.2\tUE requested PDN disconnect procedure",
                            "text_content": "The purpose of the UE requested PDN disconnection procedure is for a UE to request disconnection from one PDN. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE can initiate this procedure to disconnect from any PDN as long as it is connected to at least one other PDN. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE can initiate this procedure to disconnect from any PDN. With this procedure, all EPS bearer contexts established towards this PDN, including the default EPS bearer context, are released.\nThe UE is allowed to initiate the PDN disconnection procedure even if the timer T3396 is running.\nIn order to request PDN disconnection from a PDN, the UE shall send a PDN DISCONNECT REQUEST message to the MME, start the timer T3492 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.2.2.1). The PDN DISCONNECT REQUEST message shall include the EPS bearer identity of the default bearer associated with the PDN to disconnect from as the linked EPS bearer identity in the PDN DISCONNECT REQUEST message.\nThe figure depicts a user-requested PDN disconnection procedure, illustrating the steps taken by the network to disconnect the user's device from the network. The figure includes a diagram of the network topology, with the user's device highlighted as the source of the request. The network's response is shown as a dashed line, indicating the path taken to disconnect the device. The figure also includes a legend to help users understand the different symbols used in the diagram.\nFigure 6.5.2.2.1: UE requested PDN disconnection procedure\nUpon receipt of the PDN DISCONNECT REQUEST message, if it is accepted by the network, the MME shall initiate the bearer context deactivation procedure by sending the DEACTIVATE EPS BEARER CONTEXT REQUEST message including the linked EPS bearer identity of the default bearer associated with the PDN to disconnect from and the PTI. The behaviour of the MME is described in clause 6.4.4.\nUpon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the PDN DISCONNECT REQUEST message, the UE shall stop the timer T3492 and enter the state PROCEDURE TRANSACTION INACTIVE. The behaviour of the UE is described in clause 6.4.4. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see clause 7.3.1).\nOn reception of DEACTIVATE EPS BEARER CONTEXT ACCEPT message from the UE, the MME releases all the resources reserved for the PDN in the network.\nUpon receipt of the PDN DISCONNECT REQUEST message, if it is not accepted by the network, the MME shall send a PDN DISCONNECT REJECT message to the UE. The PDN DISCONNECT REJECT message shall contain the PTI and an ESM cause IE that typically indicates one of the following ESM cause values:\n#35:\tPTI already in use;\n#43:\tinvalid EPS bearer identity;\n#49:\tlast PDN disconnection not allowed;\n#95 – 111: protocol errors.\nIf EMM-REGISTERED without PDN connection is supported by the UE and the MME, then ESM cause #49 \"last PDN disconnection not allowed\" is not applicable.\nUpon receipt of the PDN DISCONNECT REJECT message, the UE shall stop the timer T3492, enter the state PROCEDURE TRANSACTION INACTIVE and abort the PDN disconnection procedure. Additionally, in all cases with the exception of the UE having received ESM cause #49 \"last PDN disconnection not allowed\" if EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall deactivate all EPS bearer contexts for this PDN connection locally without peer-to-peer signalling between the UE and the MME. If the UE receives ESM cause #49 \"last PDN disconnection not allowed\" and the UE has any other PDN connections established, the UE may locally deactivate, without peer-to-peer signalling between the UE and the MME, all EPS bearer contexts associated with those other PDN connections.\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3492:\nOn the first expiry of the timer T3492, the UE shall resend the PDN DISCONNECT REQUEST and shall reset and restart timer T3492. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3492, the UE shall abort the procedure, deactivate all EPS bearer contexts for this PDN connection locally without peer-to-peer signalling between the UE and the MME, release the PTI allocated for this invocation and enter the state PROCEDURE TRANSACTION INACTIVE. In order to synchronize EPS bearer contexts status with the MME, on indication of \"back to E-UTRAN coverage\" from the lower layers, the UE shall send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.\nb)\tCollision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure:\nWhen the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, the UE shall ignore the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message and proceed with the PDN disconnect procedure.\nc)\tCollision of UE requested PDN disconnect procedure and EPS bearer context modification:\nWhen the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, the UE shall ignore the MODIFY EPS BEARER CONTEXT REQUEST message and proceed with the PDN disconnect procedure.\nd)\tCollision of UE requested PDN disconnect procedure and EPS bearer context deactivation procedure:\nWhen the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, the UE shall proceed with both procedures.\nThe following abnormal cases can be identified:\na)\tNo PDN connection with the linked EPS bearer identity activated:\nIf the linked EPS bearer identity included in the PDN DISCONNECT REQUEST message does not belong to the default EPS bearer context of an established PDN connection, the MME shall reply with a PDN DISCONNECT REJECT message with ESM cause #43 \"invalid EPS bearer identity\".\nb)\tPDN DISCONNECT REQUEST message received from a UE which is in a location where the PLMN is not allowed to operate\nIf the MME determines that the UE is in a location where the PLMN is not allowed to operate, the MME discards the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.3\tUE requested bearer resource allocation procedure",
                            "text_content": "The purpose of the UE requested bearer resource allocation procedure is for a UE to request an allocation of bearer resources for a traffic flow aggregate. The UE requests a specific QoS demand (QCI) and optionally sends a GBR requirement for a new traffic flow aggregate. If accepted by the network, this procedure invokes a dedicated EPS bearer context activation procedure (see clause 6.4.2) or an EPS bearer context modification procedure (see clause 6.4.3).\nIf there is a PDN connection for emergency bearer services established, the UE shall not request additional bearer resources for this PDN connection.\nIn order to request the allocation of bearer resources for one traffic flow aggregate, the UE shall send a BEARER RESOURCE ALLOCATION REQUEST message to the MME, start timer T3480 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.3.2.1).\nThe UE shall include the EPS bearer identity of the default EPS bearer associated with the requested bearer resource in the Linked EPS bearer identity IE. The UE shall set the TFT operation code in the Traffic flow aggregate IE to \"Create new TFT\". The packet filters in the Traffic flow aggregate IE shall include at least one packet filter applicable for the uplink direction. In the Required traffic flow QoS IE, the UE shall indicate a QCI and, if the UE also includes a GBR, the additional GBR required for the traffic flow aggregate.\nThe figure depicts the UE's request for bearer resource allocation procedure, which is a crucial step in the network's resource management process. The figure shows the UE's request for a bearer resource allocation, which is a request for a specific bearer resource, such as a specific frequency band or a specific channel. The figure also shows the response from the network, which is a response to the UE's request for a bearer resource allocation. The figure is important for understanding the network's resource management process and for ensuring that the network is able to allocate resources efficiently and effectively.\nFigure 6.5.3.2.1: UE requested bearer resource allocation procedure\nFor the NBIFOM procedures as defined in 3GPP TS 24.161 [36], the UE may send a BEARER RESOURCE ALLOCATION REQUEST message to the MME. If the traffic flow aggregate IE is not needed in those procedures, the UE shall set:\n-\tthe length indicator of the Traffic flow aggregate IE to the value 1;\n-\tthe TFT operation code to \"000\";\n-\tthe E bit to zero; and\n-\tthe number of packet filters to zero;\nand in the Required traffic flow QoS IE:\n-\tthe length indicator to the value 1; and\n-\tthe QCI to zero.\nUpon receipt of the BEARER RESOURCE ALLOCATION REQUEST message, the MME checks whether the resources requested by the UE can be established by verifying the EPS bearer identity given in the Linked EPS bearer identity IE to be any of the active default EPS bearer context(s).\nIf the bearer resource allocation requested is accepted by the network, the MME shall initiate either a dedicated EPS bearer context activation procedure or an EPS bearer context modification procedure. Upon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE ALLOCATION REQUEST message, the UE shall stop timer T3480 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see clause 7.3.1).\nIf the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. The UE shall then proceed as described in clause 6.4.2.3 or clause 6.4.2.4.\nIf the MODIFY EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. The UE shall then proceed as described in clause 6.4.3.3 or clause 6.4.3.4.\nIf the bearer resource allocation requested cannot be accepted by the network, the MME shall send a BEARER RESOURCE ALLOCATION REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource allocation.\nThe ESM cause value typically indicates one of the following:\n#26:\tinsufficient resources;\n#30:\trequest rejected by Serving GW or PDN GW;\n#31:\trequest rejected, unspecified;\n#32:\tservice option not supported;\n#33:\trequested service option not subscribed;\n#34:\tservice option temporarily out of order;\n#35:\tPTI already in use;\n#37:\tEPS QoS not accepted;\n#41:\tsemantic error in the TFT operation;\n#42:\tsyntactical error in the TFT operation;\n#43:\tinvalid EPS bearer identity;\n#44:\tsemantic error(s) in packet filter(s);\n#45:\tsyntactical error(s) in packet filter(s);\n#56:\tcollision with network initiated request;\n#59:\tunsupported QCI value;\n#60:\tbearer handling not supported;\n#65:\tmaximum number of EPS bearers reached; or\n#95 – 111:\tprotocol errors.\nIf the bearer resource allocation requested is for an established LIPA PDN connection or SIPTO at the local network PDN connection, then the network shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #60 \"bearer handling not supported\".\nIf the requested new TFT is not available, then the BEARER RESOURCE ALLOCATION REJECT message shall be sent.\nThe TFT in the request message is checked by the network for different types of TFT IE errors as follows:\na)\tSemantic errors in TFT operations:\n1)\tWhen the TFT operation is an operation other than \"Create a new TFT\".\nThe network shall reject the allocation request with ESM cause #41 \"semantic error in the TFT operation\".\nb)\tSyntactical errors in TFT operations:\n1)\tWhen the TFT operation = \"Create a new TFT\" and the packet filter list in the TFT IE is empty.\n2)\tWhen there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.\nThe network shall reject the allocation request with ESM cause #42 \"syntactical error in the TFT operation\".\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document.\n2)\tWhen the resulting TFT does not contain any packet filter which applicable for the uplink direction.\nThe network shall reject the allocation request with ESM cause #44 \"semantic errors in packet filter(s)\".\nd)\tSyntactical errors in packet filters:\n1)\tWhen the TFT operation = \"Create a new TFT\" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.\n2)\tWhen the TFT operation = \"Create a new TFT\" and two or more packet filters among all TFTs associated with the PDN connection would have identical packet filter precedence values.\n3)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\nIn case 2, if the old packet filters do not belong to the default EPS bearer context, the network shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters.\nIn case 2, if one or more old packet filters belong to the default EPS bearer context, the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure. If it is the last remaining PDN connection and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the network shall detach the UE using detach type \"re-attach required\".\nOtherwise the network shall reject the allocation request with ESM cause #45 \"syntactical errors in packet filter(s)\".\nThe network may include a Back-off timer value IE in the BEARER RESOURCE ALLOCATION REJECT message.\nIf the Back-off timer value IE is included and the ESM cause value is different from #26 \"insufficient resources\" and #65 \"maximum number of EPS bearers reached\", the network may include the Re-attempt indicator IE to indicate:\n-\twhether the UE is allowed to attempt a secondary PDP context activation procedure in the PLMN for the same  in A/Gb or Iu mode or a PDU session modification procedure in the PLMN for the same APN in N1 mode; and\n-\twhether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN.\nUpon receipt of a BEARER RESOURCE ALLOCATION REJECT message, the UE shall stop the timer T3480, release the traffic flow aggregate description associated to the PTI value, and enter the state PROCEDURE TRANSACTION INACTIVE.\nIf the ESM cause value is #26 \"insufficient resources\" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in clause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.5):\ni)\tif the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall then start T3396 with the value provided in the Back-off timer value IE and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop the timer T3396 associated with no APN if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;\nii)\tif the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 \"reactivation requested\" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 \"reactivation requested\" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or\niii)\tif the timer value indicates zero, the UE:\n-\tshall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and\n-\tif the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.\nIf the Back-off timer value IE is not included, the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN.\nThe further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.\nIf the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE behaves as follows:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;\n-\tif prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause 6.5.5; and\n-\tif prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause 6.5.5.\nIf the ESM cause value is different from #26 \"insufficient resources\" and #65 \"maximum number of EPS bearers reached\", and the Back-off timer value IE is included, the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.6):\n-\tif the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource allocation procedure and PLMN and  combination and not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same  until the back-off timer expires, the UE is switched off or the USIM is removed;\n-\tif the timer value indicates that this timer is deactivated, the UE shall not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same  until the UE is switched off or the USIM is removed; and\n-\tif the timer value indicates zero, the UE may send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same .\nIf the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt Indicator IE provided by the network, if any.\n1)\tAdditionally, if the ESM cause value is #32 \"service option not supported\", or #33 \"requested service option not subscribed\", the UE shall proceed as follows:\n-\tif the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall behave as described above in the present clause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, as back-off timer value; and\nNOTE 0:\tThe way to choose one of the configured SM_RetryWaitTime values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM_RetryWaitTime value in ME as specified in 3GPP TS 24.368 [15A]; and\n-\tan SM_RetryWaitTime value in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17].\n-\totherwise, if the UE is not registered in its HPLMN or a PLMN that is within the EHPLMN list (if the EHPLMN list is present) or the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present clause, using the default value of 12 minutes for the back-off timer.\n2)\tFor ESM cause values different from #32 \"service option not supported\", or #33 \"requested service option not subscribed\", the UE behaviour regarding the start of a back-off timer is unspecified.\nThe UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the bearer resource allocation procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.\nNOTE 1:\tThis means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode or N1 mode to S1 mode. Thus the UE can still be prevented from sending another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN.\nIf the back-off timer is started upon receipt of BEARER RESOURCE ALLOCATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:\n1)\tafter a PLMN change the UE may send a BEARER RESOURCE ALLOCATION REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the bearer resource allocation procedure and the combination of new PLMN and APN.\nFurthermore as an implementation option, for the ESM cause values #32 \"service option not supported\" or #33 \"requested service option not subscribed\", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs;\n2)\tif the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:\n-\tif the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, to determine whether the UE may attempt a secondary PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session modification procedure for the same PLMN and APN combination in N1 mode; and\nNOTE 2:\tThe way to choose one of the configured SM_RetryAtRATChange values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM_RetryAtRATChange value in ME as specified in 3GPP TS 24.368 [15A]; and\n-\tan SM_RetryAtRATChange value in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17].\n-\tif the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a secondary PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session modification procedure for the same PLMN and APN combination in N1 mode are unspecified; and\n3)\tif the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the bearer resource allocation procedure with the value provided by the network, or deactivate the respective back-off timer as follows:\n-\tif the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and\n-\totherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode.\nIf the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE SECONDARY PDP CONTEXT REJECT message (see 3GPP TS 24.008 [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.\nIf a back-off timer for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP TS 24.501 [54]) was started or deactivated in N1 mode upon receipt of a PDU SESSION MODIFICATION REJECT message (see 3GPP TS 24.501 [54]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. If more than one back-off timer for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed and no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN until the UE is switched off or the USIM is removed.\nNOTE 3:\tThe back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.\nNOTE 4:\tReference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.\nIf the ESM cause value is #65 \"maximum number of EPS bearers reached\", the UE shall determine the PLMN's maximum number of EPS bearer contexts in S1 mode (see clause 6.5.0) as the number of active EPS bearer contexts it has. The UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any.\nNOTE 5:\tIn some situations, when attempting to establish multiple EPS bearer contexts, the number of active EPS bearer contexts in the UE when cause #65 is received is not equal to the maximum number of EPS bearer contexts reached in the network.\nThe PLMN's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 \"maximum number of EPS bearers reached\" is received. When the UE is switched off or when the USIM is removed, the UE shall clear all previous determinations representing any PLMN's maximum number of EPS bearer contexts in S1 mode. Upon successful registration with a new PLMN, the UE may clear previous determinations representing any PLMN's maximum number of EPS bearer contexts in S1 mode.\nThe further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.\nIf the UE requests allocation of additional bearer resources, and the network has reached its maximum number of active EPS bearer contexts, then the network can:\n-\treject the request if the network decides that it is necessary to allocate a dedicated EPS bearer context; or\n-\taccept the request by sending a MODIFY EPS BEARER CONTEXT REQUEST message.\nNOTE:\tAn example of where the network will reject the request for allocation of additional bearer resources is when the request includes a GBR requirement while all existing bearers are non-GBR bearers, and the maximum number of active EPS bearer contexts has been reached at the network.\nIf the maximum number of active EPS bearer contexts is reached at the UE (see clause 6.5.0) and the UE de-activates an active EPS bearer context prior to sending the request for additional bearer resources, then choosing which EPS bearer context to de-activate is a implementation specific, however the UE shall not deactivate a default EPS bearer context for emergency.\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3480:\nOn the first expiry of the timer T3480, the UE shall resend the BEARER RESOURCE ALLOCATION REQUEST and shall reset and restart timer T3480. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3480, the UE shall abort the procedure, release the PTI allocated for this activation and enter the state PROCEDURE TRANSACTION INACTIVE.\nb)\tUnknown EPS bearer context\nUpon receipt of the BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 \"invalid EPS bearer identity\", the UE shall deactivate the existing default EPS bearer context locally without peer-to-peer signalling between the UE and the MME and shall stop the timer T3480.\nc)\tCollision of a UE requested bearer resource allocation procedure and an EPS bearer context deactivation procedure.\nWhen the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message for the default EPS bearer context related to the UE requested bearer resource allocation procedure, the UE shall abort the UE requested bearer resource allocation procedure and shall stop the timer T3480 and proceed with the EPS bearer context deactivation procedure.\nThe following abnormal case can be identified:\na)\tNo PDN connection with the linked EPS bearer identity activated:\nIf the linked EPS bearer identity included in the BEARER RESOURCE ALLOCATION REQUEST message does not belong to the default EPS bearer context of an established PDN connection, the MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #43 \"invalid EPS bearer identity\".\nb)\tBEARER RESOURCE ALLOCATION REQUEST message received for a PDN connection established for emergency bearer services:\nThe MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #31 \"request rejected, unspecified\".\nc)\tBEARER RESOURCE ALLOCATION REQUEST message received from a UE which is in a location where the PLMN is not allowed to operate\nIf the MME determines that the UE is in a location where the PLMN is not allowed to operate, the MME discards the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.4\tUE requested bearer resource modification procedure",
                            "text_content": "The purpose of the UE requested bearer resource modification procedure is for a UE to:\na)\trequest a modification;\nb)\trelease of bearer resources for a traffic flow aggregate;\nc)\tmodify a traffic flow aggregate by replacing packet filters or adding packet filters;\nd)\tre-negotiate header compression configuration associated to an EPS bearer context;\ne)\tindicate a change of 3GPP PS data off UE status for a PDN connection;\nf)\ttransmit information for the C2 authorization for the UAS services; or\ng)\tprovide a UE policy container with the length of two octets containing the UE STATE INDICATION message (see 3GPP TS 24.501 [54] annex D).\nWhen requesting a modification of bearer resources for a traffic flow aggregate or a modification of a traffic flow aggregate, the UE can modify the existing GBR. If accepted by the network, this procedure invokes a dedicated EPS bearer context activation procedure (see clause 6.4.2), an EPS bearer context modification procedure (see clause 6.4.3), or an EPS bearer context deactivation procedure (see clause 6.4.4).\nIf there is a PDN connection for emergency bearer services established, the UE shall not request a modification of bearer resources for this PDN connection.\nWhen the UE requested bearer resource modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDN connection (see clause 6.3.10), the UE shall initiate the UE requested bearer resource modification procedure even if the timer T3396 or the back-off timer is running or is deactivated.\nIn order to request the modification of bearer resources for one traffic flow aggregate, the UE shall send a BEARER RESOURCE MODIFICATION REQUEST message to the MME, start timer T3481 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.4.2.1).\nThe UE shall include the EPS bearer identity of the EPS bearer associated with the traffic flow aggregate in the EPS bearer identity for packet filter IE.\nTo request a change of the GBR without changing the packet filter(s), the UE shall set the TFT operation code in the Traffic flow aggregate IE to \"no TFT operation\" and include the packet filter identifier(s) to which the change of the GBR applies in the Packet filter identifier parameter in the parameters list. The UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.\nTo request a modification of a traffic flow aggregate, the UE shall set the TFT operation code in the Traffic flow aggregate IE to \"Replace packet filters in existing TFT\" or \"Add packet filters to existing TFT\". If the TFT operation code is set to \"Add packet filters to existing TFT\", the UE shall include in the parameter list one existing packet filter identifier to which the newly added packet filter(s) is linked. If the EPS bearer is a GBR bearer and the UE also wishes to request a change of GBR, the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.\nTo request a release of bearer resources, the UE shall set the TFT operation code in the Traffic flow aggregate IE to \"Delete packet filters from existing TFT\". If the EPS bearer is a GBR bearer and the UE does not request the release of all bearer resources, the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.\nTo request re-negotiation of header compression configuration associated to an EPS bearer context, the UE shall include the Header compression configuration IE in the BEARER RESOURCE MODIFICATION REQUEST message if the network indicated \"Control plane CIoT EPS optimization supported\" and \"Header compression for control plane CIoT EPS optimization supported\" in the EPS network feature support IE.\nAfter an inter-system change from N1 mode to S1 mode, if:\na)\tthe UE is operating in single-registration mode and has received the interworking without N26 interface indicator set to \"interworking without N26 interface not supported\" from the network;\nb)\tthe PDN type value of the PDN type IE is set to \"IPv4\", \"IPv6\" or \"IPv4v6\";\nc)\tthe UE indicates \"Control plane CIoT EPS optimization supported\" and \"Header compression for control plane CIoT EPS optimization supported\" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message; and\nd)\tthe network indicates \"Control plane CIoT EPS optimization supported\" and \"Header compression for control plane CIoT EPS optimization supported\" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message;\nthe UE shall send a BEARER RESOURCE MODIFICATION REQUEST message to the MME and include the Header compression configuration IE to negotiate the header compression configuration.\nTo indicate a change of 3GPP PS data off UE status associated to a PDN connection, the UE shall include the Protocol configuration options IE in the BEARER RESOURCE MODIFICATION REQUEST message and set the 3GPP PS data off UE status only if:\n-\tthe network included the 3GPP PS data off support indication in the Protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message when the PDN connection was established; or\n-\tthe PDU session was established when in N1 mode.\nTo indicate a change of 3GPP PS data off UE status, the UE shall include the EPS bearer identity of the default EPS bearer context of the PDN connection, for which the UE wishes a change of the 3GPP PS data off UE status, in the EPS bearer identity for packet filter IE.\nThe UE behaves as described in clause 6.3.10.\nIf the UE requests the modification of a traffic flow aggregate, which is assigned to a dedicated EPS bearer context, it shall ensure that at least one packet filter applicable for the uplink direction remains among the packet filters created on request from the UE in that TFT, or no own packet filters.\nNOTE 1:\tIf the UE requests the release of all bearer resources of a GBR bearer and includes a Required traffic flow QoS IE in the BEARER RESOURCE MODIFICATION REQUEST message, the network ignores the Required traffic flow QoS IE.\nIf the UE includes the Required traffic flow QoS IE, the UE shall set the QCI to the current QCI value of the EPS bearer context.\nIf the UE requests the release of bearer resources, the ESM cause value typically indicates one of the following:\n#36:\tregular deactivation.\nTo perform authorization for the C2 communication when a PDN connection is already established for the USS communication, the UE shall include the Extended protocol configuration options IE in the BEARER RESOURCE MODIFICATION REQUEST message containing the service-level-AA container with the length of two octets. In the service-level-AA container with the length of two octets, the UE shall include:\na)\tthe service-level device ID, with the value set to CAA-level UAV ID;\nb)\tif provided by the upper layers, the service-level-AA payload type parameter with the value set to \"C2 authorization payload\"; and\nc)\tthe service-level-AA payload parameter, with the value set to C2 authorization payload.\nNOTE 2:\tThe C2 authorization payload can contain one, some or all of the pairing information for C2 communication, an indication of the request for direct C2 communication, pairing information for direct C2 communication and flight authorization information.\nTo provide a UE policy container with the length of two octets containing the UE STATE INDICATION message (see 3GPP TS 24.501 [54] annex D), the UE shall include the Extended protocol configuration options IE in the BEARER RESOURCE MODIFICATION REQUEST message, and include the UE policy container with the length of two octets in the Extended protocol configuration options IE.\n\nThe figure depicts the UE's request for a bearer resource modification procedure, which is a crucial step in the network's operation. The figure shows the steps involved in modifying the bearer resource, including the request, the network's response, and the UE's subsequent actions. This figure is crucial for ensuring the smooth functioning of the network and maintaining the quality of service for the users.\nFigure 6.5.4.2.1: UE requested bearer resource modification procedure\nFor the NBIFOM procedures as defined in 3GPP TS 24.161 [36], the UE may send a BEARER RESOURCE MODIFICATION REQUEST message to the MME.\nIt is possible that the traffic flow aggregate IE is not needed in the following procedures:\n-\tre-negotiation of header compression configuration associated to an EPS bearer context;\n-\tindicating a change of 3GPP PS data off UE status associated to a PDN connection; or\n-\tNBIFOM procedures.\nIf the traffic flow aggregate IE is not needed, the UE shall set:\n-\tthe length indicator of the Traffic flow aggregate IE to the value 1;\n-\tthe TFT operation code to \"000\";\n-\tthe E bit to zero; and\n-\tthe number of packet filters to zero.\nUpon receipt of the BEARER RESOURCE MODIFICATION REQUEST message, the MME checks whether the resources requested by the UE can be established, modified or released by verifying the EPS bearer identity given in the EPS bearer identity for packet filter IE.\nIf the bearer resource modification requested is accepted by the network, the MME shall initiate either a dedicated EPS bearer context activation procedure, an EPS bearer context modification procedure or an EPS bearer context deactivation procedure.\nIf the request to re-negotiate header compression configuration associated to an EPS bearer context is accepted by the network, the MME shall initiate an EPS bearer context modification procedure.\nIf the bearer resource modification requests a release of bearer resources that results in the TFT of the EPS bearer context containing only packet filters applicable to the uplink direction, the network may initiate the EPS bearer context deactivation procedure.\nUpon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, MODIFY EPS BEARER CONTEXT REQUEST or DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE MODIFICATION REQUEST message, the UE shall stop timer T3481 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST or DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see clause 7.3.1).\ni)\tIf the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. The UE shall then proceed as described in clause 6.4.2.3 or clause 6.4.2.4.\nii)\tIf the MODIFY EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. The UE shall then proceed as described in clause 6.4.3.3 or clause 6.4.3.4.\niii)\tIf the DEACTIVATE EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is one of the active EPS bearer contexts. The UE shall then proceed as described in clause 6.4.4.3.\nIn case i, after successful completion of the dedicated EPS bearer context activation procedure, the network may initiate an EPS bearer context modification procedure to delete the packet filters which have packet filter identifiers indicated by the UE in the Traffic flow aggregate IE in the BEARER RESOURCE MODIFICATION REQUEST message and for which the network created new packet filters during the dedicated EPS bearer context activation procedure. In this case the MME shall set the procedure transaction identity value in the MODIFY EPS BEARER CONTEXT REQUEST message to \"no procedure transaction identity assigned\".\nIf the bearer resource modification requested cannot be accepted by the network, the MME shall send a BEARER RESOURCE MODIFICATION REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource modification.\nThe ESM cause value typically indicates one of the following:\n#26:\tinsufficient resources;\n#30:\trequest rejected by Serving GW or PDN GW;\n#31:\trequest rejected, unspecified;\n#32:\tservice option not supported;\n#33:\trequested service option not subscribed;\n#34:\tservice option temporarily out of order;\n#35:\tPTI already in use;\n#37:\tEPS QoS not accepted;\n#41:\tsemantic error in the TFT operation;\n#42:\tsyntactical error in the TFT operation;\n#43:\tinvalid EPS bearer identity;\n#44:\tsemantic error(s) in packet filter(s);\n#45:\tsyntactical error(s) in packet filter(s);\n#56:\tcollision with network initiated request;\n#59:\tunsupported QCI value;\n#60:\tbearer handling not supported; or\n#95 – 111:\tprotocol errors.\nIf the bearer resource modification requested is for an established LIPA PDN connection or SIPTO at the local network PDN connection, then the network shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #60 \"bearer handling not supported\".\nIf the requested new TFT is not available, then the BEARER RESOURCE MODIFICATION REJECT message shall be sent.\nThe TFT in the request message is checked by the network for different types of TFT IE errors as follows:\na)\tSemantic errors in TFT operations:\n1)\tWhen the TFT operation is an operation other than \"Replace packet filters in existing TFT\", \"Add packet filters to existing TFT\", \"Delete packet filters from existing TFT\" or \"No TFT operation\".\n2)\tWhen the TFT operation is \"Replace packet filters in existing TFT\", \"Add packet filters to existing TFT\" or \"Delete packet filters from existing TFT\", the EPS bearer context being modified is the default EPS bearer content and there is no TFT for the default EPS bearer context.\n3)\tTFT operation = \"Delete packet filters from existing TFT\" when it would render the TFT empty.\nIn case 1 the network shall reject the modification request with ESM cause #41 \"semantic error in the TFT operation\".\nIn case 2, if the TFT operation is \"Delete packet filters from existing TFT\", the network shall further process the new request and, if no error according to items b, c, and d was detected, shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = \"Delete existing TFT\" in the MODIFY EPS BEARER CONTEXT REQUEST message.\nIn case 2, if the TFT operation is \"Replace packet filters in existing TFT\" or \"Add packet filters to existing TFT\", the network shall process the new request as a request with TFT operation = \"Create a new TFT\".\nIn case 3, if the packet filters belong to a dedicated EPS bearer context, the network shall process the new deletion request and, if no error according to items b, c, and d was detected, delete the existing TFT. After successful deletion of the TFT, the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context between the UE and the network.\nIn case 3, if the packet filters belong to the default EPS bearer context, the network shall process the new deletion request and if no error according to items b, c, and d was detected then perform an EPS bearer context modification procedure to remove the existing TFT of the default EPS bearer context, this corresponds to using match-all packet filter for the default EPS bearer context.\nb)\tSyntactical errors in TFT operations:\n1)\tWhen the TFT operation = \"Replace packet filters in existing TFT\", \"Add packet filters to existing TFT\" or \"Delete packet filters from existing TFT\", and the packet filter list in the TFT IE is empty.\n2)\tTFT operation = \"No TFT operation\" with a non-empty packet filter list in the TFT IE.\n3)\tTFT operation = \"Replace packet filters in existing TFT\" when the packet filter to be replaced does not exist in the original TFT.\n4)\tTFT operation = \"Delete packet filters from existing TFT\" when the packet filter to be deleted does not exist in the original TFT.\n5)\tVoid\n6)\tWhen there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.\n7)\tTFT operation = \"No TFT operation\" with an empty parameters list.\nIn case 3 the network shall not diagnose an error, shall further process the replace request and, if no error according to items c and d was detected, shall perform an EPS bearer context modification procedure using TFT operation = \"Add packet filters to existing TFT\" to include the packet filters received to the existing TFT.\nIn case 4 the network shall not diagnose an error, shall further process the deletion request and, if no error according to items c and d was detected, shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = \"Delete packet filters from existing TFT\" and the received packet filter identifier(s) in the MODIFY EPS BEARER CONTEXT REQUEST message.\nOtherwise the network shall reject the modification request with ESM cause #42 \"syntactical error in the TFT operation\".\nNOTE:\tAn implementation that strictly follows packet filter list as defined in subclause 10.5.6.12 in 3GPP TS 24.008 [13] might not detect case 2).\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document.\n2)\tWhen the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction.\nThe network shall reject the modification request with ESM cause #44 \"semantic errors in packet filter(s)\".\nd)\tSyntactical errors in packet filters:\n1)\tWhen the TFT operation = \"Replace packet filters in existing TFT\" or \"Add packet filters to existing TFT\", and two or more packet filters in the resultant TFT would have identical packet filter identifiers.\n2)\tWhen the TFT operation = \"Replace packet filters in existing TFT\" or \"Add packet filters to existing TFT\", and two or more packet filters in all TFTs associated with the PDN connection would have identical packet filter precedence values.\n3)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\nIn case 2, if the old packet filters do not belong to the default EPS bearer context, the network shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the network shall perform an EPS bearer context deactivation procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters.\nIn case 2, if one or more old packet filters belong to the default EPS bearer context, the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure. If the relevant PDN connection is the last one and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the network shall detach the UE using detach type \"re-attach required\".\nOtherwise the network shall reject the modification request with ESM cause #45 \"syntactical errors in packet filter(s)\".\nThe network may include a Back-off timer value IE in the BEARER RESOURCE MODIFICATION REJECT message.\nThe network shall not include the ESM cause value #26 \"insufficient resources\" in the BEARER RESOURCE MODIFICATION REJECT message due to APN based congestion control being active.\nIf the Back-off timer value IE is included and the ESM cause value is not #26 \"insufficient resources\", the network may include the Re-attempt indicator IE to indicate:\n-\twhether the UE is allowed to attempt a PDP context modification procedure in the PLMN for the same  in A/Gb or Iu mode or a PDU session modification procedure in the PLMN for the same APN in N1 mode; and\n-\twhether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN.\nUpon receipt of a BEARER RESOURCE MODIFICATION REJECT message, the UE shall stop the timer T3481, release the traffic flow aggregate description associated to the PTI value, and enter the state PROCEDURE TRANSACTION INACTIVE. If the ESM cause included in the BEARER RESOURCE MODIFICATION REJECT message is #43 \"invalid EPS bearer identity\", the UE locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling.\nIf the ESM cause value is #26 \"insufficient resources\" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in clause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.5):\ni)\tif the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall then start T3396 with the value provided in the Back-off timer value IE and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop the timer T3396 associated with no APN if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;\nii)\tif the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 \"reactivation requested\" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 \"reactivation requested\" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or\niii)\tif the timer value indicates zero, the UE:\n-\tshall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and\n-\tif the UE did not provide an APN for the establishment of the PDN connection and the request type was different from \"emergency\" and from \"handover of emergency bearer services\", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.\nIf the Back-off timer value IE is not included, the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN.\nThe further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.\nIf the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE behaves as follows:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;\n-\tif prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause 6.5.5; and\n-\tif prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause 6.5.5.\nIf the ESM cause value is not #26 \"insufficient resources\", and the Back-off timer value IE is included, the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in clause 6.3.6):\n-\tif the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource modification procedure and PLMN and  combination and not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in clause 6.5.4.1, in the PLMN for the same  until the back-off timer expires, the UE is switched off or the USIM is removed;\n-\tif the timer value indicates that this timer is deactivated, the UE shall not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in clause 6.5.4.1, in the PLMN for the same  until the UE is switched off or the USIM is removed; and\n-\tif the timer value indicates zero, the UE may send another BEARER RESOURCE MODIFICATION REQUEST message in the PLMN for the same .\nIf the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt indicator IE provided by the network, if any.\n1)\tAdditionally, if the ESM cause value is #32 \"service option not supported\", or #33 \"requested service option not subscribed\", the UE shall proceed as follows:\n-\tif the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall behave as described above in the present clause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, as back-off timer value; and\nNOTE 0:\tThe way to choose one of the configured SM_RetryWaitTime values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM_RetryWaitTime value in ME as specified in 3GPP TS 24.368 [15A]; and\n-\tan SM_RetryWaitTime value in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17].\n-\totherwise, if the UE is not registered in its HPLMN or a PLMN that is within the EHPLMN list (if the EHPLMN list is present) or the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present clause, using the default value of 12 minutes for the back-off timer.\n2)\tFor ESM cause values different from #32 \"service option not supported\", or #33 \"requested service option not subscribed\", the UE behaviour regarding the start of a back-off timer is unspecified.\nThe UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the bearer resource modification procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.\nNOTE 1:\tThis means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode or N1 mode to S1 mode. Thus the UE can still be prevented from sending another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in clause 6.5.4.1, in the PLMN for the same APN.\nIf the back-off timer is started upon receipt of BEARER RESOURCE MODIFICATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:\n1)\tafter a PLMN change the UE may send a BEARER RESOURCE MODIFICATION REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the bearer resource modification procedure and the combination of new PLMN and APN.\nFurthermore as an implementation option, for the ESM cause values #32 \"service option not supported\" or #33 \"requested service option not subscribed\", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another BEARER RESOURCE MODIFICATION REQUEST message for the same APN that was sent by the UE, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs;\n2)\tif the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:\n-\tif the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, to determine whether the UE may attempt a PDP context modification procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session modification procedure for the same PLMN and APN combination in N1 mode; and\nNOTE 2:\tThe way to choose one of the configured SM_RetryAtRATChange values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM_RetryAtRATChange value in ME as specified in 3GPP TS 24.368 [15A]; and\n-\tan SM_RetryAtRATChange value in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17].\n-\tif the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a PDP context modification procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session modification procedure for the same PLMN and APN combination in N1 mode are unspecified; and\n3)\tif the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the bearer resource modification procedure with the value provided by the network, or deactivate the respective back-off timer as follows:\n-\tif the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and\n-\totherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode.\nIf the back-off timer for a PLMN and APN combination was started or deactivated upon receipt of an MODIFY PDP CONTEXT REJECT message (see 3GPP TS 24.008 [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.\nIf a back-off timers for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP TS 24.501 [54]) was started or deactivated in N1 mode upon receipt of a PDU SESSION MODIFICATION REJECT message (see 3GPP TS 24.501 [54]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. If more than one back-off timer for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed and no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN until the UE is switched off or the USIM is removed.\nNOTE 3:\tThe back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.\nNOTE 4:\tReference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.\nThe further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3481:\nOn the first expiry of the timer T3481, the UE shall resend the BEARER RESOURCE MODIFICATION REQUEST and shall reset and restart timer T3481. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3481, the UE shall abort the procedure, release the PTI allocated for this activation and enter the state PROCEDURE TRANSACTION INACTIVE. In addition, if the UE had initiated resource release for all the traffic flows for the bearer, it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME. In order to synchronize the EPS bearer context status with the MME, on indication of \"back to E-UTRAN coverage\" from the lower layers, the UE shall send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.\nb)\tUnknown EPS bearer context:\nUpon receipt of the BEARER RESOURCE MODIFICATION REJECT message including ESM cause #43 \"invalid EPS bearer identity\", the UE shall deactivate the existing EPS bearer context locally without peer-to-peer signalling between the UE and the MME and shall stop the timer T3481.\nc)\tCollision of a UE requested bearer resource modification procedure and an EPS bearer context deactivation procedure:\nWhen the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the bearer resource modification procedure, and the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is an EPS bearer context the UE indicated in the UE requested bearer resource modification procedure, then the UE shall abort the UE requested bearer resource modification procedure and shall stop the timer T3481 and proceed with the EPS bearer context deactivation procedure.\nd)\tRejection of a UE requested bearer resource modification procedure when the UE has initiated the procedure to release all traffic flows for the bearer:\nUpon receipt of a BEARER RESOURCE MODIFICATION REJECT message with ESM cause value #31 \"request rejected, unspecified\", if the UE had initiated resource release for all the traffic flows for the bearer, it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME and shall stop the timer T3481. In order to synchronize the EPS bearer context status with the MME, the UE may send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.\ne)\tCollision of UE requested bearer resource modification procedure and EPS bearer context modification procedure:\nThe handling of the same abnormal case as described in clause 6.4.3.5 applies.\nThe following abnormal cases can be identified:\na)\tUnknown EPS bearer context:\nIf the EPS bearer identity provided in the EPS bearer identity for packet filter IE in the BEARER RESOURCE MODIFICATION REQUEST message indicates an EPS bearer identity value and this does not belong to any already activated EPS bearer context, the MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #43 \"invalid EPS bearer identity\".\nb)\tBEARER RESOURCE MODIFICATION REQUEST message received for a PDN connection established for emergency bearer services:\nThe MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #30 \"request rejected by Serving GW or PDN GW\".\nc)\tCollision of UE requested bearer resource modification procedure and EPS bearer context modification procedure:\nThe handling of the same abnormal case as described in clause 6.4.3.6 applies.\nd)\tBEARER RESOURCE MODIFICATION REQUEST message received from a UE which is in a location where the PLMN is not allowed to operate:\nIf the MME determines that the UE is in a location where the PLMN is not allowed to operate, the MME discards the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.5\tHandling session management request for UE configured for dual priority",
                            "text_content": "If timer T3396 is running for a specific APN due to one of the following reasons:\n-\ta PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396 and ESM cause value #26 \"insufficient resources\";\n-\ta DEACTIVATE EPS BEARER CONTEXT REQUEST message was received with a timer value for timer T3396 and ESM cause value #26 \"insufficient resources\" for a PDN connection established with low priority indicator set to \"MS is configured for NAS signalling low priority\", or\n-\tbecause the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 and ESM cause value #26 \"insufficient resources\" for a PDN connection established with low priority indicator set to \"MS is configured for NAS signalling low priority\",\nupon request of the upper layers the UE can:\n-\tsend a PDN CONNECTIVITY REQUEST message to the same APN, with low priority indicator set to \"MS is not configured for NAS signalling low priority\"; or,\n-\tsend a BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message, with low priority indicator set to \"MS is not configured for NAS signalling low priority\", for a PDN connection established with low priority indicator set to \"MS is not configured for NAS signalling low priority\" exists.\nIf timer T3396 is running, because any of the following messages containing the low priority indicator set to \"MS is configured for NAS signalling low priority\" was rejected with a timer value for timer T3396 and ESM cause value #26 \"insufficient resources\":\n-\ta PDN CONNECTIVITY REQUEST without APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", sent together with an ATTACH REQUEST message;\n-\ta stand-alone PDN CONNECTIVITY REQUEST message without APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\"; or\n-\ta BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message sent for a non-emergency PDN connection established without APN provided by the UE,\nor because the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 and ESM cause value #26 \"insufficient resources\" for a non-emergency PDN connection established without APN provided by the UE and established with low priority indicator set to \"MS is configured for NAS signalling low priority\", then upon request of the upper layers the UE can initiate a new attach procedure or stand-alone PDN CONNECTIVITY REQUEST procedure without APN and with request type different from \"emergency\" and from \"handover of emergency bearer services\", with low priority indicator set to \"MS is not configured for NAS signalling low priority\".\nFor requests with low priority indicator set to \"MS is configured for NAS signalling low priority\", the UE shall follow the procedures specified in clause 6.5.1.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.6\tMiscellaneous procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.6.1\tExchange of protocol configuration options",
                            "text_content": "The UE and the PDN GW can exchange protocol configuration options via the dedicated ESM information request procedure or via other ESM procedures.\nIf supported by the network and UE end-to-end for a PDN connection, protocol configuration options shall be exchanged via the Extended protocol configuration options IE. Otherwise the Protocol configuration options IE is used.\nNOTE 1:\tIn this version of the protocol inter-system mobility to and from NB-S1 mode is supported. During inter-system-mobility from NB-S1 mode to WB-S1 mode the end-to-end support of the Extended protocol configuration options IE can be lost, e.g. if the new MME does not support the Extended protocol configuration options IE.\nFor the UE, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if\n-\tthe UE is in NB-S1 mode;\n-\tthe APN requested for the PDN connection is for UAS services;\n-\tthe PDN Type requested for the PDN connection is non-IP or Ethernet;\n-\tthe network has indicated support of the Extended protocol configuration options IE in the last ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message and the network has included the Extended protocol configuration options IE in at least one EPS session management message received by the UE for this PDN connection; or\n-\ta corresponding PDU session was transferred after inter-system change from N1 mode to S1 mode.\nFor the MME, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if\n-\tthe UE is in NB-S1 mode;\n-\tthe APN requested for the PDN connection is for UAS services;\n-\tthe PDN Type requested for the PDN connection is non-IP or Ethernet;\n-\tthe UE has indicated support of the Extended protocol configuration options IE in the last ATTACH REQUEST or TRACKING AREA UPDATING REQUEST message, and the MME has received the Extended protocol configuration options IE in at least one message sent by the PDN GW towards the UE for this PDN connection (for details see 3GPP TS 29.274 [16D]); or\n-\ta corresponding PDU session was transferred after inter-system change from N1 mode to S1 mode.\nNOTE 2:\tFor the PDN GW, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if the last support indication received from the MME or S-GW indicates that extended protocol configuration options is supported for this PDN connection (for details see 3GPP TS 29.274 [16D]).\nThe ESM information request procedure is used by the network to retrieve ESM information, i.e. protocol configuration options, APN, or both from the UE during the attach procedure if the UE indicated in the PDN CONNECTIVITY REQUEST message that it has ESM information that needs to be sent security protected. The purpose of this procedure is to provide privacy for the ESM information if ciphering is enabled in the network.\nThe network initiates the ESM information request procedure by sending an ESM INFORMATION REQUEST message to the UE, starting timer T3489 and entering the state PROCEDURE TRANSACTION PENDING (see example in figure 6.6.1.2.2.1). This message shall be sent only after the security context has been setup, and if the ESM information transfer flag has been set in the PDN CONNECTIVITY REQUEST message. The MME shall set the EPS bearer identity of the ESM INFORMATION REQUEST message to the value \"no EPS bearer identity assigned\" and include the PTI from the associated PDN CONNECTIVITY REQUEST message.\nThe figure depicts a detailed flowchart for the ESM (Enhanced Service Migration) information request procedure, illustrating the steps involved in requesting ESM information from the network. The figure includes various nodes and arrows, representing the different stages of the process, such as initiating the request, receiving the request, and processing the request. The figure is a visual representation of the complex process, making it easier to understand and follow.\nFigure 6.6.1.2.2.1: ESM information request procedure\nUpon receipt of the ESM INFORMATION REQUEST message, the UE shall send an ESM INFORMATION RESPONSE message to the network. The UE shall include all the protocol configuration options that need to be transferred security protected, and APN if required, to the network in the ESM INFORMATION RESPONSE message. The UE shall set the EPS bearer identity of the ESM INFORMATION RESPONSE message to the value \"no EPS bearer identity assigned\" and include the PTI from the ESM INFORMATION REQUEST message.\nUpon receipt of the ESM INFORMATION RESPONSE message, the network shall stop timer T3489 and enter the state PROCEDURE TRANSACTION INACTIVE. A Protocol configuration options IE or Extended protocol configuration options IE included in the ESM INFORMATION RESPONSE message replaces any Protocol configuration options IE or Extended protocol configuration options IE that the network previously may have received during the attach procedure execution.\nApart from the case described in clause 6.3.3, no abnormal cases have been identified.\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3489:\nOn the first expiry of the timer T3489, the MME shall resend the ESM INFORMATION REQUEST message and shall reset and restart timer T3489. This retransmission is repeated two times, i.e. on the third expiry of timer T3489, the MME shall abort the procedure, release any resources for this procedure and reject the associated PDN connectivity procedure including the ESM cause #53 \"ESM information not received\", in the PDN CONNECTIVITY REJECT message.\nThe UE may include a Protocol configuration options IE or Extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity request, PDN disconnect request, bearer resource allocation request and bearer resource modification request if the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the PDN GW or the SCEF. In particular, the UE may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP TS 24.008 [13], clause 6.4.\nThe PDN GW or the SCEF may include a Protocol configuration options IE or Extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity reject, PDN disconnect reject, bearer resource allocation reject and bearer resource modification reject if the PDN GW or the SCEF wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE. In particular, the PDN GW may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP TS 24.008 [13], clause 6.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.2\tNotification procedure",
                            "text_content": "The network can use the notification procedure to inform the UE about events which are relevant for the upper layer which is using an EPS bearer context or has requested a procedure transaction.\nIf the UE has indicated that it supports the notification procedure, the network may initiate the procedure at any time while a PDN connection exists or a procedure transaction is ongoing.\nThe network initiates the notification procedure by sending a NOTIFICATION message to the UE (see example in figure 6.6.2.2.1).\nThe figure depicts a step-by-step process for notification procedures in a telecommunications system. It includes a flowchart that outlines the steps from initial notification to final response, with arrows indicating the sequence of actions. The figure is labeled \"Figure 6.6.2.2.1: Notification procedure,\" which indicates that it is a part of a larger set of figures that illustrate various aspects of telecommunications systems.\nFigure 6.6.2.2.1: Notification procedure\nWhen the UE receives a NOTIFICATION message, the ESM protocol entity in the UE shall provide the notification indicator to the upper layer.\nThe notification indicator can have the following value:\n#1:\tSRVCC handover cancelled, IMS session re-establishment required.\nThe following abnormal case can be identified:\na)\tLower layer indication of non-delivered NAS PDU due to handover\nIf the NOTIFICATION message could not be delivered due to an intra MME handover, then upon successful completion of the intra MME handover the MME shall retransmit the NOTIFICATION message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the NOTIFICATION message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.3\tRemote UE Report procedure",
                            "text_content": "The purpose of the Remote UE Report procedure is for a UE acting as ProSe UE-to-network relay to notify the network that a remote UE is connected to the ProSe UE-to-network relay or disconnected from the ProSe UE-to-network relay as specified in 3GPP TS 23.303 [31].\nThe UE does not initiate the remote UE report procedure if the timer T3396 is running.\nThe UE initiates the Remote UE Report procedure by sending a REMOTE UE REPORT message to the network, starting timer T3493 and entering the state PROCEDURE TRANSACTION PENDING (see example in figure 6.6.3.2.1). The UE shall include information of newly connected or disconnected remote UEs to the network in the REMOTE UE REPORT message. If any encrypted IMSI remote UE identity is included in the REMOTE UE REPORT message, the UE shall include the corresponding ProSe Key Management Function address. The UE shall include the default EPS bearer identity of the PDN connection associated with the remote UE connected to the ProSe UE-to-network relay or disconnected from the ProSe UE-to-network relay. If the UE allocated an IPv4 address to a remote UE and enabled UDP usage to the remote UE, the UE shall include in the REMOTE UE REPORT message the UDP port range assigned to the remote UE in the NAT function of ProSe layer-3 UE-to-network relay. If the UE allocated an IPv4 address to a remote UE and enabled TCP usage to the remote UE, the UE shall include in the REMOTE UE REPORT message the TCP port range assigned to the remote UE in the NAT function of ProSe layer-3 UE-to-network relay.\nNOTE:\tEncrypted IMSI remote UE identities corresponding to different ProSe Key Management Function addresses need to be reported using separate REMOTE UE REPORT messages.\n\nThe figure depicts a remote UE (User Equipment) report procedure, illustrating the steps involved in reporting a fault or issue to the network control center. The figure includes a diagram of the network infrastructure, with various components such as the base station (BTS), user equipment (UE), and network elements like the network control center (NCC). The diagram also shows the communication paths between the BTS and the NCC, as well as the reporting process. The figure is essential for ensuring efficient and accurate reporting of network issues, enabling quick resolution and maintaining network reliability.\nFigure 6.6.3.2.1: Remote UE Report procedure\nUpon receipt of the REMOTE UE REPORT message, the MME shall send a REMOTE UE REPORT RESPONSE message to the UE. The MME shall include the PTI from the REMOTE UE REPORT message.\nUpon receipt of the REMOTE UE REPORT RESPONSE message, the UE shall stop timer T3493 and enter the state PROCEDURE TRANSACTION INACTIVE.\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3493:\nOn the first expiry of the timer T3493, the UE shall resend the REMOTE UE REPORT message and shall reset and restart timer T3493. This retransmission is repeated two times, i.e. on the third expiry of timer T3493, the UE shall abort the procedure and release any resources for this procedure.\nNOTE:\tAfter the abortion of the Remote UE Report procedure, the Remote UE Report procedure for the remote UE(s) can be restarted and how to restart the procedure is left to UE implementation.\nThe following abnormal cases can be identified:\na)\tUnknown EPS bearer context:\nIf the EPS bearer identity provided in the REMOTE UE REPORT message indicates an EPS bearer identity value which does not belong to any already activated EPS bearer context, the MME shall reply with the ESM STATUS message with ESM cause #43 \"invalid EPS bearer identity\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.4\tTransport of user data via the control plane procedure",
                            "text_content": "The purpose of the transport of user data via the control plane procedure is to transfer user data via the control plane in an encapsulated form between the UE and the MME.\nThe procedure may be initiated by the UE or the network when the UE is in EMM-CONNECTED mode.\nThe procedure may also be initiated by the UE in EMM-IDLE mode by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message.\nUpon receipt of a request to transfer user data via the control plane, if the UE is in EMM-CONNECTED mode, the UE initiates the procedure by sending the ESM DATA TRANSPORT message including the user data to be sent in the User data container IE (see example in figure 6.6.4.2.1). The length of the value part of the User data container IE should not exceed the link MTU size for the respective type of user data (IPv4, IPv6 or Non-IP). If the user data in the value part of the User data container IE is an Ethernet frame, then the length of the Ethernet frame payload should not exceed the Ethernet frame payload MTU size.\nNOTE:\tThe recommended maximum size for link MTU is 1358 octets to prevent fragmentation in the backbone network (see 3GPP TS 23.060 [74]). Depending on the network configuration, setting link MTU size to a value larger than 1358 octets could lead to inefficient core network implementation due to fragmentation.\nIf the UE is in EMM-IDLE mode, the UE initiates the procedure by sending the ESM DATA TRANSPORT message included in a CONTROL PLANE SERVICE REQUEST message.\nBased on information provided by the upper layers, the UE may include a Release assistance indication IE in the ESM DATA TRANSPORT message to inform the network that\n1)\tsubsequent to the current uplink data transmission no further uplink or downlink data transmission (e.g. an acknowledgement or response) is expected; i.e. the upper layers indicated that data exchanges have completed with the current UL data transfer; or\n2)\tsubsequent to the current uplink data transmission only a single downlink data transmission and no further uplink data transmission is expected; i.e. the upper layers indicated that data exchanges will have completed with the next downlink data transmission.\nWhen receiving the ESM DATA TRANSPORT message, the MME shall identify the PDN connection to the SCEF or to the PDN GW, based on the EPS bearer identity included in message, and forward the contents of the User data container IE accordingly. If the ESM DATA TRANSPORT message includes a Release assistance indication IE, then ESM layer indicates to the EMM layer to initiate release of the NAS signalling connection,\n1)\tif the release assistance indication indicates that no further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected; or\n2)\tupon subsequent delivery of the next received downlink data transmission to the UE if the release assistance indication indicates that only a single downlink data transmission and no further uplink data transmission subsequent to the uplink data transmission is expected.\nThe figure depicts a user-initiated transport of user data via the control plane procedure, illustrating the flow of data from the user equipment (UE) to the network control center (NCC). The figure shows the control plane process, which includes the network control center (NCC), the network control plane (NCP), and the network control plane (NCP). The figure also highlights the role of the network control plane (NCP) in managing the network and ensuring data integrity.\nFigure 6.6.4.2.1: UE initiated transport of user data via the control plane procedure\nThe network initiates the procedure by sending the ESM DATA TRANSPORT message (see example in figure 6.6.4.3.1). Upon receiving the ESM DATA TRANSPORT message, the UE shall:\n-\tforward the contents of the User data container IE to the upper layers.\nThe figure depicts a network initiated transport of user data via the control plane procedure, illustrating the flow of data from the network to the control plane.\nFigure 6.6.4.3.1: Network initiated transport of user data via the control plane procedure\nThe following abnormal case can be identified:\na)\tT3396 is running\nThe UE shall not send an ESM DATA TRANSPORT message unless\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN; or\n-\tthe ESM DATA TRANSPORT message is used for an exception data reporting and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).\nThe ESM DATA TRANSPORT message can be sent, if still necessary, when timer T3396 expires or is stopped.\nb)\tTransmission failure of the ESM DATA TRANSPORT message indication from lower layers\nIf lower layers indicate a TAI change and the current TAI is not in the TAI list, the transport of user data via the control plane procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure if the control plane CIoT EPS optimisation is still used and the user data exists. The \"signalling active\" flag shall be set in the TRACKING AREA UPDATE REQUEST message.\nIf lower layers indicate a TAI change, but the current TAI is still part of the TAI list, or the TAI has not changed, the transport of user data via the control plane procedure shall be re-initiated immediately if the user data still exists by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message.\nNOTE:\tHow the ESM sublayer handles the retransmission of user data via the control plane is up to the UE implementation.\nc)\tNAS MAC calculation indication from lower layers\nIf lower layers indicate to calculate an NAS MAC, the UE shall calculate an NAS MAC as specified in 3GPP TS 33.401 [19] and then provide the calculated NAS MAC and 5 least significant bits of the uplink NAS COUNT used to calculate the NAS MAC to lower layers (see 3GPP TS 36.331 [22]). The UE shall increase the uplink NAS COUNT by one after the calculation of the NAS MAC.\na)\tESM DATA TRANSPORT message received from a UE which is in a location where the PLMN is not allowed to operate\nIf the MME determines that the UE is in a location where the PLMN is not allowed to operate, the MME discards the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.7\tReception of an ESM STATUS message by an ESM entity",
                    "description": "",
                    "summary": "",
                    "text_content": "The purpose of the sending of the ESM STATUS message is to report at any time certain error conditions detected upon receipt of ESM protocol data. The ESM STATUS message can be sent by both the MME and the UE (see example in figure 6.7.1).\nIf the ESM entity of the UE receives an ESM STATUS message the UE shall take different actions depending on the received ESM cause value:\n#43\t(Invalid EPS bearer identity);\nThe UE shall abort any ongoing ESM procedure related to the received EPS bearer identity, stop any related timer, and deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the UE and the MME).\n#81\t(Invalid PTI value);\nThe UE shall abort any ongoing ESM procedure related to the received PTI value and stop any related timer.\n#97\t(Message type non-existent or not implemented);\nThe UE shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity and stop any related timer.\nOn receipt of an ESM STATUS message with any other ESM cause value no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible.\nIf the ESM entity of the MME receives an ESM STATUS message the MME shall take different actions depending on the received ESM cause value:\n#43\t(Invalid EPS bearer identity);\nThe MME shall abort any ongoing ESM procedure related to the received EPS bearer identity, stop any related timer, and deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the MME and the UE).\n#81\t(Invalid PTI value);\nThe MME shall abort any ongoing ESM procedure related to the received PTI value and stop any related timer.\n#97\t(Message type non-existent or not implemented);\nThe MME shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity and stop any related timer.\nThe local actions to be taken by the MME on receipt of an ESM STATUS message with any other ESM cause value are implementation dependent.\nThe figure depicts a step-by-step procedure for the execution of an ESM (Enhanced Software Defined Networking) status procedure. The figure includes a flowchart with various steps, such as initiating the procedure, setting up the network, and executing the procedure. The steps are labeled and connected by arrows, indicating the sequence of actions. The figure is a visual representation of the complex process of managing ESM status, highlighting the importance of proper planning and execution to ensure network stability and performance.\nFigure 6.7.1: ESM status procedure\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "7\tHandling of unknown, unforeseen, and erroneous protocol data",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures specified in the present document apply to those messages which pass the checks described in this clause.\nThis clause also specifies procedures for the handling of unknown, unforeseen, and erroneous protocol data by the receiving entity. These procedures are called \"error handling procedures\", but in addition to providing recovery mechanisms for error situations they define a compatibility mechanism for future extensions of the protocols.\nClauses 7.1 to 7.8 shall be applied in order of precedence.\nMost error handling procedures are mandatory for the UE.\nDetailed error handling procedures in the network are implementation dependent and may vary from PLMN to PLMN. However, when extensions of this protocol are developed, networks will be assumed to have the error handling that is indicated in this clause as mandatory (\"shall\") and that is indicated as strongly recommended (\"should\").\nAlso, the error handling of the network is only considered as mandatory or strongly recommended when certain thresholds for errors are not reached during a dedicated connection.\nFor definition of semantical and syntactical errors see 3GPP TS 24.007 [12], clause 11.4.2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2\tMessage too short",
                    "description": "",
                    "summary": "",
                    "text_content": "When a message is received that is too short to contain a complete message type information element, that message shall be ignored, cf. 3GPP TS 24.007 [12].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.3\tUnknown or unforeseen procedure transaction identity or EPS bearer identity",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.3.1\tProcedure transaction identity",
                            "text_content": "The following network procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message:\na)\tIf the network receives a PDN CONNECTIVITY REQUEST message with an unassigned or reserved PTI value, the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #81 \"invalid PTI value\".\nb)\tIf the network receives a PDN DISCONNECT REQUEST message with an unassigned or reserved PTI value, the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #81 \"invalid PTI value\".\nc)\tIf the network receives a BEARER RESOURCE ALLOCATION REQUEST message with an unassigned or reserved PTI value, the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #81 \"invalid PTI value\".\nd)\tIf the network receives a BEARER RESOURCE MODIFICATION REQUEST message with an unassigned or reserved PTI value, the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #81 \"invalid PTI value\".\ne)\tIf the network receives an ESM INFORMATION RESPONSE message which includes an unassigned or reserved PTI value, the network shall ignore the message. If the PTI is an assigned value that does not match the PTI in use for any ongoing transaction related procedure, the network shall respond with an ESM STATUS message including ESM cause #81 \"invalid PTI value\".\nf)\tIf the network receives an ESM message other than those listed in items a through e above with a reserved PTI value, the network shall ignore the message.\nThe following UE procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message:\na)\tIf the UE receives a PDN CONNECTIVITY REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.\nb)\tIf the UE receives a PDN DISCONNECT REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.\nc)\tIf the UE receives a BEARER RESOURCE ALLOCATION REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.\nd)\tIf the UE receives a BEARER RESOURCE MODIFICATION REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.\ne)\tIf the UE receives an ESM INFORMATION REQUEST message in which the PTI value is an unassigned or reserved value, the UE shall ignore the message. If the PTI is an assigned value that does not match a PTI in use for a pending UE requested PDN connectivity procedure for which the ESM information transfer flag was set in the PDN CONNECTIVITY REQUEST message, the UE shall respond with an ESM STATUS message including ESM cause #47 \"PTI mismatch\".\nf)\tIf the UE receives a NOTIFICATION message in which the PTI value is an unassigned value, the UE shall proceed as specified in clause 7.3.2. If the PTI is a reserved value, the UE shall respond with an ESM STATUS message including ESM cause #81 \"invalid PTI value\". If the PTI is an assigned value that does not match any PTI in use, the UE shall respond with an ESM STATUS message including ESM cause #47 \"PTI mismatch\".\ng)\tIf the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see clause 6.5.1.3) the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #47 \"PTI mismatch\".\nh)\tIf the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message which contains a reserved or unassigned PTI value, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #81 \"invalid PTI value\".\ni)\tIf the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see clauses 6.5.3.3 and 6.5.4.3) the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #47 \"PTI mismatch\".\nj)\tIf the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message which contains a reserved PTI value, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #81 \"invalid PTI value\".\nk)\tIf the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see clauses 6.5.3.3 and 6.5.4.3) the UE shall respond with a MODIFY EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #47 \"PTI mismatch\".\nl)\tIf the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message which contains a reserved PTI value, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #81 \"invalid PTI value\".\nm)\tIf the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message in which the PTI value is a reserved value or an assigned value that does not match any PTI in use, the UE shall ignore the message.\nn)\tIf the UE receives an ESM message other than those listed in items a through m with a reserved PTI value or an assigned value that does not match any PTI in use, the UE shall ignore the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.2\tEPS bearer identity",
                            "text_content": "The following network procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message (specified as the header of a standard L3 message, see 3GPP TS 24.007 [12]):\na)\tIf the network receives a PDN CONNECTIVITY REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #43 \"invalid EPS bearer identity\".\nb)\tIf the network receives a PDN DISCONNECT REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #43 \"invalid EPS bearer identity\".\nc)\tIf the network receives a BEARER RESOURCE ALLOCATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 \"invalid EPS bearer identity\".\nd)\tIf the network receives a BEARER RESOURCE MODIFICATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #43 \"invalid EPS bearer identity\".\ne)\tIf the network receives an ESM INFORMATION RESPONSE message which includes an assigned or reserved EPS bearer identity value, the network shall ignore the message.\nf)\tIf the network receives an ESM DATA TRANSPORT message which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the network shall respond with an ESM STATUS message including ESM cause #43 \"invalid EPS bearer identity\".\ng)\tIf the network receives an ESM message other than those listed in items a through e above in which the message includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the network shall ignore the message.\nThe following UE procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message:\na)\tIf the UE receives a PDN CONNECTIVITY REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.\nb)\tIf the UE receives a PDN DISCONNECT REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.\nc)\tIf the UE receives a BEARER RESOURCE ALLOCATION REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.\nd)\tIf the UE receives a BEARER RESOURCE MODIFICATION REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.\ne)\tIf the UE receives an ESM INFORMATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the UE shall respond with an ESM STATUS message including ESM cause #43 \"invalid EPS bearer identity\".\nf)\tIf the UE receives a NOTIFICATION message which includes a reserved EPS bearer identity value, an assigned EPS bearer identity value that does not match an existing EPS bearer context, or the combination of an unassigned PTI value and an unassigned EPS bearer identity value, the UE shall respond with an ESM STATUS message including ESM cause #43 \"invalid EPS bearer identity\".\ng)\tIf the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #43 \"invalid EPS bearer identity\".\nh)\tIf the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #43 \"invalid EPS bearer identity\".\ni)\tIf the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #43 \"invalid EPS bearer identity\".\nj)\tIf the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, the UE shall respond with a DEACTIVATE EPS BEARER CONTEXT ACCEPT message with the EPS bearer identity set to the received EPS bearer identity.\nk)\tIf the UE receives an ESM DATA TRANSPORT message which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the UE shall respond with an ESM STATUS message including ESM cause #43 \"invalid EPS bearer identity\".\nl)\tIf the UE receives an ESM message other than those listed in items a through j in which the message includes an unassigned or reserved EPS bearer identity value or a value that does not match an EPS bearer context of an established PDN connection, the UE shall ignore the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.4\tUnknown or unforeseen message type",
                    "description": "",
                    "summary": "",
                    "text_content": "If UE receives an EMM message or ESM message with message type not defined for the protocol discriminator (PD) or not implemented by the receiver, it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 \"message type non-existent or not implemented\".\nIf the network receives an EMM or ESM message with message type not defined for the PD or not implemented by the receiver in a protocol state where reception of an unsolicited message with the given PD from the UE is not foreseen in the protocol, the network actions are implementation dependent. Otherwise, if the network receives a message with message type not defined for the PD or not implemented by the receiver, it shall ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 \"message type non-existent or not implemented\".\nNOTE:\tA message type not defined for the PD in the given direction is regarded by the receiver as a message type not defined for the PD, see 3GPP TS 24.007 [12].\nIf the UE receives a message not compatible with the protocol state, the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #98 \"message type not compatible with protocol state\".\nIf the network receives a message not compatible with the protocol state, the network actions are implementation dependent.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.5\tNon-semantical mandatory information element errors",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.5.1\tCommon procedures",
                            "text_content": "When on receipt of a message,\n-\tan \"imperative message part\" error; or\n-\ta \"missing mandatory IE\" error\nis diagnosed or when a message containing:\n-\ta syntactically incorrect mandatory IE;\n-\tan IE unknown in the message, but encoded as \"comprehension required\" (see 3GPP TS 24.007 [12]); or\n-\tan out of sequence IE encoded as \"comprehension required\" (see 3GPP TS 24.007 [12]) is received,\nthe UE shall proceed as follows:\n-\tIf the message is not one of the messages listed in clause 7.5.3, item a, b, c, or d, the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 \"invalid mandatory information\"; and\nthe network shall proceed as follows:\n-\tIf the message is not one of the messages listed in clause 7.5.3, item e, f, g or h, the network shall either:\n-\ttry to treat the message (the exact further actions are implementation dependent); or\n-\tignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 \"invalid mandatory information\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.2\tEPS mobility management",
                            "text_content": "No exceptional cases are described for mobility management messages.\nNo semantical or syntactical diagnosis other than presence and length shall be performed on the ESM message container information element in the ATTACH REQUEST, ATTACH ACCEPT, ATTACH COMPLETE and CONTROL PLANE SERVICE REQUEST messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.3\tEPS session management",
                            "text_content": "The following UE procedures shall apply for handling an error encountered with a mandatory information element in an ESM message:\na)\tIf the message is an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message with ESM cause #96 \"invalid mandatory information\", shall be returned.\nb)\tIf the message is an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #96 \"invalid mandatory information\", shall be returned.\nc)\tIf the message is a MODIFY EPS BEARER CONTEXT REQUEST, a MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #96 \"invalid mandatory information\", shall be returned.\nd)\tIf the message is a DEACTIVATE EPS BEARER CONTEXT REQUEST, a DEACTIVATE EPS BEARER CONTEXT ACCEPT message shall be returned. All resources associated with that EPS bearer shall be released.\nThe following network procedures shall apply for handling an error encountered with a mandatory information element in an ESM message:\na)\tIf the message is a PDN CONNECTIVITY REQUEST, a PDN CONNECTIVITY REJECT message with ESM cause #96 \"invalid mandatory information\", shall be returned.\nb)\tIf the message is a PDN DISCONNECT REQUEST, a PDN DISCONNECT REJECT message with ESM cause #96 \"invalid mandatory information\", shall be returned.\nc)\tIf the message is a BEARER RESOURCE ALLOCATION REQUEST, a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #96 \"invalid mandatory information\", shall be returned.\nd)\tIf the message is a BEARER RESOURCE MODIFICATION REQUEST, a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #96 \"invalid mandatory information\", shall be returned.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.6\tUnknown and unforeseen IEs in the non-imperative message part",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.6.1\tIEIs unknown in the message",
                            "text_content": "The UE shall ignore all IEs unknown in a message which are not encoded as \"comprehension required\" (see 3GPP TS 24.007 [12]).\nThe network shall take the same approach.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.2\tOut of sequence IEs",
                            "text_content": "The UE shall ignore all out of sequence IEs in a message which are not encoded as \"comprehension required\" (see 3GPP TS 24.007 [12]).\nThe network should take the same approach.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.3\tRepeated IEs",
                            "text_content": "If an information element with format T, TV, TLV, or TLV-E is repeated in a message in which repetition of the information element is not specified in clause 8 of the present document, the UE shall handle only the contents of the information element appearing first and shall ignore all subsequent repetitions of the information element. When repetition of information elements is specified, the UE shall handle only the contents of specified repeated information elements. If the limit on repetition of information elements is exceeded, the UE shall handle the contents of information elements appearing first up to the limit of repetitions and shall ignore all subsequent repetitions of the information element.\nThe network should follow the same procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.7\tNon-imperative message part errors",
                    "description": "",
                    "summary": "",
                    "text_content": "This category includes:\n-\tsyntactically incorrect optional IEs; and\n-\tconditional IE errors.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.7.1\tSyntactically incorrect optional IEs",
                            "text_content": "The UE shall treat all optional IEs that are syntactically incorrect in a message as not present in the message.\nThe network shall take the same approach.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.7.2\tConditional IE errors",
                            "text_content": "When upon receipt of a EMM or ESM message the UE diagnoses a \"missing conditional IE\" error or an \"unexpected conditional IE\" error, or when it receives a EMM or ESM message containing at least one syntactically incorrect conditional IE, the UE shall ignore the message and shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 \"conditional IE error\".\nWhen the network receives a message and diagnoses a \"missing conditional IE\" error or an \"unexpected conditional IE\" error or when it receives a message containing at least one syntactically incorrect conditional IE, the network shall either:\n-\ttry to treat the message (the exact further actions are implementation dependent); or\n-\tignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 \"conditional IE error\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.8\tMessages with semantically incorrect contents",
                    "description": "",
                    "summary": "",
                    "text_content": "When a message with semantically incorrect contents is received, the UE shall perform the foreseen reactions of the procedural part of the present document (i.e. of clauses 4, 5 and 6). If however no such reactions are specified, the UE shall ignore the message except that it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #95 \"semantically incorrect message\".\nThe network should follow the same procedure except that a status message is not normally transmitted.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "8\tMessage functional definitions and contents",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines the structure of the messages of the Layer 3 (L3) protocols defined in the present document. These are standard L3 messages as defined in 3GPP TS 24.007 [12].\nEach definition given in the present clause includes:\na)\ta brief description of the message direction and use, including whether the message has:\n1.\tLocal significance, i.e. relevant only on the originating or terminating access;\n2.\tAccess significance, i.e. relevant in the originating and terminating access, but not in the network;\n3.\tDual significance, i.e. relevant in either the originating or terminating access and in the network; or\n4.\tGlobal significance, i.e. relevant in the originating and terminating access and in the network.\nb)\ta table listing the Information Elements (IE) known in the message and the order of their appearance in the message. All IEs that may be repeated are explicitly indicated (The V, LV and LV-E formatted IEs, which compose the imperative part of the message, occur before the T, TV, TLV and TLV-E formatted IEs which compose the non-imperative part of the message, see 3GPP TS 24.007 [12]). In a (maximal) sequence of consecutive IEs with half octet length, the first IE with half octet length occupies bits 1 to 4 of octet N, the second IE bits 5 to 8 of octet N, the third IE bits 1 to 4 of octet N+1 etc. Such a sequence always has an even number of elements.\nFor each information element the table indicates:\n1.\tThe Information Element Identifier (IEI), in hexadecimal notation, if the IE has format T, TV, TLV or TLV-E. If the IEI has half octet length, it is specified by a notation representing the IEI as a hexadecimal digit followed by a \"-\" (example: B-).\nNOTE:\tThe same IEI can be used for different information element types in different messages of the same protocol.\n2.\tThe name of the information element (which may give an idea of the semantics of the element). The name of the information element followed by \"IE\" or \"information element\" is used in this technical report as reference to the information element within a message.\n3.\tThe name of the type of the information element (which indicates the coding of the value part of the IE), and generally, the referenced clause of clause 9 of the present document describing the value part of the information element.\n4.\tThe presence requirement indication (M, C, or O) for the IE as defined in 3GPP TS 24.007 [12].\n5.\tThe format of the information element (T, V, TV, LV, TLV, LV-E or TLV-E) as defined in 3GPP TS 24.007 [12].\n6.\tThe length of the information element (or permissible range of lengths), in octets, in the message, where \"?\" means that the maximum length of the IE is only constrained by link layer protocol. This indication is non-normative.\nc)\tclauses specifying, where appropriate, conditions for IEs with presence requirement C or O in the relevant message which together with other conditions specified in the present document define when the information elements shall be included or not, what non-presence of such IEs means, and – for IEs with presence requirement C – the static conditions for presence or non-presence of the IEs or for both cases (see 3GPP TS 24.007 [12]).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.2\tEPS mobility management messages",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.2.1\tAttach accept",
                            "text_content": "This message is sent by the network to the UE to indicate that the corresponding attach request has been accepted. See table 8.2.1.1.\nMessage type:\tATTACH ACCEPT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.1.1: ATTACH ACCEPT message content\n\nThis IE may be included to assign a GUTI to the UE during attach or combined EPS/IMSI attach.\nThis IE may be included to assign a new location area identification to a UE during a combined attach.\nThis IE may be included to assign or unassign a new TMSI to a UE during a combined attach.\nThis IE shall be included when IMSI attach for non-EPS services is not successful during a combined EPS/IMSI attach procedure.\nThis IE may be included to indicate a value for timer T3402.\nThis IE may be included to indicate a value for timer T3423.\nIf this IE is not included, the UE shall use the default value.\nThis IE may be included in order to assign an equivalent PLMNs list to a UE.\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received.\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received.\nThe network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, except for the S1-u data transfer (S1-U data) (octet 4, bit 2).\nNOTE:\tIn this exceptional case, the UE deems that the network supports S1-u data transfer.\nThe network may include this IE to provide the UE with additional information about the result of:\n-\ta combined attach procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and \"SMS only\"; or\n-\tan attach procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and \"SMS only\".\nThe network may include this IE to provide the UE with longer periodic tracking area update timer.\nThe network shall include the T3324 value IE if:\n-\tthe UE included the T3324 value IE in the ATTACH REQUEST message; and\n-\tthe network supports PSM and accepts the use of PSM.\nThe network shall include the Extended DRX parameters IE if:\n-\tthe UE included the Extended DRX parameters IE in the ATTACH REQUEST message; and\n-\tthe network supports eDRX and accepts the use of eDRX.\nThis IE is included in the message when the network wishes to provide a DCN-ID to the UE.\nThis IE may be included when a normal attach procedure for EPS services and \"SMS only\" was successful for EPS services only.\nThis IE is included if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP TS 24.302 [48]). If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.\nThe network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.\nThis IE is included to indicate network policy information to the UE.\nThe network may include T3447 value IE if:\n-\tthe UE has indicated support for service gap control in the ATTACH REQUEST message; and\n-\tthe EMM context contains a service gap time value.\nThis IE is included if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data.\nThis IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to assign a network-assigned UE radio capability ID to the UE.\nThis IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN.\nThe network shall include the Negotiated WUS assistance information IE if:\n-\tthe UE supports WUS assistance;\n-\tthe MME supports and accepts the use of WUS assistance; and\n-\tthe UE is not attaching for emergency bearer services.\nThe network shall include the Negotiated DRX parameter in NB-S1 mode IE if the UE has included the DRX parameter in NB-S1 mode IE in the ATTACH REQUEST message.\nThe network shall include the Negotiated IMSI offset IE if the network supports paging timing collision control and the MUSIM UE has included the Requested IMSI offset IE in the ATTACH REQUEST message.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite E-UTRAN access.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.1.1: ATTACH ACCEPT message content",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.2\tAttach complete",
                            "text_content": "This message is sent by the UE to the network in response to an ATTACH ACCEPT message. See table 8.2.2.1.\nMessage type:\tATTACH COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.2.1: ATTACH COMPLETE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.2.1: ATTACH COMPLETE message content",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.3\tAttach reject",
                            "text_content": "This message is sent by the network to the UE to indicate that the corresponding attach request has been rejected. See table 8.2.3.1.\nMessage type:\tATTACH REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.3.1: ATTACH REJECT message content\n\nThis IE is included to carry a single ESM message.\nThe MME may include this IE when the NAS level mobility management congestion control is active.\nThis IE may be included to indicate a value for timer T3402.\nThis IE may be included by the network to indicate additional information associated with the EMM cause.\nThe MME may include this IE when the EMM cause is set to #78 \"PLMN not allowed to operate at the present UE location\", to provide a minimum timer value for an entry added to the list of \"PLMNs not allowed to operate at the present UE location\".\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite E-UTRAN access.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.3.1: ATTACH REJECT message content",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.4\tAttach request",
                            "text_content": "This message is sent by the UE to the network in order to perform an attach procedure. See table 8.2.4.1.\nMessage type:\tATTACH REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.4.1: ATTACH REQUEST message content\n\nThe UE shall include this IE if the UE holds a valid P-TMSI signature, P-TMSI and RAI, and the TIN either indicates \"P-TMSI\" or is deleted. If the UE is configured for \"AttachWithIMSI\" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, the UE shall not include this IE.\nThe UE shall include this IE if the TIN indicates \"P-TMSI\" and the UE holds a valid GUTI, P-TMSI and RAI. If the UE is configured for \"AttachWithIMSI\" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, the UE shall not include this IE.\nThis IE shall be included if the UE holds a valid last visited registered TAI.\nThis IE is included if UE supports A/Gb mode or Iu mode or if the UE wants to indicate its UE specific DRX parameters to the network.\nA UE supporting A/Gb mode or Iu mode shall include this IE to indicate its capabilities to the network.\nThe UE shall include this IE during a combined attach procedure if it has a valid location area identification.\nThe UE shall include this IE during combined attach procedure if it has no valid TMSI available.\nThis IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN (see 3GPP TS 23.216 [8]), or if the UE is performing a combined attach procedure.\nThis IE shall be included if the UE supports SRVCC to GERAN.\nThis IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN to indicate its supported speech codecs for CS speech calls.\nThe UE shall include this IE if the UE requests \"SMS only\" or CIoT EPS optimizations.\nThis IE shall be included in WB-S1 mode if and only if the UE supports:\n-\tCS fallback and SMS over SGs; or\n-\tif the UE is configured to support IMS voice, but does not support 1xCS fallback.\nThis IE shall be included if the UE is configured for NAS signalling low priority.\nThe UE shall include this IE if the type of identity in the EPS mobile identity IE is set to \"GUTI\".\nThis IE shall be included if the UE supports extended periodic timer T3412.\nThe UE shall include this IE during a combined attach procedure if it has a valid TMSI.\nThe UE may include this IE to request the use of PSM.\nThe UE may include this IE to request a particular T3412 value if the T3324 value IE is included.\nThe UE may include this IE to request the use of eDRX.\nThe UE shall include this IE if the UE supports dual connectivity with NR or if the UE supports N1 mode.\nThis IE shall be included if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS.\nThe UE shall include this IE if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys for ciphered broadcast assistance data.\nThe UE shall include this IE if the UE supports N1 mode and needs to indicate the supported CIoT network behaviour for 5GCN.\nThe UE shall include this IE in WB-S1 mode if the UE supports RACS and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN.\nThe UE may include this IE if it supports WUS assistance and it is not attaching for emergency bearer services.\nThis IE is included if the UE intends to use the UE specific DRX parameter in NB-S1 mode.\nThe MUSIM UE may include this IE if the UE needs to indicate an IMSI offset value to the network as specified in 3GPP TS 23.401 [10] that is used for deriving the paging occasion as specified in 3GPP TS 36.304 [21].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.4.1: ATTACH REQUEST message content",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.5\tAuthentication failure",
                            "text_content": "This message is sent by the UE to the network to indicate that authentication of the network has failed. See table 8.2.5.1.\nMessage type:\tAUTHENTICATION FAILURE\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.5.1: AUTHENTICATION FAILURE message content\n\nThis IE shall be sent if and only if the EMM cause was #21 \"synch failure\". It shall include the response to the authentication challenge from the USIM, which is made up of the AUTS parameter (see 3GPP TS 33.102 [18]).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.5.1: AUTHENTICATION FAILURE message content",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.6\tAuthentication reject",
                            "text_content": "This message is sent by the network to the UE to indicate that the authentication procedure has failed and that the UE shall abort all activities. See table 8.2.6.1.\nMessage type:\tAUTHENTICATION REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.6.1: AUTHENTICATION REJECT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.6.1: AUTHENTICATION REJECT message content",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.7\tAuthentication request",
                            "text_content": "This message is sent by the network to the UE to initiate authentication of the UE identity. See table 8.2.7.1.\nMessage type:\tAUTHENTICATION REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.7.1: AUTHENTICATION REQUEST message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.7.1: AUTHENTICATION REQUEST message content",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.8\tAuthentication response",
                            "text_content": "This message is sent by the UE to the network to deliver a calculated authentication response to the network. See table 8.2.8.1.\nMessage type:\tAUTHENTICATION RESPONSE\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.8.1: AUTHENTICATION RESPONSE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.8.1: AUTHENTICATION RESPONSE message content",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.9\tCS service notification",
                            "text_content": "This message is sent by the network when a paging request with CS call indicator was received via SGs for a UE, and a NAS signalling connection is already established for the UE. See table 8.2.9.1.\nMessage type:\tCS SERVICE NOTIFICATION\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.9.1: CS SERVICE NOTIFICATION message content\n\nThe network shall send this IE if it was received via SGs. It contains the identification of the calling line for the mobile terminating call in the CS domain, which triggered the paging via SGs.\nThe network shall send this IE if it was received via SGs. It contains information on the supplementary service transaction in the CS domain, which triggered the paging via SGs.\nThe network shall send this IE if it was received via SGs. It indicates that the paging was triggered by a terminating LCS request in the CS domain.\nThe network shall send this IE if received via SGs. It contains information related to the requestor of the terminating LCS request in the CS domain.\nVoid.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.9.1: CS SERVICE NOTIFICATION message content",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.10\tDetach accept",
                            "text_content": "This message is sent by the network to indicate that the detach procedure has been completed. See table 8.2.10.1.1.\nMessage type:\tDETACH ACCEPT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.10.1.1: DETACH ACCEPT message content\n\nThis message is sent by the UE to indicate that the detach procedure has been completed. See table 8.2.10.2.1.\nMessage type:\tDETACH ACCEPT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.10.2.1: DETACH ACCEPT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.10.1.1: DETACH ACCEPT message content",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.2.10.2.1: DETACH ACCEPT message content",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.11\tDetach request",
                            "text_content": "This message is sent by the UE to request the release of an EMM context. See table 8.2.11.1.1.\nMessage type:\tDETACH REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.11.1.1: DETACH REQUEST message content\n\nThis message is sent by the network to request the release of an EMM context. See table 8.2.11.2.1.\nMessage type:\tDETACH REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.11.2.1: DETACH REQUEST message content\n\nThis information element is included if an EMM cause is provided.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThe MME may include this IE when the EMM cause is set to #78 \"PLMN not allowed to operate at the present UE location\", to provide a minimum timer value for an entry added to the list of \"PLMNs not allowed to operate at the present UE location\".\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.11.1.1: DETACH REQUEST message content",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.2.11.2.1: DETACH REQUEST message content",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.12\tDownlink NAS Transport",
                            "text_content": "This message is sent by the network to the UE in order to carry an SMS message in encapsulated format. See table 8.2.12.1.\nMessage type:\tDOWNLINK NAS TRANSPORT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.12.1: DOWNLINK NAS TRANSPORT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.12.1: DOWNLINK NAS TRANSPORT message content",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.13\tEMM information",
                            "text_content": "This message is sent by the network at any time during EMM context is established to send certain information to the UE. See table 8.2.13.1.\nMessage type:\tEMM INFORMATION\nSignificance:\tlocal\nDirection:\tnetwork to UE\nTable 8.2.13.1: EMM INFORMATION message content\n\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicate the \"full length name of the network\" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification.\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicate the \"abbreviated name of the network\" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification.\nThis IE may be sent by the network. The UE should assume that this time zone applies to the tracking area of the current cell, and also applies to the tracking area list if available in the UE.\nNOTE:\tThe time information can be inaccurate, especially when the TAI list includes tracking areas belonging to different time zones.\nIf the local time zone has been adjusted for daylight saving time, the network shall indicate this by including the Network daylight saving time IE.\nThis IE may be sent by the network. The UE should assume that this time zone applies to the tracking area the UE is currently in, and also applies to the tracking area list if available in the UE. The UE shall not assume that the time information is accurate.\nNOTE:\tThe time information can be inaccurate, especially when the TAI list includes tracking areas belonging to different time zones.\nIf the local time zone has been adjusted for daylight saving time, the network shall indicate this by including the Network daylight saving time IE.\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicates the value that has been used to adjust the local time zone.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.13.1: EMM INFORMATION message content",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.14\tEMM status",
                            "text_content": "This message is sent by the UE or by the network at any time to report certain error conditions listed in clause 7. See table 8.2.14.1.\nMessage type:\tEMM STATUS\nSignificance:\tlocal\nDirection:\tboth\nTable 8.2.14.1: EMM STATUS message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.14.1: EMM STATUS message content",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.15\tExtended service request",
                            "text_content": "This message is sent by the UE to the network\n-\tto initiate a CS fallback or 1xCS fallback call or respond to a mobile terminated CS fallback or 1xCS fallback request from the network; or\n-\tto request the establishment of a NAS signalling connection and of the radio and S1 bearers for packet services, if the UE needs to provide additional information that cannot be provided via a SERVICE REQUEST message.\nSee table 8.2.15.1.\nMessage type:\tEXTENDED SERVICE REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.15.1: EXTENDED SERVICE REQUEST message content\n\nThe UE shall include this IE only if the Service type information element indicates \"mobile terminating CS fallback or 1xCS fallback\".\nNOTE:\tThe UE does not include this IE for mobile terminating 1xCS fallback.\nThis IE shall be included if the UE wants to indicate the EPS bearer contexts that are active within the UE.\nThe UE shall include this IE if the UE is configured for NAS signalling low priority.\nThe UE shall include this IE if the MUSIM UE requests the release of the NAS signalling connection or rejects the paging request from the network.\nThe UE shall include this IE if the Request type is set to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE and the UE requests the network to restrict paging.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.15.1: EXTENDED SERVICE REQUEST message content",
                                    "table number": 28,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.16\tGUTI reallocation command",
                            "text_content": "This message is sent by the network to the UE to reallocate a GUTI and optionally to provide a new TAI list or a new DCN-ID or both. See table 8.2.16.1.\nMessage type:\tGUTI REALLOCATION COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.16.1: GUTI REALLOCATION COMMAND message content\n\nThis IE may be included to assign a TAI list to the UE.\nThis IE may be included to assign a new DCN-ID to the UE.\nThis IE may be included in WB-S1 mode if both the UE and the network support RACS and the network needs to assign a network-assigned UE radio capability ID to the UE.\nThis IE may be included in WB-S1 mode if both the UE and the network support RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.16.1: GUTI REALLOCATION COMMAND message content",
                                    "table number": 29,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.17\tGUTI reallocation complete",
                            "text_content": "This message is sent by the UE to the network to indicate that reallocation of a GUTI has taken place. See table 8.2.17.1.\nMessage type:\tGUTI REALLOCATION COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.17.1: GUTI REALLOCATION COMPLETE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.17.1: GUTI REALLOCATION COMPLETE message content",
                                    "table number": 30,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.18\tIdentity request",
                            "text_content": "This message is sent by the network to the UE to request the UE to provide the specified identity. See table 8.2.18.1.\nMessage type:\tIDENTITY REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.18.1: IDENTITY REQUEST message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.18.1: IDENTITY REQUEST message content",
                                    "table number": 31,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.19\tIdentity response",
                            "text_content": "This message is sent by the UE to the network in response to an IDENTITY REQUEST message and provides the requested identity. See table 8.2.19.1.\nMessage type:\tIDENTITY RESPONSE\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.19.1: IDENTITY RESPONSE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.19.1: IDENTITY RESPONSE message content",
                                    "table number": 32,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.20\tSecurity mode command",
                            "text_content": "This message is sent by the network to the UE to establish NAS signalling security. See table 8.2.20.1.\nMessage type:\tSECURITY MODE COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.20.1: SECURITY MODE COMMAND message content\n\nThe MME may include this information element to request the UE to send its IMEISV with the corresponding SECURITY MODE COMPLETE message.\nThe MME may include this information element to indicate to the UE to use the replayed nonceUE.\nThe MME may include this information element to indicate to the UE to use the nonceMME.\nThe MME shall include this information element when the MME is initiating a SECURITY MODE COMMAND during an attach or tracking area updating procedure and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message was received without integrity protection or did not successfully pass the integrity check at the MME.\nThe MME shall include this IE if the MME supports handling of UE additional security capabilities, the MME is initiating a SECURITY MODE COMMAND during an attach or tracking area updating procedure and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message included a UE additional security capability IE.\nThe MME may include this information element in WB-S1 mode to request the UE to send its UE radio capability ID with the corresponding SECURITY MODE COMPLETE message.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.20.1: SECURITY MODE COMMAND message content",
                                    "table number": 33,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.21\tSecurity mode complete",
                            "text_content": "This message is sent by the UE to the network in response to a SECURITY MODE COMMAND message. See table 8.2.21.1.\nMessage type:\tSECURITY MODE COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.21.1: SECURITY MODE COMPLETE message content\n\nThe UE shall include this information element, if the IMEISV was requested within the corresponding SECURITY MODE COMMAND message.\nThe UE shall include this information element, if during an ongoing attach or tracking area updating procedure, the MME included HASHMME in the SECURITY MODE COMMAND message and HASHMME has a different value from the hash value locally calculated at the UE as described in 3GPP TS 33.401 [19].\nThe UE shall include this information element in WB-S1 mode if the UE radio capability ID was requested within the corresponding SECURITY MODE COMMAND message.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.21.1: SECURITY MODE COMPLETE message content",
                                    "table number": 34,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.22\tSecurity mode reject",
                            "text_content": "This message is sent by the UE to the network to indicate that the corresponding security mode command has been rejected. See table 8.2.22.1.\nMessage type:\tSECURITY MODE REJECT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.22.1: SECURITY MODE REJECT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.22.1: SECURITY MODE REJECT message content",
                                    "table number": 35,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.23\tSecurity protected NAS message",
                            "text_content": "This message is sent by the UE or the network to transfer a NAS message together with the sequence number and the message authentication code protecting the message. See table 8.2.23.1.\nMessage type:\tSECURITY PROTECTED NAS MESSAGE\nSignificance:\tdual\nDirection:\tboth\nTable 8.2.23.1: SECURITY PROTECTED NAS MESSAGE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.23.1: SECURITY PROTECTED NAS MESSAGE message content",
                                    "table number": 36,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.24\tService reject",
                            "text_content": "This message is sent by the network to the UE in order to reject the service request procedure. See table 8.2.24.1.\nMessage type:\tSERVICE REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.24.1: SERVICE REJECT message content\n\nThe MME shall include this IE when the EMM cause value is #39 \"CS service temporarily not available\".\nThe MME may include this IE when the general NAS level mobility management congestion control is active.\nThe network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThe MME may include this IE when the EMM cause is set to #78 \"PLMN not allowed to operate at the present UE location\", to provide a minimum timer value for an entry added to the list of \"PLMNs not allowed to operate at the present UE location\".\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.24.1: SERVICE REJECT message content",
                                    "table number": 37,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.25\tService request",
                            "text_content": "This message is sent by the UE to the network to request the establishment of a NAS signalling connection and of the radio and S1 bearers. Its structure does not follow the structure of a standard layer 3 message. See table 8.2.25.1.\nMessage type:\tSERVICE REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.25.1: SERVICE REQUEST message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.25.1: SERVICE REQUEST message content",
                                    "table number": 38,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.26\tTracking area update accept",
                            "text_content": "This message is sent by the network to the UE to provide the UE with EPS mobility management related data in response to a tracking area update request message. See table 8.2.26.1.\nMessage type:\tTRACKING AREA UPDATE ACCEPT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.26.1: TRACKING AREA UPDATE ACCEPT message content\n\nThe MME shall include this IE during normal and combined tracking area updating procedure, and may include this IE during periodic tracking area updating procedure.\nThe MME shall include this IE if it includes the T3412 extended value IE.\nThis IE may be included to assign a GUTI to a UE.\nThis IE may be included to assign a TAI list to a UE.\nThis IE shall be included if the network wants to indicate the EPS bearer contexts that are active for the UE in the network.\nThis IE may be included to assign a new location area identification to a UE during a combined TA/LA update.\nThis IE may be included to assign or unassign a new TMSI to a UE during a combined TA/LA update.\nThis IE shall be included if the combined tracking area updating procedure was successful for EPS services only.\nThis IE may be included to indicate a value for timer T3402.\nThis IE may be included to indicate a value for timer T3423.\nIf this IE is not included, the UE shall use the default value.\nThis IE may be included in order to assign an equivalent PLMNs list to a UE.\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received.\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received.\nThe network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, except for the S1-u data transfer (S1-U data) (octet 4, bit 2).\nNOTE: In this exceptional case, the UE deems that the network supports S1-u data transfer.\nThe network may include this IE to provide the UE with additional information about the result of:\n-\ta combined tracking area updating procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and \"SMS only\"; or\n-\ta normal tracking area updating procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and \"SMS only\".\nThe network may include this IE to provide the UE with a longer periodic tracking area update timer.\nThe network shall include the T3324 value IE if:\n-\tthe UE included the T3324 value IE in the TRACKING AREA UPDATE REQUEST message; and\n-\tthe network supports PSM and accepts the use of PSM.\nThe network shall include the Extended DRX parameters IE if:\n-\tthe UE included the Extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message; and\n-\tthe network supports eDRX and accepts the use of eDRX.\nThis IE is included in the message when the network wishes to provide a DCN-ID to the UE.\nThis IE may be included when a normal tracking area updating procedure for EPS services and \"SMS only\" was successful for EPS services only.\nThis IE is included if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP TS 24.302 [48]). If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.\nThe network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.\nThis IE is included to indicate network policy information to the UE.\nThe network may include T3447 value IE if:\n-\tthe UE has indicated support for service gap control in the TRACKING AREA UPDATE REQUEST messages; and\n-\tthe EMM context contains a service gap time value.\nThis IE is included if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data.\nThis IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to assign a network-assigned UE radio capability ID to the UE.\nThis IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN.\nThe network shall include the Negotiated WUS assistance information IE if:\n-\tthe UE supports WUS assistance;\n-\tthe MME supports and accepts the use of WUS assistance; and\n-\tthe UE is not attaching for emergency bearer services.\nThe network shall include the Negotiated DRX parameter in NB-S1 mode IE if the UE has included the DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE REQUEST message.\nThe network shall include the Negotiated IMSI offset IE if the network supports paging timing collision control and the MUSIM UE has included the Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message.\nThe network may include this IE to inform the UE about the result of additional request.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThis IE may be included to provide the UE with a maximum wating time offset after return from discontinuous coverage.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.26.1: TRACKING AREA UPDATE ACCEPT message content",
                                    "table number": 39,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.27\tTracking area update complete",
                            "text_content": "This message shall be sent by the UE to the network in response to a tracking area update accept message if a GUTI has been changed or a new TMSI has been assigned. See table 8.2.27.1.\nMessage type:\tTRACKING AREA UPDATE COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.27.1: TRACKING AREA UPDATE COMPLETE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.27.1: TRACKING AREA UPDATE COMPLETE message content",
                                    "table number": 40,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.28\tTracking area update reject",
                            "text_content": "This message is sent by the network to the UE in order to reject the tracking area updating procedure. See table 8.2.28.1.\nMessage type:\tTRACKING AREA UPDATE REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.28.1: TRACKING AREA UPDATE REJECT message content\n\nThe MME may include this IE when the general NAS level mobility management congestion control is active.\nThis IE may be included by the network to indicate additional information associated with the EMM cause.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThe MME may include this IE when the EMM cause is set to #78 \"PLMN not allowed to operate at the present UE location\", to provide a minimum timer value for an entry added to the list of \"PLMNs not allowed to operate at the present UE location\".\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.28.1: TRACKING AREA UPDATE REJECT message content",
                                    "table number": 41,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.29\tTracking area update request",
                            "text_content": "The purposes of sending the tracking area update request by the UE to the network are described in clause 5.5.3.1. See table 8.2.29.1.\nMessage type:\tTRACKING AREA UPDATE REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.29.1: TRACKING AREA UPDATE REQUEST message content\n\nThe UE shall include this IE if the UE has a valid non-current native EPS security context when the UE performs an A/Gb mode or Iu mode or N1 mode to S1 mode inter-system change in EMM-CONNECTED mode and the UE uses a mapped EPS security context to protect the TRACKING AREA UPDATE REQUEST message.\nThe UE shall include this IE if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change in EMM-IDLE mode and the TIN indicates \"P-TMSI\".\nThe UE shall include this IE if the TIN indicates \"P-TMSI\" and the UE holds a valid P-TMSI signature, P-TMSI and RAI.\nThe UE shall include this IE:\na)\tif the TIN indicates \"P-TMSI\" and the UE holds a valid GUTI, P-TMSI and RAI; or\nb)\tif the UE performs an N1 mode to S1 mode inter-system change and the UE holds a valid GUTI.\nThis IE is included if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change in idle mode and the TIN is set to \"P-TMSI\".\nThe UE shall include this IE, unless the UE performs a periodic tracking area updating procedure.\nThis IE shall be included if the UE holds a valid last visited registered TAI.\nThis IE is included by the UE to indicate a change of UE specific DRX parameters to the network.\nThe UE shall include this IE if the UE radio capability information in the network needs to be updated.\nThis IE shall be included if the UE wants to indicate the EPS bearer contexts that are active within the UE.\nA UE supporting A/Gb mode or Iu mode shall include this IE, unless the UE performs a periodic tracking area updating procedure.\nThe UE shall include this IE during a combined tracking area updating procedure if it has a valid location area identification.\nThe UE shall include this IE during a combined tracking area updating procedure if it has no valid TMSI available.\nThis IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN (see 3GPP TS 23.216 [8]), or if the UE is performing a combined tracking area updating procedure.\nThis IE shall be included if the UE supports SRVCC to GERAN.\nThis IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN to indicate its supported speech codecs for CS speech calls.\nThe UE shall include this IE if the UE requests \"SMS only\" or CIoT EPS optimizations, unless the UE performs a periodic tracking area updating procedure.\nThis IE shall be included in WB-S1 mode if and only if the UE supports:\n-\tCS fallback and SMS over SGs; or\n-\tif the UE is configured to support IMS voice, but does not support 1xCS fallback.\nThe UE shall include this IE.\nThis IE shall be included if the UE is configured for NAS signalling low priority.\nThis IE shall be included if the UE supports extended periodic timer T3412.\nThe UE shall include this IE if it has a valid TMSI.\nThe UE may include this IE to request the use of PSM.\nThe UE may include this IE to request a particular T3412 value if the T3324 value IE is included.\nThe UE may include this IE to request the use of eDRX.\nThe UE shall include this IE if the UE supports dual connectivity with NR or if the UE supports N1 mode.\nThis IE shall be included if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS.\nThe UE shall include this IE if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys for ciphered broadcast assistance data.\nThe UE shall include this IE if the UE supports N1 mode and needs to indicate the supported CIoT network behaviour for 5GCN, unless the UE performs a periodic tracking area updating procedure.\nThe UE may include this IE in WB-S1 mode if the UE supports RACS and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN.\nThis IE is included if the UE intends to use or change the UE specific DRX parameter in NB-S1 mode, except when the UE performs a periodic tracking area updating procedure.\nThe UE may include this IE if it supports WUS assistance and it is not attaching for emergency bearer services.\nThe MUSIM UE may include this IE if the UE needs to indicate an IMSI offset value to the network as specified in 3GPP TS 23.401 [10] that is used for deriving the paging occasion as specified in 3GPP TS 36.304 [21].\nThe UE shall include this IE if the MUSIM UE requests the release of the NAS signalling connection.\nThe UE shall include this IE if the Request type is set to \"NAS signalling connection release\" in the UE request type IE and the UE requests the network to restrict paging.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.29.1: TRACKING AREA UPDATE REQUEST message content",
                                    "table number": 42,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.30\tUplink NAS Transport",
                            "text_content": "This message is sent by the UE to the network in order to carry an SMS message in encapsulated format. See table 8.2.30.1.\nMessage type:\tUPLINK NAS TRANSPORT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.30.1: UPLINK NAS TRANSPORT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.30.1: UPLINK NAS TRANSPORT message content",
                                    "table number": 43,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.31\tDownlink generic NAS transport",
                            "text_content": "This message is sent by the network to the UE in order to carry an application message in encapsulated format. See table 8.2.31.1.\nMessage type:\tDOWNLINK GENERIC NAS TRANSPORT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.31.1: DOWNLINK GENERIC NAS TRANSPORT message content\n\nThe MME may include this information element if the application wants to send any additional information.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.31.1: DOWNLINK GENERIC NAS TRANSPORT message content",
                                    "table number": 44,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.32\tUplink generic NAS transport",
                            "text_content": "This message is sent by the UE to the network in order to carry an application protocol message in encapsulated format. See table 8.2.32.1.\nMessage type:\tUPLINK GENERIC NAS TRANSPORT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.32.1: UPLINK GENERIC NAS TRANSPORT message content\n\nThe UE may include this information element if the application wants to send any additional information.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.32.1: UPLINK GENERIC NAS TRANSPORT message content",
                                    "table number": 45,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.33\tCONTROL PLANE SERVICE REQUEST",
                            "text_content": "This message is sent by the UE to the network when the UE is using EPS services with control plane CIoT EPS optimization. See table 8.2.33.1.\nMessage type:\tCONTROL PLANE SERVICE REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.33.1: CONTROL PLANE SERVICE REQUEST message content\n\nThe UE shall include this IE, if it wants to send an ESM message to the network.\nThe UE shall include this IE, if it is in EMM-IDLE mode and has pending SMS messages to be sent.\nThe UE shall include this IE, if it wants to indicate the EPS bearer contexts that are active within the UE.\nThe UE shall include this IE if the UE is configured for NAS signalling low priority.\nThe UE shall include this IE if the MUSIM UE requests the release of the NAS signalling connection or rejects the paging request from the network.\nThe UE shall include this IE if the Request type is set to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE and the UE requests the network to restrict paging.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.33.1: CONTROL PLANE SERVICE REQUEST message content",
                                    "table number": 46,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.34\tService Accept",
                            "text_content": "This message is sent by the network in response to the SERVICE REQUEST message, the EXTENDED SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message. See table 8.2.34.1.\nMessage type:\tSERVICE ACCEPT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.2.34.1: SERVICE ACCEPT message content\n\nThis IE shall be included if the network wants to indicate the EPS bearer contexts that are active for the UE in the network.\nThe network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.\nThe network may include this IE to inform the UE about the result of additional request.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite E-UTRAN access.\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite E-UTRAN access.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.34.1: SERVICE ACCEPT message content",
                                    "table number": 47,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "8.3\tEPS session management messages",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.3.1\tActivate dedicated EPS bearer context accept",
                            "text_content": "This message is sent by the UE to the network to acknowledge activation of a dedicated EPS bearer context associated with the same PDN address(es) and APN as an already active EPS bearer context. See table 8.3.1.1.\nMessage type:\tACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.1.1: ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message content\n\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.1.1: ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message content",
                                    "table number": 48,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.2\tActivate dedicated EPS bearer context reject",
                            "text_content": "This message is sent by UE to the network to reject activation of a dedicated EPS bearer context. See table 8.3.2.1.\nMessage type:\tACTIVATE DEDICATED EPS BEARER CONTEXT REJECT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.2.1: ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message content\n\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.2.1: ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message content",
                                    "table number": 49,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.3\tActivate dedicated EPS bearer context request",
                            "text_content": "This message is sent by the network to the UE to request activation of a dedicated EPS bearer context associated with the same PDN address(es) and APN as an already active default EPS bearer context. See table 8.3.3.1.\nMessage type:\tACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.3.1: ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message content\n\nIf the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include this IE\nIf the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.\nIf the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.\nIf the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.\nIf the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in clause 9.9.4.18.\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE shall be included in the message only if the network wishes to transmit the maximum and guaranteed bit rate values to the UE and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in clause 9.9.4.3.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.3.1: ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message content",
                                    "table number": 50,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.4\tActivate default EPS bearer context accept",
                            "text_content": "This message is sent by the UE to the network to acknowledge activation of a default EPS bearer context. See table 8.3.4.1.\nMessage type:\tACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.4.1: ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message content\n\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.4.1: ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message content",
                                    "table number": 51,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.5\tActivate default EPS bearer context reject",
                            "text_content": "This message is sent by UE to the network to reject activation of a default EPS bearer context. See table 8.3.5.1.\nMessage type:\tACTIVATE DEFAULT EPS BEARER CONTEXT REJECT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.5.1: ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message content\n\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.5.1: ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message content",
                                    "table number": 52,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.6\tActivate default EPS bearer context request",
                            "text_content": "This message is sent by the network to the UE to request activation of a default EPS bearer context. See table 8.3.6.1.\nMessage type:\tACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.6.1: ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message content\n\nIf the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include this IE.\nIf the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.\nIf the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.\nIf the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.\nIf the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.\nThis IE is included in the message when the network wishes to transmit the APN-AMBR to the UE for possible uplink policy enforcement.\nThe network shall include this IE, if the network allocated a PDN address of a PDN type which is different from the PDN type requested by the UE.\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE shall be included if the network supports Local IP address in the traffic flow aggregate description and TFT filter, the PDN Type is different from Non-IP and Ethernet, and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThe network shall include the Connectivity type IE if:\n-\tthe network is configured to indicate when a PDN connection is a LIPA PDN connection; and\n-\tthe present PDN connection is a LIPA PDN connection.\nThis IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in clause 9.9.4.18.\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThe network may include the Header compression configuration IE if:\n-\tthe network accepts an IP PDN type; and\n-\tcontrol plane CIoT EPS optimization is selected.\nThe network shall include the Control plane only indication IE if the associated PDN connection is only for control plane CIoT EPS optimization.\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE shall be included if the network supports Local IP address in the traffic flow aggregate description and TFT filter, the PDN Type is different from Non-IP and Ethernet, and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE shall be included when the network wishes to indicate the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval.\nThis IE shall be included in the message only if the network wishes to transmit the APN-AMBR values to the UE for possible uplink policy enforcement and at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in clause 9.9.4.2.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.6.1: ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message content",
                                    "table number": 53,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.7\tBearer resource allocation reject",
                            "text_content": "This message is sent by the network to the UE to reject the allocation of a dedicated bearer resource. See table 8.3.7.1.\nMessage type:\tBEARER RESOURCE ALLOCATION REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.7.1: BEARER RESOURCE ALLOCATION REJECT message content\n\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThe network may include this IE if the ESM cause is not #65 \"maximum number of EPS bearers reached\", to request a minimum time interval before procedure retry is allowed.\nThe network may include this IE only if it includes the Back-off timer value IE and the ESM cause value is not #26 \"insufficient resources\".\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.7.1: BEARER RESOURCE ALLOCATION REJECT message content",
                                    "table number": 54,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.8\tBearer resource allocation request",
                            "text_content": "This message is sent by the UE to the network to request the allocation of a dedicated bearer resource. See table 8.3.8.1.\nMessage type:\tBEARER RESOURCE ALLOCATION REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.8.1: BEARER RESOURCE ALLOCATION REQUEST message content\n\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThe UE shall include this IE if the UE is configured for NAS signalling low priority.\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE shall be included in the message only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in clause 9.9.4.3.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.8.1: BEARER RESOURCE ALLOCATION REQUEST message content",
                                    "table number": 55,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.9\tBearer resource modification reject",
                            "text_content": "This message is sent by the network to the UE to reject the modification of a dedicated bearer resource. See table 8.3.9.1.\nMessage type:\tBEARER RESOURCE MODIFICATION REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.9.1: BEARER RESOURCE MODIFICATION REJECT message content\n\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThe network may include this IE to request a minimum time interval before procedure retry is allowed.\nThe network may include this IE only if it includes the Back-off timer value IE and the ESM cause value is not #26 \"insufficient resources\".\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.9.1: BEARER RESOURCE MODIFICATION REJECT message content",
                                    "table number": 56,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.10\tBearer resource modification request",
                            "text_content": "This message is sent by the UE to the network to request the modification of a dedicated bearer resource, or to request re-negotiation of header compression configuration associated to an EPS bearer context if the network has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. See table 8.3.10.1.\nMessage type:\tBEARER RESOURCE MODIFICATION REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.10.1: BEARER RESOURCE MODIFICATION REQUEST message content\n\nThis IE is included in the message when the UE requests a change of QoS for the indicated traffic flows and does not request to release all bearer resources for the EPS bearer context.\nThis IE is included in the message when the UE requests the release of a dedicated bearer resource.\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThe UE shall include this IE if the UE is configured for NAS signalling low priority.\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message if:\na)\tthe UE wishes to re-negotiate header compression configuration associated to an EPS bearer context and both the UE and the network supports Control plane CIoT EPS optimization and header compression; or\nb)\tto negotiate header compression configuration associated to an EPS bearer context after an inter-system change from N1 mode to S1 mode when both the UE and the network support control plane CIoT EPS optimization and header compression, and the UE is operating in single-registration mode and has received the interworking without N26 interface indicator set to \"interworking without N26 interface not supported\" from the network.\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE shall be included in the message only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in clause 9.9.4.3.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.10.1: BEARER RESOURCE MODIFICATION REQUEST message content",
                                    "table number": 57,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.11\tDeactivate EPS bearer context accept",
                            "text_content": "This message is sent by the UE to acknowledge deactivation of the EPS bearer context requested in the corresponding Deactivate EPS bearer context request message. See table 8.3.11.1.\nMessage type:\tDEACTIVATE EPS BEARER CONTEXT ACCEPT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.11.1: DEACTIVATE EPS BEARER CONTEXT ACCEPT message content\n\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.11.1: DEACTIVATE EPS BEARER CONTEXT ACCEPT message content",
                                    "table number": 58,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.12\tDeactivate EPS bearer context request",
                            "text_content": "This message is sent by the network to request deactivation of an active EPS bearer context. See table 8.3.12.1.\nMessage type:\tDEACTIVATE EPS BEARER CONTEXT REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.12.1: DEACTIVATE EPS BEARER CONTEXT REQUEST message content\n\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThe network may include this IE if the ESM cause is #26 \"insufficient resources\".\nThis IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in clause 9.9.4.18. If the MME wishes to deactivate all EPS bearer contexts of a PDN connection, MME shall not include this IE.\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.12.1: DEACTIVATE EPS BEARER CONTEXT REQUEST message content",
                                    "table number": 59,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.12A\tESM dummy message",
                            "text_content": "This message is sent by the UE or the network included in an ESM message container information element during an attach procedure, if the UE does not request for PDN connection. See table 8.3.12A.1.\nMessage type:\tESM DUMMY MESSAGE\nSignificance:\tdual\nDirection:\tboth\nTable 8.3.12A.1: ESM DUMMY MESSAGE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.12A.1: ESM DUMMY MESSAGE message content",
                                    "table number": 60,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.13\tESM information request",
                            "text_content": "This message is sent by the network to the UE to request the UE to provide ESM information, i.e. protocol configuration options or APN or both. See table 8.3.13.1.\nMessage type:\tESM INFORMATION REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.13.1: ESM INFORMATION REQUEST message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.13.1: ESM INFORMATION REQUEST message content",
                                    "table number": 61,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.14\tESM information response",
                            "text_content": "This message is sent by the UE to the network in response to an ESM INFORMATION REQUEST message and provides the requested ESM information. See table 8.3.14.1.\nMessage type:\tESM INFORMATION RESPONSE\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.14.1: ESM INFORMATION RESPONSE message content\n\nThis IE is included in the message when the UE wishes to request network connectivity as defined by a certain access point name during the attach procedure.\nThis IE shall be included in the message when, during the attach procedure, the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and:\na)\tthe UE is in WB-S1 mode;\nb)\tthe requested PDN Type is different from non-IP and Ethernet; and\nc)\tthe requested APN is not for UAS services.\nThis IE shall be included if:\na)\tthe UE supports local IP address in traffic flow aggregate description and TFT filter;\nb)\tthe UE is in WB-S1 mode;\nc)\tthe requested PDN Type is different from non-IP and Ethernet; and\nd)\tthe requested APN is not for UAS services.\nThis IE shall not be included if the Extended protocol configuration options IE is included in the message.\nThis IE shall be included in the message when, during the attach procedure, the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and:\na)\tthe UE is in NB-S1 mode;\nb)\tthe requested PDN Type is non-IP or Ethernet; or\nc)\tthe requested APN is for UAS services.\nThis IE shall be included if:\na)\tthe UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in NB-S1 mode and the requested PDN Type is different from non-IP and Ethernet; or\nb)\tthe UE supports local IP address in traffic flow aggregate description and TFT filter, the requested PDN Type is different from non-IP and Ethernet, and the requested APN is for UAS services.\nThis IE shall not be included if the Protocol configuration options IE is included in the message.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.14.1: ESM INFORMATION RESPONSE message content",
                                    "table number": 62,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.15\tESM status",
                            "text_content": "This message is sent by the network or the UE to pass information on the status of the indicated EPS bearer context and report certain error conditions (e.g. as listed in clause 7). See table 8.3.15.1.\nMessage type:\tESM STATUS\nSignificance:\tdual\nDirection:\tboth\nTable 8.3.15.1: ESM STATUS message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.15.1: ESM STATUS message content",
                                    "table number": 63,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.16\tModify EPS bearer context accept",
                            "text_content": "This message is sent by the UE to the network to acknowledge the modification of an active EPS bearer context. See table 8.3.16.1.\nMessage type:\tMODIFY EPS BEARER CONTEXT ACCEPT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.16.1: MODIFY EPS BEARER CONTEXT ACCEPT message content\n\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.16.1: MODIFY EPS BEARER CONTEXT ACCEPT message content",
                                    "table number": 64,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.17\tModify EPS bearer context reject",
                            "text_content": "This message is sent by the UE or the network to reject a modification of an active EPS bearer context. See table 8.3.17.1.\nMessage type:\tMODIFY EPS BEARER CONTEXT REJECT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.17.1: MODIFY EPS BEARER CONTEXT REJECT message content\n\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.17.1: MODIFY EPS BEARER CONTEXT REJECT message content",
                                    "table number": 65,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.18\tModify EPS bearer context request",
                            "text_content": "This message is sent by the network to the UE to request modification of an active EPS bearer context, or to request re-negotiation of header compression configuration associated to an EPS bearer context if the UE has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. See table 8.3.18.1.\nMessage type:\tMODIFY EPS BEARER CONTEXT REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.18.1: MODIFY EPS BEARER CONTEXT REQUEST message content\n\nWhen the EPS QoS of the EPS bearer context is modified, the network shall include the modified EPS QoS assigned to the EPS bearer context.\nThis IE provides the UE with packet filters.\nIf the UE supports A/Gb mode or Iu mode or both and when the corresponding R99 QoS of the EPS bearer context is modified, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.\nIf the UE supports A/Gb mode and when the negotiated LLC SAPI is modified, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.\nIf the UE supports A/Gb mode and when the radio priority is modified, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.\nIf the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.\nThis IE is included when the APN-AMBR has been changed by the network.\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in clause 9.9.4.18.\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThis IE is included in the message if the network wishes to re-negotiate header compression configuration associated to an EPS bearer context and both the UE and the network support Control plane CIoT EPS optimization and header compression.\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE shall be included in the message only if at least one of the APN-AMBR values has been changed by the network and at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in clause 9.9.4.2.\nThis IE shall be included in the message only if the network wishes to transmit the maximum and guaranteed bit rate values to the UE and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in clause 9.9.4.3.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.18.1: MODIFY EPS BEARER CONTEXT REQUEST message content",
                                    "table number": 66,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.18A\tNotification",
                            "text_content": "This message is sent by the network to inform the UE about events which are relevant for the upper layer using an EPS bearer context or having requested a procedure transaction. See table 8.3.18A.1.\nMessage type:\tNOTIFICATION\nSignificance:\tlocal\nDirection:\tnetwork to UE\nTable 8.3.18A.1: NOTIFICATION message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.18A.1: NOTIFICATION message content",
                                    "table number": 67,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.19\tPDN connectivity reject",
                            "text_content": "This message is sent by the network to the UE to reject establishment of a PDN connection. See table 8.3.19.1.\nMessage type:\tPDN CONNECTIVITY REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.19.1: PDN CONNECTIVITY REJECT message content\n\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThe network may include this IE if the ESM cause is not #28 \"unknown PDN type\", #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #54 \"PDN connection does not exist\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\", #61 \"PDN type Ethernet only allowed\", or #65 \"maximum number of EPS bearers reached\", to request a minimum time interval before procedure retry is allowed.\nThe network may include this IE only if the ESM cause value is #28 \"unknown PDN type\", #50 \"PDN type IPv4 only allowed\", #51 \"PDN type IPv6 only allowed\", #57 \"PDN type IPv4v6 only allowed\", #58 \"PDN type non IP only allowed\", #61 \"PDN type Ethernet only allowed\", or #66 \"requested APN not supported in current RAT and PLMN combination\", or if the network includes the Back-off timer value IE and the ESM cause value is not #26 \"insufficient resources\".\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.19.1: PDN CONNECTIVITY REJECT message content",
                                    "table number": 68,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.20\tPDN connectivity request",
                            "text_content": "This message is sent by the UE to the network to initiate establishment of a PDN connection. See table 8.3.20.1.\nMessage type:\tPDN CONNECTIVITY REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.20.1: PDN CONNECTIVITY REQUEST message content\n\nThe UE shall include this IE in the PDN CONNECTIVITY REQUEST message sent during the attach procedure if the UE has protocol configuration options that need to be transferred security protected or wishes to provide an access point name for the PDN connection to be established during the attach procedure.\nThis IE is included in the message when the UE wishes to request network connectivity as defined by a certain access point name. This IE shall not be included when the PDN CONNECTIVITY REQUEST message is included in an ATTACH REQUEST message or if the request type indicates \"emergency\" or \"handover of emergency bearer services\" or \"RLOS\".\nThis IE shall be included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and:\na)\tthe UE is in WB-S1 mode;\nb)\tthe requested PDN Type is different from non-IP and Ethernet; and\nc)\tthe requested APN is not for UAS services.\nThis IE shall be included if:\na)\tthe UE supports local IP address in traffic flow aggregate description and TFT filter;\nb)\tthe UE is in WB-S1 mode;\nc)\tthe requested PDN Type is different from non-IP and Ethernet; and\nd)\tthe requested APN is not for UAS services.\nThis IE shall not be included if the Extended protocol configuration options IE is included in the message.\nThe UE shall include this IE if the UE is configured for NAS signalling low priority.\nThis information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].\nThe UE shall include the Header compression configuration IE if:\n-\tthe PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6;\n-\tthe UE indicates \"Control Plane CIoT EPS optimization supported\" in the UE network capability IE of the ATTACH REQUEST message; and\n-\tthe UE supports header compression.\nThis IE shall be included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and:\na)\tthe UE is in NB-S1 mode;\nb)\tthe requested PDN Type is non-IP or Ethernet; or\nc)\tthe requested APN is for UAS services.\nThis IE shall be included if:\na)\tthe UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in NB-S1 mode and the requested PDN Type is different from non-IP and Ethernet; or\nb)\tthe UE supports local IP address in traffic flow aggregate description and TFT filter, the requested PDN Type is different from non-IP and Ethernet, and the requested APN is for UAS services.\nThis IE shall not be included if the Protocol configuration options IE is included in the message.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.20.1: PDN CONNECTIVITY REQUEST message content",
                                    "table number": 69,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.21\tPDN disconnect reject",
                            "text_content": "This message is sent by the network to the UE to reject release of a PDN connection. See table 8.3.21.1.\nMessage type:\tPDN DISCONNECT REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.21.1: PDN DISCONNECT REJECT message content\n\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.21.1: PDN DISCONNECT REJECT message content",
                                    "table number": 70,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.22\tPDN disconnect request",
                            "text_content": "This message is sent by the UE to the network to initiate release of a PDN connection. See table 8.3.22.1.\nMessage type:\tPDN DISCONNECT REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.22.1: PDN DISCONNECT REQUEST message content\n\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause 6.6.1.1).\nThis IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause 6.6.1.1).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.22.1: PDN DISCONNECT REQUEST message content",
                                    "table number": 71,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.23\tRemote UE report",
                            "text_content": "This message is sent by the UE to the network to report connection or disconnection of remote UE(s). See table 8.3.23.1.\nMessage type:\tREMOTE UE REPORT\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.3.23.1: REMOTE UE REPORT message content\n\nThis IE is included in the message by the UE acting as ProSe UE-to-network relay to provide the network with newly connected remote UE information as specified in 3GPP TS 23.303 [31].\nThis IE is included in the message by the UE acting as ProSe UE-to-Network Relay to provide the network with disconnected remote UE information as specified in 3GPP TS 23.303 [31].\nThis IE is included in the message by the UE acting as ProSe UE-to-network relay to provide the network with the address of the ProSe Key Management Function associated with the remote UEs connected to or disconnected from the ProSe UE-to-network relay.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.23.1: REMOTE UE REPORT message content",
                                    "table number": 72,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.24\tRemote UE report response",
                            "text_content": "This message is sent by the network to the UE to acknowledge receipt of a Remote UE report message. See table 8.3.24.1.\nMessage type:\tREMOTE UE REPORT RESPONSE\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable 8.3.24.1: REMOTE UE REPORT RESPONSE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.24.1: REMOTE UE REPORT RESPONSE message content",
                                    "table number": 73,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.3.25\tESM DATA TRANSPORT",
                            "text_content": "This message is sent by the UE or the network in order to carry user data in an encapsulated format. See table 8.3.25.1.\nMessage type:\tESM DATA TRANSPORT\nSignificance:\tdual\nDirection:\tboth\nTable 8.3.25.1: ESM DATA TRANSPORT message content\n\nThe UE may include this IE to inform the network whether\n-\tno further uplink and no further downlink data transmission is expected; or\n-\tonly a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.3.25.1: ESM DATA TRANSPORT message content",
                                    "table number": 74,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "9\tGeneral message format and information elements coding",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "9.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "Within the protocols defined in the present document, every message, except the SERVICE REQUEST message, is a standard L3 message as defined in 3GPP TS 24.007 [12]. This means that the message consists of the following parts:\n1)\tif the message is a plain NAS message:\na)\tprotocol discriminator;\nb)\tEPS bearer identity or security header type;\nc)\tprocedure transaction identity;\nd)\tmessage type;\ne)\tother information elements, as required.\n2)\tif the message is a security protected NAS message:\na)\tprotocol discriminator;\nb)\tsecurity header type;\nc)\tmessage authentication code;\nd)\tsequence number;\ne)\tplain NAS message, as defined in item 1.\nThe organization of a plain NAS message is illustrated in the example shown in figure 9.1.1.\n\n\nFigure 9.1.1: General message organization example for a plain NAS message\nThe organization of a security protected NAS message is illustrated in the example shown in figure 9.1.2.\n\nFigure 9.1.2: General message organization example for a security protected NAS message\nThe EPS bearer identity and the procedure transaction identity are only used in messages with protocol discriminator EPS session management. Octet 1a with the procedure transaction identity shall only be included in these messages.\nUnless specified otherwise in the message descriptions of clause 8, a particular information element shall not be present more than once in a given message.\nWhen a field extends over more than one octet, the order of bit values progressively decreases as the octet number increases. The most significant bit of the field is represented by the highest numbered bit of the lowest numbered octet of the field. The least significant bit of the field is represented by the lowest numbered bit of the highest numbered octet of the field.\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 75,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "The organization of a security protected NAS message is illustrated in the example shown in figure 9.1.2.",
                            "table number": 76,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.2\tProtocol discriminator",
                    "description": "",
                    "summary": "",
                    "text_content": "The Protocol Discriminator (PD) and its use are defined in 3GPP TS 24.007 [12]. The protocol discriminator in the header (see 3GPP TS 24.007 [12]) of a security protected NAS message is encoded as \"EPS mobility management messages\".\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.3\tSecurity header type and EPS bearer identity",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.3.1\tSecurity header type",
                            "text_content": "Bits 5 to 8 of the first octet of every EPS Mobility Management (EMM) message contain the Security header type IE. This IE includes control information related to the security protection of a NAS message. The total size of the Security header type IE is 4 bits.\nThe Security header type IE can take the values shown in table 9.3.1.\nTable 9.3.1: Security header type\n\nAn EMM message received with the security header type encoded as 0000 shall be treated as not security protected, plain NAS message. A protocol entity sending a not security protected EMM message shall send the message as plain NAS message and encode the security header type as 0000.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 9.3.1: Security header type",
                                    "table number": 77,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.3.2\tEPS bearer identity",
                            "text_content": "Bits 5 to 8 of the first octet of every EPS Session Management (ESM) message contain the EPS bearer identity. The EPS bearer identity and its use to identify a message flow are defined in 3GPP TS 24.007 [12].\nIf the UE or the MME or both do not support signalling for a maximum number of 15 EPS bearer contexts, the MME shall select the EPS bearer identity from the value range 5 to 15, or select the value 0 when it needs to indicate that no EPS bearer identity is assigned.\nNOTE:\tWhen assigning EPS bearer identities from the range 1 to 4, the MME can take into account that these EPS bearer contexts will be subject to local deactivation if the UE performs inter-system change to A/Gb mode or Iu mode or if it performs a change to an MME not supporting signalling for a maximum number of 15 EPS bearer contexts.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "9.4\tProcedure transaction identity",
                    "description": "",
                    "summary": "",
                    "text_content": "Bits 1 to 8 of the second octet (octet 1a) of every EPS Session Management (ESM) message contain the procedure transaction identity. The procedure transaction identity and its use are defined in 3GPP TS 24.007 [12].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.5\tMessage authentication code",
                    "description": "",
                    "summary": "",
                    "text_content": "The Message authentication code (MAC) information element contains the integrity protection information for the message. The MAC IE shall be included in the security protected NAS message if a valid EPS security context exists and security functions are started. The usage of MAC is specified in clause 4.4.3.3.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.6\tSequence number",
                    "description": "",
                    "summary": "",
                    "text_content": "This IE includes the NAS message sequence number (SN) which consists of the eight least significant bits of the NAS COUNT for a security protected NAS message. The usage of SN is specified in clause 4.4.3.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.7\tNAS message",
                    "description": "",
                    "summary": "",
                    "text_content": "This IE includes a complete plain NAS message as specified in clause 8.2 and 8.3. The SECURITY PROTECTED NAS MESSAGE and the SERVICE REQUEST message are not plain NAS messages and shall not be included in this IE.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.8\tMessage type",
                    "description": "",
                    "summary": "",
                    "text_content": "The message type IE and its use are defined in 3GPP TS 24.007 [12]. Tables 9.8.1 and 9.8.2 define the value part of the message type IE used in the EPS mobility management protocol and EPS session management protocol.\nTable 9.8.1: Message types for EPS mobility management\n\nTable 9.8.2: Message types for EPS session management\n\n",
                    "tables": [
                        {
                            "description": "Table 9.8.1: Message types for EPS mobility management",
                            "table number": 78,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table 9.8.2: Message types for EPS session management",
                            "table number": 79,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.9\tOther information elements",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.9.1\tGeneral",
                            "text_content": "The different formats (V, LV, T, TV, TLV, LV-E, TLV-E) and the five categories of information elements (type 1, 2, 3, 4 and 6) are defined in 3GPP TS 24.007 [12].\nThe first octet of an information element in the non-imperative part contains the IEI of the information element. If this octet does not correspond to an IEI known in the message, the receiver shall determine whether this IE is of type 1 or 2 (i.e. it is an information element of one octet length), an IE of type 4 (i.e. that the next octet is the length indicator indicating the length of the remaining of the information element or an IE of type 6 (i.e. that the next 2 octets are the length indicator indicating the length of the remaining of the information element) (see 3GPP TS 24.007 [12]).\nThis allows the receiver to jump over unknown information elements and to analyse any following information elements.\nThe definitions of information elements which are common for the EMM and ESM protocols or which are used by access stratum protocols are described in clause 9.9.2.\nThe information elements of the EMM or ESM protocols can be defined by reference to an appropriate specification, e.g., \"see clause 10.5.6.3 in 3GPP TS 24.008 [13]\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.9.2\tCommon information elements",
                            "text_content": "The purpose of the Additional information information element is to provide additional information to upper layers in relation to the generic NAS message transport mechanism.\nThe Additional information information element is coded as shown in figure 9.9.2.0.1 and table 9.9.2.0.1.\nThe Additional information is a type 4 information element with a minimum length of 3 octets.\n\n\nFigure 9.9.2.0.1: Additional information information element\nTable 9.9.2.0.1: Additional information information element\n\nSee clause 10.5.7.8 in 3GPP TS 24.008 [13].\nThe purpose of the EPS bearer context status information element is to indicate the state of each EPS bearer context that can be identified by an EPS bearer identity.\nThe EPS bearer context status information element is coded as shown in figure 9.9.2.1.1 and table 9.9.2.1.1.\nThe EPS bearer context status information element is a type 4 information element with 4 octets length.\n\n\nFigure 9.9.2.1.1: EPS bearer context status information element\nTable 9.9.2.1.1: EPS bearer context status information element\n\nSee clause 10.5.1.3 in 3GPP TS 24.008 [13].\nSee clause 10.5.1.4 in 3GPP TS 24.008 [13].\nSee clause 10.5.1.6 in 3GPP TS 24.008 [13].\nSee clause 10.5.1.7 in 3GPP TS 24.008 [13].\nThe purpose of the NAS security parameters from E-UTRA information element is to provide the UE with information that enables the UE to create a mapped UMTS security context.\nThe NAS security parameters from E-UTRA information element is coded as shown in figure 9.9.2.6.1 and table 9.9.2.6.1.\nThe NAS security parameters from E-UTRA is a type 3 information element with a length of 2 octets.\nThe value part of the NAS security parameters from E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP TS 36.331 [22]. For these cases the coding of the information element identifier and length information is defined in 3GPP TS 36.331 [22].\n\n\nFigure 9.9.2.6.1: NAS security parameters from E-UTRA information element\nTable 9.9.2.6.1: NAS security parameters from E-UTRA information element\n\nThe purpose of the NAS security parameters to E-UTRA information element is to provide the UE with parameters that enable the UE to create a mapped EPS security context and take this context into use after inter-system handover to S1 mode.\nThe NAS security parameters to E-UTRA information element is coded as shown in figure 9.9.2.7.1 and table 9.9.2.7.1.\nThe NAS security parameters to E-UTRA is a type 3 information element with a length of 7 octets.\nThe value part of the NAS security parameters to E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP TS 36.331 [22]. For these cases the coding of the information element identifier and length information is defined in 3GPP TS 36.331 [22].\n\n\nFigure 9.9.2.7.1: NAS security parameters to E-UTRA information element\nTable 9.9.2.7.1: NAS security parameters to E-UTRA information element\n\nSee clause 10.5.1.13 in 3GPP TS 24.008 [13].\nThis element is used in the description of EMM and ESM messages when an odd number of half octet type 1 information elements are used. This element is filled with spare bits set to zero and is placed in bits 5 to 8 of the octet unless otherwise specified.\nSee clause 10.5.4.32 in 3GPP TS 24.008 [13].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 80,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.2.0.1: Additional information information element",
                                    "table number": 81,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 82,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.2.1.1: EPS bearer context status information element",
                                    "table number": 83,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 84,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.2.6.1: NAS security parameters from E-UTRA information element",
                                    "table number": 85,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 86,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.2.7.1: NAS security parameters to E-UTRA information element",
                                    "table number": 87,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.9.3\tEPS Mobility Management (EMM) information elements",
                            "text_content": "The purpose of the Additional update result information element is to provide additional information about the result of a combined attach procedure or a combined tracking area updating procedure.\nThe Additional update result information element is coded as shown in figure 9.9.3.0A.1 and table 9.9.3.0A.1.\nThe Additional update result is a type 1 information element.\n\n\nFigure 9.9.3.0A.1: Additional update result information element\nTable 9.9.3.0A.1: Additional update result information element\n\nThe purpose of the Additional update type information element is to provide additional information about the type of request for an attach or a tracking area updating procedure.\nThe Additional update type information element is coded as shown in figure 9.9.3.0B.1 and table 9.9.3.0B.1.\nThe Additional update type is a type 1 information element.\n\n\nFigure 9.9.3.0B.1: Additional update type information element\nTable 9.9.3.0B.1: Additional update type information element\n\nSee clause 10.5.3.2.2 in 3GPP TS 24.008 [13].\nSee clause 10.5.3.1.1 in 3GPP TS 24.008 [13].\nSee clause 10.5.3.1 in 3GPP TS 24.008 [13].\nThe purpose of the Authentication response parameter information element is to provide the network with the authentication response calculated in the USIM.\nThe Authentication response parameter information element is coded as shown in figure 9.9.3.4.1 and table 9.9.3.4.1.\nThe Authentication response parameter is a type 4 information element with a minimum length of 6 octets and a maximum length of 18 octets.\nIn an EPS authentication challenge, the response calculated in the USIM (RES) is minimum 4 octets and may be up to 16 octets in length.\nIn a 5G AKA authentication challenge, the response calculated in the ME (RES*) is 16 octets in length.\n\n\nFigure 9.9.3.4.1: Authentication response parameter information element\nTable 9.9.3.4.1: Authentication response parameter information element\n\nSee clause .2 in 3GPP TS 24.008 [13].\nThe purpose of the SMS services status information element is to indicate the status of availability for SMS services requested by the UE during the normal attach procedure or tracking area updating procedure.\nThe SMS services status information element is coded as shown in figure 9.9.3.4B.1 and table 9.9.3.4B.1.\nThe SMS services status is a type 1 information element.\n\n\nFigure 9.9.3.4B.1: SMS services status information element\nTable 9.9.3.4B.1: SMS services status information element\n\nThe purpose of the CSFB response information element is to indicate whether the UE accepts or rejects a paging for CS fallback.\nThe CSFB response information element is coded as shown in figure 9.9.3.5.1 and table 9.9.3.5.1.\nThe CSFB response is a type 1 information element.\n\n\nFigure 9.9.3.5.1: CSFB response information element\nTable 9.9.3.5.1: CSFB response information element\n\nSee clause 10.5.3.12 in 3GPP TS 24.008 [13].\nThe purpose of the Detach type information element is to indicate the type of detach.\nThe Detach type information element is coded as shown in figure 9.9.3.7.1 and table 9.9.3.7.1.\nThe Detach type is a type 1 information element.\n\n\nFigure 9.9.3.7.1: Detach type information element\nTable 9.9.3.7.1: Detach type information element\n\nSee clause 10.5.5.6 in 3GPP TS 24.008 [13].\nThe purpose of the EMM cause information element is to indicate the reason why an EMM request from the UE is rejected by the network.\nThe EMM cause information element is coded as shown in figure 9.9.3.9.1 and table 9.9.3.9.1.\nThe EMM cause is a type 3 information element with 2 octets length.\n\n\nFigure 9.9.3.9.1: EMM cause information element\nTable 9.9.3.9.1: EMM cause information element\n\nThe purpose of the EPS attach result information element is to specify the result of an attach procedure.\nThe EPS attach result information element is coded as shown in figure 9.9.3.10.1 and table 9.9.3.10.1.\nThe EPS attach result is a type 1 information element.\n\n\nFigure 9.9.3.10.1: EPS attach result information element\nTable 9.9.3.10.1: EPS attach result information element\n\nThe purpose of the EPS attach type information element is to indicate the type of the requested attach.\nThe EPS attach type information element is coded as shown in figure 9.9.3.11.1 and table 9.9.3.11.1.\nThe EPS attach type is a type 1 information element.\n\n\nFigure 9.9.3.11.1: EPS attach type information element\nTable 9.9.3.11.1: EPS attach type information element\n\nThe purpose of the EPS mobile identity information element is to provide either the IMSI, the GUTI or the IMEI.\nThe EPS mobile identity information element is coded as shown in figures 9.9.3.12.1 and 9.9.3.12.2 and table 9.9.3.12.1.\nThe EPS mobile identity is a type 4 information element with a minimum length of 3 octets and a maximum length of 13 octets.\n\n\nFigure 9.9.3.12.1: EPS mobile identity information element for type of identity \"GUTI\"\n\n\nFigure 9.9.3.12.2: EPS mobile identity information element for type of identity \"IMSI\" or \"IMEI\"\nTable 9.9.3.12.1: EPS mobile identity information element\n\nThe purpose of the EPS network feature support information element is to indicate whether certain features are supported by the network.\nThe EPS network feature support information element is coded as shown in figure 9.9.3.12A.1 and table 9.9.3.12A.1.\nThe EPS network feature support is a type 4 information element with a minimum length of 3 octets and a maximum length of 5 octets.\nIf the network does not include octet 4 or octet 5 as defined below in the present version of the protocol, then the UE shall interpret this as a receipt of an information element with all bits of octet 4 and 5 coded as zero.\n\n\nFigure 9.9.3.12A.1: EPS network feature support information element\nTable 9.9.3.12A.1: EPS network feature support information element\n\nThe purpose of the EPS update result information element is to specify the result of the associated updating procedure.\nThe EPS update result information element is coded as shown in figure 9.9.3.13.1 and table 9.9.3.13.1.\nThe EPS update result is a type 1 information element.\n\n\nFigure 9.9.3.13.1: EPS update result information element\nTable 9.9.3.13.1: EPS update result information element\n\nThe purpose of the EPS update type information element is to specify the area the updating procedure is associated with.\nThe EPS update type information element is coded as shown in figure 9.9.3.14.1 and table 9.9.3.14.1.\nThe EPS update type is a type 1 information element.\n\n\nFigure 9.9.3.14.1: EPS update type information element\nTable 9.9.3.14.1: EPS update type information element\n\nThe purpose of the ESM message container information element is to enable piggybacked transfer of a single ESM message within an EMM message. The ESM message included in this IE shall be coded as specified in clause 8.3, i.e. without NAS security header.\nThe ESM message container information element is coded as shown in figure 9.9.3.15.1 and table 9.9.3.15.1.\nThe ESM message container is a type 6 information element.\n\n\nFigure 9.9.3.15.1: ESM message container information element\nTable 9.9.3.15.1: ESM message container information element\n\nSee clause 10.5.7.3 in 3GPP TS 24.008 [13].\nSee clause 10.5.7.4 in 3GPP TS 24.008 [13].\nSee clause 10.5.7.4a in 3GPP TS 24.008 [13].\nSee clause 10.5.5.9 in 3GPP TS 24.008 [13].\nSee clause 10.5.5.10 in 3GPP TS 24.008 [13].\nThe purpose of the KSI and sequence number information element is to provide the network with the key set identifier (KSI) value of the current EPS security context and the 5 least significant bits of the NAS COUNT value applicable for the message including this information element.\nThe KSI and sequence number information element is coded as shown in figure 9.9.3.19.1 and table 9.9.3.19.1.\nThe KSI and sequence number is a type 3 information element with a length of 2 octets.\n\n\nFigure 9.9.3.19.1: KSI and sequence number information element\nTable 9.9.3.19.1: KSI and sequence number information element\n\nSee clause 10.5.5.12 in 3GPP TS 24.008 [13].\nSee clause 10.5.1.15 in 3GPP TS 24.008 [13].\nThe NAS key set identifier is allocated by the network.\nThe NAS key set identifier information element is coded as shown in figure 9.9.3.21.1 and table 9.9.3.21.1.\nThe NAS key set identifier is a type 1 information element.\n\n\nFigure 9.9.3.21.1: NAS key set identifier information element\nTable 9.9.3.21.1: NAS key set identifier information element\n\nThis information element is used to encapsulate the SMS messages transferred between the UE and the network. The NAS message container information element is coded as shown in figure 9.9.3.22.1 and table 9.9.3.22.1.\nThe NAS message container is a type 4 information element with a minimum length of 4 octets and a maximum length of 253 octets.\n\n\nFigure 9.9.3.22.1: NAS message container information element\nTable 9.9.3.22.1: NAS message container information element\n\nThe purpose of the NAS security algorithms information element is to indicate the algorithms to be used for ciphering and integrity protection.\nThe NAS security algorithms information element is coded as shown in figure 9.9.3.23.1 and table 9.9.3.23.1.\nThe NAS security algorithms is a type 3 information element with a length of 2 octets.\n\n\nFigure 9.9.3.23.1: NAS security algorithms information element\nTable 9.9.3.23.1: NAS security algorithms information element\n\nSee clause 10.5.3.5a in 3GPP TS 24.008 [13].\nSee clause 10.5.5.31 in 3GPP TS 24.008 [13].\nThe purpose of the Nonce information element is to transfer a 32-bit nonce value to support deriving a new mapped EPS security context.\nThe Nonce information element is coded as shown in figure 9.9.3.25.1 and table 9.9.3.25.1.\nThe Nonce is a type 3 information element with a length of 5 octets.\n\n\nFigure 9.9.3.25.1: Nonce information element\nTable 9.9.3.25.1: Nonce information element\n\nThe purpose of the Paging identity information element is to indicate the identity used for paging for non-EPS services.\nThe Paging identity information element is coded as shown in figure 9.9.3.25A.1 and table 9.9.3.25A.1.\nThe Paging identity is a type 3 information element with 2 octets length.\n\n\nFigure 9.9.3.25A.1: Paging identity information element\nTable 9.9.3.25A.1: Paging identity information element\n\nSee clause 10.5.5.8 in 3GPP TS 24.008 [13].\nThe purpose of the extended EMM cause information element is to indicate additional information associated with the EMM cause.\nThe Extended EMM cause information element is coded as shown in figure 9.9.3.26A.1 and table 9.9.3.26A.1.\nThe Extended EMM cause is a type 1 information element.\n\nFigure 9.9.3.26A.1: Extended EMM cause information element\nTable 9.9.3.26A.1: Extended EMM cause information element\n\nThe purpose of the Service type information element is to specify the purpose of the service request procedure.\nThe Service type information element is coded as shown in figure 9.9.3.27.1 and table 9.9.3.27.1.\nThe Service type is a type 1 information element.\n\n\nFigure 9.9.3.27.1: Service type information element\nTable 9.9.3.27.1: Service type information element\n\nThe purpose of the Short MAC information element is to protect the integrity of a SERVICE REQUEST message.\nThe integrity protection shall include octet 1 and 2 of the SERVICE REQUEST message. For the used algorithm and other input parameters to the algorithm see clause 9.5. Only the 2 least significant octets of the resulting message authentication code are included in the information element.\nThe Short MAC information element is coded as shown in figure 9.9.3.28.1 and table 9.9.3.28.1.\nThe Short MAC is a type 3 information element with a length of 3 octets.\n\n\nFigure 9.9.3.28.1: Short MAC information element\nTable 9.9.3.28.1: Short MAC information element\n\nSee clause 10.5.3.8 in 3GPP TS 24.008 [13].\nSee clause 10.5.3.9 in 3GPP TS 24.008 [13].\nSee clause 10.5.5.4 in 3GPP TS 24.008 [13].\nThe purpose of the Tracking area identity information element is to provide an unambiguous identification of tracking areas within the area covered by the 3GPP system.\nThe Tracking area identity information element is coded as shown in figure 9.9.3.32.1 and table 9.9.3.32.1.\nThe Tracking area identity is a type 3 information element with a length of 6 octets.\n\n\nFigure 9.9.3.32.1: Tracking area identity information element\nTable 9.9.3.32.1: Tracking area identity information element\n\nThe purpose of the Tracking area identity list information element is to transfer a list of tracking areas from the network to the UE.\nThe coding of the information element allows combining different types of lists. The lists of type \"00\" and \"01\" allow a more compact encoding, when the different TAIs are sharing the PLMN identity.\nThe Tracking area identity list information element is coded as shown in figure 9.9.3.33.1, figure 9.9.3.33.2, figure 9.9.3.33.3, figure 9.9.3.33.4 and table 9.9.3.33.1.\nThe Tracking area identity list is a type 4 information element, with a minimum length of 8 octets and a maximum length of 98 octets. The list can contain a maximum of 16 different tracking area identities.\n\n\nFigure 9.9.3.33.1: Tracking area identity list information element\n\n\nFigure 9.9.3.33.2: Partial tracking area identity list – type of list = \"00\"\n\n\nFigure 9.9.3.33.3: Partial tracking area identity list – type of list = \"01\"\n\n\nFigure 9.9.3.33.4: Partial tracking area identity list – type of list = \"10\"\nTable 9.9.3.33.1: Tracking area identity list information element\n\nThe purpose of the UE network capability information element is to provide the network with information concerning aspects of the UE related to EPS or interworking with GPRS and 5GS. The contents might affect the manner in which the network handles the operation of the UE. The UE network capability information indicates general UE characteristics and it shall therefore, except for fields explicitly indicated, be independent of the frequency band of the channel it is sent on.\nThe UE network capability information element is coded as shown in figure 9.9.3.34.1 and table 9.9.3.34.1.\nThe UE network capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 15 octets.\nNOTE:\tThe requirements for the support of UMTS security algorithms in the UE are specified in 3GPP TS 33.102 [18], and the requirements for the support of EPS security algorithms in 3GPP TS 33.401 [19].\n\n\nFigure 9.9.3.34.1: UE network capability information element\nTable 9.9.3.34.1: UE network capability information element\n\nThe purpose of the UE radio capability information update needed information element is to indicate whether the MME shall delete the stored UE radio capability information, if any.\nThe UE radio capability information update needed information element is coded as shown in figure 9.9.3.35.1and table 9.9.3.35.1.\nThe UE radio capability information update needed is a type 1 information element.\n\n\nFigure 9.9.3.35.1: UE radio capability information update needed information element\nTable 9.9.3.35.1: UE radio capability information update needed information element\n\nThe UE security capability information element is used by the network to indicate which security algorithms are supported by the UE in S1 mode, Iu mode and Gb mode. Security algorithms supported in S1 mode are supported both for NAS and for AS security. If the UE supports S101 mode, then these security algorithms are also supported for NAS security in S101 mode.\nThe UE security capability information element is coded as shown in figure 9.9.3.36.1 and table 9.9.3.36.1.\nThe UE security capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 7 octets.\nOctets 5, 6, and 7 are optional. If octet 5 is included, then also octet 6 shall be included and octet 7 may be included.\nIf a UE did not indicate support of any security algorithm for Gb mode, octet 7 shall not be included. If the UE did not indicate support of any security algorithm for Iu mode and Gb mode, octets 5, 6, and 7 shall not be included.\nIf the UE did not indicate support of any security algorithm for Iu mode but indicated support of a security algorithm for Gb mode, octets 5, 6, and 7 shall be included. In this case octets 5 and 6 are filled with the value of zeroes.\n\n\nFigure 9.9.3.36.1: UE security capability information element\nTable 9.9.3.36.1: UE security capability information element\n\nSee clause 10.5.3.13 in 3GPP TS 24.008 [13].\nThe purpose of this information element is to encode one or more local emergency number(s) together with a sub-services field containing zero or more sub-services of the associated emergency service URN and a validity indication. An emergency service URN is a service URN with top level service type of \"sos\" as specified in IETF RFC 5031 [55].\nEXAMPLE 1:\tIf the associated emergency service URN is \"urn:service:sos.gas\", there is only one sub-service provided in the sub-services field which is \"gas\".\nEXAMPLE 2:\tIf the associated emergency service URN is \"urn:service:sos\", there is no sub-services provided in the sub-services field and the length of the sub-services field is \"0\".\nNOTE:\tThe associated emergency service URN can be a country-specific emergency service URN as defined in 3GPP TS 24.229 [13D].\nThe Extended emergency number list information element is coded as shown in figure 9.9.3.37A.1 and table 9.9.3.37A.1.\nThe Extended emergency number list IE is a type 6 information element with a minimum length of 7 octets and a maximum length of 65538 octets.\n\nNOTE 1:\tThe length shall contain the number of octets used to encode the number digits.\nNOTE 2:\tThe number digit(s) in octet 6 precedes the digit(s) in octet 7 etc. The number digit, which would be entered first, is located in octet 6, bits 1 to 4. The contents of the number digits are coded as shown in table 10.5.118/3GPP TS 24.008 [13].\nNOTE 3:\tIf the emergency number contains an odd number of digits, bits 5 to 8 of the last octet of the respective emergency number shall be filled with an end mark coded as \"1111\".\nNOTE 4:\tThe length shall contain the number of octets used to encode the sub-services field.\nNOTE 5:\tThe characters of the sub-services of the associated emergency service URN shall be coded in accordance to GSM 7 bit default alphabet and the appropriate padding characters and bit-fill are added to octet boundary as specified in clause 6.1.2.3.1 of 3GPP TS 23.038 [3]and the first character starts in octet j+1, l+1 or n+1.\n\nFigure 9.9.3.37A.1 Extended Emergency Number List IE\nEXAMPLE 3:\tIf the associated emergency service URN is \"urn:service:sos.police.municipal\", the sub-services field contains \"police.municipal\" and the first character is \"p\".\nTable 9.9.3.37A.1: Extended Emergency Number List Validity information IE\n\nThe purpose of the CLI information element is to convey information about the calling line for a terminated call to a CS fallback capable UE.\nThe CLI information element is coded as shown in figure 9.9.3.38.1 and table 9.9.3.38.1.\nThe CLI is a type 4 information element with a minimum length of 3 octets and a maximum length of 14 octets.\n\n\nFigure 9.9.3.38.1: CLI information element\nTable 9.9.3.38.1: CLI information element\n\nThe purpose of the SS code information element is to convey information related to a network initiated supplementary service request to a CS fallback capable UE.\nThe SS Code information element is coded as shown in figure 9.9.3.39.1 and table 9.9.3.39.1.\nThe SS Code is a type 3 information element with 2 octets length.\n\n\nFigure 9.9.3.39.1: SS Code information element\nTable 9.9.3.39.1: SS Code information element\n\nThe purpose of the LCS indicator information element is to indicate that the origin of the message is due to a LCS request and the type of this request to a CS fallback capable UE.\nThe LCS indicator information element is coded as shown in figure 9.9.3.40.1 and table 9.9.3.40.1.\nThe LCS indicator is a type 3 information element with 2 octets length.\n\n\nFigure 9.9.3.40.1: LCS indicator information element\nTable 9.9.3.40.1: LCS indicator information element\n\nThe purpose of the LCS client identity information element is to convey information related to the client of a LCS request for a CS fallback capable UE.\nThe LCS client identity information element is coded as shown in figure 9.9.3.41.1 and table 9.9.3.41.1.\nThe LCI client identity is a type 4 information element with a minimum length of 3 octets and a maximum length of 257 octets.\n\n\nFigure 9.9.3.41.1: LCS client identity information element\nTable 9.9.3.41.1: LCS client identity information element\n\nThe purpose of the generic message container type information element is to specify the type of message contained in the generic message container IE.\nThe generic message container type information element is coded as shown in table 9.9.3.42.1.\nTable 9.9.3.42.1: Generic message container type information element\n\nThis information element is used to encapsulate the application message transferred between the UE and the network. The generic message container information element is coded as shown in figure 9.9.3.43.1 and table 9.9.3.43.1.\nThe generic message container is a type 6 information element.\n\n\nFigure 9.9.3.43.1: Generic message container information element\nTable 9.9.3.43.1: Generic message container information element\n\nSee clause 10.5.5.28 in 3GPP TS 24.008 [13].\nThe purpose of the GUTI type information element is to indicate whether the GUTI included in the same message in an information element of type EPS mobile identity represents a native GUTI or a mapped GUTI.\nThe GUTI type information element information element is coded as shown in figure 9.9.3.45.1 and table 9.9.3.45.1.\nThe GUTI type is a type 1 information element.\n\n\nFigure 9.9.3.45.1: GUTI type information element\nTable 9.9.3.45.1: GUTI type information element\n\nSee clause 10.5.5.32 in 3GPP TS 24.008 [13].\nThe purpose of the Control plane service type information element is to specify the purpose of the CONTROL PLANE SERVICE REQUEST message.\nThe Control plane service type information element is coded as shown in figure 9.9.3.47.1 and table 9.9.3.47.1.\nThe Control plane service type is a type 1 information element.\n\n\nFigure 9.9.3.47.1: Control plane service type information element\nTable 9.9.3.47.1: Control plane service type information element\n\nSee clause 10.5.5.35 in 3GPP TS 24.008 [13].\nSee clause 10.5.5.37 in 3GPP TS 24.008 [13].\nThe purpose of the HashMME information element is to transfer a 64-bit hash value to the UE so the UE can check the MME calculated value against the value locally calculated by the UE to determine whether the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message sent by the UE has been modified.\nThe HashMME information element is coded as shown in figure 9.9.3.50.1 and table 9.9.3.50.1.\nThe HashMME is a type 4 information element with a length of 10 octets.\n\nFigure 9.9.3.50.1: HashMME information element\nTable 9.9.3.50.1: HashMME information element\n\nThe purpose of the Replayed NAS message container IE is to, during an ongoing attach or tracking area updating procedure, re-send the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message with which the UE had initiated the procedure, if the MME has included a HASHMME in the SECURITY MODE COMMAND message and the HASHMME is different from the hash value locally calculated at the UE as described in 3GPP TS 33.401 [19]. If an ATTACH REQUEST message is included in this IE, the ATTACH REQUEST message shall be coded as specified in clause 8.2.4, i.e. without NAS security header. If a TRACKING AREA UPDATE REQUEST message is included in this IE, the TRACKING AREA UPDATE REQUEST message shall be coded as specified in clause 8.2.29, i.e. without NAS security header\nThe Replayed NAS message container information element is coded as shown in figure 9.9.3.51.1 and table 9.9.3.51.1.\nThe Replayed NAS message container is a type 6 information element.\n\n\nFigure 9.9.3.51.1: Replayed NAS message container information element\nTable 9.9.3.51.1: Replayed NAS message container information element\n\nThe purpose of the Network policy information element is to provide network policy information to the UE during attach or tracking area updating procedure via the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message.\nThe Network policy information element is coded as shown in figure 9.9.3.52.1 and table 9.9.3.52.1.\nThe Network policy is a type 1 information element.\n\nFigure 9.9.3.52.1: Network policy information element\nTable 9.9.3.52.1: Network policy information element\n\nThe UE additional security capability information element is used by the UE to indicate which additional security algorithms are supported by the UE for S1 mode in dual connectivity with NR or for N1 mode or both.\nThe UE additional security capability information element is coded as shown in figure 9.9.3.53.1 and table 9.9.3.53.1.\nThe UE additional security capability is a type 4 information element with a length of 6 octets.\n\n\nFigure 9.9.3.53.1: UE additional security capability information element\nTable 9.9.3.53.1: UE additional security capability information element\n\nSee clause 9.11.3.56 in 3GPP TS 24.501 [54].\nThe purpose of the Additional information requested information element is to enable the UE to request ciphering keys for deciphering of ciphered broadcast assistance data.\nThe Additional information requested information element is coded as shown in figure 9.9.3.55.1 and table 9.9.3.55.1.\nThe Additional information requested is a type 3 information element with a length of 2 octets.\n\n\nFigure 9.9.3.55.1: Additional information requested information element\nTable 9.9.3.55.1: Additional information requested information element\n\nThe purpose of the Ciphering key data information element is to transfer a list of ciphering data sets from the network to the UE for deciphering of ciphered assistance data.\nThe Ciphering key data information element is coded as shown in figure 9.9.3.56.1, figure 9.9.3.56.2 and table 9.9.3.56.1.\nThe Ciphering key data is a type 6 information element, with a minimum length of 35 octets and a maximum length of 2291 octets. The list can contain a maximum of 16 ciphering data sets.\n\n\nFigure 9.9.3.56.1: Ciphering key data information element\n\nFigure 9.9.3.56.2: Ciphering data set\nTable 9.9.3.56.1: Ciphering key data information element\n\nThe purpose of the N1 UE network capability IE is to allow the UE that supports N1 mode, to provide the network with information related to the UE's capabilities for 5GS.\nThe N1 UE network capability information element is coded as shown in figure 9.9.3.57.1 and table 9.9.3.57.1.\nThe N1 UE network capability is a type 4 information element.\nFigure 9.9.3.57.1: N1 UE network capability information element\nTable 9.9.3.57.1: N1 UE network capability information element\n\nThe purpose of the UE radio capability ID availability information element is to indicate that the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN.\nThe UE radio capability ID availability is a type 4 information element with a length of 3 octets.\nThe UE radio capability ID availability information element is coded as shown in figure 9.9.3.58.1 and table 9.9.3.58.1.\nFigure 9.9.3.58.1: UE radio capability ID availability information element\nTable 9.9.3.58.1: UE radio capability ID availability information element\n\nThe purpose of the UE radio capability ID request information element is to indicate that the UE radio capability ID shall be included by the UE in the SECURITY MODE COMPLETE message.\nThe UE radio capability ID request is a type 4 information element with a length of 3 octets.\nThe UE radio capability ID request information element is coded as shown in figure 9.9.3.59.1 and table 9.9.3.59.1.\n\nFigure 9.9.3.59.1: UE radio capability ID request information element\nTable 9.9.3.59.1: UE radio capability ID request information element\n\nSee clause 9.11.3.68 in 3GPP TS 24.501 [54].\nSee clause 9.11.3.69 in 3GPP TS 24.501 [54].\nThe purpose of the WUS assistance information information element is to transfer the required assistance information to determine the WUS group used when paging the UE.\nThe coding of the information element allows combining different types of WUS assistance information.\nThe WUS assistance information information element is coded as shown in figure 9.9.3.62.1, figure 9.9.3.62.2 and table 9.9.3.62.1.\nThe WUS assistance information is a type 4 information element, with a minimum length of 3 octets.\n\n\nFigure 9.9.3.62.1: WUS assistance information information element\n\nFigure 9.9.3.62.2: WUS assistance information type –type of information= \"000\"\n\nTable 9.9.3.62.1: WUS assistance information information element\n\nThe purpose of the NB-S1 DRX parameter information element is to indicate that the UE intends to use the UE specific DRX parameter in NB-S1 mode and for the network to indicate the negotiated UE specific DRX parameter to be used at paging in NB-S1 mode.\nThe NB-S1 DRX parameters information element is coded as shown in figure 9.9.3.63.1 and table 9.9.3.63.1.\nThe NB-S1 DRX parameters is a type 4 information element with a length of 3 octets.\nFigure 9.9.3.63.1: NB-S1 DRX parameter information element\nTable 9.9.3.63.1: NB-S1 DRX parameter information element\n\nThe purpose of the IMSI offset information element is to indicate an IMSI offset value that is used for calculating an alternative IMSI value as specified in 3GPP TS 23.401 [10] that is used for deriving the paging occasion as specified in 3GPP TS 36.304 [21].\nThe IMSI offset information element is coded as shown in figure 9.9.3.64.1 and table 9.9.3.64.1.\nThe IMSI offset is a type 4 information element with a length of 4 octets.\n\nFigure 9.9.3.64.1: IMSI offset information element\nTable 9.9.3.64.1: IMSI offset information element\n\nThe purpose of the UE request type information element is to enable a MUSIM UE to request the network to perform specific requests due to activity on another USIM.\nThe UE request type information element is coded as shown in figure 9.9.3.65.1 and table 9.9.3.65.1.\nThe UE request type is a type 4 information element with a length of 3 octets.\n\n\nFigure 9.9.3.65.1: UE request type information element\nTable 9.9.3.65.1: UE request type information element\n\nThe purpose of the Paging restriction information element is to request the network to restrict paging.\nThe Paging restriction information element is coded as shown in figure 9.9.3.66.1, figure 9.9.3.66.2 and table 9.9.3.66.1.\nThe Paging restriction is a type 4 information element with a minimum length of 3 octets and a maximum length of 5 octets.\nFigure 9.9.3.66.1: Paging restriction information element for Paging restriction type = \"All paging is restricted\" and for Paging restriction type = \"All paging is restricted except voice\"\nFigure 9.9.3.66.2: Paging restriction information element for Paging restriction type = \"All paging is restricted except for specified PDN connection(s)\" and for Paging restriction type = \"All paging is restricted except for voice service and specified PDN connection(s)\"\nTable 9.9.3.66.1: Paging restriction information element\n\nThe purpose of the EPS additional request result information element is to inform the UE about the result of additional request.\nThe EPS additional request result information element is coded as shown in figure 9.9.3.67.1 and table 9.9.3.67.1.\nThe EPS additional request result is a type 4 information element with a length of 3 octets.\n\n\nFigure 9.9.3.67.1: EPS additional request result information element\nTable 9.9.3.67.1: EPS additional request result information element\n\nThe purpose of the Time duration information element is to provide time information in the unit of second.\nThe Time duration information element is coded as shown in figure 9.9.3.68.1 and table 9.9.3.68.1.\nThe Time duration is a type 4 information element with a length of 5 octets.\nFigure 9.9.3.68.1: Time duration information element\nTable 9.9.3.68.1: Time duration information element\n\nThe purpose of the Unavailability information information element is to provide the unavailability type, unavailability period duration and the start of unavailability period from the UE to the network.\nThe Unavailability information information element is coded as shown in figure 9.9.3.69.1 and table 9.9.3.69.1.\nThe Unavailability information is a type 4 information element with a minimum length of 3 octets and maximum length of 9 octets.\nFigure 9.9.3.69.1: Unavailability information information element\nTable 9.9.3.69.1: Unavailability information information element\n\nThe purpose of the Unavailability configuration information element is to provide the unavailability period duration and the end of unavailability report indication from network to the UE.\nThe Unavailability configuration information element is coded as shown in figure 9.9.3.70.1 and table 9.9.3.70.1.\nThe Unavailability configuration is a type 4 information element with a minimum length of 3 octets and maximum length of 6 octets.\nFigure 9.9.3.70.1: Unavailability configuration information element\nTable 9.9.3.70.1: Unavailability configuration information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 88,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.0A.1: Additional update result information element",
                                    "table number": 89,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 90,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.0B.1: Additional update type information element",
                                    "table number": 91,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 92,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.4.1: Authentication response parameter information element",
                                    "table number": 93,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 94,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.4B.1: SMS services status information element",
                                    "table number": 95,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 96,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.5.1: CSFB response information element",
                                    "table number": 97,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 98,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.7.1: Detach type information element",
                                    "table number": 99,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 100,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.9.1: EMM cause information element",
                                    "table number": 101,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 102,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.10.1: EPS attach result information element",
                                    "table number": 103,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 104,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.11.1: EPS attach type information element",
                                    "table number": 105,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 106,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 107,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.12.1: EPS mobile identity information element",
                                    "table number": 108,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 109,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.12A.1: EPS network feature support information element",
                                    "table number": 110,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 111,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.13.1: EPS update result information element",
                                    "table number": 112,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 113,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.14.1: EPS update type information element",
                                    "table number": 114,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 115,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.15.1: ESM message container information element",
                                    "table number": 116,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 117,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.19.1: KSI and sequence number information element",
                                    "table number": 118,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 119,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.21.1: NAS key set identifier information element",
                                    "table number": 120,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 121,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.22.1: NAS message container information element",
                                    "table number": 122,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 123,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.23.1: NAS security algorithms information element",
                                    "table number": 124,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 125,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.25.1: Nonce information element",
                                    "table number": 126,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 127,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.25A.1: Paging identity information element",
                                    "table number": 128,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Extended EMM cause is a type 1 information element.",
                                    "table number": 129,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.26A.1: Extended EMM cause information element",
                                    "table number": 130,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 131,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.27.1: Service type information element",
                                    "table number": 132,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 133,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.28.1: Short MAC information element",
                                    "table number": 134,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 135,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.32.1: Tracking area identity information element",
                                    "table number": 136,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 137,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 138,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 139,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 140,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.33.1: Tracking area identity list information element",
                                    "table number": 141,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 142,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.34.1: UE network capability information element",
                                    "table number": 143,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 144,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.35.1: UE radio capability information update needed information element",
                                    "table number": 145,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 146,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.36.1: UE security capability information element",
                                    "table number": 147,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Extended emergency number list IE is a type 6 information element with a minimum length of 7 octets and a maximum length of 65538 octets.",
                                    "table number": 148,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.37A.1: Extended Emergency Number List Validity information IE",
                                    "table number": 149,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 150,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.38.1: CLI information element",
                                    "table number": 151,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 152,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.39.1: SS Code information element",
                                    "table number": 153,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 154,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.40.1: LCS indicator information element",
                                    "table number": 155,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 156,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.41.1: LCS client identity information element",
                                    "table number": 157,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.42.1: Generic message container type information element",
                                    "table number": 158,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 159,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.43.1: Generic message container information element",
                                    "table number": 160,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 161,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.45.1: GUTI type information element",
                                    "table number": 162,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 163,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.47.1: Control plane service type information element",
                                    "table number": 164,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The HashMME is a type 4 information element with a length of 10 octets.",
                                    "table number": 165,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.50.1: HashMME information element",
                                    "table number": 166,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 167,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.51.1: Replayed NAS message container information element",
                                    "table number": 168,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Network policy is a type 1 information element.",
                                    "table number": 169,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.52.1: Network policy information element",
                                    "table number": 170,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 171,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.53.1: UE additional security capability information element",
                                    "table number": 172,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 173,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.55.1: Additional information requested information element",
                                    "table number": 174,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 175,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Figure 9.9.3.56.1: Ciphering key data information element",
                                    "table number": 176,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.56.1: Ciphering key data information element",
                                    "table number": 177,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The N1 UE network capability is a type 4 information element.",
                                    "table number": 178,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.57.1: N1 UE network capability information element",
                                    "table number": 179,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The UE radio capability ID availability information element is coded as shown in figure 9.9.3.58.1 and table 9.9.3.58.1.",
                                    "table number": 180,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.58.1: UE radio capability ID availability information element",
                                    "table number": 181,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The UE radio capability ID request information element is coded as shown in figure 9.9.3.59.1 and table 9.9.3.59.1.",
                                    "table number": 182,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.59.1: UE radio capability ID request information element",
                                    "table number": 183,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 184,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Figure 9.9.3.62.1: WUS assistance information information element",
                                    "table number": 185,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.62.1: WUS assistance information information element",
                                    "table number": 186,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The NB-S1 DRX parameters is a type 4 information element with a length of 3 octets.",
                                    "table number": 187,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.63.1: NB-S1 DRX parameter information element",
                                    "table number": 188,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The IMSI offset is a type 4 information element with a length of 4 octets.",
                                    "table number": 189,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.64.1: IMSI offset information element",
                                    "table number": 190,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 191,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.65.1: UE request type information element",
                                    "table number": 192,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Paging restriction is a type 4 information element with a minimum length of 3 octets and a maximum length of 5 octets.",
                                    "table number": 193,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Figure 9.9.3.66.1: Paging restriction information element for Paging restriction type = \"All paging is restricted\" and for Paging restriction type = \"All paging is restricted except voice\"",
                                    "table number": 194,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.66.1: Paging restriction information element",
                                    "table number": 195,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 196,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.67.1: EPS additional request result information element",
                                    "table number": 197,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Time duration is a type 4 information element with a length of 5 octets.",
                                    "table number": 198,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.68.1: Time duration information element",
                                    "table number": 199,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Unavailability information is a type 4 information element with a minimum length of 3 octets and maximum length of 9 octets.",
                                    "table number": 200,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.69.1: Unavailability information information element",
                                    "table number": 201,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Unavailability configuration is a type 4 information element with a minimum length of 3 octets and maximum length of 6 octets.",
                                    "table number": 202,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.3.70.1: Unavailability configuration information element",
                                    "table number": 203,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.9.4\tEPS Session Management (ESM) information elements",
                            "text_content": "See clause 10.5.6.1 in 3GPP TS 24.008 [13].\nThe purpose of the APN aggregate maximum bit rate information element is to indicate the initial subscribed APN-AMBR when the UE establishes a PDN connection or to indicate the new APN-AMBR if it is changed by the network.\nThe APN aggregate maximum bit rate information element is coded as shown in figure 9.9.4.2.1 and table 9.9.4.2.1.\nThe APN aggregate maximum bit rate is a type 4 information element with a minimum length of 4 octets and a maximum length of 8 octets. Octets 5-8 are optional. If octet 5 is included, then octet 6 shall also be included, and octets 7-8 may be included. If octet 7 is included, then octet 8 shall also be included. The length of the APN-AMBR IE can be either 4 octets, 6 octets or 8 octets.\n\n\nFigure 9.9.4.2.1: APN aggregate maximum bit rate information element\nTable 9.9.4.2.1: APN aggregate maximum bit rate information element\n\nSee clause 10.5.6.19 in 3GPP TS 24.008 [13].\nThe purpose of the EPS quality of service information element is to specify the QoS parameters for an EPS bearer context.\nThe EPS quality of service information element is coded as shown in figure 9.9.4.3.1 and table 9.9.4.3.1.\nThe EPS quality of service is a type 4 information element with a minimum length of 3 octets and a maximum length of 15 octets. Octets 4-15 are optional. If octet 4 is included, then octets 5-7 shall also be included, and octets 8-15 may be included. If octet 8 is included, then octets 4-11 shall also be included, and octets 12-15 may be included. If octet 12 is included, then octets 4-15 shall also be included. The length of the EPS QoS IE can be either 3 octets, 7 octets, 11 octets or 15 octets.\nRefer to 3GPP TS 23.203 [7] for a detailed description of the QoS Class Identifier (QCI).\n\n\nFigure 9.9.4.3.1: EPS quality of service information element\nTable 9.9.4.3.1: EPS quality of service information element\n\nThe purpose of the ESM cause information element is to indicate the reason why a session management request is rejected.\nThe ESM cause information element is coded as shown in figure 9.9.4.4.1 and table 9.9.4.4.1.\nThe ESM cause is a type 3 information element with 2 octets length.\n\n\nFigure 9.9.4.4.1: ESM cause information element\nTable 9.9.4.4.1: ESM cause information element\n\nThe purpose of the ESM information transfer flag information element is to indicate whether ESM information, i.e. protocol configuration options or APN or both, is to be transferred security protected.\nThe ESM information transfer flag information element is coded as shown in figure 9.9.4.5.1 and table 9.9.4.5.1.\nThe ESM information transfer flag is a type 1 information element.\n\n\nFigure 9.9.4.5.1: ESM information transfer flag information element\nTable 9.9.4.5.1: ESM information transfer flag information element\n\nThe purpose of the Linked EPS bearer identity IE is to identify the default bearer that is associated with a dedicated EPS bearer or to identify the EPS bearer (default or dedicated) with which one or more packet filters specified in a traffic flow aggregate are associated.\nThe Linked EPS bearer identity information element is coded as shown in figure 9.9.4.6.1 and table 9.9.4.6.1.\nThe Linked EPS bearer identity is a type 1 information element.\n\n\nFigure 9.9.4.6.1: Linked EPS bearer identity information element\nTable 9.9.4.6.1: Linked EPS bearer identity information element\n\nSee clause 10.5.6.9 in 3GPP TS 24.008 [13].\nThe purpose of the Notification indicator information element is to inform the UE about an event which is relevant for the upper layer using an EPS bearer context or having requested a procedure transaction.\nThe Notification indicator information element is coded as shown in figure 9.9.4.7A.1 and table 9.9.4.7A.1.\nThe Notification indicator is a type 4 information element with 3 octets length.\n\n\nFigure 9.9.4.7A.1: Notification indicator information element\nTable 9.9.4.7A.1: Notification indicator information element\n\nSee clause 10.5.6.11 in 3GPP TS 24.008 [13].\nThe PDN address information element can assign an IPv4 address to the UE associated with a packet data network and provide the UE with an interface identifier to be used to build the IPv6 link local address.\nThe PDN address information element is coded as shown in figure 9.9.4.9.1 and table 9.9.4.9.1.\nThe PDN address is a type 4 information element with minimum length of 7 octets and a maximum length of 15 octets.\n\n\nFigure 9.9.4.9.1: PDN address information element\nTable 9.9.4.9.1: PDN address information element\n\nThe purpose of the PDN type information element is to indicate:\n-\tthe IP version capability of the IP stack associated with the UE;\n-\tnon IP; or\n-\tEthernet.\nThe PDN type information element is coded as shown in figure 9.9.4.10.1 and table 9.9.4.10.1.\nThe PDN type is a type 1 information element.\n\n\nFigure 9.9.4.10.1: PDN type information element\nTable 9.9.4.10.1: PDN type information element\n\nSee clause 10.5.6.3 in 3GPP TS 24.008 [13].\nSee clause 10.5.6.5 in 3GPP TS 24.008 [13].\nSee clause 10.5.7.2 in 3GPP TS 24.008 [13].\nThe purpose of the Re-attempt indicator information element is to indicate a condition under which the UE is allowed, in the current PLMN for the same APN, to re-attempt a session management procedure (see 3GPP TS 24.008 [13]) corresponding to the EPS session management procedure which was rejected by the network.\nThe Re-attempt indicator information element is coded as shown in figure 9.9.4.13A/3GPP TS 24.301 and table 9.9.4.13A/3GPP TS 24.301.\nThe Re-attempt indicator is a type 4 information element with a length of 3 octets.\n\nFigure 9.9.4.13A: Re-attempt indicator information element\nTable 9.9.4.13A: Re-attempt indicator information element\n\n\nSee clause 10.5.6.17 in 3GPP TS 24.008 [13].\nThe purpose of the Traffic flow aggregate description information element is to specify the aggregate of one of more packet filters and their related parameters and operations. The traffic flow aggregate description may contain the aggregate of packet filters for the downlink direction, the uplink direction or packet filters that apply for both directions. The packet filters determine the traffic mapping to EPS bearer contexts. The downlink packet filters shall be applied by the network, and the uplink packet filters shall be applied by the UE. A packet filter that applies for both directions shall be applied by the network as a downlink packet filter and by the UE as an uplink packet filter.\nWhen the traffic flow aggregate description is used in the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure, it is associated to a particular procedure identified by a procedure transaction identity (PTI). Therefore, the UE shall release the traffic flow aggregate description when the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure is completed. The UE shall not include the packet filters of a particular traffic flow aggregate description in any other traffic flow aggregate description when multiple UE requested bearer resource allocation procedures and/or UE requested bearer resource modification procedures are ongoing in parallel.\nThe Traffic flow aggregate description information element is encoded using the same format as the Traffic flow template (TFT) information element (see clause 10.5.6.12 in 3GPP TS 24.008 [13]). When sending this IE in the BEARER RESOURCE ALLOCATION REQUEST message or the BEARER RESOURCE MODIFICATION REQUEST message, the UE shall set the packet filter identifier values to 0 when the UE requests to \"Create a new TFT\" or \"Add packet filters to existing TFT\" ; otherwise, the UE shall set the packet filter identifier values from those of already assigned packet filter identifiers of the existing EPS bearer, so that they are unique across all packet filters for the EPS bearer context indicated by the EPS bearer identity IE.\nSee clause 10.5.6.12 in 3GPP TS 24.008 [13].\nThe purpose of the Transaction identifier information element is to represent the corresponding PDP context in A/Gb mode or Iu mode which is mapped from the EPS bearer context.\nThe Transaction identifier information element is coded as the Linked TI information element in 3GPP TS 24.008 [13], clause 10.5.6.7.\nSee clause 10.5.6.20 in 3GPP TS 24.008 [13].\nSee clause 10.5.6.21 in 3GPP TS 24.008 [4].\nThe purpose of the Remote UE context list information element is to provide identity and optionally IP address of a remote UE connected to, or disconnected from, a UE acting as a ProSe UE-to-network relay.\nThe Remote UE context list information element is coded as shown in figure 9.9.4.20.1 and table 9.9.4.20.1.\nThe Remote UE context list is a type 6 information element with a minimum length of 5 octets and a maximum length of 65538 octets.\n\nFigure 9.9.4.20.1: Remote UE context list\nTable 9.9.4.20.1: Remote UE context list\n\n\nFigure 9.9.4.20.2: Remote UE context\nTable 9.9.4.20.2: Remote UE context list information element\n\nThe purpose of the PKMF address information element is to provide IP address of a ProSe Key Management Function associated with remote UEs connected to or disconnected from a UE acting as a ProSe UE-to-network relay.\nThe PKMF address information element is coded as shown in figure 9.9.4.21.1 and table 9.9.4.21.1.\nThe PKMF address is a type 4 information element with a minimum length of 3 octets and a maximum length of 19 octets.\n\n\nFigure 9.9.4.21.1: PKMF Address\nTable 9.9.4.21.1: PKMF Address information element\n\nIf Address type indicates IPv4, the Address information in octet 4 to octet 7 contains the IPv4 address. Bit 8 of octet 4 represents the most significant bit of the IP address and bit 1 of octet 7 the least significant bit.\nIf Address type indicates IPv6, the Address information in octet 4 to octet 19 contains the IPv6 address. Bit 8 of octet 4 represents the most significant bit of the IP address and bit 1 of octet 19 the least significant bit.\nThe purpose of the Header compression configuration information element is to negotiate ROHC channel setup parameters specified in IETF RFC 5795 [37] and, optionally, provide additional header compression context setup parameters.\nThe Header compression configuration information element is coded as shown in figure 9.9.4.22.1 and table 9.9.4.22.1.\nThe Header compression configuration is a type 4 information element with a minimum length of 5 octets and a maximum length of 257 octets.\nThe optional Additional header compression parameters container field conveys the additional header compression context setup parameters as specified in 3GPP TS 23.401 [10] in a generic container. This field corresponds to the profile-specific information in the header of the ROHC IR packet type in IETF RFC 5795 [37].\n\n\nFigure 9.9.4.22.1: Header compression configuration information element\n\nTable 9.9.4.22.1: Header compression configuration information element\n\nThe purpose of the Control plane only indication information element is to indicate that a PDN connection is only for control plane CIoT EPS optimization, e.g. the PDN connection is with an SCEF (see 3GPP TS 23.401 [10]).\nThe Control plane only indication information element is coded as shown in figure 9.9.4.23.1.\nThe Control plane only indication is a type 1 information element.\n\n\nFigure 9.9.4.23.1: Control plane only indication information element\nTable 9.9.4.23.1: Control plane only indication information element\n\nThis information element is used to encapsulate the user data transferred between the UE and the MME. The User data container information element is coded as shown in figure 9.9.4.24.1 and table 9.9.4.24.1.\nThe User data container is a type 6 information element.\n\nFigure 9.9.4.24.1: User data container information element\nTable 9.9.4.24.1: User data container information element\n\nThe purpose of the Release assistance indication IE is to inform the network whether\n-\tno further uplink and no further downlink data transmission is expected; or\n-\tonly a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.\nThe Release assistance indication information element is coded as shown in figure 9.9.4.25.1 and table 9.9.4.25.1.\nThe Release assistance indication is a type 1 information element.\n\n\nFigure 9.9.4.25.1: Release assistance indication information element\nTable 9.9.4.25.1: Release assistance indication information element\n\nSee clause 10.5.6.3A in 3GPP TS 24.008 [13].\nThe purpose of the Header compression configuration status information element is to indicate the status of the Header compression configuration for each EPS bearer using Control plane CIoT EPS optimisation that can be identified by an EPS bearer identity.\nThe Header compression configuration status information element is a type 4 information element with 4 the length of 4 octets.\n\n\nFigure 9.9.4.27.1: Header compression configuration status information element\nTable 9.9.4.27.1: Header compression configuration status information element\n\nThe purpose of the Serving PLMN rate control information element is to indicate the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send via a PDN connection per 6 minute interval (see 3GPP TS 23.401 [10]).\nThe Serving PLMN rate control information element is coded as shown in figure 9.9.4.28.1.\nThe Serving PLMN rate control is a type 4 information element with 4 octets length.\n\n\nFigure 9.9.4.28.1: Serving PLMN rate control information element\nServing PLMN rate control value (octet 3 to octet 4) is a binary encoded integer indicating the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval. The Serving PLMN rate control value is an integer equal to or higher than 10. The Serving PLMN rate control value FFFFH indicates that the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval is not restricted.\nThe purpose of the extended APN aggregate maximum bit rate information element is to indicate the initial subscribed APN-AMBR with a value higher than 65280 Mbps when the UE establishes a PDN connection or to indicate the new APN-AMBR with a value higher than 65280 Mbps if it is changed by the network.\nThe receiving entity shall ignore the bit rate values which are included in the extended APN aggregate maximum bit rate information element and not higher than 65280 Mbps.\nThe extended APN aggregate maximum bit rate information element is coded as shown in figure 9.9.4.29.1 and table 9.9.4.29.1.\nThe extended APN aggregate maximum bit rate is a type 4 information element with a length of 8 octets.\n\nFigure 9.9.4.29.1: Extended APN aggregate maximum bit rate information element\nTable 9.9.4.29.1: Extended APN aggregate maximum bit rate information element\n\nThe purpose of the Extended quality of service information element is to indicate for an EPS bearer context the maximum bit rates for uplink and downlink and the guaranteed bit rates for uplink and downlink, if at least one of the bit rates has a value higher than 10 Gbps.\nThe Extended quality of service information element is coded as shown in figure 9.9.4.30.1 and table 9.9.4.30.1. For uplink and downlink, if the sending entity only has to indicate one bit rate (i.e. with a value higher than 10 Gbps), it shall encode the other bit rate (i.e., with a value smaller or equal to 10 Gbps) as \"00000000\". The receiving entity shall ignore a bit rate which is included in the extended quality of service information element and has a value smaller or equal to 10 Gbps.\nThe Extended quality of service is a type 4 information element with a length of 12 octets.\nFigure 9.9.4.30.1: Extended quality of service information element\nTable 9.9.4.30.1: Extended quality of service information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 204,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.2.1: APN aggregate maximum bit rate information element",
                                    "table number": 205,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 206,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.3.1: EPS quality of service information element",
                                    "table number": 207,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 208,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.4.1: ESM cause information element",
                                    "table number": 209,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 210,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.5.1: ESM information transfer flag information element",
                                    "table number": 211,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 212,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.6.1: Linked EPS bearer identity information element",
                                    "table number": 213,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 214,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.7A.1: Notification indicator information element",
                                    "table number": 215,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 216,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.9.1: PDN address information element",
                                    "table number": 217,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 218,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.10.1: PDN type information element",
                                    "table number": 219,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Re-attempt indicator is a type 4 information element with a length of 3 octets.",
                                    "table number": 220,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 221,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Remote UE context list is a type 6 information element with a minimum length of 5 octets and a maximum length of 65538 octets.",
                                    "table number": 222,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.20.1: Remote UE context list",
                                    "table number": 223,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 224,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.20.2: Remote UE context list information element",
                                    "table number": 225,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 226,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.21.1: PKMF Address information element",
                                    "table number": 227,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 228,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.22.1: Header compression configuration information element",
                                    "table number": 229,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 230,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.23.1: Control plane only indication information element",
                                    "table number": 231,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The User data container is a type 6 information element.",
                                    "table number": 232,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.24.1: User data container information element",
                                    "table number": 233,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 234,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.25.1: Release assistance indication information element",
                                    "table number": 235,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 236,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.27.1: Header compression configuration status information element",
                                    "table number": 237,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 238,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The extended APN aggregate maximum bit rate is a type 4 information element with a length of 8 octets.",
                                    "table number": 239,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.29.1: Extended APN aggregate maximum bit rate information element",
                                    "table number": 240,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The Extended quality of service is a type 4 information element with a length of 12 octets.",
                                    "table number": 241,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.9.4.30.1: Extended quality of service information element",
                                    "table number": 242,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "10\tList of system parameters",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "10.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The description of timers in the following tables should be considered a brief summary.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.2\tTimers of EPS mobility management",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 10.2.1: EPS mobility management timers – UE side\n\nTable 10.2.2: EPS mobility management timers – network side\n\n",
                    "tables": [
                        {
                            "description": "Table 10.2.1: EPS mobility management timers – UE side",
                            "table number": 243,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table 10.2.2: EPS mobility management timers – network side",
                            "table number": 244,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.3\tTimers of EPS session management",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 10.3.1: EPS session management timers – UE side\n\nNOTE 1:\tThe back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.\nNOTE 2:\tReference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation.\n\nTable 10.3.2: EPS session management timers – network side\n\n",
                    "tables": [
                        {
                            "description": "Table 10.3.1: EPS session management timers – UE side",
                            "table number": 245,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table 10.3.2: EPS session management timers – network side",
                            "table number": 246,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.1\tCauses related to UE identification",
            "description": "Cause #2 – IMSI unknown in HSS\nThis EMM cause is sent to the UE if the UE is not known (registered) in the HSS or if the UE has packet only subscription. This EMM cause does not affect operation of the EPS service, although it may be used by an EMM procedure.\nCause #3 – Illegal UE\nThis EMM cause is sent to the UE when the network refuses service to the UE either because an identity of the UE is not acceptable to the network or because the UE does not pass the authentication check, i.e. the RES received from the UE is different from that generated by the network.\nCause #6 – Illegal ME\nThis EMM cause is sent to the UE if the ME used is not acceptable to the network, e.g. on the prohibited list.\nCause #9 – UE identity cannot be derived by the network.\nThis EMM cause is sent to the UE when the network cannot derive the UE's identity from the GUTI/S-TMSI/P-TMSI and RAI e.g. no matching identity/context in the network or failure to validate the UE's identity due to integrity check failure of the received message.\nCause #10 – Implicitly detached\nThis EMM cause is sent to the UE either if the network has implicitly detached the UE, e.g. after the implicit detach timer has expired, or if the EMM context data related to the subscription does not exist in the MME e.g. because of a MME restart, or because of a periodic tracking area update request routed to a new MME.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.2\tCause related to subscription options",
            "description": "Cause #5 – IMEI not accepted\nThis cause is sent to the UE if the network does not accept an attach procedure for emergency bearer services using an IMEI.\nCause #7 – EPS services not allowed\nThis EMM cause is sent to the UE when it is not allowed to operate EPS services.\nCause #8 – EPS services and non-EPS services not allowed\nThis EMM cause is sent to the UE when it is not allowed to operate either EPS or non-EPS services.\nCause #11 – PLMN not allowed\nThis EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a PLMN where the UE, by subscription or due to operator determined barring, is not allowed to operate.\nCause #12 – Tracking area not allowed\nThis EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a tracking area where the HPLMN determines that the UE, by subscription, is not allowed to operate.\nNOTE 1:\tIf EMM cause #12 is sent to a roaming subscriber the subscriber is denied service even if other PLMNs are available on which registration was possible.\nCause #13 – Roaming not allowed in this tracking area\nThis EMM cause is sent to an UE which requests service, or if the network initiates a detach request, in a tracking area of a PLMN which by subscription offers roaming to that UE but not in that tracking area.\nCause #14 – EPS services not allowed in this PLMN\nThis EMM cause is sent to the UE which requests service, or if the network initiates a detach request, in a PLMN which does not offer roaming for EPS services to that UE.\nNOTE 2:\tSince only one list of forbidden PLMNs for packet services is maintained in the UE, then the \"forbidden PLMNs for GPRS service\" is the maintained list and the forbidden PLMNs for EPS service is equivalent to it.\nCause #15 – No suitable cells in tracking area\nThis EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a tracking area where the UE, by subscription, is not allowed to operate, but when it should find another allowed tracking area or location area in the same PLMN or an equivalent PLMN.\nNOTE 3:\tCause #15 and cause #12 differ in the fact that cause #12 does not trigger the UE to search for another allowed tracking area on the same PLMN.\nCause #25 – Not authorized for this CSG\nThis EMM cause is sent to the UE if it requests access, or if the network initiates a detach request, in a CSG cell with CSG ID where the UE either has no subscription to operate or the UE's subscription has expired and it should find another cell in the same PLMN or an equivalent PLMN.\nCause #35 – Requested service option not authorized in this PLMN\nThis EMM cause is sent to the UE if it requests in a PLMN a service option for which it is not authorized, e.g. if it attempts to attach for relay node operation in a PLMN with a USIM which does not belong to a relay node-specific subscription.\nCause #36 – IAB-node operation not authorized\nThis EMM cause is sent to the UE if a UE operating as an IAB-node requests service, or if the network initiates a detach request, in a PLMN where the UE, by subscription, is not authorized for IAB operation.\nCause #40 – No EPS bearer context activated\nThis EMM cause is sent to the UE, if during a tracking area updating procedure or a service request, the MME detects that there is no active EPS bearer context in the network.\nCause #31 – Redirection to 5GCN required\nThis EMM cause is sent to the UE if it requests service in a PLMN where the UE by operator policy, is not allowed in EPC and redirection to 5GCN is required.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.3\tCauses related to PLMN specific network failures and congestion/authentication failures",
            "description": "Cause #16 – MSC temporarily not reachable\nThis EMM cause is sent to the UE if it requests a combined EPS attach or tracking area updating in a PLMN where the MSC is temporarily not reachable via the EPS part of the network.\nCause #17 – Network failure\nThis EMM cause is sent to the UE if the MME cannot service an UE generated request because of PLMN failures.\nCause #18 – CS domain not available\nThis EMM cause is sent to the UE if the MME cannot service an UE generated request because CS domain is not available and SMS in MME is not supported.\nCause #19 – ESM failure\nThis EMM cause is sent to the UE when there is a failure in the ESM message contained in the EMM message.\nCause #20 – MAC failure\nThis EMM cause is sent to the network if the USIM detects that the MAC in the AUTHENTICATION REQUEST message is not fresh (see 3GPP TS 33.401 [19]).\nCause #21 – Synch failure\nThis EMM cause is sent to the network if the USIM detects that the SQN in the AUTHENTICATION REQUEST message is out of range (see 3GPP TS 33.401 [19]).\nCause #22 – Congestion\nThis EMM cause is sent to the UE because of congestion in the network (e.g. no channel, facility busy/congested etc.).\nCause #23 – UE security capabilities mismatch\nThis EMM cause is sent to the network if the UE detects that the UE security capability does not match the one sent back by the network.\nCause #24 – Security mode rejected, unspecified\nThis EMM cause is sent to the network if the security mode command is rejected by the UE if the UE detects that the nonceUE does not match the one sent back by the network or for unspecified reasons.\nCause #26 – Non-EPS authentication unacceptable\nThis EMM cause is sent to the network in S1 mode if the \"separation bit\" in the AMF field of AUTN is set to 0 in the AUTHENTICATION REQUEST message (see 3GPP TS 33.401 [19]).\nCause #39 – CS service temporarily not available\nThis EMM cause is sent to the UE when the CS fallback or 1xCS fallback request cannot be served temporarily due to O&M reasons or a mobile terminating CS fallback call is aborted by the network during call establishment (see 3GPP TS 29.118 []).\nCause #42 – Severe network failure\nThis EMM cause is sent to the UE when the network has determined that the requested procedure cannot be completed successfully due to network failure. The failure is not expected to be temporary and repeated request is not likely to succeed in near future.\nCause #78 –PLMN not allowed to operate at the present UE location\nThis EMM cause is sent to the UE to indicate that the PLMN is not allowed to operate at the present UE location.\nNOTE:\tThis cause is only used by the network towards UE in NB-S1 mode or WB-S1 mode accessing the network through a satellite E-UTRA cell.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.4\tCauses related to nature of request",
            "description": "NOTE:\tThis clause has no entries in this version of the specification\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.5\tCauses related to invalid messages",
            "description": "Cause value #95 – Semantically incorrect message.\nSee 3GPP TS 24.008 [13], annex H, clause H.5.5.\nCause value #96 – Invalid mandatory information.\nSee 3GPP TS 24.008 [13], annex H, clause H.6.1.\nCause value #97 – Message type non-existent or not implemented.\nSee 3GPP TS 24.008 [13], annex H, clause H.6.2.\nCause value #98 – Message type not compatible with protocol state.\nSee 3GPP TS 24.008 [13], annex H, clause H.6.3.\nCause value #99 – Information element non-existent or not implemented.\nSee 3GPP TS 24.008 [13], annex H, clause H.6.4.\nCause value #100 – Conditional IE error.\nSee 3GPP TS 24.008 [13], annex H, clause H.6.5.\nCause value #101 – Message not compatible with protocol state.\nSee 3GPP TS 24.008 [13], annex H, clause H.6.6.\nCause value #111 – Protocol error, unspecified.\nSee 3GPP TS 24.008 [13], annex H, clause H.6.8.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.1\tCauses related to nature of request",
            "description": "Cause #8 – Operator Determined Barring\nThis ESM cause is used by the network to indicate that the requested service was rejected by the MME due to Operator Determined Barring.\nCause #26 – Insufficient resources\nThis ESM cause is used by the UE or by the network to indicate that the requested service cannot be provided due to insufficient resources. If EPS counting is required for a network slice, this ESM cause is used by the network to indicate that the requested service cannot be provided due to maximum number of UEs registered to a specific network slice reached or maximum number of PDU sessions on a specific network slice reached.\nCause #27 – Missing or unknown APN\nThis ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network because the access point name was not included although required or if the access point name could not be resolved.\nCause #28 – Unknown PDN type\nThis ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network because the PDN type could not be recognised.\nCause #29 – User authentication or authorization failed\nThis ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network due to a failed user authentication, revoked by the external packet data network, or the required user authentication cannot be performed.\nCause #30 – Request rejected by Serving GW or PDN GW\nThis ESM cause is used by the network to indicate that the requested service or operation or the request for a resource was rejected by the Serving GW or PDN GW.\nCause #31 – Request rejected, unspecified\nThis ESM cause is used by the network or by the UE to indicate that the requested service or operation or the request for a resource was rejected due to unspecified reasons.\nCause #32 – Service option not supported\nThis ESM cause is used by the network when the UE requests a service which is not supported by the PLMN.\nCause #33 – Requested service option not subscribed\nThis ESM cause is sent when the UE requests a service option for which it has no subscription.\nCause #34 – Service option temporarily out of order\nThis ESM cause is sent when the network cannot service the request because of temporary outage of one or more functions required for supporting the service.\nCause #35 – PTI already in use\nThis ESM cause is used by the network to indicate that the PTI included by the UE is already in use by another active UE requested procedure for this UE.\nCause #36 – Regular deactivation\nThis ESM cause is used to indicate a regular UE or network initiated release of EPS bearer resources.\nCause #37 – EPS QoS not accepted\nThis ESM cause is used by the network if the new EPS QoS cannot be accepted that was indicated in the UE request.\nCause #38 – Network failure\nThis ESM cause is used by the network to indicate that the requested service was rejected due to an error situation in the network.\nCause #39 – Reactivation requested\nThis ESM cause is used by the network to request a PDN connection reactivation.\nCause #41 – Semantic error in the TFT operation.\nThis ESM cause is used by the network or the UE to indicate that the requested service was rejected due to a semantic error in the TFT operation included in the request.\nCause #42 – Syntactical error in the TFT operation.\nThis ESM cause is used by the network or the UE to indicate that the requested service was rejected due to a syntactical error in the TFT operation included in the request.\nCause #43 – Invalid EPS bearer identity\nThis ESM cause is used by the network or the UE to indicate that the EPS bearer identity value provided to it is not a valid value for the received message or the EPS bearer context identified by the linked EPS bearer identity IE in the request is not active.\nCause #44 – Semantic errors in packet filter(s)\nThis ESM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more semantic errors in packet filter(s) of the TFT included in the request.\nCause #45 – Syntactical error in packet filter(s)\nThis ESM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more syntactical errors in packet filter(s) of the TFT included in the request.\nCause #47 – PTI mismatch\nThis ESM cause is used by the UE to indicate that the PTI value which is included in the ESM message that the UE receives does not match a PTI in use.\nCause #49 – Last PDN disconnection not allowed\nThis ESM cause is used by the network, in case of EMM-REGISTERED without PDN connection is not supported by the UE or the MME, to indicate that the UE requested PDN disconnection procedure on the last remaining PDN connection is not allowed.\nCause #50 – PDN type IPv4 only allowed\nThis ESM cause is used by the network to indicate that only PDN type IPv4 is allowed for the requested PDN connectivity.\nCause #51 – PDN type IPv6 only allowed\nThis ESM cause is used by the network to indicate that only PDN type IPv6 is allowed for the requested PDN connectivity.\nCause #52 – single address bearers only allowed\nThis ESM cause is used by the network to indicate that the requested PDN connectivity is accepted with the restriction that only single IP version bearers are allowed.\nCause #53 – ESM information not received\nThis ESM cause is used by the network to indicate that the PDN connectivity procedure was rejected due to the ESM information was not received.\nCause #54 – PDN connection does not exist\nThis ESM cause is used by the network at handover of a PDN connection from a non-3GPP access network connected to EPC, or at interworking of a PDU session from non-3GPP access network connected to 5GCN or from NG-RAN connected to 5GCN to a PDN connection, to indicate that the MME does not have any information about the requested PDN connection.\nCause #55 – Multiple PDN connections for a given APN not allowed\nThis ESM cause is used by the network to indicate that the PDN connectivity procedure was rejected due to multiple PDN connections for a given APN are not allowed.\nCause #56 – Collision with network initiated request\nThis ESM cause is used by the network to indicate that the network has already initiated the activation, modification or deactivation of bearer resources which was requested by the UE.\nCause #57 – PDN type IPv4v6 only allowed\nThis ESM cause is used by the network to indicate that only PDN types IPv4, IPv6 or IPv4v6 are allowed for the requested PDN connectivity.\nCause #58 – PDN type non IP only allowed\nThis ESM cause is used by the network to indicate that only PDN type non IP is allowed for the requested PDN connectivity.\nCause #59 – Unsupported QCI value\nThis ESM cause is used by the network if the QCI indicated in the UE request cannot be supported.\nCause #60 – Bearer handling not supported\nThis ESM cause is used by the network to indicate that the procedure requested by the UE was rejected because the bearer handling is not supported.\nCause #61 – PDN type Ethernet only allowed\nThis ESM cause is used by the network to indicate that only PDN type Ethernet is allowed for the requested PDN connectivity.\nCause #65 – Maximum number of EPS bearers reached\nThis ESM cause is used by the network to indicate that the procedure requested by the UE was rejected as the network has reached the maximum number of simultaneously active EPS bearer contexts for the UE.\nCause #66 – Requested APN not supported in current RAT and PLMN combination\nThis ESM cause is used by the network to indicate that the procedure requested by the UE was rejected as the requested APN is not supported in the current RAT and PLMN.\nCause #81 – Invalid PTI value\nThis ESM cause is used by the network or UE to indicate that the PTI provided to it is unassigned or reserved.\nCause #112 – APN restriction value incompatible with active EPS bearer context.\nThis ESM cause is used by the network to indicate that the EPS bearer context(s) have an APN restriction value that is not allowed in combination with a currently active EPS bearer context. Restriction values are defined in 3GPP TS 23.060 [4].\nCause #113 – Multiple accesses to a PDN connection not allowed\nThis ESM cause is used by the network to indicate that multiple accesses to a PDN connection for NBIFOM is not allowed.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.2\tProtocol errors (e.g., unknown message) class",
            "description": "Cause #95 – Semantically incorrect message\nThis ESM cause is used to report receipt of a message with semantically incorrect contents.\nCause #96 – Invalid mandatory information\nThis ESM cause indicates that the equipment sending this ESM cause has received a message with a non-semantical mandatory IE error.\nCause #97 – Message type non-existent or not implemented\nThis ESM cause indicates that the equipment sending this ESM cause has received a message with a message type it does not recognize either because this is a message not defined, or defined but not implemented by the equipment sending this ESM cause.\nCause #98 – Message type not compatible with protocol state\nThis ESM cause indicates that the equipment sending this ESM cause has received a message not compatible with the protocol state.\nCause #99 – Information element non-existent or not implemented\nThis ESM cause indicates that the equipment sending this ESM cause has received a message which includes information elements not recognized because the information element identifier is not defined or it is defined but not implemented by the equipment sending the ESM cause. However, the information element is not required to be present in the message in order for the equipment sending the ESM cause to process the message.\nCause #100 – Conditional IE error\nThis ESM cause indicates that the equipment sending this cause has received a message with conditional IE errors.\nCause #101 – Message not compatible with protocol state\nThis ESM cause indicates that a message has been received which is incompatible with the protocol state.\nCause #111 – Protocol error, unspecified\nThis ESM cause is used to report a protocol error event only when no other ESM cause in the protocol error class applies.\nThe following EMM parameters shall be stored on the USIM if the corresponding file is present:\n-\tGUTI;\n-\tlast visited registered TAI;\n-\tEPS update status;\n-\tAllowed CSG list;\n-\tOperator CSG list; and\n-\tEPS security context parameters from a full native EPS security context (see 3GPP TS 33.401 [19]).\nThe presence and format of corresponding files on the USIM is specified in 3GPP TS 31.102 [17].\nIf the corresponding file is not present on the USIM, these EMM parameters except allowed CSG list are stored in a non-volatile memory in the ME together with the IMSI from the USIM. The allowed CSG list is stored in a non-volatile memory in the ME if the UE supports CSG selection. These EMM parameters can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory; else the UE shall delete the EMM parameters.\nThe following EMM parameters shall be stored in a non-volatile memory in the ME together with the IMSI from the USIM:\n-\tTIN;\n-\tDCN-ID list; and\n-\tnetwork-assigned UE radio capability IDs.\nThe TIN parameter can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; else the UE shall delete the TIN parameter.\nThe DCN-ID list consists of DCN-IDs stored together with a PLMN identity. The list can have zero or more entries and the maximum length shall be at least 32 entries. When the maximum length is reached any new entry shall replace the oldest entry in the list. There shall be no duplicated PLMN identities in the list and any existing DCN-ID shall be deleted when a new DCN-ID is added for the same PLMN.\nThe DCN-ID list can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; else the UE shall delete the DCN-ID list. The UE shall delete the stored DCN-ID list if the default standardized DCN-ID in the UE is changed.\nEach network-assigned UE radio capability ID is stored together with a PLMN identity of the PLMN that provided it as well as a mapping to the corresponding UE radio configuration, and is valid in that PLMN. A network-assigned UE radio capability ID can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME, else the UE shall delete the network-assigned UE radio capability ID. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs. There shall be only one network-assigned UE radio capability ID stored for a given combination of PLMN identity and UE radio configuration and any existing UE radio capability ID shall be deleted when a new UE radio capability ID is added for the same combination of PLMN identity and UE radio configuration. If the UE receives a network-assigned UE radio capability ID with a Version ID value different from the value included in the network-assigned UE radio capability ID(s) stored at the UE for the serving PLMN, the UE may delete these stored network-assigned UE radio capability ID(s).\nIf the UE is attached for emergency bearer services, the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE is detached from emergency services (e.g before attaching for normal service.\nIf the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17], the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE enters EMM-DEREGISTERED.eCALL-INACTIVE state, the UE is switched-off or the USIM is removed.\nIf the UE is attached for access to RLOS, the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead, the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters after detach.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.1\tMapping of NAS procedure to RRC establishment cause (S1 mode only)",
            "description": "When EMM requests the establishment of a NAS-signalling connection, or when EMM requests the lower layers to resume a NAS signalling connection, the RRC establishment cause used by the UE shall be selected according to the NAS procedure as specified in table D.1.1. The EMM shall also indicate to the lower layer for the purpose of access control, the call type associated with the RRC establishment cause as specified in table D.1.1. If the UE is configured for EAB (see the \"ExtendedAccessBarring\" leaf of NAS configuration MO in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]), the EMM shall indicate to the lower layer for the purpose of access control that EAB applies for this request except for the following cases:\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE is answering to paging;\n-\tthe RRC Establishment cause is set to \"Emergency call\";\n-\tthe UE is configured to allow overriding EAB (see the \"Override_ExtendedAccessBarring\" leaf of the NAS configuration MO as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) and receives an indication from the upper layers to override EAB; or\n-\tthe UE is configured to allow overriding EAB (see the \"Override_ExtendedAccessBarring\" leaf of the NAS configuration MO as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) and already has a PDN connection that was established with EAB override.\nTable D.1.1: Mapping of NAS procedure to establishment cause and call type\n\nNOTE:\tThe RRC establishment cause can be used by the network to prioritise the connection establishment request from the UE at high load situations in the network.\nThe UE uses the information elements MS network capability and UE network capability to inform the core network about its network related capabilities. Both information elements can be signalled in any of the modes: A/Gb mode, Iu mode and S1 mode.\nThe purpose of the present annex is to give some guidelines how to select the information element(s) to be enhanced if new capabilities need to be added.\n1)\tIf a capability is related to a feature that can be used in a network supporting A/Gb mode only or Iu mode only or both, the capability will be signalled in the MS network capability IE.\n2)\tIf a capability is related to a feature that can be used in network supporting S1 mode only, the capability will be signalled in the UE network capability IE.\n3)\tIf a capability is related to a feature that can be used only in a network supporting both S1 mode and at least one of the two modes A/Gb mode and Iu mode, the capability is added only to one of the two information elements:\na)\tIf the information is used by the MME only, the capability will be signalled in the UE network capability IE.\nb)\tIf the information is used by the SGSN only or both by the SGSN and by the MME, the capability will be signalled in the MS network capability IE.\nNOTE:\tThe reason for rules 1 and 2 is that a UE not supporting A/Gb mode and Iu mode will not provide the MS network capability IE to the network and a UE not supporting S1 mode will not provide the UE network capability IE. In some cases, due to rules 1 and 2 the capability indicator will be included in both information elements.\nEXAMPLE 1:\tThe support indicator for UCS2 is included in both information elements.\nEXAMPLE 2:\tThe \"SRVCC to GERAN/UTRAN capability\" is included in the MS network capability IE, as it is used both by the MME for SRVCC from E-UTRAN to GERAN/UTRAN and by the SGSN for SRVCC from UTRAN HSPA to GERAN/UTRAN.\nThe UE may support the procedures in this annex.\nIf the UE supports ACDC, the EMM layer shall determine the ACDC category applicable to the request based on the application identifier received from the upper layers and the configuration information in the \"ACDCConf\" leaf of ACDC MO as specified in 3GPP TS 24.105 [35] or in the USIM EFACDC as specified in 3GPP TS 31.102 [17].\nNOTE 1:\tAs an implementation option, the upper layers can determine the ACDC category and send it to the EMM layer. Then the EMM layer need not read the ACDC MO or USIM to determine the ACDC category.\nThe EMM sublayer shall indicate to the lower layers, for the purpose of access control:\n-\tthe ACDC category that applies to this request if only one ACDC category is applicable;\n-\tthe highest ranked ACDC category among the ACDC categories that applies to this request if multiple ACDC categories are applicable; or\n-\tthis request is for an uncategorized application if an application identifier received from the upper layers is not mapped to any ACDC category,\nexcept for the following cases:\n-\tthe UE is a UE configured to use AC11 – 15 in selected PLMN;\n-\tthe UE is answering to paging;\n-\tthe RRC Establishment cause is set to \"Emergency call\"; or\n-\tif conditions MO MMTEL voice call is started or MO MMTEL video call is started or MO SMSoIP is started, is satisfied.\nNOTE 2:\tThe request from the EMM sublayer refers to either a request to establish an initial NAS signalling connection or a request to re-establish a NAS signalling connection.\nIf the UE supports ACDC and access is barred because of ACDC, the EMM layer shall keep track of the ACDC category for which access is barred and it shall not send a request for the same ACDC category or a lower ACDC category until access is granted.\nIf the UE supports ACDC and access is barred because of ACDC, the EMM layer shall not send a request for any uncategorized application until access is granted.\n\n\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table D.1.1: Mapping of NAS procedure to establishment cause and call type",
                    "table number": 247,
                    "summary": "",
                    "name": ""
                },
                {
                    "description": "",
                    "table number": 248,
                    "summary": "",
                    "name": ""
                },
                {
                    "description": "",
                    "table number": 249,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        }
    ]
}