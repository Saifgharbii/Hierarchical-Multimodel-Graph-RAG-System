{
    "document_name": "24629-i00.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification (TS) was been produced by ETSI Technical Committee Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN) and originally published as ETSI TS 183 029 [11]. It was transferred to the 3rd Generation Partnership Project (3GPP) in January 2008.\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document specifies the stage three (protocol description) of the Explicit Communication transfer (ECT) supplementary service, based on stage one and two of the ISDN ECT supplementary service. It provides the protocol details in the IP Multimedia (IM) Core Network (CN) subsystem based on the Session Initiation Protocol (SIP) and the Session Description Protocol (SDP).\nThe present document is applicable to User Equipment (UE) and Application Servers (AS) which are intended to support the ECT supplementary service.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TS 24.229: \"Internet Protocol (IP) multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[2]\tIETF RFC 3515: \"The Session Initiation Protocol (SIP) Refer Method\".\n[3]\tIETF RFC 3892: \"The Session Initiation Protocol (SIP) Referred-By Mechanism\".\n[4]\tIETF RFC 3891: \"The Session Initiation Protocol (SIP) \"Replaces\" Header\".\n[5]\tVoid.\n[6]\tIETF RFC 3261: \"SIP: Session Initiation Protocol\".\n[7]\t3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces; Signalling flows and message contents\".\n[7A]\t3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter protocol; Protocol details\".\n[8]\t3GPP TS 24.610: \"Communication HOLD (HOLD) using IP Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".\n[9]\t3GPP TS 24.605: \"Conference (CONF) using IP Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".\n[10]\t3GPP TS 24.628: \"Common Basic Communication procedures using IP Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".\n[11]\tETSI TS 183 029 V2.5.0: \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); PSTN/ISDN simulation services: Explicit Communication Transfer (ECT); Protocol specification\".\n[12]\t3GPP TS 24.315: \"IP Multimedia Subsystem (IMS) Operator Determined Barring (ODB); Stage 3\".\n[13]\tIETF RFC 7090 (April 2014): \"Public Safety Answering Point (PSAP) Callback\".\n[14]\tIETF RFC 6665: \"SIP-Specific Event Notification\".\n[15]\tIETF RFC 4538: \"Request Authorization through Dialog Identification in the Session Initiation Protocol (SIP)\".\n[16]\tIETF RFC 7647 (September 2015): \"Clarifications for the Use of REFER with RFC6665\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following terms and definitions apply:\nECT session identifier URI: PSI created and inserted by an ECT AS that resolves to the AS itself\nNOTE 1:\tIf this URI contains correlation information it has to be constructed in such a way that it does not reveal identity information about any party involved in the transfer.\ntransferee: party being transferred to the transfer target\ntransferor: party initiating the transfer\ntransfer target: party that the existing communication is transferred to\nNOTE 2:\tAfter transfer the transferee and the transfer target are in communication with each other.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following abbreviations apply:\nACR\tAnonymous Communication Rejection\nAS\tSIP Application Server\nCDIV\tCommunication DIVersion\nCONF\tCONFerence\nCSCF\tCall Session Control Function\nECT\tExplicit Communication Transfer\nGRUU\tGlobally Routable User agent URI\nHOLD\tcommunication HOLD\nIETF\tInternet Engineering Task Force\nIFC\tInitial Filter Criteria\nISDN\tIntegrated Services Digital Network\nMCID\tMalicious Call IDentification\nMGCF\tMedia Gateway Control Function\nMiD\tMulti-iDentity\nMuD\tMulti-Device\nOCB\tOutgoing Communication Barring\nODB\tOperator Determined Barring\nOIP\tOriginating Identification Presentation\nOIR\tOriginating Identification presentation Restriction\nPSAP\tPublic Safety Answering Point\nPSTN\tPublic Switch Telephone Network\nS-CSCF\tServing-CSCF\nSIP\tSession Initiation Protocol\nTIP\tTerminating Identification Presentation\nTIR\tTerminating Identification presentation Restriction\nUE\tUser Equipment\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tExplicit Communication transfer (ECT)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "The service provides a party involved in a communication to transfer that communication to a third party.\nProcedures for the ECT AS regarding operator determined barring (ODB) are defined in 3GPP TS 24.315 [12].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tDescription",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2.1\tGeneral description",
                            "text_content": "The explicit communication transfer (ECT) service provides a party involved in a communication to transfer that communication to a third party.\nThere are three actors active in a transfer, they are acting in the following roles:\ntransferor:\tthe party that initiates the transfer of the active communication that it has with the transferee;\ntransferee:\tthe party which stays in the communication which is transferred;\ntransfer target:\tthe party which the communication is transferred to and which replaces the transferor in the communication.\nThere are two initial situations in which transfer shall be possible:\n-\tthe transferor has no ongoing consultation communication with the transfer target (blind/assured transfer), then either:\na)\tthe transferor wants to perform the transfer without any further action on the transfer operation (blind transfer); or\nb)\tthe transferor wants to have a feedback on the transfer operation progress with the possibility to retrieve the communication with the transferee (assured transfer); or\n-\tthe transferor has a consultation communication with the transfer target (consultative transfer).\nThe transferor AS takes care that it remains in the signalling path even after the communication is transferred, this allows:\n-\tclassical charging models;\n-\tanonymization of the transfer target.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.3\tOperational requirements",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.3.1\tProvision/withdrawal",
                            "text_content": "The ECT service may be provided after prior arrangement with the service provider or be generally available.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.2\tRequirements on the transferor network side",
                            "text_content": "No specific requirements are needed in the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.3\tRequirements on the transferee network side",
                            "text_content": "No specific requirements are needed in the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.4\tRequirements on the transfer target network side",
                            "text_content": "No specific requirements are needed in the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.4\tCoding requirements",
                    "description": "",
                    "summary": "",
                    "text_content": "A user agent that wishes to use the ECT service (to act as a transferor):\n-\tShall support the REFER method as a client as specified in RFC 3515 [2] as updated by IETF RFC 6665 [14] and IETF RFC 7647 [16].\n-\tShall support the Referred-By header field as specified in RFC 3892 [3].\n-\tShall support the Target-Dialog header field as specified in RFC 4538 [15].\nA user agent that is the transferred party in a communication transfer (acts as the transferee):\n-\tShall support the REFER method as a server as specified in RFC 3515 [2] and updated by RFC 6665 [14].\n-\tShall support the Referred-By header field as specified in RFC 3892 [3].\n-\tShall support Replaces header field as a client as specified in RFC 3891 [4].\n-\tShall support the Target-Dialog header field as specified in RFC 4538 [15].\nA user agent that is the transfer target in a communication transfer:\n-\tMay support the Referred-By header field as a server as specified in RFC 3892 [3].\n-\tMay support the Replaces header field as a server as specified in RFC 3891 [4].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.5\tSignalling requirements",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.5.1\tActivation/deactivation",
                            "text_content": "The ECT service is activated at provisioning and deactivated at withdrawal.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.1A\tRegistration/erasure",
                            "text_content": "The ECT service requires no registration. Erasure is not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.1B\tInterrogation",
                            "text_content": "Interrogation of ECT is not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.5.2\tInvocation and operation",
                            "text_content": "A UE that has initiated an emergency call, shall not perform any transfer operation involving the dialog associated with the emergency call.\nA UE that initiates a transfer operation shall if the Contact address of the transferee is a GRUU:\n-\tissue a REFER outside an existing dialog as specified in RFC 3515 [2] as updated by IETF RFC 6665 [14] and IETF RFC 7647 [16], where:\na)\tthe request URI shall contain the SIP URI of the transferee as received in the Contact header field:\nb)\tthe Refer-To header field shall indicate the public address of the transfer target;\nc)\tin case of Consultative transfer, the transferor UE has a consultation communication with the transfer target, a Replaces header field parameter shall be added to the Refer-To URI together with a Require=replaces header field parameter;\nd)\tthe Referred-By header field can be used to indicate the identity of the transferor. When privacy was required in the original communications dialog and a Referred-By header field is included, the UE shall include a Privacy header field set to \"user\"; and\ne)\tthe Target-Dialog header field identifies the dialog to be transferred;\notherwise the UE shall:\n-\tissue a REFER request in the original communications dialog as specified in RFC 3515 [2], where:\na)\tthe request URI shall contain the SIP URI of the transferee as received in the Contact header field;\nb)\tthe Refer-To header field shall indicate the public address of the transfer target;\nc)\tin case of consultative transfer, the transferor UE has a consultation communication with the transfer target, a Replaces header field parameter shall be added to the Refer-To URI together with a Require=replaces header field parameter; and\nd)\tthe Referred-By header field can be used to indicate the identity of the transferor. When privacy was required in the original communications dialog and a Referred-By header field is included, the UE shall include a Privacy header field set to \"user\".\nIf assured transfer is requested, the UE may include an Expires header field in the Refer-To URI of the REFER request.\nNOTE 1:\tThe value of the Expires header field indicates the maximum duration of the transfer attempt. If the transfer does not succeed within this duration, the UE will receive a NOTIFY request indicating the transfer failure.\nAfter the REFER request is accepted by the other end with a 2xx response, the transferor UE gets notifications of how the transferee's communication setup towards the transfer Target is progressing.\nWhen a NOTIFY request is received on the REFER dialog that indicates that the transferee and the transfer Target have successfully setup a communication, the transferor UE may terminate the original communication with the transferee UE, by sending a BYE request on the original dialog.\nIf an assured transfer attempt is not completed (i.e. the UE has not received a NOTIFY request with a \"message/sipfrag\" body’s status line containing a final response code indicating the end of the transfer operation), the UE may request to terminate the transfer attempt by:\n-\tsending a REFER request in the same communications dialog as the previous REFER request as specified in RFC 3515 [2] as updated by IETF RFC 6665 [14] and IETF RFC 7647 [16], where:\na)\tthe request URI shall contain the SIP URI of the transferee as received in the Contact header field; and\nb)\tthe Refer-To header field shall indicate the public address of the transfer target and shall contain the method parameter set to \"CANCEL\"; and\nc)\tif applicable include a Target-Dialog header field that identifies the dialog under transfer.\nIf the UE receives a NOTIFY request indicating that the assured transfer attempt failed,followed by a re-INVITE or an UPDATE request taking the UE off HOLD the UE may decide to retrieve the original communication by sending a re-INVITE request in the original SIP dialog.\nNOTE 2:\tIf the user requests the retrieval of the original communication while the transfer attempt has not been completed, the UE needs to first request the termination of the transfer attempt before retrieving the original communication via a re-INVITE request.\nFor ECT to be provided to end users acting as transferors, the end user's AS providing ECT shall be in the signalling path for all communications.\nIf priority is supported, to apply appropriate priority processing of ECT invocation requests (see subclause 4.5.2.4.1.2.2A and subclause 4.5.2.4.1.2.3), the AS shall store call details for all existing dialogs that contain a Resource-Priority header field, including identification of the originating and terminating parties (e.g., based on the P-Asserted Identity header field value and the Request-URI value) and the Resource-Priority header field value most recently received within each dialog.\nThe transferor AS is the one executing the ECT service logic, which is invoked by the transferor sending a special REFER request.\nIn order to know whether ECT service applies on a REFER request sent by the served user, the following criteria shall apply before the ECT logic is executed:\n-\tthe Target-Dialog header field identifies an existing dialog towards the transferee identified by the Request-URI;\n-\tthe REFER request's Request-URI (transferee) is a GRUU targeted at the same UE instance that is involved in the dialog identified by the Target-Dialog header field; and\n-\tthe REFER request's Refer-To header field contains a URI so that the method constructed from the URI according to RFC 3261 [6] is equal to INVITE;\nIn order to know whether ECT service applies on a REFER request sent by the served user, the following criteria shall apply before the ECT logic is executed:\n-\tthe REFER request's request-URI (transferee) is targeted at the same UE instance that is involved in the dialog; and\n-\tthe REFER request's Refer-To header field contains a URI so that the method constructed from the URI according to RFC 3261 [6] is equal to INVITE.\nAny REFER request that does not comply with these criteria shall not invoke the ECT service and is depending on operator policy:\n-\trejected;\n-\thandled by another service; or\n-\tproxied on.\nIf any of the following is true:\n-\tthe initial INVITE request on the dialog on which the REFER request is received was identified as a PSAP callback request; or\n-\tthe Refer-To header field in the REFER request contains a URI with which the referor is involved in a dialog where the initial INVITE request was identified as a PSAP callback request.\nthe AS shall based on local policy on how to handle PSAP callbacks reject the REFER request.\nThe mechanism to identify an INVITE request as a PSAP callback depends on local policy and can be based on the PSAP callback indicator specified in IETF RFC 7090 [13].\nWhen a REFER request is received that invokes the call transfer service (see subclause 4.5.2.4.1), the AS shall follow procedures specified in 3GPP TS 24.628 [10] for special REFER request handling using 3PCC procedures. An AS supporting the assured transfer, shall put the INVITE dialog towards the transferor on HOLD, following procedures in 3GPP TS 24.610 [8].\nIf the received REFER request contained an Expires header field in the Refer-To URI, the AS shall start a timer set to the value received in the Expires header field when the INVITE request is sent towards the transfer target, as requested by the received REFER request. If this timer expires before the transfer attempt is completed, the AS shall send a CANCEL request towards the transfer target according to RFC 3261 [4].\nFor blind communication transfer, if required by local policy to do so, the AS shall connect a media server to the transferee UE in order to provide in-band announcement about the progress of the communication establishment with the transfer target.\nIf the received REFER request pertains to an existing priority dialog that was originated by the transferee UE, the AS shall copy the stored Resource-Priority header field value from the existing dialog (see subclause 4.5.2.4.1.1) to the INVITE request that is sent towards the transfer target.\nNOTE 1:\tThe existing dialog is identified using the Target-Dialog header field included in the REFER request for a REFER request received on a separate dialog (see subclause 4.5.2.4.1.2.1) or using the dialog of a REFER request received in a to-be-transferred dialog (see subclause 4.5.2.4.1.2.2).\nNOTE 2:\tThis case only applies when the transferee UE has been authorized for priority for the original call.\nIf the assured transfer attempt fails, the AS shall resume the INVITE dialog with the transferor, following procedures in 3GPP TS 24.610 [8].\nWhen a REFER request is received that invokes the ECT service (see subclause 4.5.2.4.1), the ECT service shall perform the following actions:\n1)\tCreate a new ECT session identifier URI addressed to this AS. The URI shall be created in such a way that a new dialog set up towards this URI can be easily correlated with the current REFER dialog.\n2)\tThe AS stores the value of the Refer-To header field (transfer target URI) from the REFER request and links it to the ECT Session Identifier URI.\n3)\tThe AS replaces the Refer-To header field with the ECT Session Identifier URI (this ensures that the transferor AS remains in the loop when the transferee sets up the communication with the transfer target).\nNOTE 1:\tIf a Replaces header field parameter and/or a Require=replaces header field parameter are available in the URI contained in the Refer-To header field, the above step implies that they are not forwarded to the transferee.\n4)\tIf a Referred-By header field is available in the request, the AS verifies if the provided Referred-By header field contains a valid public identity of the served user. If not it will replace the Referred-By header filed with a valid value matching the REFER request's P-Asserted-Identity and if \"id\" privacy was requested, include a Privacy header field set to \"user\". If the Referred-By header field does not contain a valid public identity of the served user and multiple valid public user identities are received in the REFER request's P-Asserted-Identity header field, the AS shall select the first one on the list. The AS then stores the Referred-by header field.\n5)\tIf no Referred-By header field is available in the request a Referred-By header field is added that matches the REFER request's P-Asserted-Identity and if \"id\" privacy was requested, include a Privacy header field set to \"user\". If multiple valid public user identities are received in the REFER request's P-Asserted-Identity header field, the AS shall select the first one on the list.\n6)\tIf the received REFER request pertains to an existing priority dialog that was originated by the transferee UE, the AS shall copy the stored Resource-Priority header field value from the existing dialog (see subclause 4.5.2.4.1.1) to the Resource-Priority header field of the REFER request that is sent towards the transferee UE.\nNOTE 2:\tThe existing dialog is identified using the Target-Dialog header field included in the REFER request for a REFER request received on a separate dialog (see subclause 4.5.2.4.1.2.1) or using the dialog of a REFER request received in a to-be-transferred dialog (see subclause 4.5.2.4.1.2.2).\nNOTE 3:\tThis case only applies when the transferee UE has been authorized for priority for the original call.\n7)\tThe AS sends the REFER request on to the transferee using basic communication procedures according to 3GPP TS 24.229 [1].\nIf the AS receives a 403 (Forbidden) or 501 (Not implemented) response to a REFER request, the AS of the initiator of the REFER request may initiate the special REFER handling procedures, according to 3GPP TS 24.628 [10].\nIf the AS receives a NOTIFY request with a sipfrag message body indicating a 420 (Bad Extension) as defined in RFC 3892 [3], the AS of the initiator of the REFER request may initiate the special REFER handling procedures according to 3GPP TS 24.628 [10].\nAs a network option, the AS of the initiator of the REFER request that has prior knowledge that the remote party is not allowed to receive or does not support the REFER method, may initiate the special REFER handling procedures directly, according to 3GPP TS 24.628 [10].\nWhen an INVITE is received targeted at the ECT session identifier URI created earlier when the served user requested transfer of an ongoing communication, ECT shall perform the following actions:\n0)\tIf the stored transfer target URI linked to the ECT session identifier contains a Replaces header field parameter, then the AS inserts the Replaces header field in the INVITE request and:\na)\tIf the INVITE request does not contain a Requires header field, then the AS inserts a Requires header field in the INVITE request including a \"replaces\" token; and\nb)\tIf the INVITE request does contain a Requires header field without a \"replaces\" token, then the AS inserts a Requires header field in the INVITE request including a \"replaces\" token.\n1)\tstrip all header field parameters and method parameter from the stored transfer target URI and replace the request URI with the stripped version of the stored transfer target URI linked to the specific ECT session identifier URI;\n2)\tif a Referred-By header field is available in the request, the AS verifies if the provided Referred-By header field contains a valid identity of the served user. If not it will replace the Referred-By header field with a valid value matching the REFER request's P-Asserted-Identity and if \"id\" privacy was requested, include a Privacy header field set to \"user\". If the Referred-By header field does not contain a valid public identity of the served user and multiple valid public user identities are received in the REFER request's P-Asserted-Identity header field, the AS shall select the first one on the list;\n3)\tif no Referred-By header field is available in the request a Referred-By header field is added that matches the REFER request's P-Asserted-Identity , and if \"id\" privacy was requested, include a Privacy header field set to \"user\". If multiple valid public user identities are received in the REFER request's P-Asserted-Identity header field, the AS shall select the first one on the list; and\nNOTE:\tIf needed the AS can generate charging events to charge for the extra leg.\n4)\tthe INVITE request is forwarded towards the transfer target using basic communication procedures 3GPP TS 24.229 [1].\n4.5.2.4.2.2\tActions of ECT on failed REFER request\nWhen a REFER request is received in the context of a call transfer scenario (see subclause 4.5.2.4.1), the transferee UE shall perform the following steps:\n1)\tapply the procedure for holding the active communication with the transferor as described in 3GPP TS 24.610 [8] subclause 4.5.2.1;\n2)\tform a request from the URI in the Refer-To header field in accordance with RFC 3261 [6], section 19.1.5. If no \"method\" URI parameter is included an INVITE request shall be formed in accordance with RFC 3261 [6];\n3)\tsend the request to the transfer target;\n4)\tif the UE does not support the Assured transfer service, send a BYE request on the INVITE dialog towards the transferor; and\n5)\tact as a notifier in accordance with RFC 3515[2] as updated by RFC 6665 [14].\nA UE supporting the assured transfer service shall keep the INVITE dialog towards the transferor. If the request towards the transfer target fails, the UE supporting the assured transfer service shall resume the session towards the transferor as described in 3GPP TS 24.610 [8] subclause 4.5.2.1.\nApply normal re-INVITE procedures according to 3GPP TS 24.229 [1].\nFor ECT to be provided to end users acting as transferee, the end user's AS providing ECT shall be in the signalling path for all communications of the served user.\nSee subclause 4.5.2.4.1 on the criteria that determine that a REFER request is to be treated as a request for transfer of an existing communication.\nWhen a REFER request is received in the context of a call transfer scenario (see subclause 4.5.2.4.1), the ECT AS shall perform the following steps:\n1)\tStore the value of the Refer-To header field (used later to correlate the new communication with this REFER dialog).\n2)\tOptionally it may store the value of the Referred-By header field, if it wants to ensure that the Referred-By is correct on the resulting INVITE request.\n3)\tIf priority is supported and if the REFER request pertains to an existing priority dialog that contains a Resource-Priority header field, the ECT AS shall store the Resource-Priority header value along with dialog details, and based on operator policy shall copy the Resource-Priority header field value to the Resource-Priority header parameter of the SIP URI in the Refer-To header field of the REFER request.\n4)\tForward the request to the transferee according to basic communication procedures 3GPP TS 24.229 [1].\nWhen an INVITE request is received targeted at the SIP URI stored earlier when a transfer request was received targeted at the served user (transferee), the AS shall perform the following actions:\n0)\tOptionally check the following header fields in the received INVITE request:\na)\tif a Referred-By header field is present in the INVITE request, the AS may check if it matches the Referred-By header field of the REFER request stored earlier. If it does not match, depending on the policy of the service provider, the AS shall reject the INVITE request or replace the Referred-By header field in the INVITE request with the value stored earlier;\nb)\tif a Referred-By header is absent in the INVITE, the AS shall insert a Referred-By header with the value stored earlier; and\nc)\tif priority is supported and if a Resource-Priority header field is absent in the INVITE request, but was included in the REFER request as described in subclause 4.5.2.7.2, and the INVITE request is associated with the dialog details stored in subclause 4.5.2.7.2, the AS shall insert a Resource-Priority header field with the stored value;\n1)\toptionally generate charging events:\na)\tto charge for the original communication between the transferee and the transferor, in case the transferee was the originating party in the original communication; and\nb)\tto switch off charging in case the transferee was the terminating party in the original communication; and\n2)\tthe INVITE request is forwarded towards the transfer Target using basic communication procedures 3GPP TS 24.229 [1].\nBasic communication procedures according to 3GPP TS 24.229 [1] shall apply.\nBasic communication procedures according to 3GPP TS 24.229 [1] shall apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.6\tInteraction with other services",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.6.1\tCommunication HOLD (HOLD)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.2\tTerminating Identification Presentation (TIP)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.3\tTerminating Identification Restriction (TIR)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.4\tOriginating Identification Presentation (OIP)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.5\tOriginating Identification Restriction (OIR)",
                            "text_content": "Requirements relating to the Referred-By header field are described in subclauses 4.5.2.4.1.2.3 and 4.5.2.4.2.1.\nOn the reception of an INVITE request from the transferee, the transferor AS shall deduce the \"id\" related privacy requirement that the transferee has indicated in the initial call between the transferee and the transferor; and shall include a Privacy header field containing the according value in the outgoing INVITE request.\nFor the transferee AS and the transfer  there is no impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.6\tCONFerence Calling (CONF)",
                            "text_content": "ECT shall not apply when the following criteria apply:\n-\ta REFER request is received in an INVITE dialog with a conference focus, or a REFER request is received in an INVITE dialog and the Refer-to header field of the REFER request indicates the public address of active dialog to conference focus which is known by the AS providing ECT; and\n-\tthe REFER request is originated by the conference controller, the conference controller is the user that created and owns the conference.\nAn AS can determine that an established INVITE dialog is terminated at a conference focus because according to 3GPP TS 24.605 [9] it either:\n-\thas received a 1xx or 2xx response to the INVITE request with an \"isfocus\" feature parameter in the Contact header field; or\n-\thas received an INVITE with an \"isfocus\" feature parameter in the Contact header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.7\tCommunication DIVersion Services (CDIV)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.8\tMalicious Communication IDentification (MCID)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.9\tAnonymous Communication Rejection and Communication Barring (ACR/CB)",
                            "text_content": "For the transferor AS the following applies:\n-\tThe transferor AS shall not accept transfer requests with a transfer target that is barred by the served users Outgoing Communication Barring (OCB) rules.\n-\tFor the transferee AS and the transfer target AS there is no impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.10\tExplicit Communication Transfer (ECT)",
                            "text_content": "See subclause 4.5.2.4.1 on the criteria that determine that a REFER request is to be treated as a request for transfer of an existing communication.\nAdditionally the following criteria should apply for this interaction case to apply:\n-\tThe INVITE dialog on which the REFER request is received is a previously transferred communication, for which the current ECT instance had the transferor role.\nWhen a REFER request is received and the criteria of subclause 4.6.10.1 apply, then the AS shall perform the following steps:\n1)\tCreate a new ECT session identifier URI addressed to this AS. The URI shall be created in such a way that a new dialog set up towards this URI can be easily correlated with the current REFER dialog.\n2)\tThe AS stores the value of the Refer-To header field (transfer target) from the REFER request and links it to the ECT session identifier URI.\n3)\tThe AS replaces the Refer-To header field with the ECT session identifier URI from step 1). (This ensures that this AS remains in the loop when the transferee sets up the communication with the transfer target.).\n4)\tThe AS forwards the REFER request to the transferee using basic communication procedures in 3GPP TS 24.229 [1].\nWhen an INVITE is received targeted at the ECT session identifier URI created earlier in subclause 4.6.10.2, the AS shall perform the following actions:\n1)\tThe AS replaces the request URI with the stored Refer-To header field value linked to the specific ECT session identifier URI.\nNOTE:\tIf needed the AS may generate charging events to charge for the extra leg.\n2)\tThe AS forwards the INVITE request towards the transfer target using basic communication procedures in 3GPP TS 24.229 [1].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.11\tEnhanced Calling Name (eCNAM)",
                            "text_content": "On an established session with an eCNAM subscriber, if a blind transfer takes place, the AS sends a new INVITE request to the transferee without eCNAM information about the transferor.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.12\tMulti-Device (MuD)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.13\tMulti-Identity (MiD)",
                            "text_content": "No impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.7\tInterworking with other networks",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.7.1\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.8\tParameter values (timers)",
                    "description": "",
                    "summary": "",
                    "text_content": "No specific timers are required.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.9\tService configuration",
                    "description": "",
                    "summary": "",
                    "text_content": "Not applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.1\tBlind transfer",
            "description": "Figure A.1 signalling flow shows a blind transfer scenario, whereby the REFER request is forwarded the existing INVITE dialog between A and B.\nBlind transfer is a technique used in optical communication networks to ensure reliable and efficient data transmission. In Figure A.1, the figure illustrates the blind transfer process, where the signal is transmitted without any knowledge of the destination. This method is crucial for ensuring that the signal reaches its intended destination without any interference or errors.\nFigure A.1: Blind transfer\n1.\tA multimedia session exists between A-B. B initiates transfer A to C, by sending a REFER request with a Toheader field set to UE-A, a Referred-To header field set to UE-C, a Referred-By header field set to UE-B. The REFER request is sent in the existing dialog between A and B.\n1.1\tUpon reception of the REFER request, AS-B must check whether there is no outgoing call barring active from B to C. Because B is charged for the call from B-C when A is referred to C, when outgoing call barring is active from B-C the REFER request is rejected. \n\nAS-B checks whether B is allowed to transfer calls, if B is allowed to transfer the call then AS-B generates an ECT session identifier URI, addressed to itself, with the new destination information and billing information that will be needed for the new session. It replaces the Refer-To header field value with the ECT session identifier URI. This ensures that:\n\nAS-B will remain in the loop.\n2. \tThe REFER request is forwarded to AS-A.\n2.1 \tAS-A checks whether it is allowed to transfer A.\n3. \tThe REFER request is forwarded to A by AS-A.\n4.\t The REFER request is accepted by A's UE.\n4.1, 13.1, 31.1\tAS-A can use result messages and notifications caused by the REFER request to track success of the REFER request and take appropriate actions. The AS-A can ensure that header fields that were replaced with other content are recreated with the original content on the way back.\n5.1, 8.1, 32.1\tAS-B can use this to track success of the REFER request and take appropriate actions. The AS-B can ensure that header fields that were replaced with other content are recreated with the original content on the way back.\n7.\tSince the REFER request was accepted in 6. UE-B terminates the existing INVITE dialog by sending a BYE request to UE-A.\n19.\tUE-A initiates a new session by sending an INVITE request to AS-B's ECT session identifier URI (which represents UE-C).\n19.1\tAS-A routes the INVITE request to AS-B using the AS-B's ECT session identifier URI using normal SIP routing procedures. Normal charging from A to B applies.\n20.1\tUpon receiving the INVITE request to the ECT session identifier URI that was inserted by the AS-B, the AS-B replaces it with the Request URI of C and creates an INVITE request targeted towards UE-C. \n\nIn this scenario it can be assumed that there is no active outgoing call barring towards UE-C, because the REFER was accepted by AS-B. The ECT Session Identifier URI has a limited validity time to ensure that no future barring is violated. \n\nAlso the Referred-By: header field is verified or filled in with the original unmodified values. Then the INVITE request is forwarded to UE-C using normal routing procedures.\n21.1, 23.1\t terminating services apply for UE-C. The call will be treated as a call from A-C regarding call policies.\n25.1\tAS-A. Normal response handling applies.\n27.1\tAS-A. Normal ACK handling applies.\n28.1\tAS-B replaces all modified values and ECT session identifier URI 's with stored values.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.2\tConsultative transfer",
            "description": "Figure A.2 signalling flow shows a consultative transfer scenario.\nThe figure depicts a consultative transfer scenario, illustrating the process of transferring information between two parties. The diagram shows a series of nodes, each representing a participant in the transfer, with arrows indicating the flow of information. The nodes are interconnected by lines, representing the communication channels, and the arrows represent the direction of the transfer. The figure is a visual representation of the consultative transfer process, which is a key component of communication systems.\nFigure A.2: Consultative transfer\n1.\tMultimedia sessions exist between A-B and between B-C. B initiates transfer of A to C, by sending a REFER request including a To header field set to UE-A GRUU a Refer-To header field set to UE-C?Replaces=dialog2&Require=replaces and a Referred-By header field set to UE-B. The REFER request reuses the dialog that exists from A-B.\n1.1\tUpon reception of the REFER request AS-B must check whether there is no outgoing call barring active from B to C. Because B is charged for the call from B-C when A is referred to C, when outgoing call barring is active from B-C the REFER is rejected.\n\nAS-B checks whether B is allowed to transfer calls, if it is allowed to transfer the call then AS-B generates an ECT session identifier URI, addressed to itself, with the new destination information and billing information that will be needed for the new session. It replaces the Refer-To header field value with the ECT session identifier URI. This ensures that AS-B will remain in the loop.\n2.\tThe REFER request is forwarded to AS-A.\n2.1\tAS-A checks whether it is allowed to transfer A.\n3.\tThe REFER is forwarded to A by AS-A.\n4.1, 7.1, 31.1\tAS-A can use result messages and notifications caused by the REFER request to track success of the REFER request and take appropriate actions. The AS-A can ensure that header fields that where replaced with other content are recreated with the original content on the way back.\n5.1, 8.1, 32.1\tAS-B can use this to track success of the REFER request and take appropriate actions. The AS-B can ensure that header fields that where replaced with other content are recreated with the original content on the way back.\n13.\tUE-A initiates a new session by sending an INVITE to AS-B's ECT session identifier URI (which represents UE-C).\n13.1\tAS-A checks whether A is allowed to use the Replaces extension and routes the INVITE request to AS-B using the AS-B's ECT session identifier URI using normal SIP routing procedures. Normal charging from A to B applies.\n14.1\tUpon receiving the INVITE request to the ECT session identifier URI that was inserted by AS-B, AS-B replaces the Request URI and creates an INVITE targeted towards UE-C. Further AS-B inserts a Replaces header field with the value of the Replaces parameter of the stored transfer target URI if it is available, which will allow the new session to replace the existing session between B and C.\nIn this scenario it can be assumed that there is no active outgoing call barring towards UE-C, because UE-B was able to setup a call to UE-C in the first place. However when there was no consultation call to UE-C, there is an issue but this is solved at the initial reception of the REFER from UE-C and not at this stage.\nThe INVITE request is forwarded to UE-C using normal routing procedures.\n15.1, 17.1\t terminating services apply for UE-C. The call will be treated as a call from A-C regarding call policies. AS-C checks whether the Replaces mechanism is used.\n19.1\tAS-A. Normal response handling applies.\n21.1\tAS-A. Normal ACK handling applies.\n22.1\tAS-B replaces all codified values and the ECT session identifier URI with stored values.\n25.\tUE-C terminates dialog 2 as consequence of normal Replaces procedures according to RFC 3891 [4].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.3\tBlind call transfer with third party call control",
            "description": "An example of a call flow where a media server is used is given in figure E.1 of 3GPP TS 24.628 [10]. In this call flow, the media server is involved in the media path before transfer is received and remains involved after the call is transferred. For blind communication transfer, the media server may be connected only to the transferee (UE-B) after the REFER request is received and be disconnected when the transfer target accepts the call.\nAn example of call flow where no media server is used is given in figure E.1 of 3GPP TS 24.628 [10].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.4\tConsultative call transfer with third party call control",
            "description": "An example of a call flow is given in figure E.5 of 3GPP TS 24.628 [10].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.1\tExample of filter criteria for ECT",
            "description": "This annex provides an example of a filter criterion that triggers SIP requests that are subject to initial filter criteria evaluation.\nWhen the initial request matches the conditions of the next unexecuted IFC rule for the served user which points to the ECT service, the communication is forwarded to the AS.\nAn example of an Initial Filter Criteria (IFC) Trigger Point configurations under the assumption that the ECT service is a standalone service that can be invoked by a very specific trigger point active at the destination S-CSCF:\n-\tMethod=\"INVITE\".\nNOTE 1:\tThe coding of the Initial Filter Criteria is described in 29.228 [7] and 29.229 [7A].\nNOTE 2:\tWhen the REFER is forwarded on an existing dialog, no IFC processing will be performed, because this is a subsequent request on an existing dialog. It follows that when this scenario is supported, all signalling has to traverse through the AS.\nAn example of an IFC Trigger Point configuration where the S-CSCF does not invoke the ECT AS for a PSAP callback:\n-\tMethod=\"INVITE\" and not Priority header field with a \"psap-callback\" header field value.\nNOTE 3:\tNot invoking the ECT AS assumes that the ECT invocation request can be handled elsewhere in the network, e.g. in the PSAP itself.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.1\tExample of B REFER's A to C",
            "description": "This scenario is added to show that the solution presented in the present document is able to support classical charging models. Assumption in this scenario is that A originated the original call and is thus charged for the initial A-B communication.\nThe figure C.1 illustrates an example of B REFER's A to C, which is a method used in telecommunication networks to improve signal quality by reducing the number of hops between the source and the receiver. The figure shows the path of the signal from the source to the receiver, with each hop marked by a different color. By using this method, the signal can be transmitted more efficiently and with less interference, resulting in improved signal quality.\nFigure C.1: Example of B REFER's A to C\nTable C.1\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table C.1",
                    "table number": 3,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.2\tExample of A REFER's B to C",
            "description": "This scenario is added to show that the solution presented in the present document is able to support classical charging models. Assumption in this scenario is that A originated the original call and is thus charged for initial A-B communication.\nThe figure C.2 illustrates an example of a REFER's B to C, which is a type of network topology used in telecommunications. The diagram shows a network with two branches, B and C, connected to a central point, C. The branches are labeled with the corresponding network elements, such as switches, routers, and servers. The REFER's B to C topology is used to improve network performance by allowing for faster data transmission and better network utilization.\nFigure C.2: Example of a REFER's B to C\nTable C.2\n\n\n\n\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table C.2",
                    "table number": 4,
                    "summary": "",
                    "name": ""
                },
                {
                    "description": "",
                    "table number": 5,
                    "summary": "",
                    "name": ""
                },
                {
                    "description": "",
                    "table number": 6,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        }
    ]
}