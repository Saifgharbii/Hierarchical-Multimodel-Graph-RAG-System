{
    "document_name": "24554-i30.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, modal verbs have the following meanings:\nshall\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions and do not appear in Technical Reports.\nThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\tindicates permission to do something\nneed not\tindicates permission not to do something\nThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\tindicates that something is possible\ncannot\tindicates that something is impossible\nThe constructions \"can\" and \"cannot\" are not substitutes for \"may\" and \"need not\".\nwill\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document specifies the protocols for Proximity-based Services (ProSe) in 5G system as specified in 3GPP TS 23.304 [2] for:\na)\t5G ProSe direct discovery;\nb)\t5G ProSe communication over the PC5 interface;\nc)\t5G ProSe-enabled UE-to-network relay; and\nd)\t5G ProSe-enabled UE-to-UE relay.\nThe present document defines the associated procedures for 5G ProSe service authorization, 5G ProSe direct discovery (e.g. the procedures between 5G ProSe-enabled UE and 5G Direct Discovery Name Management Function (DDNMF) over the PC3a interface, the procedures over the PC5 interface), 5G ProSe UE-to-network relay discovery, 5G ProSe UE-to-UE relay discovery and 5G ProSe direct communication.\nThe present document also defines the message format, message contents, error handling and system parameters applied by the protocols for ProSe in 5GS.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System (5GS); Stage 2\".\n[3]\tIETF RFC 9112: \"HTTP/1.1\".\n[4]\tIETF RFC 9110: \"HTTP Semantics\".\n[5]\t3GPP TS 24.526: \"UE policies for 5G System (5GS); Stage 3\".\n[6]\tOMA-WAP-TS-PushOTA-V2_1-20110405-A: \"Push Over the Air\".\n[7]\tOMA-AD-Push-V2_2-20110809-A: \"Push Architecture\".\n[8]\tWAP-168-ServiceLoad-20010731-a: \"Service Loading\".\n[9]\t3GPP TS 29.555: \"Inter-5G Direct Discovery Name Management Function (DDNMF) signalling aspects; Stage 3\".\n[10]\t3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".\n[11]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[12]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[13]\t3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol Specification\".\n[14]\t3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile Station (MS) in idle mode\".\n[15]\t3GPP TS 38.304: \"User Equipment (UE) procedures in Idle mode and RRC Inactive state\".\n[16]\t3GPP TS 38.323: \"NR; Packet Data Convergence Protocol (PDCP) specification\".\n[17]\t3GPP TS 24.555: \"Proximity-services (ProSe) in 5G System (5GS); User Equipment (UE) policies; Stage 3\".\n[18]\t3GPP TS 24.587: \"Vehicle-to-Everything (V2X) services in 5G System (5GS); Protocol aspects; Stage 3\".\n[19]\t3GPP TS 29.557: \"5G System; Application Function ProSe Service; Stage 3\".\n[20]\t3GPP TS 24.007: \"Mobile radio interface signalling layer-3; General aspects\".\n[21]\t3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".\n[22]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[23]\tIETF RFC 2131: \"Dynamic Host Configuration Protocol\".\n[24]\tIETF RFC 4039: \"Rapid Commit Option for the Dynamic Host Configuration Protocol version 4 (DHCPv4)\".\n[25]\tIETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".\n[26]\t3GPP TS 24.502: \"Access to the 5G System (5GS) via non-3GPP access networks; Stage 3\".\n[27]\tITU-T Recommendation E.212: \"The international identification plan for mobile terminals and mobile users\".\n[28]\tISO/IEC 10118-3:2018: \"IT Security techniques – Hash-functions – Part 3: Dedicated hash-functions\".\n[29]\tW3C REC-xmlschema-2-20041028: \"XML Schema Part 2: Datatypes\".\n[30]\tIETF RFC 4122: \"A Universally Unique IDentifier (UUID) URN Namespace\".\n[31]\t3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core Network Protocols; Stage 3\".\n[32]\tIETF RFC 826: \"An Ethernet Address Resolution Protocol\".\n[33]\t3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System; Stage 2\".\n[34]\t3GPP TS 33.503: \"Security Aspects of Proximity based Services (ProSe) in the 5G System (5GS)\".\n[35]\t3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".\n[36]\t3GPP TS 33.303: \"Proximity-based Services (ProSe); Security aspects\".\n[37]\t3GPP TS 33.536: \"Security aspects of 3GPP support for advanced Vehicle-to-Everything (V2X) services\".\n[38]\tIETF RFC 3927: \"Dynamic Configuration of IPv4 Link-Local Addresses\".\n[39]\tIETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".\n[40]\tIETF RFC 20: \"ASCII format for Network Interchange\".\n[41]\tIETF RFC 4288: \"Media Type Specifications and Registration Procedures\".\n[42]\tIETF RFC 7303: \"XML Media Types\".\n[43]\tIETF RFC 7542: \"The Network Access Identifier\".\n[44]\t3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA) Push function\".\n[45]\t3GPP TS 32.277: \"Proximity-based Services (ProSe) charging\".\n[46]\t3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA)\".\n[47]\t3GPP TS 33.535: \"Authentication and Key Management for Applications (AKMA) based on 3GPP credentials in the 5G System (5GS)\".\n[48]\tIETF RFC 1166: \"Internet Numbers\".\n[49]\tIETF RFC 5952: \"A Recommendation for IPv6 Address Text Representation\".\n[50]\t3GPP TS 33.501: \"Security architecture and procedures for 5G system\".\n[51]\t3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".\n[52]\tIETF RFC 4555: \"IKEv2 Mobility and Multihoming Protocol (MOBIKE)\".\n[53]\tIETF RFC 1035: \"DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION\".\n[54]\t3GPP TS 23.041: \"Technical realization of Cell Broadcast Service (CBS)\".\n[55]\t3GPP TS 33.533: \"Security aspects of ranging based services and sidelink positioning\".\n[56]\t3GPP TS 24.514: \"Ranging based services and sidelink positioning in 5G system(5GS); Stage 3\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions of terms, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tTerms",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\n5G ProSe Direct Communication: A function that supports the communications between two or more UEs in proximity that are 5G ProSe-enabled, by means of user plane transmission using NR technology via a path not traversing any network node.\n5G ProSe Direct Discovery: A function employed by a 5G ProSe-enabled UE to discover other 5G ProSe-enabled UEs in its vicinity based on direct radio transmissions between the two UEs with NR technology.\n5G ProSe UE-to-network relay: A function employed by a 5G ProSe-enabled UE to support the communications between a 5G ProSe remote UE and DN.\n5G ProSe layer-2 UE-to-network relay: A function employed by a 5G ProSe-enabled UE to support the communications between a 5G ProSe layer-2 remote UE and DN.\n5G ProSe layer-3 UE-to-network relay: A function that supports the communications between a 5G ProSe layer-3 remote UE and DN.\n5G ProSe UE-to-UE relay: A function employed by a 5G ProSe-enabled UE to support the communications between two 5G ProSe end UEs.\n5G ProSe layer-2 UE-to-UE relay: A function employed by a 5G ProSe-enabled UE to support the communications between two 5G ProSe layer-2 end UEs.\n5G ProSe layer-3 UE-to-UE relay: A function that supports the communications between two 5G ProSe layer-3 end UEs.\n5G ProSe UE-to-network relay UE: A 5G ProSe-enabled UE that provides functionality to support connectivity to the network for 5G ProSe remote UE(s).\n5G ProSe layer-2 UE-to-network relay UE: A 5G ProSe-enabled UE that provides functionality to support connectivity to the network for 5G ProSe layer-2 remote UE(s) via layer-2 protocol.\n5G ProSe layer-3 UE-to-network relay UE: A 5G ProSe-enabled UE that provides functionality to support connectivity to the network for 5G ProSe layer-3 remote UE(s) via layer-3 protocol.\n5G ProSe UE-to-UE relay UE: A 5G ProSe-enabled UE that provides functionality to support connectivity between two 5G ProSe end UEs.\n5G ProSe layer-2 UE-to-UE relay UE: A 5G ProSe-enabled UE that provides functionality to support connectivity between two 5G ProSe layer-2 end UEs via layer-2 protocol.\n5G ProSe layer-3 UE-to-UE relay UE: A 5G ProSe-enabled UE that provides functionality to support connectivity between two 5G ProSe layer-2 end UEs via layer-3 protocol.\n5G ProSe layer-2 remote UE: A 5G ProSe-enabled UE that communicates with a DN via a 5G ProSe layer-2 UE-to-network relay UE.\n5G ProSe layer-3 remote UE: A 5G ProSe-enabled UE that communicates with a DN via a 5G ProSe layer-3 UE-to-network relay UE.\n5G ProSe layer-2 end UE: A 5G ProSe-enabled UE that communicates with another 5G ProSe-enabled UE via a 5G ProSe layer-2 UE-to-UE relay UE.\n5G ProSe layer-3 end UE: A 5G ProSe-enabled UE that communicates with another 5G ProSe-enabled UE via a 5G ProSe layer-3 UE-to-UE relay UE.\nOpen 5G ProSe direct discovery: A 5G ProSe direct discovery that takes place without explicit permission from the 5G ProSe-enabled UE being discovered.\nRestricted 5G ProSe direct discovery: A 5G ProSe direct discovery that only takes place with explicit permission from the 5G ProSe-enabled UE being discovered.\n5G DDNMF CTF (ADF): Accounting Data Forwarding (ADF) function block of the Charging Trigger Function (CTF) in the 5G DDNMF.\nUsage information report: Usage information related to one collection period.\nUsage information report list: One or more usage information report(s) associated with the UE identity of a 5G ProSe-enabled UE.\nFor the purposes of the present document, the following term and definition given in TS 23.304 [2] apply:\n5G ProSe-enabled UE\n5G ProSe remote UE\nApplication layer ID\nApplication layer group ID\nDestination layer-2 ID\nDirect network communication\nDiscovery entry ID\nDiscovery filter\nDiscovery query filter\nDiscovery response filter\nGeographical area\nIndirect network communication\nLocal PLMN\nMember ID\nMetadata index\nMetadata index mask\nModel A\nModel B\nMode of communication\nProSe application code\nProSe application mask\nProSe application ID\nProSe discovery UE ID\nProSe identifier\nProSe layer-2 group ID\nProSe query code\nProSe response code\nProSe restricted code\nProSe restricted code prefix\nProSe restricted code suffix\nRelay service code\nRestricted ProSe application user ID\nSource layer-2 ID\nNR Tx profile\nUser info ID\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\n5G DDNMF\t5G Direct Discovery Name Management Function\n5G PKMF\t5G ProSe Key Management Function\n5G ProSe\t5G Proximity-based Services\nAA\tAuthentication and Authorization\nAKMA\tAuthentication and Key Management for Applications\nCP-PRUK\tControl Plane ProSe Remote User Key\nCTF (ADF)\tCharging Trigger Function (Accounting Data Forwarding)\nDN\tData Network\nDNS\tDomain Name System\nDUCK\tDiscovery User Confidentility Key\nDUIK\tDiscovery User Integrity Key\nDUSK\tDiscovery User Scrambling Key\nFQDN\tFully Qualified Domain Name\nGBA\tGeneric Bootstrapping Architecture\nGFBR\tGuaranteed Flow Bit Rate\nGPI\tGBA Push Information\nLSB\tLeast Significant 8 Bits\nMSB\tMost Significant 8 Bits\nMFBR\tMaximum Flow Bit Rate\nMIC\tMessage Integrity Check\nMOBIKE \tIKEv2 Mobility and Multihoming Protocol\nNAI\tNetwork Access Identifier\nNCGI\tNG-RAN Cell Global ID\nPC5 LINK-AMBR\tPC5 Link Aggregated Bit Rate\nPDUID\tProSe Discovery UE ID\nPQI\tPC5 5QI\nProSeP\t5G ProSe Policy\nPSDK\tPublic Safety Discovery Key\nRPAUID\tRestricted ProSe Application User ID\nRQI\tReflective QoS Indication\nRSC\tRelay Service Code\nTTL\tTime-To-Live\nUP-PRUK\tUser Plane ProSe Remote User Key\nURSP\tUE Route Selection Policy\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tGeneral",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "5G Proximity-based Services (ProSe) are services that can be provided by the 3GPP system based on UEs being in proximity to each other. In this release of the document, the 3GPP system enablers for 5G ProSe include the following functions:\na)\t5G ProSe direct discovery;\nb)\t5G ProSe direct communication;\nc)\t5G ProSe UE-to-network relay; and\nd)\t5G ProSe UE-to-UE relay.\nThe above functions are applicable for both public safety UE and commercial UEs.\nThe security aspects for 5G ProSe features are specified in 3GPP TS 33.503 [34].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "5\tProvisioning of configuration information for 5G ProSe",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "5G ProSe configuration parameters are configured by the related procedures which allow configuration of necessary 5G ProSe configuration parameters to UE.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tConfiguration and precedence of 5G ProSe configuration information",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tGeneral",
                            "text_content": "UE's usage of 5G ProSe service is controlled by 5G ProSe configration information.\nThe 5G ProSe configuration information consist of the configuration parameters for 5G ProSe direct discovery, 5G ProSe direct communication, 5G ProSe UE-to-network relay, 5G ProSe UE-to-UE relay and 5G ProSe usage reporting.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tPrecedence of 5G ProSe configuration information",
                            "text_content": "The 5G ProSe configuration information for 5G ProSe direct discovery, 5G ProSe direct communication, 5G ProSe UE-to-network relay, 5G ProSe UE-to-UE relay and 5G ProSe usage reporting can be:\na)\tpre-configured in the ME;\nb)\tconfigured in the UICC;\nc)\tprovided as a ProSeP by PCF;\nd)\tprovided by a ProSe application server via PC1 reference point except:\n1)\tthe authorization policy for 5G ProSe direct discovery and restricted ProSe discovery UE ID for restricted direct discovery in parameters for 5G ProSe direct discovery;\n2)\tthe authorization policy in parameters for 5G ProSe direct communication;\n3)\tthe following parameters for the role of a 5G ProSe UE-to-network relay UE:\ni)\tauthorization policy for acting as a 5G ProSe layer-3 UE-to-network relay UE, 5G ProSe layer-2 UE-to-network relay UE or both, when \"served by NG-RAN\";\nii)\tQoS mapping rules for 5G ProSe layer-3 UE-to-network relay; and\niii)\ta mapping of ProSe identifier(s) to ProSe application server address information for 5G ProSe layer-3 UE-to-network relay UE to relay Ethernet or Unstructured traffic from remote UE by using IP type PDU session;\n4)\tthe following parameters for the role of a 5G ProSe remote UE:\ni)\tauthorization policy for using a 5G ProSe layer-3 UE-to-network relay UE, 5G ProSe layer-2 UE-to-network relay UE or both;\n5)\tthe following parameters for the role of a 5G ProSe UE-to-network relay UE as well as for the role of a 5G ProSe remote UE:\ni)\tradio parameters for 5G ProSe relay discovery when the UE is not \"served by NG-RAN\";\nii)\tradio parameters for 5G ProSe relay communication when the UE is not \"served by NG-RAN\"; and\niii)\tsecurity related content for 5G ProSe UE-to-network relay; or\n6)\tthe following parameters for the role of a 5G ProSe UE-to-UE relay UE:\ni)\tauthorization policy for acting as a 5G ProSe layer-3 UE-to-UE relay UE, or 5G ProSe layer-2 UE-to-UE relay UE or both; and\n7)\tthe following parameters for the role of a 5G ProSe end UE:\ni)\tauthorization policy for using a 5G ProSe layer-3 UE-to-UE relay UE, or 5G ProSe layer-2 UE-to-UE relay UE or both; or\ne)\ta combination of case a), b), c) or d) above.\nThe UE shall use the 5G ProSe configuration information in the following order of decreasing precedence:\na)\tthe 5G ProSe configuration information provided as a ProSeP by PCF;\nb)\tthe 5G ProSe configuration information provided by a ProSe application server via PC1 reference point;\nc)\tthe 5G ProSe configuration information configured in the UICC; and\nd)\tthe 5G ProSe configuration information pre-configured in the ME.\nNOTE:\tIt is not supported for the UE to request or receive any 5G ProSe configuration information from the PCF over the indirect network communication path, when the UE is working as a 5G ProSe remote UE using a 5G ProSe layer-3 UE-to-network relay without involving N3IWF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3\tConfiguration parameters for 5G ProSe direct discovery",
                            "text_content": "The configuration parameters for 5G ProSe direct discovery over PC5 reference point consist of:\na)\ta validity timer for the validity of the configuration parameter for 5G ProSe direct discovery over PC5 interface;\nb)\ta list of PLMNs in which the UE is authorised to perform open 5G ProSe direct discovery Model A monitoring when the UE is served by NG-RAN;\nc)\ta list of PLMNs in which the UE is authorized to perform open 5G ProSe direct discovery Model A announcing when the UE is served by NG-RAN;\nd)\ta list of PLMNs in which the UE is authorised to perform restricted 5G ProSe direct discovery Model A monitoring when the UE is served by NG-RAN;\ne)\ta list of PLMNs in which the UE is authorized to perform restricted 5G ProSe direct discovery Model A announcing when the UE is served by NG-RAN;\nf)\ta list of PLMNs in which the UE is authorized to perform restricted Model B discoverer operation when the UE is served by NG-RAN;\ng)\ta list of PLMNs in which the UE is authorized to perform restricted Model B discoveree operation when the UE is served by NG-RAN;\nh)\tan indication of whether the UE is authorized to perform 5G ProSe direct discovery for Model A or Model B when \"not served by NG-RAN\";\ni)\tradio parameters for ProSe direct discover per NR PC5 applicable per geographical area(s) with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when \"not served by NG-RAN\";\nNOTE 1:\tWhether a frequency band is \"operator managed\" or \"non-operator managed\" in a given geographical area is defined by local regulations.\nj)\ta 5G PDUID for restricted direct discovery;\nk)\ta list of group member discovery parameters that enable the group member discovery. For each group the list consists of, one application layer group ID, layer-2 group ID and user info ID;\nNOTE 2:\tUser info ID is expected to be assigned uniquely to a user within the discovery group.\nl)\ta list of ProSe identifiers to be used for direct discovery over PC5 interface;\nm)\ta list of ProSe identifiers to default destination layer-2 ID for initial discovery signalling mapping rule. Each mapping rule contains one or more ProSe identifiers and the default destination layer-2 ID for the initial signalling of direct discovery;\nNOTE 3:\tThe ProSe identifiers to default destination layer-2 ID for initial discovery signalling mapping rule can include a default configuration entry with the lowest priority for the ProSe services that do not have corresponding configurations in the mapping rule (see 3GPP TS 24.555 [17]).\nn)\tdefault PC5 DRX configuration as specified in TS 38.331 [13] when the UE is not served by NG-RAN; and\no)\toptionally, the 5G DDNMF address information in the HPLMN.\nNOTE 4:\tThe security parameters for 5G ProSe direct discovery are provisioned by 5G DDNMF as defined in clause 6.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.4\tConfiguration parameters for 5G ProSe direct communication over PC5 interface",
                            "text_content": "The configuration parameters for 5G ProSe direct communication over PC5 interface consist of:\na)\ta validity timer for the validity of the configuration parameters for 5G ProSe direct communication over PC5 interface;\nb)\ta list of PLMNs in which the UE is authorized to use 5G ProSe direct communication over PC5 interface when the UE is served by NG-RAN. Each entry of the list contains a PLMN ID in which the UE is authorized to use 5G ProSe direct communication over PC5 interface;\nc)\tan indication of whether the UE is authorized to use 5G ProSe direct communication over PC5 interface when the UE is not served by NG-RAN;\nd)\tthe radio parameters of the 5G ProSe direct communication over PC5 interface applicable per geographical area with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when the UE is not served by NG-RAN;\ne)\tconfiguration parameters for groupcast mode 5G ProSe direct communication for each application layer group, consisting of:\n1)\tapplication layer group ID;\n2)\tProSe layer-2 group identifier;\n3)\tProSe group IP multicast address;\n4)\tan indication of whether the UE is authorized to use IPv4 or IPv6; and\n5)\toptionally, an IPv4 address to be used by the UE as a source address for a specific group if the UE is authorized to use IPv4;\nf)\tconfiguration parameters for privacy support, consisting of:\n1)\ta list of ProSe applications requiring privacy. Each entry of the list contains one or more ProSe identifiers and one or more geographical areas where the privacy is required; and\n2)\ta privacy timer value as specified in 3GPP TS 24.555 [17];\ng)\toptionally, a list of ProSe identifier to ProSe NR frequency mapping rules. Each mapping rule contains one or more ProSe identifiers and the ProSe NR frequencies with associated geographical areas;\nh)\ta list of ProSe identifier to destination layer-2 ID for broadcast mapping rules. Each mapping rule contains one or more ProSe identifiers and the destination layer-2 ID for broadcast;\ni)\ta list of ProSe identifier to destination layer-2 ID for groupcast mapping rules. Each mapping rule contains one or more ProSe identifiers and the destination layer-2 ID for groupcast;\nj)\ta list of ProSe identifier to default destination layer-2 ID for unicast initial signalling mapping rules. Each mapping rule contains one or more ProSe identifiers and the default destination layer-2 ID for initial signalling to establish unicast connection;\nk)\ta list of ProSe identifier to PC5 QoS parameters mapping rules. The PC5 QoS parameters are specified in clause 5.7 of 3GPP TS 23.304 [2];\nl)\tan AS configuration, including a list of SLRB mapping rules applicable when the UE is not served by NG-RAN. Each SLRB mapping rule contains a PC5 QoS profile and an SLRB. The PC5 QoS profile contains the following parameters:\n1)\tthe PC5 QoS profile containing a PQI;\n2)\tif the PQI of the PC5 QoS profile identifies a GBR QoS, the PC5 QoS profile containing a PC5 flow bit rates consisting of a guaranteed flow bit rate (GFBR) and a maximum flow bit rate (MFBR);\n3)\tif the PQI of the PC5 QoS profile identifies a non-GBR QoS, the PC5 QoS profile containing the PC5 link aggregated bit rate consisting of a per link aggregate maximum bit rate (PC5 LINK-AMBR);\nNOTE 1:\tPC5 link aggregated bit rate is only used for unicast mode communications over PC5 interface.\n4)\tthe PC5 QoS profile containing a range, which is only used for groupcast mode communications over PC5 interface; and\n5)\tthe PC5 QoS profile optionally containing the priority level, the averaging window and the maximum data burst volume. If one or more of the priority levels, the averaging window or the maximum data burst volume are not contained in the PC5 QoS profile, their default values apply;\nm)\ta list of 5G ProSe direct link security policies. Each entry in the list contains a 5G ProSe direct link security policy composed of:\n1)\tone or more ProSe identifiers;\n2)\tthe signalling integrity protection policy for the ProSe identifier(s);\n3)\tthe signalling ciphering policy for the ProSe identifier(s);\n4)\tthe user plane integrity protection policy for the ProSe identifier(s);\n5)\tthe user plane ciphering policy for the ProSe identifier(s); and\n6)\tone or more geographical areas where the 5G ProSe direct link security policy applies;\nn)\ta list of ProSe identifiers to default mode of communication mapping rules. Each mapping rule contains one or more ProSe identifiers and the default mode of communication (one of unicast, groupcast or broadcast);\no)\ta list of ProSe application to path preference mapping rules (i.e., PC5 preferred, Uu preferred, or no preference) as defined in clause 5.4 in 3GPP TS 24.555 [17]. The list of ProSe application to path preference mapping rules are in prioritized order according to the local configuration of the network;\np)\ta list of ProSe identifiers to NR Tx profiles for broadcast and groupcast mapping rules. Each mapping rule contains one or more ProSe identifiers and the NR Tx profile for broadcast and groupcast as specified in 3GPP TS 38.300 [21] and 3GPP TS 38.331 [13]; and\nq)\tthe PC5 DRX configuration for broadcast, groupcast and initial signalling of 5G ProSe direct link establishment, as specified in 3GPP TS 38.331 [13], including the mapping of PC5 QoS profile(s) to PC5 DRX cycle(s) and the default PC5 DRX configuration when the UE is not served by NG-RAN.\nNOTE 2:\tIn this release of specification, the application ID defined in 3GPP TS 23.303 [35] can be used as the ProSe identifier in 5G ProSe direct discovery and in a consequent 5G ProSe direct communication.\nNOTE 3:\tEach mapping rule above can include a default configuration entry with the lowest priority for the ProSe services that do not have corresponding configurations in the mapping rules (see 3GPP TS 24.555 [17]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.5\tConfiguration parameters for 5G ProSe UE-to-network relay",
                            "text_content": "The configuration parameters for the role of a ProSe UE-to-network relay UE over PC5 reference point consist of:\na)\ta validity timer for the validity of the configuration parameter for 5G ProSe UE-to-network relay over PC5 interface;\nb)\ta list of PLMNs in which the UE is authorised to relay traffic for 5G ProSe layer-3 remote UEs when the UE is served by NG-RAN and in each PLMN, where that authorization also authorizes the use of both 5G ProSe UE-to-network relay discovery Model A and 5G ProSe UE-to-network relay discovery Model B;\nc)\ta list of PLMNs in which the UE is authorised to relay traffic for 5G ProSe layer-2 remote UEs when the UE is served by NG-RAN and in each PLMN, where that authorization also authorizes the use of both 5G ProSe UE-to-network relay discovery Model A and 5G ProSe UE-to-network relay discovery Model B;\nd)\tthe default destination layer-2 ID(s) for sending the discovery signalling for announcement and additional information and for receiving the discovery signalling for solicitation;\nNOTE 1:\tWhich default destination layer-2 ID is selected is up to UE implementation when there are more than one default destination layer-2 ID.\ne)\ta User info ID for the UE-to-network relay discovery;\nf)\tone or more relay service code(s) for the UE-to-network relay discovery for normal services, one or more relay service code(s) for the UE-to-network relay discovery for emergency services or both, and for each relay service code:\n1)\tsecurity related content for 5G ProSe relay discovery that is used when the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, including a validity timer for that security related content;\n2)\tan indication of whether the relay service code is offering 5G ProSe layer-2 or layer-3 UE-to-network relay service;\n3)\tfor 5G ProSe layer-3 UE-to-network relay UE, a set of PDU session parameters:\ni)\tPDU session type;\nii)\tDNN, if the 5G ProSe UE-to-network relay communication is not for emergency services;\niii)\toptionally, SSC mode;\niv)\toptionally, S-NSSAI; and\nv)\toptionally, access type preference;\n4)\tfor 5G ProSe layer-2 UE-to-network relay UE and 5G ProSe layer-3 UE-to-network relay UE, security policies for 5G ProSe UE-to-network relay direct communication:\ni)\tthe signalling integrity protection policy;\nii)\tthe signalling ciphering policy;\niii)\tthe user plane integrity protection policy; and\niv)\tthe user plane ciphering policy; and\n5)\tfor 5G ProSe layer-2 UE-to-network relay UE and 5G ProSe layer-3 UE-to-network relay UE, a control plane security indication to indicate whether to use the security procedure over control plane as specified in 3GPP TS 33.503 [34]. If the control plane security indication indicates not to use the security procedure over control plane, the 5G ProSe UE-to-network relay UE uses the security procedure over user plane as specified in 3GPP TS 33.503 [34];\nNOTE 2:\tIf the control plane security indication indicates to use the security procedure over control plane and the 5G ProSe UE-to-network relay UE doesn't support the security procedure over control plane, the 5G ProSe UE-to-network relay UE doesn't use that relay service code.\ng)\tfor 5G ProSe layer-3 UE-to-network relay UE, QoS mapping rules including:\n1)\ta mapping between a 5QI value and a 5G ProSe PQI value over PC5 for traffic relayed over the PC5 interface;\n2)\ta PDB adjustment factor of the standardized PDB identified by the PQI; and\n3)\toptionally, the relay service code(s) associated with the QoS mapping rule;\nh)\tthe radio parameters of the 5G ProSe UE-to-network relay discovery applicable per geographical area with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when the UE is not served by NG-RAN;\ni)\tfor 5G ProSe layer-3 UE-to-network relay UE, for Ethernet and Unstructured traffic using IP type PDU session, a list of ProSe identifier(s) to ProSe application server address mapping rule. Each mapping rule contains one or more ProSe identifier(s) and IP address/FQDN and transport layer port number;\nj)\tthe radio parameters of the 5G ProSe direct communication applicable per geographical area with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when the UE is not served by NG-RAN;\nk)\toptionally, the 5G PKMF address information;\nl)\tfor 5G ProSe UE-to-network relay UE, the default PC5 DRX configuration for discovery as specified in 3GPP TS 38.331 [13] when the UE is not served by NG-RAN;\nm)\tthe privacy timer value for changing the source layer-2 ID assigned by the 5G ProSe UE-to-network relay UE for direct communication, as specified in 3GPP TS 24.555 [17].\nn)\tthe default destination layer-2 ID for broadcasting warning messages;\no)\tthe PC5 QoS parameters for broadcasting warning messages. The PC5 QoS parameters are specified in clause 5.6.1 of 3GPP TS 23.304 [2]; and\np)\tthe NR Tx profile for broadcasting warning messages. The NR Tx profile is specified in 3GPP TS 38.300 [21] and 3GPP TS 38.331 [13].\nThe configuration parameters for the role of a 5G ProSe remote UE consist of:\na)\ta validity timer for the validity of the configuration parameters for 5G ProSe remote UE;\nb)\tan indication whether the UE is authorized to use a 5G ProSe layer-3 UE-to-network relay UE, where that authorization also authorizes the use of both 5G ProSe UE-to-network relay discovery Model A and 5G ProSe UE-to-network relay discovery Model B;\nc)\ta list of PLMNs in which the UE is authorized to use a 5G ProSe layer-2 UE-to-network relay UE, where that authorization also authorizes the use of both 5G ProSe UE-to-network relay discovery Model A and 5G ProSe UE-to-network relay discovery Model B;\nd)\tdefault destination layer-2 ID(s) for sending the discovery signalling for solicitation and for receiving the discovery signalling for announcement and additional information;\nNOTE 3:\tWhich default destination layer-2 ID is selected is up to UE implementation when there are more than one default destination layer-2 ID.\ne)\ta user info ID for the UE-to-network relay discovery;\nf)\tone or more relay service code(s) for the UE-to-network relay discovery for normal services, one or more relay service code(s) for the UE-to-network relay discovery for emergency services or both, and for each relay service code:\n1)\tsecurity related content for 5G ProSe UE-to-network relay discovery that is used when the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, including a validity timer for that security related content;\n2)\tan indication of whether the relay service code is offering 5G ProSe layer-2 or layer-3 UE-to-network relay service;\n3)\tfor 5G ProSe remote UE using 5G ProSe layer-3 UE-to-network relay, one of the following:\ni)\ta set of PDU session parameters for the relayed traffic without using N3IWF access:\nA)\tPDU session type;\nB)\tDNN, if the 5G ProSe UE-to-network relay communication is not for emergency services;\nC)\toptionally, SSC mode;\nD)\toptionally, S-NSSAI; and\nE)\toptionally, access type preference; or\nii)\tan indication of using N3IWF access for the relayed traffic;\n4)\tfor 5G ProSe remote UE using 5G ProSe layer-2 UE-to-network relays or 5G ProSe layer-3 UE-to-network relay, security policies for 5G ProSe UE-to-network relay direct communication:\ni)\tthe signalling integrity protection policy;\nii)\tthe signalling ciphering policy;\niii)\tthe user plane integrity protection policy; and\niv)\tthe user plane ciphering policy;\n5)\toptionally, for 5G ProSe remote UE using 5G ProSe layer-3 UE-to-network relay, the ProSe application traffic descriptor(s) (as defined in 3GPP TS 24.526 [5]) to be used for the relayed traffic; and\n6)\tfor 5G ProSe remote UE using 5G ProSe layer-2 UE-to-network relay or 5G ProSe layer-3 UE-to-network relay, a control plane security indication to indicatewhether to use the security procedure over control plane as specified in 3GPP TS 33.503 [34]. If the control plane security indication indicates not to use the security procedure over control plane, the 5G ProSe remote UE uses the security procedure over user plane as specified in 3GPP TS 33.503 [34];\nNOTE 4:\tIf the control plane security indication indicates to use the security procedure over control plane and the 5G ProSe remote UE doesn't support the security procedure over control plane, the 5G remote UE doesn't use the corresponding relay service code.\ng)\tthe radio parameters of the 5G ProSe UE-to-network relay discovery applicable per geographical area with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when the UE is not served by NG-RAN;\nh)\tthe radio parameters of the 5G ProSe direct communication applicable per geographical area with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when the UE is not served by NG-RAN;\nNOTE 5:\tWhether a frequency band is \"operator managed\" or \"non-operator managed\" in a given Geographical Area is defined by local regulations.\ni)\tif at least one relay service code is configured with the indication of using N3IWF access for the relayed traffic, the N3IWF selection information for 5G ProSe layer-3 remote UE:\n1)\tN3IWF identifier configuration (either FQDN or IP address); and\n2)\t5G ProSe layer-3 UE-to-network relays, access node selection information, which consists of a prioritized list of PLMNs for N3IWF selection and an indication that the selection of an N3IWF in a PLMN should be based on Tracking Area Identity FQDN or on Operator Identifier FQDN;\nj)\toptionally, the 5G PKMF address information;\nk)\tfor 5G ProSe remote UE, the default PC5 DRX configuration for discovery as specified in 3GPP TS 38.331 [13] when the UE is not served by NG-RAN;\nl)\tthe privacy timer value for changing the source layer-2 ID assigned by the 5G ProSe remote UE for direct communication, as specified in 3GPP TS 24.555 [17].\nn)\tthe default destination layer-2 ID for receiving warning messages;\no)\tthe PC5 QoS parameters for receiving warning messages. The PC5 QoS parameters are specified in clause 5.6.1 of 3GPP TS 23.304 [2]; and\np)\tthe NR Tx profile for broadcasting warning messages. The NR Tx profile is specified in 3GPP TS 38.300 [21] and 3GPP TS 38.331 [13].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.6\tConfiguration parameters for 5G ProSe usage information reporting",
                            "text_content": "The configuration parameters for 5G ProSe usage information reporting consist of:\na)\ta validity timer for the validity of the configuration parameters for 5G ProSe usage information reporting;\nb)\tthe 5G DDNMF CTF (ADF) address information to which the UE uploads the usage information reports;\nc)\tthe collection period;\nd)\tthe reporting window;\ne)\tfor broadcast and groupcast mode 5G ProSe direct communication, whether or not the UE reports the group parameters in the usage information;\nf)\twhether or not the UE reports the time stamps of the first transmission/reception during the collection period in the usage information;\ng)\twhether or not the UE reports the amount of data transmitted during the collection period in the usage information, and whether with location information;\nh)\twhether or not the UE reports the amount of data received during the collection period in the usage information, and whether with location information;\ni)\twhether or not the UE reports the time stamps when it went in and out of NG-RAN coverage during the collection period in the usage information;\nj)\twhether or not the UE reports the list of locations of the UE when in NG-RAN coverage during the reporting period in the usage information;\nk)\twhether or not the UE reports the radio parameters used for 5G ProSe direct communication (i.e. indicator of which radio resources used and radio frequency used) during the reporting period in the usage information; and\nl)\twhether or not the UE reports the QoS flow information (i.e. PC5 QoS flow identifier, PC5 QoS flow descriptions) during the reporting period in the usage information.\n5.2.7\tConfiguration parameters for 5G ProSe UE-to-UE relay\nThe configuration parameters for the role of a 5G ProSe UE-to-UE relay UE over PC5 reference point consist of:\na)\ta validity timer for the validity of the configuration parameter for 5G ProSe UE-to-UE relay over PC5 interface;\nb)\ta list of PLMNs in which the UE is authorised to relay traffic for 5G ProSe layer-3 end UEs when the UE is served by NG-RAN and in each PLMN, where that authorization also authorizes the use of both 5G ProSe UE-to-UE relay discovery Model A and 5G ProSe UE-to-UE relay discovery Model B;\nba)\tan indication whether the UE is authorized to relay traffic for 5G ProSe layer-3 end UEs when the UE is not served by NG-RAN, where that authorization also authorizes the use of both 5G ProSe UE-to-UE relay discovery Model A and 5G ProSe UE-to-UE relay discovery Model B;\nc)\ta list of PLMNs in which the UE is authorised to relay traffic for 5G ProSe layer-2 end UEs when the UE is served by NG-RAN and in each PLMN, where that authorization also authorizes the use of both 5G ProSe UE-to-UE relay discovery Model A and 5G ProSe UE-to-UE relay discovery Model B;\nca)\tan indication whether the UE is authorized to relay traffic for 5G ProSe layer-2 end UEs when the UE is not served by NG-RAN, where that authorization also authorizes the use of both 5G ProSe UE-to-UE relay discovery Model A and 5G ProSe UE-to-UE relay discovery Model B;\nd)\tthe default destination layer-2 ID(s) for sending the discovery signalling for announcement, for receiving the discovery signalling for solicitation and for sending discovery signalling for solicitation;\nda)\tthe default destination layer-2 ID(s) for sending or receiving the direct communication signalling to establish unicast connection for 5G ProSe UE-to-UE relay communication with integrated discovery;\nNOTE 1:\tWhich default destination layer-2 ID is selected is up to UE implementation when there are more than one default destination layer-2 ID.\ne)\ta User info ID for 5G ProSe UE-to-UE relay discovery;\nf)\tone or more relay service code(s) for 5G ProSe UE-to-UE relay discovery and for each relay service code:\n1)\tOptionally, security related content for 5G ProSe UE-to-UE relay discovery. The security related content for 5G ProSe UE-to-UE relay discovery applies only when the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, including a validity timer for that security related content;\n2)\tan indication of whether the relay service code is offering 5G ProSe layer-2 or layer-3 UE-to-UE relay service;\n3)\tfor 5G ProSe layer-3 UE-to-UE relay, the traffic type of the relayed service (i.e. IP, Ethernet or Unstructured);\n4)\tsecurity policies for 5G ProSe UE-to-UE relay direct communication:\ni)\tthe signalling integrity protection policy;\nii)\tthe signalling ciphering policy;\niii)\tthe user plane integrity protection policy; and\niv)\tthe user plane ciphering policy;\n5)\ta network assistance security indication to indicate whether to use the security procedure with network assistance or the security procedure without network assistance as specified in clause 6.6.3.3 of 3GPP TS 33.503 [34]; and\n6)\ta control plane security indication to indicate whether to use the security procedure over control plane as specified in 3GPP TS 33.503 [34], if the security procedure with network assistance is to be used. If the control plane security indication indicates not to use the security procedure over control plane, the 5G ProSe UE-to-UE relay UE uses the security procedure over user plane as specified in 3GPP TS 33.503 [34].\nNOTE 2:\tIf the control plane security indication indicates to use the security procedure over control plane and the 5G ProSe UE-to-UE relay UE doesn't support the security procedure over control plane, the 5G ProSe UE-to-UE relay UE doesn't use that relay service code.\ng)\tthe radio parameters of 5G ProSe UE-to-UE relay discovery applicable per geographical area with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when the UE is not served by NG-RAN;\nNOTE 3:\tThe radio parameters of 5G ProSe UE-to-UE relay discovery when the UE is not served by NG-RAN and the radio parameters of 5G ProSe direct discovery when the UE is not served by NG-RAN as defined in clause 5.2.3 are expected to be the same.\nh)\tthe radio parameters of 5G ProSe UE-to-UE relay communication applicable per geographical area with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when the UE is not served by NG-RAN;\nNOTE 4:\tThe radio parameters of 5G ProSe UE-to-UE relay communication when the UE is not served by NG-RAN and the radio parameters of 5G ProSe direct communication when the UE is not served by NG-RAN as defined in clause 5.2.4 are expected to be the same.\ni)\t the default PC5 DRX configuration for discovery as specified in 3GPP TS 38.331 [13] when the UE is not served by NG-RAN; and\nj)\toptionally, the 5G PKMF address information.\nThe configuration parameters for the role of a 5G ProSe end UE consist of:\na)\ta validity timer for the validity of the configuration parameters for 5G ProSe end UE;\nb)\tan indication whether the UE is authorized to use a 5G ProSe layer-3 UE-to-UE relay UE when the UE is not served by NG-RAN, where that authorization also authorizes the use of both 5G ProSe UE-to-UE relay discovery Model A and 5G ProSe UE-to-UE relay discovery Model B;\nba)\ta list of PLMNs in which the UE is authorised to use a 5G ProSe layer-3 UE-to-UE relay UE when the UE is served by NG-RAN and in each PLMN, where that authorization also authorizes the use of both 5G ProSe UE-to-UE relay discovery Model A and 5G ProSe UE-to-UE relay discovery Model B;\nc)\tan indication whether the UE is authorized to use a 5G ProSe layer-2 UE-to-UE relay UE when the UE is not served by NG-RAN and the authorization also authorizes the use of both 5G ProSe UE-to-UE relay discovery Model A and 5G ProSe UE-to-UE relay discovery Model B;\nca)\ta list of PLMNs in which the UE is authorised to use a 5G ProSe layer-2 UE-to-UE relay UE when the UE is served by NG-RAN and in each PLMN, where that authorization also authorizes the use of both 5G ProSe UE-to-UE relay discovery Model A and 5G ProSe UE-to-UE relay discovery Model B;\nd)\tthe default destination layer-2 ID(s) for sending the discovery signalling for solicitation and for receiving the discovery signalling for announcement and for receiving the discovery signalling for solicitation;\nda)\tthe default destination layer-2 ID(s) for sending or receiving the direct communication signalling to establish unicast connection for 5G ProSe UE-to-UE relay communication with integrated discovery;\nNOTE 5:\tWhich default destination layer-2 ID is selected is up to UE implementation when there are more than one default destination layer-2 ID.\ne)\ta user info ID for 5G ProSe UE-to-UE relay discovery;\nf)\tone or more relay service code(s) for 5G ProSe UE-to-UE relay discovery and for each relay service code:\n1)\tOptionally, security related content for 5G ProSe UE-to-UE relay discovery. The security related content for 5G ProSe UE-to-UE relay discovery applies only when the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, including a validity timer for that security related content;\n2)\tan indication of whether the relay service code is offering 5G ProSe layer-2 or layer-3 UE-to-UE relay service;\n3)\tfor 5G ProSe layer-3 UE-to-UE relay, the traffic type of the relayed service (i.e. IP, Ethernet or Unstructured);\n4)\tsecurity policies for 5G ProSe UE-to-UE relay direct communication:\ni)\tthe signalling integrity protection policy;\nii)\tthe signalling ciphering policy;\niii)\tthe user plane integrity protection policy; and\niv)\tthe user plane ciphering policy;\n5)\ta network assistance security indication to indicate whether to use the security procedure with network assistance or the security procedure without network assistance as specified in clause 6.6.3.3 of 3GPP TS 33.503 [34]; and\n6)\ta control plane security indication to indicate whether to use the security procedure over control plane as specified in 3GPP TS 33.503 [34], if the security procedure with network assistance is to be used. If the control plane security indication indicates not to use the security procedure over control plane, the 5G ProSe end UE uses the security procedure over user plane as specified in 3GPP TS 33.503 [34];\nNOTE 6:\tIf the control plane security indication indicates to use the security procedure over control plane and the 5G ProSe end UE doesn't support the security procedure over control plane, the 5G end UE doesn't use the corresponding relay service code.\ng)\tthe radio parameters of 5G ProSe UE-to-UE relay discovery applicable per geographical area with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when the UE is not served by NG-RAN;\nNOTE 8:\tThe radio parameters of 5G ProSe UE-to-UE relay discovery when the UE is not served by NG-RAN and the radio parameters of 5G ProSe direct discovery when the UE is not served by NG-RAN as defined in clause 5.2.3 are expected to be the same.\nh)\tthe radio parameters of 5G ProSe UE-to-UE relay communication applicable per geographical area with an indication of whether these radio parameters are \"operator managed\" or \"non-operator managed\" when the UE is not served by NG-RAN;\nNOTE 9:\tThe radio parameters of 5G ProSe UE-to-UE relay communication when the UE is not served by NG-RAN and the radio parameters of 5G ProSe direct communication when the UE is not served by NG-RAN as defined in clause 5.2.4 are expected to be the same.\ni)\tthe default PC5 DRX configuration for discovery as specified in 3GPP TS 38.331 [13] when the UE is not served by NG-RAN; and\nj)\toptionally, the 5G PKMF address information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3\tProcedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tGeneral",
                            "text_content": "The procedure for provisioning of parameters for 5G ProSe allows the UE to obtain 5G ProSe policy (ProSeP).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.2\tUE-requested ProSeP provisioning procedure",
                            "text_content": "The UE-requested ProSeP policy provisioning procedure enables the UE to request ProSeP from the PCF in the following cases:\na)\tif the T5051 for a UE policies for 5G ProSe direct discovery expires;\nb)\tif the T5052 for a UE policies for 5G ProSe direct communications expires;\nc)\tif the T5053 for a UE policies for 5G ProSe UE-to-network relay UE expires;\nd)\tif the T5054 for UE policies for 5G ProSe remote UE expires;\ne)\tif the T5057 for UE policies for 5G ProSe usage information reporting expires;\nf)\tif the T5058 for a UE policies for 5G ProSe UE-to-UE relay UE expires;\ng)\tif the T5059 for a UE policies for 5G ProSe end UE expires; and\nh)\tif there are no valid configuration parameters, e.g., for the current area, or due to abnormal situation.\nThe UE shall follow the principles of PTI handling for UE policy delivery service procedures defined in 3GPP TS 24.501 [11] clause D.1.2.\nIn order to initiate the UE-requested ProSeP policy provisioning procedure, the UE shall create a UE POLICY PROVISIONING REQUEST message (see example in figure 5.3.2.2.1). The UE:\na)\tshall allocate a PTI value currently not used and set the PTI IE to the allocated PTI value;\nb)\tshall include the Requested UE policies IE indicating whether the UE policies for 5G ProSe direct discovery, the UE policies for 5G ProSe direct communications, the UE policies for 5G ProSe UE-to-network relay, the UE policies for 5G ProSe remote UE, the UE policies for 5G ProSe usage information reporting, the UE policies for 5G ProSe UE-to-UE relay, the UE policies for 5G ProSe end UE, or any combination of them are requested;\nc)\tshall transport the UE POLICY PROVISIONING REQUEST message using the NAS transport procedure as specified in 3GPP TS 24.501 [11] clause 5.4.5; and\nd)\tshall start timer T5040.\n\n\nFigure 5.3.2.2.1: UE-requested ProSeP policy provisioning procedure\nHandling in 3GPP TS 24.587 [18] clause 5.3.2.3 shall apply.\nIf new UE policies for 5G ProSe direct discovery are included in the MANAGE UE POLICY COMMAND message, the UE shall stop timer T5051 if it is running and start timer T5051 with the value included in the UE policies for 5G ProSe direct discovery and start using the new UE policies for 5G ProSe direct discovery included in the MANAGE UE POLICY COMMAND message.\nIf new UE policies for 5G ProSe direct communications are included in the MANAGE UE POLICY COMMAND message, the UE shall stop timer T5052 if it is running and start timer T5052 with the value included in the UE policies for 5G ProSe direct communications and start using the new UE policies for 5G ProSe direct communications included in the MANAGE UE POLICY COMMAND message.\nIf new UE policies for 5G ProSe UE-to-network relay UE are included in the MANAGE UE POLICY COMMAND message, the UE shall stop timer T5053 if it is running and start timer T5053 with the value included in the UE policies for 5G ProSe UE-to-network relay UE and start using the new UE policies for 5G ProSe UE-to-network relay UE included in the MANAGE UE POLICY COMMAND message. If the security related parameters for discovery are included in the new UE policies for 5G ProSe UE-to-network relay UE in the MANAGE UE POLICY COMMAND message and the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, the UE shall stop timer T5055 if it is running and start timer T5055 with the value included in the security related parameters for discovery, and start using the security related parameters for discovery included in the new UE policies for 5G ProSe UE-to-network relay UE.\nIf new UE policies for 5G ProSe remote UE are included in the MANAGE UE POLICY COMMAND message, the UE shall stop timer T5054 if it is running and start timer T5054 with the value included in the UE policies for 5G ProSe remote UE and start using the new UE policies for 5G ProSe remote UE included in the MANAGE UE POLICY COMMAND message. If the security related parameters for discovery are included in the new UE policies for 5G ProSe remote UE in the MANAGE UE POLICY COMMAND message and the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, the UE shall stop timer T5056 if it is running and start timer T5056 with the value included in the security related parameters for discovery, and start using the security related parameters for discovery included in the new UE policies for 5G ProSe remote UE.\nIf new UE policies for 5G ProSe usage information reporting are included in the MANAGE UE POLICY COMMAND message, the UE shall stop timer T5057 if it is running and start timer T5057 with the value included in the UE policies for 5G ProSe usage information reporting, and start using the UE policies for 5G ProSe usage information reporting included in the MANAGE UE POLICY COMMAND message.\nIf new UE policies for 5G ProSe UE-to-UE relay UE are included in the MANAGE UE POLICY COMMAND message, the UE shall stop timer T5058 if it is running and start timer T5058 with the value included in the UE policies for 5G ProSe UE-to-UE relay UE and start using the new UE policies for 5G ProSe UE-to-UE relay UE included in the MANAGE UE POLICY COMMAND message. . If the security related parameters for discovery are included in the new UE policies for 5G ProSe UE-to-UE relay UE in the MANAGE UE POLICY COMMAND message and the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, the UE shall stop timer T50xx if it is running and start timer T50xx with the value included in the security related parameters for discovery, and start using the security related parameters for discovery included in the new UE policies for 5G ProSe UE-to-UE relay UE.\nIf new UE policies for 5G ProSe end UE are included in the MANAGE UE POLICY COMMAND message, the UE shall stop timer T5059 if it is running and start timer T5059 with the value included in the UE policies for 5G ProSe end UE and start using the new UE policies for 5G ProSe end UE included in the MANAGE UE POLICY COMMAND message. If the security related parameters for discovery are included in the new UE policies for 5G ProSe end UE in the MANAGE UE POLICY COMMAND message and the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, the UE shall stop timer T50yy if it is running and start timer T50yy with the value included in the security related parameters for discovery, and start using the security related parameters for discovery included in the new UE policies for 5G ProSe end UE.\nHandling in 3GPP TS 24.587 [18] clause 5.3.2.4 shall apply.\nHandling in 3GPP TS 24.587 [18] clause 5.3.2.5 shall apply.\nHandling in 3GPP TS 24.587 [18] clause 5.3.2.6 shall apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\t5G ProSe direct discovery",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tTransport protocol for PC3a control protocol messages for 5G ProSe direct discovery",
                            "text_content": "The UE and 5G DDNMF shall use HTTP/1.1 as specified in IETF RFC 9112 [3] and IETF RFC 9110 [4] as the transport protocol for 5G ProSe messages over the PC3a interface. The 5G ProSe messages described here shall be included in the body of either an HTTP request message or an HTTP response message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.2\tHandling of UE-initiated procedures",
                            "text_content": "The following rules apply for UE-initiated procedures:\na)\tthe UE initiates 5G ProSe transactions with an HTTP request message containing the PC3a request(s);\nb)\tthe 5G DDNMF responds to the requests with an HTTP response message containing the PC3a response(s) for the PC3a request(s); and\nc)\tHTTP POST methods are used for PC3a direct discovery procedures.\nThe UE may use UE local configuration or URSP, as defined in 3GPP TS 24.526 [5], to establish a PDU session for reaching the HPLMN 5G DDNMF:\na)\tif a PDU session for reaching the HPLMN 5G DDNMF is not established yet, the UE shall establish the PDU session for reaching the HPLMN 5G DDNMF and shall send the HTTP request message via the PDU session for reaching the HPLMN 5G DDNMF; and\nb)\tif a PDU session for reaching the HPLMN 5G DDNMF is already established (e.g., either due to other 5G ProSe feature or due to other application), the UE shall send the HTTP request message via the PDU session for reaching the HPLMN 5G DDNMF.\nThe IP address or the FQDN of the 5G DDNMF in the HPLMN may be pre-configured in the UE. The FQDN of the 5G DDNMF in the HPLMN may also be self-constructed by the UE, i.e. derived from the PLMN ID of the HPLMN. The FQDN of the 5G DDNMF in the HPLMN may also be provisioned by the PCF as described in clause 5.2.3. The UE may use the pre-configured IP address or the FQDN of the 5G DDNMF in the HPLMN to discover the 5G DDNMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.3\tHandling of 5G DDNMF-initiated procedures",
                            "text_content": "The 5G DDNMF address information (i.e. either IP address or FQDN) in the HPLMN may be pre-configured in the UE. The 5G DDNMF address information (i.e. either IP address or FQDN) in the HPLMN may also be provisioned by the PCF as described in clause 5.2.3. The UE may use the IP address or the FQDN of the 5G DDNMF in the HPLMN to discover the 5G DDNMF.\nIf the UE has neither the pre-configured 5G DDNMF address information in the HPLMN nor the 5G DDNMF address information in the HPLMN provisioned by the PCF, the UE may self-construct the FQDN of the 5G DDNMF in the HPLMN (e.g. deriving the FQDN from the PLMN ID of the HPLMN).\nIf the UE supports the HTTP long polling, the UE shall include a Network-Initiated Transaction Method set to \"HTTP long polling\" in the DISCOVERY_REQUEST message to the 5G DDNMF.\nUpon receiving a DISCOVERY_REQUEST message containing a Network-Initiated Transaction Method set to \"HTTP long polling\", if the 5G DDNMF supports the HTTP long polling, the 5G DDNMF shall include a Network-Initiated Transaction Method set to \"HTTP long polling\" in the DISCOVERY_RESPONSE message.\nIf the UE receives a DISCOVERY_RESPONSE message including a Network-Initiated Transaction Method set to \"HTTP long polling\", the UE shall use the HTTP long polling for network initiated procedures. Otherwise, the UE shall assume that the 5G DDNMF uses OMA Push for network initiated procedures.\nThe HTTP long polling method is described by the following steps:\na)\tthe UE sends an empty HTTP request message as a polling request when it expects network initiated message(s) over the PC3a interface;\nb)\tthe 5G DDNMF defers its response to the UE's request until;\n1)\tone or more network-initiated PC3a message(s) for the UE are available. The 5G DDNMF encloses the message(s) in an HTTP response message and send it to the UE; or\n2)\ta particular timeout for HTTP polling has occurred. The 5G DDNMF then sends an empty HTTP response message as the polling response to the UE; and\nc)\tafter receiving the response from the 5G DDNMF, the UE may keep polling after some waiting period if:\n1)\tthe UE receives an empty polling response; or\n2)\tthe UE receives 5G DDNMF-initiated message(s) from the 5G DDNMF but still expects additional network-initiated message(s).\nNOTE:\tThe implementation of the HTTP polling process can be coordinated with the SUPL (Secure User Plane Location) procedures to synchronize the SUPL location report procedures and the HTTP polling procedure so as to reduce unnecessary wait time of polling.\nIf the UE is trigged to send a PC3a message to the 5G DDNMF while it has a pending HTTP polling request, the UE shall open another HTTP connection to the 5G DDNMF to send this new request. Alternately the UE may always use a separate dedicated HTTP connection for polling.\nThe OMA Push method is described by the following steps:\na)\tif one or more network-initiated PC3a message(s) for the UE are available, the 5G DDNMF sends a push message containing a particular URL to the UE via the OMA-Push Architecture as defined in OMA-AD-Push-V2_2-20110809-A [6]. The URL is linked to the PC3a message(s) to be sent to the UE. The 5G DDNMF (performing OMA Push Proxy Gateway functionality) generates a Push Message as specified in OMA-WAP-TS-PushOTA-V2_1-20110405-A [7] with the PDU set according to WAP-168-ServiceLoad-20010731-a [8]. The URL information shall be included in the PDU payload;\nb)\tafter receiving the push message, the UE retrieves the URL from the payload of the message and sends an HTTP GET request to the 5G DDNMF with this URL; and\nc)\tthe 5G DDNMF sends an HTTP response message containing the PC3a message(s) to the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.2\tProcedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tTypes of 5G ProSe direct discovery procedures",
                            "text_content": "The following PC3a control protocol procedures are defined:\na)\tannounce request;\nb)\tmonitor request;\nc)\tdiscoveree request;\nd)\tdiscoverer request;\ne)\tmatch report;\nf)\tnetwork initiated direct discovery update;\ng)\tannouncing alert request; and\nh)\t5G PKMF address request procedure.\nThe following PC5 protocol procedures are defined:\na)\t5G ProSe direct discovery procedure over PC5 interface; and\nb)\tGroup member discovery over PC5 interface.\nIn the following descriptions of PC3a control protocol procedures, the terms \"request\" and \"response\" refer to the corresponding PC3a control protocol messages, not to the HTTP request or response. The following procedure descriptions use a single PC3a control protocol message for illustration purposes.\nThe PC3a control protocol procedures for 5G ProSe direct discovery shall be integrity protected and confidentiality protected using the security procedures defined in clause 5.2.3 in 3GPP TS 33.503 [34].\nNOTE 1:\tA single HTTP request message can contain multiple PC3a control protocol requests and a single HTTP response message can contain multiple PC3a control protocol responses.\nWhen the TLS tunnel between the UE and the 5G DDNMF for transport of PC3a messages is established by the UE according to 3GPP TS 33.503 [34], the 5G DDNMF shall obtain identity of the served UE using the procedures specified in 3GPP TS 33.220 [46] or 3GPP TS 33.535 [47].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2\tAnnounce request procedure for open 5G ProSe direct discovery",
                            "text_content": "The purpose of the announce request procedure for open 5G ProSe direct discovery is for the UE:\na)\tto obtain one or more ProSe application code(s) to be announced over the PC5 interface, upon a request for announcing from upper layers as defined in 3GPP TS 23.304 [2];\nb)\tto inform the 5G DDNMF that the UE wants to stop announcing a ProSe application code as defined in 3GPP TS 23.304 [2]; or\nc)\tto upload metadata associated with a ProSe application ID to the 5G DDNMF as defined in 3GPP TS 23.304 [2].\nThe UE shall be authorized for open 5G ProSe direct discovery announcing in the registered PLMN or the local PLMN based on the service authorization procedure as specified in clause 5, before initiating the announce request procedure.\nThe UE includes one of the ProSe application code(s) obtained as a result of a successful announce request procedure per PROSE PC5 DISCOVERY message and passes the PROSE PC5 DISCOVERY messages to the lower layers for transmission over the PC5 interface.\nBefore initiating the announce request procedure for open 5G ProSe direct discovery, the UE is configured with the data structure of the ProSe application IDs appropriate for its HPLMN. This step is performed using mechanisms out of scope of 3GPP.\nIf the UE is authorized to perform open 5G ProSe direct discovery announcing in the PLMN operating the radio resources signalled from the serving PLMN, it shall initiate an announce request procedure:\na)\twhen the UE is triggered by an upper layer application to announce a ProSe application ID and the UE has no valid corresponding ProSe application code for that upper layer application;\nb)\twhen the validity timer T5060 assigned by the 5G DDNMF to a ProSe application code has expired and the request from upper layers to announce the ProSe application ID corresponding to that ProSe application code is still in place;\nc)\twhen the UE selects a new PLMN while announcing a ProSe application code and intends to announce in the new PLMN and the UE is authorized for open 5G ProSe direct discovery announcing in the new PLMN;\nd)\twhen, while announcing a ProSe application ID, the UE intends to switch the announcing PLMN to a different PLMN without performing PLMN selection and the UE does not have a valid allocated ProSe application code for this new PLMN yet;\ne)\twhen the UE needs to inform the 5G DDNMF that the UE wants to stop announcing a ProSe application code; or\nf)\twhen the UE needs to update metadata associated with a ProSe application ID to the 5G DDNMF.\nWhen the UE selects a new PLMN while announcing a ProSe application code and the UE is not yet authorized for open 5G ProSe direct discovery announcing in the new PLMN, the UE shall initiate an announce request procedure only after the UE is authorized for open 5G ProSe direct discovery announcing in the new PLMN.\nNOTE 1:\tTo ensure service continuity if the UE needs to keep announcing a ProSe application code corresponding to the same ProSe application ID, the UE can initiate the announce request procedure before the validity timer T5060 assigned by the 5G DDNMF for a Prose application code expires.\nThe UE shall initiate the announce request procedure for open 5G ProSe direct discovery by sending a DISCOVERY_REQUEST message with:\na)\ta new transaction ID;\nb)\tthe ProSe application ID set to the ProSe application ID received from upper layers;\nc)\tthe command set to \"metadata_update\" if the UE has a valid ProSe application code corresponding to the ProSe application ID and intends to update metadata associated with the ProSe application ID to the 5G DDNMF, otherwise set to \"announce\";\nd)\tthe application identity set to the ProSe identifier of the upper layer application that requested the announcing as specified in clause 5.2.3;\ne)\tthe discovery entry ID set to 0 when this is a new request or set to the discovery entry ID received from the 5G DDNMF if the announce request is to update a previously sent announce request;\nf)\tthe ACE enabled indicator set to \"application-controlled extension enabled\" if application-controlled extension is required by the upper layers or \"normal\" if application-controlled extension is not used;\ng)\toptionally the requested timer set to the length of validity timer associated with the ProSe application code that the UE expects to receive from the 5G DDNMF;\nh)\toptionally the Metadata set to the metadata received from upper layers associated with the ProSe application ID; and\ni)\toptionally the announcing PLMN ID set to the PLMN ID of the local PLMN operating the radio resources that the UE intends to use for announcing this ProSe application ID.\nIf open 5G ProSe direct discovery with application-controlled extension is requested by upper layers, the DISCOVERY_REQUEST message shall also include the application level container, which contains application-level data transparent to the 3GPP network, to be used by the ProSe application server e.g., to assign ProSe application code suffix(es).\nWhen the UE initiates the announce request procedure to inform the 5G DDNMF that the UE wants to stop announcing a ProSe application code before the associated valid timer expires, the UE shall set the requested timer to 0.\nNOTE 2:\tA UE can include one or multiple transactions in one DISCOVERY_REQUEST message for different ProSe application IDs and receive corresponding <response-announce> element or <response-reject> element in a DISCOVERY_RESPONSE message for each respective transaction. In the following description of the announce request procedure, only one transaction is included.\nFigure 6.2.2.2.1 illustrates the interaction of the UE and the 5G DDNMF in the announce request procedure.\nThe figure depicts the announcement request procedure in a communication system, illustrating the steps taken by the system to notify the receiver of an incoming message. The figure includes a flowchart with arrows indicating the sequence of actions, such as sending an announcement message, receiving the message, and processing the request. The figure also includes labels for each step, such as \"Send Announcement Message,\" \"Receive Announcement Message,\" and \"Process Announcement Request.\" The figure is a visual representation of the communication process, providing a clear and concise overview of the steps involved.\nFigure 6.2.2.2.1: Announce request procedure\nUpon receiving a DISCOVERY_REQUEST message with the command set to \"announce\", if the requested timer is included in the DISCOVERY_REQUEST message and the requested timer is set to 0, the 5G DDNMF shall check whether there is an existing UE context containing the discovery entry identified by the discovery entry ID included in the DISCOVERY_REQUEST message. If the discovery entry exists in the UE context, the 5G DDNMF shall inform the 5G DDNMF in the announcing PLMN to remove the corresponding discovery entry as specified in 3GPP TS 29.555 [9] when the announcing PLMN is not the same as that of the PLMN to which the 5G DDNMF belongs and remove the discovery entry identified by the discovery entry ID from the UE's context. Then the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-announce> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the DISCOVERY_REQUEST message; and\nb)\tthe discovery entry ID set to the identifier associated with the corresponding discovery entry.\nUpon receiving a DISCOVERY_REQUEST message with the command set to \"announce\", if the requested timer is not included in the DISCOVERY_REQUEST message or the requested timer included in the DISCOVERY_REQUEST message is not set to 0, the 5G DDNMF shall perform the following procedure.\nThe 5G DDNMF shall check that the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is authorized for open 5G ProSe direct discovery announcing. If the application is authorized for open 5G ProSe direct discovery announcing, the 5G DDNMF may also check whether the ProSe application ID contained in the DISCOVERY_REQUEST message is known. If the ProSe application ID is known or the 5G DDNMF skips the check of the ProSe application ID, the 5G DDNMF shall check whether there is an existing context for the UE associated with the requested ProSe application ID.\nIf there is no associated UE context, the 5G DDNMF checks with the UDM whether the UE is authorized for open 5G ProSe direct discovery announcing as described in 3GPP TS 29.503 [10]. If the check indicates that the UE is authorized then:\na)\tthe 5G DDNMF shall check whether the UE is authorized to announce the ProSe application ID contained in the DISCOVERY_REQUEST message;\nb)\tif the UE is authorized to announce the ProSe application ID, the ACE enabled indicator is included and set to \"application-controlled extension enabled\", the application level container is included in the DISCOVERY_REQUEST message and the requested application uses application-controlled extension, the 5G DDNMF shall check whether the UE is authorized to use ACE. If the UE is authorized for ACE, the 5G DDNMF shall invoke the procedure described in 3GPP TS 29.557 [19] to check whether the UE is authorized to announce the requested ProSe application ID with application-defined suffix(es) and obtain suffix-related information from the ProSe application server. The 5G DDNMF shall then allocate one ProSe application code prefix and a value for validity timer T5060 to be used with the ProSe application code suffix(es) obtained from the ProSe application server for the given ProSe application ID as specified in 3GPP TS 29.557 [19]. The 5G DDNMF may take into account the requested timer if contained in the DISCOVERY_REQUEST message;\nc)\tif the UE is authorized to announce the ProSe application ID, the ACE enabled indicator is included and set to \"normal\" in the DISCOVERY_REQUEST message and the requested application does not use application-controlled extension, the 5G DDNMF shall allocate the corresponding ProSe application code(s) and a value for validity timer T5060. The 5G DDNMF may take into account the requested timer if contained in the DISCOVERY_REQUEST message;\nd)\tif the UE is authorized to announce the ProSe application ID, the ACE enabled indicator is set included and to \"normal\" in the DISCOVERY_REQUEST message, the application level container is included in the DISCOVERY_REQUEST and the requested application only uses application-controlled extension, the 5G DDNMF shall check whether the UE is authorized to use ACE. If the UE is authorized for ACE, 5G DDNMF shall invoke the procedure described in 3GPP TS 29.557 [19] to check whether the UE is authorized to announce the requested ProSe application ID with application-defined suffix(es) and obtain suffix-related information from the ProSe application server. The 5G DDNMF shall then allocate one ProSe application code prefix and a value for validity timer T5060 to be used with the ProSe application code suffix(es) obtained from the ProSe application server for the given ProSe application ID as specified in 3GPP TS 29.557 [19]. The 5G DDNMF may take into account the requested timer if contained in the DISCOVERY_REQUEST message;\ne)\tif the UE is authorized to announce the ProSe application ID, the ACE enabled indicator is included and set to \"application-controlled-extension enabled\" and the application level container is included in the DISCOVERY_REQUEST message but the requested application does not use application-controlled extension, the 5G DDNMF shall allocate the corresponding ProSe application code(s) and a value for validity timer T5060. The 5G DDNMF may consider the requested timer if contained in the DISCOVERY_REQUEST message; and\nf)\tif the UE is authorized to announce the ProSe application ID and the ACE enabled indicator is not included in the DISCOVERY_REQUEST message, the 5G DDNMF shall allocate the corresponding ProSe application code(s) and a value for validity timer T5060. The 5G DDNMF may consider the requested timer if contained in the DISCOVERY_REQUEST message.\nNOTE:\tThe 5G DDNMF can allocate multiple ProSe application codes for a given ProSe application ID for instance in the case when one or more labels in the ProSe application ID name are wild carded as described in clause 24.2.2 of 3GPP TS 23.003 [12].\nIf the requested ProSe application ID is country-specific or global as described in clause 24.2 of 3GPP TS 23.003 [12], the 5G DDNMF shall allocate the corresponding ProSe application code(s) or ProSe application code prefix according to clause 24.3 of 3GPP TS 23.003 [12]. The temporary identity part of each ProSe application code or ProSe application code prefix is taken from the data structure corresponding to the country-specific or global ProSe application ID namespace according to clause 24.3 of 3GPP TS 23.003 [12]. The 5G DDNMF shall use the MCC and MNC of the PLMN ID of this 5G DDNMF for the PLMN ID part of the ProSe application code or ProSe application code prefix.\nAfter the ProSe application code(s) or ProSe application code prefix allocation, the 5G DDNMF then associates the ProSe application code(s) or ProSe application code prefix with a new discovery entry identified by a non-zero value discovery entry ID in the new context for the UE that contains the UE's subscription parameters obtained from the UDM and starts timer T5061. The UDM also provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently registered. For a given set of ProSe application codes or the allocated ProSe application code prefix, timer T5061 shall be longer than timer T5060. By default, the value of timer T5061 is 4 minutes greater than the value of timer T5060.\nIf there is an existing context for the UE that contains the UE's subscription parameters obtained from the UDM, but no discovery entry identified by the discovery entry ID contained in the DISCOVERY_REQUEST message, the 5G DDNMF shall behave as if the discovery entry ID included in the DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a new non-zero discovery entry ID for this entry.\nIf the metadata is included in the DISCOVERY_REQUEST message, the 5G DDNMF shall allocate the ProSe application code or ProSe application code prefix including a metadata index to indicate the current version of the metadata and store the received metadata in the UE context.\nMoreover, if the command is set to \"metadata_update\" in the DISCOVERY_REQUEST message and there is an existing UE context stored in the 5G DDNMF, the 5G DDNMF shall update the metadata in the UE context by using the received metadata in the DISCOVERY_REQUEST message and update the ProSe application code or ProSe application code prefix in the UE context by changing the metadata index portion and keeping the rest unchanged.\nAfter the ProSe application code(s) allocation, the 5G DDNMF then associates the ProSe application code(s) with a new discovery entry identified by a non-zero value discovery entry ID in the UE context and starts timer T5061.\nIf there is an existing context for the UE and a discovery entry identified by the discovery entry ID contained in the DISCOVERY_REQUEST message associated with the requested ProSe application ID, the 5G DDNMF shall either update the discovery entry with a new validity timer T5060, or allocate new ProSe application code(s) or ProSe application code prefix for the requested ProSe application ID with a new validity timer T5060 and restart timer T5061. The 5G DDNMF may consider the requested timer if contained in the DISCOVERY_REQUEST message.\nIf a new discovery entry was created or an existing discovery entry was updated and the UE is currently roaming or the Announcing PLMN ID is included in the DISCOVERY_REQUEST message, the 5G DDNMF checks with the 5G DDNMF of the VPLMN or in case of open 5G ProSe direct discovery the local PLMN identified by the Announcing PLMN ID whether the UE is authorized for open 5G ProSe direct discovery announcing as described in 3GPP TS 29.555 [9].\nIf the check indicates that the UE is authorized, then the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-announce> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the DISCOVERY_REQUEST message from the UE;\nb)\teither the ProSe application code(s) set to the ProSe application code(s) allocated by the 5G DDNMF, or the ProSe application code ACE parameter set to include the ProSe-application code- prefix allocated by the 5G DDNMF and one or more ProSe application code suffix Ranges which contain the suffix(es) for the ProSe application ID received in the DISCOVERY_REQUEST message from the UE;\nc)\tvalidity timer T5060 set to the T5060 timer value assigned by the 5G DDNMF to the ProSe application code(s):\nd)\tif the ACE enabled indicator was included by the UE in the DISCOVERY_REQUEST message, the ACE enabled indicator set to:\n1)\t\"application-controlled extension enabled\" if application-controlled extension is used; or\n2)\t\"normal\" if application-controlled extension is not used;\ne)\tthe discovery entry ID set to the identifier associated with the corresponding discovery entry;\nf)\tthe discovery key set to a value provided by the 5G DDNMF; and\ng)\tthe current time set to the current UTC-based time at the 5G DDNMF and the max offset.\nIf timer T5061 expires, the 5G DDNMF shall remove the discovery entry identified by the discovery entry ID from the UE's context.\nThe 5G DDNMF uses the information (e.g. ProSe application ID, application identity) received from the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA information related to TLS tunnel transporting the DISCOVERY_REQUEST message, and other information for charging purposes as specified in 3GPP TS 32.277 [45].\nUpon receipt of the DISCOVERY_RESPONSE message, if only the transaction ID and the discovery entry ID are contained in the <response-announce> element and the transaction ID and the discovery entry ID match the corresponding values sent by the UE in a DISCOVERY_REQUEST message, the UE shall:\na)\tstop the validity timer T5060 corresponding to the ProSe application code(s) or ProSe application code prefix in the discovery entry identified by the discovery entry ID;\nb)\tremove the discovery entry identified by the discovery entry ID included; and\nc)\tinstruct the lower layers to stop announcing.\nUpon receipt of the DISCOVERY_RESPONSE message, if the transaction ID contained in the <response-announce> element matches the value sent by the UE in a DISCOVERY_REQUEST message with the command set to \"announce\", the UE shall create a new discovery entry or update an existing discovery entry with the received ProSe application code(s) and the PLMN ID of the intended announcing PLMN. For this discovery entry, the UE shall stop the validity timer T5060 if running and start the validity timer T5060 with the received value. Otherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not perform the procedures below. The UE shall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset parameter.\nFor any one of the received ProSe application codes or ProSe application code prefix in this discovery entry, the UE may perform open 5G ProSe direct discovery announcing as described in clause 6.2.14.2.1.1.\nIf the DISCOVERY_REQUEST message cannot be accepted by the 5G DDNMF, the 5G DDNMF sends a DISCOVERY_RESPONSE message containing a <response-reject> element to the UE including an appropriate PC3a control protocol cause value.\nIf the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is not authorized for open 5G ProSe direct discovery announcing, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #1 \"Invalid application\".\nIf the ProSe application ID contained in the DISCOVERY_REQUEST message is unknown to the 5G DDNMF, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #2 \"Unknown ProSe application ID\".\nIf the UE is not authorized for open 5G ProSe direct discovery announcing, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the UE is not authorized to use the ProSe application ID contained in the DISCOVERY_REQUEST message, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the UE requests a country-specific ProSe application ID for a country that does not correspond to the country of its HPLMN and the 5G DDNMF has not authorized the UE to announce in that country, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #8 \"Scope violation in Prose application ID\".\nIf the UE requests a country-specific ProSe application ID for a country that does not correspond to the country of its HPLMN and the 5G DDNMF has no agreement to access the country-wide ProSe application ID database of that country, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #8 \"Scope violation in Prose application ID\".\nIf the discovery entry ID contained in the DISCOVERY_REQUEST message is unknown to the 5G DDNMF and the requested timer is set to zero, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value # 10 \"Unknown or invalid discovery entry ID\".\nIf the UE is not authorized to use ACE, but the DISCOVERY_REQUEST message contains the ACE enabled indicator set to \"application-controlled extension enabled\", the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #12 \"UE unauthorized for discovery with application-controlled extension\".\nIf the DISCOVERY_REQUEST message contains the ACE enabled indicator set to \"application-controlled extension enabled\", but does not contain the application level container parameter, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #14 \"Missing application level container\".\nIf the ProSe application server indicates to the 5G DDNMF that the application level container in the DISCOVERY_REQUEST message contains invalid information, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #15 \"Invalid data in application level container\".\nIf the DISCOVERY_REQUEST message does not contain the ACE enabled indicator and the requested application only uses application-controlled extension, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #1 \"Invalid application\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the announce request procedure.\nNOTE 1:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nb)\tNo response from the 5G DDNMF after the DISCOVERY_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the DISCOVERY_REQUEST message)\nThe UE shall retransmit the DISCOVERY_REQUEST message.\nNOTE 2:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nNOTE 3:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nc)\tIndication from upper layers that the request to announce the ProSe application ID is no longer in place after sending the DISCOVERY_REQUEST message, but before the announce request procedure is completed\nThe UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G DDNMF but discard its contents and then abort the procedure.\nd)\tChange of PLMN\nIf a PLMN change occurs before the announce request procedure is completed, the procedure shall be aborted. If the UE is authorized to announce in the new PLMN, the procedure shall be restarted once the UE is registered on the new PLMN.\ne)\tAbsence of discovery entry ID parameter in a DISCOVERY_RESPONSE message received in response to a DISCOVERY_REQUEST message which contained a discovery entry ID parameter\nIf the DISCOVERY_REQUEST message:\n1)\tincluded a requested timer which is set to 0; or\n2)\tincluded an Announcing PLMN ID;\nthe UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G DDNMF but discard its content and then abort the procedure.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of DISCOVERY_RESPONSE message\nAfter receiving an indication from lower layer that the DISCOVERY_RESPONSE message has not been successfully acknowledged (e.g., TCP ACK is not received), the 5G DDNMF shall abort the procedure and stop any associated timer(s) T5061, if running.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3\tAnnounce request procedure for restricted 5G ProSe direct discovery model A",
                            "text_content": "The purpose of the announce request procedure for restricted 5G ProSe direct discovery model A is for the UE:\na)\tto obtain a ProSe restricted code corresponding to the RPAUID to be announced over the PC5 interface, upon a request for announcing from upper layers (e.g., application client) as defined in 3GPP TS 23.304 [2]; or\nb)\tto inform the 5G DDNMF that the UE wants to stop announcing a ProSe restricted code as defined in 3GPP TS 23.304 [2].\nBefore initiating the announce request procedure, the UE shall be authorized for restricted 5G ProSe direct discovery model A announcing in the registered PLMN or local PLMN based on the service authorization procedure as specified in clause 5.\nThe UE includes the ProSe restricted code obtained from a successful announce request procedure in a PROSE PC5 DISCOVERY message and passes the PROSE PC5 DISCOVERY message to the lower layers for transmission over the PC5 interface.\nBefore initiating the announce request procedure, the user sets the permissions for the restricted discovery using application layer mechanisms. The application client in the UE retrieves the PDUID provisioned to the UE as part of the service authorization procedure as specified in clause 5 and obtains an RPAUID associated with the UE's PDUID from the ProSe application server. The UE may provide metadata to be associated with the RPAUID and the ProSe application server stores the metadata. This step is performed using mechanisms that are out of scope of the present specification.\nIf the UE is authorized to perform restricted 5G ProSe direct discovery model A announcing in the PLMN operating the radio resources signalled from the serving PLMN, it shall initiate an announce request procedure:\na)\twhen the UE is triggered by an upper layer application to announce an RPAUID and the UE has no valid corresponding ProSe restricted code for that RPAUID of the upper layer application;\nb)\twhen the validity timer T5062 assigned by the 5G DDNMF to a ProSe restricted code has expired and the request from upper layers to announce the RPAUID corresponding to that ProSe restricted code is still in place;\nc)\twhen the UE selects a new PLMN while announcing a ProSe restricted code and intends to announce in the new PLMN and the UE is authorized for restricted 5G ProSe direct discovery model A announcing in the new PLMN;\nd)\twhen, while announcing a RPAUID, the UE intends to switch the announcing PLMN to a different PLMN without performing PLMN selection and the UE does not have a valid allocated ProSe restricted code for this new PLMN yet; or\ne)\twhen the UE needs to update a previously sent restricted 5G ProSe direct discovery model A announcing request.\nWhen the UE selects a new PLMN while announcing a ProSe restricted code and the UE is not yet authorized for restricted 5G ProSe direct discovery model A announcing in the new PLMN, the UE shall initiate an announce request procedure only after the UE is authorized for restricted 5G ProSe direct discovery model A announcing in the new PLMN.\nNOTE 1:\tTo ensure service continuity if the UE needs to keep announcing a ProSe restricted code corresponding to the same RPAUID, the UE can initiate the announce request procedure before the validity timer T5062 assigned by the 5G DDNMF for a ProSe restricted code expires.\nThe UE shall initiate the announce request procedure by sending a DISCOVERY_REQUEST message with:\na)\ta new transaction ID not used in any other direct discovery procedures in PC3a interface;\nb)\tthe RPAUID set to the RPAUID received from upper layers;\nc)\tthe command set to \"announce\";\nd)\tthe application identity set to the ProSe identifier of the upper layer application that requested the announcing as specified in clause 5.2.3;\ne)\tthe discovery type set to \"Restricted discovery\";\nr)\tthe ACE enabled indicator set to \"application-controlled extension enabled\" if application-controlled extension is required by the upper layers or \"normal\" if application-controlled extension is not used;\ng)\tthe announcing type set to \"on demand\" if on demand announcing is requested by upper layers and \"normal\" if on demand announcing is not requested by upper layers;\nh)\toptionally the requested timer set to the length of validity timer associated with the ProSe restricted code that the UE expects to receive from the 5G DDNMF;\ni)\tthe discovery entry ID set to a 0 if the announcing request is a new request and set to the discovery entry ID received from the 5G DDNMF if the announcing request is to update a previously sent announcing request;\nj)\toptionally the announcing PLMN ID set to the PLMN ID of the local PLMN operating the radio resources that the UE intends to use for announcing the RPAUID; and\nk)\tthe PC5 UE ciphering algorithm capability set to the UE supported ciphering algorithm(s) for ciphering the PROSE PC5 DISCOVERY message.\nIf restricted 5G ProSe direct discovery model A with application-controlled extension is requested by upper layers, the DISCOVERY_REQUEST message shall also include the application level container, which contains application-level data transparent to the 3GPP network, to be used by the ProSe application server e.g., to assign ProSe restricted code suffix(es).\nWhen the UE initiates the announce request procedure to inform the 5G DDNMF that the UE wants to stop announcing a ProSe restricted code before the associated valid timer expires, the UE shall set the requested timer to 0.\nNOTE 2:\tA UE can include one or multiple transactions in one DISCOVERY_REQUEST message for different RPAUIDs and receive corresponding <restricted-announce-response> element or <response-reject> element in a DISCOVERY_RESPONSE message for each respective transaction. In the following description of the announce request procedure, only one transaction is included.\nFigure 6.2.3.2.1 illustrates the interaction of the UE and the 5G DDNMF in the announce request procedure.\nThe figure depicts a simplified model of the announcement request procedure for the restricted 5G ProSe direct discovery model A, which is a direct discovery protocol for 5G networks. The figure illustrates the steps involved in requesting a discovery of a restricted 5G network, including the announcement of the request, the response from the network, and the subsequent steps for the network to respond. The figure is a simplified representation, and the actual procedure may vary depending on the specific requirements of the network.\nFigure 6.2.3.2.1: Announce request procedure for restricted 5G ProSe direct discovery model A\nUpon receiving a DISCOVERY_REQUEST message with the command set to \"announce\" and the discovery type set to \"Restricted discovery\", if the requested timer is included in the DISCOVERY_REQUEST message and the requested timer is set to 0, the 5G DDNMF shall check whether there is an existing UE context containing the discovery entry identified by the discovery entry ID included in the DISCOVERY_REQUEST message. If the discovery entry exists in the UE context, the 5G DDNMF shall inform the 5G DDNMF in the announcing PLMN to remove the corresponding discovery entry as specified in 3GPP TS 29.555 [9] when the announcing PLMN is not the same as that of the PLMN to which the 5G DDNMF belongs and remove the discovery entry identified by the discovery entry ID from the UE's context.\nUpon receiving a DISCOVERY_REQUEST message with the command set to \"announce\" and the discovery type set to \"Restricted discovery\", if the requested timer is not included in the DISCOVERY_REQUEST message or the requested timer included in the DISCOVERY_REQUEST message is not set to 0, the 5G DDNMF shall perform the following procedure.\nThe 5G DDNMF shall check that the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is authorized for restricted 5G ProSe direct discovery model A announcing. If the application is authorized for restricted 5G ProSe direct discovery model A announcing, the 5G DDNMF shall check whether there is an existing context for the UE.\nIf there is no associated UE context, the 5G DDNMF checks with the UDM whether the UE is authorized for restricted 5G ProSe direct discovery model A announcing as described in 3GPP TS 29.503 [10]. If the check indicates that the UE is authorized, the 5G DDNMF creates a UE context that contains the UE's subscription parameters obtained from the UDM. The UDM also provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently registered. If the UE context exists, the 5G DDNMF shall then check whether the UE is authorized for restricted 5G ProSe direct discovery model A announcing in the currently registered PLMN or in the local PLMN identified by the Announcing PLMN ID included in the DISCOVERY_REQUEST message.\nIf the UE is authorized and the discovery entry ID included in the DISCOVERY_REQUEST message is set to 0 then:\na)\tthe 5G DDNMF shall check whether the UE is authorized to announce the RPAUID contained in the DISCOVERY_REQUEST message. Optionally this can include checking with the ProSe application server as described in 3GPP TS 29.557 [19] to obtain the binding between the RPAUID and PDUID and then verifying that the PDUID belongs to the requesting UE;\nb)\tif the UE is authorized to announce the RPAUID, the ACE enabled indicator is set to \"application-controlled extension enabled\", the application level container is included in the DISCOVERY_REQUEST message and the requested application uses application-controlled extension, the 5G DDNMF shall check whether the UE is authorized to use ACE. If the UE is authorized for ACE, the 5G DDNMF shall invoke the procedure described in 3GPP TS 29.557 [19] to check whether the UE is authorized to announce the requested RPAUID with application-defined suffix(es) and obtain suffix-related information from the ProSe application server. The 5G DDNMF shall then allocate a ProSe restricted code prefix and a value for validity timer T5062 to be used with the ProSe restricted code suffix(es) obtained from the ProSe application server for the given RPAUID as specified in 3GPP TS 29.557 [19]. The 5G DDNMF may take into account the requested timer if contained in the DISCOVERY_REQUEST message when allocating validity timer T5062;\nc)\tif the UE is authorized to announce the RPAUID, the ACE enabled indicator is set to \"normal\" in the DISCOVERY_REQUEST message and the requested application does not use application-controlled extension, the 5G DDNMF shall allocate the corresponding ProSe restricted code and a value for validity timer T5062. The 5G DDNMF may take into account the requested timer if contained in the DISCOVERY_REQUEST message when allocating validity timer T5062;\nd)\tif the UE is authorized to announce the RPAUID, the ACE enabled indicator is set to \"normal\" in the DISCOVERY_REQUEST message, the application level container is included in the DISCOVERY_REQUEST and the requested application only uses application-controlled extension, the 5G DDNMF shall check whether the UE is authorized to use ACE. If the UE is authorized for ACE, the 5G DDNMF shall invoke the procedure described in 3GPP TS 29.557 [19] to check whether the UE is authorized to announce the requested RPAUID with application-defined suffix(es) and obtain suffix-related information from the ProSe application server. The 5G DDNMF shall then allocate a ProSe restricted code prefix and a value for validity timer T5062 to be used with the ProSe restricted code suffix(es) obtained from the ProSe application server for the given RPAUID as specified in 3GPP TS 29.557 [19] The 5G DDNMF may consider the requested timer if contained in the DISCOVERY_REQUEST message when allocating validity timer T5062;\ne)\tif the UE is authorized to announce the RPAUID, the ACE enabled indicator is set to \"application-controlled-extension enabled\" and the application level container is included in the DISCOVERY_REQUEST message but the requested application does not use application-controlled extension, the 5G DDNMF shall allocate the corresponding ProSe restricted code and a value for validity timer T5062. The 5G DDNMF may consider the requested timer if contained in the DISCOVERY_REQUEST message when allocating validity timer T5062; and\nf)\tthe 5G DDNMF associates the allocated ProSe restricted code or ProSe restricted code prefix with a new discovery entry in the UE's context and starts timer T5063. The UDM also provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently registered. For a given ProSe restricted code, timer T5063 shall be longer than timer T5062. By default, the value of timer T5063 is 4 minutes greater than the value of timer T5062.\nIf the discovery entry ID included in the DISCOVERY_REQUEST message is not set to 0 and if there is an existing discovery entry for this discovery entry ID value in the UE's context, the 5G DDNMF shall either update the discovery entry with a new validity timer T5062, or allocate a new ProSe restricted code or ProSe restricted code prefix for the requested RPAUID with a new validity timer T5062, restart timer T5063 and clear any existing on demand announcing enabled indicator. The 5G DDNMF may consider the requested timer if contained in the DISCOVERY_REQUEST message when allocating validity timer T5062.\nIf the discovery entry ID contained in the DISCOVERY_REQUEST message is not found in the UE context or there is no UE context in the 5G DDNMF, the 5G DDNMF shall behave as if the discovery entry ID included in the DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a new non-zero discovery entry ID for this entry.\nIf the announcing type is set to \"on demand\" in the DISCOVERY_REQUEST message, the 5G DDNMF shall check if \"on demand\" announcing is authorized and enabled based on the ProSe identifier and the operator's policy. If \"on demand\" announcing is authorized and enabled and there is no ongoing monitoring request for this RPAUID, then the 5G DDNMF shall set the on demand announcing enabled indicator to 1 for the corresponding discovery entry in the UE's context.\nIf a new UE context was created or an existing UE context was updated and the UE is currently roaming or the announcing PLMN ID is included in the DISCOVERY_REQUEST message and the on demand announcing enabled indicator is not set to 1 for this discovery entry in the UE's context, the 5G DDNMF checks with the 5G DDNMF of the VPLMN or the local PLMN represented by the Announcing PLMN ID whether the UE is authorized for restricted 5G ProSe direct discovery model A announcing as described in 3GPP TS 29.555 [9].\nThe 5G DDNMF shall then send a DISCOVERY_RESPONSE message containing a <restricted-announce-response> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the DISCOVERY_REQUEST message from the UE;\nb)\tif the on demand announcing enabled indicator is not set to 1 in the UE's context for this discovery entry, either the ProSe restricted code set to the ProSe restricted code or the ProSe restricted code prefix allocated by the 5G DDNMF. If restricted Direct Discovery with application-controlled extension was requested by the announcing UE , the DISCOVERY_RESPONSE message also contains one or more ProSe restricted code suffix Ranges which contain the suffix(es) for the RPAUID received in the DISCOVERY_REQUEST message;\nc)\ta validity timer T5062 set to the T5062 timer value assigned by the 5G DDNMF to the ProSe restricted code;\nd)\tthe ACE enabled indicator set to \"application-controlled extension enabled\" if application-controlled extension is used, or \"normal\" if application-controlled extension is not used;\ne)\tthe code-sending security parameter containing the security-related information for the UE to protect the transmission of the ProSe restricted code;\nf)\tthe on demand announcing enabled indicator indicating whether the on demand announcing is enabled or not for this discovery entry if the announcing type is set to \"on demand\" in the DISCOVERY_REQUEST message;\ng)\tthe discovery entry ID set to the ID of the discovery entry associated with this announce request in the UE's context;\nh)\tthe current time set to the current UTC-based time at the 5G DDNMF and the max offset;\ni)\toptionally, the PC5 security policies that are associated with the ProSe restricted code and used for 5G ProSe direct link establishment procedure instead of any PC5 security policies configured in the UE as specified in clause 5; and\nj)\tthe selected PC5 ciphering algorithm set to the PC5 ciphering algorithm selected by the 5G DDNMF based on the received PC5 UE ciphering algorithm capability and the ProSe restricted code.\nIf timer T5063 expires, the 5G DDNMF shall remove the discovery entry associated with the corresponding RPAUID from the UE's context.\nThe 5G DDNMF may associate the ProSe restricted code with the PC5 security policies.\nThe 5G DDNMF uses the information (e.g. application identity) received from the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA information related to TLS tunnel transporting the DISCOVERY_REQUEST message, and other information for charging purposes as specified in 3GPP TS 32.277 [45].\nUpon receipt of the DISCOVERY_RESPONSE message, if only the transaction ID and the discovery entry ID are contained in the <restricted-announce-response> element and the transaction ID and the discovery entry ID match the corresponding values sent by the UE in a DISCOVERY_REQUEST message, the UE shall:\na)\tstop the validity timer T5062 for the discovery entry corresponding to the discovery entry ID received in the DISCOVERY_RESPONSE message;\nb)\tremove the discovery entry identified by the discovery entry ID included; and\nc)\tinstruct the lower layers to stop announcing.\nUpon receipt of the DISCOVERY_RESPONSE message, if the transaction ID contained in the <restricted-announce-response> element matches the value sent by the UE in a DISCOVERY_REQUEST message with the command set to \"announce\", the UE shall create a new discovery entry or update an existing discovery entry with the received ProSe restricted code or ProSe restricted code prefix and the PLMN ID of the intended announcing PLMN. For this discovery entry, the UE shall stop the validity timer T5062, if running, for the discovery entry corresponding to the discovery entry ID received in the DISCOVERY_RESPONSE message and start the validity timer T5062 for this discovery entry with the received value in the DISCOVERY_RESPONSE message. Otherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not perform the procedures below. The UE shall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset parameter.\nIf the DISCOVERY_RESPONSE message includes new ProSe restricted code or ProSe restricted code prefix to replace the existing ProSe restricted code being announced, the UE shall notify lower layer to stop announcing the old ProSe restricted code in PC5 interface.\nThe UE shall store the selected PC5 ciphering algorithm received in the DISCOVERY_RESPONSE message for the received ProSe restricted code and use it for protection of the restricted 5G ProSe direct discovery messages over the PC5 interface as specified in clause 6.1.3.2.3 of 3GPP TS 33.503 [34].\nIf the DISCOVERY_RESPONSE message contains an on demand announcing enabled indicator set to 1, the UE shall wait for an announcing alert Request message from the 5G DDNMF of the HPLMN before starting to perform restricted 5G ProSe direct discovery model A announcing. Otherwise, the UE may perform restricted 5G ProSe direct discovery model A announcing as described in clause 6.2.14.2.1.\nIf the DISCOVERY_REQUEST message cannot be accepted by the 5G DDNMF, the 5G DDNMF sends a DISCOVERY_RESPONSE message containing a <response-reject> element to the UE including an appropriate PC3a control protocol cause value.\nIf the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is not authorized for ProSe direct discovery announcing, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #1 \"Invalid application\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message is unknown to the 5G DDNMF or ProSe application server, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #9 \"Unknown RPAUID\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message does not match the stored RPAUID for the requested discovery entry ID, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #10 \"Unknown or invalid discovery entry ID\".\nIf the UE is not authorized for restricted 5G ProSe direct discovery model A announcing, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the UE is not authorized for restricted \"on demand\" restricted 5G ProSe direct discovery model A announcing, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #13 \"UE unauthorized for on-demand announcing\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message is not associated with the PDUID belonging to the requesting UE, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization Failure\".\nIf the UE is not authorized to use ACE, but the DISCOVERY_REQUEST message contains the ACE enabled indicator set to \"application-controlled extension enabled\", the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #12 \"UE unauthorized for discovery with application-controlled extension\".\nIf the DISCOVERY_REQUEST message contains the ACE enabled indicator set to \"application-controlled extension enabled\", but does not contain the application level container parameter, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #14 \"Missing application level container\".\nIf the ProSe application server indicates to the 5G DDNMF that the application level container in the DISCOVERY_REQUEST message contains invalid information, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #15 \"Invalid data in application level container\".\nIf the discovery entry ID contained in the DISCOVERY_REQUEST message is unknown to the 5G DDNMF and the requested timer is set to zero, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value # 10 \"Unknown or invalid discovery entry ID\".\nIf the PC5 UE ciphering algorithm capability contained in the DISCOVERY_REQUEST message is not compatible with the selected PC5 ciphering algorithm for the target ProSe restricted code, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #19 \"Not compatible PC5 UE ciphering algorithm capability\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the announce request procedure.\nNOTE 1:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nb)\tNo response from the 5G DDNMF after the DISCOVERY_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the DISCOVERY_REQUEST message)\nThe UE shall retransmit the DISCOVERY_REQUEST message.\nNOTE 2:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nNOTE 3:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nc)\tIndication from upper layers that the request to announce the RPAUID is no longer in place after sending the DISCOVERY_REQUEST message, but before the announce request procedure is completed\nThe UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G DDNMF but discard its contents and then abort the procedure.\nd)\tChange of PLMN\nIf a PLMN change occurs before the announce request procedure is completed, the procedure shall be aborted. If the UE is authorized to announce in the new PLMN, the procedure shall be restarted once the UE is registered on the new PLMN.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of DISCOVERY_RESPONSE message\nAfter receiving an indication from lower layer that the DISCOVERY_RESPONSE message has not been successfully acknowledged (e.g. TCP ACK is not received), the 5G DDNMF shall abort the procedure and stop any associated timer(s) T5063, if running.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.4\tMonitor request procedure for open 5G ProSe direct discovery",
                            "text_content": "The purpose of the monitor request procedure for open 5G ProSe direct discovery is to allow a UE:\na)\tto receive and process PROSE PC5 DISCOVERY messages upon a request for monitoring from upper layers as defined in 3GPP TS 23.304 [2]; or\nb)\tto inform the 5G DDNMF that the UE wants to stop using discovery filters for direct discovery monitoring as defined in 3GPP TS 23.304 [2].\nThe UE shall only initiate the monitor request procedure if it has been authorized for open 5G ProSe direct discovery monitoring at least in one PLMN based on the service authorization procedure.\nAs a result of the monitor request procedure completing successfully, the UE obtains one or more discovery filters, along with a TTL (Time-To-Live) timer T5064 for each discovery filter indicating the time during which the filter is valid.\nBefore initiating the monitor request procedure, the UE is configured with the data structure of the ProSe application IDs it wants to monitor. This step is performed using mechanisms that are out of scope of 3GPP.\nIf the UE is authorized to perform open 5G ProSe direct discovery monitoring in at least one PLMN, it shall initiate a monitor request procedure:\na)\twhen the UE is triggered by an upper layer application to perform open 5G ProSe direct discovery monitoring corresponding to a ProSe application ID and the UE has no valid discovery filters corresponding to the requested ProSe application ID for that upper layer application;\nb)\twhen the TTL timer T5064 assigned by the 5G DDNMF to a discovery filter has expired and the request from upper layers to monitor that ProSe application ID is still in place; or\nc)\twhen the UE needs to inform the 5G DDNMF that the UE wants to stop using discovery filters for direct discovery monitoring.\nNOTE 1:\tTo ensure service continuity if the UE needs to keep monitoring the same discovery filter, the UE can initiate the monitor request procedure before the TTL timer T5064 assigned by the 5G DDNMF for a discovery filter expires.\nThe UE shall initiate the monitor request procedure for open 5G ProSe direct discovery by sending a DISCOVERY_REQUEST message with:\na)\ta new transaction ID;\nb)\tthe ProSe application ID set to the ProSe application ID received from upper layers;\nc)\tthe command set to \"monitor\";\nd)\tthe application identity set to the ProSe identifier of the upper layer application that requested the monitoring as specified in clause 5.2.3;\ne)\tthe ACE enabled indicator set to \"application-controlled extension enabled\" if application-controlled extension is required by the upper layers, or \"normal\" if application-controlled extension is not used;\nf)\tthe discovery entry ID set to 0 if this is a new request or set to the discovery entry ID received from the 5G DDNMF if the monitor request is to update a previously sent monitor request; and\ng)\toptionally, the requested timer set to 0 only when the UE wants to stop using discovery filters for direct discovery monitoring.\nIf open 5G ProSe direct discovery with application-controlled extension is requested by upper layers, the DISCOVERY_REQUEST message shall also include the application level container, which contains information corresponding to the ProSe application code suffix, e.g., group or user-specific information.\nNOTE 2:\tA UE can include one or multiple transactions in one DISCOVERY_REQUEST message for one or more ProSe application IDs and receive corresponding <response-monitor> element or <response-reject> element in the DISCOVERY_RESPONSE message for each respective transaction. In the following description of the monitor request procedure, only one transaction is included.\nFigure 6.2.4.2.1 illustrates the interaction between the UE and the 5G DDNMF in the monitor request procedure.\nThe figure depicts a monitor request procedure in a network monitoring system, illustrating the steps taken by the system to receive and process requests. The diagram shows the various components involved, such as the monitor server, the request queue, and the monitoring software, all connected to the network infrastructure. The figure provides a visual representation of the system's functionality and the flow of information between different components.\nFigure 6.2.4.2.1: Monitor request procedure\nUpon receiving a DISCOVERY_REQUEST message with the command set to \"monitor\", if the requested timer is included in the DISCOVERY_REQUEST message and the requested timer is set to 0, the 5G DDNMF shall check whether there is an existing UE context containing the discovery entry identified by the discovery entry ID included in the DISCOVERY_REQUEST message. If the discovery entry exists in the UE context, the 5G DDNMF shall remove the discovery entry identified by the discovery entry ID from the UE's context. When the associated ProSe application ID is PLMN-specific and that PLMN ID indicated by the ProSe application ID is not the same as that of the PLMN to which the 5G DDNMF belongs, the 5G DDNMF shall inform the 5G DDNMF in the PLMN indicated by the ProSe application ID to remove the corresponding discovery entry as specified in 3GPP TS 29.555 [9]. Then the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-monitor> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the DISCOVERY_REQUEST message; and\nb)\tthe discovery entry ID set to the value of the discovery entry ID received in the DISCOVERY_REQUEST message.\nUpon receiving a DISCOVERY_REQUEST message with the command set to \"monitor\", if the requested timer is not included in the DISCOVERY_REQUEST message, the 5G DDNMF shall perform the following procedure.\nThe 5G DDNMF shall check that the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is authorized for open 5G ProSe direct discovery monitoring. If the application is authorized for open 5G ProSe direct discovery monitoring, the 5G DDNMF checks whether there is an existing context for the UE associated with the requested ProSe application ID.\nIf there is no associated UE context, the 5G DDNMF checks with the UDM whether the UE is authorized for open 5G ProSe direct discovery monitoring as described in 3GPP TS 29.503 [10]. The UDM provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently registered. If the subscription check indicates that the UE is authorized, the 5G DDNMF creates a new context for the UE and a new discovery entry identified by a non-zero value discovery entry ID which is associated with the requested ProSe application ID.\nIf the ACE enabled indicator in the DISCOVERY_REQUEST message is included and set to \"application-controlled extension enabled\" and the requested application uses application-controlled extension, the 5G DDNMF shall check whether the UE is authorized to use ACE. If the UE is authorized for ACE, the 5G DDNMF shall also use the procedure described in 3GPP TS 29.557 [19] to obtain the mask(s) for monitoring the ProSe application code suffix (es) corresponding to the requested  ProSe application ID.\nIf the PLMN ID indicated in the ProSe application ID is PLMN-Specific and that PLMN ID is not the same as that of the PLMN to which the 5G DDNMF belongs, then the 5G DDNMF executes the procedures defined in 3GPP TS 29.555 [9] to obtain the discovery filter(s) for the ProSe application ID. Otherwise, the 5G DDNMF shall allocate one or more discovery filters for the requested ProSe application ID if it is known to the 5G DDNMF and at least one corresponding valid ProSe application code or ProSe application code prefix is available in the 5G DDNMF. Each discovery filter consists of a ProSe application code, one or more ProSe application masks and a TTL timer T5064. If application-controlled extension is used, the allocated Discovery Filter shall be applicable to match both prefix and suffix portions of the ProSe application code.\nIf the requested ProSe application ID is country-specific or global or PLMN-specific as defined respectively in clause 24.2 of 3GPP TS 23.003 [12], the 5G DDNMF shall allocate the discovery filter which contains ProSe application code and ProSe application mask(s) in the corresponding scope. If the ProSe application ID is country-specific or global, the ProSe application mask(s) enclosed in the discovery filter hides the PLMN ID part correspondingly and the temporary identity part is taken from the data structure corresponding to the global or country-wide ProSe application ID namespace, as specified in clause 24.3 of 3GPP TS 23.003 [12]. If the requested ProSe application ID is PLMN-specific, the 5G DDNMF shall allocate one or more PLMN-specific discovery filters. Each of these discovery filters shall contain a PLMN-specific Prose application code and the ProSe application mask(s) whose PLMN ID portion shall be set such that when the mask is applied to the ProSe application code, the outcome matches the full PLMN ID of that specific PLMN.\nAfter the discovery filter(s) are allocated, the 5G DDNMF then associates the discovery filters with the new discovery entry in the UE context and starts timer T5065 assigned for each discovery filter. For a given discovery filter timer T5065 shall be longer than timer T5064. By default, the value of timer T5065 is 4 minutes greater than the value of timer T5064.\nIf there is an existing context for the UE that contains the UE's subscription parameters obtained from the UDM, but no discovery entry identified by the discovery entry ID contained in the DISCOVERY_REQUEST message, the 5G DDNMF shall check whether the UE is authorized for ProSe direct discovery monitoring. If the UE is authorized, the 5G DDNMF shall allocate the discovery filter as specified above.\nAfter the discovery filter is allocated, the 5G DDNMF then associates the discovery filter with a new discovery entry identified by a non-zero value discovery entry ID in the UE context and starts timer T5065 assigned for each discovery filter.\nSimilarly, if there is an existing context and a discovery entry identified by the discovery entry ID contained in the DISCOVERY_REQUEST message for the UE associated with the requested ProSe application ID, the 5G DDNMF updates the content of discovery filter(s), associate the discovery entry with the updated discovery filter(s) and restart timer T5065 for each filter. The update of a discovery filter content includes setting new TTL timer(s) and if necessary, assigning new ProSe application code or ProSe application code prefix and ProSe application mask(s).\nThen the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-monitor> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the DISCOVERY_REQUEST message from the UE;\nb)\tthe discovery entry ID set to the identifier associated with the discovery entry;\nc)\tif the ACE enabled indicator was included by the UE in the DISCOVERY_REQUEST message, the ACE enabled indicator set to:\n1)\t\"application-controlled extension enabled\" if application-controlled extension is used; or\n2)\t\"normal\" if application-controlled extension is not used;\nd)\tone or more discovery filters allocated by the 5G DDNMF(s) for the ProSe application ID received in the DISCOVERY_REQUEST message from the UE; and\ne)\tthe current time set to the current UTC-based time at the 5G DDNMF and the max offset.\nIf timer T5065 expires, the 5G DDNMF shall remove the UE's association with the corresponding discovery filter. Furthermore, the 5G DDNMF shall remove the discovery entry from the UE's context if there is no discovery filter corresponding to the ProSe application ID.\nThe 5G DDNMF uses the information (e.g. application identity) received from the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA information related to TLS tunnel transporting the DISCOVERY_REQUEST message, and other information for charging purposes as specified in 3GPP TS 32.277 [45].\nUpon receipt of the DISCOVERY_RESPONSE message, if only the transaction ID and the discovery entry ID are contained in the <response-monitor> element and the transaction ID and the discovery entry ID match the corresponding values sent by the UE in a DISCOVERY_REQUEST message, the UE shall:\na)\tstop TTL timer T5064 for each discovery filter in the discovery entry identified by the discovery entry ID;\nb)\tremove the discovery entry identified by the discovery entry ID; and\nc)\tinstruct the lower layers to stop monitoring.\nUpon receipt of the DISCOVERY_RESPONSE message, if the transaction ID contained in the <response-monitor> element matches the value sent by the UE in a DISCOVERY_REQUEST message with the command set to \"monitor\", the UE shall, for each discovery filter assigned by the 5G DDNMF, stop TTL timer T5064 if running and start TTL timer T5064 with the received value. Otherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not perform the procedures below. The UE shall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset parameter.\nThe UE may perform open 5G ProSe direct discovery monitoring for discovery messages received over the PC5 interface as described in clause 6.2.14.2.1.4.\nIf the DISCOVERY_REQUEST message is not accepted by the 5G DDNMF, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element to the UE including an appropriate PC3a control protocol cause value.\nIf the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is not authorized for open 5G ProSe direct discovery monitoring, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #1 \"Invalid application\".\nIf the ProSe application ID contained in the DISCOVERY_REQUEST message is unknown to the 5G DDNMF, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #2 \"Unknown ProSe application ID\".\nIf the UE is not authorized for open 5G ProSe direct discovery monitoring, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the UE requests a country-specific ProSe application ID for a country that does not correspond to the country of its HPLMN and the 5G DDNMF has not authorized the UE to monitor in that country, it shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #8 \"Scope violation in Prose application ID\".\nIf the UE requests a country-specific ProSe application ID for a country that does not correspond to the country of its HPLMN and the 5G DDNMF has no agreement to access the country-specific ProSe application ID database of that country, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #8 \"Scope violation in Prose application ID\".\nIf the discovery entry ID contained in the DISCOVERY_REQUEST message is unknown to the 5G DDNMF and the requested timer is set to 0, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #10 \"Unknown or invalid discovery entry ID \".\nIf the 5G DDNMF cannot retrieve a valid ProSe application code corresponding to the ProSe application ID contained in the DISCOVERY_REQUEST message, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #17 \"No valid ProSe application code\".\nIf the UE is not authorized to use ACE, but the DISCOVERY_REQUEST message contains the ACE enabled indicator set to \"application-controlled extension enabled\", the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #12 \"UE unauthorized for discovery with application-controlled extension\".\nIf the DISCOVERY_REQUEST message does not contain the ACE enabled indicator and the requested application only uses application-controlled extension, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #1 \"Invalid application\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the monitor request procedure.\nNOTE 1:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nb)\tNo response from the 5G DDNMF after the DISCOVERY_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the DISCOVERY_REQUEST message)\nThe UE shall retransmit the DISCOVERY_REQUEST message.\nNOTE 2:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nNOTE 3:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nc)\tIndication from upper layers that the request to monitor the ProSe application ID is no longer in place after sending the DISCOVERY_REQUEST message, but before the monitor request procedure is completed\nThe UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G DDNMF but discard its contents and then abort the procedure.\nd)\tChange of PLMN\nIf a PLMN change occurs before the monitor request procedure is completed, the procedure shall be aborted. If the UE is authorized to monitor in the new PLMN, the procedures shall be restarted once the UE is registered on the new PLMN.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of DISCOVERY_RESPONSE message\nAfter receiving an indication from lower layer that the DISCOVEY_RESPONSE message has not been successfully acknowledged, the 5G DDNMF shall abort the procedure and stop any associated timer(s) T5065, if running.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.5\tMonitor request procedure for restricted 5G ProSe direct discovery model A",
                            "text_content": "The purpose of the monitor request procedure for restricted 5G ProSe direct discovery model A is:\na)\tto allow a UE participating in restricted 5G ProSe direct discovery model A to receive and process PROSE PC5 DISCOVERY messages upon a request for monitoring from upper layers as defined in 3GPP TS 23.304 [2]; or\nb)\tto inform the 5G DDNMF that the UE wants to stop using restricted discovery filter(s) for direct discovery monitoring as defined in 3GPP TS 23.304 [2].\nThe UE shall only initiate the restricted 5G ProSe direct discovery model A monitor request procedure if it has been authorized for restricted 5G ProSe direct discovery model A monitoring in at least in one PLMN based on the service authorization procedure.\nAs a result of the monitor request procedure completing successfully, the UE obtains one or more restricted discovery filters, along with a TTL (Time-To-Live) timer T5066 for each restricted discovery filter indicating the time during which the filter is valid.\nBefore initiating the monitor request procedure, the user sets the permissions for the restricted discovery using application layer mechanisms. The application client in the UE retrieves the PDUID provisioned to the UE as part of the service authorization procedure as specified in clause 5 and obtains an RPAUID associated with the UE's PDUID and the target RPAUID(s) to be monitored from the ProSe application server. This step is performed using mechanisms that are out of scope of the present specification.\nIf the UE is authorized to perform ProSe direct discovery model A monitoring in at least one PLMN, it shall initiate a monitor request procedure:\na)\twhen the UE is triggered by an upper layer application to perform restricted 5G ProSe direct discovery model A monitoring corresponding to at least one RPAUID and the UE has no valid restricted discovery filters corresponding to the requested RPAUID for that upper layer application;\nb)\twhen the TTL timer T5066 assigned by the 5G DDNMF to a Restricted discovery filter has expired and the request from upper layers to monitor that RPAUID is still in place; or\nNOTE 1:\tTo ensure service continuity if the UE needs to keep monitoring the same restricted discovery filter, the UE can initiate the monitor request procedure before the TTL timer T5066 assigned by the 5G DDNMF for a Restricted discovery filter expires.\nc)\twhen the UE needs to update a previously sent restricted 5G ProSe direct discovery model A monitoring request.\nThe UE shall initiate the monitor request procedure by sending a DISCOVERY_REQUEST message with:\na)\ta new transaction ID;\nb)\tthe RPAUID set to the RPAUID received from upper layers;\nc)\tthe command set to \"monitor\";\nd)\tthe discovery type set to \"Restricted discovery\";\ne)\tthe application identity set to the ProSe identifier of the upper layer application that requested the monitoring as specified in clause 5.2.3;\nf)\tthe ACE enabled indicator set to \"application-controlled extension enabled\" if application-controlled extension is required by the upper layers, or \"normal\" if application-controlled extension is not used;\ng)\tthe application level container set to the target RPAUIDs to monitor;\nh)\tthe discovery entry ID set to 0 if the monitoring request is a new request and set to the discovery entry ID received from the 5G DDNMF if the monitoring request is to update a previously sent monitoring request;\ni)\toptionally, the requested timer set to 0 only when the UE wants to stop using restricted discovery filter(s) for direct discovery monitoring; and\nj)\tthe PC5 UE ciphering algorithm capability set to the UE supported ciphering algorithm(s) for ciphering the PROSE PC5 DISCOVERY message.\nIf restricted direct discovery model A with application-controlled extension is requested by upper layers, the application level container included in the DISCOVERY_REQUEST also contains information corresponding to the ProSe restricted code suffix, e.g., group or user-specific information.\nNOTE 2:\tA UE can include one or multiple transactions in one DISCOVERY_REQUEST message for one or more different monitoring targets and receive corresponding <response-monitor> element or <response-reject> element in the DISCOVERY_RESPONSE message for each respective transaction. In the following description of the monitor request procedure, only one transaction is included.\nFigure 6.2.5.2.1 illustrates the interaction between the UE and the 5G DDNMF in the monitor request procedure.\nThe figure depicts a 5G ProSe direct discovery model A, which is a restricted model that allows for direct discovery of 5G services. It includes a monitor request procedure for the 5G ProSe direct discovery model A, which ensures that the request is processed correctly and that the service is available.\nFigure 6.2.5.2.1: Monitor request procedure for restricted 5G ProSe direct discovery model A\nUpon receiving a DISCOVERY_REQUEST message with the command set to \"monitor\" and the discovery type set to \"Restricted discovery\", if the requested timer is included in the DISCOVERY_REQUEST message and the requested timer is set to 0, the 5G DDNMF shall check whether there is an existing UE context containing the discovery entry identified by the discovery entry ID included in the DISCOVERY_REQUEST message. If the discovery entry exists in the UE context, the 5G DDNMF shall remove the discovery entry identified by the discovery entry ID from the UE's context. For each of the PDUIDs corresponding to the target RPAUIDs contained the restricted discovery filters in the discovery entry, if the PDUID is PLMN-specific and that PLMN ID indicated by the PDUID is not the same as that of the PLMN to which the 5G DDNMF belongs, the 5G DDNMF shall inform the 5G DDNMF in the PLMN indicated by the PDUID to remove the corresponding discovery entry as specified in 3GPP TS 29.555 [9].\nUpon receiving a DISCOVERY_REQUEST message with the command set to \"monitor\" and the discovery type set to \"Restricted discovery\", if the requested timer is not included in the DISCOVERY_REQUEST message, the 5G DDNMF shall perform the following procedure.\nThe 5G DDNMF shall check that the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is authorized for ProSe direct discovery model A monitoring. If the application is authorized for restricted 5G ProSe direct discovery model A monitoring, the 5G DDNMF shall check whether there is an existing UE context.\nIf there is no associated UE context, the 5G DDNMF checks with the UDM whether the UE is authorized for restricted 5G ProSe direct discovery model A monitoring as described in 3GPP TS 29.503 [10]. The UDM provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently registered. If the subscription check indicates that the UE is authorized, the 5G DDNMF creates a new UE context containing the UE's subscription parameters obtained from the UDM.\nIf the discovery entry ID included in the DISCOVERY_REQUEST is set to 0 then:\na)\tthe 5G DDNMF shall use the procedure described in 3GPP TS 29.557 [19] to pass the application level container included in the DISCOVERY_REQUEST message to the ProSe application server and obtain a list of PDUID(s) , an application level container and optionally Metadata Indicator(s) corresponding to the authorized target RPAUID(s) from the ProSe application server;\nb)\tif the ACE enabled indicator in the DISCOVERY_REQUEST message is set to \"application-controlled extension enabled\" and the requested application uses application-controlled extension, the 5G DDNMF shall check whether the UE is authorized to use ACE. If the UE is authorized for ACE, the 5G DDNMF shall also use the procedure described in 3GPP TS 29.557 [19] to obtain the mask(s) for monitoring a ProSe restricted suffix pool corresponding to each of the Target RPAUIDs.\nNOTE 1: The ProSe application server can reject the request for some of the target RPAUIDs included in the application level container in the DISCOVERY_REQUEST message because they are ineligible to be monitored by the requesting UE. Depending on the operator policy and application layer permissions, it is possible that only a subset of valid RPAUIDs is authorized by the ProSe application server.\nc)\tfor each of the PDUIDs corresponding to an authorized target RPAUID, if the PLMN ID of the PDUID is not the same as that of the PLMN to which the 5G DDNMF belongs, then the 5G DDNMF executes the procedures defined in 3GPP TS 29.555 [9] to obtain the ProSe restricted code or ProSe restricted code prefix for the target RPAUID and creates restricted discovery filter(s). Otherwise, for each target RPAUID, the 5G DDNMF shall allocate one or more restricted discovery filter(s). If the ACE enabled indicator in the DISCOVERY_REQUEST message does not match the ACE configuration in the 5G DDNMF or ProSe application server for this application, the ACE configuration in the 5G DDNMF or ProSe application server shall be used to create Restricted discovery filter(s). Each Restricted discovery filter consists of a ProSe restricted code, one or more masks, a TTL timer T5066, optionally the target RPAUID, optionally a metadata indicator and optionally metadata associated with this RPAUID;\nd)\tthe 5G DDNMF associates the restricted discovery filters with a new discovery entry in the UE's context; and\ne)\tthe 5G DDNMF starts timer T5067 assigned for each Restricted discovery filter. For a given restricted discovery filter, timer T5067 shall be longer than timer T5066. By default, the value of timer T5067 is 4 minutes greater than the value of timer T5066.\nNOTE 2: For each target RPAUID, the 5G DDNMF either allocates one restricted discovery filter for full-matching the ProSe restricted code assigned to this RPAUID, or allocates one or more restricted discovery filter(s) for matching the ProSe restricted code prefix and suffix pool assigned to this RPAUID.\nIf the discovery entry ID included in the DISCOVERY_REQUEST message is not set to 0 and if there is an existing discovery entry for this discovery entry ID in the UE's context, the 5G DDNMF shall check whether the UE is authorized for restricted 5G ProSe direct discovery model A monitoring. If the UE is authorized, the 5G DDNMF shall process the request as above-mentioned and update this discovery entry with the contents of the restricted discovery filter(s) associated with this discovery entry and restart timer T5067(s) for each filter. The update of a restricted discovery filter content includes setting new TTL timer(s) and if necessary, obtaining new ProSe restricted code and ProSe restricted mask(s) via the procedure defined in 3GPP TS 29.555 [9].\nIf the discovery entry ID contained in the DISCOVERY_REQUEST message is not found in the UE context or there is no UE context in the 5G DDNMF, the 5G DDNMF shall behave as if the discovery entry ID included in the DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a new non-zero discovery entry ID for this entry.\nThen the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <restricted-monitor-response> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the DISCOVERY_REQUEST message from the UE;\nb)\tone or more restricted discovery filter(s) allocated by the 5G DDNMF(s) for the authorized target RPAUID(s);\nc)\tthe ACE enabled indicator set to \"application-controlled extension enabled\" if application-controlled extension is used, or \"normal\" if application-controlled extension is not used;\nd)\tthe discovery entry ID set to the ID of the discovery entry associated with this monitor request;\ne)\tthe application level container set to the application-level data received from the ProSe application server;\nf)\tthe coding-receiving security parameter containing the security-related information needed by the UE to undo the protection applied by the announcing UE;\ng)\tthe current time set to the current UTC-based time at the 5G DDNMF and the max offset;\nh)\toptionally, the PC5 security policies that are associated with the ProSe restricted code and used for 5G ProSe direct link establishment procedure instead of any PC5 security policies configured in the UE as specified in clause 5; and\ni)\tthe selected PC5 ciphering algorithm set to the PC5 ciphering algorithm selected by the 5G DDNMF if the received PC5 UE ciphering algorithm capability includes the selected PC5 ciphering algorithm associated with the ProSe restricted code corresponding to the restricted discovery filter(s).\nIf T5067 expires, the 5G DDNMF shall remove the corresponding restricted discovery filter from the discovery entry in the UE's context. Furthermore, if there are no valid restricted discovery filters associated with the discovery entry (e.g., all restricted discovery filters have expired), the 5G DDNMF shall delete the discovery entry from the UE's context.\nThe 5G DDNMF uses the information (e.g. application identity) received from the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA information related to TLS tunnel transporting the DISCOVERY_REQUEST message, and other information for charging purposes as specified in 3GPP TS 32.277 [45].\nUpon receipt of the DISCOVERY_RESPONSE message, if only the transaction ID and the discovery entry ID are contained in <restricted-monitor-response> element and the transaction ID and the discovery entry ID match the corresponding values sent by the UE in a DISCOVERY_REQUEST message with the command set to \"monitor\", the UE shall:\na)\tstop TTL timer T5066 for each Restricted discovery filter in the discovery entry identified by the discovery entry ID;\nb)\tremove the discovery entry identified by the discovery entry ID; and\nc)\tinstruct the lower layers to stop monitoring.\nUpon receipt of the DISCOVERY_RESPONSE message, if the transaction ID contained in the <restricted-monitor-response> element matches the value sent by the UE in a DISCOVERY_REQUEST message with the command set to \"monitor\" and, the UE shall process as follow:\na)\tif the DISCOVERY_RESPONSE creates a new discovery entry, start the TTL timer T5066 with the received value for each restricted discovery filter information element received in the DISCOVERY_RESPONSE message; or\nb)\tif the DISCOVERY_RESPONSE updates an existing discovery entry, the UE shall\n1)\tstop the T5066 timer(s) of any restricted discovery filter in this discovery entry which are no longer authorized by the 5G DDNMF, ask lower layers to stop using those filters in monitoring operation and remove the corresponding restricted discovery filter from the discovery entry;\n2)\trestart the T5066 timer(s) for those remain eligible; and\n3)\tstart the T5066 timer(s) for any new restricted discovery filter(s) included in the DISCOVERY_RESPONSE message.\nOtherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not perform the procedures below. The UE shall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset parameter.\nThe UE shall store the selected PC5 ciphering algorithm received in the DISCOVERY_RESPONSE message for the received ProSe restricted code and use it for decryption of the restricted 5G ProSe direct discovery messages over the PC5 interface as specified in clause 6.1.3.2.3 of 3GPP TS 33.503 [34].\nThe UE may perform monitoring for discovery messages received over the PC5 interface as described in clause 6.2.14.2.1.4.\nIf the DISCOVERY_REQUEST message is not accepted by the 5G DDNMF, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element to the UE including an appropriate PC3a control protocol cause value.\nIf the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is not authorized for ProSe direct discovery monitoring, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #1 \"Invalid application\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message is unknown to the ProSe application server, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #9 \"Unknown RPAUID\".\nIf none of the RPAUID(s) contained in the application level container in the DISCOVERY_REQUEST message is eligible to be discovered by the requesting RPAUID, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #11 \"Invalid discovery target\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message does not match the stored RPAUID for the requested discovery entry ID, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #10 \"Unknown or invalid discovery entry ID\".\nIf the UE is not authorized for restricted 5G ProSe direct discovery monitoring, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message is not associated with a PDUID belonging to the requesting UE, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the UE is not authorized to use ACE, but the DISCOVERY_REQUEST message contains the ACE enabled indicator set to \"application-controlled extension enabled\", the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #12 \"UE unauthorized for discovery with application-controlled extension\".\nIf the discovery entry ID contained in the DISCOVERY_REQUEST message is unknown to the 5G DDNMF and the requested timer is set to 0, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #10 \"Unknown or invalid discovery entry ID\".\nIf the PC5 UE ciphering algorithm capability contained in the DISCOVERY_REQUEST message is not compatible with the selected PC5 ciphering algorithm for the target ProSe restricted code, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #19 \"Not compatible PC5 UE ciphering algorithm capability\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the monitor request procedure.\nNOTE 1:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nb)\tNo response from the 5G DDNMF after the DISCOVERY_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the DISCOVERY_REQUEST message)\nThe UE shall retransmit the DISCOVERY_REQUEST message.\nNOTE 2:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nNOTE 3:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nc)\tIndication from upper layers that the request to monitor the targets contained in application level container is no longer in place after sending the DISCOVERY_REQUEST message, but before the monitor request procedure is completed\nThe UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G DDNMF but discard its contents and then abort the procedure.\nd)\tChange of PLMN\nIf a PLMN change occurs before the monitor request procedure is completed, the procedure shall be aborted. If the UE is authorized to monitor in the new PLMN, the procedures shall be restarted once the UE is registered on the new PLMN.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of DISCOVERY_RESPONSE message\nAfter receiving an indication from lower layer that the DISCOVERY_RESPONSE message has not been successfully acknowledged, the 5G DDNMF shall abort the procedure and stop any associated timer(s) T5067, if running.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.6\tDiscoveree request procedure for restricted 5G ProSe direct discovery model B",
                            "text_content": "The purpose of the discoveree request procedure for restricted 5G ProSe direct discovery model B is for the UE to obtain discovery query filter(s) to be used for monitoring a model B query for a RPAUID over the PC5 interface and a ProSe response code to be announced over the PC5 interface as a response to a model B query, as defined in 3GPP TS 23.304 [2].\nBefore initiating the discoveree request procedure, the UE shall be authorised for restricted 5G ProSe direct discovery model B discoveree operation in the registered PLMN or the local PLMN based on the service authorization procedure as specified in clause 5.\nAs the result of successful completion of this procedure, the UE obtains one or more discovery query filters and applies them to the monitoring operation in PC5 interface. The UE shall also include the ProSe response code in a PROSE PC5 DISCOVERY message and passes the message to the lower layers for transmission over the PC5 interface when there is a match of the discovery query filter(s).\nBefore initiating the discoveree request procedure, the user sets the permissions for the restricted discovery using application layer mechanisms. The application client in the UE retrieves the PDUID provisioned to the UE as part of the service authorization procedure as specified in clause 5 and obtains a RPAUID associated with the UE's PDUID from the ProSe application server. The UE can provide metadata to be associated with the RPAUID and the ProSe application server stores the metadata. This step is performed using mechanisms that are out of scope of the present specification.\nIf the UE is authorised to perform restricted 5G ProSe direct discovery model B discoveree operation in the PLMN operating the radio resources signalled from the serving PLMN, it shall initiate a discoveree request procedure:\na)\twhen the UE is triggered by an upper layer application to announce a RPAUID in Model B and the UE has no valid corresponding ProSe response code and discovery query filter(s) for that RPAUID of the upper layer application;\nb)\twhen the validity timer T5068 assigned by the 5G DDNMF to a ProSe response code and the corresponding discovery query filter(s) has expired and the request from upper layers to announce the RPAUID corresponding to that ProSe response code is still in place;\nc)\twhen the UE selects a new PLMN while announcing or waiting for announcing a ProSe response code and intends to announce in the new PLMN and the UE is authorised for restricted 5G ProSe direct discovery model B discoveree operation in the new PLMN, and the UE does not have a valid allocated ProSe response code for this new PLMN yet; or\nd)\twhen the UE needs to update a previously sent restricted 5G ProSe direct discovery model B discoveree request.\nWhen the UE selects a new PLMN while announcing or waiting for announcing a ProSe response code and the UE is not yet authorised for restricted 5G ProSe direct discovery model B discoveree operation in the new PLMN, the UE shall initiate a discoveree request procedure only after the UE is authorised for restricted 5G ProSe direct discovery model B discoveree operation in the new PLMN.\nNOTE 1:\tTo ensure service continuity if the UE needs to keep announcing in Model B a ProSe response code  corresponding to the same RPAUID, the UE can initiate the discoveree request procedure before the validity timer T5068 assigned by the 5G DDNMF for a ProSe response code expires.\nThe UE shall initiate the discoveree request procedure by sending a DISCOVERY_REQUEST message with:\na)\ta new transaction ID not used in any other direct discovery procedures in PC3a interface;\nb)\tthe RPAUID set to the RPAUID received from upper layers;\nc)\tthe command set to \"response\";\nd)\tthe application identity set to the ProSe identifier of the upper layer application that requested the announcing as specified in clause 5.2.3;\ne)\tthe discovery type set to \"Restricted discovery\";\nf)\tthe discovery model set to \"Model B\";\ng)\tthe discovery entry ID set to a 0 if the discoveree request is a new request and set to the discovery entry ID received from the 5G DDNMF if the discoveree request is to update a previously sent discoveree request;\nh)\toptionally the announcing PLMN ID set to the PLMN ID of the local PLMN operating the radio resources that the UE intends to use for announcing the RPAUID; and\ni)\tthe PC5 UE ciphering algorithm capability set to the UE supported ciphering algorithm(s) for ciphering the PROSE PC5 DISCOVERY message.\nNOTE 2:\tA UE can include one or multiple transactions in one DISCOVERY_REQUEST message for different RPAUIDs (e.g., for different applications) and receive corresponding <restricted-discoveree-response> element or <response-reject> element in a DISCOVERY_RESPONSE message for each respective transaction. In the following description of the discoveree request procedure, only one transaction is included.\nFigure 6.2.6.2.1 illustrates the interaction of the UE and the 5G DDNMF in the discoveree request procedure.\nThe figure depicts a simplified representation of the Discoveree request procedure for the restricted 5G ProSe direct discovery model B, which is a method used in 5G networks to enable direct communication between devices. The figure shows the steps involved in the request process, including the sender's request, the receiver's response, and the subsequent communication between the sender and receiver. The figure is a crucial visual aid in understanding the process and its implications for 5G networks.\nFigure 6.2.6.2.1: Discoveree request procedure for restricted 5G ProSe direct discovery model B\nUpon receiving a DISCOVERY_REQUEST message, the 5G DDNMF shall check that the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is authorised for restricted 5G ProSe direct discovery model B discoveree operation. If the application is authorised for restricted 5G ProSe direct discovery model B discoveree operation, the 5G DDNMF shall check whether there is an existing context for the UE.\nIf there is no associated UE context, the 5G DDNMF checks with the UDM whether the UE is authorised for restricted 5G ProSe direct discovery model B discoveree operation as described in 3GPP TS 29.503 [10]. If the check indicates that the UE is authorised, the 5G DDNMF creates a UE context that contains the UE's subscription parameters obtained from the UDM. The UDM also provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently registered.\nIf the UE context exists, the 5G DDNMF shall check whether the UE is authorized for restricted 5G ProSe direct discovery model B discoveree operation in the currently registered PLMN or the local PLMN identified by the Announcing PLMN ID included in the DISCOVERY_REQUEST message.\nIf the UE is authorized and the discovery entry ID included in the DISCOVERY_REQUEST message is set to 0 then:\na)\tthe 5G DDNMF shall check whether the UE is authorised to announce the RPAUID contained in the DISCOVERY_REQUEST message. Optionally this can include checking with the ProSe application server as described in 3GPP TS 29.557 [19] to obtain the binding between the RPAUID and PDUID and then verifying that the PDUID belongs to the requesting UE;\nb)\tif the UE is authorised to announce the RPAUID, the 5G DDNMF shall allocate the corresponding ProSe response code and ProSe query code for the RPAUID. It shall also allocate discovery query filter(s) based on the allocated ProSe query code. Then it shall assign a value for validity timer T5068, which is associated with the ProSe response code, ProSe query code and discovery query filter(s); and\nc)\tthe 5G DDNMF associates the allocated ProSe response code, ProSe query code and discovery query filter with a new discovery entry ID in the UE context and starts timer T5069. For a given ProSe response code, timer T5069 shall be longer than timer T5068. By default, the value of timer T5069 is 4 minutes greater than the value of timer T5068.\nIf the discovery entry ID included in the DISCOVERY_REQUEST message is not set to 0 and if there is an existing discovery entry for this discovery entry ID value in the UE context, the 5G DDNMF shall either update the discovery entry with a new validity timer T5068, or allocate a new ProSe response code, ProSe query code and the discovery query filter(s) for the requested RPAUID with a new validity timer T5068, restart timer T5069.\nIf the discovery entry ID contained in the DISCOVERY_REQUEST message is not found in the UE context or there is no UE context in the 5G DDNMF, the 5G DDNMF shall behave as if the discovery entry ID included in the DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a new non-zero discovery entry ID for this entry.\nIf a new UE context was created or an existing UE context was updated and the UE is currently roaming or the Announcing PLMN ID is included in the DISCOVERY_REQUEST message, the 5G DDNMF checks with the 5G DDNMF of the VPLMN or the local PLMN identified by the Announcing PLMN ID whether the UE is authorised for restricted 5G ProSe direct discovery model B discoveree operation as described in 3GPP TS 29.555 [9].\nThe 5G DDNMF shall then send a DISCOVERY_RESPONSE message containing a <restricted-discoveree-response> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the DISCOVERY_REQUEST message from the UE;\nb)\tthe ProSe response code set to the ProSe response code allocated for the RPAUID received in the DISCOVERY_REQUEST message;\nc)\tone or more discovery query filters set to the ProSe query filter(s) used to match a query for the RPAUID received in the DISCOVERY_REQUEST message;\nd)\ta validity timer T5068 set to the T5068 timer value assigned by the 5G DDNMF to the ProSe response code and the discovery query filter(s);\ne)\tthe code-sending security parameter containing the security-related information for the discoveree UE to protect the transmission of the ProSe response code;\nf)\tthe code-receiving security parameter containing the security-related information needed by the discoveree UE to undo the protection applied by the discoverer UE;\ng)\tthe discovery entry ID set to the ID of the discovery entry associated with this discoveree request in the UE context;\nh)\tthe current time set to the current UTC-based time at the 5G DDNMF and the max offset;\ni)\toptionally, the PC5 security policies that are associated with the ProSe response code and used for 5G ProSe direct link establishment procedure instead of any PC5 security policies configured in the UE as specified in clause 5; and\nj)\tthe selected PC5 ciphering algorithm set to the PC5 ciphering algorithm selected by the 5G DDNMF if the received PC5 UE ciphering algorithm capability includes the selected PC5 ciphering algorithm associated with the ProSe response code corresponding to the discovery query filters.\nIf timer T5069 expires, the 5G DDNMF shall remove the discovery entry associated with the corresponding RPAUID from the UE's context.\nThe 5G DDNMF may associate the ProSe response code with the PC5 security policies.\nThe 5G DDNMF uses the information (e.g. application identity) received from the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA information related to TLS tunnel transporting the DISCOVERY_REQUEST message, and other information for charging purposes as specified in 3GPP TS 32.277 [45].\nUpon receipt of the DISCOVERY_RESPONSE message, if the transaction ID contained in the <restricted-discoveree-response> element matches the value sent by the UE in a DISCOVERY_REQUEST message with the command set to \"response\", the UE shall create a new discovery entry or update an existing discovery entry with the ProSe response code and discovery query filter(s) received in the DISCOVERY_RESPONSE message and the PLMN ID of the intended announcing PLMN. For this discovery entry, the UE shall stop the validity timer T5068 if running and start the validity timer T5068 with the received value. The UE shall also use the received ProSe response code and discovery query filter(s) to replace the old counterparts if they are currently used. This may involve notifying the lower layers to stop announcing the old ProSe response code or to stop monitoring with the old discovery query filter(s). Otherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not perform the procedures described in clause 6.2.14.2.2.3. The UE shall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset parameter.\nThe UE shall store the selected PC5 ciphering algorithm received in the DISCOVERY_RESPONSE message for the ProSe response code and the ProSe query code and the UE shall use it for protection of the restricted 5G ProSe direct discovery messages over the PC5 interface as specified in clause 6.1.3.2.3 of 3GPP TS 33.503 [34].\nIf the DISCOVERY_REQUEST message cannot be accepted by the 5G DDNMF, the 5G DDNMF sends a DISCOVERY_RESPONSE message containing a <response-reject> element to the UE including an appropriate PC3a control protocol cause value.\nIf the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is not authorised for ProSe direct discovery Model B discoveree operation, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #1 \"Invalid application\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message is unknown to the 5G DDNMF or ProSe application server, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #9 \"Unknown RPAUID\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message does not match the stored RPAUID for the requested discovery entry ID, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #10 \"Unknown or invalid discovery entry ID\".\nIf the UE is not authorised for restricted 5G ProSe direct discovery model B discoveree operation, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message is not associated with a PDUID belonging to the requesting UE, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the PC5 UE ciphering algorithm capability contained in the DISCOVERY_REQUEST message is not compatible with the selected PC5 ciphering algorithm for the ProSe response code and the ProSe query code, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #19 \"Not compatible PC5 UE ciphering algorithm capability\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the discoveree request procedure.\nNOTE 1:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nb)\tNo response from the 5G DDNMF after the DISCOVERY_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the DISCOVERY_REQUEST message)\nThe UE shall retransmit the DISCOVERY_REQUEST message.\nNOTE 2:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nNOTE 3:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nc)\tIndication from upper layers that the request to announce the RPAUID in model B is no longer in place after sending the DISCOVERY_REQUEST message, but before the discoveree request procedure is completed\nThe UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G DDNMF but discard its contents and then abort the procedure.\nd)\tChange of PLMN\nIf a PLMN change occurs before the discoveree request procedure is completed, the procedure shall be aborted. If the UE is authorized to perform restricted 5G ProSe direct discovery model B discoveree operation in the new PLMN, the procedure shall be restarted once the UE is registered on the new PLMN.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of DISCOVERY_RESPONSE message\nAfter receiving an indication from lower layer that the DISCOVERY_RESPONSE message has not been successfully acknowledged (e.g. TCP ACK is not received), the 5G DDNMF shall abort the procedure and stop any associated timer(s) T5069, if running.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.7\tDiscoverer request procedure for restricted 5G ProSe direct discovery model B",
                            "text_content": "The purpose of the discoverer request procedure for restricted 5G ProSe direct discovery model B is for the UE to obtain ProSe query code(s) and discovery response filter(s) to be used for sending query and monitoring responses over the PC5 interface based on the information provided by the upper layer application, as defined in 3GPP TS 23.304 [2].\nBefore initiating the discoverer request procedure, the UE shall be authorised for restricted 5G ProSe direct discovery model B discoverer operation in the registered PLMN or the local PLMN based on the service authorization procedure as specified in clause 5.\nAs the result of successful completion of this procedure, the UE obtains one or more ProSe query code(s) which can be included in a PROSE PC5 DISCOVERY message and passes the PROSE PC5 DISCOVERY message to the lower layers for transmission over the PC5 interface. The UE also obtains discovery response filter(s) and apply it to the monitoring operation in PC5 interface to match potential responses for the sent query request for the target RPAUID.\nBefore initiating the discoverer request procedure, the user sets the permissions for the restricted discovery using application layer mechanisms. The application client in the UE retrieves the PDUID provisioned to the UE as part of the service authorization procedure as specified in clause 5 and obtains a RPAUID associated with the UE's PDUID from the ProSe application server. The UE can also obtain the target RPAUID(s) from the ProSe application server. This step is performed using mechanisms that are out of scope of the present specification.\nIf the UE is authorised to perform restricted 5G ProSe direct discovery model B discoverer operation in the PLMN operating the radio resources signalled from the serving PLMN, it shall initiate a discoverer request procedure:\na)\twhen the UE is triggered by an upper layer application to perform the query for one or more target RPAUIDs in Model B and the UE has no valid corresponding ProSe query code and discovery response filter for those target RPAUIDs of the upper layer application;\nb)\twhen the validity timer T5070 assigned by the 5G DDNMF to a ProSe query codes and the corresponding discovery response filter has expired and the request from upper layers to announce the RPAUID corresponding to that ProSe query code is still in place;\nc)\twhen the UE selects a new PLMN while announcing a ProSe query code or waiting for a ProSe response code and intends to announce the ProSe query code in the new PLMN and the UE is authorised for restricted 5G ProSe direct discovery model B discoverer operation in the new PLMN, and the UE does not have a valid ProSe query code and discovery response filter for the target RPAUIDs for this new PLMN yet; or\nd)\twhen the UE needs to update a previously sent restricted 5G ProSe direct discovery model B discoverer request.\nWhen the UE selects a new PLMN while announcing a ProSe query code or waiting for a ProSe response code and the UE is not yet authorised for restricted 5G ProSe direct discovery model B discoverer operation in the new PLMN, the UE shall initiate a discoverer request procedure only after the UE is authorised for restricted 5G ProSe direct discovery model B discoverer operation in the new PLMN.\nNOTE 1:\tTo ensure service continuity if the UE needs to keep announcing in Model B a ProSe query code  corresponding to the same RPAUID, the UE can initiate the discoverer request procedure before the validity timer T5070 assigned by the 5G DDNMF for a ProSe query code expires.\nThe UE shall initiate the discoverer request procedure by sending a DISCOVERY_REQUEST message with:\na)\ta new transaction ID not used in any other direct discovery procedures in PC3a interface;\nb)\tthe RPAUID set to the RPAUID received from upper layers;\nc)\tthe application level container set to contain the application-layer information, e.g., target RPAUID(s) to discover;\nd)\tthe command set to \"query\";\ne)\tthe application identity set to the ProSe identifier of the upper layer application that requested the announcing as specified in clause 5.2.3;\nf)\tthe discovery type set to \"Restricted discovery\";\ng)\tthe discovery model set to \"Model B\";\nh)\tthe discovery entry ID set to a 0 if the discoverer request is a new request and set to the discovery entry ID received from the 5G DDNMF if the discoverer request is to update a previously sent discoverer request;\ni)\toptionally the Announcing PLMN ID set to the PLMN ID of the local PLMN operating the radio resources that the UE intends to use for transmitting the query for the target RPAUID(s); and\nj)\tthe PC5 UE ciphering algorithm capability set to the UE supported ciphering algorithm(s) for ciphering the PROSE PC5 DISCOVERY message.\nNOTE 2:\tA UE can include one or multiple transactions in one DISCOVERY_REQUEST message for different discovering requests (e.g., for different applications) and receive corresponding <restricted-discoverer-response> element or <response-reject> element in a DISCOVERY_RESPONSE message for each respective transaction. In the following description of the discoverer request procedure, only one transaction is included.\nFigure 6.2.7.2.1 illustrates the interaction of the UE and the 5G DDNMF in the discoverer request procedure.\nThe figure depicts a detailed procedure for the Discoverer request procedure in the restricted 5G ProSe direct discovery model B, which is a part of the 5G network architecture. The figure illustrates the steps involved in requesting a discovery of a specific device or service, including the use of a Discoverer, the request process, and the response from the device or service. The figure is crucial for understanding the communication process in the 5G network and for implementing the required protocols.\nFigure 6.2.7.2.1: Discoverer request procedure for restricted 5G ProSe direct discovery model B\nUpon receiving a DISCOVERY_REQUEST message, the 5G DDNMF shall check that the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is authorised for restricted 5G ProSe direct discovery model B discoverer operation. If the application is authorised for restricted 5G ProSe direct discovery model B discoverer operation, the 5G DDNMF shall check whether there is an existing context for the UE.\nIf there is no associated UE context, the 5G DDNMF checks with the UDM whether the UE is authorised for restricted 5G ProSe direct discovery model B discoverer operation as described in 3GPP TS 29.503 [10]. If the check indicates that the UE is authorised, the 5G DDNMF creates a UE context that contains the UE's subscription parameters obtained from the UDM. The UDM also provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently registered.\nIf the UE context exists, the 5G DDNMF shall check whether the UE is authorized for restricted 5G ProSe direct discovery model B discoveree operation in the currently registered PLMN or the local PLMN identified by the Announcing PLMN ID included in the DISCOVERY_REQUEST message.\nIf the UE is authorized and the discovery entry ID included in the DISCOVERY_REQUEST message is set to 0 then:\na)\tthe 5G DDNMF uses the procedure described in 3GPP TS 29.557 [19] to pass the application level container included in the DISCOVERY_REQUEST message to the ProSe application server and obtain a list of PDUID(s) corresponding to the authorised target RPAUID(s) from the ProSe application server;\nb)\tfor each of the PDUIDs corresponding to an authorised target RPAUID:\n1)\tif the PLMN ID of the PDUID is not the same as that of the PLMN to which the 5G DDNMF belongs, then the 5G DDNMF executes the procedures defined in 3GPP TS 29.555 [9] to obtain the ProSe query code, the ProSe response code, the associated validity timer T5070 and optionally metadata associated with this target RPAUID. Otherwise, the 5G DDNMF shall locate the discoveree UE context and retrieve the corresponding ProSe query code and ProSe response code and the validity timer T5070 and optionally metadata associated with this RPAUID. Then, the 5G DDNMF in the HPLMN builds one or more discovery response filter(s) based on the respective ProSe response code and associate the discovery response filter(s) and ProSe query code with a new validity timer T5071 based on the remaining value of T5071; and\nNOTE 1:\tIf the 5G DDNMF cannot retrieve the corresponding discoveree UE context for a target RPAUID, e.g., the target RPAUID has not yet been requested to be discovered by Model B in a discoveree request procedure, or the discoveree UE context expires, the 5G DDNMF can skip the processing of this target RPAUID.\nNOTE 2:\tThe 5G DDNMF can choose the value of T5070 to be longer than the remaining value of T5069, so that the discoverer UE sends a new discoverer request for renewing the query-related information no earlier than the discoveree UE renewing its own ProSe response code with the 5G DDNMF.\n2)\tthe 5G DDNMF associates the ProSe query code and corresponding discovery response filter(s), target RPAUID and optionally metadata associated with the target RPAUID with a new discovery entry in the discoverer UE's context; and\nc)\tthe 5G DDNMF starts timer T5071 assigned for each ProSe query code and discovery response filter(s) (of each target RPAUID) under this discovery entry of the discoverer UE context. For a given ProSe query code and the corresponding discovery response filter(s), timer T5071 shall be longer than timer T5070. By default, the value of timer T5071 is 4 minutes greater than the value of timer T5070.\nIf the discovery entry ID included in the DISCOVERY_REQUEST message is not set to 0 and if there is an existing discovery entry for this discovery entry ID value in the UE's context, the 5G DDNMF shall still process the above steps, but update the discovery entry instead of creating a new discovery entry.\nIf the discovery entry ID contained in the DISCOVERY_REQUEST message is not found in the UE context or there is no UE context in the 5G DDNMF, the 5G DDNMF shall behave as if the discovery entry ID included in the DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a new non-zero discovery entry ID for this entry.\nIf a new UE context was created or an existing UE context was updated, the UE is currently roaming or the announcing PLMN ID is included in the DISCOVERY_REQUEST message, the 5G DDNMF checks with the 5G DDNMF of the VPLMN or the local PLMN indicated by the announcing PLMN ID whether the UE is authorised for restricted 5G ProSe direct discovery model B discoverer operation as described in 3GPP TS 29.555 [9].\nThe 5G DDNMF shall then send a DISCOVERY_RESPONSE message containing a <restricted-discoverer-response> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the DISCOVERY_REQUEST message from the UE;\nb)\tone or more Subquery Result information elements, each of which includes:\n1)\ta target RPAUID;\n2)\tthe ProSe query code set to the ProSe query code for the target RPAUID;\n3)\tone or more discovery response filters which are set to the discovery response filter(s) used to match a potential ProSe response code responding to the ProSe query code;\n4)\ta validity timer T5070 set to the T5070 timer value assigned by the 5G DDNMF to the ProSe query code and the discovery response filter(s);\n5)\toptionally, the metadata associated with the target RPAUID;\n6)\tthe code-sending security parameter containing the security-related information needed by the discoverer UE to protect the transmission of ProSe query code; and\n7)\tthe code-receiving security parameter containing the security-related information needed by the discoverer UE to undo the protection applied by the discoveree UE;\nc)\tthe discovery entry ID set to the ID of the discovery entry associated with this announce request in the UE context;\nd)\tthe current time set to the current UTC-based time at the 5G DDNMF and the max offset;\ne)\toptionally, the PC5 security policies that are associated with the ProSe response code and used for 5G ProSe direct link establishment procedure instead of any PC5 security policies configured in the UE as specified in clause 5; and\nf)\tthe selected PC5 ciphering algorithm set to the PC5 ciphering algorithm selected by the 5G DDNMF if the received PC5 UE ciphering algorithm capability includes the selected PC5 ciphering algorithm associated with the ProSe response code corresponding to the discovery response filters.\nIf T5071 expires, the 5G DDNMF shall remove the corresponding ProSe query code and ProSe response filter(s) from the discovery entry associated with the discoverer UE's context.\nThe 5G DDNMF uses the information (e.g. application identity) received from the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA information related to TLS tunnel transporting the DISCOVERY_REQUEST message, and other information for charging purposes as specified in 3GPP TS 32.277 [45].\nUpon receipt of the DISCOVERY_RESPONSE message, if the transaction ID contained in the <restricted-discoverer-response> element matches the value sent by the UE in a DISCOVERY_REQUEST message with the command set to \"query\" and the discovery model set to \"Model B\", the UE shall, process as follow:\na)\tIf the DISCOVERY_RESPONSE creates a new discovery entry, start the validity timer T5070 with the received value for the ProSe query code and the corresponding Discovery Response Filter(s) included for each SubQuery-Result information element received in the DISCOVERY_RESPONSE message and the PLMN ID of the intended announcing PLMN if included in the DISCOVERY_REQUEST message; or\nb)\tIf the DISCOVERY_RESPONSE updates an existing discovery entry, the UE shall:\n1)\tstop the timer T5070 of any ProSe query code(s) and discovery response filter(s) in this discovery entry which are no longer authorized by the 5G DDNMF, ask lower layers to stop announcing the ProSe query code(s) and monitoring ProSe response filter(s) and remove the ProSe query code(s) and discovery response filter(s) from the existing discovery entry;\n2)\trestart the T5070 timer(s) for those remain eligible;\n3)\tstart the T5070 timer(s) for any new ProSe query codes and their corresponding discovery response filter(s); and\n4)\tupdate the PLMN ID of the intended announcing PLMN for this discovery entry if included in the DISCOVERY_REQUEST message.\nOtherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not perform the discoverer UE procedure for 5G ProSe direct discovery as described in clause 6.2.14.2.2.2. The UE shall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset parameter.\nThe UE shall store the selected PC5 ciphering algorithm received in the DISCOVERY_RESPONSE message and use it for protection of the restricted 5G ProSe direct discovery messages over the PC5 interface as specified in clause 6.1.3.2.3 of 3GPP TS 33.503 [34].\nFor each ProSe query code in this discovery entry, the UE performs the discoverer UE procedure for 5G ProSe direct discovery to announce the ProSe query code in the PC5 interface, as described in clause 6.2.14.2.2.2.\nIf the DISCOVERY_REQUEST message cannot be accepted by the 5G DDNMF, the 5G DDNMF sends a DISCOVERY_RESPONSE message containing a <response-reject> element to the UE including an appropriate PC3a control protocol cause value.\nIf the application corresponding to the ProSe identifier contained in the DISCOVERY_REQUEST message is not authorised for restricted 5G ProSe direct discovery Model B discoverer operation, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #1 \"Invalid application\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message is unknown to the 5G DDNMF or ProSe application server, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #9 \"Unknown RPAUID\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message does not match the stored RPAUID for the requested discovery entry ID, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #10 \"Unknown or invalid discovery entry ID\".\nIf the UE is not authorised for restricted 5G ProSe direct discovery model B discoverer operation, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the RPAUID contained in the DISCOVERY_REQUEST message is not associated with a PDUID belonging to the requesting UE, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nIf the 5G DDNMF fails to retrieve any valid target PDUIDs from ProSe application server based on the application level container contained in the DISCOVERY_REQUEST message, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #11 \"Invalid discovery target\".\nIf the 5G DDNMF fails to retrieve any valid discoveree UE contexts for the valid target RPAUIDs contained in the application level container contained in the DISCOVERY_REQUEST message, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #11 \"Invalid discovery target\".\nIf the PC5 UE ciphering algorithm capability contained in the DISCOVERY_REQUEST message is not compatible with the selected PC5 ciphering algorithm for the ProSe response code and the ProSe query code, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #19 \"Not compatible PC5 UE ciphering algorithm capability\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the discoverer request procedure.\nNOTE 1:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nb)\tNo response from the 5G DDNMF after the DISCOVERY_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the DISCOVERY_REQUEST message)\nThe UE shall retransmit the DISCOVERY_REQUEST message.\nNOTE 2:\tThe UE can abort this procedure when detecting loss of NG-RAN coverage in its serving PLMN.\nNOTE 3:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nc)\tIndication from upper layers that the request to discover the target RPAUID(s) is no longer in place after sending the DISCOVERY_REQUEST message, but before the discoverer request procedure is completed\nThe UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G DDNMF but discard its contents and then abort the procedure.\nd)\tChange of PLMN\nIf a PLMN change occurs before the discoverer request procedure is completed, the procedure shall be aborted. If the UE is authorized to perform restricted 5G ProSe direct discovery discoverer operation Model B in the new PLMN, the procedure shall be restarted once the UE is registered on the new PLMN.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of DISCOVERY_RESPONSE message\nAfter receiving an indication from lower layer that the DISCOVERY_RESPONSE message has not been successfully acknowledged (e.g., TCP ACK is not received), the 5G DDNMF shall abort the procedure and stop any associated timer(s) T5071, if running.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.8\tMatch report procedure for open 5G ProSe direct discovery",
                            "text_content": "The purpose of the match report procedure for open 5G ProSe direct discovery is to allow a UE to send a ProSe application code that was matched during the monitoring operation and receive the corresponding ProSe application ID or the updated metadata, if there is no such a mapping stored locally or the metadata index in the ProSe application code indicates the metadata is updated.\nThe UE shall only initiate the match report procedure if it has been authorized for open 5G ProSe direct discovery monitoring in the monitored PLMN based on the service authorization procedure.\nAs a result of the match report procedure completing successfully, the UE obtains a ProSe application ID and potentially other information, which the UE may store locally and pass to the upper layers.\nThe UE shall meet the following pre-conditions before initiating this procedure:\na)\ta request from upper layers to monitor for the ProSe application ID, which resulted in the matched ProSe application code, is still in place;\nb)\tthe lower layers have provided a \"Monitored PLMN ID\" value and UTC time information, along with the discovery message containing a ProSe application code; and\nc)\tthe TTL timer T5064 associated with the discovery filter, which resulted in a match event of the ProSe application code, has not expired.\nIf the UE is authorized to perform open 5G ProSe direct discovery monitoring in the monitored PLMN, it should initiate a match report procedure:\na)\twhen there is a match event of one of the ProSe application codes received from the lower layers and the UE does not have a corresponding ProSe application ID already locally stored;\nb)\twhen the UE has a locally stored mapping for the ProSe application code that resulted in a match event, but the validity timer T5072 of the ProSe application ID has expired;\nc)\twhen the UE has a locally stored mapping for the ProSe application code that resulted in a match event, but the match report refresh timer T5074 of the ProSe application filter has expired;\nd)\twhen there is a match event of one of the ProSe application codes received from the lower layers and the UE has a locally stored ProSe application code excluding the metadata index portion located by the locally stored metadata index mask; or\ne)\twhen there is a match event of one of the ProSe application codes received from the lower layer and the UE has not checked the MIC for the discovered ProSe application code previously.\nThe UE initiates the match report procedure for open 5G ProSe direct discovery by sending a MATCH_REPORT message with a new transaction ID and shall set the message contents as follows:\na)\tthe UE shall include the entire PROSE PC5 DISCOVERY message which contains the ProSe application code for which there was a match event;\nb)\tthe UE shall set the UTC-based counter as follows:\n1)\tthe UE shall generate two UTC-based counters with:\ni)\tthe first counter composed of:\nA)\tthe 27 most significant bits of the UTC-based counter set to the 27 most significant bits of the UTC time provided by the lower layers for the PROSE PC5 DISCOVERY message that contained the ProSe application code for which there was a match event encoded as specified in clause 11.2.5;\nB)\tthe 28th most significant bit of the UTC-based counter set to '0'; and\nC)\tthe 4 least significant bits of the UTC-based counter shall be set to the 4 least significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY message that contained the ProSe application code for which there was a match event, as specified in 3GPP TS 33.503 [34]; and\nii)\tthe second counter composed of:\nA)\tthe 27 most significant bits of the UTC-based counter set to the 27 most significant bits of the UTC time provided by the lower layers for the PROSE PC5 DISCOVERY message that contained the ProSe application code for which there was a match event encoded as specified in clause 11.2.5;\nB)\tthe 28th most significant bit of the UTC-based counter set to '1'; and\nC)\tthe 4 least significant bits of the UTC-based counter set to the 4 least significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY message that contained the ProSe application code for which there was a match event, as specified in 3GPP TS 33.503 [34]; and\n2)\tthen the UE shall select, among the two counters described above, the counter that is nearest to the UTC time provided by the lower layers for the PROSE PC5 DISCOVERY message that contained the ProSe application code for which there was a match event encoded as specified in clause 11.2.5 and set the UTC-based counter in the MATCH_REPORT message to that counter;\nc)\tthe UE shall set the monitored PLMN ID to the PLMN ID of the PLMN where the PROSE PC5 DISCOVERY message was received, as provided by the lower layers;\nd)\tif the UE was roaming when the match event occurred, the UE shall set the VPLMN ID to the PLMN ID of the PLMN in which the UE was registered when the match event occurred; and\ne)\tthe UE shall set the metadata flag to indicate whether or not it wishes to receive metadata information associated with the ProSe application ID in the MATCH_REPORT_ACK message from the 5G DDNMF.\nNOTE 1:\tA UE can include one or multiple transactions in one MATCH_REPORT message for different ProSe application codes and receive corresponding <match-ack> element or <match-reject> element in the MATCH_REPORT_ACK message for each respective transaction. In the following description of match report procedure, only one transaction is included.\nNOTE 2:\tThe value of the metadata flag is determined through an indication from upper layers in the original request to monitor for a ProSe application ID.\nWhen the 5G DDNMF receives the MATCH_REPORT message from the UE, the 5G DDNMF checks MIC for the received PROSE PC5 DISCOVERY message as specified in 3GPP TS 33.503 [34].\nFigure 6.2.8.2.1 illustrates the interaction between the UE and the 5G DDNMF in the match report procedure.\nThe figure depicts a match report procedure for a specific match report number, which is 6.2.8.2.1. The procedure outlines the steps involved in generating a match report, including the identification of a match, the verification of the match, and the submission of the report. The figure is a visual representation of the process, making it easy to understand and follow.\nFigure 6.2.8.2.1: Match report procedure\nUpon receiving a MATCH_REPORT message, the 5G DDNMF shall check whether there is an existing context for the UE identified by its SUPI. If there is no associated UE context, the 5G DDNMF checks with the UDM whether the UE is authorized for open 5G ProSe direct discovery monitoring as described in 3GPP TS 29.503 [10].\nThe 5G DDNMF shall also check the PLMN ID in the ProSe application code received from the UE. If the PLMN ID in the ProSe application code is not the same of that of the PLMN to which the 5G DDNMF belongs, the 5G DDNMF shall execute the procedures defined in 3GPP TS 29.555 [9]. Otherwise, the 5G DDNMF shall check whether the received ProSe application code is authorized to be transmitted on the monitored PLMN indicated in the Monitored PLMN ID in the received message.\nIf the ProSe application code is PLMN-specific, the 5G DDNMF shall verify if the PLMN ID in the ProSe application code is the same as the PLMN of the 5G DDNMF. If so, the 5G DDNMF shall map the ProSe application code to the corresponding ProSe application ID from the PLMN-specific database. If the ProSe application code is country-specific, as specified in clause 24.3 of 3GPP TS 23.003 [4], the 5G DDNMF shall check whether the MCC of the PLMN ID part of the ProSe application code corresponds to the country of the 5G DDNMF. If so, the 5G DDNMF shall map the ProSe application code to the corresponding ProSe application ID from the country-specific database. If the ProSe application code is global as specified in clause 24.3 of 3GPP TS 23.003 [4], the 5G DDNMF shall map the ProSe application code to the corresponding ProSe application ID from the global database. If the ProSe application code contains a ProSe application code prefix, the 5G DDNMF maps the ProSe application code prefix to the corresponding ProSe application ID.\nThe 5G DDNMF shall analyze the ProSe application code received from the UE and determine the validity of the ProSe application code.\nNOTE:\tThis might require the 5G DDNMF to execute procedures defined in 3GPP TS 29.555 [9].\nThe 5G DDNMF shall check if the MIC value and its corresponding UTC-based counter are valid, as defined in 3GPP TS 33.503 [34].\nThe 5G DDNMF uses the information (e.g. ProSe application code, monitored PLMN ID, VPLMN ID if included) received from the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA information related to TLS tunnel transporting the DISCOVERY_REQUEST message, and other information for charging purposes as specified in 3GPP TS 32.277 [45].\nIf the outcome of above processing is successful, the 5G DDNMF shall send a MATCH_REPORT_ACK message containing a <match-ack> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the MATCH_REPORT message from the UE;\nb)\tthe ProSe application ID set to the ProSe application ID provided by the 5G DDNMF and corresponding to the ProSe application code contained in the MATCH_REPORT message;\nc)\tthe validity timer T5072 set to indicate for how long this ProSe application ID is valid;\nd)\tthe match report refresh timer T5074 set to indicate for how long the UE will wait before sending a new match report for this ProSe application code;\ne)\tthe current time set to the current UTC-based time at the 5G DDNMF; and\nf)\toptionally, the metadata set to the metadata information associated with the ProSe application code received in the MATCH_REPORT message and set the metadata index mask to the metadata index mask allocated by the 5G DDNMF for the ProSe application code received in the MATCH_REPORT message, if the UE has set the metadata flag to indicate that it wishes to receive metadata information associated with the ProSe application ID.\nUpon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained in the <match-ack> element matches the value sent by the UE in a MATCH_REPORT message, the UE shall store the mapping between the ProSe application code and ProSe application ID locally, start timers T5072 and T5074 and may inform the upper layers of this match of the ProSe application ID. If the metadata index mask is contained in the MATCH_REPORT_ACK message, the UE shall also store the metadata index mask with the ProSe application code and the ProSe application ID locally. If there is a locally stored mapping between the ProSe application ID and a ProSe application code, the UE shall delete the old mapping. Otherwise, the UE shall discard the MATCH_REPORT_ACK message. The UE shall update the ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter.\nUpon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained in the <match-reject> element matches the value sent by the UE in a MATCH_REPORT message and if the received PC3a control protocol cause value is #5 \"Invalid MIC\", as specified in clause 6.2.8.5, the UE shall stop timer T5072 if it is running.\nNOTE 1:\tIt is an implementation specific choice whether the UE informs the upper layers every time a ProSe application ID triggers a match event, or only the first time this match occurs.\nNOTE 2:\tThe UE can also inform the upper layers if a ProSe application ID is no longer matched, because the validity timer T5072 of the corresponding ProSe application code expires.\nNOTE 3:\tThe UE can also inform the upper layers if a ProSe application ID is no longer matched, because the validity timer T5072 of the corresponding ProSe application code is stopped upon receiving MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #5 \"Invalid MIC\".\nIf the MATCH_REPORT message is not accepted by the 5G DDNMF, the 5G DDNMF sends a MATCH_REPORT_ACK message with a <match-reject> element to the UE including an appropriate PC3a control protocol cause value.\nIf the ProSe application code contained in the MATCH_REPORT message is unknown by the 5G DDNMF, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #4 \"Unknown ProSe application code\".\nIf the check of the MIC contained in the MATCH_REPORT message fails, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #5 \"Invalid MIC\".\nIf the check of the UTC-based counter contained in the MATCH_REPORT message fails, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #6 \"Invalid UTC-based counter\".\nIf the UE is not authorized for open 5G ProSe direct discovery monitoring in the monitored PLMN contained in the MATCH_REPORT message, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of MATCH_REPORT message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the match report procedure.\nb)\tNo response from the 5G DDNMF after the MATCH_REPORT message has been successfully delivered (e.g., TCP ACK has been received for the MATCH_REPORT message)\nIf the TTL timer T5064 associated with the discovery filter which resulted in a match event has not expired, the UE shall retransmit the MATCH_REPORT message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nc)\tChange of PLMN\nIf a PLMN change occurs before the match report procedure is completed, the procedure shall be aborted.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.9\tMatch report procedure for restricted 5G ProSe direct discovery model A",
                            "text_content": "The purpose of the match report procedure is to allow a UE to send a ProSe restricted code that was matched during the monitoring operation and receive the corresponding RPAUID, if there is no such a mapping stored locally.\nThe UE shall only initiate the match report procedure if it has been authorized for restricted 5G ProSe direct discovery monitoring model A in the monitored PLMN based on the service authorization procedure.\nAs a result of the match report procedure completing successfully, the UE obtains a RPAUID and potentially other information, which the UE may store locally and pass to the upper layers.\nThe UE shall meet the following pre-conditions before initiating this procedure:\na)\ta request from upper layers to monitor for the target RPAUID, which resulted in the matched ProSe restricted code, is still in place;\nb)\tthe lower layers have provided UTC time information, along with the discovery message containing the ProSe restricted code; and\nc)\tthe TTL timer T5066 associated with the Restricted discovery filter, whose use resulted in a match event of the ProSe restricted code, has not expired.\nIf the UE is authorized to perform restricted 5G ProSe direct discovery monitoring model A in the monitored PLMN, it should initiate a match report procedure:\na)\twhen there is a match event after applying one of the Restricted discovery filter(s) to a ProSe restricted code received from the lower layers and the UE does not have a corresponding RPAUID already locally stored;\nb)\twhen the UE has a locally stored mapping for the ProSe restricted code that resulted in a match event, but the validity timer T5076 of the ProSe restricted code has expired;\nc)\twhen the UE has a locally stored mapping for the ProSe restricted code that resulted in a match event, but the match report refresh timer T5077 of the ProSe restricted code has expired;\nd)\twhen the UE desires to obtain the metadata associated with the discovered ProSe restricted code; or\ne)\twhen the UE has a locally stored mapping for the ProSe restricted code that resulted in a match event, but the UE does not have a running match report refresh timer T5077 for this ProSe restricted code and the UE is directed by the 5G DDNMF to perform the required MIC check via the match report procedure.\nNOTE 1:\tThe 5G DDNMF directs the UE to use the match report procedure to perform the MIC check by including the MIC Check Indicator parameter in the DISCOVERY_RESPONSE message.\nThe UE initiates the match report procedure by sending a MATCH_REPORT message with a new transaction ID and shall set the message contents as follows:\na)\tthe RPAUID set to the UE's RPAUID which has requested the corresponding monitoring operation that resulted this match event;\nb)\tthe discovery type set to \"Restricted discovery\";\nc)\tthe application identity set to the ProSe identifier of the upper layer application that triggered the monitoring operation as specified in clause 5.2.3;\nd)\tif it is not required to check the MIC via the match report procedure, the ProSe restricted code set to the ProSe restricted code for which there was a match event;\ne)\tif it is required to check the MIC via the match report procedure, the entire PROSE PC5 DISCOVERY message that contained the ProSe restricted code for which there was a match event;\nf)\tif it is required to check the MIC via the match report procedure, the UTC-based counter set as follows:\n1)\tthe UE shall generate two UTC-based counters with:\ni)\tthe first counter composed of:\nA)\tthe 27 most significant bits of the UTC-based counter set to the 27 most significant bits of the UTC time provided by the lower layers for the PROSE PC5 DISCOVERY message that contained the ProSe restricted code for which there was a match event encoded as specified in clause 11.2.5;\nB)\tthe 28th most significant bit of the UTC-based counter set to '0'; and\nC)\tthe 4 least significant bits of the UTC-based counter set to the 4 least significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY message that contained the ProSe restricted code for which there was a match event, as specified in 3GPP TS 33.503 [34]; and\nii)\tthe second counter composed of:\nA)\tthe 27 most significant bits of the UTC-based counter set to the 27 most significant bits of the UTC time provided by the lower layers for the PROSE PC5 DISCOVERY message that contained the ProSe restricted code for which there was a match event encoded as specified in clause 11.2.5;\nB)\tthe 28th most significant bit of the UTC-based counter set to '1'; and\nC)\tthe 4 least significant bits of the UTC-based counter set to the 4 least significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY message that contained the ProSe restricted code for which there was a match event, as specified in 3GPP TS 33.503 [34]; and\n2)\tthen the UE shall select, among the two counters described above, the counter that is nearest to the UTC time provided by the lower layers for the PROSE PC5 DISCOVERY message that contained the ProSe restricted code for which there was a match event encoded as specified in clause 11.2.5 and set the UTC-based counter in the MATCH_REPORT message to that counter; and\ng)\tthe metadata flag set to indicate whether or not the UE wishes to receive the latest metadata information associated with the RPAUID in the MATCH_REPORT_ACK message from the 5G DDNMF.\nNOTE 2:\tA UE can include one or multiple transactions in one MATCH_REPORT message for different ProSe restricted codes and receive a corresponding <restricted-match-ack> element or <match-reject> element in the MATCH_REPORT_ACK message for each respective transaction. In the following description of match report procedure, only one transaction is included.\nIf it is required to check the MIC via the match report procedure, the 5G DDNMF checks MIC for the received PROSE PC5 DISCOVERY message included in the MATCH_REPORT message as specified in 3GPP TS 33.503 [34].\nFigure 6.2.9.2.1 illustrates the interaction between the UE and the 5G DDNMF in the match report procedure.\nThe figure depicts a match report procedure for a restricted discovery model A, which is used in the context of a network security system. The procedure involves the use of a restricted discovery model, which is a method for identifying and tracking the source of a security threat. The figure shows the steps involved in the procedure, including the creation of a match report, the selection of a match, and the execution of the match. The figure is important for understanding the security measures in place and for identifying potential security threats.\nFigure 6.2.9.2.1: Match report procedure for restricted discovery model A\nUpon receiving a MATCH_REPORT message, the 5G DDNMF shall check whether there is an existing context for the UE identified by its SUPI.\nThe 5G DDNMF shall analyze the ProSe restricted code received from the UE in the MATCH_REPORT message. If the MIC value and its corresponding UTC-based counter are included, the 5G DDNMF shall check whether the MIC value and the UTC-based counter are valid and within the acceptable range respectively as defined in 3GPP TS 33.503 [34]. The 5G DDNMF shall then check in the UE context if the ProSe restricted code matches any restricted discovery filter(s) allocated for the particular application identified by the ProSe identifier received in the MATCH_REPORT message. If such a discovery filter exists, the target RPAUID associated with the filter(s) shall be identified as the corresponding RPAUID for this code. Optionally, the 5G DDNMF may further invoke the procedure defined in 3GPP TS 29.503 [10] to verify if the target RPAUID is allowed to be discovered by the RPAUID of the requesting UE that has sent the MATCH_REPORT message, or to retrieve metadata associated for the target RPAUID if metadata flag is set to \"True\" in the MATCH_REPORT message and the 5G DDNMF does not have the latest metadata.\nIf the outcome of the above processing is successful, the 5G DDNMF shall send a MATCH_REPORT_ACK message containing a <restricted-match-ack> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the MATCH_REPORT message from the UE;\nb)\tthe RPAUID set to the target RPAUID retrieved from the UE context at the 5G DDNMF which corresponds to the ProSe restricted code contained in the MATCH_REPORT message;\nc)\tthe validity timer T5076 set to indicate for how long this ProSe restricted code is valid;\nd)\tthe match report refresh timer T5077 to indicate for how long the UE will wait before sending a new match report for this ProSe restricted code if the MIC value and the UTC-based counter are included in the MATCH_REPORT message;\ne)\tthe current time set to the current UTC-based time at the 5G DDNMF; and\nf)\tthe metadata set to the associated metadata information, if there exists metadata information associated with this target RPAUID and the metadata flag is set to \"True\" in the MATCH_REPORT message.\nIf the corresponding PDUID of the target RPAUID does not belong to the HPLMN of the requesting UE, the 5G DDNMF may optionally invoke the procedure defined in 3GPP TS 29.555 [9] to inform the 5G DDNMF of the announcing UE about the match event.\nThe 5G DDNMF uses the information (e.g. application identity) received from the UE in the MATCH_REPORT message, UE identity in GBA or AKMA information related to TLS tunnel transporting the MATCH_REPORT message, and other information for charging purposes as specified in 3GPP TS 32.277 [45].\nUpon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained in the <restricted-match-ack> element matches the value sent by the UE in a MATCH_REPORT message, the UE shall store the mapping between the ProSe restricted code and RPAUID locally, start timers T5076 and T5077 and may inform the upper layers of this match of the RPAUID. Otherwise, the UE shall discard the MATCH_REPORT_ACK message. The UE shall update the ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter.\nUpon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained in the <match-reject> element matches the value sent by the UE in a MATCH_REPORT message and if the received PC3a control protocol cause value is #5 \"Invalid MIC\", as specified in clause 6.2.9.5, the UE shall stop timer T5016 if it is running.\nNOTE 1:\tIt is an implementation specific choice whether the UE informs the upper layers every time an RPAUID triggers a match event, or only the first time this match occurs.\nNOTE 2:\tThe UE can also inform the upper layers if an RPAUID is no longer matched, because the validity timer T5076 of the corresponding ProSe restricted code expires.\nNOTE 3:\tThe UE can also inform the upper layers if a ProSe restricted code is no longer matched, because the validity timer T5016 of the corresponding ProSe restricted code is stopped upon receiving MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #5 \"Invalid MIC\".\nIf the MATCH_REPORT message is not accepted by the 5G DDNMF, the 5G DDNMF sends a MATCH_REPORT_ACK message with a <match-reject> element to the UE including an appropriate PC3a control protocol cause value.\nIf there is no associated UE context for the SUPI of the UE, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #16 \"Invalid match event\".\nIf the ProSe restricted code contained in the MATCH_REPORT message does not match any Restricted discovery filter(s) allocated for the requesting UE for the corresponding application, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #16 \"Invalid match event\".\nIf the check of the MIC contained in the MATCH_REPORT message fails, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #5 \"Invalid MIC\".\nIf the check of the UTC-based counter contained in the MATCH_REPORT message fails, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #6 \" Invalid UTC-based counter\".\nIf the UE is not authorized for restricted 5G ProSe direct discovery monitoring, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of MATCH_REPORT message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the match report procedure.\nb)\tNo response from the 5G DDNMF after the MATCH_REPORT message has been successfully delivered (e.g., TCP ACK has been received for the MATCH_REPORT message)\nIf the TTL timer T5066 associated with the restricted discovery filter which resulted in a match event has not expired, the UE shall retransmit the MATCH_REPORT message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.10\tMatch report procedure for restricted 5G ProSe direct discovery model B",
                            "text_content": "The purpose of the Match report procedure is to allow a UE to send a ProSe response code that was matched during the restricted 5G ProSe direct discovery Model B discoverer operation and receive the corresponding RPAUID, if there is no such a mapping stored locally.\nThe UE shall only initiate the match report procedure if it has been authorized for restricted 5G ProSe direct discovery model B discoverer operation in the monitored PLMN based on the service authorization procedure.\nAs a result of the match report procedure completing successfully, the UE obtains a RPAUID and potentially other information, which the UE may store locally and pass to the upper layers.\nThe UE shall meet the following pre-conditions before initiating this procedure:\na)\ta request from upper layers to discover the target RPAUID with restricted discovery model B, which resulted in the matched ProSe response code, is still in place;\nb)\tthe lower layers have provided UTC time information, along with the discovery message containing the ProSe response code; and\nc)\tthe validity  timer T5070 associated with the discovery response filter, whose use resulted in a match event of the ProSe response code, has not expired.\nIf the UE is authorized to perform restricted 5G ProSe direct discovery model B discoverer operation in the monitored PLMN, it should initiate a match report procedure:\na)\twhen there is a match event when applying one of the discovery response filter(s) to one of the ProSe response codes received from the lower layers and the UE does not have a corresponding RPAUID already locally stored;\nb)\twhen the UE has a locally stored mapping for the ProSe response code that resulted in a match event, but the validity timer T5076 of the ProSe response code has expired;\nc)\twhen the UE has a locally stored mapping for the ProSe response code that resulted in a match event, but the match report refresh timer T5077 of the ProSe response code has expired;\nd)\twhen the UE desires to obtain the metadata associated with the discovered ProSe response code; or\ne)\twhen the UE has a locally stored mapping for the ProSe response code that resulted in a match event, but the UE does not have a running match report refresh timer T5077 for this ProSe response code and the UE is directed by the 5G DDNMF to perform the required MIC check via the match report procedure.\nNOTE 1:\tThe 5G DDNMF directs the UE to use the match report procedure to perform the MIC check by including the MIC Check Indicator parameter in the DISCOVERY_RESPONSE message.\nThe UE initiates the match report procedure by sending a MATCH_REPORT message with a new transaction ID and shall set the message contents as follows:\na)\tthe RPAUID set to the UE's RPAUID which has requested the corresponding restricted discovery model B discoverer operation that resulted this match event;\nb)\tthe discovery type set to \"Restricted discovery\";\nc)\tthe application identity set to the ProSe identifier of the upper layer application that triggered the restricted direct discovery Model B discoverer operation as described in clause 5.2.3;\nd)\tif it is not required to check the MIC via the match report procedure, the ProSe restricted code set to the ProSe restricted code for which there was a match event;\ne)\tif it is required to check the MIC via the match report procedure, the entire PROSE PC5 DISCOVERY message that contained the ProSe restricted code for which there was a match event;\nf)\tif it is required to check the MIC via the match report procedure, the UTC-based counter set as follows:\n1)\tthe UE shall generate two UTC-based counters with:\ni)\tthe first counter composed of:\nA)\tthe 27 most significant bits of the UTC-based counter set to the 27 most significant bits of the UTC time provided by the lower layers for the PROSE PC5 DISCOVERY message that contained the ProSe response code for which there was a match event encoded as specified in clause 11.2.5;\nB)\tthe 28th most significant bit of the UTC-based counter set to '0'; and\nC)\tthe 4 least significant bits of the UTC-based counter shall be set to the 4 least significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY message that contained the ProSe response code for which there was a match event, as specified in 3GPP TS 33.503 [34]; and\nii)\tthe second counter composed of:\nA)\tthe 27 most significant bits of the UTC-based counter set to the 27 most significant bits of the UTC time provided by the lower layers for the PROSE PC5 DISCOVERY message that contained the ProSe response code for which there was a match event encoded as specified in clause 11.2.5;\nB)\tthe 28th most significant bit of the UTC-based counter set to '1'; and\nC)\tthe 4 least significant bits of the UTC-based counter set to the 4 least significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY message that contained the ProSe response code for which there was a match event, as specified in 3GPP TS 33.503 [34]; and\n2)\tthen the UE shall select, among the two counters described above, the counter that is nearest to the UTC time provided by the lower layers for the PROSE PC5 DISCOVERY message that contained the ProSe response code for which there was a match event encoded as specified in clause 11.2.5 and set the UTC-based counter in the MATCH_REPORT message to that counter; and\ng)\tthe metadata flag set to indicate whether or not the UE wishes to receive the latest metadata information associated with the RPAUID in the MATCH_REPORT_ACK message from the 5G DDNMF.\nNOTE 2:\tA UE can include one or multiple transactions in one MATCH_REPORT message for different ProSe response codes and receive corresponding <restricted-match-ack> element or <match-reject> element in the MATCH_REPORT_ACK message for each respective transaction. In the following description of match report procedure, only one transaction is included.\nIf it is required to check the MIC via the match report procedure, the 5G DDNMF checks MIC for the received PROSE PC5 DISCOVERY message included in the MATCH_REPORT message as specified in 3GPP TS 33.503 [34].\nFigure 6.2.10.2.1 illustrates the interaction between the UE and the 5G DDNMF in the match report procedure.\nThe figure depicts a match report procedure for a restricted discovery model B, which is used in a network security system. The procedure involves a match report generation process, where the system checks for potential security threats and alerts the network administrator. The figure shows the steps involved in the match report generation process, including the creation of a match report file, the selection of a match report template, and the execution of the match report generation process. The figure also includes a visual representation of the match report file, which is a text file containing the match report information.\nFigure 6.2.10.2.1: Match report procedure for restricted discovery model B\nUpon receiving a MATCH_REPORT message, the 5G DDNMF shall check whether there is an existing discoverer UE context for the UE identified by its SUPI.\nThe 5G DDNMF shall analyze the ProSe response code received from the UE in the MATCH_REPORT message. If the MIC value and its corresponding UTC-based counter are included, the 5G DDNMF shall check whether the MIC value and the UTC-based counter are valid and within the acceptable range respectively, as defined in 3GPP TS 33.503 [34]. The 5G DDNMF shall then check in the UE context if the ProSe response code matches any discovery response filter(s) allocated for the particular application identified by the ProSe identifier received in the MATCH_REPORT message. If such a discovery filter exists, the target RPAUID associated with the filter(s) shall be identified as the corresponding RPAUID for this code. Optionally, the 5G DDNMF may further invoke the procedure defined in 3GPP TS 29.503 [10] to verify if the target RPAUID is allowed to be discovered by the RPAUID of the requesting UE that has sent the MATCH_REPORT message, or to retrieve metadata associated for the target RPAUID if metadata flag is set to \"True\" in the MATCH_REPORT message and the 5G DDNMF does not have the latest metadata.\nIf the outcome of the above processing is successful, the 5G DDNMF shall send a MATCH_REPORT_ACK message containing a <restricted-match-ack> element with:\na)\tthe transaction ID set to the value of the transaction ID received in the MATCH_REPORT message from the UE;\nb)\tthe RPAUID set to the target RPAUID retrieved from the UE context at the 5G DDNMF which corresponds to the ProSe response code contained in the MATCH_REPORT message;\nc)\tthe validity timer T5076 set to indicate for how long the RPAUID is matched;\nd)\tthe match report refresh timer T5077 set to indicate for how long the UE will wait before sending a new match report for this ProSe response code if the MIC value and the UTC-based counter are included in the MATCH_REPORT message;\ne)\tthe current time set to the current UTC-based time at the 5G DDNMF; and\nf)\toptionally, the metadata set to the associated metadata information, if there exists metadata information associated with this target RPAUID.\nIf the corresponding PDUID of the target RPAUID does not belong to the HPLMN of the requesting UE, the 5G DDNMF may optionally invoke the procedure defined in 3GPP TS 29.555 [9] to inform the 5G DDNMF of the discoveree UE about the match event.\nThe 5G DDNMF uses the information (e.g. application identity) received from the UE in the MATCH_REPORT message, UE identity in GBA or AKMA information related to TLS tunnel transporting the MATCH_REPORT message, and other information for charging purposes as specified in 3GPP TS 32.277 [45].\nUpon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained in the <restricted-match-ack> element matches the value sent by the UE in a MATCH_REPORT message, the UE shall store the mapping between the ProSe response code and the RPAUID locally, start timers T5076 and T5077 and may inform the upper layers of this match of the RPAUID. Otherwise, the UE shall discard the MATCH_REPORT_ACK message. The UE shall update the ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter.\nUpon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained in the <match-reject> element matches the value sent by the UE in a MATCH_REPORT message and if the received PC3a control protocol cause value is #5 \"Invalid MIC\", as specified in clause 6.2.10.5, the UE shall stop timer T5076 if it is running.\nNOTE 1:\tIt is an implementation specific choice whether the UE informs the upper layers every time a RPAUID triggers a match event, or only the first time this match occurs.\nNOTE 2:\tThe UE can also inform the upper layers if an RPAUID is no longer matched, because the validity timer T5076 of the corresponding ProSe response code expires.\nNOTE 3:\tThe UE can also inform the upper layers if a ProSe response code is no longer matched, because the validity timer T5076 of the corresponding ProSe response code is stopped upon receiving MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #5 \"Invalid MIC\".\nIf the MATCH_REPORT message is not accepted by the 5G DDNMF, the 5G DDNMF sends a MATCH_REPORT_ACK message with a <match-reject> element to the UE including an appropriate PC3a control protocol cause value.\nIf there is no associated UE context for the SUPI of the UE, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #16 \"Invalid match event\".\nIf the ProSe response code contained in the MATCH_REPORT message does not match any Discovery Response Filter(s) allocated for the requesting UE for the corresponding application, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #16 \"Invalid match event\".\nIf the check of the MIC contained in the MATCH_REPORT message fails, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #5 \"Invalid MIC\".\nIf the check of the UTC-based counter contained in the MATCH_REPORT message fails, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #6 \" Invalid UTC-based counter\".\nIf the UE is not authorized for restricted 5G ProSe direct discovery model B discoverer operation, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a <match-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of MATCH_REPORT message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the match report procedure.\nb)\tNo response from the 5G DDNMF after the MATCH_REPORT message has been successfully delivered (e.g., TCP ACK has been received for the MATCH_REPORT message)\nIf the validity timer T5070 associated with the Discovery Response Filter which resulted in a match event has not expired, the UE shall retransmit the MATCH_REPORT message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.11\tDirect discovery update procedure for open discovery",
                            "text_content": "The direct discovery update procedure is used to update or revoke a previously allocated ProSe application code, or discovery filter(s) as specified in 3GPP TS 23.304 [2].\nWhen triggered to revoke a previously allocated ProSe application code for an announcing UE or revoke discovery filter(s) for a monitoring UE, the 5G DDNMF in the HPLMN sends a DISCOVERY_UPDATE_REQUEST message to the UE with:\na)\ta new DDNMF transaction ID not used in any other direct discovery procedures in PC3a interface; and\nb)\tthe discovery entry ID set to the discovery entry ID of the corresponding discovery entry that contains the ProSe application code or the discovery filter(s) to be revoked.\nWhen triggered to update a previously allocated ProSe application code for an announcing UE, the 5G DDNMF in the HPLMN shall allocate a new ProSe application code for the ProSe application ID with a new validity timer T5060, associate the discovery entry with the new ProSe application code and restart timer T5061.Then the 5G DDNMF sends a DISCOVERY_UPDATE_REQUEST message to the UE with:\na)\ta new DDNMF transaction ID not used in any other direct discovery procedures in PC3a interface;\nb)\tthe discovery entry ID set to the discovery entry ID of the corresponding discovery entry that contains the ProSe application code to be updated; and\nc)\tthe Update info containing the ProSe application code set to the new ProSe application code allocated by the 5G DDNMF and a validity timer T5060 set to the T5060 timer value assigned by the 5G DDNMF to the new ProSe application code.\nWhen triggered to update discovery filter(s) for a monitoring UE, the 5G DDNMF in the HPLMN updates the content of discovery filter(s), associate the discovery entry with the updated discovery filter(s) and restart timer T5063 for each filter. The update of discovery filter content includes setting new TTL timer(s) and if necessary, assigning new ProSe application code and ProSe application mask(s). Then the 5G DDNMF shall send a DISCOVERY_UPDATE_REQUEST message to the UE with:\na)\ta new DDNMF transaction ID not used in any other direct discovery procedures in PC3a interface;\nb)\tthe discovery entry ID set to the discovery entry ID of the corresponding discovery entry that contains the discovery filter(s) to be updated; and\nc)\tthe Update info containing the discovery filter(s) set to the new discovery filter(s) allocated by the 5G DDNMF.\nNOTE 1:\tThe 5G DDNMF can include one or multiple transactions in one DISCOVERY_UPDATE_REQUEST message for ProSe App Codes or discovery filter(s) contained in different discovery entries and receive corresponding < discovery-update-response> element or <response-reject> element in a DISCOVERY_UPDATE_RESPONSE message for each respective transaction. In the following description of direct discovery update request procedure, only one transaction is included.\nFigure 6.2.11.2.1 illustrates the interaction of the UE and the 5G DDNMF in the direct discovery update procedure.\nThe figure depicts a direct discovery update procedure for open discovery in a network. It illustrates the steps involved in updating the discovery process, including the use of a direct discovery update mechanism. The figure shows the network structure, with nodes representing the network elements and the update process represented by arrows. The figure is labeled with the figure number and the figure name, which helps to identify the specific figure being discussed.\nFigure 6.2.11.2.1: Direct discovery update procedure for open discovery\nNOTE 2:\tIn the figure 6.2.11.2.1, the timers are started only when the procedure is triggered to update a previously allocated ProSe application code for an announcing UE or update discovery filter(s) for a monitoring UE.\nUpon receiving a DISCOVERY_UPDATE_REQUEST message, the UE shall check if the discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is known. If the discovery entry ID is known, the UE shall proceed with the following direct discovery update procedure.\nIf the Update info is not included in the DISCOVERY_UPDATE_REQUEST message, the UE shall stop running timers corresponding to the discovery entry and delete the discovery entry corresponding to the discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message. The UE informs the lower layers to stop announcing or monitoring corresponding to the discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message.\nIf the Update info is included in the DISCOVERY_UPDATE_REQUEST message, the UE shall replace the existing ProSe application code or the discovery filter(s) with new ProSe application code or the discovery filter(s) contained in the Update info correspondingly. The announcing UE shall stop the timer T5060, start the validity timer T5060 with the received value for the new ProSe application code and perform open 5G ProSe direct discovery announcing with the new ProSe application code as described in clause 6.2.2.4. The monitoring UE shall stop TTL timer T5062, start TTL timer T5062 with the received value for each new discovery filter(s) and perform open 5G ProSe direct discovery monitoring with each new discovery filter(s) as described in clause 6.2.5.4.\nThen the UE shall send a DISCOVERY_UPDATE_RESPONSE message containing a <response-update> element with:\na)\tthe DDNMF transaction ID set to the value of the DDNMF transaction ID received in the DISCOVERY_UPDATE_REQUEST message; and\nb)\tthe discovery entry ID set to the value of the discovery entry ID received in the DISCOVERY_UPDATE_REQUEST message.\nUpon receiving a DISCOVERY_UPDATE_RESPONSE message, if the DDNMF transaction ID contained in the <response-update> element does not match the value sent by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message, the 5G DDNMF shall discard the DISCOVERY_UPDATE_RESPONSE message. Otherwise, the 5G DDNMF shall perform the following procedure.\nWhen the UE is an announcing UE and the radio resources that the UE intends to use are operated by a PLMN other than the HPLMN, the 5G DDNMF shall execute the procedures defined in 3GPP TS 29.555 [9] to inform the 5G DDNMF in VPLMN or local PLMN.\nWhen the UE is a monitoring UE and the ProSe application ID monitored by the UE is PLMN-specific and that PLMN ID indicated by the ProSe application ID is not the same as that of the PLMN to which the 5G DDNMF belongs, the 5G DDNMF executes the procedures defined in 3GPP TS 29.555 [9] to inform the 5G DDNMF in the PLMN indicated by the ProSe application ID.\nFor each discovery entry ID received in the DISCOVERY_UPDATE_RESPONSE message, if the procedure is to revoke a previously allocated ProSe application code or discovery filter(s), the 5G DDNMF shall delete the discovery entry indicated by the discovery entry ID from the UE's context and release the associated resources.\nIf the DISCOVERY_UPDATE_REQUEST message cannot be accepted by the UE, the UE sends a DISCOVERY_UPDATE_RESPONSE message containing a <response-reject> element to the 5G DDNMF including an appropriate PC3a control protocol cause value.\nIf the discovery entry ID contained in the DISCOVERY_UPDATE _REQUEST message is unknown, the UE shall send the DISCOVERY_UPDATE_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value # 10 \"Unknown or invalid discovery entry ID\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of DISCOVERY_UPDATE_REQUEST message (e.g., after TCP retransmission timeout)\nThe 5G DDNMF shall close the existing secure connection to the UE.\nb)\tNo response from the UE after the DISCOVERY_UPDATE_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the DISCOVERY_UPDATE_REQUEST message)\nThe 5G DDNMF shall retransmit the DISCOVERY_UPDATE_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are 5G DDNMF implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of DISCOVERY_UPDATE_RESPONSE message.\nAfter receiving an indication from lower layer that the DISCOVERY_UPDATE_RESPONSE message has not been successfully acknowledged (e.g., TCP ACK is not received), the UE shall abort the procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.12\tDirect discovery update procedure for restricted discovery",
                            "text_content": "The discovery update procedure is used to update the discovery filters and/or allocate a new ProSe restricted code as defined in 3GPP TS 23.304 [2]. The 5G DDNMF can at any time update/revoke a previously allocated ProSe restricted code, or discovery filters.\nThe 5G DDNMF in the HPLMN shall initiate the restricted discovery filters revocation procedure by sending the DISCOVERY_UPDATE_REQUEST to the UE with:\na)\ta new DDNMF transaction ID not used in any other direct discovery procedures in PC3a interface;\nb)\tthe discovery entry ID set to the discovery entry ID of the corresponding discovery entry that contains the restricted discovery filter to be revoked; and\nc)\toptionally update info containing the restricted discovery filters that replace the existing ones, if the 5G DDNMF decides to remove only certain filter(s) and not others.\nNOTE:\tThe 5G DDNMF can include one or multiple transactions in one DISCOVERY_UPDATE_REQUEST message for different Restricted discovery filters and receive corresponding <response-update> element or <response-reject> element in a DISCOVERY_UPDATE_RESPONSE message for each respective transaction. In the following description of the network initiated direct discovery update request procedure, only one transaction is included.\nFigure 6.2.12.2.1 illustrates the interaction of the UE and the 5G DDNMF in the restricted discovery filters revocation procedure.\nThe figure depicts a restricted discovery filter revocation procedure, which is a crucial step in the network security management process. The figure shows a hierarchical structure with various levels of discovery filters, including restricted discovery filters, which are used to control the visibility of certain network resources. The revocation procedure is depicted as a step-by-step process, with each step being highlighted in a different color, making it easy to understand the flow of the procedure. The figure also includes a legend to help users understand the different colors and their meanings. Overall, the figure provides a clear and concise representation of the restricted discovery filter revocation procedure, making it easy to understand and follow.\nFigure 6.2.12.2.1.1: Restricted discovery filters revocation procedure\nUpon receiving a DISCOVERY_UPDATE_REQUEST message, the UE shall check if the discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is valid. If the discovery entry ID is valid, the UE shall proceed with the following direct discovery update procedure.\nThe UE shall remove all the restricted discovery filters corresponding to the discovery entry ID if the Update info is not included in the DISCOVERY_UPDATE_REQUEST message or shall remove the old restricted discovery filters and store the restricted discovery filter included in the Update info in the DISCOVERY_UPDATE_REQUEST message. Then the UE shall send a DISCOVERY_UPDATE_RESPONSE message to the 5G DDNMF with the <response-update> element which contains:\na)\tthe DDNMF transaction ID set to the value of the DDNMF transaction ID received in the DISCOVERY_UPDATE_REQUEST message; and\nb)\tdiscovery entry ID set to the value of the discovery entry ID received in the DISCOVERY_UPDATE_REQUEST message.\nUpon receipt of the DISCOVERY_UPDATE_ RESPONSE message by the 5G DDNMF, if the DDNMF transaction ID contained in the <response-update> element does not match the value sent by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message, the 5G DDNMF shall discard the DISCOVERY_UPDATE_RESPONSE message. Upon receipt of the DISCOVERY_UPDATE_ RESPONSE message by the 5G DDNMF, if the DDNMF transaction ID contained in the <response-update> element matches the value sent by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message, the restricted discovery filters revocation procedure is complete.\nIf the DISCOVERY_UPDATE_REQUEST message cannot be accepted by the UE, the UE sends a DISCOVERY_UPDATE_RESPONSE message containing a <response-reject> element to the 5G DDNMF including an appropriate PC3a control protocol cause value.\nIf the discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is not found in the UE context, the UE shall send a DISCOVERY_UPDATE_RESPONSE message containing a <response-reject> element with PC3 control protocol cause value #10 \"Unknown or Invalid discovery entry ID\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of DISCOVERY_UPDATE_REQUEST message (e.g., after TCP retransmission timeout)\nThe 5G DDNMF shall close the existing secure connection to the UE.\nb)\tNo response from the UE after the DISCOVERY_UPDATE_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the DISCOVERY_UPDATE_REQUEST message)\nThe 5G DDNMF shall retransmit the DISCOVERY_UPDATE_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are 5G DDNMF implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of DISCOVERY_UPDATE_RESPONSE message.\nAfter receiving an indication from lower layer that the DISCOVERY_UPDATE_RESPONSE message has not been successfully acknowledged (e.g., TCP ACK is not received), the UE shall abort the procedure.\nThe 5G DDNMF in the HPLMN shall initiate the ProSe restricted code allocation procedure by sending the DISCOVERY_UPDATE_REQUEST to the UE with:\na)\ta new DDNMF transaction ID not used in any other direct discovery procedures in PC3a interface;\nb)\tthe discovery entry ID set to the discovery entry ID of the corresponding discovery entry that contains the ProSe restricted code to be replaced; and\nc)\tupdate info containing the ProSe restricted code set to the ProSe restricted code to be replaced and a validity timer T5062 set to the T5062 timer value assigned by the 5G DDNMF to the ProSe restricted code.\nFigure 6.2.12.3.1.1 illustrates the interaction of the UE and the 5G DDNMF in the ProSe restricted code allocation procedure.\nNOTE:\tThe 5G DDNMF can include one or multiple transactions in one DISCOVERY_UPDATE_REQUEST message for different ProSe restricted codes and receive corresponding <response-update> element or <response-reject> element in a DISCOVERY_UPDATE_RESPONSE message for each respective transaction. In the following description of the network initiated direct discovery update request procedure, only one transaction is included.\nThe figure depicts a structured and standardized procedure for allocating new restricted code in the ProSe restricted code allocation procedure. The figure includes a flowchart with various steps, such as the initial allocation, the allocation of new restricted code, and the final allocation. The figure is important for understanding the process and ensuring compliance with the procedure.\nFigure 6.2.12.3.1.1: New ProSe restricted code allocation procedure\nUpon receiving a DISCOVERY_UPDATE_REQUEST message, the UE shall check if the discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is valid. If the discovery entry ID is valid, the UE shall proceed with the following direct discovery update procedure.\nThe UE shall replace the ProSe restricted code corresponding to the discovery entry ID included in the DISCOVERY_UPDATE_REQUEST message. The UE shall stop the validity timer T5062 if running and start the validity timer T5062 with the received value. Then the UE shall send a DISCOVERY_UPDATE_RESPONSE message to the 5G DDNMF with the <response-update> element which contains:\na)\tthe DDNMF transaction ID set to the value of the DDNMF transaction ID received in the DISCOVERY_UPDATE_REQUEST message; and\nb)\tdiscovery entry ID set to the value of the discovery entry ID received in the DISCOVERY_UPDATE_REQUEST message.\nUpon receipt of the DISCOVERY_UPDATE_ RESPONSE message by the 5G DDNMF, if the DDNMF transaction ID contained in the <response-update> element does not match the value sent by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message, the 5G DDNMF shall discard the DISCOVERY_UPDATE_RESPONSE message. Upon receipt of the DISCOVERY_UPDATE_ RESPONSE message by the 5G DDNMF, if the DDNMF transaction ID contained in the <response-update> element matches the value sent by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message, the ProSe restricted code allocation procedure is complete.\nIf the DISCOVERY_UPDATE_REQUEST message cannot be accepted by the UE, the UE sends a DISCOVERY_UPDATE_RESPONSE message containing a <response-reject> element to the 5G DDNMF including an appropriate PC3a control protocol cause value.\nIf the discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is not found in the UE context, the UE shall send a DISCOVERY_UPDATE _RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #10 \"Unknown or invalid discovery entry ID\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of DISCOVERY_UPDATE_REQUEST message (e.g., after TCP retransmission timeout)\nThe 5G DDNMF shall close the existing secure connection to the UE.\nb)\tNo response from the UE after the DISCOVERY_UPDATE_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the DISCOVERY_UPDATE_REQUEST message)\nThe 5G DDNMF shall retransmit the DISCOVERY_UPDATE_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are 5G DDNMF implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of DISCOVERY_UPDATE_RESPONSE message.\nAfter receiving an indication from lower layer that the DISCOVERY_UPDATE_RESPONSE message has not been successfully acknowledged (e.g., TCP ACK is not received), the UE shall abort the procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.13\tAnnouncing alert procedure",
                            "text_content": "The purpose of the announcing alert procedure is for the 5G DDNMF in HPLMN to send to the announcing UE the ProSe restricted code generated in the announce request procedure for restricted 5G ProSe direct discovery model A as specified in clause 6.2.3.\nBefore initiating the announcing alert procedure, the 5G DDNMF shall determine whether the announcing UE and the monitoring UE are close enough to trigger the announcing alert procedure.\nThe announcing UE includes the ProSe restricted code in a PROSE PC5 DISCOVERY message and passes the PROSE PC5 DISCOVERY message to the lower layers for transmission over the PC5 interface in the registered PLMN or local PLMN as a result of a successful announcing alert procedure.\nIf the UE has initiated an announce request procedure for restricted 5G ProSe direct discovery model A before as specified in clause 6.2.3 and the on demand announcing enabled indicator associated with the RPAUID in the announcing UE context is set to 1, the 5G DDNMF shall initiate an announcing alert procedure:\na)\twhen the 5G DDNMF receives a pair of target PDUID - target RPAUID from the ProSe application server as described in 3GPP TS 29.503 [10], the target RPAUID is the same as the RPAUID stored in the announcing UE context and 5G DDNMF determines the monitoring UE is in the vicinity of the announcing UE; or\nb)\twhen the 5G DDNMF receives a pair of target PDUID - target RPAUID from other 5G DDNMF as described in 3GPP TS 29.555 [9], the target RPAUID is the same as the RPAUID stored in the announcing UE context and the 5G DDNMF determines the monitoring UE is in the vicinity of the announcing UE.\nNOTE:\tHow the 5G DDNMF in the HPLMN determines whether the announcing UE and the monitoring UE are close enough to trigger the announcing alert procedure is left to the implementation of 5G DDNMF.\nThe 5G DDNMF shall initiate the announcing alert procedure by sending an ANNOUNCING_ALERT_REQUEST message with:\na)\ta new DDNMF transaction ID;\nb)\tthe RPAUID set to the Target RPAUID received from ProSe application server as specified in 3GPP TS 29.503 [10] or from other 5G DDNMF as specified in 3GPP TS 29.555 [9];\nc)\tthe ProSe restricted code set to the ProSe restricted code or the ProSe restricted code prefix. If restricted Direct Discovery with application-controlled extension was requested by the announcing UE , the ANNOUNCING_ALERT_REQUEST message also contains one or more ProSe restricted code suffix Ranges which contain the suffix(es) for the RPAUID retrieved from the announcing UE context; and\nd)\tthe discovery entry ID set to the identifier associated with the corresponding discovery entry in the UE's context.\nFigure 6.2.13.2.1 illustrates the interaction of the 5G DDNMF and the UE in the Announce Alert procedure.\nThe figure depicts a 3D representation of a lert procedure, which is a critical component of a system's alerting and notification process. The figure shows a series of interconnected nodes, each representing a different level of alerting, from the topmost to the bottommost. The nodes are connected by lines, indicating the flow of information from the top to the bottom. The figure also includes a legend, which provides a visual guide to the different types of alerts and notifications that can be generated by the system. Overall, the figure provides a comprehensive overview of the lert procedure, allowing users to understand how the system works and how to configure it to meet their specific needs.\nFigure 6.2.13.2.1: Announcing alert procedure\nUpon receipt of the ANNOUNCING_ALERT_REQUEST message, the UE shall check whether there is an existing discovery entry identified by the discovery entry ID included in the ANNOUNCING_ALERT_REQUEST message. If the discovery entry exists in the UE, the UE shall send an ANNOUNING_ALERT_RESPONSE message to the 5G DDNMF with a DDNMF transaction ID set to the value of the DDNMF transaction ID received in the ANNOUNCING_ALERT_REQUEST message.\nThen, the UE may perform restricted 5G ProSe direct discovery model A announcing as described below.\nThe UE requests the parameters from the lower layers for restricted 5G ProSe direct discovery model A announcing (see 3GPP TS 38.331 [13]). The UE shall perform restricted 5G ProSe direct discovery model A announcing only if the lower layers indicate that ProSe direct discovery is supported by the network. If the UE in 5GMM-IDLE mode has to request resources for ProSe direct discovery announcing as specified in 3GPP TS 38.331 [13], the UE shall perform a service request procedure or registration procedure as specified in 3GPP TS 24.501 [11]. The UE shall obtain the UTC time for the next discovery transmission opportunity for ProSe direct discovery from the lower layers.\nIf a valid UTC time is obtained, the UE shall generate the UTC-based counter corresponding to this UTC time as specified in clause 11.2.5. If the resulting UTC-based counter is within Max Offset of the time shown by the clock used for ProSe by the UE, the UE shall use the UTC-based counter and the DUIK contained in the <restricted-announce-response> element of the DISCOVERY_RESPONSE message to compute the MIC field for the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34].\nThe UE shall either use the ProSe restricted code received in the ANNOUNCING_ALERT_REQUEST message, or select one ProSe restricted code based on the ProSe restricted code prefix and ProSe restricted code suffix Range(s) received in the ANNOUNCING_ALERT_REQUEST message as announced ProSe restricted code, along with the MIC and the eight least significant bits of the UTC-based counter, in order to construct a PROSE PC5 DISCOVERY message, according to the format defined in clause 10.2.5.\nNOTE:\tThe UE can use different codes formed based on different ProSe restricted code suffixes to announce, without having to send a new DISCOVERY_REQUEST message to the 5G DDNMF, as long as the validity timer T5062 of the ProSe restricted code prefix has not expired.\nThe UE then passes the PROSE PC5 DISCOVERY message to the lower layers for transmission if:\na)\tthe UE is currently authorized to perform restricted 5G ProSe direct discovery model A announcing in the registered PLMN or the local PLMN operating the radio resources that the UE intends to use;\nb)\tthe validity timer T5062 for the corresponding discovery entry allocated ProSe restricted code or ProSe restricted code prefix has not expired; and\nc)\ta request from upper layers to announce the RPAUID associated with both the ProSe restricted code or ProSe restricted code prefix and the authorized ProSe identifier, is still in place.\nThe UE shall ensure that it keeps on passing PROSE PC5 DISCOVERY messages to the lower layers for transmission until the validity timer T5062 of the ProSe restricted code or ProSe restricted code prefix expires. How this is achieved is left up to UE implementation.\nDuring the announcing operation, if one of the above conditions is no longer met, the UE may instruct the lower layers to stop announcing. When the UE stops announcing, if the lower layers indicate that the UE is required to send a discovery indication to the NG-RAN and the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nUpon receipt of the ANNOUNCING_ALERT_RESPONSE message with a DDNMF transaction ID set to the value of the DDNMF transaction ID included in the ANNOUNCING_ALERT_REQUEST message, the 5G DDNMF will set the associated on demand announcing enabled indicator to 0. Then the announcing alert procedure is successfully completed.\nIf the ANNOUNCING_ALERT_REQUEST message cannot be accepted by the UE, the UE sends an ANNOUNCING_ALERT_RESPONSE message containing a <response-reject> element to the 5G DDNMF including an appropriate PC3a control protocol cause value.\nIf the discovery entry ID contained in the ANNOUNCING_ALERT_REQUEST message is unknown, the UE shall send the ANNOUNCING_ALERT_RESPONSE message containing a <response-reject> element with PC3a control protocol cause value #10\"Unknown or invalid discovery entry ID\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of ANNOUNCING_ALERT_REQUEST message (e.g., after TCP retransmission timeout)\nThe 5G DDNMF shall close the existing secure connection to the UE.\nb)\tNo response from the UE after the ANNOUNCING_ALERT_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the ANNOUNCING_ALERT_REQUEST message)\nThe 5G DDNMF shall retransmit the ANNOUNCING_ALERT_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are 5G DDNMF implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of ANNOUNCING_ALERT_RESPONSE message.\nAfter receiving an indication from lower layer that the ANNOUNCING_ALERT_RESPONSE message has not been successfully acknowledged (e.g., TCP ACK is not received), the UE shall abort the procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.14\t5G ProSe direct discovery procedure over PC5 interface",
                            "text_content": "This clause describes the procedures for 5G ProSe direct discovery procedure over PC5 interface. The purpose of the 5G ProSe direct discovery procedure over PC5 interface is to enable a ProSe-enabled UE to detect and identify another ProSe-enabled UE over PC5 interface.\nTo perform 5G ProSe direct discovery procedure over PC5 interface, the UE is configured with the related information as described in clause 5.2.3 and the UE interacts with 5G DDNMF as specified in clause 6.2 when it is in coverage to obtain the related parameters (e.g. ProSe application code, ProSe restricted code). If a UE cannot derive any of the necessary configurations (e.g. default destination layer-2 ID for initial discovery signalling) according to the mapping rules for the ProSe identifier of a ProSe service (see 3GPP TS 24.555 [17]), then the UE is not allowed to perform any operation as specified in clause 6.2.14 for the ProSe service.\nThe following models for 5G ProSe direct discovery procedure over PC5 interface as specified in 3GPP TS 23.304 [2] are supported:\na)\tModel A uses a single discovery protocol message (Announcement); and\nb)\tModel B uses two discovery protocol messages (Solicitation and Response).\nNOTE:\tIf the UE is authorized to perform both 5G ProSe direct discovery Model A and 5G ProSe direct discovery Model B, it is up to UE implementation to select which model to perform or perform both models simultaneously.\nThe UE may use the PC5 DRX mechanism to perform 5G ProSe direct discovery over PC5 interface when the UE is not served by NG-RAN as specified in clause 5.2.3.\nThe following procedures are defined for 5G ProSe direct discovery procedure over PC5 interface:\na)\t5G ProSe direct discovery procedure over PC5 interface with Model A:\n1)\tAnnouncing UE procedure for 5G ProSe direct discovery initiation;\n2)\tAnnouncing UE procedure for 5G ProSe direct discovery completion;\n3)\tMonitoring UE procedure for 5G ProSe direct discovery initiation; and\n4)\tMonitoring UE procedure for 5G ProSe direct discovery completion; and\nb)\t5G ProSe direct discovery procedure over PC5 interface with Model B:\n1)\tDiscoverer UE procedure for 5G ProSe direct discovery initiation;\n2)\tDiscoverer UE procedure for 5G ProSe direct discovery completion;\n3)\tDiscoveree UE procedure for 5G ProSe direct discovery initiation; and\n4)\tDiscoveree UE procedure for 5G ProSe direct discovery completion.\nIn this procedure, the UE sending the PROSE PC5 DISCOVERY message is called the \"announcing UE\" and the \"monitoring UE\" is the UE that triggers the lower layer to start monitoring for PROSE PC5 DISCOVERY message.\nThe UE is authorised to perform the announcing UE procedure for 5G ProSe direct discovery if:\na)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe direct discovery using announcing procedure when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\nb)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe direct discovery using announcing in the PLMN indicated by the serving cell; or\nc)\tthe UE is:\n1)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\ni)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\niii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed \" as specified in 3GPP TS 24.501 [11]; and\n2)\tauthorised to perform 5G ProSe direct discovery using announcing when the UE is not served by NG-RAN; and:\ni)\tconfigured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN; or\nii)\tthe lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure.\nNOTE 1:\tWhen the lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure, the serving cell broadcasts a common radio resources pool for ProSe discovery transmission and the UE can use this common radio resources pool while in limited service state.\notherwise, the UE is not authorised to perform the announcing UE procedure for 5G ProSe direct discovery.\nFigure 6.2.14.2.1.2.1 illustrates the interaction of the UEs in the announcing UE procedure for 5G ProSe direct discovery.\nThe figure depicts a simplified representation of the UE procedure for 5G ProSe direct discovery, which is a key feature of 5G technology. It illustrates the steps involved in the discovery process, including the use of a ProSe protocol, which is a lightweight and efficient method for network discovery. The figure also highlights the importance of network slicing and network slicing management in 5G networks, as well as the use of network slicing for efficient resource allocation and network management.\nFigure 6.2.14.2.1.2.1: Announcing UE procedure for 5G ProSe direct discovery\nWhen the UE is triggered by an upper layer application to perform announcing UE procedure for 5G ProSe direct discovery announcing procedure, if the UE is authorised to perform the announcing UE procedure for 5G ProSe direct discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11];\nb)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nc)\tshall generate a PROSE PC5 DISCOVERY message for 5G ProSe direct discovery announcement if the resulting UTC-based counter is within the max offset of the time shown by the clock used for ProSe by the UE and if the timer T5060 or T5062 does not expire. In the PROSE PC5 DISCOVERY message for direct discovery announcement, the UE:\n1)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.1 or table 10.2.1.2;\n2)\tshall include either ProSe application code or ProSe restricted code;\n3)\tshall include the MIC field computed as described in 3GPP TS 33.503 [34], by using the UTC-based counter and the discovery key contained in the <response-announce> element of the DISCOVERY_RESPONSE message for open 5G ProSe direct discovery, or using the UTC-based counter and the DUIK contained in the <restricted-announce-response> element of the DISCOVERY_RESPONSE message for restricted 5G ProSe direct discovery model A;\n4)\tmay include the Metadata IE to provide the application layer metadata information; and\n5)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter;\nd)\tshall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.503[34], for restricted 5G ProSe direct discovery;\ne)\tshall set the destination layer-2 ID to the default destination layer-2 ID as specified in clause 5.2.3 and self-assign a source layer-2 ID for sending the direct discovery announcement; and\nNOTE 2:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2 and is different from any other self-assigned source layer-2 ID in use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a different discovery model as specified in clause 6.2.14.2.2.2, clause 6.2.15.2.2.2 and clause 8.2.1.3.1.2.\nf)\tshall pass the resulting PROSE PC5 DISCOVERY message along with the source layer-2 ID and destination layer-2 ID for direct discovery announcement and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface.\nIn case of open 5G ProSe direct discovery, the UE shall either use the ProSe application code received in the DISCOVERY_RESPONSE message from the 5G DDNMF, or select one ProSe application code based on the ProSe application code prefix and ProSe application code suffix range(s) received in the DISCOVERY_RESPONSE message from the 5G DDNMF as announced ProSe application code, along with the MIC and the four least significant bits of the UTC-based counter.\nNOTE 2:\tThe UE can use different codes formed based on different ProSe application code suffixes to announce, without having to send a new request to the 5G DDNMF, as long as the validity timer T5060 of the ProSe application code prefix has not expired.\nIn case of restricted 5G ProSe direct discovery model A, the UE shall either use the ProSe restricted code received in the DISCOVERY_RESPONSE message, or select one ProSe restricted code based on the ProSe restricted code prefix and ProSe restricted code suffix range(s) received in the DISCOVERY_RESPONSE message from the 5G DDNMF as announced ProSe restricted code, along with the 4 least significant bits of the UTC-based counter.\nNOTE 3:\tThe UE can use different codes formed based on different ProSe restricted code suffixes to announce, without having to send a new DISCOVERY_REQUEST message to the 5G DDNMF, as long as the validity timer T5062 of the ProSe restricted code prefix has not expired.\nThe announcing UE shall ensure that it keeps on passing the same PROSE PC5 DISCOVERY message to the lower layers for transmission until the request from upper layers to perform announcing UE procedure for 5G ProSe direct discovery is still in place, or the validity timer of the ProSe application code or ProSe application code prefix in case of open 5G ProSe direct discovery or the validity timer of the ProSe restricted code or ProSe restricted code prefix in case of restricted 5G ProSe direct discovery expires. How this is achieved is left up to UE implementation.\nNOTE 4:\tThe announcing UE can stop announcing UE procedure for 5G ProSe direct discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the request from upper layers to perform announcing UE procedure for 5G ProSe direct discovery is not in place, or the validity timer of the ProSe application code or ProSe application code prefix in case of open 5G ProSe direct discovery or the validity timer of the ProSe restricted code or ProSe restricted code prefix in case of restricted 5G ProSe direct discovery expires, the UE may instruct the lower layers to stop announcing.\nNOTE:\tThe announcing UE can stop announcing UE procedure for 5G ProSe direct discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the UE stops announcing, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe UE is authorised to perform the monitoring UE procedure for 5G ProSe direct discovery if:\na)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe direct discovery using monitoring when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\nb)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe direct discovery monitoring in at least one PLMN; or\nc)\tthe UE is:\n1)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\ni)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\niii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\n2)\tauthorised to perform 5G ProSe direct discovery using monitoring when the UE is not served by NG-RAN; and:\ni)\tconfigured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN; or\nii)\tthe lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure.\nNOTE 1:\tWhen the lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure, the serving cell broadcasts a common radio resources pool for ProSe discovery transmission and the UE can use this common radio resources pool while in limited service state.\notherwise, the UE is not authorised to perform the monitoring UE procedure for 5G ProSe direct discovery procedure.\nFigure 6.2.14.2.1.4.1 illustrates the interaction of the UEs in the monitoring UE procedure for 5G ProSe direct discovery procedure.\nThe figure depicts a monitoring procedure for 5G ProSe direct discovery, which involves UE procedure for monitoring the 5G ProSe direct discovery process. The figure shows the steps involved in the procedure, including the use of a monitoring tool, the identification of the UE, and the execution of the discovery process.\nFigure 6.2.14.2.1.4.1: Monitoring UE procedure for 5G ProSe direct discovery\nWhen the UE is triggered by an upper layer application to perform monitoring UE procedure for 5G ProSe direct discovery for a ProSe application code or ProSe restricted code; and:\na)\tif the UE is authorised to perform the monitoring UE procedure for 5G ProSe direct discovery;\nb)\tif the difference between UTC-based counter associated with that discovery slot and UE's ProSe clock is not greater than the max offset of the monitoring UE's ProSe clock; and\nc)\tif the timer T5060 or T5062 does not expire;\nthen the UE shall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY message.\nIn the case of restricted 5G ProSe direct discovery, upon reception of a PROSE PC5 DISCOVERY message for 5G ProSe direct discovery announcement for the destination layer-2 ID to be monitored, the UE shall use the associated DUSK, if received from the 5G DDNMF and the UTC-based counter obtained during the monitoring operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF, the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF, the UE shall use the DUIK and UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for 5G ProSe direct discovery announcement.\nNOTE 2:\tThe use of an erroneous UTC-based counter for processing received PROSE PC5 DISCOVERY messages at the ProSe-enabled UE can cause MIC check failure after DUIK is used for integrity check and malformed contents after DUSK is used for unscrambling or DUCK is used for deciphering. How a ProSe-enabled UE ensures the accuracy of the UTC-based counter is left to UE implementation.\nNOTE 3:\tThe UE can determine the received PROSE PC5 DISCOVERY message for 5G ProSe direct discovery announcement is for 5G ProSe direct discovery based on an indication from the lower layer.\nIn case of open 5G ProSe direct discovery, for a ProSe application ID requested by the monitoring UE, the 5G DDNMF may have assigned one or more discovery filters. If application-controlled extension is used, the UE may further apply additional filtering on the part corresponding to the ProSe application code suffix. The UE should apply all assigned discovery filters to its monitoring operation. Using these discovery filters may result in a match event. The UE shall consider that the ProSe application code it seeks to monitor has been discovered if there is a match event as following:\nWhen, for any of the ProSe application masks in a discovery filter, the output of a bitwise AND operation between the ProSe application code contained in the received PROSE PC5 DISCOVERY message and the ProSe application mask, matches the output of a bitwise AND operation between the ProSe application mask and the ProSe application code contained in the same discovery filter.\nNOTE 4:\tA ProSe application mask with all bits set to \"1\" is assigned by the 5G DDNMF for full matching.\nIn case of restricted 5G ProSe direct discovery model A, the UE provides the application level container, which contains the authorized Target RPAUID(s), to the upper layer applications. For each authorized target RPAUID, the 5G DDNMF may have assigned one or more restricted discovery filters. If application-controlled extension is used, the UE may further apply additional filtering on the part corresponding to the ProSe restricted code suffix. The UE should then apply all restricted discovery filters to its monitoring operation. Using these restricted discovery filters may result in a match event. The UE shall consider that the target RPAUID it seeks to monitor has been discovered if there is a match event as follows:\nWhen, for any of the masks in a restricted discovery filter, the output of a bitwise AND operation between the ProSe restricted code contained in the received PROSE PC5 DISCOVERY message and the mask, matches the output of a bitwise AND operation between the mask and the code contained in the same restricted discovery filter.\nNOTE 5:\tIn a restricted discovery filter, a mask with all bits set to \"1\" is assigned by the 5G DDNMF for full matching of a ProSe restricted code.\nDuring the monitoring UE procedure for 5G ProSe direct discovery, if the request from upper layers to perform the monitoring UE procedure for 5G ProSe direct discovery is not in place, or if the validity timer of the discovery filter or the validity timer of the Restricted discovery filter expires, the UE may instruct the lower layers to stop monitoring.\nWhen the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nIn this procedure, the UE sending the PROSE PC5 DISCOVERY message is called the \"Discoverer UE\" and the other UE is called the \"Discoveree UE\".\nThe UE is authorised to perform the discoverer UE procedure for 5G ProSe direct discovery if:\na)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe direct discovery discoverer operation when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\nb)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe direct discovery discoverer operation in the PLMN indicated by the serving cell; or\nc)\tthe UE is:\n1)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\ni)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\niii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\n2)\tauthorised to perform 5G ProSe direct discovery discoverer operation when the UE is not served by NG-RAN; and:\ni)\tconfigured with the radio parameters to be used for 5G ProSe direct discovery use when not served by NG-RAN; or\nii)\tthe lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure.\nNOTE 1:\tWhen the lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure, the serving cell broadcasts a common radio resources pool for ProSe discovery transmission and the UE can use this common radio resources pool while in limited service state.\notherwise, the UE is not authorised to perform the discoverer UE procedure for 5G ProSe direct discovery.\nFigure 6.2.14.2.2.2.1 illustrates the interaction of the UEs in the discoverer UE procedure for 5G ProSe direct discovery.\nThe figure depicts the procedure for 5G ProSe direct discovery, which is a technique used in the 5G network to enable seamless handover between devices. The figure shows the steps involved in the procedure, including the discovery of the discoverer UE, the selection of the appropriate frequency band, and the establishment of the connection. The figure also includes a visual representation of the signal path, highlighting the importance of signal reflection and combining at the receiver.\nFigure 6.2.14.2.2.2.1: Discoverer UE procedure for 5G ProSe direct discovery\nWhen the UE is triggered by an upper layer application to query the target RPAUID in restricted discovery Model B, associated with both the ProSe query code and the authorised ProSe identifier; and\na)\tif the UE is authorised to perform the discoverer UE procedure for 5G ProSe direct discovery in the registered PLMN or the local PLMN operating the radio resources that the UE intends to use; and\nb)\tif the validity timer T5070 for the ProSe query code and corresponding ProSe Response Filter(s) has not expired,\nthen the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11];\nb)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time and if the resulting UTC-based counter is within max offset of the time shown by the clock used for ProSe by the UE, the UE shall for each ProSe query code in this discovery entry, use the ProSe query code to construct a PROSE PC5 DISCOVERY message as below;\nc)\tshall generate a PROSE PC5 DISCOVERY message for 5G ProSe direct discovery solicitation. In the PROSE PC5 DISCOVERY message for 5G ProSe direct discovery solicitation, the UE:\n1)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.3;\n2)\tshall include ProSe query code;\n3)\tshall include the MIC field computed as described in 3GPP TS 33.503 [34] by using the UTC-based counter and the DUIK contained in the <restricted-discoverer-response > element of the DISCOVERY_RESPONSE message;\n4)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter; and\n5)\tshall include the discoveree user info set to the application layer ID of the discoveree UE if provided by the upper layers to identify a specific discoveree UE;\nd)\tshall apply the DUIK, DUSK, or DUCK with the associated encrypted bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.503 [34];\ne)\tshall set the destination layer-2 ID to the default destination layer-2 ID as specified in clause 5.2.3 and self-assign a source layer-2 ID for sending the direct discovery announcement; and\nNOTE 2:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2 and is different from any other self-assigned source layer-2 ID in use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a different discovery model as specified in clause 6.2.14.2.1.2, clause 6.2.15.2.1.2, clause 8.2.1.2.2.2 and clause 8.2.1.2.4.2.\nf)\tshall pass the resulting PROSE PC5 DISCOVERY message along with the source layer-2 ID and destination layer-2 ID for 5G ProSe direct discovery solicitation and the PLMN ID of the intended announcing PLMN if available in the discovery entry and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface and shall instruct the lower layer to start monitoring.\nThe UE shall ensure that it keeps on passing the same PROSE PC5 DISCOVERY message to the lower layers for transmission until the validity timer T5070 of the ProSe query code expires, or until the request from upper layers to query the target RPAUID in restricted discovery Model B, associated with both the ProSe query code and the authorised application identity, is not in place. How this is achieved is left up to UE implementation.\nNOTE 3:\tThe discoverer UE can stop discoverer UE procedure for 5G ProSe direct discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nThe UE may apply the discovery response filter(s) received from the 5G DDNMF to its monitoring operation. Using the discovery response filter may result in a match event for the target RPAUID the UE is querying for. There is match event when, for any of the masks in a discovery response filter, the output of a bitwise AND operation between the ProSe response code contained in the received PROSE PC5 DISCOVERY message and the mask, matches the output of a bitwise AND operation between the mask and the code contained in the discovery response filter.\nUpon reception of a PROSE PC5 DISCOVERY message for direct discovery response, for the target destination layer-2 ID of the direct discovery to be discovered, the UE shall use the associated DUSK, if received from the 5G DDNMF and the UTC-based counter obtained during the monitoring operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF, the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF, the UE shall use the DUIK and UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for direct discovery response. If a MIC Check Indicator parameter is included instead, the UE shall use the match report procedure described in clause 6.2.10 to trigger checking of the MIC of the PROSE PC5 DISCOVERY message containing the ProSe response code by the 5G DDNMF.\nThe UE may notify the upper layer application about the match event of restricted 5G ProSe direct discovery model B with the corresponding target RPAUID and metadata, if the RPAUID and metadata are included in the Subquery result element in the DISCOVERY_RESPONSE message from the 5G DDNMF.\nDuring the discoverer operation, if\na)\tthe validity timer T5070 for the ProSe query code and corresponding ProSe Response Filter(s) has expired; and\nb)\tthe request from upper layers to query the target RPAUID in restricted discovery Model B, associated with both the ProSe query code and the authorised ProSe identifier, is not in place,\nNOTE:\tThe discoverer UE can stop discoverer UE procedure for 5G ProSe direct discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nthen the UE may instruct the lower layers to stop the discoverer operation. When the UE stops discoverer operation, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe UE is authorised to perform the discoveree UE procedure for 5G ProSe direct discovery if:\na)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe direct discovery discoveree operation when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\nb)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe direct discovery discoveree operation in the PLMN indicated by the serving cell; or\nc)\tthe UE is:\n1)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\ni)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\niii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\n2)\tauthorised to perform 5G ProSe direct discovery discoveree operation when the UE is not served by NG-RAN; and:\ni)\tconfigured with the radio parameters to be used for 5G ProSe direct discovery use when not served by NG-RAN; or\nii)\tthe lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure.\nNOTE 1:\tWhen the lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure, the serving cell broadcasts a common radio resources pool for ProSe discovery transmission and the UE can use this common radio resources pool while in limited service state.\notherwise, the UE is not authorised to perform the discoveree UE procedure for 5G ProSe direct discovery.\nFigure 6.2.14.2.2.4.1 illustrates the interaction of the UEs in the discoveree UE procedure for 5G ProSe direct discovery.\nThe figure depicts a discoveree UE procedure for 5G ProSe direct discovery, illustrating the steps involved in the discovery process. The figure includes a schematic representation of the discoveree UE, with its components such as the discoveree, the UE, and the network. The figure also includes a flowchart to guide the user through the process, with arrows indicating the sequence of steps. The figure is a visual aid for understanding the process and is used in the context of 5G ProSe direct discovery, which is a method for discovering new network nodes.\nFigure 6.2.14.2.2.4.1: Discoveree UE procedure for 5G ProSe direct discovery\nWhen the UE is triggered by an upper layer application to perform discoveree operation for the RPAUID associated with an authorized ProSe identifier; and if:\na)\tthe UE is authorised to perform the discoveree UE procedure for 5G ProSe direct discovery;\nb)\tthe UE has obtained the ProSe response code and discovery query filter(s) and the respective validity timer T5068 for the corresponding discovery entry has not expired; and\nc)\tthe difference between UTC-based counter associated with that discovery slot and UE's ProSe clock is not greater than the max offset of the monitoring UE's ProSe clock,\nthen the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], shall perform a service request procedure or registration procedure as specified in 3GPP TS 24.501 [11]; and\nb)\tshall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13].\nThe UE may apply the discovery query filter(s) received from the 5G DDNMF to its monitoring operation. Using the discovery query filter(s) may result in a match event. There is match event when, for any of the masks in a discovery query filter, the output of a bitwise AND operation between the ProSe query code contained in the received PROSE PC5 DISCOVERY message and the mask, matches the output of a bitwise AND operation between the mask and the code contained in the discovery query filter.\nUpon reception of a PROSE PC5 DISCOVERY message for direct discovery solicitation for the destination layer-2 ID which the UE is configured to respond for, with applying a discovery query filter to a received PROSE PC5 DISCOVERY message for the above-mentioned bitwise AND operation, the UE shall use the associated DUSK, if received from the 5G DDNMF and the UTC-based counter obtained during the monitoring operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF, the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF, the UE shall use the DUIK and UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for direct discovery solicitation.\nNOTE 2:\tThe UE can look for a match on the unencrypted bits first before applying DUCK, to minimise the amount of processing performed before finding a match.\nNOTE 3:\tThe UE needs to verify the MIC field because the match report procedure is not used for checking the MIC of a PROSE PC5 DISCOVERY message containing a ProSe query code by the 5G DDNMF.\nNOTE 4:\tThe UE can determine the received PROSE PC5 DISCOVERY message for direct discovery solicitation is for 5G ProSe direct discovery based on an indication from the lower layer.\nIf the discoveree user info is included in the PROSE PC5 DISCOVERY message, the discoveree user info shall match the user info ID of the UE. Once the match of the discovery query filter(s) occurs, the UE process this match event and requests the lower layers to announce the corresponding ProSe response code in the PC5 interface as a response, as specified in 3GPP TS 38.331 [13]. If the UE in 5GMM-IDLE mode has to request resources for 5G ProSe direct discovery announcing as specified in 3GPP TS 38.331 [13], the UE shall perform a service request procedure or registration procedure as specified in 3GPP TS 24.501 [11]. The UE shall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time. If the resulting UTC-based counter is within max offset of the time shown by the clock used for ProSe by the UE, the UE shall use the ProSe response code received in the DISCOVERY_RESPONSE message from the 5G DDNMF. The UE shall generate a PROSE PC5 DISCOVERY message for 5G ProSe direct discovery response. In the PROSE PC5 DISCOVERY message for 5G ProSe direct discovery response, the UE:\na)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.4;\nb)\tshall include ProSe response code;\nc)\tshall include the MIC field computed as described in 3GPP TS 33.503 [34] by using the UTC-based counter and the DUIK contained in the <restricted-discoveree-response> element of the DISCOVERY_RESPONSE message;\nd)\tmay include the Metadata IE to provide the application layer metadata information; and\ne)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter.\nAfter generating the PROSE PC5 DISCOVERY message for 5G ProSe direct discovery response, the UE:\na)\tshall set the destination layer-2 ID to the source layer-2 ID of the received message and self-assign a source layer-2 ID for sending the direct discovery response message;\nNOTE 5:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\nb)\tshall apply the DUIK, DUSK, or DUCK with the associated encrypted bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.503 [34]; and\nc)\tshall pass the resulting PROSE PC5 DISCOVERY message along with the source layer-2 ID and destination layer-2 ID for 5G ProSe direct discovery response, the PLMN ID of the intended announcing PLMN and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface.\nNOTE 6:\tIf the UE is processing a PROSE DIRECT LINK ESTABLISHMENT REQUEST message from the same source layer-2 ID of the received PROSE PC5 DISCOVERY message for direct discovery solicitation, it depends on UE implementation to avoid the conflict of destination layer-2 ID (e.g. send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for unicast communication is detected\", or ignore the PROSE DIRECT DISCOVERY message for direct discovery solicitation).\nFor each match event with the discovery query filter(s), the UE shall at least pass PROSE PC5 DISCOVERY message once to the lower layers for transmission. The UE shall ensure that it keeps on passing PROSE PC5 DISCOVERY messages to the lower layers for transmission as response(s) to the match event(s) of the corresponding discovery query filter(s) until the validity timer T5068 expires. How this is achieved is left up to UE implementation.\nDuring the discoveree operation, if\na)\tthe validity timer T5068 for the ProSe response code and corresponding discovery query filter(s) has expired; and\nb)\tthe request from upper layers to perform discoveree operation for the RPAUID associated with an authorized ProSe identifier is not in place, then\nthe UE may instruct the lower layers to stop monitoring.\nWhen the UE stops monitoring, if the lower layers indicate that the UE is required to send a discovery indication to the NG-RAN and the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.15\tGroup member discovery over PC5 interface",
                            "text_content": "This clause describes the procedures for group member discovery over PC5 interface for both public safety use and commercial services. The purpose of the group member discovery procedure over PC5 interface is to enable a ProSe-enabled UE to detect and identify another ProSe-enabled UE that belongs to the same application layer group (e.g., sharing the same application layer group ID) over PC5 interface.\nTo perform group member discovery over PC5 interface, the UE is configured with the related information as described in clause 5.2.3. The following models for group member discovery procedure over PC5 interface as specified in 3GPP TS 23.304 [2] are supported:\na)\tModel A uses a single discovery protocol message (Announcement); and\nb)\tModel B uses two discovery protocol messages (Solicitation and Response).\nNOTE:\tIf the UE is authorized to perform both group member discovery over PC5 interface with Model A and group member discovery over PC5 interface with Model B, it is up to UE implementation to select which model to perform or perform both models simultaneously.\nThe following procedures are defined for group member discovery procedure over PC5 interface:\na)\tGroup member discovery over PC5 interface with Model A:\n1)\tAnnouncing UE procedure for group member discovery initiation;\n2)\tAnnouncing UE procedure for group member discovery completion;\n3)\tMonitoring UE procedure for group member discovery initiation; and\n4)\tMonitoring UE procedure for group member discovery completion; and\nb)\tGroup member discovery over PC5 interface with Model B:\n1)\tDiscoverer UE procedure for group member discovery initiation;\n2)\tDiscoverer UE procedure for group member discovery completion;\n3)\tDiscoveree UE procedure for group member discovery initiation; and\n4)\tDiscoveree UE procedure for group member discovery completion.\nThe group member discovery over PC5 interface with Model A can only discover the targeted group members that are identified by the configured application layer group ID. The group member discovery over PC5 interface with Model B can either discover a specific group member of the application layer group identified by the configured application layer group ID or the targeted group members that are identified by the configured application layer group ID.\nIn this procedure, the UE sending the PROSE PC5 DISCOVERY message is called the \"announcing UE\" and the other UE is called the \"monitoring UE\".\nThe UE is authorised to perform the announcing UE procedure for group member discovery if:\na)\tthe following is true:\n1)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe direct discovery using announcing procedure when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\n2)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe direct discovery using announcing in the PLMN indicated by the serving cell; or\n3)\tthe UE is:\ni)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed \" as specified in 3GPP TS 24.501 [11]; and\nii)\tauthorised to perform 5G ProSe direct discovery using announcing when the UE is not served by NG-RAN and:\nA)\tconfigured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN; or\nB)\tthe lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure; and\nNOTE 1:\tWhen the lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure, the serving cell broadcasts a common radio resources pool for 5G ProSe discovery transmission and the UE can use this common radio resources pool while in limited service state.\nb)\tthe UE is configured with the application layer group ID identifying the application layer group to be announced and with the User info ID for the group member discovery parameter;\notherwise, the UE is not authorised to perform the announcing UE procedure for group member discovery procedure.\nFigure 6.2.15.2.1.2.1 illustrates the interaction of the UEs in the announcing UE procedure for group member discovery.\nThe figure depicts a procedure for group member discovery in an 5G network, with the UE (User Equipment) initiating the discovery process. The figure includes a diagram of the network architecture, with the base station (gNB) as the central element, and the UE as the primary user. The figure also illustrates the use of beamforming techniques to mitigate interference, with the UE transmitting signals towards the gNB and other nodes in the network. The figure is a visual representation of the communication process in an 5G network, highlighting the importance of group member discovery in ensuring network reliability and efficiency.\nFigure 6.2.15.2.1.2.1: Announcing UE procedure for group member discovery\nWhen the UE is triggered by an upper layer application to announce availability in a discovery group, if the UE is authorised to perform the announcing UE procedure for group member discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11];\nb)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nc)\tshall generate a PROSE PC5 DISCOVERY message for group member discovery announcement. In the PROSE PC5 DISCOVERY message for group member discovery announcement, the UE:\n1)\tshall set the announcer info parameter to the User info ID for the group member discovery parameter; and\n2)\tshall set the application layer group ID parameter to the application layer group ID parameter identifying the discovery group to be announced;\n3)\tshall include the MIC filed computed as described in 3GPP TS 33.503 [34], by using the UTC-based counter and the DUIK contained in the <restricted-announce-response> element of the DISCOVERY_RESPONSE message;\n4)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter;\n5)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.5; and\n6)\tmay include the Metadata IE to provide the application layer discovery message;\nd)\tshall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.303[36];\ne)\tshall apply one of the following to determine the destination layer-2 ID:\n1)\tif the application layer group ID has a configured layer-2 group ID as specified in clause 5.2.3, set the destination layer-2 ID to the layer-2 group ID; or\n2)\totherwise, convert the application layer group ID into a destination layer-2 ID as following:\ni)\tto use the group identifier as the input to the SHA-256 hashing algorithm as specified in ISO/IEC 10118-3:2018 [28]; and\nii)\tto use the 24 least significant bits of the 256 bits of the output as destination layer-2 ID;\nNOTE 2:\tSHA-256 hashing algorithm is implemented in the ME.\nf)\tshall self-assign a source layer-2 ID for sending the group member discovery announcement message; and\nNOTE 3:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2 and is different from any other self-assigned source layer-2 ID in use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a different discovery model as specified in clause 6.2.14.2.2.2, clause 6.2.15.2.2.2 and clause 8.2.1.3.1.2.\ng)\tshall pass the resulting PROSE PC5 DISCOVERY message for group member discovery announcement along with the source layer-2 ID and the destination layer-2 ID to the lower layers for transmission over the PC5 interface.\nThe announcing UE shall ensure that it keeps on passing the same PROSE PC5 DISCOVERY message to the lower layers for transmission until the announcing UE is triggered by an upper layer application to stop announcing availability in a discovery group, or until the UE stops being authorised to perform the announcing UE procedure for group member discovery.\nNOTE 4:\tThe announcing UE can stop announcing UE procedure for group member discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the announcing UE is triggered by an upper layer application to stop announcing availability in a discovery group, or when the announcing UE stops being authorised to perform the announcing UE procedure for group member discovery, the UE shall instruct the lower layers to stop announcing.\nNOTE:\tThe announcing UE can stop announcing UE procedure for group member discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the UE stops announcing, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe UE is authorised to perform the monitoring UE procedure for group member discovery if:\na)\tthe following is true:\n1)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe direct discovery using monitoring when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\n2)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe direct discovery monitoring in at least one PLMN; or\n3)\tthe UE is:\ni)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\nii)\tauthorised to perform 5G ProSe direct discovery using monitoring when the UE is not served by NG-RAN; and:\nA)\tconfigured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN; or\nB)\tthe lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure; and\nNOTE 1:\tWhen the lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure, the serving cell broadcasts a common radio resources pool for 5G ProSe discovery transmission and the UE can use this common radio resources pool while in limited service state.\nb)\tthe UE is configured with the application layer group ID parameter identifying the discovery group to be monitored;\notherwise, the UE is not authorised to perform the monitoring UE procedure for group member discovery.\nFigure 6.2.15.2.1.4.1 illustrates the interaction of the UEs in the monitoring UE procedure for group member discovery.\nThe figure depicts a monitoring system for group member discovery in a 5G network. It shows a UE (User Equipment) with a camera and a microphone, which are used to detect and identify group members. The system includes a set of cameras and microphones, as well as a control panel for configuring the system. The figure illustrates the importance of group member discovery in ensuring the security and reliability of the network.\nFigure 6.2.15.2.1.4.1: Monitoring UE procedure for group member discovery\nWhen the UE is triggered by an upper layer application to monitor proximity of other UEs in a discovery group and if the UE is authorised to perform the monitoring UE procedure for group member discovery, then the UE shall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY message as following:\na)\tif the application layer group ID has a configured layer-2 group ID as specified in clause 5.2.3, the UE shall monitor for PROSE PC5 DISCOVERY message with the layer-2 group ID as specified in clause 5.2.3; or\nb)\totherwise, the UE shall convert the application layer group ID into a destination layer-2 ID and shall monitor for PROSE PC5 DISCOVERY message with the converted destination layer-2 ID. The UE shall convert the application layer group ID into a destination layer-2 ID as following:\n1)\tto use the group identifier as the input to the SHA-256 hashing algorithm as specified in ISO/IEC 10118-3:2018 [28]; and\n2)\tto use the 24 least significant bits of the 256 bits of the output as destination layer-2 ID.\nNOTE 2:\tSHA-256 hashing algorithm is implemented in the ME.\nUpon reception of a PROSE PC5 DISCOVERY message for group member discovery announcement, for the target application layer group ID of the discovery group to be monitored, the UE shall use the associated DUSK, if configured or calculated using the PSDK and the UTC-based counter obtained during the monitoring operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.303 [36]. Then, if a DUCK is configured or calculated using the PSDK, the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.303 [36]. Finally, if a DUIK is configured or calculated using the PSDK, the UE shall use the DUIK and UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for group member discovery announcement.\nNOTE 3:\tThe use of an erroneous UTC-based counter for processing received PROSE PC5 DISCOVERY messages at the ProSe-enabled UE can cause MIC check failure after DUIK is used for integrity check and malformed contents after DUSK is used for unscrambling or DUCK is used for deciphering. How a ProSe-enabled UE ensures the accuracy of the UTC-based counter is left to UE implementation.\nThen if the application layer group ID parameter of the PROSE PC5 DISCOVERY message for group member discovery announcement is the same as the configured application layer group ID parameter as specified in clause 5, the UE shall consider that other UE in the discovery group the UE seeks to monitor has been discovered.\nWhen the UE is triggered by an upper layer application to stop monitoring proximity of other UEs in a discovery group, or when the UE stops being authorised to perform the monitoring UE procedure for group member discovery, the UE shall instruct the lower layers to stop monitoring.\nWhen the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nIn this procedure, the UE sending the PROSE PC5 DISCOVERY message is called the \"discoverer UE\" and the other UE is called the \"discoveree UE\".\nThe UE is authorised to perform the discoverer UE procedure for group member discovery if:\na)\tthe following is true:\n1)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe direct discovery discoverer operation when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\n2)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe direct discovery discoverer operation in the PLMN indicated by the serving cell; or\n3)\tthe UE is:\ni)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\nii)\tauthorised to perform 5G ProSe direct discovery discoverer operation when the UE is not served by NG-RAN and:\nA)\tconfigured with the radio parameters to be used for 5G ProSe direct discovery use when not served by NG-RAN; or\nB)\tthe lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure; and\nNOTE 1:\tWhen the lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure, the serving cell broadcasts a common radio resources pool for 5G ProSe discovery transmission and the UE can use this common radio resources pool while in limited service state.\nb)\tthe UE is configured with the application layer group ID parameter identifying the discovery group to be solicited and with the User info ID for the group member discovery parameter;\notherwise, the UE is not authorised to perform the discoverer UE procedure for group member discovery.\nFigure 6.2.15.2.2.2.1 illustrates the interaction of the UEs in the discoverer UE procedure for group member discovery.\nThe figure depicts a procedure for group member discovery in a 5G network, showing the steps taken by the discoverer UE to identify and locate other group members. The figure includes a flowchart with arrows indicating the sequence of actions, and labels for each step, such as \"Identify,\" \"Send Request,\" and \"Receive Response.\" The figure is a visual representation of the communication process, providing a clear and concise explanation of the steps involved in group member discovery in a 5G network.\nFigure 6.2.15.2.2.2.1: Discoverer UE procedure for group member discovery\nWhen the UE is triggered by an upper layer application to solicit proximity of other UEs in a discovery group and if the UE is authorised to perform the discoverer UE procedure for group member discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11];\nb)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nc)\tshall generate a PROSE PC5 DISCOVERY message for group member discovery solicitation. In the PROSE PC5 DISCOVERY message for group member discovery solicitation, the UE:\n1)\tshall set the discoverer info parameter to the user info ID for the group member discovery parameter;\n2)\tshall set the application layer group ID parameter to the application layer group ID parameter identifying the discovery group to be solicited;\n3)\tshall set the target user info parameter to the target info, if the target information is provided by the upper layers to identify a specific group member of the application layer group identified by the configured application layer group ID;\nNOTE 2:\tIf the PROSE PC5 DISCOVERY message for group member discovery solicitation does not indicate any specific target UE (i.e., target user info is not included in the PROSE PC5 DISCOVERY message), the PROSE PC5 DISCOVERY message for group member discovery solicitation is only used to discover the targeted group members that are identified by the configured application layer group ID.\n4)\tshall include the MIC filed computed as described in 3GPP TS 33.503 [34] by using the UTC-based counter and the DUIK contained in the <restricted-discoverer-response> element of the DISCOVERY_RESPONSE message;\n5)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter; and\n6)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.6;\nd)\tshall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.303 [36];\ne)\tshall apply one of the following to determine the destination layer-2 ID:\n1)\tif the application layer group ID has a configured layer-2 group ID as specified in clause 5.2.3, set the destination layer-2 ID to the layer-2 group ID; or\n2)\totherwise, convert the application layer group ID into a destination layer-2 ID as following:\ni)\tto use the group identifier as the input to the SHA-256 hashing algorithm as specified in ISO/IEC 10118-3:2018 [28]; and\nii)\tto use the 24 least significant bits of the 256 bits of the output as destination layer-2 ID;\nNOTE 3:\tSHA-256 hashing algorithm is implemented in the ME.\nf)\tshall self-assign a source layer-2 ID for sending the group member discovery solicitation message; and\nNOTE 4:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2, and is different from any other self-assigned source layer-2 ID in use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a different discovery model as specified in clause 6.2.14.2.1.2, clause 6.2.15.2.1.2, clause 8.2.1.2.2.2 and clause 8.2.1.2.4.2.\ng)\tshall pass the resulting PROSE PC5 DISCOVERY message for group member discovery solicitation along with the source layer-2 ID and destination layer-2 ID to the lower layers for transmission over the PC5 interface.\nThe UE shall ensure that it keeps on passing the same PROSE PC5 DISCOVERY message to the lower layers for transmission with an indication that the message until the UE is triggered by an upper layer application to stop soliciting proximity of other UEs in a discovery group, or until the UE stops being authorised to perform the discoverer UE procedure for group member discovery. How this is achieved is left up to UE implementation.\nNOTE 5:\tThe discoverer UE can stop discoverer UE procedure for group member discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nUpon reception of a PROSE PC5 DISCOVERY message for group member discovery response, for the target application layer group ID of the discovery group to be discovered, the UE shall use the associated DUSK, if configured or calculated using the PSDK and the UTC-based counter obtained during the monitoring operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.303 [36]. Then, if a DUCK is configured or calculated using the PSDK, the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.303 [36]. Finally, if a DUIK is configured or calculated using the PSDK, the UE shall use the DUIK and UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for group member discovery response.\nThen if:\na)\tthe application layer group ID parameter of the PROSE PC5 DISCOVERY message for group member discovery response is the same as the application layer group ID parameter of the PROSE PC5 DISCOVERY message for group member discovery solicitation, and\nb)\tthe target information is not provided by the upper layers to identify a specific group member of the application layer group, or the discoveree info in the PROSE PC5 DISCOVERY message for group member discovery response is the same as the target information if the target information is provided by the upper layers,\nthe UE shall consider that other UE in the discovery group the UE seeks to discover has been discovered.\nWhen the UE is triggered by an upper layer application to stop soliciting proximity of other UEs in a discovery group, or when the UE stops being authorised to perform the discoverer UE procedure for group member discovery, the UE shall instruct the lower layers to stop discoverer operation.\nNOTE:\tThe discoverer UE can stop discoverer UE procedure for group member discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the UE stops discoverer operation, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe UE is authorised to perform the discoveree UE procedure for group member discovery if:\na)\tthe following is true:\n1)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe direct discovery discoveree operation when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\n2)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe direct discovery discoveree operation in the PLMN(s) indicated by the serving cell; or\n3)\tthe UE is:\ni)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\nii)\tauthorised to perform 5G ProSe direct discovery discoveree operation when the UE is not served by NG-RAN; and:\nA)\tconfigured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN; or\nB)\tthe lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure; and\nNOTE 1:\tWhen the lower layers indicate that the UE does not need to request resources for 5G ProSe direct discovery procedure, the serving cell broadcasts a common radio resources pool for 5G ProSe discovery transmission and the UE can use this common radio resources pool while in limited service state.\nb)\tthe UE is configured with the application layer group ID parameter identifying the discovery group to be responded to and with the User info ID for the group member discovery parameter;\notherwise, the UE is not authorised to perform the discoveree UE procedure for group member discovery.\nFigure 6.2.15.2.2.4.1 illustrates the interaction of the UEs in the discoveree UE procedure for group member discovery.\nThe figure depicts a procedure for group member discovery in a 5G network, showing the steps taken by the discoveree UE to identify and authenticate other group members. The figure includes a flowchart with arrows indicating the sequence of actions, and labels for each step, such as \"Identify,\" \"Verify,\" and \"Authenticate.\" The figure is a visual representation of the complex process involved in group member discovery in a 5G network, highlighting the importance of proper authentication and verification procedures to ensure the security and integrity of the network.\nFigure 6.2.15.2.2.4.1: Discoveree UE procedure for group member discovery\nWhen the UE is triggered by an upper layer application to start responding to solicitation on proximity of a UE in a discovery group and if the UE is authorised to perform the discoveree UE procedure for group member discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11]; and\nb)\tshall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY messages.\nUpon reception of a PROSE PC5 DISCOVERY message for group member discovery solicitation, for the application layer group ID of the discovery group which the UE is configured to respond for, the UE shall use the associated DUSK, if configured or calculated using the PSDK and the UTC-based counter obtained during the monitoring operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.303 [36]. Then, if a DUCK is configured or calculated using the PSDK, the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality protected portion, as described in 3GPP TS 33.303 [36]. Finally, if a DUIK is configured or calculated using the PSDK, the UE shall use the DUIK and UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for group member discovery solicitation.\nThen, if:\na)\tthe application layer group ID parameter of the received PROSE PC5 DISCOVERY message is the same as the application layer group ID parameter for the discovery group; and\nb)\tthe target user info parameter is not included in the received PROSE PC5 DISCOVERY message or the target user info parameter in the received PROSE PC5 DISCOVERY message is the same as the user info ID for the group member discovery provided by the upper layers  or same as the configured user info ID for the group member discovery as specified in clause 5.2.3;\nthe UE:\na)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nb)\tshall generate a PROSE PC5 DISCOVERY message for group member discovery response. In the PROSE PC5 DISCOVERY message for group member discovery response, the UE:\n1)\tshall set the discoveree info parameter to the user info ID for the group member discovery parameter;\n2)\tshall set the application layer group ID parameter to the application layer group ID parameter of the PROSE PC5 DISCOVERY message for group member discovery solicitation;\n3)\tshall include the MIC filed computed as described in 3GPP TS 33.503 [34] by using the UTC-based counter and the DUIK contained in the <restricted-discoveree-response> element of the DISCOVERY_RESPONSE message;\n4)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter;\n5)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.7; and\n6)\tmay include the Metadata IE to provide the application layer discovery message;\nc)\tshall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.303 [36];\nd)\tshall set the destination layer-2 ID to the source layer-2 ID from the discoverer UE used in the transportation of the PROSE PC5 DISCOVERY message for group member discovery solicitation and self-assign a source layer-2 ID for sending the group member discovery response message; and\nNOTE 2:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\ne)\tshall pass the resulting PROSE PC5 DISCOVERY message for group member discovery response along with the source layer-2 ID and the destination layer-2 ID to the lower layers for transmission over the PC5 interface.\nNOTE 3:\tIf the UE is processing a PROSE DIRECT LINK ESTABLISHMENT REQUEST message from the same source layer-2 ID of the received PROSE PC5 DISCOVERY message for group member discovery solicitation, it depends on UE implementation to avoid the conflict of destination layer-2 ID (e.g. send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for unicast communication is detected\", or ignore the PROSE DIRECT DISCOVERY message for group member discovery solicitation).\nWhen the UE is triggered by an upper layer application to stop responding to solicitation on proximity of other UEs in a discovery group, or when the UE stops being authorised to perform the discoveree UE procedure for group member discovery, the UE shall instruct the lower layers to stop monitoring.\nWhen the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.16\tProcedure for UE to use provisioned radio resources for 5G ProSe direct discovery",
                            "text_content": "When the UE is not served by NG-RAN for 5G ProSe direct discovery and is authorized to use 5G ProSe direct discovery, the UE shall select the corresponding radio parameters to be used for 5G ProSe direct discovery as follows:\na)\tif the UE can determine itself located in a geographical area and the UE is provisioned with radio parameters for the geographical area, the UE shall select the radio parameters associated with that geographical area; or\nb)\tin all other cases, the UE shall not initiate 5G ProSe direct discovery over PC5.\nIf the UE intends to use \"non-operator managed\" radio parameters as specified in clause 5.2.3, the UE shall initiate 5G ProSe direct discovery with the selected radio parameters.\nIf the UE intends to use \"operator managed\" radio parameters as specified in clause 5.2.3, before initiating 5G ProSe direct discovery, the UE shall check with lower layers whether the selected radio parameters can be used in the current location without causing interference to other cells as specified in 3GPP TS 38.331 [13]; and:\na)\tif the lower layers indicate that the usage would not cause any interference, the UE shall initiate 5G ProSe direct discovery; or\nNOTE:\tIf the lower layers find that there exists a cell operating the provisioned radio resources (i.e., carrier frequency) and the cell belongs to the registered PLMN or a PLMN equivalent to the registered PLMN and the UE is authorized for 5G ProSe direct discovery in this PLMN, the UE can use the radio parameters indicated by the cell as specified in 3GPP TS 38.331 [13].\nb)\telse if the lower layers report that one or more PLMNs operate in the provisioned radio resources (i.e., carrier frequency) then:\n1)\tif the following conditions are met:\ni)\tnone of the PLMNs reported by the lower layers is the registered PLMN or equivalent to the registered PLMN;\nii)\tat least one of the PLMNs reported by the lower layers is in the list of authorized PLMNs for 5G ProSe direct discovery and provides radio resources for 5G ProSe direct discovery as specified in 3GPP TS 38.331 [13]; and\niii)\tthe UE does not have an emergency PDU session;\nthen the UE shall:\ni)\tif in 5GMM-IDLE mode, perform PLMN selection triggered by 5G ProSe direct discovery as specified in 3GPP TS 23.122 [14]; or\nii)\telse if in 5GMM-CONNECTED mode, either:\nA)\tperform a De-registration procedure as specified in 3GPP TS 24.501 [11] and then perform PLMN selection triggered by 5G ProSe direct discovery as specified in 3GPP TS 23.122 [14]; or\nB)\tnot initiate 5G ProSe direct discovery.\nWhether the UE performs i) or ii) above is left up to UE implementation; or\n2)\telse the UE shall not initiate 5G ProSe direct discovery.\nIf the registration to the selected PLMN is successful, the UE shall proceed with the procedure to initiate 5G ProSe direct discovery as specified in clause 6.2.14 and clause 6.2.15.\nIf the UE is performing 5G ProSe direct discovery using radio parameters associated with a geographical area and moves out of that geographical area, the UE shall stop performing 5G ProSe direct discovery and then if the UE is not served by NG-RAN for 5G ProSe direct discovery, the UE shall select appropriate radio parameters for the new geographical area as specified above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.17\t5G PKMF address request procedure",
                            "text_content": "The purpose of the 5G PKMF address request procedure is to allow a UE to obtain a 5G PKMF address from the 5G DDNMF in HPLMN over PC3a interface as specified in 3GPP TS 33.503 [34] for the security procedure over user plane. A UE may initiate a 5G PKMF address request procedure:\na)\twhen the UE needs to obtain a 5G PKMF address from the 5G DDNMF in HPLMN on demand; or\nb)\twhen the UE can not access the 5G PKMF using the 5G PKMF address provisioned by the network as specified in clause 5.2.5.\nTo initiate a 5G PKMF address request procedure, the UE shall be configured with the authorized parameters for 5G ProSe UE-to-network relay as specified in clause 5.2.5 or the authorized parameters for 5G ProSe UE-to-UE relay as specified in clause 5.2.7. Both the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE are allowed to initiate the 5G PKMF address request procedure for 5G ProSe UE-to-network relay. Both the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE are allowed to initiate the 5G PKMF address request procedure for 5G ProSe UE-to-UE relay.\nNOTE:\tThe UE is allowed to access the 5G PKMF directly without initiating a 5G PKMF address request procedure if it is pre-configured with the 5G PKMF address as specified in clause 5.2.5 and clause 5.2.7.\nThe UE shall initiate the 5G PKMF address request procedure by sending a PROSE_5GPKMF_ADDRESS_REQUEST message with the <PKMF-address-request> element. In the <PKMF-address-request> element, the UE:\na)\tshall include a new transaction ID not used in any other direct discovery procedures in PC3a interface.\nFigure 6.2.17.2.1 illustrates the interaction of the UE and the 5G DDNMF in the 5G PKMF address request procedure.\nThe figure depicts the process of a 5G packet-level multicast forwarding (PKMF) address request procedure. It illustrates the steps taken by the network to determine the multicast group and the corresponding multicast address for a packet. The figure shows the network's ability to handle multicast traffic efficiently, as it uses a hierarchical approach to address the multicast group. This is crucial for ensuring reliable and efficient communication in 5G networks.\nFigure 6.2.17.2.1: 5G PKMF address request procedure\nUpon receiving a PROSE_5GPKMF_ADDRESS_REQUEST message, the 5G DDNMF shall check whether the UE is authorized for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay. If authorized, the 5G DDNMF shall then send a PROSE_5GPKMF_ADDRESS_RESPONSE message with the <PKMF-address-response> element. In the <PKMF-address-response> element, the 5G DDNMF shall include:\na)\tthe transaction ID set to the value of the transaction ID received in the PROSE_5GPKMF_ADDRESS_REQUEST message from the UE; and\nb)\tthe PKMF address set to the value of the 5G PMKF address in the HPLMN of the UE.\nUpon receiving the PROSE_5GPKMF_ADDRESS_RESPONSE message with the <PKMF-address-response> element, if the transaction ID matches the value sent by the UE in a PROSE_5GPKMF_ADDRESS_REQUEST message, the UE shall store the received 5G PKMF address.\nIf the PROSE_5GPKMF_ADDRESS_REQUEST message cannot be accepted by the 5G DDNMF, the 5G DDNMF sends a PROSE_5GPKMF_ADDRESS_RESPONSE message containing a <PKMF-address-reject> element to the UE including an appropriate PC3a control protocol cause value and including the transaction ID set to the value of the transaction ID received in the PROSE_5GPKMF_ADDRESS_REQUEST message.\nUpon receipt of the PROSE_5GPKMF_ADDRESS_RESPONSE message with the <PKMF-address-reject> element, if the transaction ID matches the value sent by the UE in a PROSE_5GPKMF_ADDRESS_REQUEST message, the UE shall consider the 5G PKMF address request procedure as rejected.\nIf the UE is not authorized for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay, the 5G DDNMF shall send the PROSE_5GPKMF_ADDRESS_RESPONSE message containing a <PKMF-address-reject> element with PC3a control protocol cause value #3 \"UE authorization failure\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of PROSE_5GPKMF_ADDRESS_REQUEST message (e.g., after TCP retransmission timeout).\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the 5G PKMF address request procedure.\nb)\tNo response from the 5G DDNMF after the PROSE_5GPKMF_ADDRESS_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the PROSE_5GPKMF_ADDRESS_REQUEST message).\nThe UE shall retransmit the PROSE_5GPKMF_ADDRESS_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nc)\tChange of PLMN.\nIf a PLMN change occurs before the 5G PKMF address request procedure is completed, the procedure shall be aborted. If the UE is authorized to initiate the 5G PKMF address request procedure in the new PLMN, the procedure shall be restarted once the UE is registered on the new PLMN.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of PROSE_5GPKMF_ADDRESS_REQUEST message.\nAfter receiving an indication from lower layer that the PROSE_5GPKMF_ADDRESS_REQUEST message has not been successfully acknowledged (e.g., TCP ACK is not received), the 5G DDNMF shall abort the procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\t5G ProSe direct communications",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the procedures at the UE and between UEs, for 5G ProSe direct communication over PC5.\nThe UE shall support requirements for securing 5G ProSe direct communication over PC5.\nTo perform the 5G ProSe direct communication over PC5, the UE shall be configured with the corresponding configurations as specified in clause 5.2.4. If a UE cannot derive any of the necessary configurations (e.g. NR Tx profile, ProSe NR frequencies, PC5 QoS parameters) according to the mapping rules for the ProSe identifier of a ProSe service (see 3GPP TS 24.555 [17]), then the UE is not allowed to perform any operation as specified in clause 7 for the ProSe service.\nThe PC5 interface is selected based on the ProSe application to path preference mapping rules as specified in clause 5.2.4 before 5G ProSe direct communication.\nFor unicast mode 5G ProSe direct communication, the following data unit types are supported: IPv4, IPv6, Ethernet and Unstructured.\nFor broadcast and groupcast mode 5G ProSe communication, the following data unit types are supported: IPv4, IPv6, Ethernet, Unstructured and Address Resolution Protocol (see RFC 826 [32]).\n5G ProSe direct communication over NR-PC5 supports broadcast mode, groupcast mode and unicast mode. If the upper layer of the UE indicates the mode of communication, the UE shall set the mode of communication based on the request of the upper layer. Otherwise, the UE shall set the mode of communication based on the mapping rules between the 5G ProSe identifiers and the default mode of communication defined in clause 5.2.4.\nNOTE:\tFurther details about whether broadcast, unicast or groupcast can be used over PC5 are described in 3GPP TS 23.304 [3] clause 5.3.\nThe UE may use the PC5 DRX mechanism to perform 5G ProSe direct communication over PC5 interface for broadcast mode and groupcast mode when the UE is not served by NG-RAN as specified in clause 5.2.4. For transmitting and receiving direct communication request messages (i.e. the PROSE DIRECT LINK ESTABLISHMENT REQUEST message), the default PC5 DRX configuration is used (see 3GPP TS 38.300 [21]).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2\tUnicast mode 5G ProSe direct communication over PC5",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.2.1\tOverview",
                            "text_content": "This clause describes the PC5 signalling protocol procedures between two UEs for one-to-one (i.e., unicast) mode of ProSe direct communication. The following PC5 signalling protocol procedures are defined:\na)\t5G ProSe direct link establishment;\nb)\t5G ProSe direct link modification;\nc)\t5G ProSe direct link release;\nd)\t5G ProSe direct link identifier update;\ne)\t5G ProSe direct link keep-alive;\nf)\t5G ProSe direct link security mode control;\ng)\t5G ProSe direct link re-keying;\nh)\t5G ProSe direct link authentication;\ni)\t5G ProSe direct link UE-to-UE relay update; and\nj)\t5G ProSe direct link identification.\nEach 5G ProSe direct link is associated with a 5G ProSe direct link context. For 5G ProSe UE-to-network relay, the 5G ProSe direct link context includes:\na)\tuser info ID and layer-2 ID of 5G ProSe remote UE;\nb)\tuser info ID and layer-2 ID of 5G ProSe UE-to-network relay UE;\nc)\trelay service code; and\nd)\tin the case of 5G ProSe Layer-3 UE-to-network relay, the network layer protocol and the information about PC5 QoS flow(s).\nFor 5G ProSe UE-to-UE relay, the 5G ProSe direct link context includes:\na)\tuser info ID and layer-2 ID of source 5G ProSe end UE;\nb)\tuser info ID and layer-2 ID of target 5G ProSe end UE;\nb)\tuser info ID and layer-2 ID of 5G ProSe UE-to-UE relay UE;\nc)\trelay service code; and\nd)\tin the case of 5G ProSe layer-3 UE-to-UE relay, the network layer protocol and the information about PC5 QoS flow(s), also the IP address(es) of the 5G ProSe end UE(s) at the 5G ProSe layer-3 UE-to-UE relay UE.\nThe 5G ProSe direct link context shall be created during a 5G ProSe direct link establishment procedure, be updated accordingly after a 5G ProSe direct link modification procedure or 5G ProSe direct link identifier update procedure and be deleted during the 5G ProSe direct link release procedure or during a local release of 5G ProSe direct link as specified in clause 7.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.2\t5G ProSe direct link establishment procedure",
                            "text_content": "Depending on the type of the 5G ProSe direct link establishment procedure (i.e., UE oriented layer-2 link establishment or ProSe service oriented layer-2 link establishment in 3GPP TS 23.304 [2]), the 5G ProSe direct link establishment procedure is used to establish a 5G ProSe direct link between two UEs or to establish multiple 5G ProSe direct links between the UE and multiple target UEs. The UE sending the request message is called the \"initiating UE\" and the other UE is called the \"target UE\". If the request message does not indicate the specific target UE (i.e., target user info is not included in the request message) and multiple target UEs are interested in the ProSe application(s) indicated in the request message, then the initiating UE shall handle corresponding response messages received from those target UEs. The maximum number of 5G ProSe direct links established in a UE at a time shall not exceed an implementation-specific maximum number of established 5G ProSe direct links.\nNOTE 1:\tThe recommended maximum number of established 5G ProSe direct links is 8.\nWhen the 5G ProSe direct link establishment procedure for a 5G ProSe layer-3 remote UE completes successfully and if there is a PDU session established for relaying the traffic of the 5G ProSe remote UE, the 5G ProSe layer-3 UE-to-network relay UE shall perform the remote UE report procedure as specified in 3GPP TS 24.501 [11].\nNOTE 2:\tA single PC5 unicast link is established between a 5G ProSe layer-2 UE-to-network relay UE and a 5G ProSe layer-2 remote UE for supporting PDU sessions of the 5G ProSe layer-2 remote UE, as specified in 3GPP TS 38.300 [21].\nThe initiating UE shall meet the following pre-conditions before initiating this procedure:\na)\tthe UE receives a request from upper layers to transmit the packet for ProSe application over PC5, a request from lower layers, or a PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK MODIFICATION REQUEST message in case of 5G ProSe UE-to-UE relay, to trigger ProSe direct link establishment;\nb)\tthe communication mode is unicast mode (e.g., pre-configured as specified in clause 5.2.4 or indicated by upper layers);\nc)\tthe link layer identifier for the initiating UE (i.e., layer-2 ID used for unicast communication) is available (e.g., pre-configured or self-assigned) and is not being used by other existing 5G ProSe direct links within the initiating UE;\nd)\tthe link layer identifier for the destination UE (i.e., the unicast layer-2 ID of the target UE or the broadcast layer-2 ID) is available to the initiating UE (e.g., pre-configured, obtained as specified in clause 5.2, known via prior ProSe direct communication or indicated by lower layers);\nNOTE 1:\tIn the case where different ProSe applications are mapped to distinct default destination layer-2 IDs, when the initiating UE intends to establish a single unicast link that can be used for more than one ProSe identifiers, the UE can select any of the default destination layer-2 ID for unicast initial signalling.\ne)\tthe initiating UE is either authorised for 5G ProSe direct communication over PC5 in NR-PC5 in the serving PLMN, has a valid authorization for 5G ProSe direct communication over PC5 in NR-PC5 when not served by NG-RAN, is authorized to use a 5G ProSe UE-to-network relay UE, is authorized to use a 5G ProSe UE-to-UE relay UE or is authorized to act as a 5G ProSe UE-to-UE relay UE. The UE considers that it is not served by NG-RAN if the following conditions are met:\n1)\tnot served by NG-RAN for ProSe direct communication over PC5;\n2)\tin limited service state as specified in 3GPP TS 23.122 [14], if the reason for the UE being in limited service state is one of the following;\ni)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11];\niii)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; or\niv)\tthe UE does not have a valid USIM, the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, and the RSC is specific for emergency services; or\n3)\tin limited service state as specified in 3GPP TS 23.122 [14] for reasons other than i), ii), iii) or iv) above and located in a geographical area for which the UE is provisioned with \"non-operator managed\" radio parameters as specified in clause 5.2;\nf)\tthere is no existing 5G ProSe direct link for the pair of peer application layer IDs, or there is an existing 5G ProSe direct link for the pair of peer application layer IDs and:\n1)\tthe network layer protocol of the existing 5G ProSe direct link is not identical to the network layer protocol required by the upper layer in the initiating UE for this ProSe application;\n2)\tthe security policy (either signalling security policy or user plane security policy) corresponding to the ProSe identifier is not compatible with the security policy of the existing 5G ProSe direct link; or\n3)\tin case of the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3 UE-to-network relay UE, the existing 5G ProSe direct link for the peer UE is established with a different RSC or established not for direct communication between the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3 UE-to-network relay UE;\n4)\tin case of the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe layer-2 remote UE and the 5G ProSe layer-2 UE-to-network relay UE, the existing 5G ProSe direct link for the peer UE is established not for direct communication between the 5G ProSe layer-2 remote UE and the 5G ProSe layer-2 UE-to-network relay UE;\n5)\tin case of the 5G ProSe direct link establishment procedure is for direct communication between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, the initiating UE acts as the source 5G ProSe end UE, the existing 5G ProSe direct link for the peer UE is established with a different RSC or established not for direct communication between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE;\n6)\tin case of the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE without integrated discovery, the initiating UE acts as the 5G ProSe UE-to-UE relay UE, the 5G ProSe direct link security mode control procedure between the source 5G ProSe end UE and the initiating UE has been successfully completed, and there is no 5G ProSe direct link established between the initiating UE and the target 5G ProSe end UE with the RSC received in PROSE DIRECT LINK ESTABLISHMENT REQUEST message for 5G ProSe UE-to-UE relay;\n7)\tin case of the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE, the initiating UE acting as the 5G ProSe layer-3 UE-to-UE relay UE receives a PROSE DIRECT LINK ESTABLISHMENT REQUEST message including the relay indication, and there is no 5G ProSe direct link established between the initiating UE and the target 5G ProSe end UE with the RSC received in PROSE DIRECT LINK ESTABLISHMENT REQUEST message for 5G ProSe UE-to-UE relay; or\n8)\tin case of the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE, the initiating UE acting as the 5G ProSe layer-3 UE-to-UE relay UE receives a PROSE DIRECT LINK MODIFICATION REQUEST message to establish 5G ProSe UE-to-UE relay communication with an additional 5G ProSe layer-3 end UE as specified in clause 7.2.3.2, and there is no 5G ProSe direct link established between the initiating UE and the additional target 5G ProSe end UE with the RSC received in PROSE DIRECT LINK MODIFICATION REQUEST message for 5G ProSe UE-to-UE relay;\ng)\tthe number of established 5G ProSe direct links is less than the implementation-specific maximum number of established 5G ProSe direct links allowed in the UE at a time; and\nh)\ttimer T5088 is not associated with the link layer identifier for the destination UE or timer T5088 associated with the link layer identifier for the destination UE has already expired or stopped.\nAfter receiving the service data or request from the upper layers, the initiating UE shall derive the PC5 QoS parameters and assign the PQFI(s) for the PC5 QoS flows(s) to be established as specified in clause 7.2.7.\nIf the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, then the UE shall apply the DUCK or DUSK used for UE-to-network relay discovery along with the UTC-based counter for encrypting:\na)\tthe relay service code; and\nb)\tthe UP-PRUK ID or CP-PRUK ID, if available,\nas specified in clause 6.3.5.2 of 3GPP TS 33.503 [34], and the UE shall use the security protected relay service code and the security protected UP-PRUK ID or security protected CP-PRUK ID for creating a PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nNOTE 2:\tIf the UE is neither configured with DUCK nor DUSK, the relay service code and the UP-PRUK ID or CP-PRUK ID are not encrypted.\nIf the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, then the UE shall apply the DUCK or DUSK associated with the relay service code along with the UTC-based counter for encrypting:\na)\tthe relay service code; and\nb)\tthe UP-PRUK ID or CP-PRUK ID, if available and the UE does not act as a 5G ProSe UE-to-UE relay UE,\nas specified in clause 6.3.5.2 of 3GPP TS 33.503 [34], and the UE shall use the security protected relay service code and, if available and the UE does not act as a 5G ProSe UE-to-UE relay UE, the security protected UP-PRUK ID or security protected CP-PRUK ID for creating a PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nNOTE 2A:\tIf the UE is neither configured with DUCK nor DUSK, the relay service code and the UP-PRUK ID or CP-PRUK ID are not encrypted.\nIf the 5G ProSe direct link establishment procedure is for ProSe identifier indicating \"ranging and sidelink positioning\", then the UE shall apply the DUCK or DUSK used for ranging and sidelink positioning UE discovery along with the UTC-based counter for encrypting:\na)\tthe ProSe identifier indicating \"ranging and sidelink positioning\"; and\nb)\tthe SLPK ID, if available,\nas specified in 3GPP TS 33.533 [55], and the UE shall use the security protected ProSe identifier indicating \"ranging and sidelink positioning\" and the security protected SLPK ID for creating a PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nNOTE 2B:\tIf the UE is neither configured with DUCK nor DUSK, the ProSe identifier indicating \"ranging and sidelink positioning\" and the SLPK ID are not encrypted.\nIn order to initiate the 5G ProSe direct link establishment procedure, the initiating UE shall create a PROSE DIRECT LINK ESTABLISHMENT REQUEST message. The initiating UE:\na)\tshall include the source user info set to the initiating UE's application layer ID received from upper layers, or set to the user info ID of the source 5G ProSe end UE if the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nb)\tshall include the ProSe identifier(s) received from upper layer if the 5G ProSe direct link establishment procedure is not for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE;\nc)\tshall include the target user info set to the target UE's application layer ID if received from upper layers or if known based on the unicast layer-2 ID of target UE (i.e. destination layer-2 ID) as described in clause 5.8.2.4 of 3GPP TS 23.304 [3], to the user info ID of the 5G ProSe UE-to-network relay UE obtained during the 5G ProSe UE-to-network relay discovery procedure if the initiating UE is acting as a 5G ProSe remote UE, or to the user info ID of the target 5G ProSe end UE if:\n1)\tthe initiating UE is acting as the source 5G ProSe end UE and the user info ID of the target 5G ProSe end UE is obtained during the 5G ProSe UE-to-UE relay discovery procedure or received from upper layers in case of 5G ProSe direct link establishment with integrated discovery; or\n2)\tthe initiating UE is acting as the 5G ProSe UE-to-UE relay UE and the user info ID of the target 5G ProSe end UE is obtained in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK MODIFICATION REQUEST message from the source 5G ProSe end UE;\nca)\tshall include the UE-to-UE relay UE user info set to the user info ID of the 5G ProSe UE-to-UE relay UE:\n1)\tif obtained during the 5G ProSe UE-to-UE relay discovery procedure and the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE; or\n2)\tif the initiating UE is acting as the 5G ProSe UE-to-UE relay UE and user info ID is configured at configuration parameters for 5G ProSe UE-to-UE relay as specified in clause 5.2.7;\ncb)\tshall include the target end UE layer-2 ID set to the layer-2 ID of the target 5G ProSe end UE, if the initiating UE is acting as the source 5G ProSe end UE and the layer-2 ID of the target 5G ProSe end UE is available in the source 5G ProSe end UE via the previous direct communication;\nd)\tif the 5G ProSe direct link is neither for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, nor for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance:\n1)\tshall include the key establishment information container if the UE PC5 unicast signalling integrity protection policy is set to \"Signalling integrity protection required\" or \"Signalling integrity protection preferred\" and may include the key establishment information container if the UE PC5 unicast signalling integrity protection policy is set to \"Signalling integrity protection not needed\";\nNOTE 3:\tThe key establishment information container is provided by upper layers.\ne)\tshall include:\n1)\ta Nonce_1, if the direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE nor between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE and the direct communication is not for ProSe identifier indicating \"ranging and sidelink positioning\", or if the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE and the security procedure over control plane is used as specified in 3GPP TS 33.503 [34]; or\n2)\ta KNRP freshness parameter 1, if the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE and the security procedure over user plane is used as specified in 3GPP TS 33.503 [34]; or\nx)\ta KSLP freshness parameter 1, if the direct communication is for ProSe identifier indicating \"ranging and sidelink positioning\" as specified in 3GPP TS 33.533 [55];\nset to the 128-bit nonce value generated by the initiating UE for the purpose of session key establishment over this 5G ProSe direct link if the UE PC5 unicast signalling integrity protection policy is set to \"Signalling integrity protection required\" or \"Signalling integrity protection preferred\";\nNOTE 4:\tThe Nonce_1 IE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is used to hold the value of Nonce_1 or KNRP freshness parameter 1.\nf)\tshall include its UE security capabilities indicating the list of algorithms that the initiating UE supports for the security establishment of this 5G ProSe direct link;\ng)\tshall include the MSB of KNRP-sess ID chosen by the initiating UE as specified in 3GPP TS 33.503 [34] if the direct communication is not for ProSe identifier indicating \"ranging and sidelink positioning\" and the UE PC5 unicast signalling integrity protection policy is set to \"Signalling integrity protection required\" or \"Signalling integrity protection preferred\";\nNOTE 5:\tIf the direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, nor between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance, the KNRP-sess ID holds the ID that corresponds to KNRP-sess. If the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance, the KNRP-sess ID holds the ID that corresponds to KNRP-sess (if security procedure over user plane is used) or Krelay-sess (if security procedure over control plane is used).\ng1)\tshall include the MSB of KSLP-sess ID chosen by the initiating UE as specified in 3GPP TS 33.533 [55] if the direct communication is for ProSe identifier indicating \"ranging and sidelink positioning\" and the UE PC5 unicast signalling integrity protection policy is set to \"Signalling integrity protection required\" or \"Signalling integrity protection preferred\";\nh)\tmay include a KNRP ID if the initiating UE has an existing KNRP for the target UE and the direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE nor between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance;\ni)\tshall include its UE PC5 unicast signalling security policy. In the case where the different ProSe applications are mapped to the different PC5 unicast signalling security policies, when the initiating UE intends to establish a single unicast link that can be used for more than one ProSe application, each of the signalling security polices of those ProSe applications shall be compatible, e.g., \"Signalling integrity protection not needed\" and \"Signalling integrity protection required\" are not compatible. In case the 5G ProSe direct link establishment procedure is for direct communication between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE, and the RSC is not specific for emergency services, the Signalling integrity protection policy shall be set to \"Signalling integrity protection required\". In case the 5G ProSe direct link establishment procedure is for direct communication between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, and the initiating UE has a valid USIM, the Signalling integrity protection policy shall be set to \"Signalling integrity protection preferred\". In case the 5G ProSe direct link establishment procedure is for direct communication between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, and the initiating UE does not have a valid USIM, the Signalling integrity protection policy shall be set to \"Signalling integrity protection not needed\";\nj)\tshall include the Relay service code IE set to:\n1)\tthe relay service code of the target relay UE if the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE; or\n2)\tthe relay service code indicating the connectivity service requested by the source 5G ProSe end UE if the 5G ProSe direct link establishment procedure is for direct communication between the (source or target) 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nk)\tshall include the UTC-based counter LSB set to the four least significant bits of the UTC-based counter if the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nl)\tshall include the UE identity IE set to the SUCI of the initiating UE if:\n1)\tthe 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\n2)\tthe RSC is not specific for emergency services or the initiating UE has a valid USIM; and\n3)\tthe security for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay uses the security procedure over control plane and the initiating UE does not have a valid CP-PRUK as specified in 3GPP TS 33.503 [34], or, the security for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay uses the security procedure over user plane and the initiating UE does not have a valid UP-PRUK as specified in 3GPP TS 33.503 [34];\nla)\tshall include the UE identity IE set to the PEI of the initiating UE if:\n1)\tthe 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE;\n2)\tthe RSC is specific for emergency services; and\n3)\tthe initiating UE does not have a valid USIM;\nm)\tshall include the User security key ID IE set to:\n1)\tUP-PRUK ID of the initiating UE if:\ni)\tthe 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or for direct communication between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nii)\tthe initiating UE has a valid UP-PRUK; and\niii)\tthe security for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay uses the security procedure over user plane as specified in 3GPP TS 33.503 [34]; or\n2)\tCP-PRUK ID of the initiating UE that is associated with the relay service code of the target UE if:\ni)\tthe 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or for direct communication between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nii)\tthe initiating UE has a valid CP-PRUK is associated with the relay service code of the target UE; and\niii)\tthe security for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay uses the security procedure over control plane as specified in 3GPP TS 33.503 [34];\n3)\tSLPK ID of the initiating UE that is associated with the ProSe identifier indicating \"ranging and sidelink positioning\" if:\ni)\tthe 5G ProSe direct link establishment procedure is for direct communication for ProSe identifier indicating \"ranging and sidelink positioning\"; and\nii)\tthe initiating UE has a valid SLPK is associated with the ProSe identifier indicating\"ranging and sidelink positioning\";\nn)\tshall include the HPLMN ID of the initiating UE, if the UP-PRUK ID of the initiating UE is included and is not in NAI format (see 3GPP TS 33.503 [34]);\no)\tshall include the MIC IE set to the calculated MIC value as specified in clause 6.3.5.3 of 3GPP TS 33.503 [34] if the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE and the UE has the DUIK;\no1)\tshall include the MIC IE set to the calculated MIC value as specified in 3GPP TS 33.533 [55] if the 5G ProSe direct link establishment procedure is for ProSe identifier indicating \"ranging and sidelink positioning\" and the UE has the DUIK; and\np)\tshall include the relay indication which indicates that the PROSE DIRECT LINK ESTABLISHMENT REQUEST message can be forwarded by a 5G ProSe UE-to-UE relay UE, if the 5G ProSe direct link establishment procedure is for direct communication between the source 5G ProSe end UE and 5G ProSe UE-to-UE relay UE with integrated discovery;\nAfter the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the source layer-2 ID and destination layer-2 ID as follows:\na)\tif the 5G ProSe direct communication is in a consequence of 5G ProSe direct discovery as defined in clause 6.2.14, clause 6.2.15, clause 8.2.1, clause 8a.2.1, or clause 6.2 in 3GPP TS 24.514 [56]:\nself-assign a source layer-2 ID, and\n1)\tthe destination layer-2 ID set to the target end UE layer-2 ID if received in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK MODIFICATION REQUEST message from the source 5G ProSe end UE and if the initiating UE is acting as the 5G ProSe UE-to-UE relay UE;\n2)\totherwise, the destination layer-2 ID set to the source layer-2 ID in the received PROSE PC5 DISCOVERY message for discovery announcement or discovery response;\nb)\tif the initiating UE is acting as the source 5G ProSe end UE and the 5G ProSe direct link establishment procedure is for direct communication between the source 5G ProSe end UE and 5G ProSe UE-to-UE relay UE with integrated discovery:\nself-assign a source layer-2 ID, and set the destination layer-2 ID to the broadcast destination layer-2 ID configured as specified in clause 5.2.4; or\nc)\tif the initiating UE is acting as the 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe UE-to-UE relay UE and target 5G ProSe end UE with integrated discovery:\nself-assign a source layer-2 ID, and set the destination layer-2 ID to:\n1)\tthe target end UE layer-2 ID, if received in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message from the source 5G ProSe end UE; otherwise\n2)\tthe broadcast destination layer-2 ID configured as specified in clause 5.2.4; or\nd)\totherwise:\nself-assign a source layer-2 ID, and the destination layer-2 ID set to the destination layer-2 ID used for unicast initial signalling as specified in clause 5.2.4,\nNOTE 6:\tThe UE implementation ensures that any value of the self-assigned source layer-2 ID in a), b), c) and d) is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14, clause 6.2.15, clause 8.2.1 and clause 8a.2.1, and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\nNOTE 6A:\tThe UE implementation ensures that any value of the self-assigned source layer-2 ID in a), b) and c) is different from any self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication of a data unit type different from the data unit type of the 5G ProSe direct link being established, if the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE.\nNOTE 6B:\tThe UE implementation ensures that any value of the self-assigned source layer-2 ID in a), b) and c) is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication for Unstructured traffic and a different pair of the user info ID of the source 5G ProSe end UE and the user info ID of the target 5G ProSe end UE, if the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE and for Unstructured traffic.\nNOTE 7:\tIt is possible for the initiating UE to reuse the initiating UE's layer-2 ID used in previous 5G ProSe direct link with the same peer UE, except when the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE for Unstructured traffic and a different pair of the user info ID of the source 5G ProSe end UE and the user info ID of the target 5G ProSe end UE, and except when the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE for a data unit type different than the data unit type of the previous 5G ProSe direct link.\nand start timer T5080.\nNOTE 8:\tA default PC5 DRX configuration is used for transmitting the PROSE DIRECT LINK ESTABLISHMENT REQUEST message as specified in 3GPP TS 38.300 [21].\nThe UE shall not send a new PROSE DIRECT LINK ESTABLISHMENT REQUEST message to the same target UE identified by the same application layer ID while timer T5080 is running. If the target user info IE is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message (i.e., ProSe application oriented 5G ProSe direct link establishment procedure), the initiating UE shall handle multiple PROSE DIRECT LINK ESTABLISHMENT ACCEPT messages, if any, received from different target UEs for the establishment of multiple 5G ProSe direct links before the expiry of timer T5080.\nNOTE 9:\tIn order to ensure successful 5G ProSe direct link establishment, T5080 should be set to a value larger than the sum of T5089 and T5092.\nThe figure depicts a UE-oriented 5G ProSe direct link establishment procedure, illustrating the steps involved in establishing a direct link between a UE and a base station (gNB). The figure includes various components such as the gNB, base station, and the UE, highlighting the importance of proper signal propagation and network architecture in 5G networks.\nFigure 7.2.2.2.1: UE oriented 5G ProSe direct link establishment procedure\nThe figure depicts a detailed procedure for establishing a direct 5G ProSe service-oriented link, including steps for network configuration, device pairing, and data transmission.\nFigure 7.2.2.2.2: ProSe service oriented 5G ProSe direct link establishment procedure\nUpon receipt of a PROSE DIRECT LINK ESTABLISHMENT REQUEST message, if the target UE accepts this request, the target UE shall uniquely assign a PC5 link identifier, create a 5G ProSe direct link context.\nNOTE 1:\tA default PC5 DRX configuration is used for receiving the PROSE DIRECT LINK ESTABLISHMENT REQUEST message as specified in 3GPP TS 38.300 [21].\nIf the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the target UE shall verify the MIC field in the received PROSE DIRECT LINK ESTABLISHMENT REQUEST with the DUIK, if any, and decrypts the encrypted:\na)\trelay service code; and\nb)\tUP-PRUK ID or CP-PRUK ID, if received,\nusing the DUCK or DUSK used for 5G ProSe UE-to-network relay discovery (see clause 6.3.5.2 of 3GPP TS 33.503 [34]), and verifies if the relay service code matches with the one that the target UE has sent during 5G ProSe UE-to-network relay discovery procedure.\nNOTE 2:\tIf the UE is neither configured with DUCK nor DUSK, the relay service code and the UP-PRUK ID or CP-PRUK ID are not encrypted.\nIf the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is for 5G ProSe direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, the target UE shall verify the MIC field in the received PROSE DIRECT LINK ESTABLISHMENT REQUEST with the DUIK, if any, and decrypts the encrypted:\na)\trelay service code; and\nb)\tUP-PRUK ID or CP-PRUK ID, if received,\nusing the DUCK or DUSK used for 5G ProSe UE-to-UE relay discovery (see clause 6.3.5.2 of 3GPP TS 33.503 [34]), and verifies if the relay service code matches with the one that the target UE has sent during 5G ProSe UE-to-UE relay discovery procedure.\nNOTE 2A:\tIf the UE is neither configured with DUCK nor DUSK, the relay service code and the UP-PRUK ID or CP-PRUK ID are not encrypted.\nIf the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is for ProSe identifier indicating \"ranging and sidelink positioning\", the target UE shall verify the MIC field in the received PROSE DIRECT LINK ESTABLISHMENT REQUEST with the DUIK, if any, and decrypts the encrypted:\na)\tthe ProSe identifier indicating \"ranging and sidelink positioning\"; and\nb)\tthe SLPK ID, if available,\nusing the DUCK or DUSK used for ranging and sidelink positioning UE discovery, and verifies if the ProSe identifier indicating \"ranging and sidelink positioning\" matches with the one that the target UE has sent during ranging and sidelink positioning UE discovery.\nNOTE 2B:\tIf the UE is neither configured with DUCK nor DUSK, the ProSe identifier indicating \"ranging and sidelink positioning\" and the SLPK ID are not encrypted.\nIf the target UE is acting as the target 5G ProSe end UE and the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe UE-to-UE relay UE and target 5G ProSe end UE with integrated discovery, the target UE upon reception of the PROSE DIRECT LINK ESTABLISHMENT REQUEST messages which contain the same source user info, ProSe identifier(s) and relay service code as received from multiple 5G ProSe UE-to-UE relay UEs, selects one of the 5G ProSe UE-to-UE relay UEs via which to communicate with the source 5G ProSe end UE as specified in TS 23.304, clause 6.7.3.2.\nIf the 5G ProSe direct link establishment procedure is neither for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, nor for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance, and the 5G ProSe direct link establishment procedure is not for direct communication for ProSe identifier indicating \"ranging and sidelink positioning\", the target UE may initiate 5G ProSe direct link authentication procedure as specified in clause 7.2.12 and shall initiate 5G ProSe direct link security mode control procedure as specified in clause 7.2.10.\nIf the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, or for direct communication between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance, upon receiption of the PROSE DIRECT LINK ESTABLISHMENT REQUEST messages, and the initiating UE is identified by a SUCI, a CP-PRUK ID or a UP-PRUK ID, the target UE shall proceed with either:\na)\tthe authentication and key agreement procedure as specified in clause 5.5.4 of 3GPP TS 24.501 [11] if the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used; or\nb)\tthe key request procedure as specified in clause 8.2.10.2.4 if the security procedure over user plane as specified in 3GPP TS 33.503 [34] is used;\nand if:\na)\tthe security procedure over control plane or the security procedure over user plane as specified in 3GPP TS 33.503 [34] is completed successfully; or\nb)\tthe security procedure over control plane or the security procedure over user plane as specified in 3GPP TS 33.503 [34] fails, the RSC is specific for emergency services, and providing 5G ProSe direct link for emergency services without 5G ProSe direct link security is required by the target UE's configuration;\nshall initiate 5G ProSe direct link security mode control procedure as specified in clause 7.2.10.\nIf the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE using the security procedure with network assistance, upon receiption of the PROSE DIRECT LINK ESTABLISHMENT REQUEST messages, the target UE shall proceed with 5G ProSe direct link security request procedure.\nIf the 5G ProSe direct link establishment procedure is for direct communication for ProSe identifier indicating \"ranging and sidelink positioning\", the target UE shall proceed with the SLP key request procedure as specified in clause 8.3.1.1.x in 3GPP TS 24.514 [56], and shall initiate 5G ProSe direct link security mode control procedure as specified in clause 7.2.10.\nEditor's note:\t(WI:5G_ProSe_Ph2, CR: 0411) it is FFS how to configure the target UE that 5G ProSe direct link for emergency services without 5G ProSe direct link security is required by the target UE's configuration.\nIf the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, the initiating UE is identified by a PEI, and providing 5G ProSe direct link for emergency services without 5G ProSe direct link security is required by the target UE's configuration, the target UE shall initiate 5G ProSe direct link security mode control procedure as specified in clause 7.2.10.\nThe target UE shall set the source layer-2 ID and the destination layer-2 ID as specified in clause 7.2.12 and clause 7.2.10, and store the corresponding source layer-2 ID for unicast communication and the destination layer-2 ID for unicast communication in the 5G ProSe direct link context.\nIf:\na)\tthe target user info IE is included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message and this IE includes the target UE's application layer ID; or\nb)\tthe target user info IE is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message and the target UE is interested in the ProSe application(s) identified by the ProSe identifier IE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message;\nthen the target UE shall:\na)\tif the direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, nor for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance. The 5G ProSe direct link establishment procedure is not for direct communication for ProSe identifier indicating \"ranging and sidelink positioning\":\n1)\tidentify an existing KNRP based on the KNRP ID included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message; or\n2)\tif KNRP ID is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, the target UE does not have an existing KNRP for the KNRP ID included in PROSE DIRECT LINK ESTABLISHMENT REQUEST message or the target UE wishes to derive a new KNRP, derive a new KNRP. This may require performing one or more 5G ProSe direct link authentication procedures as specified in clause 7.2.12;\nb)\tif the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, the initiating UE is identified by a SUCI or a CP-PRUK ID, and the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, request a new KNR_ProSe according to the security procedure over user plane as specified in 3GPP TS 33.503 [34];\nc)\tif the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, the initiating UE is identified by a SUCI or a UP-PRUK ID, and the security procedure over user plane as specified in 3GPP TS 33.503 [34] is used, request a new KNRP according to the security procedure over user plane; and\nNOTE 3:\tHow many times the 5G ProSe direct link authentication procedure needs to be performed to derive a new KNRP depends on the authentication method used.\nd)\tif the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, the initiating UE is identified by a PEI, and providing 5G ProSe direct link for emergency services without 5G ProSe direct link security is required by the target UE's configuration, generate a new KNRP in an implementation defined way.\ne)\tif the 5G ProSe direct link establishment procedure is for direct communication for ProSe identifier indicating \"ranging and sidelink positioning\", request a new KSLP according to the security procedure as specified in 3GPP TS 33.533 [55].\nIf the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, the security procedure over control plane or the security procedure over user plane as specified in 3GPP TS 33.503 [34] fails, and providing 5G ProSe direct link for emergency services without 5G ProSe direct link security is required by the target UE's configuration, the target UE shall generate a new KNR_ProSe or KNRP in an implementation defined way.\nAfter an existing KNRP or KSLP was identified or a new KNRP or KSLP was derived, or after a new KNRP or KNR_ProSe or KSLP is received or a new KNR_ProSe or KNRP were generated, the target UE shall initiate a 5G ProSe direct link security mode control procedure as specified in clause 7.2.10.\nUpon successful completion of the 5G ProSe direct link security mode control procedure, in order to determine whether the PROSE DIRECT LINK ESTABLISHMENT REQUEST message can be accepted or not, in case of IP communication, the target UE checks whether there is at least one common IP address configuration option supported by both the initiating UE and the target UE.\nIf the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, the security procedure over control plane or the security procedure over user plane as specified in 3GPP TS 33.503 [34] fail, and providing 5G ProSe direct link for emergency services without 5G ProSe direct link security is required by the target UE's configuration, before sending the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message to the 5G ProSe remote UE, the target UE shall perform the 5G ProSe direct link remote identity procedure to fetch PEI.\nBefore sending the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message to the 5G ProSe remote UE, the target UE acting as a 5G ProSe layer-3 UE-to-network relay UE initiates the UE requested PDU session establishment procedure as specified in 3GPP TS 24.501 [11] if:\n1)\tthe PDU session for relaying the service associated with the RSC has not been established yet; or\n2)\tthe PDU session for relaying the service associated with the RSC has been established but the PDU session type is Unstructured.\nIf the target UE accepts the 5G ProSe direct link establishment procedure, the target UE shall create a PROSE DIRECT LINK ESTABLISHMENT ACCEPT message. The target UE:\na)\tshall include the source user info set to the target UE's application layer ID received from upper layers, or set to the user info ID of the target 5G ProSe end UE if the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\naa)\tshall include the UE-to-UE relay UE user info set to the user info ID of the 5G ProSe UE-to-UE relay UE if the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nb)\tshall include PQFI(s), the corresponding PC5 QoS parameters and optionally the ProSe identifier(s) that the target UE accepts, if the target UE is not acting as a 5G ProSe layer-2 UE-to-network relay UE and the 5G ProSe direct link establishment procedure is not with integrated discovery;\nc)\tmay include the PC5 QoS rule(s) if the target UE is not acting as a 5G ProSe layer-2 UE-to-network relay UE and the 5G ProSe direct link establishment procedure is not with integrated discovery;\nd)\tshall include an IP address configuration IE set to one of the following values if IP communication is used and the target UE is not acting as a 5G ProSe layer-2 UE-to-network relay UE or 5G ProSe layer-2 UE-to-UE relay UE:\n1)\t\"DHCPv4 server\" if only IPv4 address allocation mechanism is supported by the target UE, i.e., acting as a DHCPv4 server;\n2)\t\"IPv6 router\" if only IPv6 address allocation mechanism is supported by the target UE, i.e., acting as an IPv6 router;\n3)\t\"DHCPv4 server & IPv6 Router\" if both IPv4 and IPv6 address allocation mechanism are supported by the target UE; or\n4)\t\"address allocation not supported\" if neither IPv4 nor IPv6 address allocation mechanism is supported by the target UE and the target UE is not acting as a 5G ProSe layer-3 UE-to-network relay UE;\nNOTE 4:\tThe UE doesn't include an IP address configuration IE nor a link local IPv6 address IE if Ethernet or Unstructured data unit type is used for communication.\ne)\tshall include a link local IPv6 address IE formed locally based on IETF RFC 4862 [25] if IP address configuration IE is set to \"address allocation not supported\", the received PROSE DIRECT LINK SECURITY MODE COMPLETE message included a link local IPv6 address IE and the target UE is not acting as a 5G ProSe layer-2 UE-to-network relay UE, 5G ProSe layer-3 UE-to-network relay UE or 5G ProSe layer-2 UE-to-UE relay UE;\nf)\tshall include the configuration of UE PC5 unicast user plane security protection based on the agreed user plane security policy, as specified in 3GPP TS 33.503 [34]. If the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, and:\n1)\tthe security procedure over control plane or the security procedure over user plane as specified in 3GPP TS 33.503 [34] fails; or\n2)\tthe initiating UE is identified by a PEI;\nthe target UE shall include the user plane integrity protection configuration set to \"off\" and the user plane ciphering configuration set to \"off\";\ng)\tif the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the source or target 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, and for Ethernet traffic, shall include the MAC address of the target 5G ProSe layer-3 end UE; and\nh)\tmay include a target 5G ProSe layer-3 end UE IP address IE set to the IP address of the target 5G ProSe layer-3 end UE, if the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, and the data unit type for the communication is IP.\nAfter the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message is generated, the target UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication and shall start timer T5090 if:\na)\tat least one of ProSe identifiers for the 5G ProSe direct links satisfies the privacy requirements as specified in clause 5.2.4; or\nb)\tT5090 is configured as specified in clause 5.2.5.\nNOTE 5:\tTwo UEs negotiate the PC5 DRX configuration in the AS layer, and the PC5 DRX parameter values are configured per pair of source and destination Layer-2 IDs in the AS layer, as specified in 3GPP TS 38.300 [21].\nAfter sending the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, the target UE shall provide the following information along with the layer-2 IDs to the lower layer, which enables the lower layer to handle the coming PC5 signalling or traffic data:\na)\tthe PC5 link identifier self-assigned for this 5G ProSe direct link;\nb)\tPQFI(s) and its corresponding PC5 QoS parameters, if available;\nc)\tan indication of activation of the PC5 unicast user plane security protection for the 5G ProSe direct link, if applicable; and\nd)\tan indication of emergency services for the 5G ProSe direct link if the 5G ProSe direct link is established with the RSC specific for emergency services between the 5G ProSe layer-2 remote UE and the 5G ProSe layer-2 UE-to-network relay UE.\nIf the target UE accepts the 5G ProSe direct link establishment request and the 5G ProSe direct link is established not for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE and not for 5G ProSe direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, then the target UE may perform the PC5 QoS flow establishment over 5G ProSe direct link as specified in clause 7.2.7. If the 5G ProSe direct link is established for 5G ProSe direct communication between the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3 UE-to-network relay UE, then the target UE may perform the PC5 QoS flow establishment over 5G ProSe direct link as specified in clause 8.2.6. If the 5G ProSe direct link is established for 5G ProSe direct communication between the 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, then the target UE may perform the PC5 QoS flow establishment over 5G ProSe direct link as specified in clause 8a.2.7.\nIf the Target user info IE is included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, upon receipt of the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, the initiating UE shall stop timer T5080. If the Target user info IE is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message the initiating UE may keep the timer T5080 running and continue to handle multiple response messages (i.e., the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message) from multiple target UEs.\nFor each of the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message received, the initiating UE shall uniquely assign a PC5 link identifier and create a 5G ProSe direct link context for each of the 5G ProSe direct link(s). Then the initiating UE shall store the source layer-2 ID and the destination layer-2 ID used in the transport of this message provided by the lower layers in the 5G ProSe direct link context(s) to complete the establishment of the 5G ProSe direct link with the target UE(s). From this time onward the initiating UE shall use the established link(s) for ProSe direct communication over PC5 and additional PC5 signalling messages to the target UE(s).\nIf the initiating UE is acting as the 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe UE-to-UE relay UE and target 5G ProSe end UE with integrated discovery, the initiating UE upon receipt of the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message from the target 5G ProSe end UE, shall initiate the 5G ProSe direct link security mode control procedure with the source 5G ProSe end UE, and the initiating UE upon successful completion of the 5G ProSe direct link security mode control procedure with the source 5G ProSe end UE, shall create a PROSE DIRECT LINK ESTABLISHMENT ACCEPT message as specified in clause 7.2.2.3 to send to the source 5G ProSe end UE. If the target user info IE is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, the initiating UE acting as the 5G ProSe UE-to-UE relay UE may initiate the 5G ProSe direct link security mode control procedure with the source 5G ProSe end UE after handling multiple response messages (i.e., the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message) from multiple target end UEs.\nAfter receiving the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, the initiating UE shall provide the following information along with the layer-2 IDs to the lower layer, which enables the lower layer to handle the coming PC5 signalling or traffic data:\na)\tthe PC5 link identifier self-assigned for this 5G ProSe direct link;\nb)\tPQFI(s) and its corresponding PC5 QoS parameters, if available; and\nc)\tan indication of activation of the PC5 unicast user plane security protection for the 5G ProSe direct link, if applicable.\nThe initiating UE shall start timer T5090 if:\na)\tat least one of ProSe identifiers for the 5G ProSe direct links satisfies the privacy requirements as specified in clause 5.2.4; or\nb)\tT5090 is configured as specified in clause 5.2.5.\nIn addition, the initiating UE may perform the PC5 QoS flow establishment over 5G ProSe direct link as specified in clause 7.2.7.\nUpon expiry of the timer T5080, if the PROSE DIRECT LINK ESTABLISHMENT REQUEST message did not include the Target user info IE and the initiating UE received at least one PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, it is up to the UE implementation to consider the 5G ProSe direct link establishment procedure as complete or to restart the timer T5080.\nIf the 5G ProSe direct link establishment procedure is triggered by a PROSE DIRECT LINK MODIFICATION REQUEST message from the source 5G ProSe layer-3 end UE as specified in clause 7.2.3.2, upon receipt of the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, the initiating UE shall send a PROSE DIRECT LINK MODIFICATION ACCEPT message to the source 5G ProSe layer-3 end UE as specified in clause 7.2.3.3, if the initiating UE acts as the 5G ProSe layer-3 UE-to-UE relay UE.\nIf the PROSE DIRECT LINK ESTABLISHMENT REQUEST message cannot be accepted, the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message. The PROSE DIRECT LINK ESTABLISHMENT REJECT message contains a PC5 signalling protocol cause IE set to one of the following cause values:\n#1\tdirect communication to the target UE not allowed;\n#3\tconflict of layer-2 ID for unicast communication is detected;\n#5\tlack of resources for 5G ProSe direct link;\n#13\tcongestion situation;\n#15\tsecurity procedure failure of 5G ProSe UE-to-network relay;\n#xx\tsecurity procedure failure of 5G ProSe UE-to-UE relay;\n#20\tFailure from 5G ProSe end UE;\n#yy\t5G ProSe direct link already exists;\n#xx\tMAC address not unique; or\n#111\tprotocol error, unspecified.\nIf the target UE is not allowed to accept the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, e.g., based on operator policy or configuration parameters for ProSe direct communication over PC5 as specified in clause 5.2, or the target UE is acting as a 5G ProSe layer-3 UE-to-network relay UE, is in non-allowed area of its serving PLMN and the corresponding relay service code is not associated with high priority access as defined in clause 5.3.5 of 3GPP TS 24.501 [11], the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #1 \"direct communication to the target UE not allowed\".\nNOTE 1:\tWhen the target UE acting as a 5G ProSe layer-3 UE-to-network relay UE is involved into its own emergency services as specified in 3GPP TS 24.501 [11] or is handling an emergency services of another 5G ProSe layer-3 remote UE, and receives PROSE DIRECT LINK ESTABLISHMENT REQUEST message with an RSC that is specific for emergency services, the target UE is allowed to ignore the PROSE DIRECT LINK ESTABLISHMENT REQUEST message if the target UE decides to prioritize its own ongoing emergency services or prioritize the handling of the emergency services of the other 5G ProSe layer-3 remote UE, due to local regulations or implementation specific requirements.\nFor a received PROSE DIRECT LINK ESTABLISHMENT REQUEST message from a layer-2 ID (for unicast communication), if the target UE already has an existing link established to a UE using this layer-2 ID or is currently processing a PROSE DIRECT LINK ESTABLISHMENT REQUEST message from the same layer-2 ID and with one of following parameters different from the existing link or the link for which the link establishment is in progress:\na)\tthe source user info;\nb)\ttype of data (e.g., IP, Ethernet or Unstructured); or\nc)\tsecurity policy,\nthe target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for unicast communication is detected\".\nNOTE 2:\tIf the UE is processing a PROSE DIRECT DISCOVERY message from the same source layer-2 ID of the received PROSE DIRECT LINK ESTABLISHMENT REQUEST message, it depends on UE implementation to avoid the conflict of destination layer-2 ID (e.g. send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for unicast communication is detected\", or ignore the PROSE DIRECT DISCOVERY message).\nNOTE 3:\tThe type of data (e.g., IP. Ethernet or Unstructured) is indicated by the optional IP address configuration IE included in the corresponding DIRECT LINK SECURITY MODE COMPLETE message, i.e., the type of data for the requested link is IP type if this IE is included and the type of data for the requested link is Ethernet or Unstructured if this IE is not included.\nIf the 5G ProSe direct link establishment fails due to the implementation-specific maximum number of established 5G ProSe direct links has been reached, or other temporary lower layer problems causing resource constraints, the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #5 \"lack of resources for 5G ProSe direct link\".\nIf the 5G ProSe direct link establishment request is for 5G ProSe UE-to-network relaying and:\na)\tthe NAS level mobility management congestion control as specified in clause 5.3.9 of TS 24.501 [11] is activated at the target UE acting as the 5G ProSe UE-to-network relay UE; or\nb)\tthe target UE acting as the 5G ProSe UE-to-network relay UE is under congestion;\nthe target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #13 \"congestion situation\". The target UE may provide a back-off timer value to the initiating UE in the PROSE DIRECT LINK ESTABLISHMENT REJECT message. The target UE shall not accept any 5G ProSe direct link establishment request for relaying if the back-off timer for NAS level mobility management congestion control is running.\nIf the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, for Ethernet traffic, and the target UE acting as the 5G ProSe layer-3 UE-to-UE relay UE detects that the MAC address of 5G ProSe layer-3 end UE is not unique, i.e., the MAC address of the source 5G ProSe layer-3 end UE was also provided by another 5G ProSe layer-3 end UE in a ProSe 5G direct link, the 5G ProSe layer-3 UE-to-UE relay UE may send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #xx \"MAC address not unique\" to the source 5G ProSe layer-3 end UE.\nIf the 5G ProSe direct link establishment request is for 5G ProSe UE-to-network relaying, the NAS level session management congestion as specified in clause 6.2.7 and in clause 6.2.8 of TS 24.501 [11] is activated at the target UE which is acting as a 5G ProSe layer-3 UE-to-network relay UE, and the relay service code used in the 5G ProSe direct link establishment corresponds to a DNN and/or S-NSSAI for which the NAS level session management congestion is activated, and the target UE needs to perform the PDU session establishment procedure for the DNN and/or S-NSSAI or the PDU session modification procedure for the DNN and/or S-NSSAI, then the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #13 \"congestion situation\". The target UE may provide a back-off timer value to the initiating UE in the PROSE DIRECT LINK ESTABLISHMENT REJECT message.\nNOTE 4:\tHow the target UE determines that it is under congestion is implementation specific (e.g., any relaying related operational overhead, etc).\nNOTE 5:\tIn case the target UE is under the NAS level mobility management congestion control, it is an implementation option that the provided back-off timer value to the initiating UE is set to the remaining time of the mobility management back-off timer T3346 or with an additional offset value.\nIf the 5G ProSe direct link establishment request is for 5G ProSe layer-3 UE-to-network relaying, the PDU session for relaying the service is an LADN PDU session, and the target UE acting as a 5G ProSe layer-3 UE-to-network relay UE is outside the LADN service area, the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #111 \"protocol error, unspecified\".\nIf the 5G ProSe direct link establishment request is for 5G ProSe layer-3 UE-to-network relaying, the request required the establishment of a PDU session by the 5G ProSe layer-3 UE-to-network relay UE which is a target UE, and the PDU session establishment was unsuccessful due to the reception of 5GSM cause #8 \"maximum number of PDU sessions reached\", #27 \"Missing or unknown DNN\", #28 \"Unknown PDU session type\", #29 \"user authentication or authorization failed\", #31 \"request rejected, unspecified\", #32 \"service option not supported\", #33 \"requested service option not subscribed\", #46 \"out of LADN service area\", or #65 \"maximum number of PDU sessions reached\" as specified in 3GPP TS 24.501 [11], the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #111 \"protocol error, unspecified\".\nIf the 5G ProSe direct link establishment request is for 5G ProSe UE-to-UE relay and:\na)\tthe target UE acting as a target 5G ProSe end UE is under congestion;\nthe target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #13 \"congestion situation\". The target UE may provide a back-off timer value to the initiating UE in the PROSE DIRECT LINK ESTABLISHMENT REJECT message.\nThe initiating UE, acting as a 5G ProSe UE-to-UE relay UE, upon reception of PROSE DIRECT LINK ESTABLISHMENT REJECT message from the target 5G ProSe end UE, and the 5G ProSe direct link establishment procedure is for direct communication between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, the target 5G ProSe end UE has rejected the 5G ProSe direct link establishment procedure or the 5G ProSe direct link modification procedure, the reject message contains a backoff value, and the initiating UE has not reached the maximum number of allowed retransmissions, the initiating UE shall send PROSE DIRECT LINK ESTABLISHMENT REJECT message to the source 5G ProSe end UE including a PC5 signaling cause value set to #20 \"Failure from 5G ProSe end UE\" and the backoff timer received from the target 5G ProSe end UE and the cause value from the target 5G ProSe end UE.\nThe UE acting as a source 5G ProSe end UE, upon reception of the PROSE DIRECT LINK ESTABLISHMENT REJECT message from the initiating UE acting as a 5G ProSe UE-to-UE relay UE, shall not re-attempt for the 5G ProSe direct link establishment procedure to the same target 5G ProSe end UE until the backoff timer has expired.\nThe initiating UE, acting as a 5G ProSe UE-to-UE relay UE, upon reception of PROSE DIRECT LINK ESTABLISHMENT REJECT message from the target 5G ProSe end UE, the 5G ProSe direct link establishment procedure is for direct communication between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, the target 5G ProSe end UE has rejected the 5G ProSe direct link establishment procedure or the 5G ProSe direct link modification procedure, the reject message contains a backoff value, and the initiating UE has reached the maximum number of allowed retransmissions, the initiating UE may send a PROSE DIRECT LINK ESTABLISHMENT REJECT message with the appropriate PC5 signalling protocol cause value to the source 5G ProSe end UE. The initiating UE shall include in the PROSE DIRECT LINK ESTABLISHMENT REJECT message PC5 protocol cause value #20 \"Failure from 5G ProSe end UE\" and include the PC5 end UE failure cause IE set to #13 \"congestion situation\" received from the target 5G ProSe end UE that has rejected the 5G ProSe direct link establishment or 5G ProSe direct link modification procedure. The initiating UE may include the target end UE info IE set to the user info ID of the target 5G ProSe end UE in the PROSE DIRECT LINK ESTABLISHMENT REJECT message.\nThe UE acting as a source 5G ProSe end UE, upon reception of PROSE DIRECT LINK ESTABLISHMENT REJECT message from the initiating UE acting as a 5G ProSe UE-to-UE relay UE, may abort the 5G ProSe direct link establishment procedure and may notify the upper layer that the target 5G ProSe end UE is unreachable, if the PC5 signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT message is #20 \"Failure from 5G ProSe end UE\" and the PC5 end UE failure cause IE is set to #13 \"congestion situation\".\nIf the 5G ProSe direct link establishment request is for 5G ProSe UE-to-UE relay and:\na)\tthe target UE acting as a 5G ProSe UE-to-UE relay UE is under congestion;\nthe target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #13 \"congestion situation\". The target UE may provide a back-off timer value to the initiating UE in the PROSE DIRECT LINK ESTABLISHMENT REJECT message.\nThe initiating UE acting as a source 5G ProSe end UE, upon reception of PROSE DIRECT LINK ESTABLISHMENT REJECT message from the target UE acting as a 5G ProSe UE-to-UE relay UE, may abort the 5G ProSe direct link establishment procedure and may select another 5G ProSe UE-to-UE Relay to establish a PC5 link with the same target 5G ProSe end UE, if the PC5 signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT message is #13 \"congestion situation\".\nIf the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE and it fails due to a failure in the security procedure over control plane or security procedure over user plane as specified in 3GPP TS 33.503 [34], the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #15 \"security procedure failure of 5G ProSe UE-to-network relay\". The target UE shall provide the EAP message if received from the network according to the security procedure over control plane as specified in 3GPP TS 33.503 [34].\nNOTE 6:\tThe cause value #15 \"security procedure failure of 5G ProSe UE-to-network relay\" is also used when the CP-PRUK or the UP-PRUK is not found in the network.\nIf the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE and it fails due to a failure in the security procedure over control plane or security procedure over user plane as specified in 3GPP TS 33.503 [34], the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #xx \"security procedure failure of 5G ProSe UE-to-UE relay\". The target UE shall provide the EAP message if received from the network according to the security procedure over control plane as specified in 3GPP TS 33.503 [34].\nNOTE 7:\tThe cause value #xx \"security procedure failure of 5G ProSe UE-to-UE relay\" is also used when the CP-PRUK or the UP-PRUK is not found in the network.\nIf the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe UE-to-UE relay UE and target 5G ProSe end UE with integrated discovery and a 5G ProSe direct link for the pair of initiating UE user info ID and target UE user info ID already exists and the data type unit is IP or Ethernet, the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message to the 5G ProSe UE-to-UE relay UE containing PC5 signalling protocol cause value #yy \"5G ProSe direct link already exists\".\nIf the target UE is acting as a target 5G ProSe end UE and the 5G ProSe direct link establishment procedure is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE, the target 5G ProSe end UE may include in the PROSE DIRECT LINK ESTABLISHMENT REJECT message:\na)\tthe source end UE info IE set to the user info ID of the source 5G ProSe end UE;\nb)\tthe target end UE info IE set to the user info ID of the target 5G ProSe end UE; and\nc)\tthe UE-to-UE relay UE info IE set to the user info ID of the 5G ProSe UE-to-UE relay UE.\nIf the target UE is acting as a 5G ProSe UE-to-UE relay UE, the 5G ProSe direct link establishment procedure is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the target 5G ProSe end UE has rejected the 5G ProSe direct link establishment procedure or the 5G ProSe direct link modification procedure, then the 5G ProSe UE-to-UE relay UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message with PC5 signalling protocol cause value #20 \"Failure from 5G ProSe end UE\" to the source 5G ProSe end UE. The 5G ProSe UE-to-UE relay UE may include in the PROSE DIRECT LINK ESTABLISHMENT REJECT message the PC5 end UE failure cause IE set to the PC5 signalling protocol cause received from the target 5G ProSe end UE that has rejected the 5G ProSe direct link establishment procedure. The 5G ProSe UE-to-UE relay UE may include in the PROSE DIRECT LINK ESTABLISHMENT REJECT message:\na)\tthe source end UE info IE set to the user info ID of the source 5G ProSe end UE;\nb)\tthe target end UE info IE set to the user info ID of the target 5G ProSe end UE; and\nc)\tthe UE-to-UE relay UE info IE set to the user info ID of the 5G ProSe UE-to-UE relay UE.\nIf the 5G ProSe direct link establishment fails due to other reasons, the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #111 \"protocol error, unspecified\".\nAfter sending the PROSE DIRECT LINK ESTABLISHMENT REJECT message, the target UE shall provide the following information along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication to the lower layer:\na)\tan indication of deactivation of the PC5 unicast security protection and deletion of security context for the 5G ProSe direct link, if applicable.\nUpon receipt of the PROSE DIRECT LINK ESTABLISHMENT REJECT message, the initiating UE shall stop timer T5080 and abort the 5G ProSe direct link establishment procedure.\nIf the PC5 signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT message is #1 \"direct communication to the target UE not allowed\" or #5 \"lack of resources for 5G ProSe direct link\", then the initiating UE shall not attempt to start the 5G ProSe direct link establishment procedure with the same target UE at least for a time period T.\nNOTE 7:\tThe length of time period T is UE implementation specific and can be different for the case when the UE receives PC5 signalling protocol cause value #1 \"direct communication to the target UE not allowed\" or when the UE receives PC5 signalling protocol cause value #5 \"lack of resources for 5G ProSe direct link\".\nIf the PC5 signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT message is #13 \"congestion situation\" and a back-off timer value is provided in the PROSE DIRECT LINK ESTABLISHMENT REJECT message, the initiating UE shall start timer T5088 associated with the layer-2 ID of the target UE and set its value to the provided timer value.\nIf the PC5 signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT message is #15 \"security procedure failure of 5G ProSe UE-to-network relay\", and initiating UE, acting as the 5G ProSe remote UE, has included the UE identity IE set to SUCI in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, then the initiating UE shall initiate the UE-to-network relay reselection procedure as specified in clause 8.2.3. If the PC5 signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT message is #15 \"security procedure failure of 5G ProSe UE-to-network relay\" and the initiating UE, acting as the 5G ProSe remote UE, has included the User security key ID IE set to UP-PRUK ID or CP-PRUK ID in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, then the initiating UE may initiate the UE-to-network relay reselection procedure as specified in clause 8.2.3 and the UE shall further:\na)\tif the same 5G ProSe UE-to-network relay UE is selected, discard the previously used CP-PRUK and associated CP-PRUK ID, or the UP-PRUK and associated UP-PRUK ID, if any, and include the UE identity IE set to SUCI in the PROSE DIRECT LINK ESTABLISHMENT REQUEST when initiating the subsequent 5G ProSe direct link establishment procedure as specified in clause 7.2.2.2; or\nb)\tif a different 5G ProSe UE-to-network relay UE is selected, include the User security key ID IE set to the previously used UP-PRUK ID or CP-PRUK ID in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nIf the PC5 signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT message is #xx \"security procedure failure of 5G ProSe UE-to-UE relay\", and initiating UE, acting as the 5G ProSe end UE, has included the UE identity IE set to SUCI in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, then the initiating UE shall initiate the UE-to-UE relay reselection procedure as specified in clause 8a.2.3. If the PC5 signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT message is #xx \"security procedure failure of 5G ProSe UE-to-UE relay\" and the initiating UE, acting as the 5G ProSe end UE, has included the User security key ID IE set to UP-PRUK ID or CP-PRUK ID in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, then the initiating UE may initiate the UE-to-UE relay reselection procedure as specified in clause 8a.2.3 and the UE shall further:\na)\tif the same 5G ProSe UE-to-UE relay UE is selected, discard the previously used CP-PRUK and associated CP-PRUK ID, or the UP-PRUK and associated UP-PRUK ID, if any, and include the UE identity IE set to SUCI in the PROSE DIRECT LINK ESTABLISHMENT REQUEST when initiating the subsequent 5G ProSe direct link establishment procedure as specified in clause 7.2.2.2; or\nb)\tif a different 5G ProSe UE-to-UE relay UE is selected, include the User security key ID IE set to the previously used UP-PRUK ID or CP-PRUK ID in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nIf the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe UE-to-UE relay UE and target 5G ProSe end UE and the PC5 signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT message is #yy \"5G ProSe direct link already exists\", then the initiating UE acting as the 5G ProSe UE-to-UE relay UE may initiate the 5G ProSe direct link modification procedure with the target UE to associate the source 5G ProSe end UE user info ID and the ProSe identifiers, as specified in the rejected PROSE DIRECT LINK ESTABLISHMENT REQUEST message, to the existing 5G ProSe direct link.\nAfter receiving the PROSE DIRECT LINK ESTABLISHMENT REJECT message, the initiating UE shall provide the following information along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication to the lower layer:\na)\tan indication of deactivation of the PC5 unicast security protection and deletion of security context for the 5G ProSe direct link, if applicable.\nIf timer T5080 expires and the Target user info IE is included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, the initiating UE shall retransmit the PROSE DIRECT LINK ESTABLISHMENT REQUEST message and restart timer T5080. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe direct link establishment procedure and may notify the upper layer that the target UE is unreachable. If the initiating UE is acting as a 5G ProSe UE-to-UE relay UE, the initiating UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message to the source 5G ProSe end UE.\nUpon expiry of the timer T5080, if the PROSE DIRECT LINK ESTABLISHMENT REQUEST message did not include the Target user info IE and the initiating UE did not receive any PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, the initiating UE may retransmit the PROSE DIRECT LINK ESTABLISHMENT REQUEST message and restart timer T5080. If the PROSE DIRECT LINK ESTABLISHMENT REQUEST message did not include the Target user info IE and the initiating UE did not receive any PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, then after reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe direct link establishment procedure and may notify the upper layer that no target UE is available.\nNOTE:\tThe maximum number of allowed retransmissions is UE implementation specific.\nIf the need to establish a link no longer exists before the procedure is completed, the initiating UE shall abort the procedure.\nWhen the initiating UE aborts the 5G ProSe direct link establishment procedure, the initiating UE shall provide the following information along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication to the lower layer:\na)\tan indication of deactivation of the PC5 unicast security protection and deletion of security context for the 5G ProSe direct link, if applicable.\nFor a received PROSE DIRECT LINK ESTABLISHMENT REQUEST message from a source layer-2 ID (for unicast communication), if the target UE already has an existing link established to the UE known to use the same source layer-2 ID, the same source user info, the same type of data (IP, Ethernet orUnstructured) and the same security policy, the UE shall process the new request. However, the target UE shall only delete the existing 5G ProSe direct link context after the new link establishment procedure succeeds.\nNOTE:\tThe type of data (e.g., IP, Ethernet or Unstructured) is indicated by the optional IP address configuration IE included in the corresponding PROSE DIRECT LINK SECURITY MODE COMPLETE message, i.e., the type of data for the requested link is IP type if this IE is included and the type of data for the requested link is Ethernet or Unstructured if this IE is not included.\nIf the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, after the target UE decrypts the encrypted relay service code using the DUSK or DUCK used for 5G ProSe UE-to-network relay discovery, if the relay service code does not match with the one that the target UE has sent during 5G ProSe UE-to-network relay discovery procedure, then the target UE shall abort the 5G ProSe direct link establishment procedure.\nIf the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the message is integrity protected and the integrity verification of the message fails at the target UE, then the target UE shall abort the 5G ProSe direct link establishment procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.3\t5G ProSe direct link modification procedure",
                            "text_content": "The purpose of the 5G ProSe direct link modification procedure is to modify the existing ProSe direct link to:\na)\tadd new PC5 QoS flow(s) to the existing 5G ProSe direct link;\nb)\tmodify existing PC5 QoS flow(s) for updating PC5 QoS parameters of the existing PC5 QoS flow(s);\nc)\tmodify existing PC5 QoS flow(s) for associating new ProSe application(s) with the existing PC5 QoS flow(s);\nd)\tmodify existing PC5 QoS flow(s) for removing the associated ProSe application(s) from the existing PC5 QoS flow(s);\ne)\tremove existing PC5 QoS flow(s) from the existing 5G ProSe direct link;\nf) \tnegotiate a new 5G ProSe UE-to-UE relay UE over the existing 5G ProSe direct link;\ng)\testablish 5G ProSe UE-to-UE relay communication with additional 5G ProSe layer-3 end UE(s) using the existing 5G ProSe direct link between the 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE; or\nh)\trelease 5G ProSe UE-to-UE relay communication with one of the peer 5G ProSe layer-3 end UEs using the shared 5G ProSe direct link between the 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE.\nIn this procedure, the UE sending the PROSE DIRECT LINK MODIFICATION REQUEST message is called the \"initiating UE\" and the other UE is called the \"target UE\".\nNOTE:\tThe 5G ProSe direct link modification procedure is not applicable for 5G ProSe layer-2 UE-to-network relay case.\nThe initiating UE shall meet the following pre-conditions before initiating this procedure for adding a new ProSe application to the existing 5G ProSe direct link:\na)\tthere is a 5G ProSe direct link between the initiating UE and the target UE;\nb)\tthe pair of application layer IDs and the network layer protocol of this 5G ProSe direct link are identical to those required by the application layer in the initiating UE for this ProSe application;\nc)\tthe security policy corresponding to the ProSe identifier is aligned with the security policy of the existing 5G ProSe direct link;\nd)\tthe timer T5091 is not running; and\ne)\tthe initiating UE is not performing the 5G ProSe direct link re-keying procedure initiated by the target UE.\nThe initiating UE shall meet the following pre-conditions before initiating this procedure for negotiating a new 5G ProSe UE-to-UE relay UE over the existing 5G ProSe direct link:\na)\tthe initiating UE is a source 5G ProSe end UE communicating with the target 5G ProSe end UE via a 5G ProSe UE-to-UE relay UE;\nb)\tthe initiating UE determines, e.g., based on PC5 signal strength, to perform UE-to-UE relay reselection; and\nc)\tthe initiating UE obtains a list of candidate UE-to-UE relays via UE-to-UE discovery procedure.\nThe initiating UE shall meet the following pre-conditions before initiating this procedure for establishing 5G ProSe UE-to-UE relay communication with an additional 5G ProSe layer-3 end UE over the existing 5G ProSe direct link:\na)\tthere is a 5G ProSe direct link between the initiating UE and the target UE;\nb)\tthe initiating UE acts as a 5G ProSe layer-3 end UE and the target UE acts as a 5G ProSe layer-3 UE-to-UE relay UE, or vice versa;\nc)\tthe initiating UE, if acting as a 5G ProSe layer-3 end UE, determines to communicate with an additional 5G ProSe layer-3 end UE using the same RSC as that of the existing 5G ProSe direct link; and\nd)\tthe initiating UE, if acting as a 5G ProSe layer-3 UE-to-UE relay UE, receives a request from another 5G ProSe layer-3 end UE to communicate with the target UE using the same RSC as that of the existing 5G ProSe direct link.\nAfter receiving the service data or request from the upper layers, the initiating UE shall perform the PC5 QoS flow match as specified in clause 7.2.8. If there is no matched PC5 QoS flow, the initiating UE shall derive the PC5 QoS parameters and assign the PQFI(s) for the PC5 QoS flows(s) to be established as specified in clause 7.2.7.\nIf the 5G ProSe direct link modification procedure is to add new PC5 QoS flow(s) to the existing 5G ProSe direct link, the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this message, initiating UE:\na)\tshall include the PQFI(s), the corresponding PC5 QoS parameters and optionally the ProSe identifier(s);\nb)\tshall include the link modification operation code set to \"Add new PC5 QoS flow(s) to the existing 5G ProSe direct link \";\nc)\tmay include the PC5 QoS rule(s) to indicate the packet filters of the PC5 QoS flow(s);\nd)\tshall include the source end UE info set to the user info ID of the source 5G ProSe layer-3 end UE, if the UE acts as a 5G ProSe layer-3 UE-to-UE relay UE, the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE, and multiple source 5G ProSe layer-3 end UEs have established direct communication with the target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\ne)\tmay include the source end UE info set to the user info ID of the source 5G ProSe end UE, if the UE acts as a 5G ProSe UE-to-UE relay UE, the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE, and only one source 5G ProSe end UE has established direct communication with the target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link;\nf)\tshall include the target end UE info set to the user info ID of the target 5G ProSe layer-3 end UE, if the UE acts as a source 5G ProSe layer-3 end UE, the 5G ProSe direct link is between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, and the source 5G ProSe layer-3 end UE has established direct communication with multiple target 5G ProSe layer-3 end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\ng)\tmay include the target end UE info set to the user info ID of the target 5G ProSe end UE, if:\n1)\tthe UE acts as a source 5G ProSe end UE, the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the source 5G ProSe end UE has established direct communication with only one target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link; or\n2)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE; and\nh)\tmay include the target end UE layer-2 ID set to the layer-2 ID of the target 5G ProSe end UE, if the UE acts as a source 5G ProSe end UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nIf the 5G ProSe direct link modification procedure is to modify the PC5 QoS parameters for existing PC5 QoS flow(s) in the existing 5G ProSe direct link, the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this message, the initiating UE:\na)\tshall include the PQFI(s) and the corresponding PC5 QoS parameters, including the ProSe identifier(s);\nb)\tshall include the link modification operation code set to \"Modify PC5 QoS parameters of the existing PC5 QoS flow(s)\";\nc)\tmay include the PC5 QoS rule(s) to indicate the packet filters of the PC5 QoS flow(s);\nd)\tshall include the source end UE info set to the user info ID of the source 5G ProSe layer-3 end UE, if the UE acts as a 5G ProSe layer-3 UE-to-UE relay UE, the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE, and multiple source 5G ProSe layer-3 end UEs have established direct communication with the target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\ne)\tmay include the source end UE info set to the user info ID of the source 5G ProSe end UE, if the UE acts as a 5G ProSe UE-to-UE relay UE, the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE, and only one source 5G ProSe end UE has established direct communication with the target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link;\nf)\tshall include the target end UE info set to the user info ID of the target 5G ProSe layer-3 end UE, if the UE acts as a source 5G ProSe layer-3 end UE, the 5G ProSe direct link is between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, and the source 5G ProSe layer-3 end UE has established direct communication multiple target 5G ProSe layer-3 end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\ng)\tmay include the target end UE info set to the user info ID of the target 5G ProSe end UE, if:\n1)\tthe UE acts as a source 5G ProSe end UE, the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the source 5G ProSe end UE has established direct communication with only one target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link; or\n2)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE; and\nh)\tmay include the target end UE layer-2 ID set to the destination layer-2 ID of the target 5G ProSe end UE, if the UE acts as a source 5G ProSe end UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nIf the 5G ProSe direct link modification procedure is to associate new ProSe application(s) with existing PC5 QoS flow(s), the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this message, the initiating UE:\na)\tshall include the PQFI(s) and the corresponding PC5 QoS parameters, including the ProSe identifier(s);\nb)\tshall include the link modification operation code set to \"Associate new ProSe application(s) with existing PC5 QoS flow(s)\";\nc)\tmay include the PC5 QoS rule(s) to indicate the packet filters of the PC5 QoS flow(s);\nd)\tshall include the source end UE info set to the user info ID of the source 5G ProSe layer-3 end UE, if the UE acts as a 5G ProSe layer-3 UE-to-UE relay UE, the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE, and multiple source 5G ProSe layer-3 end UEs have established direct communication with the target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\ne)\tmay include the source end UE info set to the user info ID of the source 5G ProSe end UE, if the UE acts as a 5G ProSe UE-to-UE relay UE, the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE, and only one source 5G ProSe end UE has established direct communication with the target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link;\nf)\tshall include the target end UE info set to the user info ID of the target 5G ProSe layer-3 end UE, if the UE acts as a source 5G ProSe layer-3 end UE, the 5G ProSe direct link is between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, and the source 5G ProSe layer-3 end UE has established direct communication with multiple target 5G ProSe layer-3 end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\ng)\tmay include the target end UE info set to the user info ID of the target 5G ProSe end UE, if:\n1)\tthe UE acts as a source 5G ProSe end UE, the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the source 5G ProSe end UE has established direct communication with only one target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link; or\n2)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE; and\nh)\tmay include the target end UE layer-2 ID set to the layer-2 ID of the target 5G ProSe end UE, if the UE acts as a source 5G ProSe end UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nIf the PC5 5G ProSe direct link modification procedure is to remove the associated ProSe application(s) from existing PC5 QoS flow(s), the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this message, the initiating UE:\na)\tshall include the PQFI(s) and the corresponding PC5 QoS parameters including the ProSe identifier(s); and\nb)\tshall include the link modification operation code set to \"Remove ProSe application(s) from existing PC5 QoS flow(s)\".\nIf the direct link modification procedure is to remove any PC5 QoS flow(s) from the existing 5G ProSe direct link, the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this message, the initiating UE:\na)\tshall include the PQFI(s); and\nb)\tshall include the link modification operation code set to \"Remove existing PC5 QoS flow(s) from the existing 5G ProSe direct link\".\nIf the 5G ProSe direct link modification procedure is to establish 5G ProSe UE-to-UE relay communication with additional 5G ProSe layer-3 end UE using the existing 5G ProSe direct link between the 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE, the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this message, the initiating UE:\na)\tshall include the source end UE info set to the user info ID of the source 5G ProSe layer-3 end UE and the target end UE info set to the user info ID of the target 5G ProSe layer-3 end UE received in PROSE DIRECT LINK ESTABLISHMENT REQUEST message, if the UE acts as a 5G ProSe layer-3 UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE;\nb)\tfor Ethernet traffic, shall include the MAC address of the source 5G ProSe layer-3 end UE, if the UE acts as a 5G ProSe layer-3 UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE and shall include the MAC address of the source 5G ProSe layer-3 end UE, if:\n1)\tthe UE acts as a source 5G ProSe layer-3 UE-to-UE end UE;\n2)\tthe MAC address of the source 5G ProSe layer-3 end UE changed; and\n3)\tthe 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the source 5G ProSe layer-3 end UE;\nc)\tshall include the target end UE info set to the user info ID of the additional target 5G ProSe layer-3 end UE to which the 5G ProSe UE-to-UE relay communication is requested, if the UE acts as a source 5G ProSe layer-3 end UE and the 5G ProSe direct link is between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE;\nd)\tshall include the link modification operation code set to \"Add new 5G ProSe layer-3 end UE to the existing 5G ProSe direct link\";\ne)\tmay include the PQFI(s) and the corresponding PC5 QoS parameters including the ProSe identifier(s);\nf)\tmay include the PC5 QoS rule(s) to indicate the packet filters of the PC5 QoS flow(s); and\ng)\tmay include the target end UE layer-2 ID set to the layer-2 ID of the target 5G ProSe layer-3 end UE, if the UE acts as a source 5G ProSe layer-3 end UE and the 5G ProSe direct link is between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE.\nIf the 5G ProSe direct link modification procedure is to release 5G ProSe UE-to-UE relay communication with one of the peer 5G ProSe layer-3 end UEs using the shared 5G ProSe direct link between the 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE, the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this message, initiating UE:\na)\tshall include the source end UE info set to the source user info ID of the 5G ProSe layer-3 end UE received in the PROSE DIRECT LINK RELEASE REQUEST message, if the UE acts as a 5G ProSe layer-3 UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the 5G ProSe layer-3 end UE;\nb)\tshall include the target end UE info set to the user info ID of the peer 5G ProSe layer-3 end UE with which the 5G ProSe UE-to-UE relay communication is to be released, if the UE acts as a 5G ProSe layer-3 end UE and the 5G ProSe direct link is between the 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE; and\nc)\tshall include the link modification operation code set to \"Remove 5G ProSe layer-3 end UE from the existing 5G ProSe direct link\".\nIf the 5G ProSe direct link modification procedure is to trigger the negotiated 5G ProSe layer-3 UE-to-UE relay reselection, the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this message:\n1)\tIf the initiating UE acts as a source 5G ProSe layer-3 end UE and the 5G ProSe direct link is between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, the initiating UE:\na)\tshall include the relay reselection indication;\nb)\tshall include the list of user info IDs of the candidates 5G ProSe UE-to-UE relay UEs supporting the same RSC used for the existing 5G ProSe direct link;\nc)\tshall include the list of target 5G ProSe end UEs IP address/prefix, if IP communication is used; and\nd)\tmay include the list of layer-2 IDs of the candidates 5G ProSe UE-to-UE relay UEs supporting the same RSC used for the existing 5G ProSe direct link.\n2)\tIf the initiating UE acts as a 5G ProSe layer-3 UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe end UE, the initiating UE:.\na)\tshall include the relay reselection indication;\nb)\tshall include the list of user info IDs of the candidates 5G ProSe UE-to-UE relay UEs supporting the same RSC used for the existing 5G ProSe direct link;\nc)\tshall include the initiating source 5G ProSe UE IP address/prefix, if IP communication is used; and\nd)\tmay include list of layer-2 IDs of the candidates 5G ProSe UE-to-UE relay UEs supporting the same RSC used for the existing 5G ProSe direct link.\nIf the 5G ProSe direct link modification procedure is to trigger the negotiated 5G ProSe layer-3 UE-to-UE relay reselection and the initiating UE acts as a 5G ProSe layer-3 UE-to-UE relay UE, the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message for every IP address/prefix of the target 5G ProSe layer-3 end UEs received on the associated PROSE DIRECT LINK MODIFICATION REQUEST message from the source 5G ProSe layer-3 end UE.\nIf the 5G ProSe direct link modification procedure is to trigger the negotiated 5G ProSe layer-2 UE-to-UE relay reselection, the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this message:\n1)\tshall include the relay reselection indication;\n2)\tshall include the list of candidates 5G ProSe UE-to-UE relay UE user info ID;\n3)\tshall include the new MSBs of KNRP ID; and\n4)\tmay include the list of candidates 5G ProSe UE-to-UE relay UE layer-2 ID.\nAfter the PROSE DIRECT LINK MODIFICATION REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for 5G ProSe direct communication and the target UE's layer-2 ID for 5G ProSe direct communication and start timer T5081. The UE shall not send a new PROSE DIRECT LINK MODIFICATION REQUEST message to the same target UE while timer T5081 is running.\nThe figure depicts a 5G ProSe direct link modification procedure, illustrating the steps involved in modifying the direct link between a base station (gNB) and a user equipment (UE) to enhance signal quality and reduce interference. The figure includes key components such as the gNB, UE, and scatterers, as well as the use of beamforming techniques to mitigate interference.\nFigure 7.2.3.2.1: 5G ProSe direct link modification procedure\nThe figure depicts a detailed procedure for modifying the direct link of a 5G ProSe layer-3 UE-to-UE relay selection in the 5G ProSe layer-3 protocol. The figure illustrates the steps involved in the modification process, including the selection of the relay, the modification of the link, and the reselection of the relay. The figure is crucial for understanding the complex process of 5G ProSe layer-3 UE-to-UE relay selection and its impact on network performance.\nFigure 7.2.3.2.2: 5G ProSe direct link modification procedure for the negotiated 5G ProSe layer-3 UE-to-UE relay reselection\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is accepted, the target UE shall respond with the PROSE DIRECT LINK MODIFICATION ACCEPT message.\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is to add a new ProSe application, add new PC5 QoS flow(s) or modify any existing PC5 QoS flow(s) in the 5G ProSe direct link, the target UE:\na)\tshall include the PQFI(s), the corresponding PC5 QoS parameters and optionally the ProSe identifier(s) that the target UE accepts;\nb)\tmay include the PC5 QoS rule(s) to indicate the packet filters of the PC5 QoS flow(s);\nc)\tshall include the source end UE info set to the user info ID of the source 5G ProSe layer-3 end UE, if the UE acts as a target 5G ProSe layer-3 end UE, the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE, and the target 5G ProSe layer-3 end UE has established direct communication with multiple source 5G ProSe layer-3 end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link; and\nd)\tmay include the source end UE info set to the user info ID of the source 5G ProSe end UE, if the UE acts as a target 5G ProSe end UE, the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE, and the target 5G ProSe end UE has established direct communication with only one source 5G ProSe end UEs via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link; and\ne)\tshall include the target end UE info set to the user info ID of the target 5G ProSe end UE, if the UE acts as a 5G ProSe UE-to-UE relay UE and, the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the source 5G ProSe layer-3 end UE has established direct communication with multiple target 5G ProSe layer-3 end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\nf)\tmay include the target end UE info set to the user info ID of the target 5G ProSe end UE, if the UE acts as a 5G ProSe UE-to-UE relay UE, the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the source 5G ProSe end UE has established direct communication with only one target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link;\nin the PROSE DIRECT LINK MODIFICATION ACCEPT message.\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is to remove an existing ProSe application from the 5G ProSe direct link, the target UE shall delete the ProSe identifier received in the PROSE DIRECT LINK MODIFICATION REQUEST message and the corresponding PQFI(s) and PC5 QoS parameters from the profile associated with the 5G ProSe direct link.\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is to remove existing PC5 QoS flow(s) from the PC5 5G ProSe direct link, the target UE shall delete the PQFI(s) and the corresponding PC5 QoS parameters from the profile associated with the 5G ProSe direct link.\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is to add a new ProSe application, add new PC5 QoS flow(s) or modify any existing PC5 QoS flow(s) in the 5G ProSe direct link, after sending the PROSE DIRECT LINK MODIFICATION ACCEPT message, the target UE shall provide the added or modified PQFI(s) and corresponding PC5 QoS parameters along with PC5 link identifier to the lower layer.\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is to remove an existing ProSe application or to remove the existing PC5 QoS flow(s) from the 5G ProSe direct link, after sending the PROSE DIRECT LINK MODIFICATION ACCEPT message, the target UE shall provide the removed PQFI(s) along with the PC5 link identifier to the lower layer.\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is to establish 5G ProSe UE-to-UE relay communication with additional 5G ProSe layer-3 end UE using the existing 5G ProSe direct link between the 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE, the target UE:\na)\tif acting as the 5G ProSe layer-3 UE-to-UE relay UE, shall perform the 5G ProSe direct link establishment procedure towards the target 5G ProSe layer-3 end UE as specified in clause 7.2.2.2; and after receiving the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message from the target 5G ProSe layer-3 end UE, shall create a PROSE DIRECT LINK MODIFICATION ACCEPT message;\nb)\tif acting as the target 5G ProSe layer-3 end UE, shall create a PROSE DIRECT LINK MODIFICATION ACCEPT message; and\nc)\tin the PROSE DIRECT LINK MODIFICATION ACCEPT message, the target UE:\n1)\tif the UE acts as the target 5G ProSe layer-3 end UE:\ni)\tshall include the source end UE info set to the user info ID of the source 5G ProSe layer-3 end UE and the target end UE info set to the user info ID of the target 5G ProSe layer-3 end UE;\nii)\tfor Ethernet traffic, shall include the MAC address of the target 5G ProSe layer-3 end UE if the MAC address of the target 5G ProSe layer-3 end UE changed; or\n2)\tif the UE acts as the 5G ProSe layer-3 UE-to-UE relay UE:\ni)\tshall include the target end UE info set to the user info ID of the target 5G ProSe layer-3 end UE;\nii)\tfor IP traffic, may include the target 5G ProSe layer-3 end UE IP address IE set to the IP address of the additional target 5G ProSe layer-3 end UE; and\niii)\tfor Ethernet traffic, shall include the MAC address of the target 5G ProSe layer-3 end UE.\n3)\tmay include the PQFI(s) and the corresponding PC5 QoS parameters optionally including the ProSe identifier(s) for the PC5 QoS flow(s) that the target 5G ProSe layer-3 end UE accepts; and\n4)\tmay include the PC5 QoS rule(s) to indicate the packet filters of the PC5 QoS flow(s).\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is to release 5G ProSe UE-to-UE relay communication with one of the peer 5G ProSe layer-3 end UEs using the shared 5G ProSe direct link between the 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE, the target UE:\na)\tif acting as the 5G ProSe layer-3 UE-to-UE relay UE, may initiate one of the following procedures towards the target 5G ProSe layer-3 end UE:\n1)\t5G ProSe direct link release procedure as specified in clause 7.2.6.2 to release the 5G ProSe direct link with the peer 5G ProSe layer-3 end UE; or\n2)\t5G ProSe direct link modification procedure as specified in clause 7.2.3.2 to remove the corresponding PC5 QoS flow(s), if the UE determines to keep the 5G ProSe direct link with the peer 5G ProSe layer-3 end UE; and\nb)\tshall create a PROSE DIRECT LINK MODIFICATION ACCEPT message, and in this message, the target UE:\n1)\tshall include the source end UE info set to the user info ID of the source 5G ProSe layer-3 end UE, if the UE acts as the target 5G ProSe layer-3 end UE; or\n2)\tshall include the target end UE info set to the user info ID of the target 5G ProSe layer-3 end UE, if the UE acts as the 5G ProSe layer-3 UE-to-UE relay UE.\nIf the 5G ProSe direct link is for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe layer-3 UE-to-network relay UE, and if the initiating UE is the 5G ProSe remote UE, then the target UE (as the 5G ProSe layer-3 UE-to-network relay UE) performs the QoS flows handling procedure as specified in clause 8.2.6.3.3 and clause 8.2.6.4.2.\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is accepted by the target 5G ProSe end UE to trigger UE-to-UE relay reselection and the 5G PC5 direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE, the target UE acting as the target 5G ProSe end UE may perform the candidate 5G ProSe UE-to-UE relay discovery procedure as specified in clause 8a.2.3.3. The target UE shall set up a PC5 unicast link with the selected new 5G ProSe UE-to-UE relay UE, if no such PC5 unicast link already exists.\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is accepted to trigger the negotiated 5G ProSe layer-3 UE-to-UE relay reselection, the target UE shall respond with PROSE DIRECT LINK MODIFICATION ACCEPT message. In this message:\na)\tif the target UE acts as a target 5G ProSe layer-3 end UE and the 5G ProSe direct link is between the target 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, the target UE:\n1)\tshall include the relay reselection indication;\n2)\tshall include the newly selected 5G ProSe UE-to-UE relay UE user info ID;\n3)\tshall include the initiating 5G ProSe end UE IP address; and\n4)\tshall include the target 5G ProSe end UE IP address to be used with the newly selected 5G ProSe UE-to-UE relay UE, if IP communication is used.\nb)\tif the target UE acts as a 5G ProSe layer-3 UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the source 5G ProSe layer-3 end UE, after receiving the PROSE DIRECT LINK MODIFICATION ACCEPT message from the target 5G ProSe layer-3 end UE, the target UE.\n1)\tshall include the relay reselection indication;\n2)\tshall include the newly selected 5G ProSe UE-to-UE relay UE user info ID;\n3)\tshall include the target 5G ProSe end UE IP address; and\n4)\tshall include the target 5G ProSe end UE IP address to be used with the newly selected 5G ProSe UE-to-UE relay UE, if IP communication is used.\nIf the PROSE DIRECT LINK MODIFICATION REQUEST message is accepted to trigger the negotiated 5G ProSe layer-2 UE-to-UE relay reselection, the target UE acting as the target 5G ProSe layer-2 end UE shall respond with PROSE DIRECT LINK MODIFICATION ACCEPT message. In this message:\na)\tshall include the new 5G ProSe UE-to-UE relay UE user info ID; and\nb)\tshall include the new LBSs of KNRP ID.\nAfter the PROSE DIRECT LINK MODIFICATION ACCEPT message is generated, the target UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for 5G ProSe direct communication and the target UE's layer-2 ID for 5G ProSe direct communication.\nIf this procedure is performed for the negotiated 5G ProSe layer-3 UE-to-UE relay reselection, the target UE shall start timer T5096. The target UE shall not send a new PROSE DIRECT LINK MODIFICATION ACCEPT message to the same initiating UE while timer T5096 is running.\nIf the target UE accepts the 5G ProSe direct link modification request, then the target UE may perform the PC5 QoS flow establishment over 5G ProSe direct link as specified in clause 7.2.7 and perform the PC5 QoS flow match over 5G ProSe direct link as specified in clause 7.2.8.\nThe target UE shall form the new KNRP ID from the new MSBs of KNRP ID received in the PROSE DIRECT LINK MODIFICATION REQUEST message and the new LSBs of KNRP ID included in the PROSE DIRECT LINK MODIFICATION ACCEPT message. The target UE shall replace the existing KNRP ID with the new KNRP ID. The target UE may include the new KNRP ID in DIRECT LINK ESTABLISHMENT REQUEST message with the initiating UE as specified in clause 7.2.2.2.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION ACCEPT message, the initiating UE shall stop timer T5081.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION ACCEPT message, if the PROSE DIRECT LINK MODIFICATION REQUEST message is to add a new ProSe application, add new PC5 QoS flow(s) or modify any existing PC5 QoS flow(s) in the 5G ProSe direct link, the initiating UE shall provide the added or modified PQFI(s) and corresponding PC5 QoS parameters along with PC5 link identifier to the lower layer.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION ACCEPT message, if the PROSE DIRECT LINK MODIFICATION REQUEST message is to remove an existing ProSe application or to remove the existing PC5 QoS flow(s) from the 5G ProSe direct link, the initiating UE shall provide the removed PQFI(s) along with the PC5 link identifier to the lower layer.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION ACCEPT message, if the initiating UE acts as the 5G ProSe layer-3 UE-to-UE relay UE and the PROSE DIRECT LINK MODIFICATION REQUEST message is to establish 5G ProSe UE-to-UE relay communication with additional 5G ProSe layer-3 end UE using the existing 5G ProSe direct link between the 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE, the initiating UE shall send a PROSE DIRECT LINK ESTABLISHMENT ACCEPT message to the source 5G ProSe layer-3 end UE as specified in clause 7.2.2.3.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION ACCEPT message, if the initiating UE acts as the 5G ProSe layer-3 UE-to-UE relay UE and the PROSE DIRECT LINK MODIFICATION REQUEST message is to add new PC5 QoS flow(s) or modify any existing PC5 QoS flow(s) in the existing 5G ProSe direct link or to remove any PC5 QoS flow(s) from the existing 5G ProSe direct link between the 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE, the initiating UE shall send a PROSE DIRECT LINK MODIFICATION ACCEPT message to the source 5G ProSe layer-3 end UE as specified in clause 7.2.3.3.\nWhen the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, upon receiving PROSE DIRECT LINK MODIFICATION ACCEPT message, which includes relay reselection indication, and the PROSE DIRECT LINK MODIFICATION REQUEST message is for the negotiated 5G ProSe UE-to-UE relay reselection, the initiating UE, acting as the source 5G ProSe end UE, shall set up a PC5 unicast link with the newly selected 5G ProSe UE-to-UE relay UE whose user info ID is included in the PROSE DIRECT LINK MODIFICATION ACCEPT message, if no such PC5 unicast link already exists. If the initiating UE acts as a source 5G ProSe layer-3 end UE, the initiating UE shall create a PROSE DIRECT LINK MODIFICATION ACK message. In this message, the initiating UE:\na)\tshall include the relay reselection indication, source end UE IP address for new relay IE set to IP address of the source 5G ProSe layer-3 end UE's IP address to be used with the newly selected 5G ProSe layer-3 UE-to-UE relay UE and target end UE IP address IE set to the IP address of the target 5G ProSe layer-3 end UE, if IP communication is used..\nWhen the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE, and the 5G ProSe layer-3 UE-to-UE relay UE receives PROSE DIRECT LINK MODIFICATION ACK message from the source 5G ProSe end UE which includes relay reselection indication, the 5G ProSe layer-3 UE-to-UE relay UE shall create a PROSE DIRECT LINK MODIFICATION ACK message. In this message, the 5G ProSe layer-3 UE-to-UE relay UE:\na)\tshall include the relay reselection indication, source end UE IP address for new relay IE set to the IP address of the source 5G ProSe layer-3 end UE to be used with the newly selected 5G ProSe layer-3 UE-to-UE relay UE, and source end UE IP address IE set to the IP address of the source 5G ProSe layer-3 end UE, if IP communication is used.\nUpon receiving PROSE DIRECT LINK MODIFICATION ACCEPT message, that includes relay reselection indication, if the PROSE DIRECT LINK MODIFICATION REQUEST message is for relay reselection, the initiating UE shall form the new KNRP ID from the MSBs of KNRP ID included in the PROSE DIRECT LINK MODIFICATION REQUEST message and the LSBs of KNRP ID received in the PROSE DIRECT LINK MODIFICATION ACCEPT message. The initiating UE shall replace the existing KNRP ID with the new KNRP ID. The initiating UE may include the new KNRP ID in PROSE DIRECT LINK ESTABLISHMENT REQUEST message with the target UE as specified in clause 7.2.2.2 when the initiating UE reconnects with the same target UE.\nAfter the PROSE DIRECT LINK MODIFICATION ACK message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for 5G ProSe direct communication and the target UE's layer-2 ID for 5G ProSe direct communication.\nIf the source UE acknowledges the 5G ProSe direct link modification accept, then the source UE starts to receive and/or transmit traffic via the newly selected 5G ProSe UE-to-UE relay UE.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION ACK message, the target layer-3 5G ProSe end UE starts to receive traffic, transmit traffic, or both, via the newly selected 5G ProSe UE-to-UE relay UE and shall stop T5096.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION ACK message, the layer-3 5G ProSe UE-to-UE relay UE shall stop T5096.\nIf the 5G ProSe direct link modification request cannot be accepted, the target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message. The PROSE DIRECT LINK MODIFICATION REJECT message contains a PC5 signalling protocol cause IE set to one of the following cause values:\n#5\tlack of resources for 5G ProSe direct link;\n#6\trequired service not allowed;\n#12\tsecurity policy not aligned;\n#16\tlack of local capabilities;\n#20\tFailure from 5G ProSe end UE;\n#yy\trelay UE is not selected for link setup with integrated discovery; or\n#111\tprotocol error, unspecified.\nIf the target UE is not allowed to accept this request, e.g., because the ProSe application to be added is not allowed per the operator policy or configuration parameters for ProSe communication over PC5 as specified in clause 5.2.4, the target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling protocol cause value #6 \"required service not allowed\".\nIf the target UE is a 5G ProSe layer-3 UE-to-network relay UE, the PDU session for relaying the service is an LADN PDU session and:\na)\tthe target UE is outside the LADN service area; or\nb)\tthe 5G ProSe direct link modification requires a PDU session modification procedure which fails due to reception of the 5GSM cause value #46 \"out of LADN service area\" in the PDU SESSION MODIFICATION REJECT message as specified in as specified in 3GPP TS 24.501 [11] clause 6.4.2.4.1;\nthe target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling protocol cause value #111 \"protocol error, unspecified\".\nIf the 5G ProSe direct link modification fails due to the congestion problems or other temporary lower layer problems causing resource constraints, the target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling protocol cause value #5 \"lack of resources for 5G ProSe direct link\".\nIf the target UE acting as a target 5G ProSe end UE, receives one or more direct link modification request or direct link establishment request for end-to-end connection setup with the source 5G ProSe end UE and integrated discovery is used, then the target UE shall select a 5G ProSe UE-to-UE relay UE and send a PROSE DIRECT LINK MODIFICATION REJECT message to the 5G ProSe UE-to-UE Relay which is not selected and which has sent the PROSE DIRECT LINK MODIFICATION REQUEST message, with PC5 signalling protocol cause value #yy \"relay UE is not selected for link setup with integrated discovery\".\nIf the link modification operation code is set to \"Associate new ProSe application(s) with existing PC5 QoS flow(s)\" and the security policy corresponding to the ProSe identifier(s) is not aligned with the security policy applied to the existing 5G ProSe direct link, then the target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling protocol cause value #12 \"security policy not aligned\".\nIf the link modification operation requires the addition of new PC5 QoS flow(s) but the target UE cannot support additional packet filters which would be required on the existing PDU session of the target UE, then the target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling protocol cause value #16\"lack of local capabilities\".\nIf the target UE is acting as a target 5G ProSe end UE and the 5G ProSe direct link modification procedure is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE, the target 5G ProSe end UE may include in the PROSE DIRECT LINK MODIFICATION REJECT message the source end UE info IE set to the user info ID of the source 5G ProSe end UE that has initiated the 5G ProSe direct link establishment procedure.\nIf the target UE is acting as a 5G ProSe UE-to-UE relay UE, the 5G ProSe direct link modification procedure is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the target 5G ProSe end UE has rejected the 5G ProSe direct link establishment procedure or the 5G ProSe direct link modification procedure, then the 5G ProSe UE-to-UE relay UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling protocol cause value #20 \"Failure from 5G ProSe end UE\" to the source 5G ProSe end UE. The 5G ProSe UE-to-UE relay UE may include in the PROSE DIRECT LINK MODIFICATION REJECT message the PC5 end UE failure cause IE set to the PC5 signalling protocol cause received from the target 5G ProSe end UE that has rejected the 5G ProSe direct link establishment procedure as specified in clause 7.2.2.5. The 5G ProSe UE-to-UE relay UE may include in the PROSE DIRECT LINK MODIFICATION REJECT message the target end UE info IE set to the user info ID of the target 5G ProSe end UE that has rejected the 5G ProSe direct link establishment procedure.\nFor other reasons causing the failure of link modification, the target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling protocol cause value #111 \"protocol error, unspecified\".\nUpon receipt of the PROSE DIRECT LINK MODIFICATION REJECT message, the initiating UE shall stop timer T5081 and abort the 5G ProSe direct link modification procedure. If the PC5 signalling protocol cause value in the PROSE DIRECT LINK MODIFICATION REJECT message is #11 \"required service not allowed\" or #5 \"lack of resources for 5G ProSe direct link\" or #12 \"security policy not aligned\", then the initiating UE shall not attempt to start 5G ProSe direct link modification with the same target UE to add the same ProSe application, or to add or modify the same PC5 QoS flow(s) at least for a time period T.\nNOTE:\tThe length of time period T is UE implementation specific and can be different for the case when the UE receives PC5 signalling protocol cause value #11 \"required service not allowed\" or when the UE receives PC5 signalling protocol cause value #5 \"lack of resources for 5G ProSe direct link\" or when the UE receives PC5 signalling protocol cause value #12 \"security policy not aligned\". The length of time period T is not less than 30 minutes.\nThe following abnormal cases can be identified:\na)\tIf timer T5081 expires, the initiating UE shall retransmit the PROSE DIRECT LINK MODIFICATION REQUEST message and restart timer T5081. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe direct link modification procedure and may notify the upper layer that the target UE is unreachable.\nNOTE 1:\tThe maximum number of allowed retransmissions is UE implementation specific.\nNOTE 2:\tAfter reaching the maximum number of allowed retransmissions, whether the initiating UE releases this 5G ProSe direct link depends on its implementation.\nb)\tFor the same 5G ProSe direct link, if the initiating UE receives a PROSE DIRECT LINK RELEASE REQUEST message after the initiation of UE-requested 5G ProSe direct link modification procedure, the initiating UE shall stop the timer T5081 and abort the 5G ProSe direct link modification procedure and proceed with the 5G ProSe direct link release procedure.\nc)\tFor the same 5G ProSe direct link, if the initiating UE receives a PROSE DIRECT LINK MODIFICATION REQUEST message during the 5G ProSe direct link modification procedure, the initiating UE shall stop the timer T5081 and abort the 5G ProSe direct link modification procedure. Following handling is implementation dependent, e.g., the initiating UE waits for an implementation dependent time for initiating a new 5G ProSe direct link modification procedure, if still needed.\nNOTE 3:\tThe implementation dependent timer value needs to be set to avoid further collisions (e.g., random timer value).\nThe following abnormal cases can be identified:\na)\tFor the same 5G ProSe direct link, if the target UE receives a PROSE DIRECT LINK RELEASE REQUEST message during the 5G ProSe direct link modification procedure, the target UE shall stop all running timers for this 5G ProSe direct link, abort the 5G ProSe direct link modification procedure and proceed with the 5G ProSe direct link release procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.4\t5G ProSe direct link identifier update procedure",
                            "text_content": "The 5G ProSe direct link identifier update procedure is used to update and exchange the new identifiers (e.g., application layer ID, layer-2 ID, security information and IP address/prefix) between two UEs for a 5G ProSe direct link before using the new identifiers. The UE sending the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message is called the “initiating UE” and the other UE is called the “target UE”.\nThe initiating UE shall initiate the procedure if:\na)\tthe initiating UE receives a request from upper layers to change the application layer ID and there is an existing 5G ProSe direct link associated with this application layer ID; or\nb)\tthe privacy timer (see clause 5.2.4) of the initiating UE’s layer-2 ID expires for an existing 5G ProSe direct link.\nThe initiating UE shall meet the following pre-conditions before initiating this procedure:\na)\tthe timer T5091 is not running; and\nb)\tthe initiating UE is not performing the 5G ProSe direct link re-keying procedure initiated by the target UE.\nIf the 5G ProSe direct link identifier update procedure is triggered by a change of the initiating UE’s application layer ID, the initiating UE shall create a PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message. In this message, the initiating UE:\na)\tshall include the initiating UE’s new application layer ID received from upper layer;\nb)\tshall include the initiating UE’s new layer-2 ID assigned by itself;\nc)\tshall include the new MSB of KNRP-sess ID;\nd)\tshall include the new IP address/prefix if IP communication is used and the 5G ProSe direct link is not for 5G ProSe direct communication between 5G ProSe layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay UE and the target UE is not a 5G ProSe layer-3 UE-to-UE relay UE;\ne) \tshall include the new IP address/prefix, if IP communication is used, IP address/prefix needs to be changed, the target UE is a 5G ProSe layer-3 UE-to-UE relay UE and IP address/prefix of the initiating UE is allocated by the initiating UE;\nf) shall include the IP address/prefix needed indication if IP communication is used, the target UE is a 5G ProSe layer-3 UE-to-UE relay UE, and IP address/prefix of the initiating UE needs to be changed and is allocated by the 5G ProSe UE-to-UE relay UE; and\ng) shall include the list of target end UE IP address/prefix (i.e. application layer ID(s) and IP address(es)/prefix(es)), if IP communication is used, the initiating UE’s IP address/prefix needs to be changed, and the target UE is a 5G ProSe layer-3 UE-to-UE relay UE;\nIf the 5G ProSe direct link identifier update procedure is triggered by the expiry of the initiating UE's privacy timer T5090 as specified in clause 5.2.4 and clause 5.2.5, the initiating UE shall create a PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message. In this message, the initiating UE:\na)\tshall include the initiating UE's new layer-2 ID assigned by itself;\nb)\tshall include the new MSB of KNRP-sess ID;\nc)\tmay include the initiating UE's new application layer ID if received from upper layer;\nd)\tshall include the new IP address/prefix if IP communication is used and changed, and the 5G ProSe direct link is not for 5G ProSe direct communication between 5G ProSe layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay UE and the target UE is not a 5G ProSe layer-3 UE-to-UE relay UE;\ne) \tshall include the new IP address/prefix if IP communication is used, IP address/prefix needs to be changed, the target UE is a 5G ProSe layer-3 UE-to-UE relay UE and IP address/prefix of the initiating UE is allocated by the initiating UE;\nf)  shall include the IP address/prefix needed indication if IP communication is used, IP address/prefix shall be changed and the target UE is a 5G ProSe layer-3 UE-to-UE relay UE and IP address/prefix of the initiating UE is allocated by the 5G ProSe layer-3 UE-to-UE relay UE; and\ng) shall include the list of target end UE IP address/prefix (i.e. application layer ID and IP address/prefix) if IP communication is used, IP address/prefix shall be changed and the target UE is a 5G ProSe layer-3 UE-to-UE relay UE.\nAfter the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's old layer-2 ID for 5G ProSe direct communication and the target UE's layer-2 ID for 5G ProSe direct communication and start timer T5082. The UE shall not send a new PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message to the same target UE while timer T5082 is running.\nThe figure depicts a 5G ProSe direct link identifier update procedure, illustrating the steps involved in updating the direct link identifier in a 5G network. The figure shows the various components and their connections, including the base station (gNB), user equipment (UE), and the network slicing (NS). The update procedure is shown in a step-by-step manner, highlighting the importance of maintaining the direct link identifier for network performance and security.\nFigure 7.2.4.2.1: 5G ProSe direct link identifier update procedure\nUpon receipt of a PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message, if the target UE determines:\na)\tthe 5G ProSe direct link associated with this request message is still valid; and\nb)\tthe timer T5083 for the 5G ProSe direct link identified by this request message is not running,\nthen the target UE accepts this request and responds with a PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message.\nIf the target UE is a 5G ProSe layer-3 UE-to-UE relay UE and IP address/prefix needed indication is received from the initiating UE, the 5G ProSe layer-3 UE-to-UE relay UE assigns a new IP address/prefix to the initiating UE.\nIf the target UE is a 5G ProSe layer-3 UE-to-UE relay UE, the 5G ProSe layer-3 UE-to-UE relay UE may initiate the 5G ProSe UE to UE relay update procedure as specified in clause 7.2.13.\nThe target UE shall create the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message. In this message, the target UE:\na)\tshall include the target UE's new layer-2 ID assigned by itself;\nb)\tshall include the new LSB of KNRP-sess ID;\nc)\tshall include the initiating UE's new MSB of KNRP-sess ID;\nd)\tshall include the initiating UE's new layer-2 ID;\ne)\tshall include the target UE's new application layer ID if received from upper layer;\nf)\tshall include the initiating UE's new IP address/prefix if received from the initiating UE and IP communication is used or if IP address/prefix needed indication is received from the initiating UE and IP communication is used;\ng)\tshall include the initiating UE's new application layer ID if received from the initiating UE; and\nh)\tshall include the target UE's new IP address/prefix if IP communication is used and changed and the 5G ProSe direct link is not for 5G ProSe direct communication between 5G ProSe layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay UE.\nAfter the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message is generated, the target UE shall pass this message to the lower layers for transmission along with the initiating UE's old layer-2 ID for 5G ProSe direct communication and the target UE's old layer-2 ID for 5G ProSe direct communication and start timer T5083. The UE shall not send a new PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message to the same initiating UE while timer T5083 is running.\nBefore target UE receives the traffic using the new layer-2 IDs, the target UE shall continue to receive the traffic with the old layer-2 IDs (i.e., initiating UE's old layer-2 ID and target UE's old layer-2 ID) from initiating UE.\nBefore target UE receives the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message from initiating UE, the target UE shall keep sending traffic to the initiating UE using the old layer-2 IDs (i.e., initiating UE's old layer-2 ID for 5G ProSe direct communication and target UE's old layer-2 ID for 5G ProSe direct communication).\nUpon receipt of the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message, the initiating UE shall save its new IP address/prefix if received on the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message, shall stop timer T5082 and respond with a PROSE DIRECT LINK IDENTIFIER UPDATE ACK message. In this message, the initiating UE:\na)\tshall include the target UE's new layer-2 ID;\nb)\tshall include the target UE's new LSB of KNRP-sess ID;\nc)\tshall include the target UE's new application layer ID, if received;\nd)\tshall include the target UE's new IP address/prefix, if received; and\ne)\tshall include the initiating UE's new IP address/prefix, if received on the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message.\nAfter the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's old layer-2 ID for 5G ProSe direct communication and the target UE's old layer-2 ID for 5G ProSe direct communication and shall stop timer T5090 if running and start a timer T5090 as configured if at least one of ProSe identifiers for the 5G ProSe direct link satisfying the privacy requirements as specified in clause 5.2.4 or if satisfying the privacy requirements as specified in clause 5.2.5.\nUpon sending the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message, the initiating UE shall update the associated 5G ProSe direct link context with the new identifiers and pass the new layer-2 IDs (i.e., initiating UE's new layer-2 ID for 5G ProSe direct communication and target UE's new layer-2 ID for 5G ProSe direct communication) along with the PC5 link identifier down to the lower layer. Then the initiating UE shall use the new layer-2 IDs (i.e., initiating UE's new layer-2 ID for 5G ProSe direct communication and target UE's new layer-2 ID for 5G ProSe direct communication) to transmit the PC5 signalling message and PC5 user plane data.\nThe initiating UE shall continue to receive traffic with the old layer-2 IDs (i.e., initiating UE's old layer-2 ID for 5G ProSe direct communication and target UE's old layer-2 ID for 5G ProSe direct communication) from the target UE until it receives traffic with the new layer-2 IDs (i.e., initiating UE's new layer-2 ID and target UE's new layer-2 ID) from the target UE.\nUpon receipt of the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message, the target UE shall update the associated 5G ProSe direct link context with the new identifiers, pass the new layer-2 IDs (i.e., initiating UE's new layer-2 ID and target UE's new layer-2 ID) down to the lower layer, stop timer T5083 and timer T5090 if running and start a timer T5090 as configured if at least one of ProSe identifiers for the 5G ProSe direct link satisfying the privacy requirements as specified in clause 5.2.4 or if satisfying the privacy requirements as specified in clause 5.2.5. Then the target UE shall use the new layer-2 IDs (i.e., initiating UE's new layer-2 ID for 5G ProSe direct communication and target UE's new layer-2 ID for 5G ProSe direct communication) to transmit the PC5 signalling message and PC5 user plane data.\nIf the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message cannot be accepted, the target UE shall send a PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message. The PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message contains a PC5 signalling protocol cause IE set to one of the following cause values:\n#3\tconflict of layer-2 ID for 5G ProSe direct communication is detected;\n#y unknown target UE’s IP address/prefix or target UE’s Application layer ID; or\n#111\tprotocol error, unspecified.\nFor a received PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message from a layer-2 ID (for 5G ProSe direct communication), if the target UE already has an existing link using this layer-2 ID or is currently processing a PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message from the same layer-2 ID, but with user info different from the user info IE included in this new incoming message, the target UE shall send a PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message with PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for 5G ProSe direct communication is detected\".\nNOTE:\tAfter receiving the PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message, whether the initiating UE initiates the 5G ProSe direct link release procedure or initiates another 5G ProSe direct link identifier update procedure with a new layer-2 ID depends on UE implementation.\nFor a received PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message from a source 5G ProSe end UE, if the target UE is a 5G ProSe layer-3 UE-to-UE relay UE and receives the PC5 signalling protocol cause value #x \"unknown initiating end UE's IP address/prefix or initiating UE's Application layer ID\" from the target 5G ProSe end UE in the PROSE UE TO UE RELAY UPDATE REJECT message as specified in clause 7.2.13.5, the target UE sends a PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message with PC5 signalling protocol cause value #y \"unknown target UE's IP address/prefix or target UE's Application layer ID\".\nFor other reasons causing the failure of link identifier update, the target UE shall send a PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message with PC5 signalling protocol cause value #111 \"protocol error, unspecified\".\nUpon receipt of the PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message, the initiating UE shall stop timer T5082 and abort this 5G ProSe direct link identifier update procedure.\nThe following abnormal cases can be identified:\na)\tIf timer T5082 expires, the initiating UE shall retransmit the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message and restart timer T5082. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe direct link identifier update procedure and may notify the upper layer that the target UE is unreachable.\nNOTE 1:\tThe maximum number of allowed retransmissions is UE implementation specific.\nNOTE 2:\tAfter reaching the maximum number of allowed retransmissions, whether the initiating UE releases this 5G ProSe direct link depends on its implementation.\nb)\tFor the same 5G ProSe direct link, if the initiating UE receives a PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message during the 5G ProSe direct link identifier update procedure, the initiating UE shall stop the timer T5082 and abort the 5G ProSe direct link identifier update procedure. Following handling is implementation dependent, e.g., the initiating UE waits for an implementation dependent time for initiating a new 5G ProSe direct link identifier update procedure, if still needed.\nNOTE 3:\tThe implementation dependent timer value needs to be set to avoid further collisions (e.g., random timer value).\nc)\tFor the same 5G ProSe direct link, if the initiating UE receives a PROSE DIRECT LINK REKEYING REQUEST message after initiating the 5G ProSe direct link identifier update procedure, the initiating UE shall ignore the PROSE DIRECT LINK REKEYING REQUEST message and proceed with the 5G ProSe direct link identifier update procedure.\nd)\tFor the same 5G ProSe direct link, if the initiating UE receives a PROSE DIRECT LINK RELEASE REQUEST message after the initiation of 5G ProSe direct link identifier update procedure, the initiating UE shall stop the timer T5082 and abort the 5G ProSe direct link identifier update procedure and proceed with the 5G ProSe direct link release procedure.\ne)\tAfter sending the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message to the target UE, if another PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message from the target UE is received before the traffic from the target UE with the new layer-2 IDs is received, the initiating UE shall retransmit the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message along with the initiating UE's old layer-2 ID and the target UE's old layer-2 ID.\nNOTE 4:\tIt is up to implementation to handle the failure of traffic delivery for new layer-2 IDs if such traffic has been sent before the initiating UE retransmits the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message.\nf)\tAfter sending the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message to the target UE, if the initiating UE keeps receiving traffic from the target UE with the old layer-2 IDs and traffic from the target UE with the new layer-2 IDs is not received during an implementation specific time which is greater than the value of timer T5083, the initiating UE shall abort the 5G ProSe direct link identifier update procedure and may release the 5G ProSe direct link.\nThe following abnormal cases can be identified:\na)\tIf timer T5083 expires, the target UE shall retransmit the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message and restart timer T5083. After reaching the maximum number of allowed retransmissions, the target UE shall abort the 5G ProSe direct link identifier update procedure and may notify the upper layer that the initiating UE is unreachable.\nNOTE 1:\tThe maximum number of allowed retransmissions is UE implementation specific.\nNOTE 2:\tAfter reaching the maximum number of allowed retransmissions, whether the target UE releases this 5G ProSe direct link depends on its implementation.\nb)\tIf PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST is received when the timer T5083 is running, the target UE shall stop the timer T5083 and abort the ongoing 5G ProSe direct link identifier update procedure. The target UE shall handle the new PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST as specified in clause 7.2.4.3.\nc)\tFor the same 5G ProSe direct link, if the target UE receives a PROSE DIRECT LINK RELEASE REQUEST message during the 5G ProSe direct link identifier update procedure, the target UE shall stop the timer T5083,  abort the 5G ProSe direct link identifier update procedure and proceed with the 5G ProSe direct link release procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.5\t5G ProSe direct link keep-alive procedure",
                            "text_content": "The 5G ProSe direct link keep-alive procedure is used to maintain a 5G ProSe direct link between two UEs, i.e., check that the link between the two UEs is still valid. The UE sending the PROSE DIRECT LINK KEEPALIVE REQUEST message is called the \"initiating UE\" and the other UE is called the \"target UE\".\nThe 5G ProSe direct link keep-alive procedure can be initiated by only one UE or both UEs in the established 5G ProSe direct link.\nNOTE:\tWhether the 5G ProSe direct link keep-alive procedure is initiated by only one UE or both UEs in the established 5G ProSe direct link is UE implementation specific.\nThe initiating UE shall meet the following pre-condition before initiating the 5G ProSe direct link keep-alive procedure:\na)\tthere is a 5G ProSe direct link between the initiating UE and the target UE.\nThe initiating UE shall manage a keep-alive timer T5084 and a keep-alive counter for the 5G ProSe direct link keep-alive procedure. Timer T5084 is used to trigger the periodic initiation of the 5G ProSe direct link keep-alive procedure. The UE shall start or restart timer T5084 whenever the UE receives a PC5 signalling message or PC5 user plane data from the target UE over this 5G ProSe direct link. The UE shall set the keep-alive counter to an initial value of zero after 5G ProSe direct link establishment.\nThe initiating UE shall initiate the 5G ProSe direct link keep-alive procedure when:\na)\ttimer T5084 for this link expires;\nb)\toptionally, a request from the lower layers to check the viability of the 5G ProSe direct link is received; or\nNOTE 1:\tWhether the lower layers can request the initiation of the 5G ProSe direct link keep-alive procedure and what the triggers for the lower layers are to request the initiation of the 5G ProSe direct link keep-alive procedure, are UE implementation specific.\nc)\toptionally, a request from the upper layers to check the viability of the 5G ProSe direct link is received.\nNOTE 2:\tWhether the upper layers can request the initiation of the 5G ProSe direct link keep-alive procedure and what the triggers for the upper layers are to request the initiation of the 5G ProSe direct link keep-alive procedure, are UE implementation specific.\nIn order to initiate the 5G ProSe direct link keep-alive procedure, the initiating UE shall stop timer T5084, if running and shall create a PROSE DIRECT LINK KEEPALIVE REQUEST message. In this message, the initiating UE:\na)\tshall include the keep-alive counter for the 5G ProSe direct link; and\nb)\tmay include a maximum inactivity period to indicate the maximum inactivity period of the initiating UE over this 5G ProSe direct link.\nNOTE 3:\tThe value chosen for the maximum inactivity period of the initiating UE is UE implementation specific with the objective to minimize the number of keep-alive procedures as much as possible. It is desirable to have the maximum inactivity period value to be slightly higher than the value of keep-alive timer T5084.\nAfter the PROSE DIRECT LINK KEEPALIVE REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for 5G ProSe direct communication and the target UE's layer-2 ID for 5G ProSe direct communication and start timer T5085. The UE shall not send a new PROSE DIRECT LINK KEEPALIVE REQUEST message to the same target UE while timer T5085 is running.\nThe figure depicts a 5G ProSe direct link keep-alive procedure, illustrating the steps involved in maintaining a direct link between two 5G base stations (BSs) in a network. The figure shows the network topology, including the two BSs, the direct link, and the keep-alive procedure. Key components include the network controller (NC), the network management system (NMS), and the network slicing (NS). The figure highlights the importance of network slicing in ensuring efficient and reliable network performance.\nFigure 7.2.5.2.1: 5G ProSe direct link keep-alive procedure\nUpon receipt of a PROSE DIRECT LINK KEEPALIVE REQUEST message, the target UE shall create a PROSE DIRECT LINK KEEPALIVE RESPONSE message. In this message, the target UE:\na)\tshall include the keep-alive counter set to the same value as that received in the PROSE DIRECT LINK KEEPALIVE REQUEST message.\nAfter the PROSE DIRECT LINK KEEPALIVE RESPONSE message is generated, the target UE shall pass this message to the lower layers for transmission along with the target UE's layer-2 ID for 5G ProSe direct communication and the initiating UE's layer-2 ID for 5G ProSe direct communication.\nIf a maximum inactivity period is included in the PROSE DIRECT LINK KEEPALIVE REQUEST message, the target UE shall stop T5086, if running and start T5086 with its value set to the maximum inactivity period. The target UE shall restart T5086 whenever the target UE receives a PC5 signalling message or PC5 user plane data from the initiating UE over this 5G ProSe direct link.\nUpon receipt of a PROSE DIRECT LINK KEEPALIVE RESPONSE message, the initiating UE shall stop timer T5085, start timer T5084 and increment the keep-alive counter for the 5G ProSe direct link.\na)\tTimer T5085 expires.\nThe initiating UE shall retransmit the PROSE DIRECT LINK KEEPALIVE REQUEST message with the last used value of the keep-alive counter and restart timer T5085. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe direct link keep-alive procedure and locally release the 5G ProSe direct link.\nNOTE:\tThe maximum number of allowed retransmissions is UE implementation specific.\nb)\tThe need to use this 5G ProSe direct link no longer exists before the 5G ProSe direct link keep-alive procedure is completed.\nThe initiating UE shall abort the 5G ProSe direct link keep-alive procedure and initiate a 5G ProSe direct link release procedure.\nc)\tThe initiating UE receives a PROSE DIRECT LINK KEEPALIVE RESPONSE message with a keep-alive counter value different from the value which the initiating UE had included in the last sent PROSE DIRECT LINK KEEPALIVE REQUEST message.\nThe initiating UE shall discard the PROSE DIRECT LINK KEEPALIVE RESPONSE message.\nd)\tThe initiating UE receives a PC5 signalling message other than a PROSE DIRECT LINK KEEPALIVE RESPONSE message or PC5 user plane data from the target UE over this 5G ProSe direct link while timer T5085 is running.\nThe initiating UE shall stop timer T5085, abort the 5G ProSe direct link keep-alive procedure, start timer T5084 and increment the keep-alive counter for the 5G ProSe direct link.\ne)\tThe initiating UE receives a PROSE DIRECT LINK KEEPALIVE RESPONSE message when T5085 is not running.\nThe initiating UE shall discard the PROSE DIRECT LINK KEEPALIVE RESPONSE message.\na)\tTimer T5086 expires.\nThe target UE shall:\n1)\tinitiate a 5G ProSe direct link keep-alive procedure to check the link; or\n2)\tinitiate the 5G ProSe direct link release procedure.\nWhether the UE chooses 1) or 2) is left to UE implementation.\nb)\tThe target UE receives a PROSE DIRECT LINK KEEPALIVE REQUEST message with a keep-alive counter value lower than the value which the target UE had included in the last sent PROSE DIRECT LINK KEEPALIVE RESPONSE message.\nThe target UE shall discard the PROSE DIRECT LINK KEEPALIVE REQUEST message.\nc)\tThe target UE receives a PROSE DIRECT LINK KEEPALIVE REQUEST message if there is a pending PC5 signalling message or PC5 user plane data to be sent to the initiating UE over this 5G ProSe direct link.\nThe target UE:\n1)\tshall pass this PC5 signalling message to the lower layers for transmission along with the target UE's layer-2 ID for 5G ProSe direct communication and the initiating UE's layer-2 ID for 5G ProSe direct communication, or perform the data transmission over 5G ProSe direct link as specified in clause 7.2.9; and\n2)\tshall consider transmission of this PC5 signalling message or PC5 user plane data to be an implicit PROSE DIRECT LINK KEEPALIVE RESPONSE message and skip generating a PROSE DIRECT LINK KEEPALIVE RESPONSE message. If a maximum inactivity period is included in the PROSE DIRECT LINK KEEPALIVE REQUEST message, the target UE shall stop T5086, if running and start T5086 with its value set to the maximum inactivity period.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.6\t5G ProSe direct link release procedure",
                            "text_content": "The 5G ProSe direct link release procedure is used to release a secure 5G ProSe direct link between two UEs. The link can be released from either end point. The UE sending the PROSE DIRECT LINK RELEASE REQUEST message is called the \"initiating UE\" and the other UE is called the \"target UE\".\nIf the UE receives an indication of radio link failure or an indication of PC5-RRC connection release from the lower layer, the UE shall release the 5G ProSe direct link locally and may delete the KNRP ID associated with this link after an implementation specific time. If the UE acting as 5G ProSe layer-2 UE-to-network relay UE or 5G ProSe layer-2 remote UE receives a request of 5G ProSe direct link release from the lower layer as specified in 3GPP TS 38.331 [13], the UE shall initiate the 5G ProSe direct link release procedure.\nWhen the direct link between a 5G ProSe remote UE and a 5G ProSe UE-to-network relay UE is released, the 5G ProSe layer-3 UE-to-network relay UE shall perform the remote UE report procedure as specified in 3GPP TS 24.501 [11].\nThe initiating UE shall initiate the procedure if a request from upper layers to release a 5G ProSe direct link with the target UE which uses a known layer-2 ID (for unicast communication) is received and there is an existing 5G ProSe direct link between these two UEs.\nThe initiating UE may initiate the procedure if the target UE has been non-responsive, e.g., no response in the 5G ProSe direct link modification procedure, 5G ProSe direct link identifier update procedure, 5G ProSe direct link re-keying procedure or 5G ProSe direct link keep-alive procedure.\nThe initiating UE may initiate the procedure to release an established 5G ProSe direct link if the UE has reached the maximum number of established 5G ProSe direct links and there is a need to establish a new 5G ProSe direct link. In this case, which 5G ProSe direct link is to be released is up to UE implementation.\nThe initiating UE may initiate the procedure to release an established 5G ProSe direct link upon expiry of the timer T5084.\nIf:\na)\tthe initiating UE acts as 5G ProSe layer-3 UE-to-network relay UE; and\nb)\tthe PDU session established for relaying the traffic of the target UE is released by the initiating UE or the network as specified in 3GPP TS 24.501 [11] clause 6.3.3 or clause 6.4.3;\nthe initiating UE should initiate the 5G ProSe direct link release procedure.\nIf the initiating UE which is acting as 5G ProSe layer-3 UE-to-network relay UE establishes a new PDU session after receiving 5GSM cause value #39 \"reactivation requested\" as specified in 3GPP TS 24.501 [11] clause 6.3.2.3, the UE may initiate the 5G ProSe direct link release procedure.\nIf the initiating UE is a 5G ProSe layer-3 UE-to-network relay UE, the PDU session for relaying the service is an LADN PDU session and:\na)\tthe UE is outside the LADN service area; or\nb)\tthe UE receives the 5GSM cause value #46 \"out of LADN service area\" in the PDU SESSION MODIFICATION REJECT message as specified in as specified in 3GPP TS 24.501 [11] clause 6.4.2.4.1;\nand there is at least one 5G ProSe layer-3 remote UE which is served on the PDU session, then the UE should initiate the 5G ProSe direct link release procedure.\nIf:\na)\tthe initiating UE acts as 5G ProSe layer-2 remote UE or 5G ProSe layer-3 remote UE for relay with N3IWF support; and\nb)\tthe initiating UE is in 5GMM-IDLE mode;\nthe initiating UE may initiate the 5G ProSe direct link release procedure.\nIf:\na)\tthe initiating UE acts as 5G ProSe layer-2 remote UE, 5G ProSe layer-3 remote UE or 5G ProSe layer-2 UE-to-network relay UE; and\nb)\tthe service authorization for the initiating UE to act as 5G ProSe layer-2 remote UE, 5G ProSe layer-3 remote UE or 5G ProSe layer-2 UE-to-network relay UE is revoked after receiving the configuration parameters for 5G ProSe UE-to-network relay as specified in clause 5.2.5;\nthe initiating UE should initiate the 5G ProSe direct link release procedure.\nIf:\na)\tthe initiating UE acts as 5G ProSe layer-3 UE-to-network relay UE; and\nb)\tthe service authorization for the initiating UE to act as 5G ProSe layer-3 UE-to-network relay UE in the serving PLMN is revoked after receiving the configuration parameters for 5G ProSe UE-to-network relay as specified in clause 5.2.5;\nthe initiating UE should initiate the 5G ProSe direct link release procedure, and the initiating UE releases the PDU session established for relaying the traffic of the target UE as specified in 3GPP TS 24.501 [11] clause 6.4.3.\nIf:\na)\tthe initiating UE acts as 5G ProSe layer-3 UE-to-network relay UE;\nb)\tthe 5G ProSe direct link was established with an RSC that is specific for emergency services; and\nc)\tthe initiating UE becomes involved into its own emergency services as specified in 3GPP TS 24.501 [11] and the initiating UE decides to prioritize its own emergency services due to local regulations or implementation specific requirements;\nthe initiating UE shall initiate the 5G ProSe direct link release procedure, and the initiating UE releases the PDU session established for relaying the traffic of the target UE as specified in 3GPP TS 24.501 [11] clause 6.4.3.\nIf:\na)\tthe initiating UE acts as 5G ProSe end UE or 5G ProSe UE-to-UE relay UE; and\nb)\tthe service authorization for the initiating UE to act as 5G ProSe end UE or 5G ProSe UE-to-UE relay UE is revoked after receiving the configuration parameters for 5G ProSe UE-to-UE relay as specified in clause 5.2.7;\nthe initiating UE should initiate the 5G ProSe direct link release procedure.\nIf:\na)\tthe initiating UE is acting as a 5G ProSe layer-3 UE-to-UE relay UE;\nb)\tthe direct link that is between a 5G ProSe layer-3 end UE and the initiating UE has been released; and\nc)\tthere are one or more direct links between the initiating UE and the peer 5G ProSe layer-3 end UEs that have PC5 QoS flow(s) only for the communication with the 5G ProSe layer-3 end UE;\nthe initiating UE may initiate the 5G ProSe direct link release procedure toward the peer 5G ProSe layer-3 end UEs.\nIf:\na)\tthe initiating UE is acting as a 5G ProSe layer-3 UE-to-UE relay UE;\nb)\ta PROSE DIRECT LINK MODIFICATION REQUEST message is received from a 5G ProSe layer-3 end UE to release 5G ProSe UE-to-UE relay communication with one of the peer 5G ProSe layer-3 end UEs; and\nc)\tthe direct link between the initiating UE and the target peer 5G ProSe layer-3 end UE have PC5 QoS flow(s) only for the communication with the 5G ProSe layer-3 end UE;\nthe initiating UE may initiate the 5G ProSe direct link release procedure toward the target peer 5G ProSe layer-3 end UE.\nIn order to initiate the 5G ProSe direct link release procedure, the initiating UE shall create a PROSE DIRECT LINK RELEASE REQUEST message with a PC5 signalling protocol cause IE indicating one of the following cause values:\n#1\tdirect communication to the target UE not allowed;\n#2\tdirect communication to the target UE no longer needed;\n#4\tdirect connection is not available anymore;\n#5\tlack of resources for 5G ProSe direct link;\n#13\tcongestion situation;\n#20\tFailure from 5G ProSe end UE; or\n#111\tprotocol error, unspecified.\nIf the 5G ProSe direct link was established for 5G ProSe UE-to-network relay and:\na)\tthe NAS level mobility management congestion control as specified in clause 5.3.9 of TS 24.501 [11] is activated at the initiating UE acting as a 5G ProSe UE-to-network relay UE; or\nb)\tthe initiating UE acting as a 5G ProSe UE-to-network relay UE is under congestion;\nthe initiating UE shall send a PROSE DIRECT LINK RELEASE REQUEST message containing PC5 signalling protocol cause value #13 \"congestion situation\". The initiating UE may provide a back-off timer value to the target UE in the PROSE DIRECT LINK RELEASE REQUEST message. The initiating UE shall not accept any 5G ProSe direct link establishment request for 5G ProSe UE-to-network relaying if the back-off timer NAS level mobility management congestion control is running.\nIf the 5G ProSe direct link was established for 5G ProSe UE-to-UE relay and:\na)\tthe initiating UE acting as a 5G ProSe UE-to-UE relay UE is under congestion;\nthe initiating UE shall send a PROSE DIRECT LINK RELEASE REQUEST message containing PC5 signalling protocol cause value #13 \"congestion situation\". The initiating UE may provide a back-off timer value to the target UE in the PROSE DIRECT LINK RELEASE REQUEST message.\nNOTE 1:\tHow the initiating UE determines that it is under congestion is implementation specific (e.g., any relaying related operational overhead, etc).\nNOTE 2:\tIn case the initiating UE is under the NAS level mobility management congestion control, it is an implementation option that the provided back-off timer value to the target UE is set to the mobility management back-off timer T3346 or with an additional offset value.\nIf the 5G ProSe direct link was established by the initiating UE which is a 5G ProSe layer-2 remote UE, and the NAS level mobility management congestion control as specified in clause 5.3.9 of 3GPP TS 24.501 [11] is activated at the initiating UE, then the initiating UE shall send a PROSE DIRECT LINK RELEASE REQUEST message containing PC5 signalling protocol cause value #13 \"congestion situation\".\nIf:\na)\tthe initiating UE is acting as a 5G ProSe layer-3 end UE;\nb)\tthe direct link is between the initiating UE and a 5G ProSe layer-3 UE-to-UE relay UE; and\nc)\tthe communication between the initiating UE and the peer 5G ProSe layer-3 end UE is no longer available;\nthe initiating UE shall send a PROSE DIRECT LINK RELEASE REQUEST message containing PC5 signalling protocol cause value #2 \"direct communication to the target UE no longer needed\".\nIf the initiating UE:\na)\tis no longer allowed to maintain the 5G ProSe direct link, e.g., based on operator policy or configuration parameters for ProSe direct communication over PC5 as specified in clause 5.2; or\nb)\tthe initiating UE acting as a 5G ProSe layer-3 UE-to-network relay UE decides to prioritize its own emergency services due to local regulations or implementation specific requirements, and the 5G ProSe direct link was established with an RSC that is specific for emergency services;\nthe initiating UE shall send a PROSE DIRECT LINK RELEASE REQUEST message containing PC5 signalling protocol cause value #1 \"direct communication to the target UE not allowed\".\nIf the initiating UE is acting as a 5G ProSe layer-3 UE-to-UE relay UE and decides to release the 5G ProSe direct link with a 5G ProSe layer-3 end UE because the direct link between the peer 5G ProSe layer-3 end UE and the initiating UE has been released by the peer UE, the initiating UE shall send a PROSE DIRECT LINK RELEASE REQUEST message containing PC5 signalling protocol cause value #20 \"Failure from 5G ProSe end UE\" to the 5G ProSe layer-3 end UE. The initiating UE may include in the PROSE DIRECT LINK RELEASE REQUEST message the PC5 end UE release cause IE set to the PC5 signalling protocol cause received from the peer UE that has released the 5G ProSe direct link.\nThe initiating UE shall include the new 2 MSBs of KNRP ID in the PROSE DIRECT LINK RELEASE REQUEST message.\nAfter the PROSE DIRECT LINK RELEASE REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication and shall stop T5090 if running. The initiating UE shall start timer T5087.\nThe figure depicts a 5G ProSe direct link release procedure, illustrating the steps involved in releasing a direct link between two 5G base stations (BSs) in a network. The figure shows the release process from the perspective of the network operator, with the release point (R) marked as a red dot, and the release path (L) marked as a dashed line. The release procedure includes the following steps: \n\n1. **Release Point (R)**: The release point is marked as a red dot, indicating the location where the direct link is to be released.\n2. **Release Path (L)**: The release path is marked as a dashed line, showing the path that the direct link will take from the release point to the destination BS.\n3. **Release Procedure (P)**: The release procedure is shown as a sequence of steps, with each step marked as a separate red dot. These steps include:\n   - **Release Request (R)**: The release request is sent to the network control center (NCC) for approval.\n   - **Release Approval (A)**: The NCC reviews the release request and approves or denies the release.\n   - **Release Confirmation (C)\nFigure 7.2.6.2.1: 5G ProSe direct link release procedure\nUpon receiving a PROSE DIRECT LINK RELEASE REQUEST message, the target UE shall stop all running timers for this 5G ProSe direct link and abort any other ongoing PC5 signalling protocol procedures on this 5G ProSe direct link.\nIf the PC5 signalling protocol cause value in the PROSE DIRECT LINK RELEASE REQUEST message is #13 \"congestion situation\" and a back-off timer value is provided in the PROSE DIRECT LINK RELEASE REQUEST message, the target UE shall start timer T5088 associated with the layer-2 ID of the initiating UE and set its value to the provided timer value.\nThe target UE shall respond with a PROSE DIRECT LINK RELEASE ACCEPT message. The target UE shall include the new 2 LSBs of KNRP ID in the PROSE DIRECT LINK RELEASE ACCEPT message. After the message is sent, the target UE shall release the 5G ProSe direct link by performing the following behaviours:\na)\tinform the lower layer along with the PC5 link identifier that the 5G ProSe direct link has been released; and\nb)\tdelete the 5G ProSe direct link context of the 5G ProSe direct link after an implementation specific time.\nThe target UE shall form the new KNRP ID from the new MSBs of KNRP ID received in the PROSE DIRECT LINK RELEASE REQUEST message and the new LSBs of KNRP ID included in the PROSE DIRECT LINK RELEASE ACCEPT message. The target UE shall replace the existing KNRP ID with the new KNRP ID. The target UE may include the new KNRP ID in PROSE DIRECT LINK ESTABLISHMENT REQUEST message with the initiating UE as specified in clause 7.2.2.2.\nThe target UE may initiate the 5G ProSe direct link modification procedure as specified in clause 7.2.3 to the target 5G ProSe end UE to remove the corresponding PC5 QoS flow if:\na)\tthe 5G ProSe direct link between the target UE and the source 5G ProSe end UE is released; and\nb)\tthe target UE is acting as a 5G ProSe UE-to-UE relay UE and determines to keep the 5G ProSe direct link with the peer 5G ProSe end UE.\nUpon receipt of the PROSE DIRECT LINK RELEASE ACCEPT message, the initiating UE shall stop timer T5087 and shall release the 5G ProSe direct link by performing the following behaviours:\na)\tinform the lower layer along with the PC5 link identifier that the 5G ProSe direct link has been released; and\nb)\tdelete the 5G ProSe direct link context of the 5G ProSe direct link after an implementation specific time.\nThe initiating UE shall form the new KNRP ID from the MSBs of KNRP ID included in the PROSE DIRECT LINK RELEASE REQUEST message and the LSBs of KNRP ID received in the PROSE DIRECT LINK RELEASE ACCEPT message. The initiating UE shall replace the existing KNRP ID with the new KNRP ID. The initiating UE may include the new KNRP ID in PROSE DIRECT LINK ESTABLISHMENT REQUEST message with the target UE as specified in clause 7.2.2.2 when the initiating UE reconnects with the same target UE.\nIf retransmission timer T5087 expires and the PC5 signalling protocol cause included in the PC5 signalling protocol cause IE in the PROSE DIRECT LINK RELEASE REQUEST message was #4 \"direct connection is not available anymore\" or #5 \"lack of resources for 5G ProSe direct link\", the initiating UE shall release the 5G ProSe direct link locally and delete the KNRP ID associated with this link. From this time onward the initiating UE shall no longer send or receive any messages via this link.\nIf retransmission timer T5087 expires and the PC5 signalling protocol cause included in the PC5 signalling protocol cause IE in the PROSE DIRECT LINK RELEASE REQUEST message was not #4 \"direct connection is not available anymore\" or not #5 \"lack of resources for 5G ProSe direct link\", the initiating UE shall initiate the transmission of the PROSE DIRECT LINK RELEASE REQUEST message again and restart timer T5087.\nIf no response is received from the target UE after reaching the maximum number of allowed retransmissions, the initiating UE shall release the 5G ProSe direct link locally and delete the KNRP ID associated with this link. From this time onward the initiating UE shall no longer send or receive any messages via this link.\nNOTE:\tThe maximum number of allowed retransmissions is UE implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.7\tPC5 QoS flow establishment over 5G ProSe direct link",
                            "text_content": "In order to establish a PC5 QoS flow establishment over 5G ProSe direct link, the UE shall derive the PC5 QoS parameters based on the ProSe application requirements provided by the upper layers (if available) and the ProSe identifier(s) according to the PC5 QoS mapping rules defined in clause 5.2.4. The UE shall create the PC5 QoS flow(s) based on the derived PC5 QoS parameters. For each PC5 QoS flow to be created, the UE shall perform the following operations:\na)\tself-assign a PQFI;\nb)\tcreate a PC5 QoS flow context, which contains:\n1)\tthe PQFI;\n2)\tthe ProSe identifier(s); and\n3)\tthe derived PC5 QoS parameters;\nc)\tcreate a new PC5 QoS rule which contains:\n1)\ta PC5 QoS rule identifier;\n2)\tthe PQFI;\n3)\ta set of packet filters; and\n4)\ta precedence value; and\nd)\tpass the following parameters to the lower layers:\n1)\tthe PQFI;\n2)\tthe PC5 QoS parameters;\n3)\tthe PC5 link identifier; and\n4)\toptionally, the source and destination layer-2 IDs.\nThree types of packet filters are supported for unicast mode 5G ProSe direct communication over PC5, i.e., the ProSe IP packet filter set, the ProSe packet filter set and the ProSe Ethernet packet filter set. A PC5 QoS Rule contains one of the following:\na)\tthe ProSe IP packet filter set;\nb)\tthe ProSe packet filter set; or\nc)\tthe ProSe Ethernet packet filter set.\nThe ProSe IP packet filter set is defined as content of the packet filter contents field specified in 3GPP TS 24.501 [11] figure 9.11.4.13.4 and table 9.11.4.13.1.\nThe ProSe packet filter set shall support packet filters based on at least any combination of:\na)\tProSe identifier;\nb)\tthe source layer-2 ID and the destination layer-2 ID; and\nc)\tapplication layer ID (e.g., Station ID).\nThe ProSe Ethernet packet filter set is defined as content of the Ethernet packet filter set as specified in 3GPP TS 24.501 [11] figure 9.11.4.13.4 and table 9.11.4.13.1.\nEach PC5 QoS rule additionally contains the ProSe identifier(s) when the ProSe identifier is not included in the PC5 packet filter set.\nThe UE shall also pass the one or more ProSe NR frequencies associated with the ProSe identifier of the ProSe application and the communication mode which is set to unicast mode for the ProSe identifier to the lower layers based on the ProSe identifier to ProSe NR frequency mapping rules for 5G ProSe communication over PC5 as specified in clause 5.2.4.\nIf the 5G ProSe direct link is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, PC5 QoS flow establishment over the 5G ProSe direct link is performed as specified in clause 8.2.6.\nIf the 5G ProSe direct link is for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, PC5 QoS flow establishment over the 5G ProSe direct link is performed as specified in clause 8a.2.7.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.8\tPC5 QoS flow match over 5G ProSe direct link",
                            "text_content": "When service data or request from the upper layers is received, the UE determines if there is any existing PC5 QoS flow(s) matching the service data or request, i.e., based on the PC5 QoS rules for the existing PC5 QoS flow(s).\nIf there is no PC5 QoS rules for the existing PC5 QoS flow(s) matching the service data or request, the UE shall derive the PC5 QoS parameters based on the ProSe application requirements provided by the upper layers (if available) and the ProSe identifier(s) according to the PC5 QoS mapping rules defined in clause 5.2.4 and shall perform the following:\na)\tif there is no existing PC5 QoS flow that fulfils the derived PC5 QoS parameters, then the UE shall create a new PC5 QoS flow as specified in clause 7.2.7;\nb)\tif there is an existing PC5 QoS flow that fulfils the derived PC5 QoS parameters, then the UE shall update the PC5 packet filter set in the PC5 QoS rule of this PC5 QoS flow, e.g., add the new packet filter in the PC5 QoS rule of this existing PC5 QoS flow; and\nc)\tthe UE shall use the new PC5 QoS flow created as described in bullet a) or the existing PC5 QoS flow with the updated PC5 QoS rules as described in bullet b) to perform the transmission of ProSe direct communication over PC5 as specified in clause 7.2.9.\nIf there is a PC5 QoS rule for the existing PC5 QoS flow matching the service data or request, the UE shall use this existing PC5 QoS flow to perform transmission of ProSe direct communication over PC5 as specified in clause 7.2.9.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.9\tData transmission over 5G ProSe direct link",
                            "text_content": "When receiving user data from upper layers to be sent over 5G ProSe direct link to a specific UE, the transmitting UE shall determine the 5G ProSe direct link context corresponding to the application layer ID and then shall tag each outgoing protocol data unit with the following information before passing it to the lower layers for transmission:\na)\ta layer-3 protocol data unit type (see 3GPP TS 38.323 [16]) set to:\n1)\tIP, if the ProSe message contains IP data;\n2)\tEthernet, if the ProSe message contains Ethernet data; or\n3)\tUnstructured, if the ProSe message contains Unstructured data;\nb)\tthe PC5 link identifier associated with the 5G ProSe direct link context;\nc)\toptionally, the source layer-2 ID set to the source layer-2 ID associated with the 5G ProSe direct link context;\nd)\toptionally, the destination layer-2 ID set to the destination layer-2 ID associated with the 5G ProSe direct link context; and\ne)\tthe PQFI set to the value corresponding to the ProSe identifier and the optional ProSe application requirements according to the mapping rules specified in clause 5.2.4.\nIf the 5G ProSe direct link is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the association of the ProSe application on the PC5 QoS flow over the 5G ProSe direct link is performed as specified in clause 8.2.6.\nThe procedures described for using NR-PC5 in clause 7.3.2.3 apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.10\t5G ProSe direct link security mode control procedure",
                            "text_content": "The 5G ProSe direct link security mode control procedure is used to establish security between two UEs during a 5G ProSe direct link establishment procedure or a 5G ProSe direct link re-keying procedure. Security is not established if the UE PC5 signalling integrity protection is not activated. After successful completion of the 5G ProSe direct link security mode control procedure, the selected security algorithms and their non-null associate keys are used to integrity protect and cipher all PC5 signalling messages exchanged over this 5G ProSe direct link between the UEs and the security context can be used to protect all PC5 user plane data exchanged over this 5G ProSe direct link between the UEs. The UE sending the PROSE DIRECT LINK SECURITY MODE COMMAND message is called the \"initiating UE\" and the other UE is called the \"target UE\".\nThe initiating UE shall meet the following pre-conditions before initiating the 5G ProSe direct link security mode control procedure:\na)\tthe target UE has initiated a 5G ProSe direct link establishment procedure toward the initiating UE by sending a PROSE DIRECT LINK ESTABLISHMENT REQUEST message and:\n1)\tthe PROSE DIRECT LINK ESTABLISHMENT REQUEST message:\ni)\tincludes a target user info IE which includes the application layer ID of the initiating UE; or\nii)\tdoes not include a target user info IE and the initiating UE is interested in the ProSe service identified by the ProSe identifier in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message; and\n2)\tthe initiating UE:\ni)\tif the direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE nor between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using security procedure with network assistance, has either identified an existing KNRP based on the KNRP ID included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or derived a new KNRP;\nii)\tif the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE with the security procedure over user plane being used, has received a new KNRP according to the security procedure over user plane as specified in 3GPP TS 33.503 [34];\niii) if the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE with the security procedure over control plane being used, has received a new KNR_ProSe according to the security procedure over control plane as specified in 3GPP TS 33.503 [34];\niv)\tif the direct communication is between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE with the security procedure over user plane being used, has received a new KNRP according to the security procedure over user plane as specified in 3GPP TS 33.503 [34];\nv) if the direct communication is between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE with the security procedure over control plane being used, has received a new KNR_ProSe according to the security procedure over control plane as specified in 3GPP TS 33.503 [34];\nvi)\thas decided not to activate security protection based on its UE 5G ProSe direct signalling security policy and the target UE's 5G ProSe direct signalling security policy;\nvii)\tthe direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, and the target UE is identified by a PEI, has generated a new KNRP in an implementation defined way; or\nviii)\tif the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, and the security procedure over control plane or the security procedure over user plane as specified in 3GPP TS 33.503 [34] fails, has generated a new KNR_ProSe or KNRP in an implementation defined way; or\nb)\tthe target UE has initiated a 5G ProSe direct link re-keying procedure toward the initiating UE by sending a PROSE DIRECT LINK REKEYING REQUEST message and:\n1)\tif the target UE has included a Re-authentication indication in the PROSE DIRECT LINK REKEYING REQUEST message, the initiating UE has derived a new KNRP.\nWhen:\na)\tthe direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE nor between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using security procedure with network assistance, if a new KNRP has been derived by the initiating UE; or\nb)\tthe direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, if a new KNRP or KNR_ProSe has been received by the initiating UE according to the security procedure over user plane or the security procedure over control plane, respectively, as specified in 3GPP TS 33.503 [34];\nthe initiating UE shall generate the 2 MSBs of KNRP ID to ensure that the resultant KNRP ID will be unique in the initiating UE.\nNOTE 1:\tIf the direct communication is not between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the KNRP ID holds the ID that corresponds to KNRP. If the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the KNRP ID holds the ID that corresponds to KNRP (if security procedure over user plane is used) or KNR_ProSe (if security procedure over control plane is used).\nNOTE 1A:\tIf the direct communication is not between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using security procedure with network assistance, the KNRP ID holds the ID that corresponds to KNRP. If the direct communication is between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using security procedure with network assistance, the KNRP ID holds the ID that corresponds to KNRP (if security procedure over user plane is used) or KNR_ProSe (if security procedure over control plane is used).\nThe initiating UE shall select security algorithms in accordance with its UE 5G ProSe direct signalling security policy and the target UE's 5G ProSe direct signalling security policy. If the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure, the initiating UE shall not select the null integrity protection algorithm if the initiating UE or the target UE's 5G ProSe direct signalling integrity protection policy is set to \"Signalling integrity protection required\". If the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link re-keying procedure, the initiating UE:\na)\tshall not select the null integrity protection algorithm if the integrity protection algorithm currently in use for the 5G ProSe direct link is different from the null integrity protection algorithm;\nb)\tshall not select the null ciphering protection algorithm if the ciphering protection algorithm currently in use for the 5G ProSe direct link is different from the null ciphering protection algorithm;\nc)\tshall select the null integrity protection algorithm if the integrity protection algorithm currently in use is the null integrity protection algorithm; and\nd)\tshall select the null ciphering protection algorithm if the ciphering protection algorithm currently in use is the null ciphering protection algorithm.\nThen the initiating UE shall:\na)\tif the direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE nor between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance:\n1)\tgenerate a 128-bit Nonce_2 value;\n2)\tderive KNRP-sess from Nonce_1 received in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, KNRP and Nonce_2, as specified in 3GPP TS 33.536 [37]; and\n3)\tderive the NR PC5 encryption key NRPEK and the NR PC5 integrity key NRPIK from KNRP-sess and the selected security algorithms as specified in 3GPP TS 33.536 [37];\nb)\tif the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used and completed successfully:\n1)\tderive Krelay-sess from KNR_ProSe, Nonce_2 and Nonce_1 received in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message as specified in 3GPP TS 33.503 [34]; and\n2)\tderive the NR PC5 encryption key Krelay-enc and the NR PC5 integrity key Krelay-int from Krelay-sess and the selected security algorithms as specified in 3GPP TS 33.503 [34];\nc)\tif the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE and the security procedure over user plane as specified in 3GPP TS 33.503 [34] is used and completed successfully:\n1)\tderive KNRP-sess from KNRP, KNRP freshness parameter 2 and KNRP freshness parameter 1 received in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message as specified in 3GPP TS 33.503 [34]; and\n2)\tderive the NR PC5 encryption key NRPEK and the NR PC5 integrity key NRPIK from KNRP-sess and the selected security algorithms as specified in 3GPP TS 33.503 [34]; and\nd)\tcreate a PROSE DIRECT LINK SECURITY MODE COMMAND message. In this message, the initiating UE:\n1)\tshall include the key establishment information container IE if:\ni)\tthe 5G ProSe direct link is neither for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, nor for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using security procedure with network assistance;\nii)\ta new KNRP has been derived at the initiating UE; and\niii)\tthe authentication method used to generate KNRP requires sending information to complete the 5G ProSe direct link authentication procedure;\nNOTE 2:\tThe key establishment information container is provided by upper layers.\n2)\tshall include the MSBs of KNRP ID IE if a new KNRP has been derived or a new KNRP or KNR_ProSe has been received at the initiating UE;\n3)\tshall include a Nonce_2 IE set to:\ni)\tthe 128-bit nonce value generated by the initiating UE when the direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE nor between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using security procedure with network assistance;\nii)\tthe KNRP freshness parameter 2 value received by the initiating UE when the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE with the security procedure over user plane as specified in 3GPP TS 33.503 [34] being used; or\niii)\tthe Nonce_2 value received by the initiating UE when the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE with the security procedure over control plane as specified in 3GPP TS 33.503 [34] being used;\nfor the purpose of session key establishment over this 5G ProSe direct link if the selected integrity protection algorithm is not the null integrity protection algorithm;\n4)\tshall include the selected security algorithms. If the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, and:\ni)\tthe security procedure over control plane or the security procedure over user plane as specified in 3GPP TS 33.503 [34] fails; or\nii)\tthe target UE is identified by a PEI;\nthe initiating UE shall indicate the null integrity protection algorithm and the null ciphering protection algorithm as the selected security algorithms;\n5)\tshall include the UE security capabilities received from the target UE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK REKEYING REQUEST message;\n6)\tshall include the UE 5G ProSe direct signalling security policy received from the target UE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message;\n7)\tshall include the LSB of KNRP-sess ID chosen by the initiating UE as specified in 3GPP TS 33.536 [37] if the selected integrity protection algorithm is not the null integrity protection algorithm;\nNOTE 3:\tIf the direct communication is not between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the KNRP-sess ID holds the ID that corresponds to KNRP-sess. If the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the KNRP-sess ID holds the ID that corresponds to KNRP-sess (if security procedure over user plane is used) or Krelay-sess (if security procedure over control plane is used).\nNOTE 3A:\tIf the direct communication is not between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using security procedure with network assistance, the KNRP-sess ID holds the ID that corresponds to KNRP-sess. If the direct communication is between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using security procedure with network assistance, the KNRP-sess ID holds the ID that corresponds to KNRP-sess (if security procedure over user plane is used) or Krelay-sess (if security procedure over control plane is used).\n8)\tshall include the GPI if received from the 5G PKMF according to the security procedure over user plane as specified in 3GPP TS 33.503 [34], when the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE; and\n9)\tshall include the EAP message if received from the network according to the security procedure over control plane as specified in 3GPP TS 33.503 [34], when the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nIf the security protection of this 5G ProSe direct link is activated by using non-null integrity protection algorithm or non-null ciphering protection algorithm, the initiating UE shall form the KNRP-sess ID from the MSB of KNRP-sess ID received in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK REKEYING REQUEST message and the LSB of KNRP-sess ID included in the PROSE DIRECT LINK SECURITY MODE COMMAND message. The initiating UE shall use the KNRP-sess ID to identify the new security context.\nThe initiating UE shall set the source layer-2 ID and destination layer-2 ID as follows:\n1)\tif the initiating UE is acting as a 5G ProSe UE-to-network relay UE or a 5G ProSe UE-to-UE relay UE, and the EAP-AKA' based authentication method is used as specified in clause 6.3.3.3 of 3GPP TS 33.503 [34],\nthe source layer-2 ID set to the source layer-2 ID used in PROSE AA MESSAGE TRANSPORT REQUEST message, and the destination layer-2 ID set to the the destination layer-2 ID used in PROSE AA MESSAGE TRANSPORT REQUEST message;\n2)\tif the initiating UE is not acting as a 5G ProSe UE-to-network relay UE or a 5G ProSe UE-to-UE relay UE using the security procedure with network assistance, and a 5G ProSe direct link authentication procedure has been initiated:\nthe source layer-2 ID set to the source layer-2 ID used in PROSE DIRECT LINK AUTHENTICATION REQUEST message, and the destination layer-2 ID set to the the destination layer-2 ID used in PROSE DIRECT LINK AUTHENTICATION REQUEST message;\n3)\totherwise, self-assign a source layer-2 ID, and the destination layer-2 ID set to the source layer-2 ID in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nNOTE 4:\tThe UE implementation ensures that any value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14, clause 6.2.15 and clause 8.2.1, and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\nNOTE 5:\tIt is possible for the target UE to reuse the target UE's layer-2 ID used in previous 5G ProSe direct link with the same peer UE.\nAfter the PROSE DIRECT LINK SECURITY MODE COMMAND message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the source layer-2 ID and the destination layer-2 ID, NRPIK (or Krelay-int when applicable), NRPEK (or Krelay-enc when applicable) if applicable, KNRP-sess ID, the selected security algorithm as specified in TS 33.536 [37]; an indication of activation of the 5G ProSe direct signalling security protection for the 5G ProSe direct link with the new security context, if applicable and start timer T5089. The initiating UE shall not send a new PROSE DIRECT LINK SECURITY MODE COMMAND message to the same target UE while timer T5089 is running.\nNOTE 6:\tThe PROSE DIRECT LINK SECURITY MODE COMMAND message is integrity protected (and not ciphered) at the lower layer using the new security context.\nIf the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link re-keying procedure, the initiating UE shall provide to the lower layers an indication of activation of the 5G ProSe direct user plane security protection for the 5G ProSe direct link with the new security context, if applicable, along with the initiating UE's layer-2 ID for 5G ProSe direct communication and the target UE's layer-2 ID for 5G ProSe direct communication.\nThe figure depicts a 5G ProSe direct link security mode control procedure, which is a crucial aspect of network security in 5G networks. The diagram illustrates the steps involved in controlling the security mode of a direct link, including the use of encryption, authentication, and access control mechanisms. The figure is crucial for ensuring the security of 5G networks, as it helps to prevent unauthorized access and protect sensitive data.\nFigure 7.2.10.2.1: 5G ProSe direct link security mode control procedure\nUpon receipt of a PROSE DIRECT LINK SECURITY MODE COMMAND message, if a new assigned initiating UE's layer-2 ID is included and if the 5G ProSe direct link authentication procedure has not been executed, the target UE shall replace the original initiating UE's layer-2 ID with the new assigned initiating UE's layer-2 ID for 5G ProSe direct communication. The target UE shall check the selected security algorithms IE included in the PROSE DIRECT LINK SECURITY MODE COMMAND message. If \"null integrity algorithm\" is included in the selected security algorithms IE, the integrity protection is not offered for this 5G ProSe direct link and the signalling messages are transmitted unprotected. If \"null ciphering algorithm\" and an integrity algorithm other than \"null integrity algorithm\" are included in the selected algorithms IE, the ciphering protection is not offered for this 5G ProSe direct link and the signalling messages are transmitted unprotected. If the target UE's 5G ProSe direct signalling integrity protection policy is set to \"Signalling integrity protection required\", the target UE shall check the selected security algorithms IE in the PROSE DIRECT LINK SECURITY MODE COMMAND message does not include the null integrity protection algorithm. If the selected integrity protection algorithm is not the null integrity protection algorithm, the target UE shall:\na)\tif the direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, nor between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE when security procedure with network assistance is used:\n1)\tderive KNRP-sess from KNRP, Nonce_1 and Nonce_2 received in the PROSE DIRECT LINK SECURITY MODE COMMAND message as specified in 3GPP TS 33.536 [37];\n2)\tderive NRPIK from KNRP-sess and the selected integrity algorithm as specified in 3GPP TS 33.536 [37]; and\n3)\tif the KNRP-sess is derived and the selected ciphering protection algorithm is not the null ciphering protection algorithm, then the target UE shall derive NRPEK from KNRP-sess and the selected ciphering algorithm as specified in 3GPP TS 33.536 [37]; or\nb)\tif the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE when security procedure with network assistance is used and:\n-\tthe RSC is not specific for emergency services; or\n-\tthe RSC is specific for emergency services, and the selected integrity protection algorithm is not the null integrity protection algorithm;\nthen:\n1)\tif the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, derive Krelay-sess according to the security procedure over control plane, and derive Krelay-int from Krelay-sess and the selected integrity algorithm as specified in 3GPP TS 33.503 [34]. If the Krelay-sess is derived and the selected ciphering protection algorithm is not the null ciphering protection algorithm, then the target UE shall derive Krelay-enc from Krelay-sess and the selected ciphering algorithm as specified in 3GPP TS 33.503 [34]; or\n2)\tif security procedure over user plane as specified in 3GPP TS 33.503 [34] is used, derive KNRP-sess according to the security procedure over user plane, and derive NRPIK from KNRP-sess and the selected integrity algorithm as specified in 3GPP TS 33.503 [34]. If the KNRP-sess is derived and the selected ciphering protection algorithm is not the null ciphering protection algorithm, then the target UE shall derive NRPEK from KNRP-sess and the selected ciphering algorithm as specified in 3GPP TS 33.503 [34].\nThe target UE shall determine whether or not the PROSE DIRECT LINK SECURITY MODE COMMAND message can be accepted by:\na)\tchecking that the selected security algorithms IE in the PROSE DIRECT LINK SECURITY MODE COMMAND message does not include the null integrity protection algorithm if the target UE's 5G ProSe direct signalling integrity protection policy is set to \"Signalling integrity protection required\";\nb)\tasking the lower layers to check the integrity of the PROSE DIRECT LINK SECURITY MODE COMMAND message using NRPIK (or Krelay-int when applicable) and the selected integrity protection algorithm, if the selected integrity protection algorithm is not the null integrity protection algorithm;\nc)\tchecking that the received UE security capabilities have not been altered compared to the values that the target UE sent to the initiating UE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK REKEYING REQUEST message;\nd)\tif the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure,\n1)\tchecking that the received UE 5G ProSe direct signalling security policy has not been altered compared to the values that the target UE sent to the initiating UE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message; and\n2)\tchecking that the LSB of KNRP-sess ID included in the PROSE DIRECT LINK SECURITY MODE COMMAND message are not set to the same value as those received from another UE in response to the target UE's PROSE DIRECT LINK ESTABLISHMENT REQUEST message; and\ne)\tif the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link re-keying procedure and the integrity protection algorithm currently in use for the 5G ProSe direct link is different from the null integrity protection algorithm, checking that the selected security algorithms IE in the PROSE DIRECT LINK SECURITY MODE COMMAND message do not include the null integrity protection algorithm.\nIf the target UE did not include a KNRP ID in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, the target UE included a Re-authentication indication in the PROSE DIRECT LINK REKEYING REQUEST message or the initiating UE has chosen to derive:\na)\ta new KNRP if the direct communication is neither between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, nor between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE when security procedure with network assistance is used; the target UE shall derive KNRP as specified in 3GPP TS 33.536 [37];\nb)\ta new KNRP, if the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the security procedure over user plane as specified in 3GPP TS 33.503 [34] is used, the target UE shall derive KNRP as specified in 3GPP TS 33.536 [37]; or\nc)\ta new KNR_ProSe, if the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, the target UE shall derive KNR_ProSe as specified in 3GPP TS 33.536 [37]; and\nthe target UE shall choose the 2 LSBs of KNRP ID to ensure that the resultant KNRP ID will be unique in the target UE. The target UE shall form KNRP ID from the received MSB of KNRP ID and its chosen 2 LSBs of KNRP ID and shall store the complete KNRP ID with KNRP/KNR_ProSe.\nNOTE 1:\tIf the direct communication is not between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the KNRP ID holds the ID that corresponds to KNRP. If the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the KNRP ID holds the ID that corresponds to KNRP (if security procedure over user plane is used) or KNR_ProSe (if security procedure over control plane is used).\nNOTE 1A:\tIf the direct communication is not between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance, the KNRP ID holds the ID that corresponds to KNRP. If the direct communication is between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE using the security procedure with network assistance, the KNRP ID holds the ID that corresponds to KNRP (if security procedure over user plane is used) or KNR_ProSe (if security procedure over control plane is used).\nIf the GPI is included in the PROSE DIRECT LINK SECURITY MODE COMMAND message and the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, the target UE shall derive the UP-PRUK and obtain the UP-PRUK ID from the GPI, and use the UP-PRUK in deriving the KNRP, according to the security procedure over user plane as specified in 3GPP TS 33.503 [34].\nIf the target UE accepts the PROSE DIRECT LINK SECURITY MODE COMMAND message, the target UE shall create a PROSE DIRECT LINK SECURITY MODE COMPLETE message. In this message, the target UE:\na)\tif the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure:\n1)\tshall include the PQFI and the corresponding PC5 QoS parameters if the 5G ProSe direct link is not for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE; or\n2)\tmay include the PQFI and the corresponding PC5 QoS parameters if the 5G ProSe direct link is for 5G ProSe direct communication between 5G ProSe layer-3 remote UE and 5G ProSe layer-3 UE-to-network relay UE;\nNOTE 2:\tThe PQFI and the corresponding PC5 QoS parameters are not included if the 5G ProSe direct link is for 5G ProSe direct communication between 5G ProSe remote UE and 5G ProSe layer-2 UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe layer-2 UE-to-UE relay UE.\nb)\tif IP communication is used, the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure, and the 5G ProSe direct link is not for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe layer-2 UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe layer-2 UE-to-UE relay UE, shall include an IP address configuration IE set to one of the following values:\n1)\t\"IPv6 router\" if only IPv6 address allocation mechanism is supported by the target UE, i.e., acting as an IPv6 router;\n2)\t\"DHCPv4 server\" if only IPv4 address allocation mechanism is supported by the target UE, i.e., acting as a DHCPv4 server;\n3)\t\"DHCPv4 server & IPv6 Router\" if both IPv4 and IPv6 address allocation mechanism are supported by the target UE; or\n4)\t\"address allocation not supported\" if neither IPv4 nor IPv6 address allocation mechanism is supported by the target UE and the 5G ProSe direct link is not for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe layer-3 UE-to-network relay UE;\nNOTE 3:\tThe UE doesn't include an IP address configuration IE nor a link local IPv6 address IE if Ethernet or Unstructured data unit type is used for communication.\nc)\tif IP communication is used, the IP address configuration IE is set to \"address allocation not supported\" and the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure, shall include a link local IPv6 address IE formed locally based on IETF RFC 4862 [25];\nd)\tif a new KNRP was derived or a new KNRP or KNR_ProSe was received, shall include the 2 LSBs of KNRP ID; and\ne)\tif the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure, shall include its UE 5G ProSe direct user plane security policy for this 5G ProSe direct link. In the case where the different ProSe services are mapped to the different 5G ProSe direct user plane security policies, when more than one ProSe identifier is included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, each of the user plane security polices of those ProSe services shall be compatible, e.g., \"user plane integrity protection not needed\" and \"user plane integrity protection required\" are not compatible. If the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the RSC is specific for emergency services, and the null integrity protection algorithm and the null ciphering protection algorithm are the selected security algorithms, the target UE shall indicate the user plane integrity protection policy set to \"user plane integrity protection not needed\" and the user plane ciphering policy set to \"User plane ciphering not needed\".\nIf the selected integrity protection algorithm is not the null integrity protection algorithm, the target UE shall form the KNRP-sess ID from the MSB of KNRP-sess ID it had sent in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK REKEYING REQUEST message and the LSB of KNRP-sess ID received in the PROSE DIRECT LINK SECURITY MODE COMMAND message. The target UE shall use the KNRP-sess ID to identify the new security context.\nAfter the PROSE DIRECT LINK SECURITY MODE COMPLETE message is generated, the target UE shall pass this message to the lower layers for transmission along with the target UE's layer-2 ID for 5G ProSe direct communication and the initiating UE's layer-2 ID for 5G ProSe direct communication, NRPIK (or Krelay-int when applicable), NRPEK (or Krelay-enc when applicable) if applicable, KNRP-sess ID, the selected security algorithm as specified in 3GPP TS 33.536 [37] and an indication of activation of the 5G ProSe direct signalling security protection for the 5G ProSe direct link with the new security context, if applicable.\nNOTE 4:\tThe PROSE DIRECT LINK SECURITY MODE COMPLETE message and further 5G ProSe direct signalling messages are integrity protected and ciphered (if applicable) at the lower layer using the new security context.\nIf the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link re-keying procedure, the target UE shall provide to the lower layers an indication of activation of the 5G ProSe direct user plane security protection for the 5G ProSe direct link with the new security context, if applicable, along with the initiating UE's layer-2 ID for 5G ProSe direct communication and the target UE's layer-2 ID for 5G ProSe direct communication.\nUpon receiving a PROSE DIRECT LINK SECURITY MODE COMPLETE message, the initiating UE shall stop timer T5089. If the selected integrity protection algorithm is not the null integrity protection algorithm, the UE checks the integrity of the PROSE DIRECT LINK SECURITY MODE COMPLETE message. If the integrity check passes, the initiating UE shall then continue the procedure which triggered the 5G ProSe direct link security mode control procedure. If the selected integrity protection algorithm is the null integrity protection algorithm, the UE continues the procedure without checking the integrity protection.\nAfter receiving the PROSE DIRECT LINK SECURITY MODE COMPLETE message, the initiating UE shall delete the old security context it has for the target UE, if any.\nIf the PROSE DIRECT LINK SECURITY MODE COMMAND message cannot be accepted, the target UE shall send a PROSE DIRECT LINK SECURITY MODE REJECT message and the target UE shall abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link security mode control procedure unless the ongoing procedure is a 5G ProSe direct link establishment procedure and the Target user info is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message. The PROSE DIRECT LINK SECURITY MODE REJECT message contains a PC5 signalling protocol cause IE indicating one of the following cause values:\n#5:\tlack of resources for 5G ProSe direct link;\n#7:\tintegrity failure;\n#8:\tUE security capabilities mismatch;\n#9:\tLSB of KNRP-sess ID conflict;\n#10:\tUE PC5 unicast signalling security policy mismatch;\n#14:\tAuthentication synchronisation error; or\n#111:\tprotocol error, unspecified.\nIf this 5G ProSe direct link security mode control procedure is triggered during the 5G ProSe direct link establishment procedure and the implementation-specific maximum number of established NR 5G ProSe direct links has been reached, then the target UE shall send a PROSE DIRECT LINK SECURITY MODE REJECT message containing PC5 signalling protocol cause value #5 \"lack of resources for 5G ProSe direct link\".\nIf the PROSE DIRECT LINK SECURITY MODE COMMAND message cannot be accepted because the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure, that the selected security algorithms IE in the PROSE DIRECT LINK SECURITY MODE COMMAND message included the null integrity protection algorithm and the target UE's 5G ProSe direct signalling integrity protection policy is set to \"Signalling integrity protection required\", the target UE shall include PC5 signalling protocol cause #10 \"UE PC5 unicast signalling security policy mismatch\" in the PROSE DIRECT LINK SECURITY MODE REJECT message.\nIf the PROSE DIRECT LINK SECURITY MODE COMMAND message cannot be accepted because the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link re-keying procedure, the integrity protection algorithm currently in use for the 5G ProSe direct link is different from the null integrity protection algorithm and the selected security algorithms IE in the PROSE DIRECT LINK SECURITY MODE COMMAND message include the null integrity protection algorithm, the target UE, the target UE shall include PC5 signalling protocol cause #10 \"UE PC5 unicast signalling security policy mismatch\" in the PROSE DIRECT LINK SECURITY MODE REJECT message.\nIf the target UE detects that the received UE security capabilities IE in the PROSE DIRECT LINK SECURITY MODE COMMAND message has been altered compared to the latest values that the target UE sent to the initiating UE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK REKEYING REQUEST message, the target UE shall include PC5 signalling protocol cause #8 \"UE security capabilities mismatch\" in the PROSE DIRECT LINK SECURITY MODE REJECT message.\nIf the target UE detects that the LSB of KNRP-sess ID included in the PROSE DIRECT LINK SECURITY MODE COMMAND message are set to the same value as those received from another UE in response to the target UE's PROSE DIRECT LINK ESTABLISHMENT REQUEST message, the target UE shall include PC5 signalling protocol cause #9 \"LSB of KNRP-sess ID conflict\" in the PROSE DIRECT LINK SECURITY MODE REJECT message.\nIf the 5G ProSe direct link security mode control procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the PROSE DIRECT LINK SECURITY MODE COMMAND message cannot be accepted due to a synchronisation error when processing the authentication vector contained in the GPI sent by the 5G ProSe UE-to-network relay UE to the 5G ProSe remote UE or by the 5G ProSe UE-to-UE relay UE to the 5G ProSe end UE, if any, the target UE shall include PC5 signalling protocol cause #14 \"Authentication synchronisation error\" in the PROSE DIRECT LINK SECURITY MODE REJECT message and shall include the RAND and AUTS parameters in the PROSE DIRECT LINK SECURITY MODE REJECT message.\nAfter the PROSE DIRECT LINK SECURITY MODE REJECT message is generated, the target UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for 5G ProSe direct communication and the target UE's layer-2 ID for 5G ProSe direct communication.\nUpon receipt of the PROSE DIRECT LINK SECURITY MODE REJECT message, the initiating UE shall stop timer T5089, provide an indication to the lower layer of deactivation of the 5G ProSe direct security protection and deletion of security context for the 5G ProSe direct link, if applicable and:\na)\tif the PC5 signalling protocol cause IE in the PROSE DIRECT LINK SECURITY MODE REJECT message is set to #9 \"LSB of KNRP-sess ID conflict\", retransmit the PROSE DIRECT LINK SECURITY MODE COMMAND message with a different value for the LSB of KNRP-sess ID and restart timer T5089;\nb)\tif the PC5 signalling protocol cause IE in the PROSE DIRECT LINK SECURITY MODE REJECT message is set to #14 \"Authentication synchronisation error\", the message contained a RAND and an AUTS, and the 5G ProSe direct link security mode control procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, may fetch a fresh GPI from the PKMF by sending a Key Request message including RAND and AUTS as specified in 3GPP TS 33.503 [34]; or\nc)\tif the PC5 signalling protocol cause IE is set to the value other than #9 \"LSB of KNRP-sess ID conflict\" and other than #14 \"Authentication synchronisation error\", abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link security mode control procedure.\na)\tTimer T5089 expires.\nThe initiating UE shall retransmit the PROSE DIRECT LINK SECURITY MODE COMMAND message and restart timer T5089. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe direct link security mode control procedure, shall provide an indication to the lower layer of deactivation of the 5G ProSe direct security protection and deletion of security context for the 5G ProSe direct link, if applicable and shall abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link security mode control procedure.\nNOTE 1:\tThe maximum number of allowed retransmissions is UE implementation specific.\nb)\tThe need to use this 5G ProSe direct link no longer exists before the 5G ProSe direct link security mode control procedure is completed.\nThe initiating UE shall abort the procedure, shall provide an indication to the lower layer of deactivation of the 5G ProSe direct security protection and deletion of security context for the 5G ProSe direct link, if applicable and shall abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link security mode control procedure.\nc)\tIf PROSE DIRECT LINK MODIFICATION REQUEST message or PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message is received when the timer T5089 is running, the initiating UE shall discard the PROSE DIRECT LINK MODIFICATION REQUEST message or PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message.\nd)\tFor the same 5G ProSe direct link, if PROSE DIRECT LINK RELEASE REQUEST message is received when the timer T5089 is running, the initiating UE shall stop the timer T5089, abort the 5G ProSe direct link security mode control procedure and proceed with the 5G ProSe direct link release procedure.\nNOTE 2:\t\tThe abnormal cases as described in bullet c) or d) only happen when the 5G ProSe direct link security mode control procedure is used to establish security between two UEs during a 5G ProSe direct link re-keying procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.11\t5G ProSe direct link re-keying procedure",
                            "text_content": "The purpose of the 5G ProSe direct link re-keying procedure is to derive:\na)\ta new KNRP-sess and, optionally, a new KNRP for an existing 5G ProSe direct link that is not between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE;\nb)\ta new KNRP-sess for an existing 5G ProSe direct link that is between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE when the security procedure over user plane as specified in 3GPP TS 33.503 [34] is used; or\nc)\ta new Krelay-sess for an existing 5G ProSe direct link that is between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE when the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used.\nThe UE sending the PROSE DIRECT LINK REKEYING REQUEST message is called the \"initiating UE\" and the other UE is called the \"target UE\".\nNOTE 1:\tThere is no benefit in performing the 5G ProSe direct link re-keying procedure when using the null integrity protection algorithm, hence it is recommended not to trigger it when using the null integrity protection algorithm.\nThe initiating UE shall meet the following pre-condition before initiating the 5G ProSe direct link re-keying procedure:\na)\tthere is a 5G ProSe direct link between the initiating UE and the target UE; and\n1)\tif the session key KNRP-sess or Krelay-sess (see clause 7.2.11.1) used to protect 5G ProSe direct link needs to be refreshed and neither timer T5089 nor T5091 are running;\n2)\tif the UE wants to refresh KNRP, when the 5G ProSe direct link is not between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE, and neither timer T5089 nor T5091 are running; or\n3)\tif the lower layers indicate that a 5G ProSe direct link re-keying procedure needs to be performed.\nIn order to initiate the 5G ProSe direct link re-keying procedure, the initiating UE shall create a PROSE DIRECT LINK REKEYING REQUEST message. In this message, the initiating UE:\na)\tshall include the Key establishment information container IE if the 5G ProSe direct link is not for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE and the null integrity protection algorithm is not in use;\nNOTE 1:\tThe key establishment information container is provided by upper layers.\nb)\tshall include a Nonce_1 IE set to the 128-bit nonce value generated by the initiating UE for the purpose of session key refresh over this 5G ProSe direct link if the null integrity protection algorithm is not in use;\nc)\tshall include its UE security capabilities indicating the list of algorithms that the initiating UE supports for the re-keying of this 5G ProSe direct link;\nd)\tshall include the MSB of KNRP-sess ID or the MSB of Krelay-sess ID (see clause 7.2.11.1) chosen by the initiating UE as specified in 3GPP TS 33.503 [34] if the null integrity protection algorithm is not in use;\nNOTE 2:\tThe MSB of KNRP-sess ID IE in the PROSE DIRECT LINK REKEYING REQUEST message is used to hold the value of MSB of KNRP-sess ID or MSB of Krelay-sess ID.\ne)\tmay include a Re-authentication indication if the initiating UE wants to derive a new KNRP and the 5G ProSe direct link re-keying procedure is not between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE;\nNOTE 3:\tWhen the 5G ProSe direct link re-keying procedure is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, the Re-authentication indication is not included because a new KNRP is always derived according to the security procedure over user plane or the security procedure over control plane as specified in 3GPP TS 33.503 [34].\nf)\tshall include the User security key ID IE set to:\n1)\tUP-PRUK ID of the initiating UE if:\ni)\tthe UE has a valid UP-PRUK;\nii)\tthe 5G ProSe direct link re-keying procedure is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE; and\niii)\tthe security procedure over user plane as specified in 3GPP TS 33.503 [34] is used; or\n2)\tCP-PRUK ID of the initiating UE that is associated with the relay service code of the target UE if:\ni)\tthe UE has a valid CP-PRUK associated with the relay service code of the target UE;\nii)\tthe 5G ProSe direct link re-keying procedure is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE; and\niii)\tthe security procedure over control plane as specified in 3GPP TS 33.503 [34] is used; and\ng)\tshall include the HPLMN ID of the 5G ProSe Remote UE if the UP-PRUK ID is included and is not in NAI format (see 3GPP TS 33.503 [34]).\nAfter the PROSE DIRECT LINK REKEYING REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication and start timer T5091. The UE shall not send a new PROSE DIRECT LINK REKEYING REQUEST message to the same target UE while timer T5091 is running.\nNOTE 4:\tIn order to ensure successful 5G ProSe direct link re-keying, T5091 should be set to a value larger than the sum of T5092 and T5089.\nThe figure depicts a 5G direct link re-keying procedure, showing the steps involved in re-keying the direct link between the base station (gNB) and the user equipment (UE). The figure illustrates the use of re-keying techniques to improve the signal quality and reliability of the direct link.\nFigure 7.2.11.2.1: 5G ProSe direct link re-keying procedure\nUpon receipt of a PROSE DIRECT LINK REKEYING REQUEST message, if the PROSE DIRECT LINK REKEYING REQUEST message includes a Re-authentication indication, the target UE shall derive a new KNRP. This may require performing one or more 5G ProSe direct link authentication procedures as specified in clause 7.2.12.\nNOTE:\tHow many times the 5G ProSe direct link authentication procedure needs to be performed to derive a new KNRP depends on the authentication method used.\nThen the target UE shall initiate a 5G ProSe direct link security mode control procedure as specified in in clause 7.2.10, where if the 5G ProSe direct link re-keying procedure is sent from the 5G ProSe remote UE to the 5G ProSe UE-to-network relay UE, the target UE shall proceed to establish a new KNRP or KNR_ProSe according to the security procedure over user plane or the security procedure over control plane, respectively, as specified in 3GPP TS 33.503 [34].\nUpon successful completion of the 5G ProSe direct link security mode control procedure, the target UE shall create a PROSE DIRECT LINK REKEYING RESPONSE message.\nAfter the PROSE DIRECT LINK REKEYING RESPONSE message is generated, the target UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication.\nUpon receipt of the PROSE DIRECT LINK REKEYING RESPONSE message, the initiating UE shall stop timer T5091 and check the integrity of the PROSE DIRECT LINK REKEYING RESPONSE message using the new NRPIK.\nAfter receiving the PROSE DIRECT LINK REKEYING RESPONSE message, the initiating UE shall delete the old security context it has for the target UE.\nThe following abnormal cases can be identified:\na)\tTimer T5091 expires.\nThe initiating UE shall retransmit the PROSE DIRECT LINK REKEYING REQUEST message and restart timer T5091. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe direct link re-keying procedure, shall provide an indication of deactivation of the PC5 unicast security protection and deletion of security context for the 5G ProSe direct link to the lower layer, if applicable, along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication and may initiate the 5G ProSe direct link release procedure.\nNOTE:\tThe maximum number of allowed retransmissions is UE implementation specific.\nb)\tThe need to use this 5G ProSe direct link no longer exists before the 5G ProSe direct link re-keying procedure is completed.\nThe initiating UE shall abort the procedure and shall provide an indication of deactivation of the PC5 unicast security protection and deletion of security context for the 5G ProSe direct link to the lower layer, if applicable, along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication.\nc)\tFor the same 5G ProSe direct link, if the initiating UE receives a PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message after initiating the 5G ProSe direct link re-keying procedure, the initiating UE shall stop the timer T5091, abort the 5G ProSe direct link re-keying procedure and proceed with the 5G ProSe direct link identifier update procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.12\t5G ProSe direct link authentication procedure",
                            "text_content": "The 5G ProSe direct link authentication procedure is used to perform mutual authentication of UEs establishing a 5G ProSe direct link and to derive a new KNRP shared between two UEs during a 5G ProSe direct link establishment procedure or a 5G ProSe direct link re-keying procedure. After successful completion of the 5G ProSe direct link authentication procedure, the new KNRP is used for security establishment during the 5G ProSe direct link security mode control procedure as specified in clause 7.2.10. The UE sending the PROSE DIRECT LINK AUTHENTICATION REQUEST message is called the \"initiating UE\" and the other UE is called the \"target UE\".\nNOTE 1:\tThe 5G ProSe direct link authentication procedure is applicable for neither 5G ProSe layer-3 UE-to-network relay nor 5G ProSe layer-2 UE-to-network relay.\nNOTE 2:\tThe 5G ProSe direct link authentication procedure is applicable for the source 5G ProSe layer-2 end UE and the target 5G ProSe layer-2 end UE via a 5G ProSe layer-2 UE-to-UE relay UE.\nThe initiating UE shall meet one of the following pre-conditions when establishing the non-null signalling integrity protection based on the decision of the initiating UE, before initiating the 5G ProSe direct link authentication procedure:\na)\tthe target UE has initiated a 5G ProSe direct link establishment procedure toward the initiating UE by sending a PROSE DIRECT LINK ESTABLISHMENT REQUEST message and:\n1)\tthe PROSE DIRECT LINK ESTABLISHMENT REQUEST message:\ni)\tincludes a target user info IE which includes the application layer ID of the initiating UE; or\nii)\tdoes not include a target user info IE and the initiating UE is interested in the ProSe service identified by the ProSe identifier in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message; and\n2)\tthe KNRP ID is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or the initiating UE does not have an existing KNRP for the KNRP ID included in PROSE DIRECT LINK ESTABLISHMENT REQUEST message or the initiating UE derives a new KNRP; or\nb)\tthe target UE has initiated a 5G ProSe direct link re-keying procedure toward the initiating UE by sending a PROSE DIRECT LINK REKEYING REQUEST message and the PROSE DIRECT LINK REKEYING REQUEST message includes a Re-authentication indication.\nIn order to initiate the 5G ProSe direct link authentication procedure, the initiating UE shall create a PROSE DIRECT LINK AUTHENTICATION REQUEST message. In this message, the initiating UE:\na)\tshall include the key establishment information container IE.\nNOTE 1:\tThe Key establishment information container is provided by upper layers.\nThe initiating UE shall self-assign a source layer-2 ID, and the destination layer-2 ID set to the source layer-2 ID in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nNOTE 2:\tThe UE implementation ensures that any value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14, clause 6.2.15 and clause 8.2.1 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\nNOTE 3:\tIt is possible for the target UE to reuse the target UE's layer-2 ID used in previous 5G ProSe direct link with the same peer UE.\nAfter the PROSE DIRECT LINK AUTHENTICATION REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication.\nThe initiating UE shall start timer T5092. The UE shall not send a new PROSE DIRECT LINK AUTHENTICATION REQUEST message to the same target UE while timer T5092 is running.\nThe figure depicts a direct link authentication procedure in a 5G ProSe network, illustrating the steps involved in verifying the identity of a user. The figure includes a user, a server, and a network interface controller (NICA), with the user's identity being verified through a secure channel. The figure also shows the use of encryption and authentication protocols, such as the Secure Sockets Layer (SSL) and Transport Layer Security (TLS), to ensure the security of the communication.\nFigure 7.2.12.2.1: 5G ProSe direct link authentication procedure\nUpon receipt of a PROSE DIRECT LINK AUTHENTICATION REQUEST message, if a new assigned initiating UE's layer-2 ID is included, the target UE shall replace the original initiating UE's layer-2 ID with the new assigned initiating UE's layer-2 ID for unicast communication. If the target UE determines that the PROSE DIRECT LINK AUTHENTICATION REQUEST message can be accepted, the target UE shall create a PROSE DIRECT LINK AUTHENTICATION RESPONSE message. The target UE shall check if the number of established 5G ProSe direct links is less than the implementation-specific maximum number of established NR 5G ProSe direct links allowed in the UE at a time. In this message, the target UE:\na)\tshall include the Key establishment information container IE.\nNOTE:\tThe key establishment information container is provided by upper layers.\nAfter the PROSE DIRECT LINK AUTHENTICATION RESPONSE message is generated, the target UE shall pass this message to the lower layers for transmission along with the target UE's layer-2 ID for unicast communication and the initiating UE's layer-2 ID for unicast communication.\nUpon receiving a PROSE DIRECT LINK AUTHENTICATION RESPONSE message, if the initiating UE determines that the PROSE DIRECT LINK AUTHENTICATION RESPONSE message can be accepted, the initiating UE shall stop timer T5092.\nNOTE:\tWhen the initiating UE derives the new KNRP during the 5G ProSe direct link authentication procedure depends on the authentication method in use.\nIf the PROSE DIRECT LINK AUTHENTICATION REQUEST message cannot be accepted, the target UE shall create a PROSE DIRECT LINK AUTHENTICATION REJECT message. In this message, the target UE shall include a PC5 signalling protocol cause IE indicating one of the following cause values:\n#5:\tlack of resources for 5G ProSe direct link;\n#6:\tauthentication failure.\nIf this 5G ProSe direct link authentication procedure is triggered during the 5G ProSe direct link establishment procedure and the implementation-specific maximum number of established NR 5G ProSe direct links has been reached, then the target UE shall send a PROSE DIRECT LINK AUTHENTICATION REJECT message containing PC5 signalling protocol cause value #5 \"lack of resources for 5G ProSe direct link\".\nAfter the PROSE DIRECT LINK AUTHENTICATION REJECT message is generated, the target UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication.\nThe target UE shall abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link authentication procedure if the ongoing procedure is the 5G ProSe direct link establishment procedure and the target user info is included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nUpon receipt of the PROSE DIRECT LINK AUTHENTICATION REJECT message, the initiating UE shall stop timer T5092 and abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link authentication procedure.\nIf the PROSE DIRECT LINK AUTHENTICATION RESPONSE message cannot be accepted, the initiating UE shall stop timer T5092 and create a PROSE DIRECT LINK AUTHENTICATION FAILURE message. In this message, the initiating UE may include the Key establishment information container IE if provided by upper layers.\nAfter the PROSE DIRECT LINK AUTHENTICATION FAILURE message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication.\nThe initiating UE shall abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link authentication procedure.\nUpon receipt of the PROSE DIRECT LINK AUTHENTICATION FAILURE message, the target UE shall abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link authentication procedure and shall indicate to upper layers that authentication has failed.\na)\tTimer T5092 expires.\nThe initiating UE shall retransmit the PROSE DIRECT LINK AUTHENTICATION REQUEST message and restart timer T5092. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe direct link authentication procedure and shall abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link authentication procedure.\nNOTE 1:\tThe maximum number of allowed retransmissions is UE implementation specific.\nb)\tThe need to use this 5G ProSe direct link no longer exists before the 5G ProSe direct link authentication procedure is completed.\nThe initiating UE shall abort the 5G ProSe direct link authentication procedure and shall abort the ongoing procedure that triggered the initiation of the 5G ProSe direct link authentication procedure.\nc) For the same 5G ProSe direct link, if the initiating UE receives a PROSE DIRECT LINK RELEASE REQUEST message during the 5G ProSe direct link authentication procedure, the initiating UE shall stop all running timers for this 5G ProSe direct link, abort the 5G ProSe direct link authentication procedure and proceed with the 5G ProSe direct link release procedure.\nNOTE 2:\tThe abnormal cases as described in bullet c) only happens when the 5G ProSe direct link authentication procedure is used to perform mutual authentication of UEs during a 5G ProSe direct link re-keying procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.13\t5G ProSe UE-to-UE relay update procedure",
                            "text_content": "The 5G ProSe UE-to-UE relay update procedure is used to update the target 5G ProSe end UE(s) with the source 5G ProSe end UE's new IP address/prefix and new Application layer ID during a 5G ProSe direct link identifier update procedure between the source 5G ProSe end UE and the 5G ProSe layer-3 UE-to-UE relay UE. The 5G ProSe layer-3 UE-to-UE relay UE initiates the 5G ProSe UE-to-UE relay update procedure with each target end UE as indicated by the source 5G ProSe end UE during the 5G ProSe direct link identifier update procedure.\nThe 5G ProSe layer-3 UE-to-UE relay UE is called the initiating UE in this procedure and the target 5G ProSe end UE is called target UE.\nThe initiating UE shall initiate the 5G ProSe UE-to-UE relay update procedure with the target UE, if the initiating UE receives a PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message from the source 5G ProSe end UE as part of 5G ProSe direct link identifier update procedure.\nThe initiating UE retrieves the target UEs' entry from its local table based on the target 5G ProSe end UE(s) user info received in the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message. The initiating UE initiates the 5G ProSe relay update procedure with each 5G ProSe target end UE.\nIn order to initiate the 5G ProSe UE-to-UE relay update procedure, the initiating UE shall create a PROSE UE TO UE RELAY UPDATE REQUEST message. In this message, the initiating UE:\na)\tshall include the source 5G ProSe end UE's old IP address/prefix, if the initiating UE’s IP address/prefix has changed;\nb)\tmay include the source 5G ProSe end UE's old user info ID, if the initiating UE’s user info ID has changed;\nc)\tmay include the source 5G ProSe end UE's new user info ID, if the initiating UE’s user info ID has changed; and\nd)\tshall include the source 5G ProSe end UE's new IP address/prefix, if the initiating UE’s IP address/prefix has changed.\nThe initiating UE shall pass this message to the lower layers for transmission along with the target UE's layer-2 ID for 5G ProSe direct communication and start timer T5097. The initiating UE shall not send a new PROSE UE TO UE RELAY UPDATE REQUEST message to the same target UE while timer T5097 is running.\n\nThe figure depicts a 5G ProSe direct relay update procedure, illustrating the steps involved in updating the direct relay system in a 5G network. The figure shows the various components and their connections, highlighting the importance of proper communication and coordination in ensuring the smooth operation of the system.\nFigure 7.2.13.2.1: 5G ProSe direct relay update procedure\n\nUpon receipt of a PROSE UE TO UE RELAY UPDATE REQUEST message, the target UE shall replace the original source 5G ProSe end UE's IP address/prefix with the new source 5G ProSe end UE's IP address/prefix  or unicast communication as received in the message. The target UE shall also replace the original source 5G ProSe end UE's Application ID with the new source 5G ProSe end UE's Application ID for unicast communication if received in the PROSE UE TO UE RELAY UPDATE REQUEST message. If the target UE determines that the PROSE UE TO UE RELAY UPDATE REQUEST message can be accepted, the target UE shall create a PROSE UE TO UE RELAY UPDATE ACCEPT message. In this message, the target UE:\na)\tshall include the source 5G ProSe end UE's old IP address/prefix, as received from the initiating UE;\nb)\tshall include the source 5G ProSe end UE's old application layer ID, if received from the initiating UE;\nc)\tshall include the source 5G ProSe end UE's new application layer ID, if received from the initiating UE; and\nd)\tshall include the source 5G ProSe end UE's new IP address/prefix, as received from the initiating UE.\nAfter the PROSE UE TO UE RELAY UPDATE ACCEPT message is generated, the target UE shall pass this message to the lower layers for transmission along with the target UE's layer-2 ID for 5G ProSe direct communication and the initiating UE's layer-2 ID for 5G ProSe direct communication.\n\nUpon receiving a PROSE UE TO UE RELAY UPDATE ACCEPT message, if the initiating UE determines that the PROSE UE TO UE RELAY UPDATE ACCEPT message can be accepted, the initiating UE shall stop timer T5097.\nIf more than one target 5G ProSe end UE is included on the received PROSE UE TO UE RELAY UPDATE REQUEST message, the initiating UE may wait for the responses from all target UEs before stopping timer T5097.\nIf the PROSE UE TO UE RELAY UPDATE REQUEST message cannot be accepted, the target UE shall create a PROSE UE TO UE RELAY UPDATE REJECT message. In this message, the target UE shall include a PC5 signalling protocol cause IE indicating one of the following cause values:\n#x:\tunknown initiating end UE's IP address/prefix or initiating UE's Application layer ID;\nAfter the PROSE UE TO UE RELAY UPDATE REJECT message is generated, the target UE shall pass this message to the lower layers for transmission along with initiating UE’s layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication.\nUpon receipt of the PROSE UE TO UE RELAY UPDATE REJECT message, the initiating UE shall stop timer T5097 and shall continue the ongoing procedure that triggered the initiation of the 5G ProSe UE-to-UE relay update procedure indicating the failing target UE(s) to the source 5G ProSe end UE as specified in clause 7.2.4.6.\na)\tTimer T5097 expires.\nThe initiating UE shall retransmit the PROSE UE TO UE RELAY UPDATE REQUEST message and restart timer T5097. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe UE-to-UE relay update procedure and shall continue the ongoing procedure that triggered the initiation of the 5G ProSe UE-to-UE relay update procedure indicating the failing target end UE(s) to the source 5G ProSe end UE as specified in clause 7.2.4.6.\nNOTE 1:\tThe maximum number of allowed retransmissions is UE implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.14\t5G ProSe direct link identification procedure",
                            "text_content": "The 5G ProSe direct link identification procedure is used by a 5G ProSe UE-to-network relay UE to request a 5G ProSe remote UE to provide specific identification parameters, e.g. the IMEI or the IMEISV. The UE sending the PROSE DIRECT LINK IDENTITY REQUEST message is called the “initiating UE” and the other UE is called the “target UE”.\nThe initiating UE shall initiate the procedure by sending a PROSE DIRECT LINK IDENTITY REQUEST message to request the 5G ProSe remote UE to provide its PEI if the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE with the security procedure over control plane or over user plane as specified in 3GPP TS 33.503 [34]:\na)\tfails when the 5G ProSe remote UE is attemping for emergency services; or\nb)\tis not required and no PEI is received from the 5G ProSe remote UE when the 5G ProSe remote UE is attemping for emergency services.\nIn the PROSE DIRECT LINK IDENTITY REQUEST message, the initiating UE shall include the UE identity type IE with \"Type of identity\" set to \"IMEI\" or \"IMEISV\".\nAfter the PROSE DIRECT LINK IDENTITY REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission and start timer Txxxx. The UE shall not send a new PROSE DIRECT LINK IDENTITY REQUEST message to the same target UE while timer Txxxx is running.\nThe figure depicts a direct link identification procedure for a ProSe system, with a focus on the identification of the direct link between two nodes. The figure includes a schematic representation of the system, with key components such as the ProSe protocol, the direct link, and the identification process. The identification is performed using a combination of statistical analysis and signal strength measurements, with the aim of minimizing the number of false positives and false negatives. The figure provides a clear and concise visual representation of the ProSe direct link identification procedure, making it easy to understand and follow.\nFigure 7.2.14.2.1: ProSe direct link identification procedure\nUpon receipt of the PROSE DIRECT LINK IDENTITY REQUEST message, the target UE shall create a PROSE DIRECT LINK IDENTITY RESPONSE message and include the UE identity IE with the IMEI or IMEISV as requested in the PROSE DIRECT LINK IDENTITY REQUEST message.\nUpon receipt of the PROSE DIRECT LINK IDENTITY RESPONSE the initiating UE shall stop the timer Txxxx.\nUpon expiry of the timer Txxx, the initiating UE may retransmit the PROSE DIRECT LINK IDENTITY REQUEST message and reset and restart the timer Txxx. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe direct link identification procedure.\nNOTE:\tThe maximum number of allowed retransmissions is UE implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.3\tBroadcast mode 5G ProSe direct communication over PC5",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.3.1\tOverview",
                            "text_content": "This clause describes the 5G ProSe communication over PC5 reference point in broadcast mode operation. The UE is configured with the related information as described in clause 5.2.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.2\tTransmission of broadcast mode 5G ProSe communication over PC5",
                            "text_content": "When the UE is requested by upper layers to send data unit(s) of a ProSe application identified by a ProSe identifier using 5G ProSe communication over PC5, the request from the upper layers includes:\na)\tthe data unit(s) of the ProSe application;\nb)\tthe ProSe identifier of the ProSe application for the data unit(s);\nc)\tthe type of data in the data unit(s) (i.e., IP, Ethernet, Address Resolution Protocol, or Unstructured);\nd)\toptionally the communication mode which is set to broadcast mode; and\ne)\toptionally the 5G ProSe application requirements (e.g., priority requirement, reliability requirement, delay requirement).\nUpon a request from upper layers to send data unit(s) of a ProSe application identified by a ProSe identifier using 5G ProSe communication over PC5, the UE passes the one or more ProSe NR frequencies associated with the ProSe identifier based on the ProSe identifier to ProSe NR frequency mapping rules for 5G ProSe communication over PC5 as specified in clause 5.2.4 and the communication mode which is set to broadcast mode for the data unit(s) to the lower layers.\nUpon a request from upper layers to send data unit(s) of a ProSe application identified by a ProSe identifier using 5G ProSe communication over PC5, the UE determines the NR Tx profiles based on the list of ProSe identifiers to NR Tx profiles for broadcast and groupcast mapping rules as specified in clause 5.2.4 and passes the NR Tx profiles to the lower layers as specified in clause 7.3.2.2. Additionally, when the UE is not served by NG-RAN, the UE also passes the configured PC5 DRX configuration as specified in clause 5.2.4 to the lower layers.\nThe UE shall maintain a list of ProSe services the UE is interested in, including the ProSe services in use, the ProSe services that the UE is interested for transmission or both, for each destination layer-2 ID. The ProSe services are identified by the ProSe identifiers.\nNOTE:\tHow the UE maintains the list of ProSe services the UE is interested in is left to UE implementation.\nThen, if:\na)\tthe following conditions are met:\n1)\tthe UE is served by NG-RAN for 5G ProSe communication;\n2)\tthe UE intends to use the radio resources (i.e., carrier frequency) provided by a serving cell;\n3)\tthe registered PLMN is in the list of PLMNs in which the UE is authorized to use 5G ProSe communication over PC5 when the UE is served by NG-RAN for 5G ProSe communication over PC5 as specified in clause 5.2.4; and\n4)\tthe ProSe identifier of the ProSe application is included in the list of ProSe applications authorized for 5G ProSe communication over PC5 as specified in clause 5.2.4; or\nb)\tthe following conditions are met:\n1)\tthe UE is:\ni)\tnot served by NG-RAN for 5G ProSe communication over PC5;\nii)\tin limited service state as specified in 3GPP TS 23.122 [14], if the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; or\niii)\tin limited service state as specified in 3GPP TS 23.122 [14] for reasons other than A), B) or C) above and located in a geographical area for which the UE is provisioned with \"non-operator managed\" radio parameters as specified in clause 5.2.4;\n2)\tthe UE is authorized to use 5G ProSe communication over PC5 when the UE is not served by NG-RAN for 5G ProSe communication as specified in clause 5.2.4; and\n3)\tthe ProSe identifier of the ProSe application is included in the list of ProSe applications authorized for 5G ProSe communication over PC5 as specified in clause 5.2.4;\nthen the UE shall proceed as specified in clause 7.3.2.1.2, else the UE shall not perform transmission of 5G ProSe communication over PC5.\nIn order to determine if any existing PC5 QoS flow matches the request from upper layers, UE shall proceed as follows:\na)\taccording to the PC5 QoS mapping rules specified in clause 5.2.4, the UE shall use the PC5 QoS parameters corresponding to the ProSe identifier and optionally 5G ProSe application requirements;\nb)\taccording to the ProSe identifier to destination layer-2 ID for broadcast mapping rules specified in clause 5.2.4, the UE shall use the destination layer-2 ID corresponding to the ProSe identifier;\nc)\tif there is no existing context for the destination layer-2 ID, then:\n1)\tbuild a new context for the destination layer-2 ID;\n2)\tself-assign a new source layer-2 ID; and\nNOTE:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14, clause 6.2.15 and clause 8.2.1 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\n3)\tpass the source layer-2 ID and the destination layer-2 ID to lower layers.\nd)\tif in the context for the destination layer-2 ID, there is no PC5 QoS rule for the existing PC5 QoS flow(s) matching the service data or request, the UE shall derive the PC5 QoS parameters based on the 5G ProSe application requirements provided by the upper layers (if available) and the ProSe identifier according to the PC5 QoS mapping rules defined in clause 5.2.4 and shall perform the following:\n1)\tif there is no existing PC5 QoS flow that fulfils the derived PC5 QoS parameters, then the UE shall create a new PC5 QoS flow by performing the following operations:\ni)\tself-assign a new PQFI;\nii)\tcreate a new PC5 QoS flow context which contains:\nA)\tthe PQFI;\nB)\tthe ProSe identifier(s); and\nC)\tthe derived PC5 QoS parameters;\niii)\tcreate a new PC5 QoS rule which contains:\nA)\ta PC5 QoS rule identifier;\nB)\tthe PQFI;\nC)\ta set of packet filters; and\nD)\ta precedence value; and\niv)\tpass the following parameters to the lower layers:\nA)\tthe PQFI;\nB)\tthe PC5 QoS parameters;\nC)\tthe source layer-2 ID and the destination layer-2 ID; and\nD)\tthe NR Tx profile, if available, as determined for the respective ProSe identifier based on the list of ProSe identifiers to NR Tx profiles for broadcast and groupcast mapping rules as specified in clause 5.2.4;\n2)\tif there is an existing PC5 QoS flow that fulfils the derived PC5 QoS parameters, then the UE shall update the PC5 packet filter set in the PC5 QoS rule of this PC5 QoS flow, e.g. add the new packet filter in the PC5 QoS rule of this existing PC5 QoS flow; and\n3)\tthe UE shall use the new PC5 QoS flow created as described in bullet 1) or the existing PC5 QoS flow with the updated PC5 QoS rules as described in bullet 2) to perform the transmission of 5G ProSe communication over PC5 as specified in clause 7.3.2.2; and\ne)\tif in the context for the destination layer-2 ID, there is a PC5 QoS rule for the existing PC5 QoS flow matching the service data or request, the UE shall use this existing PC5 QoS flow to perform transmission of 5G ProSe communication over PC5 as specified in clause 7.3.2.2.\nThree types of packet filters are supported for broadcast mode 5G ProSe direct communication over PC5, i.e., the ProSe IP packet filter set, the ProSe packet filter set and the ProSe Ethernet packet filter set. The three types of packet filters are defined the same as specified in clause 7.2.7.\nThe UE shall include the data unit(s) in a protocol data unit with the following parameters:\na)\ta layer-3 protocol data unit type (see 3GPP TS 38.323 [16]) set to:\n1)\tIP, if the data unit(s) contains IP data;\n2)\tEthernet, if the data unit(s) contains Ethernet data;\n3)\tAddress Resolution Protocol, if the data unit(s) contains Address Resolution Protocol data; or\n4)\tUnstructured, if the data unit(s) contains Unstructured data;\nb)\tthe source layer-2 ID set to the layer-2 ID self-assigned by the UE for 5G ProSe communication over PC5 as specified in clause 7.3.2.1.2;\nc)\tthe destination layer-2 ID set to the destination layer-2 ID associated with the ProSe identifier of the ProSe application in this list of ProSe applications authorized for 5G ProSe communication over PC5 as specified in clause 5.2.4;\nd)\tif the data unit(s) contains IP data, the source IP address set to the source IP address allocated to the UE as specified in clause 7.3.4;\nNOTE:\tHow to set the destination IP address is left to UE implementation.\ne)\tthe PQFI set to the value corresponding to the PC5 QoS rules as specified in clause 7.3.2.1, and\nf)\tthe NR Tx profile based on the ProSe identifiers to NR Tx profiles for broadcast and groupcast mapping rules as specified in clause 5.2.4. If the list of ProSe services the UE is interested in for the destination layer-2 ID changes, the UE shall provide all the NR Tx profiles for the ProSe identifier(s) in the list of ProSe services the UE is interested in for the destination layer-2 ID to the lower layers,\nthen UE shall request radio resources for 5G ProSe communication over PC5 as specified in 3GPP TS 38.300 [21] and pass the data unit(s) on the PC5 QoS Flow identified by the PQFI to lower layers for transmission. The PC5 QoS Rules corresponding to the PQFIs map the data unit(s) with the same ProSe identifier and with the same PC5 QoS parameters to the same PC5 QoS Flow and apply PQFI to the data unit(s).\nIf the UE is camped on a serving cell indicating that 5G ProSe communication over PC5 is supported by the network, but not broadcasting any carrier frequencies and radio resources for 5G ProSe communication over PC5 as specified in 3GPP TS 38.331 [13], the UE shall request radio resources for 5G ProSe communication over PC5 as specified in 3GPP TS 24.501 [11].\nWhen the UE is not served by NG-RAN for 5G ProSe communication and is authorized to use 5G ProSe communication over PC5, the UE shall identify the NR-PC5 to be used for 5G ProSe communication over PC5. After identifying NR-PC5 to be used for 5G ProSe communication over PC5, the UE shall select the corresponding radio parameters to be used for 5G ProSe communication over PC5 as follows:\na)\tif the UE can determine itself located in a geographical area and the UE is provisioned with radio parameters for the geographical area, the UE shall select the radio parameters associated with that geographical area; or\nb)\tin all other cases, the UE shall not initiate 5G ProSe communication over PC5.\nIf the UE intends to use \"non-operator managed\" radio parameters as specified in clause 5.2.4, the UE shall initiate 5G ProSe communication over PC5 with the selected radio parameters.\nIf the UE intends to use \"operator managed\" radio parameters as specified in clause 5.2.4, before initiating 5G ProSe communication over PC5, the UE shall check with lower layers whether the selected radio parameters can be used in the current location without causing interference to other cells as specified in 3GPP TS 38.331 [13]; and:\na)\tif the lower layers indicate that the usage would not cause any interference, the UE shall initiate 5G ProSe communication over PC5; or\nNOTE:\tIf the lower layers find that there exists a cell operating the provisioned radio resources (i.e., carrier frequency) and the cell belongs to the registered PLMN or a PLMN equivalent to the registered PLMN and the UE is authorized for 5G ProSe communication over PC5 in this PLMN, the UE can use the radio parameters indicated by the cell as specified in 3GPP TS 38.331 [13].\nb)\telse if the lower layers report that one or more PLMNs operate in the provisioned radio resources (i.e., carrier frequency) then:\n1)\tif the following conditions are met:\ni)\tnone of the PLMNs reported by the lower layers is the registered PLMN or equivalent to the registered PLMN;\nii)\tat least one of the PLMNs reported by the lower layers is in the list of authorized PLMNs for 5G ProSe communication over PC5 and provides radio resources for 5G ProSe communication over PC5 as specified in 3GPP TS 38.331 [13]; and\niii)\tthe UE does not have an emergency PDU session;\nthen the UE shall:\ni)\tif in 5GMM-IDLE mode, perform PLMN selection triggered by 5G ProSe communication over PC5 as specified in 3GPP TS 23.122 [14]; or\nii)\telse if in 5GMM-CONNECTED mode, either:\nA)\tperform a De-registration procedure as specified in 3GPP TS 24.501 [11] and then perform PLMN selection triggered by 5G ProSe communication over PC5 as specified in 3GPP TS 23.122 [14]; or\nB)\tnot initiate 5G ProSe communication over PC5.\nWhether the UE performs i) or ii) above is left up to UE implementation; or\n2)\telse the UE shall not initiate 5G ProSe communication over PC5.\nIf the registration to the selected PLMN is successful, the UE shall proceed with the procedure to initiate 5G ProSe communication over PC5 as specified in clause 7.3.2.1.\nIf the UE is performing 5G ProSe communication over PC5 using radio parameters associated with a geographical area and moves out of that geographical area, the UE shall stop performing 5G ProSe communication over PC5 and then:\na)\tif the UE is not served by NG-RAN for 5G ProSe communication over PC5 or the UE intends to use radio resources for 5G ProSe communication over PC5 other than those operated by the serving cell, the UE shall select appropriate radio parameters for the new geographical area as specified above; or\nb)\tif the UE is served by NG-RAN for 5G ProSe communication over PC5 and intends to use radio resources for 5G ProSe communication over PC5 operated by the serving cell, the UE shall proceed with the procedure to initiate 5G ProSe communication over PC5 when served by NG-RAN for 5G ProSe communication over PC5.\nUpon initiating transmission of 5G ProSe communication over PC5, if:\na)\tthe ProSe identifier of a ProSe application requesting transmission of 5G ProSe communication over PC5 is in the list of ProSe applications which require privacy for 5G ProSe communication over PC5 as specified in clause 5.2.4; and\nb)\tthe UE is located in a geographical area in which this ProSe application requires privacy for 5G ProSe communication over PC5 as specified in clause 5.2.4, or the UE is not provisioned any geographical areas in which this ProSe applications requires privacy for 5G ProSe communication over PC5,\nthen the UE shall proceed as follows:\na)\tif timer T5100 is not running, start timer T5100 and set its timer value as the privacy timer value as specified in clause 5.2.4;\nb)\tupon:\n1)\tgetting an indication from upper layers that the application layer identifier has been changed; or\n2)\ttimer T5100 expiry,\nthen:\n1)\tchange the value of the source layer-2 ID self-assigned by the UE for the 5G ProSe communication over PC5;\nNOTE 1:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14, clause 6.2.15 and clause 8.2.1 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\n2)\tif the data unit(s) contains IP data, change the value of the source IP address self-assigned by the UE for 5G ProSe communication over PC5;\nNOTE 2:\tHow to change and randomise the UE's source layer-2 ID and source IP address including IP prefix (if used) is specified in clause 5.5 of 3GPP TS 33.536 [37] with the consideration of replacing V2X with 5G ProSe.\n3)\tprovide an indication to upper layers that the source layer-2 ID, or the source IP address, or both the source layer-2 ID and the source IP address are changed;\n4)\tpass the changed source layer-2 ID and destination layer-2 ID, along with the corresponding PQFI down to the lower layer;\n5)\trestart timer T5100; and\n6)\tupon stopping transmission of the 5G ProSe communication over PC5, stop timer T5100.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.3\tReception of broadcast mode 5G ProSe communication over PC5",
                            "text_content": "The UE may be configured by upper layers with one or more destination layer-2 ID(s) for reception of data unit(s) over PC5.\nThe UE shall maintain a list of ProSe services the UE is interested in, including the ProSe services in use, ProSe services that the UE is interested for reception or both, for each destination layer-2 ID. The ProSe services are identified by the ProSe identifiers.\nNOTE 1:\tHow the UE maintains the list of ProSe services it is interested in is left to UE implementation.\nThe receiving UE shall determine the PC5 QoS parameters for this broadcast ProSe service in the same way described in clause 7.3.2.1.2 and shall determine the NR Tx profile as described in clause 5.2.4, and shall provide the PC5 QoS parameters, the NR Tx profile and the destination layer-2 ID(s) to lower layers. If the list of ProSe services the UE is interested in for the destination layer-2 ID changes, the receiving UE shall update the lower layers for the NR Tx Profiles information by providing all the NR Tx profiles for the ProSe identifier(s) in the list of ProSe services the UE is interested in for the destination layer-2 ID to the lower layers.\nFor each received protocol data unit over PC5, the receiving UE shall check if the destination layer-2 ID of the received protocol data unit matches one of the configured destination layer-2 IDs. If yes, the UE shall then check whether the protocol data unit type as defined 3GPP TS 38.323 [16] provided by the lower layers for the received packet is set to IP, Ethernet, Address Resolution Protocol or Unstructured and pass the protocol data unit to the corresponding upper layer entity.\nNOTE 2:\tWhen the PC5 DRX operation is needed based on the provided NR Tx profile, the lower layers use PC5 QoS parameters and the destination layer-2 ID(s) to determine the PC5 DRX parameter values (see 3GPP TS 38.300 [21]) for reception operation over PC5 reference point.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.4\tIP address allocation for broadcast mode 5G ProSe communication over PC5",
                            "text_content": "When the UE needs to perform 5G ProSe communication over PC5 reference point in broadcast mode operation and the type of data in the data unit is IP, the UE:\na)\tfor IPv4,\n1)\tshall use the pre-configured link local IPv4 address as source address; or\n2)\tshall use dynamic configuration of IPv4 link-local addresses as specified in IETF RFC 3927 [38] if there is no pre-configured link local IPv4 address; and\nb)\tfor IPv6,\n1)\tshall auto-configure a link local IPv6 address following procedures defined in IETF RFC 4862 [25]; and\n2)\tmay use this IP address for direct communication without sending Neighbour Solicitation and Neighbour Advertisement message for Duplicate Address Detection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.4\tGroupcast mode 5G ProSe direct communication over PC5",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.4.1\tOverview",
                            "text_content": "This clause describes the 5G ProSe communication over PC5 reference point in groupcast mode operation. The UE is configured with the related information as described in clause 5.2.4. For commercial services, the application layer group ID is provided by application server. For public safety services, the pre-configured or provisioned application layer group ID as described in clause 5.2.4 will be used for groupcast communication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.4.2\tTransmission of groupcast mode 5G ProSe communication over PC5",
                            "text_content": "Before the UE is requested by upper layers to send data unit(s) of a ProSe application identified by a ProSe identifier using 5G ProSe communication over PC5, for the users sharing the same application layer group ID as configured in clause 5.2.4 may perform a group member discovery procedure as specified in clause 6.2.15.\nWhen the group is formed, the following information may be exchanged within the group members included in the application layer discovery message:\na)\tgroup size; and\nb)\tmember ID.\nNOTE:\tWhether to transmit the application layer discovery message as metadata in a 5G ProSe direct discovery message or as user traffic over PC5 is UE implementation specific.\nThe requirements for groupcast mode 5G ProSe direct communication over PC5 is the same as described in clause 7.3.2.1.1, with the following additions:\na)\tWhen the UE is requested by upper layers to send data unit(s) of a ProSe application identified by a ProSe identifier using 5G ProSe communication over PC5, the request from the upper layers includes:\n1)\tthe application layer group ID;\n2)\tthe group size and the member IDs;\n3)\tthe range requirement; or\n4)\tthe communication mode which is set to groupcast mode.\nThe PC5 QoS flow match and establishment for groupcast mode 5G ProSe direct communication over PC5 is the same as described in clause 7.3.2.1.2, with the following modifications:\na)\tThe UE shall determine the destination layer-2 ID as:\n1)\tif no application layer group ID is provided by the application layer, then according to the mapping rules specified in clause 5.2.4, the UE shall set the destination layer-2 ID to the destination layer-2 ID corresponding to the ProSe identifier as specified in clause 5.2.4;\n2)\tif application layer group ID is provided by the application layer and there is a context for the application layer group ID as specified in clause 5.2.4, then UE shall set the destination layer-2 ID to the ProSe layer-2 group ID in the context; and\n3)\tif application layer group ID is provided by the application layer and there is no context for the application layer group ID as specified in clause 5.2.4, then the UE shall convert the application layer group ID into a destination layer-2 ID as following:\ni)\tto use the group identifier as the input to the SHA-256 hashing algorithm as specified in ISO/IEC 10118-3:2018 [28]; and\nii)\tto use the 24 least significant bits of the 256 bits of the output as destination layer-2 ID; and\nNOTE:\tSHA-256 hashing algorithm is implemented in the ME.\nb)\tIf there is no existing context for the destination layer-2 ID and optional group identifier, the UE shall proceed as:\n1)\tto establish a new context for the destination layer-2 ID and optional group identifier;\n2)\tself-assign a new source layer-2 ID; and\n3)\tto pass the source/destination layer-2 IDs, optional group size and optional member IDs to lower layers.\nThe transmission of groupcast mode 5G ProSe direct communication over PC5 is same as described in clause 7.3.2.2, with the following additions:\na)\tIf group identifier is provided, then the destination layer-2 ID shall be set to the destination layer-2 ID in the context for the group identifier as specified in clause 7.4.2.1.3.\nThe procedures described in clause 7.3.2.3 apply.\nThe procedures described in clause 7.3.2.4 apply with the following additions:\na)\tusing the privacy timer T5200 for groupcast; and\nb)\thow to change and randomise the UE's source layer-2 ID and source IP address including IP prefix (if used) is specified in clause 5.4 of 3GPP TS 33.536 [37] with the consideration of replacing V2X with 5G ProSe.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.4.3\tReception of groupcast mode 5G ProSe direct communication over PC5",
                            "text_content": "The reception of groupcast mode 5G ProSe direct communication over PC5 is the same as described in clause 7.3.3, with the following additions:\na)\tbesides the configured destination layer-2 ID(s) for receiving messages over PC5, the UE shall also derive the destination layer-2 ID(s) based on group identifier(s) if provided by upper layers as specified in clause 7.4.2.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.4.4\tIP address allocation for groupcast mode 5G ProSe communication over PC5",
                            "text_content": "When the UE needs to perform 5G ProSe communication over PC5 reference point in groupcast mode operation and the type of data in the data unit is IP, the UE uses the same IP address allocation mechanism as specified in clause 7.3.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.5\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.5.1\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.2\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.5.3\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.6\tPC3ach control protocol for 5G ProSe direct communication",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.6.1\tTransport protocol for PC3ach control protocol for 5G ProSe direct communication",
                            "text_content": "The UE and 5G DDNMF CTF (ADF) shall use HTTP/1.1 as specified in IETF RFC 9112 [3] and IETF RFC 9110 [4] as the transport protocol for messages transmitted over the PC3ach interface. The 5G ProSe messages described here shall be included in the body of either an HTTP request message or an HTTP response message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.2\tProcedures for PC3ach control protocol for 5G ProSe direct communication",
                            "text_content": "The purpose of the usage information report list sending procedure is to enable a 5G ProSe-enabled UE to provide information necessary for composing of charging events related to the 5G ProSe direct communication as defined in 3GPP TS 32.277 [45].\nThe UE shall perform the usage information report list sending procedure with the Accounting Data Forwarding (ADF) function block of the Charging Trigger Function (CTF) in the 5G DDNMF (5G DDNMF CTF (ADF)) residing in the HPLMN.\nThe UE shall construct the usage information report based on the configuration described in clause 5.2.\nThe UE shall perform the usage information report list sending procedure if the UE is in NG-RAN coverage and if:\na)\tthe following is true:\n1)\tthe configured collection period has elapsed, either since the beginning of 5G ProSe direct communication (if it is the first usage information report list sending procedure performed after the beginning of 5G ProSe direct communication) or since the end of the previous usage information report list sending procedure;\n2)\tthe configured reporting window has not elapsed after the configured collection period elapsed;\n3)\tthe UE is in the RRC_CONNECTED mode (see 3GPP TS 38.300 [21]); and\n4)\tthe UE has usage information for at least one collection period; or\nb)\tthe following is true:\n1)\tthe configured collection period has elapsed, either since the beginning of 5G ProSe direct communication (if it is the first usage information report list sending procedure performed after the beginning of 5G ProSe direct communication) or since the end of the previous usage information report list sending procedure;\n2)\tthe configured reporting window has elapsed after the configured collection period elapsed; and\n3)\tthe UE has usage information for at least one collection period.\nThe UE shall initiate the usage information report list sending procedure by sending a PROSE_USAGE_INFORMATION_REPORT_LIST message to the 5G DDNMF CTF (ADF).\nIf the UE is configured with the address of the 5G DDNMF CTF (ADF) for uploading the usage information reports, the UE shall send the PROSE_USAGE_INFORMATION_REPORT_LIST message to the configured address of the 5G DDNMF CTF (ADF). If the UE is not configured with the address of the 5G DDNMF CTF (ADF) for uploading the usage information reports, the UE shall send the PROSE_USAGE_INFORMATION_REPORT_LIST message to the IP address of the 5G DDNMF discovered as described in clause 6.1.2.2.\nIn the PROSE_USAGE_INFORMATION_REPORT_LIST message, the UE:\na)\tshall include a new transaction ID;\nb)\tfor each collection period:\n1)\tshall include a sequence number of the usage information report;\n2)\tif the UE is configured to report the time stamps when it went in and out of NG-RAN coverage during the collection period in the usage information, for each going in or out of NG-RAN coverage:\ni)\tshall include the information of whether the UE was in or out of NG-RAN coverage;\nii)\tshall include the time stamp of the move; and\niii)\tif the UE was in NG-RAN coverage and the UE is configured to report the list of locations of the UE when in NG-RAN coverage during the collection period in the usage information, for each camping on a cell or usage of a cell in the 5GMM-CONNECTED mode:\nA)\tshall include the NG-RAN cell global identification of the cell; and\nB)\tshall include the time stamp of beginning of the camping on the cell or of beginning of the usage of the cell in the 5GMM-CONNECTED mode;\n3)\tin case of broadcast and groupcast mode 5G ProSe direct communication, for each group identified by ProSe layer-2 group ID:\ni)\tif the UE is configured to report the group parameters in the usage information, shall include the ProSe layer-2 group ID, ProSe group IP multicast address, the IP address used by the UE as a source IP address, and the layer-2 ID used by the UE as a source layer-2 ID;\nii)\tif the UE transmitted data during the collection period and the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include the time stamp of the first transmission to the ProSe Group IP multicast address in the collection period;\niii)\tif the UE received data during the collection period and the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include the time stamp of the first reception from the ProSe Group IP multicast address in the collection period;\niv)\tfor each transmitter in groupcast mode 5G ProSe direct communication, shall include the source layer-2 ID and IP address of the transmitter;\nv)\tif the UE is configured to report the amount of data transmitted during the collection period with location information in the usage information, per each in or out of NG-RAN coverage period and per each NG-RAN cell used when in NG-RAN coverage:\nA)\tshall indicate whether the data are sent in or out of NG-RAN coverage;\nB)\tif the UE transmitted data in an NG-RAN cell during an in NG-RAN coverage period:\n-\tshall include the NG-RAN cell global identification of the NG-RAN cell;\n-\tshall include the amount of data transmitted in the NG-RAN cell;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first transmission in the NG-RAN cell; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the indicator of which radio resources were used and radio frequency used; and\nC)\tif the UE transmitted data during out of NG-RAN coverage period:\n-\tshall include the amount of data transmitted during the out of NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first transmission during the out of NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the used radio frequency;\nvi)\tif the UE is configured to report the amount of data transmitted during the collection period without location information in the usage information, per each in or out of NG-RAN coverage period:\nA)\tshall indicate whether the data are sent in or out of NG-RAN coverage;\nB)\tif the UE transmitted data during in NG-RAN coverage period:\n-\tshall include the amount of data transmitted during the in NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first transmission during the in NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the indicator of which radio resources were used and radio frequency used; and\nC)\tif the UE transmitted data during out of NG-RAN coverage period:\n-\tshall include the amount of data transmitted during the out of NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first transmission during the out of NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the used radio frequency;\nvii)\tif the UE is configured to report the amount of data received during the collection period with location information in the usage information, per each in or out of NG-RAN coverage period and per each NG-RAN cell used when in NG-RAN coverage:\nA)\tshall indicate whether the data are received in or out of NG-RAN coverage;\nB)\tif the UE received data in an NG-RAN cell during an in NG-RAN coverage period:\n-\tshall include the NG-RAN cell global identification of the NG-RAN cell;\n-\tshall include the amount of data received in the NG-RAN cell;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first reception in the NG-RAN cell; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the indicator of which radio resources were used and radio frequency used; and\nC)\tif the UE received data during out of NG-RAN coverage period:\n-\tshall include the amount of data received during the out of NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first reception during the out of NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the used radio frequency;\nviii)\tif the UE is configured to report the amount of data received during the collection period without location information in the usage information, per each in or out of NG-RAN coverage period:\nA)\tshall indicate whether the data are received in or out of NG-RAN coverage;\nB)\tif the UE received data during in NG-RAN coverage period:\n-\tshall include the amount of data received during the in NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first reception during the in NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the indicator of which radio resources were used and radio frequency used; and\nC)\tif the UE received data during out of NG-RAN coverage period:\n-\tshall include the amount of data received during the out of NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first reception during the out of NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the used radio frequency; and\nix)\tif the UE is configured to report QoS flow information, per each QoS flow identified by the PQFI:\nA)\tif the UE transmitted the QoS flow during the collection period:\n-\tshall include the time stamp for start of transmission of the QoS flow in the collection period;\n-\tshall include the time stamp for end of transmission of the QoS flow in the collection period;\n-\tshall include the (initial) PC5 QoS parameters of the QoS flow in the collection period as specified in clause 10.6.4.2;\n-\tshall include the amount of data of the QoS flow transmitted with the (initial) PC5 QoS parameters in the collection period; and\n-\tif the PC5 QoS parameters of the QoS flow were changed during the collection period, shall include the time stamp for start of transmission of the QoS flow with the new PC5 QoS parameters, the new PC5 QoS parameters of the QoS flow as specified in clause 10.6.4.2, and the amount of data of the QoS flow transmitted with the new PC5 QoS parameters in the collection period; or\nB)\tif the UE received the QoS flow during the collection period:\n-\tshall include the time stamp for start of reception of the QoS flow in the collection period;\n-\tshall include the time stamp for end of reception of the QoS flow in the collection period;\n-\tshall include the (initial) PC5 QoS parameters of the QoS flow in the collection period as specified in clause 10.6.4.2;\n-\tshall include the amount of data of the QoS flow received with the (initial) PC5 QoS parameters in the collection period; and\n-\tif the PC5 QoS parameters of the QoS flow were changed during the collection period, shall include the time stamp for start of reception of the QoS flow with the new PC5 QoS parameters, the new PC5 QoS parameters of the QoS flow as specified in clause 10.6.4.2, and the amount of data of the QoS flow received with the new PC5 QoS parameters in the collection period;\n4)\tin case of unicast mode 5G ProSe direct communication, for each 5G ProSe direct communication identified by the source layer-2 ID and destination layer-2 ID for unicast communication:\ni)\tshall include the IP address used by the UE as a source IP address, and the layer-2 ID used by the UE as a source layer-2 ID;\nii)\tif the UE transmitted data during the collection period and the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include the time stamp of the first transmission in the 5G ProSe direct communication in the collection period;\niii)\tif the UE received data during the collection period and the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include the time stamp of the first reception in the 5G ProSe direct communication in the collection period;\niv)\tfor each transmitter in unicast mode 5G ProSe direct communication not between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, shall include the source layer-2 ID and IP address of the transmitter, target layer-2 ID and IP address of the receiver;\nv)\tfor each transmitter in unicast mode 5G ProSe direct communication between 5G ProSe the remote UE and the 5G ProSe UE-to-network relay UE, shall include the source layer-2 ID and IP address of the transmitter, layer-2 ID and IP address of 5G ProSe UE-to-network relay UE;\nvi)\tif the UE is configured to report the amount of data transmitted during the collection period with location information in the usage information, per each in or out of NG-RAN coverage period and per each NG-RAN cell used when in NG-RAN coverage:\nA)\tshall indicate whether the data are sent in or out of NG-RAN coverage;\nB)\tif the UE transmitted data in an NG-RAN cell during an in NG-RAN coverage period:\n-\tshall include the NG-RAN cell global identification of the NG-RAN cell;\n-\tshall include the amount of data transmitted in the NG-RAN cell;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first transmission in the NG-RAN cell; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the indicator of which radio resources were used and radio frequency used; and\nC)\tif the UE transmitted data during out of NG-RAN coverage period:\n-\tshall include the amount of data transmitted during the out of NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first transmission during the out of NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the used radio frequency;\nvii)\tif the UE is configured to report the amount of data transmitted during the collection period without location information in the usage information, per each in or out of NG-RAN coverage period:\nA)\tshall indicate whether the data are sent in or out of NG-RAN coverage;\nB)\tif the UE transmitted data during in NG-RAN coverage period:\n-\tshall include the amount of data transmitted during the in NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first transmission during the in NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the indicator of which radio resources were used and radio frequency used; and\nC)\tif the UE transmitted data during out of NG-RAN coverage period:\n-\tshall include the amount of data transmitted during the out of NG-RAN coverage period; and\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first transmission during the out of NG-RAN coverage period;\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the used radio frequency;\nviii)\tif the UE is configured to report the amount of data received during the collection period with location information in the usage information, per each in or out of NG-RAN coverage period and per each NG-RAN cell used when in NG-RAN coverage:\nA)\tshall indicate whether the data are received in or out of NG-RAN coverage;\nB)\tif the UE received data in an NG-RAN cell during an in NG-RAN coverage period:\n-\tshall include the NG-RAN cell global identification of the NG-RAN cell;\n-\tshall include the amount of data received in the NG-RAN cell;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first reception in the NG-RAN cell; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the indicator of which radio resources were used and radio frequency used; and\nC)\tif the UE received data during out of NG-RAN coverage period:\n-\tshall include the amount of data received during the out of NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first reception during the out of NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the used radio frequency;\nix)\tif the UE is configured to report the amount of data received during the collection period without location information in the usage information, per each in or out of NG-RAN coverage period:\nA)\tshall indicate whether the data are received in or out of NG-RAN coverage;\nB)\tif the UE received data during in NG-RAN coverage period:\n-\tshall include the amount of data received during the in NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first reception during the in NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the indicator of which radio resources were used and radio frequency used; and\nC)\tif the UE received data during out of NG-RAN coverage period:\n-\tshall include the amount of data received during the out of NG-RAN coverage period;\n-\tif the UE is configured to report the time stamps of the first transmission/reception during the collection period in the usage information, shall include time stamp of the first reception during the out of NG-RAN coverage period; and\n-\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the used radio frequency;\nx)\tif the UE acts as a 5G ProSe UE-to-network relay UE, per each NG-RAN cell used during the 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE:\nA)\tshall include the NG-RAN cell global identification of the NG-RAN cell;\nB)\tshall include the amount of data relayed by the UE;\nC)\tshall include time stamp of the first data relay via the UE in the NG-RAN cell; and\nD)\tif the UE is configured to report the radio parameters used for 5G ProSe direct communication during the reporting period in the usage information, shall include the indicator of which radio resources were used and the radio frequency used; and\nxi)\tif the UE is configured to report QoS flow information, per each QoS flow identified by the PQFI:\nA)\tif the UE transmitted the QoS flow during the collection period:\n-\tshall include the time stamp for start of transmission of the QoS flow in the collection period;\n-\tshall include the time stamp for end of transmission of the QoS flow in the collection period;\n-\tshall include the (initial) PC5 QoS parameters of the QoS flow in the collection period as specified in clause 10.6.4.2;\n-\tshall include the amount of data of the QoS flow transmitted with the (initial) PC5 QoS parameters in the collection period; and\n-\tif the PC5 QoS parameters of the QoS flow were changed during the collection period, shall include the time stamp for start of transmission of the QoS flow with the new PC5 QoS parameters, the new PC5 QoS parameters of the QoS flow as specified in clause 10.6.4.2, and the amount of data of the QoS flow transmitted with the new PC5 QoS parameters in the collection period; or\nB)\tif the UE received the QoS flow during the collection period:\n-\tshall include the time stamp for start of reception of the QoS flow in the collection period;\n-\tshall include the time stamp for end of reception of the QoS flow in the collection period;\n-\tshall include the (initial) PC5 QoS parameters of the QoS flow in the collection period as specified in clause 10.6.4.2;\n-\tshall include the amount of data of the QoS flow received with the (initial) PC5 QoS parameters in the collection period; and\n-\tif the PC5 QoS parameters of the QoS flow were changed during the collection period, shall include the time stamp for start of reception of the QoS flow with the new PC5 QoS parameters, the new PC5 QoS parameters of the QoS flow as specified in clause 10.6.4.2, and the amount of data of the QoS flow received with the new PC5 QoS parameters in the collection period; and\n5)\tif configured radio parameters for the 5G ProSe direct communication applicable in the geographical area of the UE were used during the collection period, shall include the configured radio parameters for the 5G ProSe direct communication applicable in the geographical area of the UE; and\nc)\tfor each application specific data received from upper layers during the collection period, shall include the received application specific data.\nFigure 7.6.2.1.2.1 illustrates the interaction of the UE and the 5G DDNMF CTF (ADF) in the usage information report list sending procedure.\nThe figure depicts a usage information report list sending procedure, which is a crucial component of a network's operation. It outlines the steps and processes involved in sending usage information reports to network operators, ensuring that network performance and capacity are monitored and managed effectively.\nFigure 7.6.2.1.2.1: Usage information report list sending procedure\nUpon receiving a PROSE_USAGE_INFORMATION_REPORT_LIST message from UE, the 5G DDNMF CTF (ADF) triggers one or more charging data requests according to 3GPP TS 32.277 [45].\nIf the PROSE_USAGE_INFORMATION_REPORT_LIST message is accepted by the 5G DDNMF CTF (ADF), the 5G DDNMF CTF (ADF) shall send a PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message to the UE, containing a <response-accept> element with transaction ID set to the value of the transaction ID included in the PROSE_USAGE_INFORMATION_REPORT_LIST message.\nUpon receipt of the PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message containing a <response-accept> element with transaction ID set to the value of the transaction ID included in the PROSE_USAGE_INFORMATION_REPORT_LIST message, the usage information report list sending procedure is successfully completed.\nIf the PROSE_USAGE_INFORMATION_REPORT_LIST message is not accepted by the 5G DDNMF CTF (ADF), the 5G DDNMF CTF (ADF) shall send a PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message to the UE. In the PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message, the 5G DDNMF CTF (ADF):\n1)\tshall include a <response-reject> element with transaction ID set to the value of the transaction ID included in the PROSE_USAGE_INFORMATION_REPORT_LIST message; and\n2)\tshall include appropriate cause value.\nUpon receipt of the PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message containing a <response-reject> element with transaction ID set to the value of the transaction ID included in the PROSE_USAGE_INFORMATION_REPORT_LIST message, the usage information report list sending procedure is unsuccessfully completed.\nIf the PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message contains the cause value set to #3 \"Invalid message format\", the UE shall not perform the usage information report list sending procedure until the UE powers off and powers on again or the USIM is removed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.7\tCommunication path switching procedure between the direct communication path over Uu and the direct communication path over PC5",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.7.1\tGeneral",
                            "text_content": "This clause describes the procedures for path switching procedure between the direct communication path over Uu and the direct communication path over PC5.\nThe communication path of direct communication path over Uu refers to the communication path between two ProSe-enabled UEs that is performed via the network over Uu reference point. The communication path of direct communication path over PC5 refers to the communication path between two ProSe-enabled UEs that is performed via the unicast mode 5G ProSe direct communication over PC5 as specified in clause 7.2.\nThe principle of determining the ProSe applications to be switched is defined in clause 7.7.4.\nThe following procedures are defined for path switching procedure between the direct communication path over Uu and the direct communication path over PC5:\na)\tpath switching procedure from the direct communication path over Uu to the direct communication path over PC5; and\nb)\tpath switching procedure from the direct communication path over PC5 to the direct communication path over Uu.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.7.2\tPath switching procedure from the direct communication path over Uu to the direct communication path over PC5",
                            "text_content": "The purpose of the path switching procedure from the direct communication path over Uu to the direct communication path over PC5 is to enable a ProSe-enabled UE to switch the communication path from the direct communication path over Uu to the direct communication path over PC5 when the UE is communicating with another ProSe-enabled UE via the direct communication path over Uu.\nA UE may initiate a path switching procedure from the direct communication path over Uu to the direct communication path over PC5:\na)\twhen the peer UE that the UE is communicating with via the direct communication path over Uu is in proximity; or\nb)\twhen the UE needs to switch the communication path from the direct communication path over Uu to the direct communication path over PC5 on demand (e.g. to offload some traffic from the network, a request from upper layers, etc.).\nIn this procedure, the UE initiating the path switching procedure from the direct communication path over Uu to the direct communication path over PC5 is called the \"initiating UE\" and the peer UE that the \"initiating UE\" is communicating with is called the \"target UE\".\nThe initiating UE shall meet the following pre-conditions before initiating this procedure for switching the direct communication path over Uu to the direct communication path over PC5:\na)\tthe UE is configured with the configuration parameters for unicast mode 5G ProSe direct communication over PC5 interfaceas specified in clause 5.2.4.\nIn order to initiate the path switching procedure from the direct communication path over Uu to the direct communication path over PC5:\na)\tif there is an existing 5G ProSe direct link between the initiating UE and the target UE, the initiating UE shall:\n1)\tinitiate a 5G ProSe direct link modification procedure as specified in clause 7.2.3.2 with the following considerations in the PROSE DIRECT LINK MODIFICATION REQUEST message:\ni)\tthe PQFI(s), the corresponding PC5 QoS parameters, and the ProSe identifier(s) set to the parameters corresponding to the authorized ProSe application(s) for which the communication path switching procedure is to be performed according to the ProSe application to path switching mapping rules as specified in clause 5.2.4;\nii)\tthe link modification operation code set to \"Associate new ProSe application(s) with existing PC5 QoS flow(s)\", \"Modify PC5 QoS parameters of the existing PC5 QoS flow(s)\", or \"Add new PC5 QoS flow(s) to the existing 5G ProSe direct link\"; and\nNOTE 1:\tWhich link modification operation code is selected is up to UE implementations (e.g. based on the load of the existing 5G ProSe direct link).\niii)\tmay include the PC5 QoS rule(s) to indicate the packet filters of the PC5 QoS flow(s) corresponding to the authorized ProSe application(s) for which the communication path switching procedure is to be performed;\nAny parameter that is not mentioned above shall follow the definitions in clause 7.2.3.2.\nb)\telse, the initiating UE:\n1)\tmay initiate a 5G ProSe direct discovery procedure over PC5 interface with model B as specified in clause 6.2.14.2.2 with the following considerations in the PROSE PC5 DISCOVERY message:\ni)\tthe discoveree user info set to the application layer ID of the target UE provided by the upper layers (if available).\nAny parameter that is not mentioned above shall follow the definitions in clause 6.2.14.2.2; and\nNOTE 2:\tThe initiating UE is allowed to skip the 5G ProSe direct discovery procedure over PC5 interface with model B if the initiating UE ensures the target UE is in promixity. How the initiating UE ensure this is left to UE implementations.\n2)\tshall initiate a 5G ProSe direct link establishment procedure as specified in clause 7.2.2.2 with the following considerations in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message:\ni)\tthe ProSe identifier(s) set to the determined ProSe application(s) for which the communication path switching procedure is to be performed as specified in clause 7.7.4; and\nii)\tthe target user info set to the application layer ID of the target UE provided by the upper layers;\nAny parameter that is not mentioned above shall follow the definitions in clause 7.2.2.2.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION REQUEST message as specified in clause 7.7.2.2, if the received PROSE DIRECT LINK MODIFICATION REQUEST message is accepted by the target UE, the target UE shall respond with the PROSE DIRECT LINK MODIFICATION ACCEPT message as specified in clause 7.2.3.3.\nUpon receipt of the PROSE DIRECT LINK ESTABLISHMENT REQUEST message as specified in clause 7.7.2.2, if the received PROSE DIRECT LINK ESTABLISHMENT REQUEST message is accepted by the target UE, the target UE shall respond with the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message as specified in clause 7.2.2.3.\nThe PROSE DIRECT LINK MODIFICATION ACCEPT message or the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message is considered as the path switching procedure from the direct communication path over Uu to the direct communication path over PC5 is accepted by the target UE.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION ACCEPT message or the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, the initiating UE:\n1)\tshall perform the procedures as specified in clause 7.2.3.4 to complete the 5G ProSe direct link modification procedure, if the PROSE DIRECT LINK MODIFICATION ACCEPT message is received;\n2)\tshall perform the procedures as specified in clause 7.2.2.4 to complete the 5G ProSe direct link establishment procedure, if the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message is received; and\n3)\tshall perform the PC5 QoS flow establishment over 5G ProSe direct link as specified in clause 7.2.7 if bullet 2) is performed;\nThe path switching procedure from the direct communication path over Uu to the direct communication path over PC5 is considered as completed when the initiating UE has at least one PC5 QoS flow(s) over the 5G ProSe direct link for the determined ProSe application(s) for which the communication path switching procedure is to be performed.\nThe initiating UE shall then transmit the data traffic of the determined ProSe application(s) for which the communication path switching procedure is to be performed with the target UE as specified in clause 7.2.8 and clause 7.2.9 using the direct communication path over PC5.\nWhen the data traffic is successfully transmitted, the initiating UE or the target UE may perform either of the followings:\na)\tinitiate a UE-requested PDU session release procedure as specified in clause 6.4.3 of 3GPP TS 24.501 [11] if there are no more traffic transmitted over the PDU Session; or\nb)\tinitiate a UE-requested PDU session modification procedure as specified in clause 6.4.2 of 3GPP TS 24.501 [11] to request the deletion of the existing QoS flow description(s) corresponding to ProSe application(s) for which the path switching procedure from the direct communication path over Uu to the direct communication path over PC5 is performed.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION REQUEST message as specified in clause 7.7.2.2, if the received PROSE DIRECT LINK MODIFICATION REQUEST message is not accepted by the target UE, the target UE shall respond with the PROSE DIRECT LINK MODIFICATION REJECT message containing a PC5 signalling protocol cause IE as specified in clause 7.2.3.5.\nUpon receipt of the PROSE DIRECT LINK ESTABLISHMENT REQUEST message as specified in clause 7.7.2.2, if the received PROSE DIRECT LINK ESTABLISHMENT REQUEST message is not accepted by the target UE, the target UE shall respond with the PROSE DIRECT LINK ESTABLISHMENT REJECT message containing a PC5 signalling protocol cause IE as specified in clause 7.2.2.5.\nThe PROSE DIRECT LINK MODIFICATION REJECT message or the PROSE DIRECT LINK ESTABLISHMENT REJECT message is considered as the path switching procedure from the direct communication path over Uu to the direct communication path over PC5 is not accepted by the target UE.\nUpon receipt of the PROSE DIRECT LINK MODIFICATION REJECT message or the PROSE DIRECT LINK ESTABLISHMENT REJECT message, the initiating UE shall consider the path switching procedure from the direct communication path over Uu to the direct communication path over PC5 is not accepted by the target UE and perform the procedures as specified in clause 7.2.3.5 or clause 7.2.2.5 respectively.\nIf the 5G ProSe direct discovery procedure over PC5 interface with model B is initiated as specified in clause 7.7.2.2, and if:\na)\tthe condition of discoverer UE procedure for 5G ProSe direct discovery completion is met as specified in clause 6.2.14.2.2.3; and\nb)\tthe target UE that the initiating UE seeks to discover has not been discovered,\nhow to handle this for the initiating UE is up to UE implementations.\nThe following abnormal cases can be identified:\na)\tabnormal cases as specified in clause 7.2.2.6.1 shall apply if the 5G ProSe direct link establishment procedure as specified in clause 7.2.2.2 is initiated at the initiating UE (see clause 7.7.2.2); and\nb)\tabnormal cases as specified in clause 7.2.3.6.1 shall apply if the 5G ProSe direct link modification procedure as specified in clause 7.2.3.2 is initiated at the initiating UE (see clause 7.7.2.2).\nThe following abnormal cases can be identified:\na)\tabnormal cases as specified in clause 7.2.2.6.2 shall apply if the 5G ProSe direct link establishment procedure as specified in clause 7.2.2.2 is initiated at the target UE (see clause 7.7.2.3); and\nb)\tabnormal cases as specified in clause 7.2.3.6.2 shall apply if the 5G ProSe direct link modification procedure as specified in clause 7.2.3.2 is initiated at the target UE (see clause 7.7.2.3).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.7.3\tPath switching procedure from the direct communication path over PC5 to the direct communication path over Uu",
                            "text_content": "The purpose of the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu is to enable a ProSe-enabled UE to switch the communication path from the direct communication path over PC5 to the direct communication path over Uu when the UE is communicating with another ProSe-enabled UE via the direct communication path over PC5.\nFor communication with IP data unit type, the IP addresses, IPv6 prefixes, or both to be used for the direct communication path over Uu can be shared via the application layer over the existing PC5 connection, to assist the initiating UE and the target UE to establish the communication with each other via the direct communication path over the Uu.\nA UE may initiate a path switching procedure from the direct communication path over PC5 to the direct communication path over Uu:\na)\twhen the PC5 signal strength of the direct communication path over PC5 with the peer UE becomes weak (e.g. reaching a certain configured signal strength threshold); or\nb)\twhen the UE needs to switch the communication path from the direct communication path over PC5 to the direct communication path over Uu on demand (e.g. a request from upper layers).\nIn this procedure, the UE initiating the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu is called the \"initiating UE\" and the peer UE that the \"initiating UE\" is communicating with is called the \"target UE\".\nThe initiating UE shall meet the following pre-conditions before initiating this procedure for switching the direct communication path over PC5 to the direct communication path over Uu:\na)\tthe initiating UE and the target UE are communicating with each other via the 5G ProSe direct link over PC5 reference point; and\nb)\tthe communication mode of the 5G ProSe direct link is set to unicast mode.\nIn order to initiate the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu, the initiating UE initiates an implementation-specific timer to avoid a potential collision of the path switching procedure. When the implementation-specific timer expires, the initiating UE shall create a PROSE PATH SWITCHING REQUEST message. In the PROSE PATH SWITCHING REQUEST message, the initiating UE:\na)\tshall include the required ProSe identifiers set to the ProSe identifier(s) of the determined ProSe application(s) for which the communication path switching procedure is to be performed as specified in clause 7.7.4; and\nb)\tmay include the Uu QoS flow descriptions set to the requested QoS flow description for each ProSe identifier to be used in the communication path over Uu.\nNOTE 1:\tThe initiating UE derives the requested QoS flow description(s) based on the PC5 QoS parameters of the PC5 QoS flow(s) between the initiating UE and the target UE.\nAfter the PROSE PATH SWITCHING REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the source layer-2 ID and destination layer-2 ID used in the existing 5G ProSe direct link with the target UE and start timer T5098. The initiating UE shall not send a new PROSE PATH SWITCHING REQUEST message to the same target UE while timer T5098 is running.\nThe figure depicts a path switching procedure from the direct communication path over PC5 to the direct communication path over Uu, illustrating the step-by-step process of switching between these paths.\nFigure 7.7.3.2.1: Path switching procedure from the direct communication path over PC5 to the direct communication path over Uu\nUpon receipt of the PROSE PATH SWITCHING REQUEST message, the target UE determines as specified in clause 7.7.4 if there are at least one ProSe application(s) identified by the ProSe identifier(s) in the PROSE PATH SWITCHING REQUEST message that are able to perform the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu. If there are ProSe application(s) that are acceptable to be switched from the direct communication path over PC5 to the direct communication path over Uu, the target UE shall consider the PROSE PATH SWITCHING REQUEST is acceptable, and:\na)\tshall generate a PROSE PATH SWITCHING ACCEPT message. In the PROSE PATH SWITCHING ACCEPT message, the target UE:\n1)\tshall include the negotiated ProSe identifiers set to the ProSe identifier(s) of the ProSe application(s) that are acceptable to be switched from the direct communication path over PC5 to the direct communication path over Uu; and\nb)\tmay perform either of the following:\n1)\tinitiate the UE-requested PDU session establishment procedure as specified in clause 6.4.1 of 3GPP TS 24.501 [11] to establish a PDU session to be used for the direct communication path over Uu; or\n2)\tinitiate the UE-requested PDU session modification procedure as specified in clause 6.4.2 of 3GPP TS 24.501 [11] to modify a PDU session to be used for the direct communication path over Uu, with the Requested QoS flow descriptions IE set to the QoS flow descriptions if received in the PROSE PATH SWITCHING REQUEST message for the accepted ProSe application(s) to be switched to the direct communication path over Uu.\nAfter the PROSE PATH SWITCHING ACCEPT message is generated, the target UE shall pass this message to the lower layers for transmission along with the source layer-2 ID and destination layer-2 ID used in the existing 5G ProSe direct link with the initiating UE.\nUpon receipt of the PROSE PATH SWITCHING ACCEPT message, the initiating UE:\na)\tshall stop timer T5098; and\nb)\tmay perform either of the following:\n1)\tinitiate the UE-requested PDU session establishment procedure as specified in clause 6.4.1 of 3GPP TS 24.501 [11] to establish a PDU session to be used for the direct communication path over Uu; or\n2)\tinitiate the UE-requested PDU session modification procedure as specified in clause 6.4.2 of 3GPP TS 24.501 [11] to modify a PDU session to be used for the direct communication path over Uu, with the Requested QoS flow descriptions IE set to the QoS flow descriptions if sent in the PROSE PATH SWITCHING REQUEST message for the accepted ProSe application(s) to be switched to the direct communication path over Uu.\nThe initiating UE shall then transmit the data traffic of the negotiated ProSe application(s) with the target UE using the direct communication path over Uu. For the ProSe application(s) that the initiating UE requested but are not included in the negotiated ProSe identifier(s) IE, the initiating UE continues to use the direct communication path over PC5 for those applications until the 5G ProSe direct link is released.\nWhen the data traffic is successfully transmitted via the direct communication path over Uu, the initiating UE or the target UE may initiate a 5G ProSe direct link release procedure as specified in clause 7.2.6 if there are no more ProSe applications over the existing 5G ProSe direct link between the initiating UE and the target UE.\nNOTE:\tThe UE is allowed to maintain the existing 5G ProSe direct link in order to e.g. switch back from the direct communication path over Uu after the completion of the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu.\nUpon receipt of the PROSE PATH SWITCHING REQUEST message, if there is no ProSe application identified by the ProSe identifier in the PROSE PATH SWITCHING REQUEST message to perform the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu as specified in clause 7.7.4, the target UE shall consider the PROSE PATH SWITCHING REQUEST is not acceptable, and shall generate a PROSE PATH SWITCHING REJECT message. The PROSE PATH SWITCHING REJECT message contains a PC5 signalling protocol cause IE set to one of the following cause values:\n#18\tpath switching is not allowed for the ProSe applications;\n#20\tcommunication path over Uu is not available for path switching;\n#111\tprotocol error, unspecified.\nIf all the ProSe application(s) identified by the ProSe identifier(s):\na)\tare not able to perform the communication path switching procedure from the direct communication path over PC5 to the direct communication path over Uu as specified in clause 7.7.4; or\nb)\tare not able to be supported because of e.g the QoS requirements for the direct communication path over Uu;\nthe target UE shall send a PROSE PATH SWITCHING REJECT message with the PC5 signalling protocol cause value #18 \"path switching is not allowed for the ProSe applications\". In this case, the initiating UE may initiate another PROSE PATH SWITCHING REQUEST message for the ProSe application(s) that are not in the previous PROSE PATH SWITCHING REQUEST message with the same target UE.\nIf the communication path over Uu is not available to the target UE (because of e.g. week signal strength over Uu) for the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu, the target UE shall send a PROSE PATH SWITCHING REJECT message with the PC5 signalling protocol cause value #20 \"communication path over Uu is not available for path switching\".\nThe following abnormal cases can be identified:\na)\tExpiry of timer T5aaa:\nOn the first expiry of the timer T5098, the UE shall resend the PROSE PATH SWITCHING REQUEST message and shall reset and restart timer T5098. This retransmission is repeated two times, i.e. on the third expiry of timer T5098, the UE shall abort the procedure and consider the target UE is not in proximity or the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu is not accepted by the target UE.\nNOTE:\tAfter the third expiry of timer T5aaa, whether the UE performs path switching procedure to the direct communication path over Uu is up to UE implementations.\nb)\tFor the same 5G ProSe direct link, if the initiating UE receives a PROSE PATH SWITCHING REQUEST message during the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu, the initiating UE shall stop the timer T5aaa and abort the initiated procedure. Following handling is implementation dependent, e.g., the initiating UE waits for an implementation dependent time for initiating a new PROSE PATH SWITCHING REQUEST towards the target UE, if still needed.\nThe following abnormal cases can be identified:\na)\tFor the same 5G ProSe direct link, if the target UE is processing the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu and the implementation-specific timer as specified in clause 7.7.3.2 is not running, upon receipt of a PROSE PATH SWITCHING REQUEST message from the same initiating UE, the target UE shall ignore the new received PROSE PATH SWITCHING REQUEST message.\nb)\tFor the same 5G ProSe direct link, if the implementation-specific timer as specified in clause 7.7.3.2 is running, upon receipt of a PROSE PATH SWITCHING REQUEST message from the initiating UE, the target UE shall stop the implementation-specific timer, process the received PROSE PATH SWITCHING REQUEST message, and shall not initiate a path switching procedure from the direct communication path over PC5 to the direct communication path over Uu to the initiating UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.7.4\tPrinciples of determining the ProSe applications to be switched",
                            "text_content": "The UE evaluates the ProSe application to path preference mapping rules as specified in clause 5.2.4 according to the ProSe identifier of the ProSe application to obtain the preference from the network as follows:\na)\tif:\n1)\tthe ProSe application is running in the direct communication path over Uu; and\n2)\teither of the following:\ni)\tthe ProSe identifier of the ProSe application matches the ProSe identifiers field in the ProSe application to path preference mapping rule and the corresponding PP field in the ProSe application to path preference mapping rule is set to \"PC5 preferred\" (see 3GPP TS 24.555 [17]); or\nii)\tthe ProSe identifier of the ProSe application cannot match any ProSe identifiers field in the ProSe application to path preference mapping rule, the SI field in the ProSe application to path preference mapping rule is set to \"For all ProSe services\", and the PP field in the ProSe application to path preference mapping rule is set to \"PC5 preferred\" (see 3GPP TS 24.555 [17]);\nthe ProSe application is recommended by the network to perform the communication path switching from the direct communication path over Uu to the direct communication path over PC5;\nb)\tif:\n1)\tthe ProSe application is running in the direct communication path over Uu; and\n2)\teither of the following:\ni)\tthe ProSe identifier of the ProSe application matches the ProSe identifiers field in the ProSe application to path preference mapping rule and the corresponding PP field in the ProSe application to path preference mapping rule is set to \"Uu preferred\" (see 3GPP TS 24.555 [17]); or\nii)\tthe ProSe identifier of the ProSe application cannot match any ProSe identifiers field in the ProSe application to path preference mapping rule, the SI field in the ProSe application to path preference mapping rule is set to \"For all ProSe services\", and the PP field in the ProSe application to path preference mapping rule is set to \"Uu preferred\" (see 3GPP TS 24.555 [17]);\nthe ProSe application is recommended by the network not to perform the communication path switching from the direct communication path over Uu to the direct communication path over PC5;\nc)\tif:\n1)\tthe ProSe application is running in the direct communication path over PC5; and\n2)\teither of the following:\ni)\tthe ProSe identifier of the ProSe application matches the ProSe identifiers field in the ProSe application to path preference mapping rule and the corresponding PP field in the ProSe application to path preference mapping rule is set to \"Uu preferred\" (see 3GPP TS 24.555 [17]); or\nii)\tthe ProSe identifier of the ProSe application cannot match any ProSe identifiers field in the ProSe application to path preference mapping rule, the SI field in the ProSe application to path preference mapping rule is set to \"For all ProSe services\", and the PP field in the ProSe application to path preference mapping rule is set to \"Uu preferred\" (see 3GPP TS 24.555 [17]);\nthe ProSe application is recommended to perform the communication path switching from the direct communication path over PC5 to the direct communication path over Uu;\nd)\tif:\n1)\tthe ProSe application is running in the direct communication path over PC5; and\n2)\teither of the following:\ni)\tthe ProSe identifier of the ProSe application matches the ProSe identifiers field in the ProSe application to path preference mapping rule and the corresponding PP field in the ProSe application to path preference mapping rule is set to \"PC5 preferred\" (see 3GPP TS 24.555 [17]); or\nii)\tthe ProSe identifier of the ProSe application cannot match any ProSe identifiers field in the ProSe application to path preference mapping rule, the SI field in the ProSe application to path preference mapping rule is set to \"For all ProSe services\", and the PP field in the ProSe application to path preference mapping rule is set to \"PC5 preferred\" (see 3GPP TS 24.555 [17]);\nthe ProSe application is recommended by the network not to perform the communication path switching from the direct communication path over PC5 to the direct communication path over Uu; and\ne)\tin all other cases, the network has no preference.\nThe UE determines the ProSe applications to be switched with the consideration of the network preference as decribed above and maybe other criteria (e.g. availability of direct communication path over Uu, availability of direct communication path over PC5, requirements of the application, implementation-specific signal strength threshold, etc.).\nNOTE:\tThe UE can still choose to switch the communication to the non-preferred path of the network due to other criteria as decribed above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "8\t5G ProSe UE-to-network relay",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the procedures for 5G ProSe UE-to-network relay. The UE is configured with the related information as described in clause 5.2.5.\nFor the UE acting as a 5G ProSe layer-2 remote UE, the communication path switching between direct network communication path and indirect network communication path via the 5G ProSe layer-2 UE-to-network relay UE is supported as specified in clause 6.5.2.3 of 3GPP TS 23.304 [2].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.2\tProcedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.2.1\tUE-to-network relay discovery over PC5 interface",
                            "text_content": "This clause describes the procedures for both layer-3 and layer-2 UE-to-network relay discovery for public safety use and commercial services at a ProSe-enabled UE over the PC5 interface. The purpose of the UE-to-network relay discovery procedure over PC5 interface is to enable a ProSe-enabled UE to detect and identify another ProSe-enabled UE over PC5 interface for UE-to-network relay communication between a UE and 5GC.\nNOTE 1:\tRelaying Multicast/Broadcast Service traffic to a 5G ProSe remote UE by a 5G ProSe UE-to-network relay is not supported in this release of the specification.\nA 5G ProSe UE-to-network relay supporting multiple relay service codes can advertise the relay service codes using multiple discovery messages, with one relay service code per discovery message.\nDue to local regulations or implementation specific requirements and if the 5G ProSe layer-3 UE-to-network relay UE:\na)\tis using its own emergency service;\nb)\tis relaying the emergency service from one 5G ProSe layer-3 remote UE; or\nc)\treceived the emergency service support indicator for 3GPP access set to \"emergency services not supported\" in the latest REGISTRATION ACCEPT message from the AMF as specified in 3GPP TS 24.501 [11],\nthe 5G ProSe layer-3 UE-to-network relay UE shall not announce or respond to the 5G ProSe UE-to-network relay discovery message including the RSC specific for emergency service.\nNOTE 2a:\tThe prioritisation between the emergency calls of the 5G ProSe layer-3 UE-to-network relay UE itself and of the 5G ProSe layer-3 remote UE is determined by the local regulations, if available, otherwise it is left to the 5G ProSe layer-3 UE-to-network relay UE implementation.\nThe following principles for 5G ProSe UE-to-network relay apply when the 5G ProSe UE-to-network relay UE or the 5G ProSe remote UE is in service area restriction as defined in clause 5.3.5 of 3GPP TS 24.501 [11] , except the case when the 5G ProSe UE-to-network relay UE is relaying the emergency service for the 5G ProSe remote UE:\na)\tin non-allowed area of its serving PLMN, the 5G ProSe layer-3 UE-to-network relay UE is not allowed to perform relay operations (e.g., UE-to-network relay discovery as specified in clause 8.2.1, or accept the 5G ProSe direct link establishment procedure as specified in clause 7.2.2) except for e.g. high priority access as defined in clause 5.3.5 of 3GPP TS 24.501 [11] based on relay service codes as specified in clause 5.2.5;\nb)\tservice area restriction is not applicable to the 5G ProSe layer-3 remote UE;\nc)\tin non-allowed area of its serving PLMN, the 5G ProSe layer-2 UE-to-network relay UE is not allowed to perform relay operations (e.g., UE-to-network relay discovery as specified in clause 8.2.1, or accept the 5G ProSe direct link establishment procedure as specified in clause 7.2.2);\nd)\tin non-allowed area of its serving PLMN, the 5G ProSe layer-2 remote UE follows the same principles of service area restrictions as specified in clause 5.3.5 of 3GPP TS 24.501 [11] for communication with the network via the 5G ProSe layer-2 UE-to-network relay UE; and\ne)\twhen the 5G ProSe layer-2 remote UE is out of NG-RAN coverage, or is in allowed area of 5G ProSe layer-2 remote UE's serving PLMN, the 5G ProSe layer-2 remote UE follows the same principles of service area restrictions as specified in clause 5.3.5 of 3GPP TS 24.501 [11] for communication with the network via the 5G ProSe layer-2 UE-to-network relay UE if the 5G ProSe layer-2 remote UE determines that the 5G ProSe layer-2 UE-to-network relay UE is in the non-allowed area of the 5G ProSe layer-2 remote UE based on the TAI in the RRC container received from the 5G ProSe layer-2 UE-to-network relay UE.\nNOTE 2:\tClosed access group information is not specified for 5G ProSe.\nThe following principles for 5G ProSe UE-to-network relay apply when the relay UE or the 5G ProSe remote UE is in 5GS forbidden tracking areas as defined in clause 5.3.13 of 3GPP TS 24.501 [11]:\na)\tin a 5GS forbidden tracking area of its serving PLMN, the 5G ProSe UE-to-network relay UE is not allowed to perform relay operations;\nb)\tin a 5GS forbidden tracking area of its serving PLMN, the 5G ProSe remote UE is not allowed to access the network via the 5G ProSe UE-to-network relay UE unless the 5G ProSe remote UE is attempting for emergency service; and\nc)\twhen the 5G ProSe layer-2 remote UE is out of NG-RAN coverage, or is in NG-RAN coverage and not in a 5GS forbidden tracking area of its serving PLMN, the 5G ProSe layer-2 remote UE shall not access the network via this 5G ProSe layer-2 UE-to-network relay except for emergency service, if the 5G ProSe layer-2 remote UE determines that the 5G ProSe layer-2 UE-to-network relay UE is in the forbidden tracking area of the 5G ProSe layer-2 remote UE based on the TAI in the RRC container received from the 5G ProSe layer-2 UE-to-network relay UE.\nTo perform UE-to-network relay discovery over PC5 interface, the UE is configured with the related information as described in clause 5.2.5. The following models for UE-to-network relay discovery procedure over PC5 interface as specified in 3GPP TS 23.304 [2] are supported:\na)\tModel A uses a single discovery protocol message (Announcement); and\nb)\tModel B uses two discovery protocol messages (Solicitation and Response).\nNOTE 3:\tIf the UE is authorized to perform both 5G ProSe UE-to-network relay discovery Model A and 5G ProSe UE-to-network relay discovery Model B, it is up to UE implementation to select which model to perform or perform both models simultaneously.\nThe 5G ProSe UE-to-network relay UE and 5G ProSe layer-3 remote UE may use the PC5 DRX mechanism to perform 5G ProSe UE-to-network relay discovery over PC5 interface when the UE is not served by NG-RAN as specified in clause 5.2.5.\nThe following procedures are defined for UE-to-network relay discovery procedure over PC5 interface:\na)\tUE-to-network relay discovery over PC5 interface with Model A:\n1)\tAnnouncing UE procedure for UE-to-network relay discovery initiation;\n2)\tAnnouncing UE procedure for UE-to-network relay discovery completion;\n3)\tMonitoring UE procedure for UE-to-network relay discovery initiation;\n4)\tMonitoring UE procedure for UE-to-network relay discovery completion;\n5)\tAnnouncing UE procedure for UE-to-network relay discovery additional information; and\n6)\tMonitoring UE procedure for UE-to-network relay discovery additional information; and\nb)\tUE-to-network relay discovery over PC5 interface with Model B:\n1)\tDiscoverer UE procedure for UE-to-network relay discovery initiation;\n2)\tDiscoverer UE procedure for UE-to-network relay discovery completion;\n3)\tDiscoveree UE procedure for UE-to-network relay discovery initiation; and\n4)\tDiscoveree UE procedure for UE-to-network relay discovery completion.\nIn this procedure, the 5G ProSe UE-to-network relay UE acts as an \"announcing UE\" and the 5G ProSe remote UE acts as a \"monitoring UE\".\nThe purpose of the announcing UE procedure for UE-to-network relay discovery is:\na)\tto enable a ProSe-enabled UE to announce availability of a connectivity service provided by a UE-to-network relay of the ProSe-enabled UE to other ProSe-enabled UEs, upon a request from upper layers as defined in 3GPP TS 23.304 [2]; or\nb)\tto enable a ProSe-enabled UE to measure the PROSE PC5 DISCOVERY message signal strength between the ProSe-enabled UE and the 5G ProSe UE-to-network relay UE(s) for relay selection/reselection.\nThe UE is authorised to perform the announcing UE procedure for UE-to-network relay discovery if:\na)\tthe UE is authorised to act as a UE-to-network relay in the PLMN indicated by the serving cell as specified in clause 5.2.5, and\n1)\tthe UE is served by NG-RAN and the UE is authorised to perform 5G ProSe direct discovery in the PLMN as specified in clause 5; or\n2)\tthe UE is authorised to perform 5G ProSe direct discovery when not served by NG-RAN as specified in clause 5 and intends to use the provisioned radio resources for UE-to-network relay discovery;\nb)\tthe UE is configured with:\n1)\tthe relay service code parameter identifying the connectivity service to be announced as specified in clause 5.2.5 and the indicated security procedure for the relay service code is supported by the UE. For 5G ProSe layer-3 UE-to-network relay UE,\ni)\tthe S-NSSAI associated with that relay service code shall belong to the allowed NSSAI of the UE; and\nii)\tif the UE is camped on a cell whose TAI is in the list of \"non-allowed tracking areas\" or is camped on a cell whose TAI is not in the list of \"allowed tracking areas\", then the relay service code shall be associated with high priority access as defined in clause 5.3.5 of 3GPP TS 24.501 [11]; and\n2)\tthe User info ID for the UE-to-network relay discovery parameter as specified in clause 5.2.5;\nc)\tfor 5G ProSe layer-3 UE-to-network relay UE, the UE is configured with PDU Session parameters which is used for relayed traffic for the associated relay service code, as specified in clause 5.2.5; and\nd)\tthe back-off timer T3346 used for NAS mobility management congestion control as specified in clause 5.3.9 of 3GPP TS 24.501 [11] is not running at the UE;\notherwise, the UE is not authorised to perform the announcing UE procedure for UE-to-network relay discovery.\nFigure 8.2.1.2.2.2.1 illustrates the interaction of the UEs in the announcing UE procedure for UE-to-network relay discovery.\nThe figure depicts a simplified process for UE-to-network relay discovery in a 5G network. It illustrates the steps involved in identifying and selecting a relay for a UE to communicate with a network. The figure includes a series of numbered steps, each represented by a different color, to help understand the process. The steps are labeled as \"UE-to-network relay discovery,\" \"UE-to-network relay selection,\" and \"UE-to-network relay communication.\" The figure also includes a legend to help users understand the different colors and their meanings. Overall, the figure provides a clear and concise visual representation of the UE-to-network relay discovery process in a 5G network.\nFigure 8.2.1.2.2.2.1: Announcing UE procedure for UE-to-network relay discovery\nWhen the UE is triggered by an upper layer application to announce availability of a connectivity service provided by a UE-to-network relay, if the UE is authorised to perform the announcing UE procedure for UE-to-network relay discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages for relay discovery as specified in 3GPP TS 38.331 [13], shall perform a service request procedure or mobility registration procedure as specified in 3GPP TS 24.501 [11];\nb)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time as specified in clause 11.2.5;\nc)\tshall generate a PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement according to clause 10.2.1. In the PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement, the UE:\n1)\tshall set the announcer info parameter to the User info ID configured for the UE-to-network relay discovery, as specified in clause 5.2.5;\n2)\tshall set the relay service code parameter to the relay service code configured for the connectivity service to be announced, as specified in clause 5.2.5. The relay service code parameter is set to relay service code specific for emergency service if the UE is triggered by an upper layer application to announce availability of an emergency connectivity service provided by a UE-to-network relay, and either of the following:\ni)\tfor 5G ProSe layer-2 UE-to-network relay UE, the UE received an indication from the lower layers that the cell supports IMS emergency bearer services for UEs in limited service mode as specified in 3GPP TS 38.331 [13]; or\nii)\tfor 5G ProSe layer-3 UE-to-network relay UE, the EMC bit in the 5GS network feature support IE of the REGISTRATION ACCEPT message is not set to \"Emergency services not supported\" as specified in 3GPP TS 24.501 [11] and the UE is neither using its own emergency service nor relaying the emergency services from one 5G ProSe layer-3 remote UE;\n3)\tshall include the MIC field computed as described in 3GPP TS 33.503 [34], by using the UTC-based counter and the DUIK contained in the <UNR-discovery-security-parameters-accept> element of the PROSE_SECURITY_PARAM_RESPONSE message;\n4)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter;\n5)\tshall set the Resource Status Indicator bit of the status indicator parameter to indicate whether or not the UE has resources available to provide a connectivity service for additional ProSe-enabled UEs;\n6)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.8;\n7)\tif acting as 5G ProSe layer-2 UE-to-network relay UE, shall set the NCGI parameter to the NCGI of its serving cell; and\n8)\tif acting as 5G ProSe layer-2 UE-to-network relay UE, shall set the RRC container to the RRC container if provided by the lower layers;\nd)\tshall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.503 [34];\ne)\tshall set the destination layer-2 ID to the default destination layer-2 ID as specified in clause 5.2.5 and self-assign a source layer-2 ID for sending the UE-to-network relay discovery announcement; and\nNOTE 1:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2 and is different from any other self-assigned source layer-2 ID in use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a different discovery model as specified in clause 6.2.14.2.2.2, clause 6.2.15.2.2.2 and clause 8.2.1.3.1.2.\nf)\tshall pass the resulting PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement to the lower layers for transmission over the PC5 interface with the source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery.\nThe UE shall ensure that it keeps on passing the same PROSE PC5 DISCOVERY message along with the same source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission until the UE is triggered by an upper layer application to stop announcing availability of a connectivity service provided by a UE-to-network relay, or until the UE stops being authorised to perform the announcing UE procedure for UE-to-network relay discovery. How this is achieved is left up to UE implementation.\nNOTE 2:\tThe announcing UE can stop announcing UE procedure for UE-to-network relay discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the announcing UE is triggered by an upper layer application to stop announcing availability in a discovery group, or when the announcing UE stops being authorised to perform the announcing UE procedure for UE-to-network relay discovery, the UE shall instruct the lower layers to stop announcing.\nNOTE:\tThe announcing UE can stop announcing UE procedure for UE-to-network relay discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the UE stops announcing, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe purpose of the monitoring UE procedure for UE-to-network relay discovery is:\na)\tto enable a ProSe-enabled UE to become aware of proximity of a connectivity service provided by a UE-to-network relay, upon a request from upper layers as defined in 3GPP TS 23.304 [2]; or\nb)\tto enable a ProSe-enabled UE to perform measurements of signal strength of PROSE PC5 DISCOVERY messages from 5G ProSe UE-to-network relay UE(s) for relay selection/reselection.\nThe UE is authorised to perform the monitoring UE procedure for UE-to-network relay discovery if:\na)\tthe following is true:\n1)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe direct discovery using monitoring when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\n2)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe direct discovery monitoring in at least one PLMN; or\n3)\tthe UE is:\ni)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11] ; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\nii)\tauthorised to perform 5G ProSe direct discovery using monitoring when the UE is not served by NG-RAN, and:\nA)\tconfigured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN;\nb)\tthe UE is configured with the relay service code parameter identifying the connectivity service to be monitored, as specified in clause 5.2.5 and the indicated security procedure for the relay service code is supported by the UE; and\nc)\tfor 5G ProSe layer-2 remote UE, the UE is camped on a cell whose TAI is not in the list of \"non-allowed tracking areas\" or is camped on a cell whose TAI is in the list of \"allowed tracking areas\",\notherwise, the UE is not authorised to perform the monitoring UE procedure for UE-to-network relay discovery.\nFigure 8.2.1.2.3.2.1 illustrates the interaction of the UEs in the monitoring UE procedure for UE-to-network relay discovery.\nThe figure depicts a monitoring system for UE-to-network relay discovery in a 5G network. It shows the steps involved in the UE's procedure to discover a network relay, including the use of a UE-to-network relay discovery protocol. The figure illustrates the steps in the UE's procedure, such as the use of a relay discovery protocol, the identification of a network relay, and the communication between the UE and the network relay. The figure also shows the steps in the network's procedure, such as the identification of a UE-to-network relay, the communication between the UE and the network relay, and the communication between the network relay and the UE. The figure is important for understanding the communication process in a 5G network and for ensuring the reliability and security of the network.\nFigure 8.2.1.2.3.2.1: Monitoring UE procedure for UE-to-network relay discovery\nWhen the UE is triggered by the upper layers to monitor proximity of a connectivity service provided by a UE-to-network relay or when the UE decides to perform 5G ProSe UE-to-network relay reselection as specified in clause 8.2.3, and if the UE is authorised to perform the monitoring UE procedure for UE-to-network relay discovery, then the UE shall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY messages with the default destination layer-2 ID as specified in clause 5.2.5.\nIf the traffic descriptor is configured as specified in clause 5.2.5, the 5G ProSe layer-3 remote UE shall determine the monitored RSC by mapping the traffic from the upper layer application with the traffic descriptor as follows:\na)\tif there are at least one ProSe application traffic descriptor(s) to be used for the relayed traffic as specified in clause 5.2.5 which has not yet been evaluated,\n1)\tif the ProSe application traffic descriptor matches upper layer application information;\nthe UE shall select the RSC associated with the matched ProSe application traffic descriptor for monitoring, where:\ni) if more than one RSCs are associated with the upper layer application information and the monitored RSC for the 5G ProSe layer-3 remote UE is specific for emergency, the UE should prioritize selecting an RSC that does not provide an indication of using N3IWF access for the relayed traffic; or\nii) otherwise, it is up to UE implementation which RSC to select in this release of specification;\n2)\telse, the UE shall select the next ProSe application traffic descriptor which has not yet been evaluated and proceed to step 1);\nb)\telse, it is up to UE implementation which RSC to select, where if the monitored RSC for the 5G ProSe layer-3 remote UE is specific for emergency, the UE should prioritize selecting an RSC that does not provide an indication of using N3IWF access for the relayed traffic.\nNOTE 1:\tSelection of relay service code is up to UE implementation if there is no ProSe application traffic descriptor(s) configured in the UE.\nUpon reception of a PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement according to clause 10.2.1, for the target relay service code of the connectivity service which the UE is authorized to monitor, the UE shall use the associated DUSK, if received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used) and the UTC-based counter obtained during the monitoring operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used), the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used), the UE shall use the DUIK and the UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement.\nNOTE 2:\tThe use of an erroneous UTC-based counter for processing received PROSE PC5 DISCOVERY messages at the ProSe-enabled UE can cause MIC check failure after DUIK is used for integrity check and malformed contents after DUSK is used for unscrambling or DUCK is used for deciphering. How a ProSe-enabled UE ensures the accuracy of the UTC-based counter is left to UE implementation.\nNOTE 3:\tThe UE can determine the received PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement is for 5G ProSe direct discovery based on an indication from the lower layer.\nThen if:\na)\tthe relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement is the same as the relay service code parameter configured as specified in clause 5 for the connectivity service being monitored; and\nb)\tthe target announcer info is not provided by upper layers for the connectivity service being monitored, or the announcer info parameter of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement is the same as the target announcer info if the target annoucer info is provided by upper layers for the connectivity service being monitored,\nthen the UE shall consider that the connectivity service the UE seeks to monitor has been discovered. In addition, the UE can measure the signal strength of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement for relay selection or reselection.\nWhen the UE is triggered by an upper layer application to stop monitoring proximity of other UEs in a discovery group, or when the UE stops being authorised to perform the monitoring UE procedure for UE-to-network relay discovery, the UE shall instruct the lower layers to stop monitoring.\nWhen the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe purpose of the announcing UE procedure for relay discovery additional information is to announce to the 5G ProSe remote UEs additional information about:\na)\tthe NCGI of the cell serving the 5G ProSe layer-3 UE-to-network relay UE; and\nb)\tthe TAI of the cell serving the 5G ProSe layer-3 UE-to-network relay UE;\nas defined in 3GPP TS 23.304 [2].\nThe 5G ProSe UE-to-network relay UE announces the relay discovery additional information:\na)\tif the 5G ProSe remote UE requests the 5G ProSe UE-to-network relay UE to announce the NG-RAN Cell Global ID (NCGI) or TAI of the cell serving the 5G ProSe UE-to-network relay UE and as a response the 5G ProSe UE-to-network relay UE acknowledges with the ProSe additional parameters announcement response message, then the 5G ProSe UE-to-network relay UE includes the NCGI or TAI of the serving cell in the PROSE PC5 DISCOVERY message for relay discovery additional information until the timer T5107 expires (see clause 8.2.8).\nNOTE 1:\t5G ProSe UE-to-network relay UE announces the relay discovery additional information only when it is in NG-RAN coverage.\nFigure 8.2.1.2.4.2.1 illustrates the interaction of the 5G ProSe UE-to-network relay UE and the 5G ProSe remote UE in the announcing UE procedure for relay discovery additional information.\nThe figure depicts a relay discovery procedure for additional information, with a focus on the announcement of the procedure.\nFigure 8.2.1.2.4.2.1: Announcing procedure for relay discovery additional information\nThe 5G ProSe UE-to-network relay UE may start announcing relay discovery additional information if:\na)\tthe 5G ProSe UE-to-network relay UE is currently authorised to perform 5G ProSe direct discovery Model A announcing in the serving PLMN if the UE is served by NG-RAN, and\n1)\tadditional parameters announcement for the serving cell of the 5G ProSe UE-to-network relay UE has been requested and responded to 5G ProSe remote UEs, the timer T5107 has not expired (periodic reporting);\n2)\tadditional parameters announcement for the serving cell of the 5G ProSe UE-to-network relay UE has been requested and responded to 5G ProSe remote UEs, the timer T5107 has not expired and the 5G ProSe UE-to-network relay UE detects camping on a new serving cell; or\n3)\tadditional parameters announcement for the serving cell of the 5G ProSe UE-to-network relay UE has been requested and responded to 5G ProSe remote UEs, the timer T5107 has not expired and the 5G ProSe UE-to-network relay UE detects entering a new tracking area.\nWhen the 5G ProSe UE-to-network relay UE has some additional information to broadcast (i.e., NCGI, TAI), then the 5G ProSe UE-to-network relay UE:\na)\tshall request the parameters from the lower layers for ProSe direct discovery announcing (see 3GPP TS 38.331 [13]). If the 5G ProSe UE-to-network relay UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], the 5G ProSe UE-to-network relay UE shall perform a service request procedure or mobility registration procedure as specified in 3GPP TS 24.501 [11];\nb)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time as specified in clause 11.2.5;\nc)\tshall generate PROSE PC5 DISCOVERY message(s) for relay discovery additional information according to clause 10.2.1. In the PROSE PC5 DISCOVERY message for relay discovery additional information, the 5G ProSe UE-to-network relay UE shall:\n1)\tinclude the relay service code used for 5G ProSe direct communication which the 5G ProSe remote UE used to request for the relay discovery additional information;\n2)\tset the announcer info parameter to the User info ID parameter, configured in clause 5.2.5;\n3)\tset the NCGI parameter to the NCGI of the cell serving the UE, if the UE acts as 5G ProSe layer-3 UE-to-network relay UE and the NCGI is to be announced;\n4)\tset the Relay TAI parameter to the TAI of the cell serving the UE, if the UE acts as 5G ProSe layer-3 UE-to-network relay UE and the TAI is to be announced;\n5)\tinclude the MIC field computed as described in 3GPP TS 33.503 [34], by using the UTC-based counter and the DUIK contained in the <UNR-discovery-security-parameters-accept> element of the PROSE_SECURITY_PARAM_RESPONSE message;\n6)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter; and\n7)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.11;\nd)\tshall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.503 [34];\ne)\tshall set the default destination layer-2 ID as specified in clause 5.2.5 to the destination layer-2 ID and self-assign a source layer-2 ID for sending the UE-to-network relay discovery announcement; and\nNOTE 2:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2 and is different from any other self-assigned source layer-2 ID in use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a different discovery model as specified in clause 6.2.14.2.2.2, clause 6.2.15.2.2.2 and clause 8.2.1.3.1.2.\nf)\tshall pass the resulting PROSE PC5 DISCOVERY message for relay discovery additional information along with the source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface.\nThe 5G ProSe UE-to-network relay UE shall ensure that it keeps on passing the PROSE PC5 DISCOVERY messages periodically to the lower layers for transmission until the corresponding timer (i.e., timer T5107 when the additional information is NCGI or TAI) expires. How this is achieved is left up to UE implementation.\nNOTE 3:\tThe announcing UE can stop announcing UE procedure for relay discovery additional information for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nNOTE 4:\tThe periodicity of sending the PROSE PC5 DISCOVERY messages for relay discovery additional information by the 5G ProSe UE-to-network relay UE is implementation specific and is normally lower than the one related to the additional parameters announcement request refresh timer T5016.\nDuring the announcing operation, if one of the above conditions is no longer met, the 5G ProSe UE-to-network relay UE may instruct the lower layers to stop announcing.\nThe purpose of the monitoring UE procedure for relay discovery additional information is to enable a 5G ProSe remote UE to become aware of the additional information of the 5G ProSe UE-to-network relay UE as described in clause 8.2.1.2.4.1.\nThe 5G ProSe remote UE monitors relay discovery additional information:\na)\tuntil the additional parameters announcement request refresh timer T5016 expires if the 5G ProSe remote UE has requested the 5G ProSe UE-to-network relay UE to announce the NCGI or TAI of the cell serving the 5G ProSe UE-to-network relay UE and received the ProSe additional parameters announcement response message from the 5G ProSe UE-to-network relay UE.\nThe UE may instruct the lower layers to start monitoring if:\na)\ta request from upper layers to monitor for relay discovery additional information is still in place and either:\n1)\tthe UE is currently authorised to perform 5G ProSe direct discovery Model A monitoring in at least one PLMN if the UE is served by NG-RAN;\n2)\tthe UE is currently authorised to perform 5G ProSe direct discovery Model A monitoring if the UE is not served by NG-RAN; or\n3)\tthe UE is:\ni)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 36.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed \" as specified in 3GPP TS 24.501 [11]; and\nii)\tauthorised to perform 5G ProSe direct discovery Model A monitoring when the UE is not served by NG-RAN and configured with the radio parameters to be used for 5G ProSe direct discovery when not served by NG-RAN.\nIf the UE is in 5GMM-CONNECTED mode, the monitoring UE shall also trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nDuring the monitoring operation, if one of the above conditions is no longer met, the UE may instruct the lower layers to stop monitoring. When the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nUpon reception of a PROSE PC5 DISCOVERY message for relay discovery additional information according to clause 10.2.1, for the target relay service code to be monitored, the UE shall use the associated DUSK, if received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used) and the UTC-based counter obtained during the monitoring operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used), the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used), the UE shall use the DUIK and UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for relay discovery additional information.\nNOTE 1:\tThe use of an erroneous UTC-based counter for processing received PROSE PC5 DISCOVERY messages at the ProSe-enabled UE can cause MIC check failure after DUIK is used for integrity check and malformed contents after DUSK is used for unscrambling or DUCK is used for deciphering. How a ProSe-enabled UE ensures the accuracy of the UTC-based counter is left to UE implementation.\nNOTE 2:\tThe UE can determine the received PROSE PC5 DISCOVERY message for relay discovery additional information is for 5G ProSe direct discovery based on an indication from the lower layer.\nThen, if:\na)\tthe relay service code parameter of the PROSE PC5 DISCOVERY message for relay discovery additional information is the same as the relay service code parameter configured as specified in clause 5.2.5 for the connectivity service being monitored; and\nb)\tthe announcer info parameter of the PROSE PC5 DISCOVERY message for relay discovery additional information is the same as the target announcer info if the target announcer info is provided by upper layers or same as the User info ID of the 5G ProSe UE-to-network relay UE to which the 5G ProSe additional parameters announcement was requested and acknowledged as specified in clause 8.2.8,\nthen the UE shall consider that the relay discovery additional information it intends to monitor has been discovered. In addition, the UE can measure the signal strength of the PROSE PC5 DISCOVERY message for relay discovery additional information for relay selection or reselection.\nThe purpose of the discoverer UE procedure for UE-to-network Relay discovery is:\na)\tto enable a ProSe-enabled UE to solicit proximity of a connectivity service provided by a UE-to-network Relay, upon a request from upper layers; or\nb)\tto enable a ProSe-enabled UE to measure the PROSE PC5 DISCOVERY message signal strength between the ProSe-enabled UE and the 5G ProSe UE-to-network Relay UE(s) for relay selection/reselection.\nIn this procedure, the UE sending the PROSE PC5 DISCOVERY message is called the \"discoverer UE\" and the other UE is called the \"discoveree UE\".\nThe UE is authorised to perform the discoverer UE procedure for UE-to-network relay discovery if:\na)\tone of the following is true:\n1)\tthe UE is not served by NG-RAN, is authorised to act as a 5G ProSe remote UE towards a 5G ProSe UE-to-network relay UE and is configured with the radio parameters to be used for ProSe UE-to-network relay discovery when not served by NG-RAN;\n2)\tthe UE is served by NG-RAN, is authorised to act as a 5G ProSe remote UE towards a 5G ProSe UE-to-network relay UE; or\n3)\tthe UE is:\ni)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\nii)\tauthorised to act as a 5G ProSe remote UE towards a 5G ProSe UE-to-network relay UE when the UE is not served by NG-RAN and configured with the radio parameters to be used for ProSe UE-to-network relay discovery use when not served by NG-RAN;\nb)\tthe UE is configured with:\n1)\tthe relay service code parameter identifying the connectivity service to be solicited and the indicated security procedure for the relay service code is supported by the UE; and\n2)\tthe User info ID for the UE-to-network relay discovery parameter, as specified in clause 5.2.5; and\nc)\tfor 5G ProSe layer-2 remote UE, the UE is camped on a cell whose TAI is not in the list of \"non-allowed tracking areas\" or is camped on a cell whose TAI is in the list of \"allowed tracking areas\",\notherwise, the UE is not authorised to perform the discoverer UE procedure for UE-to-network relay discovery.\nFigure 8.2.1.3.1.2.1 illustrates the interaction of the UEs in the discoverer UE procedure for UE-to-network relay discovery.\nThe figure depicts the procedure for UE-to-network relay discovery in a 5G network. It illustrates the steps involved in identifying and selecting a relay for a UE to communicate with a network. The figure includes a diagram of the network, a flowchart, and a legend to help understand the process.\nFigure 8.2.1.3.1.2.1: Discoverer UE procedure for UE-to-network Relay discovery\nFor PROSE PC5 DISCOVERY message signal strength measurement, the UE manages a periodic measurement timer T5109, which is used to trigger the periodic PROSE PC5 DISCOVERY message signal strength measurement between the UE and the ProSe UE-to-network relay UE with which the UE has a link established. It is started whenever the UE has established a direct link with a 5G ProSe UE-to-network relay UE and restarted whenever the UE receives the PROSE PC5 DISCOVERY message for UE-to-network relay discovery response from the 5G ProSe UE-to-network relay UE with which the UE has a link established.\nWhen the UE is triggered by the upper layers to solicit proximity of a connectivity service provided by a 5G ProSe UE-to-network relay UE, or when the periodic measurement timer T5109 expires and if the UE is authorised to perform the discoverer UE procedure for UE-to-network relay discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages for relay discovery as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11];\nb)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nc)\tshall generate a PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation. In the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation, the UE:\n1)\tshall set the discoverer info parameter to the configured User info ID for the UE-to-network relay discovery parameter, as specified in clause 5.2.5;\n2)\tshall set the relay service code parameter to the relay service code parameter identifying the connectivity service to be solicited, configured in clause 5.2.5. For the 5G ProSe layer-3 remote UE, if the traffic descriptor is configured as specified in clause 5.2.5, the UE shall determine the RSC as follows:\ni)\tif there are at least one ProSe application traffic descriptor(s) to be used for the relayed traffic as specified in clause 5.2.5 which has not yet been evaluated,\nA)\tif the ProSe application traffic descriptor matches the upper layer application information;\nthe UE shall select the RSC associated with the matched ProSe application traffic descriptor for solicitation, where:\naa) if more than one RSCs are associated with the upper layer application information and the needed RSC for the 5G ProSe layer-3 remote UE is specific for emergency, the UE should prioritize selecting an RSC that does not provide an indication of using N3IWF access for the relayed traffic; or\nbb) otherwise, it is up to UE implementation which RSC to select in this release of specification;\nB)\telse, the UE shall select the next ProSe application traffic descriptor which has not yet been evaluated and proceed to step A);\nii)\telse, it is up to UE implementation which RSC to select, where if the needed RSC for the 5G ProSe layer-3 remote UE is specific for emergency, the UE should prioritize selecting an RSC that does not provide an indication of using N3IWF access for the relayed traffic.\nNOTE 1:\tSelection of relay service code is up to UE implementation if there is no ProSe application traffic descriptor(s) configured in the UE.\n3)\tshall include the MIC filed computed as described in 3GPP TS 33.503 [34] by using the UTC-based counter and the DUIK contained in the <UNR-discovery-security-parameters-accept> element of the PROSE_SECURITY_PARAM_RESPONSE message;\n4)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter;\n5)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.9; and\n6)\tmay include the target discoveree info parameter set to the user info ID of the targeted discoveree user if the target discoveree info is provided by the application layer;\nd)\tshall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.503 [34];\ne)\tshall set the default destination layer-2 ID as specified in clause 5.2.5 to the destination layer-2 ID and self-assign a source layer-2 ID for sending the UE-to-network relay discovery solicitation message; and\nNOTE 2:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2 and is different from any other self-assigned source layer-2 ID in use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a different discovery model as specified in clause 6.2.14.2.1.2, clause 6.2.15.2.1.2, clause 8.2.1.2.2.2 and clause 8.2.1.2.4.2.\nf)\tshall pass the resulting PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation along with the source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface.\nIf the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation is used to solicit proximity of a connectivity service provided by a 5G ProSe UE-to-network relay UE, the UE shall ensure that it keeps on passing the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation for transmission until the UE is triggered by an upper layer application to stop soliciting proximity of a connectivity service provided by a 5G ProSe UE-to-network relay UE, or until the UE stops being authorised to perform the discoverer UE procedure for UE-to-network relay discovery. How this is achieved is left up to UE implementation.\nNOTE 3:\tThe discoverer UE can stop discoverer UE procedure for UE-to-network relay discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nIf the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation is used to trigger the PROSE PC5 DISCOVERY message signal strength measurement between the UE and the 5G ProSe UE-to-network Relay UE with which the UE has a link established, the UE shall start the retransmission timer T5108. If retransmission timer T5108 expires, the UE shall retransmit the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation and restart timer T5108. If no response is received from the ProSe UE-to-network relay UE with which the UE has a link established after reaching the maximum number of allowed retransmissions, the UE shall trigger relay reselection procedure.\nNOTE 4:\tThe maximum number of allowed retransmissions is UE implementation specific.\nUpon reception of a PROSE PC5 DISCOVERY message for UE-to-network relay discovery response along with the destination layer-2 ID which the UE is configure to respond for, for the target relay service code of the connectivity service which the UE is authorized to discover, the UE shall use the associated DUSK, if received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used) and the UTC-based counter obtained during the reception operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used), the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used), the UE shall use the DUIK and the UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for UE-to-network relay discovery response.\nNOTE 5:\tThe UE can determine the received PROSE PC5 DISCOVERY message for UE-to-network relay discovery response is for 5G ProSe direct discovery based on an indication from the lower layer.\nThen if:\na)\tthe relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery response is the same as the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation; and\nb)\tthe target discoveree info is not provided by upper layers for the connectivity service being solicited, or the discoveree info parameter of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery response is the same as the target discoveree info if the target discoveree info is provided by upper layers for the connectivity service being solicited,\nthen the UE shall consider that the connectivity service the UE seeks to discover has been discovered. In addition, the UE can measure the signal strength of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery response for relay selection or reselection. If the UE has received the PROSE PC5 DISCOVERY message for UE-to-network relay discovery response from the ProSe UE-to-network Relay UE with which the UE has a link established, the UE shall stop the retransmission timer T5108 and start the periodic measurement timer T5109.\nWhen the UE is triggered by an upper layer application to stop soliciting for proximity of a connectivity service provided by a UE-to-network Relay, or when the UE stops being authorised to perform the Discoverer UE procedure for UE-to-network Relay discovery, the UE shall instruct the lower layers to stop the discoverer operation.\nNOTE:\tThe discoverer UE can stop discoverer UE procedure for UE-to-network relay discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the UE stops discoverer operation, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe purpose of the discoveree UE procedure for UE-to-network relay discovery is to enable a ProSe-enabled UE with a UE-to-network Relay to respond to solicitation from other ProSe-enabled UEs on proximity of a connectivity service provided by the 5G ProSe UE-to-network relay UE, upon a request from upper layers.\nIn this procedure, the UE sending the PROSE PC5 DISCOVERY message is called the \"discoverer UE\" and the other UE is called the \"discoveree UE\".\nThe UE is authorised to perform the discoveree UE procedure for UE-to-network relay discovery if:\na)\tthe UE is authorised to act as a 5G ProSe UE-to-network relay UE in the PLMN indicated by the serving cell, and\n1)\tthe UE is served by NG-RAN; or\n2)\tthe UE is not served by NG-RAN and intends to use the provisioned radio resources for UE-to-network relay discovery;\nb)\tthe UE is configured with:\n1)\tthe relay service code parameter identifying the connectivity service to be responded to as specified in clause 5.2.5 and the indicated security procedure for the relay service code is supported by the UE. For 5G ProSe layer-3 UE-to-network relay UE,\ni)\tthe S-NSSAI associated with that relay service code shall belong to the allowed NSSAI of the UE; and\nii)\tif the UE is camped on a cell whose TAI is in the list of \"non-allowed tracking areas\" or is camped on a cell whose TAI is not in the list of \"allowed tracking areas\", then the relay service code shall be associated with high priority access as defined in clause 5.3.5 of 3GPP TS 24.501 [11]; and\n2)\tthe User info ID for the UE-to-network relay discovery parameter, as specified in clause 5.2.5; and\nc)\tthe back-off timer T3346 used for NAS mobility management congestion control as specified in clause 5.3.9 of 3GPP TS 24.501 [11] is not running at the UE;\notherwise, the UE is not authorised to perform the discoveree UE procedure for UE-to-network relay discovery.\nFigure 8.2.1.3.2.2.1 illustrates the interaction of the UEs in the discoveree UE procedure for UE-to-network relay discovery.\nThe figure depicts a procedure for UE-to-network relay discovery in a 5G network. It illustrates the steps involved in identifying and selecting a relay for a UE to communicate with a network. The figure includes a diagram of the network topology, a flow chart, and a flow diagram, providing a clear and concise representation of the process.\nFigure 8.2.1.3.2.2.1: Discoveree UE procedure for UE-to-network Relay discovery\nWhen the UE is triggered by an upper layer application to start responding to solicitation on proximity of a connectivity service provided by the UE-to-network Relay and if the UE is authorised to perform the discoveree UE procedure for UE-to-network Relay discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11]; and\nb)\tshall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY messages.\nUpon reception of a PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation, for the relay service code of the connectivity service which the UE is authorized to respond, the UE shall use the associated DUSK, if received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used) and the UTC-based counter obtained during the reception operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used), the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network relay is used), the UE shall use the DUIK and the UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation.\nNOTE 1:\tThe UE can determine the received PROSE PC5 DISCOVERY message for 5G ProSe direct discovery announcement is for 5G ProSe direct discovery based on an indication from the lower layer.\nThen, if:\na)\tthe relay service code parameter of the received PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation is the same as the relay service code parameter configured as specified in clause 5.2.5 for the connectivity service; and\nb)\tthe target discoveree info parameter of the received PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation is the same as the user info ID for the UE-to-network relay discovery provided by upper layers or same as the configured user info ID for the UE-to-network relay discovery as specified in clause 5.2.5, if the target discoveree info parameter is included in the received PROSE PC5 DISCOVERY message;\nthen the UE:\na)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nb)\tshall generate a PROSE PC5 DISCOVERY message for UE-to-network relay discovery response. In the PROSE PC5 DISCOVERY message for UE-to-network relay discovery response, the UE:\n1)\tshall set the Discoveree info parameter to the configured User info ID for the UE-to-network Relay discovery parameter, as specified in clause 5.2.5;\n2)\tshall set the relay service code parameter to the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation. The relay service code parameter is set to relay service code specific for emergency service if the UE is triggered by an upper layer application to announce availability of an emergency connectivity service provided by a UE-to-network relay, and either of the following:\ni)\tfor 5G ProSe layer-2 UE-to-network relay UE, the UE received an indication from the lower layers that the cell supports IMS emergency bearer services for UEs in limited service mode as specified in 3GPP TS 38.331 [13]; or\nii)\tfor 5G ProSe layer-3 UE-to-network relay UE, the EMC bit in the 5GS network feature support IE of the REGISTRATION ACCEPT message is not set to \"Emergency services not supported\" as specified in 3GPP TS 24.501 [11] and the UE is neither using its own emergency service nor relaying the emergency services from one 5G ProSe layer-3 remote UE;\n3)\tshall set the Resource Status Indicator bit of the status indicator parameter to indicate whether or not the UE has resources available to provide a connectivity service for additional ProSe-enabled UEs;\n4)\tshall include the MIC filed computed as described in 3GPP TS 33.503 [34] by using the UTC-based counter and the DUIK contained in the <UNR-discovery-security-parameters-accept> element of the PROSE_SECURITY_PARAM_RESPONSE message;\n5)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter;\n6)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.10;\n7)\tif acting as 5G ProSe layer-2 UE-to-network relay UE, shall set the NCGI parameter to the NCGI of its serving cell; and\n8)\tif acting as 5G ProSe layer-2 UE-to-network relay UE, shall set the RRC container to the RRC container if provided by the lower layers;\nc)\tshall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.503 [34];\nd)\tshall set the destination layer-2 ID to the source layer-2 ID from the discoverer UE used in the transportation of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation and self-assign a source layer-2 ID for sending the UE-to-network relay discovery response message; and\nNOTE 2:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\ne)\tshall pass the resulting PROSE PC5 DISCOVERY message for UE-to-network relay discovery response along with the source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface.\nNOTE 3:\tIf the UE is processing a PROSE DIRECT LINK ESTABLISHMENT REQUEST message from the same source layer-2 ID of the received PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation, it depends on UE implementation to avoid the conflict of destination layer-2 ID (e.g. send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for unicast communication is detected\", or ignore the PROSE DIRECT DISCOVERY message for UE-to-network relay discovery solicitation).\nWhen the UE is triggered by an upper layer application to stop responding to solicitation on proximity of a connectivity service provided by a 5G ProSe UE-to-network relay UE, or when the UE stops being authorised to perform the discoveree UE procedure for UE-to-network relay discovery, the UE shall instruct the lower layers to stop monitoring.\nWhen the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nWhen the UE is not served by NG-RAN for 5G ProSe UE-to-network relay discovery and is authorized to use 5G ProSe UE-to-network relay discovery, the UE shall select the corresponding radio parameters to be used for 5G ProSe UE-to-network relay discovery as follows:\na)\tif the UE can determine itself located in a geographical area and the UE is provisioned with radio parameters for the geographical area, the UE shall select the radio parameters associated with that geographical area; or\nb)\tin all other cases, the UE shall not initiate 5G ProSe UE-to-network relay discovery.\nIf the UE intends to use \"non-operator managed\" radio parameters as specified in clause 5.2.5, the UE shall initiate 5G ProSe UE-to-network relay discovery with the selected radio parameters.\nIf the UE intends to use \"operator managed\" radio parameters as specified in clause 5.2.5, before initiating 5G ProSe UE-to-network relay discovery, the UE shall check with lower layers whether the selected radio parameters can be used in the current location without causing interference to other cells as specified in 3GPP TS 38.331 [13]; and:\na)\tif the lower layers indicate that the usage would not cause any interference, the UE shall initiate 5G ProSe UE-to-network relay discovery; or\nNOTE:\tIf the lower layers find that there exists a cell operating the provisioned radio resources (i.e., carrier frequency) and the cell belongs to the registered PLMN or a PLMN equivalent to the registered PLMN and the UE is authorized for 5G ProSe UE-to-network relay discovery in this PLMN, the UE can use the radio parameters indicated by the cell as specified in 3GPP TS 38.331 [13].\nb)\telse if the lower layers report that one or more PLMNs operate in the provisioned radio resources (i.e., carrier frequency) then:\n1)\tif the following conditions are met:\ni)\tnone of the PLMNs reported by the lower layers is the registered PLMN or equivalent to the registered PLMN;\nii)\tat least one of the PLMNs reported by the lower layers is in the list of authorized PLMNs for 5G ProSe UE-to-network relay discovery and provides radio resources for 5G ProSe UE-to-network relay discovery as specified in 3GPP TS 38.331 [13]; and\niii)\tthe UE does not have an emergency PDU session;\nthen the UE shall:\ni)\tif in 5GMM-IDLE mode, perform PLMN selection triggered by 5G ProSe UE-to-network relay discovery as specified in 3GPP TS 23.122 [14]; or\nii)\telse if in 5GMM-CONNECTED mode, either:\nA)\tperform a De-registration procedure as specified in 3GPP TS 24.501 [11] and then perform PLMN selection triggered by 5G ProSe UE-to-network relay discovery as specified in 3GPP TS 23.122 [14]; or\nB)\tnot initiate 5G ProSe direct discovery.\nWhether the UE performs i) or ii) above is left up to UE implementation; or\n2)\telse the UE shall not initiate 5G ProSe UE-to-network relay discovery.\nIf the registration to the selected PLMN is successful, the UE shall proceed with the procedure to initiate 5G ProSe UE-to-network relay discovery as specified in clause 8.2.1.\nIf the UE is performing 5G ProSe UE-to-network relay discovery using radio parameters associated with a geographical area and moves out of that geographical area, the UE shall stop performing 5G ProSe UE-to-network relay discovery and then if the UE is not served by NG-RAN for 5G ProSe UE-to-network relay discovery, the UE shall select appropriate radio parameters for the new geographical area as specified above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.2\tUE-to-network relay selection procedure",
                            "text_content": "The purpose of the UE-to-network relay selection procedure is to enable a 5G ProSe remote UE to select a suitable 5G ProSe UE-to-network relay UE to obtain a connectivity service to 5GC.\nThe 5G ProSe remote UE shall trigger the UE-to-network relay selection procedure if the following conditions are met:\na)\tthe UE is authorised to act as a 5G ProSe remote UE towards a 5G ProSe UE-to-network relay UE as specified in clause 5.2.5:\n1)\tif the 5G ProSe remote UE is expected to use 5G ProSe layer-3 UE-to-network relay, the indication whether the UE is authorized to use a 5G ProSe layer-3 UE-to-network relay UE shall be set;\n2)\tif the 5G ProSe remote UE is expected to use 5G ProSe layer-2 UE-to-network relay, the subset of the PLMN(s) provided by the 5G ProSe layer-2 UE-to-network relay UE shall be in the list of PLMNs in which the UE is authorized to use a 5G ProSe layer-2 UE-to-network relay UE; and\n3)\tif the 5G ProSe remote UE is expected to use 5G ProSe layer-2 UE-to-network relay, the 5G ProSe remote UE selected PLMN shall be in the list of PLMNs in which the UE is authorized to use a 5G ProSe layer-2 UE-to-network relay UE and in the subset of the PLMN(s) provided by the 5G ProSe layer-2 UE-to-network relay UE;\nb)\tthe UE has obtained a list of 5G ProSe UE-to-network relay UE candidate(s) fulfilling ProSe layer criteria with the monitoring procedure for UE-to-network relay discovery as specified in clause 8.2.1.2.3 or the discoverer procedure for UE-to-network relay discovery as specified in clause 8.2.1.3.1; and\nc)\tthe UE has obtained a list of 5G ProSe UE-to-network relay UE candidate(s) fulfilling lower layers criteria as specified in 3GPP TS 38.331 [13].\nNOTE:\tIt is left to UE implementation on how UE handles the case when there is no appropriate 5G ProSe UE-to-network relay UE around.\nIf there exists only one 5G ProSe UE-to-network relay UE candidate satisfying the conditions in clause 8.2.2.2, then that 5G ProSe UE-to-network relay UE is selected. If there exist more than one 5G ProSe UE-to-network relay candidate satisfying the conditions in clause 8.2.2.2, any relay candidates not satisfying the non-radio related ProSe layer criteria shall be discarded and out of the remaining relay candidates, the relay candidate with the highest ranking of the lower layer criteria shall be selected. The UE may take the value of the resource status indicator bit of the status indicator parameter of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement or PROSE PC5 DISCOVERY message for UE-to-network relay discovery response into account when deciding which 5G ProSe UE-to-network relay to select. It is up to the UE implementation whether the ProSe layer or the lower layers takes the final selection on which 5G ProSe UE-to-network relay UE to select.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.3\tUE-to-network relay reselection procedure",
                            "text_content": "The purpose of the UE-to-network relay reselection procedure is to enable a 5G ProSe remote UE to reselect a 5G ProSe UE-to-network relay UE to obtain a connectivity service to 5GC when the serving 5G ProSe UE-to-network relay UE is no longer suitable.\nThe 5G ProSe remote UE shall trigger the UE-to-network relay reselection procedure if one of the following conditions is met:\na)\tthe UE has received a lower layers indication that the serving 5G ProSe UE-to-network relay UE no longer fulfills the lower layers criteria as specified in 3GPP TS 38.331 [13];\nb)\tthe parameters related to 5G ProSe UE-to-network relay in the configuration parameters for 5G ProSe UE-to-network relay as specified in clause 5.2.5 (e.g., relay service code, User info ID, etc.) have been updated and the serving 5G ProSe UE-to-network relay UE no longer fulfills the conditions specified in clause 8.2.2.2;\nc)\tthe UE has received a PROSE DIRECT LINK ESTABLISHMENT REJECT message from the 5G ProSe UE-to-network relay UE with the PC5 signalling protocol cause value #1 \"direct communication to the target UE not allowed\";\nd)\tthe UE has received a PROSE DIRECT LINK RELEASE REQUEST message from the 5G ProSe UE-to-network relay UE with the PC5 signalling protocol cause value #1 \"direct communication to the target UE not allowed\";\ne)\tthe UE has received a PROSE DIRECT LINK RELEASE REQUEST message from the 5G ProSe UE-to-network relay UE with the PC5 signalling protocol cause value #4 \"direct connection is not available anymore\";\nf)\tthe UE has not received any response from the 5G ProSe UE-to-network relay UE after M consecutive retransmissions of PROSE DIRECT LINK ESTABLISHMENT REQUEST or PROSE DIRECT LINK KEEPALIVE REQUEST messages;\ng)\tthe UE has not received any response from the 5G ProSe UE-to-network relay UE after M consecutive retransmissions of PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation used to trigger the PROSE PC5 DISCOVERY message signal strength measurement between the UE and the 5G ProSe UE-to-network relay UE with which the UE has a link established;\nNOTE:\tThe value of M is implementation specific and is less than or equal to the maximum number of retransmissions allowed for PC5 signalling protocol.\nh)\tthe UE has received a PROSE DIRECT LINK ESTABLISHMENT REJECT message from the ProSe UE-to-network relay UE with the cause value #13 \"congestion situation\";\ni)\tthe UE has received a PROSE DIRECT LINK RELEASE REQUEST message from the ProSe UE-to-network relay UE with the cause value #13 \"congestion situation\"; or\nj)\tthe UE has received a PROSE DIRECT LINK ESTABLISHMENT REJECT message from the 5G ProSe UE-to-network relay UE with the cause value #15 \"security procedure failure of 5G ProSe UE-to-network relay\".\nIn cases c), d), h) and i), the 5G ProSe remote UE shall exclude the 5G ProSe UE-to-network relay UE which sent the message specified in cases c), d), h) or i) from the UE-to-network relay reselection process described below (at least for the indicated back-off time period if provided from the ProSe UE-to-network relay UE in cases h) and i)).\nIn case j), when the 5G ProSe remote UE has included the UE identity IE set to SUCI in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, the 5G ProSe remote UE shall exclude the 5G ProSe UE-to-network relay UE which sent the message specified in case j) from the UE-to-network relay reselection process described below.\nTo conduct UE-to-network relay reselection process, the UE shall first initiate one of the following procedures or both depending on UE's configuration parameters for 5G ProSe UE-to-network relay as specified in clause 5.2.5:\na)\tmonitoring procedure for UE-to-network relay discovery as specified in clause 8.2.1.2.3; or\nb)\tdiscoverer procedure for UE-to-network relay discovery as specified in clause 8.2.1.3.1.\nAfter the execution of the above discovery procedure(s), the 5G ProSe remote UE performs the UE-to-network relay selection procedure as specified in clause 8.2.2.\nNOTE:\tIt is left to UE implementation on how UE handles the case when there is no appropriate 5G ProSe UE-to-network relay UE around.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.4\tProcedure for UE to use provisioned radio resources for 5G ProSe UE-to-network relay communication",
                            "text_content": "When the UE is not served by NG-RAN for 5G ProSe UE-to-network relay communication and is authorized to use 5G ProSe UE-to-network relay communication, the UE shall select the corresponding radio parameters to be used for 5G ProSe UE-to-network relay communication as follows:\na)\tif the UE can determine itself located in a geographical area and the UE is provisioned with radio parameters for the geographical area, the UE shall select the radio parameters associated with that geographical area; or\nb)\tin all other cases, the UE shall not initiate 5G ProSe UE-to-network relay communication.\nIf the UE intends to use \"non-operator managed\" radio parameters as specified in clause 5.2.5, the UE shall initiate 5G ProSe UE-to-network relay communication with the selected radio parameters.\nIf the UE intends to use \"operator managed\" radio parameters as specified in clause 5.2.5, before initiating 5G ProSe UE-to-network relay communication, the UE shall check with lower layers whether the selected radio parameters can be used in the current location without causing interference to other cells as specified in 3GPP TS 38.331 [13]; and:\na)\tif the lower layers indicate that the usage would not cause any interference, the UE shall initiate 5G ProSe UE-to-network relay communication; or\nNOTE:\tIf the lower layers find that there exists a cell operating the provisioned radio resources (i.e., carrier frequency) and the cell belongs to the registered PLMN or a PLMN equivalent to the registered PLMN and the UE is authorized for 5G ProSe UE-to-network relay communication in this PLMN, the UE can use the radio parameters indicated by the cell as specified in 3GPP TS 38.331 [13].\nb)\telse if the lower layers report that one or more PLMNs operate in the provisioned radio resources (i.e., carrier frequency) then:\n1)\tif the following conditions are met:\ni)\tnone of the PLMNs reported by the lower layers is the registered PLMN or equivalent to the registered PLMN;\nii)\tat least one of the PLMNs reported by the lower layers is in the list of authorized PLMNs for 5G ProSe UE-to-network relay communication and provides radio resources for 5G ProSe UE-to-network communication as specified in 3GPP TS 38.331 [13]; and\niii)\tthe UE does not have an emergency PDU session;\nthen the UE shall:\ni)\tif in 5GMM-IDLE mode, perform PLMN selection triggered by 5G ProSe UE-to-network discovery as specified in 3GPP TS 23.122 [14]; or\nii)\telse if in 5GMM-CONNECTED mode, either:\nA)\tperform a De-registration procedure as specified in 3GPP TS 24.501 [11] and then perform PLMN selection triggered by 5G ProSe UE-to-network discovery as specified in 3GPP TS 23.122 [14]; or\nB)\tnot initiate 5G ProSe UE-to-network communication.\nWhether the UE performs i) or ii) above is left up to UE implementation; or\n2)\telse the UE shall not initiate 5G ProSe UE-to-network relay communication.\nIf the registration to the selected PLMN is successful, the UE shall proceed with the procedure to initiate 5G ProSe communication over PC5 as specified in clause 7.2.\nIf the UE is performing 5G ProSe UE-to-network relay communication using radio parameters associated with a geographical area and moves out of that geographical area, the UE shall stop performing 5G ProSe UE-to-network relay communication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.5\tIP address allocation for 5G ProSe remote UE in 5G ProSe layer-3 UE-to-network relay procedure",
                            "text_content": "When one of the two UEs on the direct link acts as a 5G ProSe layer-3 UE-to-network relay UE, the PDU session type is IPv4, IPv6 or IPv4v6 and is used for relaying IP traffic over PC5 reference point, the two UEs shall select the IP version (IPv4 or IPv6) to be used based on the following rules:\na)\tif the 5G ProSe layer-3 UE-to-network relay UE has indicated \"DHCPv4 Server\" in the IP address configuration IE, the 5G ProSe remote UE shall initiate the IPv4 address configuration with DHCPv4 procedure acting as a DHCP client, according to IETF RFC 2131 [23] and IETF RFC 4039 [24];\nb)\tif the 5G ProSe layer-3 UE-to-network relay UE has indicated \"IPv6 Router\" in the IP address configuration IE, the 5G ProSe remote UE shall initiate the IPv6 address configuration with IPv6 stateless address auto-configuration acting as an IPv6 host based on IETF RFC 4862 [25];\nNOTE:\tThe 5G ProSe layer-3 UE-to-network relay UE uses IPv6 prefix delegation via DHCPv6 (see clause 8.2.5a) to obtain the IPv6 prefix assigned to the 5G ProSe layer-3 remote UE.\nc)\tif the 5G ProSe layer-3 UE-to-network relay UE has indicated \"IPv6 Router\" in the IP address configuration IE, the 5G ProSe remote UE may use stateless DHCPv6 for additional parameter configuration, as defined in TS 23.501 [22]; and\nd)\tif the 5G ProSe layer-3 UE-to-network relay UE has indicated \"DHCPv4 Server & IPv6 Router\" in the IP address configuration IE, the 5G ProSe remote UE shall choose the IP version and initiate the corresponding IP address configuration procedure as a client or host.\nIf the UE:\na)\tis acting as a 5G ProSe layer-3 UE-to-network relay UE;\nb)\tthe SSC mode of the PDU session is SSC mode 3; and\nc)\treceives a 5GSM cause value #39 \"reactivation requested\" as specified in clause 6.3.2.3 of 3GPP TS 24.501 [11],\nthe UE advertises new IP address to be used by the 5G ProSe remote UE as defined in RFC 4862 [25]. The two UEs shall select the IP version according to the rules above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.5a\tIPv6 prefix delegation via DHCPv6 for 5G ProSe layer-3 UE-to-network relay",
                            "text_content": "If the 5G ProSe layer-3 UE-to-network relay UE can indicate \"IPv6 Router\" or \"DHCPv4 Server & IPv6 Router\" in the IP address configuration IE, the 5G ProSe layer-3 UE-to-network relay UE requests additional IPv6 prefixes (i.e., prefixes in addition to the /64 default prefix which was allocated via stateless IPv6 address autoconfiguration) from the SMF as specified in 3GPP TS 24.501 [11].\nOnce the 5G ProSe layer-3 UE-to-network relay UE successfully obtains the network prefix shorter than the default /64 prefix using DHCPv6, the 5G ProSe layer-3 UE-to-network relay UE can assign /64 prefix from the network prefix when the 5G ProSe layer-3 remote UE requests IPv6 prefix via stateless IPv6 address autoconfiguration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.6\tQoS handling for 5G ProSe UE-to-network relay",
                            "text_content": "This clause describes the QoS handling between a 5G ProSe UE-to-network relay UE and a 5G ProSe remote UE. The purpose of QoS handling for 5G ProSe UE-to-network relay is to meet the end-to-end QoS requirement between 5G ProSe remote UE and the network.\nThe QoS handling for 5G ProSe UE-to-network relay can be classified with the following three cases according to the type of 5G ProSe UE-to-network relay:\na)\tQoS handling for 5G ProSe remote UE accessing the network via a 5G ProSe layer-2 UE-to-network relay;\nb)\tQoS handling for 5G ProSe remote UE accessing the network via a 5G ProSe layer-3 UE-to-network relay without N3IWF; and\nc)\tQoS handling for 5G ProSe remote UE accessing the network via a 5G ProSe layer-3 UE-to-network relay with N3IWF.\nFor a 5G ProSe layer-2 remote UE accessing the network via a 5G ProSe layer-2 UE-to-network relay, the end-to-end QoS requirement between 5G ProSe layer-2 remote UE and the network can be met by the existing 5G QoS control between the 5G ProSe layer-2 remote UE and the core network that is serving the 5G ProSe layer-2 remote UE as specified in 3GPP TS 24.501 [11].\nThe QoS handling by a 5G ProSe layer-3 UE-to-network relay without an N3IWF to achieve an end-to-end QoS between the 5G ProSe layer-3 remote UE and the network is described in clause 5.6.2.1 of 3GPP TS 23.304 [2].\nFor a 5G ProSe layer-3 remote UE accessing the network via a 5G ProSe layer-3 UE-to-network relay without N3IWF, the end-to-end QoS requirement between 5G ProSe layer-3 remote UE and the network can be satisfied by the corresponding QoS control:\na)\tQoS control between 5G ProSe layer-3 remote UE and 5G ProSe layer-3 UE-to-network relay UE (PC5 QoS control); and\nb)\tQoS control between 5G ProSe layer-3 UE-to-network relay UE and the network (Uu QoS control).\nTo achieve this, the QoS mapping can be pre-configured as specified in clause 5.2.5 or provided to the 5G ProSe UE-to-network relay UE by the PCF using Prose Policy as specified in clause 5.3.2.\nFor QoS flows setup initiated by the network, upon reception QoS rules and QoS flow level QoS parameters from the SMF, the 5G ProSe layer-3 UE-to-network relay UE:\na)\tshall determine the PQI based on the QoS mapping rules configured in clause 5.2.5;\nb)\tshall set the GFBR value for the PC5 GBR QoS flow to the GFBR value from the SMF, if any;\nc)\tshall set the MFBR value for the PC5 GBR QoS flow to the MFBR value from the SMF, if any;\nd)\tshall set the averaging window value for the PC5 GBR QoS flow to the averaging value from the SMF, if any;\ne)\tmay derive the packet filter(s) used for PC5 QoS rule(s) from the packet filter(s) used over Uu reference; and\nf)\tmay initiate the 5G ProSe direct link modification procedure(s) as defined in clause 7.2.3 to either update the existing PC5 QoS flow or to set up a new PC5 QoS flow. The 5G ProSe layer-3 UE-to-network relay UE may include the PC5 QoS rule(s) when initiating the 5G ProSe direct link modification procedure toward a 5G ProSe layer-3 remote UE for which the IP address associated to the 5G ProSe layer-3 remote UE is included in the packet filter(s) used over Uu.\nAlternatively, for dynamic QoS handling of 5G ProSe layer-3 remote UE using reflective QoS mechanism, upon the 5G ProSe layer-3 UE-to-network relay UE receiving a downlink user data packet along with the Reflective QoS Indication (RQI) as specified in 3GPP TS 24.501 [11], the 5G ProSe layer-3 UE-to-network relay UE:\na)\tcreates a derived QoS rule by reflective QoS in the UE as specified in clause 6.2.5.1.4, 3GPP TS 24.501 [11];\nb)\tshall create a new derived PC5 QoS rule or update the existing derived PC5 QoS rule for the PC5 QoS flow based on the derived QoS rule from a);\nc)\tshall determine the corresponding PQI for the PC5 QoS flow based on the QoS mapping rules as specified in clause 5.2.5 and the 5QI value that corresponds to the QFI of the QoS rule from b); and\nd)\tshall perform one of the following:\n1)\tif there is a PC5 QoS flow with the determined PQI, the 5G ProSe layer-3 UE-to-network relay UE shall perform the 5G ProSe direct link modification procedure as specified in clause 7.2.3 to associate the ProSe application on the existing PC5 QoS flow. The 5G ProSe layer-3 UE-to-network relay UE may include the PC5 QoS rule(s) associated with the updated PC5 QoS flow; or\n2)\tif there is no PC5 QoS flow with the determined PQI, the 5G ProSe layer-3 UE-to-network relay UE shall perform the 5G ProSe direct link modification procedure as specified in clause 7.2.3 to add a new PC5 QoS flow with the determined PQI and associate the ProSe application on the new PC5 QoS flow. The 5G ProSe layer-3 UE-to-network relay UE may include the PC5 QoS rule(s) associated with the newly added PC5 QoS flow.\nWhen a derived QoS rule is deleted, the 5G ProSe layer-3 UE-to-network relay UE shall perform the 5G ProSe direct link modification procedure as specified in clause 7.2.3 to associate the ProSe application with a PC5 QoS flow such that the determined PQI maps to the 5QI of the signalled QoS rule.\nFor PC5 QoS flows setup or modification initiated by the 5G ProSe layer-3 remote UE, the 5G ProSe layer-3 remote UE shall provide the PC5 QoS flow context as defined in clause 7.2.7 to the 5G ProSe layer-3 UE-to-network relay UE to indicate the end-to-end QoS requirements for the traffic transmission between 5G ProSe layer-3 remote UE and the network, using 5G ProSe direct link establishment procedure as specified in clause 7.2.2 or 5G ProSe direct link modification procedure as specified in clause 7.2.3.\nIn addition, if the 5G ProSe layer-3 remote UE wants to add new PC5 QoS flow(s) or modify the existing PC5 QoS flow(s) for IP traffic or Ethernet traffic, the 5G ProSe layer-3 remote UE may also provide the PC5 QoS rule(s) for the PC5 QoS flow(s) to be added or modified to the 5G ProSe layer-3 UE-to-network relay UE, using 5G ProSe direct link establishment procedure as specified in clause 7.2.2 or 5G ProSe direct link modification procedure as specified in clause 7.2.3.\nUpon reception of the PC5 QoS flow context from the 5G ProSe layer-3 remote UE, the 5G ProSe layer-3 UE-to-network relay UE:\na)\tshall perform one of the following:\n1)\tif the end-to-end QoS requirements can be supported by an entry in QoS mapping configured in clause 5.2.5, then the 5G ProSe layer-3 UE-to-network relay UE uses the 5QI of the entry for the Uu QoS control and uses the PQI of the entry for the PC5 QoS control; or\n2)\tif the end-to-end QoS requirements cannot be supported by any entry in QoS mapping configured in clause 5.2.5, then the 5G ProSe layer-3 UE-to-network relay UE determines the 5QI for the Uu QoS control and PQI for the PC5 QoS control based on its implementation;\nb)\toptionally, derives the packet filter(s) used over Uu reference point if the 5G ProSe layer-3 UE-to-network relay UE received PC5 QoS rule(s) from 5G ProSe layer-3 remote UE;\nc)\tif a new QoS flow needs to be established or the existing QoS flow(s) needs to be modified, performs UE-requested PDU session modification procedure as specified in clause 6.4.2 in 3GPP TS 24.501 [11] providing:\n1)\tthe Requested QoS flow descriptions IE with the 5QI value determined in bullet a); or\n2)\tthe Requested QoS rules IE with the packet filter(s) if packet filter(s) are derived in bullet b);\nd)\tshall further update the corresponding PC5 QoS flow with the updated PQI value if the 5G ProSe layer-3 UE-to-network relay UE receives the authorized QoS flow descriptions with a 5QI value which is different from the 5QI value indicated by the 5G ProSe layer-3 UE-to-network relay UE as described in bullet c); and\ne)\tshall provide the 5G ProSe layer-3 remote UE with the PQI determined in bullet a) or the PQI updated in bullet d), the corresponding PC5 QoS parameters and the corresponding ProSe identifier(s) as specified in clause 7.2.2.3 (if 5G ProSe direct link establishment procedure was initiated by the 5G ProSe layer-3 remote UE) or clause 7.2.3.3 (if 5G ProSe direct link modification procedure was initiated by the 5G ProSe layer-3 remote UE).\nAs specified in clause 5.6.2.2 of 3GPP TS 23.304 [2], when the 5G ProSe layer-3 remote UE accesses 5GS via a 5G ProSe layer-3 UE-to-network relay with N3IWF, the N3IWF can use one of the following operations for QoS support in 5G ProSe layer-3 UE-to-network relay UE's serving PLMN:\na)\ta static QoS mapping mechanism; or\nb)\ta dynamic QoS signalling based mechanism.\nFor a), there is no signalling impact to the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3 UE-to-network relay UE.\nFor b), clause 8.2.6.4.2 specifies the QoS handling with QoS signalling procedure to transport the IPsec traffic in the 5G ProSe layer-3 UE-to-network relay UE's 5GCN.\nWhen the 5G ProSe layer-3 remote UE establishes or handovers a PDU session via the N3IWF as described in clause 4.12.5 of 3GPP TS 23.502 [51], the N3IWF initiates a child SA creation procedure by sending a CREATE_CHILD_SA request message to associate the QoS flow(s) of the PDU session with the child SA of the user plane as specified in clause 7.5 of 3GPP TS 24.502 [26]. In the CREATE_CHILD_SA request message, the 5G_QOS_INFO Notify payload includes the PDU session ID, one or more QFI(s), optionally a DSCP value and optionally Additional QoS Information as defined in clause 9.3.1.1 of 3GPP TS 24.502 [26]. The N3IWF can also initiate the user plane IPsec child SA modification procedure by sending an INFORMATIONAL request message including the 5G_QOS_INFO Notify payload if the child SA associated with the QoS flows of the PDU session needs to be modified as specified in clause 7.6 of 3GPP TS 24.502 [26].\nBased on information in the received 5G_QoS_INFO Notify payload, the 5G ProSe layer-3 remote UE determines whether to initiate the 5G ProSe direct link modification procedure to setup or modify the PC5 QoS flows. If the 5G ProSe direct link modification procedure needs to be initiated, the 5G ProSe layer-3 remote UE shall perform the procedure as specified in clause 8.2.6.3.3 with following additions:\na)\tif the Additional QoS Information is received in the 5G_QoS_INFO Notify payload, the 5G ProSe layer-3 remote UE shall set the PC5 QoS flow descriptions IE based on the Additional QoS Information; and\nb)\tthe 5G ProSe layer-3 remote UE shall include the PC5 QoS rules IE with the packet filter containing the N3IWF IP address, the security parameter index of the child SA and the DSCP value if received in the 5G_QoS_INFO Notify payload.\nThe 5G ProSe layer-3 UE-to-network relay UE determines whether to initiate PDU session modification procedure to request establishment or modification of the QoS flow of the dedicated QoS rules which is associated with the IPsec traffic between the 5G ProSe layer-3 remote UE and the N3IWF. If the PDU session modification procedure needs to be initiated, the 5G ProSe layer-3 UE-to-network relay UE shall perform the procedure as specified in clause 6.4.2 of 3GPP TS 24.501 [11] with following additions:\na)\tthe 5G ProSe layer-3 UE-to-network relay UE sends the packet filter provided in the PC5 QoS rules IE by the 5G ProSe layer-3 remote UE to the SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.7\t5G ProSe layer-3 UE-to-network relay with N3IWF support",
                            "text_content": "As specified in clause 5.4.1.2 of 3GPP TS 23.304 [2], the 5G ProSe layer-3 UE-to-network relay with N3IWF support shall provide the 5G ProSe layer-3 remote UE with the connection which can access to the N3IWF. In this way, the 5G ProSe layer-3 remote UE is able to select the N3IWF and access to the 5GC via the N3IWF.\nThe layer-3 ProSe UE-to-network relay UE is provisioned with the UE policies for 5G ProSe layer-3 UE-to-network relay including the relay service code which corresponds to use N3IWF access for the relayed traffic as defined in 3GPP TS 24.555 [17].\nFor UE-to-network relay discovery with model A, the 5G ProSe UE-to-network relay UE shall include the relay service code in the PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement as specified in clause 8.2.1.2. For UE-to-network relay discovery with model B, the 5G ProSe layer-3 remote UE shall include the relay service code which corresponds to use N3IWF access for the relayed traffic in the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation as specified in clause 8.2.1.3. The relay service code in the PROSE PC5 DISCOVERY message for UE-to-network relay discovery response shall match the relay service code received from the 5G ProSe layer-3 remote UE.\nNOTE 1:\tThe UE is allowed to use the 5G ProSe layer-3 UE-to-network relay with N3IWF support if the UE is authorized to be a 5G ProSe layer-3 remote UE as specified in clause 5.2.5 and the non-3GPP access type is preferred in the selected route selection descriptor in the URSP rule as defined in 3GPP TS 24.526 [5].\nIf the 5G ProSe layer-3 remote UE intends to access 5GC via N3IWF, the 5G ProSe layer-3 remote UE:\na)\tshall select the relay service code which corresponds to use N3IWF access for the relayed traffic in the received PROSE PC5 DISCOVERY message;\nb)\tshall send the PROSE DIRECT LINK ESTABLISHMENT REQUEST message including the selected relay service code in a) to the 5G ProSe layer-3 UE-to-network relay UE; and\nc)\tshall use either the security procedure over user plane or the security procedure over control plane as specified in 3GPP TS 33.503 [34].\nNOTE 2:\tAfter using either the security procedure over user plane or the security procedure over control plane as specified in 3GPP TS 33.503 [34], the 5G ProSe layer-3 remote UE performs the security procedures as specified in clause 7.2.1 of 3GPP TS 33.501 [50].\nThe 5G ProSe layer-3 UE-to-network relay UE establishes the PDU session with corresponding parameters for the requested relay service code as specified in clause 8.2.7.2.\nThe 5G ProSe layer-3 remote UE performs the N3IWF selection as specified in 8.2.7.3 once the IP address/prefix allocation is completed.\nThe 5G ProSe layer-3 UE-to-network relay UE establishes the PDU session based on the UE policies for 5G ProSe layer-3 UE-to-network relay service codes defined in 3GPP TS 24.555 [17]. The PDU session establishment is triggered upon receipt of the PROSE DIRECT LINK ESTABLISHMENT REQUEST message including the relay service code. The 5G ProSe layer-3 remote UE may change 5G ProSe layer-3 UE-to-network relay(s) while maintaining the PDU session(s) established via 5G ProSe layer-3 UE-to-network relay and N3IWF, when the 5G ProSe layer-3 remote UE and the N3IWF support MOBIKE as specified TS 24.502 [26].\nNOTE:\tIf there is an existing PDU session for 5G ProSe layer-3 UE-to-network relay without N3IWF, whether to reuse that existing PDU session or to establish a new PDU session for 5G ProSe layer-3 UE-to-network relay with N3IWF is determined by 5G ProSe layer-3 UE-to-network relay UE as specified in 3GPP TS 23.503[33].\nAs specified in clause 6.5.1.2.2 of 3GPP TS 23.304 [2], the 5G ProSe layer-3 remote UE selects the N3IWF using following information included in UE policies for 5G ProSe remote UE as defined in clause 5.6.2 of 3GPP TS 24.555 [17]:\na)\tN3IWF identifier configuration for 5G ProSe layer-3 remote UE; and\nb)\t5G ProSe layer-3 UE-to-network relay access node selection information.\nThe 5G ProSe layer-3 remote UE performs the N3IWF selection procedure as specified in clause 7.2.4.3 of 3GPP TS 24.502 [26] for non-emergency services and clause 7.2.6.2 of 3GPP TS 24.502 [26] for emergency services.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.8\t5G ProSe additional parameters announcement procedure",
                            "text_content": "The purpose of the 5G ProSe additional parameters announcement procedure is for the 5G ProSe layer-3 remote UE to obtain NCGI or TAI of the cell serving the 5G ProSe layer-3 UE-to-network relay UE.\nThe 5G ProSe remote UE in this procedure shall be a 5G ProSe-enabled UE and is authorised to act as a 5G ProSe layer-3 remote UE towards a 5G ProSe layer-3 UE-to-network relay UE based on the service authorization procedure as specified in clause 5. The 5G ProSe layer-3 UE-to-network relay UE in this procedure shall be a 5G ProSe-enabled UE and is authorised to act as a 5G 5G ProSe layer-3 UE-to-network relay UE based on the service authorization procedure as specified in clause 5.\nBefore initiating the 5G ProSe additional parameters announcement procedure, a direct link has been successfully established between the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3 UE-to-network relay UE.\nThe 5G ProSe layer-3 remote UE shall initiate a 5G ProSe additional parameters announcement procedure:\na)\twhen the 5G ProSe layer-3 remote UE is triggered by an upper layer application to report NCGI or TAI of the serving cell to the application server, but cannot receive the PROSE PC5 DISCOVERY message for relay discovery additional information from the 5G ProSe layer-3 UE-to-network relay UE, or the NCGI or TAI is not included in the PROSE PC5 DISCOVERY message for relay discovery additional information from the 5G ProSe layer-3 UE-to-network relay UE, or the NCGI or TAI is not included in the PROSE PC5 DISCOVERY message for UE-to-network relay discovery response because the UE-to-network relay discovery with model B is used for the direct link; or\nb)\twhen the additional parameters announcement request refresh timer T5106 expires and the 5G ProSe layer-3 remote UE still needs to obtain NCGI or TAI of the cell serving the 5G ProSe layer-3 UE-to-network relay.\nThe 5G ProSe layer-3 remote UE shall generate a PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST message and pass this message to the lower layers for transmission along with the 5G ProSe layer-3 remote UE's layer-2 ID (for unicast communication) and the 5G ProSe layer-3 UE-to-network relay UE's layer-2 ID (for unicast communication).\nThe figure depicts the announcement procedure for additional parameters in the 5G ProSe protocol. It includes the steps for configuring the parameters, such as the number of antennas, modulation scheme, and data rate. The figure also shows the flow of information between the sender and receiver, including the use of the 5G ProSe protocol.\nFigure 8.2.8.2.1: 5G ProSe additional parameters announcement procedure\nUpon receiving a PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST message, the 5G ProSe layer-3 UE-to-network relay UE shall allocate an additional parameters announcement request refresh timer T5106 to the 5G ProSe remote UE and start a timer T5107. The timer T5107 shall be longer than the additional parameters announcement request refresh timer T5106.\nThen the 5G ProSe layer-3 UE-to-network relay UE shall respond a PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT RESPONSE message with an additional parameters announcement request refresh timer T5106 IE set to the T5106 timer value assigned by the 5G ProSe layer-3 UE-to-network relay UE. The 5G ProSe layer-3 UE-to-network relay UE shall start announcing the NCGI or TAI of the serving cell by triggering the announcing UE procedure for relay discovery additional information as described in clause 8.2.1.2.4.\nUpon receiving a PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT RESPONSE message, the UE shall start the additional parameters announcement request refresh timer T5106 with the received value.\nIf there is no response from the 5G ProSe layer-3 UE-to-network relay UE after the PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST message has been successfully delivered, the 5G ProSe layer-3 remote UE shall retransmit the PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.9\t5G ProSe AA message reliable transport procedure",
                            "text_content": "The purpose of the 5G ProSe AA message reliable transport procedure is to exchange the EAP messages between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE.\nThe 5G ProSe remote UE in this procedure shall be a 5G ProSe-enabled UE and is authorised to act as a 5G ProSe remote UE towards a 5G ProSe UE-to-network relay UE based on the service authorization procedure as specified in clause 5. The 5G ProSe UE-to-network relay UE in this procedure shall be a 5G ProSe-enabled UE and is authorised to act as a 5G ProSe UE-to-network relay UE based on the service authorization procedure as specified in clause 5.\nIn this clause, the 5G ProSe UE-to-network relay UE is the initiating UE and the 5G ProSe remote UE is the target UE.\nThe UE shall initiate a 5G ProSe AA message reliable transport procedure when the UE receives the EAP message for the target UE from the network.\nThe UE shall generate a PROSE AA MESSAGE TRANSPORT REQUEST message. In this message, during an EAP based authentication procedure, the initiating UE shall include the EAP message IE set to the received EAP message for the target UE from the network as specified in 3GPP TS 24.501 [11].\nNOTE 1:\tIn this release of this specification, the EAP message IE is always included.\nThe initiating UE shall self-assign a source layer-2 ID and set the destination layer-2 ID to the source layer-2 ID in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, i.e., the target UE's layer-2 ID.\nNOTE 2:\tThe UE implementation ensures that any value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14, clause 6.2.15 and clause 8.2.1 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\nAfter the PROSE AA MESSAGE TRANSPORT REQUEST message is generated, the initiating UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID and the target UE's layer-2 ID and start timer T5093. The UE shall not send a new PROSE AA MESSAGE TRANSPORT REQUEST message to the same target UE while timer T5093 is running.\nThe figure depicts a 5G ProSe AA message reliable transport procedure, illustrating the steps involved in ensuring the transmission of reliable data over a 5G network. The figure includes various components such as the base station (gNB), user equipment (UE), and scatterers, which are essential for the successful transmission of data. The diagram highlights the use of beamforming techniques to mitigate interference and the importance of redundancy paths to ensure failover reliability.\nFigure 8.2.9.2.1: 5G ProSe AA message reliable transport procedure\nUpon receiving a PROSE AA MESSAGE TRANSPORT REQUEST message, the target UE shall pass the EAP message in the EAP message IE to the upper layer for the external DN authentication.\nWhen the upper layers provide an EAP message responding to the received EAP message, the target UE shall generate a PROSE AA MESSAGE TRANSPORT RESPONSE message including the EAP message IE set to the received EAP message from the upper layers.\nAfter the PROSE AA MESSAGE TRANSPORT RESPONSE message is generated, the target UE shall pass this message to the lower layers for transmission along with the initiating UE's layer-2 ID and the target UE's layer-2 ID.\nUpon receiving a PROSE AA MESSAGE TRANSPORT RESPONSE message, the UE shall stop timer T5093 and shall pass the EAP message in the PROSE AA MESSAGE TRANSPORT RESPONSE message to the lower layer and inform the lower layer to initiate the PDU EAP message reliable transport procedure as specified in 3GPP TS 24.501 [11].\na)\tTimer T5093 expires.\nThe initiating UE shall retransmit the PROSE AA MESSAGE TRANSPORT REQUEST message and restart timer T5093. After reaching the maximum number of allowed retransmissions, the initiating UE shall abort the 5G ProSe AA message reliable transport procedure and shall abort the ongoing procedure that triggered the initiation of the 5G ProSe AA message reliable transport procedure.\nNOTE:\tThe maximum number of allowed retransmissions is UE implementation specific.\nb)\tThe need to use this 5G ProSe direct link no longer exists before the 5G ProSe AA message reliable transport procedure is completed.\nThe initiating UE shall abort the 5G ProSe AA message reliable transport procedure and shall abort the ongoing procedure that triggered the initiation of the 5G ProSe AA message reliable transport procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.10\t5G ProSe security procedures over PC8 interface",
                            "text_content": "The UE and 5G PKMF shall use HTTP/1.1 as specified in IETF RFC 9112 [3] and IETF RFC 9110 [4] as the transport protocol for PC8 messages over the PC8 interface. The PC8 messages described here shall be included in the body of either an HTTP request message or an HTTP response message.\nThe following rules apply for UE-initiated procedures:\na)\tthe UE initiates 5G ProSe transactions with an HTTP request message containing the PC8 request(s);\nb)\tthe 5G PKMF responds to the requests with an HTTP response message containing the PC8 response(s) for the PC8 request(s); and\nc)\tHTTP POST methods are used for 5G ProSe procedures over PC8 interface.\nThe UE may use UE local configuration or URSP, as defined in 3GPP TS 24.526 [5], to establish a PDU session for reaching the HPLMN 5G PKMF:\na)\tif a PDU session for reaching the HPLMN 5G PKMF is not established yet, the UE shall establish the PDU session for reaching the HPLMN 5G PKMF and shall send the HTTP request message via the PDU session for reaching the HPLMN 5G PKMF; and\nb)\tif a PDU session for reaching the HPLMN 5G PKMF is already established (e.g., either due to other 5G ProSe feature or due to other application), the UE shall send the HTTP request message via the PDU session for reaching the HPLMN 5G PKMF.\nThe 5G PKMF address can be pre-configured in the UE, provided by the 5G DDNMF or provided in the ProSeP by the PCF.\nThe UE shall use the 5G PKMF address in the following order of decreasing precedence:\na)\tprovided in the ProSeP by the PCF;\nb)\tprovided by the 5G DDNMF; and\nc)\tpre-configured in the ME.\nIf the UE is pre-configured with the 5G PKMF address, does not have the 5G PKMF address provided in the ProSeP by the PCF and does not have the 5G PKMF address provided by the 5G DDNMF, the UE may access the 5G PKMF using the pre-configured 5G PKMF address without requesting the 5G DDNMF to provide the 5G PKMF address. In case that the UE cannot access the 5G PKMF using the pre-configured 5G PKMF address, the UE may request the 5G DDNMF to provide the 5G PKMF address.\nThe following procedures are defined:\na)\t5G ProSe UE-to-network relay discovery security parameters request procedure;\nb)\t5G ProSe remote user key request procedure; and\nc)\tKey request procedure.\nIn the following descriptions of 5G procedures over PC8 interface, the terms \"request\" and \"response\" refer to the corresponding PC8 messages, not to the HTTP request or response. The following procedure descriptions use a single PC8 message for illustration purposes.\nThe 5G ProSe procedures over PC8 interface shall be integrity protected and confidentiality protected using the security procedures using GBA or AKMA, see clause 5.2.5.3 and clause 5.2.5.4 in 3GPP TS 33.503 [34].\nNOTE 1:\tA single HTTP request message can contain multiple PC8 requests and a single HTTP response message can contain multiple PC8 responses.\nNOTE 2:\tThe privacy of the UE identity included in the PC8 messages of 5G ProSe procedures over PC8 interface is ensured by the confidentiality protection of those procedures.\nThe purpose of the 5G ProSe UE-to-network relay discovery security parameters request procedure is for the UE:\na)\tto obtain the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE, applicable when the UE acts as a 5G ProSe remote UE and uses the security procedure over user plane as specified in 3GPP TS 33.503 [34]; and\nb)\tto obtain the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE, applicable when the UE acts as a 5G ProSe UE-to-network relay UE and uses the security procedure over user plane as specified in 3GPP TS 33.503 [34].\nThe UE shall initiate the 5G ProSe UE-to-network relay discovery security parameters request procedure:\na)\tif the UE is authorized to act as a 5G ProSe remote UE and uses the security procedure over user plane as specified in 3GPP TS 33.503 [34]:\n1)\twhen the UE has no 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE and the UE is in NG-RAN coverage; or\n2)\tafter expiration of timer T5094, when in NG-RAN coverage or when entering NG-RAN coverage; or\nb)\tif the UE is authorized to act as a 5G ProSe UE-to-network relay UE and uses the security procedure over user plane as specified in 3GPP TS 33.503 [34]:\n1)\twhen the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE and the UE is in NG-RAN coverage; or\n2)\tafter expiration of timer T5095, when in NG-RAN coverage or when entering NG-RAN coverage.\nThe UE shall initiate the 5G ProSe UE-to-network relay discovery security parameters request procedure by sending a PROSE_SECURITY_PARAM_REQUEST message with the <UNR-discovery-security-parameters-request> element. In the <UNR-discovery-security-parameters-request> element, the UE:\na)\tshall include a new transaction ID;\nb)\tshall indicate whether the UE requests the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE, the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE or both;\nc)\tshall include the PC5 UE security capabilities indicating ciphering algorithms supported by the UE;\nd)\tif the UE requests the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE, may include a list of PLMN identities of the visited PLMNs;\ne)\tmay indicate the requested model indicating the model of the 5G ProSe UE-to-network relay discovery over PC5 interface for which security parameters are requested, set to \"model A\" or \"model B\"; and\nf)\tshall include the relay service code indicating the connectivity service to be discovered.\nNOTE:\tIf the requested model is not included in the PROSE_SECURITY_PARAM_REQUEST message, security parameters are requested for both model A and model B of the 5G ProSe UE-to-network relay discovery over PC5 interface.\nFigure 8.2.10.2.2.2.1 illustrates the interaction of the UE and the 5G PKMF in the 5G ProSe UE-to-network relay discovery security parameters request procedure.\nThe figure depicts a 5G ProSe UE-to-network relay discovery security parameters request procedure, illustrating the steps involved in establishing secure communication between a UE and a network relay. The figure includes various security parameters such as authentication, encryption, and key management, which are essential for ensuring the confidentiality and integrity of data transmitted over the network.\nFigure 8.2.10.2.2.2.1: 5G ProSe UE-to-network relay discovery security parameters request procedure\nUpon receiving a PROSE_SECURITY_PARAM_REQUEST message with the <UNR-discovery-security-parameters-request> element, if:\na)\tthe UE requests the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE only and the PROSE_SECURITY_PARAM_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe remote UE;\nb)\tthe UE requests the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE only and the PROSE_SECURITY_PARAM_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe UE-to-network relay UE; or\nc)\tthe UE requests the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE and the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE and the PROSE_SECURITY_PARAM_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe UE-to-network relay UE and authorized to act as a 5G ProSe remote UE;\nthe 5G PKMF shall send a PROSE_SECURITY_PARAM_RESPONSE message containing a <UNR-discovery-security-parameters-accept> element. In the <UNR-discovery-security-parameters-accept> element, the 5G PKMF:\na)\tshall include the transaction ID set to the value of the transaction ID received in the PROSE_SECURITY_PARAM_REQUEST message;\nb)\tif the UE requests the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE:\n1)\tshall include the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE. In the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE, the 5G PKMF:\nA)\tshall include the expiration timer of the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE; and\nB)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe remote UE:\ni)\tif the requested model is not indicated in the PROSE_SECURITY_PARAM_REQUEST message or is set to \"model A\", may include the code-receiving security parameters for model A containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask;\nii)\tif the requested model is not indicated in the PROSE_SECURITY_PARAM_REQUEST message or is set to \"model B\", may include the code-receiving security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask; and\niii)\tshall include the selected ciphering algorithm; and\n2)\tmay include the PC5 security policies for the received relay service code for 5G ProSe remote UE. In the PC5 security policies for the received relay service code for 5G ProSe remote UE, the 5G PKMF:\nA)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe remote UE:\ni)\tshall include the PC5 security policies;\nc)\tif the UE requests the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE:\n1)\tshall include the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE. In the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE, the 5G PKMF:\nA)\tshall include the expiration timer of the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE; and\nB)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe UE-to-network relay UE:\ni)\tif the requested model is not indicated in the PROSE_SECURITY_PARAM_REQUEST message or is set to \"model A\", may include the code-sending security parameters for model A containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask;\nii)\tif the requested model is not indicated in the PROSE_SECURITY_PARAM_REQUEST message or is set to \"model B\", may include the code-receiving security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask; and\niii)\tshall include the selected ciphering algorithm; and\n2)\tmay include the PC5 security policies for the received relay service code for 5G ProSe UE-to-network relay UE. In the PC5 security policies for the received relay service code for 5G ProSe UE-to-network relay UE, the 5G PKMF:\nA)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe UE-to-network relay UE:\ni)\tshall include the PC5 security policies; and\nd)\tshall include the current time set to the current UTC-based time at the 5G PKMF and the max offset.\nIf the UE requests the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE, the UE identity in the PROSE_SECURITY_PARAM_REQUEST message indicates a UE authorized to act as a 5G ProSe remote UE and the PROSE_SECURITY_PARAM_REQUEST message contains a list of PLMN identities of the visited PLMNs, the 5G PKMF shall include in the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE any information received from the 5G PKMFs that are discovered based on the provided list of PLMN identities of potential 5G ProSe UE-to-network relay UEs which can serve the UE. If the PROSE_SECURITY_PARAM_REQUEST message does not contain a list of PLMN identities of the visited PLMNs, the 5G PKMF may get the PLMN identities of potential 5G ProSe UE-to-network relay UEs through different means such as local configurations.\nUpon receipt of the PROSE_SECURITY_PARAM_RESPONSE message with the <UNR-discovery-security-parameters-accept>, if the transaction ID contained in the <UNR-discovery-security-parameters-accept> element matches the value sent by the UE in a PROSE_SECURITY_PARAM_REQUEST message with the <UNR-discovery-security-parameters-request> element, the UE:\na)\tif the PROSE_SECURITY_PARAM_RESPONSE message contains the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE:\n1)\tshall store the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE, shall stop timer T5094, if running and shall start timer T5094 with the value of the expiration timer indicated in the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE; and\n2)\tif the PC5 security policies for the relay service code for 5G ProSe remote UE are received, shall store the PC5 security policies for the relay service code for 5G ProSe remote UE;\nb)\tif the PROSE_SECURITY_PARAM_RESPONSE message contains the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE:\n1)\tshall store the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE, shall stop timer T5095, if running and shall start timer T5081 with the value of the expiration timer indicated in the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE; and\n2)\tif the PC5 security policies for the relay service code for 5G ProSe UE-to-network relay UE are received, shall store the PC5 security policies for the relay service code for 5G ProSe UE-to-network relay UE; and\nc)\tshall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset.\nIf the PROSE_SECURITY_PARAM_REQUEST message with the <UNR-discovery-security-parameters-request> element cannot be accepted by the 5G PKMF, the 5G PKMF shall send a PROSE_SECURITY_PARAM_RESPONSE message containing a <UNR-discovery-security-parameters-reject> element. In the <UNR-discovery-security-parameters-reject> element, the 5G PKMF shall include the transaction ID set to the value of the transaction ID received in the PROSE_SECURITY_PARAM_REQUEST message and shall include an appropriate PC8 control protocol cause value.\nUpon receipt of the PROSE_SECURITY_PARAM_RESPONSE message with the <UNR-discovery-security-parameters-reject> element, if the transaction ID contained in the <UNR-discovery-security-parameters-reject> element matches the value sent by the UE in a PROSE_SECURITY_PARAM_REQUEST message with the <UNR-discovery-security-parameters-request> element, the UE shall consider the 5G ProSe UE-to-network relay discovery security parameters request procedure as rejected.\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of PROSE_SECURITY_PARAM_REQUEST message (e.g. after TCP retransmission timeout).\nThe UE shall close the existing secure connection to the 5G PKMF, establish a new secure connection and then restart the 5G ProSe UE-to-network relay discovery security parameters request procedure.\nb)\tNo response from the 5G PKMF after the PROSE_SECURITY_PARAM_REQUEST message has been successfully delivered (e.g. TCP ACK has been received for the PROSE_SECURITY_PARAM_REQUEST message)\nThe UE shall retransmit the PROSE_SECURITY_PARAM_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of PROSE_SECURITY_PARAM_RESPONSE message.\nAfter receiving an indication from lower layer that the PROSE_SECURITY_PARAM_RESPONSE message has not been successfully acknowledged (e.g. TCP ACK is not received), the 5G PKMF shall abort the procedure.\nThe purpose of the 5G ProSe remote user key request procedure is for the UE authorized to act as a 5G ProSe remote UE to obtain a UP-PRUK and a UP-PRUK ID.\nBefore initiating this procedure, the 5G ProSe remote UE needs to be authorized to use a 5G ProSe layer-3 UE-to-network relay UE or a 5G ProSe layer-2 UE-to-network relay UE in the registered PLMN or local PLMN based on the configuration parameters as specified in clause 5.2.5.\nIf the UE is authorized to use a 5G ProSe layer-3 UE-to-network relay UE or a 5G ProSe layer-2 UE-to-network relay UE in the registered PLMN or local PLMN, and needs to be able to obtain a connectivity service from a 5G ProSe UE-to-network relay UE, it shall initiate this procedure.\nThe UE shall initiate the 5G ProSe remote user key request procedure by sending a PROSE_PRUK_REQUEST message with the <PRUK-request> element. In the <PRUK-request> element, the UE:\na)\tshall include a new transaction ID not used in any other direct discovery procedures in PC8 interface; and\nb)\tshall include the UP-PRUK ID set to the UP-PRUK ID associated with the UE stored UP-PRUK, if the UE stores UP-PRUK.\nFigure 8.2.10.2.3.2.1 illustrates the interaction of the UE and the 5G PKMF in the 5G ProSe remote user key request procedure.\nThe figure depicts a 5G ProSe remote user key request procedure, illustrating the steps involved in the authentication process. The figure includes a user, a key request, and a response, all depicted in a clear and concise manner.\nFigure 8.2.10.2.3.2.1: 5G ProSe remote user key request procedure\nUpon receiving a PROSE_PRUK_REQUEST message, the 5G PKMF shall check whether the UE is authorized to act as a 5G ProSe remote UE. If authorized, the 5G PKMF shall then send a PROSE_PRUK_RESPONSE message with the <PRUK-accept> element. In the <PRUK-accept> element, the 5G PKMF shall include:\na)\tthe transaction ID set to the value of the transaction ID received in the PROSE_PRUK_REQUEST message from the UE;\nb)\tthe UP-PRUK ID set to the value of the UP-PRUK ID associated with the UP-PRUK; and\nc)\tthe UP-PRUK set to the value of the allocated UP-PRUK to the UE.\nUpon receipt of the PROSE_PRUK_RESPONSE message, if the transaction ID matches the value sent by the UE in a PROSE_PRUK_REQUEST message, the UE shall delete any previously stored UP-PRUK and UP-PRUK ID and store the received UP-PRUK and the associtated UP-PRUK ID.\nIf the PROSE_PRUK_REQUEST message cannot be accepted by the 5G PKMF, the 5G PKMF sends a PROSE_PRUK_RESPONSE message containing a <PRUK-reject> element to the UE including an appropriate PC8 control protocol cause value and including the transaction ID set to the value of the transaction ID received in the PC8_PRUK_REQUEST message.\nUpon receipt of the PROSE_PRUK_RESPONSE message containing a <PRUK-reject> element, if the transaction ID matches the value sent by the UE in a PROSE_PRUK_REQUEST message, the UE shall consider the 5G ProSe remote user key request procedure as rejected.\nIf the UE is not authorized for acting as a 5G ProSe remote UE, the 5G PKMF shall send the PROSE_PRUK_RESPONSE message containing a <PRUK-reject> element with PC8 control protocol cause value #1 \"UE authorization failure\".\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of PROSE_PRUK_REQUEST message (e.g., after TCP retransmission timeout).\nThe UE shall close the existing secure connection to the 5G PKMF, establish a new secure connection and then restart the UP-PRUK request procedure.\nb)\tNo response from the 5G PKMF after the PROSE_PRUK_REQUEST message has been successfully delivered (e.g., TCP ACK has been received for the PROSE_PRUK_REQUEST message).\nThe UE shall retransmit the PROSE_PRUK_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of PROSE_PRUK_RESPONSE message.\nAfter receiving an indication from lower layer that the PROSE_PRUK_RESPONSE message has not been successfully acknowledged (e.g. TCP ACK is not received), the 5G PKMF shall abort the procedure.\nThe purpose of the key request procedure is for a UE acting as a 5G ProSe UE-to-network relay to obtain security parameter needed for establishment of 5G ProSe direct link with a 5G ProSe remote UE.\nThe UE shall initiate the key request procedure:\na)\twhen the UE acting as a 5G ProSe UE-to-network relay for a relay service code receives a request to establish a 5G ProSe direct link from a 5G ProSe remote UE; and\nb)\twhen a 5G ProSe direct link security mode control procedure is rejected by the 5G ProSe remote UE due to the authentication synchronisation error.\nThe UE shall initiate the key request procedure by sending a PROSE_KEY_REQUEST message with the <key-request> element. In the <key-request> element, the UE:\na)\tshall include a new transaction ID;\nb)\tshall include the relay service code for which the 5G ProSe direct link is requested to be established;\nc)\tshall include the SUCI or the UP-PRUK ID of the 5G ProSe remote UE, received from the 5G ProSe remote UE;\nd)\tshall include the KNRP freshness parameter 1, received from the 5G ProSe remote UE;\ne)\tshall include the PLMN identity of the HPLMN of the 5G ProSe remote UE, if received from the 5G ProSe remote UE; and\nf)\tif the key request procedure is initiated upon a 5G ProSe direct link security mode control procedure being rejected by the 5G ProSe remote UE due to the authentication synchronisation error, shall include the AUTS and the RAND, received from the 5G ProSe remote UE.\nFigure 8.2.10.2.4.2.1 illustrates the interaction of the UE and the 5G PKMF in the Key request procedure.\nThe figure depicts a key request procedure in a 10G network, illustrating the steps involved in initiating a request. The diagram includes various components such as the network control center (NCC), network control unit (NCU), and network management system (NMS). Key elements include the request requestor, request destination, and request type. The figure highlights the importance of network control and management in ensuring efficient and reliable network operations.\nFigure 8.2.10.2.4.2.1: Key request procedure\nUpon receiving a PROSE_KEY_REQUEST message with the <key-request> element, if:\na)\tthe PROSE_KEY_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe UE-to-network relay for the relay service code indicated in the PROSE_KEY_REQUEST message; and\nb)\tthe 5G ProSe remote UE identified by the SUCI, the UP-PRUK ID or the AUTS provided by the 5G ProSe remote UE and the PLMN identity of the HPLMN of the 5G ProSe remote UE, if any, indicated in the PROSE_KEY_REQUEST message is authorized to act as a 5G ProSe remote UE for the relay service code indicated in the PROSE_KEY_REQUEST message;\nthe 5G PKMF shall send a PROSE_KEY_RESPONSE message containing a <key-accept> element. In the <key-accept> element, the 5G PKMF:\na)\tshall include the transaction ID set to the value of the transaction ID received in the PROSE_KEY_REQUEST message;\nb)\tshall include the UP-PRUK ID of the 5G ProSe remote UE;\nc)\tshall include the KNRP;\nd)\tshall include the KNRP freshness parameter 2; and\ne)\tif the AUTS and the RAND are included in the PROSE_KEY_REQUEST message or a new UP-PRUK is required, then shall include the GBA push information (GPI).\nIf the 5G ProSe remote UE is served by another 5G PKMF, the 5G PKMF of the 5G ProSe UE-to-network relay requests the 5G PKMF of the 5G ProSe remote UE to check that the 5G ProSe remote UE identified by the SUCI, the UP-PRUK ID or the AUTS provided by the 5G ProSe remote UE and the PLMN identity of the HPLMN of the 5G ProSe remote UE, if any, indicated in the PROSE_KEY_REQUEST message, is authorized to act a 5G ProSe remote UE for the relay service code indicated in the PROSE_KEY_REQUEST message and to provide the UP-PRUK ID of the 5G ProSe remote UE, the KNRP, the KNRP freshness parameter 2, and optionally the GBA push information (GPI).\nUpon receipt of the PROSE_KEY_RESPONSE message with the <key-accept> element, if the transaction ID contained in the <key-accept> element matches the value sent by the UE in a PROSE_KEY_REQUEST message with the <key-request> element, the UE shall use the UP-PRUK ID of the 5G ProSe remote UE, the KNRP, the KNRP freshness parameter 2 and the GBA push information (GPI), if received, in the 5G ProSe direct link establishment.\nIf the PROSE_KEY_REQUEST message with <key-request> element cannot be accepted by the 5G PKMF, the 5G PKMF shall send a PROSE_KEY_RESPONSE message containing a <key-reject> element. In the <key-reject> element, the 5G PKMF shall include the transaction ID set to the value of the transaction ID received in the PROSE_KEY_REQUEST message and shall include an appropriate PC8 control protocol cause value.\nNOTE:\tThe 5G PKMF decides to reject the PROSE_KEY_REQUEST message when e.g. the UP-PRUK is not found in the network.\nUpon receipt of the PROSE_KEY_RESPONSE message with the <key-reject> element, if the transaction ID contained in the <key-reject> element matches the value sent by the UE in a PROSE_KEY_REQUEST message with the <key-request> element, the UE shall consider the key request procedure as rejected.\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of PROSE_KEY_REQUEST message (e.g., after TCP retransmission timeout)\nThe UE shall close the existing secure connection to the 5G PKMF, establish a new secure connection and then restart the key request procedure.\nb)\tNo response from the 5G PKMF after the PROSE_KEY_REQUEST message has been successfully delivered (e.g. TCP ACK has been received for the PROSE_KEY_REQUEST message)\nThe UE shall retransmit the PROSE_KEY_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of PROSE_KEY_RESPONSE message\nAfter receiving an indication from lower layer that the PROSE_KEY_RESPONSE message has not been successfully acknowledged (e.g., TCP ACK is not received), the 5G PKMF shall abort the procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.11\tUE-to-network relay unicast direct communication over PC5 interface",
                            "text_content": "The direct communication between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE reuses the procedures for unicast mode 5G ProSe direct communication over PC5 described in clause 7.2.\nNOTE:\tAny modifications needed to the procedures defined for unicast mode 5G ProSe direct communication over PC5 to support the direct communication between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE are described within clause 7.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.12\t5G ProSe security procedures over PC3a interface",
                            "text_content": "The UE and 5G DDNMF shall use HTTP/1.1 as specified in IETF RFC 9112 [3] and IETF RFC 9110 [4] as the transport protocol for PC3a messages over the PC3a interface. The PC3a messages described here shall be included in the body of either an HTTP request message or an HTTP response message.\nThe following rules apply for UE-initiated procedures:\na)\tthe UE initiates 5G ProSe transactions with an HTTP request message containing the PC3a request(s);\nb)\tthe 5G DDNMF responds to the requests with an HTTP response message containing the PC3a response(s) for the PC3a request(s); and\nc)\tHTTP POST methods are used for 5G ProSe procedures over PC3a interface.\nThe UE may use UE local configuration or URSP, as defined in 3GPP TS 24.526 [5], to establish a PDU session for reaching the HPLMN 5G DDNMF:\na)\tif a PDU session for reaching the HPLMN 5G DDNMF is not established yet, the UE shall establish the PDU session for reaching the HPLMN 5G DDNMF and shall send the HTTP request message via the PDU session for reaching the HPLMN 5G DDNMF; and\nb)\tif a PDU session for reaching the HPLMN 5G DDNMF is already established (e.g., either due to other 5G ProSe feature or due to other application), the UE shall send the HTTP request message via the PDU session for reaching the HPLMN 5G DDNMF.\nThe following procedures are defined:\na)\t5G ProSe UE-to-network relay discovery security material request procedure.\nIn the following descriptions of 5G procedures over PC3a interface, the terms \"request\" and \"response\" refer to the corresponding PC3a messages, not to the HTTP request or response. The following procedure descriptions use a single PC3a message for illustration purposes.\nThe PC3a control protocol procedures for 5G ProSe direct discovery shall be integrity protected and confidentiality protected using the security procedures defined in clause 5.2.3 in 3GPP TS 33.503 [34].\nNOTE:\tA single HTTP request message can contain multiple PC3a control protocol requests and a single HTTP response message can contain multiple PC3a control protocol responses.\nWhen the TLS tunnel between the UE and the 5G DDNMF for transport of PC3a messages is established by the UE according to 3GPP TS 33.503 [34], the 5G DDNMF shall obtain identity of the served UE using the procedures specified in 3GPP TS 33.220 [46] or 3GPP TS 33.535 [47].\nThe purpose of the 5G ProSe UE-to-network relay discovery security material request procedure is for the UE:\na)\tto obtain the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE, applicable when the UE acts as a 5G ProSe remote UE and uses the security procedure over control plane as specified in 3GPP TS 33.503 [34]; and\nb)\tto obtain the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE, applicable when the UE acts as a 5G ProSe UE-to-network relay UE and uses the security procedure over control plane as specified in 3GPP TS 33.503 [34].\nThe UE shall initiate the 5G ProSe UE-to-network relay discovery security material request procedure:\na)\tif the UE is authorized to act as a 5G ProSe remote UE and uses the security procedure over control plane as specified in 3GPP TS 33.503 [34]:\n1)\twhen the UE has no 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE and the UE is in NG-RAN coverage; or\n2)\tafter expiration of timer T5078, when in NG-RAN coverage or when entering NG-RAN coverage; or\nb)\tif the UE is authorized to act as a 5G ProSe UE-to-network relay UE and uses the security procedure over control plane as specified in 3GPP TS 33.503 [34]:\n1)\twhen the UE has no 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE and the UE is in NG-RAN coverage; or\n2)\tafter expiration of timer T5079, when in NG-RAN coverage or when entering NG-RAN coverage.\nThe UE shall initiate the 5G ProSe UE-to-network relay discovery security material request procedure by sending a PROSE_SECURITY_MATERIAL_REQUEST message with the <UNR-discovery-security-parameters-request> element. In the <UNR-discovery-security-parameters-request> element, the UE:\na)\tshall include a new transaction ID;\nb)\tshall indicate whether the UE requests the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE, the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE or both;\nc)\tshall include the PC5 UE security capabilities indicating ciphering algorithms supported by the UE;\nd)\tif the UE requests the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE, may include a list of PLMN identities of the visited PLMNs;\ne)\tmay indicate the requested model indicating the model of the 5G ProSe UE-to-network relay discovery over PC5 interface for which security parameters are requested, set to \"model A\" or \"model B\"; and\nf)\tshall include the relay service code indicating the connectivity service to be discovered.\nNOTE:\tIf the requested model is not included in the PROSE_SECURITY_MATERIAL_REQUEST message, security parameters are requested for both model A and model B of the 5G ProSe UE-to-network relay discovery over PC5 interface.\nFigure 8.2.12.2.2.2.1 illustrates the interaction of the UE and the 5G DDNMF in the 5G ProSe UE-to-network relay discovery security material request procedure.\nThe figure depicts a 5G ProSe UE-to-network relay discovery security material request procedure, illustrating the steps involved in requesting security material for a relay. The figure includes various components such as the UE, network, and relay, as well as the security material request process.\nFigure 8.2.12.2.2.2.1: 5G ProSe UE-to-network relay discovery security material request procedure\nUpon receiving a PROSE_SECURITY_MATERIAL_REQUEST message with the <UNR-discovery-security-parameters-request> element, if:\na)\tthe UE requests the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE only and the PROSE_SECURITY_MATERIAL_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe remote UE;\nb)\tthe UE requests the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE only and the PROSE_SECURITY_MATERIAL_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe UE-to-network relay UE; or\nc)\tthe UE requests the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE and the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE and the PROSE_SECURITY_MATERIAL_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe UE-to-network relay UE and authorized to act as a 5G ProSe remote UE;\nthe 5G DDNMF shall send a PROSE_SECURITY_MATERIAL_RESPONSE message containing a <UNR-discovery-security-parameters-accept> element. In the <UNR-discovery-security-parameters-accept> element, the 5G DDNMF:\na)\tshall include the transaction ID set to the value of the transaction ID received in the PROSE_SECURITY_MATERIAL_REQUEST message;\nb)\tif the UE requests the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE:\n1)\tshall include the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE. In the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE, the 5G DDNMF:\nA)\tshall include the expiration timer of the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE; and\nB)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe remote UE:\ni)\tif the requested model is not indicated in the PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model A\", may include the code-receiving security parameters for model A containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask;\nii)\tif the requested model is not indicated in the PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model B\", may include the code-receiving security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask; and\niii)\tshall include the selected ciphering algorithm; and\n2)\tmay include the PC5 security policies for the received relay service code for 5G ProSe remote UE. In the PC5 security policies per relay service code for 5G ProSe remote UE, the 5G DDNMF:\nA)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe remote UE:\ni)\tshall include the PC5 security policies;\nc)\tif the UE requests the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE:\n1)\tshall include the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE. In the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE, the 5G DDNMF:\nA)\tshall include the expiration timer of the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE; and\nB)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe UE-to-network relay UE:\ni)\tif the requested model is not indicated in the PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model A\", may include the code-sending security parameters for model A containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask;\nii)\tif the requested model is not indicated in the PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model B\", may include the code-receiving security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask; and\niii)\tshall include the selected ciphering algorithm; and\n2)\tmay include the PC5 security policies for the received relay service code for 5G ProSe UE-to-network relay UE. In the PC5 security policies for the received relay service code for 5G ProSe UE-to-network relay UE, the 5G DDNMF:\nA)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe UE-to-network relay UE:\ni)\tshall include the PC5 security policies; and\nd)\tshall include the current time set to the current UTC-based time at the 5G DDNMF and the max offset.\nIf the UE requests the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE, the UE identity in the PROSE_SECURITY_MATERIAL_REQUEST message indicates a UE authorized to act as a 5G ProSe remote UE and the PROSE_SECURITY_MATERIAL_REQUEST message contains a list of PLMN identities of the visited PLMNs, the 5G DDNMF shall include in the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE any information received from 5G DDNMFs that are discovered based on the provided list of PLMN identities of potential 5G ProSe UE-to-network relay UEs which can serve the UE. If the PROSE_SECURITY_MATERIAL_REQUEST message does not contain a list of PLMN identities of the visited PLMNs, the 5G DDNMF may get the PLMN identities of potential 5G ProSe UE-to-network relay UEs through different means such as local configurations.\nUpon receipt of the PROSE_SECURITY_MATERIAL_RESPONSE message with the <UNR-discovery-security-parameters-accept>, if the transaction ID contained in the <UNR-discovery-security-parameters-accept> element matches the value sent by the UE in a PROSE_SECURITY_MATERIAL_REQUEST message with the <UNR-discovery-security-parameters-request> element, the UE:\na)\tif the PROSE_SECURITY_MATERIAL_RESPONSE message contains the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE:\n1)\tshall store the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE, shall stop timer T5078, if running and shall start timer T5078 with the value of the expiration timer indicated in the 5G ProSe UE-to-network relay discovery security material for 5G ProSe remote UE; and\n2)\tif the PC5 security policies for the relay service code for 5G ProSe remote UE are received, shall store the PC5 security policies for the relay service code for 5G ProSe remote UE;\nb)\tif the PROSE_SECURITY_MATERIAL_RESPONSE message contains the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE:\n1)\tshall store the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE, shall stop timer T5079, if running and shall start timer T5079 with the value of the expiration timer indicated in the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-to-network relay UE; and\n2)\tif the PC5 security policies for the relay service code for 5G ProSe UE-to-network relay UE are received, shall store the PC5 security policies for the relay service code for 5G ProSe UE-to-network relay UE; and\nc)\tshall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset.\nIf the PROSE_SECURITY_MATERIAL_REQUEST message with the <UNR-discovery-security-parameters-request> element cannot be accepted by the 5G DDNMF, the 5G DDNMF shall send a PROSE_SECURITY_MATERIAL_RESPONSE message containing a <UNR-discovery-security-parameters-reject> element. In the <UNR-discovery-security-parameters-reject> element, the 5G DDNMF shall include the transaction ID set to the value of the transaction ID received in the PROSE_SECURITY_MATERIAL_REQUEST message and shall include an appropriate PC3a control protocol cause value.\nUpon receipt of the PROSE_SECURITY_MATERIAL_RESPONSE message with the <UNR-discovery-security-parameters-reject> element, if the transaction ID contained in the <UNR-discovery-security-parameters-reject> element matches the value sent by the UE in a PROSE_SECURITY_MATERIAL_REQUEST message with the <UNR-discovery-security-parameters-request> element, the UE shall consider the 5G ProSe UE-to-network relay discovery security material request procedure as rejected.\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of PROSE_SECURITY_MATERIAL_REQUEST message (e.g. after TCP retransmission timeout).\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the 5G ProSe UE-to-network relay discovery security material request procedure.\nb)\tNo response from the 5G DDNMF after the PROSE_SECURITY_MATERIAL_REQUEST message has been successfully delivered (e.g. TCP ACK has been received for the PROSE_SECURITY_MATERIAL_REQUEST message)\nThe UE shall retransmit the PROSE_SECURITY_MATERIAL_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of PROSE_SECURITY_MATERIAL_RESPONSE message.\nAfter receiving an indication from lower layer that the PROSE_SECURITY_MATERIAL_RESPONSE message has not been successfully acknowledged (e.g. TCP ACK is not received), the 5G DDNMF shall abort the procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.13\tCommunication path switching between 5G ProSe UE-to-network relays",
                            "text_content": "For a 5G ProSe remote UE accessing the network via a 5G ProSe UE-to-network relay UE, if the related conditions specified in clause 8.2.3.2 are met, the 5G ProSe remote UE:\na)\tmay perform the procedure of target UE-to-network relay discovery and selection for communication path switching as specified in clause 8.2.13.2; and\n1)\tif a target 5G ProSe UE-to-network relay UE which can provide the connectivity service same as the source 5G ProSe UE-to-network relay UE provides to the 5G ProSe remote UE is selected, shall perform procedures of communication path switching from the source 5G ProSe UE-to-network relay UE to the target 5G ProSe UE-to-network relay UE as specified in clause 8.2.13.3, clause 8.2.13.4 or clause 8.2.13.5,\n2)\totherwise, may (re-)evaluate the URSP, if any, as specified clause 6.5.4 of 3GPP TS 23.304 [2].\nIn order to discover a target 5G ProSe UE-to-network relay UE, the 5G ProSe remote UE shall initiate monitoring procedure for UE-to-network relay discovery as specified in clause 8.2.1.2.3, discoverer procedure for UE-to-network relay discovery as specified in clause 8.2.1.3.1 or both, depending on UE's configuration parameters for 5G ProSe UE-to-network relay as specified in clause 5.2.5, with following additions:\na)\tfor monitoring procedure for UE-to-network relay discovery, in the PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement received from the announcing UE, the 5G ProSe remote UE shall monitor the same  relay service code as provided by the source 5G ProSe UE-to-network relay UE; and\nb)\tfor discoverer procedure for UE-to-network relay discovery, in the PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation, the 5G ProSe remote UE shall set the relay service code parameter to the same relay service code as provided by the source 5G ProSe UE-to-network relay UE.\nNOTE 1:\tThe connectivity service in a) and b) above refers to 5G ProSe layer-2 UE-to-network relay service, 5G ProSe layer-3 UE-to-network relay service with the set of PDU session parameters, or 5G ProSe layer-3 UE-to-network relay service using N3IWF access for the relayed traffic.\nNOTE 2:\tIn a) and b) above, specifying that the 5G ProSe remote UE use the same relay service code that was used with the source 5G ProSe UE-to-network relay UE ensures that the same security mechanism (i.e. either the security procedure over control plane or the security procedure over user plane as specified in 3GPP TS 33.503 [34]) is used with the target 5G ProSe UE-to-network relay UE.\nIf the target 5G ProSe UE-to-network relay UE with the same relay service code as provided by the source 5G ProSe UE-to-network relay UE is available after the execution of the above discovery procedure(s), the 5G ProSe remote UE shall perform the UE-to-network relay selection procedure as specified in clause 8.2.2 and shall perform the procedure of path switching as specified in clause 8.2.13.3, clause 8.2.13.4 or clause 8.2.13.5. Otherwise, the 5G ProSe remote UE may:\na)\t(re-)evaluate the URSP, if any, as specified in in clause 6.5.4 of 3GPP TS 23.304 [2];\nb)\tperform the procedure of target UE-to-network relay discovery and selection for communication path switching as specified in this clause; and\nc)\tperform the procedure of path switching as specified in clause 8.2.13.3, clause 8.2.13.4 or clause 8.2.13.5.\nIf a 5G ProSe layer-3 UE-to-network relay without N3IWF is selected as the target 5G ProSe UE-to-network relay UE, the 5G ProSe remote UE shall perform the procedure of 5G ProSe communication via 5G ProSe layer-3 UE-to-network relay without N3IWF as specified in clause 6.5.1.1 of 3GPP TS 23.304 [2]. In this case, the service continuity support is used by the application layer procedures which is out of scope of the present specification.\nIf a 5G ProSe layer-3 UE-to-network relay with N3IWF is selected as the target 5G ProSe UE-to-network relay UE, the 5G ProSe remote UE shall perform the procedure as specified in clause 8.2.7 with following additions:\na)\tif the source 5G ProSe UE-to-network relay UE is a 5G ProSe layer-3 UE-to-network relay with N3IWF, the 5G ProSe remote UE shall select the same N3IWF which is connected with the source 5G ProSe layer-3 UE-to-network relay UE and use MOBIKE as specified in IETF RFC 4555 [52] if the 5G ProSe remote UE supports IETF RFC 4555 [52];\nb)\tif the source 5G ProSe UE-to-network relay UE is a 5G ProSe layer-3 UE-to-network relay without N3IWF, the service continuity support is used by the application layer procedures which is out of scope of the present specification; and\nc)\tif the source 5G ProSe UE-to-network relay UE is a 5G ProSe layer-2 UE-to-network relay, the 5G ProSe remote UE shall perform handover of a PDU session procedure from 3GPP to untrusted non-3GPP access as specified in clause 4.9.2.2 of 3GPP TS 23.502 [51].\nIf a 5G ProSe layer-2 UE-to-network relay is selected as the target 5G ProSe UE-to-network relay UE, the 5G ProSe remote UE shall perform the procedure of 5G ProSe communication via 5G ProSe layer-2 UE-to-network relay as specified in clause 6.5.2 of 3GPP TS 23.304 [2] with following additions:\na)\tif the source 5G ProSe UE-to-network relay UE is a 5G ProSe layer-3 UE-to-network relay with N3IWF, the 5G ProSe remote UE shall perform handover of a PDU session procedure from untrusted non-3GPP to 3GPP access as specified in clause 4.9.2.1 of 3GPP TS 23.502 [51];\nb)\tif the source 5G ProSe UE-to-network relay UE is a 5G ProSe layer-3 UE-to-network relay without N3IWF, the service continuity support is used by the application layer procedures which is out of scope of the present specification; or\nEditor's note:\tIf the source 5G ProSe UE-to-network relay is a 5G ProSe layer-2 UE-to-network relay, the procedure is FFS and will be aligned with RAN2 specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.14\t5G ProSe public warning notification relay procedure",
                            "text_content": "The purpose of the 5G ProSe public warning notification relay procedure is for the 5G ProSe UE-to-network relay UE to broadcast the warning message specified in 3GPP TS 23.041 [54] received from the network to the 5G ProSe remote UE(s) nearby. Broadcast mode 5G ProSe direct communication over PC5 is used for broadcasting the warning message. A 5G ProSe remote UE can receive the broadcasted warning message without establishing a connection to the 5G ProSe UE-to-network Relay for the relay service code based on the configuration as specified in the clause 5.2.5.\nNOTE:\tIf the 5G ProSe layer-2 UE-to-network relay UE is not configured with the destination layer-2 ID for broadcasting warning messages, 5G ProSe layer-2 UE-to-network relay UE forwards the SIB messages (i.e. SIB 6/7/8) for public warning system to a connected 5G ProSe layer-2 remote UE over the unicast link as specified in 3GPP TS 38 300 [21].\nThe 5G ProSe UE-to-network relay UE broadcasts the public warning notification messages if the 5G ProSe UE-to-network relay UE receives the public warning notification message from the network as specified in 3GPP TS 23.041 [54].\nNOTE:\tThe 5G ProSe UE-to-network relay UE can perform the duplication detection function as specified in 3GPP TS 23.041 [54] to suppress received duplicated warning messages over Uu in order to avoid broadcasting the duplicated warning message over PC5.\nThe 5G ProSe UE-to-network relay UE shall start broadcasting the received public warning notification message if:\na)\tthe 5G ProSe UE-to-network relay UE is served by NG-RAN for 5G ProSe communication;\nb)\tthe 5G ProSe UE-to-network relay UE is authorised to act as a 5G ProSe UE-to-network relay UE;\nc)\tthe registered PLMN is in the list of PLMNs in which the UE is authorized to use 5G ProSe communication over PC5 when the UE is served by NG-RAN for 5G ProSe communication over PC5 as specified in clause 5.2.4; and\nd)\tthe 5G ProSe UE-to-network relay UE is configured with the default destination layer-2 ID for broadcasting warning messages and the PC5 QoS parameters for broadcasting warning messages.\nThe UE shall include 5G ProSe public warning notification relay message in a protocol data unit with following parameters:\na)\tdata unit(s) includes the public warning notification message received from the network;\nb)\ta layer-3 protocol data unit type (see 3GPP TS 38.323 [16]) set to unstructured;\nc)\tthe source layer-2 ID set to the layer-2 ID self-assigned by the UE for 5G ProSe communication over PC5 as specified in clause 7.3.2.1.2;\nd)\tthe destination layer-2 ID set to the destination layer-2 ID configured for broadcasting warning message over PC5 as specified in clause 5.2.5;\ne)\tthe PQFI set to the value corresponding to the configured PC5 QoS parameters for broadcasting warning messages as specified in clause 5.2.5; and\nf)\tthe NR Tx profile based on the configuration for broadcasting warning message over PC5 as specified in clause 5.2.5.\nThen the UE shall request radio resources for 5G ProSe communication over PC5 as specified in 3GPP TS 38.300 [21] and pass the data unit(s) on the PC5 QoS flow identified by the PQFI to lower layers for transmission.\nIf the UE is camped on a serving cell indicating that 5G ProSe communication over PC5 is supported by the network, but not broadcasting any carrier frequencies and radio resources for 5G ProSe communication over PC5 as specified in 3GPP TS 38.331 [13], the UE shall request radio resources for 5G ProSe communication over PC5 as specified in 3GPP TS 24.501 [11].\nThe 5G ProSe remote UE is configured with a destination layer-2 ID(s) for reception of data unit(s) over PC5 carring 5G ProSe public warning notification relay message. The 5G ProSe remote UE is a receiving UE for this procedure.\nThe receiving UE shall determine the PC5 QoS parameter and the NR Tx profile for the 5G ProSe public warning notification relay based on the configuration as specified in clause 5.2.5, and shall provide the PC5 QoS parameters, the NR Tx profile, and the destination layer-2 ID for the 5G ProSe public warning notification relay to lower layers.\nFor each received protocol data unit over PC5, the receiving UE shall check if the destination layer-2 ID of the received protocol data unit matches one of the configured destination layer-2 ID for the 5G ProSe public warning notification relay. If yes, the UE shall then check whether the protocol data unit type as defined 3GPP TS 38.323 [16] provided by the lower layers for the received packet is set to Unstructured and pass the protocol data unit to the corresponding upper layer entity for public warning system.\nNOTE:\tThe 5G ProSe remote UE can perform the duplication detection function as specified in 3GPP TS 23.041 [54] to detect duplicated warning messages received over PC5 and/or Uu, for example, if there are multiple 5G ProSe UE-to-network relay UE broadcasting the warning messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.15\tMulti-path communication via a PDU session and via 5G ProSe UE-to-network relay",
                            "text_content": "This clause describes the procedures to support multi-path communication via a PDU session (direct path) and via 5G ProSe UE-to-network relay (indirect path).\nBased on the URSP as specified in 3GPP TS 24.526 [5], the UE may access the network through multi-path communication, i.e., via a PDU session (direct path) and via a 5G ProSe layer-3 UE-to-network relay UE (indirect path).\nFor the 5G ProSe remote UE, to access the network via a 5G ProSe layer-3 UE-to-network relay UE (the indirect path), the 5G ProSe remote UE:\na)\tif there is no existing connection with a 5G ProSe layer-3 UE-to-network relay UE for the needed RSC;\n1)\tshall perform the procedures of UE-to-network relay discovery and UE-to-network relay selection as specified in clause 8.2.1 and clause 8.2.2 in order to select a 5G ProSe layer-3 UE-to-network relay UE; and\n2)\tshall establish a connection with the selected 5G ProSe layer-3 UE-to-network relay UE by performing the procedure of 5G ProSe direct link establishment procedure as specified in clause 7.2.2; or\nb)\tif there is an existing connection with a 5G ProSe layer-3 UE-to-network relay UE for the needed RSC:\n1)\tmay modify the existing connection with a 5G ProSe layer-3 UE-to-network relay UE by performing the procedure of 5G ProSe direct link modification procedure as specified in clause 7.2.3.\nFor the 5G ProSe remote UE, to access the network via a PDU session (the direct path), the UE establishes a new PDU session or, if needed, modifies an existing PDU session as specified in 3GPP TS 24.501 [11]. If the indirect path consists of a 5G ProSe layer-3 UE-to-network relay with N3IWF support, the 5G ProSe remote UE, if needed, establishes the direct path by establishing a new MA PDU session or modifying an existing MA PDU session as specified in 3GPP TS 24.501 [11].\nThe procedure of multi-path communication via a PDU session and via 5G ProSe layer-2 UE-to-network relay is specified in 3GPP TS 38.300 [21].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "8a\t5G ProSe UE-to-UE relay",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8a.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the procedures for 5G ProSe UE-to-UE relay.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8a.2\tProcedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8a.2.1\t5G ProSe UE-to-UE relay discovery over PC5 interface",
                            "text_content": "This clause describes the procedures for both 5G ProSe layer-3 and layer-2 UE-to-UE relay discovery for public safety use and commercial services at a ProSe-enabled UE over the PC5 interface. The purpose of the 5G ProSe UE-to-UE relay discovery procedure over PC5 interface is to enable a ProSe-enabled UE to detect and identify another ProSe-enabled UE over PC5 interface for 5G ProSe UE-to-UE relay communication between two UEs with the assistance of a 5G ProSe UE-to-UE relay UE.\nA 5G ProSe UE-to-UE relay supporting multiple relay service codes can advertise the relay service codes using multiple discovery messages, with one relay service code per discovery message.\nTo perform 5G ProSe UE-to-UE relay discovery over PC5 interface, the UE is configured with the related information as described in clause 5.2.7. The following models for 5G ProSe UE-to-UE relay discovery procedure over PC5 interface as specified in 3GPP TS 23.304 [2] are supported:\na)\tModel A uses a single discovery protocol message (Announcement); and\nb)\tModel B uses two discovery protocol messages (Solicitation and Response).\nNOTE:\tIf the UE is authorized to perform both 5G ProSe UE-to-UE relay discovery Model A and 5G ProSe UE-to-UE relay discovery Model B, it is up to UE implementation to select which model to perform or perform both models simultaneously.\nThe 5G ProSe end UEs shall use the security materials provisioned by PC3a control protocol procedures for 5G ProSe direct discovery as specified in clause 6.2 to protect a direct discovery set so that the direct discovery set is transparent to the 5G ProSe UE-to-UE relay UE. The 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE shall use the security materials provisioned by 5G ProSe security procedure for 5G ProSe UE-to-UE relay as specified in clause 8a.2.x or clause 8a.2.y to protect the 5G ProSe UE-to-UE relay discovery messages.\nEditor's Note:\tIt is FFS how to construct the direct discovery set for 5G ProSe UE-to-UE relay discovery model A.\nThe following procedures are defined for 5G ProSe UE-to-UE relay discovery procedure over PC5 interface:\na)\t5G ProSe UE-to-UE relay discovery over PC5 interface with Model A:\n1)\tAnnouncing UE procedure for 5G ProSe UE-to-UE relay discovery initiation;\n2)\tAnnouncing UE procedure for 5G ProSe UE-to-UE relay discovery completion;\n3)\tMonitoring UE procedure for 5G ProSe UE-to-UE relay discovery initiation; and\n4)\tMonitoring UE procedure for 5G ProSe UE-to-UE relay discovery completion; and\nb)\t5G ProSe UE-to-UE relay discovery over PC5 interface with Model B:\n1)\tDiscoverer end UE procedure for 5G ProSe UE-to-UE relay discovery initiation;\n2)\tDiscoverer end UE procedure for 5G ProSe UE-to-UE relay discovery completion;\n3)\tRelay UE procedure for UE-to-UE relay discovery initiation;\n4)\tRelay UE procedure for UE-to-UE relay discovery completion;\n5)\tDiscoveree end UE procedure for 5G ProSe UE-to-UE relay discovery initiation; and\n6)\tDiscoveree end UE procedure for 5G ProSe UE-to-UE relay discovery completion.\nIn this procedure, the 5G ProSe UE-to-UE relay UE acts as an \"announcing UE\" and the 5G ProSe end UE acts as a \"monitoring UE\".\nThe purpose of the announcing UE procedure for UE-to-UE relay discovery is:\na)\tto enable a ProSe-enabled UE to announce availability of a connectivity service provided by a UE-to-UE relay of the ProSe-enabled UE to other ProSe-enabled UEs, upon a request from upper layers as defined in 3GPP TS 23.304 [2]; or\nb)\tto enable a ProSe-enabled UE to measure the PROSE PC5 DISCOVERY message signal strength between the ProSe-enabled UE and the 5G ProSe UE-to-UE relay UE(s) for UE-to-UE relay selection/reselection.\nThe UE is authorised to perform the announcing UE procedure for UE-to-UE relay discovery if:\na)\tthe UE is authorised to act as a 5G ProSe UE-to-UE relay UE in the PLMN indicated by the serving cell as specified in clause 5.2.7, and\n1)\tthe UE is served by NG-RAN and the UE is authorised to perform 5G ProSe UE-to-UE relay discovery in the PLMN as specified in clause 5; or\n2)\tthe UE is authorised to perform 5G ProSe UE-to-UE relay discovery when not served by NG-RAN as specified in clause 5 and intends to use the provisioned radio resources for 5G ProSe UE-to-UE relay discovery; and\nb)\tthe UE is configured with:\n1)\tthe relay service code parameter identifying the connectivity service to be announced as specified in clause 5.2.7 and the indicated security procedure for 5G ProSe UE-to-UE relay for the relay service code is supported by the UE as per 3GPP TS 33.503 [34]; and\n2)\tthe User info ID for the 5G ProSe UE-to-UE relay discovery as specified in clause 5.2.7;\notherwise, the UE is not authorised to perform the announcing UE procedure for UE-to-UE relay discovery.\nThe direct discovery set shall be available in the announcing UE to perform the announcing UE procedure for UE-to-UE relay discovery. The direct discovery set may be retrieved from a previous 5G ProSe UE-to-UE relay discovery response message, or from a previous 5G ProSe UE-to-UE relay communication. The announcing UE shall store the list of the direct discovery set(s) based on the validity timer(s) derived from the bit length of UTC-based counter LSB contents of the UTC-based counter LSB IE associated with the direct discovery set as specified in clause 6.1.3.3 of 3GPP TS 33.503 [34]. If the validity timer associated with a direct discovery set expires, the announcing UE shall remove the direct discovery set from the list of direct discovery sets.\nEditor's Note:\tIt is FFS whether and how to retrieve the direct discovery sets via the existing direct link between the end UE and the relay UE.\nEditor's Note:\tIt is FFS how to address the announce prohibited indication for the direct discovery set.\nFigure 8a.2.1.2.2.2.1 illustrates the interaction of the UEs in the announcing UE procedure for UE-to-UE relay discovery.\nThe figure depicts a simplified process for UE-to-UE relay discovery in a 5G network. It illustrates the steps involved in identifying and selecting a relay for a UE to communicate with another UE. The figure includes a series of numbered steps, each represented by a different color, to help understand the flow of information and the decision-making process. The figure also includes a legend to clarify the meaning of the different colors and symbols used in the steps. Overall, the figure provides a clear and concise visual representation of the UE-to-UE relay discovery process in a 5G network.\nFigure 8a.2.1.2.2.2.1: Announcing UE procedure for UE-to-UE relay discovery\nWhen the UE is triggered by the upper layers to announce availability of a connectivity service provided by a 5G ProSe UE-to-UE relay, if the UE is authorised to perform the announcing UE procedure for UE-to-UE relay discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages for 5G ProSe UE-to-UE relay discovery as specified in 3GPP TS 38.331 [13], shall perform a service request procedure or mobility registration procedure as specified in 3GPP TS 24.501 [11];\nb)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time as specified in clause 11.2.5;\nc)\tshall generate a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement according to clause 10.2.1. In the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement, the UE:\n1)\tshall set the announcer info parameter to the User info ID configured for the 5G ProSe UE-to-UE relay discovery, as specified in clause 5.2.7;\n2)\tshall set the relay service code parameter to the relay service code configured for the connectivity service to be announced, as specified in clause 5.2.7. If the UE is not served by NG-RAN, the relay service code shall be associated with the network assistance security indication indicating the security procedure without network assistance is to be used;\n3)\tshall set the list of direct discovery sets to a list of the stored direct discovery set(s).\nNOTE 0:\tThe 5G ProSe UE-to-UE relay announces user info IDs of other UEs in proximity only if the PC5 signal strength of the UEs in proximity measured by the 5G ProSe UE-to-UE relay is above the configured signal strength threshold as specified in 3GPP TS 38.331 [16]\n4)\tshall include the MIC field computed as described in 3GPP TS 33.503 [34];5)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter;\n6)\tshall set the Resource Status Indicator bit of the status indicator parameter to indicate whether or not the UE has resources available to provide a connectivity service for 5G ProSe UE-to-UE relay for additional ProSe-enabled UEs; and\n7)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.12;\nd)\tshall apply the DUIK, DUSK or DUCK with the associated encrypted bitmask for the relay service code for 5G ProSe UE-to-UE relay discovery, along with the UTC-based counter, to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more above parameters, as specified in 3GPP TS 33.503 [34];\ne)\tshall set the destination layer-2 ID to the default destination layer-2 ID as specified in clause 5.2.7 and self-assign a source layer-2 ID for sending the 5G ProSe UE-to-UE relay discovery announcement; and\nNOTE 1:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2 and is different from any other self-assigned source layer-2 ID in use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a different discovery model as specified in clause 6.2.14.2.2.2, clause 6.2.15.2.2.2, clause 8.2.1.3.1.2 and clause 8a.2.1.3.1.2.\nf)\tshall pass the resulting PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement to the lower layers for transmission over the PC5 interface with the source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery.\nUntil the UE is triggered by the upper layers to stop announcing availability of a connectivity service provided by a 5G ProSe UE-to-UE relay UE, or until the UE stops being authorised to perform the announcing UE procedure for UE-to-UE relay discovery,\na)\tif the list of direct discovery set(s) remains the same, the UE shall ensure that it keeps on passing the same PROSE PC5 DISCOVERY message along with the same source layer-2 ID, destination layer-2 ID, and an indication that the message is for 5G ProSe direct discovery to the lower layer for transmission, and\nb)\tif the list of direct discovery set(s) in the UE is updated, for example, other valid direct discovery set(s) are available, or the direct discovery set(s), whose validity timer(s) have expired, are removed, the UE shall generate and protect a new PROSE PC5 DISCOVERY message containing the updated list of direct discovery set(s) and pass the PROSE PC5 DISCOVERY message along with the same source layer-2 ID, destination layer-2 ID, and an indication that the message is for 5G ProSe direct discovery to the lower layer for transmission.\nNOTE 2:\tThe announcing UE can stop announcing UE procedure for UE-to-UE relay discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the announcing UE is triggered by the upper layers to stop announcing availability for 5G ProSe UE-to-UE relay, when the announcing UE stops being authorised to perform the announcing UE procedure for UE-to-UE relay discovery, or none of the direct discovery set to be announced is available, the UE shall instruct the lower layers to stop announcing.\nNOTE:\tThe announcing UE can stop announcing UE procedure for UE-to-UE relay discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the UE stops announcing, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe purpose of the monitoring UE procedure for UE-to-UE relay discovery is:\na)\tto enable a ProSe-enabled UE to become aware of proximity of a connectivity service provided by a 5G ProSe UE-to-UE relay UE, upon a request from upper layers as defined in 3GPP TS 23.304 [2]; or\nb)\tto enable a ProSe-enabled UE to perform measurements of signal strength of PROSE PC5 DISCOVERY messages from 5G ProSe UE-to-UE relay UE(s) for UE-to-UE relay selection/reselection.\nThe UE is authorised to perform the monitoring UE procedure for UE-to-UE relay discovery if:\na)\tthe following is true:\n1)\tthe UE is not served by NG-RAN, is authorised to perform 5G ProSe UE-to-UE relay discovery using monitoring when the UE is not served by NG-RAN and is configured with the radio parameters to be used for 5G ProSe UE-to-UE relay discovery when not served by NG-RAN;\n2)\tthe UE is served by NG-RAN and is authorised to perform 5G ProSe UE-to-UE relay discovery monitoring in at least one PLMN; or\n3)\tthe UE is:\ni)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11] ; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\nii)\tauthorised to perform 5G ProSe UE-to-UE relay discovery using monitoring when the UE is not served by NG-RAN, and:\nA)\tconfigured with the radio parameters to be used for 5G ProSe UE-to-UE relay discovery when not served by NG-RAN; and\nb)\tthe UE is configured with the relay service code parameter identifying the connectivity service to be monitored, as specified in clause 5.2.7;\notherwise, the UE is not authorised to perform the monitoring UE procedure for UE-to-UE relay discovery.\nFigure 8a.2.1.2.3.2.1 illustrates the interaction of the UEs in the monitoring UE procedure for UE-to-UE relay discovery.\nThe figure depicts a monitoring system for UE-to-UE relay discovery in a 5G network. It shows the process of UE-to-UE relay discovery, with a focus on the UE's procedure for identifying and selecting a relay. The system includes a relay selection algorithm, a relay discovery mechanism, and a relay monitoring system. The figure illustrates the importance of this process in ensuring reliable communication in a 5G network.\nFigure 8a.2.1.2.3.2.1: Monitoring UE procedure for UE-to-UE relay discovery\nWhen the UE is triggered by the upper layers to monitor proximity of a connectivity service provided by a 5G ProSe UE-to-UE relay UE or when the UE decides to perform 5G ProSe UE-to-UE relay reselection as specified in clause 8a.2.3, and if the UE is authorised to perform the monitoring UE procedure for UE-to-UE relay discovery, then the UE shall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY messages with the default destination layer-2 ID as specified in clause 5.2.7.\nUpon reception of a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement, for the target relay service code of the connectivity service which the UE is authorized to discover, the UE shall obtain a valid UTC time from the lower layers and generate a UTC-based counter corresponding to this UTC time, and use it to recover the UTC-based counter associated with the PROSE PC5 DISCOVERY message and the UTC-based counter associated with the direct discovery set(s). The UE shall use the associated DUSK, if received from the 5G DDNMF (if security procedure over control plane for 5G ProSe UE-to-UE relay is used) or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used) and the UTC-based counter associated with the PROSE PC5 DISCOVERY message to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF (if security procedure over control plane for 5G ProSe UE-to-UE relay is used) or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUCK and the UTC-based counter associated with the PROSE PC5 DISCOVERY message to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF (if security procedure over control plane for 5G ProSe UE-to-UE relay is used) or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUIK and the UTC-based counter associated with the PROSE PC5 DISCOVERY message to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement.\nThe UE shall further extract the received direct discovery set(s) from the list of direct discovery set(s) included in the PROSE PC5 DISCOVERY message. Then, for each direct discovery set, if a DUSK is included in the in code-receiving security parameter for the ProSe service which the UE is authorized to discover (see clause 6.2.6), the UE shall use DUSK and the UTC-based counter associated with the direct discovery set, in order to unscramble the direct discovery set as described in 3GPP TS 33.503 [34]. Then if a DUCK is included in the code-receiving security parameter, the UE shall use the DUCK and the UTC-based counter associated with the direct discovery set, in order to decrypt the direct discovery set, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is included in the code-receiving security parameter, the UE shall use the DUIK and the UTC-based counter associated with the direct discovery set, in order to verify the MIC for the direct discovery set.\nNOTE:\tThe UE can determine the received PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement is for 5G ProSe direct discovery based on an indication from the lower layer.\nThen if:\na)\tthe relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement is the same as the relay service code parameter configured as specified in clause 5 for the connectivity service being monitored; and\nb)\tat least one of the direct discovery set(s) from the list of direct discovery sets included in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement contains the application layer ID of the target end UE provided by upper layers for the connectivity service being monitored,\nthen the UE shall consider that the connectivity service the UE seeks to monitor has been discovered. In addition, the UE can measure the signal strength of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement for 5G ProSe UE-to-UE relay selection or reselection.\nWhen the UE is triggered by the upper layers to stop monitoring proximity of other UEs for 5G ProSe UE-to-UE relay, or when the UE stops being authorised to perform the monitoring UE procedure for UE-to-UE relay discovery, the UE shall instruct the lower layers to stop monitoring.\nWhen the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nIn the following procedures, the 5G ProSe end UE sending the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation is called the \"discoverer end UE\" and the other 5G ProSe end UE is called the \"discoveree end UE\".\nThe purpose of the discoverer end UE procedure for UE-to-UE Relay discovery is:\na)\tto enable a ProSe-enabled UE to solicit proximity of a connectivity service provided by a 5G ProSe UE-to-UE relay UE, upon a request from upper layers; or\nb)\tto enable a ProSe-enabled UE to measure the PROSE PC5 DISCOVERY message signal strength between the ProSe-enabled UE and the 5G ProSe UE-to-UE relay UE(s) for UE-to-UE relay selection/reselection.\nThe UE is authorised to perform the discoverer end UE procedure for UE-to-UE relay discovery if:\na)\tone of the following is true:\n1)\tthe UE is not served by NG-RAN, is authorised to act as a 5G ProSe end UE towards a 5G ProSe UE-to-UE relay UE and is configured with the radio parameters to be used for ProSe UE-to-UE relay discovery when not served by NG-RAN;\n2)\tthe UE is served by NG-RAN, is authorised to act as a 5G ProSe end UE towards a 5G ProSe UE-to-UE relay UE; or\n3)\tthe UE is:\ni)\tin 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122 [14] and the reason for the UE being in limited service state is one of the following:\nA)\tthe UE is unable to find a suitable cell in the selected PLMN as specified in 3GPP TS 38.304 [15];\nB)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501 [11]; or\nC)\tthe UE received a REGISTRATION REJECT message or a SERVICE REJECT message with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS 24.501 [11]; and\nii)\tauthorised to act as a 5G ProSe end UE towards a 5G ProSe UE-to-UE relay UE when the UE is not served by NG-RAN and configured with the radio parameters to be used for ProSe UE-to-UE relay discovery use when not served by NG-RAN;\nb)\tthe UE is configured with:\n1)\tthe relay service code parameter identifying the connectivity service provided by a 5G ProSe UE-to-UE relay to be solicited as specified in clause 5.2.7 and the indicated security procedure for the relay service code is supported by the UE; and\n2)\tthe user info ID for the 5G ProSe UE-to-UE relay discovery, as specified in clause 5.2.7.\notherwise, the UE is not authorised to perform the discoverer end UE procedure for UE-to-UE relay discovery.\nFigure 8a.2.1.3.2.2.1 illustrates the interaction of the UEs in the discoverer end UE procedure for UE-to-UE relay discovery.\nThe figure depicts the procedure for UE-to-UE relay discovery in a 5G network, showing the steps involved in identifying and selecting a relay for a UE to communicate with another UE. The figure includes a diagram of the network, with the UE at the center, and the relay at the end. The steps are labeled and are explained in detail, ensuring that the process is clear and understandable.\nFigure 8a.2.1.3.2.2.1: Discoverer end UE procedure for UE-to-UE Relay discovery\nFor PROSE PC5 DISCOVERY message signal strength measurement, the UE manages a periodic measurement timer T5111, which is used to trigger the periodic PROSE PC5 DISCOVERY message signal strength measurement between the UE and the 5G ProSe UE-to-UE relay UE with which the UE has a link established. It is started whenever the UE has established a direct link with a 5G ProSe UE-to-UE relay UE and restarted whenever the UE receives the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response from the 5G ProSe UE-to-UE relay UE with which the UE has a link established.\nWhen the UE is triggered by the upper layers to solicit proximity of a connectivity service provided by a 5G ProSe UE-to-UE relay UE to communicate with a target discoveree end UE, or when the periodic measurement timer T5111 expires and if the UE is authorised to perform the discoverer end UE procedure for UE-to-UE relay discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages for relay discovery as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11];\nb)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nc)\tshall generate a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation. In the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation, the UE:\n1)\tshall include the direct discovery set IE which contains:\ni)\tthe discoveree user info parameter set to the application layer ID of the discoveree end UE as provided by the upper layers;\nii)\tthe discoverer user info parameter set to the application layer ID of the discoverer end UE as provided by the upper layers;\niii)\tthe MIC field computed as described in 3GPP TS 33.503 [34] for the direct discovery set; and\niv)\tthe UTC-based counter LSB parameter set to the 4 least significant bits of the UTC-based counter;\nand shall apply the DUIK, DUSK or DUCK with the associated encrypted bitmask in the code-sending security parameter for the ProSe service received from the DDNMF (see clause 6.2), along with the UTC-based counter, to the direct discovery set IE as specified in 3GPP TS 33.503 [34];\n2)\tshall include the source discoverer end UE info parameter set to the configured user info ID for the 5G ProSe UE-to-UE relay discovery, as specified in clause 5.2.7;\n3)\tshall set the relay service code parameter to the relay service code parameter identifying the connectivity service to be solicited, configured in clause 5.2.7.\n4)\tshall include the MIC field computed as described in 3GPP TS 33.503 [34];\n5)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter;\n6)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.13;\n7)\tmay set the UE-to-UE relay UE info parameter to user info ID for the 5G ProSe UE-to-UE relay UE, if known e.g. during previous 5G ProSe UE-to-UE relay discovery or 5G ProSe UE-to-UE relay communication procedure(s); and\n8)\tshall include the announce prohibited indication with its value set as \"It is prohibited to broadcast the user info \" in the PC5 DISCOVERY message for UE-to-UE relay discovery solicitation if the discoverer UE needs to indicate to a 5G ProSe UE-to-UE relay UE that it is prohibited from broadcasting the user info of the discoverer end UE included in the direct discovery set during the procedure of 5G ProSe UE-to-UE relay discovery over PC5 interface with model A;\nd)\tshall apply the DUIK, DUSK or DUCK with the associated encrypted bitmask for the relay service code for 5G ProSe UE-to-UE relay discovery, along with the UTC-based counter, to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more of the above parameters, as specified in 3GPP TS 33.503 [34];\ne)\tshall set the destination layer-2 ID to the default destination layer-2 ID as specified in clause 5.2.7 and self-assign a source layer-2 ID for sending the UE-to-UE relay discovery solicitation message; and\nNOTE 2:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2 and is different from any other self-assigned source layer-2 ID in use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a different discovery model as specified in clause 6.2.14.2.1.2, clause 6.2.15.2.1.2, clause 8.2.1.2.2.2, clause 8.2.1.2.4.2 and clause 8a.2.1.2.2.2.\nf)\tshall pass the resulting PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation along with the source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface.\nIf the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation is used to solicit proximity of a connectivity service provided by a 5G ProSe UE-to-UE relay UE, the UE shall ensure that it keeps on passing the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation for transmission until the UE is triggered by the upper layers to stop soliciting proximity of a connectivity service provided by a 5G ProSe UE-to-UE relay UE, or until the UE stops being authorised to perform the discoverer end UE procedure for UE-to-UE relay discovery. How this is achieved is left up to UE implementation.\nNOTE 3:\tThe discoverer end UE can stop discoverer end UE procedure for UE-to-UE relay discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nIf the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation is used to trigger the PROSE PC5 DISCOVERY message signal strength measurement between the UE and the 5G ProSe UE-to-UE relay UE with which the UE has a link established, the UE shall start the retransmission timer T5110. If retransmission timer T5110 expires, the UE shall retransmit the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation and restart timer T5110. If no response is received from the 5G ProSe UE-to-UE relay UE with which the UE has a link established after reaching the maximum number of allowed retransmissions, the UE shall trigger UE-to-UE relay reselection procedure.\nNOTE 4:\tThe maximum number of allowed retransmissions is UE implementation specific.\nUpon reception of a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response, for the target relay service code of the connectivity service which the UE is authorized to discover, the UE shall obtain a valid UTC time from the lower layers and generate a UTC-based counter corresponding to this UTC time and use it to recover the UTC-based counter associated with the PROSE PC5 DISCOVERY message and the UTC-based counter associated with the direct discovery set. The UE shall use the associated DUSK, if received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used) and the UTC-based counter associated with the PROSE PC5 DISCOVERY message to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUCK and the UTC-based counter associated with the PROSE PC5 DISCOVERY message to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUIK and the UTC-based counter associated with the PROSE PC5 DISCOVERY message to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response.\nThe UE shall further use the DUSK in code-receiving security parameter for the ProSe service which the UE is authorized to discover (see clause 6.2.7) and the UTC-based counter associated with the direct discovery set to unscramble the direct discovery set IE in the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then if a DUCK is included in the code-receiving security parameter, the UE shall use the DUCK and the UTC-based counter associated with the direct discovery set to decrypt the direct discovery set IE, as described in 3GPP TS 33.503 [34]. The UE shall verify whether the application layer ID of the discoveree end UE in the decrypted direct discovery set matches the application layer ID of target discoveree end UE provided by the upper layers; if not, the UE shall discard the direct discovery set. Finally, if the application layer IDs match and a DUIK is included in the code-receiving security parameter, the UE shall use the DUIK and the UTC-based counter associated with the direct discovery set to verify the MIC for the direct discovery set IE in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response.\nNOTE 5:\tThe UE can determine the received PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response is for 5G ProSe direct discovery based on an indication from the lower layer.\nThen if:\na)\tthe relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response is the same as the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation; and\nb)\tthe application layer ID of the discoveree end UE received in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response is the same as the application layer ID of targeted discoveree end UE provided by upper layers for the connectivity service being solicited,\nthen the UE shall consider that the connectivity service the UE seeks to discover has been discovered. In addition, the UE can measure the signal strength of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response for relay selection or reselection. If the UE has received the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response from the 5G ProSe UE-to-UE relay UE with which the UE has a link established, the UE shall stop the retransmission timer T5110 and start the periodic measurement timer T5111.\nWhen the UE is triggered by the upper layers to stop soliciting for proximity of a connectivity service provided by a 5G ProSe UE-to-UE relay UE, or when the UE stops being authorised to perform the discoverer end UE procedure for UE-to-UE relay discovery, the UE shall instruct the lower layers to stop the discoverer operation.\nNOTE:\tThe discoverer end UE can stop discoverer end UE procedure for UE-to-UE relay discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the UE stops discoverer operation, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe purpose of the relay UE procedure for UE-to-UE relay discovery is to enable a ProSe-enabled UE with a UE-to-UE relay to respond to solicitation from other ProSe-enabled UEs on proximity of a connectivity service provided by the 5G ProSe UE-to-UE relay UE, upon a request from upper layers.\nThe UE is authorised to perform the relay UE procedure for UE-to-UE relay discovery if:\na)\tthe UE is authorised to act as a 5G ProSe UE-to-UE relay UE in the PLMN indicated by the serving cell, and\n1)\tthe UE is served by NG-RAN; or\n2)\tthe UE is not served by NG-RAN and intends to use the provisioned radio resources for 5G ProSe UE-to-UE relay discovery;\nb)\tthe UE is configured with:\n1)\tthe relay service code parameter identifying the connectivity service to be responded to as specified in clause 5.2.7 and the indicated security procedure for the relay service code is supported by the UE; and\n2)\tthe user info ID for the 5G ProSe UE-to-UE relay discovery, as specified in clause 5.2.7.Otherwise, the UE is not authorised to perform the relay UE procedure for UE-to-UE relay discovery.\nFigure 8a.2.1.3.3.2.1 illustrates the interactions between the 5G ProSe UE-to-UE relay UE and discoveree end UE in the relay UE procedure for UE-to-UE relay discovery.\nThe figure depicts a relay UE procedure for UE-to-UE relay discovery with the discoveree end UE, illustrating the steps involved in establishing a relay connection between two UEs. The figure includes a discoveree end UE, a relay UE, and a discoverer, with the discoverer end UE being highlighted. The relay UE is shown in a relay mode, with the discoverer end UE in a discoverable mode, and the discoverer end UE in a discoverable mode. The discoverer end UE is shown in a discoverable mode, with the discoverer end UE in a discoverable mode, and the discoverer end UE in a discoverable mode. The discoverer end UE is shown in a discoverable mode, with the discoverer end UE in a discoverable mode, and the discoverer end UE in a discoverable mode. The discoverer end UE is shown in a discoverable mode, with the discoverer end UE in a discoverable mode, and the discoverer end UE in a discoverable mode. The discoverer end UE is shown in a discoverable mode, with the discoverer end UE in a discoverable mode, and the discoverer end\nFigure 8a.2.1.3.3.2.1: Relay UE procedure for UE-to-UE Relay discovery with the discoveree end UE\nWhen the UE is triggered by the upper layers to start responding to solicitation on proximity of a connectivity service provided by the UE-to-UE relay and if the UE is authorised to perform the relay UE procedure for UE-to-UE relay discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11]; and\nb)\tshall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY messages.\nUpon reception of a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation, for the relay service code of the connectivity service which the UE is authorized to respond, the UE shall use the associated DUSK, if received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used) and the UTC-based counter obtained during the reception operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUIK and the UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation.\nNOTE 1:\tThe UE can determine the received PROSE PC5 DISCOVERY message for 5G ProSe UE-to-UE relay discovery solicitation is for 5G ProSe direct discovery based on an indication from the lower layer.\nIf:\na)\tthe UE receives a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation, and in this message:\n1)\tthe relay service code parameter is the same as the relay service code parameter configured for the connectivity service as specified in clause 5.2.7; and\ni)\tthe UE is served by NG-RAN; or\nii)\tthe UE is not served by NG-RAN and the relay service code is associated with the network assistance security indication indicating the security procedure without network assistance is to be used; or\n2)\tthe UE-to-UE relay UE info parameter is not included, or the UE-to-UE relay UE info parameter is included and the same as the configured user info ID for the UE-to-UE relay discovery as specified in clause 5.2.7; or\nb)\tthe periodic measurement timer T5113 expires,\nthen the UE:\na)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nb)\tshall generate a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation to the discoveree end UE. In the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation, the UE:\n1)\tshall set the direct discovery set IE to the direct discovery set as included in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation received from the discoverer end UE;\n2)\tshall set the UE-to-UE relay UE info parameter to the configured user info ID for the 5G ProSe UE-to-UE relay discovery, as specified in clause 5.2.7;\n3)\tshall set the relay service code parameter to the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation received from the discoverer end UE;\n4)\tshall set the Resource status indicator bit of the status indicator parameter to indicate whether or not the UE has resources available to provide a connectivity service for additional ProSe-enabled UEs;\n5)\tshall include the MIC field computed as described in 3GPP TS 33.503 [34];\n6)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter; and\n7)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.14;\nc)\tshall apply the DUIK, DUSK, or DUCK with the associated encrypted bitmask for the relay service code for 5G ProSe UE-to-UE relay discovery, along with the UTC-based counter, to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more of the above parameters, as specified in 3GPP TS 33.503 [34];\nd)\tshall set the destination layer-2 ID to the default destination layer-2 ID as specified in clause 5.2.7 and self-assign a source layer-2 ID for sending the UE-to-UE relay discovery solicitation message; and\nNOTE 2:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\ne)\tshall pass the resulting PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation along with the source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface.\nFor PROSE PC5 DISCOVERY message signal strength measurement, the UE manages a periodic measurement timer T5113, which is used to trigger the periodic PROSE PC5 DISCOVERY message signal strength measurement between the UE and the discoveree end UE with which the UE has a link established. It is started whenever the UE has established a direct link with a discoveree end UE and restarted whenever the UE receives the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response from the discoveree end UE with which the UE has a link established.\nIf the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation is used to trigger the PROSE PC5 DISCOVERY message signal strength measurement between the UE and the discoveree end UE with which the UE has a link established, the UE shall start the retransmission timer T5112. If retransmission timer T5112 expires, the UE shall retransmit the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation and restart timer T5112. If no response is received from the discoveree end UE with which the UE has a link established after reaching the maximum number of allowed retransmissions, the UE shall trigger the 5G ProSe direct link release procedure.\nNOTE 2:\tThe maximum number of allowed retransmissions is UE implementation specific.\nThe UE shall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY messages for UE-to-UE relay discovery response from the discoveree end UE.\nUpon reception of a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response, for the target relay service code of the connectivity service which the UE is authorized to respond, the UE shall use the associated DUSK, if received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used) and the UTC-based counter obtained during the reception operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUCK and the UTC-based counter to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUIK and the UTC-based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response.\nNOTE 3:\tThe UE can determine the received PROSE PC5 DISCOVERY message for 5G ProSe UE-to-UE relay discovery response is for 5G ProSe direct discovery based on an indication from the lower layer.\nIf the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response is the same as the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation,\nthen the UE:\na)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nb)\tshall generate a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response. In the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response, the UE:\n1)\tshall set the direct discovery set IE to the direct discovery set as included in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response received from the discoveree end UE;\n2)\tshall set the UE-to-UE relay UE info parameter to the configured user info ID for the 5G ProSe UE-to-UE relay discovery, as specified in clause 5.2.7;\n3)\tshall set the relay service code parameter to the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response received from the discoveree end UE;\n4)\tshall set the Resource status indicator bit of the status indicator parameter to indicate whether or not the UE has resources available to provide a connectivity service for 5G ProSe UE-to-UE relay for additional ProSe-enabled UEs;\n5)\tshall include the MIC field computed as described in 3GPP TS 33.503 [34];\n6)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter; and\n7)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.14;\nc)\tshall apply the DUIK, DUSK, or DUCK with the associated encrypted bitmask for the relay service code for 5G ProSe UE-to-UE relay discovery, along with the UTC-based counter to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more of the above parameters, as specified in 3GPP TS 33.503 [34];\nd)\tshall set the destination layer-2 ID to the source layer-2 ID from the discoverer end UE used in the transportation of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation and self-assign a source layer-2 ID for sending the UE-to-UE relay discovery response message; and\nNOTE 3:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\ne)\tshall pass the resulting PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response along with the source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface.\nNOTE 4:\tIf the UE is processing a PROSE DIRECT LINK ESTABLISHMENT REQUEST message from the same source layer-2 ID of the received PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation, it depends on UE implementation to avoid the conflict of destination layer-2 ID (e.g. send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for unicast communication is detected\", or ignore the PROSE DIRECT DISCOVERY message for UE-to-UE relay discovery solicitation).\nFigure 8a.2.1.3.3.2.2 illustrates the interactions between the 5G ProSe UE-to-UE relay UE and discoverer end UE in the relay UE procedure for UE-to-UE relay discovery.\nThe figure depicts a relay UE procedure for UE-to-UE relay delay discovery with the discoverer end UE, illustrating the steps involved in determining the delay of a relay UE in a 5G network.\nFigure 8a.2.1.3.3.2.2: Relay UE procedure for UE-to-UE relay discovery with the discoverer end UE\nWhen the UE is triggered by the upper layers to stop responding to solicitation on proximity of a connectivity service provided by a 5G ProSe UE-to-UE relay UE, or when the UE stops being authorised to perform the relay UE procedure for UE-to-UE relay discovery, the UE shall instruct the lower layers to stop monitoring.\nNOTE:\tThe 5G ProSe UE-to-UE relay UE can stop Relay UE procedure for UE-to-UE relay discovery for power saving by implementation specific means e.g. an implementation-specific maximum number of 5G ProSe direct links configured in the UE, or an implementation-specific timer expires.\nWhen the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\nThe purpose of the discoveree end UE procedure for UE-to-UE relay discovery is to enable a ProSe-enabled UE to respond to solicitation from other ProSe-enabled UEs on proximity of a connectivity service via a 5G ProSe UE-to-UE relay UE, upon a request from upper layers.\nThe UE is authorised to perform the discoveree end UE procedure for UE-to-UE relay discovery if:\na)\tthe UE is authorised to act as a 5G ProSe end UE in the PLMN indicated by the serving cell, and\n1)\tthe UE is served by NG-RAN; or\n2)\tthe UE is not served by NG-RAN and intends to use the provisioned radio resources for 5G ProSe UE-to-UE relay discovery;\nb)\tthe UE is configured with:\n1)\tthe relay service code parameter identifying the connectivity service to be responded to as specified in clause 5.2.7 and the indicated security procedure for the relay service code is supported by the UE; and\n2)\tthe User info ID for the UE-to-UE relay discovery, as specified in clause 5.2.7.\notherwise, the UE is not authorised to perform the discoveree end UE procedure for UE-to-UE relay discovery.\nFigure 8a.2.1.3.4.2.1 illustrates the interaction of the UEs in the discoveree end UE procedure for UE-to-UE relay discovery.\nThe figure depicts the procedure for UE-to-UE relay delay discovery in a 4G network. It illustrates the steps involved in determining the delay of a UE-to-UE relay, which is crucial for optimizing network performance. The figure includes a diagram of the network topology, with the relay node highlighted as the key element. The steps are clearly labeled, making it easy to follow the procedure.\nFigure 8a.2.1.3.4.2.1: Discoveree end UE procedure for UE-to-UE relay discovery\nWhen the UE is triggered by the upper layers to start responding to solicitation on proximity of a connectivity service provided by a 5G ProSe UE-to-UE relay UE and if the UE is authorised to perform the discoveree end UE procedure for UE-to-UE relay discovery, then the UE:\na)\tif the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS 38.331 [13], shall perform a service request procedure as specified in 3GPP TS 24.501 [11]; and\nb)\tshall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY messages.\nUpon reception of a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation, for the relay service code of the connectivity service which the UE is authorized to respond, the UE shall obtain a valid UTC time from the lower layers and generate a UTC-based counter corresponding to this UTC time, and use it to recover the UTC-based counter associated with the PROSE PC5 DISCOVERY message and the UTC-based counter associated with the direct discovery set. The UE shall use the associated DUSK, if received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used) and the UTC-based counter associated with the PROSE PC5 DISCOVERY message to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUCK and the UTC-based counter associated with the PROSE PC5 DISCOVERY message to decrypt the configured message-specific confidentiality-protected portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-UE relay is used), the UE shall use the DUIK and the UTC-based counter associated with the PROSE PC5 DISCOVERY message to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation.\nThe UE shall further use the DUSK in code-receiving security parameter for the ProSe service which the UE is authorized for discovery (see clause 6.2.6) and the UTC-based counter associated with the direct discovery set to unscramble the direct discovery set IE in the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then if a DUCK is included in the code-receiving security parameter, the UE shall use the DUCK and the UTC-based counter associated with the direct discovery set to decrypt the direct discovery set IE, as described in 3GPP TS 33.503 [34]. The UE shall verify whether the application layer ID of the discoveree end UE in the decrypted direct discovery set matches the application layer ID of the UE as provided by the upper layers; if not, the UE shall discard the direct discovery set. Finally, if the application layer IDs match and a DUIK is included in the code-receiving security parameter, the UE shall use the DUIK and the UTC-based counter associated with the direct discovery set to verify the MIC for the direct discovery set IE in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation.\nNOTE 1:\tThe UE can determine the received PROSE PC5 DISCOVERY message for 5G ProSe UE-to-UE relay discovery solicitation is for 5G ProSe direct discovery based on an indication from the lower layer.\nThen, if:\na)\tthe relay service code parameter of the received PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation is the same as the relay service code parameter configured as specified in clause 5.2.7 for the connectivity service; and\nb)\tthe application layer ID of discoveree end UE in the received PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation is the same as the application layer ID of the UE provided by upper layers ;\nthen the UE:\na)\tshall obtain a valid UTC time for the discovery transmission from the lower layers and generate the UTC-based counter corresponding to this UTC time;\nb)\tshall generate a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response. In the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response, the UE:\n1)\tshall include the direct discovery set IE which contains:\ni)\tthe discoveree user info parameter set to the application layer ID of the UE provided by the upper layers, which is the same as the application layer ID of the discoveree end UE received in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation;\nii)\tthe discoverer user info parameter set to the application layer ID of the discoverer end UE received in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation from the 5G ProSe UE-to-UE relay UE;\niii)\tthe MIC field computed as described in 3GPP TS 33.503 [34] for the direct discovery set; and\niv)\tthe UTC-based counter LSB parameter set to the 4 least significant bits of the UTC-based counter;\nand shall apply the DUIK, DUSK or DUCK with the associated encrypted bitmask in the code-sending security parameter for the ProSe service received from the DDNMF (see clause 6.2), along with the UTC-based counter, to the direct discovery set IE as specified in 3GPP TS 33.503 [34];\n2)\tshall include the target discoveree end UE info parameter set to the configured user info ID for the 5G ProSe UE-to-UE relay discovery, as specified in clause 5.2.7;\n3)\tshall set the relay service code parameter to the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation;\n4)\tshall include the MIC field computed as described in 3GPP TS 33.503 [34];\n5)\tshall set the UTC-based counter LSB parameter to the 4 least significant bits of the UTC-based counter; and\n6)\tshall set the ProSe direct discovery PC5 message type parameter as specified in table 10.2.1.14; and\n7)\tshall include the announce prohibited indication with its value set as \"It is prohibited to broadcast the user info\" in the PC5 DISCOVERY message for UE-to-UE relay discovery reponse if the discoveree UE needs to indicate to the 5G ProSe UE-to-UE relay UE that it is prohibited from broadcasting user info of the discoveree end UE included in the direct discovery set during the procedure of 5G ProSe UE-to-UE relay discovery over PC5 interface with model A;\nc)\tshall apply the DUIK, DUSK, or DUCK with the associated encrypted bitmask for the relay service code for 5G ProSe UE-to-UE relay discovery, along with the UTC-based counter, to the PROSE PC5 DISCOVERY message for whichever security mechanism(s) configured to be applied, e.g., integrity protection, message scrambling or confidentiality protection of one or more of the above parameters, as specified in 3GPP TS 33.503 [34];\nd)\tshall set the destination layer-2 ID to the source layer-2 ID from the 5G ProSe UE-to-UE relay UE used in the transportation of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation and self-assign a source layer-2 ID for sending the UE-to-UE relay discovery response message; and\nNOTE 2:\tThe UE implementation ensures that the value of the self-assigned source layer-2 ID is different from any other self-assigned source layer-2 ID(s) in use for 5G ProSe direct communication as specified in clause 7.2 and is different from any other provisioned destination layer-2 ID(s) as specified in clause 5.2.\ne)\tshall pass the resulting PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response along with the source layer-2 ID, destination layer-2 ID and an indication that the message is for 5G ProSe direct discovery to the lower layers for transmission over the PC5 interface.\nNOTE 3:\tIf the UE is processing a PROSE DIRECT LINK ESTABLISHMENT REQUEST message from the same source layer-2 ID of the received PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation, it depends on UE implementation to avoid the conflict of destination layer-2 ID (e.g. send a PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for unicast communication is detected\", or ignore the PROSE DIRECT DISCOVERY message for UE-to-UE relay discovery solicitation).\nWhen the UE is triggered by the upper layers to stop responding to solicitation on proximity of a connectivity service via a 5G ProSe UE-to-UE relay UE, or when the UE stops being authorised to perform the discoveree end UE procedure for UE-to-UE relay discovery, the UE shall instruct the lower layers to stop monitoring.\nWhen the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger the corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.2\t5G ProSe UE-to-UE relay selection procedure",
                            "text_content": "The purpose of the UE-to-network relay selection procedure is to enable a 5G ProSe end UE to select a suitable 5G ProSe UE-to-UE relay UE to obtain a connectivity service to another 5G ProSe end UE.\nThe 5G ProSe end UE shall trigger the UE-to-UE relay selection procedure if the following conditions are met:\na)\tthe UE is authorised to act as a 5G ProSe end UE towards a 5G ProSe UE-to-UE relay UE as specified in clause 5.2.7:\n1)\tif the 5G ProSe end UE is expected to use 5G ProSe layer-3 UE-to-UE relay, the indication that the UE is authorized to use a 5G ProSe layer-3 UE-to-UE relay UE shall be set; and\n2)\tif the 5G ProSe end UE is expected to use 5G ProSe layer-2 UE-to-UE relay, the indication that the UE is authorized to use a 5G ProSe layer-2 UE-to-UE relay UE shall be set;\nb)\tthe UE has obtained a list of 5G ProSe UE-to-UE relay UE candidate(s) fulfilling ProSe layer criteria with the monitoring UE relay discovery for UE-to-UE relay discovery as specified in clause 8a.2.1.2.3 or the discoverer end UE procedure for UE-to-UE relay discovery as specified in clause 8a.2.1.3.2;\nc)\tthe UE has obtained a list of 5G ProSe UE-to-UE relay UE candidate(s) fulfilling lower layers criteria as specified in 3GPP TS 38.300 [21]; and\nd)\tthe user info ID of the target 5G ProSe end UE that the UE is interested in is included in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement (for discovery model A) or in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response (for discovery model B).\nIf there exists only one 5G ProSe UE-to-UE relay UE candidate satisfying the conditions in clause 8a.2.2.2, then that 5G ProSe UE-to-UE relay UE is selected. If there exist more than one 5G ProSe UE-to-UE relay UE candidate satisfying the conditions in clause 8a.2.2.2, any relay candidates not satisfying the non-radio related ProSe layer criteria shall be discarded and out of the remaining relay candidates, the relay candidate with the highest ranking of the lower layer criteria shall be selected. The UE may take the value of the resource status indicator bit of the status indicator parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement or PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response into account when deciding which 5G ProSe UE-to-UE relay UE to select. It is up to the UE implementation whether the ProSe layer or the lower layers takes the final selection on which 5G ProSe UE-to-UE relay UE to select.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.3\t5G ProSe UE-to-UE relay reselection procedure",
                            "text_content": "The purpose of the 5G ProSe UE-to-UE relay reselection procedure is to enable a 5G ProSe end UE to reselect a 5G ProSe UE-to-UE relay UE to obtain a connectivity service to another 5G ProSe end UE when the serving 5G ProSe UE-to-UE relay UE is no longer suitable.\nThe 5G ProSe end UE shall trigger the UE-to-UE relay reselection procedure if one of the following conditions is met:\na)\tthe UE has received an indication from lower layers that the serving 5G ProSe UE-to-UE relay UE no longer fulfills the lower layers criteria as specified in 3GPP TS 38.300 [21];\nb)\tthe parameters related to 5G ProSe UE-to-UE relay in the configuration parameters for 5G ProSe UE-to-UE relay as specified in clause 5.2.7 (e.g., relay service code, User info ID, etc.) have been updated and the serving 5G ProSe UE-to-UE relay UE no longer fulfills the conditions specified in clause 8a.2.2.2;\nc)\tthe UE has received a PROSE DIRECT LINK ESTABLISHMENT REJECT message from the 5G ProSe UE-to-UE relay UE with the PC5 signalling protocol cause value #1 \"direct communication to the target UE not allowed\";\nd)\tthe UE has received a PROSE DIRECT LINK RELEASE REQUEST message from the 5G ProSe UE-to-UE relay UE with the PC5 signalling protocol cause value #1 \"direct communication to the target UE not allowed\";\ne)\tthe UE has received a PROSE DIRECT LINK RELEASE REQUEST message from the 5G ProSe UE-to-UE relay UE with the PC5 signalling protocol cause value #4 \"direct connection is not available anymore\";\nf)\tthe UE has not received any response from the 5G ProSe UE-to-UE relay UE after M consecutive retransmissions of PROSE DIRECT LINK ESTABLISHMENT REQUEST or PROSE DIRECT LINK KEEPALIVE REQUEST messages;\ng)\tthe UE has not received any response from the 5G ProSe UE-to-UE relay UE after M consecutive retransmissions of PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation used to trigger the PROSE PC5 DISCOVERY message signal strength measurement between the UE and the 5G ProSe UE-to-UE relay UE with which the UE has a link established;\nNOTE 1:\tThe value of M is implementation specific and is less than or equal to the maximum number of retransmissions allowed for PC5 signalling protocol.\nh)\tthe UE has received a PROSE DIRECT LINK ESTABLISHMENT REJECT message from the 5G ProSe UE-to-UE relay UE with the PC5 signalling protocol cause value #13 \"congestion situation\";\ni)\tthe UE has received a PROSE DIRECT LINK RELEASE REQUEST message from the 5G ProSe UE-to-UE relay UE with the PC5 signalling protocol cause value #13 \"congestion situation\"; or\nj)\tthe UE has received a PROSE DIRECT LINK ESTABLISHMENT REJECT message from the 5G ProSe UE-to-UE relay UE with the PC5 signalling protocol cause value #xx \"security procedure failure of 5G ProSe UE-to-UE relay\".\nIn cases c), d), h), i) and j), the 5G ProSe end UE shall exclude the 5G ProSe UE-to-UE relay UE which sent the message specified in cases c), d), h), i) or j) from the UE-to-UE relay reselection process described below (at least for the indicated back-off time period if provided from the ProSe UE-to-UE relay UE in cases h) and i)).\nTo conduct UE-to-UE relay reselection process, the UE shall first initiate one of the following procedures or both:\na)\tmonitoring UE relay discovery for UE-to-UE relay discovery as specified in clause 8a.2.1.2.3; or\nb)\tdiscoverer end UE procedure for UE-to-UE relay discovery as specified in clause 8a.2.1.3.2.\nAfter the execution of the above discovery procedure(s), the 5G ProSe end UE, based on UE implementation, may perform the 5G ProSe direct link modification procedure for the negotiated 5G ProSe UE-to-UE relay reselection or may perform the 5G ProSe direct link establishment procedure with the selected 5G ProSe UE-to-UE relay UE.\nThe purpose of the candidate 5G ProSe UE-to-UE relay discovery procedure is to support the target 5G ProSe end UE to discover the candidate 5G ProSe UE-to-UE relay UE when the target 5G ProSe end UE needs to discover the candidate 5G ProSe UE-to-UE relay UE for the negotiated 5G ProSe layer-3 UE-to-UE relay reselection, as specified in clause 6.7.4 of 3GPP TS 23.304 [2]. This procedure is based on UE-to-UE relay discovery over PC5 interface with model B procedure as specified in clause 8a.2.1.3 with the following modifications:\na)\twhen the target 5G ProSe end UE as a discoverer UE generates a PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solitication, in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation, the UE shall:\n1)\tset the relay service code parameter to the relay service code parameter currently being used with the serving 5G UE-to-UE relay UE for which the UE-to-UE relay reselection is needed;\n2)\tset the UE-to-UE relay UE info parameter to user info ID for the candidate 5G ProSe UE-to-UE relay UE; and\n3)\tnot include the direct discovery set parameter,\nand shall set the destination layer-2 ID to the destination layer-2 ID of the candidate 5G ProSe UE-to-UE relay UE as received in the PROSE DIRECT LINK MODIFICATION REQUEST message during the negotiated 5G ProSe layer-3 UE-to-UE relay reselection procedure. If there is no layer-2 ID of the candidate 5G ProSe UE-to-UE relay UE received in the PROSE DIRECT LINK MODIFICATION REQUEST message during the negotiated 5G ProSe layer-3 UE-to-UE relay reselection procedure, the UE shall set the destination layer-2 ID to the default layer-2 ID for discovery as specified in clause 5.2.7.\nb)\tWhen the 5G ProSe UE-to-UE relay UE receives the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation, the 5G ProSe UE-to-UE relay does not perform the Relay UE procedure for UE-to-UE relay discovery if :\n1)\tthe PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation does not include the direct discovery set parameter; and\n2)\tthe UE-to-UE relay UE info parameter in the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation matches with the user info ID for 5G ProSe UE-to-UE relay UE.\nc)\tAfter b), the 5G ProSe UE-to-UE relay UE shall send the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response to the discoverer UE. In the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response, the UE shall:\n1)\tset the relay service code paramter to the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solitication received from the target 5G ProSe end UE; and\n2)\tnot include the direct discovery set parameter.\nd)\tAfter c), when the target 5G ProSe end UE receives the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response and if\n1)\tthe relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response is the same as the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation;\nb)\tthe direct discover set parameter of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response is not included; and\nc)\tthe UE-to-UE relay UE info parameter of the the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response is the same as the user info ID for the candidate 5G ProSe UE-to-UE relay UE of the PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation,\nthen the 5G ProSe end UE shall consider the candidate 5G ProSe UE-to-UE relay UE is discovered, and proceed the 5G ProSe direct link modification procedure for UE-to-UE relay UE reselection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.4\t5G ProSe UE-to-UE relay unicast direct communication over PC5 interface",
                            "text_content": "The direct communication between 5G ProSe end UEs and 5G ProSe UE-to-UE relay UE reuses the procedures for unicast mode 5G ProSe direct communication over PC5 described in clause 7.2.\nNOTE:\tAny modifications needed to the procedures defined for unicast mode 5G ProSe direct communication over PC5 to support the direct communication between 5G ProSe end UEs and 5G ProSe UE-to-UE relay UE are described within clause 7.2.\nEditor's note:\t(WI: 5G_ProSe_Ph2, CR 0348) 5G ProSe UE-to-UE relay setting source layer-2 ID in the security establishment procedure towards the source 5G ProSe end UE as in 3GPP TS 23.304 [2] subclause 6.7.1.1 bullet 4, is FFS and depends on SA3 specification of security solution.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.5\tIP address allocation for 5G ProSe end UE in 5G ProSe layer-3 UE-to-UE relay procedure",
                            "text_content": "During 5G ProSe direct link establishment for 5G ProSe direct communication between the source or target 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE, and for IP traffic, the source or target 5G ProSe end UE and 5G ProSe UE-to-UE relay UE shall determine the IP version (IPv4 or IPv6) and IP address to be used based on the following rules:\na) IP address allocation mechanisms of unicast mode of 5G ProSe direct communication over PC5 as described in clause 7.2.2.3 and clause 7.2.10.3 can be reused between each 5G ProSe end UE and the 5G ProSe layer-3 UE-to-UE relay UE; and\nb) The 5G ProSe end UE may obtain the IP address of other 5G ProSe end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using DNS query as follows:\n1)\tthe 5G ProSe layer-3 UE-to-UE relay UE may store an association of user info ID and the IP address of target 5G ProSe layer-3 end UE into its DNS entries;\n2)\tthe source 5G ProSe layer-3 end UE, if not receiving the IP address of target 5G ProSe layer-3 end UE in the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message from the 5G ProSe layer-3 UE-to-UE relay UE, may query the IP address of target 5G ProSe layer-3 end UE from the 5G ProSe layer-3 UE-to-UE relay UE using DNS query procedure as specified in IETF RFC 1035 [53].\nNOTE: \t5G ProSe layer-3 UE-to-UE relay UE may convert the IP versions between the first hop PC5 interface(between the source 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE) and second hop PC5 interface (between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.6\tSecurity procedures for 5G ProSe layer-2 end UEs",
                            "text_content": "The security establishment between the source 5G ProSe layer-2 end UE and the target 5G ProSe layer-2 end UE via a 5G ProSe layer-2 UE-to-UE relay UE reuses the 5G ProSe direct link authentication procedure described in clause 7.2.12 and the 5G ProSe direct link security mode control procedure described in clause 7.2.10. The security establishment between the source 5G ProSe layer-2 end UE and the target 5G ProSe layer-2 end UE via a 5G ProSe layer-2 UE-to-UE relay UE happens after the 5G ProSe direct link establishment between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link establishment between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "Editor’s note:\tFurther details for 5G ProSe layer-2 UE-to-UE relay and whether it is impacted by the forwarding of the messages of 5G ProSe direct link authentication procedure and 5G ProSe direct link security mode control procedure are FFS.",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.7\tQoS handling for 5G ProSe UE-to-UE relay",
                            "text_content": "This clause describes the QoS handling between a 5G ProSe UE-to-UE relay UE and two 5G ProSe end UEs. The purpose of QoS handling for 5G ProSe UE-to-UE relay is to meet the end-to-end QoS requirement between two 5G ProSe end UEs.\nThe QoS handling for 5G ProSe UE-to-UE relay can be classified with the following two cases according to the type of 5G ProSe UE-to-UE relay:\na)\tQoS handling for two 5G ProSe end UEs via a 5G ProSe layer-2 UE-to-UE relay; and\nb)\tQoS handling for two 5G ProSe end UEs via a 5G ProSe layer-3 UE-to-UE relay.\nThe QoS handling by a 5G ProSe layer-3 UE-to-UE relay UE to achieve an end-to-end QoS between two 5G ProSe layer-3 end UEs as specified in clause 5.6.3.1 of 3GPP TS 23.304 [2].\nFor a source 5G ProSe layer-3 end UE, the end-to-end QoS requirement between the source 5G ProSe layer-3 end UE and the target 5G ProSe layer-3 end UE can be satisfied by the corresponding QoS control:\na)\tQoS control between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE (first hop PC5 QoS control); and\nb)\tQoS control between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE (second hop PC5 QoS control).\nFor PC5 QoS flows setup or modification initiated by the source 5G ProSe layer-3 end UE, the source 5G ProSe layer-3 end UE shall provide the PC5 QoS flow context as defined in clause 7.2.7 to the 5G ProSe layer-3 UE-to-UE relay UE to indicate the end-to-end QoS requirements for the traffic transmission between the source 5G ProSe layer-3 end UE and the target 5G ProSe layer-3 end UE, using 5G ProSe direct link security mode control procedure as specified in clause 7.2.10 or 5G ProSe direct link modification procedure as specified in clause 7.2.3.\nIn addition, if the source 5G ProSe layer-3 end UE wants to add new PC5 QoS flow(s) or modify the existing PC5 QoS flow(s) for IP traffic or Ethernet traffic, the source 5G ProSe layer-3 end UE may also provide the PC5 QoS rule(s) for the PC5 QoS flow(s) to be added or modified to the 5G ProSe layer-3 UE-to-UE relay UE, using 5G ProSe direct link establishment procedure as specified in clause 7.2.2 or 5G ProSe direct link modification procedure as specified in clause 7.2.3.\nUpon reception of the PC5 QoS flow context from the source 5G ProSe layer-3 end UE, the 5G ProSe layer-3 UE-to-UE relay UE:\na)\tshall determines the PQI for the first hop PC5 QoS control and PQI for the second hop PC5 QoS control based on its implementation;\nb)\tmay derive the packet filter(s) used over the second hop PC5 interface if the 5G ProSe layer-3 UE-to-UE relay UE received the PC5 QoS rule(s) from the source 5G ProSe layer-3 end UE; and\nc)\tif a new QoS flow needs to be established or the existing QoS flow(s) needs to be modified, shall perform 5G ProSe direct link establishment procedure as specified in clause 7.2.2 or 5G ProSe direct link modification procedure as specified in clause 7.2.3 providing:\n1)\tthe QoS flow descriptions IE with the PQI value for the second hop PC5 QoS control determined in bullet a) to the target 5G ProSe layer-3 end UE; and\n2)\tthe QoS rules IE with the packet filter(s) if packet filter(s) are derived in bullet b) to the target 5G ProSe layer-3 end UE; and\nd)\tmay derive the packet filter(s) used over the first hop PC5 interface if the 5G ProSe layer-3 UE-to-UE relay UE determines the PC5 QoS rule(s) over the first hop PC5 based on bullet a) and the QoS flow descriptions IE and the the QoS rules IE that the target UE accepts; and\ne)\tshall provide the source 5G ProSe layer-3 end UE with the PQI determined in bullet a) or the PQI updated in bullet d), the corresponding PC5 QoS parameters and the corresponding ProSe identifier(s) as specified in clause 7.2.2.3 (if 5G ProSe direct link establishment procedure was initiated by the source 5G ProSe layer-3 end UE) or clause 7.2.3.3 (if 5G ProSe direct link modification procedure was initiated by the source 5G ProSe layer-3 end UE).\nFor a 5G ProSe layer-2 end UE connecting with another 5G ProSe layer-2 end UE(s) via a 5G ProSe layer-2 UE-to-UE relay UE, the source 5G ProSe layer-2 end UE and the target 5G ProSe layer-2 end UE negotiate the end-to-end QoS for the traffic transmission between the source 5G ProSe layer-2 end UE and the target 5G ProSe layer-2 end UE. The 5G ProSe layer-2 UE-to-UE relay UE performs QoS splitting as described in 3GPP TS 38.300 [21].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.8\tSupport for Ethernet traffic via 5G ProSe layer-3 UE-to-UE relay",
                            "text_content": "When a 5G ProSe direct link is being established or modified between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE (called source 5G ProSe direct link) and another 5G ProSe direct link is being established or modified between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE (called target 5G ProSe direct link), for Ethernet traffic:\na)\tif the source 5G ProSe direct link is being established, MAC address of the source 5G ProSe layer-3 end UE is indicated in the TBD message of the source 5G ProSe direct link and MAC address of the target 5G ProSe layer-3 end UE is indicated in the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message of the source 5G ProSe direct link;\nEditor's note:\t(WI: 5G_ProSe_Ph2, CR: 0286) It is FFS what is the first security protected message in the source 5G ProSe direct link, sent from the source 5G ProSe layer-3 end UE to the 5G ProSe layer-3 UE-to-UE relay UE. This depends on SA3.\nb)\tif the source 5G ProSe direct link is being modified:\n1)\tMAC address of the target 5G ProSe layer-3 end UE shall be indicated in the PROSE DIRECT LINK MODIFICATION ACCEPT message of the source 5G ProSe direct link; or\n2)\tMAC address of the source 5G ProSe layer-3 end UE shall be indicated in the PROSE DIRECT LINK MODIFICATION REQUEST message of the source 5G ProSe direct link if the MAC address of the source 5G ProSe layer-3 end UE changed;\nc)\tif the target 5G ProSe direct link is being established, MAC address of the source 5G ProSe layer-3 end UE is indicated in TBD message of the target 5G ProSe direct link and MAC address of the target 5G ProSe layer-3 end UE is indicated in the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message of the target 5G ProSe direct link; and\nEditor's note:\t(WI: 5G_ProSe_Ph2, CR: 0286) It is FFS what is the first security protected message in the target 5G ProSe direct link, sent from the 5G ProSe layer-3 UE-to-UE relay UE to the target 5G ProSe layer-3 end UE. This depends on SA3.\nd)\tif the target 5G ProSe direct link is being modified:\n1)\tMAC address of the source 5G ProSe layer-3 end UE shall be indicated in the PROSE DIRECT LINK MODIFICATION REQUEST message of the target 5G ProSe direct link; or\n2)\tMAC address of the target 5G ProSe layer-3 end UE may be indicated in the PROSE DIRECT LINK MODIFICATION ACCEPT message of the target 5G ProSe direct link if the MAC address of the target 5G ProSe layer-3 end UE changed.\nThe 5G ProSe layer-3 UE-to-UE relay UE maintains associations between the 5G ProSe direct links and Ethernet MAC addresses provided by the 5G ProSe layer-3 end UEs of the 5G ProSe direct links.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.9\t5G ProSe AA message reliable transport procedure",
                            "text_content": "The 5G ProSe AA message reliable transport procedure as described in clause 8.2.9 is used for exchanging the EAP messages between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE when the security procedure over control plane is used, with the following modifications:\na)\tThe 5G ProSe remote UE is replaced by the 5G ProSe end UE.\nb)\tThe 5G ProSe UE-to-network relay UE is replaced by the 5G ProSe UE-to-UE relay UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.10\t5G ProSe UE-to-UE relay direct link security establishment procedure",
                            "text_content": "The purpose of the 5G ProSe UE-to-UE relay direct link security establishment procedure is for the target 5G ProSe end UE to establish the security between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE.\nThis procedure is triggered when the target 5G ProSe end UE receives the PROSE DIRECT LINK ESTABLISHMENT REQUEST message from the 5G ProSe UE-to-UE relay UE and the Network Assistance Security Indicator associated with the received relay service code indicates the security procedures with network assistance are required.\nThe initiating UE shall meet the following pre-conditions before initiating this procedure:\na)\tthe PROSE DIRECT LINK ESTABLISHMENT REQUEST message is received;\nb)\tthe initiating UE acting as the target 5G ProSe end UE is authorized to use a 5G ProSe UE-to-UE relay UE in the registered PLMN or local PLMN;\nc)\tthe Network Assistance Security Indicator associated with the received relay service code indicates the security procedures with network assistance are required.\nThe UE shall initiate the 5G ProSe UE-to-UE relay direct link security establishment procedure by sending the PROSE DIRECT LINK SECURITY ESTABLISHMENT REQUEST message. The initiating UE:\na)\tshall include:\n1)\ta Nonce_1, if the security procedure over control plane is used as specified in 3GPP TS 33.503 [34]; or\n2)\ta KNRP freshness parameter 1, if the security procedure over user plane is used as specified in 3GPP TS 33.503 [34];\nset to the 128-bit nonce value generated by the initiating UE for the purpose of session key establishment over this 5G ProSe direct link if the UE PC5 unicast signalling integrity protection policy is set to \"Signalling integrity protection required\" or \"Signalling integrity protection preferred\";\nb)\tshall include its UE security capabilities indicating the list of algorithms that the initiating UE supports for the security establishment of this 5G ProSe direct link;\nc)\tshall include the MSB of KNRP-sess ID chosen by the initiating UE as specified in 3GPP TS 33.503 [34] if the UE PC5 unicast signalling integrity protection policy is set to \"Signalling integrity protection required\" or \"Signalling integrity protection preferred\";\nd)\tshall include its UE PC5 unicast signalling security policy. The Signalling integrity protection policy shall be set to \"Signalling integrity protection required\";\ne)\tshall include the Relay service code IE set to the relay service code indicating the connectivity service requested by the source 5G ProSe end UE;\nf)\tshall include the UTC-based counter LSB set to the four least significant bits of the UTC-based counter;\ng)\tshall include the UE identity IE set to the SUCI of the initiating UE if:\n1)\tthe 5G ProSe direct link establishment procedure is for direct communication between the target 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE; and\n2)\tthe security for 5G ProSe UE-to-UE relay uses the security procedure over control plane and the initiating UE does not have a valid CP-PRUK as specified in 3GPP TS 33.503 [34], or, the security for 5G ProSe UE-to-UE relay uses the security procedure over user plane and the initiating UE does not have a valid UP-PRUK as specified in 3GPP TS 33.503 [34];\nh)\tshall include the User security key ID IE set to:\n1)\tUP-PRUK ID of the initiating UE if:\ni)\tthe 5G ProSe direct link establishment procedure is for direct communication between the target 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nii)\tthe initiating UE has a valid UP-PRUK; and\niii)\tthe security for 5G ProSe UE-to-UE relay uses the security procedure over user plane as specified in 3GPP TS 33.503 [34]; or\n2)\tCP-PRUK ID of the initiating UE that is associated with the relay service code of the target UE if:\ni)\tthe 5G ProSe direct link establishment procedure is for direct communication between the target 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nii)\tthe initiating UE has a valid CP-PRUK is associated with the relay service code of the target UE; and\niii)\tthe security for 5G ProSe UE-to-UE relay uses the security procedure over control plane as specified in 3GPP TS 33.503 [34];\ni)\tshall include the HPLMN ID of the initiating UE, if the UP-PRUK ID of the initiating UE is included and is not in NAI format (see 3GPP TS 33.503 [34]);\nj)\tshall include the MIC IE set to the calculated MIC value as specified in 3GPP TS 33.503 [34] if the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE has the DUIK.\nEditor’s note:\tHow to set the layer-2 ID of the PROSE DIRECT LINK SECUIRTY ESTABLISHMENT REQUEST message is FFS.\nEditor’s note:\tThe retransmission timer of PROSE DIRECT LINK SECURITY ESTABLISHMENT REQUEST message is FFS.\nThe figure depicts a 5G ProSe direct link security establishment procedure, illustrating the steps involved in establishing a secure communication link between a base station (gNB) and a user equipment (UE). The figure includes key components such as the gNB, UE, and the network infrastructure, highlighting the importance of proper security measures in 5G networks.\nFigure 8a.2.10.2.1: 5G ProSe direct link security establishment procedure\nUpon receipt of a PROSE DIRECT LINK SECURITY ESTABLISHMENT REQUEST message, the target UE shall verify the MIC field in the received PROSE DIRECT LINK SECURITY ESTABLISHMENT REQUEST with the DUIK, if any, and decrypts the encrypted:\na)\trelay service code; and\nb)\tUP-PRUK ID or CP-PRUK ID, if received,\nusing the DUCK, or DUSK with the associated encrypted bitmask used for 5G ProSe UE-to-UE relay discovery (see clause 6.6.3.1 of 3GPP TS 33.503 [34]) and verifies if the relay service code matches with the one that the target UE has sent in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nNOTE 1:\tIf the UE is neither configured with DUCK nor DUSK, the relay service code and the UP-PRUK ID or CP-PRUK ID are not encrypted.\nIf the target UE is authorized to act as the 5G ProSe UE-to-UE relay UE and is in NG-RAN coverage, the target UE shall proceed with either:\na)\tthe authentication and key agreement procedure as specified in clause 5.5.4 of 3GPP TS 24.501 [11] if the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used; or\nb)\tthe key request procedure as specified in clause 8.2.10.2.4 if the security procedure over user plane as specified in 3GPP TS 33.503 [34] is used;\nand shall initiate 5G ProSe direct link security mode control procedure as specified in clause 7.2.10.\nThe target UE shall:\na)\tif the security procedure over control plane as specified in 3GPP TS 33.503 [34] is used, request a new KNR_ProSe according to the security procedure over user plane as specified in 3GPP TS 33.503 [34]; or\nb)\tif the security procedure over user plane as specified in 3GPP TS 33.503 [34] is used, request a new KNRP according to the security procedure over user plane.\nNOTE 2:\tHow many times the 5G ProSe direct link authentication procedure needs to be performed to derive a new KNRP depends on the authentication method used.\nAfter a new KNRP was derived or after a new KNRP or KNR_ProSe is received, the target UE shall initiate a 5G ProSe direct link security mode control procedure as specified in clause 7.2.10. The target UE determines whether the PROSE DIRECT LINK SECURITY ESTABLISHMENT REQUEST message can be accepted or not based on the result of the 5G ProSe direct link security mode control procedure.\nIf the target UE accepts the 5G ProSe direct link security establishment procedure, the target UE shall create a PROSE DIRECT LINK SECURITY ESTABLISHMENT ACCEPT message and pass the message to the lower layers for transmission along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication.\nEditor’s note:\tThe content of PROSE DIRECT LINK SECURITY ESTABLISHMENT ACCEPT message is FFS.\nFor each of the PROSE DIRECT LINK SECURITY ESTABLISHMENT ACCEPT message received, the initiating UE shall create a PROSE DIRECT LINK ESTABLISHMENT ACCEPT message as specified in clause 7.2.2.4.\nIf the PROSE DIRECT LINK SECUIRTY ESTABLISHMENT REQUEST message cannot be accepted, the target UE shall send a PROSE DIRECT LINK SECURITY ESTABLISHMENT REJECT message. The PROSE DIRECT LINK SECURITY ESTABLISHMENT REJECT message contains a PC5 signalling protocol cause IE set to one of the following cause values:\n#6\t\tAuthentication failure\n#7\t\tIntegrity failure\n#13\tcongestion situation;\n#15\tsecurity procedure failure of 5G ProSe UE-to-UE relay;\n#111\tprotocol error, unspecified.If the target UE acting as the 5G ProSe UE-to-UE relay UE is under congestion, the target UE shall send a PROSE DIRECT LINK SECURITY ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #13 \"congestion situation\". The target UE may provide a back-off timer value to the initiating UE in the PROSE DIRECT LINK SECURITY ESTABLISHMENT REJECT message.\nIf the 5G ProSe direct link security establishment procedurefails due to a failure in the security procedure over control plane or security procedure over user plane as specified in 3GPP TS 33.503 [34], the target UE shall send a PROSE DIRECT LINK SECURITY ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #15 \"security procedure failure of 5G ProSe UE-to-UE relay\". The target UE shall provide the EAP message if received from the network according to the security procedure over control plane as specified in 3GPP TS 33.503 [34].\nIf the 5G ProSe direct link security establishment procedure fails due to other reasons, the target UE shall send a PROSE DIRECT LINK SECURITY ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #111 \"protocol error, unspecified\".\nAfter sending the PROSE DIRECT LINK SECURITY ESTABLISHMENT REJECT message, the target UE shall provide the following information along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication to the lower layer:\na)\tan indication of deactivation of the PC5 unicast security protection and deletion of security context for the 5G ProSe direct link, if applicable.\nAfter receiving the PROSE DIRECT LINK SECURITY ESTABLISHMENT REJECT message, the initiating UE shall provide the following information along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication to the lower layer:\na)\tan indication of deactivation of the PC5 unicast security protection and deletion of security context for the 5G ProSe direct link, if applicable.\nIf the need to establish a link no longer exists before the procedure is completed, the initiating UE shall abort the procedure.\nWhen the initiating UE aborts the 5G ProSe direct link security establishment procedure, the initiating UE shall provide the following information along with the initiating UE's layer-2 ID for unicast communication and the target UE's layer-2 ID for unicast communication to the lower layer:\na)\tan indication of deactivation of the PC5 unicast security protection and deletion of security context for the 5G ProSe direct link, if applicable.\nAfter the target UE decrypts the encrypted relay service code using the DUIK, DUSK, or DUCK with the associated encrypted bitmask used for 5G ProSe UE-to-UE relay discovery, if the relay service code does not match with the one that the target UE has sent during 5G ProSe UE-to-UE relay discovery procedure, then the target UE shall abort the 5G ProSe direct link security establishment procedure.\nIf the PROSE DIRECT LINK SECURITY ESTABLISHMENT message is integrity protected and the integrity verification of the message fails at the target UE, then the target UE shall abort the 5G ProSe direct link security establishment procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.11\t5G ProSe security procedures over PC3a interface for 5G ProSe UE-to-UE relay",
                            "text_content": "The transport protocol for PC3a messages are the same as described in clause 8.2.12.1.1.\nThe handling of UE-initiated procedures are the same as described in clause 8.2.12.1.2.\nThe following procedures are defined:\na)\t5G ProSe UE-to-UE relay discovery security material request procedure.\nIn the following descriptions of 5G procedures over PC3a interface, the terms \"request\" and \"response\" refer to the corresponding PC3a messages, not to the HTTP request or response. The following procedure descriptions use a single PC3a message for illustration purposes.\nThe PC3a control protocol procedures for 5G ProSe UE-to-UE relay discovery shall be integrity protected and confidentiality protected using the security procedures defined in clause 5.2.3 in 3GPP TS 33.503 [34].\nNOTE:\tA single HTTP request message can contain multiple PC3a control protocol requests and a single HTTP response message can contain multiple PC3a control protocol responses.\nWhen the TLS tunnel between the UE and the 5G DDNMF for transport of PC3a messages is established by the UE according to 3GPP TS 33.503 [34], the 5G DDNMF shall obtain identity of the served UE using the procedures specified in 3GPP TS 33.220 [46] or 3GPP TS 33.535 [47].\nThe purpose of the 5G ProSe UE-to-UE relay discovery security material request procedure is for the UE:\na)\tto obtain the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, applicable when the UE acts as a 5G ProSe end UE and uses the security procedure over control plane as specified in 3GPP TS 33.503 [34]; and\nb)\tto obtain the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE, applicable when the UE acts as a 5G ProSe UE-to-UE relay UE and uses the security procedure over control plane as specified in 3GPP TS 33.503 [34].\nThe UE shall initiate the 5G ProSe UE-to-UE relay discovery security material request procedure:\na)\tif the UE is authorized to act as a 5G ProSe end UE and uses the security procedure over control plane as specified in 3GPP TS 33.503 [34]:\n1)\twhen the UE has no 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE and the UE is in NG-RAN coverage; or\n2)\tafter expiration of timer T50aa, when in NG-RAN coverage or when entering NG-RAN coverage; or\nb)\tif the UE is authorized to act as a 5G ProSe UE-to-UE relay UE and uses the security procedure over control plane as specified in 3GPP TS 33.503 [34]:\n1)\twhen the UE has no 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE and the UE is in NG-RAN coverage; or\n2)\tafter expiration of timer T50yy, when in NG-RAN coverage or when entering NG-RAN coverage.\nThe UE shall initiate the 5G ProSe UE-to-UE relay discovery security material request procedure by sending a PROSE_SECURITY_MATERIAL_REQUEST message with the <UUR-discovery-security-parameters-request> element. In the <UUR-discovery-security-parameters-request> element, the UE:\na)\tshall include a new transaction ID;\nb)\tshall indicate whether the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE or both;\nc)\tshall include the PC5 UE security capabilities indicating ciphering algorithms supported by the UE;\nd)\tif the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, may include a list of PLMN identities of the visited PLMNs;\ne)\tmay indicate the requested model indicating the model of the 5G ProSe UE-to-UE relay discovery over PC5 interface for which security parameters are requested, set to \"model A\" or \"model B\"; and\nNOTE:\tIf the requested model is not included in the PROSE_SECURITY_MATERIAL_REQUEST message, security parameters are requested for both model A and model B of the 5G ProSe UE-to-UE relay discovery over PC5 interface.\nf)\tshall include the relay service code indicating the connectivity service to be discovered.\nFigure 8a.2.11.2.2.2.1 illustrates the interaction of the UE and the 5G DDNMF in the 5G ProSe UE-to-UE relay discovery security material request procedure.\nThe figure depicts a relay discovery security material request procedure in the 5G ProSe UE-to-UE communication system. It illustrates the steps involved in requesting security material from a relay, including the process of sending a security material request, receiving a response, and verifying the security material's validity. The figure is crucial for ensuring the security of communication between devices in the 5G network.\nFigure 8a.2.11.2.2.2.1: 5G ProSe UE-to-UE relay discovery security material request procedure\nUpon receiving a PROSE_SECURITY_MATERIAL_REQUEST message with the <UUR-discovery-security-parameters-request> element, if:\na)\tthe UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE only and the PROSE_SECURITY_MATERIAL_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe end UE;\nb)\tthe UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE only and the PROSE_SECURITY_MATERIAL_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe UE-to-UE relay UE; or\nc)\tthe UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE and the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE and the PROSE_SECURITY_MATERIAL_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe UE-to-UE relay UE and authorized to act as a 5G ProSe end UE;\nthe 5G DDNMF shall send a PROSE_SECURITY_MATERIAL_RESPONSE message containing a <UUR-discovery-security-parameters-accept> element. In the <UUR-discovery-security-parameters-accept> element, the 5G DDNMF:\na)\tshall include the transaction ID set to the value of the transaction ID received in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_MATERIAL_REQUEST message;\nb)\tif the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE:\n1)\tshall include the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE. In the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, the 5G DDNMF:\nA)\tshall include the expiration timer of the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE; and\nB)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe end UE:\ni)\tif the requested model is not indicated in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model A\", may include the code-receiving security parameters for model A containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask;\nii)\tif the requested model is not indicated in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model B\", may include the code-receiving security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask; and\niii)\tshall include the selected ciphering algorithm; and\n2)\tmay include the PC5 security policies for the received relay service code for 5G ProSe end UE. In the PC5 security policies for the received relay service code for 5G ProSe end UE, the 5G DDNMF:\nA)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe end UE:\ni)\tshall include the PC5 security policies;\nc)\tif the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE:\n1)\tshall include the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE. In the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE, the 5G DDNMF:\nA)\tshall include the expiration timer of the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE; and\nB)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe UE-to-UE relay UE:\ni)\tif the requested model is not indicated in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model A\", may include the code-sending security parameters for model A containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask;\nii)\tif the requested model is not indicated in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model B\", may include the code-receiving security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask; and\niii)\tshall include the selected ciphering algorithm; and\n2)\tmay include the PC5 security policies for the received relay service code for 5G ProSe UE-to-UE relay UE. In the PC5 security policies for the received relay service code for 5G ProSe UE-to-UE relay UE, the 5G DDNMF:\nA)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe UE-to-UE relay UE:\ni)\tshall include the PC5 security policies; and\nd)\tshall include the current time set to the current UTC-based time at the 5G DDNMF and the max offset.\nIf the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, the UE identity in the PROSE_SECURITY_MATERIAL_REQUEST message indicates a UE authorized to act as a 5G ProSe end UE and the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_MATERIAL_REQUEST message contains a list of PLMN identities of the visited PLMNs, the 5G DDNMF shall include in the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE any information received from 5G DDNMFs of potential 5G ProSe UE-to-UE relay UEs which can serve the UE.\nUpon receipt of the PROSE_SECURITY_MATERIAL_RESPONSE message with the <UUR-discovery-security-parameters-accept>, if the transaction ID contained in the <UUR-discovery-security-parameters-accept> element matches the value sent by the UE in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_MATERIAL_REQUEST message, the UE:\na)\tif the <UUR-discovery-security-parameters-accept> element contains the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE:\n1)\tshall store the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, shall stop timer T50aa, if running and shall start timer T50aa with the value of the expiration timer indicated in the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE; and\n2)\tif the PC5 security policies for the relay service code for 5G ProSe end UE are received, shall store the PC5 security policies for the relay service code for 5G ProSe end UE;\nb)\tif the <UUR-discovery-security-parameters-accept> element contains the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE:\n1)\tshall store the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE, shall stop timer T50bb, if running and shall start timer T50bb with the value of the expiration timer indicated in the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE; and\n2)\tif the PC5 security policies for the relay service code for 5G ProSe UE-to-UE relay UE are received, shall store the PC5 security policies for the relay service code for 5G ProSe UE-to-UE relay UE; and\nc)\tshall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset.\nIf the PROSE_SECURITY_MATERIAL_REQUEST message with the <UUR-discovery-security-parameters-request> element cannot be accepted by the 5G DDNMF, the 5G DDNMF shall send a PROSE_SECURITY_MATERIAL_RESPONSE message containing a <UUR-discovery-security-parameters-reject> element. In the <UUR-discovery-security-parameters-reject> element, the 5G DDNMF shall include the transaction ID set to the value of the transaction ID received in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_MATERIAL_REQUEST message and shall include an appropriate PC3a control protocol cause value.\nUpon receipt of the PROSE_SECURITY_MATERIAL_RESPONSE message with the <UUR-discovery-security-parameters-reject> element, if the transaction ID contained in the <UUR-discovery-security-parameters-reject> element matches the value sent by the UE in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_MATERIAL_REQUEST message, the UE shall consider the 5G ProSe UE-to-UE relay discovery security material request procedure as rejected.\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of PROSE_SECURITY_MATERIAL_REQUEST message (e.g. after TCP retransmission timeout).\nThe UE shall close the existing secure connection to the 5G DDNMF, establish a new secure connection and then restart the 5G ProSe UE-to-UE relay discovery security material request procedure.\nb)\tNo response from the 5G DDNMF after the PROSE_SECURITY_MATERIAL_REQUEST message has been successfully delivered (e.g. TCP ACK has been received for the PROSE_SECURITY_MATERIAL_REQUEST message)\nThe UE shall retransmit the PROSE_SECURITY_MATERIAL_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of PROSE_SECURITY_MATERIAL_RESPONSE message.\nAfter receiving an indication from lower layer that the PROSE_SECURITY_MATERIAL_RESPONSE message has not been successfully acknowledged (e.g. TCP ACK is not received), the 5G DDNMF shall abort the procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8a.2.12\t5G ProSe security procedures over PC8 interface for 5G ProSe UE-to-UE relay",
                            "text_content": "The transport protocol for PC3a messages are the same as described in clause 8.2.10.1.1.\nThe handling of UE-initiated procedures are the same as described in clause 8.2.10.1.2.\nThe following procedures are defined:\na)\t5G ProSe UE-to-UE relay discovery security material request procedure;\nb)\t5G ProSe end UE key request procedure; and\nc)\t5G ProSe UE-to-UE relay UE key request procedure.\nIn the following descriptions of 5G procedures over PC8 interface, the terms \"request\" and \"response\" refer to the corresponding PC8 messages, not to the HTTP request or response. The following procedure descriptions use a single PC8 message for illustration purposes.\nThe 5G ProSe procedures over PC8 interface shall be integrity protected and confidentiality protected using the security procedures using GBA or AKMA, see clause 5.2.5.3 and clause 5.2.5.4 in 3GPP TS 33.503 [34].\nNOTE 1:\tA single HTTP request message can contain multiple PC8 requests and a single HTTP response message can contain multiple PC8 responses.\nNOTE 2:\tThe privacy of the UE identity included in the PC8 messages of 5G ProSe procedures over PC8 interface is ensured by the confidentiality protection of those procedures.\nThe purpose of the 5G ProSe UE-to-UE relay discovery security material request procedure is for the UE:\na)\tto obtain the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, applicable when the UE acts as a 5G ProSe end UE and uses the security procedure over user plane as specified in 3GPP TS 33.503 [34]; and\nb)\tto obtain the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE, applicable when the UE acts as a 5G ProSe UE-to-UE relay UE and uses the security procedure over user plane as specified in 3GPP TS 33.503 [34].\nThe UE shall initiate the 5G ProSe UE-to-UE relay discovery security material request procedure:\na)\tif the UE is authorized to act as a 5G ProSe end UE and uses the security procedure over user plane as specified in 3GPP TS 33.503 [34]:\n1)\twhen the UE has no 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE and the UE is in NG-RAN coverage; or\n2)\tafter expiration of timer T50cc, when in NG-RAN coverage or when entering NG-RAN coverage; or\nb)\tif the UE is authorized to act as a 5G ProSe UE-to-UE relay UE and uses the security procedure over user plane as specified in 3GPP TS 33.503 [34]:\n1)\twhen the UE has no 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE and the UE is in NG-RAN coverage; or\n2)\tafter expiration of timer T50yy, when in NG-RAN coverage or when entering NG-RAN coverage.\nThe UE shall initiate the 5G ProSe UE-to-UE relay discovery security material request procedure by sending a PROSE_SECURITY_PARAM_REQUEST message with the <UUR-discovery-security-parameters-request> element. In the <UUR-discovery-security-parameters-request> element, the UE:\na)\tshall include a new transaction ID;\nb)\tshall indicate whether the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE or both;\nc)\tshall include the PC5 UE security capabilities indicating ciphering algorithms supported by the UE;\nd)\tif the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, may include a list of PLMN identities of the visited PLMNs;\ne)\tmay indicate the requested model indicating the model of the 5G ProSe UE-to-UE relay discovery over PC5 interface for which security parameters are requested, set to \"model A\" or \"model B\"; and\nNOTE:\tIf the requested model is not included in the PROSE_SECURITY_PARAM_REQUEST message, security parameters are requested for both model A and model B of the 5G ProSe UE-to-UE relay discovery over PC5 interface.\nf)\tshall include the relay service code indicating the connectivity service to be discovered.\nFigure 8a.2.12.2.2.2.1 illustrates the interaction of the UE and the 5G PKMF in the 5G ProSe UE-to-UE relay discovery security material request procedure.\nThe figure depicts a 5G ProSe UE-to-UE relay discovery security material request procedure, illustrating the steps involved in establishing a secure communication link between two 5G ProSe UEs. The figure includes various components such as the base station (gNB), user equipment (UE), and security material request (SMR) process. The diagram highlights the importance of proper security measures in 5G networks to ensure data integrity and prevent unauthorized access.\nFigure 8a.2.12.2.2.2.1: 5G ProSe UE-to-UE relay discovery security material request procedure\nUpon receiving a PROSE_SECURITY_PARAM_REQUEST message with the <UUR-discovery-security-parameters-request> element, if:\na)\tthe UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE only and the PROSE_SECURITY_PARAM_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe end UE;\nb)\tthe UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE only and the PROSE_SECURITY_PARAM_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe UE-to-UE relay UE; or\nc)\tthe UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE and the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE and the PROSE_SECURITY_PARAM_REQUEST message is received over a TLS tunnel established by a UE authorized to act as a 5G ProSe UE-to-UE relay UE and authorized to act as a 5G ProSe end UE;\nthe 5G PKMF shall send a PROSE_SECURITY_PARAM_RESPONSE message containing a <UUR-discovery-security-parameters-accept> element. In the <UUR-discovery-security-parameters-accept> element, the 5G PKMF:\na)\tshall include the transaction ID set to the value of the transaction ID received in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_PARAM_REQUEST message;\nb)\tif the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE:\n1)\tshall include the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE. In the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, the 5G PKMF:\nA)\tshall include the expiration timer of the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE; and\nB)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe end UE:\ni)\tif the requested model is not indicated in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_PARAM_REQUEST message or is set to \"model A\", may include the code-receiving security parameters for model A containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask;\nii)\tif the requested model is not indicated in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_PARAM_REQUEST message or is set to \"model B\", may include the code-receiving security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask; and\niii)\tshall include the selected ciphering algorithm; and\n2)\tmay include the PC5 security policies for the received relay service code for 5G ProSe end UE. In the PC5 security policies for the received relay service code for 5G ProSe end UE, the 5G PKMF:\nA)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe end UE:\ni)\tshall include the PC5 security policies;\nc)\tif the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE:\n1)\tshall include the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE. In the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE, the 5G PKMF:\nA)\tshall include the expiration timer of the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE; and\nB)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe UE-to-UE relay UE:\ni)\tif the requested model is not indicated in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_PARAM_REQUEST message or is set to \"model A\", may include the code-sending security parameters for model A containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask;\nii)\tif the requested model is not indicated in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_PARAM_REQUEST message or is set to \"model B\", may include the code-receiving security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending security parameters for model B containing one or more of DUSK, DUIK and DUCK with associated encrypted bitmask; and\niii)\tshall include the selected ciphering algorithm; and\n2)\tmay include the PC5 security policies for the received relay service code for 5G ProSe UE-to-UE relay UE. In the PC5 security policies for the received relay service code for 5G ProSe UE-to-UE relay UE, the 5G PKMF:\nA)\tfor the received relay service code for which the UE is authorized to act as a 5G ProSe UE-to-UE relay UE:\ni)\tshall include the PC5 security policies; and\nd)\tshall include the current time set to the current UTC-based time at the 5G PKMF and the max offset.\nIf the UE requests the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, the UE identity in the PROSE_SECURITY_PARAM_REQUEST message indicates a UE authorized to act as a 5G ProSe end UE and the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_PARAM_REQUEST message contains a list of PLMN identities of the visited PLMNs, the 5G PKMF shall include in the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE any information received from 5G PKMFs of potential 5G ProSe UE-to-UE relay UEs which can serve the UE.\nUpon receipt of the PROSE_SECURITY_PARAM_RESPONSE message with the <UUR-discovery-security-parameters-accept>, if the transaction ID contained in the <UUR-discovery-security-parameters-accept> element matches the value sent by the UE in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_PARAM_REQUEST message, the UE:\na)\tif the <UUR-discovery-security-parameters-accept> element contains the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE:\n1)\tshall store the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE, shall stop timer T50cc, if running and shall start timer T50cc with the value of the expiration timer indicated in the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe end UE; and\n2)\tif the PC5 security policies for the relay service code for 5G ProSe end UE are received, shall store the PC5 security policies for the relay service code for 5G ProSe end UE;\nb)\tif the <UUR-discovery-security-parameters-accept> element contains the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE:\n1)\tshall store the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE, shall stop timer T50dd, if running and shall start timer T50dd with the value of the expiration timer indicated in the 5G ProSe UE-to-UE relay discovery security material for 5G ProSe UE-to-UE relay UE; and\n2)\tif the PC5 security policies for the relay service code for 5G ProSe UE-to-UE relay UE are received, shall store the PC5 security policies for the relay service code for 5G ProSe UE-to-UE relay UE; and\nc)\tshall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current time parameter and store the received max offset.\nIf the PROSE_SECURITY_PARAM_REQUEST message with the <UUR-discovery-security-parameters-request> element cannot be accepted by the 5G PKMF, the 5G PKMF shall send a PROSE_SECURITY_PARAM_RESPONSE message containing a <UUR-discovery-security-parameters-reject> element. In the <UUR-discovery-security-parameters-reject> element, the 5G PKMF shall include the transaction ID set to the value of the transaction ID received in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_PARAM_REQUEST message and shall include an appropriate PC8 control protocol cause value.\nUpon receipt of the PROSE_SECURITY_PARAM_RESPONSE message with the <UUR-discovery-security-parameters-reject> element, if the transaction ID contained in the <UUR-discovery-security-parameters-reject> element matches the value sent by the UE in the <UUR-discovery-security-parameters-request> element in the PROSE_SECURITY_PARAM_REQUEST message, the UE shall consider the 5G ProSe UE-to-UE relay discovery security material request procedure as rejected.\nThe following abnormal cases can be identified:\na)\tIndication from the transport layer of transmission failure of PROSE_SECURITY_PARAM_REQUEST message (e.g. after TCP retransmission timeout).\nThe UE shall close the existing secure connection to the 5G PKMF, establish a new secure connection and then restart the 5G ProSe UE-to-UE relay discovery security material request procedure.\nb)\tNo response from the 5G PKMF after the PROSE_SECURITY_PARAM_REQUEST message has been successfully delivered (e.g. TCP ACK has been received for the PROSE_SECURITY_PARAM_REQUEST message)\nThe UE shall retransmit the PROSE_SECURITY_PARAM_REQUEST message.\nNOTE:\tThe timer to trigger retransmission and the maximum number of allowed retransmissions are UE implementation specific.\nThe following abnormal cases can be identified:\na)\tIndication from the lower layer of transmission failure of PROSE_SECURITY_PARAM_RESPONSE message.\nAfter receiving an indication from lower layer that the PROSE_SECURITY_PARAM_RESPONSE message has not been successfully acknowledged (e.g. TCP ACK is not received), the 5G PKMF shall abort the procedure.\nThe 5G ProSe end UE key request procedure is the same as described in clause 8.2.10.2.3 with replacing the 5G ProSe remote UE to 5G ProSe end UE and the 5G ProSe UE-to-network relay UE to 5G ProSe UE-to-UE relay UE.\nThe 5G ProSe UE-to-UE relay UE key request procedure is the same as described in clause 8.2.10.2.4 with replacing the 5G ProSe remote UE to 5G ProSe end UE and the 5G ProSe UE-to-network relay UE to 5G ProSe UE-to-UE relay UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "9\tHandling of unknown, unforeseen and erroneous protocol data",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "9.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures specified in the present document apply to those PC3a, PC8 or PC5 messages which pass the checks described in this clause.\nThis clause also specifies procedures for the handling of unknown, unforeseen and erroneous protocol data by the receiving entity. These procedures are called \"error handling procedures\", but in addition to providing recovery mechanisms for error situations they define a compatibility mechanism for future extensions of the protocols.\nDetailed error handling procedures in the network are implementation dependent and may vary from PLMN to PLMN. However, when extensions of this protocol are developed, networks will be assumed to have the error handling that is indicated in this clause as mandatory (\"shall\") and that is indicated as strongly recommended (\"should\").\nAlso, the error handling of the network is only considered as mandatory or strongly recommended when certain thresholds for errors are not reached during a dedicated connection.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.2\tHandling of unknown, unforeseen and erroneous protocol data in messages sent over the PC3a or PC8 interface",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.2.1\tUnforeseen message type",
                            "text_content": "If the UE receives a PC3a or PC8 message with a message type corresponding to a ProSe discovery mechanism that the UE is not authorised to use by the network, the UE shall discard the message.\nIf the DDNMF receives a PC3a message or the 5G PKMF receives a PC8 message, whose message type indicates that this is a ProSe discovery mechanism the sending UE is not authorised to support, the DDNMF or the the 5G PKMF shall discard the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "9.3\tHandling of unknown, unforeseen and erroneous protocol data in messages sent over the PC5 interface",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.3.1\tMessage too short or too long",
                            "text_content": "When a message is received that is too short to contain a complete message type information element, that message shall be ignored, cf. 3GPP TS 24.007 [20].\nThe maximum size of a PC5 signalling message is 65535 octets.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.3.2\tUnknown or unforeseen message type",
                            "text_content": "If the UE receives a PC5 signalling message with message type not defined for the PC5 signalling protocol or not implemented by the receiver, it shall ignore the PC5 signalling message.\nNOTE:\tA message type not defined for the PC5 signalling protocol in the given direction is regarded by the receiver as a message type not defined for the PC5 signalling protocol, see 3GPP TS 24.007 [20].\nIf the UE receives a message not compatible with the PC5 signalling protocol state, the UE shall ignore the PC5 signalling message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.3.3\tNon-semantical mandatory information element errors",
                            "text_content": "When on receipt of a message,\na)\tan \"imperative message part\" error; or\nb)\ta \"missing mandatory IE\" error\nis diagnosed or when a message containing:\na)\ta syntactically incorrect mandatory IE;\nb)\tan IE unknown in the message, but encoded as \"comprehension required\" (see 3GPP TS 24.007 [20]); or\nc)\tan out of sequence IE encoded as \"comprehension required\" (see 3GPP TS 24.007 [20]) is received,\nthe UE shall ignore the PC5 signalling message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.3.4\tUnknown and unforeseen IEs in the non-imperative message part",
                            "text_content": "The UE shall ignore all IEs unknown in a message which are not encoded as \"comprehension required\" (see 3GPP TS 24.007 [20]).\nThe UE shall ignore all out of sequence IEs in a message which are not encoded as \"comprehension required\" (see 3GPP TS 24.007 [20]).\nIf an information element with format T, TV, TLV, or TLV-E is repeated in a message in which repetition of the information element is not specified in clause 11.3, the UE shall handle only the contents of the information element appearing first and shall ignore all subsequent repetitions of the information element. When repetition of information elements is specified, the UE shall handle only the contents of specified repeated information elements. If the limit on repetition of information elements is exceeded, the UE shall handle the contents of information elements appearing first up to the limit of repetitions and shall ignore all subsequent repetitions of the information element.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.3.5\tNon-imperative message part errors",
                            "text_content": "This category includes:\na)\tsyntactically incorrect optional IEs; and\nb)\tconditional IE errors.\nThe UE shall treat all optional IEs that are syntactically incorrect in a message as not present in the message.\nWhen upon receipt of a PC5 signalling message, the UE diagnoses a \"missing conditional IE\" error or an \"unexpected conditional IE\" error, or when it receives a PC5 signalling message containing at least one syntactically incorrect conditional IE, the UE shall ignore the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.3.6\tMessages with semantically incorrect contents",
                            "text_content": "When a message with semantically incorrect contents is received, the UE shall perform the foreseen reactions of the procedural part of clause 7.2. If, however no such reactions are specified, the UE shall ignore the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "10\tMessage functional definitions and contents",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "10.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause contains the definition and contents of the messages used in the procedures described in the present document.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.2\t5G ProSe direct discovery messages",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.2.1\tMessage definition",
                            "text_content": "This message is sent by the UE over the PC5 interface for open 5G ProSe direct discovery and restricted 5G ProSe direct discovery. See table 10.2.1.1, table 10.2.1.2, table 10.2.1.3, table 10.2.1.4, table 10.2.1.5, table 10.2.1.6, table 10.2.1.7, table 10.2.1.8, table 10.2.1.9, table 10.2.1.10, table 10.2.1.11, table 10.2.1.12, table 10.2.1.13, and table 10.2.1.14.\nMessage type:\tPROSE PC5 DISCOVERY\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.2.1.1: PROSE PC5 DISCOVERY message content for open 5G ProSe direct discovery announcement\n\nTable 10.2.1.2: PROSE PC5 DISCOVERY message content for restricted 5G ProSe direct discovery announcement\n\nTable 10.2.1.3: PROSE PC5 DISCOVERY message content for restricted 5G ProSe direct discovery solicitation\n\nTable 10.2.1.4: PROSE PC5 DISCOVERY message content for restricted 5G ProSe direct discovery response\n\nTable 10.2.1.5: PROSE PC5 DISCOVERY message for group member discovery announcement\n\nTable 10.2.1.6: PROSE PC5 DISCOVERY message for group member discovery solicitation\n\nTable 10.2.1.7: PROSE PC5 DISCOVERY message for group member discovery response\n\nTable 10.2.1.8: PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement\n\nTable 10.2.1.9: PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation\n\nTable 10.2.1.10: PROSE PC5 DISCOVERY message for UE-to-network relay discovery response\n\nTable 10.2.1.11: PROSE PC5 DISCOVERY message for relay discovery additional information\n\nTable 10.2.1.12: PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement\n\nTable 10.2.1.13: PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation\n\nTable 10.2.1.14: PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.2.1.1: PROSE PC5 DISCOVERY message content for open 5G ProSe direct discovery announcement",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.2: PROSE PC5 DISCOVERY message content for restricted 5G ProSe direct discovery announcement",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.3: PROSE PC5 DISCOVERY message content for restricted 5G ProSe direct discovery solicitation",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.4: PROSE PC5 DISCOVERY message content for restricted 5G ProSe direct discovery response",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.5: PROSE PC5 DISCOVERY message for group member discovery announcement",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.6: PROSE PC5 DISCOVERY message for group member discovery solicitation",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.7: PROSE PC5 DISCOVERY message for group member discovery response",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.8: PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.9: PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.10: PROSE PC5 DISCOVERY message for UE-to-network relay discovery response",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.11: PROSE PC5 DISCOVERY message for relay discovery additional information",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.12: PROSE PC5 DISCOVERY message for UE-to-UE relay discovery announcement",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.13: PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 10.2.1.14: PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.2.2\tRelay TAI",
                            "text_content": "The information element may be included in PROSE PC5 DISCOVERY message for relay discovery additional information as in table 10.2.1.11 to indicate the tracking area identity corresponding to the serving cell of the 5G ProSe layer-3 UE-to-network relay for discoveree UEs supporting N3IWF discovery procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.3\tNCGI",
                            "text_content": "The NCGI information element shall be included in:\na)\tPROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement as in table 10.2.1.8; or\nb)\tPROSE PC5 DISCOVERY message for UE-to-network relay discovery response as in table 10.2.1.10;\nto indicate the NCGI of the serving cell if the UE acts as a 5G ProSe layer-2 UE-to-network relay UE.\nWhen the UE acts as a 5G ProSe layer-3 UE-to-network relay UE, the UE may include the NCGI information element in PROSE PC5 DISCOVERY message for relay discovery additional information as in table 10.2.1.11 to indicate the NCGI of the serving cell.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.4\tTarget user info",
                            "text_content": "The target user info IE shall be included in PROSE PC5 DISCOVERY message for group member discovery solicitation in as in table 10.2.1.6 if the target information is provided by the upper layers to identify a specific group member of the application layer group identified by the configured application layer group ID.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.5\tMetadata",
                            "text_content": "The Metadata information element may be included:\na)\tto provide the application layer metadata information in the following messages:\n1)\tthe PROSE PC5 DISCOVERY message for open 5G ProSe direct discovery announcement as in table 10.2.1.1;\n2)\tthe PROSE PC5 DISCOVERY message for restricted 5G ProSe direct discovery announcement as in table 10.2.1.2; and\n3)\tthe PROSE PC5 DISCOVERY message for restricted 5G ProSe direct discovery response as in table 10.2.1.4; or\nb)\tto provide the application layer discovery message in the following messages:\n1)\tthe PROSE PC5 DISCOVERY message for group member discovery announcement as in table 10.2.1.5; and\n2)\tthe PROSE PC5 DISCOVERY message for group member discovery response as in table 10.2.1.7.\nNOTE 1:\tThe format of the application layer metadata information and the application layer discovery message are out of scope of this specification.\nNOTE 2:\tPossible impact on the performance of the 5G ProSe direct discovery procedure is to be considered if the resulted Metadata information element size is too big, e.g., longer delay and lower reliability.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.6\tRRC container",
                            "text_content": "The RRC container information element shall be included in:\na)\tPROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement as in table 10.2.1.8; or\nb)\tPROSE PC5 DISCOVERY message for UE-to-network relay discovery response as in table 10.2.1.10;\nto indicate the RRC container information if it is received from the lower layers and the UE acts as a 5G ProSe layer-2 UE-to-network relay UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.7\tTarget discoveree info",
                            "text_content": "The target discoveree info IE shall be included in PROSE PC5 DISCOVERY message for UE-to-network relay discovery solicitation as in table 10.2.1.9 if the target discoveree info is provided by the application layer.\n10.2.8\tTarget discoveree end UE info\nThe target discoveree end UE info IE shall be included in PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response as in table 10.2.1.14 if the message is sent by the target 5G ProSe end UE.\n10.2.8a\tSource discoverer end UE info\nThe source discoverer end UE info IE shall be included in PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation as in table 10.2.1.13 if the message is sent by the source 5G ProSe end UE.\n10.2.9\tUE-to-UE relay UE info\nThe UE-to-UE relay UE info IE shall be included in PROSE PC5 DISCOVERY message for UE-to-UE relay discovery discovery solicitation as in table 10.2.1.13 or PROSE PC5 DISCOVERY message for UE-to-UE relay discovery discovery response as in table 10.2.1.14 if the message is sent by the 5G ProSe UE-to-UE relay UE.\nThe UE-to-UE relay UE info IE may be included in PROSE PC5 DISCOVERY message for UE-to-UE relay discovery discovery solicitation as in table 10.2.1.13, if available, if the message is sent by the source 5G ProSe end UE.\n10.2.10\tStatus indicator\nThe status indicator IE shall be included in PROSE PC5 DISCOVERY message for UE-to-UE relay discovery discovery solicitation as in table 10.2.1.13 and PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response in table 10.2.1.14 if the message is sent by the 5G ProSe UE-to-UE relay UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.11\tAnnounce prohibited indication",
                            "text_content": "The announce prohibited indication IE with its value set as \"It is prohibited to broadcast the user info\" shall be included in PROSE PC5 DISCOVERY message for UE-to-UE relay discovery solicitation as in table 10.2.1.13 if the discoverer end UE needs to indicate to a 5G ProSe UE-to-UE relay UE that it is prohibited from broadcasting the user info of the discoverer end UE included in the direct discovery set during the procedure of 5G ProSe UE-to-UE relay discovery over PC5 interface with model A.\nThe announce prohibited indication IE with its value set as \"It is prohibited to broadcast the user info\" shall be included in PROSE PC5 DISCOVERY message for UE-to-UE relay discovery response as in table 10.2.1.14 if the the discoveree end UE needs to indicate to the 5G ProSe UE-to-UE relay UE that it is prohibited from broadcasting the user info the discoveree end UE included in the direct discovery set during the procedure of 5G ProSe UE-to-UE relay discovery over PC5 interface with model A.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.11\tDiscoveree user info",
                            "text_content": "The discoveree user info IE shall be included in the PROSE PC5 DISCOVERY message content for restricted 5G ProSe direct discovery solicitation as in table 10.2.1.3 if the application layer ID of the discoveree UE is provided by the upper layers to identify a specific discoveree UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.3\tPC5 signalling messages",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.3.1\tProSe direct link establishment request",
                            "text_content": "This message is sent by a UE to another peer UE to establish a direct link. See table 10.3.1.1.1.\nMessage type:\tPROSE DIRECT LINK ESTABLISHMENT REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.1.1.1: PROSE DIRECT LINK ESTABLISHMENT REQUEST message content\n\nThe UE shall include this IE if the target UE's application layer ID is received from upper layers or known based on the unicast layer-2 ID of target UE (i.e. destination layer-2 ID) as described in clause 5.8.2.4 of 3GPP TS 23.304 [3], or if the UE receives the user info ID of the 5G ProSe UE-to-network relay UE during the 5G ProSe UE-to-network relay discovery procedure, or if:\n1)\tthe UE is acting as the source 5G ProSe end UE and the user info ID of the target 5G ProSe end UE is obtained during the 5G ProSe UE-to-UE relay discovery procedure; or\n2)\tthe UE is acting as the 5G ProSe UE-to-UE relay UE and the user info ID of the target 5G ProSe end UE is obtained in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message from the source 5G ProSe end UE.\nThe UE shall include this IE if the UE PC5 unicast signalling security policy is set to \"Signalling integrity protection required\" or \"Signalling integrity protection preferred\".\nThe UE shall include this IE if the UE PC5 unicast signalling security policy is set to \"Signalling integrity protection required\" or \"Signalling integrity protection preferred\" and the 5G ProSe direct link is neither for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE nor for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nNOTE:\tWhen the 5G ProSe direct link establishment procedure is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the security procedure over user plane is used as specified in 3GPP TS 33.503 [34], the \"Nonce_1\" is called \"KNRP freshness parameter 1\" as specified in 3GPP TS 33.503 [34].\nThe UE shall include this IE if the UE PC5 unicast signalling security policy is set to \"Signalling integrity protection required\" or \"Signalling integrity protection preferred\".\nThe UE may include this IE if it has an existing KNRP for the target UE.\nThe UE shall include this IE if the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nThe UE shall include this IE if the 5G ProSe direct link establishment procedure is not for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE.\nThe UE shall include this IE if the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nThe UE shall include this IE if the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, and:\na)\tthe security procedure over user plane for 5G ProSe UE-to-network relay is used as specified in 3GPP TS 33.503 [34] and the UE has a valid UP-PRUK; or\nb)\tthe security procedure over control plane for 5G ProSe UE-to-network relay is used as specified in 3GPP TS 33.503 [34] and the UE has a valid CP-PRUK associated with the relay service code of the target UE.\nThe UE shall include this IE if the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and:\na)\tthe security procedure over user plane for 5G ProSe UE-to-UE relay is used as specified in 3GPP TS 33.503 [34] and the UE has a valid UP-PRUK; or\nb)\tthe security procedure over control plane for 5G ProSe UE-to-UE relay is used as specified in 3GPP TS 33.503 [34] and the UE has a valid CP-PRUK associated with the relay service code of the target UE.\nThe UE shall include this IE if the the UP-PRUK ID of the UE is included and is not in NAI format (see 3GPP TS 33.503 [34]).\nThe UE shall include this IE if the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nThe UE shall include this IE if the 5G ProSe direct link establishment procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or for direct communication between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the UE has the DUIK.\nThe UE shall include this IE if:\n1)\tthe user info ID of the 5G ProSe UE-to-UE relay UE is obtained during the 5G ProSe UE-to-UE relay discovery procedure and the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE; or\n2)\tthe UE is acting as the 5G ProSe UE-to-UE relay UE.\nThe UE shall include this IE if the target end UE layer-2 ID is available to the source 5G ProSe end UE via the previous direct communication and the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.1.1.1: PROSE DIRECT LINK ESTABLISHMENT REQUEST message content",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.2\tProSe direct link establishment accept",
                            "text_content": "This message is sent by a UE to another peer UE to accept the received PROSE DIRECT LINK ESTABLISHMENT REQUEST message. See table 10.3.2.1.1.\nMessage type:\tPROSE DIRECT LINK ESTABLISHMENT ACCEPT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.2.1.1: PROSE DIRECT LINK ESTABLISHMENT ACCEPT message content\n\nThe UE shall include this IE if IP communication is used.\nThe UE shall include this IE if IP communication is used and the IP address configuration is set to \"address allocation not supported\".\nThe UE shall include this IE if:\na)\tthe 5G ProSe direct link establishment procedure is not for 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE; or\nb)\tthe 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3 UE-to-network relay UE.\nThe UE may include this IE to indicate the PC5 QoS rules for the established PC5 QoS flow(s).\nThe UE shall include this IE if the 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the (source or target) 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nThe UE shall include this IE when the MAC address of the target 5G ProSe layer-3 end UE needs to be indicated.\nThe UE may include this IE if:\na)\tthe 5G ProSe direct link establishment procedure is for 5G ProSe direct communication between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE;\nb)\tthe UE acts as the 5G ProSe layer-3 UE-to-UE relay UE;\nc)\tthe data unit type is IP; and\nd)\tthe IP address of the target 5G ProSe layer-3 end UE is available in the 5G ProSe layer-3 UE-to-UE relay UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.2.1.1: PROSE DIRECT LINK ESTABLISHMENT ACCEPT message content",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.3\tProSe direct link establishment reject",
                            "text_content": "This message is sent by the UE to another peer UE to indicate that the link establishment request is not accepted. See table 10.3.3.1.1.\nMessage type:\tPROSE DIRECT LINK ESTABLISHMENT REJECT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.3.1.1: PROSE DIRECT LINK ESTABLISHMENT REJECT message content\n\nThe UE may include this IE when it needs to indicate a back-off timer to another peer UE for congestion control purpose.\nThe EAP message IE is included if received from the network according to the security procedure over control plane as specified in 3GPP TS 33.503 [34], when the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nThe UE may include this IE if:\na)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE to indicate the PC5 signalling protocol cause received from the target 5G ProSe end UE.\nThe UE may include this IE if:\na)\tthe UE acts as a target 5G ProSe end UE and the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE; or\nb)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nto indicate the user info ID of the source 5G ProSe end UE.\nThe UE may include this IE if:\na)\tthe UE acts as a target 5G ProSe end UE and the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE; or\nb)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nto indicate the user info ID of the target 5G ProSe end UE.\nThe UE may include this IE if:\na)\tthe UE acts as a target 5G ProSe end UE and the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE; or\nb)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE;\nto indicate the user info ID of the 5G ProSe UE-to-UE relay UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.3.1.1: PROSE DIRECT LINK ESTABLISHMENT REJECT message content",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.4\tProSe direct link release request",
                            "text_content": "This message is sent by the UE to another peer UE to initiate the direct link release procedure. See table 10.3.4.1.1.\nMessage type:\tPROSE DIRECT LINK RELEASE REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.4.1.1: PROSE DIRECT LINK RELEASE REQUEST message content\n\nThe UE may include this IE when it needs to indicate a back-off timer to another peer UE for congestion control purpose.\nThe UE may include this IE if:\na)\tthe UE acts as a 5G ProSe layer-3 UE-to-UE relay UE to indicate to the 5G ProSe layer-3 end UE the PC5 signalling protocol cause received from the peer 5G ProSe end UE that has released its 5G ProSe direct link with the 5G ProSe layer-3 UE-to-UE relay UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.4.1.1: PROSE DIRECT LINK RELEASE REQUEST message content",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.5\tProSe direct link release accept",
                            "text_content": "This message is sent by the UE to another peer UE to indicate that the link release request is accepted. See table 10.3.5.1.1.\nMessage type:\tPROSE DIRECT LINK RELEASE ACCEPT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.5.1.1: PROSE DIRECT LINK RELEASE ACCEPT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.5.1.1: PROSE DIRECT LINK RELEASE ACCEPT message content",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.6\tProSe direct link modification request",
                            "text_content": "This message is sent by the UE to another peer UE to initiate the direct link modification procedure. See table 10.3.6.1.1.\nMessage type:\tPROSE DIRECT LINK MODIFICATION REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.6.1.1: PROSE DIRECT LINK MODIFICATION REQUEST message content\n\nThe UE may include this IE to indicate the PC5 QoS rules for the PC5 QoS flow(s) to be added or modified.\nThe UE shall include this IE to indicate the user info ID of the source 5G ProSe end UE if:\na)\tthe UE acts as a 5G ProSe layer-3 UE-to-UE relay UE;\nb)\tthe 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE; and\nc)\tone of the following conditions is met:\n1)\tmultiple source 5G ProSe layer-3 end UEs have established direct communication with the target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\n2)\tan additional source 5G ProSe end UE requests to establish direct communication with the target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link; or\n3)\tone of the source 5G ProSe layer-3 end UEs requests to release the direct communication with the target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link.\nThe UE may include this IE to indicate the user info ID of the source 5G ProSe end UE if:\na)\tthe UE acts as a 5G ProSe UE-to-UE relay UE;\nb)  the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE; and\nc)  only one source 5G ProSe end UE has established direct communication with the target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link\nThe UE shall include this IE to indicate the user info ID of the target 5G ProSe end UE if:\na)\tthe UE acts as a source 5G ProSe layer-3 end UE;\nb)\tthe 5G ProSe direct link is between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE; and\nc)\tone of the following conditions is met:\n1)\tthe source 5G ProSe layer-3 end UE have established direct communication with multiple target 5G ProSe layer-3 end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\n2)\tthe source 5G ProSe layer-3 end UE requests to establish direct communication with an additional target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link; or\n3)\tthe source 5G ProSe layer-3 end UE requests to release the direct communication with one of the target 5G ProSe layer-3 end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link.\nThe UE may include this IE to indicate the user info ID of the target 5G ProSe end UE if:\na)\tthe UE acts as a source 5G ProSe end UE, the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the source 5G ProSe end UE has established direct communication with only one target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link.\nThe UE shall include this IE to indicate the user info ID of the target 5G ProSe end UE if:\na)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE.\nThe UE may include this IE if:\na)\tthe UE acts as a source 5G ProSe end UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE to indicate the destination layer-2 ID of the target 5G ProSe End UE.\nThe UE shall include this IE when the MAC address of the source 5G ProSe layer-3 end UE needs to be indicated.\nThe UE shall include this IE if the 5G ProSe direct link modification request is to trigger the negotiated 5G ProSe UE-to-UE relay reselection,\nThe UE shall include this IE if the relay reselection is indicated.\nThe UE shall include this IE to indicate the list of IP addresses of the target 5G ProSe end UEs, if relay reselection is indicated, and if:\na)\tthe UE acts as a source 5G ProSe end UE, and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nThe UE may include this IE if the relay reselection is indicated.\nThe UE shall include this IE to indicate the IP address of the source 5G ProSe layer-3 end UE, if relay reselection is indicated, and if:\na)\tthe UE acts as a 5G ProSe layer-3 UE-to-UE relay UE, and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE.\nThe UE shall include this IE if the relay reselection indication is included and the 5G ProSe direct link is between the source 5G ProSe layer-2 end UE and the target 5G ProSe layer-2 end UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.6.1.1: PROSE DIRECT LINK MODIFICATION REQUEST message content",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.7\tProSe direct link modification accept",
                            "text_content": "This message is sent by the UE to another peer UE to indicate that the link modification request is accepted. See table 10.3.7.1.1.\nMessage type:\tPROSE DIRECT LINK MODIFICATION ACCEPT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.7.1.1: PROSE DIRECT LINK MODIFICATION ACCEPT message content\n\nThe UE shall include this IE if the 5G ProSe direct link modification procedure is to:\na)\tadd new PC5 QoS flow(s) to the existing 5G ProSe direct link;\nb)\tmodify PC5 QoS parameters of the existing PC5 QoS flow(s);\nc)\tassociate new ProSe application(s) with existing PC5 QoS flow(s); or\nd)\tremove ProSe application(s) from existing PC5 QoS flow(s).\nThe UE may include this IE to indicate the PC5 QoS rules for the PC5 QoS flow(s) to be added or modified.\nThe UE shall include this IE to indicate the user info ID of the source 5G ProSe end UE if:\na)\tthe UE acts as a target 5G ProSe layer-3 end UE;\nb)\tthe 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE; and\nc)\tone of the following conditions is met:\n1)\tmultiple source 5G ProSe layer-3 end UEs have established direct communication with the target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\n2)\tan additional source 5G ProSe end UE requests to establish direct communication with the target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link; or\n3)\tone of the source 5G ProSe layer-3 end UEs requests to release the direct communication with the target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link.\nThe UE may include this IE to indicate the user info ID of the source 5G ProSe end UE if:\na)\tthe UE acts as a target 5G ProSe end UE;\nb) the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE;\nc) only one source 5G ProSe end UE has established direct communication with the target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link.\nThe UE shall include this IE to indicate the user info ID of the target 5G ProSe end UE if:\na)\tthe UE acts as a 5G ProSe layer-3 UE-to-UE relay UE;\nb)\tthe 5G ProSe direct link is between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE; and\nc)\tone of the following conditions is met:\n1)\tthe source 5G ProSe layer-3 end UE have established direct communication with multiple target 5G ProSe layer-3 end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link;\n2)\tthe source 5G ProSe layer-3 end UE requests to establish direct communication with an additional target 5G ProSe layer-3 end UE via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link; or\n3)\tthe source 5G ProSe layer-3 end UE requests to release the direct communication with one of the target 5G ProSe layer-3 end UEs via the 5G ProSe layer-3 UE-to-UE relay UE using the same 5G ProSe direct link.\nThe UE may include this IE to indicate the user info ID of the target 5G ProSe end UE if:\na)\tthe UE acts as a 5G ProSe UE-to-UE relay UE;\nb) the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE; and\nc)\tthe source 5G ProSe end UE has established direct communication with only one target 5G ProSe end UE via the 5G ProSe UE-to-UE relay UE using the 5G ProSe direct link.\nThe UE shall include this IE to indicate the user info ID of the target 5G ProSe end UE if:\na)\tthe UE acts as the target 5G ProSe end UE and the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE.\nThe UE shall include this IE when the MAC address of the target 5G ProSe layer-3 end UE needs to be indicated.\nThe UE shall include this IE if the 5G ProSe direct link modification request for the negotiated 5G ProSe UE-to-UE relay reselection is accepted.\nThe UE shall include this IE if the relay reselection is indicated.\nThe UE shall include this IE to indicate the IP address of the source 5G ProSe layer-3 end UE if relay reselection is indicated, and if:\na)\tthe UE acts as a target 5G ProSe layer-3 end UE and the 5G ProSe direct link is between the target 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE; or\nb)\tthe UE acts as a 5G ProSe layer-3 UE-to-UE relay UE and the 5G ProSe direct link is between the source 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE.\nThe UE shall include this IE to indicate the IP address of the target 5G ProSe layer-3 end UE if relay reselection is indicated, and if:\na)\tthe UE acts as a target 5G ProSe layer-3 end UE and the 5G ProSe direct link is between the target 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE; or\nb)\tthe UE acts as a 5G ProSe layer-3 UE-to-UE relay UE and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the source 5G ProSe layer-3 end UE.\nThe UE shall include this IE to indicate the IP address of the target 5G ProSe layer-3 end UE, if:\na)\tthe 5G ProSe direct link modification procedure is to establish 5G ProSe UE-to-UE relay communication with additional target 5G ProSe layer-3 end UE using the existing 5G ProSe direct link between the source 5G ProSe layer-3 end UE and 5G ProSe layer-3 UE-to-UE relay UE;\nb)\tthe UE acts as the 5G ProSe layer-3 UE-to-UE relay UE;\nc)\tthe data unit type is IP; and\nd)\tthe IP address of the additional target 5G ProSe layer-3 end UE is available in the 5G ProSe layer-3 UE-to-UE relay UE.\nThe UE shall include this IE to indicate the target 5G ProSe end UE IP address to be used with the newly selected 5G ProSe layer-3 UE-to-UE relay UE, if relay reselection is indicated and if:\na)\tthe UE acts as a target 5G ProSe layer-3 end UE, and the 5G ProSe direct link is between the target 5G ProSe layer-3 end UE and the 5G ProSe layer-3 UE-to-UE relay UE; or\nb)\tthe UE acts as a 5G ProSe layer-3 UE-to-UE relay UE, and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the source 5G ProSe layer-3 end UE.\nThe UE shall include this IE if the relay reselection indication is included and the 5G ProSe direct link is between the source 5G ProSe layer-2 end UE and the target 5G ProSe layer-2 end UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.7.1.1: PROSE DIRECT LINK MODIFICATION ACCEPT message content",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.7a\tProSe direct link modification ack",
                            "text_content": "This message is sent by the UE to another peer UE to acknowledge the direct link modification procedure. See table 10.3.7a.1.1.\nMessage type:\tPROSE DIRECT LINK MODIFICATION ACK\nSignificance:\tdual\nDirection:\tUE to peer UE\nUE to peer UE\nTable 10.3.7a.1.1: PROSE DIRECT LINK MODIFICATION ACK message content\nThe UE shall include this IE to indicate the IP address of the source 5G ProSe layer-3 end UE if the IP communication is used, and if:\na)\tthe UE acts as a 5G ProSe layer-3 UE-to-UE relay UE, and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the target 5G ProSe layer-3 end UE.\nThe UE shall include this IE to indicate the IP address of the target 5G ProSe layer-3 end UE if the IP communication is used, and if:\na)\tthe UE acts as a source 5G ProSe layer-3 end UE, and the 5G ProSe direct link is between the 5G ProSe layer-3 UE-to-UE relay UE and the source 5G ProSe layer-3 end UE.\nThe UE shall include this IE if the relay reselection indication is included and the 5G ProSe direct link is between the source 5G ProSe layer-2 end UE and the target 5G ProSe layer-2 end UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.7a.1.1: PROSE DIRECT LINK MODIFICATION ACK message content",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.8\tProSe direct link keepalive request",
                            "text_content": "This message is sent by a UE to another peer UE when a 5G ProSe direct link keep-alive procedure is initiated. See table 10.3.8.1.1.\nMessage type:\tPROSE DIRECT LINK KEEPALIVE REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.8.1.1: PROSE DIRECT LINK KEEPALIVE REQUEST message content\n\nThe UE may include this IE to indicate its maximum inactivity period to the peer UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.8.1.1: PROSE DIRECT LINK KEEPALIVE REQUEST message content",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.9\tProSe direct link keepalive response",
                            "text_content": "This message is sent by a UE to another peer UE to respond to a PROSE DIRECT LINK KEEPALIVE REQUEST message. See table 10.3.9.1.1.\nMessage type:\tPROSE DIRECT LINK KEEPALIVE RESPONSE\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.9.1.1: PROSE DIRECT LINK KEEPALIVE RESPONSE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.9.1.1: PROSE DIRECT LINK KEEPALIVE RESPONSE message content",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.10\tProSe direct link authentication request",
                            "text_content": "This message is sent by a UE to another peer UE when a 5G ProSe direct link authentication procedure is initiated. See table 10.3.10.1.1.\nMessage type:\tPROSE DIRECT LINK AUTHENTICATION REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.10.1.1: PROSE DIRECT LINK AUTHENTICATION REQUEST message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.10.1.1: PROSE DIRECT LINK AUTHENTICATION REQUEST message content",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.11\tProSe direct link authentication response",
                            "text_content": "This message is sent by a UE to another peer UE to respond to a PROSE DIRECT LINK AUTHENTICATION REQUEST message. See table 10.3.11.1.1.\nMessage type:\tPROSE DIRECT LINK AUTHENTICATION RESPONSE\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.11.1.1: PROSE DIRECT LINK AUTHENTICATION RESPONSE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.11.1.1: PROSE DIRECT LINK AUTHENTICATION RESPONSE message content",
                                    "table number": 28,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.12\tProSe direct link authentication reject",
                            "text_content": "This message is sent by a UE to another peer UE to reject a PROSE DIRECT LINK AUTHENTICATION REQUEST message. See table 10.3.12.1.1.\nMessage type:\tPROSE DIRECT LINK AUTHENTICATION REJECT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.12.1.1: PROSE DIRECT LINK AUTHENTICATION REJECT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.12.1.1: PROSE DIRECT LINK AUTHENTICATION REJECT message content",
                                    "table number": 29,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.13\tProSe direct link security mode command",
                            "text_content": "This message is sent by a UE to another peer UE when a 5G ProSe direct link security mode control procedure is initiated. See table 10.3.13.1.1.\nMessage type:\tPROSE DIRECT LINK SECURITY MODE COMMAND\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.13.1.1: PROSE DIRECT LINK SECURITY MODE COMMAND message content\n\nThe UE shall include this IE if the selected integrity protection algorithms is not the null integrity protection algorithm.\nNOTE:\tWhen the 5G ProSe direct link establishment procedure is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the security procedure over user plane is used as specified in 3GPP TS 33.503 [34], the \"Nonce_2\" is called \"KNRP freshness parameter 2\" as specified in 3GPP TS 33.503 [34].\nThe UE shall include this IE if the selected integrity protection algorithms is not the null integrity protection algorithm.\nThe UE shall include this IE if the UE has derived a new KNRP and the authentication method used to generate KNRP requires sending information to complete the authentication procedure and the 5G ProSe direct link is not for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE.\nThe UE shall include this IE if the UE has derived a new KNRP.\nThe UE shall include this IE if the PROSE DIRECT LINK SECURITY MODE COMMAND message is triggered by the PROSE DIRECT LINK ESTABLISHMENT REQUEST message. The content of the IE is the same as the content of UE PC5 unicast signalling security policy IE in the received PROSE DIRECT LINK ESTABLISHMENT REQUEST message in order to provide protection against bidding down attacks.\nThe UE shall include this IE if received from the 5G PKMF according to the security procedure over user plane as specified in 3GPP TS 33.503 [34], when the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nThe EAP message IE is included if received from the network according to the security procedure over control plane as specified in 3GPP TS 33.503 [34], when the direct communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.13.1.1: PROSE DIRECT LINK SECURITY MODE COMMAND message content",
                                    "table number": 30,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.14\tProSe direct link security mode complete",
                            "text_content": "This message is sent by a UE to another peer UE to respond to a PROSE DIRECT LINK SECURITY MODE COMMAND message. See table 10.3.14.1.1.\nMessage type:\tPROSE DIRECT LINK SECURITY MODE COMPLETE\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.14.1.1: PROSE DIRECT LINK SECURITY MODE COMPLETE message content\n\nThe UE shall include this IE if IP communication is used and the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure.\nThe UE shall include this IE if IP communication is used, the IP address configuration is set to \"address allocation not supported\" and the 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure.\nThe UE shall include this IE if a new KNRP was derived.\nThe UE may include this IE to indicate the PC5 QoS rules for the PC5 QoS flow(s) to be added.\nThe UE shall include this IE if:\na)\tthe 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure and is not for 5G ProSe direct communication between a 5G ProSe remote UE and a 5G ProSe UE-to-network relay UE.\nThe UE may include this IE if:\na)\tthe 5G ProSe direct link security mode control procedure was triggered during a 5G ProSe direct link establishment procedure and is for 5G ProSe direct communication between the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3 UE-to-network relay UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.14.1.1: PROSE DIRECT LINK SECURITY MODE COMPLETE message content",
                                    "table number": 31,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.15\tProSe direct link security mode reject",
                            "text_content": "This message is sent by a UE to another peer UE to reject a PROSE DIRECT LINK SECURITY MODE COMMAND message. See table 10.3.15.1.1.\nMessage type:\tPROSE DIRECT LINK SECURITY MODE REJECT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.15.1.1: PROSE DIRECT LINK SECURITY MODE REJECT message content\n\nThe UE shall include this IE if there is a synchronisation error and the 5G ProSe direct link security mode control procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\nThe UE shall include this IE if there is a synchronisation error and the 5G ProSe direct link security mode control procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.15.1.1: PROSE DIRECT LINK SECURITY MODE REJECT message content",
                                    "table number": 32,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.16\tProSe direct link rekeying request",
                            "text_content": "This message is sent by a UE to another peer UE when a 5G ProSe direct link re-keying procedure is initiated. See table 10.3.16.1.1.\nMessage type:\tPROSE DIRECT LINK REKEYING REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.16.1.1: PROSE DIRECT LINK REKEYING REQUEST message content\n\nThe UE shall include this IE if the null integrity protection algorithm is not in use and the 5G ProSe direct link is not for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE.\nThe UE shall include this IE if the null integrity protection algorithm is not in use.\nNOTE 2:\tWhen the 5G ProSe direct link re-keying procedure is between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and the security procedure over user plane is used as specified in 3GPP TS 33.503 [34], the \"Nonce_1\" is called \"KNRP freshness parameter 1\" as specified in 3GPP TS 33.503 [34].\nThe UE shall include this IE if the null integrity protection algorithm is not in use.\nThe UE shall include this IE if the UE wants to derive a new KNRP.\nThe UE shall include this IE if the 5G ProSe direct link re-keying procedure is for direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE or between the 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE, and:\na)\tthe security procedure over user plane as specified in 3GPP TS 33.503 [34] is used and the UE has a valid UP-PRUK; or\nb)\tthe security procedure over control plane as specified in 3GPP TS 33.503 [34] is used and the UE has a valid CP-PRUK associated with the relay service code of the target UE.\nThe UE shall include this IE if the UP-PRUK ID is included and is not in NAI format (see 3GPP TS 33.503 [34]).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.16.1.1: PROSE DIRECT LINK REKEYING REQUEST message content",
                                    "table number": 33,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.17\tProSe direct link rekeying response",
                            "text_content": "This message is sent by a UE to another peer UE to respond to a PROSE DIRECT LINK REKEYING REQUEST message. See table 10.3.17.1.1.\nMessage type:\tPROSE DIRECT LINK REKEYING RESPONSE\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.17.1.1: PROSE DIRECT LINK REKEYING RESPONSE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.17.1.1: PROSE DIRECT LINK REKEYING RESPONSE message content",
                                    "table number": 34,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.18\tProSe direct link identifier update request",
                            "text_content": "This message is sent by a UE to another peer UE to initiate the direct link identifier update procedure. See table 10.3.18.1.1.\nMessage type:\tPROSE DIRECT LINK IDENTIFIER UPDATE REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.18.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message content\n\nThis IE is included when the initiating UE receives a new application layer ID.\nThis IE is included when the link local IPv6 address changes at the initiating UE and the 5G ProSe direct link is not for 5G ProSe direct communication between 5G ProSe layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay UE.\nThis IE is included when the initiating UE needs a new IP address/prefix to be allocated by the 5G ProSe layer-3 UE-to-UE relay.\nThis IE is included when the initiating UE changes its IP address/prefix and its peer UE(s) (i.e. target End UEs) need to be informed of this new IP address/prefix.\nThis IE is included when the initiating UE changes its IP address/prefix and its peer UE(s) (i.e. target End UEs) need to be informed of this new IP address/prefix.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.18.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message content",
                                    "table number": 35,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.19\tProSe direct link identifier update accept",
                            "text_content": "This message is sent by the UE to another peer UE to indicate that the link identifier update request is accepted. See table 10.3.19.1.1.\nMessage type:\tPROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.19.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message content\n\nThis IE is included if the target UE receives the Source user info IE in the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message.\nThis IE is included if the target UE receives the Source link local IPv6 address IE in the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message.\nThis IE is included when the application layer ID changes at the target UE and the target UE receives a new application layer ID from the upper layers.\nThis IE is included when the link local IPv6 address changes at the target UE and the target UE receives a new Link local IPv6 address from the upper layers and the 5G ProSe direct link is not for 5G ProSe direct communication between 5G ProSe layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.19.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message content",
                                    "table number": 36,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.20\tProSe direct link identifier update ack",
                            "text_content": "This message is sent by the initiating UE to target UE to indicate that the initiating UE has received target UE's accept message. See table 10.3.20.1.1.\nMessage type:\tPROSE DIRECT LINK IDENTIFIER UPDATE ACK\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.20.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE ACK message content\n\nThis IE is included when the initiating UE receives the Target user info IE in the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message.\nThis IE is included when the initiating UE receives the Target link local IPv6 address IE in the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message.\nThis IE is included when the initiating UE's IP address/prefix is allocated by the 5G ProSe layer-3 UE-to-UE relay UE  and the initiating UE receives the Link local IPv6 address IE in the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.20.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE ACK message content",
                                    "table number": 37,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.21\tProSe direct link identifier update reject",
                            "text_content": "This message is sent by the target UE to initiating UE to indicate that the link identifier update request is not accepted. See table 10.3.21.1.1.\nMessage type:\tPROSE DIRECT LINK IDENTIFIER UPDATE REJECT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.21.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.21.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message content",
                                    "table number": 38,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.22\tProSe direct link modification reject",
                            "text_content": "This message is sent by the UE to another peer UE to indicate that the link modification request is not accepted. See table 10.3.22.1.1.\nMessage type:\tPROSE DIRECT LINK MODIFICATION REJECT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.22.1.1: PROSE DIRECT LINK MODIFICATION REJECT message content\n\nThe UE may include this IE if:\na)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE to indicate the PC5 signalling protocol cause received from the target 5G ProSe end UE.\nThe UE may include this IE if:\na)\tthe UE acts as a target 5G ProSe end UE and the 5G ProSe direct link is between the 5G ProSe UE-to-UE relay UE and the target 5G ProSe end UE to indicate the user info ID of the source 5G ProSe end UE.\nThe UE may include this IE if:\na)\tthe UE acts as a 5G ProSe UE-to-UE relay UE and the 5G ProSe direct link is between the source 5G ProSe end UE and the 5G ProSe UE-to-UE relay UE to indicate the user info ID of the target 5G ProSe end UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.22.1.1: PROSE DIRECT LINK MODIFICATION REJECT message content",
                                    "table number": 39,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.23\tProSe direct link authentication failure",
                            "text_content": "This message is sent by a UE to another peer UE to reject a PROSE DIRECT LINK AUTHENTICATION RESPONSE message. See table 10.3.23.1.1.\nMessage type:\tPROSE DIRECT LINK AUTHENTICATION FAILURE\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.23.1.1: PROSE DIRECT LINK AUTHENTICATION FAILURE message content\n\nThe UE shall include this IE if it is provided by upper layers.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.23.1.1: PROSE DIRECT LINK AUTHENTICATION FAILURE message content",
                                    "table number": 40,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.24\tProSe additional parameters announcement request",
                            "text_content": "This message is sent by the 5G ProSe layer-3 remote UE to 5G ProSe layer-3 UE-to-network relay UE to initiate the ProSe additional parameters announcement request procedure. See table 10.3.24.1.1.\nMessage type:\tPROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.24.1.1: PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.24.1.1: PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST content",
                                    "table number": 41,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.25\tProSe additional parameters announcement response",
                            "text_content": "This message is sent by the 5G ProSe layer-3 UE-to-network relay UE to the 5G ProSe layer-3 remote UE to acknowledge and respond to the ProSe additional parameters announcement request. See table 10.3.25.1.1.\nMessage type:\tPROSE ADDITIONAL PARAMETERS ANNOUNCEMENT RESPONSE\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.25.1.1: PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT RESPONSE content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.25.1.1: PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT RESPONSE content",
                                    "table number": 42,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.26\tProSe AA message transport request",
                            "text_content": "This message is sent by:\na)\tthe 5G ProSe UE-to-network relay UE to the 5G ProSe remote UE; or\nb)\tthe 5G ProSe UE-to-UE relay UE to the 5G ProSe end UE;\nto forward the EAP message. See table 10.3.26.1.1.\nMessage type:\tPROSE AA MESSAGE TRANSPORT REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.26.1.1: PROSE AA MESSAGE TRANSPORT REQUEST content\n\nThe EAP message IE is included if the PROSE AA MESSAGE TRANSPORT REQUEST message is used in an EAP based authentication procedure.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.26.1.1: PROSE AA MESSAGE TRANSPORT REQUEST content",
                                    "table number": 43,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.27\tProSe AA message transport response",
                            "text_content": "This message is sent by:\na)\tthe 5G ProSe remote UE to the 5G ProSe UE-to-network relay UE; or\nb)\tthe 5G ProSe end UE to the 5G ProSe UE-to-UE relay UE;\nto forward the EAP message. See table 10.3.27.1.1.\nMessage type:\tPROSE AA MESSAGE TRANSPORT RESPONSE\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.27.1.1: PROSE AA MESSAGE TRANSPORT RESPONSE content\n\nThe EAP message IE is included if the PROSE AA MESSAGE TRANSPORT RESPONSE message is used in an EAP based authentication procedure.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.27.1.1: PROSE AA MESSAGE TRANSPORT RESPONSE content",
                                    "table number": 44,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.28\tProSe UE to UE relay update request",
                            "text_content": "This message is sent by a 5G ProSe layer-3 UE-to-UE relay UE which is handling communication between a source end UE and a target end UE to initiate the relay update procedure. See table 10.3.28.1.1.\nMessage type:\tPROSE UE TO UE RELAY UPDATE REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.28.1.1: PROSE UE TO UE RELAY UPDATE REQUEST message content\n\nThis IE shall be included if IP communication is used and the link local IPv6 address changes at the source end UE.\nThis IE shall be included if IP communication is used and the link local IPv6 address changes at the source end UE.\nThis IE shall be included if the source end UE application layer ID changes.\nThis IE shall be included if the source end UE application layer ID changes.\nEditor’s Note: Security related IE will be added based on SA3 normative requirements.\nEditor’s Note: whether Old Source end UE IPv6 address and New Source end UE IPv6 address IEs are mandatory or optional is FFS.\nThis IE is included when the 5G ProSe layer-3 UE-to-UE relay UE receives the Source user info IE in the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message. This IE contains the initiating UE’s user info associated to the direct link with the 5G ProSe layer-3 UE-to-UE relay UE.\nThis IE is included when the 5G ProSe layer-3 UE-to-UE relay UE receives the Source user info IE in the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message. This IE contains the new initiating UE’s user info specified in the Source user info IE in the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.28.1.1: PROSE UE TO UE RELAY UPDATE REQUEST message content",
                                    "table number": 45,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.29\tProSe UE to UE relay update accept",
                            "text_content": "This message is sent by the target end UE to 5G ProSe layer-3 UE-to-UE relay UE to complete the relay update procedure. See table 10.3.29.1.1.\nMessage type:\tPROSE UE TO UE RELAY UPDATE ACCEPT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.29.1.1: PROSE UE TO UE RELAY UPDATE ACCEPT message content\nThis IE shall be included if the 5G ProSe target end UE receives the Old source end UE IPv6 address IE in the PROSE UE TO UE RELAY UPDATE REQUEST message.\nThis IE shall be included if the 5G ProSe target end UE receives the New source end UE IPv6 address IE in the PROSE UE TO UE RELAY UPDATE REQUEST message.\nThis IE shall be included if the 5G ProSe target end UE receives the Old Source end UE user info IE in the PROSE UE TO UE RELAY UPDATE REQUEST message.\nThis IE shall be included if the 5G ProSe target end UE receives the New source end UE user info IE in the PROSE UE TO UE RELAY UPDATE REQUEST message.\nEditor’s Note: Security related IE will be added based on SA3 normative requirements.\nEditor’s Note: whether Old Source end UE IPv6 address and New Source end UE IPv6 address IEs are mandatory or optional is FFS.\nThis IE is included when the Target UE receives the Old Source user info IE in the PROSE UE TO UE RELAY UPDATE REQUEST message.\nThis IE is included when the Target UE receives the New Source user info IE in the PROSE UE TO UE RELAY UPDATE REQUEST message.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.29.1.1: PROSE UE TO UE RELAY UPDATE ACCEPT message content",
                                    "table number": 46,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.30\tProSe path switching request",
                            "text_content": "This message is sent by the UE that requires to initiate the path switching procedure from the direct communication path over PC5 to the direct communication path over Uu. See table 10.3.30.1.1.\nMessage type:\tPROSE PATH SWITCHING REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.30.1.1: PROSE PATH SWITCHING REQUEST content\nThe Uu QoS flow descriptions IE is included if the initiating UE derives the requested QoS flow description based on the PC5 QoS parameters of the PC5 QoS flow(s) between the initiating UE and the target UE.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.30.1.1: PROSE PATH SWITCHING REQUEST content",
                                    "table number": 47,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.31\tProSe path switching accept",
                            "text_content": "This message is sent by the UE to another peer UE to indicate that the ProSe path switching request is accepted. See table 10.3.31.1.1.\nMessage type:\tPROSE PATH SWITCHING ACCEPT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.31.1.1: PROSE PATH SWITCHING ACCEPT content\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.31.1.1: PROSE PATH SWITCHING ACCEPT content",
                                    "table number": 48,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.32\tProSe path switching reject",
                            "text_content": "This message is sent by the target UE to initiating UE to indicate that the ProSe path switching request is not accepted. See table 10.3.Z.1.1.\nMessage type:\tPROSE PATH SWITCHING REJECT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.32.1.1: PROSE PATH SWITCHING REJECT content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.32.1.1: PROSE PATH SWITCHING REJECT content",
                                    "table number": 49,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.33\tProSe UE to UE relay update reject",
                            "text_content": "This message is sent by the target 5G ProSe end UE to 5G ProSe layer-3 UE-to-UE relay UE to reject the relay update procedure. See table 10.3.33.1.1.\nMessage type:\tPROSE UE TO UE RELAY UPDATE REJECT\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.33.1.1: PROSE UE TO UE RELAY UPDATE REJECT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.33.1.1: PROSE UE TO UE RELAY UPDATE REJECT message content",
                                    "table number": 50,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.34\tProSe direct link identity request",
                            "text_content": "This message is sent by the 5G ProSe UE-to-network relay UE to the 5G ProSe remote UE to request the 5G ProSe remote UE to provide specified identity. See table 10.3.34.1.1.\nMessage type:\tPROSE DIRECT LINK IDENTITY REQUEST\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.34.1.1: PROSE DIRECT LINK IDENTITY REQUEST message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.34.1.1: PROSE DIRECT LINK IDENTITY REQUEST message content",
                                    "table number": 51,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.3.35\tProSe direct link identity response",
                            "text_content": "This message is sent by the 5G ProSe remote UE to the 5G ProSe UE-to-network relay UE to provide the requested identity. See table 10.3.35.1.1.\nMessage type:\tPROSE DIRECT LINK IDENTITY RESPONSE\nSignificance:\tdual\nDirection:\tUE to peer UE\nTable 10.3.35.1.1: PROSE DIRECT LINK IDENTITY RESPONSE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.3.35.1.1: PROSE DIRECT LINK IDENTITY RESPONSE message content",
                                    "table number": 52,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "10.4\tProvisioning of 5G ProSe configuration information signalling messages",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.4.1\tUE policy provisioning request",
                            "text_content": "The UE POLICY PROVISIONING REQUEST message is sent by the UE to the PCF to request the PCF to manage ProSeP, see 3GPP TS 24.587 [18] clause 7.2.1 for the message definition.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.4.2\tUE policy provisioning reject",
                            "text_content": "The UE POLICY PROVISIONING REJECT message is sent by the PCF to the UE to report that the PCF rejects the request to manage ProSeP, see 3GPP TS 24.587 [18] clause 7.2.2 for the message definition.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.5\t5G ProSe discovery and security messages over PC3a",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.5.1\tGeneral",
                            "text_content": "This clause defines the XML schema and MIME type related to 5G ProSe direct discovery messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.5.2\tapplication/vnd.3gpp-prose-pc3a+xml",
                            "text_content": "The MIME type is used to carry information related to the 5G ProSe discovery operation. It shall be coded as an XML document containing one of the following 5G ProSe discovery messages:\na)\tDISCOVERY_REQUEST;\nb)\tDISCOVERY_RESPONSE;\nc)\tMATCH_REPORT;\nd)\tMATCH_REPORT_ACK;\ne)\tDISCOVERY_UPDATE_REQUEST;\nf)\tDISCOVERY_UPDATE_RESPONSE;\ng)\tANNOUNCING_ALERT_REQUEST;\nh)\tANNOUNCING_ALERT_RESPONSE;\ni)\tPROSE_5GPKMF_ADDRESS_REQUEST;\nj)\tPROSE_5GPKMF_ADDRESS_RESPONSE;\nk)\tPROSE_SECURITY_MATERIAL_REQUEST; or\nl)\tPROSE_SECURITY_MATERIAL_RESPONSE\nEach of those messages is presented in the XML document as an XML element named after the corresponding message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.5.3\tXML schema",
                            "text_content": "Implementations in compliance with the present document shall implement the XML schema defined below for messages used in 5G ProSe direct discovery procedures over PC3a interface.\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nxmlns=\"urn:3GPP:ns:5GProSe:Discovery:2021\"\nelementFormDefault=\"qualified\"\ntargetNamespace=\"urn:3GPP:ns:5GProSe:Discovery:2021\">\n<xs:annotation>\n<xs:documentation>\nInfo for 5G ProSe Discovery Control Messages Syntax\n</xs:documentation>\n</xs:annotation>\n\n\n<!-- Complex types defined for parameters with complicated structure -->\n\n<xs:complexType name=\"AppID-info\">\n<xs:sequence>\n<xs:element name=\"OS-ID\">\n<xs:simpleType>\n<xs:restriction base=\"xs:hexBinary\">\n<xs:length value=\"16\"/>\n</xs:restriction>\n</xs:simpleType>\n</xs:element>\n<xs:element name=\"OS-App-ID\" type=\"xs:string\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PLMN-info\">\n<xs:sequence>\n<xs:element name=\"mcc\" type=\"xs:integer\"/>\n<xs:element name=\"mnc\" type=\"xs:integer\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PLMN-list-type\">\n<xs:sequence>\n<xs:element name=\"PLMN\" type=\"PLMN-info\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"DiscFilter-info\">\n<xs:sequence>\n<xs:element name=\"ProSe-Application-Code\" type=\"xs:hexBinary\"/>\n<xs:element name=\"ProSe-Application-Mask\" type=\"xs:hexBinary\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"TTL-timer-T5064\" type=\"xs:integer\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"MatchingFilter-info\">\n<xs:sequence>\n<xs:element name=\"Code\" type=\"xs:hexBinary\"/>\n<xs:element name=\"Mask\" type=\"xs:hexBinary\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"DUCK-info\">\n<xs:sequence>\n<xs:element name=\"discovery-user-confidentiality-key\" type=\"xs:hexBinary\"/>\n<xs:element name=\"encrypted-bitmask\" type=\"xs:hexBinary\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<xs:complexType name=\"RestrictedDiscFilter-info\">\n<xs:sequence>\n<xs:element name=\"filter\" type=\"MatchingFilter-info\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"TTL-timer-T5066\" type=\"xs:integer\"/>\n<xs:element name=\"RPAUID\" type=\"xs:string\" minOccurs=\"0\" />\n<xs:element name=\"metadata-indicator\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"metadata\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"RestrictedCodeSuffixRange-info\">\n<xs:sequence>\n<xs:element name=\"beginning-suffix-code\" type=\"xs:hexBinary\" />\n<xs:element name=\"ending-suffix-code\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<xs:complexType name=\"RestrictedMonitoringUpdate-info\">\n<xs:sequence>\n<xs:element name=\"updated-filter\" type=\"RestrictedDiscFilter-info\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<xs:complexType name=\"RestrictedAnnouncingUpdate-info\">\n<xs:sequence>\n<xs:element name=\"ProSe-Restricted-Code\" type=\"xs:hexBinary\" />\n<xs:element name=\"validity-timer-T5062\" type=\"xs:integer\" />\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"MonitoringUpdate-info\">\n<xs:sequence>\n<xs:element name=\"updated-filter\" type=\"DiscFilter-info\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"AnnouncingUpdate-info\">\n<xs:sequence>\n<xs:element name=\"ProSe-Application-Code\" type=\"xs:hexBinary\" />\n<xs:element name=\"validity-timer-T5060\" type=\"xs:integer\" />\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Update-Option-info\">\n<xs:choice>\n<xs:element name=\"update-info-restricted-announce\" type=\"RestrictedAnnouncingUpdate-info\" />\n<xs:element name=\"update-info-restricted-monitor\" type=\"RestrictedMonitoringUpdate-info\" />\n<xs:element name=\"update-info-open-annnounce\" type=\"AnnouncingUpdate-info\" />\n<xs:element name=\"update-info-open-monitor\" type=\"MonitoringUpdate-info\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" />\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n</xs:choice>\n</xs:complexType>\n\n<xs:complexType name=\"Restricted-Code-Option-info\">\n<xs:choice>\n<xs:element name=\"ProSe-Restricted-Code\" type=\"xs:hexBinary\" />\n<xs:element name=\"ProSe-Response-Code\" type=\"xs:hexBinary\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" />\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n</xs:choice>\n</xs:complexType>\n\n\n<xs:complexType name=\"Subquery-info\">\n<xs:sequence>\n<xs:element name=\"ProSe-Rquery-Code\" type=\"xs:hexBinary\" />\n<xs:element name=\"response-filter\" type=\"MatchingFilter-info\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"validity-timer-T5070\" type=\"xs:integer\"/>\n<xs:element name=\"code-sending-security-parameter\" type=\"Restricted-Security-info\" />\n<xs:element name=\"code-receiving-security-parameter\" type=\"Restricted-Security-info\" minOccurs=\"0\" />\n<xs:element name=\"RPAUID\" type=\"xs:string\" minOccurs=\"0\" />\n<xs:element name=\"metadata\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<xs:complexType name=\"Restricted-Security-info\">\n<xs:sequence>\n<xs:element name=\"DUSK\" type=\"xs:hexBinary\" minOccurs=\"0\" />\n<xs:element name=\"DUIK\" type=\"xs:hexBinary\" minOccurs=\"0\" />\n<xs:element name=\"DUCK\" type=\"DUCK-info\" minOccurs=\"0\" />\n<xs:element name=\"MIC-check-indicator\" type=\"xs:boolean\" minOccurs=\"0\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"ApplicationCodeSuffixRange-info\">\n<xs:sequence>\n<xs:element name=\"beginning-suffix-code\" type=\"xs:hexBinary\" />\n<xs:element name=\"ending-suffix-code\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"ProSeApplicationCodeACE-info\">\n<xs:sequence>\n<xs:element name=\" ProSe-Application-Code-Prefix\" type=\"xs:hexBinary\" />\n<xs:element name=\" ProSe-Application-Code-Suffix-Range\" type=\"ApplicationCodeSuffixRange-info\" maxOccurs=\"unbounded\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PC5-Security-Policies-info\">\n<xs:sequence>\n<xs:element name=\"signalling-integrity-protection-policy\" type=\"xs:integer\"/>\n<xs:element name=\"signalling-ciphering-policy\" type=\"xs:integer\"/>\n<xs:element name=\"user-plane-integrity-protection-policy\" type=\"xs:integer\"/>\n<xs:element name=\"user-plane-ciphering-policy\" type=\"xs:integer\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"requested-for-type\">\n<xs:sequence>\n<xs:element name=\"remote-UE\" type=\"empty-type\" minOccurs=\"0\"/>\n<xs:element name=\"UNR\" type=\"empty-type\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PC5-security-policies-type\">\n<xs:sequence>\n<xs:element name=\"signalling-ciphering-policy\" type=\"xs:integer\"/>\n<xs:element name=\"user-plane-integrity-protection-policy\" type=\"xs:integer\"/>\n<xs:element name=\"user-plane-ciphering-policy\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"security-parameters-for-remote-UE-type\">\n<xs:sequence>\n<xs:element name=\"expiration-timer\" type=\"xs:integer\"/>\n<xs:element name=\"code-receiving-security-parameters-for-model-A\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"code-receiving-security-parameters-for-model-B\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"code-sending-security-parameters-for-model-B\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"selected-PC5-ciphering-algorithm\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"security-parameters-for-UNR-type\">\n<xs:sequence>\n<xs:element name=\"expiration-timer\" type=\"xs:integer\"/>\n<xs:element name=\"code-sending-security-parameters-for-model-A\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"code-receiving-security-parameters-for-model-B\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"code-sending-security-parameters-for-model-B\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"selected-PC5-ciphering-algorithm\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"code-sending-or-receiving-security-parameters-type\">\n<xs:sequence>\n<xs:element name=\"DUSK\" type=\"xs:hexBinary\" minOccurs=\"0\" />\n<xs:element name=\"DUIK\" type=\"xs:hexBinary\" minOccurs=\"0\" />\n<xs:element name=\"DUCK\" type=\"DUCK-type\" minOccurs=\"0\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"DUCK-type\">\n<xs:sequence>\n<xs:element name=\"discovery-user-confidentiality-key\" type=\"xs:hexBinary\"/>\n<xs:element name=\"encrypted-bitmask\" type=\"xs:hexBinary\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<!-- Complex types defined for transaction-level -->\n\n<xs:complexType name=\"AnnounceRsp-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"ProSe-Application-Code\" type=\"xs:hexBinary\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"ProSe-Application-Code-ACE\" type=\"ProSeApplicationCodeACE-info\" minOccurs=\"0\"/>\n<xs:element name=\"validity-timer-T5060\" type=\"xs:integer\" minOccurs=\"0\" />\n<xs:element name=\"discovery-key\" type=\"xs:hexBinary\" minOccurs=\"0\" />\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\" minOccurs=\"0\" />\n<xs:element name=\"ACE-enabled-indicator\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"MonitorRsp-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"discovery-filter\" type=\"DiscFilter-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\" minOccurs=\"0\" />\n<xs:element name=\"ACE-enabled-indicator\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<xs:complexType name=\"DiscReq-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"command\" type=\"xs:integer\"/>\n<xs:element name=\"ProSe-Application-ID\" type=\"xs:string\"/>\n<xs:element name=\"application-identity\" type=\"AppID-info\"/>\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\" minOccurs=\"0\" />\n<xs:element name=\"Requested-Timer\" type=\"xs:integer\" minOccurs=\"0\" />\n<xs:element name=\"metadata\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"Announcing-PLMN-ID\" type=\"PLMN-info\" minOccurs=\"0\" />\n<xs:element name=\"ACE-enabled-indicator\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"RestrictedDiscReq-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"command\" type=\"xs:integer\"/>\n<xs:element name=\"RPAUID\" type=\"xs:string\"/>\n<xs:element name=\"application-identity\" type=\"AppID-info\"/>\n<xs:element name=\"discovery-type\" type=\"xs:integer\"/>\n<xs:element name=\"PC5-UE-ciphering-algorithm-capability\" type=\"xs:integer\"/>\n<xs:element name=\"ACE-enabled-indicator\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"announcing-type\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"application-level-container\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"discovery-model\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"Announcing-PLMN-ID\" type=\"PLMN-info\" minOccurs=\"0\" />\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\"/>\n<xs:element name=\"Requested-Timer\" type=\"xs:integer\" minOccurs=\"0\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"RestrictedAnnounceRsp-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"ProSe-Restricted-Code\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"ProSe-Restricted-Code-Suffix-Range\" type=\"RestrictedCodeSuffixRange-info\" minOccurs=\"0\"/>\n<xs:element name=\"validity-timer-T5062\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"ACE-enabled-indicator\" type=\"xs:integer\" minOccurs=\"0\" />\n<xs:element name=\"code-sending-security-parameter\" type=\"Restricted-Security-info\" />\n<xs:element name=\"selected-PC5-ciphering-algorithm\" type=\"xs:integer\"/>\n<xs:element name=\"on-demand-announcing-enabled-indicator\" type=\"xs:boolean\" minOccurs=\"0\" />\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\"/>\n<xs:element name=\"PC5-security-policies\" type=\"xs:PC5-Security-Policies-info\" minOccurs=\"0\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"RestrictedMonitorRsp-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"restricted-discovery-filter\" type=\"RestrictedDiscFilter-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"ACE-enabled-indicator\" type=\"xs:integer\" minOccurs=\"0\" />\n<xs:element name=\"application-level-container\" type=\"xs:hexBinary\"/>\n<xs:element name=\"code-receiving-security-parameter\" type=\"Restricted-Security-info\" minOccurs=\"0\" />\n<xs:element name=\"selected-PC5-ciphering-algorithm\" type=\"xs:integer\"/>\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\"/>\n<xs:element name=\"PC5-security-policies\" type=\"xs:PC5-Security-Policies-info\" minOccurs=\"0\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<xs:complexType name=\"RestrictedDiscovereeRsp-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"ProSe-Response-Code\" type=\"xs:hexBinary\" />\n<xs:element name=\"query-filter\" type=\"MatchingFilter-info\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"validity-timer-T5068\" type=\"xs:integer\"/>\n<xs:element name=\"code-sending-security-parameter\" type=\"Restricted-Security-info\" />\n<xs:element name=\"code-receiving-security-parameter\" type=\"Restricted-Security-info\" minOccurs=\"0\" />\n<xs:element name=\"selected-PC5-ciphering-algorithm\" type=\"xs:integer\"/>\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\"/>\n<xs:element name=\"PC5-security-policies\" type=\"xs:PC5-Security-Policies-info\" minOccurs=\"0\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"RestrictedDiscovererRsp-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"subquery-result\" type=\"Subquery-info\" minOccurs=\"1\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"code-sending-security-parameter\" type=\"Restricted-Security-info\" />\n<xs:element name=\"code-receiving-security-parameter\" type=\"Restricted-Security-info\" minOccurs=\"0\" />\n<xs:element name=\"selected-PC5-ciphering-algorithm\" type=\"xs:integer\"/>\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\"/>\n<xs:element name=\"PC5-security-policies\" type=\"xs:PC5-Security-Policies-info\" minOccurs=\"0\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"RejectRsp-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"PC3a-control-protocol-cause-value\" type=\"xs:integer\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"UE-RejectRsp-info\">\n<xs:sequence>\n<xs:element name=\"DDNMF-transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"PC3a-control-protocol-cause-value\" type=\"xs:integer\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"MatchRep-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"ProSe-PC5-discovery-message\" type=\"xs:hexBinary\"/>\n<xs:element name=\"Monitored-PLMN-ID\" type=\"PLMN-info\"/>\n<xs:element name=\"VPLMN-ID\" type=\"PLMN-info\" minOccurs=\"0\"/>\n<xs:element name=\"UTC-based-counter\" type=\"xs:hexBinary\"/>\n<xs:element name=\"Metadata-flag\" type=\"xs:boolean\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"RestrictedMatch-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"discovery-type\" type=\"xs:integer\"/>\n<xs:element name=\"application-identity\" type=\"AppID-info\"/>\n<xs:element name=\"RPAUID\" type=\"xs:string\"/>\n<xs:element name=\"Restricted-Code-Discovered\" type=\"Restricted-Code-Option-info\" minOccurs=\"0\"/>\n<xs:element name=\"ProSe-PC5-discovery-message\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"UTC-based-counter\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"Metadata-flag\" type=\"xs:boolean\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"MatchAck-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"ProSe-Application-ID\" type=\"xs:string\"/>\n<xs:element name=\"validity-timer-T5072\" type=\"xs:integer\"/>\n<xs:element name=\"UTC-based-counter\" type=\"xs:hexBinary\"/>\n<xs:element name=\"metadata\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"metadata-index-mask\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"match-report-refresh-timer-T5074\" type=\"xs:integer\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<xs:complexType name=\"RestrictedMatchAck-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"application-identity\" type=\"AppID-info\"/>\n<xs:element name=\"RPAUID\" type=\"xs:string\"/>\n<xs:element name=\"validity-timer-T5076\" type=\"xs:integer\"/>\n<xs:element name=\"UTC-based-counter\" type=\"xs:hexBinary\"/>\n<xs:element name=\"metadata\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"match-report-refresh-timer-T5077\" type=\"xs:integer\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"MatchReject-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"PC3a-control-protocol-cause-value\" type=\"xs:integer\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"DiscUpdateReq-info\">\n<xs:sequence>\n<xs:element name=\"DDNMF-transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\"/>\n<xs:element name=\"update-info\" type=\"Update-Option-info\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"DiscUpdateRsp-info\">\n<xs:sequence>\n<xs:element name=\"DDNMF-transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"AnnouncingAlertReq-info\">\n<xs:sequence>\n<xs:element name=\"DDNMF-transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"RPAUID\" type=\"xs:string\"/>\n<xs:element name=\"discovery-entry-ID\" type=\"xs:integer\"/>\n<xs:element name=\"ProSe-Restricted-Code\" type=\"xs:hexBinary\"/>\n<xs:element name=\"ProSe-Restricted-Code-Suffix-Range\" type=\"RestrictedCodeSuffixRange-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"AnnouncingAlertRsp-info\">\n<xs:sequence>\n<xs:element name=\"DDNMF-transaction-ID\" type=\"xs:integer\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PKMFAddrReq-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PKMFAddrRsp-info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"PKMF-address\" type=\"xs:string\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"UNR-discovery-security-parameters-request-type\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"requested-for\" type=\"requested-for-type\"/>\n<xs:element name=\"PC5-UE-security-capabilities\" type=\"xs:integer\"/>\n<xs:element name=\"relay-service-code\" type=\"xs:integer\"/>\n<xs:element name=\"VPLMN-list\" type=\"PLMN-list-type\" minOccurs=\"0\"/>\n<xs:element name=\"discovery-model\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"UNR-discovery-security-parameters-accept-type\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"security-parameters-for-remote-UE\" type=\"security-parameters-for-remote-UE-type\"  minOccurs=\"0\"/>\n<xs:element name=\"PC5-security-policies-for-remote-UE\" type=\"PC5-Security-Policies-info\" minOccurs=\"0\"/>\n<xs:element name=\"security-parameters-for-UNR\" type=\"security-parameters-for-UNR-type\"  minOccurs=\"0\"/>\n<xs:element name=\"PC5-security-policies-for-UNR\" type=\"PC5-Security-Policies-info\" minOccurs=\"0\"/>\n<xs:element name=\"Current-Time\" type=\"xs:dateTime\"/>\n<xs:element name=\"Max-Offset\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!-- Complex types defined for Message-level -->\n\n<xs:complexType name=\"prose-direct-discovery-request\">\n<xs:sequence>\n<xs:element name=\"discovery-request\" type=\"DiscReq-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"restricted-discovery-request\" type=\"RestrictedDiscReq-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"network-initiated-transaction-method\" type=\"xs:integer\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-direct-discovery-response\">\n<xs:sequence>\n<xs:element name=\"Current-Time\" type=\"xs:dateTime\"/>\n<xs:element name=\"Max-Offset\" type=\"xs:integer\"/>\n<xs:element name=\"response-announce\" type=\"AnnounceRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"response-monitor\" type=\"MonitorRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"restricted-announce-response\" type=\"RestrictedAnnounceRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"restricted-monitor-response\" type=\"RestrictedMonitorRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"restricted-discoveree-response\" type=\"RestrictedDiscovereeRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"restricted-discoverer-response\" type=\"RestrictedDiscovererRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"response-reject\" type=\"RejectRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"network-initiated-transaction-method\" type=\"xs:integer\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-direct-discovery-update-request\">\n<xs:sequence>\n<xs:element name=\"discovery-update-request\" type=\"DiscUpdateReq-info\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-direct-discovery-update-response\">\n<xs:sequence>\n<xs:element name=\"response-update\" type=\"DiscUpdateRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"response-reject\" type=\"UE-RejectRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-direct-discovery-match-report\">\n<xs:sequence>\n<xs:element name=\"match-report\" type=\"MatchRep-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"restricted-match\" type=\"RestrictedMatch-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-direct-discovery-match-report-ack\">\n<xs:sequence>\n<xs:element name=\"Current-Time\" type=\"xs:dateTime\"/>\n<xs:element name=\"match-ack\" type=\"MatchAck-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"match-reject\" type=\"MatchReject-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"restricted-match-ack\" type=\"RestrictedMatchAck-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-direct-discovery-announcing-alert-request\">\n<xs:sequence>\n<xs:element name=\"announcing-alert-request\" type=\"AnnouncingAlertReq-info\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-direct-discovery-announcing-alert-response\">\n<xs:sequence>\n<xs:element name=\"announcing-alert-response\" type=\"AnnouncingAlertRsp-info\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"response-reject\" type=\"UE-RejectRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-5gpkmf-address-request\">\n<xs:sequence>\n<xs:element name=\"PKMF-address-request\" type=\"PKMFAddrReq-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-5gpkmf-address-response\">\n<xs:sequence>\n<xs:element name=\"PKMF-address-response\" type=\"PKMFAddrRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"PKMF-address-reject\" type=\"RejectRsp-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-security-material-request\">\n<xs:sequence>\n<xs:element name=\"UNR-discovery-security-parameters-request\" type=\"UNR-discovery-security-parameters-request-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"prose-security-material-response\">\n<xs:sequence>\n<xs:element name=\"UNR-discovery-security-parameters-accept\" type=\"UNR-discovery-security-parameters-accept-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"UNR-discovery-security-parameters-reject\" type=\"reject-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<!--  extension allowed -->\n<xs:complexType name=\"DiscMsgExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!--  XML attribute for any future extensions  -->\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n\n\n<!--  Top level discovery message definition  -->\n<xs:element name=\"prose-discovery-message\">\n<xs:complexType>\n<xs:choice>\n<xs:element name=\"DISCOVERY_REQUEST\" type=\"prose-direct-discovery-request\"/>\n<xs:element name=\"DISCOVERY_RESPONSE\" type=\"prose-direct-discovery-response\"/>\n<xs:element name=\"MATCH_REPORT\" type=\"prose-direct-discovery-match-report\"/>\n<xs:element name=\"MATCH_REPORT_ACK\" type=\"prose-direct-discovery-match-report-ack\"/>\n<xs:element name=\"DISCOVERY_UPDATE_REQUEST\" type=\"prose-direct-discovery-update-request\"/>\n<xs:element name=\"DISCOVERY_UPDATE_RESPONSE\" type=\"prose-direct-discovery-update-response\"/>\n<xs:element name=\"ANNOUNCING_ALERT_REQUEST\" type=\"prose-direct-discovery-announcing-alert-request\"/>\n<xs:element name=\"ANNOUNCING_ALERT_RESPONSE\" type=\"prose-direct-discovery-announcing-alert-response\"/>\n<xs:element name=\"PROSE_5GPKMF_ADDRESS_REQUEST\" type=\"prose-5gpkmf-address-request\"/>\n<xs:element name=\"PROSE_5GPKMF_ADDRESS_RESPONSE\" type=\"prose-5gpkmf-address-response\"/>\n<xs:element name=\"PROSE_SECURITY_MATERIAL_REQUEST\" type=\"prose-security-material-request\"/>\n<xs:element name=\"PROSE_SECURITY_MATERIAL_RESPONSE\" type=\"prose-security-material-response\"/>\n\n<xs:element name=\"message-ext\" type=\"DiscMsgExtType\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n</xs:choice>\n</xs:complexType>\n</xs:element>\n\n</xs:schema>\n\nAn entity receiving the XML body ignores any unknown XML element and any unknown XML attribute.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.5.4\tSemantics",
                            "text_content": "The <prose-discovery-message> element is the root element of this XML document and it can be one of the following elements:\na)\t<DISCOVERY_REQUEST>;\nb)\t<DISCOVERY_RESPONSE>;\nc)\t<MATCH_REPORT>;\nd)\t<MATCH_REPORT_ACK>;\ne)\t<DISCOVERY_UPDATE_REQUEST>;\nf)\t<DISCOVERY_UPDATE_RESPONSE>\ng)\t<ANNOUNCE_ALERT_REQUEST>;\nh)\t<ANNOUNCE_ALERT_RESPONSE>;\ni)\t<PROSE_5GPKMF_ADDRESS_REQUEST>;\nj)\t<PROSE_5GPKMF_ADDRESS_RESPONSE>;\nk)\t<PROSE_SECURITY_MATERIAL_REQUEST>;\nl)\t<PROSE_SECURITY_MATERIAL_RESPONSE>;\nm)\t<message-ext> element containing other discovery message defined in future releases; or\nn)\tan element from other namespaces defined in future releases.\nThe <DISCOVERY_REQUEST> element contains one or more of the following elements:\na)\tzero, one or more <discovery-request> element which contains transactions sent from the UE to the 5G DDNMF as announcing or monitoring requests for open 5G ProSe direct discovery. Each <discovery-request> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <command> element containing the parameter defined in clause 11.4.2.2;\n3)\ta <Prose-Application-ID> element containing the parameter defined in clause 11.4.2.4;\n4)\tan <application-identity> element containing the parameter defined in clause 11.4.2.5;\n5)\ta <Discovery-Entry-ID> element containing the parameter defined in clause 11.4.2.26;\n6)\tan optional <Requested-Timer> element containing the parameter defined in clause 11.4.2.20;\n7)\tan optional <metadata> element containing the parameter defined in clause 11.4.2.15;\n8)\tan optional <Announcing-PLMN-ID> element containing the parameter defined in clause 11.4.2.43;\n9)\tzero or one <ACE-enabled-indicator> element containing the parameter defined in clause 11.4.2.31;\n10)\tzero or one <anyExt> element containing elements defined in future releases;\n11)\tzero, one or more elements from other namespaces defined in future releases; and\n12)\tzero, one or more attributes defined in future releases;\nb)\tzero, one, or more <restricted-discovery-request> element which contains transactions sent from the UE to the 5G DDNMF as announcing or monitoring requests for restricted 5G ProSe directed discovery model A or transactions sent from the UE to the 5G DDNMF as discoveree or discoverer requests for restricted 5G ProSe directed discovery model B. Each <restricted-discovery-request> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <command> element containing the parameter defined in clause 11.4.2.2;\n3)\ta <RPAUID> element containing the parameter defined in clause 11.4.2.23;\n4)\tan <application-identity> element containing the parameter defined in clause 11.4.2.5;\n5)\ta <discovery-type> element containing the parameter defined in clause 11.4.2.18;\n6)\tzero or one <ACE-enabled-indicator> element containing the parameter defined in clause 11.4.2.31;\n7)\tan <announcing-type> element containing the parameter defined in clause 11.4.2.24;\n8)\tan <application-level-container> element containing the parameter defined in clause 11.4.2.25;\n9)\tzero or one <discovery-model> element containing the parameter defined in clause 11.4.2.34;\n10)\tzero or one <Announcing-PLMN-ID> element containing the parameter defined in clause 11.4.2.43;\n11)\ta <discovery-entry-id> element containing the parameter defined in clause 11.4.2.26;\n12)\tan optional <Requested-Timer> element containing the parameter defined in clause 11.4.2.20;\n13)\ta <PC5-UE-ciphering-algorithm-capability> element containing the parameter defined in clause 11.4.2.50;\n14)\tzero or one <anyExt> element containing elements defined in future releases;\n15)\tzero, one or more elements from other namespaces defined in future releases; and\n16)\tzero, one or more attributes defined in future releases;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases;\ne)\tan optional \"network-initiated transaction method\" attribute containing the parameter defined in clause 11.4.2.42; and\nf)\tzero, one or more attributes defined in future releases.\nThe <DISCOVERY_RESPONSE> element contains one or more of the following elements:\na)\ta <Current-Time> element containing the parameter defined in clause 11.4.2.16;\nb)\ta <Max-Offset> element containing the parameter defined in clause 11.4.2.17;\nc)\tzero, one or more <response-announce> element which contains transactions sent from the 5G DDNMF to the UE as a response to an announcing request if the 5G DDNMF accepts the request. Each <response-announce> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\tzero, one or more <ProSe-Application-Code> elements containing the parameter defined in clause 11.4.2.6;\n3)\tzero or one <ProSe application code-ACE> element containing the parameter defined in clause 11.4.2.45;\n4)\tzero, or one <validity-timer-T5060> element containing the parameter defined in 11.4.2.7;\n5)\tzero, or, one <discovery-key> element containing the parameter defined in clause 11.4.2.48;\n6)\ta <discovery-entry-ID> element containing the parameter defined in clause 11.4.2.26;\n7)\tzero or one <ACE-enabled-indicator> element containing the parameter defined in clause 11.4.2.31;\n8)\tzero or one <anyExt> element containing elements defined in future releases;\n9)\tzero, one or more elements from other namespaces defined in future releases; and\n10)\tzero, one or more attributes defined in future releases;\nd)\tzero, one or more <response-monitor> element which contains transactions sent from the 5G DDNMF to the UE as a response to a monitoring request if the 5G DDNMF accepts the request. Each <response-monitor> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\tzero, one or more <discovery-filter> elements containing the parameter defined in clause 11.4.2.9;\n3)\ta <discovery-entry-ID> element containing the parameter defined in clause 11.4.2.26;\n4)\tzero or one <ACE-enabled-indicator> element containing the parameter defined in clause 11.4.2.31;\n5)\tzero or one <anyExt> element containing elements defined in future releases;\n6)\tzero, one or more elements from other namespaces defined in future releases; and\n7)\tzero, one or more attributes defined in future releases;\ne)\tzero, one or more <restricted-announce-response> element which contains transactions sent from the 5G DDNMF to the UE as a response to an announcing request for restricted 5G ProSe direct discovery model A if the 5G DDNMF accepts the request. Each <restricted-announce-response> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\tzero or one <ProSe-Restricted-Code> element containing the parameter defined in clause 11.4.2.27;\n3)\tzero, one or more <ProSe-Restricted-Code-Suffix-Range> element containing the parameter defined in clause 11.4.2.28;\n4)\tzero or one <validity-timer-T5062> element containing the parameter defined in 11.4.2.32;\n5)\tzero or one <ACE-enabled-indicator> element containing the parameter defined in clause 11.4.2.31;\n6)\ta <code-sending-security-parameter> element containing the parameter defined in clause 11.4.2.33;\n7)\tzero or one <on-demand-announcing-enabled-indicator> element containing the parameter defined in clause 11.4.2.29;\n8)\ta <discovery-entry-id> element containing the parameter defined in clause 11.4.2.26;\n9)\ta <selected-PC5-ciphering-algorithm> element containing the parameter defined in clause 11.4.2.51;\n10)\tzero or one <PC5-security-policies> element containing the parameter defined in clause 11.4.2.49;\n11)\tzero or one <anyExt> element containing elements defined in future releases;\n12)\tzero, one or more elements from other namespaces defined in future releases; and\n13)\tzero, one or more attributes defined in future releases;\nf)\tzero, one or more <restricted-monitor-response> element which contains transactions sent from the 5G DDNMF to the UE as a response to a monitoring request for restricted 5G ProSe direct discovery model A if the 5G DDNMF accepts the request. Each <restricted-monitor-response> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\tone or more <restricted-discovery-filter> elements containing the parameter defined in clause 11.4.2.30;\n3)\tzero or one <ACE-enabled-indicator> element containing the parameter defined in clause 11.4.2.31\n4)\ta <discovery-entry-id> element containing the parameter defined in clause 11.4.2.26;\n5)\tan <application-level-container> element containing the parameter defined in clause 11.4.2.25;\n6)\tone or more <code-receiving-security-parameter> element containing the parameter defined in clause 11.4.2.33;\n7)\ta <selected-PC5-ciphering-algorithm> element containing the parameter defined in clause 11.4.2.51;\n8)\tzero or one <PC5-security-policies> element containing the parameter defined in clause 11.4.2.49;\n9)\tzero or one <anyExt> element containing elements defined in future releases;\n10)\tzero, one or more elements from other namespaces defined in future releases; and\n11)\tzero, one or more attributes defined in future releases;\ng)\tzero, one or more <restricted-discoveree-response> element which contains transactions sent from the 5G DDNMF to the UE as a response to a discoveree UE's request for restricted 5G ProSe direct discovery model B if the 5G DDNMF accepts the request. Each <restricted-discoveree-response> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <ProSe-Response-Code> element containing the element defined in clause11.4.2.35;\n3)\tone or more <query-filter> elements containing the parameter defined in clause 11.4.2.36;\n4)\ta <validity-timer-T5068> element containing the parameter defined in clause 11.4.2.37;\n5)\ta <code-sending-security-parameter > element containing the parameter defined in clause 11.4.2.33;\n6)\tone or more <code-receiving-security-parameter> element containing the parameter defined in clause 11.4.2.33;\n7)\ta <discovery-entry-id> element containing the parameter defined in clause 11.4.2.26;\n8)\tzero or one <PC5-security-policies> element containing the parameter defined in clause 11.4.2.49;\n9)\ta <selected-PC5-ciphering-algorithm> element containing the parameter defined in clause 11.4.2.51;\n10)\tzero or one <anyExt> element containing elements defined in future releases;\n11)\tzero, one or more elements from other namespaces defined in future releases; and\n12)\tzero, one or more attributes defined in future releases;\nh)\tzero, one or more <restricted-discoverer-response> element which contains transactions sent from the 5G DDNMF to the UE as a response to a discoverer UE's request for restricted 5G ProSe direct discovery model B if the 5G DDNMF accepts the request. Each <restricted-discoverer-response> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\tone or more <subquery-result> elements containing the parameter defined in clause 11.4.2.38;\n3)\ta <code-sending-security-parameter> element containing the parameter defined in clause 11.4.2.33;\n4)\tone or more <code-receiving-security-parameter> element containing the parameter defined in clause 11.4.2.33;\n5)\ta <discovery-entry-id> element containing the parameter defined in clause 11.4.2.26;\n6)\tzero or one <PC5-security-policies> element containing the parameter defined in clause 11.4.2.49;\n7)\ta <selected-PC5-ciphering-algorithm> element containing the parameter defined in clause 11.4.2.51;\n8)\tzero or one <anyExt> element containing elements defined in future releases;\n9)\tzero, one or more elements from other namespaces defined in future releases; and\n10)\tzero, one or more attributes defined in future releases;\ni)\tzero, one or more <response-reject> element which contains transactions sent from the 5G DDNMF to the UE as a response to an announcing or monitoring requests if the 5G DDNMF  cannot accept the request. Each <response-reject> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <PC3a-control-protocol-cause-value> element containing the parameter defined in clause 11.4.2.8.\n3)\tzero, one or more elements defined in future releases; and\n4)\tzero, one or more attributes defined in future releases;\nj)\tzero or one <anyExt> element containing elements defined in future releases;\nk)\tzero, one or more elements from other namespaces defined in future releases;\nl)\tan optional \"network-initiated transaction method\" attribute containing the parameter defined in clause 11.4.2.42; and\nm)\tzero, one or more attributes defined in future releases.\nThe <MATCH_REPORT> element contains one or more of the following elements:\na)\tzero, one or more <match-report> element which contains transactions sent from the UE to the 5G DDNMF to report a matching of the direct discovery. Each <match-report> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <ProSe-PC5-discovery-message> element containing the parameter defined in clause 11.4.2.52;\n3)\ta <Monitored-PLMN-id> element containing the parameter defined in clause 11.4.2.10;\n4)\tan optional <VPLMN-id> element containing the parameter defined in clause 11.4.2.11;\n5)\ta <UTC-based-counter> element containing the parameter defined in clause 11.4.2.12;\n6)\ta <metadata-flag> element containing the parameter defined in clause 11.4.2.14;\n7)\tzero or one <anyExt> element containing elements defined in future releases;\n8)\tzero, one or more elements from other namespaces defined in future releases; and\n9)\tzero, one or more attributes defined in future releases;\nb)\tzero, one or more <restricted-match> element which contain transactions sent from the UE to the 5G DDNMF to report a matching of the restricted direct discovery model A or model B. Each <restricted-match> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <discovery-type> element containing the parameter defined in clause 11.4.2.18\n3)\tan <application-identity> element containing the parameter defined in clause 11.4.2.5\n4)\tan <RPAUID> element containing the parameter defined in clause 11.4.2.23;\n5)\tzero or one <ProSe-PC5-discovery-message> element containing the parameter defined in clause 11.4.2.52, if it is required to check the MIC via the match report procedure;\n6)\tzero or one <Restricted-Code-Discovered> element containing the ProSe Restricted Code parameter defined in clause 11.4.2.27 or ProSe Response Code parameter defined in clause 11.4.2.35, if it is not required to check the MIC via the match report procedure;\n7)\ta <UTC-based-counter> element containing the parameter defined in clause 11.4.2.12, if it is required to check the MIC via the match report procedure;\n8)\ta <metadata-flag> element containing the parameter defined in clause 11.4.2.14;\n9)\tzero or one <anyExt> element containing elements defined in future releases;\n10)\tzero, one or more elements from other namespaces defined in future releases; and\n11)\tzero, one or more attributes defined in future releases.\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\nThe <MATCH_REPORT_ACK> element contains one or more of the following elements:\na)\ta <Current-Time> element containing the parameter defined in clause 11.4.2.16;\nb)\tzero, one or more <match-ack> element which contains transactions sent from the 5G DDNMF to the UE as a response to a match report if the 5G DDNMF accepts the report. Each <match-ack> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <ProSe-Application-ID> element containing the parameter defined in clause 11.4.2.4;\n3)\ta <validity-timer-T5072> element containing the parameter defined in clause 11.4.2.13;\n4)\tan optional  <metadata> element containing the parameter defined in clause 11.4.2.15;\n5)\tan optional <metadata-index-mask> element containing the parameter defined in clause 11.4.2.41;\n6)\ta mandatory \"match-report-refresh-timer-T5074\" attribute containing the parameter defined in clause 11.4.2.19;\n7)\tzero or one <anyExt> element containing elements defined in future releases;\n8)\tzero, one or more elements from other namespaces defined in future releases; and\n9)\tzero, one or more attributes defined in future releases;\nc)\tzero, one or more <restricted-match-ack> element which contain transactions sent from the 5G DDNMF to the UE as a response to a match report if the 5G DDNMF accepts the report. Each <restricted-match-ack> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\tan <application-identity> element containing the parameter defined in clause 11.4.2.5;\n3)\tan <RPAUID> element containing the parameter defined in clause 11.4.2.23;\n4)\ta <validity-timer-T5076> element containing the parameter defined in clause 11.4.2.39;\n5)\tan optional <metadata> element containing the parameter defined in clause 11.4.2.15;\n6)\tzero or one <anyExt> element containing elements defined in future releases;\n7)\tzero, one or more elements from other namespaces defined in future releases;\n8)\tan optional \"match-report-refresh-timer-T5077\" attribute containing the parameter defined in clause 11.4.2.40; and\n9)\tzero, one or more attributes defined in future releases;\nd)\tzero, one or more <match-reject> element which contains transactions sent from the 5G DDNMF to the UE as a response to a match report if the 5G DDNMF cannot accept the match report. Each <match-reject> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <PC3a-control-protocol-cause-value> element containing the parameter defined in clause 11.4.2.8;\n3)\tzero, one or more elements defined in future releases; and\n4)\tzero, one or more attributes defined in future releases;\ne)\tzero or one <anyExt> element containing elements defined in future releases;\nf)\tzero, one or more elements from other namespaces defined in future releases; and\ng)\tzero, one or more attributes defined in future releases.\nThe < DISCOVERY_UPDATE_REQUEST> element contains one or more of the following elements:\na)\tOne or more <discovery-update-request> element which contains transactions sent from the 5G DDNMF to the UE as announcing or monitoring requests. Each <discovery-update-request> consists of:\n1)\ta <DDNMF-transaction-ID> element containing the parameter defined in clause 11.4.2.21;\n2)\ta <discovery-entry-id> element containing the parameter defined in clause 11.4.2.26;\n3)\tan optional <update-info> element containing the parameter defined in clause 11.4.2.22;\n4)\tzero or one <anyExt> element containing elements defined in future releases;\n5)\tzero, one or more elements defined in future releases; and\n6)\tzero, one or more attributes defined in future releases;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero, one or more elements from other namespaces defined in future releases; and\nd)\tzero, one or more attributes defined in future releases.\nThe < DISCOVERY_UPDATE _RESPONSE> element contains one or more of the following elements:\na)\tone or more <response-update> element which contains transactions sent from  the UE to the 5G DDNMF as a response if the UE accepts the request. Each <discovery-update-response> consists of:\n1)\ta <DDNMF-transaction-ID> element containing the parameter defined in clause 11.4.2.21;\n2)\ta <discovery-entry-id> element containing the parameter defined in clause 11.4.2.26;\n3)\tzero, one or more elements defined in future releases; and\n4)\tzero, one or more attributes defined in future releases;\nb)\tzero, one or more <response-reject> element which contains transactions sent from the UE to the 5G DDNMF as a response if the UE cannot accept the request. Each <response-reject> consists of:\n1)\ta <DDNMF-transaction-ID> element containing the parameter defined in clause 11.4.2.21;\n2)\ta <PC3a-control-protocol-cause-value> element containing the parameter defined in clause 11.4.2.8.\n3)\tzero, one or more elements defined in future releases; and\n4)\tzero, one or more attributes defined in future releases;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\nThe <ANNOUNCING_ALERT_REQUEST> element contains one or more of the following elements:\na)\tOne or more <announcing-alert-request> element which contains transactions sent from the UE to the 5G DDNMF as announcing or monitoring requests. Each <announcing-alert-request> consists of:\n1)\ta <DDNMF-transaction-ID> element containing the parameter defined in clause 11.4.2.21;\n2)\ta <RPAUID> element containing the parameter defined in clause 11.4.2.23;\n3)\ta <Discovery-Entry-ID> element containing the parameter defined in clause 11.4.2.26;\n4)\ta <ProSe-Restricted-Code> element containing the parameter defined in clause 11.4.2.27;\n5)\tzero, one or more <ProSe-Restricted-Code-Suffix-Range> element containing the parameter defined in clause 11.4.2.28;\n6)\tzero or one <anyExt> element containing elements defined in future releases;\n7)\tzero, one or more elements from other namespaces defined in future releases; and\n8)\tzero, one or more attributes defined in future releases;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero, one or more elements from other namespaces defined in future releases; and\nd)\tzero, one or more attributes defined in future releases.\nThe <ANNOUNCING_ALERT_RESPONSE> element contains one or more of the following elements:\na)\tOne or more <announcing-alert-response> element which contains transactions sent from the UE to the 5G DDNMF as announcing or monitoring requests. Each <announcing-alert-response> consists of:\n1)\ta <DDNMF-transaction-ID> element containing the parameter defined in clause 11.4.2.21;\n2)\tzero, one or more elements defined in future releases; and\n3)\tzero, one or more attributes defined in future releases;\nb)\tzero, one or more <response-reject> element which contains transactions sent from the UE to the 5G DDNMF as a response if the UE cannot accept the request. Each <response-reject> consists of:\n1)\ta <DDNMF-transaction-ID> element containing the parameter defined in clause 11.4.2.21;\n2)\ta <PC3a-control-protocol-cause-value> element containing the parameter defined in clause 11.4.2.8.\n3)\tzero, one or more elements defined in future releases; and\n4)\tzero, one or more attributes defined in future releases;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\nThe <PROSE_5GPKMF_ADDRESS_REQUEST> element contains one or more of the following elements:\na)\tzero, one or more <PKMF-address-request> element which contains transactions sent from the UE to the 5G DDNMF. Each <PKMF-address-request> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\tzero or one <anyExt> element containing elements defined in future releases;\n3)\tzero, one or more elements from other namespaces defined in future releases; and\n4)\tzero, one or more attributes defined in future releases;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero, one or more elements from other namespaces defined in future releases; and\nd)\tzero, one or more attributes defined in future releases.\nThe <PROSE_5GPKMF_ADDRESS_RESPONSE> element contains one or more of the following elements:\na)\tzero, one or more <PKMF-address-response> element which contains transactions sent from the 5G DDNMF to the UE. Each < PKMF-address-response> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <PKMF-address> element containing the parameter defined in clause 11.4.2.53;\n3)\tzero or one <anyExt> element containing elements defined in future releases;\n4)\tzero, one or more elements from other namespaces defined in future releases; and\n5)\tzero, one or more attributes defined in future releases;\nb)\tzero, one or more <PKMF-address-reject> element which contains transactions sent from the 5G DDNMF to the UE as a response if the 5G DDNMF cannot accept the request. Each <PKMF-address-reject> consists of:\n1)\ta <transaction-ID> element containing the parameter defined in clause 11.4.2.1;\n2)\ta <PC3a-control-protocol-cause-value> element containing the parameter defined in clause 11.4.2.8.\n3)\tzero, one or more elements defined in future releases; and\n4)\tzero, one or more attributes defined in future releases;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\nThe semantics of <PROSE_SECURITY_MATERIAL_REQUEST> is same as the semantics of <PROSE_SECURITY_PARAM_REQUEST> defined in clause 10.6.4.2, where 5G PKMF is replaced by 5G DDNMF.\nThe semantics of <PROSE_SECURITY_MATERIAL_RESPONSE> is same as the semantics of <PROSE_SECURITY_PARAM_RESPONSE> defined in clause 10.6.4.3, where 5G PKMF is replaced by 5G DDNMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.6\t5G ProSe security messages over PC8",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.6.1\tGeneral",
                            "text_content": "This clause defines the XML schema and MIME type related to 5G ProSe security messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.6.2\tapplication/vnd.3gpp-prose-pc8+xml",
                            "text_content": "The MIME type is used to carry information related to the 5G ProSe security operation. It shall be coded as an XML document containing one of the following 5G ProSe security messages:\na)\ta PROSE_SECURITY_PARAM_REQUEST message;\nb)\ta PROSE_SECURITY_PARAM_RESPONSE message;\nc)\ta PROSE_PRUK_REQUEST message;\nd)\ta PROSE_PRUK_RESPONSE message;\ne)\ta PROSE_KEY_REQUEST message; or\nf)\ta PROSE_KEY_RESPONSE message.\nEach of those messages is presented in the XML document as an XML element named after the corresponding message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.6.3\tXML schema",
                            "text_content": "Implementations in compliance with the present document shall implement the XML schema defined below for messages used in 5G ProSe security procedures over PC8 interface.\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nxmlns=\"urn:3GPP:ns:5GProSe:Security:2022\"\nelementFormDefault=\"qualified\"\ntargetNamespace=\"urn:3GPP:ns:5GProSe:Security:2022\">\n<xs:annotation>\n<xs:documentation>\nInfo for 5G ProSe Security Control Messages Syntax\n</xs:documentation>\n</xs:annotation>\n\n<xs:complexType name=\"empty-type\"/>\n\n<xs:complexType name=\"requested-for-type\">\n<xs:sequence>\n<xs:element name=\"remote-UE\" type=\"empty-type\" minOccurs=\"0\"/>\n<xs:element name=\"UNR\" type=\"empty-type\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PLMN-type\">\n<xs:sequence>\n<xs:element name=\"mcc\" type=\"xs:integer\"/>\n<xs:element name=\"mnc\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PLMN-list-type\">\n<xs:sequence>\n<xs:element name=\"PLMN\" type=\"PLMN-type\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"model-type\">\n<xs:sequence>\n<xs:element name=\"model-A\" type=\"empty-type\" minOccurs=\"0\"/>\n<xs:element name=\"model-B\" type=\"empty-type\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"DUCK-type\">\n<xs:sequence>\n<xs:element name=\"discovery-user-confidentiality-key\" type=\"xs:hexBinary\"/>\n<xs:element name=\"encrypted-bitmask\" type=\"xs:hexBinary\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"code-sending-or-receiving-security-parameters-type\">\n<xs:sequence>\n<xs:element name=\"DUSK\" type=\"xs:hexBinary\" minOccurs=\"0\" />\n<xs:element name=\"DUIK\" type=\"xs:hexBinary\" minOccurs=\"0\" />\n<xs:element name=\"DUCK\" type=\"DUCK-type\" minOccurs=\"0\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"security-parameters-for-remote-UE-type\">\n<xs:sequence>\n<xs:element name=\"expiration-timer\" type=\"xs:integer\"/>\n<xs:element name=\"code-receiving-security-parameters-for-model-A\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"code-receiving-security-parameters-for-model-B\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"code-sending-security-parameters-for-model-B\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"selected-PC5-ciphering-algorithm\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"security-parameters-for-UNR-type\">\n<xs:sequence>\n<xs:element name=\"expiration-timer\" type=\"xs:integer\"/>\n<xs:element name=\"code-sending-security-parameters-for-model-A\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"code-receiving-security-parameters-for-model-B\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"code-sending-security-parameters-for-model-B\" type=\"code-sending-or-receiving-security-parameters-type\" minOccurs=\"0\"/>\n<xs:element name=\"selected-PC5-ciphering-algorithm\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PC5-security-policies-type\">\n<xs:sequence>\n<xs:element name=\"signalling-ciphering-policy\" type=\"xs:integer\"/>\n<xs:element name=\"user-plane-integrity-protection-policy\" type=\"xs:integer\"/>\n<xs:element name=\"user-plane-ciphering-policy\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!-- Complex types defined for transaction-level -->\n<xs:complexType name=\"UNR-discovery-security-parameters-request-type\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"requested-for\" type=\"requested-for-type\"/>\n<xs:element name=\"PC5-UE-security-capabilities\" type=\"xs:integer\"/>\n<xs:element name=\"relay-service-code\" type=\"xs:integer\"/>\n<xs:element name=\"VPLMN-list\" type=\"PLMN-list-type\" minOccurs=\"0\"/>\n<xs:element name=\"model\" type=\"model-type\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"UNR-discovery-security-parameters-accept-type\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"security-parameters-for-remote-UE\" type=\"security-parameters-for-remote-UE-type\"  minOccurs=\"0\"/>\n<xs:element name=\"PC5-security-policies-for-remote-UE\" type=\"PC5-security-policies-type\" minOccurs=\"0\"/>\n<xs:element name=\"security-parameters-for-UNR\" type=\"security-parameters-for-UNR-type\"  minOccurs=\"0\"/>\n<xs:element name=\"PC5-security-policies-for-UNR\" type=\"PC5-security-policies-type\" minOccurs=\"0\"/>\n\n<xs:element name=\"Current-Time\" type=\"xs:dateTime\"/>\n<xs:element name=\"Max-Offset\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PRUK-request-type\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"UP-PRUK-ID\" type=\"xs:string\" minOccurs=\"0\" />\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PRUK-accept-type\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"UP-PRUK-ID\" type=\"xs:string\"/>\n<xs:element name=\"UP-PRUK\" type=\"xs:hexBinary\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"key-request-type\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"relay-service-code\" type=\"xs:integer\"/>\n<xs:element name=\"SUCI\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"UP-PRUK-ID\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"Knrp-freshness-parameter-1\" type=\"xs:hexBinary\"/>\n<xs:element name=\"HPLMN\" type=\"PLMN-type\" minOccurs=\"0\"/>\n<xs:element name=\"AUTS\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"RAND\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"key-accept-type\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"UP-PRUK-ID\" type=\"xs:string\"/>\n<xs:element name=\"Knrp\" type=\"xs:hexBinary\"/>\n<xs:element name=\"Knrp-freshness-parameter-2\" type=\"xs:hexBinary\"/>\n<xs:element name=\"GPI\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"reject-type\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"PC8-control-protocol-cause-value\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!-- Complex types defined for Message-level -->\n<xs:complexType name=\"PROSE_SECURITY_PARAM_REQUEST-type\">\n<xs:sequence>\n<xs:element name=\"UNR-discovery-security-parameters-request\" type=\"UNR-discovery-security-parameters-request-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PROSE_SECURITY_PARAM_RESPONSE-type\">\n<xs:sequence>\n<xs:element name=\"UNR-discovery-security-parameters-accept\" type=\"UNR-discovery-security-parameters-accept-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"UNR-discovery-security-parameters-reject\" type=\"reject-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PROSE_PRUK_REQUEST-type\">\n<xs:sequence>\n<xs:element name=\"PRUK-request\" type=\"PRUK-request-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PROSE_PRUK_RESPONSE-type\">\n<xs:sequence>\n<xs:element name=\"PRUK-accept\" type=\"PRUK-accept-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"PRUK-reject\" type=\"reject-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PROSE_KEY_REQUEST-type\">\n<xs:sequence>\n<xs:element name=\"key-request\" type=\"key-request-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"PROSE_KEY_RESPONSE-type\">\n<xs:sequence>\n<xs:element name=\"key-accept\" type=\"key-accept-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"key-reject\" type=\"reject-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!--  extension allowed -->\n<xs:complexType name=\"DiscMsgExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!--  XML attribute for any future extensions  -->\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n\n\n<!--  Top level Security Message definition  -->\n<xs:element name=\"prose-security-message\">\n<xs:complexType>\n<xs:choice>\n<xs:element name=\"PROSE_SECURITY_PARAM_REQUEST\" type=\"PROSE_SECURITY_PARAM_REQUEST-type\"/>\n<xs:element name=\"PROSE_SECURITY_PARAM_RESPONSE\" type=\"PROSE_SECURITY_PARAM_RESPONSE-type\"/>\n<xs:element name=\"PROSE_PRUK_REQUEST\" type=\"PROSE_PRUK_REQUEST-type\"/>\n<xs:element name=\"PROSE_PRUK_RESPONSE\" type=\"PROSE_PRUK_RESPONSE-type\"/>\n<xs:element name=\"PROSE_KEY_REQUEST\" type=\"PROSE_KEY_REQUEST-type\"/>\n<xs:element name=\"PROSE_KEY_RESPONSE\" type=\"PROSE_KEY_RESPONSE-type\"/>\n\n<xs:element name=\"message-ext\" type=\"DiscMsgExtType\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n</xs:choice>\n</xs:complexType>\n</xs:element>\n\n</xs:schema>\n\nAn entity receiving the XML body ignores any unknown XML element and any unknown XML attribute.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.6.4\tSemantics",
                            "text_content": "The <prose-security-message> element is the root element of this XML document and it contains one of the following elements:\na)\ta <PROSE_SECURITY_PARAM_REQUEST> element;\nb)\ta <PROSE_SECURITY_PARAM_RESPONSE> element;\nc)\ta <PROSE_PRUK_REQUEST> element;\nd)\ta <PROSE_PRUK_RESPONSE> element;\ne)\ta <PROSE_KEY_REQUEST> element;\nf)\ta <PROSE_KEY_RESPONSE> element;\ng)\t<message-ext> element containing other discovery message defined in future releases; or\nh)\tan element from other namespaces defined in future releases.\nThe <PROSE_SECURITY_PARAM_REQUEST> element contains:\na)\tzero or more <UNR-discovery-security-parameters-request> elements which contain transactions sent from the UE to the 5G PKMF;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero or more elements from other namespaces defined in future releases; and\nd)\tzero or more attributes defined in future releases.\nThe <UNR-discovery-security-parameters-request> contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\ta <requested-for> element;\nc)\ta <PC5-UE-security-capabilities> element containing the parameter defined in clause 11.6.2.4;\nd)\ta <relay-service-code> element containing the parameter defined in clause 11.6.2.10;\ne)\tzero or one <VPLMN-list> element;\nf)\tzero or one <model> element;\ng)\tzero or one <anyExt> element containing elements defined in future releases;\nh)\tzero or more elements from other namespaces defined in future releases; and\ni)\tzero or more attributes defined in future releases.\nThe <requested-for> element contains:\na)\tthe following:\n1)\ta <remote-UE> element indicating that the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE are requested;\n2)\ta <UNR> element indicating that the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE are requested; or\n3)\tboth;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero or more elements from other namespaces defined in future releases; and\nd)\tzero or more attributes defined in future releases.\nThe <VPLMN-list> element contains:\na)\tone or more <PLMN> elements;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero or more elements from other namespaces defined in future releases; and\nd)\tzero or more attributes defined in future releases.\nThe <PLMN> element contains:\na)\tan <mcc> elements containing the parameter defined in clause 11.6.2.5;\nb)\tan <mnc> elements containing the parameter defined in clause 11.6.2.6;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases.\nThe <model> element contains:\na)\ta <model-A> elements indicating that security parameters are requested for 5G ProSe UE-to-network relay discovery over PC5 interface model A or an <model-B> elements indicating that security parameters are requested for 5G ProSe UE-to-network relay discovery over PC5 interface model B;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero or more elements from other namespaces defined in future releases; and\nd)\tzero or more attributes defined in future releases.\nThe <PROSE_SECURITY_PARAM_RESPONSE> element sent from the 5G PKMF to the UE contains:\na)\tzero or more <UNR-discovery-security-parameters-accept> elements which contain accepted transactions;\nb)\tzero or more <UNR-discovery-security-parameters-reject> elements which contain rejected transactions;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases.\nThe <UNR-discovery-security-parameters-accept> contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\tzero or one <security-parameters-for-remote-UE> element indicating the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE;\nc)\tzero or one <PC5-security-policies-for-remote-UE> element indicating the PC5 security policies for 5G ProSe remote UE;\nd)\tzero or one <security-parameters-for-UNR> element indicating the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE;\ne)\tzero or one <PC5-security-policies-for-UNR> element indicating the PC5 security policies for 5G ProSe UE-to-network relay UE;\nf)\ta <Current-Time> element containing the parameter defined in clause 11.6.2.7;\ng)\ta <Max-Offset> element containing the parameter defined in clause 11.6.2.8;\nh)\tzero or one <anyExt> element containing elements defined in future releases;\ni)\tzero or more elements from other namespaces defined in future releases; and\nj)\tzero or more attributes defined in future releases.\nThe <security-parameters-for-remote-UE> element and the <security-parameters-for-UNR> element contains:\na)\tan <expiration-timer> element containing the parameter defined in clause 11.6.2.9;\nb)\toptionally a <code-receiving-security-parameters-for-model-A> element;\nc)\toptionally a <code-receiving-security-parameters-for-model-B> element;\nd)\toptionally a <code-sending-security-parameters-for-model-B> element;\ne)\ta <selected-PC5-ciphering-algorithm> element containing the parameter defined in clause 11.6.2.11;\nf)\tzero or one <anyExt> element containing elements defined in future releases;\ng)\tzero or more elements from other namespaces defined in future releases; and\nh)\tzero or more attributes defined in future releases.\nThe <code-receiving-security-parameters-for-model-A> element, the <code-sending-security-parameters-for-model-A> element, the <code-receiving-security-parameters-for-model-B> element and the <code-sending-security-parameters-for-model-B> element contain:\na)\toptionally a <DUSK> element containing the parameter defined in clause 11.6.2.12;\nb)\toptionally a <DUIK> element containing the parameter defined in clause 11.6.2.13;\nc)\toptionally a <DUCK> element;\nd)\tzero or one <anyExt> element containing elements defined in future releases;\ne)\tzero or more elements from other namespaces defined in future releases; and\nf)\tzero or more attributes defined in future releases.\nThe <DUCK> element contains:\na)\ta <discovery-user-confidentiality-key> element containing the parameter defined in clause 11.6.2.14;\nb)\tan <encrypted-bitmask> element containing the parameter defined in clause 11.6.2.15;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases.\nThe <PC5-security-policies-for-remote-UE> element and the <PC5-security-policies-for-UNR> element contain:\na)\ta <signalling-ciphering-policy> element containing the parameter defined in clause 11.6.2.17;\nb)\ta <user-plane-integrity-protection-policy> element containing the parameter defined in clause 11.6.2.18;\nc)\ta <user-plane-ciphering-policy> element containing the parameter defined in clause 11.6.2.19;\nd)\tzero or one <anyExt> element containing elements defined in future releases;\ne)\tzero or more elements from other namespaces defined in future releases; and\nf)\tzero or more attributes defined in future releases.\nThe <UNR-discovery-security-parameters-reject> element contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\ta <PC8-control-protocol-cause-value> element containing the parameter defined in clause 11.6.2.20;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases.\nThe <PROSE_PRUK_REQUEST> element contains:\na)\tzero or more <PRUK-request> elements which contain transactions sent from the UE to the 5G PKMF;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero or more elements from other namespaces defined in future releases; and\nd)\tzero or more attributes defined in future releases.\nThe <PRUK-request> element contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\tzero or one <UP-PRUK-ID> element containing the parameter defined in clause 11.6.2.3;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases;\nThe <PROSE_PRUK_RESPONSE> element contains:\na)\tzero or more <PRUK-accept> elements which contain the accepted transactions;\nb)\tzero or more <PRUK-reject> elements which contain the rejected transactions;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases.\nThe <PRUK-accept> element contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\ta <UP-PRUK-ID> element containing the parameter defined in clause 11.6.2.3;\nc)\ta <UP-PRUK> element containing the parameter defined in clause 11.6.2.2;\nd)\tzero or one <anyExt> element containing elements defined in future releases;\ne)\tzero or more elements from other namespaces defined in future releases; and\nf)\tzero or more attributes defined in future releases.\nThe <PRUK-reject> element contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\ta <PC8-control-protocol-cause-value> element containing the parameter defined in clause 11.6.2.20;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases.\nThe <PROSE_KEY_REQUEST> element contains:\na)\tzero or more <key-request> elements which contain transactions sent from the UE to the 5G PKMF.\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero or more elements from other namespaces defined in future releases; and\nd)\tzero or more attributes defined in future releases.\nThe <key-request> element contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\ta <relay-service-code> element containing the parameter defined in clause 11.6.2.10;\nc)\tzero or one <SUCI> element containing the parameter defined in clause 11.6.2.21;\nd)\tzero or one <UP-PRUK-ID> element containing the parameter defined in clause 11.6.2.3;\ne)\ta <Knrp-freshness-parameter-1> element containing the parameter defined in clause 11.6.2.22;\nf)\tzero or one <HPLMN> element;\ng)\tzero or one <AUTS> element containing the parameter defined in clause 11.6.2.23;\nh)\tzero or one <RAND> element containing the parameter defined in clause 11.6.2.24;\ni)\tzero or one <anyExt> element containing elements defined in future releases;\nj)\tzero or more elements from other namespaces defined in future releases; and\nk)\tzero or more attributes defined in future releases.\nThe <HPLMN> element contains:\na)\tan <mcc> elements containing the parameter defined in clause 11.6.2.5;\nb)\tan <mnc> elements containing the parameter defined in clause 11.6.2.6;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases.\nThe <PROSE_KEY_RESPONSE> element sent from the 5G PKMF to the UE contains:\na)\tzero or more <key-accept> elements which contain accepted transactions;\nb)\tzero or more <key-reject> elements which contain rejected transactions;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases.\nThe <key-accept> contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\ta <UP-PRUK-ID> element containing the parameter defined in clause 11.6.2.3;\nc)\ta <Knrp> element containing the parameter defined in clause 11.6.2.25;\nd)\ta <Knrp-freshness-parameter-2> element containing the parameter defined in clause 11.6.2.26;\ne)\tzero or one <GPI> element containing the parameter defined in clause 11.6.2.16;\nf)\tzero or one <anyExt> element containing elements defined in future releases;\ng)\tzero or more elements from other namespaces defined in future releases; and\nh)\tzero or more attributes defined in future releases.\nThe <key-reject> element contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\ta <PC8-control-protocol-cause-value> element containing the parameter defined in clause 11.6.2.20;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero or more elements from other namespaces defined in future releases; and\ne)\tzero or more attributes defined in future releases.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.7\tMessages transmitted over the PC3ach interface",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.7.1\tGeneral",
                            "text_content": "This clause defines XML schema and MIME type related to messages transmitted over the PC3ach interface.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.7.2\tapplication/vnd.3gpp-prose-pc3ach+xml",
                            "text_content": "The MIME type is used to carry information related to message transmitted over the PC3ach interface. It shall be coded as an XML document compliant to the XML schema in clause 10.7.3 containing one of the following messages:\n-\tPROSE_USAGE_INFORMATION_REPORT_LIST; or\n-\tPROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE.\nEach of those messages is presented in the XML document as an XML element named after the corresponding message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.7.3\tXML Schema",
                            "text_content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nxmlns=\"urn:3GPP:ns:5GProSe:PC3ach:2022\"\nelementFormDefault=\"qualified\"\ntargetNamespace=\"urn:3GPP:ns:5GProSe:PC3ach:2022\">\n\n<xs:annotation>\n<xs:documentation>\nSyntax of messages transmitted over the PC3ach interface\n</xs:documentation>\n</xs:annotation>\n\n<!-- Types defined for parameters with complicate structure -->\n<xs:simpleType name=\"IPAddress-type\">\n<xs:restriction base=\"xs:string\"/>\n</xs:simpleType>\n\n<xs:simpleType name=\"Layer2Id-type\">\n<xs:restriction base=\"xs:hexBinary\"/>\n</xs:simpleType>\n\n<xs:simpleType name=\"NCGI-type\">\n<xs:restriction base=\"xs:hexBinary\"/>\n</xs:simpleType>\n\n<xs:simpleType name=\"AppSpecificInfo-type\">\n<xs:restriction base=\"xs:hexBinary\"/>\n</xs:simpleType>\n\n<xs:simpleType name=\"RadioResourcesIndicator-type\">\n<xs:restriction base=\"xs:integer\"/>\n</xs:simpleType>\n\n<xs:simpleType name=\"RadioFrequency-type\">\n<xs:restriction base=\"xs:hexBinary\"/>\n</xs:simpleType>\n\n<!--  XML attribute for any future extensions  -->\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n\n<xs:complexType name=\"UsageInformationReportList-Info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"usage-information-report\" type=\"UsageInformationReport-Info\"\nminOccurs=\"1\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"app-specific-info\" type=\"AppSpecificInfo-type\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"UsageInformationReport-Info\">\n<xs:sequence>\n<xs:element name=\"coverage\" type=\"Coverage-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"group\" type=\"Group-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"unicast\" type=\"Unicast-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"radio-parameter-set\" type=\"RadioParameterSet-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"sequence-number\" type=\"xs:integer\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Coverage-info\">\n<xs:sequence>\n<xs:element name=\"location\" type=\"Location-info\" minOccurs=\"0\"  maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"in-coverage\" type=\"xs:boolean\"/>\n<xs:attribute name=\"timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Location-info\">\n<xs:sequence>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"NCGI\" type=\"NCGI-type\" use=\"optional\"/>\n<xs:attribute name=\"timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"RadioParameterSet-info\">\n<xs:sequence>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"timestamp\" type=\"xs:dateTime\" use=\"required\"/>\n<xs:attribute name=\"params\" type=\"xs:hexBinary\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Group-info\">\n<xs:sequence>\n<xs:element name=\"UE-source-IP-address\" type=\"IPAddress-type\"/>\n<xs:element name=\"UE-source-layer2-id\" type=\"Layer2Id-type\"/>\n<xs:element name=\"transmitter\" type=\"Transmitter-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"transmission\" type=\"Transmission-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"reception\" type=\"Reception-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:element name=\"qos-flow\" type=\"QoSFlow-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"prose-layer2-group-ID\" type=\"Layer2Id-type\"/>\n<xs:attribute name=\"prose-group-IP-multicast-address\" type=\"IPAddress-type\"/>\n<xs:attribute name=\"first-transmission-timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:attribute name=\"first-reception-timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Unicast-info\">\n<xs:sequence>\n<xs:element name=\"UE-source-IP-address\" type=\"IPAddress-type\"/>\n<xs:element name=\"UE-source-layer2-id\" type=\"Layer2Id-type\"/>\n<xs:element name=\"transmitter\" type=\"Transmitter-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"receiver\" type=\"Receiver-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"transmission\" type=\"Transmission-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"reception\" type=\"Reception-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"relay-UE\" type=\"RelayUE-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"relay\" type=\"Relay-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"qos-flow\" type=\"QoSFlow-info\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"first-transmission-timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:attribute name=\"first-reception-timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Transmitter-info\">\n<xs:sequence>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"source-IP-address\" type=\"IPAddress-type\"/>\n<xs:attribute name=\"source-layer2-id\" type=\"Layer2Id-type\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Transmission-info\">\n<xs:sequence>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"in-coverage\" type=\"xs:boolean\"/>\n<xs:attribute name=\"NCGI\" type=\"NCGI-type\" use=\"optional\"/>\n<xs:attribute name=\"amount\" type=\"xs:integer\"/>\n<xs:attribute name=\"timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:attribute name=\"radio-resources-ind\" type=\"RadioResourcesIndicator-type\" use=\"optional\"/>\n<xs:attribute name=\"radio-frequency\" type=\"RadioFrequency-type\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Reception-info\">\n<xs:sequence>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"in-coverage\" type=\"xs:boolean\"/>\n<xs:attribute name=\"NCGI\" type=\"NCGI-type\" use=\"optional\"/>\n<xs:attribute name=\"amount\" type=\"xs:integer\"/>\n<xs:attribute name=\"timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:attribute name=\"radio-resources-ind\" type=\"RadioResourcesIndicator-type\" use=\"optional\"/>\n<xs:attribute name=\"radio-frequency\" type=\"RadioFrequency-type\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Receiver-info\">\n<xs:sequence>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"target-IP-address\" type=\"IPAddress-type\"/>\n<xs:attribute name=\"target-layer2-id\" type=\"Layer2Id-type\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"RelayUE-info\">\n<xs:sequence>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"relay-UE-IP-address\" type=\"IPAddress-type\"/>\n<xs:attribute name=\"relay-UE-layer2-id\" type=\"Layer2Id-type\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"Relay-info\">\n<xs:sequence>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"NCGI\" type=\"NCGI-type\" use=\"optional\"/>\n<xs:attribute name=\"amount\" type=\"xs:integer\"/>\n<xs:attribute name=\"timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:attribute name=\"radio-resources-ind\" type=\"RadioResourcesIndicator-type\" use=\"optional\"/>\n<xs:attribute name=\"radio-frequency\" type=\"RadioFrequency-type\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"QoSFlow-info\">\n<xs:sequence>\n<xs:element name=\"qos-parameter-set\" type=\"QosParameterSet-info\" minOccurs=\"0\"  maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"timestamp\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:attribute name=\"qos-flow-id\" type=\"xs:hexBinary\" minOccurs=\"0\"  maxOccurs=\"unbounded\"/>\n<xs:attribute name=\"amount\" type=\"xs:integer\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"QosParameterSet-info\">\n<xs:sequence>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"pqi\" type=\"xs:hexBinary\"/>\n<xs:attribute name=\"gfbr\" type=\"xs:hexBinary\"/>\n<xs:attribute name=\"mfbr\" type=\"xs:hexBinary\"/>\n<xs:attribute name=\"averaging-window\" type=\"xs:hexBinary\"/>\n<xs:attribute name=\"Resource-type\" type=\"xs:hexBinary\"/>\n<xs:attribute name=\"default-priority-level\" type=\"xs:hexBinary\"/>\n<xs:attribute name=\"packet-delay-budget\" type=\"xs:hexBinary\"/>\n<xs:attribute name=\"packet-error-rate\" type=\"xs:hexBinary\"/>\n<xs:attribute name=\"default-maximum-data-burst-volume\" type=\"xs:hexBinary\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"UsageInformationReportListResponse-Info\">\n<xs:sequence>\n<xs:element name=\"response-accept\" type=\"UsageInformationReportListResponseAccept-Info\" minOccurs=\"0\"/>\n<xs:element name=\"response-reject\" type=\"UsageInformationReportListResponseReject-Info\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"UsageInformationReportListResponseAccept-Info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"UsageInformationReportListResponseReject-Info\">\n<xs:sequence>\n<xs:element name=\"transaction-ID\" type=\"xs:integer\"/>\n<xs:element name=\"cause-value\" type=\"xs:integer\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:element name=\"prose-pC3ach-message\">\n<xs:complexType>\n<xs:choice>\n<xs:element name=\"PROSE_USAGE_INFORMATION_REPORT_LIST\" type=\"UsageInformationReportList-Info\"/>\n<xs:element name=\"PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE\" type=\"UsageInformationReportListResponse-Info\"/>\n<xs:element name=\"anyExt\" type=\"anyExtType\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n</xs:choice>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n</xs:element>\n\n</xs:schema>\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.7.4\tSemantics",
                            "text_content": "The <prose-pC3ach-message> element is the root element of this XML document.\nThe <prose-pC3ach-message> element contains one of the following:\na)\t<PROSE_USAGE_INFORMATION_REPORT_LIST> element;\nb)\t<PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE> element;\nc)\t<anyExt> element containing elements defined in future releases; or\nd)\tone or more elements from other namespace defined in future releases.\nThe <prose-pC3ach-message> element contains zero, one or more attributes defined in future releases.\nThe <PROSE_USAGE_INFORMATION_REPORT_LIST> element contains:\na)\ta <transaction-ID> element containing the parameter defined in clause 11.6.2.1;\nb)\tone or more <usage-information-report> elements;\nc)\tzero, one or more <app-specific-info> element;\nd)\tzero or one <anyExt> element containing elements defined in future releases;\ne)\tzero, one or more elements from other namespaces defined in future releases; and\nf)\tzero, one or more attributes defined in future releases.\nThe <usage-information-report> element carries one usage information report. The <usage-information-report> element contains:\na)\tmandatory \"sequence-number\" attribute containing the parameter defined in clause 11.6.2.2;\nb)\tzero, one or more <coverage> elements;\nc)\tzero, one or more <group> element;\nd)\tzero, one or more <unicast> element;\ne)\tzero, one or more <radio-parameter-set> elements;\nf)\tzero or one <anyExt> element containing elements defined in future releases;\ng)\tzero, one or more elements from other namespaces defined in future releases; and\nh)\tzero, one or more attributes defined in future releases.\nThe <coverage> element carries information whether the UE was in NG-RAN coverage or out of NG-RAN coverage. The <coverage> element contains:\na)\tmandatory \"in-coverage\" attribute containing the parameter defined in clause 11.6.2.3;\nb)\toptional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time when the information given in the element start being valid;\nc)\tif the UE was in NG-RAN coverage, zero, one or more <location> elements;\nd)\tzero or one <anyExt> element containing elements defined in future releases;\ne)\tzero, one or more elements from other namespaces defined in future releases; and\nf)\tzero, one or more attributes defined in future releases.\nThe <location> element carries information about an NG-RAN cell where the UE was camping on or which the UE used in the 5GMM-CONNECTED mode. The <location> element contains:\na)\tan optional \"NCGI\" attribute containing the parameter defined in clause 11.6.2.4;\nb)\tan optional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time when the information given in the element start being valid;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\nThe <radio-parameter-set> element carries information about the configured radio parameters for the ProSe direct communication applicable in the geographical area of the UE. The <radio-parameter-set> element contains:\na)\ta mandatory \"params\" attribute containing the parameter defined in clause 11.6.2.5;\nb)\ta mandatory \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time when the information given in the element start being valid;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\nThe <group> element carries information about a 5G ProSe group. The <group> element contains:\na)\ta mandatory \"prose-layer2-group-ID\" attribute containing the parameter defined in clause 11.6.2.8;\nb)\ta mandatory \"prose-group-IP-multicast-address\" attribute containing the parameter defined in clause 11.6.2.10;\nc)\tan optional \"first-transmission-timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first transmission to the ProSe Group IP multicast address in the collection period;\nd)\tan optional \"first-reception-timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first reception from the ProSe Group IP multicast address in the collection period;\ne)\ta <UE-source-IP-address> element containing the parameter defined in clause 11.6.2.10, of the UE;\nf)\ta <UE-source-layer2-id> element containing the parameter defined in clause 11.6.2.11, of the UE;\ng)\tzero, one or more <transmitter> element;\nh)\tzero, one or more <transmission> element;\ni)\tzero, one or more <reception> element;\nj)\tzero, one or more <qos-flow> elements;\nk)\tzero or one <anyExt> element containing elements defined in future releases;\nl)\tzero, one or more elements from other namespaces defined in future releases; and\nm)\tzero, one or more attributes defined in future releases.\nThe <unicast> element carries information about an unicast mode 5G ProSe direct communication. The <unicast> element contains:\na)\tan optional \"first-transmission-timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first transmission in the unicast mode 5G ProSe direct communication in the collection period;\nb)\tan optional \"first-reception-timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first reception in the unicast mode 5G ProSe direct communication in the collection period;\nc)\ta <UE-source-IP-address> element containing the parameter defined in clause 11.6.2.10, of the UE;\nd)\ta <UE-source-layer2-id> element containing the parameter defined in clause 11.6.2.11, of the UE;\ne)\tzero, one or more <transmitter> element;\nf)\tzero, one or more <receiver> element;\ng)\tzero, one or more <transmission> element;\nh\tzero, one or more <reception> element;\ni)\tzero, one or more <relay-UE> element;\nj)\tzero, one or more < relay> element;\nk)\tzero, one or more <qos-flow> elements;\nl)\tzero or one <anyExt> element containing elements defined in future releases;\nm)\tzero, one or more elements from other namespaces defined in future releases; and\nn)\tzero, one or more attributes defined in future releases.\nThe <transmitter> element carries information about a transmitter in a 5G ProSe group or in an unicast mode 5G ProSe direct communication. The <transmitter> element contains:\na)\ta mandatory \"source-IP-address\" attribute containing the parameter defined in clause 11.6.2.10, of the transmitter;\nb)\ta mandatory \"source-layer2-id\" attribute containing the parameter defined in clause 11.6.2.11, of the transmitter;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\nThe <receiver> element carries information about a receiver in an unicast mode 5G ProSe direct communication. The <receiver> element contains:\na)\ta mandatory \"target-IP-address\" attribute containing the parameter defined in clause 11.6.2.10, of the receiver;\nb)\ta mandatory \"target-layer2-id\" attribute containing the parameter defined in clause 11.6.2.11, of the receiver;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\nThe <transmission> element carries information about a transmission in a ProSe group or in an unicast mode 5G ProSe direct communication. The <transmission> element contains:\na)\ta mandatory \"in-coverage\" attribute containing the parameter defined in clause 11.6.2.3;\nb)\tif the UE was in NG-RAN coverage when transmitting the data, an optional \"NCGI\" attribute containing the parameter defined in clause 11.6.2.5, indicating NG-RAN Cell Global Identification of the NG-RAN cell where the UE was camping on or which the UE used in the 5GMM-CONNECTED mode when transmitting the data;\nc)\tif the UE was in NG-RAN coverage and the \"NCGI\" attribute is included:\n1)\ta mandatory \"amount\" attribute containing the parameter defined in clause 11.6.2.12 indicating the amount of octets transmitted to the ProSe group or in an unicast mode 5G ProSe direct communication:\n-\twhen the UE was camping on a cell identified by the \"NCGI\" attribute when transmitting the data; or\n-\twhen the UE used in the 5GMM-CONNECTED mode a cell identified by the \"NCGI\" attribute when transmitting the data; and\n2)\tan optional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first transmission in the NG-RAN cell;\nd)\tif the UE was in NG-RAN coverage and the \"NCGI\" attribute is not included:\n1)\ta mandatory \"amount\" attribute containing the parameter defined in clause 11.6.2.12 indicating the amount of octets transmitted to the ProSe group or in an unicast mode 5G ProSe direct communication during the in NG-RAN coverage period; and\n2)\tan optional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first transmission during the in NG-RAN coverage period;\ne)\tif the UE was out of NG-RAN coverage:\n1)\ta mandatory \"amount\" attribute containing the parameter defined in clause 11.6.2.12 indicating the amount of octets transmitted to the ProSe group or in an unicast mode 5G ProSe direct communication during the out of NG-RAN coverage period; and\n2)\tan optional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first transmission during the out of NG-RAN coverage period;\nf)\tan optional \"radio-resources-ind\" attribute containing the parameter defined in clause 11.6.2.13;\ng)\tan optional \"radio-frequency\" attribute containing the parameter defined in clause 11.6.2.14;\nh)\tzero or one <anyExt> element containing elements defined in future releases;\ni)\tzero, one or more elements from other namespaces defined in future releases; and\nj)\tzero, one or more attributes defined in future releases.\nThe <reception> element carries information about a reception in a ProSe group or in an unicast mode 5G ProSe direct communication. The <reception> element contains:\na)\ta mandatory \"in-coverage\" attribute containing the parameter defined in clause 11.6.2.3 indicating whether the UE was in NG-RAN coverage when receiving the data;\nb)\tif the UE was in NG-RAN coverage when receiving the data, an optional \"NCGI\" attribute containing the parameter defined in clause 11.6.2.4 indicating NG-RAN Cell Global Identification of the NG-RAN cell where the UE was camping on or which the UE used in the 5GMM-CONNECTED mode when receiving the data;\nc)\tif the UE was in NG-RAN coverage and the \"NCGI\" attribute is included:\n1)\ta mandatory \"amount\" attribute containing the parameter defined in clause 11.6.2.12 indicating the amount of octets received from the ProSe group or in an unicast mode 5G ProSe direct communication:\n-\twhen the UE was camping on a cell identified by the \"NCGI\" attribute when receiving the data; or\n-\twhen the UE used in the 5GMM-CONNECTED mode a cell identified by the \"NCGI\" attribute when receiving the data; and\n2)\tan optional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first reception in the NG-RAN cell;\nd)\tif the UE was in NG-RAN coverage and the \"NCGI\" attribute is not included:\n1)\ta mandatory \"amount\" attribute containing the parameter defined in clause 11.6.2.12 indicating the amount of octets received from the ProSe group or in an unicast mode 5G ProSe direct communication during the in NG-RAN coverage period: and\n2)\tan optional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first reception during the in NG-RAN coverage period;\ne)\tif the UE was out of NG-RAN coverage:\n1)\ta mandatory \"amount\" attribute containing the parameter defined in clause 11.6.2.12 indicating the amount of octets received from the ProSe group or in an unicast mode 5G ProSe direct communication during the out of NG-RAN coverage period; and\n2)\tan optional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first reception during the out of NG-RAN coverage period;\nf)\tan optional \"radio-resources-ind\" attribute containing the parameter defined in clause 11.6.2.13;\ng)\tan optional \"radio-frequency\" attribute containing the parameter defined in clause 11.6.2.14;\nh)\tzero or one <anyExt> element containing elements defined in future releases;\ni)\tzero, one or more elements from other namespaces defined in future releases; and\nj)\tzero, one or more attributes defined in future releases.\nThe <relay-UE> element carries information about a 5G ProSe UE-to-network relay UE. The <relay-UE> element contains:\na)\ta mandatory \"relay-UE-IP-address\" attribute containing the parameter defined in clause 11.6.2.10, of the 5G ProSe UE-to-network relay UE;\nb)\ta mandatory \"relay-UE-id\" attribute containing the parameter defined in clause 11.6.2.11, of the 5G ProSe UE-to-network relay UE;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\nThe <relay> element carries information about a data relay in an unicast mode 5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE,. The <relay> element contains:\na)\ta mandatory \"NCGI\" attribute containing the parameter defined in clause 11.6.2.4, indicating NG-RAN Cell Global Identification of the NG-RAN cell where the UE was camping on or which the UE used in the 5GMM-CONNECTED mode when relaying the data;\nb\ta mandatory \"amount\" attribute containing the parameter defined in clause 11.6.2.12 indicating the amount of octets relayed by the UE used in the 5GMM-CONNECTED mode a cell identified by the \"NCGI\" attribute when relaying the data;\nc)\ta mandatory \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time of the first data relay in the NG-RAN cell;\nd)\tan optional \"radio-resources-ind\" attribute containing the parameter defined in clause 11.6.2.13;\ne)\tan optional \"radio-frequency\" attribute containing the parameter defined in clause 11.6.2.14;\nf)\tzero or one <anyExt> element containing elements defined in future releases;\ng)\tzero, one or more elements from other namespaces defined in future releases; and\nh)\tzero, one or more attributes defined in future releases.\nThe <app-specific-info> element contains an application specific data received from upper layers during the collection period.\nThe <qos-flow> element carries information of PC5 QoS flows used by the UE for 5G ProSe direct communication. The <qos-flow> element contains:\na)\ta mandatory \"qos-flow-id\" attribute containing the parameter defined in clause 11.6.2.15;\nb)\tzero, one or more \"<qos-parameter-set>\" element;\nc)\tan optional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time when the information given in the element start being valid;\nd)\tan optional \"timestamp\" attribute containing the parameter defined in clause 11.6.2.7 indicating date and time when the information given in the element stop being valid;\ne)\ta mandatory \"amount\" attribute containing the parameter defined in clause 11.6.2.12 indicating the amount of octets of the QoS flow transmitted or received;\nf)\tzero or one <anyExt> element containing elements defined in future releases;\ng)\tzero, one or more elements from other namespaces defined in future releases; and\nh)\tzero, one or more attributes defined in future releases.\nThe <qos-parameter-set> element carries information of QoS parameters for the PC5 QoS flows used by the UE for 5G ProSe direct communication. The <qos-parameter-set> element contains:\na)\ta mandatory \"pqi\" attribute containing the parameter defined in clause 11.6.2.16;\nb)\tan optional \"gfbr\" attribute containing the parameter defined in clause 11.6.2.17;\nc)\tan optional \"mfbr\" attribute containing the parameter defined in clause 11.6.2.18;\nd)\tan optional \"averaging-window\" attribute containing the parameter defined in clause 11.6.2.19;\ne)\tan optional \"Resource-type\" attribute containing the parameter defined in clause 11.6.2.20;\nf)\tan optional \"default-priority-level\" attribute containing the parameter defined in clause 11.6.2.21;\ng)\tan optional \"packet-delay-budget\" attribute containing the parameter defined in clause 11.6.2.22;\nh)\tan optional \"packet-error-rate\" attribute containing the parameter defined in clause 11.6.2.23;\ni)\tan optional \"default-maximum-data-burst-volume\" attribute containing the parameter defined in clause 11.6.2.24;\nj)\tzero or one <anyExt> element containing elements defined in future releases;\nk)\tzero, one or more elements from other namespaces defined in future releases; and\nl)\tzero, one or more attributes defined in future releases.\nThe <PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE> element contains:\na)\tone of <response-accept> element and <response-reject> element;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero, one or more elements from other namespaces defined in future releases; and\nd)\tzero, one or more attributes defined in future releases.\nThe <response-accept> element indicates that a related PROSE_USAGE_INFORMATION_REPORT_LIST message was accepted. The <response-accept> element contains:\na)\t<transaction-ID> element containing the parameter defined in clause 11.6.2.1 indicating the value of the transaction ID of the related PROSE_USAGE_INFORMATION_REPORT_LIST message;\nb)\tzero or one <anyExt> element containing elements defined in future releases;\nc)\tzero, one or more elements from other namespaces defined in future releases; and\nd)\tzero, one or more attributes defined in future releases.\nThe <response-reject> element indicates that a related PROSE_USAGE_INFORMATION_REPORT_LIST message was rejected. The <response-reject> element contains:\na)\t<transaction-ID> element containing the parameter defined in clause 11.6.2.1 indicating the value of the transaction ID of the related PROSE_USAGE_INFORMATION_REPORT_LIST message;\nb)\t<cause-value> element containing the parameter defined in clause 11.6.2.6;\nc)\tzero or one <anyExt> element containing elements defined in future releases;\nd)\tzero, one or more elements from other namespaces defined in future releases; and\ne)\tzero, one or more attributes defined in future releases.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "11\tInformation elements coding",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "11.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause contains general message format and information elements coding for the messages used in the procedures described in the present document.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "11.2\t5G ProSe direct discovery message formats",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.2.1\tProSe direct discovery PC5 message type",
                            "text_content": "This parameter is used to indicate the type of ProSe direct discovery message over PC5 interface.\nThis parameter is coded as shown in figure 11.2.1.1 and table 11.2.1.1.\nThe ProSe direct discovery PC5 message type is a type 1 information element, with the length of 1 octet.\n\nFigure 11.2.1.1: ProSe direct discovery PC5 message type parameter\nTable 11.2.1.1: ProSe direct discovery PC5 message type parameter\nNOTE 1:\tContent type '0000' (announce/response) is used for model A announcing and for model B discoveree operation.\nNOTE 2:\tContent type '0100' (UE-to-network relay discovery announcement or UE-to-network relay discovery response) is used for model A announcing and for model B discoveree operation.\nNOTE 3:\tContent type '0110' (group member discovery announcement or group member discovery response) is used for model A announcing and for model B discoveree operation.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 53,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.1.1: ProSe direct discovery PC5 message type parameter",
                                    "table number": 54,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.2\tProSe application code",
                            "text_content": "This parameter is used to contain a ProSe application code. The format of the ProSe application code is as follows:\na)\tif the ProSe application code is included in a PROSE PC5 DISCOVERY message and application-controlled extension is used, the ProSe application code is encoded as a 184 bitstring composed of:\n1)\tthe ProSe application code prefix; and\n2)\tthe ProSe application code suffix; or\nb)\tin all other cases, the ProSe application is encoded as a 184 bitstring as defined in 3GPP TS 23.003 [12].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.3\tProSe restricted code",
                            "text_content": "This parameter is used to contain a ProSe restricted code. The format of the ProSe restricted code is as follows:\na)\tif the ProSe restricted code is included in a PROSE PC5 DISCOVERY message and application-controlled extension is not used, the ProSe restricted code is encoded as a 184 bitstring composed of:\n1)\tthe ProSe restricted code in the 64 most significant bits; and\n2)\tthe remaining 120 bits set to zero;\nb)\tif the ProSe restricted code is included in a PROSE PC5 DISCOVERY message and application-controlled extension is used, the ProSe restricted code is encoded as a 184 bitstring composed of\n1)\tthe ProSe restricted code prefix in the 64 most significant bits;\n2)\tthe ProSe restricted code suffix; and\n3)\tany remaining unused least significant bits set to zero; or\nc)\tin all other cases, the ProSe restricted code is encoded as a 64 bitstring as defined in 3GPP TS 23.003 [12].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.4\tMIC",
                            "text_content": "This parameter is used to carry the MIC (Message Integrity Check) associated with the ProSe application code contained in a PROSE PC5 DISCOVERY message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.5\tUTC-based counter",
                            "text_content": "This parameter is used to indicate the UTC time associated with the discovery transmission opportunity in which a PROSE PC5 DISCOVERY message is sent. It is expressed in unit of seconds and coded in binary format as the 32 least significant bits of the Coordinated Universal Time as defined in 3GPP TS 38.331 [13].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.6\tApplication layer group ID",
                            "text_content": "The application layer group ID parameter carries an identifier of an application layer group that the UE belongs to.\nThe application layer group ID information element is coded as shown in figure 11.2.6.1 and table 11.2.6.1.\nThe application layer group ID is a type 4 information element.\n\nFigure 11.2.6.1: Application layer group ID information element\nTable 11.2.6.1: Application layer group ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 55,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.6.1: Application layer group ID information element",
                                    "table number": 56,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.7\tUser info ID",
                            "text_content": "The user info ID parameter carries a user info ID as specified in 3GPP TS 23.304 [2]. The value of the user info ID parameter is a 48-bit long bit string. The format of the user info ID parameter is out of scope of this specification.\nNOTE:\tDepending on operation, user info ID is indicated as the announcer info parameter, the discoverer info parameter or the discoveree info parameter.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.8\tRelay service code",
                            "text_content": "The relay service code parameter is used to indicate the connectivity service that:\na)\tthe 5G ProSe UE-to-network relay provides to the 5G ProSe remote UE in the UE-to-network relay direct discovery.; or\nb) the 5G ProSe UE-to-UE relay provides to the 5G ProSe end UE in the UE-to-UE relay direct discovery.\nThe value of the relay service code parameter is 24-bit long bit string. The format of the relay service code parameter is out of scope of this specification.\nThe relay service code is a type 3 information element with a length of 4 octets.\nThe relay service code IE is coded as shown in figure 11.2.8.1 and table 11.2.8.1.\n\nFigure 11.2.8.1: Relay service code information element\nTable 11.2.8.1: Relay service code information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 57,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.8.1: Relay service code information element",
                                    "table number": 58,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.9\tStatus indicator",
                            "text_content": "The status indicator parameter is used to indicate the status of 5G ProSe UE-to-network relay UE or 5G ProSe UE-to-UE relay UE.\nThe status indicator is a type 3 information element with a length of 2 octets.\nThe status indicator IE is coded as shown in figure 11.2.9.1 and table 11.2.9.1.\n\nFigure 11.2.9.1: Status indicator information element\nTable 11.2.9.1: Status indicator information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 59,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.9.1: Status indicator information element",
                                    "table number": 60,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.10\tTAI",
                            "text_content": "The TAI information element in coded as the 5GS tracking area identity specified in clause 9.11.3.8 of 3GPP TS 24.501 [11].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.11\tUTC-based counter LSB",
                            "text_content": "This parameter is used to carrythe four least significant bits of the UTC-based counter associated with the discovery transmission opportunity used by the UE.\nThe UTC-based counter LSB IE is a type 3 information element with a length of 2 octets.\nThe UTC-based counter LSB IE is coded as shown in figures 11.2.11.1, figure 11.2.11.2 and table 11.2.11.1.\n\n\nFigure 11.2.11.1: UTC-based counter LSB parameter for open 5G ProSe direct discovery\nTable 11.2.11.1: UTC-based counter LSB information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 61,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.11.1: UTC-based counter LSB information element",
                                    "table number": 62,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.12\tNCGI",
                            "text_content": "The NCGI information element is used to indicate the NCGI of the serving cell where the 5G ProSe UE-to-network relay UE is camping.\nThe NCGI is a type 3 information element with a length of 9 octets.\nThe NCGI information element is coded as shown in figure 11.2.12.1 and table 11.2.12.2.\n\n\nFigure 11.2.12.1: UE-to-network relay NCGI parameter\nTable 11.2.12.1: UE-to-network relay NCGI parameter\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 63,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.12.1: UE-to-network relay NCGI parameter",
                                    "table number": 64,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.13\tMetadata",
                            "text_content": "The Metadata parameter carries the application layer metadata information.\nThe Metadata information element is coded as shown in figure 11.2.13.1 and table 11.2.13.1.\nThe Metadata is a type 6 information element.\n\n\nFigure 11.2.13.1: Metadata information element\nTable 11.2.13.1: Metadata information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 65,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.13.1: Metadata information element",
                                    "table number": 66,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.14\tRRC container",
                            "text_content": "The RRC container information element is used to indicate the RRC container information received from the lower layers.\nThe RRC container is a type 4 information element.\nThe RRC container information element is coded as shown in figure 11.2.14.1 and table 11.2.14.1.\n\n\nFigure 11.2.14.1: RRC container information element\nTable 11.2.14.1: RRC container information element\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 67,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.14.1: RRC container information element",
                                    "table number": 68,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.15\tApplication layer ID",
                            "text_content": "The purpose of the application layer ID parameter information element carries an application layer ID as specified in 3GPP TS 23.304 [2].\nThe application layer ID information element is coded as shown in figure 11.2.15.1 and table 11.2.15.1.\nThe application layer ID is a type 4 information element.\n\nFigure 11.2.15.1: Application layer ID information element\nTable 11.2.15.1: Application layer ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 69,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.15.1: Application layer ID information element",
                                    "table number": 70,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.16\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.17\tDirect discovery set",
                            "text_content": "The purpose of the direct discovery set information element is to carry the direct discovery set as specified in 3GPP TS 33.503 [34].\nThe direct discovery set information element is a type 6 information element with the minimum length of 12 octets and the maximum length of 520 octets.\nThe direct discovery set information element is coded as shown in figure 11.2.17.1 and table 11.2.17.1.\nEditor's Note:\tIt is FFS how to construct the direct discovery set for 5G ProSe UE-to-UE relay discovery model A and Model B.\nFigure 11.2.17.1: Direct discovery set information element\nTable 11.2.17.1: Direct discovery set information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Editor's Note:\tIt is FFS how to construct the direct discovery set for 5G ProSe UE-to-UE relay discovery model A and Model B.",
                                    "table number": 71,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.17.1: Direct discovery set information element",
                                    "table number": 72,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.18\tList of direct discovery sets",
                            "text_content": "The purpose of the list of direct discovery sets information element is to carry a list of direct discovery sets as specified in 3GPP TS 33.503 [34].\nThe list of direct discovery sets information element is a type 6 information element with the minimum length of 15 octets and the maximum length of 8323 octets.\nThe list of direct discovery sets information element is coded as shown in figure 11.2.18.1 and table 11.2.18.1.\nFigure 11.2.18.1: List of direct discovery sets information element\nTable 11.2.18.1: List of direct discovery sets information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The list of direct discovery sets information element is coded as shown in figure 11.2.18.1 and table 11.2.18.1.",
                                    "table number": 73,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.18.1: List of direct discovery sets information element",
                                    "table number": 74,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "11.3\tPC5 signalling message formats",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.3.1\tProSe PC5 signalling message type",
                            "text_content": "The purpose of the ProSe PC5 signalling message type information element is to indicate the type of messages used in ProSe PC5 signalling protocol.\nThe value part of the ProSe PC5 signalling message type information element used in the ProSe PC5 signalling messages is coded as shown in table 11.3.1.1.\nThe ProSe PC5 signalling message type is a type 3 information element, with the length of 1 octet.\nTable 11.3.1.1: ProSe PC5 signalling message type\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.3.1.1: ProSe PC5 signalling message type",
                                    "table number": 75,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.2\tSequence number",
                            "text_content": "The purpose of the Sequence number information element is to uniquely identify a ProSe PC5 signalling message being sent or received. The sending UE will increment the sequence number for each outgoing new ProSe PC5 signalling message.\nThe Sequence number information element is an integer in the 0-255 range.\nThe Sequence number is a type 3 information element, with a length of 1 octet.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.3\tProSe identifier",
                            "text_content": "The purpose of the ProSe identifier parameter is to carry the identifier of a ProSe application.\nThe ProSe identifier information element is coded as shown in figure 11.3.3.1 and table 11.3.3.1.\nThe ProSe identifier is a type 6 information element with a minimum length of 21 octets.\n\nFigure 11.3.3.1: ProSe identifier information element\nTable 11.3.3.1: ProSe identifier information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 76,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.3.1: ProSe identifier information element",
                                    "table number": 77,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.4\tApplication layer ID",
                            "text_content": "The purpose of the application layer ID  information element carries an application layer ID as specified in 3GPP TS 23.304 [2].\nThe application layer ID information element is coded as shown in figure 11.3.4.1 and table 11.3.4.1.\nThe application layer ID is a type 4 information element.\n\nFigure 11.3.4.1: Application layer ID information element\nTable 11.3.4.1: Application layer ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 78,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.4.1: Application layer ID information element",
                                    "table number": 79,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.5\tPC5 QoS flow descriptions",
                            "text_content": "The purpose of the PC5 QoS flow descriptions information element is to indicate a set of PC5 QoS flow descriptions to be used by the UE over the direct link, where each PC5 QoS flow description is a set of parameters as described in clause 5.6 of 3GPP TS 23.304 [2].\nThe PC5 QoS flow descriptions is a type 6 information element with a minimum length of 6 octets. The maximum length for the information element is 65538 octets.\nThe PC5 QoS flow descriptions information element is coded as shown in figure 11.3.5.1, figure 11.3.5.2, figure 11.3.5.3, figure 11.3.5.4 and table 11.3.5.1.\n\nFigure 11.3.5.1: PC5 QoS flow descriptions information element\n\nFigure 11.3.5.2: PC5 QoS flow description\n\nFigure 11.3.5.3: Parameters list\n\nFigure 11.3.5.4: Parameter\nTable 11.3.5.1: PC5 QoS flow descriptions information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 80,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 81,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 82,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 83,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.5.1: PC5 QoS flow descriptions information element",
                                    "table number": 84,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.6\tIP address configuration",
                            "text_content": "The purpose of the IP address configuration information element is to indicate the configuration options for IP address used by the UE over this direct link.\nThe IP address configuration is a type 3 information element with the length of 2 octets.\nThe IP address configuration information element is coded as shown in figure 11.3.6.1 and table 11.3.6.1.\n\nFigure 11.3.6.1: IP address configuration information element\nTable 11.3.6.1: IP address configuration information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 85,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.6.1: IP address configuration information element",
                                    "table number": 86,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.7\tLink local IPv6 address",
                            "text_content": "The purpose of the Link local IPv6 address information element is to indicate the link local IPv6 address.\nThe Link local IPv6 address is a type 3 information element with the length of 17 octets.\nThe Link local IPv6 address information element is coded as shown in figure 11.3.7.1 and table 11.3.7.1.\n\nFigure 11.3.7.1: Link local IPv6 address information element\nTable 11.3.7.1: Link local IPv6 address information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 87,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.7.1: Link local IPv6 address information element",
                                    "table number": 88,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.8\tPC5 signalling protocol cause",
                            "text_content": "The purpose of the PC5 signalling protocol cause information element is to indicate the cause used in the PC5 signalling protocol procedures.\nThe PC5 signalling protocol cause is a type 3 information element with a length of 2 octets.\nThe PC5 signalling protocol cause information element is coded as shown in figure 11.3.8.1 and table 11.3.8.1.\n\nFigure 11.3.8.1: PC5 signalling protocol cause information element\nTable 11.3.8.1: PC5 signalling protocol cause information element\n\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 89,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 90,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.9\tKey establishment information container",
                            "text_content": "The Key establishment information container information element contains information for 5G ProSe direct link key establishment.\nThe Key establishment information container is a type 6 information element with a minimum length of 4 octets.\nThe Key establishment information container information element is coded as shown in figure 11.3.9.1 and table 11.3.9.1.\n\nFigure 11.3.9.1: Key establishment information container information element\nTable 11.3.9.1: Key establishment information container information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 91,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.9.1: Key establishment information container information element",
                                    "table number": 92,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.10\tNonce",
                            "text_content": "The Nonce information element contains a 128-bit nonce used during 5G ProSe direct link security establishment.\nThe Nonce information element is a type 3 information element, with a length of 17 octets.\nThe Nonce information element is coded as shown in figure 11.3.10.1 and table 11.3.10.1.\n\nFigure 11.3.10.1: Nonce information element\nTable 11.3.10.1: Nonce information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 93,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.10.1: Nonce information element",
                                    "table number": 94,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.11\tUE security capabilities",
                            "text_content": "The UE security capabilities information element is used to indicate which security algorithms are supported by the UE.\nThe UE security capabilities is a type 4 information element with a minimum length of 4 octets and a maximum length of 10 octets.\nThe UE security capabilities information element is coded as shown in figure 11.3.11.1 and table 11.3.11.1.\n\nFigure 11.3.11.1: UE security capabilities information element\nTable 11.3.11.1: UE security capabilities information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 95,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.11.1: UE security capabilities information element",
                                    "table number": 96,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.12\tUE PC5 unicast signalling security policy",
                            "text_content": "The purpose of the UE PC5 unicast signalling security policy information element is to indicate the UE's configuration for integrity protection and ciphering of PC5 signalling messages.\nThe UE PC5 unicast signalling security policy is a type 3 information element with a length of 2 octets.\nThe UE PC5 unicast signalling security policy information element is coded as shown in figure 11.3.12.1.1 and table 11.3.12.1.\n\nFigure 11.3.12.1: UE 5G ProSe direct signalling security policy information element\nTable 11.3.12.1: UE PC5 unicast signalling security policy information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 97,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.12.1: UE PC5 unicast signalling security policy information element",
                                    "table number": 98,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.13\tMSB of KNRP-sess ID",
                            "text_content": "The purpose of the MSB of KNRP-sess ID information element is to carry the 8 most significant bits of the KNRP-sess ID.\nThe MSB of KNRP-sess ID information element is a type 3 information element with a length of 2 octets.\nThe MSB of KNRP-sess ID information element is coded as shown in figure 11.3.13.1 and table 11.3.13.1.\n\nFigure 11.3.13.1: MSB of KNRP-sess ID information element\nTable 11.3.13.1: MSB of KNRP-sess ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 99,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.13.1: MSB of KNRP-sess ID information element",
                                    "table number": 100,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.14\tKNRP ID",
                            "text_content": "The purpose of the KNRP ID information element is to carry the identity of the KNRP held by a UE.\nThe KNRP ID is a type 3 information element with a length of 5 octets.\nThe KNRP ID information element is coded as shown in figure 11.3.14.1 and table 11.3.14.1\n\nFigure 11.3.14.1: KNRP ID information element\nTable 11.3.14.1: KNRP ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 101,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.14.1: KNRP ID information element",
                                    "table number": 102,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.15\tLSB of KNRP-sess ID",
                            "text_content": "The purpose of the LSB of KNRP-sess ID information element is to carry the 8 least significant bits of the KNRP-sess ID.\nThe LSB of KNRP-sess ID is a type 3 information element with a length of 2 octets.\nThe LSB of KNRP-sess ID information element is coded as shown in figure 11.3.15.1 and table 12.3.15.1.\n\nFigure 11.3.15.1: LSB of KNRP-sess ID information element\nTable 11.3.15.1: LSB of KNRP-sess ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 103,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.15.1: LSB of KNRP-sess ID information element",
                                    "table number": 104,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.16\tMSBs of KNRP ID",
                            "text_content": "The purpose of the MSBs of KNRP ID information element is to carry the 16 most significant bits of the KNRP ID.\nThe MSBs of KNRP ID is a type 3 information element with a length of 3 octets.\nThe MSBs of KNRP ID information element is coded as shown in figure 11.3.16.1 and table 11.3.16.1.\n\nFigure 11.3.16.1: MSBs of KNRP ID information element\nTable 11.3.16.1: MSBs of KNRP ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 105,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.16.1: MSBs of KNRP ID information element",
                                    "table number": 106,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.17\tLSBs of KNRP ID",
                            "text_content": "The purpose of the LSBs of KNRP ID information element is to carry the 16 least significant bits of the KNRP ID.\nThe LSBs of KNRP ID is a type 3 information element with a length of 3 octets.\nThe LSBs of KNRP ID information element is coded as shown in figure 11.3.17.1 and table 11.3.17.1.\n\nFigure 11.3.17.1: LSBs of KNRP ID information element\nTable 11.3.17.1: LSBs of KNRP ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 107,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.17.1: LSBs of KNRP ID information element",
                                    "table number": 108,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.18\tConfiguration of UE PC5 unicast user plane security protection",
                            "text_content": "The purpose of the configuration of UE PC5 unicast user plane security protection information element is to indicate the agreed configuration for security protection of PC5 user plane data between UEs over the 5G ProSe direct link.\nThe configuration of UE PC5 unicast user plane security protection is a type 3 information element with a length of 2 octets.\nThe configuration of UE PC5 unicast user plane security protection information element is coded as shown in figure 11.3.18.1 and table 11.3.18.1.\n\nFigure 11.3.18.1: Configuration of UE PC5 unicast user plane security protection information element\nTable 11.3.18.1: Configuration of UE PC5 unicast user plane security protection information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 109,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.18.1: Configuration of UE PC5 unicast user plane security protection information element",
                                    "table number": 110,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.19\tLink modification operation code",
                            "text_content": "The purpose of the Link modification operation code information element is to indicate what the operation of the 5G ProSe direct link modification procedure triggered by initiating UE is.\nThe Link modification operation code is a type 3 information element, with a length of 2 octets.\nThe Link modification operation code information element is coded as shown in figure 11.3.19.1 and table 11.3.19.1.\n\nFigure 11.3.19.1: Link modification operation code information element\nTable 11.3.19.1: Link modification operation code information element\n\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 111,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 112,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.20\tKeep-alive counter",
                            "text_content": "The purpose of the Keep-alive counter information element is to indicate the keep-alive counter which is a 32-bit counter used for the 5G ProSe direct link keep-alive procedure.\nThe Keep-alive counter is a type 3 information element with a length of 5 octets.\nThe Keep-alive counter information element is coded as shown in figure 11.3.20.1 and table 11.3.20.1.\n\nFigure 11.3.20.1: Keep-alive counter information element\nTable 11.3.20.1: Keep-alive counter information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 113,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.20.1: Keep-alive counter information element",
                                    "table number": 114,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.21\tMaximum inactivity period",
                            "text_content": "The purpose of the Maximum inactivity period information element is to indicate the maximum inactivity period of the initiating UE during a 5G ProSe direct link keep-alive procedure.\nThe Maximum inactivity period is a type 3 information element, with a length of 5 octets.\nThe Maximum inactivity period information element is coded as shown in figure 11.3.21.1 and table 11.3.21.1.\n\nFigure 11.3.21.1: Maximum inactivity period information element\nTable 11.3.21.1: Maximum inactivity period information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 115,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.21.1: Maximum inactivity period information element",
                                    "table number": 116,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.22\tSelected security algorithms",
                            "text_content": "The purpose of the Selected security algorithms information element is to indicate the algorithms to be used for ciphering and integrity protection.\nThe Selected security algorithms is a type 3 information element with a length of 2 octets.\nThe Selected security algorithms information element is coded as shown in figure 11.3.22.1 and table 11.3.22.1.\n\nFigure 11.3.22.1: Selected security algorithms information element\nTable 11.3.22.1: Selected security algorithms information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 117,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.22.1: Selected security algorithms information element",
                                    "table number": 118,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.23\tUE PC5 unicast user plane security policy",
                            "text_content": "The purpose of the UE PC5 unicast user plane security policy information element is to indicate the UE's configuration for integrity protection and ciphering of PC5 user plane data.\nThe UE PC5 unicast user plane security policy is a type 3 information element with a length of 2 octets.\nThe UE PC5 unicast user plane security policy information element is coded as shown in figure 11.3.23.1 and table 11.3.23.1.\n\nFigure 11.3.23.1: UE PC5 unicast user plane security policy information element\nTable 11.3.23.1: UE PC5 unicast user plane security policy information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 119,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.23.1: UE PC5 unicast user plane security policy information element",
                                    "table number": 120,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.24\tRe-authentication indication",
                            "text_content": "The purpose of the Re-authentication indication information element is to indication that KNRP needs to be refreshed.\nThe Re-authentication indication information element is a type 3 information element, with a length of 2 octets.\nThe Re-authentication indication information element is coded as shown in figure 11.3.24.1 and table 11.3.24.1.\n\nFigure 11.3.24.1: Re-authentication indication information element\nTable 11.3.24.1: Re-authentication indication information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 121,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.24.1: Re-authentication indication information element",
                                    "table number": 122,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.25\tLayer-2 ID",
                            "text_content": "The purpose of the layer-2 ID information element is to indicate the layer-2 ID that is used by UE.\nThe layer-2 ID is a type 3 information element with a length of 4 octets.\nThe layer-2 ID information element is coded as shown in figure 11.3.25.1 and table 11.3.25.1.\n\nFigure 11.3.25.1: Layer-2 ID information element\nTable 11.3.25.1: Layer-2 ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 123,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.25.1: Layer-2 ID information element",
                                    "table number": 124,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.26\tRelay service code",
                            "text_content": "The purpose of the relay service code information element is to identify a connectivity service the 5G ProSe UE-to-network relay or the 5G ProSe UE-to-UE relay UE provides.\nThe relay service code information element is coded as shown in figure 11.3.26.1 and table 11.3.26.1.\nThe relay service code is a type 3 information element with a length of 4 octets.\n\nFigure 11.3.26.1: Relay service code information element\nTable 11.3.26.1: Relay service code information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 125,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.26.1: Relay service code information element",
                                    "table number": 126,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.27\tGPRS timer",
                            "text_content": "See clause 10.5.7.3 in 3GPP TS 24.008 [31].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.28\tAdditional parametersannouncement request refresh timer T5106",
                            "text_content": "This parameter is used to carry the value of Additional parameters announcement request refresh timer. It is an integer in the 1-1440 range representing the timer value in unit of minutes.\nThe Additional parameters announcement request refresh timer T5106 is a type 3 information element with a length of 2 octets.\nThe Additional parameters announcement request refresh timer T5106 IE is coded as shown in figure 11.3.28.1 and table 11.3.28.1.\n\nFigure 11.3.28.1: Additional parameters announcement request refresh timer T5106 information element\nTable 11.3.28.1: Additional parameters announcement request refresh timer T5106 information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 127,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.28.1: Additional parameters announcement request refresh timer T5106 information element",
                                    "table number": 128,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.29\tPC5 QoS rules",
                            "text_content": "The purpose of the PC5 QoS rules information element is to indicate a set of PC5 QoS rules to be used by the UE over the direct link, where each PC5 QoS rule is a set of parameters as described in clause 5.6.1 of 3GPP TS 23.304 [2].\nThe PC5 QoS rules information element is a type 6 information element with a minimum length of 7 octets. The maximum length for the information element is 65538 octets.\nThe PC5 QoS flow rules information element is coded as shown in figure 11.3.29.1, figure 11.3.29.2, figure 11.3.29.3, figure 11.3.29.4 and table 11.3.29.1.\n\nFigure 11.3.29.1: PC5 QoS rules information element\nFigure 11.3.29.2: PC5 QoS rule (u=a+2 or u=b)\n\nFigure 11.3.29.3: Packet filter list when the rule operation is \"modify existing PC5 QoS rule and delete packet filters\" (m=N+7)\n\nFigure 11.3.29.4: Packet filter list when the rule operation is \"create new PC5 QoS rule\", or \"modify existing PC5 QoS rule and add packet filters\" or \"modify existing PC5 QoS rule and replace all packet filters\"\nTable 11.3.29.1: PC5 QoS rules information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 129,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Figure 11.3.29.1: PC5 QoS rules information element",
                                    "table number": 130,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 131,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 132,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.29.1: PC5 QoS rules information element",
                                    "table number": 133,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.30\t5GS mobile identity",
                            "text_content": "See clause 9.11.3.4 in 3GPP TS 24.501 [11] with Type of identity set to \"SUCI\", \"IMEI\" or \"IMEISV\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.31\tEAP message",
                            "text_content": "The purpose of the EAP message information element is to transport an EAP message as specified in IETF RFC 3748 [39].\nThe EAP message information element is coded as specified in clause 9.11.2.2 of 3GPP TS 24.501 [11].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.32\tPRUK ID",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.32\tUser security key ID",
                            "text_content": "The purpose of the User security key ID information element is to carry the identity of the UP-PRUK or the CP-PRUK.\nThe User security key ID is a type 4 information element with a minimal length of 3 octets and a maximum length of 255 octets.\nThe User security key ID information element is coded as shown in figure 11.3.32.1 and table 11.3.32.1.\n\n\nFigure 11.3.32.1: User security key ID information element\nTable 11.3.32.1: User security key ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 134,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.32.1: User security key ID information element",
                                    "table number": 135,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.33\tPLMN ID",
                            "text_content": "The PLMN ID information element is coded as the PLMN identity information element specified in clause 9.11.3.85 of 3GPP TS 24.501 [11].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.34\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.35\tGPI",
                            "text_content": "The GPI information element contains the GBA Push Information used for the security procedure over user plane as specified in 3GPP TS 33.503 [34].\nThe Key GPI is a type 6 information element.\nThe GPI information element is coded as shown in figure 11.3.35.1 and table 11.3.35.1.\n\n\nFigure 11.3.35.1: GPI information element\nTable 11.3.35.1: GPI information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 136,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.35.1: GPI information element",
                                    "table number": 137,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.36\tRAND",
                            "text_content": "The purpose of the RAND information element is to provide the UE with a non-predictable challenge (see 3GPP TS 33.503 [34]).\nThe RAND information element is coded as shown in figure 11.3.36.1 and table 11.3.36.1.\nThe RAND is a type 3 information element with a length of 17 octets.\n\n\nFigure 11.3.36.1: RAND information element\nTable 11.3.36.1: RAND information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 138,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.36.1: RAND information element",
                                    "table number": 139,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.37\tAUTS",
                            "text_content": "The purpose of the AUTS information element is to provide the network with the necessary information to begin a re-synchronisation (see 3GPP TS 33.503 [34]).\nThe AUTS information element is coded as shown in figure 11.3.37.1 and table 11.3.37.1.\nThe AUTS is a type 3 information element with a length of 15 octets.\n\n\nFigure 11.3.37.1: AUTS information element\nTable 11.3.37.1: AUTS information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 140,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.37.1: AUTS information element",
                                    "table number": 141,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.38\tMIC",
                            "text_content": "This parameter is used to carry the MIC value for integrity protection of the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.\nThe MIC information element is coded as shown in figure 11.3.38.1 and table 11.3.38.1.\nThe MIC IE is a type 3 information element with a length of 5 octets.\n\n\nFigure 11.3.38.1: MIC information element\nTable 11.3.38.1: MIC information element\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 142,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.38.1: MIC information element",
                                    "table number": 143,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.39\tUser info ID",
                            "text_content": "The purpose of the user info ID information element is to carry a user info ID as specified in 3GPP TS 23.304 [2]. The format of the user info ID is out of scope of this specification.\nThe User info ID is a type 4 information element.\nThe User info ID information element is coded as shown in figure 11.3.39.1 and table 11.3.39.1.\n\nFigure 11.3.39.1: User info ID information element\nTable 11.3.39.1: User info ID information element\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 144,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.39.1: User info ID information element",
                                    "table number": 145,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.40\tQoS flow descriptions",
                            "text_content": "The QoS flow descriptions information element is coded as the QoS flow descriptions specified in clause 9.11.4.12 of 3GPP TS 24.501 [11].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.41\tPC5 signalling protocol cause 2",
                            "text_content": "The purpose of the PC5 signalling protocol cause 2 information element is to indicate the cause used in the PC5 signalling protocol procedures.\nThe PC5 signalling protocol cause 2 is a type 4 information element with 3 octets length.\nThe PC5 signalling protocol cause information element 2 is coded as shown in figure 11.3.41.1 and table 11.3.41.1.\nFigure 11.3.41.1: PC5 signalling protocol cause 2 information element\nTable 11.3.41.1: PC5 signalling protocol cause 2 information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The PC5 signalling protocol cause information element 2 is coded as shown in figure 11.3.41.1 and table 11.3.41.1.",
                                    "table number": 146,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.41.1: PC5 signalling protocol cause 2 information element",
                                    "table number": 147,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.42\tIP address/prefix needed indication",
                            "text_content": "The purpose of the IP address/prefix needed indication information element is to indicate that a new IP address/prefix to be allocated by the 5G ProSe layer-3 UE-to-UE relay UE.\nThe IP address/prefix needed indication information element is a type 1 information element, with a length of 1 octets.\nThe IP address/prefix needed indication information element is coded as shown in figure 11.3.42.1 and table 11.3.42.1.\nFigure 11.3.42.1: IP address/prefix needed indication information element\nTable 11.3.42.1: IP address/prefix needed indication information element\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The IP address/prefix needed indication information element is coded as shown in figure 11.3.42.1 and table 11.3.42.1.",
                                    "table number": 148,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.42.1: IP address/prefix needed indication information element",
                                    "table number": 149,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.43\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.44\tList of Link local IPv6 address",
                            "text_content": "The purpose of the list of Link local IPv6 addresses information element is to indicate a list of Link local IPv6 addresses.\nThe list of Link local IPv6 addresses is a type 4 information element with a minimum length of 19 octets. The maximum length for the information element is 257 octets.\nThe list of Link local IPv6 addresses information element is coded as shown in figure 11.3.z.1. Each Link local IPv6 address is coded as shown in figure 11.3.44.1 and table 11.3.44.1.\n\nFigure 11.3.44.1: List of Link local IPv6 addresses information element\nTable 11.3.44.1: List of Link local IPv6 addresses information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 150,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.44.1: List of Link local IPv6 addresses information element",
                                    "table number": 151,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.45\tMAC address",
                            "text_content": "The purpose of the MAC address information element is to signal the MAC address of the UE when the 5G ProSe direct link is for Ethernet traffic.\nThe MAC address information element is coded as shown in figure 11.3.45.1 and table 11.3.45.1.\nThe MAC address is a type 4 information element with a length of 8 octets.\nFigure 11.3.45.1: MAC address information element\nTable 11.3.45.1: MAC address information element\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The MAC address is a type 4 information element with a length of 8 octets.",
                                    "table number": 152,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.45.1: MAC address information element",
                                    "table number": 153,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.46\tRelay reselection indication",
                            "text_content": "The relay reselection indication parameter is used to indicate whether the direct link modification procedure is for the negotiated 5G ProSe UE-to-UE relay reselection.\nThe relay reselection indication is a type 1 information element with a length of 1 octet.\nThe relay reselection indication IE is coded as shown in figure 11.3.46.1 and table 11.3.46.1.\n\nFigure 11.3.46.1: Relay reselection indication information element\nTable 11.3.46.1: Relay reselection indication information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 154,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.46.1: Relay reselection indication information element",
                                    "table number": 155,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.47\tList of user info ID",
                            "text_content": "The list of user info ID parameter is to indicate a list of user info IDs.\nThe list of user info ID information element is a type 4 information element with the minimum length of 4 octets and the maximum length of 257 length.\nThe list of user info ID information element is coded as shown in figure 11.3.37.1 and table 11.3.37.1.\nFigure 11.3.47.1: List of user info ID information element\nTable 11.3.47.1: List of user info ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The list of user info ID information element is coded as shown in figure 11.3.37.1 and table 11.3.37.1.",
                                    "table number": 156,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.47.1: List of user info ID information element",
                                    "table number": 157,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.48\tList of candidates U2U relay UE layer-2 IDs",
                            "text_content": "The list of candidates U2U relay UE layer-2 IDs parameter is to indicate a list of the candidates 5G ProSe UE-to-UE relay UE user info ID and the associated layer-2 ID.\nThe list of candidates U2U relay UE layer-2 IDs information element is a type 4 information element with the minimum length of 7 octets and the maximum length of 257 length.\nThe list of candidates U2U relay UE layer-2 IDs information element is coded as shown in figure 11.3.48.1 and table 11.3.48.1.\nFigure 11.3.48.1: List of candidates U2U relay UE layer-2 IDs information element\nTable 11.3.48.1: List of candidates U2U relay UE layer-2 IDs information element\n\nFigure 11.3.48.2: Candidate U2U relay UE layer-2 ID\nTable 11.3.48.2: Candidate U2U relay UE layer-2 ID\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The list of candidates U2U relay UE layer-2 IDs information element is coded as shown in figure 11.3.48.1 and table 11.3.48.1.",
                                    "table number": 158,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.48.1: List of candidates U2U relay UE layer-2 IDs information element",
                                    "table number": 159,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 160,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.48.2: Candidate U2U relay UE layer-2 ID",
                                    "table number": 161,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.49\tUE IP address",
                            "text_content": "The purpose of the UE IP address information element is to indicate the IP address of the UE.\nThe UE IP address is a type 4 information element with minimum length of 7 octets and a maximum length of 19 octets.\nThe UE IP address information element is coded as shown in figure 11.3.49.1 and table 11.3.49.1.\nFigure 11.3.49.1: UE IP address\nTable 11.3.49.1: UE IP address\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The UE IP address information element is coded as shown in figure 11.3.49.1 and table 11.3.49.1.",
                                    "table number": 162,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.49.1: UE IP address",
                                    "table number": 163,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.50\tList of UE IP addresses",
                            "text_content": "The purpose of the list of UE IP addresses information element is to indicate a list of IP addresses of the UEs.\nThe list of UE IP addresses is a type 4 information element with a minimum length of 9 octets and a maximum length of 255 octets..\nThe List of UE IP addresses information element is coded as shown in figure 11.3.50.1 and table 11.3.50.1.\n\nFigure 11.3.50.1: List of UE IP addresses information element\nTable 11.3.50.1: List of UE IP addresses information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 164,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.50.1: List of UE IP addresses information element",
                                    "table number": 165,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.50\t5GS identity type",
                            "text_content": "See clause 9.11.3.3 of 3GPP TS 24.501 [11].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.51\tSpare half octet",
                            "text_content": "This element is used in the description of PC5 signalling messages when an odd number of half octet type 1 information elements are used. This element is filled with spare bits set to zero and is placed in bits 5 to 8 of the octet unless otherwise specified.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.3.52\tMSBs of KNRP ID 2",
                            "text_content": "The purpose of the MSBs of KNRP ID 2 information element is to carry the 16 most significant bits of the KNRP ID.\nThe MSBs of KNRP ID 2 information element is a type 4 information element with a length of 4 octets.\nThe MSBs of KNRP ID 2 information element is coded as shown in figure 11.3.52.1 and table 11.3.52.1.\n\nFigure 11.3.52.1: MSBs of KNRP ID 2 information element\nTable 11.3.52.1: MSBs of KNRP ID 2 information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 166,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.52.1: MSBs of KNRP ID 2 information element",
                                    "table number": 167,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.53\tLSBs of KNRP ID 2",
                            "text_content": "The purpose of the LSBs of KNRP ID 2 information element is to carry the 16 least significant bits of the KNRP ID.\nThe LSBs of KNRP ID 2 information element is a type 4 information element with a length of 4 octets.\nThe LSBs of KNRP ID 2 information element is coded as shown in figure 11.3.53.1 and table 11.3.53.1.\n\nFigure 11.3.53.1: LSBs of KNRP ID 2 information element\nTable 11.3.53.1: LSBs of KNRP ID 2 information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 168,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3.53.1: LSBs of KNRP ID 2 information element",
                                    "table number": 169,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.54\tAnnounce prohibited indication",
                            "text_content": "The announce prohibited indication parameter is used to indicate whether, or not, a 5G ProSe UE-to-UE relay UE is prohibited from broadcasting the user info of an end UEincluded in the direct discovery set during the procedure of 5G ProSe UE-to-UE relay discovery over PC5 interface with model A.\nThe announce prohibited indication is a type 1 information element with a length of 1 octet.\nThe announce prohibited indication IE is coded as shown in figure 11.2.54.1 and table 11.2.54.1.\n\nFigure 11.2.54.1: Announce prohibited indication information element\nTable 11.2.54.1: Announce prohibited indication information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 170,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.2.54.1: Announce prohibited indication information element",
                                    "table number": 171,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "11.4\t5G ProSe direct discovery message over PC3a formats",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.4.1\tData types format in XML schema",
                            "text_content": "To exchange structured information over the transport protocol, XML text format/notation is introduced.\nThe corresponding XML data types for the data types used in ProSe messages are provided in table 11.4.1.1.\nTable 11.4.1.1: Primitive or derived types for ProSe parameter type\n\nFor complex data types described in clause 11.4.2, an XML \"complexType\" can be used.\nMessage construction shall be compliant with W3C REC-xmlschema-2-20041028: \"XML Schema Part 2: Datatypes\" [29]\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.4.1.1: Primitive or derived types for ProSe parameter type",
                                    "table number": 172,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.4.2\tParameters in 5G ProSe direct discovery messages over PC3a",
                            "text_content": "This parameter is used to uniquely identify a PC3a control protocol for ProSe direct discovery transaction when it is combined with other PC3a control protocol for ProSe direct discovery transactions in the same transport message. The UE shall set this parameter to a new number for each outgoing new discovery request. The transaction ID is an integer in the 0-255 range.\nThis parameter is used to indicate the type of discovery request (announce, monitor, query, or response) contained in a DISCOVERY_REQUEST message. It is an integer in the 0-255 range encoded in table 11.4.2.2.1.\nTable 11.4.2.2.1: Command\n\n\nThis parameter is used to carry an identity used for open 5G ProSe direct discovery, identifying application related information for the ProSe-enabled UE. It is coded as specified in 3GPP TS 23.003 [12].\nThis parameter is used to identify the particular application that triggers the DISCOVERY_REQUEST message. The Application identity information element is coded as the ProSe identifier specified in clause 11.3.3.\nThis parameter is used to contain a ProSe application code. The format of the ProSe application code is as follows:\na)\tif the ProSe application code is included in a MATCH_REPORT message and application-controlled extension is used, the ProSe application code is encoded as a 184 bitstring composed of:\n1)\tthe ProSe application code Prefix; and\n2)\tthe ProSe application code Suffix; or\nb)\tin all other cases, the ProSe application is encoded as a 184 bitstring as defined in 3GPP TS 23.003 [12].\nThis parameter is used to carry the value of validity timer T5060 associated with a ProSe application code. It is an integer in the 1-525600 range representing the timer value in unit of minutes.\nThis parameter is used to indicate the particular reason why a DISCOVERY_REQUEST or MATCH_REPORT message from the UE has been rejected by the 5G DDNMF. It is an integer in the 0-255 range encoded in table 11.4.2.8.1.\nTable 11.4.2.8.1: PC3a control protocol cause value\n\nThe elements in the discovery filter parameter are listed below.\na)\tProSe application code: The ProSe application code is used by a monitoring UE for full or partial matching of PROSE PC5 DISCOVERY messages received on the PC5 interface (see clause 10.2.1). Only one code is allowed in a discovery filter;\nb)\tProSe application mask: a bitmask provided by the 5G DDNMF in order to allow the monitoring UE to perform a full matching or partial matching of PROSE PC5 DISCOVERY messages received on the PC5 interface. A ProSe application mask with all bits set to \"1\" is used for full matching. One or more ProSe application masks may be included in a discovery filter. The length of the ProSe application mask is as same as the length of ProSe application code; and\nc)\tTTL Timer T5064: time-to-live duration for which the associated discovery filter is valid, after which it shall not be used. It is an integer in the 1-525600 range representing the timer value in unit of minutes.\nThis parameter is used to indicate the PLMN ID of the PLMN in which the PROSE PC5 DISCOVERY message containing a ProSe application code for which there was a match event was received. It is coded as specified in 3GPP TS 23.003 [12].\nThis parameter is used to indicate the PLMN ID of the PLMN in which the requesting UE is registered. It is coded as specified in 3GPP TS 23.003 [12].\nThis parameter is used to indicate the UTC time associated with the discovery transmission opportunity in which a PROSE PC5 DISCOVERY message is sent. This parameter is also used to indicate the UTC time associated with the security protected relay service code for 5G ProSe UE-to-network relay when PROSE DIRECT LINK ESTABLISHMENT REQUEST message is sent. It is expressed in unit of seconds and coded in binary format as the 32 least significant bits of the coordinated universal time as defined in 3GPP TS 38.331 [13].\nThis parameter is used to carry the value of validity timer T5072 associated with a ProSe application code for which there was a match event. It is an integer in the 1-525600 range representing the timer value in unit of minutes.\nThis parameter is used to indicate whether the UE wishes to receive the latest metadata information associated with the ProSe application ID or RPAUID in the MATCH_REPORT_ACK from the 5G DDNMF. It is a Boolean value coded as follows:\na)\tFalse: the UE does not wish to receive the latest metadata information associated with the ProSe application ID or RPAUID in the MATCH_REPORT_ACK from the 5G DDNMF; or\nb)\tTrue: the UE wishes to receive the latest metadata information associated with the ProSe application ID or RPAUID in the MATCH_REPORT_ACK message from the 5G DDNMF.\nThis parameter is used to carry the metadata that is associated with the ProSe application ID contained in the MATCH_REPORT_ACK message. The purpose of the metadata is to carry additional application-layer information associated with a particular ProSe application ID. Examples of such information are postal address, phone number, URL etc. The length and contents of the metadata are out of scope of 3GPP. The format of the metadata is a UTF8-encoded string.\nThis parameter is used to carry the current UTC-based time at the 5G DDNMF. The format of this parameter follows the XML data type defined in table 11.4.1.1 for ProSe parameter type \"Time\".\nThis parameter is used to indicate the maximum time difference between the time on the UE's ProSe clock and the UTC-based counter associated with the discovery slot in seconds, as specified in 3GPP TS 33.503 [34]. The Max offset is an integer in the 1-32 range.\nThis parameter is used to indicate the type of ProSe direct discovery contained in the DISCOVERY_REQUEST message or MATCH_REPORT message. It is an integer in the 0-3 range encoded as table 11.4.2.18.1.\nTable 11.4.2.18.1: Discovery type\n\nThis parameter is used to carry the value of match report refresh timer T5074 associated with a ProSe application code for which there was a match event. It is an integer in the 1-525600 range representing the timer value in unit of minutes.\nDuring the announce request procedure for open 5G ProSe direct discovery or restricted 5G ProSe direct discovery model A, the requested timer element is used to carry the length of validity timer associated with the ProSe application code or the ProSe restricted code that the UE expects to receive from the 5G DDNMF. When the procedure is to inform the 5G DDNMF that the UE wants to stop announcing a ProSe application code or a ProSe restricted code before the associated valid timer expires, the requested timer shall be set to 0.\nDuring the monitor request procedure for open 5G ProSe direct discovery or restricted 5G ProSe direct discovery model A, the requested timer element is only used to inform the 5G DDNMF that the UE wants to stop monitoring using discovery filter(s) or restricted discovery filter(s). The requested timer shall be set to 0.\nIt is an integer in the 0-525600 range representing the timer value in unit of minutes.\nThis parameter is used to uniquely identify a PC3a control protocol for ProSe direct discovery transaction when it is combined with other PC3a control protocol for ProSe direct discovery transactions in the same transport message. The 5G DDNMF shall set this parameter to a new number for each outgoing new request. The DDNMF transaction ID is an integer in the 0-255 range.\nThis parameter is used to carry the following:\na)\tthe updated information for an announcing UE in restricted discovery with a new ProSe restricted code to replace the old one in the discovery entry and the corresponding validity timer. In this case the parameter shall contain the following:\n1)\tProSe restricted code: See clause 11.4.2.27; and\n2)\tvalidity timer T5062: See clause 11.4.2.32.\nb)\tthe updated information for a monitoring UE in restricted discovery with a new set of restricted discovery filters to be used for a given discovery entry. In this case the parameter shall contain one or more restricted discovery filters as defined in clause 11.4.2.30;\nc)\tthe updated information for an announcing UE in open discovery with a new ProSe application code to replace the old one in the discovery entry and the corresponding validity timer. In this case the parameter shall contain:\n1)\tProSe application code: See clause 11.4.2.6; and\n2)\tvalidity timer T5060: See clause 11.4.2.7; or\nd)\tthe updated information for a monitoring UE in open discovery with a new set of discovery filters to be used for a given discovery entry. In this case the parameter shall contain one or more discovery filters defined in clause 11.4.2.9.\nThis parameter is used to carry the RPAUID, which is an identity used for restricted 5G ProSe direct discovery, identifying application related information for the 5G ProSe-enabled UE.\nThis parameter is used to indicate whether the UE requests on demand announcing in a DISCOVERY_REQUEST message. It is an integer in the 0-255 range encoded as table 11.4.2.24.1.\nTable 11.4.2.24.1: Announcing type\n\nThis parameter is used to carry the Application level container, which contains application-level data transparent to the 3GPP network transferred between the application client in the UE and the ProSe application server.\nThis parameter is used to carry the discovery entry ID, which is an identity allocated by the 5G DDNMF to refer to a discovery entry in the UE's context as a result of a discovery request, either announcing or monitoring. It is an integer in the 0-65535 range.\nThis parameter is used to contain a ProSe restricted code. The format of the ProSe restricted code is as follows:\na)\tif the ProSe restricted code is included in a MATCH_REPORT message and application-controlled extension is not used, the ProSe restricted code is encoded as a 184 bitstring composed of:\n1)\tthe ProSe restricted code in the 64 most significant bits; and\n2)\tthe remaining 120 bits set to zero;\nb)\tif the ProSe restricted code is included in a MATCH_REPORT message and application-controlled extension is used, the ProSe restricted code is encoded as a 184 bitstring composed of\n1)\tthe ProSe restricted code prefix in the 64 most significant bits;\n2)\tthe ProSe restricted code suffix; and\n3)\tany remaining unused least significant bits set to zero; or\nc)\tin all other cases, the ProSe restricted code is encoded as a 64 bitstring as defined in 3GPP TS 23.003 [12].\nThis parameter is used to carry a range of consecutive ProSe restricted code suffixes, each of which can be appended by the UE to a ProSe restricted code prefix (see clause 11.4.2.27) for restricted 5G ProSe direct discovery with application-controlled extension. A ProSe restricted code suffix range includes a beginning suffix code and optionally an ending suffix code, as described below:\na)\tbeginning suffix code: the bit-length of this bit string reflects the length of the suffix portion of the ProSe restricted code allocated by the ProSe application server for an RPAUID based on application configuration. The binary value of this code is the lowest value of the ProSe restricted code suffix range; and\nb)\tending suffix code: the binary value of this code is the highest value of the ProSe restricted code suffix range. The length of the ending suffix code shall be the same as that of the beginning suffix code.\nIf the ProSe restricted code suffix range contains only a single ProSe restricted code suffix, then that suffix is represented by the beginning suffix code and the ending suffix code is omitted.\nThis parameter is used to carry the on demand announcing enabled indicator, which is a Boolean value indicating whether on demand announcing is enabled or not in the 5G DDNMF.\nThis parameter is used to carry the discovery filter(s) used to monitor an individual target RPAUID in restricted 5G ProSe direct discovery model A. It contains one or more filters, TTL timer T5066, optionally an RPAUID parameter identifying the target RPAUID, optionally a metadata indicator and optionally the corresponding metadata. The elements in the restricted discovery filter parameter are defined as below:\na)\tfilter: a matching filter used for restricted 5G ProSe direct discovery Model A monitoring. It contains one code and one or more masks. The code is used by a monitoring UE for full or partial matching of PROSE PC5 DISCOVERY messages received on the PC5 interface with a ProSe restricted code (see clause 11.4.2.27). Only one code is allowed in a filter. The mask is a bitmask provided by the 5G DDNMF in order to allow the monitoring UE to perform a full matching or partial matching of PROSE PC5 DISCOVERY messages received on the PC5 interface. A mask with all bits set to \"1\" is used for full matching. One or more masks may be included in a filter. The length of the mask is the same as the length of the code;\nb)\tTTL Timer T5066: time-to-live duration for which the associated restricted discovery filter is valid, after which it shall not be used. It is an integer in the 1-525600 range representing the timer value in unit of minutes;\nc)\tRPAUID: identifier of the target RPAUID to be monitored;\nd)\tmetadata indicator: it contains the information element defined in clause 11.4.2.44; and\ne)\tmetadata: application-layer metadata associated with the monitoring target.\nThis parameter is used to indicate whether application-controlled extension for open 5G ProSe direct discovery or restricted 5G ProSe direct discovery is enabled. It is an integer value in the 0-255 range encoded as table 11.4.2.31.1.\nTable 11.4.2.31.1: ACE enabled indicator\n\nThis parameter is used to carry the value of validity timer T5062 associated with a ProSe restricted code or ProSe restricted code prefix. It is an integer in the 1-525600 range representing the timer value in unit of minutes.\nThis parameter is used as a container for the information necessary for security keys and algorithms protecting the sending or receiving of restricted 5G ProSe direct discovery messages over the PC5 interface. The elements in the restricted code security material parameter are listed below:\na)\tDUSK: an optional key which is allocated by the 5G DDNMF and is used by the UE for scrambling or unscrambling the PROSE PC5 DISCOVERY message containing the ProSe restricted code in restricted 5G ProSe direct discovery. The calculation of the DUSK is defined in 3GPP TS 33.503 [34];\nb)\tDUIK: an optional key which is allocated by the 5G DDNMF and is used by the UE to compute the MIC that is included in the PROSE PC5 DISCOVERY message containing the ProSe restricted code in restricted 5G ProSe direct discovery. The calculation of the DUIK is defined in 3GPP TS 33.503 [34]; and\nc)\tDUCK and associated encrypted bitmask: DUCK is an optional key which is allocated by the 5G DDNMF and is used by the UE to encrypt a portion of the PROSE PC5 DISCOVERY message containing the ProSe restricted code in restricted 5G ProSe direct discovery. The calculation of the DUCK is defined in 3GPP TS 33.503 [34]. The encrypted bitmask is a bitmask which uses bit \"1\" to mark the positions of the bits for which the DUCK encryption is applied.\nd)\tMIC-check-indicator: an optional indication which is provided by the 5G DDNMF and indicates whether to use match reports for MIC checking, used by the UE to decide whether to perform the required MIC check via the match report procedure for restricted 5G ProSe direct discovery. If this indication is included, the DUIK shall not be included in the restricted code security material parameter but provided as a separate parameter as specified in 3GPP TS 33.503 [34]. This indication is not used for 5G ProSe UE-to-network relay discovery and group member discovery.\nThis parameter is used to indicate the model of ProSe direct discovery contained in the DISCOVERY_REQUEST message. It is an integer in the 0-3 range encoded as table 11.4.2.34.1.\nTable 11.4.2.34.1: Discovery model\n\nThis parameter is used to carry the ProSe response code. It is a bit string coded as specified in 3GPP TS 23.003 [12].\nThis parameter is used to carry the discovery query filter that is allocated by the 5G DDNMF in the HPLMN to the discoveree UE for restricted Model B discovery, for a particular RPAUID. The elements in the discovery query filter parameter are defined as below:\na)\tCode: the code is used by a discoveree UE for full or partial matching of PROSE PC5 DISCOVERY messages received on the PC5 interface containing a ProSe query code. Only one code is allowed in a discovery query filter; and\nb)\tMask: the mask is a bitmask provided by the 5G DDNMF in order to allow the discoveree UE to perform a full matching or partial matching of PROSE PC5 DISCOVERY messages received on the PC5 interface containing the ProSe query code. A mask with all bits set to \"1\" is used for full matching. One or more masks may be included in a filter. The length of the mask is the same as the length of the code.\nThis parameter is used to carry the value of validity timer T5068 associated with a ProSe response code and corresponding discovery query filter(s). It is an integer in the 1-525600 range representing the timer value in unit of minutes.\nThis parameter is used to contain the information allocated by the 5G DDNMF related to one particular query target RPAUID which the discoverer UE intends to query with restricted 5G ProSe direct discovery model B. It contains one ProSe query code, one or more discovery response filter(s), validity timer T5070, an RPAUID parameter identifying the target RPAUID, restricted security and optionally the corresponding metadata. The elements in the subquery result parameter are defined as below:\na)\tProSe query code: it is a ProSe restricted code allocated by the 5G DDNMF to a discoverer UE to solicit the response from a discoveree UE for a particular target RPAUID;\nb)\tdiscovery response filter: it contains one code and one or more masks to be used to matching ProSe response code. The code is used by a discoverer UE to represent a targeted ProSe response code (see clause 11.4.2.35). The mask is a bitmask provided by the 5G DDNMF in order to allow the discoverer UE to perform a full matching or partial matching of PROSE PC5 DISCOVERY messages received on the PC5 interface containing the ProSe response code. A mask with all bits set to \"1\" is used for full matching. The length of the mask is the same as the length of the code;\nc)\tvalidity timer T5070: it represents the validity time associated with a ProSe query code and corresponding discovery response filter(s). It is an integer in the 1-525600 range representing the timer value in unit of minutes;\nd)\tcode-sending security parameter: it contains the information element defined in clause 11.4.2.33;\ne)\tcode-receiving security parameter: it contains the information element defined in clause 11.4.2.33;\nf)\tRPAUID: identifier of the target RPAUID to be monitored; and\ng)\tmetadata: application-layer metadata associated with the querying target.\nThis parameter is used to carry the value of validity timer T5076 associated with a ProSe restricted code for which there was a match event. It is an integer in the 1-525600 range representing the timer value in unit of minutes.\nThis parameter is used to carry the value of match report refresh timer T5077 associated with a ProSe restricted Code for which there was a match event. It is an integer in the 1-525600 range representing the timer value in unit of minutes.\nThis parameter is a bitmask provided by the 5G DDNMF in order to indicate the portion used for the metadata index in the ProSe application code for the monitoring UE. The length of the metadata index mask is as same as the length of ProSe application code.\nThis parameter is used to indicate the method enabling transport of PC3a messages for 5G DDNMF-initiated ProSe direct discovery procedures. It is an integer in the 0-255 range encoded as table 11.4.2.42.1.\nTable 11.4.2.42.1: Network-initiated transaction method\n\nThis parameter is used to indicate the PLMN ID of the PLMN operating the radio resources which the UE intends to use for transmitting a PROSE PC5 DISCOVERY message. It is coded as specified in 3GPP TS 23.003 [12].\nThis parameter is used to indicate whether there is a metadata associated with the target RPAUID. It is an integer value in the 0-255 range encoded as table 11.4.2.44.1.\nTable 11.4.2.44.1: Metadata indicator\n\nThis parameter is used to contain a ProSe application code prefix. Its length indicates the size in bits of the allocated prefix, which can take any value that is a multiple of 8 in the 32 to 176 range.\nNOTE:\tThe size of the prefix for a given application is determined by the ProSe application server and made known to the 5G DDNMF by means that are out of scope of 3GPP.\nThis parameter is used to contain a ProSe application code suffix. The ProSe application code suffix is used with a ProSe application code prefix to form a 184-bit ProSe application code for open 5G ProSe direct discovery with application-controlled extension.\nThis parameter is used to carry a set of ProSe application code(s) allocated for a corresponding ProSe application ID when application-controlled extension is used. It contains one ProSe application code Prefix and one or more ProSe application code suffix range(s). The elements in the ProSe application code ACE parameter are defined as below:\na)\tProSe application code prefix: as defined in clause 11.4.2.45; and\nb)\tProSe application code suffix range: this parameter is used to carry a range of consecutive ProSe application code suffixes (see clause 11.4.2.46). A ProSe application code suffix range includes a beginning suffix code and optionally an ending suffix code, as described below:\n1)\tbeginning suffix code: the bit-length of this bit string reflects the length of the suffix portion of the ProSe application code allocated by the ProSe application server for a ProSe application ID based on application configuration. The binary value of this code is the lowest value of the ProSe application code suffix range; and\n2)\tending suffix code: the binary value of this code is the highest value of the ProSe application code suffix range. The length of the ending suffix code shall be the same as that of the beginning suffix code.\nIf the ProSe application code suffix range contains only a single ProSe application code suffix, then that suffix is represented by the beginning suffix code and the ending suffix code is omitted.\nThis parameter is used to carry a Discovery key allocated by the 5G DDNMF. This key is used by the UE to compute the MIC that is included in the PROSE PC5 DISCOVERY message. The format of Discovery key is defined in 3GPP TS 33.303 [36].\nThis parameter is used to indicate the PC5 security policies as integer values, where the PC5 signalling security policies are defined in table 11.3.12.1 and the PC5 user plane security policies are defined in table 11.3.23.1.\nThis parameter is used to indicate the UE supported ciphering algorithms as integer values, where the UE supported ciphering algorithms field is defined as octet 3 of figure 11.3.11.1 and table 11.3.11.1.\nThis parameter is used to indicate the selected PC5 ciphering algorithm as integer values, where the selected PC5 ciphering algorithm filed is defined as bit 5 to 7 of octet 2 in figure 11.3.22.1 and table 11.3.22.1.\nThis parameter is used to include the entire PROSE PC5 DISCOVERY message where the match event occurred. For the restricted 5G ProSe direct discovery procedure, this parameter is included if it is required to check the MIC via the match report procedure as specified in clause 6.2.9.2 and clause 6.2.10.2.\nThis parameter is used to carry a 5G PKMF address to the UE by the 5G DDNMF in order to find a 5G PKMF for the authentication based on security procedure over user plane as specified in 3GPP TS 33.503 [34].\nThe PKMF address information element is coded as shown in figure 11.4.2.53.1, figure 11.4.2.53.2, figure 11.4.2.53.3, and table 11.4.2.53.1.\n\nFigure 11.4.2.53.1: PKMF address\n\nFigure 11.4.2.53.2: IPv4 address list\n\nFigure 11.4.2.53.3: IPv6 address list\nTable 11.4.2.53.1: PKMF address information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.4.2.2.1: Command",
                                    "table number": 173,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.4.2.8.1: PC3a control protocol cause value",
                                    "table number": 174,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.4.2.18.1: Discovery type",
                                    "table number": 175,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.4.2.24.1: Announcing type",
                                    "table number": 176,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.4.2.31.1: ACE enabled indicator",
                                    "table number": 177,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.4.2.34.1: Discovery model",
                                    "table number": 178,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.4.2.42.1: Network-initiated transaction method",
                                    "table number": 179,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.4.2.44.1: Metadata indicator",
                                    "table number": 180,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 181,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 182,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 183,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.4.2.53.1: PKMF address information element",
                                    "table number": 184,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "11.5\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "11.6\t5G ProSe security message over PC8 formats",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.6.1\tData types format in XML schema",
                            "text_content": "To exchange structured information over the transport protocol, XML text format/notation is introduced.\nThe corresponding XML data types for the data types used in ProSe messages are provided in table 11.6.1.1.\nTable 11.6.1.1: Primitive or derived types for ProSe parameter type\n\nFor complex data types described in clause 11.6.2, an XML \"complexType\" can be used.\nMessage construction shall be compliant with W3C REC-xmlschema-2-20041028: \"XML Schema Part 2: Datatypes\" [29].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.6.1.1: Primitive or derived types for ProSe parameter type",
                                    "table number": 185,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.6.2\tParameters in 5G ProSe security messages over PC8",
                            "text_content": "This parameter is used to uniquely identify a PC8 control protocol for 5G ProSe security transaction when it is combined with other PC8 control protocol for 5G ProSe security transactions in the same transport message. The UE shall set this parameter to a new number for each outgoing new key request. The transaction ID is an integer in the 0-255 range.\nThis parameter is used to indicate the UP-PRUK allocated by the 5G PKMF. The calculation of the UP-PRUK is defined in 3GPP TS 33.503 [34].\nThis parameter is used to indicate the identifier of the UE stored UP-PRUK. The UP-PRUK ID value consists of two fields:\na)\tUP-PRUK ID format field which is the 1st character of the UP-PRUK ID value: an ASCII character, as defined in IETF RFC 20 [40], coded in table 11.6.2.5.1; and\nTable 11.6.2.3.1: UP-PRUK ID format\n\nb)\tUP-PRUK ID field which is 2nd and later characters of the UP-PRUK ID value:\n1)\tif the UP-PRUK ID format field indicates \"NAI\", the UP-PRUK ID field is a UP-PRUK ID in the NAI format as defined in clause 28.7.10 of 3GPP TS 23.003 [12], encoded as UTF-8 string; or\n2)\tif the UP-PRUK ID format field indicates \"64-bit string\", the UP-PRUK ID field is a 64-bit string, encoded using 16 hexadecimal digits, each digit indicated by an ASCII character \"0\" - \"9\" or \"A\" - \"F\", as defined in IETF RFC 20 [40].\nSee clause 11.4.2.50.\nThis parameter is used to indicate the MCC as specified in Annex A of ITU-T Recommendation E.212 [27].\nThe coding of this parameter is responsibility of each administration. If MNC consists of 2 digits, MNC value is between 10 and 99.\nSee clause 11.4.2.16.\nSee clause 11.4.2.17.\nThis parameter is used to indicate the expiration timer of the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE or the expiration timer of the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe UE-to-network relay UE.\nIt is an integer in the 1-525600 (decimal) range representing the timer value in unit of minutes.\nThis parameter is used to indicate a connectivity service the UE-to-Network relay provides.\nIt is an integer in the 0 to 16777215 (decimal) range.\nSee clause 11.4.2.51.\nThis parameter is used to provide DUSK as specified in 3GPP TS 33.503 [34].\nThis parameter is used to provide DUIK as specified in 3GPP TS 33.503 [34].\nThis parameter is used to provide DUCK as specified in 3GPP TS 33.503 [34].\nThis parameter is used to provide encrypted_bits_mask associated with a DUCK as specified in 3GPP TS 33.503 [34].\nThis parameter is used to indicate the GPI encoded as specified in clause 5.3.5 in 3GPP TS 33.223 [44].\nThis parameter is used to indicate the signalling ciphering policy. The parameter is encoded as the signalling ciphering policy field as specified in the table 11.3.12.1, with values in the 0 to 7 range.\nThis parameter is used to indicate the user plane integrity protection policy. The parameter is encoded as the user plane integrity protection policy field as specified in the table 11.3.23.1, with values in the 0 to 7 range.\nThis parameter is used to indicate the user plane ciphering policy. The parameter is encoded as the user plane ciphering policy field as specified in the table 11.3.23.1, with values in the 0 to 7 range.\nThis parameter is used to indicate the particular reason why a PROSE_SECURITY_PARAM_REQUEST, PROSE_PRUK_REQUEST or PROSE_KEY_REQUEST message from the UE has been rejected by the 5G PKMF. It is an integer in the 0-255 range encoded in table 11.6.2.20.1.\nTable 11.6.2.20.1: PC8 control protocol cause value\n\nThis parameter is used to indicate the SUCI of the 5G ProSe remote UE in NAI format as specified in 3GPP TS 23.003 [12].\nThis parameter is used to indicate 128-bit long KNRP freshness parameter 1 as specified in 3GPP TS 33.503 [34].\nThis parameter is used to provide 112-bit long information to begin a re-synchronisation as specified in 3GPP TS 33.503 [34].\nThis parameter is used to provide a 128-bit long non-predictable challenge as specified in 3GPP TS 33.503 [34].\nThis parameter is used to provide a 256-bit KNRP as specified in 3GPP TS 33.503 [34].\nThis parameter is used to indicate 128-bit long KNRP freshness parameter 2 as specified in 3GPP TS 33.503 [34].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.6.2.3.1: UP-PRUK ID format",
                                    "table number": 186,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.6.2.20.1: PC8 control protocol cause value",
                                    "table number": 187,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "11.7\tFormats for messages transmitted over the PC3ach interface",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.7.1\tData types format in XML schema",
                            "text_content": "To exchange structured information over the transport protocol, XML text format/notation is introduced.\nThe corresponding XML data types for the data types used in 5G ProSe PC3ach messages are provided in table 11.7.1.\nTable 11.7.1: Primitive or derived types for 5G ProSe PC3ach Parameter Type\n\nFor complex data types described in clause 11.7.2, an XML \"complexType\" can be used.\nMessage construction shall be compliant with W3C REC-xmlschema-2-20041028 [29].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.7.1: Primitive or derived types for 5G ProSe PC3ach Parameter Type",
                                    "table number": 188,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.7.2\tParameters in messages transmitted over the PC3ach interface",
                            "text_content": "This parameter is used to uniquely identify a message transmitted over the PC3ach interface when it is combined with another message transmitted over the PC3ach interface in the same transport message. The UE shall set this parameter to a new number for each outgoing new message which includes this information element and is transmitted over the PC3ach interface. The transaction ID is an integer in the 0-255 range.\nThis parameter is used to indicate sequence number of the usage information report. The sequence number is an integer in the 0-4294967295 range. The sequence number is set to 0 on UE power up and is increased by 1 whenever a new usage information report is created.\nThis parameter is used to indicate whether the UE was in NG-RAN coverage. It is a Boolean value coded as follows:\nTrue\tthe UE is in NG-RAN coverage.\nFalse\tthe UE is out of NG-RAN coverage.\nThis parameter is used to indicate NG-RAN Cell Global Identification of the NG-RAN cell where the UE was camping on or which the UE used in the 5GMM-CONNECTED mode. The coding of NCGI is defined in 3GPP TS 23.003 [12].\nThis parameter is used to indicate the radio parameters used for 5G ProSe direct communication. Format of the value is according to the SL-PreconfigurationNR-r16 ASN.1 data type described in 3GPP TS 38.331 [13].\nThis parameter is used to indicate the particular reason why the 5G DDNMF CTF (ADF) rejects PROSE_USAGE_INFORMATION_REPORT_LIST message. It is an integer in the 0-255 range encoded as follows:\n0\tReserved\n2\tUE authorization failure\n3\tInvalid message format\n10\tUnable to process usage information report list\n1, 4-9, 11-255\t\tUnused\nThis parameter is used to indicate time and date. The format of this parameter follows the XML data type defined in table 11.7.1 for 5G ProSe PC3ach message parameter type \"Time\".\nThis parameter is used to indicate a ProSe layer-2 group ID. The value of ProSe layer-2 group ID is a 24-bit bit-string.\nThis parameter is used to indicate a 5G ProSe Group IP multicast address. If the IP address is an IPv4 address, its value is coded as a string representing the dotted-decimal format of the IPv4 address as specified in IETF RFC 1166 [48]. If the IP address is an IPv6 address, its value is coded as a string representing the canonical text representation format of the IPv6 address as specified in IETF RFC 5952 [49].\nThis parameter is used to indicate an IP address used by the UE as a source address. If the IP address is an IPv4 address, its value is coded as a string representing the dotted-decimal format of the IPv4 address as specified in IETF RFC 1166 [48]. If the IP address is an IPv6 address, its value is coded as a string representing the canonical text representation format of the IPv6 address as specified in IETF RFC 5952 [49].\nThis parameter is used to indicate the layer-2 ID used by the UE. The value of UE layer-2 ID is a 24-bit bit-string.\nThis parameter is used to indicate the amount of transmitted or received data in octets. The value of this parameter is coded as an integer.\nThis parameter is used to indicate whether the operator-provided radio resources or the configured radio resources were used for 5G ProSe direct communication.\nIt is an integer in the 0-255 range encoded as follows:\n0\tReserved\n1\tthe operator-provided radio resources\n2\tthe configured radio resources\n3-255\tUnused\nThis parameter is used to indicate the radio frequency used for 5G ProSe direct communication.\nFormat of the value is according to the ARFCN-ValueNR ASN.1 data type described in 3GPP TS 38.331 [13].\nThis parameter is used to indicate the PC5 QoS flow identifier used to identify the QoS flow for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\nThis parameter is used to indicate the PQI of PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\nThis parameter is used to indicate the guaranteed flow bit rate (GFBR) of PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\nThis parameter is used to indicate the maximum flow bit rate (MFBR) of PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\nThis parameter is used to indicate the averaging window of PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\nThis parameter is used to indicate the resource type of PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\nThis parameter is used to indicate the default priority level of PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\nThis parameter is used to indicate the packet delay budget of PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\nThis parameter is used to indicate the packet error rate of PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\nThis parameter is used to indicate the default maximum data burst volume of PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "12\tList of system parameters",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "12.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "The description of timers in the following tables should be considered a brief summary. The precise details are found in clauses 4 to 8, which should be considered the definitive descriptions.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.2\tTimers of provisioning of parameters for 5G ProSe configuration procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "Timers of provisioning of parameters for 5G ProSe configuration are shown in table 12.2.1.\nNOTE:\tTimer T5040 is defined in 3GPP TS 24.587 [18].\nTable 12.2.1: Timers of provisioning of parameters for 5G ProSe configuration – UE side\n\n",
                    "tables": [
                        {
                            "description": "Table 12.2.1: Timers of provisioning of parameters for 5G ProSe configuration – UE side",
                            "table number": 189,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.3\tTimers of 5G ProSe direct link management procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "NOTE:\tTimer T3346 is defined in 3GPP TS 24.008 [31].\nTable 12.3.1: 5G ProSe direct link management timers\n\n",
                    "tables": [
                        {
                            "description": "Table 12.3.1: 5G ProSe direct link management timers",
                            "table number": 190,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.4\tTimers of 5G ProSe direct discovery procedures over PC3a",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 12.4.1: Timers of 5G ProSe direct discovery procedures over PC3a – UE side\n\nTable 12.4.2: Timers of 5G ProSe direct discovery procedures over PC3a – 5G DDNMF side\nNOTE:\tMultiple timers T5061, T5063, T5065, T5067, T5069 and T5071 can run simultaneously in the 5G DDNMF.\n",
                    "tables": [
                        {
                            "description": "Table 12.4.1: Timers of 5G ProSe direct discovery procedures over PC3a – UE side",
                            "table number": 191,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table 12.4.2: Timers of 5G ProSe direct discovery procedures over PC3a – 5G DDNMF side",
                            "table number": 192,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.5\tTimers of broadcast mode 5G ProSe communication over PC5 interface",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 12.5.1: timers of broadcast mode 5G ProSe communication over PC5\n\n",
                    "tables": [
                        {
                            "description": "Table 12.5.1: timers of broadcast mode 5G ProSe communication over PC5",
                            "table number": 193,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.6\tTimers of groupcast mode 5G ProSe communication over PC5 interface",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 12.6.1: timers of groupcast mode 5G ProSe direct communication over PC5\n\n",
                    "tables": [
                        {
                            "description": "Table 12.6.1: timers of groupcast mode 5G ProSe direct communication over PC5",
                            "table number": 194,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.7\tTimers of 5G ProSe additional parameters announcement procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 12.7: 5G ProSe additional parameters announcement timers\n\n",
                    "tables": [
                        {
                            "description": "Table 12.7: 5G ProSe additional parameters announcement timers",
                            "table number": 195,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.8\tTimers for PC8 interface",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 12.8.1: Timers for PC8 interface - UE side\n\n",
                    "tables": [
                        {
                            "description": "Table 12.8.1: Timers for PC8 interface - UE side",
                            "table number": 196,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.9\tTimers of 5G ProSe UE-to-network relay with model B",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 12.9.1: 5G ProSe UE-to-network relay with Model B timers\n\n",
                    "tables": [
                        {
                            "description": "Table 12.9.1: 5G ProSe UE-to-network relay with Model B timers",
                            "table number": 197,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.10\tTimers for 5G ProSe UE-to-network relay discovery security material request procedure over PC3a interface",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 12.10.1: Timers for PC8 interface - UE side\n\n",
                    "tables": [
                        {
                            "description": "Table 12.10.1: Timers for PC8 interface - UE side",
                            "table number": 198,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.11\tTimers of 5G ProSe UE-to-UE relay discovery with model B",
                    "description": "",
                    "summary": "",
                    "text_content": "Table 12.11.1: 5G ProSe UE-to-UE relay discovery with model B timers\n\n",
                    "tables": [
                        {
                            "description": "Table 12.11.1: 5G ProSe UE-to-UE relay discovery with model B timers",
                            "table number": 199,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.1\tIANA registrations for MIME types",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.1.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "IETF RFC 4288 [41], clause 9, states the process that applies in case of changes to the registry of media types. Any changes to the format after the registration with IANA would invoke this procedure.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.2\tapplication/vnd.3gpp-prose-pc3a+xml",
                    "description": "",
                    "summary": "",
                    "text_content": "Your Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nVendor Tree – vnd.3gpp-prose-pc3a+xml\nRequired parameters:\nNone.\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in clause 9.1 of IETF RFC 7303 [42].\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in clause 9.1 of IETF RFC 7303 [42]. The information transported in this media type does not include active or executable content. Mechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 33.503 [34].\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nThe media type allows for interoperability of messages transmitted for 5G ProSe over the PC3a interface. The messages are sent between user equipment and mobile network.\nPublished specification:\n3GPP TS 24.554 (http://www.3gpp.org/ftp/Specs/html-info/24554.htm)\nApplications which use this media type:\nn/a.\nFragment identifier considerations:\nThe handling in clause 5 of IETF RFC 7303 [42] applies.\nRestrictions on usage:\nNone.\nProvisional registration? (standards tree only):\nn/a.\nAdditional information:\n1.\tDeprecated alias names for this type:\tn/a\n2.\tMagic number(s):\tn/a\n3.\tFile extension(s):\tn/a\n4.\tMacintosh File Type Code(s):\tn/a\n5.\tObject Identifier(s) or OID(s):\tn/a\nIntended usage:\nCommon.\nOther information/general comment:\nThe media type is intended to be used in 5G proximity service procedures.\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.2A\tapplication/vnd.3gpp-prose-pc8+xml",
                    "description": "",
                    "summary": "",
                    "text_content": "Your Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nVendor Tree - vnd.3gpp-prose-pc8+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in clause 9.1 of IETF RFC 7303 [42].\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in clause 9.1 of IETF RFC 7303 [42]. The information transported in this media type does not include active or executable content. Mechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 33.503 [34].\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nThe media type allows for interoperability of messages transmitted over the PC8 interface. The messages are sent between user equipment and mobile network.\nPublished specification:\n3GPP TS 24.554 ()\nApplications which use this media type:\nn/a.\nFragment identifier considerations:\nThe handling in clause 5 of IETF RFC 7303 [42] applies.\nRestrictions on usage:\nNone.\nProvisional registration? (standards tree only):\nn/a.\nAdditional information:\n1.\tDeprecated alias names for this type:\tn/a.\n2.\tMagic number(s):\tn/a.\n3.\tFile extension(s):\tn/a.\n4.\tMacintosh File Type Code(s):\tn/a.\n5.\tObject Identifier(s) or OID(s):\tn/a.\nIntended usage:\nCommon.\nOther information/general comment:\nThe media type is intended to be used in 5G proximity service procedures.\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.3\tapplication/vnd.3gpp-prose-pc3ach+xml",
                    "description": "",
                    "summary": "",
                    "text_content": "Your Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nVendor Tree – vnd.3gpp-prose-pc3ach+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in clause 9.1 of IETF RFC 7303 [42].\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in clause 9.1 of IETF RFC 7303 [42]. The information transported in this media type does not include active or executable content. Mechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 33.503 [34].\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nThe media type allows for interoperability of messages transmitted over the PC3ach interface, including those related to transport of the usage information request of proximity services. The messages are sent between user equipment and mobile network.\nPublished specification:\n3GPP TS 24.554 (http://www.3gpp.org/ftp/Specs/html-info/24554.htm)\nApplications which use this media type:\nn/a\nFragment identifier considerations:\nThe handling in clause 5 of IETF RFC 7303 [42] applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nn/a\nAdditional information:\n1.\tDeprecated alias names for this type:\tn/a\n2.\tMagic number(s):\tn/a\n3.\tFile extension(s):\tn/a\n4.\tMacintosh File Type Code(s):\tn/a\n5.\tObject Identifier(s) or OID(s):\tn/a\nIntended usage:\nCommon.\nOther information/general comment:\nThe media type is intended to be used in proximity service procedures.\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 200,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}