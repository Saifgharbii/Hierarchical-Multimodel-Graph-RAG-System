{
    "document_name": "29561-i20.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present specification defines the stage 3 interworking procedures for 5G Network interworking between PLMN and external DN or Network Slice Specific AAA.\nThe stage 2 requirements and procedures are contained in 3GPP TS 23.501 [2] and 3GPP TS 23.502 [3].\nFor interworking between 5G PLMN and external DNs, the present document is valid for both 3GPP accesses and non-3GPP accesses.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[3]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[4]\t3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunnelling Protocol User Plane (GTPv1-U)\".\n[5]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting packet based services and Packet Data Networks (PDN)\".\n[6]\tIETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".\n[7]\tIETF RFC 3579: \"RADIUS (Remote Authentication Dial In User Service) Support For Extensible Authentication Protocol (EAP)\".\n[8]\tIETF RFC 2865: \"Remote Authentication Dial In User Service (RADIUS)\".\n[9]\tIETF RFC 3162: \"RADIUS and IPv6\".\n[10]\tIETF RFC 4818: \"RADIUS Delegated-IPv6-Prefix Attribute\".\n[11]\tIETF RFC 5216: \"The EAP-TLS Authentication Protocol\".\n[12]\t3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".\n[13]\t3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on SIP and SDP; Stage 3\".\n[14]\tIETF RFC 2132: \"DHCP Options and BOOTP Vendor Extensions\".\n[15]\tIETF RFC 3361: \"Dynamic Host Configuration Protocol (DHCP-for-IPv4) Option for Session Initiation Protocol (SIP) Servers\".\n[16]\tIETF RFC 3646: \"DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)\".\n[17]\tIETF RFC 3319: \"Dynamic Host Configuration Protocol (DHCPv6) Options for Session Initiation Protocol (SIP) Servers\".\n[18]\tIETF RFC 2131: \"Dynamic Host Configuration Protocol\".\n[19]\tIETF RFC 1542: \"Clarification and Extensions for the Bootstrap Protocol\".\n[20]\tIETF RFC 4039: \"Rapid Commit Option for the Dynamic Host Configuration Protocol version 4 (DHCPv4)\".\n[21]\tIETF RFC 3315: \"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)\".\n[22]\tIETF RFC 3736: \"Stateless Dynamic Host Configuration Protocol (DHCP) Service for IPv6\".\n[23]\tIETF RFC 7155: \"Diameter Network Access Server Application\".\n[24]\tIETF RFC 6733: \"Diameter Base Protocol\".\n[25]\tIETF RFC 4072: \"Diameter Extensible Authentication Protocol (EAP) Application\".\n[26]\tIETF RFC 2866: \"RADIUS Accounting\".\n[27]\tIETF RFC 5176: \"Dynamic Authorization Extensions to Remote Authentication Dial In User Service (RADIUS)\".\n[28]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[29]\tIETF RFC 1825: \"Security Architecture for the Internet Protocol\".\n[30]\tIETF RFC 1826: \"IP Authentication Header\".\n[31]\tIETF RFC 1827: \"IP Encapsulating Security Payload (ESP)\".\n[32]\tIETF RFC 4291: \"IP Version 6 Addressing Architecture\".\n[33]\tIETF RFC 4861: \"Neighbor Discovery for IP Version 6 (IPv6)\".\n[34]\tIETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".\n[35]\tIETF RFC 1027: \"Using ARP to Implement Transparent Subnet Gateways\".\n[36]\t802.3-2015 - IEEE Standard for Ethernet.\n[37]\tIETF RFC 5281: \"Extensible Authentication Protocol Tunneled Transport Layer Security Authenticated Protocol Version 0 (EAP-TTLSv0)\".\n[38]\t3GPP TS 23.380: \"IMS Restoration Procedures\".\n[39]\t3GPP TS 29.571: \"5G System; Common Data Types for Service Based Interfaces; Stage 3\".\n[40]\t3GPP TS 29.502: \"5G System; Session Management Services; Stage 3\".\n[41]\t3GPP TS 29.229: \"Cx and Dx interfaces based on Diameter protocol; Protocol details\".\n[42]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[43]\t3GPP TS 23.316: \"Wireless and wireline convergence access support for the 5G System (5GS)\".\n[44]\tIETF RFC 7761: \"Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)\".\n[45]\tIETF RFC 3973: \"Protocol Independent Multicast - Dense Mode (PIM-DM): Protocol Specification (Revised)\".\n[46]\t3GPP TS 29.571: \"5G System; Common Data Types for Service Based Interfaces Stage 3\".\n[47]\tIETF RFC 2132: \"DHCP Options and BOOTP Vendor Extensions\".\n[48]\tIETF RFC 3925: \"Vendor-Identifying Vendor Options for Dynamic Host Configuration Protocol version 4 (DHCPv4)\".\n[49]\tIETF RFC 8415: \"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)\".\n[50]\t3GPP TS 29.274: \"3GPP Evolved Packet System. Evolved GPRS Tunnelling Protocol for EPS (GTPv2)\".\n[51]\tCableLabs WR-TR-5WWC-ARCH: \"5G Wireless Wireline Converged Core Architecture\".\n[52]\tBBF WT-470: \"5G FMC Architecture\".\n[53]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[54]\tBBF TR-456: \"AGF Functional Requirements\".\n[55]\tCableLabs DOCSIS MULPI: \"Data-Over-Cable Service Interface Specifications DOCSIS 3.1, MAC and Upper Layer Protocols Interface Specification\".\n[56]\tIETF RFC 7542: \"The Network Access Identifier\".\n[57]\tIETF RFC 2661: \" Layer Two Tunneling Protocol \"L2TP\".\n[58]\t3GPP TS 29.244: \"Interface between the Control Plane and the User Plane of EPC Nodes; Stage 3\".\n[59]\t3GPP TS 33.501: \"Security architecture and procedures for 5G system\".\n[60]\t3GPP TS 23.247: \"Architectural enhancements for 5G multicast-broadcast services; Stage 2\".\n[61]\t3GPP TS 26.502: \"5G Multicast-Broadcast User Service Architecture\".\n[62]\tIETF RFC 6603: \"Prefix Exclude Option for DHCPv6-based Prefix Delegation\".\n[63]\t3GPP TS 23.434: \"Service Enabler Architecture Layer for Verticals (SEAL); Functional architecture and information flows\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\n5G-BRG\t5G Broadband Residential Gateway\n5G-CRG\t5G Cable Residential Gateway\nAMF\tAccess and Mobility Management Function\nBBF\tBroadband Forum\nCH\tCredentials Holder\nCHAP\tChallenge Handshake Authentication Protocol\nCHF\tCharging Function\nCSMA/CD\tCarrier Sense Multiple Access/Collision Detection\nDCS\tDefault Credentials Server\nDHCPv4\tDynamic Host Configuration Protocol version 4\nDHCPv6\tDynamic Host Configuration Protocol version 6\nDN\tData Network\nDNAI\tDN Access Identifier\nDR\tDesignated Router\nDSL\tDigital Subscriber Line\nFN-BRG\tFixed Network Broadband RG\nFN-CRG\tFixed Network Cable RG\nFQDN\tFully Qualified Domain Name\nGCI\tGlobal Cable Identifier\nGLI\tGlobal Line Identifier\nGPSI\tGeneric Public Subscription Identifier\nHFC\tHybrid Fiber Coax\nI-SMF\tIntermediate SMF\nL2TP\tLayer Two Tunneling Protocol\nLAC\tL2TP Access Concentrator\nLNS\tL2TP Network Server\nMBS\tMulticast/Broadcast Service.\nMBSTF\tMulticast/Broadcast Service Transport Function.\nMB-UPF\tMulticast/Broadcast User Plane Function\nN3IWF\tNon-3GPP InterWorking Function\nNGAP\tNG Application Protocol\nNRM\tNetwork Resource Management\nNSS\tNetwork Slice Specific\nNSSAAF \tNetwork Slice-Specific Authentication and Authorization Function\nON-SNPN\tOnboarding Standalone Non-Public Network\nPAP\tPassword Authentication Protocol\nPIM\tProtocol-Independent Multicast\nPIM-DM\tProtocol-Independent Multicast- Dense Mode\nPIM-SM\tProtocol-Independent Multicast- Sparse Mode\nPON\tPassive Optical Network\nPtP\tPoint-to-Point\nRG\tResidential Gateway\nRP\tRendezvous Point\nRSN\tRedundancy Sequence Number\nRTP\tReal-time Transport Protocol\nSD\tSlice Differentiator\nSEAL\tService Enabler Architecture Layer for Verticals\nSFD\tStart Frame Delimiter\nSMF\tSession Management Function\nS-NSSAI\tSingle Network Slice Selection Assistance Information\nSNPN\tStand-alone Non-Public Network\nSO-SNPN\tSubscription Owner Standalone Non-Public Network\nSSC\tSession and Service Continuity\nSST\tSlice/Service Type\nTCP\tTransmission Control Protocol\nTNAP\tTrusted Non-3GPP Access Point\nTWAP\tTrusted WLAN Access Point\nUDP\tUser Datagram Protocol\nUPF\tUser Plane Function\nV-SMF\tVisited SMF\nVAL\tVertical Application Layer\nWAN\tWide Area Network\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tNetwork Characteristics",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tKey characteristics of PLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "The PLMN is fully defined in the 3GPP technical specifications. The 5G Network related key characteristics are defined in 3GPP TS 23.501 [2].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tKey characteristics of IP Networks",
                    "description": "",
                    "summary": "",
                    "text_content": "The Internet is a conglomeration of networks utilising a common set of protocols. IP protocols are defined in the relevant IETF RFCs. The networks topologies may be based on LANs (e.g. Ethernet), Point to Point leased lines, PSTN, ISDN, X.25 or WANs using switched technology (e.g. SMDS, ATM).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.3\tKey characteristics of Ethernet",
                    "description": "",
                    "summary": "",
                    "text_content": "The Ethernet is a family of computer networking technologies commonly used in LAN and is often used to refer to all Carrier Sense Multiple Access/Collision Detection (CSMA/CD) LANs that generally conform to Ethernet Specifications, including IEEE 802.3 [36]. The key characteristics for Ethernet are defined in IEEE 802.3 [36].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "5\tInterworking Classifications",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tService Interworking",
                    "description": "",
                    "summary": "",
                    "text_content": "Service interworking is required when the Teleservice at the calling and called terminals are different. No service interworking is specified in this specification.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tNetwork Interworking",
                    "description": "",
                    "summary": "",
                    "text_content": "Network interworking is required whenever a PLMN is involved in communications with another network to provide end-to-end communications. The PLMN shall interconnect in a manner consistent with that of a normal Data Network (type defined by the requirements e.g. IP). Interworking appears exactly like that of Data Networks.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "6\tReference Architecture",
            "description": "Figure 6-1 shows the access interfaces for the 5G Network. Figure 6-2 shows the access interfaces for the 5G and EPC interworking network.\nThe 5G Network includes both the 3GPP access and the non-3GPP access.\nThe NSS-AAA may belong to the H-PLMN in the 5G Network (without AAA-P interworking) or a 3rd party (with AAA-P interworking).\nThe figure depicts a reference architecture for 5G network interworking, illustrating the various components and their interconnections. It includes base stations (gNB), user equipment (UE), and scatterers, as well as key technologies such as beamforming and network slicing. The figure highlights the importance of redundancy and failover mechanisms to ensure reliable communication.\nFigure 6-1: Reference Architecture for 5G Network Interworking\n\nThe figure depicts a reference architecture for 5G and EPC (Evolved Packet Core) interworking, illustrating the interconnection between the two technologies. It shows the various components and their interconnections, including base stations (BSs), user equipment (UE), and network elements such as optical line terminals (OLTs), distributed nodes, and core switches. The figure highlights the importance of redundancy and failover mechanisms to ensure reliable communication.\nFigure 6-2: Reference Architecture for 5G and EPC Interworking\nNOTE 1:\tThe SMF represents the H-SMF and the SMF+PGW-C represents the H-SMF+ H-PGW-C in the home routed scenario.\nNOTE 2:\tIf the DN-AAA server or the DHCP server located in 5GC or in the external PDN is reachable directly, then the SMF or SMF+PGW-C can communicate with the DN-AAA server directly without involving the UPF or UPF+PGW-U, applicable to all the message flows on N6 interface in clause 11 and clause 12 in this specification.\nNOTE 3:\tIn the follow clauses, the description on SMF also apples to SMF+PGW-C, the description on UPF also applies to UPF+PGW-U, unless otherwise specified.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "7\tInterface to 5G Network services (User Plane)",
            "description": "The user plane for 5G Network services is defined in clause 8.3 of 3GPP TS 23.501 [2] and 3GPP TS 29.281 [4].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "8\tInterworking with DN (IP)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "5GS shall support interworking with DNs based on the Internet Protocol (IP). These interworked networks may be either intranets or the Internet.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.2\tDN Interworking Model",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.2.1\tGeneral",
                            "text_content": "When interworking with the IP networks, the 5GS can operate IPv4 and/or IPv6. The interworking point is shown in clause 6.\nThe UPF for interworking with the IP network is the 5GS access point (see figure 8.2.1-1).\nThe figure depicts the protocol stacks of the IP network interworking, illustrating the various protocols used for network communication.\nFigure 8.2.1-1: The protocol stacks of UPF for the IP network interworking\nTypically, in the IP networks, the interworking with subnetworks is done via IP routers. The N6 reference point is between the UPF and the external IP network. From the external IP network's point of view, the UPF is seen as a normal IP router. The L2 and L1 layers are operator specific.\nIt is out of the scope of the present document to standardise the router functions and the used protocols in the N6 reference point.\nInterworking with user defined ISPs and private/public IP networks is subject to interconnect agreements between the network operators.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.2\tAccess to DN through 5G Network",
                            "text_content": "The figure depicts a DN Interworking Model, specifically the transparent case, which illustrates the interworking of different network layers. The DN Interworking Model is a key component of SDN, enabling the seamless integration of network functions across different network layers.\nFigure 8.2.2.1-1: Example of the DN Interworking Model, transparent case\nIn figure 8.2.2.1-1, an example DN interworking model for transparent access to the Internet is provided for an UPF in the 5GS and its N6 reference point.\nIn transparent access to the Internet case:\n-\tthe UE is given an IPv4 address and/or an IPv6 prefix belonging to the operator addressing space. The IPv4 address and/or IPv6 prefix is assigned either at subscription in which case it is a static address or at PDU session establishment in which case it is a dynamic address. This IPv4 address and/or IPv6 prefix if applicable is used for packet forwarding between the Internet and the UPF and within the 5GS. With IPv6, Stateless Address Autoconfiguration shall be used to assign an IPv6 address to the UE. These procedures are as described in the IPv6 non-transparent access case except that the addresses belong to the operator addressing space.\n-\tthe UE need not send any authentication request at PDU session establishment procedure and the SMF/UPF need not take any part in the user authentication/authorization process.\nThe transparent case provides at least a basic ISP service. As a consequence of this it may therefore provide a QoS flow service for a tunnel to a private Intranet. The user level configuration may be carried out between the UE and the intranet, the 5GS is transparent to this procedure. The used protocol stack is depicted in figure 8.2.2.1-2.\nThe figure depicts a transparent access point (TAP) that allows users to access an intranet, illustrating the concept of network visibility and security.\nFigure 8.2.2.1-2: Transparent access to an Intranet\nThe communication between the PLMN and the Intranet may be performed over any network, even an insecure network e.g. the Internet. There is no specific security protocol between the UPF and the Intranet because security is ensured on an end to end basis between the UE and the intranet by the \"Intranet Protocol\".\nUser authentication and encryption of user data are done within the \"Intranet Protocol\" if either of them is needed. This \"Intranet Protocol\" may also carry private (IP) addresses belonging to the address space of the Intranet.\nAn example of an \"Intranet Protocol\" is IPsec (see IETF RFC 1825 [29]). If IPsec is used for this purpose, then IPsec authentication header or security header may be used for user (data) authentication and for the confidentiality of user data (see IETF RFC 1826 [30] and IETF RFC 1827 [31]). In this case private IP tunnelling within public IP takes place.\nIn this case:\n-\ta static or a dynamic IPv4 address belonging to the Intranet/ISP addressing space is allocated to a UE at PDU session establishment. The methods of allocating IP address to the UE are specified in 3GPP TS 23.501 [2]. The allocated IPv4 address is used for packet forwarding within the UPF or UPF+PGW-U and for packet forwarding on the Intranet/ISP;\n-\tas a part of the PDU session establishment, the SMF or SMF+PGW-C may request user authentication from an external DN-AAA server (i.e. RADIUS, Diameter) belonging to the Intranet/ISP;\n-\tthe IPv4 address allocation to the UE may be performed based on the subscription or a local address pool, which belongs to the Intranet/ISP addressing space, provisioned in the SMF or SMF+PGW-C; provisioned in the UPF or UPF+PGW-U or via the address allocation servers (i.e. DHCPv4, RADIUS DN-AAA, Diameter DN-AAA) belonging to the Intranet/ISP;\n-\tif requested by the UE at PDU session establishment, the SMF or SMF+PGW-C may retrieve the Protocol Configuration Options or IPv4 configuration parameters from a locally provisioned database in SMF or SMF+PGW-C and/or from some external server (i.e. DHCPv4, RADIUS DN-AAA, Diameter DN-AAA) belonging to the Intranet/ISP;\n-\tthe communication between the 5GS and the Intranet/ISP may be performed over any network, even an insecure network, e.g. the Internet. In case of an insecure connection between the UPF or UPF+PGW-U and the Intranet/ISP, there may be a specific security protocol in between. This security protocol is defined by mutual agreement between PLMN operator and Intranet/ISP administrator.\nTable 8.2.2.2-1 summarizes the IPv4 address allocation and parameter configuration use cases between the UE and the SMF or SMF+PGW-C that may lead the SMF or SMF+PGW-C to interwork with the external DHCPv4, DN-AAA servers. For detailed description of the signalling flows between the UE and the SMF or SMF+PGW-C, see the references in the table.\nTable 8.2.2.2-1: IPv4 address allocation and parameter configuration use cases\n\nNOTE:\tExternal network operators intending to use PAP/CHAP without proper underlying protection for authentication are warned about the respective vulnerabilities of PAP and CHAP protocols from a security point of view. It's up to the external network operator to perform the risk assessment if PAP/CHAP is used for authentication.\nWhen using IPv6 Address Autoconfiguration, the process of setting up the access to an Intranet or ISP involves two signalling phases. The first signalling phase is done in the control plane and consists of the PDU session establishment for 5GS 3GPP or non-3GPP based access, followed by a second signalling phase done in the user plane.\nThe user plane signalling phase shall be stateless. The stateless procedure, which involves only the UE and the SMF or SMF+PGW-C, is described in clause 10.2. 3.\nFor DNNs that are configured for IPv6 address allocation, the SMF or SMF+PGW-C shall only use the Prefix part of the IPv6 address for forwarding of mobile terminated IP packets. The size of the prefix shall be according to the maximum prefix length for a global IPv6 address as specified in the IPv6 Addressing Architecture, see IETF RFC 4291 [32].\nThe SMF or SMF+PGW-C indicates to the UE that Stateless Autoconfiguration shall be performed by sending Router Advertisements as described in clause 10.2.3 and according to the principles defined in IETF RFC 4861 [33] and IETF RFC 4862 [34].\nFor UE supporting IPv6, IPv6 Stateless Address Autoconfiguration is mandatory.\nIn this case, the SMF or SMF+PGW-C provides the UE with an IPv6 Prefix belonging to the Intranet/ISP addressing space. A dynamic IPv6 address is given using stateless address autoconfiguration. This IPv6 address is used for packet forwarding within the UPF and for packet forwarding on the Intranet/ISP.\nWhen an SMFor SMF+PGW-C receives an initial access request (i.e. Nsmf_PDUSession_CreateSMContext) message, the SMF or SMF+PGW-C deduces from local configuration data associated with the DNN:\n-\tThe source of IPv6 Prefixes (SMF or SMF+PGW-C internal prefix pool, or external address allocation server);\n-\tAny server(s) to be used for address allocation, authentication and/or protocol configuration options retrieval (e.g. IMS related configuration, see 3GPP TS 24.229 [13]);\n-\tThe protocol, i.e. RADIUS, Diameter or DHCPv6, to be used with the server(s);\n-\tThe communication and security feature needed to communicate with the server(s).\nAs an example, the SMF or SMF+PGW-C may use one of the following options:\n-\tSMF or SMF+PGW-C internal Prefix pool for IPv6 prefixes allocation and no authentication;\n-\tSMF or SMF+PGW-C internal Prefix pool for IPv6 prefixes allocation and RADIUS for authentication. The RADIUS DN-AAA server responds with either an Access-Accept or an Access-Reject to the RADIUS client in the SMF or SMF+PGW-C;\n-\tRADIUS for authentication and IPv6 prefix allocation. The RADIUS DN-AAA server responds with either an Access-Accept or an Access-Reject to the RADIUS client in the SMF or SMF+PGW-C.\n-\tRADIUS for authentication. DHCPv6 for IPv6 prefix allocation and may support IPv6 prefix delegation for allocating additional IPv6 prefix(es). The details of IPv6 prefix delegation are described in clause 10.2.5.\nThe SMF or SMF+PGW-C includes the IPv6 address composed of a Prefix and an Interface-Identifier in the initial access response (Namf_Communication_N1N2MessageTransfer). The Interface-Identifier may have any value and it does not need to be unique within or across DNNs. It shall however not conflict with the Interface-Identifier that the SMF or SMF+PGW-C has selected for its own side of the UE-SMF link. The Prefix assigned by the SMF or SMF+PGW-C or the external DN-AAA server shall be globally or site-local unique (see the Note in clause 11.3 of this document regarding the usage of site-local addresses).\nTable 8.2.2.3-1 summarizes the IPv6 prefix allocation and parameter configuration use cases between the UE and the SMF or SMF+PGW-C that may lead the SMF or SMF+PGW-C to interwork with the external RADIUS DN-AAA, Diameter DN-AAA and DHCPv6 servers. For detailed description of the signalling flows between the UE and the SMF or SMF+PGW-C, see the references in the table.\nTable 8.2.2.3-1: IPv6 prefix allocation and parameter configuration use cases\n\nNOTE:\tExternal network operators intending to use PAP/CHAP without proper underlying protection for authentication are warned about the respective vulnerabilities of PAP and CHAP protocols from a security point of view. It's up to the external network operator to perform the risk assessment if PAP/CHAP is used for authentication.\nFor IPv6 the PDU session establishment phase is followed by an address autoconfiguration phase. IPv6 prefix is delivered to UE in Router Advertisement message from the SMF or SMF+PGW-C which acts as an access router, in the process of IPv6 Stateless Address Autoconfiguration as described in clause 10.2.2. Besides DHCPv6 protocol, the SMF or PGW-C may also use RADIUS or Diameter protocol for the retrieval of an IPv6 prefix from external DN.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.2.2-1: IPv4 address allocation and parameter configuration use cases",
                                    "table number": 1,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.2.2.3-1: IPv6 prefix allocation and parameter configuration use cases",
                                    "table number": 2,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "8.3\tTransport Level Marking",
                    "description": "",
                    "summary": "",
                    "text_content": "Based on operator policy, the transport level packet marking (e.g. setting the DiffServ Code Point) by the SMF/UPF in the uplink may be based on the 5QI, the Priority Level (if explicitly signalled), and optionally the ARP priority level, of the associated QoS flow.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "9\tInterworking with DN (Unstructured)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "9.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "When support of unstructured PDU type data is provided at the N6 interface, different Point-to-Point (PtP) tunneling techniques may be used. When using PtP tunneling by UDP/IPv6 encapsulation clause 9.2 below shall be followed. Other techniques as described in clause 9.3 below may be used.\nIn the following clauses, the AS is used as an example for the destination in the external DN.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.2\tN6 PtP tunnelling based on UDP/IP",
                    "description": "",
                    "summary": "",
                    "text_content": "N6 PtP tunnelling based on UDP/IPv6 may be used to deliver unstructured PDU type data to the AS.\nThe PtP tunnel is set up by configuration of tunnel parameters in both end of the tunnel. The following parameters are pre-configured in the UPF per DNN:\n-\tthe UDP destination port number to use when sending unstructured PDU type data;\n-\tthe UDP port number it wants to receive unstructured PDU type data;\n-\tthe destination IP address to be used for sending unstructured PDU type data.\nThe following is pre-configured in the AS:\n-\tthe UDP destination port number to use when sending unstructured PDU type data;\n-\tthe UDP port number it wants to receive unstructured PDU type data.\nNOTE 1:\tThe UPF as well as the AS can use any UDP port numbers not assigned by IANA. The port numbers used need to be aligned between peers.\nIP address allocation procedures for the UE (i.e. PDU session) are performed by the SMF as described in clause 6.3.2, but the IPv6 prefix is not provided to the UE, i.e. Router Advertisements and DHCPv6 are not performed. The SMF assigns a suffix (i.e. IPv6 Interface Identifier) for the PDU session. For the N6 PtP tunnel, the IPv6 prefix allocated for the PDU session plus suffix assigned for the PtP tunnel is used as source address for the uplink data and as destination address for the downlink data.\nDuring the PDU session establishment, the UPF associates the GTP-U tunnel for the PDU session with the N6 PtP tunnel.\nThe UPF acts as a transparent forwarding node between the UE and the AS.\nFor uplink delivery, if the uplink data is received from the GTP-U tunnel, the UPF shall forward the received data to the AS over the N6 PtP tunnel associated with the GTP-U tunnel with the destination address of the AS and the configured UDP destination port number for unstructured PDU type data.\nFor downlink delivery, the AS shall send the data using UDP/IP encapsulation with the IPv6 prefix plus suffix as destination address and the configured UDP destination port number for unstructured PDU type data.\nNOTE 2:\tThe UPF decapsulates the received data (i.e. removes the UDP/IPv6 headers) and forwards the data on the GTP-U tunnel identified by the IPv6 prefix of the UE (i.e. PDU session) for delivery to the UE.\nThe figure depicts a protocol configuration for unstructured PDU type data (user plane) using N6 UDP/IPv6 PtP tunneling, illustrating the use of IPv6 for data transmission.\nFigure 9.2-1: Protocol configuration for unstructured PDU type data (user plane) using N6 UDP/IPv6 PtP tunneling\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.3\tOther N6 tunnelling mechanism",
                    "description": "",
                    "summary": "",
                    "text_content": "N6 PtP tunnelling mechanisms such as PMIPv6/GRE, L2TP, etc, may be used to deliver unstructured PDU type data to AS. The general handling of such delivery mechanisms is as described below.\nA PtP tunnel is established by the UPF towards the AS. Depending on the type of protocol employed on the N6 PtP tunnel, the N6 PtP tunnel setup may be done at the time of PDU Session establishment or at the time of first MO datagram being sent by the UE. The UPF selects the AS based on its configuration (e.g. per DNN, or per PtP tunnel type, etc). However, IP address allocation procedures for the UE (according to clause 6.3.2) are not performed by the SMF.\nNOTE:\tAn AS can be dedicated for handling a specific protocol for unstructured PDU type data.\nThe UPF acts as a transparent forwarding node between the UE and the AS.\nFor uplink delivery, the UPF forwards the received data to the AS over the established N6 PtP tunnel.\nFor downlink delivery, the AS locates the right N6 PtP tunnel for the UE (using information such as UE identifiers in the unstructured PDU type protocol itself, etc) to forward the data. The AS sends the data to UPF over the established N6 PtP tunnel. The UPF in turn sends the data on the GTP-U tunnel identified by the associated N6 PtP tunnel for delivery to the UE.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "10\tInterworking with DN (DHCP)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "10.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "In current LAN environments the most commonly used configuration protocol is DHCP (Dynamic Host Configuration Protocol, IETF RFC 2131 [18]) and DHCPv6 (Dynamic Host Configuration Protocol for IPv6, IETF RFC 3315 [21]). It provides a mechanism for passing a large set of configuration parameters to hosts connected to a TCP/IP network (IP address, sub-net mask, domain name, MTU, etc.) in an automatic manner. Moreover, DHCP may assign IP addresses to clients for a finite lease time, allowing for sequential reassignment of addresses to different users.\nThe lease time is chosen by the administrator of the DHCP server (in the external network), and is therefore out of the scope of the present document.\nThe 3GPP network may obtain IP address via external DHCP server during the PDU establishment procedure, the SMF or SMF+PGW-C acts a DHCP server towards the UE and it acts as a DHCP client towards the external DHCP server.\nIn the following cases the PDU session associated with the allocated IPv4 address or IPv6 prefix shall be released:\n-\tif the DHCP lease expires;\n-\tif the DHCP renewal is rejected by the DHCP server;\n-\tif the IP address is changed during the renewal process. Usually when the lease is renewed, the IP address remains unchanged. However, if for any reason (e.g. poor configuration of the DHCP server), a different IP address is allocated during the lease renewal process the associated PDU session shall be released.\nA RG may request DHCP singalling for a UE behind the RG as specified in 3GPP TS 23.316 [43].When handling DHCP signalling coming from the wireline BBF access, the SMF or SMF+PGW-C shall support the DHCP signalling as described in BBF TR-456 [54].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.2\tDN interworking Model of SMF or SMF+PGW-C for DHCP",
                    "description": "",
                    "summary": "",
                    "text_content": "A DHCP client shall be located in the SMF or SMF+PGW-C used for interworking with the IP network as illustrated in figure 10.2.1-1.\nThe figure depicts the protocol stacks for the N6 reference point for DHCP, illustrating the various components involved in the DHCP process. The diagram includes the DHCP server, DHCP client, and the DHCP server's IP address, subnet mask, and default gateway. The DHCP server's IP address is highlighted, indicating its role in managing the DHCP request and response. The DHCP client's IP address is also shown, representing the client device that initiates the DHCP request. The DHCP server's subnet mask is depicted, showing the network address space that the DHCP server can use to assign IP addresses. The DHCP server's default gateway is shown, which is the IP address that the DHCP server uses to forward requests to the DHCP server. The DHCP server's IP address is also shown, indicating its role in managing the DHCP request and response. The DHCP server's subnet mask is depicted, showing the network address space that the DHCP server can use to assign IP addresses. The DHCP server's default gateway is shown, which is the IP address that the DHCP server uses to forward requests to the DHCP server. The DHCP server's IP address is also shown, indicating its role in managing the DHCP request and response. The DHCP server's subnet mask is depicted,\nFigure 10.2.1-1: The protocol stacks for the N6 reference point for DHCP\nThe DHCP client function in the SMF or SMF+PGW-C shall be used to allocate IPv4 address or IPv6 prefix to the UE and/or to configure associated parameters via external DHCP servers. The SMF or SMF+PGW-C shall have both DHCPv4 and DHCPv6 client functions.\nThe procedures where the DHCP client function in the SMF or SMF+PGW-C is used are further described in 3GPP TS 23.501 [2]. The procedures are IPv4 address allocation and IPv4 parameter configuration via an external DHCPv4 server; IPv6 Prefix allocation via stateless address autoconfiguration; and IPv6 parameter configuration via stateless DHCPv6. These procedures are detailed in the clauses below.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.2.2\tIPv4 Address allocation and IPv4 parameter configuration via DHCPv4",
                            "text_content": "The UE may obtain the IPv4 address and/or its configuration parameters at or after the initial access signalling (i.e. Nsmf_PDUSession_CreateSMContext) to the 3GPP network. The request for IPv4 address and/or configuration parameters from the UE may trigger the SMF or SMF+PGW-C acting as a DHCPv4 client to request the IPv4 address and/or configuration parameters from an external DHCPv4 server and deliver them to the UE. The DHCPv4 functions in the SMF or SMF+PGW-C, the UE and the external DHCPv4 server shall be compliant to IETF RFC 2131 [18], IETF RFC 1542 [19] and IETF RFC 4039 [20].\nThe following system procedure describes the successful IPv4 address allocation and parameter configuration signalling flow between the SMF or SMF+PGW-C and the external DHCPv4 server as depicted in figure 10.2.2-1. For a detailed description of the DHCPv4 messages, refer to IETF RFC 2131 [18], IETF RFC 1542 [19] and IETF RFC 4039 [20].\n1)\tThe DHCPv4 client function in the SMF or SMF+PGW-C sends a DHCPDISCOVER as an IP limited broadcast message, i.e. the destination address 255.255.255.255, towards the external DN. If the SMF or SMF+PGW-C has the DHCPv4 server IP addresses configured for the DNN, the DHCPDISCOVER shall be send as unicast (or even multicast) to the external DHCPv4 servers.\n2)\tUpon receiving the DHCPDISCOVER request message, the external DHCPv4 servers reply by sending a DHCPOFFER message including an offered IP address. Several DHCPOFFER messages may be received by the SMF or SMF+PGW-C if multiple DHCPv4 servers respond to the DHCPDISCOVER.\n3)\tThe DHCPv4 client function in the SMF or SMF+PGW-C processes the messages and sends a DHCPREQUEST towards the selected external DHCPv4 server.\nNOTE:\tIf the optimized signalling (Rapid Commit Option) is used as per IETF RFC 4039 [20], the messages 2-3 can be eliminated.\n4)\tUpon receiving the DHCPREQUEST message, the selected external DHCPv4 server acknowledges the address allocation by sending a DHCPACK containing the lease period (T1), the time-out time (T2) and the configuration information requested in DHCPREQUEST. The SMF or SMF+PGW-C stores the allocated IPv4 address, the lease timers and the configuration parameters. The SMF or SMF+PGW-C shall further deliver the IPv4 address and the configuration parameters to the UE by SM NAS message.\nThe figure depicts the signalling flow for IPv4 address allocation and parameter configuration using DHCPv4, illustrating the steps involved in assigning and configuring IP addresses and parameters for a network.\nFigure 10.2.2-1: The signalling flow for IPv4 address allocation and parameter configuration using DHCPv4\nFigure 10.2.2-2 is a signalling flow for IPv4 address lease renew by using DHCPv4 protocol as specified in IETF RFC 2131 [18].\n1)\tThe DHCPv4 client function in the SMF or SMF+PGW-C sends a unicast DHCPREQUEST towards the external DHCPv4 server to extend the lease period of the allocated IPv4 address.\n2)\tThe external DHCPv4 server replies with a DHCPACK message confirming the renewed lease and the T1 and T2 timers are restarted.\nThe figure depicts the signalling flow for IPv4 address lease renew using DHCPv4, illustrating the steps involved in the lease renewal process. The flow starts with the DHCP server sending a lease request to the lease server, which then sends a lease renewal request to the lease server. The lease server then sends a lease renewal request to the lease server, which then sends a lease renewal request to the lease server, and so on, until the lease is successfully renewed.\nFigure 10.2.2-2: The signalling flow for IPv4 address lease renew using DHCPv4\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.3\tIPv6 Prefix allocation via IPv6 stateless address autoconfiguration via DHCPv6",
                            "text_content": "When the IPv6 prefix is allocated from the external DN, the SMF or SMF+PGW-C is responsible to obtain the IPv6 prefix for external DN, allocate and release the IPv6 prefix. The SMF or SMF+PGW-C may use DHCPv6 to obtain the IPv6 prefix from the external DN. In this context, the SMF or SMF+PGW-C shall act as a DHCP client as per IETF RFC 3315 [21] towards the external DHCPv6 server.\nThe SMF or SMF+PGW-C may allocate a second IPv6 prefix for routing traffic via a second UPF or UPF+PGW-U to enable simultaneous access via remote and local networks or to enable SSC mode 3 (i.e. make-before-break) mobility, as described in clause 4.3.5.3 of 3GPP TS 23.502 [3].\nThe following system procedure describes the signalling flows for the IPv6 Stateless Address Autoconfiguration procedures for 5G system. The procedures are based on the descriptions in 3GPP TS 23.501 [2] and 3GPP TS 23.502 [3].\n1.\tUE initiates the PDU Session Establishment procedure, indicating IPv6 address is required.\n2.\tThe AMF sends PDU Session Establishment Request in Nsmf_PDUSession_CreateSMContext to the SMF or SMF+PGW-C.\n3.\tThe SMF or SMF+PGW-C may retrieve IPv6 prefix using DHCPv6 mechanism. This procedure is performed when an external DN allocates an IPv6 prefix, the signaling between the SMF or SMF+PGW-C and external DN is exchanged via UPF or UPF+PGW-U which is omitted in the figure 10.2.3-1.\n4.\tThe SMF or SMF+PGW-C sends PDU Session Establishment Accept included in Namf_Communication_N1N2MessageTransfer to the AMF. It includes the IPv6 prefix.\n5.\tThe AMF sends PDU Session Establishment Accept message to the UE without the IPv6 prefix. The UE shall ignore the IPv6 prefix if it receives it in the message.\n6.\tThe UE may send a Router Solicitation to the SMF or SMF+PGW-C via the UPF or UPF+PGW-U to solicit a Router Advertisement message.\n7.\tThe SMF or SMF+PGW-C sends a Router Advertisement message to the UE via the UPF or UPF+PGW-U, solicited or unsolicited. It shall include an IPv6 prefix in Prefix Information option field of the message. The prefix is the same as the one in the PDU Session Establishment Accept message, if it is provided during the previous PDU Session Establishment procedure.\n8.\tAt any time after PDU session establishment, the SMF or SMF+PGW-C may trigger the establishment on an alternative route via UPF2 or UPF+PGW-U2 for access to a local data network or for SSC mode 3 mobility.\n9.\tLike step 3, the SMF or SMF+PGW-C may retrieve a second IPv6 prefix using DHCPv6 mechanism.\n10.\tThe SMF or SMF+PGW-C sends a Router Advertisement to the UE via UPF2 or UPF+PGW-U2 to update the UE. Note that this will occur without a Router Solicitation since the UE is unaware of the network's decision to form an alternative Route.\n11.\tSpecific to the case of SSC mode 3 mobility, the SMF or SMF+PGW-C sends a Router Advertisement to the UE via UPF1 or UPF+PGW-U1 with zero value in the preferred lifetime field and a value in the valid lifetime field according to IETF RFC 4862 [34]. The UE shall update the valid lifetime of the old IPv6 prefix to the signalled value, regardless of the remaining lifetime. The signalled lifetime value indicates how long the SMF or SMF+PGW-C is willing to keep the old IPv6 prefix.\nNOTE:\tAlternative routes can be established repeatedly through additional UPFs or UPF+PGW-Us and old routes can be terminated when required by the SMF or SMF+PGW-C. More complex scenarios are not described here for the sake of simplicity.\nIPv6 Stateless Address Autoconfiguration (SAAC) is a feature in IPv6 that allows a network to automatically configure a new address for a device without requiring a new configuration. This feature is beneficial for network administrators as it simplifies the process of assigning addresses to devices and reduces the need for manual configuration.\nFigure 10.2.3-1: IPv6 Stateless Address Autoconfiguration\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.4\tIPv6 parameter configuration via stateless DHCPv6",
                            "text_content": "A UE that has obtained an IPv6 address may use stateless DHCP to request other configuration information such as a list of DNS recursive name servers or SIP servers.\nFor 3GPP networks, when an external DHCPv6 server in a DN is used to obtain the requested parameters, the SMF acts as a DHCPv6 client towards the external DHCPv6 server while acting a DHCPv6 server towards the UE.\nThe IPv6 parameter configuration via stateless DHCPv6 function in the UE, the SMF and the external DHCPv6 Server shall be compliant to IETF RFC 3736 [22]. The following system procedure describes the signalling flows for the IPv6 parameter configuration via stateless DHCPv6 procedures for 5G system. All messages in the following steps between the UE and the SMF are sent via the UPF.\n1)\tA Router Advertisement with the O-flag set, is sent from SMF to UE to indicate to it to retrieve other configuration information.\n2)\tThe UE sends an INFORMATION-REQUEST message with the IP destination address set to the All_DHCP_Relay_Agents_and_Servers multicast address defined in the DHCPv6 IETF RFC 3315 [21]. The source address shall be the link-local address of the UE. The DHCP relay agent in the SMF shall forward the message.\n3)\tDHCP servers receiving the forwarded INFORMATION-REQUEST message, reply by sending a RELAY-REPLY message, with the \"Relay Message\" option including a REPLY message with the requested configuration parameters.\nThe UE chooses one of the possibly several REPLY messages and extracts the configuration information.\nThe figure depicts the DHCPv6 Other configuration signal flow, illustrating the various steps involved in configuring the DHCPv6 protocol for a network. The flow includes the initial DHCP request, the negotiation phase, and the final DHCP response. The figure provides a clear and concise representation of the process, making it easy to understand the steps and the steps involved in configuring DHCPv6.\nFigure 10.2.4-1: DHCPv6 Other configuration signal flow\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.5\tIPv6 Prefix Delegation via DHCPv6",
                            "text_content": "SMF or SMF+PGW-C may (depending on the configuration for the DNN/S-NSSAI) assign a single network prefix shorter than the default /64 prefix to a PDU Session from the internal IPv6 Prefix pool or via DHCPv6. In this case, the /64 default prefix used for IPv6 stateless autoconfiguration shall be allocated from this network prefix, except for RG may have different shorter IPv6 prefix(es) delegated via DHCPv6 not including the allocated /64 default prefix; the remaining address space from the network prefix may be delegated to the PDU Session using prefix delegation after the PDU Session establishment and IPv6 prefix allocation via IPv6 stateless address autoconfiguration as defined in clause 10.2.3.\nDepending on configuration, the SMF may obtain the prefix from a locally provisioned pool, from the PSA UPF or from the external DN.\nIf the UE had indicated that it supports prefix exclusion and the prefix to be delegated to the UE includes the /64 prefix that was allocated to the PDU Session, the SMF or SMF+PGW shall utilize the prefix exclusion feature as specified for DHCPv6 Prefix Delegation in RFC 6603 [62].\nThe UE uses DHCPv6 to request additional IPv6 prefix (i.e.: prefix in addition to the default prefix) from the SMF or SMF+PGW-C after completing stateless IPv6 address autoconfiguration procedures. The UE acts as a \"Requesting Router\" as described in RFC 8415 [49] and inserts one or more IA_PD option(s) into a DHCPv6 Solicit message sent from the UE to the SMF or SMF+PGW-C via the user plane and the UPF or UPF+PGW-U. The SMF or SMF+PGW-C acts as the DHCP server and fulfils the role of a \"Delegating Router\" according to RFC 8415 [49]. The UE optionally includes the RAPID_COMMIT option in the DHCPv6 Solicit message to trigger two-message DHCPv6 procedure instead of the four-message DHCPv6 procedure. The UE shall include OPTION_PD_EXCLUDE option code in an OPTION_ORO option to indicate support for prefix exclusion. In response to the DHCPv6 Solicit message, the UE receives a DHCPv6 Reply message with one or more IA_PD prefix(es) for every IA_PD option that it sent in the DHCPv6 Solicit message. The SMF or SMF+PGW-C delegates a prefix excluding the default prefix with help of OPTION_PD_EXCLUDE, except for RG as UE when different shorter IPv6 prefix(es) is delegated via DHCPv6. Prefix exclusion procedures shall follow RFC 6603 [62].\nThe additional requirement for RG connecting to 5GC with IPv6 Prefix Delegation via DHCPv6 is defined in clause 10.2.5.2.\nBesides the general support to IPv6 prefix delegation as described in clause 10.2.5.1, a RG may request IPv6 prefix allocation for UE behind the RG as specified in 3GPP TS 23.316 [43]. A SMF or SMF+PGW-C may receive both DHCP options for IA_NA and IA_PD together in a single DHCPv6 message, the SMF or SMF+PGW-C may provide a reply to both IA_NA and IA_PD in the same message or alternatively process the DHCPv6 IA_NA before the DHCPv6 IA_PD.\nFor the detailed description of the RG uses DHCPv6 to request additional IPv6 prefix(es) refer to clause 4.6.2.3 of 3GPP TS 23.316 [43]. The prefix exclude option is optionally used to exclude the default /64 prefix allocated to the PDU Session within the same shorter prefix of the DHCPv6 delegated prefix, and it is possible for SMF or SMF+PGW-C to assign a /64 prefix using stateless address autoconfiguration and one or more completely different shorter prefix(es) using DHCPv6 Prefix Delegation without use of prefix exclude option.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.3\t3GPP Vendor-Specific Options",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes 3GPP Vender-Specific Options that will be included in DHCP messages exchanged between SMF or SMF+PGW-C and DHCP Server. Other DHCP options may be used as defined in DHCP RFC(s). Unless otherwise stated, when the encoding scheme of an attribute is specified as UTF-8 encoding, this shall be interpreted as UTF-8 hexadecimal encoding.\nThe DHCPv4 vendor specific option is encoded as per IETF RFC 2132 [47] or IETF RFC 3925 [48]. The DHCPv6 vendor specific option is encoded as per IETF RFC 8415 [49]. For DHCP vendor specific option code 17 or 125, the Enterprise Number shall be set to value 10415.\n\nThe table 10.3-1 lists the encapsulated 3GPP Vendor-Specific Options in DHCP vendor specific option (17/43/125).\nTable 10.3-1: List of the encapsulated 3GPP Vendor-Specific sub-options\n\n1 – 3GPP-IP-Pool-Info\n\n\nVS option code: 1\nLength: m-2 or m-4\nThe IP address pool ID is of Octet String type.\nThe SMF or SMF+PGW-C may determine an IP address pool ID based on UPF ID, S-NSSAI, DNN, and IP version as described in clause 5.8.2.2.1 in 3GPP TS 23.501 [2] and includes the IP address pool ID within 3GPP Vendor-Specific-Option and send it to the DHCP server. The DHCP server assigns IPv6 prefix or IPv4 address from the requested IP address pool. Multiple 3GPP-IP-Pool-Info sub-options may be sent in a DHCP request message. The DHCP server shall return the selected IP address pool ID within 3GPP Vendor-Specific-Option to the SMF or SMF+PGW-C in the DHCP successful response message (e.g. DHCPACK).\n",
                    "tables": [
                        {
                            "description": "Table 10.3-1: List of the encapsulated 3GPP Vendor-Specific sub-options",
                            "table number": 3,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "1 – 3GPP-IP-Pool-Info",
                            "table number": 4,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "",
                            "table number": 5,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "11\tInterworking with DN-AAA (RADIUS)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "11.1\tRADIUS procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.1.1\tRADIUS Authentication and Authorization in 5GC",
                            "text_content": "The SMF also represents the H-SMF in the home routed scenario in this clause unless specified otherwise.\nRADIUS Authentication and Authorization shall be used according to IETF RFC 2865 [8], IETF RFC 3162 [9] and IETF RFC 4818 [10]. In 5G, multiple authentication methods using Extensible Authentication Protocol (EAP) may be used such as EAP-TLS (see IETF RFC 5216 [11]), EAP-TTLS (see IETF RFC 5281 [37]). The SMF shall implement the RADIUS extension to support EAP as specified in IETF RFC 3579 [7].\nThe RADIUS client function may reside in an SMF. When the SMF receives an initial access request (i.e. the SMF receives the Nsmf_PDUSession_CreateSMContext request with type \"Initial request\" for non-roaming case or local breakout case, or the H-SMF receives the Nsmf_PDUSession_Create Request with type \"Initial request\" for home routed case), the RADIUS client function may send the authentication information to a DN-AAA server, which is identified during the DNN provisioning.\nWhen the legacy applications require PAP/CHAP authentication with the UE accessing to the 5GS and the legacy DN-AAA server does not support EAP, PAP/CHAP may be used as the authentication protocol, with the external network performing the risk assessment.\nThe DN-AAA server performs authentication and authorization. The response (when positive) may contain network information, such as an IPv4 address and/or IPv6 prefix for the user when the SMF is interworking with the DN-AAA server.\nThe information delivered during the RADIUS authentication can be used to automatically correlate the user identity (e.g. SUPI) to the IPv4 address and/or IPv6 prefix, if applicable, assigned/confirmed by the SMF or the DN-AAA server respectively. The same procedure applies, in case of sending the authentication to a 'proxy' DN-AAA server.\nFor 5G, RADIUS Authentication is applicable to the initial access request. When the SMF receives an Access-Accept message from the DN-AAA server it shall complete the initial access procedure. If Access-Reject or no response is received, the SMF shall reject the initial access procedure with a suitable cause code.\nWhen DN-AAA server authorizes the PDU Session Establishment, it may send DN authorization data for the established PDU Session to the SMF. The DN authorization data for the established PDU Session may include one or more of the following:\n-\ta reference to authorization data for policy and charging control locally configured in the SMF or PCF;\n-\ta list of allowed MAC addresses (maximum 16) for the Ethernet PDU Session;\n-\ta list of allowed VLAN Ids (maximum 16) for the Ethernet PDU Session;\n-\tSession-AMBR for the PDU Session;\n-\tL2TP information, such as LNS IP address and/or LNS host name; and\n-\tFramed Route information for the PDU Session.\nNOTE: If the DN-AAA server send L2TP information to SMF, the L2PT information can e.g. be provisioned per DNN/S-NSSAI or per SUPI or GPSI by configuration which is out of the scope of 3GPP specifications.\nSMF policies may require DN authorization without DN authentication. In that case, when contacting the DN-AAA server for authorization, the SMF shall provide the GPSI of the UE if available.\nThe SMF may also use the RADIUS re-authorization procedure for the purpose of IPv4 address and/or IPv6 prefix allocation to the UE. The use cases that may lead this procedure are:\n-\tIPv4 address and/or IPv6 prefix allocation after UPF selection during PDU session establishment procedure.\n-\tIPv6 prefix allocation during adding additional PDU Session Anchor procedure for IPv6 multi-homing.\n-\tIPv4 address allocation via DHCPv4 procedure after successful PDU session establishment procedure.\nThe SMF may also trigger request for DN authentication/authorization and/or IP address/prefix allocation based on UE subscription data retrieve from the UDM as defined in clause 5.2.2.2.5 of 3GPP TS 29.503.\nWhen an IPv4 address and/or IPv6 prefix (including any additional IPv6 prefix of IPv6 multi-homing) is (re-)allocated or de-allocated (not causing the PDU session to be released) by using a method not via the DN-AAA server and if the SMF was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF shall, if applicable, use the authentication session that was established before to inform the DN-AAA server  by sending RADIUS Access-Request with the latest list of IPv4 address and/or IPv6 prefix(es).\nWhen the SMF is notified by the UPF regarding the UE MAC address change (a new one is detected or a used one is inactive), if the SMF was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF shall, if applicable, use the authentication session that was established before to inform the DN-AAA server by sending RADIUS Access-Request with the latest list of UE MAC addresses in use.\nDN-AAA may initiate QoS flow termination, re-authorization and re-authentication, see details in clause 11.2.3, clause 11.2.4 and clause 11.2.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.1a\tRADIUS Authentication and Authorization in EPC Interworking",
                            "text_content": "RADIUS Authentication and Authorization shall be used according to IETF RFC 2865 [8], IETF RFC 3162 [9] and IETF RFC 4818 [10]. The SMF+PGW-C shall implement the RADIUS extension to support EAP as specified in IETF RFC 3579 [7].\nWhen the SMF+PGW-C receives a new Create Session Request and the Session Management Subscription Data from the UDM or local configuration indicate the need for EAP-based secondary authentication and authorization by DN-AAA, the RADIUS client function may send the authentication information to a DN-AAA server, which is identified during the DNN provisioning.\nWhen the legacy applications require PAP/CHAP authentication with the UE accessing the 5GC and EPC interworking scenario and the legacy DN-AAA server does not support EAP, PAP/CHAP may be used as the authentication protocol, with the external network performing the risk assessment.\nThe DN-AAA server performs authentication and authorization. The response (when positive) may contain network information, such as an IPv4 address and/or IPv6 prefix for the user when the SMF+PGW-C is interworking with the DN-AAA server.\nThe information delivered during the RADIUS authentication can be used to automatically correlate the user identity (e.g. SUPI) to the IPv4 address and/or IPv6 prefix, if applicable, assigned/confirmed by the SMF+PGW-C or the DN-AAA server respectively. The same procedure applies, in case of sending the authentication to a 'proxy' DN-AAA server.\nWhen the SMF+PGW-C receives an Access-Accept message from the DN-AAA server it shall complete the initial access procedure. If Access-Reject or no response is received, the SMF+PGW-C shall reject the PDN Connection procedure with a suitable cause code.\nWhen DN-AAA server authorizes the PDN Connection Establishment, it may send DN authorization data for the established PDN Connection to the SMF+PGW-C. The DN authorization data for the established PDN Connection may include one or more of the following:\n-\ta reference to authorization data for policy and charging control locally configured in the SMF+PGW-C or PCF;\n-\ta list of allowed MAC addresses (maximum 16) for the Ethernet PDN Connection;\n-\ta list of allowed VLAN Ids (maximum 16) for the Ethernet PDN Connection;\n-\tSession-AMBR for the PDN Connection;\n-\tL2TP information, such as LNS IP address and/or LNS host name; and\n-\tFramed Route information for the PDN Connection.\nNOTE: If the DN-AAA server send L2TP information to SMF+PGW-C, the L2PT information can e.g. be provisioned per DNN/S-NSSAI or per SUPI or GPSI by configuration which is out of the scope of 3GPP specifications.\nSMF+PGW-C policies may require DN authorization without DN authentication. In that case, when contacting the DN-AAA server for authorization, the SMF+PGW-C shall provide the GPSI of the UE if available.\nThe SMF may also use the RADIUS re-authorization procedure for the purpose of IPv4 address and/or IPv6 prefix allocation to the UE. The use cases that may lead this procedure are:\n-\tIPv4 address and/or IPv6 prefix allocation after UPF+PGW-U selection during PDN connection establishment procedure.\n-\tIPv6 prefix allocation during adding additional PDN Connection Anchor procedure for IPv6 multi-homing.\n-\tIPv4 address allocation via DHCPv4 procedure after successful PDN connection establishment procedure.\nThe SMF+PGW-C may also trigger request for DN authentication/authorization and/or IP address/prefix allocation based on UE subscription data retrieve from the UDM as defined in clause 5.2.2.2.5 of 3GPP TS 29.503.\nWhen an IPv4 address and/or IPv6 prefix (including any additional IPv6 prefix of IPv6 multi-homing) is (re-)allocated or de-allocated (not causing the PDN connection to be released) by using a method not via the DN-AAA server and if the SMF+PGW-C was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF+PGW-C shall, if applicable, use the authentication session that was established before to inform the DN-AAA server  by sending RADIUS Access-Request with the latest list of IPv4 address and/or IPv6 prefix(es).\nWhen the SMF+PGW-C is notified by the UPF+PGW-U regarding the UE MAC address change (a new one is detected or a used one is inactive), if the SMF+PGW-C was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF+PGW-C shall, if applicable, use the authentication session that was established before to inform the DN-AAA server by sending RADIUS Access-Request with the latest list of UE MAC addresses in use.\nDN-AAA may initiate QoS flow termination, re-authorization and re-authentication, see details in clause 11.2.3, clause 11.2.4 and clause 11.2.5. In case EAP based authentication and authorization has been performed for the PDU Session while the UE was in 5GS, and if SMF+PGW-C determines that the UE has moved to the EPS (i.e. the SMF+PGW-C receives the modify bearer request or create session request from the S-GW), the following applies:\n-\tthe SMF+PGW-C may initiate RADIUS re-authorization procedure without re-authentication with the DN-AAA server based on local policy.\n-\tDN-AAA initiated re-authorization without re-authentication may be performed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.2\tRADIUS Accounting",
                            "text_content": "RADIUS Accounting shall be used according to IETF RFC 2866 [26], IETF RFC 3162 [9] and IETF RFC 4818 [10].\nThe RADIUS accounting client function may reside in an SMF. The RADIUS accounting client may send information to a DN-AAA server, which is identified during the DNN provisioning. The DN-AAA server may store this information and use it to automatically identify the user. This information can be trusted because the 3GPP network has authenticated the subscriber (i.e. USIM card and possibly other authentication methods).\nThe SMF may use the RADIUS Accounting-Request Start and Stop messages during QoS flow (e.g. QoS flow associated with the default QoS rule) establishment and termination procedures, respectively.\nThe use of Accounting-Request STOP and in addition the Accounting ON and Accounting OFF messages may be used to ensure that information stored in the DN-AAA server is synchronised with the SMF information.\nIf the DN-AAA server is used for IPv4 address and/or IPv6 prefix assignment, then, upon reception of a RADIUS Accounting-Request STOP message for all QoS flows associated to a PDU session defined by DNN and SUPI or GPSI, the DN-AAA server may make the associated IPv4 address and/or IPv6 prefix available for assignment.\nWhen an IPv4 address and/or IPv6 prefix (including any additional IPv6 prefix of IPv6 multi-homing) is (re-)allocated or de-allocated (not causing the PDU session to be released) by using a method not via the DN-AAA server and if the SMF was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF shall, if applicable, use the accounting session that was established before to inform the DN-AAA server by sending RADIUS Accounting-Request Interim-Update with the latest list of IPv4 address and/or IPv6 prefix(es).\nWhen the SMF is notified by the UPF regarding the UE MAC address change (a new one is detected or a used one is inactive), if the SMF was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF shall, if applicable, use the accounting session that was established before to inform the DN-AAA server by sending RADIUS Accounting-Request Interim-Update with the latest list of UE MAC addresses in use.\nIn order to avoid race conditions, the SMF shall include a 3GPP Vendor-Specific sub-attribute \"Session Stop indicator\" when it sends the Accounting-Request STOP for the last QoS flow of a PDU session and the PDU session is terminated (i.e. the IPv4 address and/or IPv6 prefix and any associated GTP tunnel can be released). The DN-AAA server shall not assume the PDU session terminated until an Accounting-Request STOP with the Session Stop indicator is received.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "11.2\tMessage flows on N6 interface",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.2.1\tAuthentication, Authorization and Accounting procedures in 5GC",
                            "text_content": "The SMF also represents the H-SMF in the home routed scenario in this clause unless specified otherwise.\nWhen an SMF receives an initial access request (i.e. the SMF receives the Nsmf_PDUSession_CreateSMContext request with type \"Initial request\" for non-roaming case or local breakout case, or the H-SMF receives the Nsmf_PDUSession_Create Request with type \"Initial request\" for home routed case) message for a given DNN, the SMF may (depending on the configuration for this DNN) send a RADIUS Access-Request message with EAP extension to a DN-AAA server. The SMF may also (depending on the configuration for this DNN) send the S-NSSAI and the PDU Session ID that are associated with the PDU Session, respectively in the 3GPP-Session-S-NSSAI VSA and the 3GPP-Session-Id VSA, to a DN-AAA server. Upon receipt of the Access-Request message, the DN-AAA server shall respond with an Access-Challenge message. Multi-round authentication using the Access-Challenge (sent by DN-AAA) and Access-Request messages may be used. The DN-AAA server finally authenticates and authorizes the user by replying with an Access Accept message. If the DN-AAA server is also responsible for IPv4 address and/or IPv6 prefix allocation, the DN-AAA server shall return the allocated IPv4 address and/or IPv6 prefix in the Access-Accept message.\nFor re-authentication and re-authorization, the SMF shall send a RADIUS Access-Request message with EAP extension and the DN-AAA shall respond with an Access-Challenge message. Multi-round authentication using the Access-Challenge (sent by DN-AAA) and Access-Request messages may be used. The DN-AAA server finally authenticates and authorizes the user by replying with an Access Accept message.\nThe SMF may initiate RADIUS re-authorization procedures for the purpose of IPv4 address and/or IPv6 prefix allocation (or renew the lease). In this case, the SMF shall set the Service-Type attribute to \"Authorize Only\" and the 3GPP-Allocate-IP-Type subattribute to the type of IP address to be allocated in the Access-Request message sent to the DN-AAA server. If the SMF is using DHCP signalling towards the UE and the DN-AAA server includes the Session-Timeout attribute in the Access-Accept, the SMF may use the Session-Timeout value as the DHCP lease time. The SMF shall not set the DHCP lease time value higher than the Session-Timeout value. The SMF may renew the DHCP lease to the UE without re-authorization towards the DN-AAA server providing that the new lease expiry is no later than the Session-Timeout timer expiry. If the SMF wishes to extend the lease time beyond the current Session-Timeout expiry, it shall initiate a new AAA re-authorization.\nEven if the SMF was not involved in user authentication, it may send a RADIUS Accounting-Request (START) message to a DN-AAA server. This message may contain parameters, e.g. the tuple which includes the user ID and IPv4 address and/or IPv6 prefix, to be used by application servers (e.g. WAP gateway) in order to identify the user, the 3GPP-Charging-Id VSA or 3GPP-Charging-Id-v2 VSA according to the length of the Charging Id for the user session. This message may also (depending on the configuration for the DNN) contains the S-NSSAI and the PDU Session ID that are associated with the PDU Session, respectively in the 3GPP-Session-S-NSSAI VSA and the 3GPP-Session-Id VSA, and/or AF traffic influence PCC rule provisioned and then SMF used DNAI in the 3GPP-DNAI VSA, to a DN-AAA server. This message also indicates to the AAA server that the user session has started. The user session is uniquely identified by the Acct-Session-Id that is composed of the Charging ID and the SMF IP address.\nNOTE:\tIf the accounting session is required by the DN-AAA server to be created per QoS flow, how to identify the different accounting sessions is implementation specific. The SMF can include the Acct-Session-Id which is extended to include the QFI of the QoS flow or the Acct-Session-Id without QFI extension and with 3GPP-NSAPI combination in the RADIUS Accounting-Request (START).\nIf some external applications require RADIUS Accounting-Request (START) information before they can process user packets, then the selected DNN (SMF) may be configured in such a way that the UPF is instructed to drop user data until the Accounting-Response (START) is received from the AAA server. The SMF may wait for the Accounting-Response (START) before sending the final authentication response message in Namf_Communication_N1N2MessageTransfer service operation. The SMF may reject the initial access request if the Accounting-Response (START) is not received. The authentication and accounting servers may be separately configured for each DNN.\nFor IPv4 PDU type, if IPv4 address is allocated via DHCPv4 signalling between the UE and the DN-AAA after PDU session establishment, the SMF may wait to send the Accounting-Request (START) message until the UE receives its IPv4 address in a DHCPACK.\nWhen the SMF receives a message indicating a QoS flow or PDU session release request and providing a RADIUS Accounting-Request (START) message was sent previously, the SMF shall send a RADIUS Accounting-Request (STOP) message to the DN-AAA server, which indicates the termination of this particular QoS flow or PDU session. The SMF shall immediately send the corresponding response (e.g. Nsmf_PDUSession_UpdateSMContext response) to the AMF, without waiting for an Accounting-Response (STOP) message from the DN-AAA server.\nThe DN-AAA server shall deallocate the IPv4 address and/or IPv6 prefix initially allocated to the subscriber, if there is no session for the subscriber.\nAccounting-Request (ON) and Accounting-Request (OFF) messages may be sent from the SMF to the DN-AAA server to ensure the correct synchronization of the session information in the SMF and the DN-AAA server.\nThe SMF may send an Accounting-Request (ON) message to the DN-AAA server to indicate that a restart has occurred. The DN-AAA server may then release the associated resources.\nPrior to a scheduled restart, the SMF may send Accounting-Request (OFF) message to the DN-AAA server. The DN-AAA server may then release the associated resources.\nThe following figure 11.2.1-1 is an example message flow to show the procedure of RADIUS Authentication and Accounting between an SMF and a DN-AAA server:\n1.\tUE initiates the PDU Session Establishment procedure, including authentication/authorization information.\n2.\tThe AMF sends Nsmf_PDUSession_CreateSMContext Request including the authentication/authorization information to the SMF and the SMF responds to the service operation.\nAccording to the configuration in the SMF, step 6 to step 9 are executed before step 3 if the SMF needs to send an EAP-Request message to the UE.\nIn the case of home routed, the AMF sends Nsmf_PDUSession_CreateSMContext Request including the authentication/authorization information to the V-SMF and the V-SMF sends Nsmf_PDUSession_Create Request including the authentication/authorization information to the H-SMF.\n3.\tIf the N4 session has not been established before, the SMF triggers the N4 Session Establishment procedure to the UPF.\nIn the case of home routed, the V-SMF triggers the N4 Session Establishment procedure to the V-UPF and the H-SMF triggers the N4 Session Establishment procedure to the H-UPF.\n4.\tThe SMF sends the Access-Request message to the DN-AAA via the UPF, the message is forwarded from the SMF to the DN-AAA by the UPF in N4 user plane message.\nIn the case of home routed, the H-SMF sends the Access-Request message to the DN-AAA via the H-UPF, the message is forwarded from the H-SMF to the DN-AAA by the H-UPF in N4 user plane message.\n5-10.\tThe DN-AAA responds with the Access-Challenge message to the SMF via the UPF, the message is forwarded from the DN-AAA to the SMF by the UPF in N4 user plane message. The authentication/authorization information is further transferred to UE via Namf_Communication_N1N2MessageTransfer service and NAS SM Transport message. UE responds to the received authentication/authorization data and such information is transferred in NAS SM Transport message and Nsmf_PDUSession_UpdateSMContext service, then finally sent to the DN-AAA by the SMF, via the UPF, in the Access-Request message.\nIn the case of home routed, the DN-AAA responds with the Access-Challenge message to the H-SMF via the H-UPF, the message is forwarded from the DN-AAA to the H-SMF by the H-UPF in N4 user plane message. The authentication/authorization information is transferred to V-SMF via Nsmf_PDUSession_Update service and is further transferred to UE via Namf_Communication_N1N2MessageTransfer service and NAS SM Transport message. UE responds to the received authentication/authorization data and such information is transferred in NAS SM Transport message, Nsmf_PDUSession_UpdateSMContext service and Nsmf_PDUSession_Update servic, then finally sent to the DN-AAA by the H-SMF, via the H-UPF, in the Access-Request message.\nNOTE:\tStep 5 to step 10 can be repeated depending on the authentication/authorization mechanism used (e.g. EAP-TLS).\n11.\tThe SMF receives the final result of authentication/authorization from the DN-AAA in the Access-Accept message, via the UPF.\n12.\tThe SMF requests to start accounting by sending the Accounting-Request (START) message to the DN-AAA via the UPF.\n13.\tThe SMF proceeds with the PDU session establishment procedure and includes the authentication/authorization information in Namf_Communication_N1N2MessageTransfer service.\nIn the case of home routed, the H-SMF proceeds with the PDU session establishment procedure and includes the authentication/authorization information is transferred to V-SMF via Nsmf_PDUSession_Update service and is further transferred to the AMF via Namf_Communication_N1N2MessageTransfer service.\n14.\tThe DN-AAA responds with the Accounting-Response (START) message. The SMF may wait for the Accounting-Response (START) before sending the Namf_Communication_N1N2MessageTransfer request in step 13.\nIn the case of home routed, the H-SMF may wait for the Accounting-Response (START) before sending the Nsmf_PDUSession_Update service in step 13.\n15.\tThe AMF sends the NAS PDU Session Establishment Request with the authentication/authorization information to the UE.\n16.\tThe UE sends a NAS message Deregistration Request to the AMF.\n17.\tThe AMF sends Nsmf_PDUSession_ReleaseSMContext Request to the SMF and the SMF responds to the service operation.\nIn the case of home routed, the AMF sends Nsmf_PDUSession_ReleaseSMContext Request to the V-SMF and the V-SMF sends the Nsmf_PDUSession_Release Request to the H-SMF.\n18-19. The SMF requests to stop accounting by sending the Accounting-Request (STOP) message to the DN-AAA via the UPF and the DN-AAA responds with the Accounting-Response (STOP) message.\nThe figure depicts a RADIUS Authentication and Accounting example, illustrating the successful case of RADIUS authentication and accounting. The diagram shows the RADIUS server, RADIUS client, and RADIUS authentication and accounting process. The RADIUS server is responsible for authenticating and accounting for RADIUS clients, while the RADIUS client is responsible for authenticating and accounting for RADIUS servers. The diagram highlights the key components and their interactions, such as the RADIUS server's authentication and accounting functions, the RADIUS client's authentication and accounting functions, and the RADIUS server's authentication and accounting functions.\nFigure 11.2.1-1: RADIUS Authentication and Accounting example (successful case)\nWhen PAP/CHAP is used as the authentication protocol with the external DN-AAA server which does not support EAP for the 5GS or for the 5GC, the RADIUS Authentication procedures refer to the non transparent access procedures in clause 11.2.1 and the related RADIUS Authentication description in clause 16.3a.1 in 3GPP TS 29.061 [5] are reused with the following differences:\n-\tthe SMF  performs the actions specified for the P-GW;\n-\tthe external DN-AAA server performs the actions specified for AAA;\n-\tPDU Session Establishment request is sent from the UE to the SMF instead of the Activate PDN connection request being sent from the UE to the S-GW and the Create Session request being sent from S-GW to P-GW;\n-\tPDU Session Establishment accept is sent from the SMF  to the UE instead of the Create Session Response message being sent from the P-GW to S-GW and the Activate PDN Connection Accept being sent from S-GW to the UE; and\n-\tPDU Session Establishment reject is sent from the SMF to the UE instead of the Create Session Response message being sent from the P-GW to the S-GW and the Activate PDN Connection Reject being sent from S-GW to the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.1a\tAuthentication and Authorization procedures in EPC Interworking",
                            "text_content": "When an SMF+PGW-C receives a Create Session Request message for a given DNN from the MME, the SMF+PGW-C may (depending on the configuration for this DNN) send a RADIUS Access-Request message with EAP extension to a DN-AAA server. Upon receipt of the Access-Request message, the DN-AAA server shall respond with an Access-Challenge message. Multi-round authentication using the Access-Challenge (sent by DN-AAA) and Access-Request messages may be used. The DN-AAA server finally authenticates and authorizes the user by replying with an Access Accept message. If the DN-AAA server is also responsible for IPv4 address and/or IPv6 prefix allocation, the DN-AAA server shall return the allocated IPv4 address and/or IPv6 prefix in the Access-Accept message.\nFor re-authentication and re-authorization, the SMF+PGW-C shall send a RADIUS Access-Request message with EAP extension and the DN-AAA shall respond with an Access-Challenge message. Multi-round authentication using the Access-Challenge (sent by DN-AAA) and Access-Request messages may be used. The DN-AAA server finally authenticates and authorizes the user by replying with an Access Accept message.\nThe SMF+PGW-C may initiate RADIUS re-authorization procedures for the purpose of IPv4 address and/or IPv6 prefix allocation (or renew the lease). In this case, the SMF+PGW-C shall set the Service-Type attribute to \"Authorize Only\" and the 3GPP-Allocate-IP-Type attribute to the type of IP address to be allocated in the Access-Request message sent to the DN-AAA server. If the SMF+PGW-C is using DHCP signalling towards the UE and the DN-AAA server includes the Session-Timeout attribute in the Access-Accept, the SMF+PGW-C may use the Session-Timeout value as the DHCP lease time. The SMF+PGW-C shall not set the DHCP lease time value higher than the Session-Timeout value. The SMF+PGW-C may renew the DHCP lease to the UE without re-authorization towards the DN-AAA server providing that the new lease expiry is no later than the Session-Timeout timer expiry. If the SMF+PGW-C wishes to extend the lease time beyond the current Session-Timeout expiry, it shall initiate a new AAA re-authorization.\nWhen the SMF+PGW-C receives a message indicating a QoS flow or PDN connection release request, the SMF+PGW-C shall send a RADIUS Accounting-Request (STOP) message to the DN-AAA server, which indicates the termination of this particular QoS flow or PDN connection. The SMF+PGW-C shall immediately send the corresponding response to the MME, without waiting for an Accounting-Response (STOP) message from the DN-AAA server.\nThe DN-AAA server shall deallocate the IPv4 address and/or IPv6 prefix initially allocated to the subscriber, if there is no session for the subscriber.\nAccounting-Request (ON) and Accounting-Request (OFF) messages may be sent from the SMF+PGW-C to the DN-AAA server to ensure the correct synchronization of the session information in the SMF+PGW-C and the DN-AAA server.\nThe SMF+PGW-C may send an Accounting-Request (ON) message to the DN-AAA server to indicate that a restart has occurred. The DN-AAA server may then release the associated resources.\nPrior to a scheduled restart, the SMF+PGW-C may send Accounting-Request (OFF) message to the DN-AAA server. The DN-AAA server may then release the associated resources.\nThe figure depicts a RADIUS Authentication and Accounting example, illustrating the successful case of RADIUS authentication and accounting. The diagram shows the RADIUS server, RADIUS client, and RADIUS client-server communication. The RADIUS server authenticates and records the authentication and accounting information, while the RADIUS client communicates with the RADIUS server to retrieve the necessary information. The diagram highlights the importance of RADIUS authentication and accounting in network security and management.\nFigure 11.2.1a-1: RADIUS Authentication and Accounting example (successful case)\nThe above figure 11.2.1a-1 is an example message flow to show the procedure of RADIUS Authentication and Accounting between an SMF+PGW-C and a DN-AAA server:\n1.\tUE initiates the PDN Connection Establishment procedure, including authentication/authorization information.\n2.\tThe MME sends Create Session Request including the authentication/authorization information to the SMF+PGW-C.\nAccording to the configuration in the SMF+PGW-C, step 6 to step 10 are executed before step 3 if the SMF+PGW-C needs to send an EAP-Request message to the UE.\n3.\tIf the N4 session has not been established before, the SMF+PGW-C triggers the N4 Session Establishment procedure to the UPF+PGW-U and sets the N4 rules to block any UE traffic over the PDN Connection (until the Secondary DN authentication and authorization has been completed successfully).\n4.\tThe SMF+PGW-C sends the Access-Request message to the DN-AAA via the UPF+PGW-U in the N4 user plane.\n5-11.\tThe DN-AAA responds with the Access-Challenge message to the SMF+PGW-C via the UPF+PGW-U in the N4 use plane message. The authentication/authorization information is further transferred to UE via Create Session Response and Downlink NAS Transport message, along with uplink data not allowed indication within the PCO attribute. UE responds to the received authentication/authorization data and such information is transferred in Uplink NAS Transport message and Modify Bearer Request, then finally sent to the DN-AAA by the SMF+PGW-C, via the UPF+PGW-U, in the Access-Request message.\n12-17.\tThe DN-AAA responds with the Access-Challenge message to the SMF+PGW-C via the UPF+PGW-U in the N4 use plane message. The authentication/authorization information is further transferred to UE via Update bearer Response and Downlink NAS Transport message. UE responds to the received authentication/authorization data and such information is transferred in Uplink NAS Transport message and Update Bearer Response, then finally sent to the DN-AAA by the SMF+PGW-C, via the UPF+PGW-U, in the Access-Request message.\nNOTE:\tStep 12 to step 17 can be repeated depending on the authentication/authorization mechanism used (e.g. EAP-TLS).\n18.\tThe SMF+PGW-C receives the final result of authentication/authorization from the DN-AAA in the Access-Accept message, via the UPF+PGW-U.\n19.\tThe SMF+PGW-C updates the N4 rules to allow UE traffic over the PDN connection.\n20.\tThe SMF+PGW-C requests to start accounting by sending the Accounting-Request (START) message to the DN-AAA via the UPF+PGW-U.\n21. The SMF+PGW-C proceeds with PDN connection establishment procedure and includes the authentication/authorization information in the Update Bearer Request message with uplink data allowed indication within the PCO attribute, sent to the MME.\n22.\tThe DN-AAA responds with the Accounting-Response (START) message. The SMF+PGW-C may wait for the Accounting-Response (START) before sending the Update Bearer Request in step 21.\n23.\tThe MME sends the Downlink NAS Transport message with Session Management Request with the authentication/authorization information to the UE.\n24.\tThe UE sends a Uplink NAS Transport message with Session Management Response to the MME.\n25.\tThe MME sends Update Bearer Response to the SMF+PGW-C, after which user data is allowed over the PDN connection.\n26-30. At any point, if the UE triggers Detach procedure and send Detech request to the MME then MME sends Delete Session Request message to the SMF+PGW-C, which responds with Delete Session Response message. The SMF+PGW-C requests to stop accounting by sending the Accounting-Request (STOP) message to the DN-AAA via the UPF+PGW-U and the DN-AAA responds with the Accounting-Response (STOP) message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.2\tAccounting Update",
                            "text_content": "During the life of a QoS flow some information related to this QoS flow may change. The SMF may send RADIUS Accounting Request Interim-Update to the DN-AAA server upon occurrence of a chargeable event, e.g. RAT change, DNAI change or QoS change. Interim updates are also used when the IPv4 address and/or IPv6 prefix is allocated/released/re-allocated.\nNOTE:\tDNAI change is only applicable when application relocation possible indicated in the AF traffic influenced PCC rule as described in clause 5.6.7 of TS 23.501 [2], align with the DNAI change in UP path management events as described in clause 4.3.6.3 of TS 23.502 [3]. Only the target DNAI is provided in the ACR message. The change from the UP path status where a DNAI applies to a status where no DNAI applies indicating the de-activation of the AF request for AF influence on traffic routing is not supported in this release.\nWhen the SMF receives a signalling request (i.e. Nsmf_PDUSession_UpdateSMContext) that indicates the occurrence of one of these chargeable events, the SMF may send an Accounting Request Interim-Update to the DN-AAA server to update the necessary information related to this QoS flow. It is not necessary for the SMF to wait for the RADIUS AccountingResponse message from the DN-AAA server before sending the response for the triggering signalling message (i.e. Namf_Communication_N1N2MessageTransfer). The SMF may delete the QoS flow if the AccountingResponse is not received from the DN-AAA server.\nThe SMF may also send interim updates at the expiry of an operator configured time limit.\nFigure 11.2.2-1 is an example message flow to show the procedure of RADIUS accounting update, messages between the SMF and DN-AAA are forwarded by the UPF in N4 user plane message.\nThe figure depicts a RADIUS accounting update, which is a crucial component of network security. It shows the process of updating the RADIUS server to ensure that the network is secure and that the necessary updates have been applied. The figure provides a visual representation of the steps involved in updating the RADIUS server, including the steps to configure the server, update the database, and ensure that the necessary updates have been applied. This figure is essential for network administrators to ensure that the network is secure and that the necessary updates have been applied.\nFigure 11.2.2-1: RADIUS accounting update\nFor the 5GC and EPC interworking scenario without authentication, authorization, re-authentication and/or re-authorization impacts, if the UE establishes the PDU session through the 5GC and initiates the accounting session, when the SMF+PGW-C determines that the UE has moved to the EPS (i.e. the SMF+PGW-C receives the modify bearer request or create session request from the S-GW), the SMF+PGW-C may perform the accounting session update with the following modifications:\n-\tfor the case that the accounting session is initiated per PDU session, the SMF+PGW-C may update the accounting session by including the identifier of the accounting session within the Acct-Session-Id, the \"EUTRA\" within the 3GPP-RAT-Type, the IPv4 address of S-GW within the 3GPP-SGSN-Address, the default EPS bearer id within the 3GPP-NSAPI, the user location in the EPC within the 3GPP-User-Location-Info if available and the new QoS profile within the 3GPP-GPRS-Negotiated-QoS-Profile if changed.\n-\tfor the case that the accounting session is initiated per QoS flow:\n-\tif the SMF+PGW-C mapped a QoS flow to an EPS bearer, the SMF may update the accounting session corresponding to the QoS flow with the information of the EPS bearer by including the identifier of the accounting session within the Acct-Session-Id, the \"EUTRA\" within the 3GPP-RAT-Type, the IPv4 address of S-GW within the 3GPP-SGSN-Address, the EPS bearer id within the 3GPP-NSAPI, the user location in the EPC within the 3GPP-User-Location-Info if available, the new QoS profile within the 3GPP-GPRS-Negotiated-QoS-Profile if changed, the new charging id within the 3GPP-Charging-Id VSA or 3GPP-Charging-Id-v2 VSA according to the length of the Charging Id if allocated and the new packet filters within the 3GPP-Packet-Filter if changed;\n-\tif the SMF+PGW-C mapped multiple QoS flows to one EPS bearer, the SMF shall select one of the accouting sessions corresponding to these QoS flows to update it as above and terminate the accounting session(s) corresponding to the other QoS flow(s).\n-\tif the SMF+PGW-C did not map a QoS flow to any EPS bearer, the SMF may decide to associate the corresponding account session to the default EPS bearer or terminate the corresponding accounting session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.3\tDN-AAA initiated QoS flow termination",
                            "text_content": "RADIUS is used as the protocol between the SMF and the DN-AAA server or proxy for applications (e.g. MMS) to deliver information related to user session. However some IP applications could need to interwork with the SMF to release the corresponding resource (e.g. terminate a particular QoS flow). For this purpose, the DN-AAA server or proxy may send a RADIUS Disconnect-Request to the SMF. On receipt of the Disconnect-Request from the DN-AAA server, the SMF shall release the corresponding resources and reply with a Disconnect-ACK. If the SMF is unable to release the corresponding resources, it shall reply to the DN-AAA server with a Disconnect-NAK. For more information on RADIUS Disconnect, see IETF RFC 5176 [27]. If the SMF deletes the corresponding QoS flow, it is not necessary for the SMF to wait for the response (i.e. Nsmf_PDUSession_UpdateSMContext) from the AMF before sending the RADIUS Disconnect-ACK to the DN-AAA server. The DN-AAA shall include the identification of the QoS flow to be disconnected within the Disconnect-Request. How to identify the QoS flow to be deleted is implementation specific.\nNOTE:\tThe QoS flow can be identified by the Acct-Session-Id which is extended to include QFI or by the Acct-Session-Id and 3GPP-NSAPI combination if provided by the SMF.\nThe Teardown-Indicator in the RADIUS Disconnect Request message indicates to the SMF that all QoS flows for this particular user and sharing the same user session shall be deleted. The QoS flows that belong to the same PDU session can be are identified by the Acct-Session-Id. The SMF is able to find out all the related QoS flows sharing the same user session once it has found the exact QoS flow from the Acct-Session-Id. If a user has the same user IP address for different sets of QoS flows towards different networks, only the QoS flows linked to the one identified by the Acct-Session-Id shall be deleted.  If the value of Teardown-Indicator is set to \"0\" or if TI is missing, and if the Acct-Session-Id and 3GPP-NSAPI if provided identifies the QoS flow associated with the default QoS rule, the SMF shall tear down all the QoS flows that share the same user session identified by the Acct-Session-Id.\nFigure 11.2.3-1 is an example message flow to show the procedure of DN-AAA initiated QoS flow termination, messages between the SMF and DN-AAA are forwarded by the UPF in N4 user plane message.\nThe figure depicts a DN-AAA initiated QoS flow termination with RADIUS, illustrating the process of initiating a QoS flow termination using the DN-AAA protocol. The figure shows the flow termination process, including the initiation of the flow, the use of RADIUS for authentication, and the termination of the flow.\nFigure 11.2.3-1: DN-AAA initiated QoS flow termination with RADIUS\nFor the 5GC and EPC interworking scenario, when the DN-AAA server initiates the QoS flow termination, the SMF+PGW-C shall send the delete bearer request to the S-GW as defined in clause 5.4.4.1 of 3GPP TS 23.401 [53] to delete the EPS bearer corresponding to the accounting session if the UE has moved to the EPS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.4\tDN-AAA initiated re-authorization in 5GC",
                            "text_content": "Some IP applications could need to interwork with the SMF to update the PDU session authorization attributes. For this purpose, the DN-AAA server or proxy may send a RADIUS CoA-Request to the SMF. On receipt of the CoA-Request from the DN-AAA server, if the service-type value of \"Authorize Only\" is not included, the SMF shall update the corresponding PDU session authorization attributes and reply with a CoA-ACK; otherwise it shall follow the procedure described in IETF RFC 5176 [27]. DN-AAA may also use CoA procedure to revoke the authorization of a PDU session, or to update the authorization data (e.g. allowed UE MAC addresses).\nIf the SMF updates/deletes the corresponding PDU session, it is not necessary for the SMF to wait for Nsmf_PDUSession_UpdateSMContext from the AMF before sending the RADIUS CoA-ACK to the DN-AAA server.\nFigure 11.2.4-1 is an example message flow to show the procedure of DN-AAA initiated re-authorization, messages between the SMF and DN-AAA are forwarded by the UPF in N4 user plane message.\nThe figure depicts a DN-AAA initiated re-authorization process with RADIUS, illustrating the steps involved in initiating a re-authorization request. The figure includes the DN-AAA protocol, the RADIUS server, and the re-authorization request, all of which are essential components in the network's authentication and authorization process.\nFigure 11.2.4-1: DN-AAA initiated re-authorization with RADIUS\nNOTE:\tThe DN-AAA initiated re-authorization procedure is not applicable for legacy DN-AAA supporting the RADIUS procedures over SGi interface as specified in 3GPP TS 29.061 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.4a\tDN-AAA initiated re-authorization in EPC Interworking",
                            "text_content": "Some IP applications could need to interwork with the SMF+PGW-C to update the PDN connection authorization attributes. For this purpose, the DN-AAA server or proxy may send a RADIUS CoA-Request to the SMF+PGW-C. On receipt of the CoA-Request from the DN-AAA server, if the service-type value of \"Authorize Only\" is not included, the SMF shall update the corresponding PDN connection authorization attributes and reply with a CoA-ACK; otherwise it shall follow the procedure described in IETF RFC 5176 [27]. DN-AAA may also use CoA procedure to revoke the authorization of a PDN connection, or to update the authorization data (e.g. allowed UE MAC addresses).\nIf the SMF+PGW-C updates/deletes the corresponding PDN connection, it is not necessary for the SMF+PGW-C to wait for Update Bearer Response from the MME before sending the RADIUS CoA-ACK to the DN-AAA server.\nFigure 11.2.4-1 is an example message flow to show the procedure of DN-AAA initiated re-authorization, messages between the SMF+PGW-C and DN-AAA are forwarded by the UPF+PGW-U in N4 user plane message.\nThe figure depicts a DN-AAA initiated re-authorization process with RADIUS, illustrating the steps involved in initiating a re-authorization request. The figure includes a DN-AAA initiator, a RADIUS server, and a RADIUS client, all connected to a network interface controller (NIC). The figure also shows the steps for initiating the re-authorization request, such as obtaining the RADIUS server's IP address, establishing a connection, and sending the re-authorization request. The figure is a visual representation of the process, making it easier to understand and follow.\nFigure 11.2.4a-1: DN-AAA initiated re-authorization with RADIUS\nNOTE:\tThe DN-AAA initiated re-authorization procedure is not applicable for legacy DN-AAA supporting the RADIUS procedures over SGi interface as specified in 3GPP TS 29.061 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "11.3\tList of RADIUS attributes",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.3.1\tGeneral",
                            "text_content": "RADIUS attributes as defined in clause 16.4 of 3GPP TS 29.061 [5] are re-used in 5G with the following differences:\n-\tSMF or SMF+PGW-C replaces P-GW. GGSN and PPP PDP type related description are not applicable for 5G.\n-\t5G QoS flow replaces IP-CAN bearer and PDU session replaces IP-CAN session.\n-\tN6 replaces Gi/Sgi and UE replaces MS.\n-\tDNN replaces APN.\n-\tDetailed information needed for 5G compared to 3GPP TS 29.061 [5] is described below.\nTable 11.3-1: Additional information needed for 5G compared to the RADIUS attributes defined in 3GPP TS 29.061 [5]\n\nTable 11.3-2: Different information needed for 5G compared to the RADIUS VSA defined in clause 16.4.7 of 3GPP TS 29.061 [5]\n\n110 – 3GPP-Notification\n\n\n3GPP Type: 110\nLength: 3\nOctet 3 is Octet String type.\nFor bit 1 AUTH,\n-\tif the value of AUTH is set to \"1\", and there is IPv4 address and/or IPv6 prefix change (not allocated/de-allocated by the DN-AAA itself) and the PDU session is not terminated, the SMF shall send Access-Request message to the DN-AAA with  GPSI in Calling-Station-Id or External-Identifier attribute and IP address in:\n1)\tFramed-IP-Address and Framed-IPv6-Prefix, if both IPv4 address and IPv6 prefix(es) exist for the PDU session; or\n2)\tFramed-IP-Address, if only IPv4 address exists for the PDU session; or\n3)\tFramed-IPv6-Prefix, if only IPv6 prefix(es) exists for the PDU session.\nFor Ethernet PDU session, if there is UE MAC address change, the SMF shall send Access-Request message to the DN-AAA with GPSI in Calling-Station-Id or External-Identifier attribute and the complete list of used UE MAC addresses in the 3GPP-UE-MAC-Address attribute.\n-\tif the value is set to \"0\", the SMF may notify authentication DN-AAA with the UE address and GPSI based on local configuration.\nFor bit 2 ACC,\n-\tif the value is set to \"1\", and there is IPv4 address and/or IPv6 prefix change (not allocated/de-allocated by the DN-AAA itself) and the PDU session is not terminated, the SMF shall send Accounting-Request Interim-Update message to the DN-AAA with  GPSI in Calling-Station-Id or External-Identifier attribute and IP address in:\n1)\tFramed-IP-Address and Framed-IPv6-Prefix, if both IPv4 address and IPv6 prefix(es) exist for the PDU session; or\n2)\tFramed-IP-Address, if only IPv4 address exists for the PDU session; or\n3)\tFramed-IPv6-Prefix, if only IPv6 prefix(es) exists for the PDU session.\nFor Ethernet PDU session, if there is UE MAC address change, the SMF shall send Accounting-Request Interim-Update message to the DN-AAA with GPSI in Calling-Station-Id or External-Identifier attribute and the complete list of used UE MAC addresses in the 3GPP-UE-MAC-Address attribute.\n-\tif the value is set to \"0\", the SMF may notify accounting DN-AAA with the UE address and GPSI based on local configuration.\n111 – 3GPP-UE-MAC-Address\n\n\n3GPP Type: 111\nLength: 8\nIt is sent from the DN-AAA to authorize UE MAC addresses. Multiple 3GPP- UE-MAC-Address sub-attributes (maximum 16) may be sent in one RADIUS CoA or Access-Accept message. The DN-AAA shall always provide the full list of allowed MAC addresses, and SMF shall replace the existing list with the newly received one. When omitted, there is no restriction and all UE MAC addresses are permitted for the Ethernet PDU session.\nWhen sending from the SMF to the DN-AAA, it indicates UE MAC addresses in use. Multiple 3GPP- UE-MAC-Address sub-attributes may be sent in one RADIUS Access-Request or Accounting-Request Interim-Update message.\nMAC address is Octet String type. The encoding is defined as MacAddr48 in 3GPP TS 29.571 [39] without dashes as delimiter, encoded as 12-digit hexadecimal numbers.\n112 – 3GPP-Authorization-Reference\n\n\n3GPP Type: 112\nLength:  m\nAuthorization Data Reference: Octet String. It is sent from the DN-AAA to refer to the local authorization data in the SMF or PCF.\n113 – 3GPP-Policy-Reference\n\n\n3GPP Type: 113\nLength:  m\nPolicy Data Reference: Octet String. It is sent from the DN-AAA and used by the SMF to retrieve the SM or QoS policy data from the PCF. It is not used in this release.\n114 – 3GPP-Session-AMBR\n\n\n3GPP Type: 114\nLength:  m\nSession AMBR: Octet String. It is sent from the DN-AAA to authorize the PDU Session AMBR in the downlink and uplink direction. The encoding is defined as BitRate in 3GPP TS 29.571 [39]. Same value is applied to downlink and uplink via this VSA.\n115 – 3GPP-NAI\n\n\n3GPP Type: 115\nLength: m\nNAI: Octet String. It shall be formatted according to clause 14.3 of 3GPP TS 23.003 [28] that describes an NAI.\n116 – 3GPP-Session-AMBR-v2\n\n\n\n3GPP Type: 116\nLength:  m\nOctet 3 is Octet String type.\nBit 1 UL and bit 2 DL indicate if the corresponding UL and DL Session-AMBR shall be present in a respective field or not. If one of these bits is set to \"0\", the corresponding field shall not be present at all.\nUL/DL Session AMBR: Octet String. It is sent from the DN-AAA to authorize the PDU Session AMBR. The encoding is defined as BitRate in 3GPP TS 29.571 [39].\nIf the feature eSessionAMBR is supported and if applicable, the DN-AAA shall send this VSA; otherwise, the DN-AAA shall send the VSA 3GPP-Session-AMBR.\n117 – 3GPP-Supported-Features\n\n\n\n3GPP Type: 117\nLength:  m\nThis VSA may be present in the Access-Request (initial one) message and either the Access-Challenge (initial one) or the Access-Accept message. If present, this VSA informs the destination entity about the features that the origin entity requires to successfully complete the message exchange. The Vendor ID, Feature List ID and Feature List are encoded according to 3GPP TS 29.229 [41]. See clause 12.4.1 for more detailed information regarding the general principle of the feature negotiation with the difference that RADIUS terms replace Diameter terms. The table 12.4.1-1 defines the features applicable to the RADIUS N6 interfaces for the feature lists with a Feature-List-ID of 1.\n118 – 3GPP-IP-Address-Pool-Info\n\n\n3GPP Type: 118\nLength: m\nOctet 3 is Octet String type.\nFor bit 1 and bit 2 IP version:-\tif the value is set to \"0\", it indicates the IP address pool id is applicable for both IPv4 and IPv6;\n-\tif the value is set to \"1\", it indicates the IP address pool id is applicable for IPv4;\n-\tif the value is set to \"2\", it indicates the IP address pool id is applicable for IPv6; and\n-\tvalue \"3\" is reserved.\nThe SMF may determine an IP address pool ID based on UPF ID, S-NSSAI, DNN, and IP version as described in clause 5.8.2.2.1 in 3GPP TS 23.501 [2] and includes the IP address pool ID within 3GPP-IP-Address-Pool-Info and send it to the DN-AAA. The DN-AAA assigns IPv6 prefix or IPv4 address from the requested IP address pool. Multiple 3GPP-IP-Address-Pool-Info sub-attributes may be sent in the RADIUS Access-Request message. The DN-AAA shall include the selected IP address pool in the 3GPP-IP-Address-Pool-Info sub-attribute of the RADIUS Access-Accept message. For accounting, if Framed-IP-Address or Framed-IPv6-Prefix attribute is included in RADIUS Accounting-Request (START/Interim-Update/STOP), the SMF shall also include the 3GPP-IP-Address-Pool-Info sub-attribute.\n119 – 3GPP-VLAN-Id\n\n\n3GPP Type: 119\nLength: 4\nVLAN Id: Octet String. Octet 3/ Bit 1 to Bit 4 shall be zero, Octet 3 / Bit 8 shall be the most significant bit of the VLAN Id and Octet 4 / Bit 1 shall be the least significant bit.\nIt is sent from the DN-AAA to authorize the allowed VLAN Ids for the Ethernet PDU session. Multiple 3GPP-VLAN-Id sub-attributes (maximum 16) may be sent in one RADIUS CoA or Access-Accept message. The DN-AAA shall always provide the full list of allowed VLAN Ids, and SMF shall replace the existing list with the newly received one. When omitted, there is no restriction and all VLAN Ids are permitted for the Ethernet PDU session.\n120 – 3GPP-TNAP-Identifier\n\n\n3GPP Type: 120\nLength: m, where m depends on the type of location that is present as described in 3GPP TS 29.274 [50].\nTNAP Identifier field is used to convey the location information in a Trusted Non-3GPP Access Network. The coding of this field shall be the same as for the GTP TWAN Identifier starting with Octet 5, till Octet (q+r) +2 as per clause 8.100 in 3GPP TS 29.274 [50], with LAII flag, OPNAI flag and PLMNI flag in Octet 5 shall be set as zero.\nTNAP Identifier field is Octet String type.\nThe SMF may indicate the UE location in a Trusted Non-3GPP Access Network, in Access-Request, Accounting-Request START, Accounting-Request STOP, or Accounting-Request Interim-Update messages.\n121 – 3GPP-HFC-NodeId\n\n\n3GPP Type: 121\nLength: n6+2\nHFCNodeId field is the identifier of the HFC node Id as specified in CableLabs WR-TR-5WWC-ARCH [51]. It is provisioned by the wireline operator as part of wireline operations and may contain up to six characters.\nHFCNodeId field is Octet String type.\nThe SMF may indicate the HFC Node Identifier received over NGAP. Present for a 5G-CRG accessing the 5GC via wireline access network, in Access-Request, Accounting-Request START, Accounting-Request STOP, or Accounting-Request Interim-Update messages. Present for a FN-CRG accessing the 5GC via wireline access network, in Accounting-Request START, Accounting-Request STOP, or Accounting-Request Interim-Update messages.\n122 – 3GPP-GLI\n\n\n3GPP Type: 122\nLength: n150+2\nGLI field is the Global Line Identifier uniquely identifying the line connecting the 5G-BRG or FN-BRG to the 5GS. See clause 28.16.3 of 3GPP TS 23.003 [28]. Shall be encoded as a string with format \"byte\", i.e. base64-encoded characters, representing the GLI value (up to 150 bytes) encoded as specified in BBF WT-470 [52].\nGLI field is Octet String type.\nThe SMF may indicate the Global Line Identifier. Present for a 5G-BRG accessing the 5GC via wireline access network, in Access-Request, Accounting-Request START, Accounting-Request STOP, or Accounting-Request Interim-Update messages. Present for a 5G-BRG accessing the 5GC via wireline access network, in Accounting-Request START, Accounting-Request STOP, or Accounting-Request Interim-Update messages.\n123 – 3GPP-Line-Type\n\n\n3GPP Type: 123\nThe Line-Type sub-attribute may be present for a 5G-BRG/FN-BRG accessing the 5GC via wireline access network.\nWhen present, it shall indicate the type of the wireline (DSL or PON).\nLine-Type field is Octet String type. It shall be coded as follows:\n0 (DSL):\nThis value shall be used to indicate DSL line.\n1 (PON):\nThis value shall be used to indicate PON line.\nThe SMF may indicate the type of the wireline (DLS or PON). Present for a 5G-BRG accessing the 5GC via wireline access network, in Access-Request, Accounting-Request START, Accounting-Request STOP, or Accounting-Request Interim-Update messages. Present for a FN-BRG accessing the 5GC via wireline access network, in Accounting-Request START, Accounting-Request STOP, or Accounting-Request Interim-Update messages.\n124 – 3GPP-NID\n\n\n3GPP Type: 124\nLength: 13\nThe Network ID field is Octet String type. The encoding is defined as Nid in 3GPP TS 29.571 [39].\nTable 11.3-3 describes the sub-attributes of the 3GPP Vendor-Specific attribute described above in different RADIUS messages.\n125 – 3GPP-Session-S-NSSAI\n\n\n3GPP Type: 125\nLength: 3 or 6\nSST: the Slice/Service Type with value range 0 to 255.\nSD: 3-octet string, representing the Slice Differentiator, the encoding follows sd attribute specified in clause 5.4.4.2 of 3GPP TS 29.571 [46]. Its presence depends on the Length field.\nIt is sent from the SMF to the DN-AAA server to indicate the S-NSSAI that is associated with the PDU Session.\n126 – 3GPP-CHF-FQDN\n\n\n3GPP Type: 126\nLength: m\nCHF FQDN: string, indicates the FQDN of the CHF.\nIt is sent from the SMF to the DN-AAA server to indicate the FQDN of the CHF.\n127 – 3GPP-Serving-NF-FQDN\n\n\n3GPP Type: 127\nLength: m\nServing NF FQDN: string, indicates the FQDN of the Serving NF (including AMF, I-SMF or V-SMF).\nIt is sent from the SMF to the DN-AAA server to indicate the Serving NF FQDN address.\n128 – 3GPP-Session-Id\n\n\n3GPP Type: 128\nLength: 3\nPduSessionId: 1-octet unsigned integer identifying a PDU session, within the range 0 to 255, as specified in clause 5.4.2 of 3GPP TS 29.571 [46].\nIt is sent from the SMF to the DN-AAA server to indicate the PDU Session Identifier.\n129 – 3GPP-GCI\n\n\n3GPP Type: 129\nLength: m\nGCI field is Octet String type.\nThe GCI is the Global Cable Identifier uniquely identifies the line connecting the 5G-CRG or FN-CRG to the 5GS. See clause 28.15.4 of 3GPP TS 23.003 [28].\nThe GCI is a variable length opaque identifier, shall be encoded as specified in CableLabs WR-TR-5WWC-ARCH [51] and CableLabs DOCSIS MULPI [55]. It shall comply with the syntax specified in clause 2.2 of IETF RFC 7542 [56] for the username part of a NAI.\nThe SMF may indicate the Global Cable Identifier. Present for a 5G-CRG accessing the 5GC via wireline access network, in Access-Request, Accounting-Request START, Accounting-Request STOP, or Accounting-Request Interim-Update messages. Present for a FN-CRG accessing the 5GC via wireline access network, in Accounting-Request START, Accounting-Request STOP, or Accounting-Request Interim-Update messages.\n130 – 3GPP-DNAI\n\n\n3GPP Type: 130\nLength: m\nDNAI: string, indicates the Data Network Access Identifier.\nIt is sent from SMF to DN-AAA server to indicate the SMF selected or used DNAI interworking with the external DN.\n131 – 3GPP-RSN\n\n\n3GPP Type: 131\nLength: 3\nRSN: 1-octet unsigned integer identifying a RSN (see 3GPP TS 24.501 [42] for encoding).\nIt is sent from the SMF to the DN-AAA accounting server to indicate the RSN.\n132 – 3GPP-Session-Pair-Id\n\n\n3GPP Type: 132\nLength: 3\nPDU Session Pair Id: 1-octet unsigned integer identifying a PDU session pair information (see 3GPP TS 24.501 [42] for encoding).\nIt is sent from the SMF to the DN-AAA accounting server to indicate the PDU Session Pair Identifier. Two redundant PDU sessions share the same PDU Session Pair Identifier.\n\n133 – 3GPP-Charging ID-v2\n\n\n3GPP Type: 133\nLength: m\nCharging ID value: string, indicates the Charging Identifier.\nTable 11.3-3: List of the 3GPP Vendor-Specific sub-attributes for N6\n\nRADIUS attributes related to the DN-AAA initiated re-authorization and authentication challenge are described in the following clauses.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.3-1: Additional information needed for 5G compared to the RADIUS attributes defined in 3GPP TS 29.061 [5]",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3-2: Different information needed for 5G compared to the RADIUS VSA defined in clause 16.4.7 of 3GPP TS 29.061 [5]",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 28,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 29,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 30,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 31,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.3-3: List of the 3GPP Vendor-Specific sub-attributes for N6",
                                    "table number": 32,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.2\tChange-of-Authorization Request (optionally sent from DN-AAA server to SMF)",
                            "text_content": "Table 11.3.2-1 describes the attributes of the Change-of-Authorization Request message. Other RADIUS attributes may be used as defined in IETF RFC 5176 [27].\nTable 11.3.2-1: The attributes of the Change-of-Authorization Request message\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.3.2-1: The attributes of the Change-of-Authorization Request message",
                                    "table number": 33,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.3.3\tAccess-Challenge (sent from DN-AAA server to SMF)",
                            "text_content": "Table 11.3.3-1 describes the attributes of the Access-Challenge Request message. Other RADIUS attributes may be used as defined in IETF RFC 2865 [8].\nTable 11.3.3-1: The attributes of the Access-Challenge message\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.3.3-1: The attributes of the Access-Challenge message",
                                    "table number": 34,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "12\tInterworking with DN-AAA (Diameter)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "12.1\tDiameter Procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "12.1.1\tDiameter Authentication and Authorization",
                            "text_content": "The SMF also represents the H-SMF in the home routed scenario in this clause unless specified otherwise.\nDiameter Authentication and Authorization shall be used according to IETF RFC 7155 [23]. In 5G, multiple authentication methods using Extensible Authentication Protocol (EAP) may be used such as EAP-TLS (see IETF RFC 5216 [11]), EAP-TTLS (see IETF RFC 5281 [37]). The SMF shall support Diameter EAP application as specified in IETF RFC 4072 [25].\nThe SMF and the DN-AAA shall advertise the support of the Diameter NASREQ and EAP applications by including the value (1 and 5) of the application identifier in the Auth-Application-Id AVP (as specified in IETF RFC 4072 [25]) and the value of the 3GPP (10415) in the Vendor-Id AVP of the Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands as specified in IETF RFC 6733 [24], i.e. as part of the Vendor-Specific-Application-Id AVP.\nThe Diameter client function may reside in an SMF. When the SMF receives an initial access request (i.e. the SMF receives the Nsmf_PDUSession_CreateSMContext request with type \"Initial request\" for non-roaming case or local breakout case, or the H-SMF receives the Nsmf_PDUSession_Create Request with type \"Initial request\" for home routed case), the Diameter client function may send the authentication information to a DN-AAA server, which is identified during the DNN provisioning.\nWhen the legacy applications require PAP/CHAP authentication with the UE accessing to the 5GS and the legacy DN-AAA server does not support EAP, PAP/CHAP may be used as the authentication protocol, with the external network performing the risk assessment.\nThe DN-AAA server performs authentication and authorization. The response (when positive) may contain network information, such as an IPv4 address and/or IPv6 prefix for the user when the SMF is interworking with the DN-AAA server.\nThe information delivered during the Diameter authentication can be used to automatically correlate the user identity (e.g. SUPI) to the IPv4 address and/or IPv6 prefix, if applicable, assigned/confirmed by the SMF or the DN-AAA server respectively. The same procedure applies, in case of sending the authentication to a 'proxy' DN-AAA server.\nFor 5G, Diameter Authentication is applicable to the initial access request. When the SMF receives a positive response from the DN-AAA server it shall complete the initial access procedure. If DEA with Result-Code set to DIAMETER_AUTHENTICATION_REJECTED or no response is received, the SMF shall reject the initial access procedure with a suitable cause code.\nWhen DN-AAA server authorizes the PDU Session Establishment, it may send DN authorization data for the established PDU Session to the SMF. The DN authorization data for the established PDU Session may include one or more of the following:\n-\ta reference to authorization data for policy and charging control locally configured in the SMF;\n-\ta list of allowed MAC addresses (maximum 16) for the Ethernet PDU Session;\n-\ta list of allowed VLAN Ids (maximum 16) for the Ethernet PDU Session;\n-\tSession-AMBR for the PDU Session;\n-\tL2TP information, such as LNS IP address and/or LNS host name; and\n-\tFramed Route information for the PDU Session.\nNOTE 1: If the DN-AAA server send L2TP information to SMF, the L2PT information can e.g. be provisioned per DNN/S-NSSAI or per SUPI or GPSI by configuration which is out of the scope of 3GPP specifications.\nSMF policies may require DN authorization without DN authentication. In that case, when contacting the DN-AAA server for authorization, the SMF shall provide the GPSI of the UE if available.\nThe SMF may also use the Diameter re-authorization procedure for the purpose of IPv4 address and/or IPv6 prefix allocation to the UE. The use cases that may lead this procedure are:\n-\tIPv4 address and/or IPv6 prefix allocation after UPF selection during PDU session establishment procedure.\n-\tIPv6 prefix allocation during adding additional PDU Session Anchor procedure for IPv6 multi-homing.\n-\tIPv4 address allocation via DHCPv4 procedure after successful PDU session establishment procedure.\nThe SMF may also trigger request for DN authentication/authorization and/or IP address/prefix allocation based on UE subscription data retrieve from the UDM as defined in clause 5.2.2.2.5 of 3GPP TS 29.503.\nWhen an IPv4 address and/or IPv6 prefix (including any additional IPv6 prefix of IPv6 multi-homing) is (re-)allocated or de-allocated (not causing the PDU session to be released) by using a method not via the DN-AAA server and if the SMF was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF shall, if applicable, use the authentication session that was established before to inform the DN-AAA server by sending Diameter DER or AAR with the latest list of IPv4 address and/or IPv6 prefix(es).\nWhen the SMF is notified by the UPF regarding the UE MAC address change (a new one is detected or a used one is inactive), if the SMF was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF shall, if applicable, use the authentication session that was established before to inform the DN-AAA server by sending Diameter DER or AAR with the latest list of UE MAC addresses in use.\nDN-AAA may initiate QoS flow termination, see details in clause 12.2.3. DN-AAA may initiate re-authorization and optional re-authentication, see details in clause 12.2.4 and 12.2.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.1.1a\tDiameter Authentication and Authorization in EPC Interworking",
                            "text_content": "Diameter Authentication and Authorization shall be used according to IETF RFC 7155 [23]. Multiple authentication methods using Extensible Authentication Protocol (EAP) may be used such as EAP-TLS (see IETF RFC 5216 [11]), EAP-TTLS (see IETF RFC 5281 [37]). The SMF+PGW-C shall support Diameter EAP application as specified in IETF RFC 4072 [25].\nThe SMF+PGW-C and the DN-AAA shall advertise the support of the Diameter NASREQ and EAP applications by including the value (1 and 5) of the application identifier in the Auth-Application-Id AVP (as specified in IETF RFC 4072 [25]) and the value of the 3GPP (10415) in the Vendor-Id AVP of the Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands as specified in IETF RFC 6733 [24], i.e. as part of the Vendor-Specific-Application-Id AVP.\nThe Diameter client function may reside in an SMF+PGW-C. When the SMF+PGW-C receives new Create Session Request and the Session Management Subscription Data from the UDM or local configuration indicate the need for EAP-based secondary authentication and authorization by DN-AAA, the Diameter client function may send the authentication information to a DN-AAA server, which is identified during the DNN provisioning.\nWhen the legacy applications require PAP/CHAP authentication with the UE accessing the 5GC and EPC interworking scenario and the legacy DN-AAA server does not support EAP, PAP/CHAP may be used as the authentication protocol, with the external network performing the risk assessment.\nThe DN-AAA server performs authentication and authorization. The response (when positive) may contain network information, such as an IPv4 address and/or IPv6 prefix for the user when the SMF+PGW-C is interworking with the DN-AAA server.\nThe information delivered during the Diameter authentication can be used to automatically correlate the user identity (e.g. SUPI) to the IPv4 address and/or IPv6 prefix, if applicable, assigned/confirmed by the SMF+PGW-C or the DN-AAA server respectively. The same procedure applies, in case of sending the authentication to a 'proxy' DN-AAA server.\nWhen the SMF+PGW-C receives a positive response from the DN-AAA server it shall complete the initial access procedure. If Access-Reject or no response is received, the SMF+PGW-C shall reject the initial access procedure with a suitable cause code.\nWhen DN-AAA server authorizes the PDN Connection Establishment, it may send DN authorization data for the established PDN Connection to the SMF+PGW-C. The DN authorization data for the established PDN Connection may include one or more of the following:\n-\ta reference to authorization data for policy and charging control locally configured in the SMF+PGW-C;\n-\ta list of allowed MAC addresses (maximum 16) for the Ethernet PDN Connection;\n-\ta list of allowed VLAN Ids (maximum 16) for the Ethernet PDN Connection;\n-\tSession-AMBR for the PDU Connection;\n-\tL2TP information, such as LNS IP address and/or LNS host name; and\n-\tFramed Route information for the PDU Connection.\nNOTE 1: If the DN-AAA server send L2TP information to SMF+PGW-C, the L2PT information can e.g. be provisioned per DNN/S-NSSAI or per SUPI or GPSI by configuration which is out of the scope of 3GPP specifications.\nSMF+PGW-C policies may require DN authorization without DN authentication. In that case, when contacting the DN-AAA server for authorization, the SMF+PGW-C shall provide the GPSI of the UE if available.\nThe SMF may also use the Diameter re-authorization procedure for the purpose of IPv4 address and/or IPv6 prefix allocation to the UE. The use cases that may lead this procedure are:\n-\tIPv4 address and/or IPv6 prefix allocation after UPF selection during PDU connection establishment procedure.\n-\tIPv6 prefix allocation during adding additional PDN connection Anchor procedure for IPv6 multi-homing.\n-\tIPv4 address allocation via DHCPv4 procedure after successful PDN connection establishment procedure.\nThe SMF+PGW-C may also trigger request for DN authentication/authorization and/or IP address/prefix allocation based on UE subscription data retrieve from the UDM as defined in clause 5.2.2.2.5 of 3GPP TS 29.503.\nWhen an IPv4 address and/or IPv6 prefix (including any additional IPv6 prefix of IPv6 multi-homing) is (re-)allocated or de-allocated (not causing the PDN connection to be released) by using a method not via the DN-AAA server and if the SMF+PGW-C was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF+PGW-C shall, if applicable, use the authentication session that was established before to inform the DN-AAA server by sending Diameter DER or AAR with the latest list of IPv4 address and/or IPv6 prefix(es).\nWhen the SMF+PGW-C is notified by the UPF+PGW-U regarding the UE MAC address change (a new one is detected or a used one is inactive), if the SMF+PGW-C was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF+PGW-C shall, if applicable, use the authentication session that was established before to inform the DN-AAA server by sending Diameter DER or AAR with the latest list of UE MAC addresses in use.\nDN-AAA may initiate QoS flow termination, see details in clause 12.2.3. DN-AAA may initiate re-authorization and optional re-authentication, see details in clause 12.2.4 and 12.2.5.\nIn case EAP based authentication and authorization has been performed for the PDU Session while the UE was in 5GS, and if SMF+PGW-C determines that the UE has moved to the EPS (i.e. the SMF+PGW-C receives the modify bearer request or create session request from the S-GW), the following applies:\n-\tthe SMF+PGW-C may initiate Diameter re-authorization procedure without re-authentication with the DN-AAA server based on local policy.\n-\tDN-AAA initiated re-authorization without re-authentication may be performed.\n-\twhen the SMF+PGW-C receives a re-authentication request from the DN-AAA server, the SMF+PGW-C shall execute the procedure as described in clause 12.2.5.\nNOTE 2:\tThe DN-AAA server decided actions to take (e.g. to request another re-authorization without the association with EAP based re-authentication or release the session) are out of 3GPP scope.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.1.2\tDiameter Accounting",
                            "text_content": "Diameter Accounting shall be used according to IETF RFC 7155 [23].\nThe SMF and the DN-AAA may advertise the support of the Diameter base accounting application by including the value (3) of the application identifier in the Acct-Application-Id AVP and the value of the 3GPP (10415) in the Vendor-Id AVP of the Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands as specified in IETF RFC 6733 [24], i.e. as part of the Vendor-Specific-Application-Id AVP.\nThe Diameter accounting client function may reside in an SMF. The Diameter accounting client may send information to a DN-AAA server, which is identified during the DNN provisioning. The DN-AAA server may store this information and use it to automatically identify the user. This information can be trusted because the 3GPP network has authenticated the subscriber (i.e. USIM card and possibly other authentication methods).\nThe SMF may use the Diameter Accounting messages during QoS flow (e.g. QoS flow associated with the default QoS rule) establishment and termination procedures, respectively.\nIf the DN-AAA server is used for IPv4 address and/or IPv6 prefix assignment, then, upon reception of a Diameter Accounting-Request STOP message for all QoS flows associated to a PDU session defined by DNN and SUPI or GPSI, the DN-AAA server may make the associated IPv4 address and/or IPv6 prefix available for assignment.\nWhen an IPv4 address and/or IPv6 prefix (including any additional IPv6 prefix of IPv6 multi-homing) is (re-)allocated or de-allocated (not causing the PDU session to be released) by using a method not via the DN-AAA server and if the SMF was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF shall, if applicable, use the accounting session that was established before to inform the DN-AAA server by sending Diameter Accounting-Request Interim-Update with the latest list of IPv4 address and/or IPv6 prefix(es).\nWhen the SMF is notified by the UPF regarding the UE MAC address change (a new one is detected or a used one is inactive), if the SMF was required by the DN-AAA server to report such change during authentication procedure or by local configuration, the SMF shall, if applicable, use the accounting session that was established before to inform the DN-AAA server by sending Diameter Accounting-Request Interim-Update with the latest list of UE MAC addresses in use.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "12.2\tMessage flows on N6 interface",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "12.2.1\tAuthentication, Authorization and Accounting procedures",
                            "text_content": "The SMF also represents the H-SMF in the home routed scenario in this clause unless specified otherwise.\nWhen an SMF receives an initial access request (i.e. the SMF receives the Nsmf_PDUSession_CreateSMContext request with type \"Initial request\" for non-roaming case or local breakout case, or the H-SMF receives the Nsmf_PDUSession_Create Request with type \"Initial request\" for home routed case) message for a given DNN, the SMF may (depending on the configuration for this DNN) send a Diameter DER message to a DN-AAA server. The SMF may also (depending on the configuration for this DNN) send the S-NSSAI and the PDU Session ID that are associated with the PDU Session, respectively in the 3GPP-Session-S-NSSAI AVP and the 3GPP-Session-Id AVP, to a DN-AAA server. Upon receipt of the DER message, the DN-AAA server shall respond with an DEA message. Multi-round authentication using the DEA DEA (with Result-Code set to DIAMETER_MULTI_ROUND_AUTH)  and DER messages may be used. The DN-AAA server finally authenticates and authorizes the user by replying with the DEA message with Result-Code set to DIAMETER_SUCCESS. If the DN-AAA server is also responsible for IPv4 address and/or IPv6 prefix allocation, the DN-AAA server shall return the allocated IPv4 address and/or IPv6 prefix in the DEA message.\nFor re-authentication and re-authorization, the SMF shall send a DER message to the DN-AAA server and the DN-AAA server shall respond with a DEA message. Multi-round authentication using the DEA (with Result-Code set to DIAMETER_MULTI_ROUND_AUTH) and DER messages may be used. The DN-AAA server finally authenticates and authorizes the user by replying with the DEA message with Result-Code set to DIAMETER_SUCCESS.\nThe SMF may initiate Diameter re-authorization procedures for the purpose of IPv4 address and/or IPv6 prefix allocation (or renew the lease). In this case, the SMF shall set the Session-Id to the value used in the initial request, the Auth-Request-Type AVP to \"AUTHORIZE_ONLY\" and the 3GPP-Allocate-IP-Type AVP to the type of IP address to be allocated in the AA-Request message sent to the AAA server. If the SMF is using DHCP signalling towards the UE and the DN-AAA server includes the Session-Timeout attribute in the DEA, the SMF may use the Session-Timeout value as the DHCP lease time. The SMF shall not set the DHCPv4 lease time value higher than the Session-Timeout value. The SMF may renew the DHCP lease to the UE without re-authorization towards the DN-AAA server providing that the new lease expiry is no later than the Session-Timeout timer expiry. If the SMF wishes to extend the lease time beyond the current Session-Timeout expiry, it shall initiate a new AAA re-authorization.\nEven if the SMF was not involved in user authentication, it may send a Diameter Accounting-Request (START) message to a DN-AAA server. If no Diameter session is already open for the same PDU session a Diameter session needs to be activated, otherwise the existing Diameter session is used to send the Accounting-Request (START). If accounting is used per QoS flow, the QFI will identify the particular bearer this accounting message refers to. This message contains parameters, e.g. the tuple which includes the user ID and IPv4 address and/or IPv6 prefix, to be used by application servers (e.g. WAP gateway) in order to identify the user, the 3GPP-Charging-Id AVP or 3GPP-Charging-Id-v2 AVP according to the length of the Charging Id for the user session. This message may also (depending on the configuration for the DNN) contains the S-NSSAI and the PDU Session ID that are associated with the PDU Session, respectively in the 3GPP-Session-S-NSSAI AVP and the 3GPP-Session-Id AVP, and/or AF traffic influence PCC rule provisioned and then SMF used DNAI in the 3GPP-DNAI AVP, to a DN-AAA server. This message also indicates to the DN-AAA server that the user session has started.\nIf some external applications require Diameter Accounting-Request (START) information before they can process user packets, then the selected DNN (SMF) may be configured in such a way that the SMF drops user data until an Accounting-Answer (START) indicating success is received from the DN-AAA server. The SMF may wait for the Accounting-Answer (START) before sending the final authentication response message in Namf_Communication_N1N2MessageTransfer service operation. The SMF may reject the initial access request if the Accounting-Answer (START) is not received. The authentication and accounting servers may be separately configured for each DNN.\nFor IPv4 PDU type, if IPv4 address is allocated via DHCPv4 signalling between the UE and the DN-AAA after PDU session establishment, the SMF may wait to send the Accounting-Request START message until the UE receives its IPv4 address in a DHCPACK.\nWhen the SMF receives a message indicating a QoS flow or PDU session release request and providing a Diameter Accounting-Request START message was sent previously, the SMF shall send a Diameter Accounting-Request (STOP) message to the DN-AAA server, which indicates the termination of this particular QoS flow or PDU session. The SMF shall immediately send the corresponding response (e.g. Nsmf_PDUSession_UpdateSMContext response) to the AMF, without waiting for an Accounting-Answer (STOP) message from the DN-AAA server.\nIf the last QoS flow of a PDU session is deactivated, the SMF shall additionally send an STR message to the DN-AAA server. The DN-AAA server shall reply with an STA message and shall deallocate the IPv4 address and/or IPv6 prefix initially allocated to the subscriber.\nThe following figure 12.2.1-1 is an example message flow to show the procedure of Diameter Authentication and Accounting between an SMF and a DN-AAA server:\n1.\tUE initiates the PDU Session Establishment procedure, including authentication/authorization information.\n2.\tThe AMF sends Nsmf_PDUSession_CreateSMContext Request including the authentication/authorization information to the SMF and the SMF responds to the service operation.\nAccording to the configuration in the SMF, step 6 to step 9 are executed before step 3 if the SMF needs to send an EAP-Request message to the UE.\nIn the case of home routed, the AMF sends Nsmf_PDUSession_CreateSMContext Request including the authentication/authorization information to the V-SMF and the V-SMF sends Nsmf_PDUSession_Create Request including the authentication/authorization information to the H-SMF.\n3.\tIf the N4 session has not been established before, the SMF triggers the N4 Session Establishment procedure to the UPF.\nIn the case of home routed, the V-SMF triggers the N4 Session Establishment procedure to the V-UPF and the H-SMF triggers the N4 Session Establishment procedure to the H-UPF.\n4.\tThe SMF sends the DER message to the DN-AAA via the UPF, the message is forwarded from the SMF to the DN-AAA by the UPF in N4 user plane message.\nIn the case of home routed, the H-SMF sends the DER message to the DN-AAA via the H-UPF, the message is forwarded from the H-SMF to the DN-AAA by the H-UPF in N4 user plane message.\n5-10.\tThe DN-AAA responds with the DEA message to the SMF via the UPF, the message is forwarded from the DN-AAA to the SMF by the UPF in N4 user plane message. The authentication/authorization information is further transferred to UE via Namf_Communication_N1N2MessageTransfer service and NAS SM Transport message. UE responds to the received authentication/authorization data and such information is transferred in NAS SM Transport message and Nsmf_PDUSession_UpdateSMContext service, then finally sent to the DN-AAA by the SMF, via the UPF, in the DER message.\nIn the case of home routed, the DN-AAA responds with the DEA message to the H-SMF via the H-UPF, the message is forwarded from the DN-AAA to the H-SMF by the H-UPF in N4 user plane message. The authentication/authorization information is transferred to V-SMF via Nsmf_PDUSession_Update service and is further transferred to UE via Namf_Communication_N1N2MessageTransfer service and NAS SM Transport message. UE responds to the received authentication/authorization data and such information is transferred in NAS SM Transport message, Nsmf_PDUSession_UpdateSMContext service and Nsmf_PDUSession_Update servic, then finally sent to the DN-AAA by the H-SMF, via the H-UPF, in the DER message.\nNOTE:\tStep 5 to step 10 can be repeated depending on the authentication/authorization mechanism used (e.g. EAP-TLS).\n11.\tThe SMF receives final result of authentication/authorization from the DN-AAA in the DEA message, via the UPF.\n12.\tThe SMF requests to start accounting by sending the Accounting-Request (START) message to the DN-AAA via the UPF.\n13.\tThe SMF proceeds with the PDU session establishment procedure and includes the authentication/authorization information in Namf_Communication_N1N2MessageTransfer service.\nIn the case of home routed, the H-SMF proceeds with the PDU session establishment procedure and includes the authentication/authorization information is transferred to V-SMF via Nsmf_PDUSession_Update service and is further transferred to the AMF via Namf_Communication_N1N2MessageTransfer service.\n14.\tThe DN-AAA responds with the Accounting-Response (START) message. The SMF may wait for the Accounting-Response (START) before sending the Namf_Communication_N1N2MessageTransfer request in step 13.\nIn the case of home routed, the H-SMF may wait for the Accounting-Response (START) before sending the Nsmf_PDUSession_Update service in step 13.\n15.\tThe AMF sends the NAS PDU Session Establishment Request with the authentication/authorization information to the UE.\n16.\tThe UE sends a NAS message Deregistration Request to the AMF.\n17.\tThe AMF sends Nsmf_PDUSession_ReleaseSMContext Request to the SMF and the SMF responds to the service operation.\nIn the case of home routed, the AMF sends Nsmf_PDUSession_ReleaseSMContext Request to the V-SMF and the V-SMF sends the Nsmf_PDUSession_Release Request to the H-SMF.\n18-19. The SMF requests to stop accounting by sending the Accounting-Request (STOP) message to the DN-AAA via the UPF and the DN-AAA responds with the Accounting-Response (STOP) message.\nThe figure depicts a successful case of diameter authentication and accounting in a network. It shows a network with multiple paths, each with a different diameter, and a central hub that performs authentication and accounting. The diagram illustrates the process of verifying the diameter of each path and accounting for the different paths, ensuring network integrity and security.\nFigure 12.2.1-1: Diameter Authentication and Accounting example (successful case)\nWhen PAP/CHAP is used as the authentication protocol with the external DN-AAA server which does not support EAP for the 5GS, the Diameter Authentication procedures refer to the non transparent access procedures in clause 11.2.1 and related Diameter Authentication descriptions in clause 16a.3a.1 in 3GPP TS 29.061 [5] are reused with the following differences:\n-\tthe SMF performs the actions specified for the P-GW;\n-\tthe external DN-AAA server performs the actions specified for AAA;\n-\tPDU Session Establishment request is sent from the UE to the SMF instead of or the Activate PDN connection request being sent from the UE to the S-GW and the Create Session request being sent from S-GW to P-GW;\n-\tPDU Session Establishment accept is sent from the SMF to the UE instead of the Create Session Response message being sent from the P-GW to S-GW and the Activate PDN Connection Accept being sent from S-GW to the UE; and\n-\tPDU Session Establishment reject is sent from the SMF to the UE instead of the Create Session Response message being sent from the P-GW to the S-GW and the Activate PDN Connection Reject being sent from S-GW to the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.2.1a\tAuthentication and Authorization procedures in EPC Interworking",
                            "text_content": "When an SMF+PGW-C receives a Create Session Request message for a given DNN from the MME, the SMF+PGW-C may (depending on the configuration for this DNN) send a Diameter DER message to a DN-AAA server. Upon receipt of the DER message, the DN-AAA server shall respond with an Diameter DEA message. Multi-round authentication using the DEA (with Result-Code set to DIAMETER_MULTI_ROUND_AUTH) and DER messages may be used. The DN-AAA server finally authenticates and authorizes the user by replying with a DEA message with Result-Code set to DIAMETER_SUCCESS. If the DN-AAA server is also responsible for IPv4 address and/or IPv6 prefix allocation, the DN-AAA server shall return the allocated IPv4 address and/or IPv6 prefix in the DEA message.\nFor re-authentication and re-authorization, the SMF+PGW-C shall send a Diameter DER message and the DN-AAA shall respond with an DEA message. Multi-round authentication using the DEA (with Result-Code set to DIAMETER_MULTI_ROUND_AUTH) and DER messages may be used. The DN-AAA server finally authenticates and authorizes the user by replying with an DEA message with Result-Code set to DIAMETER_SUCCESS.\nThe SMF+PGW-C may initiate Diameter re-authorization procedures for the purpose of IPv4 address and/or IPv6 prefix allocation (or renew the lease). In this case, the SMF+PGW-C shall set the Session-Id to the value used in the initial request, the Auth-Request-Type AVP to \"AUTHORIZE_ONLY\" and the 3GPP-Allocate-IP-Type AVP to the type of IP address to be allocated in the AA-Request message sent to the AAA server. If the SMF+PGW-C is using DHCP signalling towards the UE and the DN-AAA server includes the Session-Timeout attribute in the Access-Accept, the SMF+PGW-C may use the Session-Timeout value as the DHCP lease time. The SMF+PGW-C shall not set the DHCP lease time value higher than the Session-Timeout value. The SMF+PGW-C may renew the DHCP lease to the UE without re-authorization towards the DN-AAA server providing that the new lease expiry is no later than the Session-Timeout timer expiry. If the SMF+PGW-C wishes to extend the lease time beyond the current Session-Timeout expiry, it shall initiate a new AAA re-authorization.\nWhen the SMF+PGW-C receives a message indicating a QoS flow or PDN connection release request, the SMF+PGW-C shall send a Diameter Accounting-Request (STOP) message to the DN-AAA server, which indicates the termination of this particular QoS flow or PDN connection. The SMF+PGW-C shall immediately send the corresponding response to the MME, without waiting for an Accounting-Response (STOP) message from the DN-AAA server.\nThe DN-AAA server shall deallocate the IPv4 address and/or IPv6 prefix initially allocated to the subscriber, if there is no session for the subscriber.\nAccounting-Request (ON) and Accounting-Request (OFF) messages may be sent from the SMF+PGW-C to the DN-AAA server to ensure the correct synchronization of the session information in the SMF+PGW-C and the DN-AAA server.\nThe SMF+PGW-C may send an Accounting-Request (ON) message to the DN-AAA server to indicate that a restart has occurred. The DN-AAA server may then release the associated resources.\nPrior to a scheduled restart, the SMF+PGW-C may send Accounting-Request (OFF) message to the DN-AAA server. The DN-AAA server may then release the associated resources.\nThe figure depicts a RADIUS Authentication and Accounting example, illustrating the successful case of RADIUS authentication and accounting. The diagram shows the RADIUS server, RADIUS client, and RADIUS client-server communication. The RADIUS server authenticates and records the authentication and accounting information, while the RADIUS client communicates with the RADIUS server to retrieve the necessary information. The diagram highlights the importance of RADIUS authentication and accounting in network security and management.\nFigure 11.2.1a-1: RADIUS Authentication and Accounting example (successful case)\nThe above figure 11.2.1a-1 is an example message flow to show the procedure of RADIUS Authentication and Accounting between an SMF+PGW-C and a DN-AAA server:\n1.\tUE initiates the PDN Connection Establishment procedure, including authentication/authorization information.\n2.\tThe MME sends Create Session Request including the authentication/authorization information to the SMF+PGW-C.\nAccording to the configuration in the SMF+PGW-C, step 6 to step 10 are executed before step 3 if the SMF+PGW-C needs to send an EAP-Request message to the UE.\n3.\tIf the N4 session has not been established before, the SMF+PGW-C triggers the N4 Session Establishment procedure to the UPF+PGW-U and sets the N4 rules to block any UE traffic over the PDN Connection (until the Secondary DN authentication and authorization has been completed successfully).\n4.\tThe SMF+PGW-C sends the Diameter DER message to the DN-AAA via the UPF+PGW-U in the N4 user plane.\n5-11.\tThe DN-AAA responds with the Diameter DEA message to the SMF+PGW-C via the UPF+PGW-U in the N4 use plane message. The authentication/authorization information is further transferred to UE via Create Session Response and Downlink NAS Transport message, along with uplink data not allowed indication within the PCO attribute. UE responds to the received authentication/authorization data and such information is transferred in Uplink NAS Transport message and Modify Bearer Request, then finally sent to the DN-AAA by the SMF+PGW-C, via the UPF+PGW-U, in the DER message.\n12-17.\tThe DN-AAA responds with the DEA message to the SMF+PGW-C via the UPF+PGW-U in the N4 use plane message. The authentication/authorization information is further transferred to UE via Update bearer Response and Downlink NAS Transport message. UE responds to the received authentication/authorization data and such information is transferred in Uplink NAS Transport message and Update Bearer Response, then finally sent to the DN-AAA by the SMF+PGW-C, via the UPF+PGW-U, in the DER message.\nNOTE:\tStep 12 to step 17 can be repeated depending on the authentication/authorization mechanism used (e.g. EAP-TLS with Result-Code set to DIAMETER_MULTI_ROUND_AUTH in DEA message).\n18.\tThe SMF+PGW-C receives the final result of authentication/authorization from the DN-AAA in the DEA with Result-Code set to DIAMETER_SUCCESS message, via the UPF+PGW-U.\n19.\tThe SMF+PGW-C updates the N4 rules to allow UE traffic over the PDN connection.\n20.\tThe SMF+PGW-C requests to start accounting by sending the Accounting-Request (START) message to the DN-AAA via the UPF+PGW-U.\n21. The SMF+PGW-C proceeds with PDN connection establishment procedure and includes the authentication/authorization information in the Update Bearer Request message with uplink data allowed indication within the PCO attribute, sent to the MME.\n22.\tThe DN-AAA responds with the Accounting-Response (START) message. The SMF+PGW-C may wait for the Accounting-Response (START) before sending the Update Bearer Request in step 21.\n23.\tThe MME sends the Downlink NAS Transport message with Session Management Request with the authentication/authorization information to the UE.\n24.\tThe UE sends a Uplink NAS Transport message with Session Management Response to the MME.\n25.\tThe MME sends Update Bearer Response to the SMF+PGW-C, after which user data is allowed over the PDN connection.\n26-30. At any point, if the UE triggers Detach procedure and send Detech request to the MME then MME sends Delete Session Request message to the SMF+PGW-C, which responds with Delete Session Response message. The SMF+PGW-C requests to stop accounting by sending the Accounting-Request (STOP) message to the DN-AAA via the UPF+PGW-U and the DN-AAA responds with the Accounting-Response (STOP) message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.2.2\tAccounting Update",
                            "text_content": "During the life of a QoS flow some information related to this QoS flow may change. The SMF may send an Accounting Request (Interim) to the DN-AAA server upon occurrence of a chargeable event, e.g. RAT change, DNAI change or QoS change. Interim updates are also used when the IPv4 address and/or IPv6 prefix is allocated/released/re-allocated.\nNOTE:\tDNAI change is only applicable when application relocation possible indicated in the AF traffic influenced PCC rule as described in clause 5.6.7 of TS 23.501 [2], align with the DNAI change in UP path management events as described in clause 4.3.6.3 of TS 23.502 [3]. Only the target DNAI is provided in the ACR message. The change from the UP path status where a DNAI applies to a status where no DNAI applies indicating the de-activation of the AF request for AF influence on traffic routing is not supported in this release.\nWhen the SMF receives a signalling request (i.e. Nsmf_PDUSession_UpdateSMContext) that indicates the occurrence of one of these chargeable events, the SMF may send an Accounting Request Interim-Update to the DN-AAA server to update the necessary information related to this QoS flow. It is not necessary for the SMF to wait for the Diameter Accounting Answer message from the DN-AAA server before sending the response for the triggering signalling message (i.e. Namf_Communication_N1N2MessageTransfer). The SMF may delete the QoS flow if the Accounting Answer is not received from the DN-AAA server.\nThe SMF may also send interim updates at the expiry of an operator configured time limit.\nFigure 12.2.2-1 is an example message flow to show the procedure of Diameter accounting update, messages between the SMF and DN-AAA are forwarded by the UPF in N4 user plane message.\nThe figure depicts a detailed update on the diameter accounting process, highlighting the steps involved in updating the diameter of a fiber-optic cable. The update includes the calculation of the new diameter, the removal of the old diameter, and the addition of the new diameter to the existing cable. This process ensures that the cable remains consistent in size and can be used for future applications.\nFigure 12.2.2-1: Diameter accounting update\nFor the 5GC and EPC interworking scenario without authentication, authorization, re-authentication and/or re-authorization impacts, if the UE establishes the PDU session through the 5GC and initiates the accounting session, when the SMF+PGW-C determines that the UE has moved to the EPS (i.e. the SMF+PGW-C receives the modify bearer request or create session request from the S-GW), the SMF+PGW-C may perform the accounting session update with the following modifications:\n-\tfor the case that the accounting session is initiated per PDU session, the SMF+PGW-C may update the accounting session by including the identifier of the accounting session within the Session-Id AVP, the \"EUTRA\" within the 3GPP-RAT-Type AVP, the IPv4 address of S-GW within the 3GPP-SGSN-Address AVP or IPv6 address of S-GW within the 3GPP-SGSN-IPv6-Address AVP, the default EPS bearer id within the 3GPP-NSAPI AVP, the user location in the EPC within the 3GPP-User-Location-Info AVP if available and the new QoS profile within the 3GPP-GPRS-Negotiated-QoS-Profile AVP if changed.\n-\tfor the case that the accounting session is initiated per QoS flow:\n-\tif the SMF+PGW-C mapped a QoS flow to an EPS bearer, the SMF may update the accounting session corresponding to the QoS flow with the information of the EPS bearer by including the identifier of the accounting session within the Session-Id AVP, the \"EUTRA\" within the 3GPP-RAT-Type AVP, the IPv4 address of S-GW within the 3GPP-SGSN-Address AVP or IPv6 address of S-GW within the 3GPP-SGSN-IPv6-Address AVP, the default EPS bearer id within the 3GPP-NSAPI AVP, the user location in the EPC within the 3GPP-User-Location-Info AVP if available and the new QoS profile within the 3GPP-GPRS-Negotiated-QoS-Profile AVP if changed, the new charging id within the 3GPP-Charging-Id AVP or 3GPP-Charging-Id-v2 AVP according to the length of the Charging Id if allocated and the new packet filters within the 3GPP-Packet-Filter AVP if changed;\n-\tif the SMF+PGW-C mapped multiple QoS flows to one EPS bearer, the SMF shall select one of the accounting sessions corresponding to these QoS flows to update it as above and terminate the accounting session(s) corresponding to the other QoS flow(s).\n-\tif the SMF+PGW-C did not map a QoS flow to any EPS bearer, the SMF may decide to associate the corresponding account session to the default EPS bearer or terminate the corresponding accounting session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.2.3\tDN-AAA initiated QoS flow termination",
                            "text_content": "Diameter is used as the protocol between the SMF and the DN-AAA server or proxy for applications (e.g. MMS) to deliver information related to user session. However some IP applications could need to interwork with the SMF to release the corresponding resource (e.g. terminate a particular QoS flow). For this purpose, the DN-AAA server or proxy may send a Diameter ASR along with the QoS flow Identifier in 3GPP-NSAPI, if available, to identify the particular QoS flow to be terminated to the SMF. The SMF should react by deleting the corresponding QoS flow and reply with ASA. If the SMF deletes the corresponding QoS flow, it is not necessary for the SMF to wait for the response (i.e. Nsmf_PDUSession_UpdateSMContext) from the AMF before sending the ASA to the DN-AAA server.\nThe absence of the QoS flow Identifier in the Diameter ASR message indicates to the SMF that all QoS flows for this particular user and sharing the same user session shall be deleted. The QoS flows belonging to the same PDU session are identified by the Diameter Session-Id. If a user has the same user IP address for different sets of QoS flows towards different networks, only the QoS flows linked to the one identified by the Diameter Session-Id shall be deleted.\nFigure 12.2.3-1 is an example message flow to show the procedure of DN-AAA initiated QoS flow termination, messages between the SMF and DN-AAA are forwarded by the UPF in N4 user plane message.\nThe figure depicts a DN-AAA initiated QoS flow termination with Diameter, illustrating the process of terminating a QoS flow with a Diameter-based approach.\nFigure 12.2.3-1: DN-AAA initiated QoS flow termination with Diameter\nFor the 5GC and EPC interworking scenario, when the DN-AAA initiates the QoS flow termination, the SMF+PGW-C shall send the delete bearer request to the S-GW as defined in clause 5.4.4.1 of 3GPP TS 23.401 [53] to delete the EPS bearer corresponding to the if the UE has moved to the EPS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.2.4\tDN-AAA initiated re-authorization in 5GC",
                            "text_content": "Some IP applications could need to interwork with the SMF to update the PDU session authorization attributes. For this purpose, the DN-AAA server or proxy may send a Diameter RAR with Re-Auth-Request-Type value \"AUTHORIZE_ONLY\" to the SMF. On receipt of the RAR from the DN-AAA server, the SMF shall update the corresponding PDU session authorization attributes and reply with RAA. DN-AAA may also use such procedure to revoke the authorization of a PDU session, or to update the authorization data (e.g. allowed UE MAC addresses).\nIf the SMF updates/deletes the corresponding PDU session, it is not necessary for the SMF to wait for Nsmf_PDUSession_UpdateSMContext from the AMF before sending the RAA to the DN-AAA server.\nFigure 12.2.4-1 is an example message flow to show the procedure of DN-AAA initiated re-authorization, messages between the SMF and DN-AAA are forwarded by the UPF in N4 user plane message.\nThe figure depicts a DN-AAA initiated re-authorization process with Diameter, illustrating the steps involved in initiating a re-authorization request. The figure includes a diagram of the DN-AAA protocol, the Diameter protocol, and the steps involved in initiating the re-authorization process.\nFigure 12.2.4-1: DN-AAA initiated re-authorization with Diameter\nNOTE:\tThe DN-AAA initiated re-authorization procedure is not applicable for legacy DN-AAA supporting the Diameter procedures over SGi interface as specified in 3GPP TS 29.061 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.2.4a\tDN-AAA initiated re-authorization in EPC Interworking",
                            "text_content": "Some IP applications could need to interwork with the SMF+PGW-C to update the PDD connection authorization attributes. For this purpose, the DN-AAA server or proxy may send a Diameter RAR with Re-Auth-Request-Type value \"AUTHORIZE_ONLY\" to the SMF+PGW-C. On receipt of the RAR from the DN-AAA server, the SMF+PGW-C shall update the corresponding PDN connection authorization attributes and reply with RAA. DN-AAA may also use such procedure to revoke the authorization of a PDN connection, or to update the authorization data (e.g. allowed UE MAC addresses).\nIf the SMF+PGW-C updates/deletes the corresponding PDN connection, it is not necessary for the SMF+PGW-C to wait for Update Bearer Response from the MME before sending the RAA to the DN-AAA server.\nFigure 12.2.4-1 is an example message flow to show the procedure of DN-AAA initiated re-authorization, messages between the SMF+PGW-C and DN-AAA are forwarded by the UPF+PGW-U in N4 user plane message.\nThe figure depicts a DN-AAA initiated re-authorization process with Diameter, illustrating the steps involved in initiating a re-authorization request. The figure includes a diagram of the DN-AAA protocol, the Diameter protocol, and the steps involved in initiating the re-authorization process.\nFigure 12.2.4a-1: DN-AAA initiated re-authorization with Diameter\nNOTE:\tThe DN-AAA initiated re-authorization procedure is not applicable for legacy DN-AAA supporting the Diameter procedures over SGi interface as specified in 3GPP TS 29.061 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.2.5\tDN-AAA initiated re-authentication and re-authorization in 5GC",
                            "text_content": "Some IP applications could need to interwork with the SMF to request re-authentication and re-authorization for the PDU session. For this purpose, the DN-AAA server or proxy may send a Diameter RAR with Re-Auth-Request-Type value \"AUTHORIZE_AUTHENTICATE\" to the SMF. The RAR should not include any authorization attribute.\nNOTE:\tSince the SMF will initiate authentication procedure upon receipt of the RAR and in the end the DN-AAA will authorize the session, the DN-AAA does not have to apply authorization change immediately.\nOn receipt of the RAR from the DN-AAA server, the SMF shall reply with RAA and start authentication and authorization procedure as described in figure 12.2.1-1, from step 4 to step 11, step 13 and with PDU SESSION AUTHENTICATION RESULT message (successful case) sent from the AMF to the UE. The Auth-Request-Type in the DER is set to \"AUTHORIZE_AUTHENTICATE\".\nFigure 12.2.5-1 is an example message flow to show the procedure of DN-AAA initiated re-authentication and re-authorization, messages between the SMF and DN-AAA are forwarded by the UPF in N4 user plane message.\nBased on the result from the SMF, the DN-AAA server may decide to keep the PDU session or request to release the PDU session.\nNOTE:\tAs an implementation option, when the UE becomes unreachable, the SMF can mark the re-authentication result as pending and initiate re-authentication at the next uplink activity.\nWhen the SMF receives a re-authentication request from the DN-AAA server, the SMF shall inform the DN-AAA server that the re-authentication is not possible with error code 3002 and optionaly the \"NR\" within the 3GPP-RAT-Type to indicated the UE is in 5GS not reachable for re-authentication. The SMF should not initiate PDU session release.\n\nThe figure depicts a DN-AAA initiated re-authentication and re-authorization process with Diameter, illustrating the steps involved in ensuring secure communication.\nFigure 12.2.5-1: DN-AAA initiated re-authentication and re-authorization with Diameter\nWhen PAP/CHAP is used as the authentication protocol with the external DN-AAA server which does not support EAP, the Diameter DN-AAA initiated re-authentication and re-authorization procedures are not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.2.5a\tDN-AAA initiated re-authentication and re-authorization in EPC Interworking",
                            "text_content": "Some IP applications could need to interwork with the SMF+PGW-C to request re-authentication and re-authorization for the PDN connection. For this purpose, the DN-AAA server or proxy may send a Diameter RAR with Re-Auth-Request-Type value \"AUTHORIZE_AUTHENTICATE\" to the SMF+PGW-C. The RAR should not include any authorization attribute.\nNOTE:\tSince the SMF+PGW-C will initiate authentication procedure upon receipt of the RAR and in the end the DN-AAA will authorize the session, the DN-AAA does not have to apply authorization change immediately.\nOn receipt of the RAR from the DN-AAA server, the SMF shall reply with RAA and start authentication and authorization procedure as described in figure 12.2.1a-1, from step 11 to step 18. The Auth-Request-Type in the DER is set to \"AUTHORIZE_AUTHENTICATE\".\nFigure 12.2.5-1 is an example message flow to show the procedure of DN-AAA initiated re-authentication and re-authorization, messages between the SMF+PGW-C and DN-AAA are forwarded by the UPF+PGW-U in N4 user plane message.\nWhen the SMF+PGW-C receives a re-authentication request from the DN-AAA server, the SMF+PGW-C shall inform the DN-AAA server that the re-authentication is not supported with error code 3002 and optionaly the \"EUTRA\" within the 3GPP-RAT-Type to indicated the UE is in EPS not available for re-authentication. The SMF+PGW-C should not initiate PDN connection release. Based on the result from the SMF+PGW-C, the DN-AAA server may decide to keep the PDN connection or request to release the PDN connection.\nNOTE:\tAs an implementation option, when the UE becomes unreachable, the SMF+PGW-C can mark the re-authentication result as pending and initiate re-authentication at the next uplink activity.\n\nThe figure depicts a DN-AAA initiated re-authentication and re-authorization process with Diameter, illustrating the steps involved in ensuring secure communication.\nFigure 12.2.5a-1: DN-AAA initiated re-authentication and re-authorization with Diameter\nWhen PAP/CHAP is used as the authentication protocol with the external DN-AAA server which does not support EAP, the Diameter DN-AAA initiated re-authentication and re-authorization procedures are not applicable.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "12.3\tN6 specific AVPs",
                    "description": "",
                    "summary": "",
                    "text_content": "There is no specific AVP defined in the present release.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.4\tN6 re-used AVPs",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "12.4.0\tGeneral",
                            "text_content": "Table 12.4-1 lists the Diameter AVPs re-used by the N6 reference point from existing Diameter Applications, reference to the respective specifications and a short description of the usage within the N6 reference point.\nTable 12.4-1: N6 re-used Diameter AVPs\n\nNOTE 1:\tAttribute 3GPP-CAMEL-Charging-Info (24) is not applicable for 5G in the present specification.\nNOTE 2:\tTable 11.3-2 lists the differences between the RADIUS VSAs used in 5G and the VSAs defined in clause 16.4.7 of 3GPP TS 29.061 [5].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 12.4-1: N6 re-used Diameter AVPs",
                                    "table number": 35,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "12.4.1\tUse of the Supported-Features AVP on the N6 reference point",
                            "text_content": "The Supported-Features AVP is used during session establishment to inform the destination host about the required and optional features that the origin host supports. The client shall, in the first request in a Diameter session indicate the set of supported features. The server shall, in the first answer within the Diameter session indicate the set of features that it has in common with the client and that the server shall support within the same Diameter session. Any further command messages shall always be compliant with the list of supported features indicated in the Supported-Features AVPs during session establishment. Features that are not advertised as supported shall not be used to construct the command messages for that Diameter session. Unless otherwise stated, the use of the Supported-Features AVP on the N6 reference point shall be compliant with the requirements for dynamic discovery of supported features and associated error handling on the Cx reference point as defined in clause 7.2.1 of 3GPP TS 29.229 [41].\nThe base functionality for the N6 reference point is the 3GPP Rel-15 standard and a feature is an extension to that functionality. If the origin host does not support any features beyond the base functionality, the Supported-Features AVP may be absent from the N6 commands. As defined in clause 7.1.1 of 3GPP TS 29.229 [41], when extending the application by adding new AVPs for a feature, the new AVPs shall have the M bit cleared and the AVP shall not be defined mandatory in the command ABNF.\nAs defined in 3GPP TS 29.229 [41], the Supported-Features AVP is of type grouped and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. On the N6 reference point, the Supported-Features AVP is used to identify features that have been defined by 3GPP and hence, for features defined in this document, the Vendor-Id AVP shall contain the vendor ID of 3GPP (10415). If there are multiple feature lists defined for the N6 reference point, the Feature-List-ID AVP shall differentiate those lists from one another.\nOn receiving an initial request application message, the destination host shall act as defined in clause 7.2.1 of 3GPP TS 29.229 [41].\nOnce the SMF and DN-AAA have negotiated the set of supported features during session establishment, the set of common features shall be used during the lifetime of the Diameter session.\nThe table below defines the features applicable to the N6 interfaces for the feature lists with a Feature-List-ID of 1.\nTable 12.4.1-1: Features of Feature-List-ID 1 used in N6\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 12.4.1-1: Features of Feature-List-ID 1 used in N6",
                                    "table number": 36,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "12.5\tN6 specific Experimental-Result-Code AVP",
                    "description": "",
                    "summary": "",
                    "text_content": "Diameter Base IETF RFC 6733 [24] defines a number of Result-Code AVP values that are used to report protocol errors and how those are used. Those procedures and values apply for the present specification.\nDue to the N6 specific AVPs, new application results can occur and the Experimental-Result AVP is used to transfer the 3GPP-specific result codes. The Experimental-Result AVP is a grouped AVP containing the Vendor-Id AVP set to the value of 3GPP's vendor identifier (10415) and an Experimental-Result-Code AVP.\nThe following N6 specific Experimental-Result-Code value is defined:\nDIAMETER_QOS_FLOW_DELETION_INDICATION (2421)\nFor SMF this is an indication to the server that the requested 5G QoS flow or PDU session has been deleted.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.6\tN6 Diameter messages",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "12.6.1\tGeneral",
                            "text_content": "This clause describes the N6 Diameter messages.\nThe relevant AVPs that are of use for the N6 interface are detailed in this clause. Other Diameter AVPs as defined in IETF RFC 4072 [25] and IETF RFC 7155 [23], even if their AVP flag rules are marked with \"M\", are not required for being compliant with the current specification.\nDiameter messages as defined in clause 16a.4 of 3GPP TS 29.061 [5] are re-used in 5G with the following differences:\n-\tSMF or SMF+PGW-C replaces P-GW, and GGSN related description are not applicable for 5G.\n-\t5G QoS flow replaces IP-CAN/EPS bearer and PDU session replaces IP-CAN session.\n-\tN6 replaces Gi/Sgi.\nNOTE:\tN6 re-used and specific AVPs are specified in clause 12.3 and clause 12.4.\n-\t3GPP-NAI AVP may be included in the AAR and ACR command.\n-\t3GPP-NID AVP may be included together with 3GPP-SGSN-MCC-MNC AVP in the AAR and ACR command.\n-\t3GPP-Session-S-NSSAI AVP and/or 3GPP-Session-Id AVP may be included in the AAR and ACR command.\n-\t3GPP-DNAI AVP, 3GPP-RSN AVP and/or 3GPP-Session-Pair-Id AVP may be included in the ACR command.\n-\tMultiple 3GPP-IP-Address-Pool-Info AVPs may be included in the AAR command and one or two 3GPP-IP-Address-Pool-Info AVPs may be included in the AAA and ACR command.\n-\tMultiple 3GPP-UE-MAC-Address AVPs may be included in the AAR and ACR command.\n-\tFor indicating user location, TWAN-Identifier AVP, 3GPP-TNAP-Identifier AVP, 3GPP-HFC-NodeId AVP, 3GPP-GLI AVP, 3GPP-Line-Type AVP, 3GPP-UE-Local-IP-Address and optionally UDP or TCP source port number (if NAT is detected) may be included in the AAR and ACR command.\n-\tAcct-Application-Id AVP shall be included in the ACR and ACA command as specified in IETF RFC 7155 [23].\n-\tAdditional Diameter messages needed for 5G compared to the 3GPP TS 29.061 [5] are described in the following clauses.\n-\tMultiple Supported-Features AVPs may be included in the ACR and ACA command.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.6.2\tDER Command",
                            "text_content": "The DER command, defined in IETF RFC 4072 [25], is indicated by the Command-Code field set to 268 and the 'R' bit set in the Command Flags field. It is sent by the SMF to the DN-AAA server upon reception of an initial access request (e.g. Nsmf_PDUSession_CreateSMContext) message for a given DNN to request user authentication and authorization.\nThe relevant AVPs that are of use for the N6 interface are detailed in the ABNF description below. Other valid AVPs for this command are not used for N6 purposes and should be ignored by the receiver or processed according to the relevant specifications.\nThe bold marked AVPs in the message format indicate new optional AVPs for N6, or modified existing AVPs.\nMessage Format:\n<Diameter-EAP-Request> ::= < Diameter Header: 268, REQ, PXY >\n< Session-Id >\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n[ Destination-Host ]\n[ NAS-Port ]\n[ NAS-Port-Id ]\n[ NAS-Port-Type ]\n[ Origin-State-Id ]\n[ Port-Limit ]\n[ User-Name ]\n{ EAP-Payload }\n[ EAP-Key-Name ]\n[ Service-Type ]\n[ Authorization-Lifetime ]\n[ Auth-Grace-Period ]\n[ Auth-Session-State ]\n[ Callback-Number ]\n[ Called-Station-Id ]\n[ Calling-Station-Id ]\n[ Originating-Line-Info ]\n[ Connect-Info ]\n*\t[ Framed-Compression ]\n[ Framed-Interface-Id ]\n[ Framed-IP-Address ]\n*\t[ Framed-IPv6-Prefix ]\n*\t[ Delegated-IPv6-Prefix ]\n[ Framed-IP-Netmask ]\n[ Framed-MTU ]\n[ Framed-Protocol ]\n*\t[ Tunneling ]\n*\t[ Proxy-Info ]\n*\t[ Route-Record ]\n[ External-Identifier ]\n[ 3GPP-IMSI ]\n[ 3GPP-NAI ]\n*\t[ 3GPP-UE-MAC-Address ]\n[ 3GPP-Charging-ID ]\n[ 3GPP-Charging-ID-v2 ]\n[ 3GPP-PDP-Type ]\n[ 3GPP-CG-Address ]\n[ 3GPP-CHF-FQDN ]\n[ 3GPP-GPRS-Negotiated-QoS-Profile ]\n[ 3GPP-SGSN-Address ]\n[ 3GPP-GGSN-Address ]\n[ 3GPP-Session-S-NSSAI ]\n[ 3GPP-Session-Id ]\n[ 3GPP-IMSI-MCC-MNC ]\n[ 3GPP-GGSN-MCC-MNC ]\n[ 3GPP-NSAPI ]\n[ 3GPP-Selection-Mode ]\n[ 3GPP-Charging-Characteristics ]\n[ 3GPP-CG-IPv6-Address ]\n[ 3GPP-SGSN-IPv6-Address ]\n[ 3GPP-Serving-NF-FQDN ]\n[ 3GPP-GGSN-IPv6-Address ]\n[ 3GPP-SGSN-MCC-MNC ]\n[ 3GPP-NID ]\n[ 3GPP-User-Location-Info ]\n[ 3GPP-RAT-Type ]\n[ 3GPP-Negotiated-DSCP ]\n[ 3GPP-Allocate-IP-Type ]\n[ TWAN-Identifier ]\n[ 3GPP-TNAP-Identifier ]\n[ 3GPP-HFC-NodeId ]\n[ 3GPP-GCI ]\n[ 3GPP-GLI ]\n[ 3GPP-Line-Type ]\n[ 3GPP-UE-Local-IP-Address ]\n[ 3GPP-UE-Source-Port ]\n*\t[ 3GPP-IP-Address-Pool-Info]\n*\t[ Supported-Features ]\n*\t[ AVP ]\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.6.3\tDEA Command",
                            "text_content": "The DEA command, defined in IETF RFC 4072 [25], is indicated by the Command-Code field set to 268 and the 'R' bit cleared in the Command Flags field. It is sent by the DN-AAA server to the SMF in response to the DER command.\nThe relevant AVPs that are of use for the N6 interface are detailed in the ABNF description below. Other valid AVPs for this command are not used for N6 purposes and should be ignored by the receiver or processed according to the relevant specifications.\nThe bold marked AVPs in the message format indicate new optional AVPs for N6, or modified existing AVPs.\nMessage Format:\n<Diameter-EAP-Answer> ::= < Diameter Header: 268, PXY >\n< Session-Id >\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n[ EAP-Payload ]\n[ EAP-Reissued-Payload ]\n[ EAP-Master-Session-Key ]\n[ EAP-Key-Name ]\n[ Multi-Round-Time-Out ]\n[ Accounting-EAP-Auth-Method ]\n[ Service-Type ]\n*\t[ Class ]\n[ Acct-Interim-Interval ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n[ Idle-Timeout ]\n[ Authorization-Lifetime ]\n[ Auth-Grace-Period ]\n[ Auth-Session-State ]\n[ Re-Auth-Request-Type ]\n[ Session-Timeout ]\n*\t[ Reply-Message ]\n[ Origin-State-Id ]\n*\t[ Filter-Id ]\n[ Port-Limit ]\n[ Callback-Id ]\n[ Callback-Number ]\n*\t[ Framed-Compression ]\n[ Framed-Interface-Id ]\n[ Framed-IP-Address ]\n*\t[ Framed-IPv6-Prefix ]\n[ Framed-IPv6-Pool ]\n*\t[ Framed-IPv6-Route ]\n*\t[ Delegated-IPv6-Prefix ]\n[ Framed-IP-Netmask ]\n*\t[ Framed-Route ]\n[ Framed-Pool ]\n[ Framed-IPX-Network ]\n[ Framed-MTU ]\n[ Framed-Protocol ]\n[ Framed-Routing ]\n*\t[ NAS-Filter-Rule ]\n*\t[ QoS-Filter-Rule ]\n*\t[ Tunneling ]\n*\t[ Redirect-Host ]\n[ Redirect-Host-Usage ]\n[ Redirect-Max-Cache-Time ]\n*\t[ Proxy-Info ]\n*\t[ External-Identifier ]\n[ 3GPP-IPv6-DNS-Servers ]\n[ 3GPP-Notification ]\n0*16 [ 3GPP-UE-MAC-Address ]\n0*16 [ 3GPP-VLAN-Id ]\n[ 3GPP-Authorization-Reference ]\n[ 3GPP-Policy-Reference ]\n[ 3GPP-Session-AMBR ]\n[ 3GPP-Session-AMBR-v2 ]\n0*2 [ 3GPP-IP-Address-Pool-Info]\n*\t[ Supported-Features ]\n*\t[ AVP ]\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.6.4\tRAR Command",
                            "text_content": "The RAR command, defined in IETF RFC 7155 [23], is indicated by the Command-Code field set to 258 and the 'R' bit set in the Command Flags field. It is sent by the DN-AAA server to the SMF to initiate re-authorization and optional re-authentication service.\nThe relevant AVPs that are of use for the N6 interface are detailed in the ABNF description below. Other valid AVPs for this command are not used for N6 purposes and should be ignored by the receiver or processed according to the relevant specifications.\nThe bold marked AVPs in the message format indicate new optional AVPs for N6, or modified existing AVPs.\nMessage Format:\n<RA-Request> ::= < Diameter Header: 258, REQ, PXY >\n< Session-Id >\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Application-Id }\n{ Re-Auth-Request-Type }\n[ User-Name ]\n[ Origin-State-Id ]\n[ NAS-Port ]\n[ NAS-Port-Id ]\n[ NAS-Port-Type ]\n[ Service-Type ]\n[ Framed-IP-Address ]\n[ Framed-IPv6-Prefix ]\n[ Framed-Interface-Id ]\n[ Called-Station-Id ]\n[ Calling-Station-Id ]\n[ Originating-Line-Info ]\n[ Acct-Session-Id ]\n*\t[ Class ]\n[ Reply-Message ]\n*\t[ Proxy-Info ]\n*\t[ Route-Record ]\n0*16 [ 3GPP-UE-MAC-Address ]\n0*16 [ 3GPP-VLAN-Id ]\n[ 3GPP-Authorization-Reference ]\n[ 3GPP-Policy-Reference ]\n[ 3GPP-Session-AMBR ]\n[ 3GPP-Session-AMBR-v2 ]\n*\t[ AVP ]\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.6.5\tRAA Command",
                            "text_content": "The RAA command, defined in IETF RFC 7155 [23], is indicated by the Command-Code field set to 258 and the 'R' bit set in the Command Flags field. It is sent by the SMF to the DN-AAA server in response to the RAR command.\nThe relevant AVPs that are of use for the N6 interface are detailed in the ABNF description below. Other valid AVPs for this command are not used for N6 purposes and should be ignored by the receiver or processed according to the relevant specifications.\nThe bold marked AVPs in the message format indicate new optional AVPs for N6, or modified existing AVPs.\nMessage Format:\n<RA-Answer> ::= < Diameter Header: 258, PXY >\n< Session-Id >\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n[ Origin-State-Id ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*\t[ Redirect-Host ]\n[ Redirect-Host-Usage ]\n[ Redirect-Max-Cache-Time ]\n[ Service-Type ]\n[ Idle-Timeout ]\n[ Authorization-Lifetime ]\n[ Auth-Grace-Period ]\n[ Re-Auth-Request-Type ]\n*\t[ Class ]\n*\t[ Reply-Message ]\n*\t[ Proxy-Info ]\n[ 3GPP-RAT-Type ]\n*\t[ AVP ]\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "13\tInterworking with IMS",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "13.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Interworking with the IP Multimedia Core Network Subsystem (IMS) puts specific requirements on the SMF.\nThe SMF shall use the following mechanisms to support the interworking with the IMS:\n-\tthe P-CSCF discovery;\n-\tN7 interface for the policy and charging control of QoS flows for IMS media flows; and\n-\tthe P-CSCF restoration.\nThese mechanisms are however not restricted only to the interworking with the IMS and may be used for other services that could benefit from these mechanisms.\nIf the PDU Session is used for IMS (identified by DNN), the SMF/UPF shall not modify the fields Type of Service (IPv4) and Traffic Class (IPv6) of the received downlink packets..\nNOTE:\tThe P-CSCF can support paging policy differentiation for different traffic or service types over NG-RAN by marking the fields Type of Service (IPv4) and Traffic Class (IPv6) (see clause L.3.2.4 of 3GPP TS 24.229 [13]).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "13.2\tIMS interworking Model",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "13.2.1\tIntroduction",
                            "text_content": "The signalling interface between the UE and the P-CSCF is a logical interface, i.e. it uses 5GC as a QoS flow. The Npcf_SMPolicyControl services, offered via N7 interface, are used for network communication between the SMF and the PCF. For a description of the IMS architecture, refer to 3GPP TS 23.228 [12].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.2.2\tIMS specific configuration in the SMF",
                            "text_content": "The SMF shall have a list of preconfigured addresses of signalling servers (the P-CSCF servers). This list shall be provided to the UE at PDU session establishment. It shall be possible to preconfigure the list of preconfigured addresses of signalling servers per DNN.\nThe SMF/UPF may have the locally preconfigured packet filters, and/or the applicable PCC rules, to be applied on the QoS flow. The packet filters shall filter up-link and down-link packets, and shall only allow traffic to/from the signalling servers and to the DNS and the DHCP servers. It shall be possible to locally preconfigure the packet filters per DNN.\nIt shall be possible to enable/disable the use of the services offered via N7 interface per DNN.\nThe SMF shall support IPv4 and/or IPv6 addresses and protocol for IMS signalling and IMS QoS flows.\nThe methods for the UE to discover the P-CSCF address(es) may vary depending on the access technology that the UE is on. The details of the P-CSCF discovery mechanisms for various accesses are specified in 3GPP TS 23.228 [12] and 3GPP TS 24.229 [13]. The P-CSCF discovery mechanisms are:\n-\ta 5GC procedure for the P-CSCF discovery;\n-\tvia DHCP servers i.e. the SMF shall provide the functionality of a DHCP relay agent; and\n-\tif the UE has a P-CSCF FQDN locally configured and request the DNS IP address(es) from the SMF (via 5GC mechanism or DHCP procedures), the SMF shall be able to provide DNS IP address(es) to the UE.\nThe SMF shall have similar functional support depending on the P-CSCF discovery methods supported by the UE on the access technology. For example, for the UE in 3GPP 5G access network the SMF shall have DHCP server function towards the UE while acting as a DHCP client towards external DHCP server, if the SMF is configured to request DNS and/or P-CSCF IP addresses from the external DHCP servers.\nThe SMF shall be able to deliver DNS and/or P-CSCF addresses to the UE if requested by the UE via the 5G network or via DHCP procedures using the relevant DHCP options for IPv4/IPv6 DNS and SIP servers (see IETF RFC 2132 [14], IETF RFC 3361 [15], IETF RFC 3646 [16] and IETF RFC 3319 [17]).\nOn DNNs providing IMS services, the information advertised in Router Advertisements from the SMF to the UEs shall be configured in the same manner as for other DNNs providing IPv6 services except that the \"O-flag\" shall be set.\nThe \"O-flag\" shall be set in IPv6 Router Advertisement messages sent by the SMF for DNNs used for IMS services. This will trigger a DHCP capable UE to start a DHCPv6 session to retrieve server addresses and other configuration parameters. The UE which doesn't support DHCP shall ignore the \"O-flag\" and shall request the IMS specific configuration (e.g. the P-CSCF address) via other discovery methods supported in the UE (i.e. via locally configured P-CSCF address/FQDN in the UE or via 5G procedure, if applicable).\nThe SMF shall have configurable policy rules for controlling QoS flows used for signalling.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.2.3\tIMS specific procedures in the SMF",
                            "text_content": "At a PDU Session establishment procedure related to the IMS, the SMF shall support the capability to send the P-CSCF address(es) to the UE. The P-CSCF address information is sent by the visited SMF if LBO is used. For Home routed, the P-CSCF address information is sent by the SMF in the HPLMN. The P-CSCF address(es) shall be sent transparently through the AMF, and in case of Home Routed also through the SMF in the VPLMN.\nNOTE 1:\tThe SMF is located in the VPLMN if LBO is used.\nNOTE 2:\tOther options to provide the P-CSCF address(es) to the UE as defined in 3GPP TS 23.228 [12] is not excluded.\nNOTE 3:\tA PDU session for IMS is identified by \"APN\" or \"DNN\".\nIf the SMF detects a failure:\n-\tupon receiving the N4 session report from the UPF for the monitored P-CSCF address being used by the UE (as specified in 3GPP TS 23.380 [38], clause 5.8.3); or\n-\tupon receiving a P-CSCF restoration indication from the UDM or the PCF,\nthen the SMF shall act as specified in 3GPP TS 23.380 [38], clause 5.8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "14\tInterworking with DN (Ethernet)",
            "description": "When support of Ethernet PDU type data is provided at the N6 interface, the SMF and UPF may support ARP proxying as specified in IETF RFC 1027 [35] and/or IPv6 Neighbour Solicitation Proxying as specified in IETF RFC 4861 [33] functionality. Based on operator configuration, during the PDU session establishment, the SMF may request the UPF acting as the PDU Session Anchor to proxy ARP/IPv6 Neighbour Solicitation or to forward the ARP/IPv6 Neighbour Solicitation traffic from the UPF to the SMF.\nEthernet Preamble, Start Frame Delimiter (SFD) and Frame Check Sequence (FCS) are not sent over 5GS:\n-\tFor UL traffic the UE strips the Preamble, SFD and FCS from the Ethernet frame, those fields shall be added by the UPF acting as the PDU Session Anchor.\n-\tFor DL traffic the UPF acting as the PDU Session Anchor shall strip the Preamble, SFD and FCS from the Ethernet frame.\nIP address is not allocated by the SMF to the UE for this PDU Session. The UPF shall store the MAC addresses, received from the UE, and associate those with the appropriate PDU Session.\nNOTE 1:\tThe UE can operate in bridge mode with regard to a LAN it is connecting to the 5GS, thus different MAC addresses can be used as source address of different frames sent UL over a single PDU Session (and destination MAC address of different frames sent DL over the same PDU Session)\nNOTE 2:\tEntities on the LAN connected to the 5GS by the UE can have an IP address allocated by the external DN, but the IP layer is considered as an application layer which is not part of the Ethernet PDU Session.\nNOTE 3:\tIn this Release of the specification, only the UE connected to the 5GS is authenticated, not the devices behind such UE.\nWhen a PDU Session of Ethernet PDU type is authorized by a DN, the DN-AAA server may, as part of authorization data, provide the SMF with a list of allowed MAC addresses (maximum 16) for this PDU Session. When such a list has been provided for a PDU Session, the SMF sets corresponding filtering rules in the UPF(s) acting as PDU Session Anchor for the PDU Session and the UPF discards any UL traffic that does not contain any of these MAC addresses as a source address.\nThe figure depicts a protocol stack for Ethernet PDU type data (user plane) for N6 reference point, illustrating the various components and their interactions.\nFigure 14-1: Protocol stacks for Ethernet PDU type data (user plane) for N6 reference point\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "15\tInterworking with DN (Multicast Routing Protocol)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "15.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP network support IPTV multicast packets transmission over PDU Session as specified in 3GPP TS 23.316 [43] clause 7.7.1. When support of multicast routing protocol is provided at the N6 interface, different techniques may be used.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "15.2\tDN interworking Model of UPF for PIM",
                    "description": "",
                    "summary": "",
                    "text_content": "If PIM (Protocol-Independent Multicast) is used as Multicast Routing Protocol, including PIM-SM (Protocol-Independent Multicast-Sparse Mode, IETF RFC 7761 [44]) and PIM-DM (Protocol-Independent Multicast- Dense Mode, IETF RFC 3973 [45]), are commonly used to efficiently routing multicast groups that may span wide-area (and inter-domain) internets.\nUPF acts as the PIM router which is clostest to UE and receive multicast packets originated from multicast source via perform PIM function.  Based on local policy, UPF support either PIM-SM or PIM-DM or both.\nUPF shall acts as PIM router used for interworking with the IP network as illustrated in figure 15.2-1.\nThe figure depicts the protocol stacks for the N6 reference point for PIM, illustrating the various components and their interactions.\nFigure 15.2-1: The protocol stacks for the N6 reference point for PIM\nPIM function in UPF shall interacts with PIM routers in IP network.\n-\tIn case of PIM-SM, PIM router in UPF acts as DR (Designated Router) which is clostest to UE and send register message to RP (Rendezvous Point). It receive multicast packets over shared tree from RP. Refer to IETF RFC 7761 [44] for more details.\n-\tIn case of PIM-DM, PIM router in UPF sends Upstream Prune Messages to indicate that designated multicast traffic is not desired, It sends Upstream Graft message to re-join a previously pruned branch to the delivery tree. Refer to IETF RFC 3973 [45] for more details.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "16\tInterworking with NSS-AAA (RADIUS)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "16.1\tRADIUS procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.1.1\tGeneral",
                            "text_content": "The Network Slice Specific Authentication and Authorization procedure is triggered for a network slice requiring Network Slice Specific Authentication and Authorization with an NSS-AAA server which may be hosted by the H-PLMN operator or by a third party which has a business relationship with the H-PLMN. An AAA Proxy (AAA-P) in the HPLMN may be involved e.g. if the NSS-AAA Server belongs to a third party.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.1.2\tRADIUS Authentication and Authorization",
                            "text_content": "RADIUS Authentication and Authorization shall be used according to IETF RFC 2865 [8], IETF RFC 3162 [9] and IETF RFC 4818 [10]. In 5G, multiple authentication methods using Extensible Authentication Protocol (EAP) may be used such as EAP-TLS (see IETF RFC 5216 [11]), EAP-TTLS (see IETF RFC 5281 [37]). The NSSAAF or AAA-P shall implement the RADIUS extension to support EAP as specified in IETF RFC 3579 [7].\nThe RADIUS client function may reside in an NSSAAF. When the NSSAAF receives Nnssaaf_NSSAA_Authenticate request from AMF, the RADIUS client function shall send the authentication information with network slice information to a NSS-AAA server directly or via an AAA-P.\nThe NSS-AAA server performs authentication and authorization for the user and requested network slice information. When the NSSAAF receives an Access-Accept message from the NSS-AAA server or AAA-P, it shall complete the network slice specific authentication procedure. If Access-Reject or no response is received, the NSSAAF shall reject the network slice specific authentication procedure with a suitable cause code.\nThe NSS-AAA may revoke the authorization for the network slice, see details in clause 16.2.2. In the present release, the NSS-AAA initiated re-authentication is not supported.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "16.2\tMessage flows for network slice specific authentication",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.2.1\tAuthentication and Authorization procedures",
                            "text_content": "When the NSSAAF receives Nnssaaf_NSSAA_Authenticate request from AMF, it shall send a RADIUS Access-Request message with EAP extension to an NSS-AAA server directly or via an AAA-P if AAA-P is involved. The Access-Request message shall include GPSI in Calling-Station-Id or External-Identifier attribute and network slice information in 3GPP-S-NSSAI attribute. Upon receipt of the Access-Request message, the NSS-AAA server shall respond with an Access-Challenge message. Multi-round authentication using the Access-Challenge (sent by NSS-AAA) and Access-Request messages may be used. The NSS-AAA server finally authenticates and authorizes the user and the network slice by replying with an Access Accept message.\nFor re-authentication and re-authorization, the NSSAAF shall send a RADIUS Access-Request message with EAP extension to the NSS-AAA server directly or via the AAA-P if AAA-P is used and the NSS-AAA shall respond with an Access-Challenge message. Multi-round authentication using the Access-Challenge (sent by NSS-AAA) and Access-Request messages may be used. The NSS-AAA server finally authenticates and authorizes the user and the network slice by replying with an Access Accept message.\nThe following figure 16.2.1-1 is an example message flow to show the procedure of RADIUS Authentication and Authorization between an AMF and a NSS-AAA server:\n1.\tAMF decides to trigger the start of the Network Slice Specific Authentication and Authorization procedure.\n2.\tThe AMF may send an EAP Identity Request in a NAS Network Slice-Specific Authentication Command message.\n3.\tThe UE provides the EAP Identity Response in a NAS Network Slice-Specific Authentication Complete message towards the AMF.\n4. The AMF sends Nnssaaf_NSSAA_Authenticate Request to the NSSAAF including the authentication/authorization information.\n5-6.\tIf the AAA-P is present (e.g. because the NSS-AAA belongs to a third party and the operator deploys a proxy towards third parties), the NSSAAF sends the Access-Request message to the NSS-AAA via the AAA-P to forward the authentication/authorization information, otherwise the NSSAAF sends the Access-Request message directly to the NSS-AAA.\n7-14.\tThe NSS-AAA responds with the Access-Challenge message to the NSSAAF directly or via the AAA-P. The authentication/authorization information is further transferred to UE via AMF by Nnssaaf_NSSAA_Authenticate service and NAS Network Slice-Specific Authentication Command message. UE responds to the received authentication/authorization data and such information is transferred in NAS Network Slice-Specific Authentication Complete message and Nnssaaf_NSSAA_Authenticate service, then finally sent to the NSS-AAA by the NSSAAF, via the AAA-P if the AAA-P is used, in the Access-Request message.\nNOTE:\tStep 7 to step 14 can be repeated depending on the authentication/authorization mechanism used (e.g. EAP-TLS).\n15-16. If the AAA-P is used, the NSS-AAA sends a Access-Accept message with the final result of authentication/authorization to the NSSAAF via the AAA-P, otherwise the NSS-AAA sends the Access-Accept message directly to the NSSAAF.\n17.\tThe NSSAAF sends a Nnssaaf_NSSAA_Authenticate Response with the final result of authentication/authorization information to the AMF.\n18.\tThe AMF transfers the final result of authentication/authorization information in a NAS Network Slice-Specific Authentication Result message to the UE.\nThe figure depicts a network slice specific authentication and authorization procedure (RADIUS) in a network. It illustrates the authentication and authorization process, with a focus on network slice-specific authentication and authorization. The RADIUS protocol is used to ensure secure communication between network slices, with specific authentication and authorization rules defined for each slice.\nFigure 16.2.1-1: Network slice specific authentication and Authorization procedure (RADIUS)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.2.2\tNSS-AAA initiated revocation of network slice authorization",
                            "text_content": "The NSS-AAA server may send a RADIUS Disconnect-Request to the NSSAAF directly or via AAA-P (if AAA-P is used) asking for revocation of network slice authorization. On receipt of the Disconnect-Request from the NSS-AAA server, the NSSAAF shall check whether the NSS-AAA server is authorized to request the revocation by verifying the local configuration of the address of the NSS-AAA server per S-NSSAI, if successful, the NSSAAF shall release the resources, interact with its succeeding Network Function AMF which is got from the UDM by Nudm_UECM_GET service operation with GPSI and reply with a Disconnect-ACK. If the NSSAAF is unable to release the corresponding resources, it shall reply to the NSS-AAA server with a Disconnect-NAK. For more information on RADIUS Disconnect, see IETF RFC 5176 [27]. It is not necessary for the NSSAAF to wait for the response (i.e. Nudm_UECM_GET or Nnssaaf_NSSAA_Notify response) from the succeeding Network Function before sending the RADIUS Disconnect-ACK to the NSS-AAA server or AAA-P (if AAA-P is used).\nEditor's Note:\tIt is FFS whether the RADIUS is applicable.\nFigure 16.2.2-1 is an example message flow to show the procedure of NSS-AAA initiated revocation of network slice authorization. If the AAA-P is not used, the Disconnect Request and Response messages are exchanged between the NSS-AAA and the NSSAAF.\nThe figure depicts a network slice authorization revocation process initiated by NSS-AAA, which is a security service that provides authorization for network slices. The process involves the use of RADIUS, a protocol for authentication and authorization, to revoke the authorization of a network slice. The figure shows the steps involved in the process, including the use of the RADIUS protocol, the authentication of the requester, and the revocation of the authorization.\nFigure 16.2.2-1: NSS-AAA initiated revocation of network slice authorization with RADIUS\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "16.3\tList of RADIUS attributes",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.3.1\tGeneral",
                            "text_content": "Information defined in clause 11.3 are re-used for network slice specific authentication with the following differences:\n-\tNSSAAF replaces SMF.\n-\tIP, Ethernet and PDU session related descriptions and attributes are not applicable.\n-\tRADIUS messages for accounting function (Accounting Request/Response) are not applicable.\n-\tAdditional detailed information needed for network slice specific authentication are described below.\nTable 16.3-1: Additional information needed for network slice specific authentication\n\n200 – 3GPP-S-NSSAI\n\n\n3GPP Type: 200\nLength: 3 or 6\nSST: the Slice/Service Type with value range 0 to 255.\nSD: 3-octet string, representing the Slice Differentiator, the encoding follows sd attribute specified in clause 5.4.4.2 of 3GPP TS 29.571 [46]. Its presence depends on the Length field.\nTable 16.3-2 describes the sub-attributes of the 3GPP Vendor-Specific attribute described above in different RADIUS messages.\nTable 16.3-2: List of the 3GPP Vendor-Specific sub-attributes for network slice specific authentication\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 16.3-1: Additional information needed for network slice specific authentication",
                                    "table number": 37,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 38,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 16.3-2: List of the 3GPP Vendor-Specific sub-attributes for network slice specific authentication",
                                    "table number": 39,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "17\tInterworking with NSS-AAA (Diameter)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "17.1\tDiameter procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.1.1\tGeneral",
                            "text_content": "The Network Slice Specific Authentication and Authorization procedure is triggered for a network slice requiring Network Slice Specific Authentication and Authorization with an NSS-AAA server which may be hosted by the H-PLMN operator or a third party which has a business relationship with the H-PLMN. An AAA Proxy (AAA-P) in the HPLMN may be involved e.g. if the NSS-AAA Server belongs to a third party.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.1.2\tDiameter Authentication and Authorization",
                            "text_content": "Diameter Authentication and Authorization shall be used according to IETF RFC 7155 [23]. In 5G, multiple authentication methods using Extensible Authentication Protocol (EAP) may be used such as EAP-TLS (see IETF RFC 5216 [11]), EAP-TTLS (see IETF RFC 5281 [37]). The NSSAAF or AAA-P shall support Diameter EAP application as specified in IETF RFC 4072 [25].\nThe NSSAAF or AAA-P and the NSS-AAA shall advertise the support of the Diameter NASREQ and EAP applications by including the value (1 and 5) of the application identifier in the Auth-Application-Id AVP (as specified in IETF RFC 4072 [25]) and the value of the 3GPP (10415) in the Vendor-Id AVP of the Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands as specified in IETF RFC 6733 [24], i.e. as part of the Vendor-Specific-Application-Id AVP.\nThe Diameter client function may reside in an NSSAAF. When the NSSAAF receives Nnssaaf_NSSAA_Authenticate request from AMF, the Diameter client function shall send the authentication information with network slice information to a NSS-AAA server directly or via an AAA-P (if AAA-P is used).\nThe NSS-AAA server performs authentication and authorization for the requested network slice information. When the Nnssaaf receives a positive response from the NSS-AAA server or AAA-P (if AAA-P is used), it shall complete the network slice specific authentication procedure. If negative response or no response is received, the NSSAAF shall reject the network slice specific authentication procedure with a suitable cause code.\nThe NSS-AAA may revoke the authorization for the network slice, see details in clause 17.2.2. NSS-AAA may initiate re-authentication and re-authorization, see details in clause 17.2.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17.2\tMessage flows for network slice specific authentication",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.2.1\tAuthentication and Authorization procedures",
                            "text_content": "For network slice specific authentication and authorization, when the NSSAAF receives Nnssaaf_NSSAA_Authenticate request from AMF, it shall send a Diameter DER message with GPSI in Calling-Station-Id or External-Identifier attribute and network slice information in 3GPP-S-NSSAI attribute to a NSS-AAA server directly or via AAA-P if AAA-P is involved. Upon receipt of the DER message, the DN-AAA server shall respond with an DEA message. Multi-round authentication using the DEA and DER messages may be used. The NSS-AAA server finally authenticates and authorizes the user and the network slice by replying with a Diameter DEA message.\nFor re-authentication and re-authorization, the NSSAAF shall send a DER message to the NSS-AAA server directly or via AAA-P if AAA-P is used and the NSS-AAA server shall respond with a DEA message. Multi-round authentication using the DEA and DER messages may be used. The NSS-AAA server finally authenticates and authorizes the user and the network slice by replying with a Diameter DEA message.\nIf the network slice specific authentication is not required, the NSSAAF shall send a Diameter STR message to the NSS-AAA server directly or via AAA-P if AAA-P is involved. The NSS-AAA server shall reply with a Diameter STA message.The following figure 17.2.1-1 is an example message flow to show the procedure of Diameter Authentication and Authorization between an AMF and a NSS-AAA server:\n1.\tAMF decides to trigger the start of the Network Slice Specific Authentication and Authorization procedure.\n2.\tThe AMF may send an EAP Identity Request in a NAS Network Slice-Specific Authentication Command message.\n3.\tThe UE provides the EAP Identity Response in a NAS Network Slice-Specific Authentication Complete message towards the AMF.\n4. The AMF sends Nnssaaf_NSSAA_Authenticate Request to the NSSAAF including the authentication/authorization information.\n5-6.\tIf the AAA-P is present (e.g. because the NSS-AAA belongs to a third party and the operator deploys a proxy towards third parties), the NSSAAF sends the DER message to the NSS-AAA via the AAA-P to forward the authentication/authorization information, otherwise the NSSAAF sends the DER message directly to the NSS-AAA.\n7-14.\tThe NSS-AAA responds with the DEA message to the NSSAAF directly or via the AAA-P. The authentication/authorization information is further transferred to UE via AMF by Nnssaaf_NSSAA_Authenticate service and NAS MM Transport message. UE responds to the received authentication/authorization data and such information is transferred in NAS Network Slice-Specific Authentication Complete message and Nnssaaf_NSSAA_Authenticate service, then finally sent to the NSS-AAA by the NSSAAF, via the AAA-P if the AAA-P is used, in the DER message.\nNOTE:\tStep 7 to step 14 can be repeated depending on the authentication/authorization mechanism used (e.g. EAP-TLS).\n15-16. If the AAA-P is used, the NSS-AAA sends a DEA message with the final result of authentication/authorization to the NSSAAF via the AAA-P, otherwise the NSS-AAA sends the DEA message directly to the NSSAAF.\n17.\tThe NSSAAF sends a Nnssaaf_NSSAA_Authenticate Response with the final result of authentication/authorization information to the AMF.\n18.\tThe AMF transfers the final result of authentication/authorization information in a NAS Network Slice-Specific Authentication Result message to the UE.\nThe figure depicts a network slice specific authentication and authorization procedure (Diameter) in a 5G network. It illustrates the authentication and authorization process, with key components such as the network slice, authentication server, and authorization server. The figure highlights the use of Diameter protocols to ensure secure communication and data integrity.\nFigure 17.2.1-1: Network slice specific authentication and Authorization procedure (Diameter)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.2\tNSS-AAA initiated revocation of network slice authorization",
                            "text_content": "The NSS-AAA server may send a Diameter ASR message to the NSSAAF directly or via AAA-P (if AAA-P is used) asking for revocation of network slice authorization. On receipt of the ASR message from the NSS-AAA server, the NSSAAF shall check whether the NSS-AAA server is authorized to request the revocation by verifying the local configuration of the address of the NSS-AAA server per S-NSSAI, if successful, the NSSAAF shall release the corresponding resources, interact with its succeeding Network Function AMF which is got from the UDM by Nudm_UECM_GET service operation with GPSI and reply with a Diameter ASA message. It is not necessary for the NSSAAF to wait for the response (i.e. Nudm_UECM_GET or Nnssaaf_NSSAA_Notify response) from its succeeding Network Function before sending the ASA message to the NSS-AAA server or AAA-P.\nNOTE:\tIn the Diameter ASR request, the Origin-Host AVP with the FQDN/domain format indicates the address of the NSS-AAA server for NSSAAF check.\nFigure 17.2.2-1 is an example message flow to show the procedure of NSS-AAA initiated revocation of network slice authorization. If the AAA-P is not used, the ASR and ASA messages are exchanged between the NSS-AAA and the NSSAAF.\nThe figure depicts a network slice authorization revocation process initiated by the Network Slice Authorization (NSA) system. The process involves Diameter, a protocol used for network slice authorization, revoking the authorization of a network slice. The figure shows the steps involved in the revocation process, including the initiation of the revocation, the communication between the Diameter server and the network slice, and the response from the network slice. The figure provides a clear and concise representation of the process, making it easy to understand the steps involved in revoking network slice authorization.\nFigure 17.2.2-1: NSS-AAA initiated revocation of network slice authorization with Diameter\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.3\tNSS-AAA initiated re-authentication and re-authorization",
                            "text_content": "The NSS-AAA server may send a Diameter RAR message to the NSSAAF directly or via AAA-P (if AAA-P is used) asking for re-authentication and re-authorization. On receipt of the RAR message from the NSS-AAA server, the NSSAAF shall check whether the NSS-AAA server is authorized to request the re-authentication and re-authorization by verifying the local configuration of the address of the NSS-AAA server per S-NSSAI, if successful, the NSSAAF shall interact with its succeeding Network Function AMF which is got from the UDM by Nudm_UECM_GET service operation with GPSI and reply with a Diameter RAA message. It is not necessary for the NSSAAF to wait for the response (i.e. Nudm_UECM_GET or Nnssaaf_NSSAA_Notify response) from its succeeding Network Function before sending the RAA message to the NSS-AAA server or AAA-P.\nNOTE:\tIn the Diameter RAR request, the Origin-Host AVP with the FQDN/domain format indicates the address of the NSS-AAA server for NSSAAF check.\nAfter replying Nnssaaf_NSSAA_Notify response, the AMF shall start authentication and authorization procedure as described in clause 17.2.1. The Auth-Request-Type in the DER is set to \"AUTHORIZE_AUTHENTICATE\".\nFigure 17.2.3-1 is an example message flow to show the procedure of NSS-AAA initiated re-authentication and re-authorization. If the AAA-P is not used, the RAR and RAA messages are exchanged between the NSS-AAA and the NSSAAF.\nThe figure depicts a network setup with multiple network service providers (NSSs) and Authentication, Authorization, and Accounting (AAA) services. It shows the initiation of re-authentication and re-authorization processes, which are initiated by the NSSs and AAA services, respectively. The figure also includes Diameter, a protocol used for network service discovery and authentication, as well as the network's topology, which includes multiple network service providers, network service requests, and network service responses.\nFigure 17.2.3-1: NSS-AAA initiated re-authentication and re-authorization with Diameter\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17.3\tSpecific AVPs",
                    "description": "",
                    "summary": "",
                    "text_content": "There is no specific AVP defined in the present release.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "17.4\tre-used AVPs",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.4.1\tGeneral",
                            "text_content": "Information defined in clause 12.4.0 are re-used for network slice specific authentication with the following differences:\n-\tNSSAAF replaces SMF.\n-\tIP, Ethernet and PDU session related descriptions and AVPs are not applicable.\n-\tAdditional detailed information needed for network slice specific authentication are described below.\nTable 17.4-1: Additional information needed for network slice specific authentication\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 17.4-1: Additional information needed for network slice specific authentication",
                                    "table number": 40,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "17.4.2\tUse of the Supported-Features AVP",
                            "text_content": "The Supported-Features AVP is used during the network slice specific authentication procedure to inform the destination host about the required and optional features that the origin host supports. The client shall, in the first request in a Diameter session indicate the set of supported features. The server shall, in the first answer within the Diameter session indicate the set of features that it has in common with the client and that the server shall support within the same Diameter session. Any further command messages shall always be compliant with the list of supported features indicated in the Supported-Features AVPs during session establishment. Features that are not advertised as supported shall not be used to construct the command messages for that Diameter session. Unless otherwise stated, the use of the Supported-Features AVP shall be compliant with the requirements for dynamic discovery of supported features and associated error handling on the Cx reference point as defined in clause 7.2.1 of 3GPP TS 29.229 [41].\nThe base functionality is the 3GPP Rel-16 standard and a feature is an extension to that functionality. If the origin host does not support any features beyond the base functionality, the Supported-Features AVP may be absent in the DER command. As defined in clause 7.1.1 of 3GPP TS 29.229 [41], when extending the application by adding new AVPs for a feature, the new AVPs shall have the M bit cleared and the AVP shall not be defined mandatory in the command ABNF.\nAs defined in 3GPP TS 29.229 [41], the Supported-Features AVP is of type grouped and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. The Supported-Features AVP is used to identify features that have been defined by 3GPP and hence, for features defined in this document, the Vendor-Id AVP shall contain the vendor ID of 3GPP (10415). If there are multiple feature lists defined, the Feature-List-ID AVP shall differentiate those lists from one another.\nOn receiving an initial request application message, the destination host shall act as defined in clause 7.2.1 of 3GPP TS 29.229 [41].\nOnce the NSSAAF or AAA-P and NSS-AAA have negotiated the set of supported features during session establishment, the set of common features shall be used during the lifetime of the Diameter session.\nThe table below defines the features applicable for the network slice specific authentication, for the feature lists with a Feature-List-ID of 1.\nTable 17.4.2-1: Features of Feature-List-ID 1\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 17.4.2-1: Features of Feature-List-ID 1",
                                    "table number": 41,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "17.5\tSpecific Experimental-Result-Code AVP",
                    "description": "",
                    "summary": "",
                    "text_content": "There is no specific experimental result code AVP defined in the present release.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "17.6\tDiameter messages",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.6.1\tGeneral",
                            "text_content": "Diameter messages as defined in clause 12.6 are re-used for network slice specific authentication with the following differences:\n-\tNSSAAF or AAA-P replaces SMF.\n-\tIP, Ethernet and PDU session related descriptions and AVPs are not applicable.\n-\tDiameter commands for accounting function (ACR and ACA) are not applicable.\n-\tAAR and AAA commands are not applicable.\n-\t3GPP-S-NSSAI is included in the DER command.\n-\tthe address of NSS-AAA server is included in the Origin-Host AVP in the ASR and RAR command\nNOTE:\tThe presence of 3GPP-S-NSSAI in the DER command is optional but it is mandatory for the NSSAAF or AAA-P to include it for the network slice specific authentication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "18\tInterworking with DN (L2TP tunnel)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "18.1\tSupport L2TP for CUPS across N6",
                    "description": "",
                    "summary": "",
                    "text_content": "L2TP (described in IETF RFC 2661 [57]) is a standard method for tunneling encapsulated Point-to-Point Protocol (PPP) frames over an IP network. L2TP operates between two L2TP endpoints (LAC and LNS), and tunnels PPP-encapsulated IP traffic between these endpoints. L2TP runs over UDP/IP and was originally defined for systems where PPP is used by an end-device to connect to a network (e.g. via DSL connections, or 2G/3G PPP PDP context). In these cases, a LAC could be deployed in the network (e.g. in a BNG or GGSN/PGW) to tunnel the PPP traffic to a server (LNS) over an IP network.\nFor 5GC with the UE using IP PDU Session, the PPP functionality that is required to use L2TP is instead supported by the UPF or UPF+PGW-U, as illustrated in below figure. Upon receiving a PDU Session/PDN Connection establishment request from the UE via AMF or MME, SMF or SMF+PGW-C may depend on local L2TP configuration per DNN or the received L2TP information from a DN AAA server in Access-Accept message, request the UPF or UPF+PGW-U to setup L2TP tunnel towards an L2TP network server (LNS) in the external DN and tunnel the PDU Session user plane traffic in this L2TP tunnel. In this case the UPF or UPF+PGW-U acts as a L2TP access concentrator (LAC).\nTo enable this, the SMF or SMF+PGW-C may provide L2TP information to the UPF or UPF+PGW-U as LAC, such as LNS IP address or FQDN, as described in 3GPP TS 29.244 [58]. This L2TP information may be configured on the SMF or SMF+PGW-C as part of the DNN configuration or received from the DN-AAA server. Alternatively, the L2TP tunnel parameters may be configured in the UPF or UPF+PGW-U. The L2TP tunnel parameters include necessary parameters for setting up L2TP tunnel towards the LNS (e.g. LNS address, tunnel password).\nIn addition, the SMF or SMF+PGW-C may provide PAP/CHAP authentication information to the UPF or UPF+PGW-U, for use in L2TP session establishment, in case it was received from the UE in the ePCO IE of the PDU Session Establishment Request.\nWhen L2TP is to be used for a PDU Session, the SMF or SMF+PGW-C may select a UPF or UPF+PGW-U and requests the UE IP address to be allocated by LNS according to 3GPP TS 29.244 [58], the UPF (LAC) may retrieve this IP address from the LNS.\nThe figure depicts a L2TP tunnel between a 5G Core (5GC) and an external DN (Network Device). The tunnel is designed to provide secure communication between the two networks, ensuring data confidentiality and integrity. The tunnel is equipped with redundant paths to ensure failover reliability in case of network failures.\nFigure 18.1-1: L2TP Tunnel between 5GC and external DN\nBelow figure describes the L2TP connection procedures between 5GC and external DN, upon the UE is accessed in 5GC and the SMF or SMF+PGW-C and UPF or UPF+PGW-U has been negotiated supporting L2TP feature.\n\nFigure 18.1-2: L2TP connection procedures between 5GC and external DN\n0.\tThe SMF or SMF+PGW-C and the UPF or UPF+PGW-U negotiated supporting L2TP feature as specified in 3GPP TS 29.244 [114].\n1.\tThe SMF or SMF+PGW-C receives a PDU Session or PDN Connection establishment request from the UE via AMF or MME and SGW.\nThe UE may include the authentication information for PAP and/or CHAP in ePCO IE. The SMF or SMF+PGW-C may locally configure the UE authentication information for a given DNN.\nThe SMF or SMF+PGW-C may determine that an L2TP session is required for the PDU Session based on local configured L2TP parameters per DNN.\n2.\tThe SMF or SMF+PGW-C may receive the L2TP Tunnel parameters (e.g. LNS IP address or FQDN, tunnel password) from the DN-AAA server in Access-Accept message or Diameter AAA message, or local configured.\nNOTE:\tIf EAP based secondary authentication is used (e.g. DER/DEA), L2TP Proxy Authenticate Extensions for EAP is not supported in this release of the specification.\n3.\tIf L2TP protocol is determined to support the PDU Session, the SMF or SMF+PGW-C selects a UPF or UPF+PGW-U supporting L2TP and be configured with the LAC name/addresses and then requests the UPF or UPF+PGW-U to setup an L2TP tunnel if needed and/or L2TP session towards the L2TP network server (LNS).\nThe SMF or SMF+PGW-C sends PFCP Session Establishment Request to the UPF or UPF+PGW-U, which may include L2TP Tunnel Information for setting up a L2TP tunnel and L2TP session information to setup a L2TP session, together with the information for authentication used during L2TP Tunnel setup, as well as for L2TP session.\nThe L2TP Tunnel Information includes LNS IPv4 address or IPv6 address of LNS, Tunnel Password.\nThe L2TP Session Information includes specific information related to the PDU Session, e.g. a Calling Number which may be set to UE's GPSI, an indication to instruct that the UPF or UPF+PGW-U shall request the LNS to allocate an IP address for the PDU Session, indications to instruct that the UPF or UPF+PGW-U shall request the LNS to provide DNS server addresses or NBNS server addresses etc. as specified in 3GPP TS 29.244 [114].\n4.\tThe UPF or UPF+PGW-U checks if any existing L2TP tunnel can be used to serve the PDU Session according to the information provided in the L2TP Tunnel Information.\nIf the UPF or UPF+PGW-U decides to setup a new L2TP tunnel, it initiates L2TP Tunnel establishment by sending an SCCRQ (Start-Control-Connection-Request) message towards the LNS, the UPF or UPF+PGW-U will allocate a Tunnel ID, and it may include a CHAP Challenge to authenticate the LNS. The Challenge and Challenge Response (to be included in SCCCN) is produced by the UPF or UPF+PGW-U using the Tunnel Password received from the SMF or SMF+PGW-C.\nThe LNS responds with an SCCRP (Start-Control-Connection-Reply) message, containing its allocated Tunnel ID and a CHAP Challenge Response to the Challenge in SCCRQ.\nThe UPF or UPF+PGW-U then responds with a Challenge response for tunnel authentication in the SCCCN (Start-Control-Connection-Connected) message. An L2TP tunnel is established after the tunnel authentication is successful, with the reception of the SCCCN message sent by the LAC to the LNS.\nIf the UPF or UPF+PGW-U decides to use an already existing L2TP tunnel for the requested PDU Session from the UPF or UPF+PGW-C, it proceeds with step 5 below directly without current step.\n5.\tIf the L2TP tunnel is not successfully established, then the UPF or UPF+PGW-U may respond to the SMF or SMF+PGW-C  with PFCP Session Establishment Response with error cause IE value set to either 87 or 89 as specified in clause 8.2.1 of TS 29.244 [114]. The SMF, SMF+PGW-C may decide how to handle the failure associated with the received cause code based on local policy and/or O&M procedures.\n6.\tSMF or SMF+PGW-C may reject the PDU Session/PDN Connection Establishment Request according to step 5.\n7.\tOnce the L2TP Tunnel is established (or already present) between the LAC and the LNS for the PDU Session/PDN Connection requested by the UE, the UPF or UPF+PGW-U proceeds with L2TP session setup towards the LNS.\nThe UPF or UPF+PGW-U sends an ICRQ (Incoming-Call-Request) message towards the LNS, which contains the Tunnel ID assigned by the LNS, its assigned Session ID, and optionally, the Calling Number and Called Number. The LNS responds with an ICRP (Incoming-Call-Reply) message and provides the Session ID assigned by it to the LAC.\nThe LAC then sends an ICCN (Incoming-Call-Connected) message. If proxy LCP and authentication are employed, the ICCN message includes link control parameters (e.g. MRU) and the UE authentication information sent from the SMF or SMF+PGW-C which was received via ePCO IE in step 1. In addition, the UPF or UPF+PGW-U (LAC) will act as a PPP endpoint to use IPCP to request UE IP Address, DNS server address and/or NBNS server address(es).\nThe LCP renegotiation may by triggered by the LNS after receiving the ICCN message. If so, the LAC and LNS will use PPP LCP to communicate link specific control parameter, and indicate authentication type, then either PPP PAP/CHAP takes place. The PPP IPCP transactions takes places to retrieve UE IP Address, DNS server address and/or NBNS server address.\n8.\tThe status of the L2TP session setup is sent by the UPF or UPF+PGW-U to the SMF or SMF+PGW-C  in a PFCP Session Establishment Response.\n9.\tThe SMF or SMF+PGW-C sends a PDU Session Establishment Response to the UE and the user data session is initiated, which may contain the DNS and NBNS Server information.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "19\tInterworking with Credentials Holder using AAA server",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "19.1\tCredentials Holder using AAA server for primary authentication and authorization",
                    "description": "",
                    "summary": "",
                    "text_content": "The AUSF and the UDM in SNPN may support primary authentication and authorization of UEs using credentials from an AAA Server in a Credentials Holder (CH).\n-\tUpon the UDM decides that the primary authentication is performed by AAA Server with credentials holder and inform the AUSF that primary authentication by a AAA server in a CH is required, the AUSF shall discover and select the NSSAAF, and then forward EAP messages to the NSSAAF.\n-\tThe NSSAAF selects AAA Server based on the domain name corresponds to the realm part of the SUPI, relays EAP messages between AUSF and AAA Server (or AAA proxy) and performs related protocol conversion. The AAA server acts as the EAP Server for the purpose of primary authentication.\nNOTE:\tThe UDM in SNPN, based on SLA between Credentials Holder and SNPN, is pre-configured with information indicating whether the UE needs primary authentication from AAA server.\n5G System architecture with access to SNPN using credentials from Credentials Holder using AAA Server and related functions are defined in clause 5.30.2.9 of 3GPP TS 23.501 [2].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "19.2\tCredentials Holder using AAA server for primary authentication procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures described in this clause enables UEs to access an SNPN which makes use of a credential management system managed by a credential provider external to the SNPN.\nIn this scenario the authentication server role is taken by the AAA Server. The AUSF acts as EAP authenticator and interacts with the AAA Server to execute the primary authentication procedure.\nFigure 19.2-1: Primary authentication with external domain\nThe detail procedures description is defined in clause I.2.2.2 of 3GPP TS 33.501 [59].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "20\tInterworking with MBS Application Provider (AF/AS)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "20.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "For MBS user plane, the MB-UPF is used for interworking with the MBS AF/AS (i.e. MBS Application Provider) either directly via the N6mb reference point or via the MBSTF. In the latter case, the MB-UPF is interworking with the MBSTF via the Nmb9 reference point and the MBSTF is interworking with the MBS AF/AS via the Nmb8 reference point.\nFor MBS Group Message Delivery user plane, the MB-UPF is used for interworking with the NEF via the MBSTF. The MB-UPF is interworking with the MBSTF via the Nmb9 reference point and the MBSTF is interworking with the NEF (which plays the role of the MBS AF/AS) via the Nmb14 reference point.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "20.2\tMBS interworking user plane reference point architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure 20.2-1 depicts the reference point representation of the MBS user plane interworking architecture.\nThe figure depicts the user plane interworking architecture of a 5G network, illustrating the reference point representation of the MBS user plane. It shows the various components such as the base station (gNB), user equipment (UE), and scatterers, highlighting the importance of beamforming techniques to mitigate interference.\nFigure 20.2-1: MBS user plane interworking architecture – Reference point representation\nNOTE 1:\tFrom functionality point of view, Nmb9 and N6mb are identical, as specified in 3GPP TS 23.247 [60].\nFor MBS group message delivery, the NEF (playing the role of an MBS AF/AS) shall be responsible for user plane delivery of MBS group message content to the MBSTF over the Nmb14 interface, as specified in clauses 6.15 and 7.5 of 3GPP TS 23.247 [60].\nWhen MBS is used to support VAL services provisioning as specified in clauses 14.2.2.1 and 14.3.4A of 3GPP TS 23.434 [63], the SEAL NRM Server shall play the role of the MBS AF/AS for MBS user plane management over the Nmb8 and Nmb9 interfaces or the N6mb interface.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "20.3\tUser Plane Protocol between MB-UPF and MBS AF/AS or MBSTF",
                    "description": "",
                    "summary": "",
                    "text_content": "The MBS user plane interworking protocol stack in the case of shared MBS delivery is described in Figure 20.3-1 and Figure 20.3-2. In Figure 20.3-1, the UDP tunnel applies to N6mb and Nmb9, while in Figure 20.3-2, the plain IP multicast applies to N6mb.\nThe figure depicts a user plane protocol stack for N6mb/Nmb9, which is a UDP tunnel used for network management and control. The stack includes various components such as the user plane protocol (UPP), network management protocol (NMP), and network management control (NMC), all of which are essential for managing and controlling network operations. The diagram illustrates the flow of data between the user plane and the network management control plane, ensuring efficient communication and coordination.\nFigure 20.3-1: User Plane Protocol Stack for N6mb/Nmb9 (UDP Tunnel)\nThe figure depicts a user plane protocol stack for N6mb, a multicast protocol used in 5G networks. It illustrates the various components and their interactions, including the user plane, network plane, and control plane. The stack includes the user plane protocol, which defines the user plane interface, and the network plane protocol, which defines the network plane interface. The control plane protocol is also included, which manages the network plane and user plane interfaces. The figure provides a clear and concise representation of the N6mb protocol stack, making it easier to understand and interpret.\nFigure 20.3-2: User Plane Protocol Stack for N6mb (plain IP multicast)\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "20.4\tUser Plane Protocol between MBSTF and MBS AF/AS or NEF",
                    "description": "",
                    "summary": "",
                    "text_content": "The MBS user plane interworking protocol stack used over the Nmb8 reference point is described in Figure 20.4-1 for the case of TCP/IP for the Object Distribution Method, and in Figure 20.4-2 for the case of UDP/IP for the Packet Distribution Method with Proxy mode or Forward-only mode . The MBS user plane interworking protocol stack over the Nmb14 reference point shall be the same as the MBS user plane interworking protocol stack over the Nmb8 interface described in Figures 20.4-1 and 20.4-2 with the NEF playing the role of the AF/AS.\n\n\nFigure 20.4-1: User Plane Protocol Stack for Nmb8/Nmb14 used in Object Distribution Method\n\n\nFigure 20.4-2: User Plane Protocol Stack for Nmb8/Nmb14 used in Packet Distribution Method with Proxy mode or Forward-only mode\nNOTE:\tFor more details, refer to Annex B of 3GPP TS 26.502 [61].\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "21\tInterworking with AAA server in DCS for UE onboarding in SNPNs",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "21.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE configured with Default UE credentials shall consist of the credentials for primary authentication and may optionally consist of the credentials for secondary authentication, may register with an ON-SNPN for the provisioning of SO-SNPN credentials, for the purpose of provisioning the UE with SNPN credentials for primary authentication and other information to enable access to a desired SNPN, i.e. (re-)select and (re-)register with SNPN.\nThe architectures for Onboarding of UEs in an ON-SNPN are defined in clause 5.30.2.10.2. of 3GPP TS 23.501 [2].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.1\tPrimary authentication using AAA server in DCS",
                    "description": "",
                    "summary": "",
                    "text_content": "The AUSF in SNPN may support primary authentication and authorization of UEs using default UE credentials meant only for primary authentication from a Default Credentials Server (DCS) for Onboarding of UEs in an ON-SNPN. In case of primary authentication and authorization with an AAA server in DCS the procedures defined in clause 19.1 and clause 19.2 shall apply with the AAA server in DCS taking the role of the AAA server in a CH. When AAA server in DCS is used for primary authentication, the AUSF directly selects the NSSAAF as specified in 3GPP TS 23.501 [2]. In this case, the UDM is not involved in the procedure defined in Figure 19.2-1, and the step 3 to step 5 shall be skipped.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.2\tSecondary authentication using AAA server in DCS",
                    "description": "",
                    "summary": "",
                    "text_content": "The SMF in SNPN may support secondary authentication with a Default Credentials Server (DCS) using default UE credentials meant only for secondary authentication upon establishment of an Onboarding PDU Session when the UE has registered successfully with primary authentication without using DCS. In case of secondary authentication with AAA server in DCS the procedures defined in clause 11 and clause 12 shall apply with the AAA server in DCS taking the role of the DN-AAA server. When AAA server in DCS is used for secondary authentication, the SMF selects the AAA server based on its configuration or using the DN-specific identity provided by the UE inside the EAP message in the PDU Session Authentication Complete message as specified in 3GPP TS 33.501 [8].\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.1\tGeneral",
            "description": "The present annex defines specific requirements for rate control related to 5G CIoT optimisations.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.2\tSupport of rate control of user data",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The rate of user data sent to and from a UE (e.g. a UE using 5G CIoT Optimizations) can be controlled in two different ways:\n-\tServing PLMN rate control\n-\tSmall data rate control\nServing PLMN rate control is further described in 3GPP TS 23.501 [2].\nSmall data rate control allows HPLMN operators on per user to control the amount of user data sent DL and UL.\nThis is done with help of policing user data on a maximum number of user data packets per time unit both DL and UL. Small data DL rate control policing is done in the UPF or the NEF and the small data UL rate control policing is done in the UE. The UPF or NEF can also do small data UL rate control policing.\nFor further information on small data rate control in the UE, see 3GPP TS 24.501 [42].\nNOTE 1:\tExisting Session-AMBR mechanisms are not suitable for such a service since, for radio efficiency and UE battery life reasons, an AMBR of e.g. > 100kbit/s is desirable and such an AMBR translates to a potentially large daily data volume.\nNOTE 2:\tFor serving PLMN rate control and small data rate control, whether the UPF or the NEF is used for data policing depends on the CIoT Optimizations mode that UE and network support (CP or UP Optimizations) and the UE subscription data.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.2.2\tSmall Data Rate Control",
                    "description": "",
                    "summary": "",
                    "text_content": "The small data rate control is configured in the (H-)SMF.\nThe small data rate control parameters, if configured, shall consist of:\n-\tthe maximum number of DL user data packets per time unit,\n-\tthe maximum number of UL user data packets per time unit, and\n-\tthe maximum number of additional UL exception reports per time unit.\nPossible time units shall be, minute, hour, day or week.\nIf the small data rate control is supported by the UE as indicated in the Extended Protocol Configuration Options (ePCO) IE included in the PDU session establishment request and if the (H-)SMF is configured to use small data rate control, the (H-)SMF shall include the configured small data UL rate control parameters in the ePCO IE of the PDU session establishment reply, and send the configured small data DL rate control parameters and optionally the UL rate control parameters to the UPF or the NEF. The small data rate control parameters sent to UE, UPF or NEF may include a remaining small data rate control with validity time information that shall be applied first before applying the configured small data rate control parameters.\nNOTE 1:\tThe (H-)SMF can receive small data rate control parameters from the AMF.\nSee 3GPP TS 24.501 [42] for ePCO IE definition.\nIf the small data UL rate control parameters are modified, the (H-)SMF shall initiate a PDU session modification procedure and include the small data UL rate control parameters in the ePCO IE. The (H-)SMF may also send the updated small data UL rate control parameters to the UPF or the NEF.\nIf the small data DL rate control parameters are modified, the (H-)SMF shall send the updated small data DL rate control parameters to the UPF or the NEF.\nThe UPF or the NEF shall enforce the small data DL rate control and may enforce the small data UL rate control per UE.\nNOTE 2:\tThe UE locally enforces this uplink small data rate control instruction. The UE considers this small data rate control instruction as valid until it receives a new one from the (H-)SMF.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.2.3\tServing PLMN Rate Control information handling",
                    "description": "",
                    "summary": "",
                    "text_content": "The serving PLMN rate control is configured in the (V-)SMF and it applies per PDU session.\nThis rate control is operator configurable and expressed as \"X NAS Data PDUs per deci hour\" where X is an integer that shall not be less than 10. There are separate limits for uplink and downlink NAS Data PDUs:\nIf serving PLMN rate control information is received from the SMF, the UPF or the NEF shall store this information and use that for DL rate control enforcement for this UE.\nThe UE shall enforce the serving PLMN UL rate control based on the rate control information received from the (V-)SMF.\nThe (V-)SMF may also enforce the serving PLMN UL and/or DL rate control.\nIf the UPF or the NEF previously have received Serving PLMN rate control information, it shall behave as follows:\n-\tIf the UPF or the NEF receives new Serving PLMN rate control information from the SMF, it shall replace the old Serving PLMN rate control information with the new Serving PLMN rate control information and use that for DL rate control enforcement for this UE.\n-\tIf the UPF or the NEF receives no Serving PLMN rate control information from the SMF, it shall still consider the latest received Serving PLMN rate control information from the SMF as valid.\n-\tIf UPF or the NEF receives an indication that Serving PLMN rate control does not apply from the SMF, it shall remove the rate control information based on Serving PLMN rate control information.\nSmall data rate control, if configured, also applies for the same PDU session, see clause A.2.2.\n\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 42,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}