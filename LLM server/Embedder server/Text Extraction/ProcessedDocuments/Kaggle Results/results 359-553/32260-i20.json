{
    "document_name": "32260-i20.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document is part of a series of Technical Specifications (TSs) that specify charging functionality and charging management in 3GPP networks. The 3GPP core network charging architecture and principles are specified in document TS 32.240 [1], which provides an umbrella for other charging management documents that specify:\n-\tthe content of the CDRs per domain and subsystem (offline charging),\n-\tthe content of real-time charging events per domain / subsystem (online charging);\n-\tthe functionality of online and offline charging for those domains and subsystems;\n-\tthe interfaces that are used in the charging framework to transfer the charging information (i.e. CDRs or charging events).\nThe complete document structure for these TSs is defined in TS 32.240 [1].\nThe present document specifies the offline, online and converged charging description for the IP Multimedia Subsystem (IMS), based on the functional descriptions of the IMS in TS 23.228 [200]. This charging description includes the offline, online and converged charging architecture and scenarios specific to IMS, as well as the mapping of common 3GPP charging architecture specified in TS 32.240 [1] onto IMS. It further specifies the structure and content of the CDRs and the charging events. The present document is related to other 3GPP charging TSs as follows:\n-\tThe common 3GPP charging architecture is specified in TS 32.240 [1];\n-\tThe parameters, abstract syntax and encoding rules for these CDR types are specified in TS 32.298 [51].\n-\tA transaction based mechanism for the transfer of CDRs within the network is specified in TS 32.295 [54].\n-\tThe file based mechanism used to transfer the CDRs from the network to the operator's billing domain (e.g. the billing system or a mediation device) is specified in TS 32.297 [52].\n-\tThe 3GPP Diameter application that is used for IMS offline and online charging is specified in TS 32.299 [50].\n-\tThe services, operations and procedures of charging, using Service Based Interface are specified in TS 32.290 [45].\n-\tThe charging service of 5G system is specified in TS 32.291 [46].\nFurthermore, requirements that govern the charging work are specified in TS 22.115 [101].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions, which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies.  In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TS 32.240: \"Telecommunication management; Charging management; Charging architecture and principles\".\n[2]\tVoid.\n[3] - [10]\tVoid.\n[11]\t3GPP TS 32.251: \"Telecommunication management; Charging management; Packet Switched (PS) domain charging\".\n[12] - [34]\tVoid.\n[35]\t3GPP TS 32.275: \"Telecommunication management; Charging management; MultiMedia Telephony (MMTel) charging\".\n[36] \t3GPP TS 32.276: \"Telecommunication management; Charging management; Voice Call Service (VCS) charging\".\n[37] - [39]\tVoid.\n[40] \t3GPP TS 32.280: \"Telecommunication management; Charging management; Advice of Charge (AoC) service\".\n[41] \t3GPP TS 32.281: \"Telecommunication management; Charging management; Announcement service\".\n[42] - [44]\tVoid.\n[45]\t3GPP TS 32.290: \"Telecommunication management; Charging management; 5G system; Services, operations and procedures of charging using Service Based Interface (SBI)\".\n[46]\t3GPP TS 32.291: \"Telecommunication management; Charging management; 5G system; Charging service, stage 3\".\n[47] - [49]\tVoid.\n[50]\t3GPP TS 32.299: \"Telecommunication management; Charging management; Diameter charging application\".\n[51]\t3GPP TS 32.298: \"Telecommunication management; Charging management; Charging Data Record (CDR) parameter description\".\n[52]\t3GPP TS 32.297: \"Telecommunication management; Charging management; Charging Data Records (CDR) file format and transfer\".\n[53]\tVoid.\n[54]\t3GPP TS 32.295: \"Telecommunication management; Charging management; Charging Data Record (CDR) transfer\".\n[55] - [99]\tVoid.\n[100]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[101]\t3GPP TS 22.115: \"Service aspects; Charging and billing\".\n[102]\tVoid.\n[103]\t3GPP TS 23.002: \"Network architecture\".\n[104]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[105] - [199]\tVoid.\n[200]\t3GPP TS 22.228: \"Service requirements for the Internet Protocol (IP) multimedia core network subsystem (IMS); Stage 1\".\n[201]\t3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".\n[202]\t3GPP TS 24.228: \"Signalling flows for the IP multimedia call control based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[203]\t3GPP TS 23.218: \"IP Multimedia (IM) session handling; IM call model; Stage 2\".\n[204]\t3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[205]\t3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter protocol; Protocol details\".\n[206]\t3GPP TS 29.658: \"SIP Transfer of IP Multimedia Service Tariff Information; Protocol specification\".\n[207]\t3GPP TS 33.203: \"3G security; Access security for IP-based services\".\n[208]\t3GPP TS 33.210: \"3G security; Network Domain Security (NDS); IP network layer security\".\n[209]\t3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework (AF)\".\n[210]\t3GPP TS 24.292: \"IP Multimedia (IM) Core Network (CN) subsystem Centralized Services (ICS); Stage 3\".\n[211]\t3GPP TS 29.079: \"Optimal media routeing within the IP Multimedia Subsystem (IMS); Stage 3\".\n[212] \t3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".\n[213]\t3GPP TS 23.203: \"Policy and charging control architecture\".\n[214]\t3GPP TS 29.214: \"Policy and charging control over Rx reference point\".\n[215]\t3GPP TS 29.328: \"IP Multimedia (IM) Subsystem Sh Interface; Signalling flows and message contents\".\n[216] \t3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage 2\".\n[217]\t3GPP TS 24.237: \"IP Multimedia (IM) Core Network (CN) subsystem IP Multimedia Subsystem (IMS) service continuity; Stage 3\".\n[218]\t3GPP TS 24.337: \"IP Multimedia Subsystem (IMS) inter-UE transfer; Stage 3\".\n[219]\t3GPP TS 23.292: \"IP Multimedia Subsystem (IMS) centralized services; Stage 2\".\n[220]\t3GPP TS 24.628: \"Common Basic Communication procedures using IP Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".\n[221]\t3GPP TS 23.503:\"Policy and Charging Control Framework for the 5G System; Stage 2\".\n[222]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[223]\t3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia Telephony; Media handling and interaction\".\n[224] – [299]\tVoid.\n[300] - [399]\tVoid.\n[400]\tVoid.\n[401]\tVoid.\n[402]\tIETF RFC 4006 (2005): \"Diameter Credit-Control Application\".\n[403]\tIETF RFC 2806 (2000): \"URLs for Telephone Calls\".\n[404]\tIETF RFC 3261 (2002): \"SIP: Session Initiation Protocol\".\n[405]\tIETF RFC 2486 (1999): \"The Network Access Identifier\".\n[406]\tIETF RFC 7315 (2014): \"Private Header (P-Header) Extensions to the Session Initiation Protocol (SIP) for the 3rd-Generation Partnership Project (3GPP)\".\n[407]\tVoid.\n[408]\tVoid.\n\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following terms and definitions given in TR 21.905 [100] and TS 32.240 [1] apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [100].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tSymbols",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following symbols apply:\nBi\tReference point for the CDR file transfer from the IMS CGF to the BD.\nGa\tReference point for CDR transfer between a CDF and CGF.\nNchf\tService based interface exhibited by CHF.\nN45\tReference point between IMS Node and the CHF.\nRf\tOffline Charging Reference Point between an IMS Network Entity or an AS and CDF\nRo\tOnline Charging Reference Point between an AS or MRFC and IMS-GWF and the OCS\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.3\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in TR 21.905 [100] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [100].\n5GS\t5G System\nABNF\tAugmented Backus-Naur Form\nACA\tAccounting-Answer\nACR\tAccounting-Request\nAS\tApplication Server\nATCF\tAccess Transfer Control Function\nATGW\tAccess Transfer Gateway\nAVP\tAttribute Value Pair\nB2BUA\tBack-to-Back User Agent\nBGCF\tBreakout Gateway Control Function\nBS\tBilling System\nCCA\tCredit-Control-Answer\nCCF\tCharging Collection Function\nCCR\tCredit-Control-Request\nCDF\tCharging Data Function\nCDIV\tCommunication Diversion\nCDR\tCharging Data Record\nCGF\tCharging Gateway Function\nCHF\tCharging Function\nCONF\tConference\nCPCF\tContent Provider Charging Function\nCSCF\tCall Session Control Function (I-Interrogating; P-Proxy; and S-Serving)\nEATF\tEmergency Access Transfer Function\nECF\tEvent Charging Function\nECUR\tEvent Charging with Unit Reservation\nIBCF\tInterconnect Border Control Function\nIEC\tImmediate Event Charging\nIMS\tIP Multimedia Subsystem\nIMS-AGW\tIMS Access Media Gateway\nIMS-ALG\tIMS - Application Level Gateway\nIMS-GWF\tIMS Gateway Function\nIOI\tInter Operator Identifier\nISC\tIMS Service Control\nLBO\tLocal Break Out\nMGCF\tMedia Gateway Control Function\nMMTel\tMultiMedia Telephony\nMRFC\tMedia Resource Function Controller\nNNI\tNetwork to Network Interface\nMRFP\tMultimedia Resource Function Processor\nNCGI\tNR Cell Global Identity\nNCI\tNR Cell Identity\nNetLoc\tNetwork provided Location informationNR\tNew Radio\nOCS\tOnline Charging System\nOMR\tOptimal Media Routing\nPCRF\tPolicy and Charging Rules Function\nPCF\tPolicy Control Function\nRTTI\tReal-time Transfer of Tariff Information\nSCCF\tSubscriber Content Charging Function\nSCUR\tSession Charging with Unit Reservation\nSDP\tSession Description Protocol\nSMF\tSession Management Function\nSIP\tSession Initiation Protocol\nTF\tTransit Functions\nTIP\tTerminating Identity Presentation\nTIR\tTerminating Identity Restriction\nTRF\tTransit and Roaming Function\nTrGW\tTransition GateWay\nUA\tUser Agent\nUE\tUser Equipment\nVCC\tVoice Call Continuity\nVCS\tVoice Call Service\nVDN\tVCC Domain transfer Number\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tArchitecture considerations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tHigh level IMS architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure 4.1.1 depicts the logical IMS architecture, as described in TS 23.002 [103]\nThe IMS logical architecture, depicted in Figure 4.1.1, is a crucial component of the 5G network. It is designed to efficiently manage and distribute data across the network, ensuring high-speed and reliable communication. The architecture includes multiple layers, including the core switches, optical line terminals (OLTs), and distributed nodes, which work together to provide a robust and scalable network infrastructure.\nFigure 4.1.1: IMS logical architecture\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tIMS offline charging architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "The architecture for IMS offline charging is described in the following figure 4.2.1. The Rf interface is described in clause 6.1.1 and Bi in clause 6.1.2.\nThe IMS offline charging architecture depicted in Figure 4.2.1 illustrates the offline charging process for mobile devices, with a focus on the charging infrastructure and its components. The architecture includes a charging station (CS), a charging station controller (CS-C), and a charging station management system (CS-MS). The CS-C manages the charging process, ensuring that the charging station is operational and that the devices are charged. The CS-MS manages the charging station infrastructure, including the charging station equipment and the charging station network. The CS-MS also manages the charging station management system, ensuring that the charging station is operational and that the devices are charged. The CS-MS manages the charging station infrastructure, including the charging station equipment and the charging station network. The CS-MS also manages the charging station management system, ensuring that the charging station is operational and that the devices are charged. The CS-MS manages the charging station infrastructure, including the charging station equipment and the charging station network. The CS-MS also manages the charging station infrastructure, including the charging station equipment and the charging station network. The CS-MS also manages the charging station infrastructure, including the charging station equipment and the charging station network. The CS-MS also manages the charging station infrastructure\nFigure 4.2.1: IMS offline charging architecture\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.3\tIMS online charging architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "The architecture for IMS online charging is described in the following figure 4.3.1. The Ro interface is described in clause 6.2 and ISC in TS 23.228 [201].\n\nThe figure depicts an IMS online charging architecture, illustrating the various components and their interconnections. The diagram includes a base station (BS), a user equipment (UE), and a charging station (CS). The BS and CS are connected via a charging line, while the UE is connected to the BS via a charging port. The diagram also shows the presence of a charging station controller (SC), which manages the charging process and ensures the proper functioning of the system. The architecture is designed to support multiple charging modes, including direct and indirect charging, and is equipped with redundancy to ensure fault tolerance.\nFigure 4.3.1: IMS online charging architecture\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.4\tIMS converged charging architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "The architectural options for IMS converged charging are depicted in figure 4.4.1 in service-based representation for CHF:\nThe IMS converged charging architecture, depicted in Figure 4.1, is a comprehensive solution for charging electric vehicles (EVs) in a converged network. It combines various charging technologies, such as DC fast charging, DC fast charging, and DC fast charging, to provide a seamless and efficient charging experience for EVs. The architecture is designed to optimize energy consumption and reduce the environmental impact of charging EVs.\nFigure 44.1: IMS converged charging architecture\nIn this architecture, IMS nodes, CHF, CGF and corresponding Billing domain are located in the same PLMN.\nThe IMS Nodes for which this architecture applies are the MRFC, IMS-GWF (connected to S-CSCF using ISC) and SIP AS, the architecture for MMTel AS is described in TS 32.275 [35]. In addition the MRFC and SIP AS may support offline only charging via Nchf interface.\nEditor’note: whether other IMS Nodes use the Nchf interface is FFS.\nThe general architecture components can be found in TS 32.240 [2].\nGa is described in clause 5.4.5 and Bi in clause 5.4.6 of the present document, and Nchf is described in TS 32.290 [45].\nFigure 4.4.2 depicts the IMS converged charging architecture in reference point representation:\nThe figure depicts a converged charging architecture in reference point representation, showcasing the integration of multiple charging technologies and the use of reference points to facilitate efficient power distribution.\nFigure 4.4.2: IMS converged charging architecture in reference point representation\nThe architectural options of figure 4.4.1 apply to figure 4.4.2 with IMS node, CHF and corresponding Billing domain/CGF located in the same PLMN.\nThe different IMS architectures for the support of IMS services for roaming users are specified in TS 23.228 [201], and can be considered under two categories:\n-\twithout IMS-level roaming interfaces as per clause 4.15b, Annex M.2, Annex W and Annex Y.9.2 of TS 23.228 [201], with the P-CSCF located in HPLMN. All IMS Nodes are located in HPLMN and figure 4.4.1 and figure 4.4.2 apply.\n-\twith IMS-level roaming interfaces as per clause 4.15a, Annex M.1 and Annex Y.9.3 of TS 23.228 [201], with the P-CSCF located in VPLMN. Figure 4.4.3 and figure 4.4.4 are applicable.\nFigure 4.4.3 depicts the IMS converged charging architecture in service-based representation for CHF, in IMS with IMS-level roaming interfaces:\nIMS-level roaming interfaces and service-based representation are key components of the converged charging architecture depicted in Figure 4. This figure illustrates the IMS (Integrated Mobile System) converged charging architecture, which is designed to provide seamless roaming services across multiple mobile networks. The architecture includes IMS-level roaming interfaces, which enable seamless switching between different mobile networks, and service-based representation, which allows for the efficient management of roaming charges.\nFigure 4.4.3: IMS converged charging architecture IMS-level roaming interfaces service based representation\nEditor’note: whether P-CSCF use the Nchf interface is FFS.\nThe architectural options of figure 4.4.1 apply to figure 4.4.3 with IMS node, CHF and corresponding Billing domain/CGF located in the HPLMN.\nFigure 4.4.4 depicts the IMS converged charging architecture in reference point representation for CHF, in IMS with IMS-level roaming interfaces:\n\nIMS-level roaming interfaces in reference point representation\nFigure 4.4.4: IMS converged charging architecture IMS-level roaming interfaces in reference point representation\nEditor’note: whether P-CSCF use the Nchf interface, therefore N45 is FFS.\nThe architectural options of figure 4.4.1 apply to figure 4.4.4 with IMS node, CHF and corresponding Billing domain/CGF located in the HPLMN.\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "5\tCharging principles",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tIMS charging principles",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.1.0\tIntroduction",
                            "text_content": "The IMS node shall maintain the integrity of all received or created charging-related information when forwarding the information to the offline, online and converged charging systems, whatever the length of the value of any particular parameter is. For example, the IMS Charging Identifier (ICID) may be generated by one IMS node (e.g. the P-CSCF) and forwarded to another IMS node (e.g. the S-CSCF). Both may generate charging information and ensure that the data integrity is maintained, in order to make possible correlation based on the ICID.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.1\tIMS charging applicability",
                            "text_content": "The IMS node may select charging method, i.e. online, offline or converged. The selection can be made based on local configuration or a combination of local configuration and received OCS/CDF addresses.\nIf a combination of local configuration and received OCS/CDF addresses and:\n-\tonly OCS address received, then either online charging (over Ro) or converged charging (over Nchf) may be used based on local configuration.\n-\tonly CDF address received then either offline charging (over Rf), converged charging (over Nchf) or offline only charging (over Nchf) may be used based on local configuration.\n-\tboth OCS and CDF address received then either online and offline changing (over Ro and Rf), or converged charging (over Nchf) may be used based on local configuration.\n-\tneither OCS nor CDF address received then depending on IMS node any of the above may be used based on local configuration.\nThe CDF and OCS  addresses transferred in SIP signalling are encoded in the P-Charging-Function-Addresses as defined in TS 24.229 [204] and RFC 7315 [406]. The P-Charging-Function-Addresses header contains the following parameters: CCF (i.e. CDF) and ECF (i.e. OCS).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2\tIMS charging correlation",
                            "text_content": "The IMS charging correlation information is encoded in the SIP P-Charging-Vector header as defined in the following sub clauses. The P-Charging-Vector header contains the following parameters: ICID, access network charging identifier and IOI.\nThe loopback-indication parameter identify when loopback apply.\nGeneral correlation mechanisms are defined in TS 32.240 [1], and further details about the usage of P-Charging-Vector are defined in TS 24.229 [204], TS 24.292 [210], and IETF RFC 7315 [406].\nThe enhanced MSC server for ICS charging in this specification refers the MSC server which performs IMS registration, as defined in TS 23.292 [219]. The enhanced MSC server for SRVCC charging in this specification refers the MSC server defined in TS 24.237 [217].\nThe IMS domain correlation is based on IMS Charging Identifier (ICID) shared between IMS Network Elements involved with the same session/transaction. With ICID it is possible to correlate session/transaction related charging data generated in different IMS elements (i.e. x-CSCFs, ASs'). The ICID is included in all SIP methods, if the P-Charging-Vector header is present, and transferred through originating and terminating side nodes, except to UE.\nThe value of the ICID parameter is identical with the 'icid-value' parameter defined in TS 24.229 [204]. The 'icid-value' is a mandatory part of the P-Charging-Vector and coded as a text-based UTF-8 charset (as are all SIP messages). For further information regarding the composition and usage of the P-Charging-Vector refer to [204] and RFC 7315 [406].\nThe ICID value is globally unique across all 3GPP IMS networks for a time period of at least one month, implying that neither the node that generated this ICID nor any other IMS Network Element reuse this value before the uniqueness period expires.  The one month minimum uniqueness period counts from the time of release of the ICID, i.e. the ICID value no longer being used. This can be achieved by using node specific information, e.g. high-granularity time information and / or topology / location information.  The exact method how to achieve the uniqueness requirement is an implementation issue.\nAt each SIP session unrelated method, both initial and subsequent (e.g. SIP REGISTER, SIP NOTIFY, SIP MESSAGE etc.), a new, session unrelated ICID is generated at the first IMS Network Element that processes the method. This ICID value is contained in the SIP request and SIP response of that SIP transaction and must be valid for the duration of the transaction.\nAt each SIP session establishment a new, session specific ICID is generated at the first IMS Network Element that processes the session-initiating SIP INVITE message. Enhanced MSC server will generate an ICID for ICS and SRVCC originated calls as described in TS 24.229 [204]. This ICID is then used in all subsequent SIP messages for that session (e.g., SIP 200 OK, SIP (RE-)INVITE, SIP BYE etc.) until the session is terminated.\nDuring the process of SRVCC access transfer, the Enhanced MSC server or the P-CSCF generates an ICID for the target access leg. For the purpose of charging correlation between the source access leg and the target access leg when the user is roaming the SCC AS and the ATCF includes the ICID used on the source access leg as the Related ICID for the target access leg as described in TS 24.229 [204]. Alternatively, when OneChargingSession is applied in the SCC AS and the ATCF, the ICID of the original access leg is preserved in the AS/ATCF CDR for the whole duration of the session, and the Related ICID contains the ICID used on the target access leg.\nThis Related ICID is sent in the 1xx and 2xx responses to the initial SIP INVITE as described in TS 24.237 [217].\nThe access network charging identifier is the media flow level data shared among the IMS Network Elements for one side of the session (either the originating or terminating side). This information is used to correlate the access network charging data with the IMS charging data. \nThe access network is identified by access specific correlation identifier, e.g. for Packet Switched Access (PGW address and Charging Id per bearer) , for 5GS (SMF Address and Charging Id per PDU session) or Fixed Broadband Access (Multimedia Charging Identifier). The access network charging identifier is populated in the P-Charging-Vector using the access-network-charging-info parameter. For further information regarding the composition and usage of the access-network-charging-info parameter refer to TS 24.229[204] and RFC 7315 [406].\nThe Inter Operator Identifier (IOI) identifies originating, terminating and transit networks involved in a session/transaction. The IOI may be generated from each side of session/transaction to identify the home networks associated with each side. The Orig-IOI and Term-IOI parameters of P-Charging-Vector represent the originating and terminating operator identifiers.\nFor interconnection scenarios in multi operator environments where one or more transit operators are between the originating and terminating operator, a list of Transit-IOI values may occur additionally to identify involved transit operators. Due to operator policy, a transit operator may also hide his identity by adding a void value. Addition and deletion of Transit-IOI values are operator configurable. For further information regarding the composition and usage of the parameters refer to TS 24.229[204], TS 24.292 [210], and IETF RFC 7315 [406].\nNOTE:\tNo transit networks are expected between the S-CSCF and a 3rd party Application Server triggered by the initial filter criteria in the S-CSCF.\nThe IMS visited network identifier identifies the visited network involved in a session/transaction. The IMS visited network identifier is available in the SIP P-Visited-Network-ID header of the SIP REGISTER, with the value according to 3GPP TS 24.229 [204],  and should be used for all charging events associated with the user.\n-\tFor the roaming architecture for voice over IMS with local breakout, the value of IMS visited network identifier is a pre-provisioned string that identifies the network of the P-CSCF at the home network.\n-\tFor the roaming architecture for voice over IMS with home routed traffic, IMS visited network identifier is a string that identifies the visited network of the UE including an indication that the P-CSCF is located in the home network.\nDuring the loopback the TRF will set the Loopback-indication parameter to identify when loopback applies.  When the TRF receives responses to initial or subsequent requests from the terminating side, the TRF inserts in the P-Charging-Vector header field, if present, the \"loopback-indication\" header field parameter to the outgoing response.\nThe FE Identifier List contains one or more:\n-\tIM CN subsystem functional entity address, and/or\n-\tAS address and the corresponding application identifier\nAs defined in TS 32.240 [1] clause 5.3.4.4.2 the functional entity address is included when the IM CN subsystem functional entity does create charging information for the related CDR of this IM CN subsystem functional entity. As defined in TS 32.240 [1] clause 5.3.4.4.3 for AS hosting several applications the same AS address can appear several times, each accompanied with a different application identifier based on the application executed by the AS.\nValues in SIP requests shall be ignored. The FE-Identifier header exchange via SIP signalling is defined in TS 24.229 [210].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.3\tSDP handling",
                            "text_content": "SDP information on SIP can have two different meanings; SDP offer or SDP answer. This is captured in the charging information by a SDP-type parameter that indicates if the SDP Media Component is an SDP offer or SDP answer. SDP offers can be sent by either the calling or called party and the Media Initiator Flag identifies who sent the first SDP offer in a SDP negotiation. SDP can be negotiated more than once in an SIP INVITE or SIP RE-INVITE dialog.\nEach occurrence of the List of SDP Media Components in the corresponding CDRs may include either SDP offer or SDP answer. For the first negotiation, the SDP answer defines which media are used in the session, therefore it shall be recorded in case of successful session setup. Additionally the corresponding SDP offer may be recorded. In case of unsuccessful session setup the SDP offer may be recorded, if available.\nWhen session re-negotiations occur, multiple occurrences of List of SDP Media Components may be used to include a series of SDP negotiations in which each occurrence holds an SDP offer or SDP answer as for the first SDP negotiation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.4\tTrigger conditions",
                            "text_content": "This clause contains the details for trigger conditions listed in table 5.2.1.1 for offline charging messages (Charging Data Request and Charging Data Response) and table 5.3.1.1 for online charging messages (Debit / Reserve Units Request and Debit / Reserve Response) triggered by SIP methods or ISUP messages for all IMS nodes except for MRFC and AS.\nThe I-CSCF and BGCF, which need not be present in the signalling path for subsequent requests after the first SIP INVITE, do not support session-based charging using Charging Data Request [Start, Interim, and Stop]. In these (and only in these) IMS Network Elements, successful session set-up completion triggers Charging Data Request [Event]. Use of session-based charging when the I-CSCF or the BGCF is call stateful is not described in this release.\nThe initial registration, user-initiated re-registration, and user-initiated de-registration chargeable events relate to SIP REGISTER to trigger Charging Data Request [Event] / Debit / Reserve Units Requests, while network-initiated deregistration event relates to SIP NOTIFY to trigger Charging Data Request [Event] / Debit / Reserve Units Requests provided that subscription to registration events has been applied (see TS 24.229 [204]).\nIf at the time when the SIP 200 OK is received only the SDP offer is available, the CTF may trigger Charging Data Request[Start] immediately (subsequent SIP ACK containing the SDP answer triggers Charging Data Request[Interim]) or may trigger Charging Data Request[Start] once the SIP ACK has been received. The precise behaviour shall depend on operator policy.\nIf capturing the last user location information and/or UE Time Zone of one specific party (originating or terminating) at session release is required by operator (e.g. for legal purpose), and such information is not available at the time the SIP BYE is received, the CTF shall delay the Charging Data Request [Stop] until the reception of SIP 200 OK acknowledging the SIP BYE. Otherwise, the CTF shall trigger Charging Data Request [Stop] once the SIP BYE request has been received.\nIf capturing the last user location information and/or UE Time Zone of one specific party (originating or terminating) at session release is required by operator (e.g. for legal purpose), and such information is not available at the time the SIP BYE is received, the CTF shall delay the Debit / Reserve Units Request [Terminate] until the reception of SIP 200 OK acknowledging the SIP BYE. Otherwise, the CTF shall trigger Debit / Reserve Units Request [Terminate] once the SIP BYE request has been received. In any case, the granted quota shall not be used once the SIP BYE is received.\nIf capturing a user location change during a session is required by operator (e.g. for legal or statistics purposes), the CTF should trigger Charging Data Request or Debit / Reserve Units Request on any SIP method received containing user location information.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.5\tIMS support of real-time tariff transfer",
                            "text_content": "The TS 29.658 [206] describes the Real-time Transfer of Tariff Information (RTTI) in SIP. The RTTI may be supported for the requested service (e.g. tariff information of a value added service residing in the called network or in a specific AS).\nAccording to the procedures described in the TS 29.658 [206], tariff information may be included in the content body of the following SIP messages: 1xx provisional response or SIP 200 OK at session setup, mid-dialog requests or responses. The following IMS Network Elements, IBCF, MGCF, S-CSCF and AS may pass tariff information and record the tariff information in the corresponding CDRs for IMS offline charging. For online charging, the AS and the IMS-GWF may send charging information related to the content body of RTTI message over Ro interface to the OCS.\nThe following security mechanisms shall be used for RTTI:\n-\tIBCF shall accept RTTI information only from trusted IMS networks and filter out RTTI information from non trusted IMS networks.\n-\tIf RTTI information has to be sent over unsecure domain networks, the security of the domains interconnection shall rely on Network Domain Security specifications: TS 33.210 [208] and TS 33.310 [209].\n-\tThe S-CSCF responsible for the handling of RTTI messages shall follow the common IMS security specification TS 33.203 [207] to protect against malicious UE that try to bypass the P-CSCF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.6\tServed user identification",
                            "text_content": "Subscriber Identifier is an Information Element used in both online and offline charging information to identify the served user for the specific leg of an IMS session. A list of Subscription Id(s) for IMS CDR shall contain the Public user Id(s) for the served user.\nIn the case when the served user is obtained from the P-Header P-Served-User (can be available in P-CSCF, S-CSCF and AS) then it shall also be used as Subscription-Id in both online and offline charging.\nThe Subscriber Equipment Number field contains the identification of the mobile device (e.g. IMEI) that the subscriber is using.\nAn Instance Id is defined as a URN generated by the device that uniquely identifies a specific device amongst all other devices (fixed or mobile). The Instance Id is transported in the sip.instance feature tag in the Contact header of a SIP request associated with the served user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.7\tSingle charging session from AS/ATCF acting as B2BUA",
                            "text_content": "When a session-initiating SIP INVITE message is received by an AS/ATCF, this AS/ATCF, per application logic needs, acting as a B2BUA, may decide ICID for the outgoing dialog to be the same as received or different.\nIn case the same ICID is preserved between incoming and outgoing dialog by the AS/ATCF acting as a B2BUA, a single charging session for both dialogs can be created by this AS/ATCF. This option, refered-to as \"OneChargingSession\" in the different descriptions, is applicable per Operator configuration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.8\tCharging support for roaming architecture for voice over IMS with local breakout",
                            "text_content": "The roaming architecture for voice over IMS with local breakout is described in the TS 23.228 [201]. The corresponding Charging principles are defined in the TS 32.240 [1]. In the present document, charging support for the Transit and Roaming Function (TRF) requisite for roaming architecture for voice over IMS with local breakout is rendered by presuming collocation or standalone.\nFigure 5.1.8.1 shows an example for possible signalling and media flows in a roaming architecture for voice over IMS with local breakout.\n\nThe figure depicts a signaling and media flow architecture for voice over IP (VoIP) in a roaming architecture with virtual backhaul (VBH). Key components include the core switch, optical line terminal (OLT), and distributed nodes. The layered design aligns with SDN principles, ensuring failover reliability.\nFigure 5.1.8.1: Signalling and media flows in a roaming architecture for voice over IMS with vocal breakout (example)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.8A\tCharging support for roaming architecture for voice over IMS with home routed traffic",
                            "text_content": "The charging principle of roaming architecture for voice over IMS with home routed traffic is described in TS 32.240 [1].\nIn LBO roaming model where P-CSCF is located in VPLMN, the home network determines the serving PLMN of the UE from the location of the P-CSCF during initial IMS Registration, using the P-CSCF network identifier.\nIn deployments without IMS-level roaming interfaces where P-CSCF is located in HPLMN, the home network determines the serving PLMN of the UE using procedure defined in TS 23.228 [201], where P-CSCF requests the PCRF/PCF to report the PLMN identifier where the UE is currently located. The received PLMN ID information is then forwarded in the SIP REGISTER request.Figure 5.1.8A.1 shows an example for possible signalling and media flows in a Roaming Architecture for Voice over IMS with home routed traffic.\n\n\n\nIn this figure, we see a simplified representation of a Roaming Architecture for Voice over IP (VoIP) with home-routed traffic. The figure illustrates the signaling and media flows in a roaming environment, where the user's device (UE) is connected to a base station (BS) and the BS is connected to a network (N) through a network-to-network (N2N) connection. The figure also shows the signaling paths, including the signaling path, media path, and the network path. The media path is shown as a dashed line, indicating that it is redundant and can be used for failover in case of failure. The figure is a simplified representation and does not include all the details of a real-world Roaming Architecture, but it provides a good overview of the key components and signaling paths involved.\nFigure 5.1.8A.1: Signalling and media flows in a Roaming Architecture for Voice over IMS with home routed traffic (Example)\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.9\tCharging support for Network provided Location information",
                            "text_content": "The Network provided Location information (NetLoc) is described in the TS 23.228 [201] and for emergency service request using PCC-based solutions for the UE location in mobile networks in TS 23.167 [212]. \nIn some scenarios, an AS can also detect emergency service and obtain the UE location using HSS-based solutions in TS 23.167 [212].\nBased on operator policies and the availability of the user location information and/or UE Time Zone from the access network, the solution ensures that relevant SIP messages contain the correct or up to date information about the user location information, and/or UE Time Zone provided by the access network and currently used by the UE.\nFor the 3GPP and non-3GPP accesses, the P-CSCF can retrieve user location information and/or UE Time Zone related to the access network currently used by the UE using PCC mechanisms, as specified in TS 23.203 [213] , TS 23.503 [221] and TS 29.214 [214] . In some scenarios, an AS can also obtain location information using HSS-based solutions in TS 29.328 [215].\nFor fixed networks, the P-CSCF is aware of the network provided location information through signalling with the NASS.\nAs specified in TS 24.229 [204], clause 7.2A.4.3, the network provided location information is transported in the SIP P-Access-Network-Info header with an \"np\" parameter and indicates details of where the UE is currently located  as defined in TS 23.228 [214].\nFor trusted WLAN access, the SIP P-Access-Network-Info header includes the BSSID, and as specified in TS 23.228 [201] Annex T, a Geographical Identifier, if generated by the P-CSCF or AS based on the retrieved Access Network Information.\nFor untrusted WLAN access, the SIP P-Access-Network-Info header includes the BSSID, and as specified in TS 23.228 [201] Annex V, UE local IP address, ePDG IP Address, and the TCP source port or UDP source port used by the UE to establish the IKEv2 tunnel with the ePDG.\nFor 3GPP accesses, the SIP P-Access-Network-Info header includes the SAI, TAI, RAI, CGI, ECGI, and NCGI.\nNOTE: When NR is accessed by the UE via Dual Connectivity scenario (i.e. option 3a/x) specified TS 23.401 [222] clause 4.3.2a, the user location is retrieved from EPC, i.e. NCGI is not applicable.\nFor other accesses, the SIP P-Access-Network-Info header includes specific user location information detailed in TS 24.229 [204], clause 7.2A.4.3.\nIn the defined CDRs, the network provided location information available when the CDR is opened, for 3GPP accesses is directly available in the User Location Info field and also available in the Access Network Information or Additional Access Network Information fields. For non-3GPP accesses, the network provided location information available when the CDR is opened, shall be available in either the Access Network Information or Additional Access Network Information fields\nNOTE 1: \tIn a node that receives two\"P-Access-Network-Info\"   headers, in Rel-11, the operator determined which \"P-Access-Network-Info\"  header (i.e., network-provided or UE-provided) would be included in the Access Network Information field. For backward compatibility, for an operator that deployed the Rel-11 capability the other \"P-Access-Network-Info\"  header should be included in the Additional Access Network Information field.\nNOTE 2: \tIn a node that receives two \"P-Access-Network-Info\"  headers for an operator first deploying this capability in Rel-12, it is recommended that the network-provided \"P-Access-Network-Info\"  header be included in the Access Network Information field and a UE-provided \"P-Access-Network-Info\"  header be included in the Additional Access Network Information field.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.9A\tCharging support for IMS transit scenarios",
                            "text_content": "The IMS transit network scenarios are described in the TS 23.228 [201] and may require additional functionalities provided by the IMS Transit Functions (TF). When residing in a stand-alone entity, the IMS TF may apply offline charging. Applicable fields for the IMS TF are in table 6.3.2.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.10\tCharging support for TRF",
                            "text_content": "In order to support traffic for the Roaming Architecture for Voice over IMS with Local Breakout, IMS TF are enhanced with additional routing functionality, both combined in a Transit and Roaming Function (TRF and defined in TS 23.228 [201]. Depending on the transit operator configuration, these functions might reside in a stand-alone entity or be collocated with an existing IMS Network Element.\nWhen residing in a stand-alone entity, the TRF may apply offline charging.\nWhen collocated with an existing IMS Network Element, charging information for the TRF is combined with charging information of the corresponding IMS Network Element. Applicable fields are in table 6.3.2.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.11\tCharging support for IMS service continuity",
                            "text_content": "The charging requirements for IMS service continuity using AS and ATCF are specified in TS 23.237 [216].\nInter-UE transfer provides the capability of transferring the communication sessions with multiple media across different UEs and is part of Service Continuity (SC) as described in TS 23.237 [216]. For inter-UE transfer shall an AS implement the role of an SCC AS according to TS 24.337 [218].\nA complete session can be transferred from one UE to another with or without establishing a collaborative session as defined in TS 23.237 [216] and TS 24.337 [218]. The SCC AS is able to serve an inter-UE transfer request initiated by the target UE without the establishment of a collaborative session regardless of the access technology used by either of the involved UEs.\nFor a consistent representation of the various access transfers specified in TS 23.237 [216] and TS 24.337 [218] in offline and online charging of the AS and in offline charging of the ATCF the Access Transfer Type parameter provides information on the used access technologies, e.g. PS to CS, CS to PS, PS to PS or CS to CS. The Inter-UE Transfer parameter indicates whether the access transfer was done between two UEs provided by the SCC AS as defined in TS 24.337 [218]. These parameters together, show the type of access transfer in detail, and are reported together with UE identification (i.e. Subscriber Equipment Number and/or Instance Id), Access Network Information and potentially Additional Access Network Information and Cellular Network Information available along the session transfer procedure.\nSubsequently, the Requested Party Address parameter holds addresses related to session transfer if available: For SIP transactions, the address of the party (Public User ID or Public Service ID) to whom the SIP transaction was originally posted. For PS to CS transfer, the Session Transfer Number for Single Radio Voice Call Continuity (STN-SR) as described in TS 23.237 [216]. For CS to PS transfer, the Session Transfer Identifier for CS to PS Single Radio Voice Call Continuity (STI-SR) as described in TS 23.237 [216].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.12\tIMS support of announcements",
                            "text_content": "During a charging session, the CHF/OCS may utilize the Announcement service specified in TS 32.281 [41] to request the IMS-GWF or AS to render video or audio announcements to a subscriber involved in an IMS session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.13\tCharging support of UE location(s) and TimeZone(s)",
                            "text_content": "As specified in TS 24.229 [204], clause 7.2A.4.3, and in RFC 7315 [406], details of the UE location and Timezone are transported in the SIP P-Access-Network-Info header, which is conveyed in SIP signalling through IMS Nodes. Consequently UE location and TimeZone changes are addressed under SIP P-Access-Network-Info header changes.\n\nThe SIP P-Access-Network-Info header includes either UE-provided location, either Network-Provided location, both are subject to change independently during an IMS session. Any available UE-provided and Network-Provided locations are received by IMS Nodes in every SIP requests and responses, and transported in two P-Access-Network-Info headers when both are available.The charging support for Network-Provided location is described in clause 5.1.9.\nAs specified in TS 24.229 [204], clause 7.2.15.3, when a User Agent (UA) supporting one or more cellular radio access technology (e.g. E-UTRAN) is using a non-cellular IP-CAN to access the IM CN subsystem, details of the radio cell identity of the cellular radio access network on which the UE most recently camped are transported in the SIP Cellular-Network-Info header, which is conveyed in SIP signalling through IMS Nodes.\nWhen Charging Data Request [Start/ Interim/Stop] are triggered for SIP session-related procedures, based on principles described in clause 5.2.1, any available SIP P-Access-Network-Info and SIP Cellular-Network-Info header(s) shall be reported to the CDF, using Access Network Information, Additional Access Network Information and Cellular Network Information IEs. The received IEs shall be included by the CDF:\n-\tin Access Network Information, Additional Access Network Information and Cellular Network Information fields of IMS CDRs, upon Charging Data Request [Start] from IMS Nodes.\n-_\tin the List of Access Network Info Change field of IMS CDRs, upon reception of Charging Data Request [Interim, Stop] from IMS Nodes, only for SIP P-Access-Network-Info and SIP Cellular-Network-Info header(s) identified as changed.\nWhen Debit / Reserve Units Request [Initial/ Update/Terminate] are triggered for SIP session-related procedures, based on principles described in clause 5.3.1, any available SIP P-Access-Network-Info and SIP Cellular-Network-Info header(s) shall be reported, using Access Network Information, Additional Access Network Information and Cellular Network Information IEs.\nAs specified in clause 5.1.11, during IMS service continuity transfer procedure, the Access Network Information, Additional Access Network Information and Cellular Network Information shall be provided by the AS and ATCF together with transfer parameters, using Access Transfer Information IE, in offline and online charging.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.14\tCharging support of duration based charging",
                            "text_content": "IMS Network Elements can not get the volume information from the underlying network as described in TS 24.229 [204], therefore IMS charging only supports duration based charging.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.15\tCharging support of duration-based charging for IMS data channel",
                            "text_content": "The basic procedures related to IMS data channel are specified in TS 23.228 [201]. UE can establish data channel(s) simultaneously while establishing an IMS audio/video session or upgrade an ongoing IMS audio/video session through a re-INVITE to add IMS data channel(s). The IMS data channel is kept as long as there is an independent IMS audio/video SDP. The data channel is either terminated along with the release of the call or is or be terminated by closing the data channel. The charging principle of this senario is same as duration-based charging for IMS audio/video session.\nThe information of each DC stream is available in SDP which can be used for IMS data channel charging. The media handling and interaction for IMS data channel are specified in TS 26.114 [223]. The SDP can contain media description for data channel:\n-\t\"m=application\" line with webrtc-datachannel.\n-\t\"a=dcmap\" lines with stream ID for different types of data channels, and the stream ID values are specified in TS 26.114 [223].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.2\tIMS offline charging principles",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tBasic principles",
                            "text_content": "The offline charging functionality is based on the IMS network nodes reporting accounting information upon reception of various SIP methods or ISUP messages, as most of the accounting relevant information is contained in these messages. This reporting is achieved by sending Charging Data Request [start, interim, stop and event] from the IMS Network Elements to the CDF or Charging Data Request [Initial, Update, Termination and Event] from the IMS Network Elements to the CHF.\nThe charging client uses Charging Data Request[start/Initial, interim/Update and stop/Termination] in procedures related to successful SIP sessions. It uses Charging Data Request[event]s for unsuccessful SIP sessions and for session unrelated procedures. Further details are specified in the tables below and in clause 5.2.2.\nIt is operator configurable in the nodes for which SIP method or ISUP messages a Charging Data Request is sent. Table 5.2.1.1 describes all possible Charging Data Requests that might be sent from a P-CSCF, I-CSCF, S-CSCF, IBCF, MGCF or BGCF. A list of node specific Charging Data Requests, along with the AVPs to be included are detailed in TS 32.299 [50] or the API attributes to be included are detailed in TS 32.291 [46].\nThe Charging Data Requests to be sent from a MRFC are described in table 5.2.1.2 specific for reference point Rf or 5.2.1.4 specific for service based interface Nchf.\nIt is configurable for the operators to enable or disable the generation of a Charging Data Request message by the IMS node in response to a particular \"triggering SIP method /ISUP message\".\nTable 5.2.1.1-1: Charging Data Request messages triggered by SIP methods or ISUP messages\nfor all IMS nodes except for MRFC and AS\n\nTable .1-2: Charging Data Request messages triggered by SIP methods for the MRFC\n\nThe Charging Data Request and Charging Data Response are exchanged between the IMS nodes and the CHF using Nchf, based on either PEC or SCUR scenarios specified in TS 32.290 [45].\nThe contents and purpose of each charging event that triggers interaction with CHF, as well as the chargeable events that trigger them, are described in this clause.\nThe CHF address can be selected from IMS signalling as per the TS 24.229 [204] or can be configured locally.\nThe CHF services may be selected by local configuration. IMS nodes (except IMS-GWF) may consume offline only charging service via Nchf interface.\nThe IMS nodes for which SIP method a charging Data Request is sent shall be operator configurable. The tables below describe all possible Charging Data Requests that might be sent from IMS nodes.\nThe generation of a Charging Data Request message by the IMS nodes in response to a particular \"triggering SIP method\" shall be operator configurable (enable or disable).\nTable 5.2.1.2-1: Default Trigger conditions in IMS nodes (except MRFC and AS)\n\nTable 5.2.1.2-2: Default Trigger conditions in MRFC\n\nFor offline only charging, the following details of chargeable events and corresponding actions in the IMS nodes (except MRFC) are defined in Table 5.2.1.2-3:\nTable 5.2.1.2-3: Chargeable events and their related actions in IMS nodes (except MRFC)\n\nFor offline only charging, the following details of chargeable events and corresponding actions in the MRFC are defined in Table 5.2.1.2-4:\nTable 5.2.1.2-4: Chargeable events and their related actions in MRFC\n\nEditor’note: The applicable triggers in the tables is ffs.\nEditor’note: Whether the general table or individual tables for each IMS node is ffs.\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.2.1.1-1: Charging Data Request messages triggered by SIP methods or ISUP messages\nfor all IMS nodes except for MRFC and AS",
                                    "table number": 1,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table .1-2: Charging Data Request messages triggered by SIP methods for the MRFC",
                                    "table number": 2,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.1.2-1: Default Trigger conditions in IMS nodes (except MRFC and AS)",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.1.2-2: Default Trigger conditions in MRFC",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.1.2-3: Chargeable events and their related actions in IMS nodes (except MRFC)",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.1.2-4: Chargeable events and their related actions in MRFC",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.2.2\tMessage flows and types",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2.0\tIntroduction",
                            "text_content": "The flows described in the present document specify the charging communications between IMS entities and the charging functions for different charging scenarios. The SIP messages and Charging Data transactions associated with these charging scenarios are shown primarily for general information and to illustrate the charging triggers. They are not intended to be exhaustive of all the SIP message flows discussed in TS 24.228 [200] and they depend on the Charging Data Requests triggers configured by the operator.\nFigure 5.2.2.1.1.1 to figure 5.2.2.1.1.3 show the Charging Data transactions that are required between CSCF and CDF during session establishment originated by a UE.\nFigures 5.2.2.1.1.1-5.2.2.1.1.3 below are illustrated in LBO roaming model where P-CSCF and CDF are located in VPLMN. The same figures are applicable for deployment of voice over IMS with home routed traffic, where P-CSCF is located in HPLMN, with the exception that the HPLMN CDF is used.\nScenario 1: Successful session establishment\n\nThe figure depicts a message sequence chart for session establishment, illustrating the steps involved in establishing a session. The chart includes various components such as the session identifier (SID), session key, and session establishment message (SEM). The figure is used to ensure that the session is established correctly and securely.\nFigure 5.2.2.1.1.1: Message sequence chart for session establishment (mobile origination)\n1.\tThe session is initiated.\n2.\tThe destination party answers and a final response are received.\n3.\tUpon reception of the final response, the S-CSCF sends an Charging Data Request[Start] to record start of a user session and start of a media component in the S-CSCF CDR.\n4.\tThe CDF acknowledges the reception of the data and opens an S-CSCF CDR.\n5.\tSame as 3, but for P-CSCF.\n6.\tSame as 4, but creating a P-CSCF CDR.\n\nScenario 2: Successful session establishment with late SDP answer (SIP 200 OK triggering Charging Data Request)\nFigure 5.2.2.1.1.2 shows the Charging Data transactions that are required between CSCF and CDF during session establishment originated by a UE.\nThe figure depicts a message sequence chart for session establishment, showing the steps involved in initiating a charging data request. The chart includes a message sequence, a charging data request, and a successful message, all of which are essential components of the session establishment process in a mobile origination system (MOS).\nFigure 5.2.2.1.1.2: Message sequence chart for session establishment  \n(SIP 200 OK triggering Charging Data Request) - mobile origination\n1.\tThe session is initiated.\n2.\tThe destination party answers and a response are received.\n3.\tUpon reception of the SIP 200 OK, the S-CSCF sends an Charging Data Request[Start] to record start of a user session and start of a media component in the S-CSCF CDR.\n4.\tThe CDF acknowledges the reception of the data and opens an S-CSCF CDR.\n5.\tSame as 3, but for P-CSCF.\n6.\tSame as 4, but creating a P-CSCF CDR.\n7. - 11.\tThese steps are identical to steps 3. -7. of scenario 2 described in clause 5.2.2.1.3.\nScenario 3: Successful session establishment with late SDP answer (SIP ACK triggering Charging Data Request)\nFigure 5.2.2.1.1.3 shows the Charging Data transactions that are required between CSCF and CDF during session establishment originated by a UE.\nThe given telecommunication figure depicts a message sequence for session establishment, specifically for a mobile origination point (MOP) to a mobile termination point (MTP). The figure includes a SIP ACK triggering the Charging Data Request (CDR) message, which is sent to the mobile origination point (MOP) to initiate the charging process.\nFigure 5.2.2.1.1.3: Message sequence chart for session establishment \n(SIP ACK triggering Charging Data Request) - mobile origination\n1.\tThe session is initiated.\n2.\tThe destination party answers and a final response are received. If the final response includes a SDP offer only, then the CSCF shall wait for the SIP ACK.\n3.\tThe SIP ACK including the SDP answer is received.\n4.\tUpon reception of the SIP ACK, the P-CSCF sends an Charging Data Request[Start] to record start of a user session and start of a media component in the P-CSCF CDR.\n5.\tThe CDF acknowledges the reception of the data and opens an P-CSCF CDR.\n6.\tSame as 4, but for S-CSCF.\n7.\tSame as 5, but creating a S-CSCF CDR.\nFigure 5.2.2.1.2.1 shows the Charging Data transactions that are required between CSCF and CDF during a session establishment that is terminated to a mobile. The I-CSCF is only involved in the SIP INVITE transaction.\nFigure 5.2.2.1.2.1 below is illustrated in LBO roaming model where P-CSCF and CDF are located in VPLMN. The same figure is applicable for deployment of voice over IMS with home routed traffic, where P-CSCF is located in HPLMN, with the exception that the HPLMN CDF is used.\nThe figure depicts a message sequence chart for session establishment, illustrating the steps involved in establishing a session. The chart includes various components such as the session identifier (SID), session key, and session establishment message (SEM). The figure is used to ensure that the session is established correctly and securely.\nFigure 5.2.2.1.2.1: Message sequence chart for session establishment (mobile termination)\n1.\tThe session is initiated.\n2.\tThe destination party answers and a final response are sent.\n3. - 6.\tThese steps are identical to the corresponding steps described in clause 5.2.2.1.1.\n7.\tUpon reception of the SIP 200 OK, the I-CSCF sends an Charging Data Request[Event].\n8.\tThe CDF acknowledges the data received and creates an I-CSCF CDR.\n\nFigure 5.2.2.1.3.1 shows the Charging Data transactions that are required between CSCF and CDF when a UE generates a SIP (rE-)iNVITE or SIP UPDATE in mid-session, e.g. in order to modify media component(s), or when the hold and resume procedure is executed.\nFigures 5.2.2.1.3.1-5.2.2.1.3.2 below are illustrated in LBO roaming model where P-CSCF and CDF are located in VPLMN. The same figures are applicable for deployment of voice over IMS with home routed traffic, where P-CSCF is located in HPLMN, with the exception that the HPLMN CDF is used.\nScenario 1: Mid-session procedures\nThe figure depicts a message sequence chart for media monitoring, illustrating the flow of data from source to destination. The chart includes various components such as the source, destination, and intermediate nodes, as well as the media type (e.g., voice, video, or data). The chart is designed to be easily understood and used for monitoring and analysis purposes.\nFigure 5.2.2.1.3.1: Message sequence chart for media modification\n1.\tModified media information is received from the subscriber.\n2.\tThe destination party acknowledges the media modification.\n3.\tAt modification of a media, the S-CSCF sends Charging Data Request[Interim] to record modification of a media component in the S-CSCF CDR.\n4.\tThe CDF acknowledges the reception of the data and updates the S-CSCF CDR.\n5.\tSame as 3, but for P-CSCF.\n6.\tSame as 4, updating the P-CSCF CDR.\nScenario 2 : Mid-session procedures with late SDP answer (SIP ACK triggering Charging Data Request)\nFigure 5.2.2.1.3.2 shows the Charging Data transactions that are required between CSCF and CDF when a UE generates a SIP (rE-)iNVITE or SIP UPDATE in mid-session, e.g. in order to modify media component(s), or when the hold and resume procedure is executed.\nThe figure depicts a message sequence chart for a media message (SIP ACK triggering Charging Data Request) in a SIP network. The chart shows the sequence of messages, including the SIP request, the acknowledgment, and the charging data request. The chart is used to understand the flow of messages in a SIP network and to ensure that the correct sequence of messages is followed.\nFigure 5.2.2.1.3.2: Message sequence chart for media modification (SIP ACK triggering Charging Data Request)\n1.\tThe UE generates a SIP RE-INVITE or SIP UPDATE in mid-session.\n2.\tThe destination party replies with a response including a SDP offer. If the final response includes a SDP offer only, then the CSCF shall wait for the SIP ACK.\n3.\tThe SIP ACK including the SDP answer is received.\n4.\tAt modification of a media, the P-CSCF sends  Charging Data Request[Interim] to record modification of a media component in the P-CSCF CDR.\n5.\tThe CDF acknowledges the reception of the data and updates the P-CSCF CDR.\n6.\tSame as 4, but for S-CSCF.\n7.\tSame as 5, updating the S-CSCF CDR.\n\nFigures 5.2.2.1.4.1 to 5.2.2.1.4.2 show the Charging Data transactions that are required between CSCF and CDF for a session release that is initiated by the UE.\nFigures 5.2.2.1.4.1-5.2.2.1.4.2 below are illustrated in LBO roaming model where P-CSCF and CDF are located in VPLMN. The same figures are applicable for deployment of voice over IMS with home routed traffic, where P-CSCF is located in HPLMN, with the exception that the HPLMN CDF is used.\nScenario 1: Successful session release (SIP BYE triggering Charging Data Request)\n\nThe figure depicts a message sequence chart for session release (SIP BYE triggering Charging Data Request), illustrating the flow of messages and their corresponding actions.\nFigure 5.2.2.1.4.1: Message sequence chart for session release (SIP BYE triggering Charging Data Request)\n1.\tThe session is released.\n2.\tAt session termination the P-CSCF sends  Charging Data Request[Stop] to record stop of a session and stop of a media component in the\nP-CSCF CDR.\n3.\tThe CDF acknowledges the reception of the data and closes the P-CSCF CDR.\n4.\tSame as 2, but for S-CSCF.\n5.\tSame as 3, closing the S-CSCF CDR.\n6.\tThe release is acknowledged.\nScenario 2: Successful session release (SIP 200 OK triggering Charging Data Request)\nThe figure depicts a message sequence chart for session release (SIP 200 OK triggering Charging Data Request), showing the flow of messages from the sender to the receiver. The chart includes various messages such as \"OK\", \"Charging Data Request\", and \"Charging Data Response\", indicating the sequence of events in the session release process. The chart is organized in a hierarchical manner, with each message represented by a different color, making it easy to identify and understand the flow of messages.\nFigure 5.2.2.1.4.2: Message sequence chart for session release (SIP 200 OK triggering Charging Data Request)\n1.\tThe session is released.\n2.\tThe release is acknowledged.\n3.\tAt acknowledgement of SIP session termination and, if required, Rx session termination, the P-CSCF sends Charging Data Request[Stop] to record stop of a session and stop of a media component and information from the acknowledgement message (e.g. user location retrieved as per Annex A.10.5 of TS 29.214[214] ) in the P-CSCF CDR. Reported charging information  must rely on the time when SIP BYE message is received and not when the corresponding acknowledgement is received.\n4.\tThe CDF acknowledges the reception of the data and closes the P-CSCF CDR.\n5.\tSame as 3, but for S-CSCF.\n6.\tSame as 4, closing the S-CSCF CDR.\n\nFigure 5.2.2.1.5.1 shows the Charging Data transactions that are required between CSCF and CDF for session-unrelated IMS procedures, i.e. those that relate to the Charging Data Request [event], as listed in table 5.2.1.1.\nFigure 5.2.2.1.5.1 below is illustrated in LBO roaming model where P-CSCF and CDF are located in VPLMN. The same figure is applicable for deployment of voice over IMS with home routed traffic, where P-CSCF is located in HPLMN, with the exception that the HPLMN CDF is used.\nThe figure depicts a message sequence chart for session-related procedure, illustrating the flow of messages between different components in a telecommunication system.\nFigure 5.2.2.1.5.1: Message sequence chart for session-unrelated procedure\n\n1.\tThe P-CSCF receives a \"SIP request\" (e.g. SUBSCRIBE) from the subscriber.\n2.\tThe \"SIP Request\" is acknowledged by the \"SIP response\" as follows:\n-\tin the successful case, a SIP 200 OK message is returned;\n-\tin case of failure an appropriate SIP error message is returned.\nDepending on the used SIP method, there might be additional signalling between steps 1 and 2.\n3.\tAfter the completion of the procedure, the S-CSCF sends  Charging Data Request[Event] to record transaction specific information in the S-CSCF CDR.\n4.\tThe CDF acknowledges the reception of the data and produces an S-CSCF CDR.\n5.\tSame as 3, but for P-CSCF.\n6.\tSame as 4, creating a P-CSCF CDR.\n\nFigure 5.2.2.1.6.1 shows the Charging Data transactions that are required between MGCF and CDF during session establishment initiated from the PSTN side.\nThe figure depicts a message sequence chart for session establishment (PSTN-initiated) in a telecommunication network. It illustrates the steps involved in establishing a session, including the sender's request, the network's response, and the establishment of a session key. The chart is divided into two main sections, with the sender's request and the network's response shown in the upper section, and the session key and the establishment of the session in the lower section. The chart is color-coded to indicate the status of each step, with green indicating successful completion and red indicating failure. The figure is used to demonstrate the process of establishing a session in a telecommunication network, which is an essential step in ensuring secure communication.\nFigure 5.2.2.1.6.1: Message sequence chart for session establishment (PSTN initiated)\n1.\tThe session is originated from the PSTN.\n2.\tThe session setup is triggered in the IMS.\n3.\tThe destination party answers and a final response are received.\n4.\tMGCF forwards an answer message to the PSTN.\n5.\tUpon reception of the final response, the MGCF sends an Charging Data Request[Start] to record start of a user session and start of a media component in the MGCF CDR.\n6.\tThe CDF acknowledges the reception of the data and opens a MGCF CDR.\n\nFigure 5.2.2.1.7.1 shows the Charging Data transactions that are required between BGCF, MGCF and CDF during session establishment initiated from the IMS side.\nThe figure depicts a message sequence chart for session establishment in the Internet Mobile System (IMS) protocol. It illustrates the flow of data packets, including the header and payload, as they travel through the network. The chart is divided into different sections, each representing a different step in the session establishment process. The figure is crucial for understanding the IMS protocol and its role in mobile communication.\nFigure 5.2.2.1.7.1: Message sequence chart for session establishment (IMS initiated)\n1.\tThe session is originated from the IMS.\n2.\tA session towards PSTN is established.\n3.\tThe destination party answers and an answer message are received.\n4.\tA final response message is sent to the session originator.\n5.\tUpon reception of the answer message, the MGCF sends an Charging Data Request[Start] to record start of a user session and start of a media component in the MGCF CDR.\n6.\tThe CDF acknowledges the reception of the data and opens a MGCF CDR.\n7.\tUpon reception of the SIP 200 OK message, the BGCF sends an Charging Data Request[Event] to create a BGCF CDR.\n8.\tThe CDF acknowledges the reception of the data and creates a BGCF CDR.\n\nFigure 5.2.2.1.8.1 shows the Charging Data transactions that are required between MGCF and CDF during a PSTN initiated session release.\nThe figure depicts a message sequence chart for session release (PSTN initiated), illustrating the flow of messages between the sender and receiver. The chart includes various components such as the sender, receiver, and session, with arrows indicating the direction of the message flow. The figure is used to understand the communication process and identify any potential issues or errors that may occur during the session release process.\nFigure 5.2.2.1.8.1: Message sequence chart for session release (PSTN initiated)\n1.\tThe session release is initiated from PSTN.\n2.\tSession release continues within IMS.\n3.\tThe reception of the release message is acknowledged.\n4.\tUpon reception of the release message, the MGCF sends an Charging Data Request[Stop] to record stop of a session in the MGCF CDR.\n5.\tThe CDF acknowledges the reception of the data and closes the MGCF CDR.\n\nFigure 5.2.2.1.9.1 shows the Charging Data transactions that are required between MGCF and CDF during an IMS initiated session release.\nThe figure depicts a message sequence chart for session release (IMS initiated) in a 5G network. It illustrates the flow of messages from the sender to the receiver, including the initiation of the session, the transmission of the session key, and the release of the session. The chart is a visual representation of the complex network architecture, highlighting the role of session identifiers and session keys in the 5G network.\nFigure 5.2.2.1.9.1: Message sequence chart for session release (IMS initiated)\n1.\tThe session release is initiated from the IMS side.\n2.\tA release message is sent towards PSTN.\n3.\tThe acknowledgement of the release message is received from PSTN.\n4.\tUpon reception of the SIP BYE message the MGCF sends an Charging Data Request[Stop] to record stop of a session in the MGCF CDR.\n5.\tThe CDF acknowledges the reception of the data and closes the MGCF CDR.\nFigure 5.2.2.1.10.1 shows the establishment of an ad hoc conference (multiparty call). An AS (acting as B2BUA) performs third party call control with the MRFC, where the S-CSCF is in the signalling path. The AS that is in control of the ad hoc conference is aware of the MRFC capabilities. Note that only accounting information sent from the MRFC is shown in detail in figure 5.2.2.1.10.1. The SIP messages are for illustrative purpose only.\nThe figure depicts a message sequence chart for Multi-Party Caching Establishment in MRFC, illustrating the communication flow between different parties involved in the caching process.\nFigure 5.2.2.1.10.1: Message sequence chart for Multi-party call establishment in MRFC\n1.\tSessions exist between UE-1 and UE-2, and between UE-1 and UE-3. A request is received from UE-1for putting all parties together to a multi-party call.\n2. - 3.\tRequest and acknowledgement to initiate multi-party call. MRFC assigns a conference-ID that is used by the AS in subsequent interactions with the MRFC in SIP INVITE messages connecting other endpoints (see TS 23.228 [201]). Path establishment between AS and MRFC for UE-2.\n4.\tAt start of session establishment the MRFC sends an Charging Data Request[ Start] to record start of multi-party call in the MRFC CDR\n5.\tThe CDF acknowledges the reception of the data and creates the MRFC CDR. 'Calling Party Address', 'Service Request Time Stamp', 'Service ID' (holding the conference-ID) etc. are included in the MRFC CDR\n6 - 7.\tPath establishment between UE-2 and AS. Same ICID is used as for the path between AS and MRFC for UE-2 (step 2. - 3.).\n8\tAcknowledgement of path between AS and MRFC for UE-2.\n9.\tThe MRFC may send an Charging Data Request[Interim] to report that UE-2 has been connected to the multi-party call.\n10.\tThe CDF acknowledges the reception of the data and includes UE-2 in the field 'Application Provided Called Parties' of the MRFC CDR.\n11.\tAcknowledgement of path between AS and UE-2. Now a path between UE-2 and MRFP via AS is established.\n12 –13.\t Request and acknowledgement to establish path between AS and MRFC for UE-3.\n14. -15.\tPath establishment between UE-3 and AS. Same ICID is used as for the path between AS and MRFC for UE-3 (step 12. - 13.).\n16.\tAcknowledgement of path between AS and MRFC for UE-3.\n17.\tThe MRFC may send an Charging Data Request[Interim] to report that UE-3 has been connected to the multi-party call.\n18.\tThe CDF acknowledges the reception of the data and includes UE-3 in a new field 'Application Provided Called Parties' of the MRFC CDR.\n19.\tAcknowledgement of path between AS and UE-3.\n20 - 21.\tRequest and acknowledgement to establish path between AS and MRFC for UE-1. Same ICID is used as for the path between UE-1 and AS (step 1.).\n22 - 23.\tRequest for multi-party conference with UE-2 and UE-3 is acknowledged to UE 1. Implicit acknowledgement of path UE-1 to AS.\n24.\tAcknowledgement of path between AS and MRFC for UE-1.\n25.\tThe MRFC may send an Charging Data Request[Interim] to report that UE-1 has been connected to the Multi-Party call.\n26.\tThe CDF acknowledges the reception of the data and includes the field 'Service Delivery Start Time Stamp' into the MRFC CDR.\n27. - 28.\tUE-1 acknowledges the multi-party call session establishment.\n\nNOTE:\tIt is in the responsibility of the AS to terminate the sessions existing at the beginning of the multi-party call establishment between UE-1 and UE-2 and between UE-1 and UE-3 (see step 1.) in case of successful multi-party call establishment. This is not shown in the diagram above.\nASs may support a multitude of services which are not specified in 3GPP standards. Therefore it is not possible to standardise charging flows and procedures for those services. However, for all such services, the AS may apply either event charging, where Charging Data Request [event] messages are generated, or Session Charging, using Charging Data Request [start, stop and interim]. The following clauses depict one example for each of the two scenarios. The first procedure, AS acting as a redirect server, depicts the \"event\" case, while the second procedure, AS acting as a voice mail server, depicts the \"session\" case.\nFigure 5.2.2.1.11.1 shows the case where an AS acts as a redirect server. In the figure below, UE-1 sets up a session towards UE-2 but due to Call Forwarding functionality located in the AS, a new number (to UE-3) is returned to UE-1. Finally UE-1 sets up the session towards UE-3.\nThe figure depicts a message sequence chart for an AS (Access Server) acting as a relay server, illustrating the flow of data between the sender and receiver. The chart includes various components such as the sender, receiver, and relay servers, as well as the path of the data through the network. The use of arrows and labels helps to visualize the data flow and ensure clarity in the message sequence.\nFigure 5.2.2.1.11.1: Message sequence chart for AS acting as a redirect server\n1.\tSessions initiated by UE-1 towards UE-2.\n2. - 3.\tResponse indicating that session should be redirected towards another number (UE-3).\n4.\tAfter successful service execution, the AS sends  Charging Data Request[Event] to record service specific information in the AS CDR.\n5.\tThe CDF acknowledges the reception of the data and creates the AS CDR.\n6-7.\tResponse indicating that session should be redirected towards another number (UE-3).\n8.\tSession is initiated by UE-1 towards UE-3.\n\nFigure 5.2.2.1.12.1 shows the case where an AS acts as a voice mail server. S-CSCF invokes the AS acting as Voice Mail Server according to procedure as defined in TS 23.218 [203].\nThe figure depicts a message sequence chart for an AS (Application Service) as a message server, illustrating the flow of messages between different components within the network.\nFigure 5.2.2.1.12.1: Message sequence chart for AS acting as a mail server\n1.\tAS receives the SIP INVITE from the S-CSCF.\n2.\tAS acknowledges the initiated Voice Mail session by issuing a SIP 200 OK in response to the SIP INVITE.\n3.\tAS sends  Charging Data Request[Start] to record start of a voice mail session.\n4.\tThe CDF acknowledges the reception of the  Charging Data Request[Start] and opens an AS CDR.\n5.\tVoice mail session release is initiated.\n6.\tUpon reception of release message AS sends an Charging Data Request[Stop] to record stop of a session in the AS CDR.\n7.\tThe CDF acknowledges the reception of the data and closes the AS CDR.\n\nService continuity using SCC AS call flows with alternative \"OneChargingSession\" option reflected in the different flows description, i.e. a single charging session from SCC AS.\nIn the flow figure 5.2.2.1.13.1.1, Call-ID #1 is for access leg and Call-ID #2 is for remote leg.\n\nThe figure depicts a call sequence in a 5G network, showing the message exchange between the sender and the receiver. The sequence includes the sender's call setup, the call initiation, the call progress, and the call termination. The figure illustrates the use of various signaling protocols, such as G.711, G.729, and G.729.1, to ensure efficient communication.\nFigure 5.2.2.1.13.1.1: Message sequence chart UE originating call\n1. The SCC session is initiated (an SIP INVITE for IMS, a call setup for CS).\n2. After processing at CS/PS intermediate nodes, the resulting SIP INVITE is sent to the S-CSCF\n3. The S-CSCF validates the service profile, and invokes any appropriate service logic required for this user.\n4. The S-CSCF forwards the SIP INVITE request message to the SCC AS, according to the service origination logic defined by initial Filter Criteria (iFC) in the subscriber profile of the HSS.\n5. The SCC call is anchored at the SCC AS in the home IMS Domain upon reception of the SIP Invite (Call-ID# 1).\n6-7. The S-CSCF forwards the SIP INVITE request message to the terminating network (Call-ID #2).\n8. The response SIP 200 OK is transmitted to the S-CSCF in the Originating network.\n9. Upon reception of the final response, the S-CSCF in the originating network sends an Charging Data Request[Start] to record SCC call routing and start of a user session/media component in the S-CSCF CDR.\n10-11. The CDF from the Originating network opens a S-CSCF CDR related to the Remote leg and acknowledges the reception of the data.\n12. Same as 8 but for  (Remote leg)\n13. Same as 9 but for the SCC AS (Remote leg)\n14-15. Same as 10-11 but opening a SCC AS CDR related to the Remote leg\n13-14a-15. Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Start] to record SCC call routing and start of a user session/media components in the SCC AS CDR for the IMS session (ICID) with access leg and remote leg. The CDF opens a SCC AS CDR related to the IMS session, and acknowledges the reception of the data.\n16. Same as 8 but for  (Access leg)\n17. Same as 9 but for the SCC AS (Access leg) .\n18-19. Same as 10-11 but opening a SCC AS CDR (Access leg).\nSteps 17 to 19 are not applicable for the \"OneChargingSession\" option.\n20. Same as 9 but for the S-CSCF (Access leg)\n21-22. Same as 10-11 but opening a S-CSCF CDR (Access leg)\n23. The final response to SIP Invite (Call ID #1) is transmitted.\n24. The session is set up with CS or PS media.\nFor IMS Emergency session over PS, the same flow applies in the UE serving Network, between the E-CSCF (instead of S-CSCF) and the EATF (Emergency Access Transfer Function, instead of ), with E-CSCF and EATF CDRs opened for access and remote legs.\nEATF (acting as a B2BUA) performs third party call control and is considered as an AS for the charging description.\nIn the flow figure 5.2.2.1.13.2.1, Call-ID #1 is for PS access leg, Call-ID #1' for CS access leg and Call-ID #2 for remote leg.\n\n\nFigure 5.2.2.1.13.2.1: Message sequence chart UE originating call\n1. UE-1 wants to initiate a multimedia session with UE-2 with speech components carried on CS bearers and non-speech components carried on PS bearers. Therefore the multimedia session is split into two parts, each one corresponding to a separate access leg. UE-1 initiates the establishment of the first access leg by sending an SIP INVITE request with non-speech media components. The SIP INVITE contains STI information indicating that a second access leg (with the speech component) will be originated from the CS domain.\n2. The S-CSCF executes any service logic as appropriate.\n3. The S-CSCF sends the SIP INVITE to the SCC AS. The SCC AS identifies that this access leg has to be correlated to a subsequent access leg based on the STI information in the SIP INVITE.\n4. UE-1 request to set up call with CS bearer. The called party number is set to an identifier such as a PSI DN, which is used to indicate to the SCC AS that this access leg is to be combined with a PS leg. \nThe DN is either statically configured on the UE or assigned to the UE by the network upon IMS Registration.\n5. After processing at ICS/Interworking nodes, the resulting SIP INVITE is sent to the S-CSCF.\n6. The S-CSCF executes any service logic as appropriate.\n7. The S-CSCF sends the SIP INVITE to the SCC AS. The SCC AS identifies that this CS leg has to be correlated to a PS leg based on the iFC in the SIP INVITE.\n8. After the SCC AS receives both the SIP INVITE requests in step 3 and in step 7, the SCC AS identifies that they are part of the same multimedia session and combines the two access legs of the session by checking the caller's identity and anchor the combined session.\n9-10. The SCC AS sends SIP INVITE to the remote end point for combined session establishment.\n11. The SIP 200 OK response is transmitted to the S-CSCF in the Originating network.\n12. Upon reception of the final response, the S-CSCF in the originating network sends an Charging Data Request[Start] to record SCC call routing and start of a user session/media component in the S-CSCF CDR.\n13-14. The CDF from the Originating network opens an S-CSCF CDR related to the Remote leg and acknowledges the reception of the data.\n15. Same as 11 but for  (Remote leg)\n16. Same as 12 but for the SCC AS (Remote leg)\n17-18. Same as 13-14 but opening a SCC AS CDR related to the Remote leg\n16-17a-18 Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Start] to record start of the SCC AS CDR for the IMS session (ICID) with the CS access leg, PS access leg and the Remote leg. The CDF opens a SCC AS CDR related to the IMS session, and acknowledges the reception of the data.\n19. Same as 11 but for S-CSCF (Access leg)\n20. Same as 12 but for the SCC AS (Access leg)\n21-22. Same as 13-14 but opening a SCC AS CDR for the PS access leg.\nSteps 20 to 22 are not applicable for the \"OneChargingSession\" option.\n23. Same as 12 but for the S-CSCF (Access leg)\n24-25. Same as 13-14 but opening a S-CSCF CDR for the PS access leg.\n26. Same as 11 but for  (Access leg).\n27. Same as 12 but for the SCC AS (Access leg).\n28-29. Same as 13-14 but opening a SCC AS CDR for the CS access leg.\nSteps 27 to 29 are not applicable for the \"OneChargingSession\" option.\n29. Same as 12 but for the S-CSCF (Access leg)\n30-31. Same as 13-14 but opening a S-CSCF CDR for the CS access leg.\n32. The final SIP 200 OK response is sent to the UE #1\n33. The SIP 200 OK response is sent to the ICS intermediate nodes.\n34. The completion of the CS call bearer is done.\nIn the flow figure 5.2.2.1.13.3.1, Call-ID #1 is for PS access leg and Call-ID #2 for remote leg.\nThe figure depicts a call termination scenario in a 5G network, showing the message sequence, call head, and terminating call. The figure illustrates the use of a 5G network's advanced signaling and control technologies to enable efficient call termination.\nFigure 5.2.2.1.13.3.1: Message sequence chart UE terminating call\n1. The SCC session is initiated by UE #2 sending an SIP INVITE to S-CSCF.\n2. The S-CSCF validates the service profile, and invokes any appropriate service logic required for this user.\n3. The S-CSCF forwards the SIP INVITE request message to the SCC AS, according to the service origination logic defined by initial Filter Criteria (iFC) in the subscriber profile of the HSS.\n4. The SCC call is anchored at the SCC AS in the home IMS Domain upon reception of the SIP INVITE (Call ID #2).\n5-6-7. The S-CSCF forwards the SIP INVITE request message to the terminating network (Call ID #1). After processing at CS/PS intermediate nodes, the resulting message is sent to UE #1.\n8. The response SIP 200 OK is transmitted to CS/PS intermediate nodes.\n9. After processing at CS/PS intermediate nodes, the SIP 200 OK message is sent to S-CSCF.\n10. Upon reception of the final response, the S-CSCF in the originating network sends an Charging Data Request[Start] to record SCC call routing and start of a user session/media component in the S-CSCF CDR.\n11-12. The CDF from the Originating network opens an S-CSCF CDR related to the Access leg and acknowledges the reception of the data.\n13. Same as 9 but for  (Access leg)\n14. Same as 10 but for the SCC AS (Access leg)\n15-16. Same as 11-12 but opening a SCC AS CDR related to the Access leg\n14-15a-16. Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Start] to record SCC call routing and start of a user session/media components in the SCC AS CDR for the IMS session (ICID) with access leg and remote leg.  The CDF opens a SCC AS CDR related to the IMS session and acknowledges the reception of the data.\n17. Same as 9 but for  (Remote leg)\n18. Same as 10 but for the SCC AS (Remote leg) .\n19-20. Same as 11-12 but opening a SCC AS CDR (Remote leg).\nSteps 18 to 20 are not applicable for the \"OneChargingSession\" option.\n21. Same as 10 but for the S-CSCF (Remote leg)\n22-23. Same as 11-12 but opening a S-CSCF CDR (Remote leg)\n24. The final response to SIP INVITE (Call ID #2) is transmitted.\nIn the flow figure 5.2.2.1.13.4.1, Call-ID #1 is for PS access leg, Call-ID #1' for CS access leg and Call-ID #2 for remote leg.\n\nThe figure depicts a call termination scenario in a 5G network, showing the message sequence, call head, and terminating call. The figure illustrates the use of a call termination mechanism, which is crucial for ensuring reliable communication in a 5G network.\nFigure 5.2.2.1.13.4.1: Message sequence chart UE terminating call\n1. UE-2 sends SIP INVITE to UE-1 to establish a session with both speech and non-speech components.\n2. The S-CSCF executes any service logic as appropriate.\n3. The S-CSCF sends the SIP INVITE to the SCC AS. The SCC AS identifies that this access leg has to be correlated to a subsequent access leg based on the ST information in the SIP INVITE.\n4. The session is anchored at the SCC AS. Based on operator policy and on information indicating that UE-1 is accessible over both the PS and CS domains, the SCC AS decides to split the session over PS and CS domains. This behaviour is similar to the behaviour of a CSI AS specified in TS 23.279.\n5-6. The SCC AS sends SIP INVITE for the non-speech part of the session. The SIP INVITE contains STI information indicating that the speech component will be established from the CS domain.\n7-8. The SCC AS sends SIP INVITE for the speech part of the session and the S-CSCF forwards the SIP INVITE to the ICS/Interworking nodes.\n9. The ICS/Interworking nodes set up call to UE-1 with CS bearer.\n10-18. A 200 OK response is sent to the S-CSCF. The speech and non-speech part of the session is established.\n11. Upon reception of the response, the S-CSCF in the originating network sends an Charging Data Request[Start] to record SCC call routing and start of a user session/media component in the S-CSCF CDR.\n12-13. The CDF from the Originating network opens an S-CSCF CDR related to the PS Access leg and acknowledges the reception of the data.\n14. Same as 10 but for  (Access leg)\n15. Same as 11 but for the SCC AS (Access leg)\n16-17. Same as 12-13 but opening a SCC AS CDR related to the PS Access leg.\n15-16a-17. Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Start] to record start of the SCC AS CDR for the IMS session (ICID) with the PS access leg and the Remote leg. The CDF opens the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\n19. Upon reception of the response, the S-CSCF in the originating network sends an Charging Data Request[Start] to record SCC call routing and start of a user session/media component in the S-CSCF CDR.\n20-21. The CDF from the Originating network opens an S-CSCF CDR related to the CS Access leg and acknowledges the reception of the data.\n22. Same as 10 but for  (Access leg)\n23. Same as 11 but for the SCC AS (Access leg)\n24-25. Same as 12-13 but opening a SCC AS CDR related to the CS Access leg.\n23-24a-25. Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Interim] to record modification of the SCC AS CDR for the IMS session (ICID) with the CS access leg. The CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\n26. Same as 10 but for S-CSCF (Remote leg)\n27. Same as 11 but for the SCC AS (Remote leg)\n28-29. Same as 12-13 but opening a SCC AS CDR for the Remote leg.\nSteps 27 to 29 are not applicable for the \"OneChargingSession\" option.\n30. Same as 11 but for the S-CSCF (Remote leg)\n31-32. Same as 12-13 but opening a S-CSCF CDR for the Remote leg.\n33. The SIP 200 OK response is sent to the UE #2.\n\nIn the flow figure 5.2.2.1.13.5.1, Call-ID #1 is for PS access leg, Call-ID #1' for CS access leg and Call-ID #2 for remote leg.\n\nThe figure depicts a message sequence in a 5G network, with the message being transmitted from the source to the destination, and the path to the access point (PS) and the access point to the core network (CS) being shown. The figure illustrates the hierarchical structure of the network, with the core network being the highest level of the network hierarchy.\nFigure 5.2.2.1.13.5.1: Message sequence chart UE domain transfer PS access to CS access\nThe user is engaged in an active multimedia session with UE-2 via PS access.\n1-2. UE-1 originates a multimedia call in the CS domain including the STN information to request the real time media transfer to CS access.\n3. The ICS intermediate Nodes convert the request into IMS SIP format and then forward the converted request to the S-CSCF.\n4. The S-CSCF invokes the SCC Application as the first AS of any ASs that need to remain in the path of the call after session transfer.\n5. The S-CSCF forwards the SIP INVITE to the SCC Application over the ISC interface.\n6 The SCC AS analyses the SIP INVITE to derive that the SIP INVITE is a request to transfer a multimedia session with video and voice media components to the PS domain.\n7-9. The SCC AS sends a SIP RE-INVITE to the Remote UE to update the media components of the previous dialog.  Remote UE answers by a SIP 200 OK message.\n10-12. At Remote Leg update the S-CSCF in the originating network sends  Charging Data Request[Interim] to record update of a session in the S-CSCF CDR.\n13. The S-CSCF answers to the SIP INVITE message in 7.\n14-16. At Remote Leg update the SCC AS sends  Charging Data Request[Interim] to record update of a session in the SCC AS CDR.\n14-15a-16. Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Interim] to record modification of SCC AS CDR for the IMS session (ICID) with the new legs configuration (Remote leg and new CS access leg).The CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\n17. The SCC AS answers to the SIP INVITE message in 5.18-20. Upon generation of the SIP 200 OK response, the SCC AS in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the SCC AS-CDR for Call-ID #1'. The CDF from the originating network opens an AS CDR and acknowledges the reception of the data.\nSteps 18 to 20 are not applicable for the \"OneChargingSession\" option.\n21-23. Upon generation of the SIP 200 OK response, the S-CSCF in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the S-CSCF-CDR for Call-ID #1'. The CDF from the originating network opens an S-CSCF CDR and acknowledges the reception of the data.\n24. The SIP 200 OK response is sent by the S-CSCF.\n25. The SIP 200 OK response is converted by the ICS/Interworking nodes in CS format.\n26-28. The UE #1 acknowledges by sending an ACK message to the SCC AS.\n29-31. The SCC Application sends BYE request to release the old access leg.\n32-34. At session termination the SCC AS sends Charging Data Request[Stop] to record stop of a session and stop of a media component in the SCC AS CDR. This CDR may be generated with special handling. One example of special handling is to zero rate the IMS resource usage for the Access leg establishment.\nSteps 32 to 34 are not applicable for the \"OneChargingSession\" option.\n35-37. The S-CSCF in the originating network sends  Charging Data Request[Stop] for closing the S-CSCF CDR related to the initial Access leg. This CDR may be generated with special handling. One example of special handling is to zero rate the IMS resource usage for Access leg establishment. This can be performed using the correlation mechanism with the SCC AS CDR for Access leg.\n38-40. The UE-1 acknowledges the release of old access leg.\n\nIn the flow figure 5.2.2.1.13.6.1, Call-ID #1 is for PS access leg, Call-ID #1' for CS access leg and Call-ID #2 for remote leg.\n\nThe figure depicts a message sequence in a 5G network, with the message being transmitted from the source to the destination, and the access point (AP) being the point of access for the message. The figure also shows the communication path, including the core switches, optical line terminals (OLTs), and distributed nodes, which are essential components of the network architecture.\nFigure 5.2.2.1.13.6.1: Message sequence chart UE domain transfer CS access to PS access\nThe user is engaged in an active multimedia session with UE-2 via CS access.\n1. UE-1 originates a call in the PS domain including the STI to request the multimedia session transfer to PS access in conjunction with CS access.\n2. The session establishment request is routed to the S-CSCF by the P-CSCF.\n3. The S-CSCF invokes the SCC Application as the first AS of any ASs that need to remain in the path of the call after session transfer.\n4. The S-CSCF forwards the SIP INVITE to the SCC Application over the ISC interface.\n5. The SCC Application analyses the SIP INVITE to derive that the SIP INVITE is a request to transfer a multimedia session with video and voice media components to the PS domain.\n6-8. The SCC AS sends a SIP RE-INVITE to the Remote UE to update the media components of the previous dialog.  Remote UE answers by a SIP 200 OK message.\n9-11. At Access Leg update the S-CSCF in the originating network sends Charging Data Request[Interim] to record update of a session in the S-CSCF CDR.\n12. The S-CSCF answers to the SIP INVITE message in 6.\n13-15. At Access Leg update the SCC AS sends Charging Data Request[Interim] to record update of a session in the SCC AS CDR.\n13-14a-15. Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Interim] to record modification of SCC AS CDR for the IMS session (ICID) with the new legs configuration (Remote leg and new PS access leg).The CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\n16. The SCC AS answers to the SIP INVITE message in 4.\n17-19. Upon generation of the final response, the SCC AS in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the SCC AS-CDR. The CDF from the originating network opens an AS CDR and acknowledges the reception of the data.\nSteps 17 to 19 are not applicable for the \"OneChargingSession\" option.\n20-22. Upon generation of the final response, the S-CSCF in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the S-CSCF-CDR. The CDF from the originating network opens an S-CSCF CDR and acknowledges the reception of the data.\n23. The S-CSCF answers to the SIP INVITE message in 2.\n24-25. The SIP 200 OK is acknowledged.\n26-28. The SCC Application sends BYE request to release the old access leg. 29-31 The SCC AS sends Charging Data Request[Stop] for closing the SCC AS CDR related to the original Access leg. The CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data\nSteps 29 to 31 are not applicable for the \"OneChargingSession\" option.\n32-34. The S-CSCF sends Charging Data Request[Stop] for closing the S-CSCF CDR related to the original Access leg. This CDR may be generated with special handling. One example of special handling is to zero rate the IMS resource usage for Access leg establishment. This can be performed using the correlation mechanism with the SCC AS CDR for Access leg.\n35-37. The UE-1 acknowledges the release of old access leg.\n\nIn the flow figure 5.2.2.1.13.7.1, Call-ID #1 is for PS2 access leg, Call-ID #1' for PS1 access leg, Call-ID #1\" for CS access leg and Call-ID #2 for remote leg.\n\n\nFigure 5.2.2.1.13.7.1: Message sequence chart UE domain transfer PS2 access to PS1 and CS access.\n1-2. UE-1 originates a call in the PS1 domain including the STI to request the multimedia session transfer to PS1 access in conjunction with CS access.\n3. The session establishment request is routed to the S-CSCF by the P-CSCF.\n4. The S-CSCF invokes the SCC Application as the first AS of any ASs that need to remain in the path of the call after session transfer.\n5. The S-CSCF forwards the SIP INVITE to the SCC Application over the ISC interface.\n6. The SCC Application analyses the STI and decides to wait for the session transfer request in CS access.\n7. UE-1 origins a CS call including STN to indicate to the network that this is a session transfer request.\n8. The ICS intermediate Nodes convert the request into IMS SIP format and then forward the converted request to the S-CSCF.\n9. The S-CSCF forwards the SIP INVITE to the SCC Application over the ISC interface.\n10. The SCC Application correlates the two requests and decides to update the remote leg.\n11-13. The SCC AS sends a SIP RE-INVITE to the Remote UE to modify the media components of the existing dialog identified in the REFER request. \nThe SIP RE-INVITE proposes new SDP parameters based on the parameters received from UE-2 in step 6. \nWhen the Remote UE receives the new media parameters, it returns an answer and starts the reception/transmission of these media components.\n14-16. At Access Leg update the S-CSCF in the originating network sends Charging Data Request[Interim] to record update of a session in the S-CSCF CDR.\n17. The S-CSCF answers to the SIP INVITE message in 11.\n18-20. At Access Leg update the SCC AS sends Charging Data Request[Interim] to record update of a session in the SCC AS CDR\n18-19a-20. Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Interim] to record modification of SCC AS CDR for the IMS session (ICID) with the new PS access leg, new CS access leg and Remote leg. \nThe CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\n21. The S-CSCF answers to the SIP INVITE message in 5.\n22-24. Upon generation of the final response, the SCC AS in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the SCC AS-CDR for Call-ID #1'. \nThe CDF from the originating network opens an AS CDR and acknowledges the reception of the data.\nSteps 22 to 24 are not applicable for the \"OneChargingSession\" option.\n25-27. Upon generation of the final response, the S-CSCF in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the S-CSCF-CDR for Call-ID #1'. The CDF from the originating network opens an S-CSCF CDR and acknowledges the reception of the data.\n28-29. The S-CSCF accepts session continuity message from the Remote UE by sending a SIP 200 OK response (for the PS1 INVITE message).\n30-32. UE-1 sends an ACK response to the SCC AS.\n33. The S-CSCF answers to the SIP INVITE message in 9.\n34-36. Upon generation of the final response, the SCC AS in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the SCC AS-CDR for Call-ID #1\". The CDF from the originating network opens an AS CDR and acknowledges the reception of the data.\nSteps 34 to 36 are not applicable for the \"OneChargingSession\" option.\n37-39. Upon generation of the final response, the S-CSCF in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the S-CSCF-CDR for Call-ID #1\". The CDF from the originating network opens an S-CSCF CDR and acknowledges the reception of the data.\n40-41. The S-CSCF accepts session continuity message from the Remote UE by sending a SIP 200 OK response (for the CS INVITE message).\n42-44. UE-1 sends an ACK response to the S-CSCF.\n45. Once acknowledgment has been received for the both leg, the ACK message is sent to the remote UE.\n46-48. The SCC Application initiates to release the old access leg.\n49-51. The SCC AS sends Charging Data Request[Stop] for closing the SCC AS CDR related to the original Access leg. The CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\nSteps 49 to 51 are not applicable for the \"OneChargingSession\" option.\n52-54. The S-CSCF sends Charging Data Request[Stop] for closing the S-CSCF CDR related to the original Access leg. This CDR may be generated with special handling. One example of special handling is to zero rate the IMS resource usage for Access leg establishment. This can be performed using the correlation mechanism with the SCC AS CDR for Access leg.\n55-56. The UE answers by a SIP 200 OK message to the S-CSCF.\n57. The S-CSCF sends a SIP 200 OK message to the SCC AS the releasing of the old access leg.\n\nIn the flow figure 5.2.2.1.13.8.1, Call-ID #1 is for PS2 access leg, Call-ID #1' for CS access leg, Call-ID #1\" for PS1 access leg and Call-ID #2 for remote leg.\n\nThe given telecommunication figure depicts a message sequence in a 5G network, with a focus on the UE (User Equipment) and the PS (Physical Service) access paths. The figure illustrates the various components involved in the communication process, including the base station (gNB), user equipment (UE), and scatterers. The diagram highlights the use of beamforming techniques to mitigate interference, and the layered architecture of the optical backbone ensures redundancy and failover reliability.\nFigure 5.2.2.1.13.8.1: Message sequence chart UE domain transfer PS2 access and CS access to PS1 access\n1-2. UE-1 originates a call in the PS1 domain including the STI to request the multimedia session transfer to PS1 access.\n3. The session establishment request is routed to the S-CSCF by the P-CSCF.\n4. The S-CSCF invokes the SCC Application as the first AS of any ASs that need to remain in the path of the call after session transfer.\n5. The S-CSCF forwards the SIP INVITE to the SCC Application over the ISC interface.\n6. The SCC Application analyses the STI and decides to update the Remote leg.\n7-9. The SCC AS sends a SIP RE-INVITE to the Remote UE to modify the media components of the existing dialog identified in the REFER request. \nThe SIP RE-INVITE proposes new SDP parameters based on the parameters received from UE-2 in step 6. \nWhen the Remote UE receives the new media parameters, it returns an answer and starts the reception/transmission of these media components.\n10-12. At Access Leg update the S-CSCF in the originating network sends Charging Data Request[Interim] to record update of a session in the S-CSCF CDR.\n13. The S-CSCF answers to the SIP INVITE message in step 7.\n14-16. At Access Leg update the SCC AS sends Charging Data Request[Interim] to record update of a session in the SCC AS CDR.\n14-15a-16. Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Interim] to record modification of SCC AS CDR for the IMS session (ICID) with remote leg and new PS access leg. The CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\n17. The SCC AS answers to the SIP INVITE message in step 5.\n18-20. Upon generation of the final response, the SCC AS in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the SCC AS-CDR. The CDF from the originating network opens an AS CDR and acknowledges the reception of the data.\nSteps 18 to 19 are not applicable for the \"OneChargingSession\" option.\n21-23. Upon generation of the final response, the S-CSCF in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the S-CSCF-CDR. The CDF from the originating network opens an S-CSCF CDR and acknowledges the reception of the data.\n24. The S-CSCF answers to the SIP INVITE message in step 3.\n25. The SIP 200 OK message is sent to UE #1.\n26-30. UE-1 sends an ACK response to the S-CSCF. The ACK message is sent to the remote UE.\n31-33. The source Access Leg 2(which is one of the Access Legs previously established over PS2) is released by the SCC Application in this example, however the UE-1 may initiate to release the source Access Leg 2.\n34-36. The SCC AS sends Charging Data Request[Stop] for closing the SCC AS CDR related to the original Access leg. The CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\nSteps 34 to 36 are not applicable for the \"OneChargingSession\" option.\n37-39. The S-CSCF sends Charging Data Request[Stop] for closing the S-CSCF CDR related to the original PS Access leg. This CDR may be generated with special handling. One example of special handling is to zero rate the IMS resource usage for Access leg establishment. This can be performed using the correlation mechanism with the SCC AS CDR for PS Access leg.\n40-42. The UE-1 answers to the BYE message in step 33.\n43-45. The SCC Application initiates to release the old access leg via CS access in this example, however the UE-1 may initiate to release the source Access Leg.\n46-48. The SCC AS sends Charging Data Request[Stop] for closing the SCC AS CDR related to the original CS Access leg. The CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\nSteps 46 to 48 are not applicable for the \"OneChargingSession\" option.\n49-51. The S-CSCF sends Charging Data Request[Stop] for closing the S-CSCF CDR related to the original CS Access leg. This CDR may be generated with special handling. One example of special handling is to zero rate the IMS resource usage for Access leg establishment. This can be performed using the correlation mechanism with the SCC AS CDR for CS Access leg.\n52-54. The UE-1 answers to the BYE message in step 43.\n\nIn the flow figure 5.2.2.1.13.9.1, Call-ID #1 is for PS access leg, Call-ID #1' for CS access leg and Call-ID #2 for remote leg.\nThe given telecommunication figure depicts a message sequence in a 5G network, with a focus on the UE (User Equipment) and the access paths to the CS (Control Session) and PS (Physical Session) access points. The figure illustrates the hierarchical structure of the network, with the UE initiating the session and the access paths to the CS and PS access points being highlighted. The figure also includes a dashed line to represent redundancy paths, ensuring failover reliability. The layered design of the network aligns with SDN principles, allowing for efficient network management and control.\nFigure 5.2.2.1.13.9.1: Message sequence chart UE domain transfer PS access to CS access for IMS emergency session.\n1-2. UE originates an IMS emergency session transfer towards EATF via I-CSCF.\n3. From the received INVITE analysis, the EATF derives a request for transfer of the existing IMS emergency session to the CS domain, and proceeds with switch of access leg communicating with the Remote Leg from Old PS Access Leg to new CS Access Leg.\n4-5. The EATF performs the Remote Leg update by sending the SIP RE-INVITE request towards the remote end vie E-CSCF.\n6-8 Upon receipt of the SIP 200 OK response, the E-CSCF sends an Charging Data Request[Interim] to record update of the E-CSCF CDR for remote leg Call-ID #2.\n9-11 Upon receipt of the SIP 200 OK response, the EATF sends an Charging Data Request[Start] to record start of an EATF CDR for new access leg Call-ID #1'. Alternatively, when \"OneChargingSession\", the EATF sends an Charging Data Request[Interim] to record modification of EATF CDR for the IMS session (ICID) with new CS access leg. The CDF updates the EATR CDR related to the IMS session and acknowledges the reception of the data.\n12-14 Upon receipt of the SIP 200 OK response, the I-CSCF sends an Charging Data Request[Event] to create an I-CSCF CDR for new access leg Call-ID #1'.\n15. The SIP 200 OK response is sent towards the UE via ICS/Interworking nodes.\n16-17 Upon release of old access leg, the EATF sends an Charging Data Request[Stop] to record stop of the EATF CDR for old access leg Call-ID #1.\nSteps 16 to 17 are not applicable for the \"OneChargingSession\" option.\n18-19 Upon release of old access leg, the E-CSCF sends an Charging Data Request[Stop] to record stop of the E-CSCF CDR for old access leg Call-ID #1.\n\nEATF (acting as a B2BUA) performs third party call control and is considered as an AS for the charging description.\nIn the flow figure 5.2.2.1.13.10-1, Call-ID #1 is for source access leg, Call-ID #1' for target access leg and Call-ID #2 for remote leg.\nThe given telecommunication figure depicts a message sequence chart for inter-UE transfer triggered by a target UE without a collaborative session establishment. The chart illustrates the sequence of messages exchanged between the sender and receiver, with the target UE being the one initiating the transfer. The figure is labeled as \"Figure 5.2.2.1.13.10 - 1\" and is part of a larger set of figures that includes \"Figure 5.2.2.1.13.10 - 1\" and \"Figure 5.2.2.1.13.10 - 2\".\nFigure 5.2.2.1.13.10-1 Message sequence chart Inter-UE transfer triggered by target UE without collaborative session establishment\nThe user is engaged in an active call session with UE#2 via either PS or CS access. UE#2 is having either PS or CS access (or both).\n1. The user decides to transfer the session to UE#2, therefore initiates a call with UE#2 in its current (PS or CS) domain including the STN information to request the transfer of the session to UE#2.\n2a. UE#2 originates a call in PS domain including the STN information to initiate Inter-UE transfer\n2b. UE#2 originates a call in CS domain including the STN information (Inter-UE STN number) to initiate Inter-UE transfer. The ICS intermediate Nodes convert the request into IMS SIP format.\n3. The request is forwarded to the S-CSCF.\n4. The S-CSCF invokes the SCC Application as the first AS of any ASs that need to remain in the path of the call after session transfer.\n5. The S-CSCF forwards the SIP INVITE to the SCC Application over the ISC interface.\n6 The SCC AS analyses the SIP INVITE to derive that the SIP INVITE is a request to transfer a session from UE#1 to UE#2.\n7-9. The SCC AS sends a SIP Re-INVITE to the Remote UE to update the media components of the previous dialog.  Remote UE answers by a SIP 200 OK message.\n10-12. At Remote Leg update the S-CSCF in the originating network sends Charging Data Request[Interim] to record update of a session in the S-CSCF CDR.\n13. The S-CSCF answers to the SIP INVITE message in 7.\n14-16. At Remote Leg update the SCC AS sends Charging Data Request[Interim] to record update of a session in the SCC AS CDR.\n14-15a-16. Alternatively, when \"OneChargingSession\", the SCC AS sends an Charging Data Request[Interim] to record modification of SCC AS CDR for the IMS session (ICID) with the new legs configuration (Remote leg and new CS access leg).The CDF updates the SCC AS CDR related to the IMS session and acknowledges the reception of the data.\n17. The SCC AS answers to the SIP INVITE message in 5.18-20. Upon generation of the SIP 200 OK response, the SCC AS in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the SCC AS-CDR for Call-ID #1'. The CDF from the originating network opens an AS CDR and acknowledges the reception of the data.\nSteps 18 to 20 are not applicable for the \"OneChargingSession\" option.\n21-23. Upon generation of the SIP 200 OK response, the S-CSCF in the home IMS of the originating SCC user sends an Charging Data Request[Start] to record start of a user session in the S-CSCF-CDR for Call-ID #1'. The CDF from the originating network opens an S-CSCF CDR and acknowledges the reception of the data.\n24. The SIP 200 OK response is sent by the S-CSCF.\n25a. The SIP 200 OK response is forwared to UE#2.\n25b. The SIP 200 OK response is converted by the ICS/Interworking nodes in CS format and sent to UE#2.\n26a. UE#2 acknowledges the SIP 200 OK message.\n26b. UE#2 acknowledges the Connect message.\n27-28. The acknowledge from UE#2 is forwarded to the SCC AS.\n29-30. The SCC application sends SIP BYE request to release the old access leg.\n31a. The SIP BYE is forwarded to UE#1.\n31b. The BYE is converted by the ICS/Interworking nodes in CS format and sent to UE#1.\n32-34. At session termination the SCC AS sends Charging Data Request[Stop] to record stop of a session and stop of a media component in the SCC AS CDR. This CDR may be generated with special handling. One example of special handling is to zero rate the IMS resource usage for the Access leg establishment.\nSteps 32 to 34 are not applicable for the \"OneChargingSession\" option.\n35-37. The S-CSCF in the originating network sends Charging Data Request[Stop] for closing the S-CSCF CDR related to the initial Access leg. This CDR may be generated with special handling. One example of special handling is to zero rate the IMS resource usage for Access leg establishment. This can be performed using the correlation mechanism with the SCC AS CDR for Access leg.\n38a. UE#1 acknowledges the release of old access leg in PS domain.\n38b. UE#1 acknowledges the release of old access leg in CS domain. The ICS intermediate nodes convert the acknowledge into IMS SIP format.\n39-40. The acknowledge of the release of old access leg is forwarded to the AS.\n\nFigure 5.2.2.1.14.1 shows the case where a call with an alternate charged party is successfully initiated.\nThe figure depicts a successful initiation of a linear pattern charging scenario, illustrating the process of charging a mobile device using a linear charging cable. The cable is connected to a power source, and the device is placed on a charging pad. The charging process is initiated by pressing a button on the device, which triggers the charging cable to extend and the device to be charged. The figure provides a visual representation of the charging process, allowing users to understand the steps involved and the expected outcome.\nFigure5.2.2.1.14.1: Successful Initiation of alternate party charging\n1.\tThe AS receives a SIP INVITE.\n2.\tAfter determining that alternate charged party is supported, the AS initiates an Invite with an \"Alternate Party Identity\" for charging. The method for determination of the alternate charged party includes accessing subscriber data and doing a security assessment.\n3.\tThe terminating side issues a SIP 200 OK (Answer), to AS.\n4.\tThe AS sends a SIP 200 OK.\n5.\tThe AS sends an Charging Data Request[Start] to the CDF.\n6.\tThe CDF opens a CDR with the Subscription-ID for the Alternate Charged Party and sends an Charging Data Response to the AS.\n7.\tThe session is established.\nFigure 5.2.2.1.15.1 shows the Charging Data transactions that are required between IBCF, S-CSCF and CDF in each IMS network during session establishment.\nThe figure depicts a message sequence chart for an IMS-initiated session establishment via IBCF, illustrating the steps and components involved in the session establishment process.\nFigure 5.2.2.1.15.1: Message sequence chart for IMS initiated session establishment via IBCF\n1.\tThe session is originated in Home IMS A, and an SIP INVITE is sent through to Home IMS B via IBCFs.\n2.\tAll of the IMS network entities respond with successful SIP 200 OK to the SIP INVITE.\n3.\tUpon reception of the answer message, the IBCFs send an Charging Data Request[Start] in each IMS  to record start of a user session and start of a media component in the IBCF and CDRs.\n4\tThe CDF in each IMS acknowledges the reception of the data and opens an IBCF CDR.\n5.\tUpon reception of the answer message, the  S-CSCFs send an Charging Data Request[Start] in each IMS to record start of a user session and start of a media component in the and S-CSCF.\n6\tThe CDF in each IMS acknowledges the reception of the data and opens an S-CSCF CDR.\n7.\tThe session is established.\n\nFor details on charging at AS acting as an MMTel server, providing service such as CDIV, CONF and TIP/TIR, see the TS 32.275 [35].\nFigure 5.2.2.1.17.1 shows the Charging Data transactions that are required between S-CSCF, IBCF and CDF, in each IMS network, during session establishment. It represents a charging interconnect scenario where the third party AS (located in another network) provides e.g. value-added service and real time tariff information according to TS 29.658 [206].\nEditor's Note: The interconnect scenario between IMS network and PSTN (involving MGCF rather than IBCF) is FFS.\n\n\nFigure 5.2.2.1.17.1: Message sequence chart for IMS initiated session establishment with a 3rd party AS providing Real-Time Tariff Information (RTTI)\n1.\tThe session is initiated.\n2.\tThe destination (third party AS) answers with successful SIP 200 OK to the SIP INVITE. The third party AS includes a real time tariff information within the SIP 200OK response.\n3.\tUpon reception of the final response, the S-CSCF sends an Charging Data Request[Start] to record start of a user session and start of a media component in the S-CSCF.\n4\tThe CDF in each IMS network acknowledges the reception of the data and opens an S-CSCF CDR.\n5.\tUpon reception of the SIP 200 OK message, the IBCFs send an Charging Data Request[Start] in each IMS to record start of a user session and start of a media component in the IBCF.\n6\tThe CDF in each IMS acknowledges the reception of the data and opens an IBCF CDR.\n\nFigure 5.2.2.1.18.1shows the Charging Data transactions that are required between S-CSCF, IBCF and CDF, in each IMS network, when a third party AS (located in another network) involved in the session provides e.g. value-added service and real time tariff information according to TS 29.658 [206] during the session.\nThe figure depicts a message sequence chart for third-party ASs providing tariff information in real time (RTTI) during a session. The chart shows the flow of messages between the sender and the receiver, with timestamps indicating the time at which each message is sent or received. The chart is used to ensure that tariff information is provided in real time, which is crucial for efficient and accurate communication in the telecommunications industry.\nFigure 5.2.2.1.18.1: Message sequence chart for third party AS providing tariff information in real time (RTTI) during the session\n1.\tThe third party AS includes an RTTI within a SIP INFO and sends the message to the originating party.\n2.\tUpon reception of the SIP INFO embedding RTTI, the S-CSCF sends an Charging Data Request[Interim] to record tariff information in the CDR.\n3.\tThe CDF acknowledges the reception of the data and updates the S-CSCF CDR.\n4\tUpon reception of the SIP INFO embedding RTTI, the IBCF sends an Charging Data Request[Interim] to record tariff information in the CDR.\n5.\tThe CDF acknowledges the reception of the data and updates the IBCF-CDR.\n6.\tUpon reception of the SIP INFO embedding RTTI, the IBCF sends an Charging Data Request[Interim] to record tariff information in the CDR.\n7.\tThe CDF acknowledges the reception of the data and updates the IBCF-CDR.\n8.\tUpon reception of the SIP INFO embedding RTTI, the S-CSCF sends an Charging Data Request[Interim] to record tariff information in the CDR.\n9.\tThe CDF acknowledges the reception of the data and updates the S-CSCF CDR.\n\nOptimal Media Routing (OMR) relies on IMS-ALG function enhancement, used by some IMS Nodes as described in TS 23.228 [201] Annex Q, when performing media functions at transport level such as firewall or NAT, or application level such as transcoding. The purpose of OMR is to identify and remove unnecessary media functions from the media path for each media stream associated to a session. The OMR procedures are applicable to the following IMS entities having IMS-ALG function used in a B2BUA mode:\n-\tP-CSCF for support of NAT for signalling and media (with IMS-ALG/IMS-AGW model as described in TS 23.228 [201]) Annex G);\n-\tIBCF for border Control Functions towards other IMS/SIP Networks (with IBCF/TrGW model as described in TS 23.228 [201] Annex I);\n-\tAny AS performing as a B2BUA controlling media resources.\nAlthough the different TS 23.228 [201] scenarios mainly address the IBCF/TrGW, they are also applicable to P-CSCF/ IMS-AGW, except for transcoding function which relates to IBCF only. Consequently, in the different flows, the \"GW\" stands for TrGW or IMS-AGW, according to the situation.\nThe following flows focus on one IMS Node behaviour, embedding such IMS-ALG function supporting OMR, when involved in some of OMR scenarios described in TS 23.228 [201] Annex Q.\nEach media line of the same session can be applied with separate OMR decision (i.e. different optimised paths), however, for simplification, only one media is assumed in the following call flows.\nIn the Figure, the \"Originating side\" may be an Originating UA or another IMS-ALG in the same IMS Network, or another IMS Network, and the \"Destination side\" may be a Terminating UA or another IMS-ALG in the same IMS Network, or another IMS Network.\nFigure 5.2.2.1.19.1.1 shows the session establishment with SDP offer/answer exchange from Originating side towards a Destination side, traversing an IMS Network Node including IMS-ALG function supporting OMR, and OMR results in IMS-ALG bypasses its local GW.\nThe figure depicts a message sequence chart for session establishment with IMS-ALG supporting OMR and IMS-ALG bypasses its local GW due to OMR process.\nFigure 5.2.2.1.19.1.-1: Message sequence chart for session establishment with IMS-ALG supporting OMR and IMS-ALG bypasses its local GW due to OMR process.\n1.\tIMS-ALG receives an SIP INVITE with SDP offer-inc (call-ID#-inc) from Originating side, containing the transport address allocated in realm R1 by the Originating side for the media on incoming leg, and potential OMR information from prior user plane segments.\n2.\tIMS-ALG determines the outgoing IP realm (R2) is different from the incoming IP realm (R1) and interacts with a  GW in order to allocate a local transport address for the media on outgoing leg, in realm R2.\n3.\tIMS-ALG generates SIP INVITE towards Destination side (call-ID#-out), with a new SDP offer-out including such local transport address, and also OMR extensions (for the segment locally handled, along with those received from prior user plane segments) for further OMR decisions.\n4.\tThe destination side answers with SIP 200 OK and SDP answer-out, with the transport address allocated by the destination side for the media on outgoing leg, as result of OMR processing (based on OMR information provided in step 3). This transport address is in realm R1, thus identifying the local GW to be bypassed (i.e. same IP realm as in step 1), and also identifying use of a different IP realm from the default one (i.e. R2).\n5.  The Local GW is de-allocated (release of resource allocated in step 2 in realm R2).\n6.\tIMS-ALG forwards the SDP answer-inc for the media on incoming leg, with this transport address received in step 4.\n7.  IMS-ALG sends Charging Data Request[Start] to record start of session with \"Local GW Not Inserted\" and \"IP realm Not Default\" indications for the media.\n8-9. The CDF opens a session CDR for the IMS Node and acknowledges the reception of the data.\n10.\tA user plane connection is now established in realm R1 without GW insertion for the media.\nFigure 5.2.2.1.19.2.1 shows the session establishment with SDP offer/answer exchange from Originating side towards Destination side, traversing an IMS Network Node including IMS-ALG function supporting OMR, and OMR results in alternate IP realm selection (i.e. not the default IP realm) for the media.\nThe figure depicts a message sequence chart for session establishment with IMS-ALG supporting OMR, and an alternate realm is selected due to OMR process.\nFigure 5.2.2.1.19.2.1: Message sequence chart for session establishment with IMS-ALG supporting OMR, and alternate realm is selected due to OMR process.\n1. \tIMS-ALG receives an SIP INVITE with SDP offer-inc (call-ID#-inc) from Originating side, containing the transport address allocated in realm R1 by the Originating side for the media on incoming leg, and potential OMR information from prior user plane segments.\n2.\tIMS-ALG determines the outgoing IP realm (R2) is different from the incoming IP realm (R1) and interacts with a GW1 in order to allocate a local transport address for the media on outgoing leg, in realm R2. IMS-ALG additionally interacts with GW2 in order to allocate an alternate local transport address for the media in realm R3.\n3.\tIMS-ALG generates SIP INVITE towards Destination side (call-ID#-out), with a new SDP offer-out including such local transport addresses, and also OMR extensions (for the segment locally handled, along with those received from prior user plane segments) for further OMR decisions.\n4.\tThe destination side answers with SIP 200 OK and SDP answer-out, with the transport address allocated by the destination side for the media on outgoing leg, as result of OMR processing (based on OMR information provided in step 3).This transport address is in realm R3, thus identifying the local GW2 to be retained, and also identifying use of a different IP realm from the default one (i.e. R2).\n5.  The GW1 is de-allocated (release of resource allocated in step 2 for realm R2), and interaction occurs with GW2 to maintain the user plane connection via R3.\n6.\tIMS-ALG1 forwards the SDP answer-inc, with the transport address allocated by the GW2 in realm R1, for the media on incoming leg.\n7.  IMS-ALG sends Charging Data Request[Start] to record start of session with \"Local GW Inserted\" and \"IP realm Not Default\" indications for the media.\n8-9. The CDF opens a session CDR for the IMS Node and acknowledges the reception of the data.\n10a-b.\tA user plane connection is now established in realm R1 up to the GW2, and in realm R3 from the GW2 for the media.\nFigure 5.2.2.1.19.3.1 shows a scenario when a new SDP offer/answer exchange due to UE generating a SIP (rE-)iNVITE or SIP UPDATE in mid-session in order to add a media component , and the OMR procedures is processed for this new media, with same situation as in clause 5.2.2.1.19.1 (IMS-ALG bypasses its local GW).\nThis scenario also applies for situations where a  (rE-)iNVITE or a SIP UPDATE is issued for updating a media and the OMR procedures is processed again, changing the established media path.\n\nFigure 5.2.2.1.19.3.1: Message sequence chart for mid-session procedure with IMS-ALG supporting OMR, IMS-ALG bypasses its GW due to OMR process for the added media.\nThe same steps described in clause 5.2.2.1.19.1 apply, with following exceptions:\n1 and 3.  A SIP RE-INVITE instead of SIP INVITE\n7.  IMS-ALG sends Charging Data Request[Interim] to record update of session with \"Local GW Not Inserted\" and \"IP realm Not Default\" indications for the media.\n8-9.  The CDF updates the session CDR for the IMS Node and acknowledges the reception of the data.\nAs described in TS 23.228 [201] Annex Q, transcoding is also part of OMR process.\nThe following flows 5.2.2.1.19.4.1 show session establishment with SDP offer/answer exchange from Originating side towards a Destination side, traversing an IMS Network Node including IMS-ALG function supporting OMR with transcoder inserted by this IMS node.\nAlthough transcoding aspect is part of the same SDP offer/answer different exchanges described in clause 5.2.2.1.19.1 to clause 5.2.2.1.19.3, therefore combined in OMR process, it is reflected here through dedicated flows for simplification.\nThese procedures apply to IBCF/TrGW only.\nThe flow in figure 5.2.2.1.19.4.1.1 describes the situation where IMS-ALG allocates a transcoder for offering an additional transcoding option, and this transcoder is selected.\n\nThe figure depicts a message sequence chart for Session establishment with transcoder offered by IMS-ALG, showing the flow of data from the sender to the receiver. The chart includes various components such as the sender, transcoder, and receiver, as well as the message sequence and the transcoder's response. The figure is used to illustrate the communication process and the role of the transcoder in the session establishment process.\nFigure 5.2.2.1.19.4.1.1: Message sequence chart for Session establishment with transcoder offered by IMS-ALG is inserted\n1.\tIMS-ALG receives an SIP INVITE with SDP offer-inc (call-ID#-inc) from Originating side, containing a codec-list-inc in the SDP offer, and potential OMR information from prior user plane segments based on an Operator's configuration.\n2.\tIMS-ALG interacts with TrGW for transcoder allocation for the purpose of offering an additional codec \"codec-out\".\n3.\tIMS-ALG generates INVITE towards Destination side (call-ID#-out), the SDP offer-out containing the new codec-list-out (i.e. codec-list-inc enriched with \"codec-out\"), and also OMR extensions (for transcoding options associated to different segments).\n4.\tThe destination side answers with SIP 200 OK and SDP answer-out with the selected codec which is the additional one offered by IMS-ALG (i.e. codec-out).\n5.  Interaction occurs with TrGW for media configuration with codec-out for the outgoing leg and with codec-inc for the incoming leg (codec-inc is selected by IBCF from the codec-list-inc received in step 1).\n6.  IMS-ALG forwards the SDP answer-inc for the incoming leg, with this codec-inc.\n7.  IMS-ALG sends Charging Data Request[Start] to record start of session with \"Transcoder Inserted\" indication for the media.\n8-9. The CDF opens a session CDR for the IMS Node and acknowledges the reception of the data.\n\nThe fflow in figure 5.2.2.1.19.4.2.1 describes the situation where IMS-ALG allocates a transcoder for offering an additional transcoding option, and this transcoder is not selected.\nThe given telecommunication figure depicts a message sequence chart for session establishment with transcoder offered by IMS-ALG. The chart shows the sequence of messages sent to the transcoder, which is not selected. This indicates that the transcoder is not the intended recipient of the message sequence.\nFigure 5.2.2.1.19.4.2.1: Message sequence chart for session establishment with transcoder offered by IMS-ALG is not selected\n1.\tIMS-ALG receives an SIP INVITE with SDP offer-inc (call-ID#-inc) from Originating side, containing a codec-list-inc in the SDP offer, and potential OMR information from prior user plane segments, based on an Operator's configuration.\n2.\tIMS-ALG interacts with TrGW for transcoder allocation for the purpose of offering additional codec \"codec-out\".\n3.\tIMS-ALG generates SIP INVITE towards Destination side (call-ID#-out), the SDP offer-out containing the new codec-list-out (i.e. codec-list-inc enriched with \"codec-out\"), and also OMR extensions (for transcoding options associated to different segments).\n4.\tThe destination side answers with SIP 200 OK and SDP answer-out with the selected codec (codec-inc), belonging to the codec-list-inc received in step 1 (original offer).\n5.  Therefore, transcoding is not needed, and TrGW is de-allocated.\n6.\tIMS-ALG forwards the SDP answer-inc for the incoming leg, with this codec-inc.\n7.  IMS-ALG sends Charging Data Request[Start] to record start of session with \"Transcoder Not Inserted\" indication for the media.\n8-9. The CDF opens a session CDR for the IMS Node and acknowledges the reception of the data.\n\nFigure 5.2.2.1.20.1 shows the case where an AS acts as a B2BUA, and a single offline charging session is created for the established dialogs (\"OneChargingSession\" option)\n\nThe figure depicts a message sequence chart for an AS acting as a B2BUA with a single charging session. The chart shows the sequence of messages sent by the B2BUA to the charging session, with the message sequence and the corresponding charging session details.\nFigure 5.2.2.1.20.1: Message sequence chart for AS acting as a B2BUA with single charging session\n1.\tAS receives the SIP INVITE from Incoming side (Call-ID#inc) containing ICID.\n2.\tAS acting as a B2BUA generates SIP INVITE towards Outgoing side (Call-ID#out) with the same ICID as received in step 1.\n3.   SIP 200 OK is received in response to the SIP INVITE (Call-ID#out).\n4.   SIP 200 OK is sent in response to the SIP INVITE (Call-ID#inc).\n5.\tAS sends Charging Data Request[Start] to record start of a session, provided with ICID and  information associated to both Call-ID#inc and  Call-ID#out.\n6.\tThe CDF acknowledges the reception of the  Charging Data Request[Start] and opens a AS CDR.\n7. AS receives a mid-session (e.g. in order to modify media component(s)) SIP RE-INVITE or SIP UPDATE from Incoming side (Call-ID#inc) for the IMS session (ICID).\n8. AS generates SIP RE-INVITE or SIP UPDATE towards Outgoing side (Call-ID#out)\n9-10. AS sends SIP 200 OK (Call-ID#inc) towards Incoming side, when SIP 200 OK (Call-ID#out) response is received from Outgoing side.\n11.\tAS sends an Charging Data Request[Interim] to record changes associated to Call-ID#inc or/and Call-ID#out (e.g. changed media component(s)) in the AS CDR for the IMS session (ICID).\n12.\tThe CDF acknowledges the reception of the data and updates the AS CDR.\n13. AS receives BYE from Incoming side (Call-ID#inc)\n14. AS sends BYE towards Outgoing side (Call-ID#out)\n15.\tAS sends an Charging Data Request[Stop] to record stop of a session in the AS CDR for the IMS session (ICID).\n16.\tThe CDF acknowledges the reception of the data and closes the AS CDR.\n17-18. AS sends SIP 200 OK (Call-ID#inc) towards Incoming side, when SIP 200 OK (Call-ID#out) response is received from Outgoing side.\n\nFigure 5.2.2.1.21.1 shows the Charging Data transactions initiated by the P-CSCF, S-CSCF, IBCF, and TRF towards the CDF that are required for a roaming architecture for voice over IMS with local breakout in each IMS network during session establishment. This example pertains to the flow in Annex M.3.1.3 in TS 23.228 [201] in which loopback and OMR procedures are applied between the visited network and the home network serving UE A.\nThe figure depicts a message sequence chart for roaming architecture in Voice over IP (VoIP) with Local Backbone (LB) and Trunk Routing (TRF) features. The chart illustrates the routing process, including the use of VPLMN routing and Trunk Routing (TRF) for efficient communication.\nFigure 5.2.2.1.21.1: Message sequence chart for roaming architecture for voice over IMS with local breakout with \"VPLMN routing\" and TRF\n\n1.\tThe session initiation is acknowledged by the SIP 200 OK by the termination side and received by the IBCF in the Visited Network A.\n1a.\tIBCF sends Charging Data Request[Start] to record start of session with \"Local GW Inserted\" indication and with information on the non-roaming NNI 5 used for interconnection towards the terminating network.\n1b.\tThe CDF acknowledges the reception of the data and opens an IBCF CDR.\n2.\tThe Visited Network A TRF performs the loopback procedure and the session acknowledgement is routed towards the Home network through an IBCF.\n2a.\tTRF sends Charging Data Request[Start] to record start of session and indicating loopback routing from the roaming NNI.\n2b.\tThe CDF acknowledges the reception of the data and opens a TRF CDR.\n2c.\tIBCF sends Charging Data Request[Start] to record start of session with \"Local GW Not Inserted\" indication and with information on the roaming NNI 4 interconnecting to the intermediate network for the loopback path.\n2d.\tThe CDF acknowledges the reception of the data and opens an IBCF CDR.\n2e.\tIBCF sends Charging Data Request[Start] to record start of session with \"Local GW Not Inserted\" indication and with information on the roaming NNI 3 interconnecting to the intermediate network for the loopback path.\n2f.\tThe CDF acknowledges the reception of the data and opens an IBCF CDR.\n3.\tThe S-CSCF in the Home Network A routes the session acknowledgement towards the Visited Network A through an IBCF.\n3a.\tS-CSCF sends Charging Data Request[Start] to record start of session and indicating loopback routing to the roaming NNI.\n3b.\tThe CDF acknowledges the reception of the data and opens an IBCF CDR.\n3c.\tIBCF sends Charging Data Request[Start] to record start of session with \"Local GW Not Inserted\" indication and with information on the roaming NNI 2 interconnecting to the intermediate network for the non-loopback path.\n3d.\tThe CDF acknowledges the reception of the data and opens an IBCF CDR.\n3e.\tIBCF sends Charging Data Request[Start] to record start of session with \"Local GW Not Inserted\" indication and with information on the roaming NNI 1 interconnecting to the intermediate network for the non-loopback path.\n3f.\tThe CDF acknowledges the reception of the data and opens an IBCF CDR.\n3g.\tP-CSCF sends  Charging Data Request[Start] to record start of session.\n3h.\tThe CDF acknowledges the reception of the data and opens an IBCF CDR.\n\nService continuity using ATCF call flows with alternative \"OneChargingSession\" option reflected in the different flows description, i.e. a single charging session from ATCF.\nIn the flow figure 5.2.2.1.22.1.1, Call-ID #1 is for serving leg and Call-ID #2 is for home leg of CS access leg.\nThe figure depicts a call sequence in a telecommunications network, specifically focusing on the message exchange between the originating call (CS) and the call terminating (CT) through the Automatic Tandem Circuit (ATCF). The figure illustrates the flow of information, including the call initiation, call termination, and call continuation, as well as the signaling between the call endpoints.\nFigure 5.2.2.1.22.1.1: Message sequence chart UE originating call (CS only) through ATCF\n1. The SCC session is initiated by UE#1 sending a Call Setup.\n2. After processing at CS/PS intermediate nodes, the resulting SIP INVITE goes through the ATCF in the UE#1 serving network.\n3. The ATCF may decide whether to anchor the media session, and allocate if needed, ATGW resources to it.\n4. The ATCF create an SIP INVITE request message and send it to the UE#1 Home Network SCC AS.\n5. The call setup proceeds and is routed to the remote UE-2.\n6-7. On response SIP 200 OK from the remote UE#2, response SIP 200 OK is transmitted to UE#1 serving network.\n8. Upon reception of the final response, the ATCF sends an Charging Data Request[Start] to record start of a user session/media component in the ATCF CDR for the IMS session.\n9-10. The CDF from the Serving network opens an ATCF CDR for the home leg (Call-ID#2) and acknowledges the reception of the data.\n9a-10. Alternatively, when \"OneChargingSession\", the CDF opens an ATCF CDR related to the IMS session, with serving leg and home leg, and acknowledges the reception of the data.\n11-12. The final response to SIP INVIT (Call ID #1) is transmitted.\n13-15. Same as 8-9-10 but opening a ATCF CDR for the serving leg (Call-ID#1).\nSteps 13 to 15 are not applicable for the \"OneChargingSession\" option.\n\nThe figure depicts a call sequence in a telecommunications network, specifically focusing on the path taken by a call originating from a PSTN (Public Switched Telephone Network) to an ATCF (Access Traffic Control Facility). The figure shows the path taken by the call through various network elements, including the PSTN, ATCF, and other network components. The figure is labeled as \"Figure 5.2.2.1.22.1 A . 1: Message sequence chart UE originating call (PS only) through ATCF,\" indicating that it is a simplified representation of the call sequence, with only the PSTN and ATCF components shown.\nFigure 5.2.2.1.22.1A.1: Message sequence chart UE originating call (PS only) through ATCF\n1. The SCC session is initiated by UE#1 sending an SIP INVITE.\n2. After processing at P-CSCF, the resulting SIP INVITE goes through the ATCF in the UE#1 Visited Network.\n3. The ATCF may decide whether to anchor the media session, and allocate if needed, ATGW resources to it.\n4. The ATCF forwards the SIP INVITE request message to the UE#1 Home Network\n5. The call setup proceeds and is routed to the remote UE#2.\n6-7 On response SIP 200 OK from the remote UE#2, response SIP 200 OK is transmitted to UE#1 Visited Network.\n8. Upon reception of the final response, the ATCF sends an Charging Data Request[Start] to record start of a user session/media component in the ATCF CDR for the IMS session.\n9-10. The CDF from UE#1 Visited Network opens an ATCF CDR and acknowledges the reception of the data.\n11-12. The final response to SIP INVITE is transmitted.\n\nIn the flow figure 5.2.2.1.22.2.1, Call-ID #1 is for serving leg and Call-ID #2 is for home leg.\n\nThe figure depicts a call termination scenario in a 5G network, where a message is being transmitted through an ATCF (Access Traffic Control Function) to a UE (User Equipment). The figure shows the sequence of events, including the CS (Carrier Signal) and the call termination, with the UE terminating the call through the ATCF.\nFigure 5.2.2.1.22.2.1: Message sequence chart UE terminating call (CS only) through ATCF\n1. The SCC session is initiated by UE #2 sending an SIP INVITE towards UE-1.\n2. The call setup proceeds and is routed to the UE-1.\n3. The ATCF may decide whether to anchor the media session, and allocate if needed, ATGW resources to it.\n4. The ATCF create an SIP INVITE request message and send it to the CS/PS intermediate nodes.\n5. After processing at CS/PS intermediate nodes, the resulting message is sent to UE #1.\n6. The response is transmitted to CS/PS intermediate nodes.\n7. After processing at CS/PS intermediate nodes, the SIP 200 OK message is sent to ATCF.\n8. Upon reception of the final response, the ATCF in the terminating network sends an Charging Data Request[Start] to record start of a user session/media component in the ATCF CDR.\n9-10. The CDF from the Terminating serving network opens an ATCF CDR for the serving leg (Call ID #1) and acknowledges the reception of the data.\n9a-10 Alternatively, when \"OneChargingSession\", the CDF opens a ATCF CDR related to the IMS session (ICID) with serving leg and home leg, and acknowledges the reception of the data.\n11-12. The final response to SIP INVITE (Call ID #2) is transmitted.\n13-15.  Same as 8-9-10 but for the home leg (Call ID #2).\nSteps 13 to 15 are not applicable for the \"OneChargingSession\" option.\n\n\nThe figure depicts a call termination scenario in an AT&T network, showing the message sequence, call head, and terminating call (PS only) through the AT&T core network. The figure illustrates the AT&T core network architecture, including the AT&T core, AT&T core network, and AT&T core network.\nFigure 5.2.2.1.22.2A.1: Message sequence chart UE terminating call (PS only) through ATCF\n1. The SCC session is initiated by UE #2 sending an SIP INVITE towards UE#1.\n2. The call setup proceeds and is routed to the UE#1.\n3. The ATCF may decide whether to anchor the media session, and allocate if needed, ATGW resources to it.\n4. The ATCF forwards the SIP INVITE request message to the P-CSCF.\n5. After processing at P-CSCF, the resulting message is sent to UE #1.\n6. The response is transmitted to P-CSCF.\n7. After processing at P-CSCF, the SIP 200 OK is sent to ATCF.\n8. Upon reception of the final response, the ATCF sends an Charging Data Request[Start] to record start of a user session/media component in the ATCF CDR.\n9-10. The CDF from UE#1 Visited Network opens an ATCF CDR and acknowledges the reception of the data.\n11-12. The final response to SIP INVITE is transmitted.\n\nIn the flow figure 5.2.2.1.22.3.1, Call-ID #1 is for PS access leg, Call-ID #1' for serving leg of CS access leg and Call-ID #2' for home leg of CS access leg.\n\n\nFigure 5.2.2.1.22.3.1: Message sequence chart UE session transfer PS to CS using ATCF\n1. UE has an ongoing session under PS with media anchored in ATGW, and interactions between UE, RAN, MME/SGSN and MSC take place for session transfer to CS.\n2. MSC server sends the resulting SIP INVITE towards the ATCF in the UE#1 serving network.\n3. The media session is anchored in ATGW: the ATCF updates the ATGW with new CS access leg resource.\n4. The ATCF sends SIP 200 OK answer to MSC server for switching the media path.\n5-7. the ATCF sends an Charging Data Request[Start] to record start of a user session/media component in the ATCF CDR for the serving leg of new CS access leg.\n5-6a-7. Alternatively, when \"OneChargingSession\", the ATCF sends an Charging Data Request[Interim] to record modification of the ATCF CDR with the serving leg of new CS access leg. The CDF updates ATCF CDR related to the IMS session, with new serving leg, and acknowledges the reception of the data.\n8. ACK from MSC server to ATCF\n9. The ATCF creates and sends a SIP INVITE request via a new dialog to the SCC AS for indicating the transfer has taken place.\n10. The SCC AS sends a SIP 200 OK confirmation response to the ATCF containing SDP answer stored during the original session establishment procedure.\n11-13. The ATCF sends an Charging Data Request[Start] to record start of a user session/media component in the ATCF CDR for home leg of new CS access leg.\n11-12a-13 Alternatively, when \"OneChargingSession\", the ATCF sends an Charging Data Request[Interim] to record modification of the ATCF CDR with the home leg of new CS access leg. The CDF updates ATCF CDR related to the IMS session, with new home leg, and acknowledges the reception of the data.\n14. The ATCF acknowledges the SIP 200 OK.\n15, 19-20 The SCC AS terminates the old PS access leg, by sending a SIP BYE request.\n16-18. The ATCF sends an Charging Data Request[Stop] to close the ATCF CDR for the old PS access leg (conducted for both serving and home leg of the old PS access leg if flow 5.2.2.1.22.4 precedes for the same session).\nSteps 16 to 18 are not applicable for the \"OneChargingSession\" option.\n\nIn the flow figure 5.2.2.1.22.4.1, Call-ID#1 for serving leg of old CS access leg and Call-ID#2 for home leg of old CS access leg, Call-ID#1' is for serving leg of new PS access leg, and Call-ID#2' is for home leg of new PS access leg.\n\nThe figure depicts a message sequence in a 5G network, showing the communication between a user equipment (UE) and a physical system (PS) using the Advanced Terahertz Communication (ATCF) protocol. The figure illustrates the use of carrier sense (CS) to detect the presence of a physical system, and the use of channel state information (CSI) to improve the quality of service (QoS) for the UE.\nFigure 5.2.2.1.22.4.1: Message sequence chart UE session transfer CS to PS using ATCF\n1. UE has an ongoing session under CS with media anchored in ATGW, and interactions between UE, RAN, MME/SGSN and MSC take place for session transfer to PS.\n2. Transfer preparation procedure between MSC server and ATCF, the MSC interacts with UE for handover.\n3. The MSC server sends a SIP INFO request containing a session transfer preparation to the ATCF to instruct the ATCF that media should be switched to the new access leg.\n4. The ATCF sends SIP 200 OK answer to MSC server for switching the media path.\n5-6. UE A sends an SIP INVITE request towards the ATCF to move the session control to the PS access.\n7-11. The ATCF sends a SIP 200 OK response to the UE.\n8-10. The ATCF sends an Charging Data Request[Start] to record start of  a user session in the ATCF CDR for the serving leg of the new PS access leg.\n8-9a -10. Alternatively, when \"OneChargingSession\", the ATCF sends an Charging Data Request[Interim] to record modification of the ATCF CDR with the serving leg of new PS access leg. The CDF updates ATCF CDR related to the IMS session, with new serving leg, and acknowledges the reception of the data.\n12-13. UE acknowledges the SIP 200 OK.\n14. The ATCF creates and sends SIP INVITE request via a new dialog to the SCC AS for indicating the transfer has taken place.\n15. The SCC AS sends a SIP 200 OK confirmation response to the ATCF containing SDP answer stored during the original session establishment procedure.\n16-18. The ATCF sends an Charging Data Request[Start] to record start of a user session in the ATCF CDR for the home leg of the new PS access leg.\n16-17a -18. Alternatively, when \"OneChargingSession\" , the ATCF sends an Charging Data Request[Interim] to record modification of the ATCF CDR with the home leg of new PS access leg. The CDF updates ATCF CDR related to the IMS session, with new home leg, and acknowledges the reception of the data.\n20, 27 The SCC AS terminates the old CS access leg, by sending a SIP BYE request.\n21-23. The ATCF sends an Charging Data Request[Stop] to close the ATCF CDR for the serving leg of old CS access leg.\n24-26. The ATCF sends an Charging Data Request[Stop] to close the ATCF CDR for the home leg of old CS access leg.\nSteps 21 to 26 are not applicable for the \"OneChargingSession\" option.\n\nThis clause describes various error cases and how these should be handled. The error cases are grouped into the following categories:\nFailure in SIP related procedures:\n-\tSession related error scenarios;\n-\tSession unrelated error scenarios.\nErrors in Charging Data Transfer related procedures.\n\nA SIP session is closed abnormally by the reception of a SIP BYE message indicating the reason for such termination.\nIn this case, an Charging Data Request[stop] message that includes an appropriate error indication is sent.\nAll nodes involved in the SIP session are expected to exercise some kind of session supervision. In case a node detects an error in the SIP session, such as a timeout or the occurrence of an invalid SIP message that results in the inability to maintain the session, this IMS node will generate a SIP BYE message towards both ends of the connection.\nThe node that sent the BYE to trigger session termination identifies the cause of the failure in the Charging Data Request [stop] towards the CDF. All other nodes, i.e. those that receive the SIP BYE, are not aware of an error, and therefore they treat this situation as any normal SIP session termination.\nAs described in clause 5.1.2.1.2, a session unrelated SIP procedure may either be completed with the reception of a SIP 200 OK, or a SIP error message. If the latter occurs, i.e. there is a failure in the procedure, the Charging Data Request[event] sent towards the CDF includes an appropriate error indication.\nThe CDF connection failure mechanism is specified in TS 32.299 [50] clause 6.1.3.1.\n\nThe mechanism when no reply from CDF, is specified in TS 32.299 [50] clause 6.1.3.2.\nThe duplicate detection mechanism is specified in TS 32.299 [50] clause 6.1.3.3.\nThe CDF detected failure mechanism on expected Charging Data Requests for a particular SIP session is specified in TS 32.299 [50] clause 6.1.3.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3\tCDR generation",
                            "text_content": "For via Nchf interface (see clause 6.1.1a), CDR generation is the same as converged charging as described in clause 5.4.4.\nEditor's Note: The CDR generation for offline charging is FFS.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.4\tGTP' record transfer flows",
                            "text_content": "GTP' is not used between CDF and CGF for IMS offline charging because CDF and CGF are combined into CCF (see clause 4.2).\nNOTE:\tVendors may nevertheless implement a separate CDF and CGF for IMS offline charging. In this case, it is recommended that the approach chosen conforms to the principles and protocol applications specified in TS 32.295 [54].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.5\tBi CDR file transfer",
                            "text_content": "The CGF will receive charging events from each AS involved in a SIP dialog. This may result in multiple CDRs, some of these CDRs may be redundant for billing purposes. When preparing these CDRs for the BD, the CGF may elect not to send some CDRs or may perform consolidation before transfer based on the operator's configuration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3\tIMS online charging scenarios",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tBasic principles",
                            "text_content": "IMS online charging uses the Credit-Control application that is specified in TS 32.299 [50].\nThree cases for online charging are distinguished:\n-\tImmediate Event Charging (IEC); and\n-\tevent charging with unit reservation (ECUR), and\n-\tSession Charging with Unit Reservation (SCUR).\nBoth stage 2 and stage 3 mechanisms for the three cases for online charging are detailed in TS 32.299 [50].\nIn the case of Immediate Event Charging (IEC), granting units to the IMS Network Element is performed in a single operation that also includes the deduction of the corresponding monetary units from the subscriber's account. The charging process is controlled by the corresponding Debit UnitsRequest which is sent for a given Credit-Control event.\nIn contrast, Event Charging with Unit Reservation (ECUR) also includes the process of requesting, reserving, releasing and returning unused units for events. The deduction of the corresponding monetary units then occurs upon conclusion of the ECUR transaction. In this case, the Debit / Reserve Units Request is used to control the Credit-Control session.\nSession Charging with Unit Reservation (SCUR) is used for Credit-Control of sessions. SCUR also includes the process of requesting, reserving, releasing and returning unused units for sessions, and the deduction of the corresponding monetary units. During a SIP session there can be repeated execution of unit reservation and debit operations as specified in TS 32.299 [50].\nThe IMS Network Element may apply IEC, where Debit UnitsRequest[event] messages are generated, or ECUR, using Reserve Units Request[Initial] and Debit Units Request[Terminate] or SCUR. The decision whether to apply IEC, ECUR or SCUR is based on the service and/or operator's policy.\nThe CTF uses Debit / Reserve Units Request[Initial, Update, Terminate] in procedures related to successful SIP sessions. It uses Debit Units Request[event] or Reserve Units Request[Event or Initial, Terminate] depending on whether IEC or ECUR/SCUR applies) for unsuccessful SIP sessions and for session unrelated procedures. Further details are specified in the tables below.\nIt is operator configurable in the nodes for which SIP method a Debit / Reserve Units Request is sent. The table below describes all possible Debit / Reserve Units Requests that might be sent from an IMS GWF or an MRFC or an AS.\nIt is configurable for the operators to enable or disable the generation of a Debit / Reserve Units Request message by the IMS node in response to a particular \"triggering SIP method\".\nTable 5.3.1.1: Debit / Reserve Units Request messages triggered by SIP methods for IMS-GWF or AS\n\nTable .2: Debit / Reserve Units Request messages triggered by SIP methods for MRFC\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.3.1.1: Debit / Reserve Units Request messages triggered by SIP methods for IMS-GWF or AS",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table .2: Debit / Reserve Units Request messages triggered by SIP methods for MRFC",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.3.2\tMessage flows and types",
                            "text_content": "This clause describes the message flows for the event charging procedures on the Ro interface. The IMS functions providing online charging via the Ro interface are the S-CSCF with IMS GWF, the AS and the MRFC.\nNOTE: \tThe following sub-clauses only show the scenarios of the S-CSCF with IMS-GWF case and the AS case. The scenarios of the MRFC are FFS.\nThis clause provides the details of the \"Debit Units\" operation specified in TS 32.299 [50].\nThe transactions that are required on the Ro interface in order to perform IEC with Debit Units operations are carried out as described in TS 32.299 [50] where CTF refers to IMS Network Element. The Debit Units operation may alternatively be carried out prior to, concurrently with or after service/content delivery. the IMS Network Element must ensure that the requested service execution is successful, when this scenario is used.\nEditor's Note: Must be aligned with TS 32.299 [50].\nFigure 5.3.2.1.1.2.1 shows the Debit Units transactions that are required between the IMS-GWF/AS and the OCS for session-unrelated IMS procedures, i.e. those that relate to the Debit Units Request[event], as listed in table 5.3.1.1.\nSIP messages and Charging Data transactions associated with these charging scenarios are shown primarily for general information and to illustrate the charging triggers. They are not intended to be exhaustive and depend on the Debit Units Request triggers configured by the operator.\nScenario 1: Successful session unrelated case\nNOTE:\tThe Debit Units operation is carried out prior to service/content delivery.\nThe figure depicts a message sequence chart for a session-unrelated procedure in a telecommunication system. It illustrates the flow of messages from the sender to the receiver, with each message representing a step in the procedure. The chart is divided into two main sections: the sender's message and the receiver's response. The sender's message is represented by a series of dots, while the receiver's response is represented by a series of lines. The chart is color-coded to indicate the status of each message, with different colors representing different stages of the procedure. The figure provides a visual representation of the procedure's steps and helps in understanding the sequence of messages and their corresponding statuses.\nFigure 5.3.2.1.1.2.1: Message sequence chart for session-unrelated procedure\n1)\tA session unrelated SIP request (e.g. SUBSCRIBE) is received in the S-CSCF. The S-CSCF forwards this request to the IMS-GWF/AS.\n2)\tThe IMS-GWF/AS sends a Debit Units Request[Event] to the OCS, requesting units in order to provide the service.\n3)\tThe OCS sends the Debit Units Response to acknowledge the Debit Units Request, granting the requested units.\n4)\tThe IMS-GWF/AS and the S-CSCF forward the SIP request.\n\n\nThis clause describes various error cases and how these should be handled.\nThe failure handling behaviour is locally configurable in the IMS Network Element. If the Direct-Debiting-Failure-Handling AVP is not used, the locally configured values are used instead.\nIf SIP errors in SIP response (4xx, 5xx or 6xx) occur during service delivery, as defined in TS 24.228 [202] and TS 23.218 [203], it is up to the IMS Network Element to determine to what extent the service was delivered before the error occurred and act appropriately with respect to charging. This may imply that no units at all (or no more units) are debited.\nThis case comprises situations where either no, or an erroneous response, is received from the OCS. The \"no response\" case is detected by the IMS Network Element when the connection supervision timer Tx expires (IETF RFC 4006 [402]) before a Debit / Reserve Units Response is received.  The case of receiving an erroneous response implies that the IMS Network Element receives a Debit / Reserve Units Response, which it is unable to process, while Tx is running. The failure handling complies with the failure procedures for \"Direct Debiting\" scenario described in IETF RFC 4006 [402].\nThe detection of duplicate request is needed and must be enabled. To speed up and simplify as much as possible the duplicate detection, the all-against-all record checking should be avoided and just those records marked as potential duplicates need to be checked against other received requests (within a reasonable time window) by the receiver entity.\nThe IMS Network Element marks the request messages that are retransmitted after a link failover as possible duplicates with the T-flag as described in TS 23.228 [201]. For optimized performance, uniqueness checking against other received requests is only necessary for those records marked with the T-flag received within a reasonable time window. This focused check is based on the inspection of the Session-Id and CC-Request-Number AVP pairs.\nThis clause provides the details of the \"Reserve Units\" and \"Debit Units\" operation specified in TS 32.299 [50].\nThe transactions that are required on the Ro interface in order to perform ECUR/SCUR with Reserve / Debit Units operations is carried out as described in TS 32.299 [50] where CTF refers to an IMS Network Element. Multiple replications of both of these operations are possible.\nThis clause defines how reserved units are returned, if not used, within a reasonable time. It should be possible that both, reservation and SIP sessions are cancelled or only the reservation is cancelled without removing the SIP session.\nThe following figures show the Reserve Units transactions that are required between the IMS-GWF/AS and the OCS for session-related and session-unrelated IMS procedures.\nThe SIP messages and Charging Data transactions associated with these charging scenarios are shown primarily for general information and to illustrate the charging triggers. They are not intended to be exhaustive and they depend on the Reserve Units Request triggers configured by the operator.\nAll of the scenarios depict originating sessions only.\nScenario 1: Successful session establishment\nFigure 5.3.2.2.1.3.1.1 shows the Reserve Units transactions that are required in the IMS-GWF/AS during a SIP session establishment.\n\nThe figure depicts a message sequence chart for successful session establishment in a 5G network. It illustrates the flow of data packets, including the sender, receiver, and the network, with various stages such as data transmission, error detection, and retransmission. The chart highlights the importance of error correction and retransmission techniques to ensure reliable communication.\nFigure 5.3.2.2.1.3.1.1: Message sequence chart for successful session establishment\n1)\tAn initial SIP Invite Request is received in the S-CSCF. This request is forwarded to the IMS-GWF/AS.\n2)\tThe IMS-GWF/AS sends a Reserve Units Request[Initial] to the OCS requesting service units. The online Credit-Control session is initiated.\n3)\tThe OCS grants units in the Reserve Units Response.\n4)\tThe IMS-GWF/AS and S-CSCF forward the initial SIP INVITE.\n5)\tA final response is received in the IMS-GWF/AS.\n6)\tIf the trigger is active, the SIP 200 OK answer triggers a Reserve Units Request[Update] in the IMS-GWF/AS in order to update the Credit-Control session. New service units are requested. Also the used service units (if any) are reported.\n7)\tThe OCS sends the Reserve Units Response to acknowledge the Reserve Units Request. New service units are granted.\n8)\tThe final answer is forwarded.\n\n\nScenario 2: Successful session establishment with early media negotiation\nFigure 5.3.2.2.1.3.1.2 shows the Charging Data transactions that are required in the IMS-GWF/AS during a SIP session establishment in which SDP negotiation is completed before a final response to the initial SIP INVITE is exchanged.\nThe figure depicts a message sequence chart for session establishment in a 5G network, illustrating the early media negotiation process. The chart shows the sequence of messages exchanged between the sender and receiver, with the sender initiating the session by sending a message to the receiver, and the receiver responding with a message to confirm the session. The chart also includes a visual representation of the media negotiation process, with the sender sending a message to the receiver, and the receiver sending a response message to the sender. The chart is a crucial tool for understanding the communication process in a 5G network and is used to ensure the successful establishment of sessions.\nFigure 5.3.2.2.1.3.1.2: Message sequence chart for session establishment with early media negotiation\n1)\tAn initial SDP offer is conveyed in a SIP INVITE message. The SIP INVITE message received in the S-CSCF is forwarded to the IMS-GWF/AS.\n2)\tIn this example, the SDP offer is conveyed in a SIP request which implies the start of the online Credit-Control session towards the OCS. The IMS-GWF/AS sends a Reserve Units Request[Initial] to the OCS requesting service units. The online Credit-Control session is initiated.\n3)\tThe OCS grants units in the Reserve Units Response.\n4)\tThe IMS-GWF/AS and S-CSCF forward the SIP request conveying the SDP offer.\n5)\tA non-final SIP message (e.g. a  provisional reliable response) conveying an SDP answer is received in the IMS-GWF/AS.\n6)\tThe received SDP answer triggers a Reserve Units Request[Update] in order to update the session. New service units are requested. Also the used service units (if any) are reported.\n7)\tThe OCS sends the Reserve Units Response to acknowledge the Reserve Units Request. New service units are granted.\n8)\tThe SDP answer is forwarded.\n\nScenario 3: Mid-session procedures\nFigure 5.3.2.2.1.3.1.3 shows the Charging Data transactions that are required in the IMS-GWF/AS when receiving a SIP RE-iNVITE in mid-session, e.g. in order to modify media component(s), or when the hold and resume procedure is executed.\nThe figure depicts a message sequence chart for mid-session procedures in a telecommunication network. It illustrates the flow of messages from the sender to the receiver, with various stages such as data transmission, error detection, and error correction. The chart is divided into different sections, each representing a different stage of the process, and is color-coded to indicate the status of the messages. The figure is crucial for understanding the communication process and ensuring the smooth operation of the network.\nFigure 5.3.2.2.1.3.1.3: Message sequence chart for mid-session procedures\n\n1)\tA SIP RE-INVITE request is received in the S-CSCF. This request is forwarded to the IMS-GWF/AS.\n2)\tUpon receiving the SIP RE-INVITE request, the IMS-GWF/AS sends a Reserve Units Request[Update] to update the previously initiated session. New service units are requested. The used service units (if any) are also reported.\n3)\tThe OCS grants new service units in the Reserve Units Response.\n4)\tThe RE-INVITE request is forwarded.\n5)\tThe RE-INVITE request is acknowledged with a SIP 200 OK.\n6)\tIf the trigger is active, the IMS-GWF/AS sends a Reserve Units Request[Update] to the OCS to update the session. New service units are requested. The used service units (if any) are also reported.\n7)\tThe OCS grants new service units in the Reserve Units Response.\n8)\tThe SIP 200 OK message is forwarded.\n\nScenario 4: Session release\nFigure 5.3.2.2.1.3.1.4 shows the Debit / Reserve Units operation that are required in the IMS-GWF/AS for a session release scenario with SIP BYE triggering online Credit-Control session termination.\nFigure 5.3.2.2.1.3.1.4: Message sequence chart for session release (SIP BYE triggering Credit-Control session termination).\n\n1)\tA SIP session is released by sending a SIP BYE message. The S-CSCF forwards this message to the IMS-GWF/AS.\n2)\tUpon receiving the SIP BYE message, the IMS-GWF/AS forwards the SIP BYE request to the UE.\n3)\tIn case there is an ongoing online control session, the IMS-GWF/AS sends a Reserve Units Request[Terminate] reporting the used granted units.\n4)\tThe OCS sends a Reserve Units Response. The online Credit-Control session is terminated.\n5)\tThe final answer to the SIP BYE message is forwarded.\n\nFigure 5.3.2.2.1.3.1.4A shows the Debit / Reserve Units operation that are required in the IMS-GWF/AS for a session release scenario with SIP 200 OK triggering online Credit-Control session termination.\n\nFigure 5.3.2.2.1.3.1.4A: Message sequence chart for session release (SIP 200 OK triggering Credit-Control session termination).\n\n1)\tA SIP session is released by receiving a SIP BYE message. The S-CSCF forwards this message to the IMS-GWF/AS.\n2)\tUpon receiving the SIP BYE message, the IMS-GWF/AS forwards the SIP BYE request to the UE. In case there is an ongoing online control session, and the IMS-GWF/AS is configured to wait for SIP 200 OK acknowledging SIP BYE, the counter of used granted units is stopped.\n3)\tThe release is acknowledged by SIP 200 OK forwarded to the IMS-GWF/AS by the S-CSCF.\n4)\tIn case there is an ongoing online control session, the IMS-GWF/AS sends a Reserve Units Request [Terminate] reporting charging information (e.g. user location received in SIP 200 OK) together with the used granted units.\n5)\tThe OCS sends a Reserve Units Response. The online Credit-Control session is terminated.\n6)\tThe final SIP 200 OK answer to the SIP BYE message is forwarded.\nScenario 5: Successful session establishment with reception of RTTI message\nFigure 5.3.2.2.1.3.1.5 shows the Debit / Reserve Units operationthat are required in the IMS-GWF/AS during a SIP session establishment when RTTI message is received embedded in the SIP 200 OK.\nThe figure depicts a message sequence chart for successful session establishment with reception of the RTTI message, illustrating the sequence of events and the steps required to establish a successful session.\nFigure 5.3.2.2.1.3.1.5: Message sequence chart for successful session establishment with reception of RTTI message\n\n1)\tAn initial SIP INVITE request is received in the S-CSCF. This request is forwarded to the IMS-GWF/AS.\n2)\tThe IMS-GWF/AS sends a Reserve Units Request[Initial] to the OCS requesting service units. The online Credit-Control session is initiated.\n3)\tThe OCS grants units in the Reserve Units Response.\n4)\tThe IMS-GWF/AS and S-CSCF forward the initial SIP INVITE.\n5)\tA final response is received in the IMS-GWF/AS, which embeds a RTTI XML body.\n6)\tIf the trigger is active, the SIP 200 OK answer triggers a Reserve Units Request[Update] in the IMS-GWF/AS in order to update the session and take into account the RTTI XML body within the SIP 200 OK (see NOTE). New service units are requested. Also the used service units (if any) are reported.\n7)\tThe OCS sends the Reserve Units Response to acknowledge the Reserve Units Request. New service units are granted.\n8)\tThe final answer is forwarded.\nNOTE: \tThe mapping of RTTI XML body on Tariff Information structure is described in TS 32.280 [36].\n\nScenario 1: Successful session unrelated procedure\nFigure 5.3.2.2.1.3.2.1shows the Debit / Reserve Units operation that are required in the IMS-GWF/AS for a session unrelated procedure.\nThe figure depicts a message sequence chart for session-unrelated procedures, illustrating the flow of messages between different processes or systems. The chart is divided into three main sections: the top section shows the message sequence, the middle section represents the message flow, and the bottom section shows the message sequence. The chart is color-coded to indicate the status of each message, with different colors representing different states or actions. The figure is used to communicate the sequence of messages and their status to the user, helping them understand the flow of information and the steps involved in a session-unrelated procedure.\nFigure 5.3.2.2.1.3.2.1: Message sequence chart for session-unrelated procedures\n\n1)\tA session unrelated SIP request (e.g. SIP SUBSCRIBE) is received in the S-CSCF. The S-CSCF forwards this request to the IMS-GWF/AS.\n2)\tThe IMS-GWF/AS sends a Reserve Units Request[Initial] to initiate a Credit-Control session. Service units are requested to the OCS.\n3)\tThe OCS grants service units in the Reserve Units Response.\n4)\tThe IMS-GWF/AS and the S-CSCF forward the SIP request\n5)\tDepending on the used SIP method, there might be additional signalling between steps 4 and 5.\n6)\tThe SIP request is acknowledged by a SIP response.\n7)\tThe IMS-GWF/AS sends a Debit Units Request[Terminate] to the OCS. It also reports the used granted units.\n8)\tThe OCS sends a Debit Units Response to acknowledge the Debit Units Request. The online session is terminated.\n9)\tThe IMS-GWF/AS and S-CSCF forward the SIP response.\n\nThis clause describes various error cases and how these should be handled.\nThe failure handling behaviour is locally configurable in the IMS Network Element. If Credit-Control-Failure-Handling AVP is not used, the locally configured values are used instead.\nIf SIP errors occur during service delivery, as defined in [202] and [203], it is up to the IMS Network Element to determine to what extent the service was delivered before the error occurred and act appropriately with respect to charging. This may imply that no units at all (or no more units) are reserved or debited.\nThe Debit / Reserve Units operation failure mechanism is specified in TS 32.299 [50] clause 6.3.6.2.\nFor Debit / Reserve Units operation duplicate detection is performed only for possible duplicate event requests related to IEC as mentioned in clause 5.3.2.1.2.3, as retransmission of ECUR/SCUR related Debit / Reserve Units Requests is not allowed.\nIf a trigger occurs during session establishment to release a session during the establishment procedure, the IMS Network Element shall initiate procedures to cancel the session establishment as defined in TS 24.229 [204]. \nOn completion of the cancellation procedure, the IMS Network Element shall close the credit-control session (for SCUR and ECUR) indicating an appropriate cause code.\nAnnex B describes several scenarios related to IMS service termination.\nNOTE: \tThe annex B only shows the scenario of the S-CSCF with IMS-GWF case.\nFor IMS session related scenarios charged by means of SCUR in the IMS-GWF, service termination shall imply the rejection of a request for IMS session establishment or the release of an established session that is possibly associated to an online charging session.\nFor IMS session unrelated scenarios charged by means of ECUR in the IMS-GWF, Service Termination shall imply the rejection of the SIP method triggering the Reserve Units Request as defined in TS 32.299 [50].\nFor IMS session unrelated scenarios charged by means of IEC prior to service/content delivery in the IMS-GWF, service termination shall imply the rejection of the SIP method triggering the Debit Units Request as defined in TS 32.299 [50].\nThe procedures in Ro interface which may trigger the IMS Service termination are the following:\n-\tReception of an unsuccessful Operation Result different from DIAMETER_CREDIT_CONTROL_NOT_APPLICABLE (TS 32.299 [50]) in the Debit / Reserve Units Response message.\n-\tReception of an unsuccessful Result Code different from DIAMETER_CREDIT_CONTROL_NOT_APPLICABLE (TS 32.299 [50]) within the multiple units operation in the Debit / Reserve Units Response message when only one instance of the multiple units operation field is used.\n-\tExecution of the termination action procedure as defined in TS 32.299 [50] when only one instance of the Multiple Unit Operation field is used.\n-\tExecution of the failure handling procedures when the Failure Action is set to ‘Terminate' or ‘Retry & Terminate'.\nReception in the IMS-GWF of an Abort-Session-Request message from OCS.\nIn case either a Final-Unit-Indication or an erroneous Result-Code at multiple units operation level trigger the IMS service termination and the charging is based on ECUR or SCUR, the IMS-GWF shall close the online session by sending a Debit Units and Reserve Units operation of Type ‘Terminate'.\nRefer to TS 32.299 [50] for a detailed description of these procedures.\nAs a result of service termination triggering in IMS-GWF, the IMS service shall be denied to end-users. The network should provide an indication to UEs of the reason the service has been released or rejected. The procedure shall depend on:\n-\tThe charged party.\nThe network should provide UEs with an indication of the reason the service has been released or rejected. However, this reason shall depend on whether the UE is the charged party or not. The premise is that only the charged party should know that the IMS service is being rejected / released because of OCS interaction.\n-\tIMS specific protocol issues as defined in TS 24.229 [204].\nA)\tIn this scenario, the Response Code of the SIP response shall indicate the server understood the request but is refusing to fulfil it and that this request should not be repeated. The SIP response may include additional information about the cause to reject/release the IMS service. The presence of this additional error information in the response shall be operator configurable.\nThe additional information included in the SIP response may contain a SIP URI. The UE may treat the SIP URI as if it were a Contact in a redirect and generate a new SIP INVITE, resulting, for example, in a recorded announcement session being established. If announcement information is present in the Debit / Reserve Units Response message then a SIP URI should not be provided in the SIP response for redirection purposes.\nB)\tThe IMS-GWF generates a SIP request (e.g. SIP BYE or SIP CANCEL) as a result of the IMS Service Termination procedure:\nIn this scenario, the IMS-GWF may include a ‘Reason' field in the request which provides additional information about the cause to reject/release the IMS service. The presence of this additional information in the request shall be operator configurable.\nIn both scenarios, it shall also be operator configurable both per SIP method and per Originating/Terminating side, the content of the additional error information sent to the UEs. This error information shall also be configurable based on the procedure in Ro interface which has triggered the release/rejection of the IMS service according to clause 5.3.2.3.1. In particular when the service termination is triggered by the reception of an unsuccessful operation result (different from DIAMETER_CREDIT_CONTROL_NOT_APPLICABLE as defined in TS 32.299 [50]) in the Debit / Reserve Units Response message or the reception of an unsuccessful Result Code (different from DIAMETER_CREDIT_CONTROL_NOT_APPLICABLE as defined in TS 32.299 [50]) within the multiple units operation in the Debit / Reserve Units Response message, the additional error information/reason shall also be configurable based on the Result Code received through Ro interface.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.4\tIMS converged charging scenarios",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.4.1\tBasic scenario",
                            "text_content": "The Charging Data Request and Charging Data Response are exchanged between the IMS Nodes and the CHF using Nchf, based on either IEC, PEC, ECUR or SCUR scenarios specified in TS 32.290 [45].\nConverged charging uses centralized or decentralized unit determination and centralized rating scenarios for event based converged charging as specified in TS 32.290 [45].\nThe contents and purpose of each charging event that triggers interaction with CHF, as well as the chargeable events that trigger them, are described in the following clauses 5.4.3.\nA detailed formal description of the converged charging parameters defined in the present document is to be found in TS 32.291 [46].\nA detailed formal description of the CDR parameters defined in the present document is to be found in TS 32.298 [51].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.2\tCHF and charging service selection",
                            "text_content": "When use of Nchf interface is determined by the IMS Node, the CHF address(s) with possible associated CHF instance ID(s) and/or CHF set ID(s) can be selected from IMS signalling as per clause 5.1.1 , using NRF or can be configured locally.\nEach IMS Node of the IMS converged charging architecture is configured with \"converged charging\" method or \"offline only charging\" method, except the IMS-GWF for which only the \"converged charging\" method is valid. When configured with \"offline only charging\" method, the Nchf converged charging service is the default one to be used by the IMS Node, unless based on Operator policy the alternative Nchf offline only service has to be used.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.3\tApplicable triggers for IMS charging",
                            "text_content": "The IMS nodes for which SIP method a charging Data Request is sent shall be operator configurable. The tables below describe all possible Charging Data Requests that might be sent from IMS nodes.\nThe generation of a Charging Data Request message by the IMS nodes in response to a particular \"triggering SIP method\" shall be operator configurable (enable or disable).\nTable 5.4.3.1: Default Trigger conditions in IMS Node\n\nFor converged charging, the following details of chargeable events and corresponding actions in the IMS nodes are defined in Table 5.4.3.2:\nTable 5.4.3.2: Chargeable events and their related actions in IMS nodes\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.4.3.1: Default Trigger conditions in IMS Node",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.4.3.2: Chargeable events and their related actions in IMS nodes",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.4.4\tCDR generation",
                            "text_content": "The CHF CDRs for IMS charging are generated by the CHF to collect charging information that they subsequently transfer to the Charging Gateway Function (CGF).\nThe CHF shall support generating, opening updating and closing the CHF CDR as described in clause 5.4.4.2.\nA IMS charging CHF CDR is used to collect charging information related to IMS chargeable events.\nA CHF CDR is generated by the CHF for each received Charging Data Request [Event].\nA CHF CDR shall be opened when the CHF receives Charging Data Request [Initial].\nA CHF CDR shall be updated when the CHF receives Charging Data Request [Update].\nThe CHF CDR shall be closed when the CHF receives Charging Data Request [Termination].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.5\tGa record transfer flows",
                            "text_content": "Details of the Ga protocol application are specified in TS 32.295 [54].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.6\tBi CDR file transfer",
                            "text_content": "Details of the Bi protocol application are specified in TS 32.297 [52].\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tDefinition of charging information",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tData description for IMS offline charging",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tRf message contents",
                            "text_content": "The IMS nodes generate accounting information that can be transferred from the CTF to the CDF. For this purpose, IMS offline charging utilises the Charging Data Transfer that is specified in the 3GPP accounting application described in TS 32.299 [50].\nThe Charging Data Transfer operation employs the Charging Data Request and Charging Data Response messages. Table 6.1.1.0.1 describes the use of these messages for offline charging.\nTable 6.1.1.0.1: Offline charging messages reference table\n\nThe tables in the subsequent parts of this clause describes the Information Elements (IE) used in the charging data messages and the category in table are used according to the charging data configuration defined in clause 5.4 of TS 32.240 [1].\nTable 6.1.1.1.1 illustrates the basic structure of a Charging Data Request message as used for IMS offline charging.\nTable 6.1.1.1.1: Charging Data Request message contents\n\nTable 6.1.1.2.1 illustrates the basic structure of a Charging Data Response message as used for IMS offline charging.\nTable 6.1.1.2.1: Charging Data Response message contents\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.1.0.1: Offline charging messages reference table",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.1.1.1: Charging Data Request message contents",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.1.2.1: Charging Data Response message contents",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.1.1a\tOffline only charging message contents via Nchf interface",
                            "text_content": "The Charging Data Request and Charging Data Response are specified in TS 32.290 [57] and include charging information. The Charging Data Request can be of type [Event, Initial, Update, Termination].\nTable 6.1.1a.1.1 describes the use of these messages for offline only charging.\nTable 6.1.1a.1.1: offline only charging messages reference table\n\nTable 6.1.1a.2.1.1 illustrates the basic structure of a Charging Data Request message as used for I IMS offline only charging.\nTable 6.1.1a.2.1.1: Charging Data Request message contents\n\nEditor’s Note:\tThe full structure of the charging data request is FFS.\n\nTable 6.1.1a.2.2.1 illustrates the basic structure of a Charging Data Response message as used for IMS offline only charging.\nTable 6.1.1a.2.2.1: Charging Data Response Message Contents\n\nEditor’s Note:\tThe full structure of the charging data response is FFS.\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.1a.1.1: offline only charging messages reference table",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.1a.2.1.1: Charging Data Request message contents",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.1a.2.2.1: Charging Data Response Message Contents",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.1.2\tGTP' message contents",
                            "text_content": "Not applicable. Refer to clause 5.2.4 for further information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.3\tCDR description on the Bi interface",
                            "text_content": "The following standard CDR content and format are considered:\n-\tS-CSCF-CDR generated based on information from the S-CSCF\n-\tI-CSCF-CDR generated based on information from the I-CSCF\n-\tP-CSCF-CDR generated based on information from the P-CSCF\n-\tBGCF-CDR generated based on information from the BGCF\n-\tIBCF-CDR generated based on information from the IBCF\n-\tMGCF-CDR generated based on information from the MGCF\n-\tMRFC-CDR generated based on information from the MRFC\n-\tAS-CDR generated based on information from the AS\n-\tE-CSCF-CDR generated based on information from the E-CSCF\n-\tTF-CDR generated based on information from the IMS TF\n-\tTRF-CDR generated based on information from the TRF\n-\tATCF-CDR generated based on information from the ATCF\nThe content of each CDR type is defined in the tables in clauses 6.1.3.3 to 6.14.3.1. For each CDR type the field definition includes the CDR parameter (\"field name\"), category and description. The categories in the tables are used according to the charging data configuration defined in clause 5.4 of TS 32.240 [1].\nEditor's Note: Equipment vendors shall be able to provide all of the fields listed in the CDR content table in order to claim compliance with the present document. However, since CDR processing and transport consume network resources, operators may opt to eliminate some of the fields that are not essential for their operation.\nThe CDF provides the CDRs at the Bi interface in the format and encoding described in TS 32.298 [51]. Additional CDR formats and contents may be available at the interface to the billing system to meet the requirements of the billing system, these are outside of the scope of 3GPP standardisation.\nReflecting the usage of multimedia sessions IMS CDRs are generated by the CDF on a per session level. In the scope of the present document the term \"session\" refers always to a SIP session. The coherent media components are reflected inside the session CDRs with a media component container comprising of all the information necessary for the description of a media component.\nAccounting information for SIP sessions is transferred from the CTF involved in the session to the CDF using Charging Data Request[start, interim and stop] messages. A session CDR is opened in the CDF upon reception of a Charging Data Request[start] message. Partial CDRs may be generated upon reception of a Charging Data Request[interim] message, which is sent by the network entity towards the CDF due to a session modification procedure (i.e. change in media). Session CDRs are updated, or partial CDRs are generated upon reception of a Charging Data Request[Interim] message, which is sent by the network entity due to expiration of the Charging Data Interim Interval. The CDF closes the final session CDR upon reception of a Charging Data Request[stop] message, which indicates that the SIP session is terminated. Further details on triggers for the generation of IMS CDRs are specified in [1].\nAccounting information for unsuccessful session set-up attempts may be sent by the CTF to the CDF employing the Charging Data Request[event] message. The behaviour of the CDF upon receiving Charging Data Request [event] messages is specified in clause 6.1.3.2.2.\nTo reflect chargeable events not directly related to a session the CDF may generate CDRs upon the occurrence of session unrelated SIP procedures, such as registration respectively de-registration events. Accounting information for SIP session-unrelated procedures is transferred from the IMS nodes involved in the procedure to the CDF using Charging Data Request[event] messages. Session unrelated CDRs are created in the CDF in a \"one-off\" action based on the information contained in the Charging Data Request[event] message. One session unrelated CDR is created in the CDF for each Charging Data Request[event] message received, whereas the creation of partial CDRs is not applicable for session unrelated CDRs. The cases for which the IMS nodes send Charging Data Request[event] messages are listed per SIP procedure in table 5.2.1.1 and table 5.2.1.2.\nFurther details on triggers for the generation of IMS CDRs are specified in clause 5.2.2.\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.3.1: Charging data of S-CSCF CDR\n\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.4.1: Charging data of P-CSCF CDR\n\nEditor's Note: The SIP parameter from which the IMS Application Reference ID (IARI) is to be extracted requires further investigation in CT1. A mechanism to identify the IARI in use is ffs.\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.5.1: Charging data of I-CSCF CDR\n\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.6.1: Charging data of MRFC CDR\n\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.7.1: Charging data of MGCF CDR\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.8.1: Charging data of BGCF CDR\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.9.1: Charging data of AS CDR\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.10.1: Charging data of IBCF CDR\n\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.11.1: Charging data of E-CSCF CDR\n\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.12.1: Charging data of TRF CDR\n\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.13.1: Charging data of ATCF CDR\n\nNOTE: ATCF collocated with P-CSCF or IBCF applies combined offline charging with applicable fields described in table 6.3.2.1.\n\nThe detailed description of the field is provided in TS 32.298 [51].\nTable 6.1.3.14.1: Charging data of TF CDR\n\nEditor's note: More investigation on parameters occurrence should be worked out.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.3.3.1: Charging data of S-CSCF CDR",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.4.1: Charging data of P-CSCF CDR",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.5.1: Charging data of I-CSCF CDR",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.6.1: Charging data of MRFC CDR",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.7.1: Charging data of MGCF CDR",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.8.1: Charging data of BGCF CDR",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.9.1: Charging data of AS CDR",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.10.1: Charging data of IBCF CDR",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.11.1: Charging data of E-CSCF CDR",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.12.1: Charging data of TRF CDR",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.13.1: Charging data of ATCF CDR",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.14.1: Charging data of TF CDR",
                                    "table number": 28,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "6.2\tData description for IMS online charging",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tRo message contents",
                            "text_content": "The IMS nodes generate Debit / Reserve Units message information that can be transferred from the CTF to the OCF. For this purpose, IMS online charging utilises the Debit Units / Reserve Units procedure that is specified in the 3GPP Debit / Reserve Units operation in TS 32.299 [50].\nThe Debit / Reserve Units procedure employs the Debit / Reserve Units Request and Debit / Reserve Units Response messages. Table 6.2.1.0 describes the use of these messages in IMS online charging.\nTable 6.2.1.0: Online charging messages reference table\nTable 6.2.1.1.1 illustrates the basic structure of a Debit / Reserve Units Request message from the CTF in MRFC and AS and the IMS-GWF as used for IMS online charging.\nTable 6.2.1.1.1: Debit / Reserve Units Request message contents\n\nTable 6.2.1.2.1 illustrates the basic structure of a Debit / Reserve Units Response message as used for IMS charging. This message is always used by the OCS as specified below, independent of the receiving IMS node and the operation type that is being replied to.\nTable 6.2.1.2.1: Debit / Reserve Units Response message contents for MRFC, AS and IMS-GWF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.2.1.0: Online charging messages reference table",
                                    "table number": 29,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1.1.1: Debit / Reserve Units Request message contents",
                                    "table number": 30,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1.2.1: Debit / Reserve Units Response message contents for MRFC, AS and IMS-GWF",
                                    "table number": 31,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "6.3\tIMS charging specific parameters",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3.1\tDefinition of IMS charging information",
                            "text_content": "The IMS Information parameter used for IMS charging is provided in the Service Information parameter.\nThe components in the Service Information that are use for IMS charging can be found in Table 6.3.1.1.1.\nTable 6.3.1.1.1: Service Information used for IMS charging\n\n\nIMS specific charging information is provided within the IMS Information. The fields of the IMS Information which are differently covered in several IMS network nodes are indicated by the node specific type.\nThe detailed structure of the IMS Information can be found in table 6.3.1.2.1.\nTable 6.3.1.2.1: Structure of the IMS Information\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.3.1.1.1: Service Information used for IMS charging",
                                    "table number": 32,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.3.1.2.1: Structure of the IMS Information",
                                    "table number": 33,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.3.2\tDetailed message format for offline charging",
                            "text_content": "The following clause specifies per Operation Type the charging data that are sent by each of the IMS Network Elements for:\n-\tIMS session and IMS event (S/I/S/E)\nS-CSCF, E-CSCF, P-CSCF, MGFC, AS, IBCF, TRF, ATCF, TF\n-\tIMS session only (S/I/S)\nMRFC\n-\tIMS event only (E)\nI-CSCF, BGCF\nThe Operation Types are listed in the following order: S (Start)/I (Interim)/S (Stop)/E (Event). Therefore, when all Operation Types are possible it is marked as SISE. If only some Operation Types are allowed for a node, only the appropriate letters are used (i.e. SIS or E) as indicated in the table heading. The omission of an Operation Type for a particular field is marked with \"-\" (i.e. SI-E). Also, when an entire field is not allowed in a node the entire cell is marked as \"-\".\nTable 6.3.2.1 illustrates the basic structure of the supported fields in the Charging Data Request message for IMS offline charging.\nTable 6.3.2.1: Supported fields in Charging Data Request message\n\nTable 6.3.2.2 illustrates the basic structure of the supported fields in the Charging Data Response message for IMS offline charging.\nTable 6.3.2.2: Supported fields in Charging Data Response message\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.3.2.1: Supported fields in Charging Data Request message",
                                    "table number": 34,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.3.2.2: Supported fields in Charging Data Response message",
                                    "table number": 35,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.3.3\tDetailed message format for online charging",
                            "text_content": "The following table specifies per Operation Type the charging data that are sent by each of the IMS Network Elements for:\n-\tIMS session and IMS event (I/U/T/E)\nIMS-GWF, AS\n-\tIMS session only (I/U/T)\nMRFC\nThe Operation Types are listed in the following order: I (Initial)/U (Update)/T (Terminate)/E (Event). Therefore, when all Operation Types are possible it is marked as IUTE. If only some Operation types are allowed for a node, only the appropriate letters are used (i.e. IUT or E) as indicated in the table heading. The omission of an Operation Type for a particular field is marked with \"-\" (i.e. IU-E). Also, when an entire filed is not allowed in a node the entire cell is marked as \"-\".\nNote that not for all structured fields the individual field members are listed in the table. Detailed descriptions of the fields are provided in TS 32.299 [50].\nTable 6.3.3.1 illustrates the basic structure of the supported fields in the Debit / Reserve Units Request for IMS online charging.\nTable 6.3.3.1: Supported fields in Debit / Reserve Units Request message\n\nTable 6.3.3.2 illustrates the basic structure of the supported fields in the Debit / Reserve Units Response for IMS online charging.\n\nTable 6.3.3.2: Supported fields in Debit / Reserve Units Response message\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.3.3.1: Supported fields in Debit / Reserve Units Request message",
                                    "table number": 36,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.3.3.2: Supported fields in Debit / Reserve Units Response message",
                                    "table number": 37,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.3.4\tFormal IMS charging parameter description",
                            "text_content": "The detailed definitions, abstract syntax and encoding of the IMS CDR parameters are specified in TS 32.298 [51].\nThe detailed charging event parameter definitions are specified in TS 32.299 [50].\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.4\tData description for IMS converged charging",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.4.1\tMessage contents",
                            "text_content": "The Charging Data Request and Charging Data Response are specified in TS 32.290 [57] and include charging information. The Charging Data Request can be of type [Event, Initial, Update, Termination].\nTable 6.4.1.1.1 describes the use of these messages for converged charging.\nTable 6.4.1.1.1: Converged charging messages reference table\nTable 6.4.1.2.1.1 illustrates the basic structure of a Charging Data Request message as used for IMS converged charging.\nTable 6.4.1.2.1.1: Charging Data Request message contents\n\nEditor’s Note:\tThe full structure of the charging data request is FFS.\n\nTable 6.4.1.2.2.1 illustrates the basic structure of a Charging Data Response message as used for IMS converged charging.\nTable 6.4.1.2.2.1: Charging Data Response Message Contents\n\nEditor’s Note:\tThe full structure of the charging data response is FFS.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.4.1.1.1: Converged charging messages reference table",
                                    "table number": 38,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.4.1.2.1.1: Charging Data Request message contents",
                                    "table number": 39,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.4.1.2.2.1: Charging Data Response Message Contents",
                                    "table number": 40,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.4.1a\tGa message contents",
                            "text_content": "Refer to clause 5.4.5 for further information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.1b\tCDR description on the Bi interface",
                            "text_content": "This clause describes the CHF CDR content and format generated of IMS converged charging for IMS nodes (i.e. MRFC, IMS-GWF and SIP AS).\nThe following tables provide a brief description of each CDR parameter of CHF CDR. The category in the tables is used according to the charging data configuration defined in clause 5.4 of TS 32.240 [1]. Full definitions of the CDR parameters, sorted by the name in alphabetical order, are provided in TS 32.298 [51].\nThe fields of IMS converged charging CHF CDR are specified in table 6.4.1b.2.1.\nTable 6.4.1b.2.1: IMS converged charging CHF record data\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.4.1b.2.1: IMS converged charging CHF record data",
                                    "table number": 41,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.4.2\tDefinition of the IMS converged charging information",
                            "text_content": "The Charging Information parameter used for IMS converged charging is provided in the following clauses.\nIMS specific charging information used for IMS converged charging is provided within the IMS charging Information.\nTable 6.4.2.2.1: Structure of IMS Charging Information\n\nThe following clause specifies per Operation Type the charging data that are sent by IMS node for IMS converged charging.\nThe Operation Types are listed in the following order: I (Initial)/U (Update)/T (Termination)/E (Event). Therefore, when all Operation Types are possible it is marked as IUTE. If only some Operation Types are allowed for a node, only the appropriate letters are used (i.e. IUT or E) as indicated in the table heading. The omission of an Operation Type for a particular field is marked with \"-\" (i.e. I-TE). Also, when an entire field is not allowed in a node the entire cell is marked as \"-\".\nTable 6.5.3.1 defines the basic structure of the supported fields in the Charging Data Request message for IMS converged charging.\nTable 6.4.2.3.1: Supported fields in Charging Data Request message\n\nTable 6.4.2.3.1 defines the basic structure of the supported fields in the Charging Data Response message for IMS converged charging.\nTable 6.4.2.3.2: Supported fields in Charging Data Response message\n\nThe detailed definitions, abstract syntax and encoding of the IMS charging CHF CDR parameters are specified in TS 32.298 [51].\nThe detailed definitions of resources attributes used for IMS charging are specified in TS 32.291 [58].\n\nThis Annex is a placeholder for documents which are not explicitly cited in this specification.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.4.2.2.1: Structure of IMS Charging Information",
                                    "table number": 42,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.4.2.3.1: Supported fields in Charging Data Request message",
                                    "table number": 43,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.4.2.3.2: Supported fields in Charging Data Response message",
                                    "table number": 44,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "B.0\tGeneral",
            "description": "This annex describes several scenarios related to IMS service termination in IMS-GWF.\nSIP messages and Diameter transactions associated with these charging scenarios are shown primarily to illustrate the service termination procedures. They are not intended to be exhaustive and depend on the Diameter CCR triggers configured by the operator. The triggers for sending Debit / Reserve Units Requests from the IMS-GWF to the OCS are defined according to table 5.3.1.1.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.1\tScenario 1 - session related (SCUR): service termination on reception of an initial SIP INVITE request",
            "description": "\nThe figure depicts a service termination triggered by an initial SIP request, illustrating the process of initiating a call. The figure shows the various components involved in the call, such as the originating network (RIP) and the destination network (VoIP). The figure also highlights the importance of network management and the role of the network operator in ensuring the smooth functioning of the network.\nFigure B.1.1: Service termination triggered by an initial SIP request\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.2\tScenario 2 - session related (SCUR): service termination triggered after an early SIP dialog is established",
            "description": "The figure depicts a SIP 200OK response to the initial SIP INVITE, illustrating the initiation of a service request. The response is triggered by the service request, which is a key component of the SIP protocol used for communication over IP networks. The figure provides a visual representation of the interaction between the service request and the response, highlighting the role of the SIP protocol in initiating and managing communication sessions.\nFigure B.2.1: Service termination triggered by the SIP 200OK response to the initial SIP INVITE\n\nThe figure depicts a service termination triggered by an SIP UPDATE request within an early SIP dialog. The figure illustrates the process of a SIP update, which is a method used to update the state of a session in a SIP (Session Initiation Protocol) call. The figure shows the various components involved in the SIP update process, including the sender, receiver, and the SIP server. The figure also includes a visual representation of the SIP update message, which is a text-based message that contains the update information. The figure is important for understanding the SIP update process and its role in the communication between the sender and receiver.\nFigure B.2.2: Service termination triggered by an SIP UPDATE request within an early SIP dialog\n\nThe figure depicts a SIP service termination triggered by the 200OK to an 200OK update request within an early SIP dialog, illustrating the interaction between the service termination and the update request.\nFigure B.2.3: Service termination triggered by the SIP 200OK to an SIP UPDATE request within an early SIP dialog\n\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.3\tScenario 3 - session related (SCUR): service termination triggered after a confirmed SIP dialog is established",
            "description": "The figure depicts a SIP RE-INVITE request within a confirmed SIP dialog, illustrating the process of initiating a service request. The figure shows the SIP request message, the response message, and the confirmation message, all within the context of a confirmed SIP dialog.\nFigure B.3.1: Service termination triggered by a SIP RE-INVITE request within a confirmed SIP dialog\n\nThe figure depicts a SIP dialog with a service termination triggered by the 200 OK response to a SIP RE -INVITE request within a confirmed SIP dialog. The figure illustrates the SIP protocol, which is used for communication over the internet, and the response to a SIP RE -INVITE request.\nFigure B.3.2: Service termination triggered by the SIP 200 OK response to a SIP RE-INVITE request within a confirmed SIP dialog\n\nThe figure depicts a service termination triggered by the charging application procedures as defined in TS 32.299 [50], within a confirmed SIP dialog. The figure illustrates the process of charging application procedures, including the initiation of a charging request, the initiation of a charging response, and the termination of the charging response. The figure also includes a confirmation dialog, which confirms the termination of the charging response.\nFigure B.3.3: Service termination triggered by the charging application procedures as defined in TS 32.299 [50] within a confirmed SIP dialog\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.4\tScenario 4 - session unrelated (ECUR): service termination on reception of an initial non-INVITE SIP request",
                    "description": "",
                    "summary": "",
                    "text_content": "The figure depicts a service termination triggered by the reception of a non-INVITE SIP request, illustrating the process of signaling and signaling termination in a SIP-based communication system.\nFigure B.4.1: Service termination triggered by the reception of a non-INVITE SIP request\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.5\tScenario 5 - session unrelated (IEC): service termination on reception of an initial non-INVITE SIP request",
            "description": "\nThe figure depicts a service termination triggered by the reception of a non-INVITE SIP request, illustrating the process of signaling and signaling termination in a SIP-based communication system.\nFigure B.5.1: Service termination triggered by the reception of a non-INVITE SIP request\n\n\n\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "",
                    "table number": 45,
                    "summary": "",
                    "name": ""
                },
                {
                    "description": "",
                    "table number": 46,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        }
    ]
}