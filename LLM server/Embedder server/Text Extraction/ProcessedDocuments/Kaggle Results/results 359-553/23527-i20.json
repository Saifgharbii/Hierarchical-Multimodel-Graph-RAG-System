{
    "document_name": "23527-i20.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, modal verbs have the following meanings:\nshall\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions, and do not appear in Technical Reports.\nThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible, and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\tindicates permission to do something\nneed not\tindicates permission not to do something\nThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\tindicates that something is possible\ncannot\tindicates that something is impossible\nThe constructions \"can\" and \"cannot\" are not substitutes for \"may\" and \"need not\".\nwill\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document defines the restoration procedures in the 5G System.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.007: \"Restoration procedures\".\n[3]\t3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunneling Protocol User Plane (GTPv1-U)\".\n[4]\t3GPP TS 29.244: \"Interface between the Control Plane and the User Plane Nodes; Stage 3\".\n[5]\t3GPP TS 23.502:\"Procedures for the 5G System; Stage 2\"\n[6]\t3GPP TS 29.518: \"5G System; Access and Mobility Management Service; Stage 3\".\n[7]\t3GPP TS 29.510: \"5G System; Network Function Repository Services; Stage 3\".\n[8]\t3GPP TS 23.041: \"Technical realization of Cell Broadcast Service (CBS)\".\n[9]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[10]\t3GPP TS 29.500: \"5G System; Technical Realization of Service Based Architecture; Stage 3\".\n[11]\t3GPP TS 38.413: \"NG Radio Access Network (NG-RAN); NG Application Protocol (NGAP)\".\n[12]\t3GPP TS 23.247: \"Architectural enhancements for 5G multicast-broadcast services; Stage 2\".\n[13]\t3GPP TS 33.501: \"Security architecture and procedures for 5G system\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and 3GPP TS 29.244 [4] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1] and 3GPP TS 29.244 [4].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\n5MBS\t5G Multicast-Broadcast Services\nAF/AS\tApplication Function / Application server\nAMF\tAccess and Mobility Management Function\nC-TEID\tCommon Tunnel Endpoint IDentifier\nF-SEID\tFully Qualified SEID\nF-TEID\tFully Qualified TEID (i.e. IP address and TEID)\nPFCP\tPacket Forwarding Control Protocol\nGTP-U\tGTP User plane\nLLC SM\tLow Layer Source Specific Multicast (address)\nMBS\tMulticast/Broadcast Service\nMBSF\tMulticast/Broadcast Service Function\nMB-SMF\tMulticast/Broadcast Session Management Function\nMB-UPF\tMulticast/Broadcast User Plane Function\nNEF\tNetwork Exposure Function\nNG-RAN\tNext Generation (5G) RAN\nPSA\tPDU Session Anchor\nSMF\tSession Management Function\nTEID\tTunnel Endpoint IDentifier\nUPF\tUser Plane Function\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tRestoration Procedures related to the N4 Interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause specifies the procedures supported in the 5G System to detect and handle failures affecting the N4 interface.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tN4 Failure and Restart Detection",
                    "description": "",
                    "summary": "",
                    "text_content": "Across PFCP based interfaces, an SMF and UPF shall utilize the PFCP Heartbeat Request and Heartbeat Response messages to detect a peer PFCP entity failure or restart as described in clause 19A of 3GPP TS 23.007 [2].\nA PFCP function shall ignore the Recovery Timestamp received in PFCP Association Setup Request and PFCP Association Setup Response messages (see clause 6.2.6 of 3GPP TS 29.244 [4]).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.3\tUPF Restoration Procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.3.1\tGeneral",
                            "text_content": "When a UPF fails, all its Session contexts and PFCP associations affected by the failure become invalid and may be deleted.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.2\tRestoration Procedure for PSA UPF Restart",
                            "text_content": "If F-TEID and/or UE IP address allocation is performed in the UPF, the UPF shall ensure that previously used F-TEID values and/or UE IP addresses are not immediately reused after a UPF restart, in order to avoid inconsistent F-TEID and/or UE IP address allocation throughout the network and to enable the restoration of PFCP sessions affected by the failure. How this is ensured is implementation specific.\nThe UPF shall not send GTP-U Error indication message for a configurable period after an UPF restart when the UPF receives a G-PDU not matching any PDRs.\nDuring or immediately after an UPF Restart, the UPF shall place a local UPF Recovery Time Stamp value in all Heartbeat Request/Response messages.\nImmediately after the re-establishment of a PFCP association between the SMF and the UPF, the SMF may start restoring PFCP sessions in the UPF.\nThe SMF should prioritize the PFCP sessions to restore based on operator's policy.\nThe SMF should control the load induced on the UPF when performing the PFCP restoration procedures, the way it is done is implementation specific.\nWhen re-establishing a PFCP session and if F-TEID allocation and/or UE IP address is performed in the PSA UPF by network configuration, the SMF shall include a restoration indication in the PFCP Session Establishment Request message to indicate to the UPF it is for a restoration of an existing PFCP session and the UPF shall accept SMF allocated F-TEID and/or UE IP address if possible. If the UPF cannot accept the requested F-TEID and/or UE IP address because the IP address is no longer available at the UPF, the UPF shall reject the PFCP Session Establishment Request with the cause \"PFCP session restoration failure due to requested resource not available\".\nNOTE:\tThe cause \"PFCP session restoration failure due to requested resource not available\" corresponds to scenarios where the requested address is no longer available at the UPF, i.e. it cannot be assigned to any PFCP session, due to e.g. the address having been decommissioned by OAM from the UPF or e.g. the address being no longer operational due to a partial hardware failure at the UPF. This cause is not to be used for scenarios where the requested address would be available at the UPF but would have been re-assigned to a different PFCP session, which is a scenario that is not expected to happen based on the requirements specified above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.3\tRestoration Procedure for PSA UPF Failure without Restart",
                            "text_content": "Procedures for PSA UPF failure without restart are implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.4\tRestoration Procedure for Intermediate UPF Restart",
                            "text_content": "The SMF will receive the UPF recovery time stamps in PFCP heartbeat requests/responses.\nAfter an Intermediate UPF restart, the PFCP association between the SMF(s) and the Intermediate UPF has to be re-established.\nThe restoration of the PFCP sessions may start immediately after the PFCP association setup procedure:\n-\tif the restoration is supported in the SMF on a proactive basis, the SMF may start re-establishing PFCP sessions matching any PDRs.\n-\tas defined in clause 4.3.2, the SMF should prioritize the PFCP sessions restoration.\n-\tif the restoration is supported in the SMF on a reactive basis:\n-\tthe SMF shall establish an PFCP session with a wildcarded PDR to instruct the Intermediate UPF to forward G-PDU packets which are not matching any other PDRs to the SMF (to a F-TEID uniquely assigned in the SMF for this PFCP-u tunnel);\n-\tupon receipt of G-PDUs from this PFCP-u tunnel, the SMF shall then check if it has an active session for each received G-PDU packet:\n-\tif so, the SMF shall perform the PFCP Session establishment procedures to re-establish the corresponding PFCP sessions in the Intermediate UPF;\n-\totherwise the SMF shall generate a GTP-U Error Indication with a destination address set to the source IP address of the received G-PDU, and send it to the Intermediate UPF. The Intermediate UPF shall forward this GTP-U Error Indication transparently. The SMF shall delete the G-PDU after the check for active sessions.\nNOTE 1:\tThe UPF can filter the G-PDU packets with same target F-TEID and send only one such G-PDU to the Intermediate SMF.\nWhen re-establishing a PFCP session and if F-TEID allocation is performed in the Intermediate UPF by network configuration, the SMF shall include a restoration indication in the PFCP Session Establishment Request message to indicate to the UPF it is for a restoration of an existing PFCP session and the UPF shall accept SMF allocated F-TEID if possible. If the UPF cannot accept the requested F-TEID because the IP address is no longer available at the UPF, the UPF shall reject the PFCP Session Establishment Request with the cause \"PFCP session restoration failure due to requested resource not available\".\nThe Intermediate UPF shall not send any Error indication messages for an operator configurable period after an Intermediate UPF restart when the Intermediate UPF receives G-PDU not matching any PDRs.\nNOTE 2:\tIf restoration on a reactive basis is used, the period needs to be longer than the time required by the SMF to detect the UPF restart, to establish the PFCP association and provision the wildcarded PDR. Otherwise, the period needs to be longer than the time required by the SMF to restore all the PFCP sessions on a proactive basis.\nNOTE 3:\tThe cause \"PFCP session restoration failure due to requested resource not available\" corresponds to scenarios where the requested address is no longer available at the UPF, i.e. it cannot be assigned to any PFCP session, due to e.g. the address having been decommissioned by OAM from the UPF or e.g. the address being no longer operational due to a partial hardware failure at the UPF. This cause is not to be used for scenarios where the requested address would be available at the UPF but would have been re-assigned to a different PFCP session, which is a scenario that is not expected to happen based on the requirements specified above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.5\tRestoration Procedure for Intermediate UPF Failure without Restart",
                            "text_content": "Procedures for Intermediate UPF failure without restart are implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.4\tSMF Restoration Procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.4.1\tGeneral",
                            "text_content": "When a SMF fails, all its PDU session contexts and PFCP associations affected by the failure may become invalid and may be deleted.\nIf F-TEID allocation is performed in the SMF, the SMF should ensure as far as possible that previously used F-TEID values are not immediately reused after a SMF restart, in order to avoid inconsistent TEID allocation throughout the network.\nNOTE:\tThis is to ensure that F-TEIDs are not reused until earlier PDU sessions using them are released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.2\tRestoration Procedure for SMF Restart",
                            "text_content": "During or immediately after a SMF Restart, the SMF shall place local SMF-C Recovery Time Stamp value in all Heartbeat Request/Response messages.\nThe UPF will receive the SMF recovery time stamps in PFCP heartbeat requests/responses.\nWhen a UPF detects that a peer PFCP entity in the SMF has restarted (as specified in clause 4.2), the UPF shall delete all session contexts affected by the PFCP entity restart that it may have stored. When the UPF receives a GTP-U PDU not matching any PDRs, it shall discard the GTP-U PDU and return a GTP error indication to the originating node (e.g. other UPF, gNB or N3IWF).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.3\tRestoration Procedure for SMF Failure without Restart",
                            "text_content": "When a UPF detects that a peer PFCP entity in the SMF is not reachable for a preconfigured time, the UPF shall delete all the session contexts affected by the peer PFCP entity failure that it may have stored.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.5\tN4 path failure",
                    "description": "",
                    "summary": "",
                    "text_content": "If the N4 path to the UPF is down, the SMF should handle this as an UPF Failure without Restart, see clause 4.3.3.\nIf the N4 path to the SMF is down, the UPF should handle this as a SMF Failure without Restart, see clause 4.4.3.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.6\tPartial failure handling over N4",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.6.1\tGeneral",
                            "text_content": "The SMF and UPF may support the partial failure handling feature over N4. If so, they shall support the requirements specified in this clause.\nThis feature enables to clean up PFCP sessions optimally in the peer PFCP node (i.e. SMF or UPF), when a hardware or software failure affects a significant number of PFCP sessions. When it is not possible to recover the affected PFCP sessions, it is useful to inform the peer PFCP node about the affected PFCP sessions using an identifier that represents a large set of PFCP sessions, rather than doing so per PFCP session.\nA Connection Set Identifier (CSID) shall identify a set of PFCP sessions within a PFCP node that may belong to an arbitrary number of UEs. A CSID is an opaque parameter local to a PFCP node. Each PFCP node that supports the feature shall maintain a local mapping of CSID to its internal resources. When one or more of these resources fail, the corresponding one or more fully qualified CSIDs shall be signalled to the peer PFCP nodes.\nThe fully qualified CSID (FQ-CSID) is the combination of the PFCP node identity and the CSID assigned by the PFCP node which together globally identifies a set of PFCP sessions.\nThe node identifier shall be globally unique across all 3GPP EPS and 5GS networks. Its format is defined in 3GPP TS 29.244 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.2\tProcedures",
                            "text_content": "The SMF and the UPF may each assign one FQ-CSID to a PFCP session during the PFCP session establishment, by signalling the SMF FQ-CSID in the PFCP Session Establishment Request or the UPF FQ-CSID in the PFCP Session Establishment Response, as shown in Figure 4.6.2-1.\nThe figure depicts a PFCP session setup with FQ-CSID, illustrating the process of establishing a session with a specific FQ-CSID. The figure includes various components such as the session establishment procedure, the FQ-CSID, and the session setup.\nFigure 4.6.2-1 : PFCP Session Establishment procedure with FQ-CSID\nThe SMF and the UPF shall assign only one FQ-CSID for a given PFCP session and each FQ-CSID shall have exactly one CSID within the FQ-CSID. The peer PFCP node shall store the received FQ-CSID for the related PFCP session.\nThe receipt of a FQ-CSID also implicitly indicates that the peer FFCP node supports the feature.\nThe SMF and the UPF may update the FQ-CSID associated to a PFCP session during a PFCP session modification procedure, by signalling the SMF FQ-CSID in the PFCP Session Modification Request or the UPF FQ-CSID in the PFCP Session Modification Response, as shown in Figure 4.6.2-2.\nThe figure depicts a simplified representation of the PFCP (Packet Forwarding Control Protocol) session management procedure, with changes in the FQ-CSID (Frame Queue Control Sequence Identifier) indicating the initiation of a new session. The figure illustrates the process of selecting a new FQ-CSID, which is crucial for maintaining the integrity of the session.\nFigure 4.6.2-2: PFCP Session Modification procedure with change of FQ-CSID\nAn SMF that detects then that it has undergone a partial failure shall send a PFCP Session Set Deletion Request, including all its CSIDs corresponding to the component(s) that failed, to the UPF, if the UPF is known to support the feature, as shown in Figure 4.6.2-3.\nThe figure depicts a 6.2-3 SMF initiated PFCP Session Set Deletion procedure, which is a crucial step in the network's security and management processes. The figure illustrates the steps involved in initiating a PFCP session, setting up a deletion procedure, and ensuring the deletion process is completed successfully.\nFigure 4.6.2-3: SMF initiated PFCP Session Set Deletion procedure\nLikewise, an UPF that detects then that it has undergone a partial failure shall send a PFCP Session Set Deletion Request, including all its CSIDs corresponding to the component(s) that failed, to the SMF, if the SMF is known to support the feature, as shown in Figure 4.6.2-4.\nThe figure depicts a 6.2-4 UPF initiated PFCP Session Set Deletion procedure, illustrating the steps involved in initiating a PFCP session and deleting it. The figure includes a UPF (User Plane Function) initiated PFCP Session Set, which is a key component in the network's control plane. The deletion procedure involves the deletion of the PFCP Session Set, ensuring that the network remains secure and efficient.\nFigure 4.6.2-4: UPF initiated PFCP Session Set Deletion procedure\nUpon receiving a PFCP Session Set Deletion Request reporting a partial failure for one or more FQ-CSID(s), the SMF or UPF shall find the PFCP sessions matching the FQ-CSID(s) and then proceed with the restoration procedures specified in clause 4 for an SMF or UPF failure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.7\tRestoration of PFCP sessions associated with a specific FQ-CISD, Group ID or SMF IP Address",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.7.1\tGeneral",
                            "text_content": "To reduce signalling latency and achieve a better load balancing among SMFs in a SMF Set when it is deployed, an SMF in a SMF Set and a UPF may support the procedures specified in this clause. These procedures enable an SMF from the same set to request UPF to move PFCP sessions associated with certain FQ-CSIDs (when partial failure handling is supported as specified in clause 4.6), Group IDs or SMF IP addresses, to (another) SMF(s) in the set proactively, without causing massing signalling (per PFCP session) towards UPF(s).\nNOTE:\tThe FQ-CSID can only be used in the procedure specified in this clause when the partial failure feature (using FQ-CSID) is deployed and used (not to force the NF to use a Group ID). For a network where the partial failure feature is not deployed, a Group ID or a SMF IP address needs to be used.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.2\tAllocation of Group Id or FQ-CSID to a PFCP session",
                            "text_content": "To optimize the resource utilization for PFCP session(s), e.g. to meet different traffic requirements for different APNs/DNNs and/or DCNs/Network Slices, and also to facilitate moving a (sub)set of PDN connections/PFCP sessions among an SMF set, e.g. for a partial or complete SMF failure or a scale-in operation, an SMF in a SMF Set may:\n-\tallocate a globally unique Group Id in the PFCP Session Establishment Request message for a PFCP session during a PFCP session establishment procedure and update the Group Id, if necessary, in subsequent PFCP Session Modification Request messages (see also clause 5.22.X of 3GPP TS 29.244 [43]).\nAlternatively, if partial failure handling is supported, the SMF may assign an FQ-CSID to a PFCP session as specified in clause 4.6.\nSubsequently, e.g. when a partial or complete failure takes place affecting all PFCP sessions which are sharing either the same FQ-CSID or the Group ID (see clause 4.7.1), a PGW-C/SMF in a PGW-C/SMF Set may trigger the restoration procedure for those affected PFCP sessions as specified in clauses 4.7.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.3\tRestoration of PFCP sessions associated with an FQ-CSID, Group ID or SMF IP Address",
                            "text_content": "When there is a need to change the SMF controlling certain PFCP sessions, e.g. when a partial or complete failure takes place, the SMF (either the SMF serving the PFCP sessions or another SMF in the same Set taking over the control of the PFCP sessions) may send a PFCP Session Set Modification Request message to the UPF(s) to request the UPF(s) to send subsequent PFCP Session Report Request messages to the alternative SMF (as indicated in the Alternative SMF IP Address IE) for the PFCP sessions which are associated with the FQ-CSID(s) or Group ID(s), or which have their CP F-SEIDs containing the SMF IP Address as shown in Figure 4.7.3-1.\nThe SMF may instruct the UPF to move sessions associated with different SMF FQ-CSIDs, Group Ids or SMF IP addresses, to different SMF addresses.\n\nThe figure depicts a step-by-step process for initiating a PFCP session set modification procedure in a 5G network. It illustrates the steps involved in modifying the session set, including the initiation of the session set, the selection of the session set, and the modification of the session set. The figure also includes a visual representation of the network topology, with the SMF (Service Mobility Framework) and the PFCP (Packet Flow Control Protocol) being highlighted. The figure is a crucial visual aid for understanding the process and ensuring that the correct steps are followed during the modification procedure.\nFigure 4.7.3-1: SMF initiated PFCP Session Set Modification procedure\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "5\tRestoration Procedures related to the User Plane Interfaces N3 and N9",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause specifies the procedures supported in the 5G System to detect and handle failures affecting the user plane interfaces N3 and N9\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tUser Plane Failure Detection",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tLoss of GTP-U contexts",
                            "text_content": "A GTP-U entity may lose its GTP-U contexts upon a failure or restart.\nWhen a GTP-U node receives a G-PDU for which no corresponding GTP-U tunnel exists, the GTP-U node shall discard the G-PDU and return a GTP-U Error Indication to the sending node, as specified in clause 7.3.1 of 3GPP TS 29.281 [3].\nThe receipt of a GTP-U Error Indication is an indication for the sending GTP-U entity that the peer GTP-U entity cannot receive any more user plane traffic on the corresponding GTP-U tunnel.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tUser Plane Path Failure",
                            "text_content": "A GTP-U entity may detect a user plane path failure by using GTP-U Echo Request and Echo Response messages, as specified in clause 20.3.1 of 3GPP TS 23.007 [2].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3\tRestoration Procedures upon Loss of GTP-U contexts",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tGeneral",
                            "text_content": "The following clauses specify the behaviour of the different network entities when receiving a GTP-U Error Indication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.2\tProcedure for GTP-U Error Indication received from 5G-AN",
                            "text_content": "The figure depicts a GTP-U error indication from 5G-AN, which is a crucial component in the 5G network. It shows the error indicator in a graphical format, providing a clear visual representation of the error status. This helps network operators to quickly identify and resolve any issues, ensuring the smooth operation of the network.\nFigure 5.3.2.1-1: GTP-U Error Indication from 5G-AN\n1.\tThe user plane connection of an existing PDU session is activated. Downlink G-PDUs are sent towards the 5G-AN.\n2.\tThe 5G-AN returns a GTP-U Error Indication if it does not have a corresponding GTP-U context (see clause 5.2).\n3.\tUpon receipt of a GTP-U Error Indication, the UPF shall identify the related PFCP session and send an Error Indication Report to the SMF, as specified in clause 5.10 of 3GPP TS 29.244 [4].\n4.\tFor a GTP-U Error Indication received from a 5G-AN, the SMF shall modify the PFCP session to instruct the UPF to buffer downlink packets.\n5.\tIf the user plane connection of the PDU session is seen as activated by the SMF, the SMF shall initiate an Namf_Communication_N1N2MessageTransfer service operation to request the 5G-AN to release the PDU session's resources, as specified in clause 4.3.7 of 3GPP TS 23.502 [5].\n6.\tUpon receipt of an Namf_Communication_N1N2MessageTransfer request to transfer the PDU Session Resource Release Command, the AMF shall:\n-\tproceed with the request, as specified in clause 5.2.2.3.1 of 3GPP TS 29.518 [6], if the UE is in CM-CONNECTED state for the Access Network Type associated to the PDU session;\n-\totherwise, reject the request with an error indicating that the UE is in CM-IDLE state for the Access Network Type associated to the PDU session.\n7.\tIf the AMF sent a PDU Session Resource Release Command to the 5G-AN, the PDU session's resource release is acknowledged to the SMF.\n8.\tThe SMF initiates the Network Triggered Service Request procedure specified in clause 4.2.3.3 of 3GPP TS 23.502 [5], to re-activate the user plane connection of the PDU session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.3\tProcedure for GTP-U Error Indication received from UPF",
                            "text_content": "Upon receipt of a GTP-U Error Indication, the 5G-AN shall proceed as follows:\n-\tif the GTP-U Error Indication was received from an UPF over a NG-U tunnel that is not an indirect forwarding tunnel, the 5G-AN shall initiate a PDU Session Resource Notify procedure and release immediately the resources of the PDU session for which the Error Indication was received. The 5G-AN should indicate to the SMF that the release is due to receiving the GTP-U Error Indication from the NG-U tunnel.\nUpon receiving this information, the SMF may re-establish the PFCP session for the affected PDU session using the procedure specified in clause 4.3.2, if the related UPF is a PSA UPF or is an I-UPF controlled by the same SMF;\n-\tif the GTP-U Error Indication was received from a peer5G-AN over a Xn-U direct forwarding tunnel or an UPF over a NG-U indirect forwarding tunnel, the 5G-AN may ignore the error indication or delete the forwarding tunnel context locally without deleting the corresponding PDU session and bearers.\nNOTE:\tThe 5G-AN behaviour for dual connectivity is not described in this specification.\nUpon receipt of a GTP-U Error Indication, the UPF shall identify the related PFCP session and send an Error Indication Report to the SMF, as specified in clause 5.10 of 3GPP TS 29.244 [4].\nUpon receipt of an Error Indication Report from the UPF, the SMF shall identify the PDU session for which the Error Indication is received using the remote F-TEID included in the report.\nFor a GTP-U Error Indication received from another UPF, the SMF shall delete the PFCP session and PDU session, unless the UPF from which the Error Indication was received is controlled by the same SMF and the SMF is able to restore the user plane connectivity of the PDU session (e.g. Error Indication received from an Intermediate UPF controlled by the same SMF).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.4\tRestoration Procedures upon User Plane Path Failure",
                    "description": "",
                    "summary": "",
                    "text_content": "Upon detecting a GTP-U user plane path failure as specified in clause 5.2.2, the UPF shall report the user plane path failure to the SMF, by sending a PFCP Node Report Request (see 3GPP TS 29.244 [4]) including a User Plane Path Failure Report with the IP address of the remote GTP-U peer(s) towards which a failure has been detected. The UPF should also notify the GTP-U user plane path failure via the Operation and Maintenance system.\nUpon detecting a failed GTP-U user plane path become recovered, the UPF shall report the user plane path recovery to the SMF, by sending a PFCP Node Report Request (see 3GPP TS 29.244 [4]) including a User Plane Path Recovery Report with the IP address of the remote GTP-U peer(s) associated with the recovered user plane path. The UPF should also notify the GTP-U user plane path recovery via the Operation and Maintenance system.\nWhen the SMF receives the PFCP Node Report Request with a User Plane Path Failure Report, the SMF may:\n-\tdelete the PDU session contexts associated with the path in failure; or\n-\tmaintain the PDU session contexts associated with the path in failure during an operator configurable maximum path failure duration. The SMF shall delete the PDU session contexts associated with the path in failure if the path is still down when this duration expires; or\nNOTE 1:\tDuring transient path failures (e.g. path failures not exceeding few minutes at most), maintaining the PDU session contexts associated with the peer's IP address enables the delivery of end user services (when the path is re-established again) and this also avoids unnecessary signalling in the network for restoring those PDU sessions.\nNOTE 2:\tIt is not intended to maintain PDU session contexts during long path failures (e.g. exceeding few minutes at most) as this would imply undesirable effects like undue charging.\n-\tmaintain the PDU session contexts associated with the path in failure if the path in failure is towards a 5G-AN. When deciding to maintain the PDU session contexts, it shall send a PFCP Session Modification Request message with changing Apply-Action from FORW to BUFF and NOCP for each affected PFCP session. In addition, upon receipt of subsequent downlink data notifications from the UPF or the service request from affected UE, the SMF will try to reestablish the PDU session resources in the NG-RAN. As an implementation option, the SMF may try to re-establish the PDU session resources in the NG-RAN for those PDU sessions associated with the user plane path in failure prior to receiving downlink data notifications from the UPF or service request from the affected UE.\nNOTE 3:\tThis approach (as above for user plane path failure towards a 5G-AN) allows to maintain the PDU session even for non-transient path failures. For a PDU session with I/V-SMF, the pause of charging (as specified in clause 4.4.4 of 3GPP TS 23.502 [5]) ensures that there is no undue charging.\nWhen deciding to delete the PDU session contexts associated with the path in failure, the SMF shall modify or delete the affected PFCP sessions in the UPF.\nNOTE 4:\tThe SMF need to take care to smoothen the signalling load towards the UPF if a large number of PFCP sessions are affected by the user plane path failure.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.5\tReporting of a Peer GTP-U Entity Restart",
                    "description": "",
                    "summary": "",
                    "text_content": "To reduce massive amount of N4 signalling to report the receiving of GTP-U Error Indication messages and to perform subsequent PFCP Session Modification for PFCP sessions affected by the peer GTP-U restart, a user plane function (UPF) and a control plane function (SMF) may optionally support reporting of a peer GTP-U entity restart.\nA GTP-U entity, e.g. in a UPF, may detect the restart of the peer GTP-U entity as specified in clause 18A of 3GPP TS 23.007 [2].\nWhen the user plane function detects the peer GTP-U entity has restarted via receiving one or more GTP-U Error Indication message(s) or Echo Request/Response message(s) containing a larger Recovery Time Stamp, and when the control plane function supports Reporting of a GTP-U Entity Restart, it shall send a PFCP Node Report Request message to the control plane function to report that:\n-\tthe peer GTP-U entity identified by Remote GTP-U Peer IE has restarted; and\n-\tall PFCP sessions associated with the restarted peer GTP-U entity have been modified by the user plane function, i.e. the F-TEID(s) that had been allocated by the restarted GTP-U entity have been removed from the FARs and the Apply-Action in these FARs changed to BUFF and NOCP, if the restarted GTP-U entity is a 5G-AN.\nNOTE:\tThe UP function can learn if the restarted GTP-U entity is a 5G-AN by using the Destination Interface Type included in the Forwarding Parameters in the FAR (which contains the F-TEID that had been allocated by the restarted GTP-U entity).  The control plane function shall send a PFCP Node Report Response message to acknowledge the receipt of the report of the peer GTP-U entity restart; and the control plane may further behave as if it receives a Error Indication Report for those PFCP sessions affected by the peer GTP-U entity restart, e.g. to trigger a Network Triggered Service Request procedure if the restarted GTP-U entity is a 5G-AN. (see also clause 5.3)\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "6\tRestoration Procedures related to Service-Based Interfaces",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "A NF may detect a failure or a restart of a peer NF or NF service using the NRF as specified in clause 6.2.\nA NF may also detect a restart of a peer NF or NF service by receiving recovery time information in signalling exchanged with that peer NF or NF service.\nWhen NF (Service) Set is deployed in the network as specified in clauses 5.21.3 and 6.3.1.0 of 3GPP TS 23.501[9], an NF Service Producer in a NF (Service) Set creates resource contexts and the context data is shared by all the NF (Service) instances pertaining to the same NF (Service) set, i.e. the resource context is bound to the NF (Service) Set. So, requests targeting the resource may be served by any NF (Service) Instance within the NF (Service) set, unless the shared contexts are lost (which is further referenced in this specification as \"the NF (Service) Set has failed or restarted\").\nIn order to enable peer NFs to detect the loss of the resource contexts, i.e. the \"restart of the NF (Service) Set or NF instance\", and trigger appropriate restoration procedures, the NF Service Producer may provide a recovery timestamp associated to the highest resiliency level that it supports for the resource context, i.e. the binding entity with which the context data is shared (bound). Binding entities are sorted from the highest to the lowest resilience levels as follows: an NF Set, NF Instance, NF service set or NF service instance. The NF Service Producer may signal this recovery timestamp and its corresponding binding entity, in direct HTTP signalling or via the NRF.\nNOTE 1:\tSignalling the recovery timestamp of an NF (Service) Set or an NF (Service) Instance via the NF profile in the NRF does not require the support of Binding Indication.\nNOTE 2:\tSignalling the recovery timestamp and its corresponding binding entity in direct HTTP signalling requires the use of a Binding Indication (i.e. \"3gpp-sbi-binding\" HTTP header, see clause 5.2.3.2.6 of 3GPP TS 29.500 [10]). When multiple binding entities are present in a Binding Indication, the binding entity with the highest resiliency level is associated with the recovery timestamp; otherwise (if there is only one binding entity in a Binding Indication), the recovery timestamp is associated with that binding entity in the Binding Indication.\nA NF may prioritize the contexts to restore based on operator's policy.\nA NF should control/regulate the load induced on a peer NF or NF service when performing the restoration procedures.\nThe restoration procedures initiated when detecting a failure or a restart are not specified in this release.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.2\tNF (NF Service) Failure and Restart Detection using the NRF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tGeneral",
                            "text_content": "This clause describes optional procedures that may be supported by NFs to detect the failure or restart of a NF or a NF service using the NRF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2\tNF (NF Service) Failure",
                            "text_content": "Figure 6.2.2-1 describes a NF failure scenario and how other NFs can be notified of this failure.\nThe figure depicts a network failure detection and notification system, showing a failure indicator (red dot) and a notification message (text). The system uses a combination of sensors, such as temperature, humidity, and pressure, to detect potential failures and alert the network manager. The system also includes a notification system that sends a message to the network manager, allowing them to take appropriate action to resolve the issue.\nFigure 6.2.2-1: NF Failure Detection and Notification\n1.\tNF A subscribes to the NRF to receive notifications of changes of the NF B Profile, as specified in 3GPP TS 29.510 [7].\n2.\tA NF failure occurs at NF B.\n3.\tThe NRF detects that NF B is no longer operative using the NF Heart-Beat procedure as specified in clause 5.2.2.3.2 of 3GPP TS 29.510 [7]. The NRF changes the NFStatus of NF B to SUSPENDED.\n4.\tThe NRF notifies NFs having subscribed to receive notifications of changes of the NF B Profile that the NFStatus of NF B is changed to SUSPENDED.\n5.\tNF A may trigger appropriate restoration or clean-up actions, if it cannot communicate with NF B.\n\nFigure 6.2.2-2 describes a NF service failure scenario and how other NFs can be notified of this failure.\nThe figure depicts a network failure detection and notification system, showing how NF Service Failure Detection and Notification (NFSDN) is implemented. The system includes a network failure detection module, a notification module, and a system monitoring module. The NFSDN module is responsible for detecting network failures and notifying the system administrator. The notification module is responsible for notifying the system administrator of the network failure and providing a detailed report of the failure. The system monitoring module is responsible for monitoring the network performance and ensuring that the system is functioning properly.\nFigure 6.2.2-2: NF Service Failure Detection and Notification\n1.\tNF A subscribes to the NRF to receive notifications of changes of the NF B Profile.\n2.\tA NF Service failure occurs at NF B. NF B (other than the failed NF Service) is still operative.\n3.\tNF B (or OAM) updates its NF Profile in the NRF, by setting the NFServiceStatus of the failed NF Service to SUSPENDED.\n4.\tThe NRF notifies NFs having subscribed to receive notifications of changes of NF B Profile that the NF Service status of the failed NF service of NF B is changed to SUSPENDED.\n5.\tNF A triggers appropriate restoration or clean-up actions, if it cannot communicate with the NF B service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3\tNF (NF Service) Restart",
                            "text_content": "Figure 6.2.3-1 describes a NF restart scenario and how other NFs can be notified of this restart.\nThe figure depicts a schematic representation of NF Restart Detection and Notification, highlighting the various components involved in the process. The diagram includes a network flow chart, a flow diagram, and a flow chart, all illustrating the steps and interactions between the different components. The flow chart shows the flow of data from the source to the destination, with the NF Restart Detection and Notification process highlighted in red. The flow diagram shows the flow of data from the source to the destination, with the NF Restart Detection and Notification process highlighted in red. The flow diagram shows the flow of data from the source to the destination, with the NF Restart Detection and Notification process highlighted in red.\nFigure 6.2.3-1: NF Restart Detection and Notification\n1.\tNF B (or OAM) registers NF B Profile to the NRF. The NF B Profile may include the recoveryTime attribute, if a restart of NF B results in losing contexts.\n\nNF B Profile may include the recoveryTime attribute of the NF Set to which NF B pertains to, when NF B pertains to an NF Set, i.e. when the resource contexts created in the NF B is bound to the NF Set, i.e. resource contexts are accessible by all NF Instances within the NF Set.NOTE 1:\tThe restart of an NF Set indicates that resource contexts bound to the NF Set (i.e. that are accessible by all NF Instances within the NF Set) have been lost.2\tNF A subscribes to the NRF to receive notifications of changes of the NF B Profile.\n3.\tNF B restarts.\n4.\tIf contexts are lost during the restart, NF B (or OAM) updates the recoveryTime in its NF Profile in the NRF.\n\nNF B Profile shall update the recoveryTime attribute of the NF Set to which NF B pertains to, if the whole NF Set has restarted and NF B has registered the recoveryTime for that NF Set.\n5.\tThe NRF notifies NFs having subscribed to receive notifications of changes of NF B Profile about the updated recoveryTime of the NF B Profile or updated recoveryTime of NF Set to which the NF B pertains to.\n6.\tNF A may consider that all the resources created in the NF B before the NF B recovery time as have been lost. NF A triggers then appropriate restoration or clean-up actions.\n\nFigure 6.2.3-2 describes a NF service restart scenario and how other NFs can be notified of this restart.\nThe figure depicts a system for NF Service Restart Detection and Notification. It shows a flowchart with various stages, including a check for the status of the NF Service Restart, a notification to the user, and a response to the user's action.\nFigure 6.2.3-2: NF Service Restart Detection and Notification\n1.\tNF B (or OAM) registers its NF B Profile (and its services) to the NRF. The NF B Profile may include the recoveryTime attribute for the NF Services it supports, if a restart of a NF B service results in losing contexts. The NF B Profile may include the recoveryTime attribute of either the NF Service Set, NF Instance or NF Set to which the NF Service Instance pertains to, when the resource context for the NF Service created in NF B is bound to NF Service Set, or NF Instance, or NF Set respectively, i.e. accessible by all NF Service Instances within an NF Service Set, NF Instance or NF Set respectively (see clause 6.3.1.0 of 3GPP TS 23.501 [9]).\nNOTE 2:\tThe restart of an NF Service Set indicates that the resource contexts bound to the NF Service Set (i.e. accessible by all NF Service Instances within the NF Service Set) have been lost.\n2\tNF A subscribes to the NRF to receive notifications of changes of the NF B Profile.\n3.\tA NF B service restarts.\n4.\tIf contexts are lost during the service restart, NF B (or OAM) updates the recoveryTime of the corresponding NF Service in the NRF. NF B (or OAM) shall update the recoveryTime attribute of the NF Service Set, NF Instance or NF Set to which the NF Service Instance pertains to, when the whole NF Service Set, NF Instance or NF Set has restarted respectively.\n5.\tThe NRF notifies NFs having subscribed to receive notifications of changes of the NF B Profile about the updated recoveryTime of the NF B Service or updated recoveryTime of the NF B Service Set, NF Instance or NF Set.\n6.\tNF A may consider that all the resources created in the NF B service before the NF B service recovery time as have been lost. NF A triggers then appropriate restoration or clean-up actions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.3\tNF Service Producer Restart Detection using direct signalling between NFs",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3.1\tGeneral",
                            "text_content": "This clause describes an optional procedure that may be supported by NFs to detect the restart of a peer NF service using direct signalling between NFs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.2\tNF Service Producer Restart",
                            "text_content": "Figure 6.3.2-1 describes a NF Service restart scenario of an NF Service Producer and how the NF Service Consumer can detect this restart.\nThe figure depicts a NF Service Producer Restart Detection system, illustrating the process of detecting and restarting a service producer in a network. The system uses a combination of network functions virtualization (NFV) and network functions orchestration (NFSO) to ensure efficient and reliable service delivery. The figure shows the various components involved in the system, such as the service producer, network functions, and orchestration, and their interactions to maintain a stable and efficient network.\nFigure 6.3.2-1: NF Service Producer Restart Detection\n1.\tNF A (NF Service Consumer) requests to create a resource in the NF B (NF Service Producer).\n2.\tIf the request is accepted, and if NF B implements the procedure specified in this clause, NF B shall return its NF B service instance ID in the response, and NF A shall associate the created resource with the NF B service instance if no Binding Indication is received from NF B.\nIn the response message, the NF B that supports this procedure may include the recovery timestamp in the Binding Indication (i.e. in the \"3gpp-sbi-binding\" HTTP header). An NF A that supports this procedure shall associate the created resource with the binding entity and the recovery timestamp as specified in clause 6.1.\n3.\tA NF service produced by NF B restarts, e.g. an NF Service Instance in NF B, an NF Service Set in NF B, NF B or the NF Set to which NF B pertains has restarted.\n4-5.\tNF B Service Producer may include its last recovery timestamp in responses it sends to the NF A Service Consumer, if the restart of the NF service resulted in losing contexts and e.g. if the NF service has restarted recently.\n6.\tNF A may consider that all the resource contexts are lost, which were created in the NF B service instance before the updated recovery timestamp, if the recovery timestamp was associated to the NF B service instance.\n\nIf the recovery timestamp was associated to an NF Service Set, NF Instance or NF Set, NF A may consider that all the resource contexts are lost, which were created in these binding entities before the recovery, as indicated in the received recovery timestamp.\n\nNF A may trigger then appropriate restoration or clean-up actions.\nNOTE 1:\tThe recovery time signalled in this procedure is equivalent to the recovery time of the NF service of Figure 6.2.3-2. For an entire NF restart scenario, this procedure can be applied by each NF service instance of the NF.\nNOTE 2:\tThis procedure enables the detection of a restart of a peer NF service when sending signalling towards that NF Service. It can fasten the detection of a restart of a peer NF service when frequent signalling occurs towards that peer NF Service.\nNOTE 3:\tIn some use cases, NF A is not aware of the NF B Service Instance ID when creating the resource, e.g. a V-SMF just receives the H-SMF URI from the AMF to create a PDU session resource in H-SMF. Besides, for APIs supporting distributed collections (e.g. SMF), the response can contain a different Service Instance ID (that need not be registered in the NRF) than the one selected by NF A for sending the request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.4\tNF Service Consumer Restart Detection using direct signalling between NFs",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.4.1\tGeneral",
                            "text_content": "This clause describes an optional procedure that may be supported by NFs to detect the restart of a peer NF Service Consumer by NF Service Producer using direct signalling between NFs.\nWhen NF (Service) Set is deployed in the network as specified in clause 5.21.3 and 6.3.1.0 of 3GPP TS 23.501[9], an NF Service Consumer in an NF (Service) Set may create a session context for callback (corresponding to the resource context in the NF Service Producer) when invoking a NF Service and the session context data is shared by all NF (Service) instances pertaining to the same NF (Service) set, i.e. the context is bound to the NF (Service) Set. So, any NF (service) instance within the NF (service) set is able to receive notifications or callback request from the NF Service Producer, unless the shared contexts are lost (which is further referenced in this specification as \"the NF (Service) Set has failed or restarted\").\nIn order to enable peer NF Service Producers to detect the loss of the session contexts in the NF Service Consumer, i.e. the \"restart of the NF (Service) Set or NF instance\", and trigger appropriate restoration procedures,  the NF Service Consumer may provide a recovery timestamp associated to the highest resiliency level it supports for the context, i.e. the binding entitiy with which the context data is shared (bound). Binding entities are sorted from the highest to the lowest resilience levels as follows: an NF Set, NF Instance, NF service set or NF service instance. The NF Service Consumer may signal this recovery timestamp in direct HTTP signalling, using a Binding Indication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.2\tNF Service Consumer Restart",
                            "text_content": "Figure 6.4.2-1 describes a NF Service Consumer restart scenario and how the NF Service Producer can detect this restart.\nThe figure depicts a NF Service Consumer Restart Detection system, illustrating the process of detecting and restarting a NF Service Consumer (NFC) in a network. The system uses a combination of hardware and software components to detect and respond to the restart of NFCs, ensuring the network remains operational and efficient.\nFigure 6.4.2-1: NF Service Consumer Restart Detection\n1.\tNF A (NF Service Consumer) requests to create a resource in the NF B (NF Service Producer). If NF A implements the procedure specified in this clause, it shall include a Consumer Id together with the last recovery timestamp in the request. The Consumer Id shall be identical for all service requests triggered by the NF service consumer for that service and shall be globally unique (e.g. using UUID).\n\nIf NF A includes Binding Indication(s) (i.e. in the \"3gpp-sbi-binding\" HTTP header) in the request, NF A may include the recovery timestamp for the higher level binding entity indicated in the Binding Indication with the scope set to \"callback\" (see clause 5.2.3.2.6 of 3GPP TS 29.500 [10]).\n2.\tIf resource creation is successful, NF B as service producer shall store the received Consumer Id and recovery timestamp and associate the created resource with it.\n\nAn NF B that supports this procedure shall associate the callback resource and the recovery timestamp to the higher level binding entity indicated in the received Binding Indication (with the scope set to \"callback\").\n\nIf the Service Request contains Binding Indication(s) with the scope set to \"other service\", the NF B may use the binding information and associated recovery timestamp to detect whether resources that NF B has created in NF A have been lost, according to the principles specified in clause 6.3.2.\n3.\tThe NF service consumer in NF A restarts.\n4.\tThe NF service consumer in NF A shall include its last recovery timestamp together with the Consumer Id in the request when invoking service provided by NF B. The same Consumer Id shall be used after restarting.\n\nIf NF A includes Binding Indication(s) in the request, NF A shall include the updated recovery timestamp for the higher level binding entity to which the callback resource context is bound in the Binding Indication with the scope set to \"callback\".\n5.\tNF B as NF service producer may compare the received recovery timestamp with previous stored and detect the NF service consumer has restarted, if the received recovery timestamp is newer than the previous one.\nThe consumer Id for the resource or the Binding Indication with the scope set to \"callback\" may be updated if another service consumer took over the usage of the resource. e.g. if a new consumer Id is received during a service operation of a resource. NF B as NF service producer shall consider the service consumer handling the resource has changed and associate the resource with the new consumer Id or according to the new Binding Indication and with the corresponding recovery timestamp.\n6.\tNF B may consider that the contexts in NF A corresponding to all the resources associated with the consumer Id or all resources bound to the entity (with which the recovery timestamp is associated) and the previous stored recovery time stamp have been lost. NF B triggers then appropriate restoration or clean-up actions.\nNOTE 1:\tThis procedure is only supported by NF services that support signalling the recovery timestamp attribute.\nNOTE 2:\tThis procedure can be used when the resource is exclusively used by an NF service consumer.\nNOTE 3:\tThis procedure enables the detection of a restart of a peer NF service consumer when sending signalling towards that NF service producer. It is helpful if the NF A as a pure service consumer without registration of its profile in NRF. If NF A does have a profile registered in NRF, it also can fasten the detection of a restart of a peer NF service consumer when frequent signalling occurs towards that peer NF Service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.5\tNF Service Producer Instance Reselection",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.5.1\tGeneral",
                            "text_content": "An NF Instance of an NF Service Producer may expose several service instances of the same NF Service (e.g., an UDM instance may expose several service instances of the \"Nudm_SubscriberDataManagement\" service).\nAn NF Service Consumer may discover, while an SCP shall be able to discover, via NRF Nnrf_NFDiscovery service, all available NF Service Instances for a given NF Service and select one of them.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.2\tNF Service Instance Reselection when a (Routing) Binding Indication is available",
                            "text_content": "When using the Binding procedures specified in clause 6.12 of 3GPP TS 29.500 [10], Binding Indications and Routing Binding Indications include the Binding level and one or more Binding entity IDs representing all NF service instances that are capable to serve service requests targeting the resource, i.e. that share the same resource contexts.\nWhen a Binding Indication or a Routing Binding Indication is available for a target resource, NF Service Instance selection and re-selection shall be supported as specified in clause 6.12 of 3GPP TS 29.500 [10].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.3\tNF Service Instance Reselection when a (Routing) Binding Indication is not available",
                            "text_content": "If a formerly selected NF Service Instance becomes unavailable, the NF Service Consumer may, while the SCP shall be able to select a different instance of a same NF Service in:\n-\tthe same NF Instance, if the NF Instance indicates in its NF Profile that it supports the capability to persist their resources in shared storage inside the NF Instance, and if the new NF Service Instance offers the same major service version; or\n-\tthe same NF Set or NF Service Set, if the NF (service) instance indicates in its NF Profile that it belongs to an NF Set or an NF Service Set.\nIf so, the NF Service Consumer may, while the SCP shall be able to invoke service operations in the newly selected NF Service Instance by means of replacing the addressing parameters with those of the new service instance, and the new NF Service Instance in the NF Service Producer shall produce the same result as if the service request would have been successfully delivered to the former NF Service Instance.\nNOTE 1:\tIn some scenarios, the newly selected NF Service Producer might not produce the exact same result as the former NF Service Producer would have produced for the service request, e.g. when the former NF Service Producer failed before it could update a change in the resource context to the USDF.\nFor indirect communication, if the NF service consumer delegates target NF service instance reselection to the SCP (when the target NF service instance is not reachable), the NF Service Consumer shall include at least one of the 3gpp-Sbi-Discovery-target-nf-instance-id, 3gpp-Sbi-Discovery-target-nf-set-id, 3gpp-Sbi-Discovery-target-nf-service-set-id, 3gpp-Sbi-Discovery-amf-region-id and 3gpp-Sbi-Discovery-amf-set-id headers, and it should also include at least the following information in its request to the SCP:\n-\tthe target NF type, the service name, and the requested S-NSSAI in the corresponding \"3gpp-Sbi-Discovery-*\" request header(s) (see clause 6.10.3.2 of 3GPP TS 29.500 [10]).\nNOTE 2:\tThis is to allow the SCP to discover and reselect a target NF service instance from the target NF instance or target NF (service) set for the corresponding service request and supporting the requested S-NSSAI, e.g. when the NF service producer supports different NF service instances serving different network slices. Likewise, other \"3gpp-Sbi-Discovery-*\" request header(s), e.g. target-plmn-list, can also be included for the same purpose.\nNOTE 3:\tThe inclusion of the 3gpp-Sbi-Discovery-target-nf-instance-id in an HTTP request enables the SCP to discover the profile of the target NF instance and to possibly reselect a different target NF service instance from the same NF instance or from a different NF instance in the same set.\nIf so, the SCP shall use the information provided by the NF service consumer to perform a NF service discovery procedure and reselect a NF (service) producer instance as specified in the preceding bullets, if possible and if the target NF Service Instance indicated in the \"3gpp-Sbi-Target-apiRoot\" header or target URI is not reachable.\nNOTE 4:\tThis reselection mechanism is applicable only for the request/response service semantics, but not for notify/callback requests.\nIf the NF instance does not indicate in its NF Profile the support of the capability to persist their resources in shared storage across service instances of the same NF Service, inside the NF Instance, and if it does not indicate in its NF Profile that it belongs to an NF Set or an NF Service Set, the NF Service Consumer or SCP may still reselect any of the exposed service instances, but it shall not assume that the resources created in the former service instance are still valid.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.6\tNF Service Consumer Instance Reselection",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.6.1\tGeneral",
                            "text_content": "When NF (Service) Set is deployed in the network as specified in clauses 5.21.3 and 6.3.1.0 of 3GPP TS 23.501[9], an NF Service Consumer in an NF (Service) Set may create a session context for callback (corresponding to the resource context in the NF Service Producer) when invoking a NF Service and the session context data is shared by all NF (Service) instances pertaining to the same NF (Service) set, i.e. the context is bound to the NF (Service) Set.\nAn NF Service Producer may, while the SCP shall be able to discover, via NRF Nnrf_NFDiscovery service, all available NF (Service) Instances within the NF (service) set that are capable to receive the notifications or callback requests and select one of them.\nNOTE:\tWhen an NF service consumer changes, if the new NF service consumer does not support handling the notification or callback requests as described above, the new NF service consumer updates NF service producers with new URI as specified in clause 6.5.3.2 of 3GPP TS 29.500 [10].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.2\tNF Service Consumer Instance Reselection when a (Routing) Binding Indication is available",
                            "text_content": "When using the Binding procedures specified in clause 6.12 of 3GPP TS 29.500 [10], Binding Indications and Routing Binding Indications include the Binding level and one or more Binding entity IDs representing all NF service consumer instances that are capable to receive the notifications or callback requests targeting the session context for callback (corresponding to the resource context in the NF Service Producer). See also clause 6.5.3.2 of 3GPP TS 29.500 [10].\nWhen a Binding Indication or a Routing Binding Indication is available for a target context, NF Service Consumer selection and re-selection shall be supported as specified in clause 6.12 of 3GPP TS 29.500 [10].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.3\tNF Service Consumer Instance Reselection when a (Routing) Binding Indication is not available",
                            "text_content": "When the target NF Service Consumer becomes unavailable, the NF Service Producer may, while the SCP shall be able to select a different instance of the Service Consumer which is capable to receive the notifications or callback requests targeting the session context for callback (corresponding to the resource context in the NF Service Producer) in:\n-\tthe same consumer NF instance, using an alternate endpoint address information if any is configured at the NF instance level, or at the NF service instance level when the name of the NF service to which these notifications are to be sent is known and the (consumer) NF instance registered in its NF Profile that it is capable to persist its resources in shared storage across NF service instances of the same NF Service;\n-\tthe same NF (service) Set or a backup NF Service Consumer if applicable.\nNOTE 1:\tWhen binding procedures are not supported, the NF Service Consumer can provide in certain APIs the name of the NF service to which these notifications are to be sent. This service can be one of the service produced by the NF (if this NF Service Consumer can also serve as a NF Service Producer) and registered in the NRF, or a custom service registered in the NRF for the purpose of receiving these notifications). See clause 6.5.2.2 of 3GPP TS 29.500 [10].\nNOTE 2:\tWhen the AMF serves as a NF Service Consumer, it can indicate to the NF Service Producer its backup AMF. See clause 5.21.2 of 3GPP TS 23.501 [9].\nNOTE 3:\tNF Service Consumer Reselection when a (Routing) Binding Indication is not available is only supported when the NF Service Producer has the target NF Service Consumer information available, e.g.  for APIs where the NF Service Consumer can communicate its NF Instance Id to the NF Service Producer in the service request message.\nIf so, the NF Service Producer may, while the SCP shall be able to send the notification or callback request to the newly selected NF Service Consumer Instance by means of replacing the addressing parameters with those of the newly selected instance. If the Callback URI included a prefix it shall be removed from the notification URI when using an alternate Consumer NF Service Instance and the callback URI prefix of the new Consumer NF Service Instance (if any) shall be added.\nFor indirect communication, if the NF service producer delegates target NF consumer instance reselection to the SCP (when the target NF consumer instance is not reachable), the NF service producer should include the target NF type (i.e. the type of the NF service consumer) in the corresponding \"3gpp-Sbi-Discovery-*\" request header, and may also include other 3gpp-Sbi-Discovery-*\" headers in a notification or callback request, to enable the SCP to reselect a different NF service consumer instance as specified in the preceding bullets, if possible and if the NF service consumer instance indicated in the \"3gpp-Sbi-Target-apiRoot\" header or target URI is not reachable. If the Callback URI included a prefix, the NF service producer should also include the callback URI Prefix in the 3gpp-Sbi-Request-Info header.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.7\tRestoration of Profiles related to UDR",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.7.1\tGeneral",
                            "text_content": "This clause describes an optional procedure that may be supported by UDR, UDR consumers (i.e. UDM, PCF, and NEF), and UDM consumers (e.g. AMF, SMF, SMSF, AUSF, NEF…) to re-synchronize profiles in UDR to those in UDR consumers and UDM consumers. When UDR detects corruption, loss, or inconsistency in temporary data stored in UDR, the UDR indicates it to its consumers. UDR should also send notifications to its consumers upon restart based on the deployment policy. If the UDR consumer is UDM, the UDM indicates it to its consumers. Then, those consumers initiate necessary procedures directly or via UDM towards UDR, so that related profiles are re-synchronized and adverse impacts on operator's service can be minimized.\nNOTE 1:\tNotification can also be sent on other occasions than data corruption based on local policy.\nTemporary data stored in UDR subject to restoration may be identified within the notification sent to UDR consumers and UDM consumers either by:\n-\tReset-ID (plus PLMN ID of the UDR): Reset-IDs of temporary data associated to SUPI ranges or GPSI ranges are assigned by UDR in an implementation specific way; e.g. a Reset-ID may identify a hardware resource and may contain a reset-counter. The Reset-ID is provided to UDR consumers and UDM consumers in the response of a request that has created temporary data (i.e. a resource) in UDR.\n-\tSUPI or GPSI ranges.\n-\tDNNs/S-NSSAIs (plus PLMN ID of the UDR).\n-\tUDR or UDM Group ID (plus PLMN ID of the UDR).\n-\tPLMN ID of the UDR.\nThe identifiers used in notifications are optional to be included when sent by UDR or by UDR consumers, but it is recommended that the notification includes some type of identifier to narrow down as much as possible the set of affected profiles. In particular, the notification to UDM consumers in PLMNs different from the PLMN of the UDM shall contain at least one of the identifiers. For the receivers of the notifications, all identifiers shall be supported.\nIf multiple identifiers are included in the notification, the set of affected profiles shall consider as a logical \"AND\" between all the included identifiers.\nThe notification sent to UDR consumers and UDM consumers also includes the following time values:\n-\tlastReplicationTime: The last time when UDR replicated the temporary data identified to be potentially lost or corrupted, i.e. before the situation causing the potential data inconsistency occurred.\n-\trecoveryTime: The time when UDR started working properly after the situation causing the potential data inconsistency occurred.\nResources related to temporary data stored in UDR are associated in the corresponding user profile stored at UDR consumers or UDM consumers with a timestamp of the time they were created or last modified; i.e. lastSynchronizationTime. Temporary data in UDR created or updated between the lastReplicationTime and the recoveryTime may be inconsistent with profiles in UDR consumers and UDM consumers. In order to avoid inconsistency of time due to different timezones, lastReplicationTime, recoveryTime and lastSynchronizationTime shall be identified using UTC.\nUDR consumers and UDM consumers define callbackUri for data restoration in their NF profile. This is an endpoint to receive notification when potential UDR data inconsistency occurs. In addition, UDR consumers may inform their identity to UDR. Additionally, UDM consumers may inform their dataRestorationCallbackUri to UDM during registration in UDM (e.g. for AMF, SMF, SMSF); if so, such callback URI shall be the same as the URI registered by the UDM consumer in its NF Profile in NRF, and it shall be a same URI for the entire consumer's NF Instance (i.e., the UDM consumer shall not indicate different callback URIs per each UE registration).\nWhen the UDR detects a potential data inconsistency of temporary data, the UDR notifies the UDR consumers of the potential data inconsistency event using the callbackUri of the UDR consumer.\nThe UDM may notify UDM consumers within its PLMN using the callbackUri included in the NF profile of the UDM consumer in NRF. This is, a UDM that receives a notification from UDR can discover the callbackURI of e.g. AMFs, SMFs, SMSFs or AUSFs within its PLMN and forward the notification to all of them. The UDM may also notify UDM consumers using the callbackUri if provided by UDM consumers during its registration in UDM based on local configuration.\nNOTE 2:\tThe option for UDM consumers to provide its dataRestorationCallbackUri during registration in UDM, and such UDM using these callbackUris to send subsequent notifications, is particularly beneficial to support roaming users connecting via UDM consumers in PLMNs different from the PLMN of the UDM (e.g. AMF, SMSF, and SMF in Local Break Out scenarios), since it avoids the task for UDM to perform an inter-PLMN service discovery.\nThe notification to UDR consumers and UDM consumers includes optionally the identifier of the temporary data subject to restoration (e.g. Reset-IDs), the lastReplicationTime and the recoveryTime. The UDR consumer or UDM consumer may then initiate the restoration of the temporary data identified to be potentially lost or corrupted when the last synchronization time recorded at consumer falls between the lastReplicationTime and the recoveryTime as provided by the producer, i.e. UDR or UDM.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.7.2\tProcedure",
                            "text_content": "Figure 6.7.2-1 describes the procedure for restoration of profiles related to UDR.\n\nThe figure depicts a restoration process for UDR profiles, which are used to restore the quality of voice and data services in a telecommunications network. The restoration process involves the use of advanced algorithms and techniques to recover the lost data and improve the overall performance of the network.\nFigure 6.7.2-1: Restoration of Profiles related to UDR\n0.\tUDR consumers and UDM consumers define callbackUri for data restoration in the NF profile registered in NRF.\n1.\tUDR consumers store temporary data in UDR. The UDR consumers may set its identity in the request to UDR, when accessing it for the first time. The UDR stores the received identity and creates for the UDR consumer a subscription on notification for the potential UDR data inconsistency. The UDR may provide to the UDR consumer the Reset-ID if assigned by the UDR for the temporary data stored in UDR.\nThe UDM stores temporary data in UDR as requested by its consumers. UDM consumers may set dataRestorationCallbackUri in the request of their registration to UDM. In this case, the UDM stores the dataRestorationCallbackUri locally and creates for the UDM consumer a subscription on notification for the potential UDR data inconsistency. If received from UDR, the UDM also provides the Reset-ID assigned by the UDR to UDM consumers.\nWhen an NF other than UDM creates or updates a resource directly or via UDM in UDR, the NF sets or stores lastSynchronizationTime in a relevant profile. If the NF receives a Reset-ID directly or via UDM from UDR, the NF stores it in the profile.\n2.\tUDR detects corruption, loss, or inconsistency in temporary data caused due to certain scenarios (e.g. failure and restart of the UDR, or migration of the data from an old UDR to a new UDR).\nNOTE 1:\tThe UDR can recover consistency by different means, e.g. by reloading data from its back-up.\n3.\tUDR queries NRF based on the identity stored in step 1 and discovers callbackUri for data restoration in UDR consumers' NF profiles. If no UDR consumer impacted by the restoration event provided its identity in step 1, the UDR discovers via NRF the callbackUri of one suitable UDR consumer instance to send the notification to. The UDR sends Nudr_DR_Notification request to the callbackUri to notify potential UDR data inconsistency. The Nudr_DR_Notification request may contain temporary data identifier(s) (e.g. Reset-IDs) and an impacted period (i.e. lastReplicationTime and recoveryTime).\n4.\tIf UDR consumer is UDM, the UDM forwards the notification to UDM consumers. The UDM finds callbackUri for data restoration for UDM consumers within its PLMN in UDM consumers' NF profiles through querying NRF. Optionally, the UDM may find callbackUri for data restoration for UDM consumers (especially UDM consumers outside its PLMN) if provided by the UDM consumer during UDM consumer registration in UDM and locally stored in UDM in step1.\n5.\tWhen a UDR consumer other than UDM (e.g. PCF, NEF) or a UDM consumer (e.g. AMF, SMF, SMSF) finds that a stored profile is affected by the potential loss or corruption of data, and that the last synchronization time of the profile falls into the impacted period in the notification, then the NF judges that the profile requires re-synchronization.\nUDR consumers other than UDM (e.g. PCF, NEF) initiates the re-synchronization of the impacted resources using Nudr_DataRepository service operations.\nUDM consumers initiate the re-synchronization for each impacted UE using different service operations depending on the UDM consumer type. UDM consumers shall include a flag (\"udrRestartInd\") indicating that the request is due to a re-synchronization event.\n-\tUDM consumers that register in UDM start re-synchronization by sending Nudm_UECM_Registration request for each impacted UE.\nIn order to prevent storing obsolete registration information for a given user coming from UDM consumers that trigger resynchronization for the same user, UDM consumers may include the stored last synchronization time within the re-synchronization request. The lastSynchronizationTime provided by the UDM consumer may be used in UDM to compare it with current data stored in UDR and ensure that the registration from the most recent UDM consumer is kept (see step 7). However, if the UDM consumer ensures that its resynchronization is the most recent, accurate and correct (e.g. if the AMF triggers resynchronization upon detection of UE activity), the UDM consumer shall not include the lastSynchronizationTime within the resynchronization request and the UDM stores the UDM consumer registration in the UDR without further processing.\n-\tUDM consumers that subscribe to notification of subscription data changes in UDM start re-synchronization of these subscriptions in UDM by sending Nudm_SDM_Subscribe request for each impacted UE and subscription.\n-\tAUSF starts re-synchronization by sending Nudm_UEAuthentication_ResultConfirmation request containing the stored last synchronization timestamp of the authentication for each impacted UE.\n-\tNEF starts re-synchronization of the subscription to exposure events in UDM by sending Nudm_EE_ModifySubscription request for each impacted UE and subscribed event.\n6.\tThe UDR consumers and UDM consumers locally adjusts invocation timing of each of those procedures, in order not to cause congestion in the system. The NF invokes necessary procedures.\nUDM consumers select a UDM instance to send the re-synchronization signalling as defined in 3GPP TS 23.501 [9]. This is, the UDM consumer may not send the re-synchronization signalling to the UDM instance from which the UDM consumer received the notification.\n7.\tIf UDM receives Nudm_UECM_Registration request containing the \"udrRestartInd\" flag, the UDM overwrites the related profile in the UDR, or creates it if not available. If the registration request includes a lastSynchronizationTime, the related profile in UDR is overwritten only if the lastSynchronization time received from the UDM consumer is not older than the registration time stored in UDR before resynchronization. In this case, if the UDM replaces or creates the related profile in UDR, the UDM sets the registration time to the current time.\nIf UDM receives Nudm_SDM_Subscribe request containing the \"udrRestartInd\" flag the UDM sends a corresponding request to UDR, the UDR overwrites the related profile in the UDR or creates it if not available in UDR.\nIf UDM receives Nudm_UEAuthentication_ResultConfirmation request containing the \"udrRestartInd\" flag, the UDM sends a corresponding request to UDR, the UDR overwrites the related profile in the UDR or creates it if not available in UDR.\nIf UDM receives Nudm_EE_ModifySubscription request containing the \"udrRestartInd\" flag, the UDM sends a corresponding request to UDR, the UDR overwrites the related profile in the UDR or creates it if not available in UDR.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.8\tRestoration Procedures for Home Routed PDU Sessions or PDU sessions with an I-SMF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.8.1\tGeneral",
                            "text_content": "This clause specifies requirements in the AMF, the V/I-SMF and the (H-)SMF to restore Home Routed PDU Sessions or PDU sessions with an I-SMF.\nDuring a PDU session establishment and update procedure, the V/I-SMF or the (H-)SMF shall:\n-\tset the \"Peer NF SET based Reselection\"(PSETR) feature bit in the SupportedFeatures attribute if it supports the (re)selection of an alternative peer SMF using the binding indication of the resource/session contexts or based on the NF profile of the peer SMF;\n-\tset the \"Deployed Local SMF Set\" (DLSET) feature bit in the SupportedFeatures attribute if the PDU session resource is not bound exclusively to the specific V/I-SMF or (H-)SMF NF service instance, i.e. if there is at least one alternative SMF service instance (in the same or a different SMF instance) that can take it over if the current serving SMF service instance becomes no longer operational (e.g. fails).\nNOTE 1:\tA SMF can set the DLSET flag to \"1\" if it indicates in its NF Profile that it supports the capability to persist its resources in shared storage inside the NF Instance, i.e. if another SMF service instance with the SMF instance can take over the resource context even when NF (service) set is not deployed locally.\nIn the service request or response message towards the (new) AMF, the V/I-SMF shall set the \"DLSET\" feature bit if the PDU session resource can be taken over by an alternative V-SMF Service Instance. The V/I-SMF shall set the \"anchorSmfPsetrSupportInd\" attribute to \"true\" in the Update SM Context Response message towards the new AMF if the (H-)SMF supports the \"PSETR\" feature.\nNOTE 2:\tThe AMF needs to know if the V/I-SMF supports the DLSET feature and if the (H-)SMF supports the PSETR to take proper restoration actions when there is a V/I-SMF failure. See clause 6.8.2. The AMF can alternatively learn whether the (H-)SMF supports the PSETR feature when doing the SMF discovery/selection during the PDU Session Establishment procedure.\nNOTE 3:\tThe V/I-SMF indicates more generally all the features it supports to the AMF in the service request/response, including also setting the \"PSETR\" feature bit if it is able to reselect an alternative (H-)SMF when it detects the peer (H-)SMF has failed, but the AMF is not required to use this indication.\nThe requirements specified in subsequent clauses shall also be applied for N16a reference point by replacing the V-SMF with I-SMF, and H-SMF with SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.8.2\tV-SMF failure",
                            "text_content": "When the H-SMF detects the failure of the V-SMF, it shall retrieve all PDU sessions associated with the failed V-SMF and perform the following procedure for those PDU sessions:\n-\tif the H-SMF supports the PSETR feature:\n-\tif the V-SMF supports the DLSET feature, the H-SMF shall keep the PDU session and should reselect an alternative V-SMF service instance, e.g. when it needs to send any request message to the V-SMF;\n-\tif the V-SMF doesn't support the DLSET feature, the H-SMF shall delete the affected PDU sessions locally.\n-\tif the H-SMF does not support the PSETR feature:\n-\tthe H-SMF shall delete the affected PDU sessions.\nWhen the AMF detects the failure of the V-SMF, it shall retrieve all PDU sessions associated with the failed V-SMF and perform the following procedure for those PDU sessions:\n-\tif the H-SMF supports the PSETR feature and if the V-SMF supports the DLSET feature, the AMF shall keep the PDU session and should reselect an alternative V-SMF service instance, e.g. when it needs to send any request message to the V-SMF.\n-\tif the H-SMF doesn't support the PSETR feature while the V-SMF supports the DLSET feature, the AMF shall keep the PDU sessions, and may reselect an alternative V-SMF service instance to request the selected alternative V-SMF to delete the PDU session towards the UE and the UPF. The V-SMF may request the UE to reactivate the PDU session.\n-\tfor any other cases, the AMF may release the affected PDU session(s) locally and/or notify the UE about the release of the PDU session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.8.3\tH-SMF failure",
                            "text_content": "When the V-SMF detects the failure of the H-SMF, it shall retrieve all PDU sessions associated with the failed H-SMF and perform the following procedure for those PDU sessions:\n-\tif the V-SMF does not support the PSETR feature, the V-SMF may release the affected PDU sessions towards the AMF and UE, and may request the UE to reactivate the PDU session;\n-\tif the V-SMF supports the PSETR feature:\n-\tif the H-SMF supports the DLSET feature, the V-SMF shall keep the PDU session and may reselect an alternative H-SMF service instance, e.g. when it needs to send any request message to the H-SMF;\n-\tif the H-SMF doesn't support the DLSET feature, the V-SMF may release the PDU session towards the AMF and UE, and the V-SMF may request UE to reactivate the PDU session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tRestoration Procedures related to Public Warning System (PWS)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause specifies the procedures supported in the 5G System to handle failures affecting Public Warning System (PWS).  The stage 2 architecture and procedures for PWS are specified in 3GPP TS 23.041 [8].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2\tPWS operation failure in NG-RAN",
                    "description": "",
                    "summary": "",
                    "text_content": "The NG-RAN shall report that on-going PWS operation for one or more cells of the NG-RAN has failed by sending a PWS Failure Indication as specified in 3GPP TS 23.041 [8].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.3\tPWS operation restart in NG-RAN",
                    "description": "",
                    "summary": "",
                    "text_content": "After a NG-RAN (i.e. gNB or ng-eNB) has restarted, it shall delete all its warning message data. If the warning message service is operational in one or more cell(s) of the NG-RAN, the NG-RAN shall send a PWS Restart Indication message, which shall include the identity of the NG-RAN, the identity of the restarted cell(s), and the TAI(s) and Emergency Area Id(s) with which the restarted cell(s) are configured, to request the CBC to re-load its warning message data if applicable.\nThe NG-RAN should send the PWS Restart Indication message via two AMFs of the AMF Region, if possible, to ensure that the CBC receives the message even if one AMF cannot propagate it to the CBC (e.g. due to a path failure between the AMF and the CBC).\nIf the AMF interfaces with multiple CBCs, the AMF shall forward the PWS Restart Indication to all CBCs.\nUpon receipt of a PWS Restart Indication message, the CBC shall consider that the warning message service is restarted in the reported cell(s), i.e. the service is operational and no warning messages are being broadcast in the cell(s). The CBC shall then re-send the warning message data (with the same message identifier and serial number) to the NG-RAN for these cells, if any. When doing so, the CBC:\n-\tshall provide the identity of the NG-RAN received in the PWS Restart Indication when sending the Write-Replace-Warning-Request message(s) to the AMF, to enable the AMF to forward the message(s) only to the NG-RAN involved in the restart. The identity of the NG-RAN shall be included in:\n-\tthe Write-Replace-Warning-Request message(s) sent to the PWS-IWF over the SBc interface; or\n-\tthe globalRanNodeList IE of the NonUeN2MessageTransfer request message(s) sent to the AMF over the N50 interface (see clauses 5.2.2.4.1.3 and 6.1.6.2.9 of 3GPP TS 29.518 [6]) to request the transfer of the Write-Replace-Warning-Request message(s).\n-\tshould set the warning area list to the identities of the cell(s) to be reloaded which are relevant to the warning message data being reloaded; and\n-\tmay update the number of broadcasts requested, if necessary.\nThe CBC shall consider a PWS Restart Indication message received shortly after a preceding one for the same cell identity as a duplicate restart indication for that cell which it shall ignore.\nNOTE:\tThe broadcast of warning messages can be configured in the network per individual cell, TAI and/or Emergency Area Id. The CBC can use the list of cell(s), the TAI(s) and Emergency Area Id(s) received in the PWS Restart Indication to derive the list of warning messages to be broadcast in the respective cell(s), TAI(s) and Emergency Area Id(s).\nLikewise, in other scenarios where the NG-RAN may need to reload its warning message data (e.g. when an individual cell is restarted), the NG-RAN shall send a PWS Restart Indication message (including the identity of the NG-RAN, the identity of the restarted cell(s), and the TAI(s) and Emergency Area Id(s) with which the restarted cell(s) are configured) to the CBC to request the CBC to re-load its warning message data if applicable. The NG-RAN, AMF and CBC shall then proceed as specified above for a NG-RAN restart.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "8\tRestoration Procedures for MBS",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause specifies the procedures supported in the 5G System to detect and handle failures affecting any network entity involved in the delivery of broadcast and/or multicast service.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.1A\tN4mb Failure and Restart Detection",
                    "description": "",
                    "summary": "",
                    "text_content": "Across PFCP based interfaces, an MB-SMF and MB-UPF shall utilize the PFCP Heartbeat Request and Heartbeat Response messages to detect a peer PFCP entity failure or restart as described in clause 19A of 3GPP TS 23.007 [2].\nA PFCP function shall ignore the Recovery Timestamp received in PFCP Association Setup Request and PFCP Association Setup Response messages (see clause 6.2.6 of 3GPP TS 29.244 [4]).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.2\tRestoration procedures for MB-UPF failure with or without restart",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.2.1\tGeneral",
                            "text_content": "When an MB-UPF fails, all its PFCP session contexts of the MBS sessions and all its PFCP associations affected by the failure may be lost.\nThe MB-SMF and MB-UPF may support the procedures specified in this clause to restore the multicast and broadcast MBS sessions affected by the failure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.2\tRestoration Procedure for MB-UPF Restart",
                            "text_content": "The MB-UPF should ensure that:\n-\twhen multicast transport is used on N3mb and/or N19mb, any N3mb and/or N19mb Low Layer Source Specific Multicast (LL SSM) addresses used by the MB-UPF before the MB-UPF restart are not immediately reused after the MB-UPF restart; and\n-\twhen unicast transport is used on N6mb and/or Nmb9, any N6mb and/or Nmb9 ingress tunnel addresses used by the MB-UPF before the MB-UPF restart are not immediately reused after the MB-UPF restart.\nNOTE 1:\tThis avoids inconsistent addresses allocation throughout the network and enable the restoration of PFCP sessions of MBS sessions affected by the failure. How this is ensured is implementation specific.\nDuring or immediately after an MB-UPF Restart, the MB-UPF shall place a local UPF Recovery Time Stamp value in all Heartbeat Request/Response messages.\nImmediately after the re-establishment of a PFCP association between the MB-SMF and the MB-UPF, the MB-SMF may start restoring the PFCP sessions of the affected MBS sessions in the MB-UPF, by following PFCP requirements for establishing a PFCP session over N4mb as specified in clause 5.34.2 of 3GPP TS 29.244 [4], with the following modifications:\n-\tthe MB-SMF shall include the MBS Restoration Indication in the PFCP Session Establishment Request message to indicate to the MB-UPF that this is a request to restore the PFCP session of an existing MBS session;\n-\tIf multicast transport is used on N3mb and/or N19mb, the MB-SMF shall additionally provide, in the Multicast Transport Information for N3mb and/or N19mb IE in the PFCP Session Establishment Request, the N3mb and/or N19mb LL SSM address and GTP-U Common TEID (C-TEID) that was previously used for the MBS session, and the MB-UPF shall allocate the same N3mb and/or N19mb LL SSM address and C-TEID to the PFCP session if possible. The MB-SMF shall not set the PLLSSM flag in the MBSN4mbReq-Flags IE in the PFCP Session Establishment Request.\n-\tIf unicast transport is used on N6mb and/or Nmb9, the MB-SMF shall additionally provide, in the \"Local Ingress Tunnel\" IE in the Create PDR IE or Create Tunnel Endpoint IE (for the downlink PDRs) in the PFCP Session Establishment Request, the N6mb and/or Nmb9 ingress tunnel address that was previously used for the MBS session, and the MB-UPF shall allocate the same N6mb and/or Nmb9 ingress tunnel address if possible. The MB-SMF shall not set the CHOOSE bit to \"1\" in the \"Local Ingress Tunnel\" IE\".\nIf multicast transport is used on N3mb and/or N19mb and the MB-UPF cannot accept the requested N3mb and/or N19mb LL SSM address, or if unicast transport is used on N6mb and/or Nmb9 and the UPF cannot accept the requested N6mb and/or Nmb9 ingress tunnel address, because the requested address is not available at the MB-UPF,  the MB-UPF shall reject the PFCP Session Establishment Request with the cause \"PFCP session restoration failure due to requested resource not available\". The MB-SMF may then proceed as specified for the restoration procedure for MB-UPF failure without restart, but possibly using the same or a different MB-UPF.\nNOTE 2:\tThe cause \"PFCP session restoration failure due to requested resource not available\" corresponds to scenarios where the requested address is no longer available at the MB-UPF, i.e. it cannot be assigned to any PFCP session, due to e.g. the address having been decommissioned by OAM from the MB-UPF or e.g. the address being no longer operational due to a partial hardware failure at the MB-UPF. This cause is not to be used for scenarios where the requested address would be available at the MB-UPF but would have been re-assigned to a different PFCP session, which is a scenario that is not expected to happen based on the requirements specified above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.3\tRestoration Procedure for MB-UPF failure without Restart",
                            "text_content": "Upon detecting that an MB-UPF fails without restart, the MB-SMF may restore the MBS sessions that were served by the failed MB-UPF by selecting an alternative MB-UPF and by restoring the PFCP sessions of the MBS sessions in the alternative MB-UPF, following PFCP requirements for establishing an N4mb PFCP session as specified in clause 5.34.2 of 3GPP TS 29.244 [4] with the following additions:\n-\tthe MB-SMF shall request the alternative MB-UPF to join the multicast tree towards the Source Specific Multicast (SSM) address information earlier provided by AF/AS or MBSTF, if multicast transport is used over N6mb and/or Nmb9;\n-\tthe MB-SMF shall request the alternative MB-UPF to allocate a new N6mb and/or Nmb9 ingress tunnel address, if unicast transport is used over N6mb and/or Nmb9;\n-\tthe MB-SMF shall request the alternative MB-UPF to allocate a new N3mb and/or N19mb LL SSM address and C-TEID, if multicast transport is used over N3mb and/or N19mb; and\n-\tfor each N3mb and/or N19mb endpoint expected to receice the MSB session data, the MB-SMF shall request the alternative MB-UPF to send data towards the N3mb and/or N19mb endpoint's DL F-TEID, if unicast transport is used over N3mb and/or N19mb.\nFor each MBS session, during the PFCP session establishment, the alternative MB-UPF will assign:\n-\ta new N3mb and/or N19mb LL SSM address and C-TEID, if multicast transport is used on N3mb and/or N19mb; and/or\n-\ta new N6mb and/or Nmb9 ingress tunnel address, if unicast transport is used on N6mb and/or Nmb9.\nThen, for each MBS session:\n-\tif multicast transport is used on N3mb:\n-\tthe MB-SMF shall update the AMFs handling the multicast or broadcast MBS session, or location dependent component of the MBS session, about the new N3mb LL SSM address and C-TEID by sending:\n-\tan Namf_MBSCommunication_N2MessageTransfer request (Multicast Session Update Request including the new MB-UPF LL SSM address and C-TEID) for a multicast MBS session; and/or\n-\tan Namf_MBSBroadcast ContextUpdate Request (Broadcast Session Modification Request including the new MB-UPF LL SSM address and C-TEID) for a broadcast MBS session.\n-\tthe AMFs shall forward the above information towards the NG-RAN nodes handling the MBS session (using the Multicast Session Update and Broadcast Session Modification procedures respectively);\n-\tthe NG-RAN nodes shall join delivery from the new multicast transport address to receive MBS session data from the new MB-UPF and leave delivery from the previous multicast address in use for the MBS session.\n-\tif multicast transport is used on N19mb, for a multicast MBS session:\n-\tthe MB-SMF shall update the SMF handling the multicast MBS session, or location dependent component of the MBS session, about the new N19mb LL SSM address and C-TEID by sending an Nmbsmf_MBSSession_ContextStatusNotify request including an \" MULT_TRANS_ADD_CHANGE\" event and the new N19mb LL SSM address and C-TEID used for the MBS data delivery over N19mb;\n-\tthe SMF shall update the UPF terminating the N19mb tunnel about the new LL SSM address and C-TEID;\n-\tthe UPF shall join delivery from the new multicast transport address to receive MBS session data from the new MB-UPF and leave delivery from the previous multicast address in use for the MBS session.\n-\tif unicast transport is used on N6mb and/or Nmb9:\n-\tthe MB-SMF shall update the AF/NEF/MBSF about the new N6mb/Nmb9 ingress tunnel address to use for sending MBS data for a given MBS session, or location dependent component of the MBS session, by sending an Nmbsmf_MBSSession_StatusNotify request including an \"Ingress Tunnel Address Change\" event and the new N6mb/Nmb9 ingress tunnel address;\n-\tthe AF/MBSF shall start sending MBS data to the new N6mb/Nmb9 ingress tunnel address.\nFigures 8.2.3-1 and 8.2.3-2 depict the call flows for the case of a broadcast MBS session and a multicast MBS session respectively.\nThe figure depicts a scenario where a Broadcast MBS session is restored upon MB-UPF failure without the need for a restart. The MB-UPF failure is indicated by the red line, and the restoration process is shown through the restoration of the session. The figure illustrates the use of a MBS session, which is a crucial component in a broadcast network, to ensure the continuity of communication.\nFigure 8.2.3-1: Broadcast MBS session restoration upon MB-UPF failure without restart\nThe figure depicts a scenario where a Multicast MBS session is restored upon MB-UPF failure without the need for a restart. The MB-UPF failure is indicated by the red line, and the restoration process is shown through the restoration of the session. The figure illustrates the use of multicast routing and the restoration of the session, which is crucial for maintaining network reliability and efficiency.\nFigure 8.2.3-2: Multicast MBS session restoration upon MB-UPF failure without restart\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "8.3\tRestoration procedures for NG-RAN failure with or without restart",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.3.1\tGeneral",
                            "text_content": "When an NG-RAN fails with or without restart, all its MBS session contexts may be lost, causing the interruption in the delivery of MBS data over the radio interface.\nRestoration procedures for NG-RAN failure with or without restart are optional to support.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.2\tBroadcast MBS session restoration Procedure for NG-RAN failure with restart",
                            "text_content": "MBS sessions affected by an NG-RAN failure with restart may be restored by the AMF as specified in clause 8.3.2.2 or by the MB-SMF as specified in clause 8.3.2.3.\nThe procedure specified in this clause may be supported to restore a broadcast MBS session affected by an NG-RAN restart.\nThe AMF handling a broadcast MBS session is responsible for restoring the MBS session in a restarted NG-RAN, as shown in Figure 8.3.2.2-1.\nNOTE 1:\tAn NG-RAN restart is transparent to the MB-SMF (i.e. the restoration procedure does not cause any signaling to the MB-SMF) when multicast transport is used over N3mb.\nNOTE 2:\tThis procedure can also be used in other scenarios where an existing MBS session needs to be started in a new NG-RAN, e.g. an NG-RAN that is reconfigured by OAM to support a new TA that is part of the MBS service area of an existing MBS session.\n\nThe figure depicts a broadcast MBS session restoration process in an NG-RAN network. Upon NG-RAN restart, the AMF (Access Multiplexer) is activated to restore the broadcast MBS session. This process involves the use of a set of protocols and algorithms to ensure the restoration of the broadcast MBS session, which is critical for maintaining network functionality and user experience.\nFigure 8.3.2.2-1: Broadcast MBS session restoration by AMF upon NG-RAN restart\n1.\tThe AMF stores the last N2 MBS SM container (i.e. MBS Session Setup or Modification Request Transfer IE defined in 3GPP TS 38.413 [11]) received from the MB-SMF during the establishment of the broadcast MBS session or during a broadcast MBS session update. When unicast transport is used over N3mb, the MB-SMF stores the RAN-ID together with the DL F-TEID received from each NG-RAN.\nNOTE 3:\tThe N2 MBS SM container contains all the information to establish the broadcast MBS session (e.g. transport layer address if multicast transport is used over N3mb, QoS flows).\n2.\tThe NG-RAN restarts, causing the broadcast MBS service interruption.\n3.\tThe AMF detects that the NG-RAN has restarted (e.g. upon receiving NG Setup Request message) and that it serves at least one TAI or one cell being part of the MBS service area of an existing MBS session (or one of the MBS services areas of the MBS session in case of location dependent content).\n4.\tThe AMF re-establishes the broadcast MBS session in the restarted NG-RAN, by sending an NGAP Broadcast Session Setup Request including the last N2 (NGAP) MBS Session Setup or Modification Request Transfer IE that was stored.\nThe NG-RAN establishes the broadcast MBS session and returns a response to the AMF. If unicast transport is used over N3mb, the NG-RAN response includes the DL F-TEID assigned by the NG-RAN to receive the MBS data from the MB-UPF within the N2 (NGAP) MBS Session Setup or Modification Response Transfer IE of the NGAP Broadcast Session Setup Response message. In deployments where multiple NG-RAN nodes share a common user plane entity and unicast transport is used over N3mb, the NG-RAN response may include an existing DL F-TEID signalled by other NG-RAN nodes during shared delivery setup.\nThe NG-RAN joins the delivery of the broadcast MBS session if multicast transport is used over N3mb.\n5.\tIf an N2 MBS SM Container (i.e. N2 (NGAP) MBS Session Setup or Modification Response Transfer IE) was received from the NG-RAN in step 4, the AMF sends an Namf_MBSBroadcast_ContextStatusNotify Request to the MB-SMF including the N2 MBS SM Container and the RAN-ID of the NG-RAN .\n6.\tThe MB-SMF modifies the PFCP session of the MBS session in the MB-UPF to start distributing MBS data towards the DL GTP-U F-TEID received from the NG-RAN, and to stop doing so towards the earlier DL GTP-U F-TEID that was used by the same NG-RAN before the NG-RAN restart.\nThis step shall be skipped in deployments where multiple NG-RAN nodes share a common user plane entity, unicast transport is used over N3mb, and the MB-SMF that supports handling shared NG-U terminations determines that the DL F-TEID signalled by restarted NG-RAN node is already associated with other NG-RAN nodes.\nThe procedure specified in this clause may be supported to restore a Broadcast MBS session affected by an NG-RAN restart.\nWhen the AMF detects an NG-RAN restart, or a (new) NG-RAN is deployed to serve a TAI that is part of the MBS session service area, e.g. using NG Setup Request message, as specified in 3GPP TS 38.413 [11], it shall report such event to the MB-SMF for each of MBS session(s) affected by this event, to enable the MB-SMF to (re)start the MBS session(s) in the concerning NG-RAN as further described in the Figure 8.3.2.3-1.\nThe MB-SMF shall run the following restoration procedure for each of Broadcast MBS sessions which were established in the restarted NG-RAN or a (new) NG-RAN.\nThe figure depicts a broadcast MBS session restoration scenario in an NG-RAN network, where MB-SMF (MBS Session Management Function) is used to restore the session upon NG-RAN failure. The restoration process involves the MB-SMF initiating a restart of the MBS session, which is then propagated to the MBS and the MBS-RAN. The figure illustrates the MB-SMF's role in ensuring the reliability of the network by providing a fallback mechanism in case of network failure.\nFigure 8.3.2.3-1: Broadcast MBS session restoration by MB-SMF upon NG-RAN failure with restart\n1.\tThe NG-RAN has failed with restart.\n2.\tThe AMF detects the NG-RAN has failed with restart, e.g., upon receiving NG Setup Request message.\n3.\tThe AMF sends Namf_MBSBroadcast_ContextStatusNotify Request message to the MB-SMF for each affected MBS session including the MBS Session ID, the NG-RAN ID and an indication of the event, either NG-RAN restart, or NG-RAN failure without restart, or a (new) NG-RAN getting into service to serve a TAI that is part of the MBS session service area.\n3a.\tThe MB-SMF receives a PFCP Node Report Request message from the MB-UPF to report NG-RAN has failed with restart or a PFCP Session Report Request message from the MB-UPF to report receiving GTP-U Error Indication for each affected MBS session when unicast transport was used for N3mb interface.\n4.\tThe MB-SMF returns a \"204 No Content\" response.\n5.\tThe MB-SMF modifies the PFCP sessions corresponding to the affected MBS sessions to remove the NG-RAN DL F-TEID for unicast transport over N3mb.\n6.\tThe MB-SMF sends Namf_MBSBroadcast_ContextUpdate Request message to the AMF to (re)start the MBS session in the related NG-RAN including the MBS Session Setup or Modification Request Transfer IE and the NG-RAN ID received in the step 3.\nIf the notification is triggered due to receiving the PFCP Node Report Request message or the PFCP Session Report Request message from the MB-UPF as specified in step 3a, and the MB-SMF that supports handling shared NG-U terminations determines that multiple NG-RAN nodes share the restarted user plane entity, the Namf_MBSBroadcast_ContextUpdate Request message may include multiple corresponding NG-RAN IDs.\n7.\tThe AMF sends the N2 MBS Session Setup Request message to the NG-RAN node(s) including the MBS Session  Setup or Modification Request Transfer IE.\n8.\tThe MBS session is created/restored in the NG-RAN node(s).\n9.\tThe NG-RAN node(s) joins the delivery of the broadcast MBS session if multicast transport is used over N3mb.\n10.\tThe NG-RAN node(s) responds with the N2 MBS Session Setup Response message including a MBS Session Setup or Modification Transfer IE if a Shared NG-U Unicast TNL Information needs to be allocated for unicast transport over N3mb interface.\n11.\tThe AMF responds with Namf_MBSBroadcast_ContextUpdate Response message with a MBS Session Setup or Modification Response Transfer IE if received.\n12.\tThe MB-SMF modifies the PFCP sessions corresponding to the MBS sessions to provision the new NG-RAN DL F-TEID if received in step 10.\nWhen the AMF selected by the MB-SMF to start a Broadcast MBS Session fails without restart, to support the restoration procedure to restore an Broadcast MBS Session in a restarted NG-RAN as specified in 8.3.2.2 and 8.3.2.3, another AMF in the same AMF set needs to be selected to become the serving AMF for this broadcast MBS session and to be responsible for restoration. This may be done by one of the following solutions:\n-\tanother AMF is selected in the same AMF set by an AMF implementation specific mechanism, and this AMF sends a Namf_MBSBroadcast_ContextStatusNotify Request message to the MB-SMF to notify this optionally containing an updated binding indication; or\n-\twhen the MB-SMF detects that the AMF which was handling the Broadcast MBS session has failed without restart and no Namf_MBSBroadcast_ContextStatusNotify Request is received from any AMF of the AMF set as described in the first bullet, the MB-SMF may reselect an alternative AMF by sending a Namf_MBSBroadcast_ContextUpdate Request message with an indication that the alternative AMF needs not trigger any NGAP message to deliver the N2 container - MBS Session Setup or Modification Request Transfer, but just to store it for future potential NG-RAN restoration.\nThe figure depicts a schematic of an AMF (Analog-to-Digital Converter) selection process, illustrating the steps to choose an alternative AMF in the event of an AMF failure. The figure includes a legend to help users understand the different options available, such as \"AMF 1\" and \"AMF 2,\" and the corresponding steps to follow. The figure also includes a visual representation of the AMF selection process, with arrows indicating the flow of data from the analog input to the digital output. This figure is crucial for understanding the process of AMF selection in a telecommunication system, ensuring that the correct AMF is used to maintain the integrity of the signal.\nFigure 8.3.2.4-1 Selecting an alternative AMF at AMF failure.\n1.\tA Broadcast MBS Session has been established in the network.\n2.\tThe AMF1 has failed without restart.\n3.\tAlternative A: another AMF2 in the same AMF set is selected by an AMF implementation specific mechanism.\n4.\tThe AMF2 sends Namf_MBSBroadcast_ContextStatusNotify to the MB-SMF that the AMF2 becomes the AMF controlling the Broadcast MBS Session context.\n5.\tThe MB-SMF acknowledges the notification and will send subsequent signalling message for this Broadcast MBS Session via the AMF2.\n6.\tAlternative B: the MB-SMF detects that the AMF1 has failed without restart either via HTTP/2 PING Frame for directly connected, or via notifications from the NRF for the NF Status Change when it has subscribed such event, and that no Namf_MBSBroadcast_ContextStatusNotify Request is received from any AMF of the AMF set as described in Alternative A.\n7.\tThe MB-SMF selects an alternative AMF pertaining to the same AMF set using the Binding Indication provided by the old AMF or using the NF profile of the old AMF.\n8.\tThe MB-SMF sends a Namf_MBSBroadcast_ContextUpdate Request including a MBS Session ID, the corresponding MBS Service Area, a MBS Session Setup or Modification Request Transfer, and sets the \"noNgapSignallingInd\" to \"true\" to request the AMF2 to be the AMF for the Broadcast MBS Session to handle subsequent MBS session signaling and be responsible for triggering restoration procedures for NG-RAN failure with or without restart. The AMF may consider to not trigger any NGAP signalling towards NG-RANs covering the MBS service area.\nNOTE 1:\tUpon receiving any subsequent NGAP Broadcast MBS Session signalling from an alternative AMF, the NG-RAN will send any later NG-RAN initiated MBS session signalling towards this alternative AMF.\nNOTE 2:\tIf the AMF does not trigger any NGAP signaling towards NG-RANs covering the MBS service area, before receiving any subsequent NGAP Broadcast MBS Session signalling from an alternative AMF, a NG-RAN can initiate a NGAP Broadcast MBS Session signaling procedure (e.g. Broadcast MBS Session Release Required) to a third AMF, e.g. AMF3, in which case the NG-RAN expects a response from AMF3. However, this does not affect that the AMF2 is the AMF responsible for the Broadcast MBS Session, e.g. to handle subsequent Namf_MBSBroadcast_ContextUpdate request messages or to restore the Broadcast MBS session at a NG-RAN restart. How the NGAP initiated Broadcast MBS Session signaling is handled between AMF3 and AMF2 is implementation specific (e.g. to update the broadcast MBS session context that the MBS session has been stopped in the NG-RAN).\n9.\tThe AMF responds the Namf_MBSBroadcast_ContextUpdate Request message.\n10.\tThe AMF2 continues with the procedures as specified in clauses 8.3.2.2 and 8.3.2.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.3\tBroadcast MBS session restoration Procedure for NG-RAN failure without restart",
                            "text_content": "The procedure specified in this clause may be supported to restore a Broadcast MBS session affected by an NG-RAN failure without restart.\nWhen the AMF detects NG-RAN failure without restart, e.g. using SCTP path failure detection mechanism, it shall report such event to the MB-SMF for each of MBS session(s) affected by this failure, to enable the MB-SMF to remove the DL F-TEID allocated by the failed NG-RAN in the MB-UPF when unicast transport is used over N3mb interface.\nThe figure depicts a scenario where a Broadcast MBS session is restored by MB-SMF (Mobile Base Station-Small Cell) upon the failure of an NG-RAN (Next-Generation Radio Access Network) node. The MB-SMF is responsible for managing the session, ensuring that the MBS can continue to function even if the NG-RAN node fails. The figure illustrates the MB-SMF's role in maintaining the session, with the MB-SMF initiating a new session and the MBS accepting it. The figure also shows the MB-SMF's ability to restore the session without the need for a restart, demonstrating its resilience and efficiency in managing network sessions.\nFigure 8.3.3-1: Broadcast MBS session restoration by MB-SMF upon NG-RAN failure without restart\n0.\tA Broadcast MBS session is created in a NG-RAN, the NG-RAN ID is inserted by the AMF in the N2MbsSmInfo attribute included in the Namf_MBSBroadcast_ContextCreate Response message to the MB-SMF and the MB-SMF stores the NG-RAN ID together with the DL F-TEID allocated by the NG-RAN when unicast transport is used over N3mb interface.\n1.\tThe NG-RAN has failed without restart.\n2.\tThe AMF detects the NG-RAN has failed without restart e.g. using SCTP path failure detection mechanism.\n3.\tThe AMF sends Namf_MBSBroadcast_ContextStatusNotify Request message to the MB-SMF for each affected MBS session including the MBS Session ID, the NG-RAN ID and an indication of the NG-RAN failure without restart event.\n3a.\tThe MB-SMF receives a PFCP Node Report Request message from the MB-UPF to report NG-RAN has failed without restart for each affected MBS session when unicast transport was used for N3mb interface.\n4.\tThe MB-SMF returns a \"204 No Content\" response.\n5.\tThe MB-SMF modifies the PFCP sessions corresponding to the affected MBS sessions to remove the NG-RAN DL F-TEID in case NG-RAN failure without restart for unicast transport over N3mb.\nThe MB-SMF executes step 5 upon receiving either the notification from the AMF or from the MB-UPF.\nIf the restoration procedure is triggered due to notification from AMF as specified in step 3, this step may be skipped in deployments where multiple NG-RAN nodes share a common user plane entity, unicast transport is used over N3mb, and the MB-SMF that supports handling shared NG-U terminations determines that the DL F-TEID is associated with other NG-RAN nodes too.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.4\tMulticast MBS session restoration Procedure for NG-RAN failure with or without restart",
                            "text_content": "The procedure specified in this clause may be supported to restore a Multicast MBS session affected by an NG-RAN failure with or without restart.\nWhen a UPF detects the NG-RAN failure with or without restart using Echo Request and Echo Response message which is sent towards the IP address in the DL F-TEID allocated by the failed NG-RAN, or upon receiving GTP-U Error Indication, it shall report such event to the SMF to enable the SMF to derive UEs who have joined the MBS sessions which are affected by the NG-RAN failure and initiates the restoration procedure for each of Multicast MBS session which were activated in the failed NG-RAN as described in Figure 8.3.4-1.\nWhen unicast transport is used over N3mb interface for 5GC Shared MBS traffic delivery, the MB-UPF detects the NG-RAN failure with or without restart using Echo Request and Echo Response message which is sent towards the IP address in the DL F-TEID allocated by the failed NG-RAN, or upon receiving GTP-U Error Indication, it shall report such event to the MB-SMF, so that the MB-SMF removes the DL-TEID allocated by the failed NG-RAN.\nThe figure depicts a scenario where a Multicast MBS session is restored upon NG-RAN failure, with or without restart. It illustrates the restoration process, including the restoration of the multicast session, the restoration of the multicast MBS, and the restoration of the multicast MBS session. The figure also shows the restoration of the multicast MBS session with and without the restart of the NG-RAN.\nFigure 8.3.4-1: Multicast MBS session restoration upon NG-RAN failure with or without restart\n1.\tThe NG-RAN has failed with or without restart.\n2.\tThe UPF receive GTP-U Error Indication when the NG-RAN recovers from its restart for 5GC Individual MBS traffic delivery.\n2a. The MB-UPF receives GTP-U Error Indication when the NG-RAN recovers from its restart for unicast transport over N3mb for 5GC Shared MBS traffic delivery.\n3.\tThe UPF sends Echo Request message towards the NG-RAN using the IP address included in the DL F-TEID, thus the UPF detects the NG-RAN has failed with or without restart.\n3a.  The MB-UPF sends Echo Request message towards the NG-RAN using the IP address included in the DL F-TEID for unicast transport over N3mb, thus the MB-UPF detects the NG-RAN has failed with or without restart.\n4.\tThe UPF sends PFCP Session Report Request messages to the SMF to report receiving of GTP-U Error Indication message, or sends a PFCP Node Report Request message to the SMF to report the GTP-U path failure towards the NG-RAN or the remote GTP-U entity has restarted.\n5.\tThe SMF sends PFCP Session Modification Request message to request the UPF to remove DL-FTEID allocated by the failed NG-RAN and buffer the MBS session data for 5GC Individual MBS traffic delivery, except for an NG-RAN restart if the UPF has already removed the DL F-TEID on its own as specified in clause 5.5.\n6.\tThe MB-UPF sends PFCP Session Report Request messages to the MB-SMF to report receiving of GTP-U Error Indication message, or sends a PFCP Node Report Request message to the MB-SMF to report the GTP-U path failure towards the NG-RAN or the remote GTP-U entity has restarted, for unicast transport for N3mb.\n7.\tThe MB-SMF sends PFCP Session Modification Request message to request the MB-UPF to remove DL-FTEID allocated by the failed NG-RAN, except for an NG-RAN restart if the MB-UPF has already removed the DL F-TEID on its own as specified in clause 5.5.\n8a.\tThe SMF may wait for UEs who have joined the MBS session(s) which are affected by the NG-RAN failure to trigger a Service Request procedure to re-establish the user plane resource and then restore the Multicast MBS session in NG-RAN.\n8b.\tAlternatively, the SMF may derive UEs who have joined the MBS session(s) which are affected by the NG-RAN failure (i.e. with a DL F-TEID matching the IP address of the NG-RAN node's to restore the MBS service and perform step 9.\n9.\tWhen step 8b applies, the SMF continues with the MBS session activation procedure as specified in clause 7.2.5.2 of 3GPP TS 23.247 [12] starting from step 3 to restore the MBS sessions for affected UEs for each MBS session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "8.4\tRestoration procedures for AMF failure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.4.1\tMulticast MBS session (de)activation or update after an AMF failure",
                            "text_content": "Different NG-RAN nodes may establish shared delivery for the same MBS session via different AMFs of a same AMF set. During the shared delivery establishment:\n-\teach AMF involved in the establishment of shared delivery stores in its multicast MBS session context the RAN-ID of the NG-RAN nodes that have established shared delivery via this AMF, for subsequent signaling related to the multicast MBS Session (Multicast MBS session activation, deactivation or update); and\n-\tthe MB-SMF stores in its multicast MBS session context the NF Instance ID of each AMF involved in the establishment of shared delivery to enable subsequent signalling towards these AMFs.\nSee clause 7.2.1.4 and Table 6.9.1-1 of 3GPP TS 23.247 [12].\nThe following procedure may be used to enable the MB-SMF to activate, deactivate or update the multicast MBS session, when an AMF of the AMF set through which one or more NG-RAN nodes had established shared delivery has failed with or without restart or is no longer reachable (e.g. due to networking issues, or because it has been de-instantiated from the AMF set).\nDuring the shared delivery establishment procedure (see clause 7.2.1.4 of 3GPP TS 23.247 [12]), the MB-SMF stores, for each AMF involved in the establishment of shared delivery, the list of NG-RAN Node IDs having shared delivery established through the AMF.\nThe MB-SMF may then send any multicast MBS session activation, deactivation and update request towards the NG-RAN nodes that established shared delivery as defined in Figure 8.4.1.2-2.\nThe figure depicts a session activation, deactivation, or update of a multicast MBS session via an alternative AMF set. The figure shows the process of activating, deactivating, or updating a multicast MBS session, with an alternative AMF set. The figure illustrates the process of activating, deactivating, or updating a multicast MBS session, with an alternative AMF set.\nFigure 8.4.1.2-2: Multicast MBS session activation, deactivation or update via an alternative AMF of the AMF set\n0.\tNG RAN1 establishes shared delivery for the multicast MBS session via AMF1. NG RAN2 and NG RAN3 do so via AMF2. MB-SMF stores corresponding information in its MBS session context.\n1.\tAMF2 becomes no longer available/reachable.\n2.\tThe MB-SMF needs to activate, deactivate or update the MBS session.\n3. \tThe MB-SMF sends an Namf_MBSCommunication_N2MessageTransfer Request to every AMF of the same AMF set that was involved in the establishment of shared delivery, as specified in clauses 7.2.5.2, 7.2.5.3 and 7.2.6 of 3GPP TS 23.247 [12], but with the request further including the list of NG RAN Node IDs known by the MB-SMF to have established shared delivery through the respective AMF. AMF1 distributes the request to the list of NG-RAN nodes received from the MB-SMF, if any, otherwise to the list of the NG-RAN nodes it has stored locally, if any.\nNOTE 1:\tIn absence of AMF failures, an NG-RAN node receives requests to activate, deactivate and update the MBS session via the same AMF through which it established shared delivery.\nNOTE 2:\tIncluding the list of NG RAN Node IDs in every Namf_MBSCommunication_N2MessageTransfer Request, even towards AMFs that are operational, enable to distribute the requests to the NG RAN nodes, even if these AMFs would have restarted and lost their list of NG RAN node IDs beforehand, or if the SCP would need to reselect a different AMF when using indirect communication.\n4.\tIf the MB-SMF is not yet aware that AMF2 has failed, it sends an Namf_MBSCommunication N2MessageTransfer Request to AMF2 as described in step 3 and detects that AMF2 is no longer available.\n5.\tThe MB-SMF sends an Namf_MBSCommunication_N2MessageTransfer Request to an alternative AMF (AMF1 in this example) of the same AMF set including the list of NG RAN Node IDs known by the MB-SMF to have established shared delivery through the failed AMF (AMF2). AMF1 distributes the request to the list of NG-RAN nodes received from the MB-SMF.\n\nIf the MB-SMF is already aware at the start of this procedure that AMF2 has failed, the MB-SMF may already include in step 3 the list of NG RAN Node IDs known by the MB-SMF to have established shared delivery through the failed AMF (AMF2).When using unicast transport over N3mb, the MB-SMF may determine that a NG-RAN node has failed or restarted as specified in clause 8.3.4. In this case, the MB-SMF shall remove this NG RAN node from its MBS session context.\nNOTE 3:\tThis avoids that the MB-SMF requests an AMF to send requests to NG RAN nodes that have failed or restarted, i.e. that have no more shared delivery established.\nIn scenarios where the MB-SMF would request an AMF to distribute an activate, deactivate or update request to a NG RAN node that has no longer shared delivery established (e.g. the NG RAN node has restarted but this has not been detected by the MB-SMF), the NG RAN will return an activation or update failure to the AMF. To enable the MB-SMF to be notified about this failure and to remove the NG RAN node ID from its MBS session context, the MB-SMF shall include a notification URI in every Namf_MBSCommunication_N2MessageTransfer Request it sends and the AMF shall notify a failure received from an NG RAN node towards the MB-SMF by sending an Namf_MBSCommunication_Notify request to the notification URI that was received in the request.\nLikewise, if an AMF receives an Namf_MBSCommunication_N2MessageTransfer Request including a NG RAN Node ID and the AMF cannot send any N2 message towards this NG RAN node (e.g. the NG-RAN node has failed without restart), the AMF shall notify the failure to send N2 MBS session requests to the NG RAN node by sending an Namf_MBSCommunication_Notify request to the notification URI that was received in the request.\nNOTE 4:\tWhen IP multicast is used over N3mb, the MB-SMF cannot detect via the MB-UPF that a NG RAN node has failed or restarted. So in this case, and also possibly even when using unicast transport, it can occur that the MB-SMF requests the AMF to send an activate, deactivate or update request to an NG RAN node that has no longer shared delivery established.\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}