{
    "document_name": "29380-i00.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, certain modal verbs have the following meanings:\nshall\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nNOTE 1:\tThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions, and do not appear in Technical Reports.\nNOTE 2:\tThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible, and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\t\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\t\tindicates permission to do something\nneed not\tindicates permission not to do something\nNOTE 3:\tThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\t\tindicates that something is possible\ncannot\t\tindicates that something is impossible\nNOTE 4:\tThe constructions \"can\" and \"cannot\" shall not to be used as substitutes for \"may\" and \"need not\".\nwill\t\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\t\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nNOTE 5:\tThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document specifies the media plane control protocols and interactions with the media needed to support a Mission Critical Push To Talk (MCPTT) system interworking with a Land Mobile Radio (LMR) system. This interworking includes both the signalling and the media planes between the MCPTT system and the LMR system. The function between the MCPTT system and the LMR system is referred to as an Interworking Function (IWF).\nThe IWF supports the basic group and other features as specified in 3GPP TS 23.283 [24].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control Protocol specification\".\n[3]\tIETF RFC 3550: \"RTP: A Transport Protocol for Real-Time Applications\".\n[4]\t3GPP TS 24.483: \"Mission Critical Services (MCS) Management Object (MO)\".\n[5]\t3GPP TS 23.379: \"Functional architecture and information flows to support mission critical communication services; Stage 2\".\n[6]\t3GPP TS 29.468: \"Group Communication System Enablers for LTE (GCSE_LTE); MB2 Reference Point; Stage 3\".\n[7]\tIETF RFC 5761: \"Multiplexing RTP Data and Control Packets on a Single Port\".\n[8]\tVoid.\n[9]\t3GPP TS 25.446: \"MBMS synchronization protocol (SYNC)\".\n[10]\t3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunnelling Protocol User Plane (GTPv1-U)\".\n[11]\t3GPP TS 24.008: \"Mobile radio interface layer 3 specification; Core Network protocols; Stage 3\".\n[12]\t3GPP TS 24.481: \"Mission Critical Services (MCS) group management Protocol specification\".\n[13]\t3GPP TS 24.484: \"Mission Critical Services (MCS) configuration management protocol specification\".\n[14]\tVoid.\n[15]\tIETF RFC 3830: \"MIKEY: Multimedia Internet KEYing\".\n[16]\tIETF RFC 3711: \"The Secure Real-time Protocol (SRTP)\".\n[17]\tIETF RFC 6509: \"MIKEY-SAKKE: Sakai-Kashar Key Encryption in Multimedia Internet KEYing (MIKEY)\".\n[18]\t3GPP TS 33.180: \"Security of the mission critical service\".\n[19]\t3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".\n[20]\tIETF RFC 5795: \"The Robust Header Compression (ROHC) Framework\".\n[21]\tIETF RFC 3095: \"RObust Header Compression (ROHC): Framework and four profiles: RTP, UDP, ESP, and uncompressed\".\n[22]\tIETF RFC 5225: \"RObust Header Compression Version 2 (ROHCv2): Profiles for RTP, UDP, IP, ESP and UDP-Lite\".\n[23]\t3GPP TS 23.280: \"Common functional architecture to support mission critical services; Stage 2\".\n[24]\t3GPP TS 23.283: \"Mission Critical Communication Interworking with Land Mobile Radio Systems\".\n[25]\t3GPP TS 24.380: \"Mission Critical Push To Talk (MCPTT) media plane control\".\n[26]\t3GPP TS 29.379: \"Mission Critical Push To Talk (MCPTT) call control interworking with LMR systems\".\n[27]\t3GPP TS 22.179: \"Mission Critical Push To Talk (MCPTT) Stage 1\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions of terms, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tTerms",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\nFloor participant: The floor participant functional entity is responsible for floor requests. In the present document this term can be a floor participant that can be in either an MCPTT system (ref. 3GPP TS 23.379 [5]) or in an IWF.\nIWF floor control server: A floor control server that is in the IWF.\nIWF floor participant: A floor participant that is in the IWF.\nIWF media endpoint: A media endpoint that is in the IWF.\nMedia endpoint: The end producer or consumer of media and floor control traffic (see also \"IWF media endpoint\").\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.379 [5] apply:\nFloor control\nFloor participant\nFloor control server\nGroup call\nMCPTT call\nMission critical push to talk\nPrivate call\nSIP core\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.283 [24] apply:\nInterworking Function (IWF)\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 29.379 [26] apply:\nIWF performing the controlling role\nIWF performing the non-controlling\nIWF performing the participating role\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 24.380 [25] apply:\nActive floor request queue\nConversation\nEffective priority\nMedia burst\nMedia plane control protocols\nPassive floor request queue\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 33.180 [18] apply:\nGroup Master Key (GMK)\nGroup Master Key Identifier (GMK-ID)\nPrivate Call Key (PCK)\nPrivate Call Key Identifier (PCK-ID)\nSignalling Protection Key (SPK)\nSignalling Protection Key Identifier (SPK-ID)\nFor the purposes of the present document, the following terms and definitions given in IETF RFC 3711 [16] apply:\nSRTP master key (SRTP-MK)\nSRTP master key identifier (SRTP-MKI)\nSRTP master salt (SRTP-MS)\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\nGMK\tGroup Management Key\nGMK-ID\tGroup Master Key Identifier\nGMS\tGroup Management Server\nGUK-ID\tGroup User Key Identifier\nIP\tInternet Protocol\nMBMS\tMultimedia Broadcast and Multicast Service\nMCPTT\tMission Critical Push To Talk\nPCK\tPrivate Call Key\nPCK-ID\tPrivate Call Key Identifier\nPTT\tPush-To-Talk\nRFC\tRequest For Comment\nRTCP\tRTP Control Protocol\nRTP\tReal-time Transport Protocol\nSPK\tSignalling Protection Key\nSPK-ID\tSignalling Protection Key Identifier\nSRTCP\tSecure RTCP\nSRTP\tSecure RTP\nSRTP-MK\tSRTP master key\nSRTP-MKI\tSRTP master key identifier\nSRTP-MS\tSRTP master salt\nSSRC\tSynchronization SouRCe\nUE\tUser Equipment\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tGeneral",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tOverview",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.1.1\tFloor Control",
                            "text_content": "In an MCPTT group call after the call is setup, at a given time only a single group member is allowed to talk, and all other affiliated group members listen to this talker. The control action for obtaining this mode of operation is known as floor control. The direct actors of floor control are the floor participants and the floor control server. A floor participant does the floor control related actions in MCPTT media endpoints and IWF media endpoints. The floor control server is the decision maker of the floor control. The floor control server is in the IWF when it is performing the controlling role.\nFor a general overview of floor control not specific to the IWF, see 3GPP TS 24.380 [25]. In that description, the IWF fulfills all of the described roles as a peer to the MCPTT server. The following features mentioned in 3GPP TS 24.380 [25] are not fully supported in the present document: cut-in, ambient listening and multi-talker.\nOff-network is not applicable to the IWF.\nThe floor control server can determine how to handle a received Floor Request message using a number of input parameters. Examples of input parameters that the floor control server can use are:\n1.\tthe floor priority, using the value of the Floor Priority field in the Floor Request message;\n2.\tthe <user-priority> element as specified in 3GPP TS 24.481 [12];\n3.\tthe participant type, using the <participant-type> element specified in 3GPP TS 24.481 [12] or, in case a non-controlling MCPTT function is attached to a group call, the <Participant Type> value in the Track Info field in the Floor Request message;\n4.\tthe type of call indicated in the Floor Indicator field;\n5.\tthe effective priority of the floor participant with the permission to send media, and the current type of the call (e.g. normal, imminent-peril, emergency, broadcast); and\n6.\tany other information in the group document specified in 3GPP TS 24.481 [12] or information stored in the IWF outside the scope of the present document.\nUsing a local policy and the above input parameters the floor control server can determine that a floor request is:\n1.\tpre-emptive such that the current talker is overridden;\n2.\tpre-emptive such that the current talker is revoked;\n3.\tnot pre-emptive and put in the floor request queue, if queueing was negotiated; or\n4.\tnot-pre-emptive and rejected, if queueing was not negotiated.\nOff-network is not applicable to the IWF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.2\tPre-established session call control",
                            "text_content": "Pre-established session call control is not applicable to the IWF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.3\tMBMS subchannel control",
                            "text_content": "MBMS is not applicable to the IWF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.2\tInternal structure of media plane control entities",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2.0\tGeneral",
                            "text_content": "For clarity, the present document describes media plane aspects of the IWF-1 reference point using the structure shown in 3GPP TS 24.380 [25] and further detailed in clause 4.2.1. The IWF need not implement the structure of media plane control entities given in the present document, but the resulting IWF behaviour on the IWF-1 interface must be as specified in the present document.\nThe floor control interface towards LMR entities is out of scope of the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.1\tControlling MCPTT function",
                            "text_content": "According to 3GPP TS 23.379 [5], the controlling MCPTT function is divided into a floor control server and a media distribution function. In the present document an example of an internal structure of the IWF performing the controlling role is illustrated in figure 4.2-1.\nThe given figure illustrates a possible internal structure of an Intrusion Prevention System (IPS) known as the Intrusion Detection and Prevention System (IDPS), which is a crucial component in network security. The figure shows the various components and their interactions within the IDPS, including the input and output interfaces, the processing elements, and the database. The input interfaces receive data packets from the network, which are then processed by the processing elements, which may include filtering, pattern matching, and anomaly detection algorithms. The output interfaces then send alerts or take action based on the results of the processing. The database stores information about known threats and patterns of normal network traffic, which can be used to enhance the accuracy of the detection and prevention mechanisms. The figure also shows the relationship between the IDPS and other security components, such as firewalls and security information and event management (SIEM) systems, highlighting the importance of a coordinated approach to network security.\nNOTE:\tThe real internal structure of the IWF is implementation specific but a possible internal structure is shown to illustrate the procedures.\nFigure 4.2.1-1: Internal structure of floor control in the IWF performing the controlling role\nAll entities in the IWF performing the controlling role are assumed to have a direct communication interface to the application and signalling plane. The interface to the application and signaling plane carries information about SIP session initialisation and SIP session release, SDP content, etc.\nThe reference point IWF-1 is described in 3GPP TS 23.283 [24]. The floor control interface towards the MCPTT media endpoint receives and transmits the floor control messages from and to the MCPTT media endpoint via the participating MCPTT function or non-controlling MCPTT function. The procedures are controlled by a state machine described in clause 6.3.5. One state machine is needed for each MCPTT media endpoint participating in an MCPTT call. A non-controlling MCPTT function is seen by the floor control interface towards the MCPTT client as an MCPTT media endpoint.\nThe floor control arbitration logic performs the floor control. The floor control arbitration logic is controlled by a state machine described in clause 6.3.4. One state machine is needed per MCPTT call.\nThe floor request queue is accessible both by the floor control interface towards the MCPTT client for all MCPTT media endpoint in the call and the floor control arbitration logic.\nThe network media interface receives and sends media from and to the associated MCPTT media endpoint via the participating MCPTT function or non-controlling MCPTT function. The network media interface is out of scope of the present document. One network media interface is needed for each MCPTT media endpoint participating in an MCPTT call. A non-controlling MCPTT function is seen by the network media interface as an MCPTT media endpoint.\nThe media distributor is controlled by the floor control arbitration logic. The media distributor is out of scope of the present document. One media distributor is needed per MCPTT call.\nThe internal interfaces are assumed to transport the following types of information.\n1.\tThe interface between the network media interface and the floor control interface towards the MCPTT client:\na.\tIndication that the network media interface has started to receive media packets from the associated MCPTT media endpoint or that media packets are no longer received from the associated MCPTT media endpoint.\nNOTE:\tIt is an implementation option whether an indication e.g. is sent for every received RTP media packet or only when the first packet is received and then when no more RTP packets are received.\n2.\tThe interface between the floor control interface towards the MCPTT media endpoint and the floor control arbitration logic:\na.\tFloor control messages to and from the associated MCPTT media endpoint, requests to create or delete the state machine instance for the associated MCPTT media endpoint. The floor control messages to the floor control arbitration logic are limited to floor control messages that will change the state of the floor.\n3.\tThe interface between the network media interface and the media distributor:\na.\tMedia to and from associated MCPTT media endpoint. This interface is out of scope of the present document.\n4.\tThe interface between the floor control arbitration logic and the media distributor:\na.\tRequests to start or stop distributing media to floor participants in the MCPTT call. Indication that the media distributor has started to receive media packets from the network media interface associated with the MCPTT media endpoint with the permission to send media or that media packets are no longer received from the network media interface from the associated MCPTT media endpoint.\n5.\tThe interface between the floor control interface towards the MCPTT client and the floor request queue:\na.\tRequests to store received Floor Request messages in the queue or requests to remove Floor Request messages from the queue and the queue content for building the Floor Queue Position Info message.\n6.\tThe interface between the floor control arbitration logic and the floor request queue:\na.\tRequests to store received Floor Request messages in the queue or requests to remove Floor Request messages from the queue. Indications that the queue is modified.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.2\tMCPTT client",
                            "text_content": "A user homed in the IWF is represented as an \"IWF media endpoint\". Actions relative to an IWF media endpoint are described as appropriate in the procedures of this present document for the IWF performing the participating, controlling, and non-controlling roles.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.3\tParticipating MCPTT function",
                            "text_content": "The IWF performing the participating role uses media plane control (non-SIP) messages when taking part in the floor control procedures as specified in clause 6.\nThe following clauses describe the assumed internal structure of the IWF performing the participating role and its role in the floor control procedures.\nIn the present document the internal structure of the IWF performing the participating role is illustrated in figure 4.2.3.2-1.\nThe given telecommunication figure illustrates the internal structure of an Intelligent Working Function (IWF) performing the participating role. The figure depicts the logical flow and procedures within the IWF, showcasing its role in the network. The IWF is shown to interact with various components, such as the Service Control Point (SCP), Policy and Charging Rules Function (PCRF), and Home Agent (HA), to ensure proper network management and service delivery. The figure highlights the IWF's ability to process and respond to events, enforce policies, and perform charging functions, all while adhering to the network's overall architecture and protocols.\nNOTE:\tThe real internal structure of the IWF performing the participating role is implementation specific, but a possible internal structure is shown to illustrate the logic and the procedures.\nFigure 4.2.3.2-1: Internal structure of the IWF performing the participating role\nAll entities in the IWF performing the participating role have a direct communication interface to the application and signalling plane. The interface to the application and signalling plane carries information about SIP session initialisation and SIP session release, SDP content, etc.\nThe reference point IWF-1 is described in 3GPP TS 23.283 [24].\nThe IWF floor participant in the IWF performing the participating role manages media sessions on behalf of users homed in the IWF for cases where the session is homed in the MCPTT system. The specifications for the IWF performing the participating role related to the floor control are in clause 6.4 for media and media plane control delivery.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.4\tNon-controlling MCPTT function of an MCPTT group",
                            "text_content": "According to 3GPP TS 24.379 [2] subclause 5.3 the MCPTT server can act in a non-controlling MCPTT function of an MCPTT group role. In the present document the internal structure of the non-controlling MCPTT function of the IWF of an MCPTT group is illustrated in figure 4.2.4-1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.3\tThe media plane control channel",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.3.1\tGeneral",
                            "text_content": "The media plane control channel is used for transport of messages associated with the floor control protocol.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.2\tControl channel realization",
                            "text_content": "The media plane control channel is realized by sending RTCP APP packets on top of UDP/IP. RTCP APP packets are defined in IETF RFC 3550 [3]. The MCPTT specific coding of the RTCP APP packets is defined in clause 8 of the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.3\tEstablishing a media plane control channel",
                            "text_content": "The IWF uses the SDP offer/answer mechanism in order to negotiate the establishment of the media plane control channel. The SDP offer/answer procedures for negotiating media plane control channel capabilities are specified in clause 14. The ABNF is defined in clause 12.\nThe media description (\"m=\" line) associated with the media plane control channel shall have the values as described in table 4.3.3.1-1.\nTable 4.3.3.1-1: Media plane control channel media description\n\nThe port used for RTCP messages associated with the media plane control channel shall be different than ports used for RTCP messages associated with other \"m=\" lines (e.g. RTP) in the SDP.\nNOTE 1:\tAs RTCP is used to transport messages on the media plane control channel, the \"m=\" line port value indicates an RTCP port. This is different from cases where an \"m=\" line is associated with an RTP-based stream, and the \"m=\" line port value indicates an RTP port.\nNOTE 2:\tIn the case where the media plane control channel uses a different IP address than other media described in the SDP, a media plane control channel specific \"c=\" line also needs to be associated with the \"m=\" line associated with the media plane control channel.\nThe format of the optional SDP fmtp attribute, when associated with the media plane control channel, is described in clause 12.\nThe example below shows an SDP media description for a media plane control channel.\nm=application 20032 udp MCPTT\na=fmtp:MCPTT mc_queueing;mc_priority=5;mc_granted\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.3.3.1-1: Media plane control channel media description",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "5\tRoles",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause associates the IWF with the MCPTT roles described in the stage 2 architecture document (see 3GPP TS 23.379 [5]).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tClient",
                    "description": "",
                    "summary": "",
                    "text_content": "The IWF acts on behalf of all users homed in the IWF. There are no client procedures specified in the present document and specific client handling within the LMR system is out of scope.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.3\tIWF performing the controlling role",
                    "description": "",
                    "summary": "",
                    "text_content": "An IWF performing the controlling role shall:\n1.\tsupport the role of a controlling MCPTT function as specified in 3GPP TS 23.379 [5];\n2.\tsupport negotiating media plane control channel media level attributes as specified in clause 4.3;\n3.\tprovide floor control arbitration logic with an interface to MCPTT clients as described in clause 4.2.1 and support the related procedures as specified in clause 6.3;\n4.\tprovide a network media interface as described in clause 4.2.1 and support associated procedures as specified in clause 6.3;\n5.\tprovide a media distributor with a floor control interface towards the MCPTT clients as described in 3GPP TS 24.380 [25] clause 4.2.1 and support associated procedures in clause 6.3;\n6.\tsupport the on-network mode floor control protocol elements as specified in clause 8: and\n7.\tsupport media plane security as specified in clause 13.\nAn IWF performing the controlling role may:\n1.\tprovide a floor request queue as described in clause 4.2.1 and support the related procedures as specified in clause 6.3 and clause 4.3.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.4\tIWF performing the participating role",
                    "description": "",
                    "summary": "",
                    "text_content": "An IWF performing the participating role shall:\n1.\tsupport the role of a participating MCPTT function;\n2.\tdistribute floor control messages as described in clause 6.3 and support associated procedures as specified in clause 6.4;\n3.\tperform endpoint floor control signalling as the floor participant on behalf of users homed in the IWF; and\nNOTE:\tFloor control is modelled as a floor participant that is part of the IWF performing the participating role, and sits \"behind\" the participating role. This is for modelling purposes only and does not impose any particular structure or implementation on the IWF.\n4.\tsupport media plane security as specified in clause 13.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.5\tIWF performing the non-controlling role",
                    "description": "",
                    "summary": "",
                    "text_content": "An IWF performing the non-controlling role of an MCPTT group shall:\n1.\tsupport floor control involving groups from multiple MCPTT systems as specified in 3GPP TS 29.379 [26];\n2.\tprovide a floor control interface towards the controlling MCPTT function as described in clause 4.2.4 and support the related procedures as specified in clause 6.5;\n3.\tprovide a media interface towards the controlling MCPTT function as described in clause 4.2.4 and support the related procedure as specified in clause 6.5;\n4.\tprovide a media distributor as described in clause 4.2.4 and the related procedures as specified in clause 6.5; and\n5.\tsupport media plane security as specified in clause 13.\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "6\tFloor control",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause provides:\n1.\tthe IWF floor participant in clause 6.2;\n2.\tthe IWF floor control server procedures in clause 6.3;\n3.\tthe IWF performing the participating floor control procedures in clause 6.4; and\n4.\tthe IWF performing the non-controlling role of an MCPTT group in clause 6.5.\nIf media plane security is required, the IWF shall perform the additional procedures in clause 13.\nNOTE:\tIt is possible that in a group re-group operation, the IWF can be performing both the controlling role for the re-grouped groups and the non-controlling role for one or more constituent groups. The actual implementation and internal communication among aspects of the IWF is out of scope.\nEditor's Note:\tThe procedures of the IWF performing the non-controlling role are FFS.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.2\tFloor participant procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "Procedures for IWF floor participants are addressed in the following:\n-\tthe IWF performing the controlling role procedures in clause 6.3.4; and\n-\tthe IWF performing the participating role procedures in clause 6.4.\nEditor's Note:\tThe IWF performing the non-controlling role is FFS.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.3\tFloor control server procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3.1\tGeneral",
                            "text_content": "The floor control server arbitration logic in the IWF floor control server shall support the procedures in clauses 6.3.2 and 6.3.3 and shall behave according to the floor control server state transition diagram for 'general floor control operation' in clause 6.3.4.\nThe floor control interface towards the MCPTT client in the IWF floor control server shall behave according to the floor control server state transition diagram for 'basic floor control operation towards the floor participant' as specified in clause 6.3.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.2\tIWF performing the controlling role procedures at MCPTT call initialization",
                            "text_content": "Clause 6.3.2.2 describes the initial procedures when a new SIP session is establishing a group session or a private session with floor control.\nClause 6.3.2.3 describes the procedures when the IWF performing the non-controlling role switches from the non-controlling role to the controlling role.\nWhen an MCPTT call is established a new instance of the floor control server state machine for 'general floor control operation' is created.\nFor each MCPTT media endpoint added to the MCPTT call, a new instance of the floor control server state machine for 'basic floor control operation towards the floor participant' is added.\nIf the optional \"mc_queueing\" feature is supported and has been negotiated as specified in clause 14, the IWF floor control server could queue the implicit floor control request for the MCPTT media endpoint.\nFor cases where a SIP request originates in the MCPTT system, the initial SIP INVITE request or SIP REFER request to establish an MCPTT chat group call or to rejoin an ongoing MCPTT call is not handled as an implicit floor control request message by the IWF floor control server unless explicitly stated in the SIP INVITE request or in the SIP REFER request.\nThe permission to send media to the inviting MCPTT media endpoint due to implicit floor control request is applicable to both confirmed indication and unconfirmed indication.\nWhen the first unconfirmed indication is received from the invited participating MCPTT function (see 3GPP TS 29.379 [26]) the IWF floor control server optionally can give an early indication to send RTP media packets, to the inviting MCPTT media endpoint.\nBefore the IWF floor control server sends the first floor control message in the MCPTT call, the IWF floor control server has to assign itself an SSRC identifier to be included in media floor control messages and quality feedback messages if the IWF is supporting that option. A suitable algorithm to generate the SSRC identifier is described in IETF RFC 3550 [3].\nThe MCPTT floor participant and the IWF floor control server can negotiate the maximum priority level that the floor participant is permitted to request. The IWF floor control server can pre-empt the current sender based on the negotiated maximum priority level that the MCPTT floor participant is permitted to request, and the priority level included in the Floor Request message.\nNOTE:\tThe maximum priority level that an MCPTT floor participant can use is negotiated as specified in clause 14.3.3 and is based on group configuration data retrieved by the IWF performing the controlling role from the group management server as described in 3GPP TS 24.481 [12] and local policies applied by the IWF performing the controlling role.\nThe MCPTT floor participant and the IWF floor control server can negotiate queueing of floor requests using the \"mc_queueing\" fmtp attribute as described in clause 14. If queueing is supported and negotiated, the IWF floor control server queues the floor control request if a Floor Request message is received when another floor participant has the floor and the priority of the current speaker is the same or higher.\nEditor's Note:\tThe IWF non-controlling role procedures are FFS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.3\tFloor control procedures at MCPTT call release",
                            "text_content": "When an MCPTT media endpoint leaves an MCPTT call and the MCPTT call remains ongoing with the other media endpoints, the IWF floor control server follows a two-step procedure.\nStep 1\tThe IWF stops sending floor control messages and RTP media packets to the MCPTT media endpoint leaving the MCPTT call and, the IWF discards floor control messages and RTP media packets received from the MCPTT media endpoint leaving the MCPTT call.\nStep 2\tWhen the application and signalling plane has determined that the MCPTT call with this MCPTT floor participant has been released, the corresponding instance of the IWF floor control server state machine for 'basic floor control operation towards the floor participant' is released.\nWhen an MCPTT call is released, the IWF floor control server follows a two-step procedure.\nStep 1\tThe IWF stops sending floor control messages and RTP media packets to all floor participants in the MCPTT call.\nStep 2\tWhen the application and signalling plane has determined that the MCPTT call has been released, the corresponding instance of the floor control server state machine for 'general floor control operation' are also terminated, along with any 'basic floor control operation towards the floor participant' state machines for the floor participants of this call.\nThe floor control server state machine for general floor control operation initiates the MCPTT call release depending on the release policy specified in 3GPP TS 29.379 [26].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.4\tFloor control server state transition diagram for general floor control operation",
                            "text_content": "The floor control server arbitration logic in the floor control server in the IWF shall behave according to the state diagram in Figure 6.3.4.1-1 and state transitions specified in this clause. The present clause is applicable for floor control of groups homed in the IWF.\nFigure 6.3.4.1-1 illustrates the state transition diagram for 'general floor control operation' within a building automation system. The diagram depicts the various states a floor control server can transition through, including initialization, normal operation, and error states. Key components include the floor control server, sensors, actuators, and communication interfaces. The diagram emphasizes the flow of commands and data between these components, highlighting the system's ability to respond to user inputs and maintain building conditions.\nFigure 6.3.4.1-1: Floor control server state transition diagram for 'general floor control operation'\nThe floor control arbitration logic in the floor control server shall keep one instance of the 'general floor control operation' state machine per MCPTT call.\nIf floor control messages or RTP media packets arrives in a state where there is no procedure specified in the following clauses the floor control arbitration logic in the IWF floor control server:\n1.\tshall discard the floor control message;\n2.\tshall request the media distributor in the IWF to discard any received RTP media packet; and\n3.\tshall remain in the current state.\nState details are explained in the following clauses.\nWhen a new instance of the 'general floor control operation' state machine is initiated, before any floor control related input is applied, the state machine is in 'Start-stop' state. Similarly, when the call is released the state machine shall return to the 'Start-stop' state or the related MCPTT call is released.\nWhen an MCPTT call is initiated as specified in 3GPP TS 29.379 [26] and\n1.\tif a confirmed indication is required and at least one invited media endpoint has accepted the invitation;\n2.\tif a confirmed indication is not required; or\n3.\tif the initialised MCPTT call is a temporary group session;\nNOTE:\tAn MCPTT group call is a temporary group session when the <on-network-temporary> element is present in the <list-service> element as specified in 3GPP TS 24.481 [12].\nthen the floor control arbitration logic in the floor control server:\n1.\tshall create an instance of the 'general floor control operation' state machine;\n2.\tshall wait for the 'basic floor control operation towards the floor participant' to be initialized before continuing the following steps;\n3.\twhen the 'basic floor control operation towards the floor participant' state machine is initialized, and the initialised session is not a temporary group session:\na.\tif the \"mc_granted\" fmtp attribute is not negotiated as specified in clause 14:\ni.\tif the floor control server is granting an implicit floor request at MCPTT call establishment, shall act as if a Floor Request message was received and perform the actions specified in clause 6.3.4.3.3; or\nii.\tif the floor control server is not granting an implicit floor request at MCPTT call establishment, shall enter the 'G: Floor Idle' state as specified in clause 6.3.4.3.2; or\nb.\tif the \"mc_granted\" fmtp attribute is negotiated as specified in clause 14, shall enter the 'G: Floor Taken' state as specified in clause 6.3.4.4.2; and\n4.\tif the 'basic floor control operation towards the floor participant' state machine is initialized, and the initialised session is a temporary group session, shall enter the 'G: Initialising' state as specified in the clause 6.3.4.8.1.\nThe floor control arbitration logic in the IWF floor control server is in this state when no floor participant currently has permission to send media.\nTimer T4 (Inactivity) and timer T7 (Floor Idle) can be running when the floor control arbitration logic in the IWF floor control server is in this state.\nWhen entering this state from any state except the 'Start-stop' state and if no MCPTT media endpoint negotiated support of queueing floor requests as described in clause 14, and the IWF does not require queuing for its IWF floor participants, and the state machine specified in clause 6.3.6 does not exist, the floor control arbitration logic in the IWF floor control server:\n1.\tif there is a Track Info field associated with the floor control server state transition diagram for 'general floor control operation' stored, shall remove the Track Info field from the storage;\n2.\tif the active floor request queue is empty the IWF floor control server:\na.\tshall send Floor Idle message to all MCPTT floor participants. The Floor Idle message:\ni.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1; and\nii.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\nNOTE 1:\tHow the IWF informs IWF media endpoints of the idle floor is out of scope of the present document.\nb.\tshall start timer T7 (Floor Idle) and initialise counter C7 (Floor Idle) to 1;\nc.\tshall start timer T4 (Inactivity); and\nd.\tshall set the general state to the 'G: Floor Idle' state; and\n3.\tif the active floor request queue is not empty the IWF floor control server:\na.\tshall select a queued floor request from the top of the active floor request queue;\nb.\tshall remove that queued floor request from the active floor request queue;\nc.\tif the queued floor request includes a Track Info field, shall store the Track Info field and associate it with the floor control server state transition diagram for 'general floor control operation'; and\nd.\tshall enter the 'G: Floor Taken' state as specified in the clause 6.3.4.4.2 with respect to that floor participant.\nWhen entering this state from any state except the 'Start-stop' state and the state machine specified in clause 6.3.6 exists, the floor control arbitration logic in the IWF floor control server:\n1.\tif there is a Track Info field associated with the floor control server state transition diagram for 'general floor control operation' stored, shall remove the Track Info field from the storage;\n2.\tshall send Floor Idle message to all MCPTT floor participants which are configured to listen to the overridden participant. The Floor Idle message:\na.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1; and\nb.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\nNOTE 2:\tHow the IWF informs IWF media endpoints of the idle floor is out of scope of the present document.\n3.\tshall send Floor Taken message to MCPTT floor participants which are configured to listen only to the overridden participant. The Floor Taken message:\na.\tif privacy is not requested, shall include the granted MCPTT user's (overriding participant) MCPTT ID in the Granted Party's Identity field;\nb.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\nNOTE 3:\tHow the IWF informs IWF media endpoints of the taken floor is out of scope of the present document.\n4.\tshall set the general state to the 'G: Floor Taken' state; and\n5.\tshall send the termination instruction to the 'dual floor control operation' state machine.\nUpon receiving a floor request message (from an MCPTT floor participant that is permitted to make a floor request) the floor control arbitration logic in the IWF floor control server:\n1.\tshall reject the request if one of the following conditions is fulfilled:\na.\tif there is only one media endpoint in the MCPTT call; and\nb.\t<on-network-recvonly> element is present in the <entry> element as specified 3GPP TS 24.481 [12] for the associated floor participant;\n2.\tif the floor request is rejected the IWF floor control server:\na.\tshall send the Floor Deny message. The Floor Deny message:\ni.\tshall include in the Reject Cause field the <Reject Cause> value:\nA.\tcause #3 (Only one participant), if there is only one media endpoint in the MCPTT call; or\nB.\tcause #5 (Receive only), if the <on-network-recvonly> element is present in the <entry> element as specified in 3GPP TS 24.481 [12] for the associated MCPTT floor participant;\nii.\tmay include an additional text string explaining the reason for rejecting the floor request in the <Reject Phrase> value of the Reject Cause field; and\niii.\tif the Floor Request included a Track Info field, shall include the received Track Info field;\nb.\tshall remain in the 'G: Floor Idle' state; and\n3.\tif the floor request is granted the IWF floor control server:\na.\tshall stop timer T4 (Inactivity);\nb.\tshall stop timer T7 (Floor Idle);\nc.\tif the floor is being granted to an MCPTT floor participant, and if a Track Info field is included in the Floor Request message, shall store the received Track Info field, and\nd.\tshall enter the 'G: Floor Taken' state as specified in the clause 6.3.4.4.2.\nTo grant floor to an IWF floor participant, the floor control arbitration logic in the IWF floor control server:\n1.\tshall stop timer T4 (Inactivity);\n2.\tshall stop timer T7 (Floor Idle);\n3.\tif the floor is being granted to an IWF floor participant,\na.\tshall generate and store an SSRC; otherwise\nb.\tshall store the SSRC of the IWF floor participant granted the permission to send media until the floor is released associated to that floor request; and\n4.\tshall enter the 'G: Floor Taken' state as specified in the clause 6.3.4.4.2.\nOn expiry of timer T7 (Floor Idle) the floor control arbitration logic in the IWF floor control server:\n1.\tshall restart timer T7 (Floor Idle) and increment counter C7 (Floor Idle) by 1 if counter C7 (Floor Idle) has not reached its upper limit;\n2.\tshall send a Floor Idle message to all MCPTT floor participants in the MCPTT call if counter C7 (Floor Idle) has not reached its upper limit. The Floor Idle message:\na.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nNOTE:\tHow the IWF informs IWF media endpoints of the idle floor is out of scope of the present document.\n3.\tshall remain in the 'G: Floor Idle' state.\nOn expiry of timer T4 (Inactivity) the floor control arbitration logic in the IWF floor control server based on a configurable service provider policy either:\n1.\tshall indicate to the application and signalling plane that timer T4 (Inactivity) has expired;\n2.\tif the application and signalling planes initiates MCPTT call release, shall enter the 'Releasing' state; and\n3.\tif the application and signalling planes do not initiate MCPTT call release:\na.\tshould restart the T4 (Inactivity) timer; and\nb.\tshall remain in the 'G: Floor Idle' state.\nUpon receiving an implicit floor request due to an upgrade to an emergency group call or due to an upgrade to imminent peril call, the floor control arbitration logic in the IWF floor control server:\n1.\tshall reject the request if there is only one media endpoint in the MCPTT call;\n2.\tif the floor request is rejected the IWF floor control server:\na.\tshall send the Floor Deny message. The Floor Deny message:\ni.\tshall include in the Reject Cause field the <Reject Cause> value cause #3 (Only one participant); and\nii.\tmay include in the Reject Cause field an additional text string explaining the reason for rejecting the floor request in the <Reject Phrase> value; and\nb.\tshall remain in the 'G: Floor Idle' state; and\n3.\tif the floor request is granted the IWF floor control server:\na.\tshall stop the timer T4 (Inactivity);\nb.\tshall stop the timer T7 (Floor Idle); and\nc.\tshall enter the 'G: Floor Taken' state as specified in the clause 6.3.4.4.2.\nThe floor control arbitration logic in the IWF floor control server uses this state when it has permitted one or more media endpoints in the MCPTT call to send media.\nTimer T1 (End of RTP media) is running when the floor control server is in this state.\nTimer T2 (End talking) can be running when the IWF floor control server is in this state.\nTimer T20 (Floor Granted) is running to guarantee reliable delivery of the Floor Granted message, if the granted floor request was queued.\nWhen entering this state, the floor control arbitration logic in the IWF floor control server:\n1.\tshall send a Floor Granted message to the MCPTT floor participant to which the floor is granted. The Floor Granted message:\na.\tshall include the value of timer T2 (Stop talking) in the Duration field;\nb.\tshall include the granted priority in the Floor priority field;\nc.\tif a Track Info field associated with the floor control server state transition diagram for 'general floor control operation' is stored, shall include the stored Track Info field; and\nd.\tif a group call is a broadcast group call, system call, emergency call, an imminent peril call or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n2.\tshall start timer T20 (Floor Granted) if the floor request was queued for the participant to which the floor is granted and initialise the counter C20 (Floor Granted) to 1;\n3.\tshall send Floor Taken message to all MCPTT floor participants. The Floor Taken message:\na.\tshall include the granted user's MCPTT ID in the Granted Party's Identity field, if privacy is not requested;\nb.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1;\nc.\tif the session is a broadcast group call, shall include the Permission to Request the Floor field set to '0';\nd.\tif the session is not a broadcast group call, may include the Permission to Request the Floor field set to '1'; and\ne.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\nNOTE:\tHow the IWF informs IWF media endpoints of the taken floor is out of scope of the present document.\n4.\tshall start timer T1 (End of RTP media) for the participant to which the floor is granted; and\n5.\tshall set the general state to 'G: Floor Taken' state.\nOn expiry of timer T1 (End of RTP media), the floor control arbitration logic in the IWF floor control server:\n1.\tshall stop the timer T2 (Stop talking) for the participant to which the floor is granted; if running;\n2.\tshall stop timer T20 (Granted re-send) for the participant to which the floor is granted, if running;\n3.\tshall request the media distributor to stop distributing RTP media packets received from the participant for which T1 (End of RTP media) has expired (with the exception of RTP media packets already in the buffer (if RTP media buffering is ongoing)) to other media endpoints; and\n4.\tshall enter the 'G: Floor Idle' state as specified in the clause 6.3.4.3.2;\nOn expiry of timer T2 (Stop talking), the floor control arbitration logic in the IWF floor control server:\n1.\tshall stop timer T1 (End of RTP media) for the MCPTT participant for which timer T2 has expired;\n2.\tshall include the Reject Cause field with the <Reject Cause> value set to #2 (Media burst too long) in the Floor Revoke message sent in clause 6.3.4.5.2; and\n3.\tshall enter the 'G: pending Floor Revoke' state as specified in the clause 6.3.4.5.2.\nUpon receiving an indication from the media distributor that RTP media packets are received from the MCPTT media endpoint, the floor control arbitration logic in the IWF floor control server:\n1.\tshall start timer T2 (Stop talking) for the MCPTT media endpoint from which the RTP packet has been received, if not running;\n2.\tshall restart timer T1 (End of RTP media) for the participant from which the RTP packet has been received;\n3.\tshall stop timer T20 (Floor Granted) for the participant from which the RTP packet has been received, if running;\n4.\tshall forward the RTP media packets to media endpoints according to local policy; and\nNOTE:\tIf dual floor control is ongoing as described in clause 6.3.6, the list of floor participants that receive the overriding, overridden, or both transmissions is based on configuration.\n5.\tshall remain in the 'G: Floor Taken' state.\nUpon receiving a Floor Release message or upon determining that a user homed in the IWF has released the floor, the floor control arbitration logic in the IWF floor control server:\n1.\tshall request the media distributor to stop forwarding RTP media packets received from the participant that sent the Floor Release message;\n2.\tshall stop timer T2 (Stop talking) for the participant that sent the Floor Release message, if running;\n3.\tshall stop timer T20 (Granted re-send) for the participant that sent the Floor Release message, if running; and\n4.\tshall enter the 'G: Floor Idle' state as specified in the clause 6.3.4.3.2;\nUpon deciding to release the floor, the floor control arbitration logic in the IWF floor control server:\n1.\tshall request the media distributor to stop forwarding RTP media packets; and\n2.\tshall enter the 'G: Floor Idle' state as specified in the clause 6.3.4.3.2.\nNOTE:\tThis procedure is also invoked from the clause 6.3.5.4.4.\nOn receipt of a floor request message with effective priority indicating pre-emptive priority, and if the effective priority of the floor participant with permission to send media is not the pre-emptive priority, the floor control arbitration logic in the IWF floor control server:\n1.\tbased on local policy, select one of the following options:\na.\trevoke the current speaker; or\nb.\tallow media from both the current speaker and from the participant now requesting floor with a pre-emptive floor priority;\n2.\tif revoking current speaker is selected:\na.\tshall stop timer T1 (End of RTP media), if running;\nb.\tshall stop timer T20 (Floor Granted), if running;\nc.\tshall include a Reject Cause field with the <Reject Cause> value set to #4 (Media Burst pre-empted) in the Floor Revoke message sent in clause 6.3.4.5.2;\nd.\tshall enter the 'G: pending Floor Revoke' state as specified in the clause 6.3.4.5.2;\ne.\tshall insert the MCPTT floor participant into the active floor request queue to the position in front of all queued requests, if not inserted yet or update the position of the floor participant in the active floor request queue to the position in front of all other queued requests, if already inserted; and\nf.\tshall send a Floor Queue Position Info message to the requesting MCPTT floor participant, if negotiated support of queueing of floor requests as specified in clause 14. The Floor Queue Position Info message:\ni.\tinclude the queue position and floor priority in the Queue Info field; and\nii.\tif the Floor Request message included a Track Info field, shall include the received Track Info field; and\n3.\tif allow media from both the current speaker and from the participant now requesting floor with a pre-emptive priority is selected:\na.\tshall perform the actions specified in the clause 6.3.6.2.2.\nThe multi-talker feature is not supported in this version of the present document.\nUpon receiving a floor request message from the MCPTT floor participant that has been granted permission to send media, the floor control arbitration logic in the IWF floor control server:\n1.\tshall send a Floor Granted message to the previously granted MCPTT floor participant. The Floor Granted message:\na.\tshall include the value of timer T2 (Stop talking) running for this MCPTT floor participant in the Duration field;\nb.\tshall include the granted priority in the Floor priority field; and\nc.\tif the Floor Request message included a Track Info field, shall include the received Track Info field; and2.\tshall remain in the 'G: Floor Taken' state.\nOn expiry of timer T20 (Floor Granted), the floor control arbitration logic in the IWF floor control server:\n1.\tshall send a Floor Granted message to the granted floor participant if counter C20 (Floor Granted) has not reached its upper limit: The Floor Granted message:\na.\tshall include the value of timer T2 (Stop talking) in the Duration field;\nb.\tshall include the granted priority in the Floor priority field; and\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n2.\tshall start timer T20 (Floor Granted) and increment counter C20 (Floor Granted) by 1 if counter C20 (Floor Granted) has not reached its upper limit; and\n3.\tshall remain in the 'G: Floor Taken' state.\nWhen timer T20 (Floor Granted) expires and counter C20 (Floor Granted) reaches its upper limit, the floor control arbitration logic in the IWF floor control server:\n1.\tshall remain in the 'G: Floor Taken' state.\nIf the IWF floor control server receives an indication from the floor control interface towards the MCPTT client that the MCPTT media endpoint has started to disconnect from the MCPTT call, or the IWF decides to release the floor, the floor control arbitration logic in the floor control server:\n1.\tshall enter the 'G: Floor Idle' state as specified in the clause 6.3.4.3.2.\nUpon receiving an implicit floor request due to an upgrade to an emergency group call or due to an upgrade to imminent peril call, the floor control arbitration logic in the IWF floor control server:\n1.\tshall stop timer T1 (End of RTP media), if running;\n2.\tshall stop timer T20 (Floor Granted), if running;\n3.\tshall set the Reject Cause field in the Floor Revoke message to #4 (Media Burst pre-empted);\n4.\tshall enter the 'G: pending Floor Revoke' state as specified in the clause 6.3.4.5.2;\n5.\tshall insert the MCPTT floor participant into the active floor request queue to the position in front of all queued requests, if not inserted yet or update the position of the floor participant in the active floor request queue to the position in front of all other queued requests, if already inserted; and\n6.\tshall send a Floor Queue Position Info message to the requesting MCPTT floor participant, if negotiated support of queueing floor requests as specified in clause 14. The Floor Queue Position Request message:\na.\tshall include the queue position and floor priority in the Queue Info field; and\nb.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications.\nThe floor control arbitration logic in the IWF floor control server uses this state after having sent a Floor Revoke message to the MCPTT floor participant.\nTimer T3 (Stop talking grace) is running when the floor control arbitration logic in the IWF floor control server is in this state.\nIn this state, the IWF forwards RTP media packets to the MCPTT media endpoints in the MCPTT call.\nWhen entering this state, the floor control arbitration logic in the IWF floor control server:\n1.\tshall send the Floor Revoke message to the MCPTT floor participant. The Floor Revoke message:\na.\tshall include the reason for sending the Floor Revoke message in the <Reject Cause> value in the Reject Cause field; and\nb.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n2.\tshall start timer T3 (Stop talking grace) for which a Floor Revoke message has been sent; and\n3.\tshall set the general state to 'G: pending Floor Revoke'.\nUpon receiving an indication from the media distributor that RTP media packets are received from the permitted floor participant the IWF floor control server:\n1.\tshall restart timer T1 (End of RTP media);\nNOTE 1:\tIf the upper limit for timer T3 (Stop talking grace) is less than the upper limit of timer T1 (End of RTP media) then timer T1 (End of RTP media) will not expire.\n2.\tshall instruct the media distributor to forward the RTP media packets to MCPTT media endpoints according to local policy; and\nNOTE 2:\tIf dual floor control is ongoing as described in clause 6.3.6, the list of floor participants that receive the overriding, overridden, or both transmissions is based on configuration.\n3.\tshall remain in the 'G: pending Floor Revoke' state.\nUpon receiving a Floor Release message for which a Floor Revoke message has been sent, the floor control arbitration logic in the IWF floor control server:\n1.\tshall request the media distributor to stop forwarding RTP media packets;\n2.\tshall stop timer T1 (End of RTP media) , if running;\n3.\tshall stop timer T3 (Stop talking grace);\n4.\tif the active floor request queue is not empty the IWF floor control server shall enter the 'G: Idle' state as specified in the clause 6.3.4.3.2; and\n5.\tif the active floor request queue is empty the IWF floor control server shall enter the 'G: Idle' state as specified in the clause 6.3.4.3.2.\nOn expiry of timer T3 (Stop talking grace) for which a Floor Revoke message has been sent, the floor control arbitration logic in the IWF floor control server:\n1.\tshall indicate to the interface towards the MCPTT client that the general state machine is now 'G: Floor Idle'; and\n2.\tshall enter the 'G: Idle' state as specified in the clause 6.3.4.3.2.\nOn expiry of timer T1 (End of RTP media) assigned to the MCPTT floor participant for which a Floor Revoke message has been sent, the floor control arbitration logic in the IWF floor control server:\n1.\tshall stop timer T3 (Stop talking grace); and\n2.\tif the floor is now empty; shall enter the 'G: Floor Idle' state as specified in the clause 6.3.4.3.2.\nOn expiry of timer T1 (End of RTP media) assigned to a participant different than the MCPTT floor participant for which a Floor Revoke message has been sent, the floor control arbitration logic in the IWF floor control server:\n1.\tshall stop forwarding related RTP media packets;\n2.\tshall stop timer T2 (Stop talking) for the MCPTT floor participant for which timer T1 (End of RTP media) expired, if running; and\n3.\tshall stop timer T20 (Granted re-send) for the participant, if running.\nThis clause describes the actions to be taken in all states defined for the general state diagram with the exception of the 'Start-stop' state.\nThis clause is used by the floor control arbitration logic in the IWF floor control server when an MCPTT call is released.\nUpon receiving an MCPTT call release step 1 request from the application and signalling plane or upon determining that a user homed in the IWF has released the call, the floor control arbitration logic in the IWF floor control server:\n1.\tshall request the media distributor to stop sending RTP media packets to MCPTT media endpoints; and\n2.\tshall enter the 'Releasing' state.\nUpon receiving an instruction from the application and signalling plane to merge the ongoing group call with other group calls, the IWF floor control server:\n1.\tshall perform the actions in clause 6.5.2.3; and\n2.\tshall enter the 'Start-stop' state.\nThe floor control arbitration logic in the IWF floor control server uses this state while waiting for the application and signalling plane to finalize the disconnection of an MCPTT call.\nUpon receiving an MCPTT call release step 2 request from the application and signalling plane, the floor control arbitration logic in the IWF floor control server:\n1.\tshall release all resources reserved in the media plane including the instances used for the 'Floor control server state transition diagram for general floor control operation', and 'Floor control server state transition diagram for basic floor control operation towards the floor participant' state machines and any running timers associated with the state machines; and\n2.\tshall enter the 'Start-stop' state.\nThe floor control arbitration logic in the IWF floor control server uses this state while waiting for all invited constituent MCPTT groups to reply with a final SIP response.\nThere are no timers running in this state. The floor control arbitration logic is relying on SIP timers in the signalling and application plane.\nWhen entering this state, the floor control arbitration logic:\n1.\tshall set the general state to the 'G: Initialising' state.\nUpon receiving an indication from the application and signalling plane that a floor request is received from one of the invited constituent MCPTT groups in an application/vnd.3gpp.mcptt-floor-request+xml MIME body, the floor control arbitration logic:\n1.\tshall cache the application/vnd.3gpp.mcptt-floor-request+xml MIME body; and\n2.\tremain in the 'G: Initialising' state.\nUpon receiving an indication from the application and signalling plane that all invited constituent MCPTT groups have sent a final SIP response, the floor control arbitration logic:\n1.\tif at least one application/vnd.3gpp.mcptt-floor-request+xml MIME body exists with the <floor-type> element set to \"general\":\na.\tshall select the floor participant with the highest priority as described in clause 4.1.1.4:\ni.\tamong the cached application/vnd.3gpp.mcptt-floor-request+xml MIME bodies with the <floor-type> element set to \"general\"; and\nii.\tthe floor participant initialising the temporary group session as described in clause 4.1.1.4, if the floor participant initialising the temporary group session negotiated implicit floor request as specified in clause 14;\nb.\tshall send a Floor Revoke message to all MCPTT floor participants in the cached application/vnd.3gpp.mcptt-floor-request+xml MIME body with the <floor-type> element set to \"general\" that are not granted the permission to send media. The Floor Revoke message:\ni.\tshall include the <Reject Cause> value set to '4' (Media Burst pre-empted) in the Reject Cause field;\nii.\tshall include information taken from the <track-info> element in the cached application/vnd.3gpp.mcptt-floor-request+xml MIME body with the <floor-type> element set to \"general\" in the Track Info field; and\niii.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nNOTE 1:\tHow the IWF informs IWF media endpoints of the floor revoke is out of scope of the present document.\nc.\tif the floor participant selected to be granted the floor is in one of invited constituent MCPTT groups:\ni.\tshall convert the <track-info> element to a format of a Track Info field and cache the Track Info field associated with the floor control server state transition diagram for 'general floor control operation'; and\nii.\tshall enter the 'G: Taken' state as specified in the clause 6.3.4.4.2 using the selected floor participant as the requesting floor participant;\n2.\tif at least one application/vnd.3gpp.mcptt-floor-request+xml MIME body exists with the <floor-type> element set to \"dual\":\na.\tshall select the floor participant with the highest priority as described in clause 4.1.1.4 among the cached application/vnd.3gpp.mcptt-floor-request+xml MIME bodies with the <floor-type> element set to \"dual\"; and\nb.\tshall send a Floor Revoke message to all floor participants in the cached application/vnd.3gpp.mcptt-floor-request+xml MIME body with the <floor-type> element set to \"dual\" that are not granted the permission to send media. The Floor Revoke message:\ni.\tshall include the <Reject Cause> value set to '4' (Media Burst pre-empted) in the Reject Cause field;\nii.\tshall include information taken from the <track-info> element in the cached application/vnd.3gpp.mcptt-floor-request+xml MIME body with the <floor-type> element set to \"general\" in the Track Info field;\niii.\tshall include the Floor Indicator with the G-bit set to '1' (Dual floor);\niv.\tshall convert the <track-info> element to a format of a Track Info field and cache the Track Info field associated with floor control server state transition diagram for 'dual floor control operation'; and\nv.\tshall enter the 'D: Floor Taken' state as specified in the clause 6.3.6.3.2 using the selected floor participant as the requesting floor participant; and\nNOTE 2:\tHow the IWF informs IWF media endpoints of the floor revoke is out of scope of the present document.\n3.\tif no cached application/vnd.3gpp.mcptt-floor-request+xml MIME with the <floor-type> element set to \"general\" body exists:\na.\tif an implicit floor request is negotiated as described in clause 14 when the temporary group session was established, shall enter the 'G: Taken' state as specified in the clause 6.3.4.4.2; and\nb.\tif an implicit floor request is not negotiated as described in clause 14 when the temporary group session was established, shall enter the 'G: Idle' state as specified in the clause 6.3.4.3.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.5\tFloor control server state transition diagram for basic floor control operation towards the floor participant",
                            "text_content": "The floor control interface towards the MCPTT client in the IWF floor control server shall behave according to the state diagram and state transitions specified in this clause.\nEditor's Note:\tprocedures for the IWF performing the non-controlling role are FFS.\nThe description of the floor control interface towards an IWF media endpoint is part of the general floor control server state diagram and state transitions specified in clause 6.3.4.\nFigure 6.3.5.1-1 shows the states and state transitions for an associated floor participant in the floor control server.\n\nFigure 6.3.5.1-1 illustrates the state transition diagram for basic floor control operation towards the floor participant, depicting the control server's progression through various states. The diagram showcases the server's interaction with the floor participant, highlighting the communication flow and the necessary steps to execute commands effectively. The visual representation emphasizes the synchronization and coordination between the control server and the floor participant, ensuring seamless operation within the building automation system.\nFigure 6.3.5.1-1: Floor control server state transition diagram for basic floor control operation towards the floor participant\nThe floor control interface towards the MCPTT client in the IWF floor control server shall create one instance of the 'basic floor control operations' state machine towards the MCPTT client for every floor participant served by the IWF floor control server as follows:\n1.\tFor pre-arranged group call in case of an originating MCPTT call, the 'basic floor control operation towards the floor participant' state machine shall be created when the MCPTT server sends the SIP 200 (OK) response towards the originating MCPTT client.\n2.\tFor pre-arranged group call in case of a terminating MCPTT call, the 'basic floor control operation towards the floor participant' state machine shall be created when the IWF floor control server receives the SIP 200 (OK) response.\n3.\tFor chat group call the 'basic floor control operation state machine towards the floor participant' shall be created when the MCPTT server sends the SIP 200 (OK) response to the received initial SIP INVITE request.\nThe floor participant associated to the 'basic floor control operation towards the floor participant' state machine is here referred to as the \"associated floor participant\".\nThe external inputs to the state machine are:\n1.\tdirectives coming from the floor control arbitration logic;\n2.\tfloor messages sent by the floor participants;\n3.\tmedia; and\n4.\tin certain cases, SIP messages used for call handling.\nIf floor control messages or RTP media packets arrives in a state where there is no procedure specified in the following clauses, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall discard the floor control message;\n2.\tshall request the network media interface in the MCPTT server to discard any received RTP media packet; and\n3.\tshall remain in the current state.\nState details are explained in the following clauses.\nWhen a new instance of the 'basic floor control operations towards the floor participant' state machine is created, before any floor control related input is applied, the state machine is in the 'Start-stop' state. Similarly, when the call is released the state machine shall return to the Start-Stop state.\nAn association between the IWF floor control server and a floor participant in the MCPTT client is created, when the state machine is created; and\n1.\tin case of an originating MCPTT call, when the MCPTT server sends the SIP 200 (OK) response to the originating MCPTT client; and\n2.\tin case of a terminating MCPTT call, when the IWF floor control server receives the SIP 200 (OK) response sent from the terminating MCPTT client.\nWhen a SIP Session is established and if:\n1.\tthe session is not a temporary group call session; or\n2.\tthe session is a temporary group call session and the associated floor participant is an invited MCPTT client (i.e. not a constituent MCPTT group);\nthen:\nNOTE 1:\tA MCPTT group call is a temporary group session when the <on-network-temporary> element is present in the <list-service> element as specified in 3GPP TS 24.481 [12].\n1.\tif an MCPTT client initiates an MCPTT call with an implicit floor request, and the MCPTT call does not exist yet, the floor control interface towards the MCPTT client in the IWF floor control server:\na.\tshall initialize a general state machine as specified in clause 6.3.4.2.2; and\nNOTE 2:\tIn the clause 6.3.4.2.2 the 'general floor control operation' state machine will continue with the initialization of the 'general floor control operation' state machine.\nb.\tshall enter the state 'U: permitted' as specified in the clause 6.3.5.5.2;\n2.\tif the associated MCPTT client rejoins an ongoing MCPTT call without an implicit floor request or initiates or joins a chat group call without an implicit floor request or attempts to initiate an already existing MCPTT call without an implicit floor request, and\na.\tif an MCPTT call already exists but no MCPTT client has the permission to send a media, the floor control interface towards the MCPTT client in the IWF floor control server:\ni.\tshould send a Floor Idle message to the MCPTT client. The Floor Idle message:\nA.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1; and\nB.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nii.\tshall enter the state 'U: not permitted and Floor Idle' as specified in the clause 6.3.5.5.2;\nb.\tif an MCPTT call is initiated, the floor control interface towards the MCPTT client in the IWF floor control server:\ni.\tshall enter the state 'U: not permitted and Floor Idle' as specified in the clause 6.3.5.5.2; and\nii.\tshall initialize a general state machine as specified in clause 6.3.4.2.2; and\nNOTE 3:\tIn the clause 6.3.4.2.2 the general state machine will continue with the initialization of the general state machine.\nc.\tif another MCPTT client has the permission to send a media, the floor control interface towards the MCPTT client in the IWF floor control server:\ni.\tshould send a Floor Taken message to the MCPTT client. The Floor Taken message:\nA.\tshall include the granted MCPTT user's MCPTT ID in the Granted Party's Identity field if privacy is not requested;\nB.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1;\nC.\tif the session is a broadcast group call, shall include the Permission to Request the floor field set to '0';\nD.\tif the session is not a broadcast group call, may include the Permission to Request the floor field set to '1'; and\nE.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications\nii.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2;\n3.\tif the associated floor participant attempts to initiate an already existing MCPTT call with an implicit floor request, and\na.\tif no MCPTT client has the permission to send media, the floor control interface towards the MCPTT client in the IWF floor control server:\ni.\tshall process the implicit floor request as if a Floor Request message was receive as specified in clause 6.3.4.3.3; and\nii.\tshall enter the state 'U: permitted' as specified in the clause 6.3.5.5.2;\nb.\tif the MCPTT client negotiated support of queueing floor requests as specified in clause 14 and if another MCPTT client has the permission to send media, the floor control interface towards the MCPTT client in the IWF floor control server:\ni.\tshall set the priority level to the negotiated maximum priority level that the MCPTT client is permitted to request, except for pre-emptive priority, when high priority is used;\nNOTE 4:\tThe maximum floor priority the floor participant is permitted to request is negotiated in the \"mc_priority\" fmtp attribute as specified in clause 14.\nNOTE 5:\tThe initial implicit floor request will not result in pre-emption when an MCPTT client is joining an ongoing MCPTT call. If the MCPTT client wants to pre-empt the current MCPTT client that is sending media, an explicit floor request with pre-emptive floor priority is required.\nii.\tshall insert the MCPTT client into the active floor request queue to the position immediately following all queued floor requests with the same floor priority;\niii.\tshall send a Floor Queue Position Info message to the MCPTT client. The Floor Queue Position Info message:\nA\tshall include the queue position and floor priority in the Queue Info field; and\nB.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\niv.\tshould send a Floor Queue Position Info message with the updated status to the MCPTT clients in the active floor request queue which negotiated queueing of floor requests as specified in clause 14, which have requested the queue status, whose queue position has been changed since the previous Floor Queue Position Info message and which is not the joining MCPTT client. The Floor Queue Position Info message:\nA\tshall include the queue position and floor priority in the Queue Info field; and\nB.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nv.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2; and\nc.\tif the MCPTT client did not negotiate queueing of floor requests and if another MCPTT client has the permission to send a media, the floor control interface towards the MCPTT client in the IWF floor control server:\ni.\tshall send a Floor Taken message to the MCPTT client. The Floor Taken message:\nA.\tshall include the granted MCPTT user's MCPTT ID in the Granted Party's Identity field if privacy is not requested;\nB.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1;\nC.\tif the session is a broadcast group call, shall include the Permission to Request the floor field set to '0';\nD.\tif the session is not a broadcast group call, may include the Permission to Request the floor field set to '1'; and\nE.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nii.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2; and\n4.\tif the MCPTT client is invited to the MCPTT call and\na.\tif another MCPTT client has permission to send a media, the floor control interface towards the MCPTT client in the IWF floor control server:\ni.\tshould send a Floor Taken message to the MCPTT client. The Floor Taken message:\nA.\tshall include the granted MCPTT user's MCPTT ID in the Granted Party's Identity field if privacy is not requested;\nB.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1;\nC.\tif the session is a broadcast group call, shall include the Permission to Request the floor field set to '0';\nD.\tif the session is not a broadcast group call, may include the Permission to Request the floor field set to '1'; and\nE.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nii.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2; and\nb.\tif no other MCPTT client has the permission to send a media; the floor control interface towards the MCPTT client in the IWF floor control server:\ni.\tshould send a Floor Idle message to the MCPTT client. The Floor Idle message:\nA.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nB.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nii.\tshall enter the 'U: not permitted and Floor Idle' state as specified in the clause 6.3.5.3.2.\nWhen a SIP Session is established and if the session is a temporary group call session and,\n1.\tif the associated floor participant is a constituent MCPTT group; or\n2.\tif the associated floor participant is the initiator of the temporary group session;\nthen the floor control interface towards the MCPTT client:\n1.\tshall initialize a general state machine as specified in clause 6.3.4.2.2, if not already initiated; and\n2.\tshall enter the 'U: not permitted and initiating' state as specified in clause 6.3.5.10.2.\nThe floor control interface towards the MCPTT client in the IWF floor control server uses this state when the associated floor participant is not permitted to send media.\nWhen entering this state, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif a Track Info field is stored, shall remove the Track Info field from the storage; and\n2.\tshall set the state for the associated floor participant to 'U: not permitted and Floor Idle'.\nWhen a Floor Taken message is received from the floor control server arbitration logic, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Taken message to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Taken message to '1' (Acknowledgment is required) as described in clause 8.3.2, and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2.\nUpon receiving a Floor Request message from the associated floor participant, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif the session is not a broadcast group call or if the session is a broadcast group call and the associated floor participant is the initiator of the broadcast group call, shall forward the Floor Request message to the floor control server arbitration logic;\nNOTE 1:\tThe Floor Request message can contain a Floor Indicator field indicating that the floor request is an attempt to upgrade a group call to a broadcast group call. If the floor control arbitration logic accepts the floor request, the ongoing group call will be upgraded accordingly by the Floor Granted message and, for other participants, by the Floor Taken message.\nNOTE 2\tInitiating a broadcast group call is done in the application and signalling plane using SIP. Initiating or upgrading a call to an emergency call or an imminent peril call is done in the application and signalling plane using SIP.\n2.\tif the session is a broadcast group call and the associated floor participant is not the initiator of the broadcast group call, shall send a Floor Deny message to the associated floor participant. The Floor Deny message:\na.\tshall include in the Reject Cause field the <Reject Cause> value cause #5 (Receive only);\nb.\tmay include in the Reject Cause field an additional text string explaining the reason for rejecting the floor request in the <Reject Phrase> value;\nc.\tmay set the first bit in the subtype of the Floor Deny message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE 3:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\nd.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n3.\tshall remain in the 'U: not permitted and Floor Idle' state.\nWhen a Floor Granted message is received from the floor control arbitration logic in the IWF, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Granted messages to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Granted message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall enter the state 'U: permitted' as specified in clause 6.3.5.5.2.\nWhen a Floor Deny message is received from the floor control arbitration logic in the IWF, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Deny messages to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Deny message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall remain in the 'U: not permitted and Floor Idle' state.\nUpon receiving a Floor Release message from the associated floor participant, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif the first bit in the subtype of the Floor Release message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '4' (Floor Release); and\nb.\tshall include the Source field set to '2' (the controlling MCPTT function is the source);\n2.\tshall send a Floor Idle message to the associated floor participant. The Floor Idle message:\na.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1;\nb.\tmay set the first bit in the subtype of the Floor Idle message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n3.\tif a Track Info field is included in the Floor Release message, shall use the topmost <Participant Reference> value and the SSRC in the received Floor Release message to check if the floor participant has a queued floor request;\n4.\tif a no Track Info field is included in the Floor Release message, shall use the SSRC in the received Floor Release message to check if the floor participant has a queued floor request;\n5\tif the floor participant has a floor request in the queue, shall remove the queued floor request from the queue; and\n6.\tshall remain in the state 'U: not permitted and Floor Idle' state.\nUpon receiving an indication from the network media interface that RTP media packets are received with payload from the associated floor participant and if Floor Release message was received in the previous 'U: permitted' state, the floor control interface towards the MCPTT client in the IWF floor control server:\nNOTE:\tReception of unauthorized RTP media packets can only happen if the associated floor participant is in an MCPTT client. If the associated floor participant is a floor control server interface in a non-controlling MCPTT function of an MCPTT group, the unauthorized RTP media packets are handled in the non-controlling MCPTT function.\n1.\tshall request the network media interface in the MCPTT server to not forward the received RTP media packets to the media distributor in the MCPTT server;\n2.\tshall send a Floor Revoke message to the associated floor participant. The Floor Revoke message:\na.\tshall include the Reject Cause field with the <Reject Cause> value set to #3 (No permission to send a Media Burst); and\nb.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n3.\tshall enter the 'U: not permitted but sends media' state as specified in the clause 6.3.5.7.2.\nWhen an ongoing session is upgraded to an emergency group call and when the application and signalling plane indicates that a subsequent SDP offer included the \"mc_implicit_request\" fmtp attribute as described in clause 14, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall indicate to the floor control server arbitration logic that an implicit floor request is received due to an upgrade to an emergency group call; and\n2.\tshall remain in the 'U: not permitted and Floor Idle' state.\nWhen receiving a Floor Idle message from the floor control server arbitration logic in the MCPTT server, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Idle message to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Idle message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall remain in the 'U: not permitted and Floor Idle' state.\nThe floor control interface towards the MCPTT client in the IWF floor control server uses this state when another MCPTT client (i.e. not the associated floor participant) has been given permission to send media.\nIn this state RTP media packets received from the media distributor in the MCPTT server are forwarded to the associated floor participant by the network media interface in the MCPTT server.\nWhen entering this state, the IWF floor control server:\n1.\tif a Track Info field is stored, shall remove the Track Info field from the storage; and\n2.\tshall set the state to 'U: not permitted and Floor Taken'.\nWhen receiving a Floor Idle message from the floor control server arbitration logic in the MCPTT server, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Idle message to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Idle message to '1' (Acknowledgment is required) as described in clause 8.3.2;\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\t if an indication is stored that the participant is listening to media from two sources, i.e. dual floor control is applied,\na.\tshall remain in the 'U: not permitted and Floor Taken' state; and\nb.\tshall remove the indication that a participant is listening to media from two sources; and\n4.\tif an indication for dual floor control is not stored, shall enter the 'U: not permitted and Floor Idle' state as specified in the clause 6.3.5.3.2.\nUpon receiving a Floor Request message from the associated floor participant, if the group is configured for audio cut-in floor control, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Request message to the floor control server arbitration logic; and\n2.\tshall remain in the 'U: not permitted and Floor Taken' state.\nUpon receiving a Floor Request message, without a Floor Indicator field or with the Floor Indicator field included where the D-bit (Emergency call) and the E-bit (Imminent peril call) are set to '0', from the associated floor participant, and if the MCPTT client did not negotiate queueing of floor requests or did not include a priority in the \"mc_priority\" fmtp attribute as specified in clause 14, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall send a Floor Deny message to the associated floor participant. The Floor Deny message:\na.\tshall include in the Reject Cause field the <Reject Cause> value cause #1 (Another MCPTT client has permission);\nb.\tmay include in the Reject Cause field an additional text string explaining the reason for rejecting the floor request in the <Reject Phrase> value;\nc.\tif the Floor Request included a Track Info field, shall include the received Track Info field; and\nd.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n2.\tmay set the first bit in the subtype of the Floor Deny message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE 1:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall remain in the 'U: not permitted and Floor Taken' state.\nUpon receiving a Floor Request message from the associated floor participant and the session is a broadcast group call, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall send a Floor Deny message to the associated floor participant. The Floor Deny message:\na.\tshall include in the Reject Cause field the <Reject Cause> value cause #5 (Receive only);\nb.\tmay include in the Reject Cause field an additional text string explaining the reason for rejecting the floor request in the <Reject Phrase> value; and\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n2.\tmay set the first bit in the subtype of the Floor Deny message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE 2:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall remain in the 'U: not permitted and Floor Taken' state.\nUpon receiving a Floor Request message from the associated floor participant and if the MCPTT client negotiated support of queueing of floor requests or included a floor priority in the \"mc_priority\" or both as described in specified in clause 14 and according to local policy, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall determine the effective priority level as described in clause 4.1.1.4 by using the following parameters:\na.\tthe floor priority shall be:\ni.\tthe lower of the floor priority included in Floor Request message and the negotiated maximum floor priority that the MCPTT client is permitted to request, if the MCPTT client negotiated floor priority \"mc_priority\" and floor priority is included in the Floor Request message;\nii.\tthe receive only floor priority, if the MCPTT client negotiated floor priority in the \"mc_priority\" fmtp attribute and if the negotiated maximum floor priority that the MCPTT client is permitted to request is \"receive only\";\niii.\tthe default priority, if the MCPTT client negotiated floor priority in the \"mc_priority\" fmtp attribute, if the negotiated maximum floor priority that the MCPTT client is permitted to request is not receive only and if the floor priority is not included in the Floor Request message; and\niv.\tthe default priority, if the MCPTT client did not negotiate floor priority in the \"mc_priority\" fmtp attribute; and\nb.\tthe type of the call shall be\ni.\tif the Floor Indicator field is included in the message and the D-bit (Emergency call bit) is set to '1', determined to be an emergency call;\nii.\tif the Floor Indicator field is included in the message and the E-bit (Imminent peril call) is set to '1', determined to be an imminent peril call; and\niii.\tif the Floor Indicator field is not included in the message or the Floor Indicator field is included and neither the D-bit (Emergency call bit) nor the E-bit (Imminent peril call) is set to '1', determined to be a normal call;\n2.\tif the effective priority is \"receive only\", the floor control interface towards the MCPTT client in the IWF floor control server:\na.\tshall send a Floor Deny message to the floor participant. The Floor Deny message:\ni.\tshall include in the Reject Cause field the <Reject Cause> value cause #5 (Receive only) ;\nii.\tmay include in the Reject Cause field an additional text string explaining the reason for rejecting the floor request in the <Reject Phrase> value;\niii.\tif the Floor Request included a Track Info field, shall include the received Track Info field; and\niv.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nb.\tshall remain in the 'U: not permitted and Floor Taken' state;\n3.\tif\na.\ta Track Info field is included in the Floor Request message, shall use the topmost <Participant Reference> value and the SSRC in the received Floor Request message to check if the floor participant has a queued floor request; or\nb.\ta Track Info field is not included in the Floor Request message, shall use the SSRC in the received Floor Request message to check if the floor participant has a queued floor request;\n4.\tif the floor participant already has a queued floor request with the same effective priority level, the floor control interface towards the MCPTT client in the IWF floor control server:\na.\tshall send a Floor Queue Position Info message to the requesting MCPTT client, if the MCPTT client negotiated support of queueing of floor requests as specified in clause 14. The Floor Queue Position Info message:\ni.\tshall include the queue position and floor priority in the Queue Info field;\nii.\tif the Floor Request included a Track Info field, shall include the received Track Info field; and\niii.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nb.\tshall remain in the 'U: not permitted and Floor Taken' state\n5.\tif the effective priority level is pre-emptive and there are no other pre-emptive requests in the active floor request queue and the effective priority level of the current MCPTT client with permission to send a media is not the pre-emptive priority, the floor control interface towards the MCPTT client in the IWF floor control server:\na.\tshall forward the Floor Request message to the floor control server arbitration logic indicating that a Floor Request message with pre-emptive priority is received; and\nb.\tshall remain in the 'U: not permitted and Floor Taken' state\nNOTE 3:\tThe Floor control server arbitration logic initiates revoking the permission to send media towards the current MCPTT client with the permission to send media as specified in the clause 6.3.4.4.7;\n6.\tif the MCPTT client did not negotiate support of queueing of floor requests as specified in clause 14, the effective priority level is pre-emptive and either other pre-emptive request is queued or the effective priority level of the current MCPTT client with permission to send a media is the pre-emptive priority, the floor control interface towards the MCPTT client in the IWF floor control server:\na.\tshall send a Floor Deny message to the associated floor participant. The Floor Deny message:\ni.\tshall include in the Reject Cause field the <Reject Cause> value cause #1 (Another MCPTT client has permission);\nii.\tmay include in the Reject Cause field an additional text string explaining the reason for rejecting the floor request in the <Reject Phrase> value;\niii.\tif the Floor Request included a Track Info field, shall include the received Track Info field; and\niv.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nb.\tshall remain in the 'U: not permitted and Floor Taken' state;\n7.\tif the MCPTT client did not negotiate \"queueing\" and the effective priority level is not pre-emptive, the floor control interface towards the MCPTT client in the IWF floor control server:\na.\tshall send a Floor Deny message to the associated floor participant. The Floor Deny message:\ni.\tshall include in the Reject Cause field the <Reject Cause> value cause #1 (Another MCPTT client has permission);\nii.\tmay include in the Reject Cause field an additional text string explaining the reason for rejecting the floor request in the <Reject Phrase> value;\niii.\tif the Floor Request included a Track Info field, shall include the received Track Info field; and\niv.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nb.\tshall remain in the 'U: not permitted and Floor Taken' state; and\n8.\tif the MCPTT client negotiated support of queueing of floor requests as specified in clause 14 and the effective priority level is not pre-emptive, the floor control interface towards the MCPTT client in the IWF floor control server:\na.\tshall insert the MCPTT client into the active floor request queue, if not inserted yet, or update the position of the MCPTT client in the active floor request queue, if already inserted, to the position immediately following all queued requests at the same effective priority level;\nb.\tthe IWF floor control server shall send a Floor Queue Position Info message to the floor participant. The Floor Queue Position Info message:\ni.\tshall include the queue position and floor priority in the Queue Info field;\nii.\tif the Floor Request included a Track Info field, shall include the received Track Info field; and\niii.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\nc.\tshall remain in the 'U: not permitted and Floor Taken' state; and\nd.\tmay set the first bit in the subtype of the Floor Queue Position message to '1' (Acknowledgment is required) as described in clause 8.3.2.\nNOTE 4:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\nUpon receiving a Floor Release message from the associated floor participant and if the MCPTT client did not negotiate support of queueing of floor requests or included a floor priority in the \"mc_priority\" fmtp attribute as specified in clause 14, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif the first bit in the subtype of the Floor Release message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '4' (Floor Release); and\nb.\tshall include the Source field set to '2' (the controlling MCPTT function is the source);\n2.\tshall send a Floor Taken message to the associated floor participant. The Floor Taken message:\na.\tshall include the granted MCPTT user's MCPTT ID in the Granted Party's Identity field if privacy is not requested;\nb.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1;\nc.\tshall include the Permission to Request the floor field set to '0', if the floor participants are not allowed to request the floor;\nd.\tif the Floor Release message included a Track Info field, shall include the received Track Info field;\ne.\tmay set the first bit in the subtype of the Floor Taken message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE 1:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\nf.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n3.\tshall remain in the 'U: not permitted and Floor Taken' state.\nUpon receiving a Floor Release message from the associated floor participant and if the MCPTT client negotiated support of queueing of floor requests as specified in clause 14, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif the first bit in the subtype of the Floor Release message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '4' (Floor Release); and\nb.\tshall include the Source field set to '2' (the controlling MCPTT function is the source);\n2.\tif\na.\ta Track Info field is included in the Floor Release message, shall use the topmost <Participant Reference> value and the SSRC in the received Floor Release message to check if the floor participant has a queued floor request; or\nb.\tif a Track Info field is not included in the Floor Release message, shall use the SSRC in the received Floor Release message to check if the floor participant has a queued floor request;\n3.\tshall remove the MCPTT client from the active floor request queue, if the MCPTT client was in the active floor request queue;\n4.\tshall send a Floor Taken message to the associated floor participant. The Floor Taken message:\na.\tshall include the granted MCPTT user's MCPTT ID in the Granted Party's Identity field if privacy is not requested;\nb.\tif the session is a broadcast group call, shall include the Permission to Request the floor field set to '0';\nc.\tif the session is not a broadcast group call, may include the Permission to Request the floor field set to '1';\nd.\tif a Track Info field is included in the Floor Release message, shall include the received Track Info field;\ne.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nf.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n5.\tmay set the first bit in the subtype of the Floor Taken message is set to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE 2:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n6.\tshall remain in the 'U: not permitted and Floor Taken' state.\nUpon receiving an indication from the network media interface in the MCPTT server that RTP media packets with payload are received from the associated floor participant, the floor control interface towards the MCPTT client in the IWF floor control server:\nNOTE:\tReception of unauthorized RTP media packets can only happen if the associated floor participant is in an MCPTT client. If the associated floor participant is a floor control server interface in a non-controlling MCPTT function of an MCPTT group, the unauthorized RTP media packets are handled in the non-controlling MCPTT function.\n1.\tshall request the network media interface to not forward the RTP media packets to the media distributor in the MCPTT server;\n2.\tshall send a Floor Revoke message to the associated floor participant. The Floor Revoke message:\na.\tshall include the Reject Cause field with the Reject Cause value set to #3 (No permission to send a Media Burst); and\nb.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n3.\tshall enter the 'U: not permitted but sends media' state as specified in the clause 6.3.5.7.2.\nUpon receiving a Floor Queue Position Request message from the associated floor participant, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall send the Floor Queue Position Info message. The Floor Queue Position Info message:\na.\tshall include the queue position and floor priority in the Queue Info field;\nb.\tif a Track Info field is included in the Floor Queue Position Info message, shall include the received Track Info field;\nc.\tmay include the first bit in the subtype of the Floor Queue Position Info message set to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\nd.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n3.\tshall remain in the 'U: not permitted and Floor Taken' state.\nWhen an ongoing session is upgraded to an emergency group call and when the application and signalling plane indicates that a subsequent SDP offer included the \"mc_implicit_request\" fmtp attribute as specified in clause 14, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall indicate to the floor control server arbitration logic that an implicit floor request is received due to an upgrade to an emergency group call; and\n2.\tshall remain in the 'U: not permitted and Floor Taken' state.\nWhen a Floor Granted message is received from the floor control arbitration logic in the IWF, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Granted messages to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Granted message to '1' (Acknowledgment is required) as described in clause 8.3.2;\nNOTE 1:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tif the G-bit in the Floor Indicator is set to '1' (Dual floor) shall store an indication that the participant is overriding without revoke; and\nNOTE 2:\tThe G-bit in the Floor Indicator is set to '1' as specified in clause 6.3.6.3.2.\n4.\tshall enter the state 'U: permitted' as specified in clause 6.3.5.5.2.\nWhen a Floor Taken message is received from the floor control arbitration logic in the IWF, if the G-bit in the Floor Indicator is set to '1' (Dual floor) the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Taken message to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Taken message to '1' (Acknowledgment is required) as described in clause 8.3.2;\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall store an indication that the participant is listening to media from two sources; and\n4.\tshall remain in the 'U: not permitted and Floor Taken' state.\nMulti-talker is not supported in the present document.\nThe floor control interface towards the MCPTT client in the IWF floor control server uses this state when the associated floor participant has been given permission to send media.\nWhen entering this state, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall set the state for the associated floor participant to 'U: permitted'.\nUpon receiving a Floor Release message from the associated floor participant, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif the first bit in the subtype of the Floor Release message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '4' (Floor Release); and\nb.\tshall include the Source field set to '2' (the controlling MCPTT function is the source);\n2.\tif an indication that the participant is overriding without revoke is stored,\na.\tshall forward the Floor Release message to the 'dual floor control operation' state machine of the floor control arbitration logic in the IWF with the first bit in the subtype of the Floor Release message set to '0' (Acknowledgment is not required), if not already set;\nb.\tshall remove the indication that the participant is overriding without revoke; and\nc.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2;\n3.\tif an indication that the participant is overridden without revoke is stored,\na.\tshall forward the Floor Release message to the general floor control operation state machine of the floor control arbitration logic in the IWF with the first bit in the subtype of the Floor Release message set to '0' (Acknowledgment is not required), if not already set;\nb.\tshall remove the indication that the participant is overridden without revoke; and\nc.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2; and\n4.\tif no indication is stored:\na.\tshall forward the Floor Release message to the general floor control operation state machine of the floor control arbitration logic in the IWF with the first bit in the subtype of the Floor Release message set to '0' (Acknowledgment is not required), if not already set; and\nb.\tshall remain in the 'U: permitted' state.\nUpon receiving the Floor Idle message from the floor control server arbitration logic in the MCPTT server, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif the G-bit in the Floor Indicator is set to '1' (Dual Floor) and an indication that the participant is overridden without revoke is stored\na.\tshall send Floor Idle message to the associated floor participant;\nb.\tshall remove the indication that a participant is overridden without revoke; and\nc.\tshall remain in 'U: permitted state';\n2.\tif no indication is stored shall enter the 'U: not permitted and Floor Idle' state as specified in the clause 6.3.5.3.2; and\n3.\tif an indication that the participant is overriding without revoke is stored\na.\tshall send Floor Idle message to the associated floor participant;\nb.\tshall remove the indication that a participant is overriding without revoke; and\nc.\tshall remain in 'U: permitted state'.\nWhen receiving the Floor Revoke message from the floor control server arbitration logic in the MCPTT server, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Revoke message to the floor participant;\n2.\tif the Floor Revoke message includes the Track Info field, shall store the Track Info field; and\n3.\tshall enter the state 'U pending Floor Revoke' as specified in the clause 6.3.5.6.2.\nUpon receiving an indication from the network media interface in the MCPTT server that RTP media packets with payload are received from the associated floor participant, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif an indication that the participant is overriding without revoke is not stored,\na.\tshall request the network media interface in the MCPTT server to forward RTP media packets to the media distributor in the MCPTT server.\nUpon receiving a Floor Request message from the associated floor participant, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the Floor Request message to the floor control server arbitration logic in the MCPTT server; and\nb.\tshall instruct the media distributor to act as in clause 6.3.4.4.5.\n2.\tif an indication that the participant is overriding without revoke is stored,\na.\tshall request the network media interface in the MCPTT server to forward RTP media packets to the media distributor in the MCPTT server; and\nb.\tshall instruct the media distributor to act as in clause 6.3.6.3.5; and\n3.\tshall remain in the 'U: permitted' state.\nWhen RTP packets are received from the media distributor, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward the RTP packet to the associated floor participant if the indication that the participant is overridden without revoke is stored;\n2.\tshall forward the RTP packet to the associated floor participant if the indication that the participant is overriding without revoke is stored; and\n3.\tshall remain in the 'U: permitted' state.\nWhen receiving the Floor Taken message from the floor control server arbitration logic in the MCPTT server with the G-bit in the Floor Indicator set to '1' (Dual Floor), the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall send the Floor Taken message to the associated floor participant;\n2.\tshall store an indication that the participant is overridden without revoke; and\n3.\tshall remain in the 'U: permitted' state.\nWhen receiving the Floor Taken message from the floor control server arbitration logic in the MCPTT server with the G-bit in the Floor Indicator set to '0' (Not dual floor), the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall send the Floor Taken message to the associated floor participant; and\n2.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2.\nMulti-talker is not supported in the present document.\nThe floor control interface towards the MCPTT client in the floor control server uses this state during the grace period after sending the Floor Revoke message.\nIn this state timer T8 (Floor Revoke) is running.\nWhen entering this state, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall start timer T8 (Floor Revoke); and\n2.\tshall enter the state 'U: pending Floor Revoke'.\nOn expiry of timer T8 (Floor Revoke) the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall retransmit the Floor Revoke message to the associated floor participant. The Floor Revoke message:\na.\tshall include the same Rejection Cause field and the same Floor Indicator field as in the previous sent Floor Revoke message;\n2.\tshall start timer T8 (Floor Revoke); and\n3.\tshall remain in the 'U: pending Floor Revoke' state.\nNOTE:\tThe number of times the IWF floor control server retransmits the Floor Revoke message and the action to take when the IWF floor control server gives up is an implementation option. However, it is recommended that the MCPTT client is disconnected from the MCPTT call when the IWF floor control server gives up.\nUpon receiving an RTP media packet with payload from the associated floor participant, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall forward RTP media packets to the media distributor; and\n2.\tshall remain in the 'U: pending Floor Revoke' state.\nUpon receiving a Floor Release message from the associated floor participant, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif the first bit in the subtype of the Floor Release message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '4' (Floor Release); and\nb.\tshall include the Source field set to '2' (the controlling MCPTT function is the source);\n2.\tif the G-bit in the Floor Indicator is set to '1' (Dual floor):\na.\tif the state in the 'general floor control operation' state machine is 'G: Taken':\ni.\tshall send a Floor Taken message to the associated floor participant. The Floor Taken message:\nA.\tshall include the granted MCPTT user's MCPTT ID in the Granted Party's Identity field of the permitted MCPTT client if privacy is not requested; and\nB.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nii.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2; and\nb.\tif the state in the 'general floor control operation' state machine is 'G: Idle':\ni.\tshall send a Floor Idle message to the associated floor participant;\nii.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\niii.\tshall enter the 'U: not permitted and Floor Idle' state as specified in the clause 6.3.5.3.2; and\n3.\tif the G-bit in the Floor Indicator is set to '0':\na.\tshall forward the Floor Release message to the floor control server arbitration logic; and\nb.\tshall remain in the state 'U: pending Floor Revoke'.\nUpon receiving a Floor Idle message from the floor control server arbitration logic in the MCPTT server, the floor control interface towards the MCPTT client in the IWF floor control server:\nNOTE 1:\tThe Floor Idle message is sent when timer T3 (Stop talking grace) expires and when timer T1 (End of RTP media) expires and when there are no queued floor requests.\n1.\tshall send the Floor Idle message to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Idle message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE 2:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall enter the 'U: not permitted and Floor Idle' state as specified in the clause 6.3.5.3.2.\nUpon receiving a Floor Taken message from the floor control server arbitration logic in the MCPTT server, the floor control interface towards the MCPTT client in the IWF floor control server:\nNOTE 1:\tThe Floor Taken message is sent when timer T3 (Stop talking grace) expires or when timer T1 (End of RTP media) expires and if there are queued floor requests.\n1.\tshall send the Floor Taken message to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Taken message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE 2:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.3.2.\nMulti-talker is not supported in the present document.\nThe floor control interface towards the MCPTT client in the floor control server uses this state when it receives RTP media packets from the MCPTT client and the MCPTT client is not permitted to send media.\nTimer T8 (Floor Revoke) is running in this state.\nWhen entering this state, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall start timer T8 (Floor Revoke); and\n2.\tshall enter the state 'U: not permitted but sends media'.\nIn this state the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall not request the network media interface in the MCPTT server to forward RTP media packets from the MCPTT client to the media distributor in the MCPTT server.\nOn expiry of timer T8 (Floor Revoke), the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall send a Floor Revoke message to the associated floor participant. The Floor Revoke message:\na.\tshall include in the Rejection Cause field the <Rejection Cause> value set to #3 (No permission to send a Media Burst); and\nb.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n2.\tshall restart timer T8 (Floor Revoke); and\n3.\tshall remain in the 'U: not permitted but sends media' state.\nNOTE:\tThe number of times the IWF floor control server retransmits the Floor Revoke message and the action to take when the IWF floor control server gives up is an implementation option. However, the recommended action is that the MCPTT client is disconnected from the MCPTT call.\nUpon receiving a Floor Release message, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tif the first bit in the subtype of the Floor Release message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '4' (Floor Release); and\nb.\tshall include the Source field set to '2' (the controlling MCPTT function is the source);\n2.\tif the general state is 'G: Floor Idle', the floor control interface towards the MCPTT client in the IWF floor control server:\na.\tshall send the Floor Idle message. The Floor Idle message:\ni.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1; and\nii.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nb.\tshall enter the 'U: not permitted and Floor Idle' state as specified in the clause 6.3.5.3.2; and\n3.\tif the general state is 'G: Floor Taken', the floor control interface towards the MCPTT client in the IWF floor control server:\na.\tshall send a Floor Taken message. The Floor Taken message:\ni.\tshall include the granted MCPTT user's MCPTT ID in the Granted Party's Identity field if privacy is not requested;\nii.\tif the session is a broadcast group call, shall include the Permission to Request the floor field set to '0';\niii.\tif the session is not a broadcast group call, may include the Permission to Request the floor field set to '1';\niv.\tmay include the first bit in the subtype of the Floor Taken message set to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\nv.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nc.\tshall enter the 'U: not permitted and Floor Taken' state as specified in the clause 6.3.5.4.2.\nReceiving the Floor Taken message from the floor control server arbitration logic in the MCPTT server with the I-bit in the Floor Indicator set to '1' (multi-talker) is not supported in the present document.\nMulti-talker is not supported in the present document.\nThis clause describes the actions to be taken in all states defined for the basic state diagram with the exception of the 'Start-stop' and 'Releasing' states.\nUpon receiving an MCPTT call release step 1 request from the application and signalling plane e.g. when the MCPTT call is going to be released or when the MCPTT client leaves the MCPTT call, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall stop sending floor control messages to the associated floor participant;\n2.\tshall request the network media interface to stop sending RTP media packets towards to the associated MCPTT client;\n3.\tshall ignore any floor control messages received from the associated floor participant;\n4.\tshall request the network media interface to stop forwarding RTP media packets from the associated MCPTT client to the media distributor in the MCPTT server;\n5.\tshall indicate to the floor control server arbitration logic in the MCPTT server that the MCPTT client has started to disconnect from the MCPTT call; and\n6.\tshall enter the 'Releasing' state.\nUpon receipt of an instruction to merge with another group due to the group regrouping function, the floor control interface towards the MCPTT client:\n1.\tshall create an instance of the 'floor participant interface state transition' as specified in clause 6.5.5;\n2.\tshall move information associated with the instance used for 'floor participant interface state transition' to the 'basic floor control operation towards the floor participant' state machine;\nNOTE:\t Which information that needs to be moved is an implementation option.\n3.\tshall enter the 'Start-stop' state and terminate the 'basic floor control operation towards the floor participant'' state machine associated with this floor participant and this MCPTT call;\n4.\tif the state was 'U: not permitted and Floor Idle', 'U: not permitted Floor Taken', 'U: pending Floor Revoke', 'U: not permitted and initiating' or 'U: not permitted but sends media':\na.\tshall enter the 'P: has no permission' state as specified in clause 6.5.5; and\nb.\tshall perform actions specified in clause 6.5.5.3; and\n5.\tif the state was 'U: permitted':\na.\tshall enter the 'P: has permission' state; and\nb.\tshall perform actions specified in clause 6.5.5.4.\nThe floor control interface towards the MCPTT client in the IWF floor control server uses this state while waiting for the application and signalling plane to finalize the release of the MCPTT call or finalizing the removal of the MCPTT client from the MCPTT call.\nUpon receiving an MCPTT call release step 2 request from the application and signalling plane, the floor control interface towards the MCPTT client in the IWF floor control server:\n1.\tshall request the network media interface to release all resources associated with this MCPTT client for this MCPTT call; and\n2.\tshall enter the 'Start-stop' state and terminate the 'basic floor control operation towards the floor participant'' state machine associated with this floor participant and this MCPTT call.\nThe floor control interface towards the MCPTT client uses this state when waiting for the floor control arbitration logic to finalize the initialisation of the state machine to be used for a temporary group session.\nDuring this state Floor Request messages can be received from the non-controlling MCPTT function. Any Floor Request message received will be added to the queue according to the priority of the floor request determine as described in clause 4.1.1.4.\nThe floor control interface towards the MCPTT client:\n1.\tshall set the state for the associated floor participant to 'U: not permitted and Initiating'.\nWhen a Floor Taken message is received from the floor control arbitration logic in the IWF, the floor control interface towards the MCPTT client:\n1.\tshall forward the Floor Taken messages to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Taken message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall enter the state 'U: not permitted and Floor Taken' as specified in clause 6.3.5.4.2.\nWhen receiving a Floor Idle message from the floor control server arbitration logic in the MCPTT server, the floor control interface towards the MCPTT client:\n1.\tshall forward the Floor Idle message to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Idle message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall enter the 'U: not permitted and Floor Idle' state as specified in the clause 6.3.5.3.2.\nUpon receipt of a Floor Request message, the floor control interface towards the MCPTT client:\n1.\tshall determine the effective priority level as described in clause 4.1.1.4;\n2.\tshall put the Floor Request message in the floor request queue according to the determined effective priority level;\n3.\tif the <Queueing Capability> value in the Track Info field is set to '1' (the floor participant in the MCPTT client supports queueing), shall send a Floor Queue Position Info message to the requesting non-Controlling MCPTT function, The Floor Queue Position Info message:\na.\tshall include the queue position and floor priority in the Queue Info field;\nb.\tshall include the received Track Info field; and\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n4\tif the <Queueing Capability> value in the Track Info field is set to '0' (the floor participant in the MCPTT client does not support queueing), shall send the Floor Deny message. The floor Deny message:\nNOTE:\tA Floor Request from a MCPTT client in a constituent group can be received without the queuing capability if a floor participant in an ongoing constituent MCPTT group request floor while the floor was idle during the merging process.\na.\tshall include in the Reject Cause field the <Reject Cause> value cause '1' (Another MCPTT client has permission);\nb.\tshall include the received Track Info field; and\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n5.\tshall remain in the 'U: not permitted and initiating' state.\nWhen a Floor Granted message is received from the floor control arbitration logic, the floor control interface towards the MCPTT client:\n1.\tshall forward the Floor Granted messages to the associated floor participant;\n2.\tmay set the first bit in the subtype of the Floor Granted message to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tshall enter the state 'U: permitted' as specified in clause 6.3.5.5.2.\nUpon receiving a Floor Release message from the associated floor participant, the floor control interface towards the MCPTT client:\n1.\tif the first bit in the subtype of the Floor Release message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '4' (Floor Release); and\nb.\tshall include the Source field set to '2' (the controlling MCPTT function is the source);\n2.\tshall use the topmost <Participant Reference> value and the SSRC in the Track Info field of the received Floor Release message to check if the floor participant has a queued floor request and if not, check if there is a floor request in one of the cached application/vnd.3gpp.mcptt-floor-request+xml MIME bodies;\n3.\tshall remove the MCPTT client from the active floor request queue or the cached application/vnd.3gpp.mcptt-floor-request+xml MIME body, if the MCPTT client was in the active floor request queue or in the application/vnd.3gpp.mcptt-floor-request+xml MIME body; and\n4.\tshall remain in the 'U: not permitted and initiating' state.\nMulti-talker is not supported in the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.6\tDual floor control",
                            "text_content": "Editor's Note:\tThe procedures of the IWF performing the non-controlling role are FFS.\nDual floor control is used when a floor participant requests floor with a pre-emptive floor priority allowing the floor control in clause 6.3.4 to continue without revoking the floor from the floor participant permitted to send media as specified in 3GPP TS 23.379 [5] clause 10.9.1.3.2.2.\nThe floor control server arbitration logic in the IWF floor control server shall behave according to the state diagram and state transitions specified in this clause.\nFigure 6.3.6.1-1 shows the 'dual floor control operation' states (D states) and the state transition diagram.\nFigure 6.3.6.1-1 illustrates the state transition diagram for 'dual floor control operation' within a building automation system. The diagram depicts the various states of a floor control server, including initialization, normal operation, and failure scenarios. Key components include the floor control server, sensors, actuators, and communication interfaces. The transition between states is managed by a central controller, ensuring seamless coordination and response to system events. The diagram emphasizes the importance of redundancy and fault tolerance in maintaining the building's environmental control systems.\nFigure 6.3.6.1-1: Floor control server state transition diagram for 'dual floor control operation'\nThe floor control arbitration logic in the IWF floor control server shall keep one instance of the 'dual floor control operation' state machine for a floor participant with pre-emptive floor priority where this MCPTT user or user homed in the IWF is allowed to talk without revoking a current speaker with lower floor priority.\nNOTE:\tOnly one media endpoint with this type of pre-emptive floor priority can exist within an MCPTT call.\nThe floor participant associated to the 'dual floor control operation' state machine is in the following clauses referred to as the overriding media endpoint.\nIf floor control messages or RTP media packets arrive in a state where there is no procedure specified in the following clauses the floor control arbitration logic in the IWF floor control server:\n1.\tshall discard the floor control message;\n2.\tshall request the media distributor in the IWF to discard any received RTP media packet; and\n3.\tshall remain in the current state.\nState details are explained in the following clauses.\nWhen a new instance of the 'dual floor control operation' state machine is initiated, before any floor control related input is applied, the state machine is in 'Start-stop' state. Similarly, when the media burst is released the state machine shall return to the 'Start-Stop' state or the related MCPTT call is released.\nWhen an MCPTT floor participant that requests the floor with an overriding pre-emptive priority is granted the floor the floor control arbitration logic in the IWF floor control server:\n1.\tshall create one instance of the 'dual floor control operation' state machine;\n2.\tshall store the SSRC of the floor participant;\n3.\tif a Track Info field is included in the Floor Request message, shall store the received Track Info field associated with the floor control server state transition diagram for 'dual floor control operation', and\n4\tshall enter the state 'D: Floor Taken' as specified in the clause 6.3.6.3.2.\nWhen the IWF determines that an IWF floor participant with an overriding pre-emptive priority is to be granted the floor the floor control arbitration logic in the IWF floor control server:\n1.\tshall create one instance of the 'dual floor control operation' state machine;\n2.\tshall determine an SSRC for the IWF floor participant and shall store the SSRC of the IWF floor participant; and\n3\tshall enter the state 'D: Floor Taken' as specified in the clause 6.3.6.3.2.\nThe floor control arbitration logic in the IWF floor control server uses this state when it has permitted one floor participant to override a current speaker in an MCPTT call to send media.\nTimer T11 (End of RTP dual) can be running when the IWF floor control server is in this state.\nTimer T12 (Stop talking dual) can be running when the IWF floor control server is in this state.\nWhen entering this state, the floor control arbitration logic in the IWF floor control server:\n1.\tif the requesting floor participant is an MCPTT floor participant, shall send a Floor Granted message to the requesting MCPTT floor participant. The Floor Granted message:\na.\tshall include the value of the T12 (Stop talking dual) timer in the Duration field;\nb.\tshall include the granted priority in the Floor priority field;\nc.\tif a Track Info field associated with the floor control server state transition diagram for 'dual floor control operation' state machine is stored, shall include the stored Track Info field;\nd.\tshall include the Floor Indicator field with the G-bit set to '1' (Dual floor);\ne.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\nf.\tif non-controlling MCPTT functions are involved, shall include the SSRC of the granted floor participant;\n2.\tshall send a Floor Idle message to any non-controlling MCPTT functions involved in the session and to those MCPTT floor participants controlled by the IWF performing the controlling role that will only listen to RTP media from the overriding media endpoint according to local policy. The Floor Idle message:\nNOTE 1:\tThe non-controlling MCPTT function will send the Floor Idle message to those MCPTT floor participants controlled by the non-controlling MCPTT function that will only listen to RTP media from the overriding media endpoint according to local policy when the non-controlling MCPTT function receives the Floor Taken with the G-bit set to '1' (Dual floor) in the Floor Indicator field.\ni.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1; and\nii.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n3.\tshall send a Floor Taken message to any non-controlling MCPTT functions involved and to MCPTT floor participants controlled by the IWF performing the controlling role that will listen to the RTP media from the overriding media endpoint according to local policy. The Floor Taken message:\nNOTE 2:\tThe media endpoint overridden by the overriding media endpoint is still sending voice (overridden). The list of floor participants that receive the overriding, overridden, or both transmissions is based on configuration.\na.\tshall include the granted floor participant’s MCPTT ID in the Granted Party's Identity field, if privacy is not requested;\nb.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1;\nc.\tshall include the Floor Indicator field with the G-bit set to '1' (Dual floor); and\nd.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n4.\tshall start the T11 (End of RTP dual) timer; and\n5.\tshall enter the state 'D: Floor Taken'.\nOn expiry of timer T11 (End of RTP dual), the floor control arbitration logic in the IWF floor control server:\n1.\tshall stop the T12 (Stop talking dual) timer; if running;\n2.\tshall request the media distributor in the IWF to stop distributing RTP media packets received from the overriding media endpoint to other media endpoints;\nNOTE:\tIf dual floor control is ongoing as described in clause 6.3.6, the list of floor participants that receive the overriding, overridden, or both transmissions is based on configuration.\n3.\tshall release all resources reserved in the media plane including the instances used for the 'dual floor control operation' state machine and any running timers associated with the state machine;\n4.\tshall send a Floor Idle message to any non-controlling MCPTT functions and to those MCPTT floor participants controlled by the IWF performing the controlling role receiving RTP media from the overriding media endpoint. The Floor Idle message:\na.\tshall include a Floor Indicator field with the G-bit set to '1' (Dual floor);\nb.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n5.\tif the state in the 'general floor control operation' state machine is 'G: Taken';\na\t shall send a Floor Taken message to any non-controlling MCPTT functions and to those MCPTT floor participants controlled by the IWF performing the controlling role that only received RTP media from the overriding media endpoint. The Floor Taken message:\ni.\tshall include the granted floor participant's MCPTT ID in the Granted Party's Identity field, if privacy is not requested;\nii.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\niii.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n6.\tif the state in the 'general floor control operation' state machine is 'G: Idle', shall send a Floor Idle message to all MCPTT floor participants. The Floor Idle message:\na.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nb.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n7.\tshall enter the 'Start-stop' state.\nOn expiry of the T12 (Stop talking dual) timer the floor control arbitration logic in the IWF floor control server:\n1.\tshall stop the T11 (End of RTP dual) timer;\n2.\tshall request the media distributor in the IWF to stop distributing RTP media packets to other media endpoints;\n3.\tif the floor participant is an MCPTT floor participant, shall send the Floor Revoke message to the permitted MCPTT floor participant. The Floor Revoke message:\na.\tshall include the Reject Cause field with the <Reject Cause> value set to #2 (Media burst too long) in the Floor Revoke message sent in clause 6.3.4.5.2;\nb.\tshall include the Floor Indicator with the G-bit set to '1' (Dual floor);\nc.\tif a Track Info field associated with the dual floor is stored, shall include the stored Track Info field; and\nd.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n4.\tshall remove the stored Track info field associated with the dual floor;\n5.\tif the state in the 'general floor control operation' state machine is 'G: Taken';\na.\tshall send a Floor Taken message to all non-controlling MCPTT functions (if the session is a temporary group session involving non-controlling MCPTT functions) and to those MCPTT floor participants that only received RTP media from the overriding media endpoint. The Floor Taken message:\ni.\tshall include the granted floor participant’s MCPTT ID in the Granted Party's Identity field, if privacy is not requested; and\nii\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1;\n6.\tif the state in the 'general floor control operation' state machine is 'G: Idle', shall send a Floor Idle message to all MCPTT floor participants. The Floor Idle message:\na.\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nb.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n7.\tshall release all resources reserved in the media plane including the instances used for the Floor control server state transition diagram for 'dual floor control operation'; and\n8.\tshall enter the 'Start-stop' state.\nUpon receiving an indication from the media distributor in the IWF that RTP media packets are received from the permitted media endpoint, the floor control arbitration logic in the IWF floor control server:\n1.\tif the media endpoint is an MCPTT media endpoint, shall start the T12 (Stop talking dual) timer, if not already running;\n2.\tshall restart the T11 (End of RTP dual) timer;\n3.\tshall instruct the media distributor to forward the received RTP media packets to any non-controlling MCPTT functions, to the overridden media endpoint and to those media endpoints receiving RTP media from the overriding media endpoint controlled by the IWF performing the controlling role according to local policy; and\nNOTE 1:\tThe RTP media is sent to the media endpoints subjected to the maximum number of simultaneous transmissions received in one group call for override (N7) as indicated in 3GPP TS 23.379 [5].\nNOTE 2:\tThe IWF performing the non-controlling role will forward the RTP media packets to media endpoints receiving RTP media from the overriding media endpoint according to local policy in the IWF performing the non-controlling role.\n4.\tshall remain in the 'D: Floor Taken' state.\nUpon receiving a Floor Release message from the overriding MCPTT media endpoint or upon determining that the floor has been released by an overriding IWF media endpoint, the floor control arbitration logic in the IWF floor control server:\n1.\tshall request the media distributor in the IWF to stop distributing RTP media packets received from the overriding media endpoint to other media endpoints;\n2.\tshall stop the T12 (Stop talking dual) timer, if running;\n3.\tshall stop the T11 (End of RTP dual) timer;\n4.\tshall release all resources reserved in the media plane including the instances used for the Floor control server state transition diagram for 'dual floor control operation' and any running timers associated with the state machine;\n5.\tif a Floor Release message has been received from an MCPTT media endpoint and if the first bit in the subtype of the Floor Release message is set to '1' (acknowledgement is required) as specified in clause 8.2.2:\na.\tshall send a Floor Ack message. The Floor Ack message:\ni.\tshall set the Source field to the value '2' (the IWF performing the controlling role is the source); and\nii.\tshall set the Message Type field to the value '4' (Floor Release);\n6.\tshall send a Floor Idle message to any non-controlling MCPTT functions, to the overridden participant if it is an MCPTT floor participant and to those MCPTT floor participants controlled by the IWF performing the controlling role receiving RTP media from the overriding media endpoint. The Floor Idle message:\na.\tshall include an Floor Indicator field with the G-bit set to '1' (Dual floor);\nb\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n7.\tif the state in the 'general floor control operation' state machine is 'G: Taken',\na.\tshall send a Floor Taken message to any non-controlling MCPTT functions and to those MCPTT floor participants that only received RTP media from the overriding media endpoint. The Floor Taken message:\ni.\tshall include the granted floor participant’s MCPTT ID in the Granted Party's Identity field, if privacy is not requested;\nii.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1; and\niii.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n8.\t if the state in the 'general floor control operation' state machine is 'G: Idle', shall send a Floor Idle message to all MCPTT floor participants. The Floor Idle message:\na.\tshall include a Message Sequence Number field with a Message Sequence Number value increased with 1; and\nb.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n9.\tshall enter the 'Start-stop' state.\nThe procedures in clause 6.3.6.3.6 are followed.\nUpon receiving a Floor Request message from the MCPTT floor participant that has been granted permission to send overriding media, the floor control arbitration logic in the IWF floor control server:\n1.\tshall send a Floor Granted message to the previously granted MCPTT floor participant. The Floor Granted message:\na.\tshall include the value of the T12 (Stop talking dual) timer in the Duration field;\nb.\tshall include the granted priority in the Floor priority field;\nc.\tif the Floor Request message included a Track Info field, shall include the received Track Info field; and\nd.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications; and\n2.\tshall remain in the 'D: Floor Taken' state.\nIf the IWF floor control server receives an indication from the floor control interface towards the MCPTT client that the overriding MCPTT media endpoint has started to disconnect from the MCPTT call, the floor control arbitration logic in the IWF floor control server:\n1.\tshall request the media distributor in the IWF to stop distributing RTP media packets received from the overriding MCPTT media endpoint to other media endpoints;\n2.\tshall send a Floor Idle message to any non-controlling MCPTT functions and to those MCPTT floor participants controlled by the IWF performing the controlling role receiving RTP media from the overriding MCPTT media endpoint. The Floor Idle message:\na.\tshall include an Floor Indicator field with the G-bit set to '1' (Dual floor);\nb\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n3.\tshall release all resources reserved in the media plane including the instances used for the Floor control server state transition diagram for 'dual floor control operation' and any running timers associated with the state machine; and\n4.\tshall enter the 'Start-stop' state.\nIf the IWF floor control server determines that the overriding IWF media endpoint has started to disconnect from the MCPTT call, the floor control arbitration logic in the IWF floor control server:\n1.\tshall request the media distributor in the IWF to stop distributing RTP media packets received from the overriding IWF media endpoint to other media endpoints;\n2.\tshall send a Floor Idle message to any non-controlling MCPTT functions and to those MCPTT floor participants controlled by the IWF performing the controlling role receiving RTP media from the overriding IWF media endpoint. The Floor Idle message:\na.\tshall include an Floor Indicator field with the G-bit set to '1' (Dual floor);\nb\tshall include a Message Sequence Number field with a <Message Sequence Number> value increased with 1; and\nc.\tif a group call is a broadcast group call, a system call, an emergency call, an imminent peril call, or a temporary group session, shall include the Floor Indicator field with appropriate indications;\n3.\tshall release all resources reserved in the media plane including the instances used for the Floor control server state transition diagram for 'dual floor control operation' and any running timers associated with the state machine; and\n4.\tshall enter the 'Start-stop' state.\nUpon receiving the termination instruction, the floor control arbitration logic in the IWF floor control server:\n1.\tshall set the value of timer T1 (End of RTP media) to the value of timer T11 (End of RTP dual) and start timer T1, if timer T11 (End of RTP dual) is running;\n2.\tshall set the value of timer T2 (Stop talking) to the value of timer T12 (Stop talking dual) and start timer T2, if timer T12 (Stop talking dual) is running;\n3.\tshall release all resources reserved in the media plane including the instances used for the dual floor control operation' state machine and stop any running timers associated with the state machine; and\n4.\tshall enter the 'Start-stop' state.\nNOTE:\tThe overriding participant continues to have the floor until its current talk burst is terminated.\nThis clause describes the actions to be taken in all states defined for the general state diagram with the exception of the 'Start-stop' state.\nThis clause is used by the floor control arbitration logic in the IWF floor control server when an MCPTT call is released.\nUpon receiving an MCPTT call release step 1 request from the application and signalling plane the floor control arbitration logic in the IWF floor control server:\n1.\tshall request the media distributor in the IWF to stop sending RTP media packets to media endpoints; and\n2.\tshall enter the 'Releasing' state.\nThe floor control arbitration logic in the IWF floor control server uses this state while waiting for the application and signalling plane to finalize the disconnection of an MCPTT call.\nUpon receiving an MCPTT call release step 2 request from the application and signalling plane, the floor control arbitration logic in the IWF floor control server:\n1.\tshall release all resources reserved in the media plane including the instances used for the dual floor control operation' state machine and any running timers associated with the state machine; and\n2.\tshall enter the 'Start-stop' state.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.4\tIWF performing the participating role floor control procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.4.1\tGeneral",
                            "text_content": "The IWF performing the participating role performs the procedures in this clause on behalf of each IWF media endpoint.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.2\tIWF floor participant procedures at MCPTT session initialization",
                            "text_content": "Based on the negotiations during the call establishment specified in 3GPP TS 29.379 [26], a new instance of a media session shall be created for this call.\nThe SIP INVITE request sent by the application and signalling plane:\n1.\tshall be regarded an implicit floor request when an implicit floor request is negotiated; and\n2.\tshall not be regarded as an implicit floor request in case of a rejoin to an already on-going group call.\nNOTE:\tThe IWF floor participant can negotiate the use of prioritization of the Floor Request message. In that case, the floor participant can request permission to send media at a priority level that is either the same as or lower than the highest priority that was permitted to the participant in the MCPTT call initialization. If a floor participant is authorized for pre-emptive priority in the MCPTT call it is good practise to always request permission to send RTP media packets at a priority level that is lower than pre-emptive priority unless the IWF explicitly needs to pre-empt the current RTP media packets' sender. In any case pre-emptive priority will have no effect for audio cut-in floor control.\nWhen a call is initiated as described in 3GPP TS 29.379 [26], the IWF floor participant:\n1.\tshall create a media session;\n2.\tif the originating IWF floor participant receives a floor control message before it receives the SIP 200 (OK) response, shall store the floor control message; and\nNOTE:\tThe originating IWF floor participant might receive a floor control message before the SIP 200 (OK) response when initiating, joining or rejoining a call because of processing delays of the SIP 200 (OK) response in the SIP core.\n3.\tif a floor control message is received after a SIP INVITE request with implicit floor request and before the reception of the SIP 200 (OK), shall act upon the floor control message.\nWhen an MCPTT call is established, the terminating IWF floor participant shall create an instance of a media session.\nNOTE:\tFrom an IWF floor participant perspective the MCPTT call is established when the application and signalling plane sends the SIP 200 (OK) response.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.3\tIWF floor participant procedures at MCPTT call release",
                            "text_content": "The MCPTT call release can be initiated by the IWF floor participant or the MCPTT floor control server. The following steps are performed:\n1.\tThe IWF floor participant stops sending floor control messages and stops sending RTP media packets.\n2.\tWhen the application and signalling plane has determined that the MCPTT call is released, the corresponding instance of the media session is terminated.\nThe user plane can initiate release step 1, but the application and signalling plane always initiates release step 2.\nNOTE:\tA badly formatted RTP packet or floor control message received is ignored by the IWF floor participant.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.4\tIWF floor participant floor message handing",
                            "text_content": "Upon receiving a Floor Idle message, the IWF floor participant:\n1.\tif the first bit in the subtype of the Floor Idle message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '5' (Floor Idle); and\nb.\tshall include the Source field set to '0' (the IWF floor participant is the source).\nUpon receiving the Floor Taken message, the IWF floor participant:\n1.\tif the first bit in the subtype of the Floor Taken message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '2' (Floor Taken); and\nb.\tshall include the Source field set to '0' (the IWF floor participant is the source).\nThe IWF can expect to receive RTP media packets at any time during a media session except after releasing a media session.\nNOTE:\tRTP media packets can be received from multiple sources when dual floor control is applied by the floor control server (see 3GPP TS 24.380 [25], clause 6.3.6). The IWF can differentiate between the different sources using the SSRC in the received RTP media packets. How the IWF mixes the different RTP media stream sources is out of scope of the present document.\nUpon deciding to request permission to send media, the IWF floor participant:\n1.\tshall send the Floor Request message toward the MCPTT floor control server; The Floor Request message:\na.\tif a different priority than the normal priority is required, shall include the Floor Priority field with the priority not higher than negotiated with the floor control server as specified in clause 14.3.3;\nb.\tif the floor request is a broadcast group call, system call, emergency call or an imminent peril call, shall include a Floor Indicator field indicating the relevant call types; and\nc.\tshall include the MCPTT ID associated with the requesting LMR user in a User ID field, if privacy is not requested.6.4.4.5\tReceive Floor Granted message\nUpon receiving a Floor Granted message from the floor control server or a floor granted indication in a SIP 200 (OK) response in the application and signalling layer, the IWF floor participant:\n1.\tif the first bit in the subtype of the Floor Granted message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '1' (Floor Granted); and\nb.\tshall include the Source field set to '0' (the IWF floor participant is the source);\n2.\tmay send a Floor Release message at any time, even before sending any media; and\n3.\tshall start encoding and forwarding media to the MCPTT server.\nUpon receiving a Floor Deny message, the IWF floor participant:\n1.\tif the first bit in the subtype of the Floor Deny message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '3' (Floor Deny); and\nb.\tshall include the Source field set to '0' (the IWF floor participant is the source); and\n2.\tshall not encode and forward voice packets.\nUpon deciding to release permission to send media, the IWF floor participant:\n1.\tshall send a Floor Release message towards the floor control server;\na.\tif the session is a broadcast call and if the session was established as a normal call, shall include the Floor Indicator with the A-bit set to '1' (Normal call);\n2.\tmay include the first bit in the subtype of the Floor Release message set to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tif the Floor Granted message included the G-bit set to '1' (Dual floor), shall include the Floor Indicator with the G-bit set to '1' (Dual floor).\nUpon receiving a Floor Queue Position Info message, the IWF floor participant:\n1.\tif the first bit in the subtype of the Floor Queue Position Info message is set to '1' (Acknowledgment is required) as described in clause 8.3.2, shall send a Floor Ack message. The Floor Ack message:\na.\tshall include the Message Type field set to '9' (Floor Queue Position Info); and\nb.\tshall include the Source field set to '0' (the IWF floor participant is the source).\nNOTE:\tWhile in the queue, the IWF floor participant can receive RTP Media packets and the IWF floor participant can send and receive floor control messages.\nUpon receiving a Floor Revoke message, the IWF floor participant:\n1.\tshall discard any remaining buffered RTP media packets and to stop forwarding encoded voice to the MCPTT server;\n2.\tshall send a Floor Release message. In the Floor Release message:\na.\tshall include the Floor Indicator with the G-bit set to the value of the G-bit in the Floor Revoke message; and\nb.\tmay set the first bit in the subtype to '1' (Acknowledgment is required) as described in clause 8.3.2.\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\nUpon receiving an MCPTT call release request from the application and signalling plane when the MCPTT call is going to be released or when the IWF floor participant is leaving the MCPTT call, the IWF floor participant:\n1.\tshall stop sending floor control messages; and\n2.\tshall stop sending RTP media packets.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.5\tIWF performing the non-controlling role of an MCPTT group",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.5.4\tFloor control server interface procedures",
                            "text_content": "The floor control server interface is stateless with regards to the floor control message received and sent.\nThe following subclauses specify what the floor control server interface shall do when receiving a floor control message sent by the controlling MCPTT function or received at the floor participant interface or initiated internally for an IWF media endpoint and how the floor control server controls the media distribution function in the non-controlling MCPTT function.\nEditor's Note:\tExisting clauses 6.3.5 and 6.3.6 should be evaluated for updates now that we support regroup. Search for \"non-controlling\" in TS 24.380 and TS 29.380.\nUpon receiving a Floor Request message from one floor participant interface, the floor control server interface:\n1.\tshall\na.\tforward the Floor Request message to the controlling MCPTT function if the controlling function is in the MCPTT system; or\nb.\tforward to the floor control server in the IWF if the controlling function is in the IWF.\nThe Floor Request message:\na.\tshall include all fields included by the floor participant;\nb.\tif a Track Info field is included, shall include the temporary identifier at the end of the <Floor Participant Reference> value item;\nc.\tif a Track Info field is not included, shall include a Track Info field populated as follows:\ni.\tshall include the \"mc_queueing\" fmtp attribute value negotiated as specified in clause 14 in the <Queueing Capability> value;\nii.\tshall include a <Participant Type> value based on the <participant-type> element specified in 3GPP TS 24.481 [12], if value in the <participant-type> element is available, otherwise set the <Participant Type> value to \"unknown\"; and\niii. shall include the temporary identifier as the first <Floor Participant Reference> value; and\nd.\tshall include the MCPTT ID of the requesting floor participant in a User ID field, if privacy is not requested; and\n2.\tif the value of the <Queueing Capability> in the Track Info is '1' (the floor participant in the MCPTT client supports queueing), shall store the outgoing Floor Request message in the passive floor request queue.\nUpon deciding to request permission to send media when the controlling function is in the MCPTT system, the IWF:\n1.\tshall send the Floor Request message toward the MCPTT floor control server in the MCPTT system. The Floor Request message:\na.\tif a different priority than the normal priority is required, shall include the Floor Priority field with the priority not higher than negotiated with the floor control server as specified in clause 14.3.3;\nb.\tif the floor request is a broadcast group call, system call, emergency call or an imminent peril call, shall include a Floor Indicator field indicating the relevant call types; and\nc.\tshall include the MCPTT ID associated with the requesting LMR user in a User ID field, if privacy is not requested.\nNOTE:\tIf the IWF does not know the identity of the LMR user requesting the floor because of privacy settings in the LMR system, the IWF uses its own MCPTT ID\nUpon receiving a Floor Release message from one floor participant interface, the floor control server interface:\nNOTE:\tA Floor Release message can be received from the permitted floor participant and from any participant that is queued in the floor control server.\n1.\tshall forward a Floor Release message to the controlling MCPTT function if the controlling function is in the MCPTT system or to the floor control server state transition diagram for basic floor control operation towards the floor participant in the IWF if the controlling function is in the IWF. The Floor Release message:\na.\tshall include all fields included by the floor participant in the Floor Release message;\nb.\tif a Track Info field is included, shall include the temporary identifier at the end of the <Floor Participant Reference> value item; and\nc.\tif a Track Info field is not included, shall include a Track Info field as follows:\ni.\tshall include the \"mc_queueing\" fmtp attribute value negotiated as specified in clause 14 in the <Queueing Capability> value; and\nii. shall include the temporary identifier as the first <Floor Participant Reference> value; and\n2.\tif a Floor Request message received from this floor participant is in the passive floor request queue, shall remove the floor request from the passive floor request queue.\nUpon deciding to release permission to send media when the controlling function is in the MCPTT system, the IWF floor participant:\n1.\tshall send a Floor Release message towards the floor control server in the MCPTT system;\na.\tif the session is a broadcast call and if the session was established as a normal call, shall include the Floor Indicator with the A-bit set to '1' (Normal call);\n2.\tmay include the first bit in the subtype of the Floor Release message set to '1' (Acknowledgment is required) as described in clause 8.3.2; and\nNOTE:\tIt is an implementation option to handle the receipt of the Floor Ack message and what action to take if the Floor Ack message is not received.\n3.\tif the Floor Granted message included the G-bit set to '1' (Dual floor), shall include the Floor Indicator with the G-bit set to '1' (Dual floor).\nUpon receiving a Floor Queue Position Request message from one floor participant interface, the floor control server interface:\n1.\tshall forward the Floor Queue Position Request message to the controlling MCPTT function if the controlling function is in the MCPTT system or to the floor control server state transition diagram for basic floor control operation towards the floor participant in the IWF if the controlling function is in the IWF. The Floor Queue Position Request message:\na.\tshall include all fields included by the floor participant;\nb.\tif a Track Info field is included, shall include the temporary identifier at the end of the <Floor Participant Reference> value item; and\nc.\tif a Track Info field is not included, shall include a Track Info field as follows:\ni.\tshall include the \"mc_queueing\" fmtp attribute value negotiated as specified in clause 14 in the <Queueing Capability> value; and\nii. shall include the temporary identifier as the first <Floor Participant Reference> value.\nUpon deciding to request the queue position, when the controlling function is in the MCPTT system, the IWF:\n1.\tshall send the Floor Ack message towards the floor control server in the MCPTT system. The Floor Ack message:\na.\tshall include the Message Type field set to '2' (Floor Taken);\nb.\tshall include the Source field set to '0' (the floor participant is the source); and\nc.\tshall include a Track Info field as follows:\ni.\tshall include the \"mc_queueing\" fmtp attribute value negotiated as specified in clause 14 in the <Queueing Capability> value; and\nii. shall include the temporary identifier as the first <Floor Participant Reference> value.\nUpon receiving a Floor Ack message from one floor participant interface the floor control server interface:\n1.\tshall send the Floor Ack message towards the controlling MCPTT function if the controlling function is in the MCPTT system or to the floor control server state transition diagram for basic floor control operation towards the floor participant in the IWF if the controlling function is in the IWF. The Floor Ack message:\na.\tshall include all fields included by the floor participant in the Floor Ack message;\nb.\tif Track Info field is included, shall include the temporary identifier at the end of the <Floor Participant Reference> value item; and\nc.\tif a Track Info field is not included, shall include a Track Info field with temporary identifier as the first <Floor Participant Reference>.\nUpon deciding to send a Floor Ack message, when the controlling function is in the MCPTT system, the IWF:\n1.\tshall send the Floor Ack message towards the floor control server in the MCPTT system. The Floor Ack message shall include a Track Info field as follows:\na. shall include the temporary identifier as the first <Floor Participant Reference> value.\nUpon receiving a Floor Granted message sent from the controlling MCPTT function, the floor control server interface:\n1.\tshall send the Floor Granted to the floor participant interface identified by the <Participant Reference> value at the end of the Track Info field. The Floor Granted message:\na.\tshall include the fields as received with the following exceptions:\ni.\tif the Track Info field only contains one <Participant Reference> value, shall remove the Track Info field from the outgoing Floor Granted message; and\nii.\tif the Track Info field contains more than one <Participant Reference> value, shall remove the last <Participant Reference> value from the Track Info field from the outgoing Floor Granted message; and\nb\tif the Floor Indicator field is included in the Floor Granted message and the G-bit is set to '1' (Dual floor), shall store the SSRC of granted floor participant and associate the stored value with dual floor;\n2.\tif:\na.\tthe SSRC of the granted floor participant associated with dual floor is not stored, shall send a Floor Taken message populated as specified in step d. below to all participant interfaces with the exception of the floor participant interface to which the Floor Granted message is sent;\nb.\tthe SSRC of the granted floor participant associated with dual floor is stored and if the Floor Indicator field is not included in the Floor Granted message or if the Floor Indicator field is included in the Floor Granted message and the G-bit is set to '0' (Not dual floor), shall send a Floor Taken message populated as specified in step d. below to all participant interfaces with the exception of:\ni.\tthe floor participant interface to which the Floor Granted message is sent; and\nii.\tthe floor participants only listening to the overriding floor participant;\nc.\tthe Floor Indicator field is included in the Floor Granted message and the G-bit is set to '1' (Dual floor):\ni.\tshall send a Floor Taken message populated as specified in step d. below to floor participants that will listen to the RTP media from the overriding MCPTT client according to local policy;\nNOTE 1:\tThe floor participant overridden by the overriding floor participant is still sending voice (overridden). The list of floor participants that receive the overriding, overridden, or both transmissions is based on configuration.\nd.\tThe Floor Taken message:\ni.\tshall include the granted user's MCPTT ID in the Granted Party's Identity field if privacy is not requested by the granted floor participant when the floor participant was invited to the session;\nNOTE 2:\tThe privacy request was stored for each invited floor participant when the floor participant accepted the invitation as specified in subclause 6.5.2.\nii.\tshall include in the Message Sequence Number field the local <Message Sequence Number> value increased with 1;\niii.\tshall include the Permission to Request Floor field to '0', if the group call is a broadcast group call;\niv.\tmay include the Permission to Request the Floor field set to '1', if the group call is not a broadcast group call; and\nv.\tshall set the first bit in the subtype of the Floor Taken message to '0' (acknowledgement is not required); and\nNOTE 3:\tA Floor Taken message sent to all participants does not require acknowledgement.\ne.\tif the Floor Indicator field was included in the Floor Granted message, shall include the received Floor Indicator field; and\n3.\tif the Floor Request message received from the floor participant is in the passive floor request queue, shall remove the floor request from the passive floor request queue; and\n4\tif the Floor Indicator field is included in the Floor Granted message and the G-bit is set to '1' (Dual floor), shall send a Floor Idle message to those floor participants that will only listen to RTP media from the overriding MCPTT client. The Floor Idle message:\na.\tshall include the Floor Indicator field as received in the Floor Granted message with the G-bit set to '0' (Not dual floor); and\nb.\tshall include in the Message Sequence Number field the local <Message Sequence Number> value increased with 1.\nUpon deciding to grant floor, where the controlling function is in the IWF, the IWF floor control server interface:\nEditor's Note:\tNeed to create a grant message for internally generated requests, need to also consider floor requests coming from IWF CF that originated in MCPTT, how do those make it here? Does IWF CF call this nCF?\nEditor's note:\tNeed to add procedures for clauses 6.5.4.7 thru 6.5.4.16.\nUpon receiving a Floor Release Multi Talker message sent from the controlling MCPTT function, the IWF floor control server interface shall ignore the Floor Release Multi Talker message.\nNOTE:\tThe multi-taker feature is not supported in the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.5\tFloor participant interface procedures",
                            "text_content": "The floor participant interface toward the MCPTT client shall behave according to the state diagram and state transitions specified in this clause.\nFigure 6.5.5.1-1 shows the general floor control operation states (P states) and the state transition diagram.\n\nFigure 6.5.5.1-1 presents a state diagram illustrating the floor participant interface's progression towards the MCPTT (Mission-Critical Push-to-Talk) client state transition. The diagram outlines the various states a floor participant may undergo, including initial setup, authentication, and connection establishment, before transitioning to the MCPTT client state. Key components include the floor participant, MCPTT client, and the state transition process. The diagram emphasizes the importance of secure and reliable communication in mission-critical environments.\nFigure 6.5.5.1-1: The 'floor participant interface toward the MCPTT client state transition' state diagram\nThe floor participant interface toward the MCPTT client shall keep one instance of the 'floor participant interface toward the MCPTT client state transition' state machine per MCPTT client in a session. The interface and procedures toward IWF media endpoints are out of scope of the present document.\nThe floor participant associated to the 'floor participant interface toward the MCPTT client state transition' state machine is in the following clauses referred to as the MCPTT floor participant.\nIf floor control messages or RTP media packets arrives in a state where there is no procedure specified in the following clauses the floor participant interface toward the MCPTT client:\n1.\tshall discard the floor control message;\n2.\tshall request the network media interface to discard any received RTP media packet; and\n3.\tshall remain in the current state.\nState details are explained in the following clauses.\nWhen a new instance of the 'Floor participant interface toward the MCPTT client state transition' state machine is initiated, before any floor control related input is applied, the state machine is in 'Start-stop' state. Similarly, when the session is released the state machine shall return to the 'Start-stop' state.\nWhen the floor participant interface toward the MCPTT client receives an indication from the floor control server interface that an MCPTT client has accepted the invitation to a session (i.e. when the SIP 200 (OK) response to the initial SIP INVITE request is received as specified in 3GPP TS 24.379 [2]) , the floor participant interface toward the MCPTT client:\n1.\tshall enter the 'P: has no permission' state.\nThe floor participant interface toward the MCPTT client uses this state when the MCPTT floor participant is not permitted to send media.\nWhen the floor participant interface toward the MCPTT client receives a Floor Idle message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Idle message to the MCPTT floor participant;\n2.\tif the first bit in the subtype of the Floor Idle message is set to '1' (acknowledgement is required) as specified in clause 8.2.2, shall store an indication that a Floor Ack message to a Floor Idle messages is expected; and\n3.\tshall remain in the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Taken message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Taken message to the MCPTT floor participant;\n2.\tif the first bit in the subtype of the Floor Taken message is set to '1' (acknowledgement is required) as specified in clause 8.2.2, shall store an indication that a Floor Ack message to a Floor Taken messages is expected; and\n3.\tshall remain in the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Request message from the MCPTT floor participant, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Request message to the floor control server interface; and\n2.\tshall remain in the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Granted message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Granted message to the MCPTT floor participant;\n2.\tif the first bit in the subtype of the Floor Granted message is set to '1' (acknowledgement is required) as specified in clause 8.2.2, shall store an indication that a Floor Ack message to a Floor Granted messages is expected; and\n3.\tshall enter the 'P: has permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Deny message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Deny message to the MCPTT floor participant toward the MCPTT client;\n2.\tif the first bit in the subtype of the Floor Deny message is set to '1' (acknowledgement is required) as specified in clause 8.2.2, shall store an indication that a Floor Ack message to a Floor Deny messages is expected; and\n3.\tshall remain in the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Queue Position Info message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Queue Position Info message to the MCPTT floor participant;\n2.\tif the first bit in the subtype of the Floor Queue Position Info message is set to '1' (acknowledgement is required) as specified in clause 8.2.2, shall store an indication that a Floor Ack message to a Floor Queue Position Info messages is expected; and\n3.\tshall remain in the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Queue Position Request message from the MCPTT floor participant, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Queue Position Request message to the floor control server interface; and\n2.\tshall remain in the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives an indication from the network media interface that RTP media packets are received from the media distributor, the floor participant interface toward the MCPTT client:\n1.\tshall instruct the network media interface to send the received RTP media packets towards the MCPTT client; and\n2.\tshall remain in the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives an indication from the network media interface that RTP media packets are received from the MCPTT client, the floor participant interface toward the MCPTT client:\n1.\tshall send a Floor Revoke message to the MCPTT floor participant. The Floor Revoke message:\na.\tshall include the Reject Cause field with the <Reject Cause> value set to #3 (No permission to send a Media Burst);\n2.\tshall store that a Floor Release message is expected from the MCPTT floor participant; and\n3.\tshall remain in the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Release message from the MCPTT floor participant, the floor participant interface toward the MCPTT client:\n1.\tif a Floor Release message is not expected from the MCPTT floor participant:\na.\tif the first bit in the subtype of the Floor Release message is set to '1' (acknowledgement is required) as specified in clause 8.2.2, based on local policy:\ni\tshall send a Floor Ack message to the MCPTT floor participant and set the first bit in the subtype of the Floor Release message to '0' (acknowledgement is not required) in the outgoing Floor Release message; or\nii.\twait for the Floor Ack from the floor control server; and\nb.\tshall forward the Floor Release message to the floor control server interface;\n2.\tif a Floor Release message is expected from the MCPTT floor participant:\na.\tif the first bit in the subtype of the Floor Release message is set to '1' (acknowledgement is required) as specified in clause 8.2.2:\ni.\tshall send a Floor Ack message to the MCPTT floor participant; and\nb.\tshall remove that a Floor Release message is expected from the floor participant; and\n3.\tshall remain in the 'P: has no permission' state.\nUpon receiving an instruction to split the ongoing MCPTT call, to the floor participant interface toward the MCPTT client:\n1.\tshall create a new instance of the 'basic floor control operation towards the floor participant' state machine;\n2.\tshall move information associated with the instance used for 'floor participant interface toward the MCPTT client state transition' to the 'basic floor control operation towards the floor participant' state machine;\nNOTE:\t Which information that needs to be moved is an implementation option.\n3.\tshall enter the 'Start-stop' state and terminate the 'floor participant state transition' state machine associated with this MCPTT floor participant and this session;\n4.\tif the state in 'general floor control operation' state machine is 'G: Floor Idle' state; shall enter the 'U: not permitted and Floor Idle' state as specified in clause 6.3.5.3.2; and\n5.\tif the state in 'general floor control operation' state machine is 'G: Floor Taken' state; shall enter the 'U: not permitted and Floor Taken' state as specified in clause 6.3.5.4.2.\nWhen the floor participant interface toward the MCPTT client receives a Floor Release Multi Talker message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall remain in the 'P: has no permission' state.\nNOTE:\tThe multi-talker feature is not supported in the present document.\nThe floor participant interface toward the MCPTT client uses this state when the floor participant has permission to send media\nWhen the floor participant interface toward the MCPTT client receives an indication from the network media interface that RTP media packets are received from the MCPTT client, the floor participant interface toward the MCPTT client:\n1.\tshall instruct the media interface to forward received RTP media packets towards the media distributor; and\n2.\tshall remain in the 'P: has permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Release message from the floor participant, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Release message to the floor control server interface; and\n3.\tshall remain in the 'P: has permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Ack message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Ack message to the floor participant; and\n2.\tshall remain in the 'P: has permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Idle message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Idle message to the floor participant;\n2.\tif the first bit in the subtype of the Floor Idle message is set to '1' (acknowledgement is required), shall store an indication that a Floor Ack message to a Floor Idle messages is expected; and\n3.\tshall enter the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Taken message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Taken message to the floor participant;\n2.\tif the first bit in the subtype of the Floor Taken message is set to '1' (acknowledgement is required), shall store an indication that a Floor Ack message to a Floor Taken messages is expected; and\n3.\tshall enter the 'P: has no permission' state.\nWhen the floor participant interface toward the MCPTT client receives a Floor Revoke message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Revoke message to the MCPTT floor participant;\n2.\tif the first bit in the subtype of the Floor Revoke message is set to '1' (acknowledgement is required), shall store an indication that a Floor Ack message to a Floor Revoke messages is expected; and\n3.\tshall remain in the 'P: has permission' state.\nUpon receiving an instruction to split the ongoing MCPTT call, the floor participant interface toward the MCPTT client:\n1.\tshall create a new instance of the 'basic floor control operation towards the floor participant' state machine as specified in clause 6.3.5;\n2.\tshall move information associated with the instance used for 'floor participant interface toward the MCPTT client state transition' to the 'basic floor control operation towards the floor participant' state machine;\nNOTE:\t Which information that needs to be moved is an implementation option.\n3.\tshall enter the 'Start-stop' state and terminate the 'floor participant state transition' state machine associated with this MCPTT floor participant and this session; and\n4.\tshall enter the 'U: permitted' state as specified in clause 6.3.5.5.2.\nWhen the floor participant interface toward the MCPTT client receives a Floor Release Multi Talker message from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall remain in the 'P: has permission' state.\nNOTE:\tThe multi-talker feature is not supported in the present document.\nThis clause describes the actions to be taken in all states defined for the 'floor participant state transition' diagram with the exception of the 'Start-stop' and 'Releasing' states.\nIf a Floor Ack message is received from the MCPTT floor participant, the floor participant interface toward the MCPTT client:\n1.\tif an indication exists that a Floor Ack message is expected for the message in the Message Type field;\na.\tshall forward the Floor Ack message to the floor control server interface; and\nb.\tshall remove the indication that a Floor Ack message is expected for the message in the Message Type field; and\nNOTE:\tIt is an implementation option what action to take if an indication exists that a Floor Ack message is expected for the message in the Message Type field, but the Floor Ack message is not received\n2.\tshall remain in the current state.\nIf a Floor Ack message is received from the floor control server interface, the floor participant interface toward the MCPTT client:\n1.\tshall send the Floor Ack message to the MCPTT floor participant; and\n2.\tshall remain in the current state.\nUpon receiving an MCPTT call release step 1 request from the application and signalling plane e.g. when the session is going to be released or when the MCPTT client leaves the session, the floor participant interface toward the MCPTT client:\n1.\tshall stop sending floor control messages to the MCPTT floor participant;\n2.\tshall request the network media interface to stop sending RTP media packets towards to the MCPTT client;\n3.\tshall ignore any floor control messages received from the MCPTT floor participant;\n4.\tshall request the network media interface to stop forwarding RTP media packets from the MCPTT client to the media distributor;\n5.\tshall indicate to the floor control server interface that the MCPTT client has started to disconnect from the session; and\n6.\tshall enter the 'P: Releasing' state.\nThe floor participant interface toward the MCPTT client uses this state while waiting for the application and signalling plane to finalize the release of the session or finalizing the removal of the MCPTT client from the session.\nUpon receiving an MCPTT call release step 2 request from the application and signalling plane, the floor participant interface toward the MCPTT client:\n1.\tshall request the network media interface to release all resources associated with this MCPTT client for this MCPTT call; and\n2.\tshall enter the 'Start-stop' state and terminate the 'floor participant state transition' state machine associated with this MCPTT floor participant and this session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tOff-network floor control",
            "description": "Off-network floor control is not applicable to an IWF.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "8\tCoding",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "The message and field formats specified in 3GPP TS 24.380 [25] clause 8.1 shall be used.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.2\tFloor control",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures specified in 3GPP TS 24.380 [25] clause 8.2 shall be used with the following clarification.\nThe field formats specified in 3GPP TS 24.380 [25] clause 8.2 shall be supported except for fields and field values used for the following features:\n-\tmulti-talker;\n-\tambient listening; and\n-\tfunctional alias.\nThe User ID field of the Floor Request message defined in 3GPP TS 24.380 [25] clause 8.2.4 is also used in Floor Request messages sent by an IWF to an MCPTT server.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.3\tPre-established session call control",
                    "description": "",
                    "summary": "",
                    "text_content": "Pre-established session call control is not applicable to the IWF.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.4\tMBMS subchannel control",
                    "description": "",
                    "summary": "",
                    "text_content": "MBMS subchannel control is not applicable to the IWF.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.5\tMBMS notifications",
                    "description": "",
                    "summary": "",
                    "text_content": "MBMS notifications are not applicable to the IWF.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "9\tCall setup control over pre-established session",
            "description": "Call setup control over a pre-established session is not applicable to the IWF.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "10\tMBMS procedures",
            "description": "MBMS procedures are not applicable to the IWF.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "11\tConfigurable parameters",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "11.1\tTimers",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "11.2\tCounters",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "12\tExtensions within the present document",
            "description": "No extensions are defined in the present document.\nThe IWF shall support the session description types defined in 3GPP TS 24.380 [25] clause 12.1.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "13\tMedia plane security",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "13.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Media plane security provides integrity and confidentiality protection of individual media streams and media plane control messages in MCPTT sessions.\nThe media plane security is based on the 3GPP MCPTT security solution including key management and end-to-end media and floor control messages protection as defined in 3GPP TS 33.180 [18].\nVarious keys and associated key identifiers protect:\n1.\tRTP transported media;\n2.\tRTCP transported media control messages (i.e. RTCP SR packets, RTCP RR packets, RTCP SDES packets); and\n3.\tRTCP APP transported floor control messages.\nIn an on-network group call of an MCPTT group which is not a constituent MCPTT group of a temporary MCPTT group:\n1.\tif protection of media is negotiated, the GMK and the GMK-ID of the MCPTT group protect the media sent and received by MCPTT clients and users homed in the IWF;\n2.\tif protection of floor control messages between the IWF performing the participating role and the controlling MCPTT function or between the IWF performing the controlling role and the participating MCPTT function is negotiated, the SPK and the SPK-ID protect the floor control messages sent and received between the IWF performing the participating role and the controlling MCPTT function or between the IWF performing the controlling role and the participating MCPTT function; and\n3.\tif protection of media control messages between the IWF performing the participating role and the controlling MCPTT function or between the IWF performing the controlling role and the participating MCPTT function is negotiated, the SPK and the SPK-ID protect the media control messages sent and received between the IWF performing the participating role and the controlling MCPTT function or between the IWF performing the controlling role and the participating MCPTT function.\nIn an on-network group call of an MCPTT group which is a constituent MCPTT group of a temporary MCPTT group:\n1.\tif protection of media is negotiated, the GMK and the GMK-ID of the temporary MCPTT group protect the media sent and received by an MCPTT client and a user homed in the IWF;\n2.\tif protection of floor control messages between the IWF performing the participating role and the non-controlling MCPTT function or between the IWF performing the non-controlling role and the participating MCPTT function is negotiated, the SPK and the SPK-ID protect the floor control messages sent and received between the IWF performing the participating role and the non-controlling MCPTT function or between the IWF performing the non-controlling role and participating MCPTT function;\n3.\tif protection of floor control messages between the IWF performing the non-controlling role and the controlling MCPTT function or between the IWF performing the controlling role and the non-controlling MCPTT function is negotiated, the SPK and the SPK-ID protect the floor control messages sent and received between the IWF performing the non-controlling role and the controlling MCPTT function or between the IWF performing the controlling role and the non-controlling MCPTT function;\n4.\tif protection of media control messages between the IWF performing the participating role and the non-controlling MCPTT function or between the IWF performing the non-controlling role and the participating MCPTT function is negotiated, the SPK and the SPK-ID protect the media control messages sent and received between the IWF performing the participating role and the non-controlling MCPTT function or between the IWF performing the non-controlling role and the participating MCPTT function; and\n5.\tif protection of media control messages between the IWF performing the non-controlling role and the controlling MCPTT function or between the IWF performing the controlling role and the non-controlling MCPTT function is negotiated, the SPK and the SPK-ID protect the media control messages sent and received between the IWF performing the non-controlling role and the controlling MCPTT function or between the IWF performing the controlling role and the non-controlling MCPTT function.\nIn an on-network private call:\n1.\tif protection of media is negotiated, the PCK and the PCK-ID protect media sent and received by the MCPTT client and the user homed in the IWF;\n2.\tif protection of floor control messages between the IWF performing the participating role and the controlling MCPTT function or between the IWF performing the controlling role and the participating MCPTT function is negotiated, the SPK and the SPK-ID protect the floor control messages sent and received between the IWF performing the participating role and the controlling MCPTT function or between the IWF performing the controlling role and the participating MCPTT function; and\n3.\tif protection of media control messages between the IWF performing the participating role and the controlling MCPTT function or between the IWF performing the controlling role and the participating MCPTT function is negotiated, the SPK and the SPK-ID protect the media control messages sent and received between the IWF performing the participating role and the controlling MCPTT function or between the IWF performing the controlling role and the participating MCPTT function.\nThe GMK and the GMK-ID are distributed to the MCPTT clients using the group document subscription and notification procedure specified in 3GPP TS 24.481 [12].\nThe GMK and the GMK-ID are distributed to the IWF by the MCPTT GMS per the procedures specified in 3GPP TS 24.481 [12] for distribution of the GMK and GMK-ID to an MCPTT server.\nHow the GMK and the GMK-ID are distributed to floor participants homed in the IWF is out of scope of the present document.\nThe SPK and the SPK-ID are configured in the IWF for all the roles it performs.\nIf a private call that passes through the IWF is initiated by an MCPTT client, the PCK and the PCK-ID are generated by the MCPTT client initiating the private call and provided to the IWF using SIP signalling according to 3GPP TS 24.379 [2], using the Connect message described in clause 8.3.4.\nIf a private call that passes through the IWF is initiated by a user homed in the IWF, the PCK and the PCK-ID are generated by the IWF and provided to the MCPTT client receiving the private call using SIP signalling according to 3GPP TS 24.379 [2], using the Connect message described in clause 8.3.4.\nNOTE:\tThe distribution and provisioning of LMR keys by the LMR system to entities in the MCPTT system is out of scope.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "13.2\tDerivation of SRTP/SRTCP master keys",
                    "description": "",
                    "summary": "",
                    "text_content": "Each key (i.e. GMK, PCK, SPK) and its associated key identifier (i.e. GMK-ID, PCK-ID, SPK-ID) described in clause 13.1 are used to derive SRTP-MK, SRTP-MS and SRTP-MKI.\nSRTP-MK, SRTP-MS and SRTP-MKI are used in encryption of media or floor control messages in SRTP as specified in IETF RFC 3711 [16] and 3GPP TS 33.180 [18].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "13.3\tMedia plane encryption and decryption",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "13.3.1\tGeneral",
                            "text_content": "Void.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.3.2\tThe IWF performing the participating role",
                            "text_content": "The IWF performing the participating role:\n1.\tif protection of media is negotiated, shall be transparent to RTP media streams and shall forward encrypted RTP media streams without decrypting the payload;\n2.\tif protection of floor control messages between the IWF performing the participating role and the controlling MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the participating role:\nA)\tshall encrypt floor control messages sent to the controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tshall decrypt floor control messages received from the controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;\n3.\tif protection of floor control messages between the IWF performing the participating role and the non-controlling MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the participating role:\nA)\tshall encrypt floor control messages sent to the non-controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tshall decrypt floor control messages received from the non-controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;\n4.\tif protection of media control messages between the IWF performing the participating role and the controlling MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the participating role:\nA)\tshall encrypt media control messages sent to the controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tshall decrypt media control messages received from the controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\n5.\tif protection of media control messages between the IWF performing the participating role and the non-controlling MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the participating role:\nA)\tshall encrypt media control messages sent to the non-controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tshall decrypt media control messages received from the non-controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.3.3\tThe IWF media endpoint",
                            "text_content": "The IWF media endpoint:\n1.\tin an on-network group call of an MCPTT group which is not a constituent MCPTT group of a temporary MCPTT group:\nA)\tif protection of media is negotiated and the GMK and the GMK-ID of the MCPTT group were received using the group document subscription and notification procedure specified in 3GPP TS 24.481 [12] for the MCPTT group:\ni)\tshall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and GMK-ID as specified in clause 13.2; and\nii)\tshall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and GMK-ID as specified in clause 13.2;\n2.\tin an on-network group call of an MCPTT group which is a constituent MCPTT group of a temporary MCPTT group:\nA)\tif protection of media is negotiated and the GMK and the GMK-ID of the temporary MCPTT group were received using the group document subscription and notification procedure specified in 3GPP TS 24.481 [12] for the constituent MCPTT group:\ni)\tshall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and GMK-ID of the temporary MCPTT group as specified in clause 13.2; and\nii)\tshall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and GMK-ID of the temporary MCPTT group as specified in clause 13.2; and\n3.\tin an on-network private call:\nA)\tif:\ni)\tprotection of media is negotiated in an originating call and the PCK and the PCK-ID were sent to the remote MCPTT client using SIP signalling according to 3GPP TS 24.379 [2]; or\nii)\tprotection of media is negotiated in a terminating call and the PCK and the PCK-ID were received from the remote MCPTT client using SIP signalling according to 3GPP TS 24.379 [2];\nthen:\ni)\tshall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and PCK-ID as specified in clause 13.2; and\nii)\tshall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and PCK-ID as specified in clause 13.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.3.4\tThe IWF performing the controlling role",
                            "text_content": "The IWF performing the controlling role:\n1.\tif protection of media is negotiated, shall be transparent to RTP media streams and shall forward encrypted RTP media streams without decrypting the payload;\n2.\tin an on-network group call of an MCPTT group which is not a constituent MCPTT group of a temporary MCPTT group:\nA)\tif protection of floor control messages between the IWF performing the controlling role and the participating MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the controlling role:\ni)\tshall encrypt floor control messages sent to the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nii)\tshall decrypt floor control messages received from the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tif protection of media control messages between the IWF performing the controlling role and the participating MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the controlling role:\ni)\tshall encrypt media control messages sent to the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nii)\tshall decrypt media control messages received from the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;\n3.\tin an on-network group call of an MCPTT group which is a constituent MCPTT group of a temporary MCPTT group:\nA)\tif protection of floor control messages between the IWF performing the controlling role and the non-controlling MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the controlling role:\ni)\tshall encrypt floor control messages sent to the non-controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nii)\tshall decrypt floor control messages received from the non-controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tif protection of media control messages between the IWF performing the controlling role and the non-controlling MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the controlling role:\ni)\tshall encrypt media control messages sent to the non-controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nii)\tshall decrypt media control messages received from the non-controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\n4.\tin an on-network private call:\nA)\tif protection of floor control messages between the IWF performing the controlling role and the participating MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the controlling role:\ni)\tshall encrypt floor control messages sent to the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nii)\tshall decrypt floor control messages received from the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tif protection of media control messages between the IWF performing the controlling role and the participating MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the controlling role:\ni)\tshall encrypt media control messages sent to the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;\nii)\tshall decrypt media control messages received from the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.3.5\tThe IWF performing the non-controlling role",
                            "text_content": "The IWF performing the non-controlling role:\n1.\tif protection of media is negotiated, shall be transparent to RTP media streams and shall forward encrypted RTP media streams without decrypting the payload;\n2.\tif protection of floor control messages between the IWF performing the non-controlling role and the participating MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the non-controlling role:\nA)\tshall encrypt floor control messages sent to the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tshall decrypt floor control messages received from the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;\n3.\tif protection of floor control messages between the IWF performing the non-controlling role and the controlling MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the non-controlling role:\nA)\tshall encrypt floor control messages sent to the controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tshall decrypt floor control messages received from the controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;\n4)\tif protection of media control messages between the IWF performing the non-controlling role and the participating MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the non-controlling role:\nA)\tshall encrypt media control messages sent to the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tshall decrypt media control messages received from the participating MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\n5)\tif protection of media control messages between the IWF performing the non-controlling role and the controlling MCPTT function is negotiated and the SPK and the SPK-ID are configured in the IWF, then the IWF performing the non-controlling role:\nA)\tshall encrypt media control messages sent to the controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2; and\nB)\tshall decrypt media control messages received from the controlling MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "14\tSDP offer/ answer procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "14.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The IWF shall operate per 3GPP TS 24.380 [25] clause 14.1.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "14.2\tGenerating an SDP offer",
                    "description": "",
                    "summary": "",
                    "text_content": "The IWF shall generate an SDP offer per 3GPP TS 24.380 [25] clause 14.2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "14.3\tGenerating the SDP answer",
                    "description": "",
                    "summary": "",
                    "text_content": "The IWF shall generate an SDP answer per 3GPP TS 24.380 [25] clause 14.3.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "14.4\tOfferor processing of the SDP answer",
                    "description": "",
                    "summary": "",
                    "text_content": "The IWF shall process an SDP answer per 3GPP TS 24.380 [25] clause 14.4.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "14.5\tModifying the media plane control channel",
                    "description": "",
                    "summary": "",
                    "text_content": "The IWF shall support modification of the media plane control channel per 3GPP TS 24.380 [25] clause 14.5.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "14.6\tThe use of SDP offer / answer procedures in off-network mode",
                    "description": "",
                    "summary": "",
                    "text_content": "The use of SDP offer / answer procedures in off-network mode is not applicable to the IWF.\n\n\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 4,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}