{
    "document_name": "33511-i20.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document contains objectives, requirements and test cases that are specific to the gNB network product class. It refers to the Catalogue of General Security Assurance Requirements and formulates specific adaptions of the requirements and test cases given there, as well as specifying requirements and test cases unique to the gNB network product class.\nNOTE:\tTest cases for the split gNB product classes are specified in TS 33.523 [9].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 33.501: \"Security architecture and procedures for 5G system\".\n[3]\t3GPP TS 33.117: \"Catalogue of general security assurance requirements\".\n[4]\tVoid\n[5]\t3GPP TR 33.926: \"Security Assurance Specification (SCAS) threats and critical assets in 3GPP network product classes\".\n[6]\t3GPP TS 38.331: \"NR; Radio Resource Control (RRC) protocol specification\".\n[7]\t3GPP TS 23.501: \"System Architecture for 5G System (5GS)\".\n[8]\t3GPP TS 38.300: \"NR and NG-RAN Overall Description\".\n[9]\t3GPP TS 33.523: \"5G Security Assurance Specification (SCAS); split gNB product classes\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions of terms and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tTerms",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\n5GC\t5G Core Network\nAMF\tAccess and Mobility Management Function\ngNB\tNR Node B\nNG\tNext Generation\nNG-RAN\t5G Radio Access Network\nSMF\tSession Management Function\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tgNodeB-specific security requirements and related test cases",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "gNB specific security requirements include both requirements derived from gNB-specific security functional requirements as well as security requirements derived from threats specific to gNB as described in TR 33.926 [5]. Generic security requirements and test cases common to other network product classes have been captured in TS 33.117 [3] and are not repeated in the present document.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tgNodeB-specific security functional adaptations of requirements and related test cases",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2.1\tIntroduction",
                            "text_content": "Present clause contains gNB-specific security functional adaptations of requirements and related test cases.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.2\tSecurity functional requirements on the gNodeB deriving from 3GPP specifications and related test cases",
                            "text_content": "Requirement Name: Integrity protection of RRC-signalling\nRequirement Reference: TS 33.501 [2], clause 5.3.3\nRequirement Description: The gNB supports integrity protection and replay protection of RRC-signalling as specified in TS 33.501 [2], clause 5.3.3.\nThreat References: TR 33.926 [5], clause D.2.2.2 – Control plane data integrity protection.\nTest Case:\nTest Name: TC_CP_DATA_INT_RRC-SIGN_gNB\nPurpose: To verify that the RRC-signalling data sent between UE and gNB over the NG RAN air interface are integrity protected.\nPre-Condition:\n-\tThe gNB network product shall be connected in emulated/real network environments. UE may be simulated.\n-\tTester shall have access to the integrity algorithm and the integrity protection keys.\n-\tThe tester can capture the message via the NG RAN air interface, or can capture the message at the UE.\nExecution Steps:\n1. The NIA0 is disabled at UE and gNB.\n2. gNB sends AS SMC message to the UE, and UE responses AS SMP.\n3. Check any RRC message sent by gNB after sending AS SMC and before UE enters CM-Idle state is integrity protected.\nExpected Results:\nAny RRC-signalling over the NG RAN air interface is integrity protected after gNB sending AS SMC.\nExpected format of evidence:\nEvidence suitable for the interface, e.g. Screenshot containing the operational results.\nRequirement Name: Integrity protection of user data between the UE and the gNB.\nRequirement Reference: TS 33.501 [2], clause 5.3.3\nRequirement Description: The gNB supports integrity protection and replay protection of user data between the UE and the gNB  as specified in TS 33.501 [2], clause 5.3.3.\nNOTE: \tThis requirement does not apply to the gNB that is used as a secondary node connecting to the EPC.\nThreat References: TR 33.926 [5], clause D.2.2.4 – User plane data integrity protection.\nTest Case:\nTest Name: TC-UP-DATA-INT_gNB\nPurpose: To verify that the user data packets are integrity protected over the NG RAN air interface.\nPre-Condition:\n-\tThe gNB network product shall be connected in emulated/real network environments. UE may be simulated.\n-\tTester shall enable the user plane integrity protection and ensure NIA0 is not used.\n-\tTester shall have knowledge of integrity algorithm and integrity protection keys.\n-\tThe tester can capture the message via  the NG RAN air interface, or can capture the message at the UE.\nExecution Steps:\n1. The NIA0 is disabled at UE and gNB.\n2. gNB sends RRCConnectionReconfiguration with integrity protection indication \"on\".\n3. Check any User data sent by gNB after sending RRCConnectionReconfiguration and before UE enters CM-Idle state is Integrity protected.\nExpected Results:\nAny user plane packets sent between UE and gNB over the NG RAN air interface after gNB sending RRCConnectionReconfiguration is integrity protected.\nExpected format of evidence:\nEvidence suitable for the interface e.g. Screenshot containing the operational results.\nRequirement Name: RRC integrity check failure\nRequirement Reference: TS 33.501 [2], clause 6.5.1\nRequirement Description: The RRC integrity checks are performed both in the ME and the gNB. In case failed integrity check (i.e. faulty or missing MAC-I) is detected after the start of integrity protection, the concerned message is discarded. This can happen on the gNB side or on the ME side, as specified in TS 33.501 [2], clause 6.5.1.\nThreat References: TR 33.926 [5], clause D.2.2.2, Control plane data integrity protection\nTest Case:\nTest Name: TC-CP-DATA-RRC-INT-CHECK_gNB\nPurpose:\nVerify that RRC integrity check failure is handled correctly by the gNB.\nPre-Conditions:\nTest environment with a UE. The UE may be simulated. RRC integrity protection is activated at the gNB.\nExecution Steps\n1a)\tThe UE sends a RRC message to the gNB without MAC-I; or\n1b)\tThe UE sends a RRC message to the gNB with a wrong MAC-I.\n2b)\tThe gNB verifies the integrity of the RRC message from the UE.\nExpected Results:\nThe RRC message is discarded by the gNB after step 1a) or after step 2b).\nExpected format of evidence:\nSample copies of the log files.\nRequirement Name: UP integrity check failure\nRequirement Reference: TS 33.501 [2], clause 6.6.4\nRequirement Description: If the gNB or the UE receives a PDCP PDU which fails integrity check with faulty or missing MAC-I after the start of integrity protection, the PDU is discarded as specified in TS 33.501 [2], clause 6.6.4.2.\nThreat References: TR 33.926 [5], clause D.2.2.4, User plane data integrity protection\nTest Case:\nPurpose:\nVerify that UP integrity check failure is handled correctly by the gNB.\nPre-Conditions:\nTest environment with a UE. The UE may be simulated. UP integrity protection is activated at the gNB.\nExecution Steps\n1a)\tThe UE sends a PDCP PDU to the gNB without MAC-I; or\n1b)\tThe UE sends a PDCP PDU to the gNB with a wrong MAC-I.\n2b)\tThe gNB verifies the integrity of the PDCP PDU from the UE.\nExpected Results:\nThe PDCP PDU is discarded by the gNB after step 1a) or after step 2b).\nExpected format of evidence:\nEvidence suitable for the interface e.g. Screenshot containing the operational results.\nRequirement Name: Ciphering of RRC-signalling\nRequirement Reference: TS 33.501 [2], clause 5.3.2\nRequirement Description: The gNB supports ciphering of RRC-signalling as specified in TS 33.501 [2], clause 5.3.2.\nThreat References: TR 33.926 [5], clause D.2.2.1 – Control plane data confidentiality protection.\nTest Case:\nTest Name: TC-CP-DATA-CIP-RRC-SIGN_gNB\nPurpose: To verify that the RRC-signalling data sent between UE and gNB over the NG RAN air interface are confidentiality protected.\nPre-Condition:\n-\tThe gNB network product shall be connected in emulated/real network environments. The UE may be simulated.\n-\tThe tester shall have access to the NG RAN air interface or can capture the message at the UE.\nExecution Steps:\n1. The UE sends a Registraton Request to the AMF.\n2. The AMF sends a KgNB and the UE security capability to the gNB.\n3. The gNB selects an algorithm and sends AS SMC to the UE.\n4. The gNB receive AS SMP from the UE.\nExpected Results:\nControl plane packets sent to the UE after the gNB sends AS SMC is ciphered.\nExpected format of evidence:\nEvidence suitable for the interface, e.g. Screenshot containing the operational results.\nRequirement Name: Ciphering of user data between the UE and the gNB\nRequirement Reference: TS 33.501 [2], clause 5.3.2\nRequirement Description:  The gNB supports ciphering of user data between the UE and the gNB. as specified in TS 33.501 [2], clause 5.3.2.\nThreat References: TR 33.926 [5], clause D.2.2.3 – User plane data confidentiality protection at gNB\nTest Case:\nTest Name: TC-UP-DATA-CIP_gNB\nPurpose: To verify that the user data packets are confidentiality protected over the NG RAN air interface.\nPre-Condition:\n-\tThe gNB network product shall be connected in emulated/real network environments. The UE may be simulated.\n-\tThe tester shall have access to the NG RAN air interface or can capture the message at the UE.\nExecution Steps:\n1. The UE sends PDU session establishment Request to the SMF.\n2. The SMF sends a UP security policy with UP ciphering required or preferred to the gNB.\n3. The gNB sends RRCConnectionReconfiguration with ciphering protection indication \"on\".\n4. Check any user data sent by the gNB after sending RRCConnectionReconfiguration and before the UE enters into CM-Idle state.\n\nExpected Results:\nThe user plane packets sent to the UE after the gNB sends RRCConnectionReconfiguration is confidentiality protected.\nExpected format of evidence:\nEvidence suitable for the interface e.g. Screenshot containing the operational results.\nRequirement Name: Replay protection of user data between the UE and the gNB.\nRequirement Reference: TS 33.501 [2], clause 5.3.3\nRequirement Description: The gNB supports integrity protection and replay protection of RRC-signalling as specified in TS 33.501 [2], clause 5.3.3.\nThreat References: TR 33.926 [5], clause D.2.2.4 – User plane data integrity protection.\nTest Case:\nTest Name: TC-UP-DATA-REPLAY_gNB\nPurpose: To verify that the user data packets are replay protected over the NG RAN air interface.\nPre-Condition:\n-\tThe gNB network product shall be connected in emulated/real network environments. The UE may be simulated.\n-\tThe tester shall have access to the NG RAN air interface.\n-\tThe tester shall active the user plane integrity protection of the RRC-signalling packets.\nExecution Steps:\n1.\tThe tester shall capture the user plane data sent between UE and gNB using any network analyser over the NG RAN air interface.\n2.\tTester shall filter user plane data packets sent between UE and gNB.\n3.\tTester shall replay the captured user plane packets or shall use any packet crafting tool to create a user plane packet similar to the captured user plane packet and replay to the gNB.\n4.\tTester shall check whether the replayed user plane packets were processed by the gNB by capturing over NG RAN air interface to see if any corresponding response message is received from the gNB.\n5.\tTester shall confirm that gNB provides replay protection by dropping/ignoring the replayed packet if no corresponding response is received from the gNB to the replayed packet.\n6.\tTester shall verify from the result that if the replayed user plane packets are not accepted by gNB, the NG RAN air interface is replay protected.\nExpected Results:\nThe user plane packets sent between the UE and gNB over the NG air interface is replay protected.\nExpected format of evidence:\nEvidence suitable for the interface, e.g. Screenshot containing the operational results.\nRequirement Name: Replay protection of RRC-signalling.\nRequirement Reference: TS 33.501 [2], clause 5.3.3\nRequirement Description: The gNB supports integrity protection and replay protection of RRC-signalling as specified in TS 33.501 [2], clause 5.3.3.\nThreat References: TR 33.926 [5], clause D.2.2.2 – Control plane data integrity protection.\nTest Case:\nTest Name: TC-UP-DATA-RRC-REPLAY_gNB\nPurpose: To verify the replay protection of RRC-signalling between UE and gNB over the NG RAN air interface.\nPre-Condition:\n-\tThe gNB network product shall be connected in emulated/real network environments.\n-\tTester shall have knowledge of the integrity algorithm and the corresponding protection keys.\n-\tThe tester shall have access to the NG RANs air interface.\n-\tThe tester shall active the integrity protection of RRC-signalling.\nExecution Steps:\n1.\tThe tester shall capture the data sent between UE and the gNB using any network analyser over the NG RAN air interface.\n2.\tTester shall filter RRC signalling packets.\n3.\tTester shall check for the RRC SQN of the filtered RRC signalling packets and shall use any packet crafting tool to create RRC signalling packets similar to the captured packets or the tester shall replay the captured RRC uplink packet to the gNB to perform the replay attack over gNB.\n4.\t Tester shall check whether the replayed RRC signalling packets were processed by the gNB or not, by capturing over NG RAN air interface to see if any corresponding response message is received from the gNB.\n5.\tTester shall confirm that gNB provides replay protection by dropping/ignoring the replayed packet if no corresponding response is sent by the gNB to the replayed packet.\nExpected Results:\nThe RRC signalling over the NG RAN air interface is replay protected.\nExpected format of evidence:\nEvidence suitable for the interface, e.g. Screenshot containing the operational results.\nRequirement Name: Ciphering of user data based on the security policy sent by the SMF\nRequirement Reference: TS 33.501 [2], clause 5.3.2\nRequirement Description: The gNB  activates ciphering of user data based on the security policy sent by the SMF as specified in TS 33.501 [2], clause 5.3.2.\nThreat References: TR 33.926 [5], clause D.2.2.8 – Security Policy Enforcement.\nTest Case:\nTest Name: TC-UP-DATA-CIP-SMF\nPurpose: To verify that the user data packets are confidentiality protected based on the security policy sent by the SMF via AMF\nPre-Condition:\n-\tThe gNB network product shall be connected in emulated/real network environments. The UE and the 5GC may be simulated.\n-\tThe tester shall have access to the NG RAN air interface.\n-\tThe tester shall have knowledge of the RRC and UP ciphering algorithm and protection keys.\n-\tRRC ciphering is already activated at the gNB.\nExecution Steps:\n1.\tThe tester triggers PDU session establishment procedure by sending PDU session establishment request message.\n2.\tTester shall trigger the SMF to send the UP security policy with ciphering protection \"required\" or \"not needed\" to the gNB.\n3.\tThe tester shall capture the RRC reconfiguration procedure between gNB to UE over NG RAN air interface. And filter the RRC reconfiguration message sent by gNB to UE.\n4.\tThe tester shall decrypt the RRC Reconfiguration message and retrieve the UP ciphering protection indication presenting in the decrypted message.\n5.\tThe tester shall verify if the UP security policy received at gNB is same as the UP ciphering protection indication notified by the gNB to the UE in the RRC Reconfiguration message.\n6.\tTester shall capture the RRC Reconfiguration complete message sent between UE and gNB.\n6a.\tTester shall capture the user plane data sent between UE and gNB using any network analyser.\n7.\tTester shall check that the captured  UP data is activated/de-activated  according to the UP security policy.\nExpected Results:\nWhen the received UP cipher protection indication is set to “required”, the captured user plane data appear to be garbled (i.e. no longer plaintext) and the user plane packets are confidentiality protected based on the UP security policy sent by the SMF.\nWhen the received UP cipher protection indication is set to \"not needed\", the captured user plane data appear to be plaintext and the user plane packets are not confidentiality protected based on the UP security policy sent by the SMF.\nExpected format of evidence:\nEvidence suitable for the interface, e.g. Screenshot containing the operational results.\nRequirement Name: Integrity of user data based on the security policy sent by the SMF\nRequirement Reference: TS 33.501 [2], clause 5.3.2\nRequirement Description: The gNB activates integrity protection of user data based on the security policy sent by the SMF as specified in TS 33.501 [2], clause 5.3.2.\nThreat References: TR 33.926 [5], clause D.2.2.8 – Security Policy Enforcement.\nTest Case:\nTest Name: TC-UP-DATA-INT-SMF\nPurpose: To verify that the user data packets are integrity protected based on the security policy sent by the SMF.\nPre-Condition:\n-\t The gNB network product shall be connected in emulated/real network environments. The UE and the 5GC may be simulated.\n-\tThe tester shall have access to the NG RAN air interface.\n-\tThe tester shall have knowledge of the integrity algorithm and protection keys.\n-\tRRC integrity and cipher are already activated at the gNB.\n\nExecution Steps:\n1.\tThe tester triggers PDU session establishment procedure by sending PDU session establishment request message.\n2.\tTester shall trigger the SMF to send the UP security policy with integrity protection is \"required\" or \"not needed\" to the gNB.\n3.\tThe tester shall capture the RRC reconfiguration message sent by gNB to UE over NG RAN air interface.\n4.\tThe tester shall decrypt the RRC reconfiguration message and retrieve the UP integrity protection indication presenting in the decrypted message.\n5.\tTester shall check whether UP integrity is enabled /disabled to verify if the UP security policy received at gNB is same as the UP integrity protection indication notified by the gNB to the UE in the RRC reconfiguration message.\n6.\tTester shall capture the user plane data sent between UE and gNB using any network analyser.\n7.\tThe tester shall check whether the user plane data packet contains a message authentication code.\n\nExpected Results:\nWhen the received UP integrity protection is set to \"required\", the user plane data packet contains a message authentication code and the user plane packets are integrity protected based on the security policy sent by the SMF.\nWhen the received UP interity protection is set to \"not needed\", the user plane data packet message authentication code is not present and the user plane packets are not integrity protected based on the security policy sent by the SMF.\nExpected format of evidence:\nEvidence suitable for the interface, e.g. Screenshot containing the operational results.\nRequirement Name: AS algorithms selection\nRequirement Reference: TS 33.501 [2], clause 6.7.3.0 and clause 5.11.2.\nRequirement Description: The serving network selects the algorithms to use dependent on: the UE security capabilities of the UE, the configured allowed list of security capabilities of the currently serving network entity as specified in TS 33.501 [2], clause 5.11.2.\n\"Each gNB/ng-eNB is configured via network management with lists of algorithms which are allowed for usage. There is one list for integrity algorithms, and one for ciphering algorithms. These lists are ordered according to a priority decided by the operator.\" as specified in TS 33.501 [2], clause 6.7.3.0.\nThreat References: TR 33.926 [5], D.2.2.5 – AS algorithm selection and use\nTest Case:\nTest Name: TC-AS-alg-select_gNB\nPurpose:\nVerify that the gNB selects the algorithms with the highest priority in its configured list.\nPre-Conditions:\nTest environment with the gNB has been pre-configured with allowed security algorithms with priority.\nExecution Steps\n1)\tThe UE sends registration request message to the gNB.\n2)\tThe gNB receives UE context setup request message.\n3)\tThe gNB sends the AS SECURITY MODE COMMAND message.\n4)\tThe UE replies with the AS SECURITY MODE COMPLETE message.\nExpected Results:\nThe gNB initiates the SECURITY MODE COMMAND message that includes the chosen algorithm with the highest priority according to the ordered lists and is contained in the UE NR security capabilities.\nThe MAC in the AS SECURITY MODE COMPLETE message is verified, and the AS protection algorithms are selected and applied correctly.\nExpected format of evidence:\nSample copies of the log files.\nRequirement Name: Key refresh at the gNB\nRequirement Reference: TS 33.501 [2], clause 6.9.4.1; TS 38.331 [6], clause 5.3.1.2\nRequirement Description: Key refresh is possible for KgNB, KRRC-enc, KRRC-int, KUP-enc, and KUP-int (if available), and is to be initiated by the gNB/ng-eNB when a PDCP COUNTs are about to be re-used with the same Radio Bearer identity and with the same KgNB. as specified in TS 33.501 [2], clause 6.9.4.1.\nThe network is responsible for avoiding reuse of the COUNT with the same RB identity and with the same key, e.g. due to the transfer of large volumes of data, release and establishment of new RBs, and multiple termination point changes for RLC-UM bearers and multiple termination point changes for RLC-AM bearer with SN terminated PDCP re-establishment (COUNT reset) due to SN only full configuration whilst the key stream inputs (i.e. bearer ID, security key) at MN have not been updated. In order to avoid such re-use, the network e.g. uses different RB identities for RB establishments, change the AS security key, or an RRC_CONNECTED to RRC_IDLE/RRC_INACTIVE and then to RRC_CONNECTED transition as specified in TS 38.331 [6], clause 5.3.1.2.\nThreat References: TR 33.926 [5], clause D.2.2.7 Key Reuse\nTest Case :\nTest Name: TC_GNB_KEY_REFRESH_DRB_ID\nPurpose:\nVerify that the gNB performs KgNB refresh when DRB-IDs are about to be reused under the following conditions:\n-\tthe successive Radio Bearer establishment uses the same RB identity while the PDCP COUNT is reset to 0, or\n-\tthe PDCP COUNT is reset to 0 but the RB identity is increased after multiple calls and wraps around.\nPre-Conditions:\nThe UE, AMF and SMF may be simulated.\nExecution Steps\n1)  The gNB sends the AS Security Mode Command message to the UE.\n2)\tThe UE responds with the AS Security Mode Complete message.\n3)\tA DRB is set up.\n4)\tDRB is set up and torn down for multiple times within one active radio connection without the UE going to idle (e.g. by the UE making multiple IMS calls, or by the SMF requesting PDU session modification and deactivation via the AMF), until the DRB ID is reused.\nExpected Results:\nBefore DRB ID reuse, the gNB takes a new KgNB into use by e.g. triggering an intra-cell handover or triggering a transition from RRC_CONNECTED to RRC_IDLE or RRC_INACTIVE and then back to RRC_CONNECTED.\nExpected format of evidence:\nPart of log that shows all the DRB identities and the intra-cell handover or the transition from RRC_CONNECTED to RRC_IDLE or RRC_INACTIVE and then back to RRC_CONNECTED. This part can be presented, for example, as a screenshot.\nRequirement Name: Bidding Down Prevention\nRequirement Reference: TS 33.501 [2], clause 6.7.3.1\nRequirement Description: In the Path-Switch message, the target  gNB/ng-eNB sends the UE's 5G security capabilities received from the source gNB/ng-eNB to the AMF. as specified in TS 33.501 [2], clause 6.7.3.1.\nThreat References: TR 33.926 [5], clause D.2.2.6 Bidding Down on Xn-Handover\nTest Case:\nTest Name: TC-Xn-handover_bid_down_gNB\nPurpose:\nVerify that bidding down is prevented in Xn-handovers.\nPre-Conditions:\nTest environment with source gNB and target gNB, and the source gNB may be simulated.\nExecution Steps:\nThe target gNB sends the path-switch message to the AMF.\nExpected Results:\nThe UE NR security capabilities are in the path-switch message.\nExpected format of evidence:\nSnapshots containing the result.\nRequirement Name: AS protection algorithm selection in gNB change.\nRequirement Reference: TS 33.501 [2], clauses 6.7.3.1 and 6.7.3.2\nRequirement Description: The target gNB/ng-eNB selects the algorithm with highest priority from the received 5G security capabilities of the UE according to the prioritized locally configured list of algorithms (this applies for both integrity and ciphering algorithms). The chosen algorithms are indicated to the UE in the Handover Command message if the target gNB/ng-eNB selects different algorithms compared to the source gNB/ng-eNB as specified in TS 33.501 [2], clause 6.7.3.1, and clause 6.7.3.2.\nThreat References: TR 33.926 [5], D.2.2.5 – AS algorithm selection and use\nTest Case:\nTest Name: Alg_select_change_gNB\nPurpose:\nVerify that AS protection algorithm is selected correctly.\nPre-Conditions:\nTest environment with source gNB, target gNB and AMF. Source gNB and AMF may be simulated.\nExecution Steps:\nTest Case 1:\nSource gNB transfers the ciphering and integrity algorithms used in the source cell to the target gNB in the handover request message.\nTarget gNB verifies the algorithms and selects AS algorithms which have the highest priority according to the ordered lists. Target gNB includes the algorithm in the handover command.\nTest Case 2:\nAMF sends the UE NR security capability to the Target gNB.\nThe target gNB selects the AS algorithms which have the highest priority according to the ordered lists in the HANDOVER COMMAND.\nThe above test cases assume that the algorithms selected by the target gNB are different from the ones received from the source gNB.\nExpected Results:\nFor both test cases:\n1.\tThe UE checks the message authentication code on the handover command message.\n2.\tThe MAC in the handover complete message is verified, and the AS integrity protection algorithm is selected and applied correctly.\nExpected format of evidence:\nSnapshots containing the result.\nRequirement Name: Control plane data confidentiality protection over N2/Xn interface\nRequirement Reference: TS 33.501 [2], clauses 9.2 and 9.4\nRequirement Description: The transport of control plane data over N2 is integrity, confidentiality and replay-protected. The transport of control plane data and user data over Xn is integrity, confidentiality and replay-protected, as specified in TS 33.501 [2], clauses 9.2 and 9.4.\nThreat References: TR 33.926 [5], clause D.2.2.1 – Control plane data confidentiality protection.\nTest Case: the test case in clause 4.2.3.2.4 of TS 33.117 [3]\nRequirement Name: Control plane data integrity protection over N2/Xn interface\nRequirement Reference: TS 33.501[2], clauses 9.2 and 9.4\nRequirement Description: The transport of control plane data over N2 is integrity, confidentiality and replay-protected. The transport of control plane data and user data over Xn is integrity, confidentiality and replay-protected. as specified in TS 33.501 [2], clauses 9.2 and 9.4.\nThreat References: TR 33.926 [5], clause D.2.2.2 – Control plane data integrity protection.\nTest Case: the test case in clause 4.2.3.2.4 of TS 33.117 [3].\nRequirement Name: Key update at the gNB on dual connectivity\nRequirement Reference: TS 33.501 [2], clause 6.10.2.1; clause 6.10.2.2.1;clause 6.10.3.1.\nRequirement Description: When executing the procedure for adding subsequent radio bearer(s) to the same SN, the MN is expected to, for each new radio bearer, assign a radio bearer identity that has not previously been used since the last KSN change. If the MN cannot allocate an unused radio bearer identity for a new radio bearer in the SN, due to radio bearer identity space exhaustion, the MN is expected to increment the SN Counter and compute a fresh KSN, and then is expected to perform a SN Modification procedure to update the KSN as specified in TS 33.501 [2], clause 6.10.2.1.\nThe MN is expected to refresh the root key of the 5G AS security context associated with the SN Counter before the SN Counter wraps around. Refreshing the root key is done using intra cell handover as described in subclause 6.7.3.3 of TS 33.501 [2]. When the root key is refreshed, the SN Counter is reset to '0' as defined above. in that same clause; as specified in TS 33.501 [2], clause 6.10.3.1.\nNOTE:\tThe following testcases are only tested when the NR-NR DC, NE-DC and EN-DC scenarios are deployed.\nThreat References: TR 33.926 [5], clause D.2.2.7 Key Reuse\nTest Case 1:\nTest Name: TC_GNB_DC_KEY_UPDATE_DRB_ID\nPurpose:\nVerify that the gNB under test acting as a Master Node (MN) performs KSN update when DRB-IDs are about to be reused.\nPre-Conditions:\n-\tTest environment with a gNB or ng-eNB acting as the Secondary Node (SN), which may be simulated\n-\tTest environment with a UE, SMF and AMF, which may be simulated\nExecution Steps\n1.\tThe gNB under test establishes RRC connection and AS security context with the UE.\n2.\tThe gNB under test establishes security context between the UE and the SN for the given AS security context shared between the gNB under test and the UE; and generates a KSN sent to the SN.\n3.\tA SCG bearer is set up between the UE and the SN.\n4.\tThe gNB under test is triggered to execute the SN Modification procedure to provide additional available DRB IDs to be used for SN terminated bearers (e.g. by the UE making multiple IMS calls, or by the SMF requesting PDU session modification and deactivation via the AMF), until the DRB IDs are reused.\nExpected Results:\n-\tBefore DRB ID reuse, the gNB under test generates a new KSN and sends it via the SN Modification Request message to the SN.\nExpected format of evidence:\nEvidence suitable for the interface, e.g. text representation of the captured SN Modification Request message.\nTest Case 2:\nTest Name: TC_GNB_DC_KEY_UPDATE_SN_COUNTER\nPurpose:\nVerify that the gNB under test acting as a Master Node (MN) performs KNG-RAN( AS root key) update when SN COUNTER is about to wrap around.\nPre-Conditions:\n-\tTest environment with a gNB or ng-eNB acting as the Secondary Node (SN), which may be simulated\n-\tTest environment with a UE, SMF and AMF, which may be simulated.\nExecution Steps\n1.\tThe gNB under test establishes RRC connection and AS security context with the UE.\n2.\tThe gNB under test establishes security context between the UE and the SN for the given AS security context shared between the gNB under test and the UE; and generates a KSN sent to the SN and increases the value of SN Counter.\n3.\tA SCG bearer is set up between the UE and the SN.\n4.\tThe gNB under test is triggered to execute the SN Modification procedure to provide updated KSN to SN, until the SN Counter value wraps around.\nExpected Results:\n-\tBefore SN Counter wraps around, the gNB under test takes a new KNG-RAN into use by e.g. triggering an intra-cell handover or triggering a transition from RRC_CONNECTED to RRC_IDLE or RRC_INACTIVE and then back to RRC_CONNECTED.\nExpected format of evidence:\nPart of log that shows the SN Counter values before and after wrapping around and the intra-cell handover or the transition from RRC_CONNECTED to RRC_IDLE or RRC_INACTIVE and then back to RRC_CONNECTED. This part can be presented, for example, as a screenshot.\nRequirement Name: UP security activation in Inactive scenario\nRequirement Reference: TS 33.501 [2], clause 6.8.2.1.3.\nRequirement Description: If the UP security activation status can be supported in the target gNB/ng-eNB, the target gNB/ng-eNB uses the UP security activations that the UE used at the last source cell. Otherwise, the target gNB/ng-eNB responds with an RRC Setup message to establish a new RRC connection with the UE as specified in TS 33.501 [2], clause 6.8.2.1.3.\nThreat Reference:  TR 33.926 [5], clause D.2.2.9 State transition from inactive state to connected state.\nTest Name: TC_GNB_INACTIVE_TO_ACTIVE\nPurpose:\nVerify that the target gNB/ng-eNB uses the UP security activation status to activate the UP security.\nPre-Conditions:\n-\tThe gNB network product shall be connected in emulated/real network environments.\n-\tThe UE may be simulated.\nExecution Steps\n1. The tester shall complete a Registration Procedure and PDU Session establishment procedure to make sure the gNB configure the UP security, and get the UP security activation status.\n2. The gNB sends RRC Release message with a suspend config to the UE.\n3. The tester deletes the UP security activation status of the UE.\n4. The tester triggers the UE to send RRC Resume message.\nExpected Results:\nThe gNB sends RRC Setup message to the UE.\nExpected format of evidence:\nScreenshot containing the operational results.\nRequirement Name: User plane data confidentiality protection over N3/Xn interface\nRequirement Reference: TS 33.501 [2], clauses 9.3 and 9.4\nRequirement Description: The transport of user data over N3 is integrity, confidentiality and replay-protected.\nThe transport of control plane data and user data over Xn is integrity, confidentiality and replay-protected as specified in TS 33.501 [2], clauses 9.3 and 9.4.\nThreat References: TR 33.926 [5], clause D.2.2.3 – User plane data confidentiality protection at gNB.\nTest Case: the test case in subclause 4.2.3.2.4 of TS 33.117 [3].\nRequirement Name: User plane data integrity protection over N3/Xn interface\nRequirement Reference: TS 33.501[2], clauses 9.3 and 9.4\nRequirement Description: The transport of user data over N3 is integrity, confidentiality and replay-protected.\nThe transport of control plane data and user data over Xn is integrity, confidentiality and replay-protected as specified in TS 33.501 [2], clauses 9.3 and 9.4.\nThreat References: TR 33.926 [5], clause D.2.2.4 – User plane data integrity protection\nTest Case: the test case in subclause 4.2.3.2.4 of TS 33.117 [3].\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.3\tTechnical Baseline",
                            "text_content": "The present clause provides baseline technical requirements.\nThere are no gNB-specific additions to clause 4.2.3.2.1 of TS 33.117 [3].\nThere are no gNB-specific additions to clause 4.2.3.2.2 of TS 33.117 [3].\nThere are no gNB-specific additions to clause 4.2.3.2.3 of TS 33.117 [3].\nThere are no gNB-specific additions to clause 4.2.3.2.4 of TS 33.117 [3].\nThe requirement and testcase in clause 4.2.3.2.5 of TS 33.117 [3] are not applicable to the gNB network products.\nThere are no gNB-specific additions to clause 4.2.3.3 of TS 33.117 [3].\ngNB-specific adaptation to clause 4.2.3.4.2.1 of TS 33.117 [3] is:\nDual-factor authentication by combining several authentication options as noted in clause 4.2.3.4.2.1 of TS 33.117 [3] for higher level of security is not applicable to the gNB.\nApart from the above exception, there are no other gNB-specific adaptations to clause 4.2.3.4 of TS 33.117 [3].\nThere are no gNB-specific additions to clause 4.2.3.5 of TS 33.117 [3].\nThere are no gNB-specific additions to clause 4.2.3.6 of TS 33.117 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.4\tOperating systems",
                            "text_content": "The gNB-specific additions to clause 4.2.4 of TS 33.117 [3] are:\nFor the requirement defined in clause 4.2.4.1.1.2\tHandling of ICMP of TS 33.117[3]:\n-\t Echo Reply can be sent by default.\n-\tIn case of remote base station auto deployment, Router Advertisement can be processed. Apart from the above exceptions, there are no gNB-specific additions to clause 4.2.4 of TS 33.117 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.5\tWeb servers",
                            "text_content": "There are no gNB-specific additions to clause 4.2.5 of TS 33.117 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.6\tNetwork devices",
                            "text_content": "There are no gNB-specific additions to clause 4.2.6 of TS 33.117 [3].\nThere are no gNB-specific additions to clause 4.2.6.2.1 of TS 33.117 [3].\nThere are no gNB-specific additions to clause 4.2.6.2.2 of TS 33.117 [3].\nThe requirement and testcase in clause 4.2.6.2.3 of TS 33.117 [3] is not applicable to gNB network products.\nThere are no gNB-specific additions to clause 4.2.6.2.4 of TS 33.117 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.7\tVoid",
                            "text_content": "\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.3\tgNodeB-specific adaptations of hardening requirements and related test cases.",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.3.1\tIntroduction",
                            "text_content": "The present clause contains gNB-specific adaptations of hardening requirements and related test cases.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.2\tTechnical Baseline",
                            "text_content": "There are no gNB-specific additions to clause 4.3.2 of TS 33.117 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.3\tOperating Systems",
                            "text_content": "There are no gNB-specific additions to clause 4.3.3 of TS 33.117 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.4\tWeb Servers",
                            "text_content": "There are no gNB-specific additions to clause 4.3.4 of TS 33.117 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.5\tNetwork Devices",
                            "text_content": "There are no gNB-specific additions to clause 4.3.5 of TS 33.117 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.6\tNetwork Functions in service-based architecture",
                            "text_content": "The requirements and test cases in clause 4.3.6 of TS 33.117 [3] are not applicable to the gNB network products.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.4\tgNodeB-specific adaptations of basic vulnerability testing requirements and related test cases",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.4.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "There are no gNB specific addtions to clause 4.4.1 of TS 33.117 [3].\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.4.2\tPort Scanning",
                            "text_content": "There are no gNB specific addtions to clause 4.4.2 of TS 33.117 [3].\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.3\tVulnerability scanning",
                            "text_content": "There are no gNB specific addtions to clause 4.4.3 of TS 33.117 [3].\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.4\tRobustness and fuzz testing",
                            "text_content": "The test cases under clause 4.4.4 of TS 33.117 [3] are applicable to gNB.\n\nThe interfaces defined for the gNB are in clause 4.2.3 of TS 23.501 [7] and in clause 4.1 of TS 38.300 [8].\n\nAccording to clause 4.4.4 of TS 33.117 [3], the transport protocols available on the interfaces providing IP-based protocols need to be robustness tested. Following TCP/IP layer model and considering all the protocols over transport layer, for gNB, the following interfaces and protocols are in the scope of the testing:\n\n-\tFor N2: the SCTP and NGAP procotols.\n-\tFor N3: the UDP and GTP-U protocols.\n-\tFor Xn: the SCTP and XnAP protocols for the control plane, and the UDP and GTP-U protocols for the user plane.\nNOTE: There could be other interfaces and/or protocols requiring testing under clause 4.4.4 of TS 33.117 [3]\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 1,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}