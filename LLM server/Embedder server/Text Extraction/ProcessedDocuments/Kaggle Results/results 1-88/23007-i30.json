{
    "document_name": "23007-i30.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, modal verbs have the following meanings:\nshall\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions, and do not appear in Technical Reports.\nThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible, and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\tindicates permission to do something\nneed not\tindicates permission not to do something\nThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\tindicates that something is possible\ncannot\tindicates that something is impossible\nThe constructions \"can\" and \"cannot\" are not substitutes for \"may\" and \"need not\".\nwill\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The data stored in location registers are automatically updated in normal operation; the main information stored in a location register defines the location of each mobile station and the subscriber data required to handle traffic for each mobile subscriber. The loss or corruption of these data will seriously degrade the service offered to mobile subscribers; it is therefore necessary to define procedures to limit the effects of failure of a location register, and to restore the location register data automatically. The present document defines the necessary procedures.\nThe basic principle is that restoration should be based on radio contact to avoid faulty data being spread in the system.\nSubscriber data for supplementary services must also be correctly restored, although the impact on service of corruption of supplementary service data is less severe.\nProcedures for supporting these functions are defined in 3GPP TS 29.002 [6] and 3GPP TS 29.060 [8].\nThe MAP operation \"IMSI Attach\" is used only in MAP version 1; in MAP version 2 the same function is performed by the MAP operation \"Update Location Area\". References in this specification to IMSI attach apply only to MAP version 1 network entities.\nIf the restoration of subscriber data in the VLR is triggered by Location Updating or IMSI Attach, the VLR retrieves subscriber data from the HLR by sending an \"Update Location\" request, which triggers one or more \"Insert Subscriber Data\" operations from the HLR. The \"Update Location\" request may also be used to send the LMSI to the HLR.\nIf the restoration of subscriber data in the VLR is triggered by a \"Provide Roaming Number\" request, the behaviour of the VLR depends on whether it is implemented according to MAP version 1 or MAP version 2. For MAP version 2, the VLR retrieves subscriber data from the HLR by sending a \"Restore Data\" request, which triggers one or more \"Insert Subscriber Data\" operations from the HLR. The \"Restore Data\" request is also used to send the LMSI to the HLR. For MAP version 1, the VLR retrieves subscriber data from the HLR by sending a \"Send Parameters\" request with parameter type \"Subscriber Data\", which cannot be used to send the LMSI to the HLR.\nThe VLR number and MSC number in the subscriber data in the HLR are updated by the \"Update Location\" procedure.\nThe GGSN (Gateway GPRS Support Node) is the point of PDN interconnection with the GSM PLMN supporting GPRS. The GGSN contains routing information for GPRS users with a PDP context active. The necessary procedures needed to restore GGSN data information after a restart are described in this document.\nThe SGSN (Serving GPRS Support Node) is the node that is serving the MS. The SGSN stores information regarding e.g. mobility management, routing and security. The necessary procedures needed to restore this SGSN information after a restart are described in this document.\nThe MME (Mobility Management Entity) is the node that is serving the UE when attached to E-UTRAN. The MME stores information regarding e.g. mobility management, routing and security. The necessary procedures needed to restore this MME information after a restart are described in this document.\nA Type A LMU (Location Measurement Unit) is a network node, accessed over the GSM air interface, that is functionally similar to an MS. All requirements associated with a non-GPRS MS in this specification apply also to a Type A LMU except where specified otherwise.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "1.1\tReferences",
                    "description": "",
                    "summary": "",
                    "text_content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies.  In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary of 3GPP Specifications \".\n[2]\tVoid\n[3]\tVoid\n[4]\t3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS)\".\n[5]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service description; Stage 2\".\n[6]\t3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".\n[7]\t3GPP TS 29.018: \"General Packet Radio Service (GPRS); Serving GPRS Support Node (SGSN) - Visitors Location Register (VLR); Gs interface layer 3 specification\".\n[8]\t3GPP TS 29.060: \"General Packet Radio Service (GPRS); GPRS Tunneling Protocol (GTP) across the Gn and Gp interface\".\n[9]\t3GPP TS 43.005: \"Technical performance objectives\".\n[10]\t3GPP TS 23.071: \" Location Services (LCS); Functional description; Stage 2\".\n[11]\tVoid\n[12]\t3GPP TS 23.246: \"Multimedia Broadcast/Multicast Service (MBMS); Architecture and functional description\".\n[13]\t3GPP TS 29.274: \"3GPP Evolved Packet System (EPS); Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3\".\n[14]\t3GPP TS 29.118:\"Mobility Management Entity (MME) – Visitor Location Register (VLR) SGs interface specification\".\n[15]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for  Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[16]\t3GPP TS 29.275: \"Proxy Mobile IPv6 (PMIPv6) based Mobility and Tunneling protocols; Stage 3\".\n[17]\t3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunneling Protocol User Plane (GTPv1-U)\".\n[18]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[19]\t3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS); Stage 3\".\n[20]\t3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core network protocols; Stage 3\".\n[21]\t3GPP TS 29.213: \"Policy and charging control signalling flows and Quality of Service (QoS) parameter mapping \".\n[22]\tIETF RFC 5847: \"Heartbeat Mechanism for Proxy Mobile IPv6\".\n[23]\t3GPP TS 23.018: \"Basic call handling; Technical realization\".\n[24]\t3GPP TS 23.236: \"Intra-domain connection of Radio Access Network (RAN) nodes to multiple Core Network (CN) nodes\".\n[25]\t3GPP TS 29.212: \"Policy and Charging Control (PCC); Reference points\".\n[26]\tIETF RFC 7077: \"Update Notifications for Proxy Mobile IPv6\".\n[27]\t3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile Station (MS) in idle mode\".\n[28]\t3GPP TS 36.444: \"EUTRAN M3 Application Protocol (M3AP)\".\n[29]\t3GPP TS 25.413: \"UTRAN Iu interface RANAP signalling\".\n[30]\t3GPP TS 23.041: \"Technical realization of Cell Broadcast Service (CBS)\".\n[31]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting packet based services and Packet Data Networks (PDN) \".\n[32]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; Stage 2\".\n[33]\t3GPP TS 23.303: \"Proximity based Services; Stage 2\".\n[34]\t3GPP TS 29.344: \"Proximity-services (ProSe) Function to Home Subscriber Server (HSS) aspects; Stage 3\".\n[35]\t3GPP TS 29.468: \"Group Communication System Enablers for LTE (GCSE_LTE); MB2 Reference Point; Stage 3\".\n[36]\t3GPP TS 29.468: \"Group Communication System Enablers for LTE (GCSE_LTE); MB2 Reference Point; Stage 3\".\n[37]\t3GPP TS 29.303: \"Domain Name System Procedures; Stage 3\".\n[38]\t3GPP TS 23.682: \"Architecture enhancements to facilitate communications with packet data networks and applications\".\n[39]\t3GPP TS 23.161: \"Network-Based IP Flow Mobility (NBIFOM); Stage 2\".\n[40]\t3GPP TS 23.285: \"Architecture enhancements for V2X services; Stage 2\".\n[41]\t3GPP TS 29.388: \"V2X Control Function to V2X Control Function to Home Subscriber Server (HSS) aspects (V4)\". .\n[42]\t3GPP TS 23.214: \"Architecture enhancements for control and user plane separation of EPC nodes; Stage 2\".\n[43]\t3GPP TS 29.244: \"Interface between the Control Plane and the User Plane of EPC Nodes; stage 3\".\n[44]\t3GPP TS 29.674:\" Interface between the UCMF and the MME; Stage 3\".\n[45]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[46]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[47]\t3GPP TS 23.632: \"User data interworking, coexistence and migration; Stage 2\".\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "1.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations listed in 3GPP TR  21. 905 [1] apply.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "1.3\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\nPDN Connection: \"PDN Connection\" in this specification only refers to the PDN connection through the SGW and PGW.\nSCEF PDN Connection: The PDN connection to the SCEF. Unless otherwise indicated in a clause or clause, \"PDN Connections\" do not refer to any SCEF PDN Connection.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "2\tDesign objectives",
            "description": "To avoid loss of all the data stored in a location register when part of the equipment of the location register fails, a regime must be implemented to secure the data. This regime can include replication of volatile storage units and periodic back-up of data to non-volatile storage. If the data security regime ensures the integrity of the data in spite of failure of part of the location register equipment then there will be no impact on service. This Technical Specification describes the procedures to be used when the integrity of data in the location register cannot be ensured; that situation is referred to below as \"failure\".\nThe VLR and SGSN shall erase all IMSI records affected by the failure when it restarts after a failure. The GGSN shall erase all non-static PDP records affected by the failure and restore static PDP records when it restarts after a failure.\nFor the HLR/HSS or CSS, periodic back-up of data to non-volatile storage is mandatory.\nThe reliability objectives of location registration are listed in 3GPP TS  43.005 [9].\nThe MME, S-GW and P-GW must similarly have a regime to secure the PDN connection and bearer data at failures. When an MME, SGW or PGW has a full node restart or fails all PDN connections and bearer records associated with the failing node shall be erased and any internal resources released.\nClause 18 \"GTP-C based restart procedures\" specifies how a GTP-C entity restart is detected and handled by the peer.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tRestoration indicators in location registers and in GPRS support nodes",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tRestoration Indicators in the VLR",
                    "description": "",
                    "summary": "",
                    "text_content": "Three restoration indicators are provided in the VLR for each IMSI record: \"Confirmed by Radio Contact\", \"Subscriber Data Confirmed by HLR\" and \"Location Information Confirmed in HLR\".\nThe indicator \"Confirmed by Radio Contact\" indicates whether the VLR\"s record of location area identity and MSC number for the mobile station is confirmed by radio contact.\nThe indicator \"Confirmed by Radio Contact\" in an IMSI record is set to the initial value \"Not Confirmed\" when the VLR receives a \"Provide Roaming Number\" request, an \"Update Location Area\" request or an \"IMSI Attach\" request for an MS for which the VLR does not have an IMSI record. The indicator \"Confirmed by Radio Contact\" in an IMSI record may also be set to the initial value \"Not Confirmed\" when the VLR receives a Reset indication message from the SGSN serving the MS if the MS is attached to both GPRS and non-GPRS services (see 3GPP TS 29.018 [7]) , or a Reset indication message from the MME serving the UE if the UE is attached to both EPS and non-EPS services or for SMS only (see 3GPP TS 29.118 [14]).\nThe indicator \"Confirmed by Radio Contact\" is set to \"Confirmed\" when the radio contact that has been established with the MS is authenticated.\nThe indicator \"Subscriber Data Confirmed by HLR\" indicates whether the subscriber data set for the mobile station held by the VLR is consistent with that held by the HLR.\nThe indicator \"Subscriber Data Confirmed by HLR\" is set to the initial value \"Not Confirmed\" when the VLR receives a \"Provide Roaming Number\" request, an \"Update Location Area\" request or an \"IMSI Attach\" request for an MS for which the VLR does not have an IMSI record.\nThe indicator \"Subscriber Data Confirmed by HLR\" is set to \"Confirmed\" at either of the following events:\n-\tThe VLR successfully performs an \"Update Location\" to the HLR;\n-\tThe VLR successfully performs a \"Restore Data\" operation to the HLR.\nThe indicator \"Location Information Confirmed in HLR\" indicates whether the HLR's record of VLR number and MSC number for the mobile station is confirmed by radio contact.\nThe indicator \"Location Information Confirmed in HLR\" is set to \"Not Confirmed\" at any of the following events:\n-\tThe VLR receives an \"Update Location Area\" request or an IMSI Attach\" request for an MS for which the VLR has no IMSI record;\n-\tA VLR which serves two or more MSCs receives a \"Provide Roaming Number\" request for an MS for which the VLR has no IMSI record;\n-\tThe VLR receives a \"Reset\" message from the HLR with which the MS is registered;\n-\tThe VLR in a Super-Charged network receives a Send Identification message from the serving VLR;\n-\tThe VLR in a Super-Charged network receives a Cancel Location message that indicates an \"updateProcedure\".\nThe indicator \"Location Information Confirmed in HLR\" is set to \"Confirmed\" at either of the following events:\n-\tA VLR which serves only one MSC receives a \"Provide Roaming Number\" request for an MS for which the VLR has no IMSI record;\n-\tSuccessful completion of the \"Update Location\" procedure triggered by authenticated radio contact.\nThe indicator \"Location Information Confirmed in SMLC\" indicates whether an SMLC's record of  MSC number for a particular LMU is confirmed by radio contact.\nThe indicator \"Location Information Confirmed in SMLC\" is set to \"Not Confirmed\" at any of the following events:\n-\tThe VLR receives an \"Update Location Area\" request or an \"IMSI Attach\" request for an MS for which the VLR has no IMSI record. The indicator, in this case, becomes valid only if HLR subscriber data later indicates an LMU;\n-\tThe VLR receives an \"LCS Reset\" message from an SMLC where the message is targetted to either a specific LMU or all LMUs registered with the SMLC;\n-\tThe VLR receives an \"IMSI Detach\" from an LMU that is registered with an SMLC.\nThe indicator \"Location Information Confirmed in SMLC\" is set to \"Confirmed\" at the following event:\n-\tSuccessful completion of the \"LCS Registration\" procedure triggered by a successful location update;\n-\tSuccessful transfer of an LCS Information message from an SMLC to the LMU.\nAlso the following two restoration indicators may be provided in the VLR for each IMSI record: \"Subscriber Data Confirmed by CSS\" and \"Location Information Confirmed by CSS\".\nThe indicator \"Subscriber Data Confirmed by CSS\" indicates whether the CSG subscriber data set for the roaming mobile station held by the VLR is consistent with that held by the CSS.\nThe indicator \"Subscriber Data Confirmed by CSS\" is set to the initial value \"Not Confirmed\" at the following event:\n-\tThe VLR receives a \"Provide Roaming Number\" request, an \"Update Location Area\" request or an \"IMSI Attach\" request for a roaming MS for which the VLR does not have an IMSI record.\n-\tThe VLR receives a \"Cancel VCSG Location Request\" message from the CSS after the VLR restart if the roaming MS attached to the macro cell after the VLR restart.The indicator \"Subscriber Data Confirmed by CSS\" is set to \"Confirmed\" at the following event:\n-\tThe VLR successfully performs an \"Update VCSG Location\" to the CSS.\n-\tThe VLR receives an \"Insert/Delete VCSG Subscription Data Request\" message from the CSS after the VLR restart if the roaming MS attached to the macro cell after the VLR restart.\nThe indicator \"Location Information Confirmed by CSS\" indicates whether the VLR number for the roaming mobile station registered is confirmed by the CSS.\nThe indicator \"Location Information Confirmed by CSS\" is set to \"Not Confirmed\" at any of the following events:\n-\tThe VLR receives an \"Update Location Area\" request or an \"IMSI Attach\" request for a roaming MS for which the VLR has no IMSI record;\n-\tThe VLR receives a \"Reset\" message from the CSS with which the roaming MS is registered.\n-\tThe VLR receives a \"Cancel VCSG Location Request\" message from the CSS after the VLR restart if the roaming MS attached to the macro cell after the VLR restart.\nThe indicator \"Location Information Confirmed by CSS\" is set to \"Confirmed\" at the following event:\n-\tSuccessful completion of the \"Update VCSG Location\" procedure to the CSS.\n-\tThe VLR receives an \"Insert/Delete VCSG Subscription Data Request\" message from the CSS after the VLR restart if the roaming MS attached to the macro cell after the VLR restart.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tRestoration Indicators in the HLR",
                    "description": "",
                    "summary": "",
                    "text_content": "As an implementation option, one restoration indicator may be provided in the HLR for each IMSI record: \"Check SS\".\nThe \"Check SS\" indicator is set to \"Check Required\" when the HLR restarts after a failure.\nThe \"Check SS\" indicator is checked whenever the HLR receives an \"Update Location\" request from a VLR. If it is set to \"Check Required\", after successful completion of subscriber data retrieval that ran embedded in the \"Update Location\" procedure the HLR sends a \"Forward Check SS Indication\" request message to the VLR and sets the \"Check SS\" indicator to \"Check Not Required\".\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.3\tRestoration Indicators in the SGSN",
                    "description": "",
                    "summary": "",
                    "text_content": "Two restoration indicators are provided in the SGSN for reach IMSI record: \"Subscriber Data Confirmed by HLR\" and \"Location Information Confirmed in HLR\".\nThe indicator \"Subscriber Data Confirmed by HLR\" indicates whether the subscriber data set for the mobile station held by the SGSN is consistent with that held by the HLR.\nThe indicator \"Subscriber Data Confirmed by HLR\" is set to the initial value \"Not Confirmed\" when the SGSN receives a Routing Area Update request or an IMSI- and/or GPRS Attach request for an MS for which the SGSN does not have an IMSI record.\nThe indicator \"Subscriber Data Confirmed by HLR\" is set to \"Confirmed\" at the following event:\n-\tThe SGSN successfully performs an Update GPRS Location to the HLR;\nThe indicator \"Location Information Confirmed in HLR\" indicates whether the HLRs record of the SGSN address for the mobile station is confirmed by radio contact.\nThe indicator \"Location Information Confirmed in HLR\" is set to \"Not Confirmed\" at any of the following events:\n-\tThe SGSN receives a Routing Area Update request or an IMSI- and/or GPRS Attach request for an MS for which the SGSN has no IMSI record;\n-\tThe SGSN receives a \"Reset\" message from the HLR with which the MS is registered;\n-\tThe SGSN in a Super-Charged network receives a Send Identification message from the serving SGSN;\n-\tThe SGSN in a Super-Charged network receives a Cancel Location message that indicates an \"updateProcedure\".\nThe indicator \"Location Information Confirmed in HLR\" is set to \"Confirmed\" at the following event:\n-\tSuccessful completion of the Update GPRS Location procedure to the HLR.\nThe indicator \"VLR-Reliable\" indicates whether the VLR serving the MS has performed a restart.\nThe indicator \"VLR-Reliable\" is set to the value \"false\" when the SGSN receives a Reset indication message from the VLR serving the MS if the MS is attached to both GPRS and non-GPRS services. The indicator \"VLR-Reliable\" is set to the value \"true\" when the SGSN receives a confirmation from a VLR that a location update procedure to the affected VLR has been successfully performed.\nThe indicator \"SGSN-Reset\" indicates whether the SGSN has recently experienced a restart.\nThe indicator \"SGSN-Reset\" is set to the value \"true\" when the SGSN suffers a restart. This indicator is unique per SGSN. The indicator \"SGSN-Reset\" is set to the value \"false\" after a certain time specified by the operator. The value of the timer controlling the reset of the \"SGSN-Reset\" indicator shall be longer than the periodic routeing area update timer value used by the MSs.\nAlso the following two restoration indicators may be provided in the SGSN for each IMSI record: \"Subscriber Data Confirmed by CSS\" and \"Location Information Confirmed by CSS\".\nThe indicator \"Subscriber Data Confirmed by CSS\" indicates whether the CSG subscriber data set for the roaming mobile station held by the SGSN is consistent with that held by the CSS.\nThe indicator \"Subscriber Data Confirmed by CSS\" is set to the initial value \"Not Confirmed\" at any of the following events:\n-\tThe SGSN receives a Routing Area Update request or an IMSI- and/or GPRS Attach request for a roaming MS for which the SGSN does not have an IMSI record.\n-\tThe SGSN receives a \"Cancel VCSG Location Request\" message from the CSS after the SGSN restart if the roaming MS attached to the macro cell after the SGSN restart.\nThe indicator \"Subscriber Data Confirmed by CSS\" is set to \"Confirmed\" at the following event:\n-\tThe SGSN successfully performs an \"Update VCSG Location\" to the CSS.\n-\tThe SGSN receives an \"Insert/Delete VCSG Subscription Data Request\" message from the CSS after the SGSN restart if the roaming MS attached to the macro cell after the SGSN restart.\nThe indicator \"Location Information Confirmed by CSS\" indicates whether the SGSN address for the roaming mobile station registered is confirmed by the CSS.\nThe indicator \"Location Information Confirmed by CSS\" is set to \"Not Confirmed\" at any of the following events:\n-\tThe SGSN receives a Routing Area Update request or an IMSI- and/or GPRS Attach request for a roaming MS for which the SGSN has no IMSI record;\n-\tThe SGSN receives a \"Reset\" message from the CSS with which the roaming MS is registered.\n-\tThe SGSN receives a \"Cancel VCSG Location Request\" message from the CSS after the SGSN restart if the roaming MS attached to the macro cell after the SGSN restart.The indicator \"Location Information Confirmed by CSS\" is set to \"Confirmed\" at the following event:\n-\tSuccessful completion of the \"Update VCSG Location\" procedure to the CSS.\n-\tThe SGSN receives an \"Insert/Delete VCSG Subscription Data Request\" message from the CSS after the SGSN restart if the roaming MS attached to the macro cell after the SGSN restart.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.4\tRestoration Indicators in the MME",
                    "description": "",
                    "summary": "",
                    "text_content": "Two restoration indicators are provided in the MME for each IMSI record: \"Subscriber Data Confirmed by HSS\" and \"Location Information Confirmed in HSS\".\nThe indicator \"Subscriber Data Confirmed by HSS\" indicates whether the subscriber data set for the mobile station held by the MME is consistent with that held by the HSS.\nThe indicator \"Subscriber Data Confirmed by HSS\" shall be  set to the initial value \"Not Confirmed\" when the MME receives a Tracking Area Update request or an Attach request for an UE for which the MME does not have an IMSI record.\nThe indicator \"Subscriber Data Confirmed by HSS\" shall be set to \"Confirmed\" at the following event:\n-\tThe MME successfully performs an Update Location to the HSS;\nThe indicator \"Location Information Confirmed in HSS\" indicates whether the HSS's record of the MME address for the UE is confirmed by radio contact.\nThe indicator \"Location Information Confirmed in HSS\" shall be set to \"Not Confirmed\" at any of the following events:\n-\tThe MME receives a Tracking Area Update request or an Attach request for an UE for which the MME has no IMSI record;\n-\tThe MME receives a \"Reset\" message from the HSS with which the UE is registered;\nThe indicator \"Location Information Confirmed in HSS\" shall be set to \"Confirmed\" at the following event:\n-\tSuccessful completion of the Update Location procedure to the HSS.\nAlso the following two restoration indicators may be provided in the MME for each IMSI record: \"Subscriber Data Confirmed by CSS\" and \"Location Information Confirmed by CSS\".\nThe indicator \"Subscriber Data Confirmed by CSS\" indicates whether the CSG subscriber data set for the roaming UE held by the MME is consistent with that held by the CSS.\nThe indicator \"Subscriber Data Confirmed by CSS\" is set to the initial value \"Not Confirmed\" at any of the following events:\n-\tThe MME receives a Tracking Area Update request or an Attach request for a roaming UE for which the MME has no IMSI record;\n-\tThe MME receives a \"Cancel VCSG Location Request\" message from the CSS after the MME restart if the roaming UE attached to the macro cell after the MME restart.\nThe indicator \"Subscriber Data Confirmed by CSS\" is set to \"Confirmed\" at the following event:\n-\tThe MME successfully performs an \"Update VCSG Location\" to the CSS.\n-\tThe MME receives an \"Insert/Delete VCSG Subscription Data Request\" message from the CSS after the MME restart if the roaming UE attached to the macro cell after the MME restart.\nThe indicator \"Location Information Confirmed by CSS\" indicates whether the MME address for the roaming UE registered is confirmed by the CSS.\nThe indicator \"Location Information Confirmed by CSS\" is set to \"Not Confirmed\" at any of the following events:\n-\tThe MME receives a Tracking Area Update request or an Attach request for a roaming UE for which the MME has no IMSI record;\n-\tThe MME receives a \"Reset\" message from the CSS with which the roaming UE is registered.\n-\tThe MME receives a \"Cancel VCSG Location Request\" message from the CSS after the MME restart if the roaming UE attached to the macro cell after the MME restart.\nThe indicator \"Location Information Confirmed by CSS\" is set to \"Confirmed\" at the following event:\n-\tSuccessful completion of the \"Update VCSG Location\" procedure to the CSS.\n-\tThe MME receives an \"Insert/Delete VCSG Subscription Data Request\" message from the CSS after the MME restart if the roaming UE attached to the macro cell after the MME restart.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.5\tRestoration Indicator in the ProSe Function",
                    "description": "",
                    "summary": "",
                    "text_content": "One restoration indicator is provided in the ProSe Function for each IMSI record: \"Subscriber Data Confirmed by HSS\".\nThe indicator \"Subscriber Data Confirmed by HSS\" indicates whether the subscriber data set for the user equipment held by the ProSe Function is consistent with that held by the HSS.\nThe indicator \"Subscriber Data Confirmed by HSS\" shall be set to \"Confirmed\" at the following event:\n-\tSuccessful retrieval of ProSe subscriber information from the HSS.\nThe indicator \"Subscriber Data Confirmed by HSS\" shall be set to \"Not Confirmed\" at the following event:\n-\tThe ProSe Function receives a request for ProSe Service from an UE for which the ProSe Function does not have associated UE context;\n-\tThe ProSe Function receives a \"Reset\" message from the HSS with which the UE is registered.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.6\tRestoration Indicator in the V2X Control Function",
                    "description": "",
                    "summary": "",
                    "text_content": "One restoration indicator is provided in the V2X Control Function for each IMSI record: \"Subscriber Data Confirmed by HSS\".\nThe indicator \"Subscriber Data Confirmed by HSS\" indicates whether the subscriber data set for the user equipment held by the V2X Control Function is consistent with that held by the HSS.\nThe indicator \"Subscriber Data Confirmed by HSS\" shall be set to \"Confirmed\" at the following event:\n-\tSuccessful retrieval of V2X subscriber information from the HSS.\nThe indicator \"Subscriber Data Confirmed by HSS\" shall be set to \"Not Confirmed\" at the following event:\n-\tThe V2X Control Function receives a request for V2X Service from an UE for which the V2X Control Function does not have associated UE context;\n-\tThe V2X Control Function receives a \"Reset\" message from the HSS with which the UE is registered.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tRestoration of data in the VLR",
            "description": "The effect on service of failure of a VLR is different from the effect of failure of an HLR. The procedures for restoration of a VLR and an HLR are therefore different.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.0\tVLR Failure with Restart",
                    "description": "",
                    "summary": "",
                    "text_content": "When a VLR fails, all its associations with SGSNs affected by the failure become invalid and may be deleted. Based on configuration data, the MSC/VLR sends a BSSAP+ Reset message to each of its associated SGSNs. The SGSNs mark all associations containing the restarted VLR as invalid. For an MS that is both GPRS-attached and IMSI-attached, the SGSN may then:\n-\tupon reception of a combined routing area update request, perform immediately the location update for non-GPRS services procedure towards the VLR; or.\n-\tupon reception of a periodic routing Area update request, dependent on network configuration and operator policy,\n-\treturn a Detach Request (Detach Type) message with the Detach Type set to IMSI Detach immediately after the completion of the periodic routing area update procedure, in order to request the MS to perform a combined routing area update, , or\n-\tperform immediately the location update for non-GPRS services procedure towards the VLR.\nWhen a VLR fails, all its associations with MMEs affected by the failure become invalid and may be deleted. The VLR and MME shall behave as per clause 4.2.10. For a UE that is attached to both EPS and non-EPS services, the MME may then:\n-\tupon reception of a combined tracking area update request, perform immediately  the location update for non-EPS services procedure towards the VLR; or\n-\tupon reception of a periodic tracking area update request, dependent on network configuration and operator policy,\n-\trequest the UE to re-attach to non-EPS services immediately after the completion of the periodic tracking area update procedure; or\n-\tperform immediately the location update for non-EPS services procedure towards the VLR.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.0a\tVLR Failure without Restart",
                    "description": "",
                    "summary": "",
                    "text_content": "If the VLR serving a MS that is attached for non-GPRS services is no longer in service, the SGSN may:\n-\tupon reception of a combined routing area update request, perform immediately the location update for non-GPRS services procedure towards an alternative (available) VLR; or\n-\tupon reception of a periodic routing area update request, dependent on network configuration and operator policy,\n-\trequest the MS to re-attach to non-GPRS services immediately after the completion of the periodic routing area update procedure and then select an alternative (available) VLR to serve the UE for non-GPRS services during the subsequent combined routing area update procedure; or\n-\tperform immediately the location update for non-GPRS services procedure towards an alternative (available) VLR.\nSee 3GPP TS 29.018 [7].\nIf the VLR serving a UE that is attached for non-EPS services is no longer in service, the MME may :\n-\tupon reception of a combined tracking area update request, perform immediately  the location update for non-EPS services procedure towards an alternative (available) VLR; or\n-\tupon reception of a periodic tracking area update request, dependent on network configuration and operator policy,\n-\trequest the UE to re-attach to non-EPS services immediately after the completion of the periodic tracking area procedure and then select an alternative (available) VLR to serve the UE for non-EPS services during the subsequent combined tracking area update procedure; or\n-\tperform immediately the location update for non-EPS services procedure towards an alternative (available) VLR.\nUpon reception of an Uplink NAS Transport message from a UE that is attached for non-EPS service, if the VLR serving the UE is no longer in service, the MME may request the UE to re-attach to non-EPS services and then select an alternative available VLR to serve the UE for MO SMS and other CS services during the subsequent combined TA / LA update procedure.\nSee 3GPP TS 29.118 [14].\nNOTE:\tHow an SGSN or MME detects that a VLR is no longer in service is implemention specifc, e.g. if there are no more SCTP associations in service with that VLR for a given period.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.1\tRestart of the VLR",
                    "description": "",
                    "summary": "",
                    "text_content": "When a VLR restarts after a failure, all IMSI records affected by the failure are erased.\nThere will be no subscriber data or location information stored for an affected mobile station until after the VLR has received either a \"Provide Roaming Number\" request or an \"Update location Area\" request for that mobile station.\nThe VLR causes all affected TMSIs and all affected LMSIs to become invalid. \"Invalid\" in this context means that the TMSI and LMSI can no longer be regarded as accurate. The term is used to avoid unnecessary constraints on the implementation.\nOn receipt of either a \"Provide Roaming Number\" request or an \"Update Location Area\" request, restoration of subscriber data in the VLR is triggered individually for each IMSI record as described below.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tRestoration Procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2.0\tGeneral",
                            "text_content": "The objective of the restoration procedure is to handle all traffic for each mobile subscriber correctly. In order to meet this objective, the procedure must make the subscriber data in the VLR consistent with that in the HLR or in the CSS, and make the location information in the HLR and VLR or the location information in the CSS and VLR reflect accurately the current location of the MS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.1\tIncoming Call",
                            "text_content": "a)\tSend Routing Information (GMSC->HLR):\nThe HLR sends \"Provide Roaming Number\" to the VLR as for normal operation. The LMSI is updated by the VLR when the VLR requests the transfer of subscriber data from the HLR using the \"Restore Data\" operation.\nb)\tProvide Roaming Number (HLR->VLR):\n-\tRegardless of whether the VLR has an IMSI record corresponding to the IMSI in the \"Provide Roaming Number\", it returns an MSRN. If no IMSI record exists, the VLR creates a skeleton IMSI record, sets the indicators \"Subscriber Data Confirmed by Radio Contact\" and \"Subscriber Data Confirmed by HLR\" to \"Not Confirmed\" and (if IMSI Attach is used) marks the IMSI as attached. If the VLR serves two or more MSCs, the VLR sets the indicator \"Location Information Confirmed in HLR\" to \"Not Confirmed\". Otherwise, if the VLR serves only one MSC, the indicator \"Location Information Confirmed in HLR\" is set to the initial value \"Confirmed\". Also the VLR may set the indicators \"Subscriber Data Confirmed by CSS\" and \"Location Information Confirmed by CSS\" to \"Not Confirmed\".\n-\tIf the indicator \"Subscriber Data Confirmed by HLR\" is \"Not Confirmed\" the VLR requests authentication data, if required and still not available and subscriber data from the HLR. When the dialogue that covers the subscriber data retrieval procedure is completed successfully, the VLR sets the indicator \"Subscriber Data Confirmed by HLR\" to \"Confirmed\". The indicators \"Confirmed by Radio Contact\" and \"Location Information Confirmed in HLR\" remain unchanged.\n-\tIf the IMSI record for the MS is marked \"Subscriber Data Confirmed by HLR\" but \"Not Confirmed by Radio Contact\" the operator may choose an appropriate method to limit the number of \"Search for MS\" procedures for that MS.\nc)\tSend Information for I/C Call Setup (MSC->VLR)\n-\tIf the VLR has no IMSI record, or if the record is marked \"Subscriber Data Not Confirmed by HLR\" the VLR returns a \"System Failure\" error.\n-\tIf the VLR has an IMSI record marked \"Subscriber Data Confirmed by HLR\" and \"Not Confirmed by Radio Contact\", the VLR handles the request in the normal way, except that the \"Search for MS\" procedure is used instead of the \"Page MS\" procedure.\n-\tIf the VLR has an IMSI record marked \"Subscriber Data Confirmed by HLR\" and \"Confirmed by Radio Contact\", the VLR handles the request in the normal way; for this MS, VLR restoration is complete.\n-\tThe state of the indicator \"Location Information Confirmed in HLR\" does not affect the \"Send Information for I/C Call Setup\" procedure.\nd)\tProcess Access Request in Response to Search (MSC->VLR):\n-\tIf the MS responds to paging, the MSC sends a positive response to the search request and a \"Process Access Request\" to the VLR. After successful authentication, if required, the VLR sets the indicator \"Confirmed by Radio Contact\" to \"Confirmed\", sets the location area information for the MS, and handles the request in the normal way.\n-\tThe VLR checks the indicator \"Location Information Confirmed in HLR\". If it indicates \"Not Confirmed\" the VLR starts an \"Update Location\" procedure to the HLR. When this procedure is successfully completed the VLR sets the indicator \"Location Information Confirmed in HLR\" to \"Confirmed\".\n-\tIf the MS is roaming, the VLR checks the indicators \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\". If either of them indicates \"Not Confirmed\" the VLR shall start an \"Update VCSG Location\" procedure to the CSS if the roaming MS is still in the CSG cell. When this procedure is successfully completed the VLR sets the indicator \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\" to \"Confirmed\".\nFor this MS, VLR restoration is complete.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.2\tMobile Terminated Short Message",
                            "text_content": "a)\tSend Routing Information for MT SMS (SMS-GMSC->HLR):\nThe HLR returns the MSC number as for normal operation.\nb)\tSend Information for MT SMS (MSC->VLR) - MAP version 2:\n-\tIf the VLR has no IMSI record, or if the record is marked \"Subscriber Data Not Confirmed by HLR\", the VLR proceeds as follows:\n-\tthe VLR returns an \"Unidentified Subscriber\" error. This causes the MSC to report a short message delivery failure, with cause \"Unidentified Subscriber\", to the SMS gateway MSC. The Gateway MSC sends a \"Report SM Delivery Status\" request, with a cause of \"Absent Subscriber\", to the HLR. This causes the HLR to set the \"Mobile Station Not Reachable Flag\" for the MS, as described in Technical Specifications 3GPP TS 23.040 [4] and 3GPP TS 29.002 [6]; or\n-\tthe VLR performs the data restoration procedure as specified in clause 4.2.1 for an incoming call and delay the mobile terminating SMS until the data restoration procedure is complete. During the data restoration procedure, the  shall send to the VLR the MME name or/and the SGSN Number if the subscriber is registered on this VLR and is registered to EPS or/and GPRS services respectively.\n-\tIf the VLR has an IMSI record marked \"Subscriber Data Confirmed by HLR\" and \"Not Confirmed by Radio Contact\", the VLR handles the request in the normal way, except that the \"Search for MS\" procedure is used instead of the \"Page MS\" procedure.\n-\tIf the VLR has an IMSI record marked \"Subscriber Data Confirmed by HLR\" and \"Confirmed by Radio Contact\", the VLR handles the request in the normal way; for this MS, VLR restoration is complete.\n-\tThe state of the indicator \"Location Information Confirmed in HLR\" does not affect the \"Send Information for MT SMS\" procedure.\nc)\tSend Information for I/C Call Setup (MSC->VLR) - MAP version 1:\n-\tIf the VLR has no IMSI record, or if the record is marked \"Subscriber Data Not Confirmed by HLR\", the VLR proceeds as follows:\n-\tthe VLR returns a \"System Failure\" error. This causes the MSC to report a short message delivery failure, with cause \"System Failure\", to the SMS gateway MSC; or\n-\tthe VLR performs the data restoration procedure as specified in clause 4.2.1 for an incoming call and delay the mobile terminating SMS until the data restoration procedure is complete. During the data restoration procedure, the  shall send to the VLR the MME name or/and the SGSN Number if the subscriber is registered on this VLR and is registered to EPS or/and GPRS services respectively.\n-\tIf the VLR has an IMSI record marked \"Subscriber Data Confirmed by HLR\" and \"Not Confirmed by Radio Contact\", the VLR handles the request in the normal way, except that the \"Search for MS\" procedure is used instead of the \"Page MS\" procedure.\n-\tIf the VLR has an IMSI record marked \"Subscriber Data Confirmed by HLR\" and \"Confirmed by Radio Contact\", the VLR handles the request in the normal way; for this MS, VLR restoration is complete.\n-\tThe state of the indicator \"Location Information Confirmed in HLR\" does not affect the \"Send Information for MT SMS\" procedure.\nd)\tProcess Access Request in Response to Search (MSC->VLR):\n-\tIf the MS responds to paging, the MSC sends a positive response to the search request and a \"Process Access Request\" to the VLR. After successful authentication, if required, the VLR sets the indicator \"Confirmed by Radio Contact\" to \"Confirmed\", sets the location area information for the MS, and handles the request in the normal way.\n-\tThe VLR checks the indicator \"Location Information Confirmed in HLR\". If it indicates \"Not Confirmed\" the VLR starts an \"Update Location\" procedure to the HLR. When this procedure is successfully completed, the VLR sets the indicator \"Location Information Confirmed in HLR\" to \"Confirmed\".\n-\tIf the MS is roaming, the VLR checks the indicators \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\". If either of them indicates \"Not Confirmed\" the VLR shall start an \"Update VCSG Location\" procedure to the CSS if the roaming UE is still in the CSG cell. When this procedure is successfully completed the VLR sets the indicator \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\" to \"Confirmed\".\n\nFor this MS, VLR restoration is complete.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.3\tMobile Terminating Location Request (MT-LR)",
                            "text_content": "Receipt of an MT-LR for a target MS identified by its IMSI in a serving MSC during VLR restoration is supported by the procedures below.\na)\tProvide Subscriber Location (GMLC->MSC/VLR):\n-\tIf the VLR has no IMSI record, or if the record is marked \"Subscriber Data Not Confirmed by HLR\" the VLR returns an \"Unidentified Subscriber\" error. This causes the MSC to report a location failure, with cause \"Unidentified Subscriber\", to the GMLC.\n-\tIf the VLR has an IMSI record marked \"Subscriber Data Confirmed by HLR\" and \"Not Confirmed by Radio Contact\", the VLR handles the request in the normal way, except that the \"Search for MS\" procedure is used instead of the \"Page MS\" procedure when paging for the MS.\n-\tIf the VLR has an IMSI record marked \"Subscriber Data Confirmed by HLR\" and \"Confirmed by Radio Contact\", the VLR handles the request in the normal way; for this MS, VLR restoration is complete.\n-\tThe state of the indicator \"Location Information Confirmed in HLR\" does not affect the \"Provide Subscriber Location\" procedure.\nb)\tProcess Access Request in Response to Search (MSC->VLR):\n-\tIf the MS responds to paging, the MSC sends a positive response to the search request and a \"Process Access Request\" to the VLR. After successful authentication, if required, the VLR sets the indicator \"Confirmed by Radio Contact\" to \"Confirmed\", sets the location area information for the MS, and handles the request in the normal way.\n-\tThe VLR checks the indicator \"Location Information Confirmed in HLR\". If it indicates \"Not Confirmed\" the VLR starts an \"Update Location\" procedure to the HLR. When this procedure is successfully completed, the VLR sets the indicator \"Location Information Confirmed in HLR\" to \"Confirmed\".\n-\tIf the MS is roaming, the VLR checks the indicators \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\". If either of them indicates \"Not Confirmed\" and the roaming MS is still in the CSG cell, the VLR shall start an \"Update VCSG Location\" procedure to the CSS. When this procedure is successfully completed the VLR sets the indicator \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\" to \"Confirmed\".\nFor this MS, VLR restoration is complete.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.4\tIncoming LCS Information Request (GSM only)",
                            "text_content": "Receipt of an incoming BSSMAP-LE LMU Connection Request from an SMLC directed to a specific Type A LMU is supported by the procedures below.\na)\tRequest associated with an LMU  (SMLC->MSC/VLR):\n-\tIf the VLR has no IMSI record, or if the record is marked \"Subscriber Data Not Confirmed by HLR\", the VLR returns an \"Unidentified Subscriber\" error.\n-\tIf the VLR has an IMSI record for an LMU marked \"Subscriber Data Confirmed by HLR\" and \"Not Confirmed by Radio Contact\", the VLR handles the request in the normal way, except that the \"Search for MS\" procedure is used instead of the \"Page MS\" procedure when paging for the LMU.\n-\tIf the VLR has an IMSI record marked \"Subscriber Data Confirmed by HLR\" and \"Confirmed by Radio Contact\", the VLR handles the request in the normal way. For this LMU, data restoration is complete.\n-\tThe state of the indicator \"Location Information Confirmed in HLR\" does not affect the incoming  LMU Connection Request.\nb)\tProcess Access Request in Response to Search (MSC->VLR):\n-\tIf the LMU responds to paging, the MSC sends a positive response to the search request and a \"Process Access Request\" to the VLR. After successful authentication, if required, the VLR sets the indicator \"Confirmed by Radio Contact\" to \"Confirmed\", sets the location area information for the LMU, and handles the request in the normal way.\n-\tThe VLR checks the indicator \"Location Information Confirmed in HLR\". If it indicates \"Not Confirmed\" the VLR starts an \"Update Location\" procedure to the HLR. When this procedure is successfully completed, the VLR sets the indicator \"Location Information Confirmed in HLR\" to \"Confirmed\".\n-\tIf the MS is roaming, the VLR checks the indicators \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\". If either of them indicates \"Not Confirmed\" and the roaming MS is still in the CSG cell, the VLR shallstart an \"Update VCSG Location\" procedure to the CSS. When this procedure is successfully completed the VLR sets the indicator \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\" to \"Confirmed\".\nFor this LMU, VLR restoration is complete.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.5\tOutgoing MS request",
                            "text_content": "An outgoing request (MS originated call, mobile originated Short Message or call-independent supplementary service activity) from the MS causes the VLR to check its IMSI record for that MS.\n-\tIf the MS is unknown in this VLR (i.e. the VLR has no IMSI record for the MS) or there is an IMSI record marked \"Subscriber Data Not Confirmed by HLR\" the outgoing request is rejected with error cause \"Unidentified Subscriber\". This causes the MS to initiate the location registration procedure described below.\n-\tIf the VLR has an IMSI record for the MS marked \"Subscriber Data Confirmed by HLR\" the request is handled in the normal way, and after any necessary authentication and/or IMEI checking the record is marked \"Confirmed by Radio Contact\".\n-\tThe VLR checks the indicator \"Location Information Confirmed in HLR\". If it indicates \"Not Confirmed\" the VLR starts an \"Update Location\" procedure to the HLR. When this procedure is successfully completed the VLR sets the indicator \"Location Information Confirmed in HLR\" to \"Confirmed\".\n-\tIf the MS is roaming, the VLR checks the indicators \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\". If either of them indicates \"Not Confirmed\" and the roaming MS is still in the CSG cell, the VLR shall start an \"Update VCSG Location\" procedure to the CSS. When this procedure is successfully completed the VLR sets the indicator \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\" to \"Confirmed\".\nFor this MS, VLR restoration is complete.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.6\tOutgoing LMU Request (GSM only)",
                            "text_content": "An outgoing request (CM ServiceRequest) for LCS from a Type A LMU causes the VLR to check its IMSI record for that LMU.\n-\tIf the LMU is unknown in this VLR (i.e. the VLR has no IMSI record for the LMU) or there is an IMSI record marked \"Subscriber Data Not Confirmed by HLR\" the outgoing request is rejected with error cause \"Unidentified Subscriber\". This causes the LMU to initiate the location registration procedure described below.\n-\tIf the VLR has an IMSI record for the MS marked \"Subscriber Data Confirmed by HLR\", the request is handled in the normal way, and after any necessary authentication and/or IMEI checking the record is marked \"Confirmed by Radio Contact\".\n-\tThe VLR checks the indicator \"Location Information Confirmed in HLR\". If it indicates \"Not Confirmed\" the VLR starts an \"Update Location\" procedure to the HLR. When this procedure is successfully completed the VLR sets the indicator \"Location Information Confirmed in HLR\" to \"Confirmed\".\n-\tIf the MS is roaming, the VLR checks the indicators \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\". If either of them indicates \"Not Confirmed\" the VLR and the roaming MS is still in the CSG cell, may start an \"Update VCSG Location\" procedure to the CSS. When this procedure is successfully completed the VLR sets the indicator \"Subscriber Data Confirmed by CSS\" if the CSS has the corresponding valid CSG subscription data and \"Location Information Confirmed by CSS\" to \"Confirmed\".\nFor this LMU, VLR restoration is complete.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.7\tLocation Updating or IMSI Attach",
                            "text_content": "A location registration request (location updating or IMSI attach) from an MS causes the VLR to check its IMSI record for that MS.\n-\tIf the MS is unknown in this VLR (i.e. the VLR has no IMSI record for the MS) the VLR creates a skeleton IMSI record for the MS and sets the indicators \"Confirmed by Radio Contact\", \"Location Information Confirmed in HLR\", \"Subscriber Data Confirmed by HLR\", \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" to \"Not Confirmed\". If authentication is required, the VLR retrieves authentication data. When the radio contact with the Mobile Station is authenticated, the VLR sets the indicator \"Confirmed by Radio Contact\" to \"Confirmed. The VLR then performs an \"Update Location\" to the HLR. If this is successful, the VLR sets the indicators \"Location Information Confirmed in HLR\" and \"Subscriber Data Confirmed by HLR\" to \"Confirmed\". For this MS, VLR restoration is complete. If the VPLMN supports Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN, the VLR may perform an \"Update VCSG Location\" to the CSS if the requested cell is a CSG/hybrid cell. If this is successful, the VLR sets the indicators \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" to \"Confirmed\" if the CSS has the corresponding valid CSG subscription data.\n-\tIf the VLR has an IMSI record for the MS, after successful authentication, if required, the VLR sets the indicator \"Confirmed by Radio Contact\" to \"Confirmed\". If the record is marked \"Location Information Not Confirmed in HLR\" or \"Subscriber Data Not Confirmed by HLR\" the VLR performs an \"Update Location\" to the HLR. If this is successful, the VLR sets the indicators \"Location Information Confirmed in HLR\" and \"Subscriber Data Confirmed by HLR\" to \"Confirmed\". For this MS, VLR restoration is complete. If the record is marked \"Location Information Not Confirmed by CSS\" or \"Subscriber Data Not Confirmed by CSS\" if the CSS has the valid CSG subscription data, and the VPLMN supports Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN, the VLR may perform an \"Update VCSG Location\" to the CSS if the requested cell is a CSG/hybrid cell. If this is successful, the VLR sets the indicators \"Location Information Confirmed by CSS\" if the CSS has the valid CSG subscription data and \"Subscriber Data Confirmed by CSS\" to \"Confirmed\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.8\tUse of TMSI",
                            "text_content": "After the VLR has restarted but before the next authenticated radio contact the TMSI known by the MS is invalid, as it was allocated before the VLR restarted. The VLR therefore uses the IMSI to identify the MS on the first radio contact during restoration.\n-\tA VLR which initiates a \"Search for Subscriber\" procedure uses the IMSI to identify the MS.\n-\tIf an MS identifies itself by a TMSI in a \"Location Registration\" request, the VLR proceeds as follows:\na)\tThe VLR checks the location area identity (LAI) of the previous location area sent by the MS. If this LAI is in a VLR different from the current one, the request is handled in the normal way.\nb)\tIf the LAI is in the current VLR, the status of the TMSI is checked:\n-\tIf the TMSI was allocated after the VLR restarted, and corresponds to a valid IMSI record, the request is handled as described in clause 4.2.7.\n-\tIf the TMSI was allocated before the VLR restarted, or does not correspond to a valid IMSI record, the VLR requests the IMSI from the MS. If the MS returns an IMSI the VLR proceeds as described in clause 4.2.7. If the MS does not return an IMSI the network aborts the location registration procedure.\n-\tIf an MS identifies itself by a TMSI in an outgoing MS request, the VLR proceeds as follows:\n-\tIf the TMSI was allocated after the VLR restarted, and corresponds to a valid IMSI record, the request is handled as described in clause 4.2.5.\n-\tIf the TMSI was allocated before the VLR restarted, or does not correspond to a valid IMSI record, the VLR requests the IMSI from the MS. If the MS returns an IMSI the VLR proceeds as described in clause 4.2.5. If the MS does not return an IMSI the network aborts the outgoing request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.9\tSGSN associations",
                            "text_content": "Based on configuration data, \"Reset\" messages are sent on the Gs-interface to the SGSNs in the Location Areas served by the VLR as described in the 3GPP TS 29.018 [7]. The SGSNs mark all associations with the VLR as unreliable by setting the restoration indicator \"VLR-Reliable\" to \"False\" for the UEs served by that VLR. The associations will be re-initiated one by one by the SGSN at the next Routing Area update or combined RA/LA update from each UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.10\tMME associations",
                            "text_content": "Based on configuration data, \"Reset\" messages are sent on the SGs-interface to the MMEs by the VLR as described in the 3GPP TS 29.118 [14]. The MMEs mark all associations with the VLR as unreliable by setting the restoration indicator \"VLR-Reliable\" to \"False\" for the UEs served by that VLR. The associations will be re-initiated one by one by the MME at the next Tracking Area update or combined TA/LA update from each UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "5\tRestoration of data in the HLR/HSS",
            "description": "The loss or corruption of subscriber data in the HLR/HSS has an impact not only in the HLR/HSS's own PLMN but also on the service for its mobiles in other PLMNs. Restoration of the data in the HLR/HSS requires co-operation from all the VLRs, SGSNs and MMEs at which its mobiles are registered.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tRestart of the HLR/HSS",
                    "description": "",
                    "summary": "",
                    "text_content": "The periodic backup of HLR/HSS data to non-volatile storage is mandatory.\nWhen an HLR/HSS restarts after failure it shall perform the following actions for the subscriber data records that have been affected by the HLR/HSS fault:\n-\treload all data from the non-volatile back-up;\n-\treset all \"MS Purged\" flags;\n-\tmark each subscriber record \"SS Check Required\" by setting the \"Check SS\" indicator if the \"Forward Check SS Indication\" service is implemented;\n-\tsend a \"Reset\" message to each VLR where one or more of its MSs are registered. This causes each VLR concerned to mark each relevant subscriber record \"Location Information Not Confirmed in HLR\", and\n-\tsend a \"Reset\" message to each SGSN where one or more of its MSs are registered. This causes each SGSN to mark each relevant MM context \"Location Information Not Confirmed in HLR\".\n-\tsend a \"Reset\" message to each MME where one or more of its UEs are registered. This causes each MME to mark each relevant MM context \"Location Information Not Confirmed in HSS\".\n-\tsend a \"Reset\" message to each ProSe Function (see 3GPP TS 23.303 [33]), where one or more of its UEs are registered for ProSe Services. This causes each ProSe Function to mark each relevant UE context \"Subscriber Data Not Confirmed by HSS\".\n-\tsend a \"Reset\" message to each V2X Control Function (see 3GPP TS 23.285 [40]), where one or more of its UEs are registered for V2X Services. This causes each V2X Control Function to mark each relevant UE context \"Subscriber Data Not Confirmed by HSS\".\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tProcedures During Restoration",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tMobile terminated call",
                            "text_content": "If the VLR receives a \"Process Access Request\" request in response to a \"Page\" or \"Search for MS\" operation, after successful authentication, if required, it checks the indicator \"Location Information Confirmed in HLR\". If this indicates \"Not Confirmed\" the VLR triggers an \"Update Location\" to the HLR as described in clause 4.2.1.d).\nWhen the HLR receives the \"Update Location\" request it stores the VLR number, MSC number and LMSI in the subscriber record as for normal operation.\nIf the \"Forward Check SS Indication\" service is implemented, the HLR checks the indicator \"Check SS\". If this indicates \"Check Required\", after successful completion of the subscriber data retrieval procedure that ran embedded in the \"Update Location\" procedure the HLR sends a \"Forward Check SS Indication\" to the VLR and marks the subscriber record \"Check Not Required. When the VLR receives the \"Forward Check SS Indication\" request it forwards an indication to the MS to alert the user that supplementary service parameters should be checked.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tMobile Originated Activity for CS",
                            "text_content": "When the VLR receives a request from an MS (MS originated call, mobile originated Short Message, call-independent supplementary service activity or location registration request) whose IMSI record is marked \"Location Information Not Confirmed in HLR\", it will perform an \"Update Location\" to the HLR as described in clauses 4.2.5 and 4.2.7 above.\nWhen the HLR receives an \"Update Location\" request from the VLR, it proceeds as described in clause 5.2.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3\tMobile Originated Activity for ProSe",
                            "text_content": "When the ProSe Function receives a request for ProSe Service from a UE whose associated context is marked as \"Subscriber Data Not Confirmed by HSS\", it shall initiate a \"ProSe Subscriber Information Retrieval\" request to the HSS as described in the 3GPP TS 29.344 [34].\nWhen the HSS receives a \"ProSe Subscriber Information Retrieval\" request from the ProSe Function, it shall proceed as described in the 3GPP TS 29.344 [34].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.4\tProcedures in the SGSN",
                            "text_content": "Upon receipt of a HLR/HSS reset, the SGSN shall mark each relevant MM contexts as invalid and shall set the Non-GPRS Alert Flag (NGAF) if an SGSN - MSC/VLR association exists. After detection of any activity (either signalling or data) from a marked MS or any other implementation dependent trigger for a marked MS in PMM-CONNECTED state with Direct tunnel, the SGSN performs an update location to the HLR/HSS as in the attach or inter-SGSN RA update procedures and, if NGAF is set, the procedure of \"Non-GPRS Alert\" is followed (see clause 7 in 3GPP TS 29.018 [7]).\nThe update location procedure and the procedure towards the VLR may be delayed by the SGSN for a maximum operator configuration-depending time period to avoid high signalling load.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.5\tProcedures in the MME",
                            "text_content": "Upon receipt of a HSS reset, the MME shall mark each relevant MM contexts as invalid and shall set Non-EPS Alert Flag (NEAF) if an MME - MSC/VLR association exists. After detection of any activity (either signalling or data) from a marked UE or any other implementation dependent trigger for a marked UE in ECM-CONNECTED state, the MME performs an update location to the HSS as in the attach or inter-MME TA update procedures and, if NEAF is set, the procedure of \"NON-EPS Alert\" is followed (see clause 5.3 in 3GPP TS 29.118 [14]).\nThe update location procedure and the procedure towards the VLR may be delayed by the MME for a maximum operator configuration-depending time period to avoid high signalling load.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.6\tMobile Originated Activity for V2X",
                            "text_content": "When the V2X Control Function receives a request for V2X Service from a UE whose associated context is marked as \"Subscriber Data Not Confirmed by HSS\", it shall initiate a \"V2X Subscriber Information Retrieval\" request to the HSS as described in the 3GPP TS 29.388 [41].\nWhen the HSS receives a \"V2X Subscriber Information Retrieval\" request from the V2X Control Function, it shall proceed as described in the 3GPP TS 29.388 [41].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tPeriodic location updating",
            "description": "The time taken to confirm the location of an MS after location register failure is governed by the frequency with which the MS establishes radio contact with the network. The location information for an MS which remains silent for a long time will remain doubtful for a long time.\nA method of reducing this time is to require the MS to establish radio contact with the network at intervals, purely to confirm its location, if the MS does not move to a new location area (which would lead to a normal location registration) or respond to paging for a mobile terminated call or request a mobile originated call or call-independent supplementary service activity.\nThe interval between successive periodic location updatings is controlled by a timer in the MS; this timer is reset to its initial value at the end of each successfully established radio contact between the MS and the network.\nThe use of the periodic location update timer is described in 3GPP TS 23.122 [27].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "7\tPeriodic routeing area updating",
            "description": "All GPRS-attached MSs, except MSs in class-B mode of operation engaged in CS communication, shall perform periodic RA updates. For MSs that are both IMSI-attached and GPRS-attached, the periodic updates depend on whether the Gs interface is installed or not:\n-\tIf the Gs interface is installed, periodic RA updates shall be performed, and periodic LA updates shall not be performed. If the SGSN has the indicator \"VLR-reliable\" set to ´false´ the SGSN shall perform a location area update procedure towards the VLR\n-\tIf the Gs interface is not installed, both periodic RA updates and periodic LA updates shall be performed independently. RA updates are performed via the Gb interface, and LA updates are performed via the A interface.\nThe periodic routeing area update is described in 3GPP TS 23.060 [5].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "8\tStand-alone operation of the VLR",
            "description": "In a 2G authentication regime, triplets, regardless of its nature (generated in a 2G AuC or derived from quintuplets in a 3G VLR or a 3G HLR), may be reused when no unused authentication triplets are available in the VLR for an IMSI record. It is an operator option to define how many times an authentication triplet may be reused in the VLR.\nIn a 3G authentication regime, quintuplets, regardless of its nature (generated in a 3G AuC or derived from triplets in a 3G VLR), shall not be reused when no unused authentication quintuplets are available in the VLR for an IMSI record.\nIf the Update Location response contains an error different from \"Unknown Subscriber\" or \"Roaming Not Allowed\" or if there is a parameter problem (e.g. no HLR number included), no error shall be indicated to the MSC and the IMSI record in the VLR shall not be affected, provided that the associated \"Subscriber Data Confirmed by HLR\" indicator is in the \"Confirmed\" status.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "9\tStand-alone operation of the SGSN",
            "description": "In a 2G authentication regime, triplets, regardless of their nature (generated in a 2G AuC or derived from quintuplets in a 3G SGSN or a 3G HLR), may be reused when no unused authentication triplets are available in the SGSN for an IMSI record. It is an operator option to define how many times an authentication triplet may be reused in the SGSN.\nIn a 3G authentication regime, quintuplets, regardless of their nature (generated in a 3G AuC or derived from triplets in a 3G SGSN), shall not be reused when no unused authentication quintuplets are available in the SGSN for an IMSI record.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "9A\tStand-alone operation of the MME",
            "description": "In a E-UTRAN authentication regime, EPS authentication vectors shall not be reused when no unused EPS authentication vectors are available in the MME for an IMSI record.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "10\tRestoration of data in the GGSN",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "10.0\tGGSN failure",
                    "description": "",
                    "summary": "",
                    "text_content": "When a GGSN fails, all its PDP contexts affected by the failure become invalid and may be deleted. GGSN storage of subscriber data is volatile.\nWhen the GGSN receives a GTP-U PDU for which no PDP context exists, it shall discard the GTP-U PDU and return a a GTP error indication to the originating node (the SGSN or, if Direct Tunnel is established, the RNC).\nThe GGSN should ensure as far as possible that previously used TEID values are not immediately reused after a GGSN restart, in order to avoid inconsistent TEID allocation throughout the network.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.1\tRestart of the GGSN",
                    "description": "",
                    "summary": "",
                    "text_content": "After a GGSN restart, all the PDP contexts, the MBMS UE contexts, and the MBMS Bearer contexts stored in the GGSN and affected by the restart become invalid and may be deleted.\nWhen the SGSN detects a restart in a GGSN (see clause 18 \"GTP-C based restart procedures\") with which it has one or more PDP contexts activated, it shall deactivate all these PDP contexts and request the MS to reactivate them. When the SGSN detects a restart in a GGSN with which it has MBMS Bearer context(s) and/or MBMS UE context(s), it shall delete all these MBMS Bearer context(s) and/or MBMS UE context(s).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.2\tRestoration Procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.2.0\tGeneral",
                            "text_content": "The GGSN will receive the SGSN restart counters in GTPv1 echo response from the SGSN. When a GGSN detects that a peer SGSN has restarted it shall delete all PDP context(s), MBMS UE context(s), MBMS Bearer context(s) associated with the peer node that failed as well as freeing any internal GGSN resources associated with those PDP context(s), MBMS UE context(s) and MBMS Bearer context(s). The GGSN may optionally perform other implementation specific actions such as messages to clear other external resources (e.g. PCC messages).\nIf the GGSN needs to send a request for IP-CAN Session Modification procedure towards a PCRF which is known to have restarted since the IP-CAN session establishment, the GGSN may discard the request and may tear down all the PDP context(s) associated with the PDP address of the IP-CAN session, based on operator policy, by initiating a PDP Context Deactivation procedure towards the SGSN with the cause set to \"Reactivation requested\". This leads the UE to initiate PDP Context Activation procedure for the same APN. Emergency sessions should not be torn down.\nNOTE:\tThe procedure above just enables to clean up all the PDP Context(s) associated with the PDP address of the IP-CAN session, affected by the PCRF failure when a specific interaction with the PCRF is required. Prior to that interaction, PCC controlled services cannot be provided to the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.1\tMobile terminated transmission",
                            "text_content": "When the GGSN receives a mobile terminated PDU for which no valid PDP context exists the GGSN discards the received PDU and may also return an appropriate Error message depending on the protocol used. No further actions are performed by the GGSN. Alternatively, if the GGSN has static PDP information about the PDP address, the GGSN may try to deliver the PDU by initiating the Network-Requested PDP Context Activation procedure (see 3GPP TS 23.060 [5]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.2\tMobile originated transmission",
                            "text_content": "When the GGSN receives a tunnel PDU for which no PDP context exists it discards the tunnel PDU and sends an Error indication message to the originating SGSN. The SGSN deactivates the PDP context and sends an Error indication to the MS. The MS may then re-activate the PDP context.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "11\tRestoration of data in the SGSN",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "11.0\tSGSN Failure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.0.1\tGn/Gp SGSN failure",
                            "text_content": "When an SGSN fails, it deletes all MM and PDP contexts affected by the failure. SGSN storage of subscriber data is volatile. Based on configuration data, the SGSN may send a Reset message to each of its associated VLRs. If a Reset message is sent, the VLR may mark all associations containing the restarted SGSN as unreliable. See 3GPP TS 29.018 [7]. In the case of optional CAMEL interaction the failing SGSN shall invoke the CAMEL-GPRS-Exception procedure towards the GSM-SCFs.\nIf data or signalling, except GPRS attach and RA update, is received in an SGSN from an MS for which no MM context exists in the SGSN, the SGSN shall discard the data or signalling.\nIf an RA update request is received in an SGSN from an MS for which no MM context exists in the SGSN, or in the old SGSN for the inter-SGSN RA update case, the SGSN shall reject the RA update with an appropriate cause. In order to remain GPRS-attached, the MS shall then perform a new GPRS attach and should (re-)activate PDP contexts.\nIf a service request is received in a 3G-SGSN from an MS for which no MM context exists in the 3G-SGSN, the 3G-SGSN shall reject the service request with an appropriate cause. In order to remain GPRS-attached, the MS shall then perform a new GPRS attach and should (re-) activate PDP contexts.\nNOTE:\tIn some cases, user interaction may be required, and then the MS cannot (re-)activate the PDP contexts automatically.\nWhen the SGSN receives a PDU Notification Request message for which no MM context exists, the SGSN returns a PDU Notification Response message to the GGSN with an appropriate cause (see clause \"Unsuccessful Network-Requested PDP Context Activation Procedure\" in 3GPP TS 23.060 [5]), and the SGSN may search the MS by paging with the IMSI in the SGSN area. An MS that is paged for PS services with IMSI as the identifier shall perform a new GPRS attach and should (re-)activate PDP contexts.\nWhen the SGSN receives a GTP-U PDU from the GGSN for which no PDP context exists, it shall discard the GTP-U PDU and send a GTP error indication to the originating GGSN.\nWhen the SGSN receives a GTP-U PDU from the RNC for which no PDP context exists, the SGSN shall discard the GTP-U PDU and send a GTP error indication to the originating RNC.\nWhen the SGSN receives a mobile-terminated SM from the SMS-GMSC for an IMSI unknown in the SGSN, it rejects the request.\nWhen the SGSN receives a paging request over the Gs interface for an IMSI unknown in the SGSN and the SGSN has not completed recovery, the SGSN may page the MS for packet services with IMSI as identifier in the area specified by the location information provided by the MSC/VLR. If no such location information is provided, the SGSN may page the MS in the routeing areas corresponding to that MSC/VLR. After the MS performs a combined GPRS attach, the SGSN may continue serving the Gs interface paging request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.0.2\tSGSN Failure using S4",
                            "text_content": "When the SGSN receives a GTP-U PDU from the Serving GW for which no Bearer context exists, it shall discard the GTP-U PDU and send a GTP error indication to the originating Serving GW.\nWhen the SGSN receives a GTP-U PDU from the MBMS GW for which no MBMS Point to Point Bearer context exists, it shall discard the GTP-U PDU and send a GTP Error Indication to the originating MBMS GW.\nAn S4-SGSN and an SGW supporting the optional network triggered service restoration procedure shall behave as specified in clause 25.\nWhen the S4-SGSN which does not support the optional network triggered service restoration procedure as specified in clause 25 receives a Downlink Data Notification message for which no MM context exists, the S4-SGSN returns a Downlink Data Notification Acknowledge message to the Serving GW with an appropriate cause. The Serving GW shall delete the related Bearer context related to S4-SGSN; and if there is no ISR associated MME recorded on the related Bearer context the Serving GW shall also notify the PDN GW to delete the Bearer context.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "11.1\tRestart of the SGSN",
                    "description": "",
                    "summary": "",
                    "text_content": "After an SGSN restart, the SGSN deletes all MM, PDP, MBMS UE, and MBMS Bearer contexts affected by the restart.\nWhen the GGSN detects a restart in an SGSN (see clause 18 \"GTP-C based restart procedures\") with which it has PDP context(s) activated and/or MBMS UE context(s), it shall delete all these PDP context(s) and/or MBMS UE context(s). When the GGSN detects a restart in an SGSN with which it has any MBMS Bearer context, it shall not delete the MBMS bearer context unless all SGSNs connected to the GGSN restart.\nWhen the MBMS GW detects a restart in an SGSN (see clause 18 \"GTP-C based restart procedures\") with which it has at least one MBMS Bearer context, the MBMS GW should re-establish the active MBMS bearer services affected by the SGSN restart by initiating MBMS Session Start procedure(s) towards the restarted SGSN (or an alternative SGSN in the same SGSN pool). The MBMS GW shall encode the contents of the MBMS Session Start Request with the same contents as in the original MBMS Session Start Request (or as per the last MBMS Session Update Request received from the BM-SC if the original parameters were updated) with the following exceptions:\n-\tthe MBMS GW shall set the \"MBMS session re-establishment indication\" flag to signal that this message is used to re-establish an MBMS session;\n-\tthe MBMS GW may change the relative start time (\"time to MBMS data transfer\" parameter) to fasten the restoration of the MBMS service in UTRAN;\n-\tthe MBMS GW should set the estimated session duration to a value corresponding to the remaining duration of the session.\nNOTE:\tIf the MBMS GW receives an MBMS Session Update Request from the BM-SC during the SGSN restart, the contents of the MBMS Session Start Request sent to the SGSN after the SGSN restart can also differ from the parameters sent to the SGSN before its restart for the parameters that can be modified by the MBMS session update procedure (i.e. MBMS Session Area, MBMS Time to Data Transfer).\nThe MBMS GW shall not delete the MBMS Bearer context unless all SGSNs/MMEs serving the MBMS bearer service and connected to the MBMS GW have restarted and the MBMS-GW does not support re-establishing MBMS bearer services after an SGSN restart.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "11.2\tRestoration Procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.2.1\tMobile terminated user data transmission",
                            "text_content": "When a Gn-SGSN receives a tunnel PDU for which no PDP context or MBMS Bearer Context exists it discards the tunnel PDU and sends an Error indication message to the originating GGSN.\nAn S4-SGSN and an SGW supporting the optional network triggered service restoration procedure shall behave as specified in clause 25.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.2\tMobile terminated services requested by the MSC/VLR",
                            "text_content": "When the SGSN receives a request for CS paging from an MSC/VLR for an IMSI unknown by the SGSN, if the \"SGSN-Reset\" indicator is set to \"true\", the SGSN sends the paging request with the location information provided by the VLR. If no such location information is provided, the SGSN should page for the MS in all the routeing areas corresponding to that SGSN.\nIf the \"SGSN-Reset\" indicator is set to \"false\" and the IMSI is unknown or the MS is marked as GPRS or non-GPRS detached by the SGSN, the paging request is rejected.\nIf the \"SGSN-Reset\" indicator is set to \"false\" and the IMSI is known and the MS is marked as GPRS and is non-GPRS attached by the SGSN, the paging request shall be sent to the MS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.3\tMobile terminated SMS over GPRS",
                            "text_content": "a)\tSend Routing Information for MT SMS (SMS-GMSC -> HLR):\nThe HLR returns the SGSN number as for normal operation.\nb)\tSend Information for MT SMS:\n-\tWhen the SGSN receives a mobile terminated SMS for an unknown MM context for the MS, or if the SGSN indicator \"Subscriber Data Confirmed by HLR\" is marked \"Not Confirmed\" it rejects the SMS request and returns a failure report with cause value \"Unidentified Subscriber\" to the SMS gateway MSC indicating unsuccessful delivery of the SMS. The Gateway MSC sends a \"Report SM Delivery Status\" request, with a cause of \"Absent Subscriber\", to the HLR. This causes the HLR to set the \"Mobile Station Not Reachable for GPRS Flag\" for the MS, as described in the Technical Specifications3GPP TS 23.040 [4] and 3GPP TS 29.002 [6].\n-\tIf the SGSN has the indicator \"Subscriber Data Confirmed by HLR\" set to \"Confirmed\", the SGSN handles the SMS request in the normal way.\nThe state of the indicator \"Location Information Confirmed in HLR\" does not affect the Mobile Terminated SMS procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.4\tMobile originated Routeing Area Updating or Attach",
                            "text_content": "For attach, where the MS is unknown in the SGSN (i.e. the SGSN has no MM context for the MS) the SGSN creates an MM context for the MS and sets the indicators \"Location Information Confirmed in HLR\", \"Subscriber Data Confirmed by HLR\", \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" to \"Not Confirmed\". If authentication is required, the SGSN retrieves authentication data. The SGSN then performs an \"Update GPRS Location\" to the HLR. If this is successful, the SGSN sets the indicators \"Location Information Confirmed in HLR\" and \"Subscriber Data Confirmed by HLR\" to \"Confirmed\". If the VPLMN supports Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN, the SGSN may perform an \"Update VCSG Location\" to the CSS if the requested cell is a CSG/hybrid cell. If this is successful, the SGSN sets the indicators \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" if the CSS has the valid CSG subscription data to \"Confirmed\".\nFor routing area update, where the MS is unknown in the SGSN (i.e. the SGSN has no MM context for the MS) or for inter-SGSN routing area update, where the MS is unkown in the old SGSN, the SGSN shall reject the RA update with an appropriate cause. In order to remain GPRS-attached, the MS shall then perform a new GPRS attach and should (re-)activate its PDP contexts.\nIf the SGSN has an MM context for the MS, and the indicators \"Location Information Confirmed in HLR\" or \"Subscriber Data Confirmed by HLR\" is set to \"Not Confirmed\" the SGSN performs an \"Update GPRS Location\" to the HLR. If this is successful, the SGSN sets the indicators \"Location Information Confirmed in HLR\" and \"Subscriber Data Confirmed by HLR\" to \"Confirmed\". If the indicators \"Location Information Confirmed by CSS\" or \"Subscriber Data Confirmed by CSS\" if the CSS has the valid CSG subscription data is set to \"Not Confirmed\", and the VPLMN supports Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN, the SGSN may perform an \"Update VCSG Location\" to the CSS if the requested cell is a CSG/hybrid cell. If this is successful, the SGSN sets the indicators \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" if the CSS has the valid CSG subscription data to \"Confirmed\".\nIf the SGSN has an MM context for the MS with the indicator \"Subscriber Data Confirmed by HLR\" marked \"Confirmed\" the originated transmission is handled in the normal way.\nThe SGSN retrieves subscriber data from the HLR by sending an \"Update GPRS Location\" request, which triggers one or more \"Insert Subscriber Data\" operations from the HLR.\nThe SGSN retrieves CSG subscriber data from the CSS by sending an \"Update VCSG Location\" request, which triggers one or more \"Insert Subscriber Data\" operations from the CSS if the CSS has the valid CSG subscription data.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.5\tMobile originated LLC frame",
                            "text_content": "If an SGSN receives an LLC frame for which no MM context exists in the SGSN, and if the LLC frame does not contain an Attach Request or a Routeing Area Update Request signalling message, then the LLC frame shall be discarded. The MS may determine that the network is not responding and attempt to re-attach or eventually a periodic Routing Area Update message is sent by the MS which initiates the attach procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.6\tMobile originated Service Request",
                            "text_content": "For service request, where the MS is unknown in the SGSN (i.e. the SGSN has no MM context for the MS), the SGSN shall reject the service request with an appropriate cause. In order to remain GPRS-attached, the MS shall then perform a new GPRS attach and should (re-)activate its PDP contexts.\nIf the SGSN has an MM context for the MS, and the indicators \"Location Information Confirmed by CSS\" or \"Subscriber Data Confirmed by CSS\" if the CSS has the valid CSG subscription data is set to \"Not Confirmed\", and the VPLMN supports Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN, the SGSN may perform an \"Update VCSG Location\" to the CSS if the requested cell is a CSG/hybrid cell. If this is successful, the SGSN sets the indicators \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" if the CSS has the valid CSG subscription data to \"Confirmed\".\nThe SGSN retrieves CSG subscriber data from the CSS by sending an \"Update VCSG Location\" request, which triggers one or more \"Insert Subscriber Data\" operations from the CSS if the CSS has the valid CSG subscription data.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "11.3\tUse of TLLI",
                    "description": "",
                    "summary": "",
                    "text_content": "After the SGSN has restarted but before the next authenticated radio contact the P-TMSI and TLLI known by the MS are invalid, as the P-TMSI was allocated before the SGSN restarted. The SGSN may request the MS to identify itself with the IMSI in order to make a relationship between the IMSI and the received old TLLI. The SGSN shall allocate a new P-TMSI for that MS.\nIf an MS identifies itself by a TLLI in an MS originating transmission, the SGSN proceeds as follows:\na)\tThe SGSN checks the routing area identity (RAI) of the previous routing area sent by the MS. If this previous RAI belongs to a different SGSN, the request is handled in the normal way.\nb)\tIf the previous RAI belongs to the current SGSN, the status of the TLLI is checked.\n-\tIf the P-TMSI derived from the TLLI was allocated after the SGSN restarted, and corresponds to a valid IMSI record, then the request is handled in the normal way.\n-\tIf the P-TMSI derived from the TLLI was allocated before the SGSN restarted, or does not correspond to a valid IMSI record, then the SGSN requests the IMSI from the MS. If the MS returns an IMSI the SGSN proceeds in the normal way. If the MS does not return an IMSI the network aborts the originating transmission request or location registration procedure.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "11.4\tVLR associations",
                    "description": "",
                    "summary": "",
                    "text_content": "All associations with VLRs affected by the restart of an SGSN are marked as unreliable and may be deleted. Based on configuration data, Reset messages may be sent on the Gs-interface to the VLRs served by the SGSN. If Reset messages are sent, the VLRs may mark all associations with the SGSN as unreliable by setting the restoration indicator \"Confirmed by radio contact\" to \"Not Confirmed\" for the MSs served by that SGSN. See 3GPP TS 29.018 [7]. The associations will be re-initiated one by one by the SGSN at the next Routing Area update, or combined RA/LA update from each MS.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "11.5\tRestart of a peer node",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.5.1\tSGW failure",
                            "text_content": "When an SGSN detects that a peer SGW has failed with or without restart (relying on restart counter as specified in clause 18 \"GTP-C based restart procedures\" or implementation e.g. preconfigured path failure timer) it shall either:\n-\tas a default delete all PDN connection table data/MM bearer contexts associated with the peer node that has failed as well as freeing any internal SGSN resources associated with those PDN connections. The SGSN may optionally perform other implementation specific actions such as to clear external resources (e.g. Iu messages to clear UTRAN resources) or more advanced forms of restoration;\nor\n-\tfollow the procedures specified in clause 27 to restore the PDN connections affected by the SGW failure, if the SGSN and the PGW support these procedures.\nNOTE:\tThe SGSN will have the identity of the PGW and SGW currently in use for a PDN connection available in the SGSN's PDN connection table as part of existing EPC procedures as well as other peer state data.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.5.2\tMBMS-GW failure",
                            "text_content": "The behaviour of an SGSN when it detects that a peer MBMS GW has restarted is described in clause 17A.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "12\tRestoration of Data in an SMLC (GSM only)",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "12.1\tRestart of an SMLC",
                    "description": "",
                    "summary": "",
                    "text_content": "When an SMLC restarts after a failure, it performs the following actions for those of its associated LMUs whose records have been affected by the fault:\n-\tReload all administered LMU data from non-volatile back-up;\n-\tReinitialize other temporary data for each LMU to indicate no ongoing measurement or diagnostic activities;\n-\tPerform data restoration for each affected Type A and Type B LMU as described below.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.2\tData Restoration for a Specific LMU",
                    "description": "",
                    "summary": "",
                    "text_content": "An SMLC may restore data for a specific LMU when the data in the SMLC or LMU is considered unreliable (e.g. if there is no communication between the SMLC and LMU for a long time or if messages received by the SMLC are inconsistent with the LMU state kept by the SMLC). To restore data for a specific LMU, the SMLC shall open a signalling connection to the LMU if this is Type A, as described in 3GPP TS 23.071 [10]. For both a Type A LMU and a Type B LMU, the SMLC shall then send an  LLP Reset message to the LMU. On receiving an LLP Reset, an LMU shall cancel any LCS measurement and O&M tasks previously ordered by the SMLC and shall return an LLP Reset acknowledgement to the SMLC.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "13\tRestoration of Data in an LMU (GSM only)",
            "description": "When an LMU restarts following a failure, it shall reinitialize all data concerning LCS measurement and O&M tasks to indicate that no tasks ordered by an SMLC are active.  A Type A LMU shall then perform an \"IMSI Attach\".  A Type A LMU shall then open a signalling connection to its controlling SMLC as described in 3GPP TS 23.071 [10]. Both a Type A LMU and a Type B LMU shall send an LLP Status Update message to their controlling SMLC containing an indication that the LMU has restarted following a failure. The SMLC shall update its data regarding the state of the LMU and shall return an LLP Update Status acknowledgment to the LMU.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "14\tRestoration of data in the MME",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "14.1\tRestart of the MME",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "14.1.1\tRestoration Procedures",
                            "text_content": "After an MME restart, the MME shall delete all MM Bearer contexts affected by the restart that it may have stored.\nWhen the MBMS GW detects a restart in an MME (see clause 18 \"GTP-C based restart procedures\") with which it has at least one MBMS Bearer context, the MBMS-GW should re-establish the active MBMS bearer services affected by the MME restart by initiating MBMS Session Start procedure(s) towards the restarted MME (or an alternative MME in the same MME pool). The MBMS GW shall encode the MBMS Session Start Request with the same contents as in the original MBMS Session Start Request (or as per the last MBMS Session Update Request received from the BM-SC if the original parameters were updated) with the following exceptions:\n-\tthe MBMS GW shall set the \"MBMS session re-establishment indication\" flag to signal that this message is used to re-establish an MBMS session;\n-\tif no absolute start time (\"MBMS data transfer start\" parameter) has been received, the MBMS GW may change the relative start time (\"time to MBMS data transfer\" parameter) to fasten the restoration of the MBMS service in E-UTRAN;\n-\tthe MBMS GW should set the estimated session duration to a value corresponding to the remaining duration of the session.\nThe MCE shall be able to accept MBMS session requests with an absolute start time (\"MBMS data transfer start\" parameter) in the past.\nNOTE:\tIf the MBMS GW receives an MBMS Session Update Request from the BM-SC during the MME restart, the contents of the MBMS Session Start Request sent to the MME after the MME restart can also differ from the parameters sent to the MME before its restart for the parameters that can be modified by the MBMS session update procedure (i.e. MBMS Session Area, MBMS Time to Data Transfer, MBMS Data Transfer Start).\nThe MBMS GW shall not delete the MBMS Bearer context unless all SGSNs/MMEs serving the MBMS bearer service and connected to the MBMS GW have restarted and the MBMS-GW does not support re-establishing MBMS bearer services after an MME restart.\nIf the MCE receives an M3 Reset message from the MME (i.e. in case the restart event has resulted in loss of some or all M3 transactions reference information) with which it has at least one MBMS Bearer context, the MCE shall deactivate all the related MBMS Bearer contexts locally and towards E-UTRAN within which the MBMS bearer service is active, either immediately or after a pre-configured time period if the corresponding MBMS Bearer contexts are not re-established via any MME.\nAn MME and an SGW supporting the optional network triggered service restoration procedure shall behave as specified in clause 25.\nWhen the MME which does not support the optional network triggered service restoration procedure as specified in clause 25 receives a Downlink Data Notification message for which no MM context exists, the MME returns a Downlink Data Notification Acknowledge message to the Serving GW with an appropriate cause. The Serving GW shall delete the related Bearer context related to MME; and if there is no ISR associated S4-SGSN recorded on the related Bearer context the Serving GW shall also notify the PDN GW to delete the Bearer context.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.1.2\tMobile originated Tracking Area Updating or E-UTRAN Attach",
                            "text_content": "For attach, where the UE is unknown in the MME (i.e. the MME has no MM context for the UE) the MME shall create an MM context for the UE and shall set the indicators \"Location Information Confirmed in HSS\", \"Subscriber Data Confirmed by HSS\", \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" to \"Not Confirmed\". If authentication is required, the MME shall retrieve the authentication data. The MME then performs an \"Update Location\" to the HSS. If this is successful, the MME shall set the indicators \"Location Information Confirmed in HSS\" and \"Subscriber Data Confirmed by HSS\" to \"Confirmed\". If the VPLMN supports Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN, the MME may perform an \"Update VCSG Location\" to the CSS if the requested cell is a CSG/hybrid cell. If this is successful, the MME shall set the indicators \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" if the CSS has the valid CSG subscription data to \"Confirmed\".\nFor tracking area update, where the UE is unknown in the MME (i.e. the MME has no MM context for the UE) or for inter-MME tracking area update, where the UE is unkown in the old MME, the MME shall reject the TA update with an appropriate cause. In order to remain attached, the UE shall then perform a new attach and should (re-)activate its EPS Bearer contexts.\nIf the MME has an MM context for the UE, and the indicator \"Location Information Confirmed in HSS\" or \"Subscriber Data Confirmed by HSS\" is set to \"Not Confirmed\" the MME shall perform an \"Update Location\" to the HSS. If this is successful, the MME shall set the indicators \"Location Information Confirmed in HSS\" and \"Subscriber Data Confirmed by HSS\" to \"Confirmed\". If the indicators \"Location Information Confirmed by CSS\" or \"Subscriber Data Confirmed by CSS\" is set to \"Not Confirmed\", and the VPLMN supports Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN, the MME may perform an \"Update VCSG Location\" to the CSS if the requested cell is a CSG/hybrid cell. If this is successful, the MME shall set the indicators \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" if the CSS has the valid CSG subscription data to \"Confirmed\".\nIf the MME has an MM context for the UE with the indicator \"Subscriber Data Confirmed by HSS\" marked \"Confirmed\" the originated transmission shall be handled in the normal way.\nThe MME retrieves subscriber data from the HSS by sending an \"Update Location\" request, which triggers an \"Update Location\" answer which contains the subscriber data.\nThe MME retrieves CSG subscriber data from the CSS by sending an \"Update VCSG Location\" request, which triggers an \"Update VCSG Location\" answer which may contain the valid CSG subscription data.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.1.3\tMobile terminated services requested by the MSC/VLR",
                            "text_content": "An MME and a VLR supporting mobile terminated CS service delivery via an alternative MME in MME pool shall behave as specified in clause 26.\nWhen the MME receives a request for CS paging from an MSC/VLR for an IMSI unknown by the MME, if the \"MME-Reset\" indicator is set to \"true\", the MME sends the paging request with the location information provided by the VLR. If no such location information is provided, the MME should page for the UE in all the tracking areas corresponding to that MME. The MME may support and apply this procedure to a UE using extended idle mode DRX for MT-SMS service.\nNOTE:\tHow the restarted MME knows the UE's DRX parameter or the extended DRX parameters to page the UE is implementation dependent.\nIf the \"MME-Reset\" indicator is set to \"false\" and the IMSI is unknown or the UE is marked as EMM-DEREGISTERED by the MME, the paging request is rejected.\nIf the \"MME-Reset\" indicator is set to \"false\" and the IMSI is known and the UE is marked as EMM-REGISTERED by the MME, the paging request shall be sent to the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.1.4\tMobile terminated user data transmission",
                            "text_content": "An MME and an SGW supporting the optional network triggered service restoration procedure shall behave as specified in clause 25.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.1.5\tMobile originated Service Request",
                            "text_content": "For service request, where the UE is unknown in the MME (i.e. the MME has no MM context for the UE), the MME shall reject the service request with an appropriate cause. In order to remain attached, the UE shall then perform a new attach and should (re-)activate its EPS Bearer contexts.\nIf the MME has an MM context for the UE, and the indicators \"Location Information Confirmed by CSS\" or \"Subscriber Data Confirmed by CSS\" is set to \"Not Confirmed\", and the VPLMN supports Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN, the MME may perform an \"Update VCSG Location\" to the CSS if the requested cell is a CSG/hybrid cell. If this is successful, the MME shall set the indicators \"Location Information Confirmed by CSS\" and \"Subscriber Data Confirmed by CSS\" if the CSS has the valid CSG subscription data to \"Confirmed\".\nThe MME retrieves CSG subscriber data from the CSS by sending an \"Update VCSG Location\" request, which triggers an \"Update VCSG Location\" answer which may contain the valid CSG subscription data.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.1.6\tMobile Terminated NIDD procedure",
                            "text_content": "During the Mobile Terminated NIDD procedure, if the SCEF receives a MT-Data-Answer from the MME/SGSN with a failure cause that UE cannot be found, the SCEF shall delete all the bearer contexts of this UE and may notify the Operation and Maintenance network element.\nNOTE:\tAfter that, if the SCEF receives a following NIDD Submit request from the SCS/AS for the deleted bearer, the SCEF behaves as specified in clause 5.13.3 of TS 23.682[38] step 2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "14.1A\tRestart of a peer node",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "14.1A.1\tSGW Failure",
                            "text_content": "When an MME detects that a peer SGW has failed with or without restart (relying on restart counter as specified in clause 18 \"GTP-C based restart procedures\" or implementation e.g. preconfigured path failure timer) it shall either:\n-\tas a default delete all PDN connection table data/MM bearer contexts associated with the peer node that has failed as well as freeing any internal MME resources associated with those PDN connections. The MME may optionally perform other implementation specific actions such as to clear external resources (e.g. S1-MME messages to clear eNodeB resources) or more advanced forms of restoration;\nor\n-\tfollow the procedures specified in clause 27 to restore the PDN connections affected by the SGW failure, if the MME and the PGW support these procedures.\nNOTE:\tThe MME will have the identity of the PGW and SGW currently in use for a PDN connection available in the MME's PDN connection table as part of existing EPC procedures as well as other peer state data.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.1A.2\tMBMS GW failure",
                            "text_content": "The behaviour of an MME when it detects that a peer MBMS GW hast restarted is described in clause 17A.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.1A.3\tMCE Restart",
                            "text_content": "When the MME detects a restart in an MCE (i.e. when the MME receives an M3 Reset or M3 Setup Request message from the MCE) with which it has at least one MBMS Bearer context, the MME shall behave as specified in clause 15A.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.1A.4\tUCMF Failure",
                            "text_content": "When an MME detects that a peer UCMF has failed with or without restart (relying on restart counter as specified in clause 19B \"URCMP based restart procedures\" or implementation e.g. a preconfigured path failure timer as specified in clause 20 \"Path management procedures\"), it shall consider the dictionary mapping information received from the failed UCMF is deprecated, the subscription to get notifications from the UCMF become invalid; the MME may retrieve such mapping information upon subsequent UE - AMF signalling e.g. at registration procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "14.2\tVLR associations",
                    "description": "",
                    "summary": "",
                    "text_content": "All associations with VLRs affected by the restart of an MME are marked as unreliable and may be deleted. Based on configuration data, Reset messages may be sent on the SGs interface to the VLRs served by the MME. If Reset messages are sent, the VLRs may mark all associations with the MME as unreliable by setting the restoration indicator \"Confirmed by radio contact\" to \"Not Confirmed\" for the UEs served by that MME. See 3GPP TS 29.118 [14]. The associations will be re-initiated one by one by the MME at the next Combined TA/LA update from each UE.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "14.3\tPartial Failure Handling at MME",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "14.3.1\tGeneral",
                            "text_content": "See Clause 23.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.3.2\tProcedures during PDN Connection Establishment",
                            "text_content": "If the MME supports the feature, the following procedures apply.\nDuring a PDN connection establishment, the MME shall provide one MME FQ-CSID containing exactly one CSID for that particular PDN connection to the SGW in the S11 Create Session Request. The MME shall store the Node-ID and CSID values from the FQ-CSID provided by the SGW and the PGW in the S11 Create Session Response  in its PDN Connection table maintained as part of MME MM and EPS Bearer Contexts as specified in Table 5.6.2-15.7.2-1 in 3GPP TS 23.401 [15].\nThe MME should ensure as far as possible that previously used FQ-CSIDs are not immediately reused after a partial/full failure of an MME.\nThe MME determines that the SGW supports partial failure handling by the presence of the SGW FQ-CSID in the S11 Create Session Response.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.3.3\tProcedures during MME Partial Failure",
                            "text_content": "If the MME supports the feature the following procedures apply.\nWhen an MME detects that it has undergone a partial failure, it shall verify that one or more corresponding CSID(s) are present for the component(s) undergoing a partial fault. If there is no such CSID, then the following does not apply. When one or more CSIDs are currently assigned, the MME shall perform the following.\nThe MME may perform implementation-specific operations to clean up any residual state associated with the CSID(s).\nThe MME shall send a GTPv2 Delete PDN Connection Set Request containing all the MME CSID(s) of the component(s) failing in MME FQ-CSID(s) to  the SGW peers that support the feature.\nUpon receiving a GTPv2 Delete PDN Connection Set Response message with Cause value \"Success\", the MME shall conclude that the SGW peer has initiated the internal deletion of the PDN connections corresponding to the FQ-CSID(s) present in the GTPv2 Delete PDN Connection Set Request message.\nRegardless of the \"Cause\" value in the response, the MME is not required to perform any further recovery actions towards SGW and PGW peers for PDN connections in the connection set identified by the MME FQ-CSID(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.3.4\tProcedures during a Peer's Partial Failure",
                            "text_content": "If the MME supports the feature, the following procedures apply.\nWhen an MME receives a GTPv2 Delete PDN Connection Set Request message from an SGW, the MME shall retrieve all the PDN connections corresponding to each of the FQ-CSID(s) present in the message. The MME shall delete all the retrieved PDN connections and the associated resources. Other implementation-specific actions may be performed.\nAs a response, the MME shall send a GTPv2 Delete PDN Connection Set Response message with appropriate Cause value immediately to the SGW.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.3.5\tProcedures during PDN Connection Removal or Modification",
                            "text_content": "If an MME and an SGW support the feature, the following procedures apply.\nDuring an S11 procedure, impacting an existing PDN connection removal or modification the following apply:\n1)\tIf the SGW is being relocated then the MME shall clear the currently stored SGW FQ-CSID .\n2)\tIf an MME relocation occurs (for example, TAU with MME change), or if an SGW relocation occurs, (for example, TAU with SGW change), the MME shall include its MME FQ-CSID in the S11 Create Session Request for SGW change and the S11 Modify Bearer Request for MME change without SGW change.\n3)\tAdditionally, if MME decides to change own FQ-CSID, the MME shall include MME FQ-CSID in other S11 messages.\n4)\tIf the MME receives a FQ-CSID value of an SGW over S11, the MME shall overwrite the current stored SGW FQ-CSID value with the received value.\n5)\tIf the MME receives a FQ-CSID value of a PGW over S11, the MME shall overwrite the current stored PGW FQ-CSID value with the received value.\n6)\tDuring a S11 procedure removing an existing PDN connection the MME removes the PDN data as well as any stored FQ-CSID values(s) of the PGW FQ-CSID and SGW FQ-CSID. The same actions are done on the old MME if there is an MME relocation.\nThe MME determines that the SGW supports partial failure handling by the presence of the SGW FQ-CSID in the S11 Create Session Response with SGW change; and S11 Modify Bearer Response without SGW change.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "15\tRestoration of data in GERAN/UTRAN",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "15.1\tBSS Failure (A/Gb mode)",
                    "description": "",
                    "summary": "",
                    "text_content": "When a BSS fails, all its BSS contexts affected by the failure become invalid and shall be deleted. BSS storage of data is volatile.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "15.2\tRNC/BSC Failure (Iu mode)",
                    "description": "",
                    "summary": "",
                    "text_content": "When an RNC/BSC fails, all its RNC/BSC contexts affected by the failure become invalid and shall be deleted. RNC/BSC storage of data is volatile. An SGSN that recognises unavailability of an RNC/BSC or receives a Reset from an RNC/BSC, shall locally release the RABs for all affected PDP contexts.\nAny affected PDP contexts that use Direct Tunnel and have an invalid tunnel in GGSN will be recovered when the SGSN receives an Iu connection establishment request from the MS or when the GGSN informed the SGSN that the GGSN has received a GTP error indication from RNC.\nWhen the RNC/BSC receives a GTP-U PDU for which no RAB context exists, the RNC/BSC shall discard the GTP-U PDU and return a GTP error indication to the originating node that may be SGSN or GGSN if Direct Tunnel is established.\nThe RNC should ensure as far as possible that previously used TEID values are not immediately reused after an RNC restart, in order to avoid inconsistent TEID allocation throughout the network.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "15.3\tRNC/BSC Failure (Iu mode) using S4",
                    "description": "",
                    "summary": "",
                    "text_content": "When an RNC/BSC fails, all its RNC/BSC contexts affected by the failure become invalid and shall be deleted. RNC/BSC storage of data is volatile. An SGSN that recognises unavailability of an RNC/BSC or receives a Reset from an RNC/BSC, shall locally release the RABs for all affected PDP contexts. If ISR is activated or direct tunnel is established, the S4-SGSN shall initiate release of the access bearer for all bearers towards the Serving GW as defined in Iu Release Procedure Using S4 in 3GPP TS 23.060 [5]. For the other cases, the S4-SGSN may send the Release Access Bearers Request message to the Serving GW to remove the downlink user plane address and TEID as specified in 3GPP TS 23.060 [5]. In addition, based on operator policy, the SGSN may initiate the Dedicated Bearer Deactivation procedure for bearers using streaming or conversational traffic class. Any affected EPS bearers contexts in Serving GW are recovered when the SGSN receives an Iu connection establishment request from the MS or when the Serving GW initiates the Network Triggered Service Request procedure as specified in 3GPP TS 23.060 [5].\nWhen the RNC/BSC receives a GTP-U PDU for which no RAB Context exists, the RNC/BSC shall discard the GTP-U PDU and return a GTP Error Indication to the originating node that may be SGSN or Serving GW if Direct Tunnel is established.\nAn S4-SGSN that recognises unavailability of an RNC (e.g. no more SCTP association in service) or receives a Reset message from an RNC shall maintain the related MBMS bearer contexts but shall locally delete the RNC related information (i.e. Iu related resources) for all MBMS service association(s) or those indicated in the Reset message. See clause 8.26 of 3GPP TS 25.413 [29].\nUpon receipt of a Reset message from the RNC, the S4-SGSN should then subsequently re-establish the MBMS bearer services affected by the RNC failure by initiating MBMS Session Start procedure(s) towards the RNC. The S4-SGSN shall encode the contents of the MBMS Session Start Request with the same contents as in the original MBMS Session Start Request (or per the last MBMS Session Update Request received from the MBMS GW if the original parameters were updated) with the following exceptions:\n-\tif the S4-SGSN has received recently an MBMS session re-establishment indication from the MBMS GW (i.e. within a past short period covering the time during which the same MBMS session may exist simultaneously in two S4-SGSNs of the S4-SGSN pool), the S4-SGSN shall set the \"MBMS session re-establishment indication\" flag to signal that this message is used to re-establish an MBMS session. Otherwise, the S4-SGSN shall not set \"MBMS session re-establishment indication\" flag;\n-\tthe S4-SGSN should set the estimated session duration to a value corresponding to the remaining duration of the session.\nNOTE 1:\tDuring an Sn path failure when the MBMS GW moves the control of an MBMS session to an alternative S4-SGSN in the S4-SGSN pool (see clause 20.2.3.2), the MBMS session can exist in the old and in the new S4-SGSN for a short period of time. This time period is not bigger than the value of the maximum Sm path failure timer configured at the S4-SGSN. If an RNC happens to restart during this time, both S4-SGSNs will try to re-establish the MBMS session. In this case, it needs to be ensured that the control of the MBMS session remains at the new S4-SGSN, whatever the order of the MBMS Session Start Request messages the RNC will receive from both S4-SGSNs. The setting of the \"MBMS session re-establishment indication\" flag by the new S4-SGSN as specified above ensures that the new S4-SGSN, which has acquired the control of the MBMS session in the recent past, will get the control of the MBMS session.\nNOTE 2:\tIf the S4-SGSN receives an MBMS Session Update Request from the MBMS GW during the RNC failure, the contents of the MBMS Session Start Request sent to the RNC after the RNC recovery can also differ from the parameters sent to the RNC before its failure for the parameters that can be modified by the MBMS session update procedure (i.e. MBMS Session Area, MBMS Time to Data Transfer).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "15.4\tOther RNC functionality for MBMS restoration",
                    "description": "",
                    "summary": "",
                    "text_content": "The RNC should accept an MBMS Session Start Request received for an ongoing MBMS session (i.e. with the same TMGI)\n-\tfrom the same or a different SGSN than the SGSN that currently controls the MBMS session, if the message contains the \"MBMS session re-establishment indication\" flag; or\n-\tfrom the SGSN that currently controls the MBMS session, if the RNC supports the option to maintain MBMS bearer contexts during a pre-configured time period after an Iu path failure and the message is received during that period without the \"MBMS session re-establishment indication\" flag.\nIf it accepts the request from the SGSN, and if the message contains the \"MBMS session re-establishment indication\" flag, the RNC shall:\n-\treplace the Iu related resources for this MBMS service associated to the previous SGSN by those assigned in the MBMS Session Request (if different) and consider that the MBMS session is now being controlled by the new SGSN (if different from the previous SGSN); for IP Unicast over Iu, the RNC receives the user plane data for this MBMS session via the new SGSN (if different from the previous SGSN);\n-\tthe RNC shall leave the former M1 transport network IP multicast address and join the new M1 transport network IP multicast address (including the IP address of the multicast source) if the MBMS Session Start Request contains a different transport network IP multicast distribution address and/or a different IP multicast source address; the RNC shall also use the C-TEID received in the MBMS Session Start Request\nNOTE: This can also result in a change from IP Multicast to IP unicast or vice versa for the Iu userplane.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "15.5\tIu path failure using S4",
                    "description": "",
                    "summary": "",
                    "text_content": "Upon detection of an Iu path failure (i.e. no more SCTP association in service),\n-\tthe RNC shall release all the MBMS services affected by the Iu path failure either immediately or after a pre-configured time period if the corresponding MBMS bearer contexts are not re-established via any S4-SGSN;\n-\tthe S4-SGSN shall maintain the related MBMS bearer contexts but shall locally delete the RNC related information (i.e. Iu related resources) for all MBMS service association(s).\nUpon recovery of the Iu path, the RNC should initiate a Reset procedure towards the related S4-SGSN. Upon receipt of the Reset message from the RNC, the S4-SGSN should behave as specified for RNC failure in clause 15.3.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "15A\tRestoration of data in E-UTRAN",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "15A.1\teNodeB Failure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "15A.1.1\tGeneral",
                            "text_content": "An MME which does not support UE context retention at SCTP recovery and recognises unavailability of an eNodeB (e.g. no more SCTP association in service) or an MME which receives a Reset or a S1 Setup message with UE Retention Information not set to \"ues-retained\" from an eNodeB, shall locally delete the eNodeB related information (\"eNodeB Address in Use for S1-MME\" and \"eNodeB UE S1AP ID\"). In this case, the MME initiates release of all S1 bearers towards the Serving GW by sending a Release Access Bearer Request message as defined in the S1 Release procedure in 3GPP TS 23.401 [15]. The MME shall initiate the Dedicated Bearer Deactivation procedure to deactivate the GBR bearers in the packet core; as an option, the MME may defer the deactivation of the GBR bearers for a short period (e.g. in the order of seconds) so as to allow the re-establishment of the corresponding radio and S1 bearers and thus avoid the GBR bearers deactivation if the MME receives a NAS Service Request or a GTP-C Downlink Data Notification message as a result of the SGW having received an Error Indication message from the eNodeB (see clause 22).\nIf the Serving GW receives Release Access Bearers Request message, the Serving GW shall release all eNodeB related information (address and TEIDs) for the UE, but other elements of the UE's Serving GW context shall not be affected. Any Bearer contexts affected by eNodeB failure that have no valid S1-U tunnel in Serving GW are recovered during the UE Triggered Service Request or during the Network Triggered Service Request procedure as specified in 3GPP TS 23.401 [15].\nAn MME, which supports UE context retention at SCTP recovery and recognises unavailability of an eNodeB (e.g. no more SCTP association in service), shall keep the UEs in ECM-CONNECTED and suspended UE Context data for UEs in ECM-IDLE, which have used the S1 signalling connection before it was broken. Upon the subsequent S1 Setup procedure, the MME and the eNB may agree that UE-related contexts and related signalling connection that have been existing before the S1 Setup shall not be affected as specified in the clause 19.2.2.8 of 3GPP TS 36.300 [32].\nThe eNodeB should ensure as far as possible that previously used TEID values are not immediately reused after an eNodeB restart, in order to avoid inconsistent TEID allocation throughout the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "15A.1.2\tPWS restoration",
                            "text_content": "After an (H)eNodeB has restarted, it shall delete all its warning message data. If the warning message service is operational in one or more cell(s) of the (H)eNodeB, the (H)eNodeB shall send a PWS Restart Indication message, which shall include the identity of the (H)eNodeB, the identity of the restarted cell(s), and the TAI(s) and EAI(s) with which the restarted cell(s) are configured, to the CBC to request the CBC to re-load its warning message data if applicable.\nThe (H)eNB should send the PWS Restart Indication message via two MMEs of the MME pool, if possible, to ensure that the CBC receives the message even if one MME cannot propagate it to the CBC (e.g. due to an SBc path failure).\nFor HeNBs, the HeNB GW (respectively the MME) shall check the cell identity (respectively the HeNB identity) received in the PWS Restart Indication, as specified in clause 4.6.2 of 3GPP TS 36.300 [32].\nUpon receipt of a PWS Restart Indication message, the CBC shall consider that the warning message service is restarted in the reported cell(s), i.e. the service is operational and no warning messages are being broadcast in the cell(s). The CBC shall then re-send the warning message data (with the same message identifier and serial number) to the (H)eNodeB for these cells, if any. When doing so, the CBC:\n-\tshall include the identity of the (H)eNodeB received in the PWS Restart Indication into the Write-Replace-Warning-Request message(s) to enable the MME to forward the message(s) only to the (H)eNodeB (or HeNB GW) involved in the restart;\n-\tshould set the warning area list to the identities of the cell(s) to be reloaded which are relevant to the warning message data being reloaded; and\n-\tmay update the number of broadcasts requested, if necessary.\nNOTE 1:\tSetting the warning area list to the identities of the cell(s) to be reloaded enables, for example, the HeNB GW to forward the message only to the involved HeNB when the restarted HeNB is connected to a HeNB GW.\nThe CBC shall consider a PWS Restart Indication message received shortly after a preceding one for the same cell identity as a duplicate restart indication for that cell which it shall ignore.\nNOTE 2:\tThe broadcast of warning messages can be configured in the network per individual cell, TAI and/or EAI. The CBC can use the list of cell(s), the TAI(s) and EAI(s) received in the PWS Restart Indication to derive the list of warning messages to be broadcast in the respective cell(s), TAI(s) and EAI(s).\nLikewise, in other scenarios where the (H)eNodeB may need to reload its warning message data (e.g. when an individual cell is restarted), the (H)eNodeB shall send a PWS Restart Indication message (including the identity of the (H)eNodeB,  the identity of the restarted cell(s), and the TAI(s) and EAI(s) with which the restarted cell(s) are configured) to the CBC to request the CBC to re-load its warning message data if applicable. The (H)eNodeB, MME and CBC shall then proceed as specified above for an (H)eNodeB restart.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "15A.2\tS1-AP path failure",
                    "description": "",
                    "summary": "",
                    "text_content": "Upon detection of an S1-AP path failure (i.e. no more SCTP association in service),\n-\tthe eNodeB shall either release the RRC connection of the affected UEs, or if UE context retention at SCTP recovery is supported, the eNodeB shall keep those UEs in RRC_CONNECTED and suspended UE Context data for UEs in ECM-IDLE, which have used the S1 signalling connection before it was broken;\n-\tthe MME shall proceed as specified for the eNodeB failure in clause 15A.1.\nThe eNodeB shall continue to broadcast warning messages, if any, during an S1AP path failure. Upon recovery of the S1AP path, the eNodeB shall proceed as if no S1AP path failure had occurred.\nDuring an S1AP path failure, the warning message data stored in the eNodeB may become desynchronized with the CBC, e.g. if the CBC attempts to modify the warning message data during the S1AP path failure. The CBC and MME(s) should support the Write-Replace-Warning-Indication and Stop-Warning-Indication procedures (see 3GPP TS 23.041 [30]) to keep the warning message data synchronized in the eNodeB and the CBC.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "15A.3\tMCE Failure",
                    "description": "",
                    "summary": "",
                    "text_content": "When an MCE fails, the MCE shall release all the MBMS services affected by the failure locally and towards E-UTRAN within which the MBMS bearer services are active, either immediately or after a pre-configured time period if the corresponding MBMS bearer contexts are not re-established via any MME.\nAn MME that recognises unavailability of an MCE (e.g. no more SCTP association in service) or receives a Reset or a M3 Setup Request message from an MCE shall maintain the related MBMS bearer contexts but shall locally delete the MCE related information (i.e. M3 related resources) for all MBMS service association(s) or those indicated in the RESET message. See clauses 8.5 and 8.7 of 3GPP TS 36.444 [28].\nUpon receipt of a Reset or M3 Setup Request message from the MCE, the MME should then subsequently re-establish the MBMS bearer services affected by the MCE failure by initiating MBMS Session Start procedure(s) towards the MCE. The MME shall encode the contents of the MBMS Session Start Request with the same contents as in the original MBMS Session Start Request (or per the last MBMS Session Update Request received from the MBMS GW if the original parameters were updated) with the following exceptions:\n-\tif the MME has received recently an MBMS session re-establishment indication from the MBMS GW (i.e. within a past short period covering the time during which the same MBMS session may exist simultaneously in two MMEs of the MME pool), the MME shall set the \"MBMS session re-establishment indication\" flag to signal that this message is used to re-establish an MBMS session. Otherwise, the MME shall not set \"MBMS session re-establishment indication\" flag;\n-\tif no absolute start time (\"MBMS data transfer start\" parameter) has been received, the MME may change the relative start time (\"time to MBMS data transfer\" parameter) to fasten the restoration of the MBMS service in E-UTRAN;\n-\tthe MME should set the estimated session duration to a value corresponding to the remaining duration of the session.\nThe MCE shall be able to accept MBMS session requests with an absolute start time (\"MBMS data transfer start\" parameter) in the past.\nNOTE 1:\tDuring an Sm path failure when the MBMS GW moves the control of an MBMS session to an alternative MME in the MME pool (see clause 20.2.3.1), the MBMS session can exist in the old and in the new MME for a short period of time. This time period is not bigger than the value of the maximum Sm path failure timer configured at the MME. If an MCE happens to restart during this time, both MMEs will try to re-establish the MBMS session. In this case, it needs to be ensured that the control of the MBMS session remains at the new MME, whatever the order of the MBMS Session Start Request messages the MCE will receive from both MMEs. The setting of the \"MBMS session re-establishment indication\" flag by the new MME as specified above ensures that the new MME, which has acquired the control of the MBMS session in the recent past, will get the control of the MBMS session.\nNOTE 2:\tIf the MME receives an MBMS Session Update Request from the MBMS GW during the MCE failure, the contents of the MBMS Session Start Request sent to the MCE after the MCE recovery can also differ from the parameters sent to the MCE before its failure for the parameters that can be modified by the MBMS session update procedure (i.e. MBMS Session Area, MBMS Time to Data Transfer, MBMS Data Transfer Start).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "15A.4\tM3AP path failure",
                    "description": "",
                    "summary": "",
                    "text_content": "Upon detection of an M3AP path failure (i.e. no more SCTP association in service),\n-\tthe MCE shall release all the MBMS services affected by the M3AP path failure locally and towards E-UTRAN within which the MBMS bearer services are active, either immediately or after a pre-configured time period if the corresponding MBMS bearer contexts are not re-established via any MME;\n-\tthe MME shall maintain the related MBMS bearer contexts but shall locally delete the MCE related information (i.e. M3 related resources) for all MBMS service association(s).\nUpon recovery of the M3AP path, the MCE should initiate a Reset or M3 Setup Request procedure towards the related MME. Upon receipt of the Reset or M3 Setup Request message from the MCE, the MME should then subsequently re-establish the MBMS bearer services affected by the M3AP path failure by initiating MBMS Session Start procedure(s) towards the MCE. The MME shall encode the MBMS Session Start Request with the same contents as in the original MBMS Session Start Request (or per the last MBMS Session Update Request received from the MBMS GW if the original parameters were updated) with the following exceptions:\n-\tif the MME has received recently an MBMS session re-establishment indication from the MBMS GW (i.e. within a past short period covering the time during which the same MBMS session may exist simultaneously in two MMEs of the MME pool), the MME shall set the \"MBMS session re-establishment indication\" flag to signal that this message is used to re-establish an MBMS session. Otherwise, the MME shall not set \"MBMS session re-establishment indication\" flag;\n-\tif no absolute start time (\"MBMS data transfer start\" parameter) has been received, the MME may change the relative start time (\"time to MBMS data transfer\" parameter) to fasten the restoration of the MBMS service in E-UTRAN;\n-\tthe MME should set the estimated session duration to a value corresponding to the remaining duration of the session.\nThe MCE shall be able to accept MBMS session requests with an absolute start time (\"MBMS data transfer start\" parameter) in the past.\nNOTE 1:\tDuring an Sm path failure when the MBMS GW moves the control of an MBMS session to an alternative MME in the MME pool (see clause 20.2.3.1), the MBMS session can exist in the old and in the new MME for a short period of time. This time period is not bigger than the value of the maximum Sm path failure timer configured at the MME. If an M3AP path failure and recovery happens during this time, both MMEs will try to re-establish the MBMS session. In this case, it needs to be ensured that the control of the MBMS session remains at the new MME, whatever the order of the MBMS Session Start Request messages the MCE will receive from both MMEs. The setting of the \"MBMS session re-establishment indication\" flag by the new MME as specified above ensures that the new MME, which has acquired the control of the MBMS session in the recent past, will get the control of the MBMS session.\nNOTE 2:\tIf the MME receives an MBMS Session Update Request from the MBMS GW during the M3AP path failure, the contents of the MBMS Session Start Request sent to the MCE after the M3AP path recovery can also differ from the parameters sent to the MCE before the M3AP path failure for the parameters that can be modified by the MBMS session update procedure (i.e. MBMS Session Area, MBMS Time to Data Transfer, MBMS Data Transfer Start).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "15A.5\tOther MCE functionality for MBMS restoration",
                    "description": "",
                    "summary": "",
                    "text_content": "The MCE should accept an MBMS Session Start Request received for an on-going MBMS session (i.e. with the same TMGI)\n-\tfrom the same or a different MME than the MME that currently controls the MBMS session, if the message includes the \"MBMS session re-establishment indication\" flag; or\n-\tfrom the MME that currently controls the MBMS session, if the MCE supports the option to maintain MBMS bearer contexts during a pre-configured time period after an M3AP path failure, MME restart or MCE failure, and the message is received during that period without the \"MBMS session re-establishment indication\" flag.\nIf the MCE accepts the request from the MME, and if the message contains the \"MBMS session re-establishment indication\" flag,\n-\tthe MCE shall replace the M3 related resources for this MBMS service associated to the previous MME by those assigned in the MBMS Session Start Request (if different) and consider that the MBMS session is now being controlled by the new MME (if different from the previous MME);\n-\tthe eNodeB(s) involved in the broadcast of the MBMS session shall leave the former M1 transport network IP multicast address and join the new M1 transport network IP multicast address (including the IP address of the multicast source) if the MBMS Session Start Request contains a different transport network IP multicast distribution address and/or a different IP multicast source address; the eNodeB(s) shall also use the C-TEID received in the MBMS Session Start Request.\nThe MCE shall be able to accept MBMS session start/update/stop requests with an absolute start time (\"MBMS data transfer start\" or \"MBMS data transfer stop\" parameter) in the past.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "15A.6\tOther MME related functionality for MBMS restoration",
                    "description": "",
                    "summary": "",
                    "text_content": "When establishing MBMS bearer services in an MCE to ensure the distribution of content from ongoing MBMS sessions to an MCE which modifies the lists of the MBMS Service Areas it serves via the MCE Configuration Update procedure (see clause 5.9.2 of 3GPP TS 23.246 [12]), the MME shall encode the MBMS Session Start Request as specified in clause 15A.3 upon receipt of a Reset or M3 Setup Request message from the MCE.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "16\tRestoration of data in the SGW",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "16.1\tRestart of the SGW",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.1.0\tSGW Failure",
                            "text_content": "When a SGW fails, all its Bearer contexts affected by the failure become invalid and may be deleted. SGW storage of subscriber data is volatile.\nWhen the SGW receives a GTP-U PDU for which no Bearer context exists, it shall discard the GTP-U PDU and return a GTP error indication to the originating node (the PGW, the eNodeB, the S4-SGSN, or if Direct Tunnel is established, the RNC) or follow the procedures specified in clause 27.2.2.5 if the restoration of PDN connections after an SGW failure is supported.\nThe SGW should ensure as far as possible that previously used TEID values are not immediately reused after a SGW restart, in order to avoid inconsistent TEID allocation throughout the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.1.1\tRestoration Procedures",
                            "text_content": "After an SGW restart, the SGW shall delete all MM Bearer contexts affected by the restart that it may have stored.\nDuring or immediately after an SGW Restart the SGW shall place local SGW restart counter value in all GTPv2 Echo requests/responses messages and PMIPv6 heartbeat responses the SGW sends.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "16.1a\tRestart of the SGW-C",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.1a.1\tSGW-C failure",
                            "text_content": "When a SGW-C fails, all its Bearer and Session contexts, Sx Association(s) affected by the failure become invalid and may be deleted.\nIf F-TEID allocation is performed in the SGW-C, the SGW-C should ensure as far as possible that previously used F-TEID values are not immediately reused after a SGW-C restart, in order to avoid inconsistent TEID allocation throughout the network.\nNOTE:\tThis is to ensure that F-TEIDs are not reused until earlier PDN connections using them are released e.g. in eNB or PGW.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.1a.2\tRestoration procedure",
                            "text_content": "During or immediately after an SGW-C Restart, the SGW-C shall place local SGW-C Recovery Time Stamp value in all Heartbeat Request/Response and Sx Association Setup Request/Response Messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "16.1b\tRestart of the SGW-U",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.1b.1\tSGW-U failure",
                            "text_content": "When a SGW-U fails, all its Sx session contexts and Sx Association(s) affected by the failure become invalid and may be deleted.\nIf F-TEID allocation is performed in the SGW-U, the SGW-U shall ensure that previously used F-TEID values are not immediately reused after a SGW-U restart, in order to avoid inconsistent TEID allocation throughout the network and to enable the restoration of Sx sessions affected by the failure. How this is ensured is implementation specific.\nNOTE:\tAs the user plane F-TEID pool is partitioned in the SGW-U across the multiple SGW-Cs controlling the SGW-U, the SGW-U does not need to wait for the re-establishment of all the Sx associations from all SGW-Cs to start assigning new F-TEID for new Sx sessions for a particular SGW-C.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.1b.2\tRestoration procedure",
                            "text_content": "During or immediately after an SGW-U Restart, the SGW-U shall place local SGW-U Recovery Time Stamp value in all Heartbeat Request/Response and Sx Association Setup Request/Response Messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "16.1A\tRestart of a peer node",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.1A.1\tMME/S4-SGSN Failure",
                            "text_content": "The SGW will receive the MME/S4-SGSN restart counter in GTPv2 Echo requests and Echo response messages that the SGW receives from the MME/S4-SGSN.\nWhen an SGW detects that a peer MME /S4-SGSN has restarted (see clause 18 \"GTP-C based restart procedures\") it shall either:\n-\tdelete all PDN connection table data/MM bearer contexts associated with the peer node that fails as well as freeing any internal SGW resources associated with those PDN connections. The SGW may optionally perform other implementation specific actions such as messages to clear other external resources (e.g. PCC messages to clear the resources in the PCRF or GTP/PMIP messages to release the corresponding PDN connection in the PGW);\nor\n-\tfollow the network triggered service restoration procedure as specified in clause 25 if the MME, the S4-SGSN and the SGW support this procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.1A.2\tPGW Failure",
                            "text_content": "The SGW will receive the PGW restart counter in GTPv2 Echo requests/ responses and PMIPv6 heartbeat responses that the SGW receives from the PGW.\nWhen an SGW detects that a peer PGW has restarted (see clause 18 \"GTP-C based restart procedures\") it shall delete all PDN connection table data/MM bearer contexts associated with the peer node that fails as well as freeing any internal SGW resources associated with those PDN connections. In addition, if the optional feature PGW Restart Notification is supported by the SGW and MME/S4-SGSN as specified in clause 8.83 in 3GPP TS 29.274[13], the SGW shall initiate the cleanup of the hanging PDN connections associated with the SGW and the restarted PGW at the corresponding MMEs/S4-SGSNs by sending GTPv2 message(s) PGW Restart Notification, with the control plane IP address of the restarted PGW and the control plane IP address of the SGW on the S11/S4 interface included. The SGW may optionally perform other implementation specific actions such as messages to clear other external resources (e.g. PCC messages).\nIf an SGW detects that a peer PGW has failed and not restarted, it may delete all PDN connection table data/MM bearer contexts associated with the peer node that fails as well as freeing any internal SGW resources associated with those PDN connections. In addition, if the optional feature PGW Restart Notification is supported by the SGW and MME/S4-SGSN as specified in clause 8.83 in 3GPP TS 29.274[13], the SGW may also send a PGW Restart Notification message to the MME or S4-SGSN. The PGW Restart Notification message shall include the control plane IP address of the PGW, the control plane IP address of the SGW on the S11/S4 interface and the cause value \"PGW not responding\". It is an implementation matter how an SGW becomes aware that a PGW has failed and has not restarted, e.g. the SGW detects a signalling path failure with the PGW for a duration exceeding the maximum path failure duration timer (see clause 20.2.1).\nWhen the MME/S4-SGSN receives this message, according to the control plane IP address of the restarted PGW and the control plane IP address of the SGW on the S11/S4 interface included in the message, the MME/S4 SGSN should delete all PDN connection table data/MM bearer contexts associated with the SGW and the restarted PGW as well as freeing any internal MME/S4-SGSN resources associated with those PDN connections. Additionally the MME/S4-SGSN may decide to restore certain PDN connections based on operator's policy e.g. based on the QCI and/or ARP and/or APN. If so,\n-\tthe S4-SGSN shall deactivate the corresponding PDN connections using the \"reactivation requested\" cause value as specified in clause 9.2.4.2 of 3GPP TS 23.060 [5];\n-\tthe MME shall deactivate the corresponding PDN connections using the \"reactivation requested\" cause value as specified in clause 5.10.3 of 3GPP TS 23.401 [15] if only a subset of the PDN connections of the UE need to be restored or if the UE has a SCEF PDN connection or if the UE supports Attach without PDN connectivity as specified in clause 5.3.8.3 of 3GPP TS 23.401 [15]; if all the PDN connections of the UE need to be restored and the UE does not have a SCEF PDN connection and the UE does not support Attach without PDN connectivity, the MME shall initiate the \"explicit detach with reattach required\" procedure as specified in clause 5.3.8.3 of 3GPP TS 23.401 [15].\nThe MME/S4-SGSN may prioritize the PDN connections to restore based on operator's policy e.g. based on the QCI and/or APN. Besides, the MME/SGSN may use the subscribed Restoration Priority per APN, if received from the HSS, and if permitted by service level agreements for in-bound roamers, to determine the relative restoration priority among PDN connections to the same APN. The MME/SGSN may use a locally configured value as default restoration priority if the restoration priority for a user's PDN connection is not received from the HSS or not permitted by service level agreement for in-bound roamers.\nNOTE 1:\tThe Restoration Priority can e.g. allow to restore with a higher priority users with an IMS voice subscription over IMS users without an IMS voice subscription.\nThe MME/S4-SGSN may optionally perform other implementation specific actions such as to clear external resources (e.g. S1-MME messages to clear eNodeB resources or Iu messages to clear RNC resources) or more advanced forms of restoration.\nNOTE 2:\tThe SGW will have the identity of the MME/S4-SGSN and PGW currently in use for a PDN connection available in the SGW's PDN connection table as part of existing EPC procedure.\nIf PMIPv6 based S5/S8 interface is used and if the SGW needs to send a request for Gateway Control and QoS Policy Rules Provision procedure towards a PCRF which is known to have restarted since the Gateway Control Session Establishment, the SGW may discard the request and may tear down the associated PDN connection, based on operator policy, by sending a Delete Bearer Request message for the default bearer towards the MME/S4-SGSN with the cause set to \"Reactivation requested\". Additionally, SGW initiates an SGW initiated PDN Disconnection procedure towards PGW. This leads the UE to initiate a UE requested PDN connectivity procedure for the same APN. Emergency and eMPS sessions should not be torn down.\nNOTE 3:\tThe procedure above just enables to clean up the PDN connection affected by the PCRF failure when a specific interaction with the PCRF is required. Prior to that interaction, PCC controlled services cannot be provided to the UE.\nFor a split SGW, if the SGW-C detects a PGW failure, it shall initiate a Sx Session Deletion procedure towards the SGW-U.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.1A.3\tSGW-C Failure",
                            "text_content": "The SGW-U will receive the recovery time stamps of the PFCP entity(ies) in the SGW-C in PFCP heartbeat request/response messages.\nWhen an SGW-U detects that a peer PFCP entity in the SGW-C has restarted, the SGW-U shall delete all its Sx session contexts affected by the restart. When the SGW-U receives a GTP-U PDU not matching any PDRs, it shall discard the GTP-U PDU and return a GTP error indication to the originating node (the PGW, the eNodeB, the S4-SGSN, or if Direct Tunnel is established, the RNC); as an exception, if the restoration of PDN connections after an SGW failure is supported as specified in clause 27, the SGW-U shall not send Error indication message for a configurable period after the restart in the SGW-C.\nNOTE:\tThe period needs to be longer than the time required for the peer node to detect the restart of the SGW-C, e.g. the interval between two echo request messages. This ensures that the MME/SGSN or PGW does not deactivate the bearers before it detects the SGW-C failure and triggers the restoration procedure.\nWhen a SGW-U detects that a peer PFCP entity in the SGW-C is not reachable for a preconfigured time, the SGW-U shall delete all session contexts affected by the unreachability of the peer PFCP entity in the SGW-C that it may have stored.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.1A.4\tSGW-U Failure",
                            "text_content": "The SGW-C will receive the recovery time stamps of the PFCP entity(ies) in the SGW-U in PFCP heartbeat request/response messages.\nAfter an SGW-U restart, the Sx association between SGW-C(s) and the SGW-U has to be re-established.\nNOTE:\tThe SGW-C can determine to re-establish the Sx Association if it receives the cause code \"No established PFCP Association\" in a response message, or if it detects all peer PFCP entities in the SGW-U have restarted.\nRestoration of Sx sessions includes:\n-\tif re-establishment of Sx association is required, the SGW-C may start immediately the Sx association setup procedure, and then;\n-\twhen re-establishing a Sx session and if F-TEID allocation is performed in the SGW-U by network configuration, the SGW-C shall include a restoration indication in the PFCP Session Establishment Request message to indicate to the SGW-U it is for a restoration of an existing PFCP session and the SGW-U shall accept SGW-C allocated F-TEID if possible.\n-\tif the restoration is supported in the SGW-C on a proactive basis, the SGW-C may start re-establishing Sx sessions matching any PDRs.\n-\tif the restoration is supported in the SGW-C on a reactive basis:\n-\tthe SGW-C shall establish an Sx session with a wildcarded PDR to instruct the UP function to forward G-PDU packets which are not matching any other PDRs to the CP function (to a F-TEID uniquely assigned in the CP function for this Sx-u tunnel);\n-\tupon receipt of G-PDUs from this Sx-u tunnel, the CP function shall then check if it has an active session for each received G-PDU packet:\n-\tif so, the CP function shall perform Sx Session establishment procedures to re-establish the corresponding Sx sessions in the SGW-U;\n-\totherwise the CP function shall generate a GTP-U Error Indication with a destination address set to the source IP address of the received G-PDU, and send it to the UP function. The UP function shall forward this GTP-U Error Indication transparently. The CP function shall delete the G-PDU after the check for active sessions.\nNOTE 1:\tThe SGW-U can filter the G-PDU packets with same target F-TEID and send only one such G-PDU to the CP function.\nNOTE 2:\tSuch Sx-u tunnel to forward GTP-U Error Indication can be established per UP function and can also be used to send End Marker packets generated by the CP function. See clause 5.3.2 of TS 29.244 [43]\nThe SGW-U shall not send Error indication message for a configurable period after a PFCP entity restart in the SGW-U  when the SGW-U receives G-PDU not matching any PDRs.\nNOTE 3:\tIf restoration on a reactive basis is used, the period needs to be longer than the time required by the SGW-C to detect the SGW-U restart, establish the Sx association and provision the wildcarded PDR. Otherwise, the period needs to be longer than the time required by the SGW-C to restore all the Sx sessions on a proactive basis.\nWhen the SGW-C detects the failure of an SGW-U without a restart, the SGW-C may select an alternative SGW-U which can take over the IP addresses of the failed one to restore the Sx sessions in the UP function. How this is performed is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "16.2\tPartial Failure Handling at SGW",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.2.1\tGeneral",
                            "text_content": "See Clause 23.\nIn addition, the following applies. If an SGW, which supports the feature receives Delete PDN Connection Set Request/Reply messages from MME or the PGW it  shall forward the messages to the appropriate peer.\nIf the SGW does not support the feature then partial failure handling does not apply to that specific PDN connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.2.2\tProcedures during PDN Connection Establishment",
                            "text_content": "If the SGW supports the feature, the following procedures apply.\nDuring a PDN connection establishment, the SGW shall provide one SGW FQ-CSID for that particular PDN connection to the PGW. Similarly, the SGW shall provide one SGW FQ-CSID for that particular PDN connection to the MME if the MME supports partial failure handling. The SGW shall store the Node-ID and CSID from the FQ-CSID provided by the PGW and the MME respectively for that particular PDN connection in its PDN Connection table maintained as part of \"EPS Bearer Contexts\" table as specified in Table 5.7.3-1 in 3GPP TS 23.401 [15].\nThe SGW shall forward the MME FQ-CSID provided by the MME on S11 to the PGW in the S5/S8 Create Session Request (Proxy Binding Update for PMIPv6)   for that PDN connection. Similarly, the SGW shall forward the PGW FQ-CSID provided by the PGW on S5/S8 to the MME in the S11 Create Session Response for that PDN connection if the MME supports partial failure handling.\nThe SGW determines that the MME supports partial failure handling by the presence of the MME FQ-CSID in the S11 Create Session Request.\nThe SGW determines that the PGW supports partial failure handling by the presence of the PGW FQ-CSID in the S5/S8 Create Session Response for GTPv2 based S5/S8 and the Proxy Binding Acknowledgement for PMIPv6 based S5/S8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.2.3\tProcedures during SGW Partial Failure",
                            "text_content": "If the SGW supports the feature, the following procedures apply.\nWhen an SGW detects that it has undergone a partial failure, it shall verify that one or more corresponding CSID(s) are present for the component undergoing a partial fault. If there is no such CSID, then the following does not apply. When one or more CSIDs are currently assigned, the SGW shall perform the following.\nThe SGW may perform implementation-specific operations to clean up any residual state associated with the CSID(s).\nThe SGW shall send the GTPv2 Delete PDN Connection Set Request containing all the SGW CSIDs of the component(s) failing in SGW FQ-CSID to MME peers supporting the feature. The SGW shall send the GTPv2 Delete PDN Connection Set Request (or PMIP6 Binding Revocation Indication with G bit set) message containing the equivalent SGW FQ-CSID(s) to PGW peers supporting the feature.\nUpon receiving a GTPv2 Delete PDN Connection Set Response message with Cause value \"Success\", the SGW shall conclude that the PGW (for GTPv2 S5/S8) or the MME (for S11) has initiated the internal deletion of the PDN connections corresponding to the FQ-CSID(s) present in the GTPv2 Delete PDN Connection Set Request message. Similarly, upon receiving a successful PMIP6 Binding Revocation Acknowledgment message with G bit set, the SGW shall conclude that the PGW has initiated the internal deletion of the PDN connections corresponding to the CSID(s) present in the PMIP6 Binding Revocation Indication message.\nThe SGW is not required to perform any further recovery actions towards MME and PGW peers for PDN connections in the connection set identified by the SGW FQ-CSID(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.2.4\tProcedures during a Peer's Partial Failure",
                            "text_content": "If the SGW supports the feature, the following procedures apply.\nWhen an SGW receives a S11 GTPv2 Delete PDN Connection Set Request message from an MME, the SGW shall retrieve all the PDN connections corresponding to each of the FQ-CSID(s) present in the message. The SGW shall send a S5/S8 GTPv2 Delete PDN Connection Set Request (or PMIP6 Binding Revocation Indication with G bit set) message containing the FQ-CSID(s) provided by the MME to PGW peers supporting the feature. The SGW shall delete all the retrieved PDN connections and the associated resources. Other implementation-specific actions may be performed.\nAs a response, the SGW shall send a S11 GTPv2 Delete PDN Connection Set Response message with an appropriate Cause value immediately to the MME.\nWhen an SGW receives a S5/S8 GTPv2 Delete PDN Connection Set Request (or PMIP6 Binding Revocation Indication with G bit set) message from a PGW, the SGW shall retrieve all the PDN connections corresponding to each of the FQ-CSID(s) present in the message. The SGW shall send a S11 GTPv2 Delete PDN Connection Set Request message containing the FQ-CSID(s) provided by the PGW to MME peers supporting the feature. The SGW shall delete all the retrieved PDN connections and the associated resources. Other implementation-specific actions may be performed.\nAs a response, the SGW shall send a S5/S8 GTPv2 Delete PDN Connection Set Response message with an appropriate Cause value to the PGW. On PMIP6-based S5/S8 interface, the SGW shall send a PMIP6 Binding Revocation Acknowledgment message with G bit set.\nIf the SGW detects the full/complete failure of an MME or PGW, e.g., through the Echo Request/Echo Response procedure, it may send a Delete PDN Connection Set Request (or PMIP6 Binding Revocation Indication with G bit set) message, containing all of the FQ-CSIDs of the associated hanging PDN connections of the failed node, to the corresponding remote node (MME or PGW).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.2.5\tProcedures during PDN Connection Removal or Modification",
                            "text_content": "Only if the SGW supports the feature, the following procedures apply.\nDuring a S11 or an S5/S8 procedure, impacting an existing PDN connection removal or modification the following apply:\n1)\tIf the MME is being relocated then the SGW shall clear the currently stored MME FQ-CSID value (if any).\n2)\tFor inter MME and intra SGW HO/TAU, and if the new MME supports the feature, then the SGW shall:\n-\tinclude SGW FQ-CSID in the S11 Modify Bearer Response. If PGW supports the feature, the SGW shall also include PGW FQ-CSID into the message.\n-\tinform the feature supporting PGW about the change of FQ-CSID values with the following messages:\n-\tModify Bearer Request, when Modify Bearer Request message needs to be sent to the PGW as specified in the 3GPP TS 23.401 [15], e.g. if the sending of this message is triggered by user location reporting procedure. The message shall contain both SGW FQ-CSID and MME FQ-CSID.\n-\tUpdate PDN Connection Set Request message, only if Modify Bearer Request is not sent. The message shall contain both SGW FQ-CSID and MME FQ-CSID.\n-\tProxy Binding Update (if PMIPv6 is used). The message shall contain both SGW FQ-CSID and MME FQ-CSID.\n3)\tFor inter MME and intra SGW HO/TAU, and if the new MME does not support the feature, then the SGW shall:\n-\tnot include any FQ-CSID in the S11 Modify Bearer Response.\n-\tinform the feature supporting PGW with the following messages:\n-\tModify Bearer Request when Modify Bearer Request message needs to be sent to the PGW as specified in the 3GPP TS 23.401 [15], e.g. if the sending of this message is triggered by user location reporting procedure. The message shall contain only SGW FQ-CSID.\n-\tUpdate PDN Connection Set Request message, only if Modify Bearer Request is not sent. The message shall contain only SGW FQ-CSID.\n-\tProxy Binding Update (if PMIPv6 is used). The message shall contain only the SGW FQ-CSID.\nNOTE:\tThe patial failure handling is not supported by the S4-SGSN, therefore, during the RAU/HO to S4-SGSN procedure, the SGW can behave in the same way as the TAU/HO to a MME which does not support the feature.\n4)\tFor inter SGW HO/TAU, if the new MME supports the feature, then the new SGW shall:\n-\tinclude SGW FQ-CSID in the S11 Create Session Response. If PGW supports the feature, the SGW shall also include PGW FQ-CSID into the message.\n-\tinform the feature supporting PGW about the change of FQ-CSID values with the following messages:\n-\tModify Bearer Request. The message shall contain both SGW FQ-CSID and MME FQ-CSID.\n-\tProxy Binding Update (if PMIPv6 is used). The message shall contain both SGW FQ-CSID and MME FQ-CSID.\n5)\tFor inter SGW HO/TAU, if the MME does not support the feature, then the SGW shall:\n-\tnot include any FQ-CSID in the S11 Create Session Response.\n-\tinform the feature supporting PGW about the change of SGW FQ-CSID value with the following messages:\n-\tModify Bearer Request. The message shall contain only SGW FQ-CSID\n-\tProxy Binding Update (if PMIPv6 is used). The message shall contain only the SGW FQ-CSID.\n6)\tIf the SGW receives a FQ-CSID value of a PGW over S5/S8, or a FQ-CSID value of a MME over S11, the SGW shall overwrite the current stored FQ-CSID value with the received value.\n7)\tDuring the PDN connection removing procedures, a PGW removes the PDN data as well as any stored FQ-CSID values(s) of the MME and SGW FQ-CSIDs.\n8)\tFor the following procedures, if the procedures as specified in 3GPP TS 23.401 [15] e.g. Location Change reporting is enabled, the SGW shall send its own FQ-CSID and the MME FQ-CSID in Modify Bearer Request and Proxy Binding Update across S5/S8 interface to the respective PGW even if the MME did not update its FQ-CSID, e.g.:\n-\tX2-based Handover without SGW relocation\n-\tTAU without MME and without SGW relocation\n-\tUE Triggered Service Request\nDuring a S11 or S5/S8 procedure removing an existing PDN connection the SGW simply removes the PDN data as well as any stored FQ-CSID values(s) of the PGW FQ-CSID and MME FQ-CSID or pointers to such data. The same actions are done on the old SGW if there is an SGW relocation.\nAn SGW determines that the MME supports partial failure handling if MME FQ-CSID is present in the received S11 Modify Bearer Request or S11 Create Session Request (with both MME and SGW change) messages.\nA new SGW determines that the PGW supports partial failure handling if PGW FQ-CSID is present in the S5/S8  Modify Bearer Response for GTPv2 based S5/S8 or in the Proxy Binding  Acknowledgement for PMIPv6 based S5/S8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "17\tRestoration of data in the PGW",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "17.1\tRestart of the PGW",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.1.0\tPGW Failure",
                            "text_content": "When a PGW fails, all its Bearer contexts affected by the failure become invalid and may be deleted. PGW storage of subscriber data is volatile.\nWhen the PGW receives a GTP-U PDU for which no Bearer context exists, it shall discard the GTP-U PDU and return a GTP error indication to the originating node i.e. the SGW/ePDG/TWAN.\nThe PGW should ensure as far as possible that previously used TEID values are not immediately reused after a PGW restart, in order to avoid inconsistent TEID allocation throughout the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.1.1\tRestoration Procedures",
                            "text_content": "After a PGW restart, the PGW shall delete all MM Bearer contexts affected by the restart that it may have stored.\nDuring or immediately after a PGW Restart, the PGW shall place this PGW restart counter value in all GTPv2 echo requests/responses and PMIPv6 heartbeat responses the PGW sends.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17.1a\tRestart of the PGW-C",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.1a.1\tPGW-C failure",
                            "text_content": "When a PGW-C fails, all its Bearer, session contexts and Sx associations affected by the failure become invalid and may be deleted.\nIf F-TEID allocation is performed in the PGW-C, the PGW-C should ensure as far as possible that previously used F-TEID values are not immediately reused after a PGW-C restart, in order to avoid inconsistent TEID allocation throughout the network.\nNOTE:\tThis is to ensure that F-TEIDs are not reused until earlier PDN connections using them are released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.1a.2\tRestoration Procedures",
                            "text_content": "After a PGW-C restart, the PGW-C shall delete all MM Bearer and session contexts, and Sx Associations affected by the restart that it may have stored.\nDuring or immediately after a PGW-C Restart, the PGW-C shall place local PGW-C Recovery Time Stamp value in all Heartbeat Request/Response and Sx Association Setup Request/Response Messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17.1b\tRestart of the PGW-U",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.1b.1\tPGW-U failure",
                            "text_content": "When a PGW-U fails, all its Session contexts and Sx associations affected by the failure become invalid and may be deleted.\nIf F-TEID allocation is performed in the PGW-U, the PGW-U shall ensure that previously used F-TEID values are not immediately reused after a PGW-U restart, in order to avoid inconsistent TEID allocation throughout the network and to enable the restoration of Sx sessions affected by the failure. How this is ensured is implementation specific.\nThe PGW-U shall not send Error indication message for a configurable period after an PGW-U restart when the PGW-U receives G-PDU not matching any PDRs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.1b.2\tRestoration Procedures",
                            "text_content": "During or immediately after an PGW-U Restart, the PGW-U shall place local PGW-U Recovery Time Stamp value in all Heartbeat Request/Response and Sx Association Setup Request/Response Messages.\nImmediately after the re-establishment of an Sx association between the PGW-C and the PGW-U, the PGW-C may start restoring Sx sessions in the PGW-U.\nNOTE :\tRestoring Sx sessions in a PGW-U on a reactive basis (like defined for an SGW-U restart in clause 16.1A.4) is not supported in this release. In some cases, a restarted PGW-U cannot determine from the UE IP address the CP function reponsible for an incoming packet for which no session exists, e.g. when a UP function is controlled by multiple CP function for the same APN and when the UE IP address was assigned by the PDN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17.1A\tRestart of a peer node",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.1A.1\tSGW/ePDG/TWAN Failure",
                            "text_content": "The PGW will receive the SGW/ePDG/TWAN restart counters in GTPv2 echo requests/responses and  PMIPv6 heartbeat responses that the PGW receives from the SGW/ePDG/TWAN.\nWhen a PGW detects that a peer ePDG/peer TWAN has restarted it shall delete all PDN connection table data/MM bearer contexts associated with the peer node that fails as well as freeing any internal PGW resources associated with those PDN connections. The PGW may optionally perform other implementation specific actions such as messages to clear other external resources (e.g. PCC messages).\nWhen a PGW detects that a peer SGW has failed with or without restart it shall either:\n-\tproceed as specified above when the PGW detects that a peer ePDG/TWAN fails; or\n-\tfollow the procedures specified in clause 27 to restore the PDN connections affected by the SGW failure, if the MME/S4-SGSN and the PGW support these procedures.\nNOTE:\tThe PGW will have the identity of SGW/ePDG/TWAN currently in use for a PDN connection available in the PGW's PDN connection table as part of existing EPC procedure.\nFor multi-access PDN connection in the Network-initiated NBIFOM mode, when the PGW detects ePDG/TWAN has failed, the PGW may:\n-\tmaintain the PDN connection on the 3GPP access and notify the PCRF the removal of Non-3GPP access. Then the PCRF can determine to move the affected traffic to the 3GPP access by updating the PCC rules as specified in the clause 5.8 in the 3GPP TS 23.161 [39].\nFor multi-access PDN connection in the Network-initiated NBIFOM mode, when the PGW detects that the SGW has failed, the PGW may:\n-\tmaintain the PDN connection on the Non-3GPP access and notify the PCRF the removal of 3GPP access. Then the PCRF can determine to move the affected traffic to the 3GPP access by updating the PCC rules as specified in the clause 5.8 in the 3GPP TS 23.161 [39], if the SGW restoration procedures as specified in clause 27 are not supported; or,\n-\tfollow the SGW restoration procedures specified in clause 27, e.g. maintain the PDN connection on both non-3GPP access and 3GPP access without notify the PCRF about SGW failure, if the SGW restoration procedures are supported.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.1A.2\tPCRF Failure",
                            "text_content": "If the PGW needs to send a request for IP-CAN Session Modification procedure towards a PCRF which is known to have restarted since the IP-CAN session establishment, the PGW may discard the request and may tear down the associated PDN connection, based on operator policy, by initiating a PGW initiated bearer deactivation procedure for the default bearer towards the MME/S4-SGSN with the cause set to \"Reactivation requested\". This leads the UE to initiate a UE requested PDN connectivity procedure for the same APN. Emergency and eMPS sessions should not be torn down.\nNOTE:\tThe procedure above just enables to clean up the PDN connection affected by the PCRF failure when a specific interaction with the PCRF is required. Prior to that interaction, PCC controlled services cannot be provided to the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.1A.3\tPGW-C Failure",
                            "text_content": "The PGW-U will receive the recovery time stamps of the PFCP entity(ies) in the PGW-C in  PFCP heartbeat requests/responses.\nWhen a PGW-U detects that a peer PFCP entity in the PGW-C has restarted, the PGW-U shall delete all session contexts affected by the restart that it may have stored.\nWhen a PGW-U detects that a peer PFCP entity in the PGW-C is not reachable for a preconfigured time, the PGW-U shall delete all session contexts affected by the unreachability of the peer PFCP entity in the PGW-C that it may have stored.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.1A.4\tPGW-U Failure",
                            "text_content": "The PGW-C will receive the recovery time stamps of the PFCP entity(ies) in the PGW-U in and PFCP heartbeat requests/responses.\nThe PGW-C may start restoring Sx sessions in the PGW-U and it may:\n-\tif re-establishment of Sx association is required, immediately re-establish the Sx association between the PGW-C and the PGW-U;\n-\tre-establish Sx sessions affected by the PGW-U failure. .\n-\twhen re-establishing a Sx session and if F-TEID allocation is performed in the PGW-U by network configuration, the PGW-C shall include a restoration indication in the PFCP Session Establishment Request message to indicate to the PGW-U it is for a restoration of an existing PFCP session and the PGW-U shall accept PGW-C allocated F-TEID if possible.\nNOTE:\tThe PGW-C can determine to re-establish the Sx Association if it receives the cause code \"No established PFCP Association\" in a response message, or if it detects all peer PFCP entities in the PGW-U have restarted. When a PGW-C detects the failure of a PGW-U without a restart, the PGW-C may select an alternative PGW-U to restore the Sx sessions in the UP function. How this is performed is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17.2\tPartial Failure Handling at PGW",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.2.1\tGeneral",
                            "text_content": "See Clause 23.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.2\tProcedures during PDN Connection Establishment",
                            "text_content": "If the PGW supports the feature, the following procedures apply.\nDuring a PDN connection establishment, the PGW shall provide one FQ-CSID containing exactly one CSID for that particular PDN connection to the SGW, the ePDG or the TWAN. The PGW shall store the FQ-CSID provided by the SGW and the MME in the PDN Connection table maintained as part of P-GW Context as specified in Table 5.7.3-1 in 3GPP TS 23.401 [15]. Similarly, the PGW shall store the FQ-CSID received from the ePDG or the TWAN.\nThe PGW should ensure as far as possible that previously used FQ-CSIDs are not immediately reused after a partial/full failure of a PGW.\nPGW determines that the partial failure handling does not apply to this PDN connection if it does not receive an SGW FQ-CSID in the S5/S8 Create Session Request (for GTP based interface) or in Proxy Binding Update (for PMIPv6 based interface), or if it does not receive a TWAN FQ-CSID in the S2a Create Session Request (for GTP based S2a) or in Proxy Binding Update (for PMIPv6 based S2a), or if it does not receive an ePDG FQ-CSID in the S2b Create Session Request (for GTP based S2b) or in Proxy Binding Update (for PMIPv6 based S2b).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.3\tProcedures during PGW Partial Failure",
                            "text_content": "If the PGW supports the feature, the following procedures apply.\nWhen a PGW detects that it has undergone a partial failure, it shall verify that one or more corresponding CSID(s) are present for the component(s) undergoing a partial fault. If there is no such CSID, then the following does not apply. When one or more CSIDs are currently assigned, the PGW shall perform the following:\n-\tThe PGW may perform implementation-specific operations to clean up any residual state associated with the CSID(s).\n-\tThe PGW shall send the GTPv2 Delete PDN Connection Set Request (or PMIPv6 Binding Revocation Indication with G bit set) message containing all the PGW FQ-CSID(s) of the component(s) failing to the SGW, the TWAN or the ePDG that support the feature.\nUpon receiving a GTPv2 Delete PDN Connection Set Response message with Cause value \"Success\", the PGW shall conclude that the SGW, the ePDG peer or the TWAN peer has initiated the internal deletion of the PDN connections corresponding to the FQ-CSID(s) present in the GTPv2 Delete PDN Connection Set Request message. Similarly, upon receiving a PMIP6 Binding Revocation Acknowledgment message with G bit set, the PGW shall conclude that the SGW, the ePDG or the TWAN has initiated the internal deletion of the PDN connections corresponding to the CSID(s) present in the PMIPv6 Binding Revocation Indication message with G bit set.\nThe PGW is not required to perform any further recovery actions towards SGW, MME peers, an ePDG peer or a TWAN peer for PDN connections in the connection set identified by the PGW FQ-CSID regardless of the \"Cause\" value in the response.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.4\tProcedures during a Peer's Partial Failure",
                            "text_content": "If the PGW supports the feature, the following procedures apply.\nWhen a PGW receives a GTPv2 Delete PDN Connection Set Request (or PMIPv6 Binding Revocation Indication with G bit set) message from an SGW, an ePDG or a TWAN, the PGW shall retrieve all the PDN connections corresponding to each of the FQ-CSIDs present in the message. The PGW shall delete all the retrieved PDN connections and the associated resources. Other implementation-specific actions may be performed.\nAs a response, the PGW shall send a GTPv2 Delete PDN Connection Set Response message. On PMIPv6-based S5/S8 interface, the PGW shall send a PMIPv6 Binding Revocation Acknowledgment message with G bit set.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.5\tProcedures during PDN Connection Removal or Modification",
                            "text_content": "If the PGW supports the feature, the following procedures apply.\nDuring a S5/S8 procedure, impacting an existing PDN connection Removal or Modification the following apply:\n1)\tIf an SGW is being relocated then the PGW shall clear the currently stored MME and SGW FQ-CSID values.\n2)\tIf the SGW includes a SGW FQ-CSID in the S5/S8 Modify Bearer Request (Proxy Binding Update for PMIPv6), or Update PDN Connection Request message, then the PGW shall include PGW FQ-CSID in the S5/S8 Modify Bearer Response (Proxy Binding  Acknowledgement for PMIPv6), or Update PDN Connection Response message.\n3)\tIf the new SGW does not include a SGW FQ-CSID in the S5/S8 Modify Bearer Request (Proxy Binding Update for PMIPv6), then the new SGW does not support the feature and the feature does not apply for this PDN connection. In such case, PGW shall not include PGW FQ-CSID in the S5/S8 Modify Bearer Response (Proxy Binding  Acknowledgement for PMIPv6).\n4)\tIf the PGW receives an SGW FQ-CSID and/or an MME FQ-CSID value of a SGW over S5/S8 then the PGW shall overwrite the respective stored FQ-CSID value with the received value.\n5)\tIf the PGW receives an Update PDN Connection Request, a Modify Bearer Request or Proxy Binding Update  with an SGW FQ-CSID but without an MME FQ-CSID then the PGW shall erase the MME FQ-CSID value (i.e. the current MME does not support the feature).\n6)\tDuring a S5/S8 procedure removing an existing PDN connection the PGW simply removes the PDN data as well as any stored FQ-CSID values(s) of the MME and SGW or pointers to such data.\nDuring an S2a/S2b procedure, impacting an existing PDN connection Removal or Modification the following apply:\n1)\tIf the PGW receives a TWAN or an ePDG FQ-CSID value then the PGW shall overwrite the respective stored FQ-CSID value with the received value;\n2)\tDuring an S2a/S2b procedure removing an existing PDN connection, the PGW removes the corresponding PDN data as well as any stored FQ-CSID value of the TWAN or the ePDG FQ-CSID.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "17A\tRestoration of data in the MBMS GW",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "17A.1\tRestart of the MBMS GW",
                    "description": "",
                    "summary": "",
                    "text_content": "When a MBMS GW fails, all its MBMS Bearer contexts affected by the failure become invalid and will be deleted. MBMS GW storage of subscriber data is volatile.\nAfter a MBMS GW restart, all the MBMS Bearer contexts stored in the MBMS GW and affected by the restart become invalid and will be deleted. All the SGmb Diameter sessions affected by the restart are also lost in the MBMS GW.\nWhen the SGSN/MME detects a restart in a MBMS GW (see clause 18 \"GTP-C based restart procedures\") with which it has MBMS Bearer contexts activated, it shall deactivate all the related MBMS Bearer contexts locally and towards E-UTRAN/UTRAN in which the MBMS bearer service is active. The MME shall initiate a M3AP Reset procedure (see clause 8.5 of 3GPP TS 36.444 [28]), or an MBMS Session Stop procedure per affected MBMS service (see clause 8.3 of 3GPP TS 36.444 [28]), towards the MCE(s) to deactivate the related MBMS services in E-UTRAN. The SGSN shall initiate an MBMS Session Stop procedure per affected MBMS service (see clause 8.38 of 3GPP TS 25.413 [29]), towards the RNC(s) to deactivate the related MBMS services in UTRAN.\nIf the MBMS GW receives a non-initial message (i.e. MBMS session update or MBMS session stop request) from the BM-SC for which no SGmb Diameter session exists, the MBMW GW shall discard the message and return a Diameter error indication to the originating BM-SC.\nIn deployments without a Diameter Agent between the BM-SC and the MBMS GW, the BM-SC shall detect a restart in the MBMS GW using either:\n-\tthe Diameter Origin-State-Id AVP as specified in the Diameter Base Protocol. To enable fast detection of restart, the Diameter Origin-State-Id AVP shall be included (at least) in Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands; or\n-\tthe Diameter Restart-Counter AVP as specified in the MBMS Heartbeat procedure (see clause 29), if this procedure is supported.\nIn deployments with a Diameter Agent between the BM-SC and the MBMS GW, the BM-SC shall detect a restart in the MBMS GW using the Diameter Restart-Counter AVP as specified in the MBMS Heartbeat procedure (see clause 29).\nNOTE 1:\tThe intermediate Diameter Agent can remove or update the Diameter Origin-State-Id AVP, e.g. if it needs to modify the Origin-Host-ID. Thus the Diameter Origin-State-Id AVP, if received by the BM-SC or MBMS GW, does not reflect the state of the remote MBMS peer but the state of the Diameter Agent.\nWhen the BM-SC detects a restart in a MBMS GW with which it has at least one MBMS Bearer context, the BM-SC shall maintain the related MBMS bearer context(s), assume that all related SGmb Diameter session(s) have been terminated and clean-up internal resources associated with these lost session(s). The BM-SC should then re-establish the active MBMS bearer services affected by the MBMS GW restart by initiating MBMS Session Start procedure(s) towards the restarted MBMS GW (or an alternative MBMS GW). The BM-SC shall encode the MBMS Session Start Request with the same contents as in the original MBMS Session Start Request (or per the last MBMS Session Update Request sent by the BM-SC if the original parameters were updated) with the following exceptions:\n-\tthe BM-SC shall set the \"MBMS session re-establishment indication\" flag to signal that this message is used to re-establish an MBMS session;\n-\tif no absolute start time (\"MBMS data transfer start\" parameter) has been sent, the BM-SC may change the relative start time (\"time to MBMS data transfer\" parameter) to fasten the restoration of the MBMS service in E-UTRAN;\n-\tthe BM-SC should set the estimated session duration to a value corresponding to the remaining duration of the session.\nNOTE 2:\tIf the BM-SC is instructed to modify an MBMS Session during the MBMS GW failure/restart, the contents of the MBMS Session Start Request sent to the MBMS GW after the MBMS GW restart can also differ from the parameters sent to the MBMS GW before its restart for the parameters that can be modified by the MBMS session update procedure (i.e. MBMS Session Area, MBMS Time to Data Transfer, MBMS Data Transfer Start).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "17A.2\tRestart of a peer node",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17A.2.1\tMME failure",
                            "text_content": "The behaviour of an MBMS GW when it detects that a peer MME has restarted is described in clause 14.1.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17A.2.2\tSGSN failure",
                            "text_content": "The behaviour of an MBMS GW when it detects that a peer SGSN has restarted is described in clause 11.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17A.2.3\tBM-SC failure",
                            "text_content": "In deployments without a Diameter Agent between the BM-SC and the MBMS GW, the MBMS GW shall detect a restart in the BM-SC using either:\n-\tthe Diameter Origin-State-Id AVP as specified in the Diameter Base Protocol. To enable fast detection of restart, the Diameter Origin-State-Id AVP shall be included (at least) in Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands; or\n-\tthe Diameter Restart-Counter AVP as specified in the MBMS Heartbeat procedure (see clause 29), if this procedure is supported.\nIn deployments with a Diameter Agent between the BM-SC and the MBMS GW, the MBMS GW shall detect a restart in the BM-SC using the Diameter Restart-Counter AVP as specified in the MBMS Heartbeat procedure (see clause 29).\nNOTE:\tThe intermediate Diameter Agent can remove or update the Diameter Origin-State-Id AVP, e.g. if it needs to modify the Origin-Host-ID. Thus the Diameter Origin-State-Id AVP, if received by the BM-SC or MBMS GW, does not reflect the state of the remote MBMS peer but the state of the Diameter Agent.\nWhen the MBMS GW detects a restart of the BM-SC with which it has at least one MBMS Bearer context, the MBMS GW shall assume that all related SGmb Diameter session(s) have been terminated and shall deactivate all the related MBMS Bearer contexts locally and towards E-UTRAN/UTRAN in which the MBMS bearer service is active by sending MBMS Session Stop messages to their controlling MME/SGSNs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "17B\tRestoration of data in the ePDG",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "17B.1\tRestart of the ePDG",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17B.1.1\tePDG Failure",
                            "text_content": "When an ePDG fails, all its Bearer contexts/PDN connections affected by the failure become invalid and may be deleted. ePDG storage of subscriber data is volatile.\nWhen the ePDG receives a GTP-U PDU over GTPv2 based S2b for which no Bearer context exists, it shall discard the GTP-U PDU and return a GTP error indication to the originating node (i.e. the PGW).\nThe ePDG should ensure as far as possible that previously used TEID values are not immediately reused after an ePDG restart, in order to avoid inconsistent TEID allocation throughout the network.\nWhen the ePDG receives a user packet with an unknown GRE Key over PMIPv6 based S2b, the ePDG shall discard the packet and optionally response back with an ICMP message, as specified in Clauses  8.2 and 8.3 of  IETF RFC2473 [31] for the node unreachable error case.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17B.1.2\tRestoration Procedures",
                            "text_content": "After an ePDG restart, the ePDG shall delete all MM Bearer contexts affected by the restart that it may have stored.\nDuring or immediately after an ePDG Restart the ePDG shall place local ePDG restart counter value in all GTPv2 Echo requests/responses messages and PMIPv6 heartbeat responses the ePDG sends to the PGW.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17B.1A\tRestart of a peer node",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17B.1A.1\tPGW Failure",
                            "text_content": "The ePDG will receive the PGW restart counter in GTPv2 Echo requests/ responses and PMIPv6 heartbeat responses that the ePDG receives from the PGW.\nWhen an ePDG detects that a peer PGW has restarted (see clause 18 \"GTP-C based restart procedures\" and clause 19 \"PMIPv6 based restart procedures\") it shall delete all PDN connection table data/MM bearer contexts associated with the peer node that fails, free any internal ePDG resources associated with those PDN connections and initiate the release of the corresponding SWu instances (i.e. IKEv2 tunnels).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17B.2\tPartial Failure Handling at ePDG",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17B.2.1\tGeneral",
                            "text_content": "See clause 23.\nThe partial failure feature is optional for ePDG.\nIf the ePDG does not support the feature then partial failure handling does not apply to that specific PDN connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17B.2.2\tProcedures during PDN Connection Establishment",
                            "text_content": "If the ePDG supports the feature, the following procedures apply.\nDuring a PDN connection establishment, the ePDG shall provide one ePDG FQ-CSID containing exactly one CSID for that particular PDN connection to the PGW. The ePDG shall store the Node-ID and CSID from the FQ-CSID provided by the PGW for that particular PDN connection in its PDN Connection table.\nThe ePDG determines that the PGW supports partial failure handling by the presence of the PGW FQ-CSID in the Create Session Response for GTPv2 based S2b and/or Proxy Binding Acknowledgement message for PMIPv6 based S2b.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17B.2.3\tProcedures during ePDG Partial Failure",
                            "text_content": "If the ePDG supports the feature, the following procedures apply.\nWhen an ePDG detects that it has undergone a partial failure, it shall verify that one or more corresponding CSID(s) are present for the component undergoing a partial fault. If there is no such CSID, then the following does not apply. When one or more CSIDs are currently assigned, the ePDG shall perform the following.\nThe ePDG may perform implementation-specific operations to clean up any residual state associated with the CSID(s).\nThe ePDG shall send Delete PDN Connection Set Request containing all the ePDG CSIDs of the component(s) failing in ePDG FQ-CSID over the GTPv2 based S2b interface or PMIPv6 Binding Revocation Indication with G bit set message containing the equivalent ePDG FQ-CSID(s) over the PMIPv6 based S2b interface to PGW peers supporting the feature.\nOn the GTPv2 based S2b interface, upon receiving a GTPv2 Delete PDN Connection Set Response message with Cause value \"Success\", the ePDG shall conclude that the PGW has initiated the internal deletion of the PDN connections corresponding to the FQ-CSID(s) present in the GTPv2 Delete PDN Connection Set Request message. Similarly, on the PMIPv6 based S2b interface, upon receiving a successful PMIP6 Binding Revocation Acknowledgment message with G bit set, the ePDG shall conclude that the PGW has initiated the internal deletion of the PDN connections corresponding to the CSID(s) present in the PMIP6 Binding Revocation Indication message.\nThe ePDG is not required to perform any further recovery actions towards PGW peers for PDN connections in the connection set identified by the PGW FQ-CSID(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17B.2.4\tProcedures during PGW Partial Failure",
                            "text_content": "If the ePDG supports the feature, the following procedures apply.\nWhen an ePDG receives a GTPv2 Delete PDN Connection Set Request or PMIP6 Binding Revocation Indication with G bit set message from a PGW, the ePDG shall retrieve all the PDN connections corresponding to each of the FQ-CSID(s) present in the message. The ePDG shall delete all the retrieved PDN connections, free the associated internal resources and initiate the release of the corresponding SWu instances (i.e. IKEv2 tunnels). Other implementation-specific actions may be performed.\nAs a response, the ePDG shall send a GTPv2 Delete PDN Connection Set Response message with an appropriate Cause value or a PMIPv6 Binding Revocation Acknowledgment message with G bit set to the PGW.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17B.2.5\tProcedures during PDN Connection Removal or Modification",
                            "text_content": "For the modification of an existing PDN connection established over 2b, if the corresponding ePDG and PGW support the partial failure feature, when the ePDG receives an FQ-CSID value of a PGW over S2b, the ePDG shall overwrite the currently stored FQ CSID value with the received value.\nFor the removal of an existing PDN connection established over S2b, if the corresponding ePDG and PGW support the partial failure feature, an ePDG removes the corresponding PDN data as well as any relevant stored FQ-CSID value of the PGW FQ-CSID.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "17C\tRestoration of data in the TWAN",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "17C.1\tRestart of the TWAN",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17C.1.1\tTWAN Failure",
                            "text_content": "When a TWAN fails, all its Bearer contexts/PDN connections affected by the failure become invalid and may be deleted. TWAN storage of subscriber data is volatile.\nWhen the TWAN receives a GTP-U PDU over GTPv2 based S2a for which no Bearer context exists, it shall discard the GTP-U PDU and return a GTP error indication to the originating node (i.e. the PGW).\nThe TWAN should ensure as far as possible that previously used TEID values are not immediately reused after a TWAN restart, in order to avoid inconsistent TEID allocation throughout the network.\nWhen the TWAN receives a user packet with an unknown GRE Key over PMIPv6 based S2a, the TWAN shall discard the packet and optionally respond back with an ICMP message, as specified in Clauses  8.2 and 8.3 of  IETF RFC2473 [31] for the node unreachable error case.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17C.1.2\tRestoration Procedures",
                            "text_content": "After a TWAN restart, the TWAN shall delete all Bearer contexts affected by the restart that it may have stored and place local TWAN restart counter value in all GTPv2 Echo requests/responses messages and PMIPv6 heartbeat responses the TWAN sends to the PGW.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17C.1A\tRestart of a peer node",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17C.1A.1\tPGW Failure",
                            "text_content": "The TWAN will receive the PGW restart counter in GTPv2 Echo requests/ responses and PMIPv6 heartbeat responses that the TWAN receives from the PGW.\nWhen a TWAN detects that a peer PGW has restarted (see clause 18 \"GTP-C based restart procedures\" and clause 19 \"PMIPv6 based restart procedures\") it shall delete all PDN connection table data/bearer contexts associated with the peer node that fails, and may free the associated internal TWAN resources.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17C.2\tPartial Failure Handling at TWAN",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17C.2.1\tGeneral",
                            "text_content": "See clause 23.\nThe partial failure feature is optional for TWAN.\nIf the TWAN does not support the feature then partial failure handling does not apply to that specific PDN connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17C.2.2\tProcedures during PDN Connection Establishment",
                            "text_content": "If the TWAN supports the feature, the following procedures apply.\nDuring a PDN connection establishment, the TWAN shall provide one TWAN FQ-CSID containing exactly one CSID for that particular PDN connection to the PGW. The TWAN shall store the Node-ID and CSID from the FQ-CSID provided by the PGW for that particular PDN connection in its PDN Connection table.\nThe TWAN determines that the PGW supports partial failure handling by the presence of the PGW FQ-CSID in the Create Session Response for GTPv2 based S2a and/or Proxy Binding Acknowledgement message for PMIPv6 based S2a.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17C.2.3\tProcedures during TWAN Partial Failure",
                            "text_content": "If the TWAN supports the feature, the following procedures apply.\nWhen a TWAN detects that it has undergone a partial failure, it shall verify that one or more corresponding CSID(s) are present for the component undergoing a partial fault. If there is no such CSID, then the following does not apply. When one or more CSIDs are currently assigned, the TWAN shall perform the following.\nThe TWAN may perform implementation-specific operations to clean up any residual state associated with the CSID(s).\nThe TWAN shall send Delete PDN Connection Set Request containing all the TWAN CSIDs of the component(s) failing in TWAN FQ-CSID over the GTPv2 based S2a interface or PMIPv6 Binding Revocation Indication with G bit set message containing the equivalent TWAN FQ-CSID(s) over the PMIPv6 based S2a interface to PGW peers supporting the feature.\nOn the GTPv2 based S2a interface, upon receiving a GTPv2 Delete PDN Connection Set Response message with Cause value \"Success\", the TWAN shall conclude that the PGW has initiated the internal deletion of the PDN connections corresponding to the FQ-CSID(s) present in the GTPv2 Delete PDN Connection Set Request message. Similarly, on the PMIPv6 based S2a interface, upon receiving a successful PMIPv6 Binding Revocation Acknowledgment message with G bit set, the TWAN shall conclude that the PGW has initiated the internal deletion of the PDN connections corresponding to the CSID(s) present in the PMIPv6 Binding Revocation Indication message.\nThe TWAN is not required to perform any further recovery actions towards PGW peers for PDN connections in the connection set identified by the PGW FQ-CSID(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17C.2.4\tProcedures during PGW Partial Failure",
                            "text_content": "If the TWAN supports the feature, the following procedures apply.\nWhen an TWAN receives a GTPv2 Delete PDN Connection Set Request or PMIP6 Binding Revocation Indication with G bit set message from a PGW, the TWAN shall retrieve all the PDN connections corresponding to each of the FQ-CSID(s) present in the message. The TWAN shall delete all the retrieved PDN connections, and may free the associated internal TWAN resources.\nAs a response, the TWAN shall send a GTPv2 Delete PDN Connection Set Response message with an appropriate Cause value or a PMIPv6 Binding Revocation Acknowledgment message with G bit set to the PGW.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17C.2.5\tProcedures during PDN Connection Removal or Modification",
                            "text_content": "For the modification of an existing PDN connection established over S2a, if the corresponding TWAN and PGW support the partial failure feature, when the TWAN receives an FQ-CSID value of a PGW over S2a, the TWAN shall overwrite the currently stored FQ CSID value with the received value.\nFor the removal of an existing PDN connection established over S2a, if the corresponding TWAN and PGW support the partial failure feature, a TWAN removes the corresponding PDN data as well as any relevant stored FQ-CSID value of the PGW FQ-CSID.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "17D\tRestoration of data in the BM-SC",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "17D.1\tRestart of the BM-SC",
                    "description": "",
                    "summary": "",
                    "text_content": "When a BM-SC fails, all its MBMS Bearer contexts affected by the failure become invalid and will be deleted.\nAfter a BM-SC restart, all the MBMS Bearer contexts stored in the BM-SC and affected by the restart become invalid and will be deleted. All the SGmb Diameter sessions affected by the restart are also lost in the BM-SC. If Group Communication Service (GCS) is supported, the BM-SC also loses the knowledge of the TMGIs it had allocated to the Group Communication Service Application Server(s) (GCS AS) before restarting.\nWhen the MBMS GW detects the restart of a BM-SC, it shall behave as described in clause 17A.2.3.\nWhen the GCS AS detects the restart of a BM-SC, it shall behave as described in clause 17E.1. The restoration of MBMS services by content providers other than GCS AS after a BM-SC failure or restart is out of scope of 3GPP.\nNOTE: The reference point from content providers other than GCS AS to the BM-SC is not standardised by 3GPP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "17D.2\tRestart of the GCS AS",
                    "description": "",
                    "summary": "",
                    "text_content": "In deployments without a Diameter Agent between the GCS AS and the BM-SC, the BM-SC shall detect a restart in the GCS AS using either:\n-\tthe Diameter Origin-State-Id AVP as specified in the Diameter Base Protocol. To enable fast detection of restart, the Diameter Origin-State-Id AVP shall be included (at least) in Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands; or\n-\tthe Diameter Restart-Counter AVP as specified in the MBMS Heartbeat procedure (see clause 29), if this procedure is supported.\nIn deployments with a Diameter Agent between the GCS AS and the BM-SC, the BM-SC shall detect a restart in the GCS AS using the Diameter Restart-Counter AVP as specified in the MBMS Heartbeat procedure (see clause 29).\nNOTE:\tThe intermediate Diameter Agent can remove or update the Diameter Origin-State-Id AVP, e.g. if it needs to modify the Origin-Host-ID. Thus the Diameter Origin-State-Id AVP, if received by the BM-SC or GCS AS, does not reflect the state of the remote MBMS peer but the state of the Diameter Agent.\nWhen the BM-SC detects a restart of the GCS AS, the BM-SC shall deallocate (locally) all the TMGIs that had been assigned to the restarted GCS AS and the BM-SC shall stop all the related MBMS bearers to free the corresponding resources in E-UTRAN.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "17E\tRestoration of data in the GCS AS",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "17E.1\tRestart of the GCS-AS",
                    "description": "",
                    "summary": "",
                    "text_content": "After a GCS AS restart, the GCS AS loses its MBMS bearer contexts and the knowledge of the TMGIs it had been allocated by the BM-SC(s) before restarting.\nWhen the BM-SC detects the restart of a GCS AS, it shall behave as described in clause 17D.2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "17E.2\tRestart of the BM-SC",
                    "description": "",
                    "summary": "",
                    "text_content": "In deployments without a Diameter Agent between the GCS AS and the BM-SC, the GCS AS shall detect a restart in the BM-SC using either:\n-\tthe Diameter Origin-State-Id AVP as specified in the Diameter Base Protocol. To enable fast detection of restart, the Diameter Origin-State-Id AVP shall be included (at least) in Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands; or\n-\tthe Diameter Restart-Counter AVP as specified in the MBMS Heartbeat procedure (see clause 29), if this procedure is supported.\nIn deployments with a Diameter Agent between the GCS AS and the BM-SC, the GCS AS shall detect a restart in the BM-SC using the Diameter Restart-Counter AVP as specified in the MBMS Heartbeat procedure (see clause 29).\nNOTE:\tThe intermediate Diameter Agent can remove or update the Diameter Origin-State-Id AVP, e.g. if it needs to modify the Origin-Host-ID. Thus the Diameter Origin-State-Id AVP, if received by the BM-SC or GCS AS, does not reflect the state of the remote MBMS peer but the state of the Diameter Agent.\nWhen the GCS AS detects a restart of the BM-SC, the GCS AS shall assume that all the TMGIs that had been assigned by the restarted BM-SC have been de-allocated and that all the related MBMS bearers have been deactivated.\nThe GCS AS may restore the MBMS delivery using the MB2-C procedures specified in 3GPP TS 29.468 [35].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "17F\tRestoration of data in the UCMF",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "17F.1\tRestart of the UCMF",
                    "description": "",
                    "summary": "",
                    "text_content": "The UCMF is assumed as a front-end application function with a persistent database connected. The UCMF may restart but all dictionary mapping information between UE Radio Capability and UE Radio Capability IDs can be retained, hence, in this case, a UCMF shall not update its Recovery Time Stamp if the UCMF has restarted.\nEditor' Note:\tThe handling of Version ID within PLMN assigned UE Radio Capability IDs at UCMF Restart is ffs.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "17F.2\tRestart of the MME",
                    "description": "",
                    "summary": "",
                    "text_content": "When a UCMF detects that a peer MME has failed with or without restart (relying on restart counter as specified in clause 19B \"URCMP based restart procedures\" or implementation e.g. a preconfigured path failure timer as specified in clause 20 \"Path management procedures\"), it shall delete the subscription created by the failed MME.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "18\tGTP-C based restart procedures",
            "description": "Across GTP-C based interfaces an SGSN, GGSN, MME, SGW, PGW, TWAN, ePDG and HRPD Access Node utilize either GTPv1-C or GTPv2-C Echo Request and Echo Response messages or GTP-C messages containing the Recovery Information Element to detect and handle a restart.\nA GTP-C entity shall maintain two Restart counters:\n-\tin volatile memory a remote Restart counter of a peer with which the entity is in contact;\n-\tin non-volatile memory own, or local Restart counter that was sent to a peer.\nAfter a GTP-C entity has restarted, it shall immediately increment all local Restart counters and shall clear all remote Restart counters.\nA GTP-C entity may have a common local Restart counter for all peers, or it may have a separate local Restart counter for each peer.\nA GTP-C entity may probe the liveliness of each peer with which it is in contact by sending an Echo Request message (see clause 20 \"Path management procedures\") . The presence of the Restart counter in Echo Request or in a GTP-C message depends on the GTP-C version and therefore is specified in 3GPP TS 29.060 [8] and 3GPP TS 29.274 [13], respectively. The restart counter signalled in the GTP-C message is associated with the GTP-C entity identified by the sender's F-TEID or SGSN/GGSN IP address for control plane if present in the message, otherwise (e.g. in echo request message) it is associated with the GTP-C entity identified by the source IP address of the message.\nThe GTP-C entity that receives a Recovery Information Element in an Echo Response or in another GTP-C message from a peer, shall compare the received remote Restart counter value with the previous Restart counter value stored for that peer entity.\n-\tIf no previous value was stored the Restart counter value received in the Echo Response or in the GTP-C message shall be stored for the peer.\n-\tIf the value of a Restart counter previously stored for a peer is smaller than the Restart counter value received in the Echo Response message or the GTP-C message, taking the integer roll-over into account, this indicates that the entity that sent the Echo Response or the GTP-C message has restarted. The received, new Restart counter value shall be stored by the receiving entity, replacing the value previously stored for the peer.\n-\tIf the value of a Restart counter previously stored for a peer is larger than the Restart counter value received in the Echo Response message or the GTP-C message, taking the integer roll-over into account, this indicates a possible race condition (newer message arriving before the older one). The received new Restart counter value shall be discarded and an error may be logged.\nBased on operator's policy, when a Recovery IE is received in an Echo Request or in any incoming GTP-C request message (which includes a Recovery IE) from a peer GTP-C entity, with a Restart counter value larger than the value of the Restart counter previously stored for the peer GTP-C entity, the GTP-C entity may verify whether the peer GTP-C entity has really restarted by:\n-\tsending one or more Echo Request message(s) towards the peer GTP-C entity, or by monitoring other GTP-C request messages it may have sent for any PDN connections (e.g. Update Bearer Request message) towards the peer GTP-C entity; and\n-\tdetermining that the peer GTP-C entity has restarted if the value of the restart counter received in the Recovery IE in the Echo Response message or in the corresponding GTP-C response messages (e.g. Update Bearer Response) is larger than the value of the Restart counter previously stored for the peer GTP-C entity.\nNOTE:\tThis can be used e.g. when two GTP-C entities are connected via a roaming interface and Network Domain Security (e.g. IPsec ESP) is not applied or may not provide sufficient protection of the GTP-C signalling, e.g. against IP address spoofing.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "18A\tGTP-U based restart procedure",
            "description": "The support of GTP-U based restart procedure is optional for a GTP-U entity.\nWhen the feature is supported, across GTP-U based interfaces, i.e. the S1-U, S11-U, S2a, S2b, X2, S4, S5, S8, S12, M1 and Sn interfaces of the Evolved Packet System in EPS, and the F1-U, Xn, N3, N9, N19, N3mb and N19mb interfaces of the 5G System in 5GS, a GTP-U entity shall utilize GTP-U Echo Request, Echo Response messages and GTP-U Error Indication message containing the Recovery Time Stamp Information Element to detect and handle a restart.\nA GTP-U entity shall be prepared to receive an Echo Request message at any time (even from unknown peers), and it shall reply with an Echo Response message.\nA GTP-U entity shall maintain two Recovery Time Stamps:\n-\tin volatile memory a remote Recovery Time Stamp of a peer GTP-U entity with which the entity is in contact;\n-\tin non-volatile memory own, or local Recovery Time Stamp that was sent to a peer GTP-U entity.\nAfter a GTP-U entity has (re)started and all its GTP-U contexts have been lost, and if the GTP-U entity knows these GTP-U contexts are not to be restored, e.g., by its Control Plane function, it shall immediately update all local Recovery Time Stamps and shall clear all remote Recovery Time Stamps. When peer GTP-U entities information is available, e.g. when the first GTP-U tunnel towards the peer GTP-U entity is established, the (re)started GTP-U entity may send its (updated) Recovery Time Stamps in an Echo Request message to the peer GTP-U entity before sending GTP-U packets.\nNOTE:\tThe GTP-U entity needs to be configured to know if the GTP-U contexts can be restored or not. It is implemention specific how to handle the scenario that the GTP-U entity interworks with some control plane nodes supporting restoration of GTP-U contexts while others not supporting, for example, it can use different IP addresses.\nA GTP-U entity may have a common local Recovery Time Stamp for all peer GTP-U entities, or it may have a separate local Recovery Time Stamp for each peer GTP-U entity.\nA GTP-U entity may probe the liveliness of each peer GTP-U entity with which it is in contact by sending an Echo Request message.\nThe Recovery Time Stamp signalled in the GTP-U Echo Request and Response messages is associated with the GTP-U entity identified by the source IP address of the message.\nThe Recovery Time Stamp signalled in the GTP-U Error Indication is associated with the source IP address of the GTP-U Error Indication or associated with a list of IP address(es) which are sharing the same Recovery Time Stamp if those IP address(es) are explicitly included in the GTP-U Error Indication message.\nThe GTP-U entity that receives a Recovery Time Stamp Information Element from a peer GTP-U entity shall compare the received remote Recovery Time Stamp value with the previous Recovery Time Stamp value stored for that peer GTP-U entity.\n-\tIf no previous value was stored, the Recovery Time Stamp value received in the Echo Request or Response messages or the GTP Error Indication message shall be stored for the peer GTP-U entity.\n-\tIf the value of a Recovery Time Stamp previously stored for a peer GTP-U entity is smaller than the Recovery Time Stamp received in the Echo Request or Response messages or the GTP-U Error Indication messages, this indicates that the entity that sent the Echo Request or Response messages or the GTP-U Error Indication messages has restarted. The received, new Recovery Time Stamp value shall be stored by the receiving entity, replacing the value previously stored for the peer GTP-U entity.\n-\tIf the value of a Recovery Time Stamp previously stored for a peer GTP-U entity is larger than the Recovery Time Stamp value received in the Echo Request or Response messages or the GTP-U Error Indication messages, this indicates a possible race condition (newer message arriving before the older one). The received new Recovery Time Stamp value shall be discarded and an error may be logged.\nBased on operator's policy, when a Recovery Time Stamp IE is received in an Echo Request from a peer GTP-U entity, with a Recovery Time Stamp larger than the value of the Recovery Time Stamp previously stored for the peer GTP-U entity, the GTP-U entity may verify whether the peer GTP-U entity has really restarted by:\n-\tsending one or more Echo Request message(s) towards the peer GTP-U entity; and\n-\tdetermining that the peer GTP-U entity has restarted if the Recovery Time Stamp in the Echo Response message is larger than the value of the Recovery Time Stamp previously stored for the peer GTP-U entity.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "19\tPMIPv6 based restart procedures",
            "description": "Across PMIPv6 based interfaces, SGW, PGW, TWAN and ePDG utilize PMIPv6 Heartbeat mechanism for node restart detection as specified in 3GPP TS 29.275 [16].\nA PMIPv6 entity shall maintain two restart counters:\n-\tin volatile memory a remote restart counter of a peer with which the entity is in contact;\n-\tin non-volatile memory an own, or local restart counter that was sent to a peer.\nAfter a PMIPv6 entity has restarted, it shall immediately increment all local restart counters and shall clear all remote restart counters.\nA PMIPv6 entity may have a common local restart counter for all peers, or it may have a separate local restart counter for each peer.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "19A\tPFCP based restart procedures",
            "description": "Across PFCP based interfaces, an SGW-C, SGW-U, PGW-C and PGW-U Node shall utilize PFCP Heartbeat Request and Heartbeat Response messages to detect and handle a peer PFCP entity failure or restart. A PFCP entity shall be prepared to receive a Heartbeat Request message at any time (even from unknown peers), and it shall reply with a Heartbeat Response message.\nA PFCP entity shall maintain two Recovery Time Stamps:\n-\tin volatile memory a remote Recovery Time Stamp of a peer PFCP entity with which the entity is in contact;\n-\tin non-volatile memory own, or local Recovery Time Stamp that was sent to a peer PFCP entity.\nAfter a PFCP entity has restarted, it shall immediately update all local Recovery Time Stamps and shall clear all remote Recovery Time Stamps. When peer PFCP entities information is available, i.e. when the PFCP Association is still alive, the restarted PFCP entity shall send its updated Recovery Time Stamps in a Heartbeat Request message to the peer PFCP entities before initiating any PFCP session signalling.\nA PFCP entity may have a common local Recovery Time Stamp for all peer PFCP entities, or it may have a separate local Recovery Time Stamp for each peer PFCP entity.\nA PFCP entity may probe the liveliness of each peer PFCP entity with which it is in contact by sending a Heartbeat Request message (see clause 20 \"Path management procedures\").\nThe Recovery Time Stamp signalled in the PFCP Heartbeat Request and Response messages is associated with the PFCP entity identified by the source IP address of the message.\nThe Recovery Time Stamp signalled in the PFCP Session Establishment Request messages is associated with the IP address in the CP F-SEID IE.\nThe PFCP entity that receives a Recovery Time Stamp Information Element from a peer PFCP entity shall compare the received remote Recovery Time Stamp value with the previous Recovery Time Stamp value stored for that peer PFCP entity.\n-\tIf no previous value was stored, the Recovery Time Stamp value received in the Heartbeat Request or Response messages or the PFCP Session Establishment Request messages shall be stored for the peer PFCP entity.\n-\tIf the value of a Recovery Time Stamp previously stored for a peer PFCP entity is smaller than the Recovery Time Stamp value received in the Heartbeat Request or Response messages or the PFCP Session Establishment Request messages, this indicates that the entity that sent the Heartbeat Request or Response messages has restarted. The received, new Recovery Time Stamp value shall be stored by the receiving entity, replacing the value previously stored for the peer PFCP entity.\n-\tIf the value of a Recovery Time Stamp previously stored for a peer PFCP entity is larger than the Recovery Time Stamp value received in the Heartbeat Request or Response message or the PFCP Session Establishment Request messages, this indicates a possible race condition (newer message arriving before the older one). The received Sx node related message and the received new Recovery Time Stamp value shall be discarded and an error may be logged.\nA PFCP function shall ignore the Recovery Timestamp received in PFCP Association Setup Request and PFCP Association Setup Response messages (see clause 6.2.6 of 3GPP TS 29.244 [43]).\nWhen a NAT device is deployed between PFCP entities, e.g. between the CP function and UP function, the following requirements shall apply in addition to the above requirements:\n-\tthe Heartbeat Request message may include a Source IP Address IE;\n-\twhen the Source IP Address IE is present, the Recovery Time Stamp signalled in the Heartbeat Request message shall be associated with the Source IP Address IE, instead of the source IP address of the message.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "19B\tURCMP based restart procedures",
            "description": "Across URCMP based interfaces, an MME and UCMF Node shall utilize URCMP Heartbeat Request and Heartbeat Response messages to detect and handle a peer URCMP entity failure or restart. A URCMP entity shall be prepared to receive a Heartbeat Request message at any time (even from unknown peers), and it shall reply with a Heartbeat Response message.\nA URCMP entity shall maintain two Recovery Time Stamps:\n-\tin volatile memory a remote Recovery Time Stamp of a peer URCMP entity with which the entity is in contact;\n-\tin non-volatile memory own, or local Recovery Time Stamp that was sent to a peer URCMP entity.\nAfter a URCMP entity has restarted and if it loses all dictionary mapping information between UE Radio Capability Information and UE Radio Capability IDs, it shall immediately update all local Recovery Time Stamps and shall clear all remote Recovery Time Stamps.\nA URCMP entity may have a common local Recovery Time Stamp for all peer URCMP entities, or it may have a separate local Recovery Time Stamp for each peer URCMP entity.\nA URCMP entity may probe the liveliness of each peer URCMP entity with which it is in contact by sending a Heartbeat Request message (see clause 20 \"Path management procedures\").\nThe Recovery Time Stamp signalled in the URCMP Heartbeat Request and Response messages is associated with the URCMP entity identified by the source IP address of the message.\nThe URCMP entity that receives a Recovery Time Stamp Information Element from a peer URCMP entity shall compare the received remote Recovery Time Stamp value with the previous Recovery Time Stamp value stored for that peer URCMP entity.\n-\tIf no previous value was stored, the Recovery Time Stamp value received in the Heartbeat Request or Response messages shall be stored for the peer URCMP entity.\n-\tIf the value of a Recovery Time Stamp previously stored for a peer URCMP entity is smaller than the Recovery Time Stamp value received in the Heartbeat Request or Response messages, this indicates that the entity that sent the Heartbeat Request or Response messages has restarted. The received, new Recovery Time Stamp value shall be stored by the receiving entity, replacing the value previously stored for the peer URCMP entity.\n-\tIf the value of a Recovery Time Stamp previously stored for a peer URCMP entity is larger than the Recovery Time Stamp value received in the Heartbeat Request or Response message, this indicates a possible race condition (newer message arriving before the older one). The received Sx node related message and the received new Recovery Time Stamp value shall be discarded and an error may be logged.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "20\tPath management procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "20.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause specifies path management procedures for GTP-C based, PMIP and PFCP based interfaces.\nFor GTP based interfaces, Echo Request / Response procedure is used. The usage depends on the GTP-C version in the following way:\n-\tGTPv1-C entity may periodically send an Echo Request message as specified in 3GPP TS 29.060 [8].\n-\tGTPv2 entity shall probe the liveliness of each peer with which it is in contact by sending an Echo Request messages (see TS 29.274 [13]). When and how often a GTPv2 Echo Request message may be sent is implementation specific but an Echo Request shall not be sent more often than every 60 s on each path. This does not prevent resending an Echo Request with the same sequence number according to the T3-RESPONSE timer.\nIt is recommended that GTPv2 Echo Request should be sent only when a GTP-C entity has not received any GTP response message for a previously sent request message on the GTP-C path for, an implementation dependent period of time.\nA GTP-C entity (both GTPv1-C and GTPv2) shall be prepared to receive an Echo Request message at any time and it shall reply with an Echo Response message.\nFor the PMIP based S5/S8 interface, the SGW and PGW shall detect respectively a peer PGW and SGW as currently unavailable by sending a series of PMIPv6 Heartbeat Request messages, and not receiving within a period of time respectively a PMIPv6 Heartbeat Response message (see 3GPP TS 29.275 [16]).\nFor PFCP based Sxa/Sxb/Sxc interfaces, the CP function shall detect a peer UP function (or vice versa) as currently unavailable by sending a series of PFCP heartbeat Request messages, and not receiving within a period of time respectively a PFCP Heartbeat Response message (see 3GPP TS 29.244 [43]).\nFor URCMP based S17 interface, the URCMP entity shall detect a peer URCMP entity as currently unavailable by sending a series of URCMP heartbeat Request messages, and not receiving within a period of time respectively a URCMP Heartbeat Response message (see 3GPP TS 29.674 [44]).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "20.2\tSignalling path failure detection and handling",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "20.2.1\tGeneral",
                            "text_content": "GTP-C entities shall support detection of path failure by using Echo Request / Echo Response messages in the following way. A peer's IP address specific counter shall be reset each time an Echo Response message is received from that peer's IP address and incremented when the T3-RESPONSE timer expires for an Echo Request message sent to that peer's IP address. The path shall be considered to be down if the counter exceeds N3-REQUESTS.\nPMIP entities shall support detection of path failure as specified for Failure Detection in IETF RFC 5847 [22].\nUpon detecting a path failure, the network node should notify the failure via the Operation and Maintenance system and may either:\n-\tdelete the PDN connections (EPS bearer contexts) or PDP contexts associated with this peer's IP address; or\n-\tmaintain the PDN connections (EPS bearer contexts) or PDP contexts associated with the peer's IP address during an operator configurable maximum path failure duration. The network node shall delete the maintained resources if the path is still down when this duration expires. The network node may delete the maintained resources if control/user plane signalling is received across other interface(s) during the path failure and before the maximum path failure duration timer expires.\nNOTE 1:\tDuring transient path failures (e.g. path failures not exceeding few minutes at most), maintaining the EPS bearer contexts or PDP contexts associated with the peer's IP address enables the delivery of end user services (when the path is reestablished again) and also avoids unnecessary signalling in the network for restoring those connections.\nNOTE 2:\tIt is not intended to maintain PDN connections during long path failures (e.g. exceeding few minutes at most) as this would imply undesirable effects like undue charging.\nThe following clauses specify further specific network element requirements.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.2.2\tSGW functionality",
                            "text_content": "It is optional for the SGW to maintain the S5/S8 bearer contexts when the SGW detects a path failure to the MME/S4-SGSN (see clause 20.2.1). However upon detecting a path failure to the MME/S4-SGSN, an SGW that supports the network triggered service restoration procedure (see clause 25) should maintain the S5/S8 bearer contexts eligible for network initiated service restoration and proceed with the network triggered service restoration procedure with the following modification:\n-\tif the path to the MME/S4-SGSN is down for a duration exceeding the maximum path failure duration and if there is no alternative reachable path, e.g. another MME/S4-SGSN in the same pool or another control plane IP address belonging to the same MME/S4-SGSN, the SGW should locally delete the maintained PDN connections associated with the failed path.\nIn addition, for UEs in connected state associated with the failed path, the SGW should continue sending downlink packets to the eNodeB/RNC as long as the impacted PDN connections are maintained, regardless of whether the SGW supports the network triggered service restoration procedure or not.\nThe SGW may support the PGW triggered SGW restoration for an S5 path failure. If so, then the SGW should support the PGW Restart Notification procedure. After detecting a path failure to the PGW, the SGW may delete all the PDN connections affected by the path failure and should also send a PGW Restart Notification message to the MME or S4-SGSN if the the PGW Restart Notification procedure is supported by the SGW and MME/S4-SGSN (see clause 16.1A.2).\nNOTE:\tThe PGW Restart Notification procedure can help the MME to restore the PDN connections earlier since the SGW will detect the S5 path failure and send PGW Restart Notification triggering a PDN connection restoration at the MME, before the PGW sends the PGW Downlink Triggering Notification.\nThe SGW should proceed with the PGW triggered SGW restoration procedure (see clause 27.2.3.3) with the following modification:\n-\tThe SGW shall include the PGW F-TEID or PGW IP address and GRE key for control plane in the PGW Downlink Triggering Notification message that it sends to the MME/S4-SGSN, if this information is present in the PGW Downlink Triggering Notification/PMIP Update Notification message received from the PGW.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.2.3\tMBMS GW functionality",
                            "text_content": "The MBMS GW may be provisioned with the list (or a sublist) of the MMEs pertaining to the MME pool.\nNOTE 1:\tThe MBMS GW expects only one MME of the MME pool in BM-SC requests received across the SGmb interface.\nUpon detecting an Sm path failure, the MBMS GW should maintain the MBMS bearer contexts associated with the peer's MME IP address.\nDuring a transient Sm path failure (e.g. before the maximum path failure duration timer expires), the MBMS GW may process MBMS requests from the BM-SC and intended for the MME for which the Sm path has failed as follows:\n-\tfor new MBMS Session Start Request, the MBMS GW may select an alternative MME in the same MME pool and send the MBMS Session Start Request to this alternative MME;\n-\tfor MBMS Session Update Request or MBMS Session Stop Request, the MBMS GW may select an alternative MME in the same MME pool, send a MBMS Session Start Request message to this alternative MME and, if successful, send subsequently the MBMS Session Update Request or MBMS Session Stop Request to this alternative MME.\nAfter having selected an alternative MME, the MBMS GW shall consider the MME answering to the MBMS Start Request as the controlling MME for the MBMS session and send any subsequent MBMS Session Update or MBMS Session Stop for this MBMS Session to this MME.\nNOTE 2:\tEach MME of the MME pool provisioned in the MBMS GW supports an M3 interface with the MCE(s).\nWhen detecting a non-transient Sm path failure at the MBMS GW (e.g. the maximum path failure duration timer of the MBMS GW expires), the MBMS GW may move the control of all the affected active MBMS sessions to another MME in the same MME pool (if any other MME is reachable by the MBMS GW) by initiating new MBMS Session Start Request(s) to alternative MME(s).\nNOTE 3:\tThis allows to re-establish the MBMS sessions when a MME fails without restart.\nThe maximum path failure duration timer of the MBMS GW should be configured with a shorter value than the maximum path failure duration timer of the MME to avoid interrupting active MBMS sessions upon a non-transient Sm path failure. The MBMS GW timer should be shorter than the MME timer by at least the period between two Echo Request messages sent by the MME, to avoid that the MME timer expires before the MBMS GW timer if the MME starts its timer before the MBMS GW.\nNOTE 4:\tThis enables the MCE to receive a MBMS Session Start request from the new MME controlling the MBMS session before the MCE receives a request to stop the MBMS service from the previous controlling MME.\nWhen sending an MBMS Session Start Request sent to an alternative MME, the MBMS GW shall encode the contents of the request with the same contents as in the original MBMS Session Start Request (or per the last MBMS Session Update Request sent by the MBMS GW if the original parameters were updated) with the following exceptions:\n-\tthe MBMS GW shall set the \"MBMS session re-establishment indication\" flag to signal that this message is used to re-establish an MBMS session;\n-\tif no absolute start time (\"MBMS data transfer start\" parameter) has been received, the MBMS GW may change the relative start time (\"time to MBMS data transfer\" parameter) to fasten the restoration of the MBMS service in E-UTRAN;\n-\tthe MBMS GW should set the estimated session duration to a value corresponding to the remaining duration of the session.\nNOTE 5:\tPer the requirements above, if the MBMS GW had started an MBMS session within an MME with the MBMS Service Area (1, 2, 3) and receives during an Sm path failure (towards this MME) an MBMS Session Update from the BM-SC modifying the MBMS Service Area to (3, 4, 5), the MBMS GW will encode the original MBMS Service Area (1, 2, 3) in the MBMS Session Start Request sent to the alternative MME and subsequently send an MBMS Session Update Request with the MBMS Service Area (3,4,5) to the new MME controlling the MBMS session.\nNOTE 6:\tIf the previous MME received an MBMS Session Update Request from the MBMS GW but could not propagate it to the MCE due to a M3AP path failure, the contents of the MBMS Session Start Request sent to the MCE via the new MME can also differ from the parameters sent to the MCE via the previous MME for the parameters that can be modified by the MBMS session update procedure (i.e. MBMS Session Area, MBMS Time to Data Transfer, MBMS Data Transfer Start).\nAfter detecting an Sm path failure, the MBMS GW shall determine whether the failure is transient or non transient from the perpective of the MME (e.g. the MBMS GW is provisioned with the maximum path failure timer of the MME). The MBMS GW shall assume that the failure is non transient from the perspective of the MME if the Sm path recovers after a period longer than the maximum path failure timer of the MME plus the period between two Echo Request messages sent by the MME, to ensure that the MME also determines this is a non transient path failure if the MBMS GW starts its timer before the MME. The MBMS GW shall consider that the MBMS session has been released by the MME if the Sm path failure is non transient for the MME. If the Sm path failure remains transient for the MME, the MBMS GW shall behave as follows upon detecting the Sm path recovery:\n-\tif the MBMS GW has already moved the control of the MBMS session to an alternative MME(s), the MBMS GW shall send an MBMS Session Stop Request message to the MME previously controlling the MBMS session with a \"Local MBMS bearer context release\" indication to instruct that MME to release its MBMS bearer context locally, without sending any message to the MCE(s).\n-\tif the MBMS GW has not yet moved the control of the MBMS session to an alternative MME (e.g. if the MBMS restoration procedures are not supported in the network),\n-\tif the Sm path failure is transient from the perspective of the MBMS GW, the MBMS GW shall consider that MBMS session is still controlled by the related MME and proceed as if there had been no Sm path failure;\n-\tif the Sm path failure is non transient from the perspective of the MBMS GW, the MBMS GW shall send an MBMS Session Start Request to the MME for the session and encode it as specified above (for a message sent to an alternative MME).\nNOTE 7:\tThe MBMS GW cannot know whether the MME will see the Sm path failure as transient or non transient if the Sm path recovers in the period between the maximum path failure timer of the MME plus and minus the period between two Echo Request messages sent by the MME. This can possibly lead the MBMS GW to send an MBMS Session Stop request to the MME for a session that has already been terminated by the MME (if the MME determined the failure is non transient) or to send an MBMS Session Start request (with the \"MBMS session re-establishment indication\" flag) to the MME for a session that is still alive at the MME (if the MME determined the failure is transient).\nThe MBMS GW may be provisioned with the list (or a sub list) of the SGSNs belonging to the SGSN pool.\nNOTE:\tThe MBMS GW expects only one SGSN of the SGSN pool in BM-SC requests received across the SGmb interface.\nAn MBMS GW and SGSN shall handle Sn path failure similar to the Sm path failure as described in clause 20.2.3.1 For IP Unicast over Sn/Iu when the SGSN changes the MBMS GW has to move the user plane which is affected by the Sn-path failure additionally.\nIn deployments without a Diameter Agent between the BM-SC and the MBMS GW, the MBMS GW shall detect an SGmb path failure using either:\n-\tmechanisms as specified in the Diameter Base Protocol (e.g. transport connection failure, BM-SC peer not responding, Diameter Device-Watchdog-Request and Device-Watchdog-Answer messages during periods when there is no need for other MBMS signalling); or\n-\tthe MBMS Heartbeat procedure (see clause 29), if this procedure is supported.\nIn deployments with a Diameter Agent between the BM-SC and the MBMS GW, the MBMS GW shall detect an SGmb path failure using the MBMS Heartbeat procedure (see clause 29).\nNOTE 1:\tA transport connection failure does not allow to identify a failure of the remote MBMS peer. Likewise, it is not possible to rely on Diameter Device-Watchdog-Request / Answer messages to test the responsiveness of the remote MBMS node during periods when there is no need for other MBMS signalling as these messages are only exchanged between Diameter peers with a direct transport connection.\nUpon detecting an SGmb path failure, the MBMS GW should maintain the MBMS bearer contexts associated with the peer's BM-SC during an operator configurable maximum path failure duration.\nIf the SGmb path to the BM-SC is down for a duration exceeding the maximum path failure duration, the MBMS GW should deactivate all the related MBMS Bearer contexts locally and send MBMS Session Stop Requests towards all MME/SGSNs in which the MBMS bearer services are active.\nNOTE 2:\tThis enables to free corresponding radio resources in E-UTRAN/UTRAN for MBMS services if the BM-SC has failed without restart.\nThe MBMS GW shall pass on the \"MBMS session re-establishment indication\" flag in the MBMS Session Start Request it sends to MME/SGSNs if received from the BM-SC.\nThe MBMS GW shall pass on the \"Local MBMS bearer context release\" indication in the MBMS Session Stop Request it sends to MME/SGSNs if received from the BM-SC.\nThe MBMS GW shall accept an MBMS Session Start Request received for an on-going MBMS bearer service (i.e. with the same TMGI and, if provided, MBMS Flow Identifier) from the same BM-SC that currently controls the MBMS session if the message includes the \"MBMS session re-establishment indication\" flag. The MBMS GW shall replace the SGmb related resources for this MBMS service by those received in the MBMS Session Start Request (if different). The MBMS GW should not send MBMS Session Start Request message(s) towards the involved MME/SGSN(s) if no parameters other than the estimated duration and relative start time have changed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.2.4\tMME functionality",
                            "text_content": "Upon detecting an Sm path failure, the MME should maintain the MBMS bearer contexts associated with the peer's MBMS GW IP address during an operator configurable maximum path failure duration.\nThe MME should behave as specified for the case of an MBMS GW restart (see clause 17A.1) if the Sm path to the MBMS GW is down for a duration exceeding the maximum path failure.\nNOTE 1:\tThis enables to free corresponding radio resources in E-UTRAN for MBMS services if the MBMS GW has failed without restart.\nThe MME shall pass on the \"MBMS session re-establishment indication\" flag in the MBMS Session Start Request it sends to MCEs if received from the MBMS GW.\nThe MME should accept an MBMS Session Start Request received for an on-going MBMS bearer service (i.e. with the same TMGI and, if provided, MBMS Flow Identifier) from a different MBMS GW than the MBMS GW that currently controls the MBMS session if the message includes the \"MBMS session re-establishment indication\" flag. If it accepts the request from the new MBMS GW, the MME shall replace the Sm related resources (i.e. TEID-C) for this MBMS service associated to the previous MBMS GW by those associated to the new MBMS GW and consider that the MBMS session is now being controlled by the new MBMS GW. The MME shall then send an MBMS Session Start Request message including the \"MBMS session re-establishment\" flag (and the new M1 transport parameters) towards all involved MCE(s).\nThe MME may accept an MBMS Session Start Request received for an on-going MBMS bearer service (i.e. with the same TMGI and, if provided, MBMS Flow Identifier) from a different MBMS GW than the MBMS GW that currently controls the MBMS session even if the message does not include the \"MBMS session re-establishment indication\" flag. If it accepts the request from the new MBMS GW, the MME shall replace the Sm related resources (i.e. TEID-C) for this MBMS service associated to the previous MBMS GW by those associated to the new MBMS GW and consider that the MBMS session is now being controlled by the new MBMS GW; the MME shall then either:\n-\tstop the on-going MBMS bearer service and then start the new MBMS bearer service (without including the \"MBMS session re-establishment indication\" flag in the MBMS Session Start Request sent to the MCE(s)); or\n-\tbehave as if it had received an MBMS Session Start Request including the \"MBMS session re-establishment indication\" flag (i.e. include the \"MBMS session re-establishment indication\" flag in the MBMS Session Start Request sent to the MCE(s)).\nThe MME shall accept an MBMS Session Start Request received for an on-going MBMS bearer service (i.e. with the same TMGI and, if provided, MBMS Flow Identifier) from the same MBMS GW that currently controls the MBMS session if the message includes the \"MBMS session re-establishment indication\" flag. The MME shall replace the Sm related resources (i.e. TEID-C) for this MBMS service by those received in the MBMS Session Start Request (if different). The MME should not send MBMS Session Start Request message(s) towards the involved MCE(s) if no parameters other than the estimated duration and relative start time have changed.\nThe MME shall reject an MBMS Session Stop Request received for an on-going MBMS bearer service from a different MBMS GW than the MBMS GW that currently controls the MBMS session.\nNOTE 2:\tUpon a non-transient SGmb path failure, if the BM-SC moves the control of an MBMS session to an alternative MBMS GW, the same MME can receive an MBMS Session Stop Request from the old MBMS GW after an MBMS Session Start Request from the new MBMS GW.\nThe MME shall release the MBMS bearer context resources locally without sending any message to the MCE(s) if it receives a MBMS Session Stop Request with a \"Local MBMS bearer context release\" indication for an on-going MBMS bearer service from the MBMS GW currently controlling the MBMS session.\nThe MME may support invoking the PGW triggered SGW restoration (see clause 27.2.3) upon receiving a PGW Downlink Triggering Notification message when the S11 path for the related UE is still available (see clause 20.2.1). If so, upon receiving a PGW Downlink Triggering Notification while the S11 path for the related UE is still available, the MME should proceed with the PGW triggered SGW restoration procedure (see clauses 27.2.3.2 and 27.3.2.2) with the following modifications:\n-\tif the PGW F-TEID or PGW IP address and GRE key for control plane received in the PGW Downlink Triggering Notification message does not match the stored PGW F-TEID or PGW IP address and GRE key for control plane of any PDN connection(s) for that UE, the MME shall not proceed with the PGW triggered SGW restoration procedure but just respond to the SGW with a PGW Downlink Triggering Acknowledge message with an acceptance cause code;\nNOTE 1:\tThis can happen e.g. if the PDN connection has already been restored by the MME upon receipt of a preceding PGW Restart Notification message. In this case, the PDN connection remains hanging in the PGW until the timer monitoring the maximum duration to restore the PDN connection expires in the PGW.\n-\tif the PGW F-TEID or PGW IP address and GRE key for control plane received in the PGW Downlink Triggering Notification message matches the stored PGW F-TEID or PGW IP address and GRE key for control plane of any PDN connection(s) for that UE, the MME shall proceed with the PGW triggered SGW restoration procedure.\n-\tif the related UE is in connected mode, the MME may restore the PDN connection(s) of that UE by performing the MME triggered Serving GW relocation procedure as defined in clause 5.10.4 of 3GPP TS 23.401 [15].\nNOTE 2:\tThis avoids to tear down the S1 connection of the UE and thus to negatively affect other PDN connections of that UE that would not be impacted by the S5 path failure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.2.5\tSGSN functionality",
                            "text_content": "Upon detecting an Sn path failure, the S4-SGSN should maintain the MBMS bearer contexts associated with the peer's MBMS GW IP address during an operator configurable maximum path failure duration.\nThe S4-SGSN should behave as specified for the case of an MBMS GW restart (see clause 17A.1) if the Sn path to the MBMS GW is down for a duration exceeding the maximum path failure.\nNOTE 1:\tThis enables to free corresponding radio resources in UTRAN for MBMS services if the MBMS GW has failed without restart.\nThe S4-SGSN shall pass on the \"MBMS session re-establishment indication\" flag in the MBMS Session Start Request it sends to RNCs if received from the MBMS GW.\nThe S4-SGSN should accept an MBMS Session Start Request received for an on-going MBMS bearer service (i.e. with the same TMGI and, if provided, MBMS Flow Identifier) from a different MBMS GW than the MBMS GW that currently controls the MBMS session if the message includes the \"MBMS session re-establishment indication\" flag. If it accepts the request from the new MBMS GW, the S4-SGSN shall replace the Sn related resources (i.e. TEID-C) for this MBMS service associated to the previous MBMS GW by those associated to the new MBMS GW and consider that the MBMS session is now being controlled by the new MBMS GW. The S4-SGSN shall then send an MBMS Session Start Request message including the \"MBMS session re-establishment\" flag (and the new M1 transport parameters) towards all involved RNC(s).\nThe S4-SGSN may accept an MBMS Session Start Request received for an on-going MBMS bearer service (i.e. with the same TMGI and, if provided, MBMS Flow Identifier) from a different MBMS GW than the MBMS GW that currently controls the MBMS session even if the message does not include the \"MBMS session re-establishment indication\" flag. If it accepts the request from the new MBMS GW, the S4-SGSN shall replace the Sn related resources (i.e. TEID-C) for this MBMS service associated to the previous MBMS GW by those associated to the new MBMS GW and consider that the MBMS session is now being controlled by the new MBMS GW; the S4-SGSN shall then either:\n-\tstop the on-going MBMS bearer service and then start the new MBMS bearer service (without including the \"MBMS session re-establishment indication\" flag in the MBMS Session Start Request sent to the RNC(s)); or\n-\tbehave as if it had received an MBMS Session Start Request including the \"MBMS session re-establishment indication\" flag (i.e. include the \"MBMS session re-establishment indication\" flag in the MBMS Session Start Request sent to the RNC(s)).\nThe S4-SGSN shall accept an MBMS Session Start Request received for an on-going MBMS bearer service (i.e. with the same TMGI and, if provided, MBMS Flow Identifier) from the same MBMS GW that currently controls the MBMS session if the message includes the \"MBMS session re-establishment indication\" flag. The S4-SGSN shall replace the Sn related resources (i.e. TEID-C) for this MBMS service by those received in the MBMS Session Start Request (if different). The S4-SGSN should not send MBMS Session Start Request message(s) towards the involved RNC(s) if no parameters other than the estimated duration and relative start time have changed.\nThe S4-SGSN shall reject an MBMS Session Stop Request received for an on-going MBMS bearer service from a different MBMS GW than the MBMS GW that currently controls the MBMS session.\nNOTE 2:\tUpon a non-transient SGmb path failure, if the BM-SC moves the control of an MBMS session to an alternative MBMS GW, the same S4-SGSN can receive an MBMS Session Stop Request from the old MBMS GW after an MBMS Session Start Request from the new MBMS GW.\nThe S4-SGSN shall release the MBMS bearer context resources locally without sending any message to the RNC(s) if it receives a MBMS Session Stop Request with a \"Local MBMS bearer context release\" indication for an on-going MBMS bearer service from the MBMS GW currently controlling the MBMS session.\nThe S4-SGSN may support invoking the PGW triggered SGW restoration (see clause 27.2.3) upon receiving a PGW Downlink Triggering Notification and the S4 path of the related UE is still available (see clause 20.2.1). If so, S4-SGSN shall proceed as defined for the MME in clause 20.2.4.2, with the following modification:\n-\tif the related UE is in connected mode, the S4-SGSN may restore the PDN connection(s) of that UE by performing the S4-SGSN triggered Serving GW relocation procedure as defined in clause 9.2.2.4 of 3GPP TS 23.060 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.2.6\tBM-SC functionality",
                            "text_content": "In deployments without a Diameter Agent between the BM-SC and the MBMS GW, the BM-SC shall detect an SGmb path failure using either:\n-\tmechanisms as specified in the Diameter Base Protocol (e.g. transport connection failure, MBMS GW peer not responding, Diameter Device-Watchdog-Request and Device-Watchdog-Answer messages during periods when there is no need for other MBMS signalling); or\n-\tthe MBMS Heartbeat procedure (see clause 29), if this procedure is supported.\nIn deployments with a Diameter Agent between the BM-SC and the MBMS GW, the BM-SC shall detect an SGmb path failure using the MBMS Heartbeat procedure (see clause 29).\nNOTE 1:\tA transport connection failure does not allow to identify a failure of the remote MBMS peer. Likewise, it is not possible to rely on Diameter Device-Watchdog-Request / Answer messages to test the responsiveness of the remote MBMS node during periods when there is no need for other MBMS signalling as these messages are only exchanged between Diameter peers with a direct transport connection.\nUpon detecting an SGmb path failure, the BM-SC should maintain the related MBMS bearer contexts.\nDuring a transient SGmb path failure (e.g. before the maximum path failure duration timer expires), the BM-SC should consider all related MBMS bearer contexts as active in the MBMS GW. The BM-SC may initiate new MBMS sessions via an alternative MBMS GW (if available). The BM-SC should defer any MBMS session update or stop procedure for on-going MBMS sessions in the MBMS GW affected by the SGmb path failure until the transient path failure ends.\nNOTE 2: Re-establishing an MBMS session via an alternative MBMS GW can generate network signalling over many interfaces and interrupt transiently the delivery of the MBMS data stream due to the need for related eNB/RNCs to switch to the new IP multicast group over M1. Thus during a transient SGmb path failure it is recommended to defer any MBMS session update or stop procedure for on-going MBMS sessions in the MBMS GW affected by the SGmb path failure. However if the MBMS session update or stop procedure is for time critical services, the BM-SC can immediately re-establish the active MBMS bearer services affected by the SGmb path failure by initiating MBMS Session Start procedure(s) towards an alternative MBMS GW (if available) as specified below, and subsequently send the MBMS Session Update or Stop message.\nWhen detecting a non-transient SGmb path failure (e.g. the maximum path failure duration timer of the BM-SC expires), the BM-SC should re-establish the active MBMS bearer services affected by the SGmb path failure by initiating MBMS Session Start procedure(s) towards an alternative MBMS GW (if available) or towards the same MBMS GW (once the SGmb path is recovered). If the MBMS session is not re-established and if it was activated by a Group Communication Service Application Server(s) (GCS AS), the BM-SC shall notify the GCS AS that the MBMS session has been deactivated.\nNOTE 3:\tThis enables to re-establish the MBMS sessions when a MBMS GW fails without restart.\nThe maximum path failure duration of the BM-SC should be configured with a shorter value than the maximum path failure duration timer of the MBMS GW to minimize the interruption of the active MBMS sessions upon a non-transient SGmb path failure. The BM-SC timer should be shorter than the MBMS GW timer by at least the period between two Diameter Device-Watchdog-Request messages or MBMS Heartbeat Request messages sent by the MBMS GW, to avoid that the MBMS GW timer expires before the BM-SC timer if the MBMS GW starts its timer before the BM-SC.\nNOTE 4:\tThis enables the MCE/RNC to receive a MBMS Session Start request from the new MME/SGSN (and MBMS GW) controlling the MBMS session before the MCE/RNC receives a request to stop the MBMS service from the previous controlling MME/SGSN (and MBMS GW).\nWhen re-establishing the active MBMS bearer services affected by the SGmb path failure, the BM-SC shall encode the MBMS Session Start Request with the same contents as in the original MBMS Session Start Request (or per the last MBMS Session Update Request sent by the BM-SC if the original parameters were updated) with the following exceptions:\n-\tthe BM-SC shall set the \"MBMS session re-establishment indication\" flag to signal that this message is used to re-establish an MBMS session;\n-\tif no absolute start time (\"MBMS data transfer start\" parameter) has been sent, the BM-SC may change the relative start time (\"time to MBMS data transfer\" parameter) to fasten the restoration of the MBMS service in E-UTRAN;\n-\tthe BM-SC should set the estimated session duration to a value corresponding to the remaining duration of the session.\nNOTE 5:\tIf the BM-SC is instructed to modify an MBMS Session during the SGmb path failure, the contents of the MBMS Session Start Request sent to the MBMS GW after the SGmb path failure can also differ from the parameters sent to the MBMS GW before the SGmb path failure for the parameters that can be modified by the MBMS session update procedure (i.e. MBMS Session Area, MBMS Time to Data Transfer, MBMS Data Transfer Start).\nAfter detecting an SGmb path failure, the BM-SC shall determine whether the failure is transient or non transient from the perpective of the MBMS GW (e.g. the BM-SC is provisioned with the maximum path failure timer of the MBMS GW). The BM-SC shall assume that the failure is non transient from the perspective of the MBMS GW if the SGmb path recovers after a period longer than the maximum path failure timer of the MBMS GW plus the period between two Diameter Device-Watchdog-Request messages or MBMS Heartbeat Request messages sent by the MBMS GW, to ensure that the MBMS GW also determines this is a non transient path failure if the BM-SC starts its timer before the MBMS GW. The BM-SC shall consider that the MBMS session has been released by the MBMS GW if the SGmb path failure is non transient for the MBMS GW. If the SGmb path failure remains transient for the MBMS GW, the BM-SC shall behave as follows upon detecting the SGmb path recovery:\n-\tif the BM-SC has already moved the control of the MBMS session to an alternative MBMS GW, the BM-SC shall send an MBMS Session Stop Request message to the MBMS GW previously controlling the MBMS session with a \"Local MBMS bearer context release\" indication to instruct that MBMS GW to release the MBMS bearer context locally in the MBMS GW and in the associated MME/SGSN(s) without sending any message to the MCE/RNC(s).\n-\tif the BM-SC has not yet moved the control of the MBMS session to an alternative MBMS GW (e.g. if the MBMS restoration procedures are not supported in the network),\n-\tif the SGmb path failure is transient from the perspective of the BM-SC, the BM-SC shall consider that the MBMS session is still controlled by the related MBMS GW and proceed as if there had been no SGmb path failure;\n-\tif the SGmb path failure is non transient from the perspective of the BM-SC, the BM-SC shall send an MBMS Session Start Request to the MBMS GW for the session and encode it as specified above (for a message sent to an alternative MBMS GW).\nNOTE 6:\tThe BM-SC cannot know whether the MBMS GW will see the SGmb path failure as transient or non transient if the SGmb path recovers in the period between the maximum path failure timer of the MBMS GW plus and minus the period between two Diameter Device-Watchdog-Request messages or MBMS Heartbeat Request messages sent by the MBMS GW. This can possibly lead the BM-SC to send an MBMS Session Stop request to the MBMS GW for a session that has already been terminated by the MBMS GW (if the MBMS GW determined the failure is non transient) or to send an MBMS Session Start request (with the \"MBMS session re-establishment indication\" flag) to the MBMS GW for a session that is still alive at the MBMS GW (if the MBMS GW determined the failure is transient).\nIn deployments without a Diameter Agent between the BM-SC and the GCS AS, the BM-SC shall detect an MB2-C path failure using either:\n-\tmechanisms as specified in the Diameter Base Protocol (e.g. transport connection failure, GCS AS peer not responding, Diameter Device-Watchdog-Request and Device-Watchdog-Answer messages during periods when there is no need for other MB2 signalling); or\n-\tthe MBMS Heartbeat procedure (see clause 29), if this procedure is supported.\nIn deployments with a Diameter Agent between the BM-SC and the GCS AS, the BM-SC shall detect an MB2-C path failure using the MBMS Heartbeat procedure (see clause 29).\nNOTE 1:\tA transport connection failure does not allow to identify a failure of the remote MBMS peer. Likewise, it is not possible to rely on Diameter Device-Watchdog-Request / Answer messages to test the responsiveness of the remote MBMS node during periods when there is no need for other MB2 signalling as these messages are only exchanged between Diameter peers with a direct transport connection.\nUpon detecting a non-transient MB2-C path failure, the BM-SC shall deallocate (locally) all the TMGIs that had been assigned to the GCS AS and the BM-SC shall stop all the related MBMS bearers to free the corresponding resources in E-UTRAN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.2.7\tPGW functionality",
                            "text_content": "The PGW may support invoking the PGW triggered SGW restoration procedure (see clause 27.2.3) when detecting a path failure to an SGW (see clause 20.2.1). If so, after detecting a path failure to an SGW, the PGW should maintain the S5 bearer contexts eligible for restoration and proceed with the PGW triggered SGW restoration procedure with the following modifications:\n-\tfor GTP-based S5, the PGW shall include the PGW F-TEID for control plane in the PGW Downlink Triggering Notification message;\n-\tfor PMIP-based S5, the PGW shall include the PGW IP address and uplink GRE key for control plane in the PMIP Update Notification message;\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.2.8\tGCS AS functionality",
                            "text_content": "In deployments without a Diameter Agent between the BM-SC and the GCS AS, the GCS AS shall detect an MB2-C path failure using either:\n-\tmechanisms as specified in the Diameter Base Protocol (e.g. transport connection failure, BM-SC peer not responding, Diameter Device-Watchdog-Request and Device-Watchdog-Answer messages during periods when there is no need for other MB2 signalling); or\n-\tthe MBMS Heartbeat procedure (see clause 29), if this procedure is supported.\nIn deployments with a Diameter Agent between the BM-SC and the GCS AS, the GCS AS shall detect an MB2-C path failure using the MBMS Heartbeat procedure (see clause 29).\nNOTE 1:\tA transport connection failure does not allow to identify a failure of the remote MBMS peer. Likewise, it is not possible to rely on Diameter Device-Watchdog-Request / Answer messages to test the responsiveness of the remote MBMS node during periods when there is no need for other MB2 signalling as these messages are only exchanged between Diameter peers with a direct transport connection.\nUpon detecting a non-transient MB2-C path failure, the GCS AS shall assume that all the TMGIs that had been assigned by the BM-SC have been de-allocated and that all the related MBMS bearers have been deactivated.\nThe GCS AS may restore the MBMS delivery e.g. via a different BM-SC using the MB2-C procedures specified in 3GPP TS 29.468 [36].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.2.9\tSx interface functionality",
                            "text_content": "If the path to the SGW-U is down, the SGW-C should handle this as SGW-U Failure without Restart, see clause 16.1A.4.\nIf the path to the SGW-C is down, the SGW-U should handle this as SGW-C Failure without Restart, see clause 16.1A.3.\nIf the path to the PGW-U is down, the PGW-C should handle this as PGW-U Failure without Restart, see clause 17.1A.4.\nIf the path to the PGW-C is down, the PGW-U should handle this as PGW-C Failure without Restart, see clause 17.1A.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "20.3\tUser plane path failure detection and handling",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "20.3.1\tGeneral",
                            "text_content": "GTP-U entities shall support detection of path failure by using Echo Request / Echo Response messages in the following way. A path counter shall be reset each time an Echo Response is received on the path and incremented when the T3-RESPONSE timer expires for any Echo Request message sent on the path. The path shall be considered to be down if the counter exceeds N3-REQUESTS.\nUpon detecting a path failure, the network node should notify the failure via the Operation and Maintenance system and may either\n-\tdelete the bearer contexts associated with the path in failure; or\n-\tmaintain the bearer contexts associated with the path in failure during an operator configurable maximum path failure duration. The network node shall delete the maintained resources if the path is still down when this duration expires.\nAn MME may also perform relevant restoration procedure(s) if the S1-U path failure notification feature as specified in the following clause(s) is supported.\nNOTE 1:\tDuring transient path failures (e.g. path failures not exceeding few minutes at most), maintaining the bearer contexts associated with the peer's IP address enables the delivery of end user services (when the path is re-established again) and also avoids unnecessary signalling in the network for restoring those bearers.\nNOTE 2:\tIt is not intended to maintain bearer contexts during long path failures (e.g. exceeding few minutes at most) as this would imply undesirable effects like undue charging.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.3.2\tMBMS GW functionality",
                            "text_content": "An MBMS GW may support the detection of an SGi-mb path failure.\nNOTE 1:\tHow an MBMS GW detects an SGi-mb path failure is implementation specific. E.g. an MBMS GW can monitor the receipt of downlink user plane from the BM-SC (synchronization sequences are transmitted continuously e.g. in case of MBSFN transmissions, even if there is no MBMS user data to be sent).\nUpon detecting a non-transient SGi-mb path failure (operator configurable maximum path failure duration), based on operator's policy, the MBMS GW may tear down the affected MBMS sessions by sending MBMS Session Stop Request message(s) to the MME/SGSN(s) serving the MBMS sessions and Session Termination Request message(s) to the BM-SC with a terminating cause signalling a user plane failure.\nNOTE 2:\tThis enables to free corresponding radio resources in E-UTRAN/UTRAN and to attempt to re-establish the MBMS session(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.3.3\tBM-SC functionality",
                            "text_content": "Upon receipt of a Session Termination Request message from an MBMS GW with a terminating cause signalling a user plane failure, the BM-SC may attempt to re-establish the MBMS session via the same MBMS GW (using different user plane resources over SGi-mb) or an alternative MBMS GW.\nWhen re-establishing the MBMS session, the BM-SC shall encode the MBMS Session Start Request with the same contents as in the original MBMS Session Start Request (or per the last MBMS Session Update Request sent by the BM-SC if the original parameters were updated) with the following exceptions:\n-\tthe BM-SC shall set the \"MBMS session re-establishment indication\" flag to signal that this message is used to re-establish an MBMS session;\n-\tif no absolute start time (\"MBMS data transfer start\" parameter) has been sent, the BM-SC may change the relative start time (\"time to MBMS data transfer\" parameter) to fasten the restoration of the MBMS service in E-UTRAN;\n-\tthe BM-SC should set the estimated session duration to a value corresponding to the remaining duration of the session;\n-\tthe BM-SC shall provide the new user plane resources assigned to the MBMS session over SGi-mb.\nIf the MBMS session is not re-established and if it was activated by a Group Communication Service Application Server(s) (GCS AS), the BM-SC shall notify the GCS AS that the MBMS session has been deactivated.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.3.4\tWith Control and User plane Separation of SGW or PGW nodes",
                            "text_content": "With a split SGW or PGW (see 3GPP TS 23.214 [42]), user plane path failure detection and handling shall be supported as specified in clause 20.3.1 with the following additional requirements:\n-\tupon detecting a GTP-U user plane path failure, the SGW-U or PGW-U shall report the user plane path failure to the SGW-C or PGW-C respectively, by sending an PFCP Node Report Request (see 3GPP TS 29.244 [43]) including a User Plane Path Failure Report with the IP address of the remote GTP-U peer(s) towards which a failure has been detected;\n-\tupon detecting a failed GTP-U user plane path become recovered, the SGW-U or PGW-U shall report the user plane path recovery to the SGW-C or PGW-C respectively, by sending an PFCP Node Report Request (see 3GPP TS 29.244 [43]) including a User Plane Path Recovery Report with the IP address of the remote GTP-U peer(s) associated with the user plane path recovered;\n-\tupon being notified about the user plane path failure, when deciding to delete the bearer contexts associated with the path in failure, the SGW-C or PGW-C shall modify or delete the affected PFCP sessions in the SGW-U or PGW-U.\nNOTE:\tThe SGW-C and PGW-C need to take care to smooth the signalling load towards the SGW-U and PGW-U if a large number of PFCP sessions are affected by the user plane path failure.\nAn SGW-C may support S1-U path failure notification feature as specified in clause 20.3.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.3.4A\tReporting of a Peer GTP-U Entity Restart",
                            "text_content": "When Control Plane and User Plane Separation (CUPS) is deployed, to reduce massive amount of Sx signalling to report the receiving of GTP-U Error Indication messages and to perform subsequent PFCP Session Modification for PFCP sessions affected by the peer GTP-U restart, a user plane function (SGW-U or PGW-U) and a control plane function (SGW-C or PGW-C) may optionally support reporting of a peer GTP-U entity restart.\nA GTP-U entity, e.g. in a SGW-U or a PGW-U, may detect the restart of the peer GTP-U entity as specified in clause 18A.\nWhen the user plane function detects the peer GTP-U entity has restarted via receiving one or more GTP-U Error Indication message(s) or Echo Request/Response message(s) containing a larger Recovery Time Stamp, and when the control plane function supports Reporting of a GTP-U Entity Restart, it shall send a PFCP Node Report Request message to the control plane function to report that:\n-\tthe peer GTP-U entity identified by Remote GTP-U Peer IE has restarted; and\n-\tall PFCP sessions associated with the restarted peer GTP-U entity have been modified by the user plane function, i.e. the F-TEID(s) that had been allocated by the restarted GTP-U entity have been removed from the FARs and the Apply-Action in these FARs changed to BUFF and NOCP, if the restarted GTP-U entity is a RNC or eNB.\nNOTE:\tThe UP function can learn if the restarted GTP-U entity is a RNC or eNB by using the Destination Interface Type included in the Forwarding Parameters in the FAR (which contains the F-TEID that had been allocated by the restarted GTP-U entity).\nThe control plane function shall send a PFCP Node Report Response message to acknowledge the receipt of the report of the peer GTP-U entity restart; and the control plane may further behave as if it receives a GTP-U Error Indication Report for those PFCP sessions affected by the peer GTP-U entity restart, e.g. to trigger Downlink Data Notification procedure as part of Network Triggered Service Request procedure if the restarted GTP-U entity is a RNC or eNB. (see also clauses 21.7 and 21.8)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.3.5\tSGW functionality",
                            "text_content": "An SGW, with or without CUPS support, may optionally support the following S1-U path failure notification feature.\nIf the feature is supported and deployed in the network, after detecting a S1-U user plane path failure:\n-\tIf the SGW decides to keep the bearer contexts associated with the failed path (e.g. when the operator configurable maximum path failure duration timer has not expired), the SGW shall notify the MME of the S1-U path failure in subsequent signalling procedures associated with those PDN connections that are affected by the failed S1-U path as follows:\n-\twhen the SGW receives a Create Session Request message with eNodeB F-TEID(s), e.g. in an S1/X2 handover with SGW relocation procedure, or a Modify Bearer Request message or a Modify Access Bearer Request message, e.g. in a Service Request procedure:\n-\tif all default bearer contexts are associated with failed S1-U paths, the SGW shall reject the request messages with the cause code \"S1-U Path Failure\" at the message level;\n-\tif the bearer context(s) associated with the failed S1-U path(s) is not the default bearer context, the SGW may partially accept the Create Session Request or the Modify Bearer Request message and shall include the cause code \"S1-U Path Failure\" at the bearer context level for the bearer context(s) associated with failed S1-U path(s);\n-\tif at least one of default bearers among multiple PDN connections from the same UE is not associated with the failed S1-U path, the SGW may partially accept the Modify Access Bearer Request message including the cause code \"S1-U Path Failure\" at the bearer context level for the bearer context associated with failed S1-U path;\n-\tat reception of downlink packets to be sent towards an S1-U bearer associated with a failed S1-U path, the SGW shall send a Downlink Data Notification message with the cause code \"S1-U Path Failure\".\n-\tIf the SGW decided to delete the bearer contexts associated with the failed path, the SGW shall include a cause code \"S1-U path failure\" in the Delete Bearer Request message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "20.3.6\tMME functionality",
                            "text_content": "An MME may optionally support the following S1-U path failure notification feature.\nIf the feature is supported and deployed in the network, after receiving the cause code \"S1-U Path Failure\" in a Create Session Response or a Modify Bearer Response or a Modify Access Bearer Response or a Downlink Data Notification or a Delete Bearer Request message:\n-\tthe MME shall derive the S1-U path information (e.g. the eNB F-TEID and the SGW F-TEID) from the UE Context and mark it as failed, and the MME shall store such information for a configurable period, and before the configured period is expired;\n-\tthe MME should avoid selecting the SGW with a failed S1-U path towards the eNB for subsequent PDN connection establishment procedures and mobility procedures with SGW relocation;\n-\tif an alternative SGW without an S1-U path failure is available, the MME shall perform an SGW relocation procedure at a Service Request procedure for the PDN Connection(s) where the default bearer is associated with a failed S1-U path as specified in clause 5.10.4 of 3GPP TS 23.401 [15].\n-\tif an alternative SGW without an S1-U path failure is available, the MME should perform an SGW relocation procedure for all active PDN connections where the default bearer is associated with the failed S1-u path as specified in clause 5.10.4 of 3GPP TS 23.401 [15].\n-\tthe MME should deactivate the corresponding PDN connections using the \"reactivation requested\" cause value as specified in clause 5.10.3 of 3GPP TS 23.401 [15] if it receives a Delete Bearer Request with the cause \"S1-U Path Failure\" for deleting the PDN connection;\n-\tthe MME shall deactivate the corresponding E-RAB for the bearer context(s) associated with failed S1-U path(s) if it receives a Delete Bearer Request message with the cause \"S1-U Path Failure\" for deleting dedicated bearer context(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "21\tError Indication handling",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "21.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The following clauses specify a network element behaviour, if it receives a GTPv1-U Error Indication message. The reception of the message triggers a node internal procedure and/or a Control Plane procedure (GTPv1-C, GTPv2, RANAP, S1-AP).\nFor the PMIP based S5/S8 interface, an error in the form of an ICMP message is used instead of a GTPv1-U Error Indication message for the Error Indication handling.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.2\tGGSN",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tIf the GGSN receives a GTP error indication for a PDP context that has the DTI flag set (i.e. from an RNC), the GGSN should not delete the associated PDP context but mark it as invalid. Any subsequent packets arriving for an invalid PDP context should be discarded. The GGSN shall inform the SGSN that the GGSN received a GTP error indication from RNC. The SGSN shall re-establish the tunnel between the SGSN and GGSN as specified in 3GPP TS 29.060 [8], which sets the related PDP context as valid again in the GGSN. The GGSN then forwards any subsequent downlink packets to the SGSN.\n-\tIf the GGSN receives a GTP error indication for a PDP context that has the no DTI flag set (i.e. from an SGSN), the GGSN shall delete its PDP context and may notify the Operation and Maintenance network element.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.3\tGn/Gp SGSN",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tIf the SGSN receives a GTP error indication from a GGSN, the SGSN shall delete its PDP context and may notify the Operation and Maintenance network element. Additionally it shall send a Deactivate PDP Context Request message to the MS with cause \"re-activation required\"\n-\tIf the SGSN receives a GTP error indication from the RNC it shall locally release the RAB. The SGSN should preserve the associated PDP context. The SGSN may initiate the RAB Assignment procedure in order to re-establish the RAB.\n-\tFor MBMS, when an Error Indication is received from an SGSN, the receiving GGSN shall delete all information associated with the relevant SGSN in its MBMS Bearer Context and the GGSN may notify the Operation and Maintenance network element. In addition, for broadcast mode the GGSN may request the re-establishment of the MBMS Bearer Context by sending an MBMS Session Start Request message (see clause 7.5A.2.5 of 3GPP TS 29.060 [8]). Furthermore, if the GGSN serves only one downstream SGSN for MBMS data transfer and the GGSN does not support the re-establishment procedure, the GGSN shall delete its MBMS Bearer Context together with the affected MBMS UE Context(s).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.4\tS4 SGSN",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tIf the S4-SGSN receives a GTP error indication from a SGW, the S4-SGSN shall delete its Bearer context and may notify the Operation and Maintenance network element.  Additionally it shall send a Deactivate PDP Context Request message to the MS with cause \"re-activation required\"\n-\tIf the S4-SGSN receives a GTP error indication from the RNC it shall locally release the RAB. The S4-SGSN should preserve the associated Bearer context. The S4-SGSN may initiate the RAB Assignment procedure in order to re-establish the RAB.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.5\tRNC or NodeB",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tWhen the RNC receives GTP error indication from the SGSN, it shall initiate the RAB Release procedure with the error cause \"GTP Resources Unavailable\" and shall immediately locally release the RAB (i.e. without waiting for a response from the SGSN).\n-\tIf the RNC receives a GTP error indication from the GGSN (i.e. if Direct Tunnel is established), it shall initiate the RAB Release procedure with the error cause \"GTP Resources Unavailable\" and immediately locally release the RAB (i.e. without waiting for a response from the SGSN). The SGSN shall delete the related PDP context at the SGSN and send a Deactivate PDP Context Request message to the MS with cause \"re-activation required\".\n-\tIf the RNC receives a GTP error indication from the SGW (i.e. if Direct Tunnel is established), it shall initiate the RAB Release procedure with the error cause \"GTP Resources Unavailable\" and immediately locally release the RAB (i.e. without waiting for a response from the SGSN). The SGSN shall delete the related PDP context and send a Deactivate PDP Context Request message to the MS with the cause \"re-activation required\". If the deleted PDP context is a primary PDP context, the SGSN shall set the \"Tear down indicator\" bit in the Deactivate PDP Context Request message. The SGSN may also optionally send a Delete Bearer Command or a Delete Session Request message to the SGW if the deleted PDP context is a secondary PDP context or a primary PDP context respectively.\nNOTE:\tSending a Delete Bearer Command or a Delete Session Request message to the SGW can help the SGSN to determine whether the GTP error indication was due to the release of the bearer context or the release of the UE context in the SGW.\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.6\teNodeB",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tIf the eNodeB receives a GTP error indication from the SGW over an S1-U tunnel not doing indirect forwarding, it shall initiate the E-RAB Release procedure and immediately locally release the E-RAB (i.e. without waiting for a response from the MME). If the MME receives the E-RAB Release Indication for a default bearer that is not the last default bearer of a UE or that the UE has a SCEF PDN connection or that the UE supports Attach without PDN connectivity as specified in clause 5.3.8.3 of 3GPP TS 23.401 [15], the MME should send a Delete Session Request to the SGW. Additionally the MME may also send a Deactivate EPS Bearer Context Request to the UE with the ESM cause set to \"Reactivation Requested\" if the MME has decided to restore the PDN connection based on operator policy, QCI and/or ARP and/or APN. If the MME receives the E-RAB Release Indication for the last default bearer of a UE and the UE does not have a SCEF PDN connection and the UE does not support Attach without PDN connectivity as specified in clause 5.3.8.3 of 3GPP TS 23.401 [15], the MME shall initiate a MME initiated Detach procedure with the detach type \"re-attach required\". If the MME receives the UE Context Release Request from the eNB, the MME shall send a Release Access Bearers Request to the SGW but if the SGW responds with a \"context not found\" cause and the UE does not have a SCEF PDN connection and the UE does not support Attach without PDN connectivity, then the MME shall initiate a MME initiated Detach procedure with the detach type \"re-attach required\".\n-\tIf the eNodeB receives a GTP error indication from a peer eNodeB over an X2-U direct forwarding tunnel or from an SGW over an S1-U indirect forwarding tunnel, the eNodeB may ignore the error indication received over the forwarding tunnels or delete the forwarding tunnel context locally without deleting the EPS bearers.\n-\tFor dual connectivity case as specified in 3GPP TS 36.300 [32]:\n-\tIf the MeNodeB receives a GTP error indication from the SGW over an S1-U tunnel, it shall initiate the E-RAB Release procedure and immediately locally release the E-RAB (i.e. without waiting for a response from the MME);\n-\tIf the MeNodeB/SeNodeB receives a GTP error indication from the peer SeNodeB/MeNodeB, the MeNodeB/SeNodeB shall delete the X2-U tunnel locally;\n-\tIf the SeNodeB receives a GTP error indication from the SGW over an S1-U tunnel, it shall delete the S1-U tunnel locally;\n-\tThe MeNodeB and SeNodeB may initiate an additional dual connectivity procedure(s) as specified in 3GPP TS 36.300 [32].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.7\tSGW",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tFor an 'Active' mode UE having a user plane connection with an RNC, i.e. SGW has F-TEIDs assigned by RNC for user plane for the UE,when the SGW receives a GTP Error Indication for a Bearer Context that has the DTI flag set (i.e. from an RNC), the SGW should not delete the associated Bearer Context but delete all the RNC GTP-U tunnel TEIDs for this MS and sends a Downlink Data Notification message to the SGSN (the complete behaviour is specified in clause 22). Then the SGW starts buffering downlink packets received for this MS.\n-\tFor an 'Active' mode UE having a user plane connection with an eNB, i.e. SGW has F-TEIDs assigned by eNB for user plane for the UE, when the SGW receives a GTP Error Indication for a Bearer Context from an eNodeB, the SGW should not delete the associated Bearer Context but delete all the eNodeB GTP-U tunnel TEIDs for this UE and sends a Downlink Data Notification message to the MME (the complete behaviour is specified in clause 22). Then the SGW starts buffering downlink packets received for this UE.\n-\tFor a UE having an S11 user plane connection with an MME, i.e. SGW has S11-U F-TEIDs assigned by MME for user plane for the UE, when the SGW receives a GTP Error Indication for a Bearer Context from an MME, the SGW may:\n-\tdelete all the Bearer contexts associated with the PDN connection (identified by the default bearer) and notify the Operation and Maintenance network element, or as an alternative,\n-\tdelete the MME GTP-U tunnel TEID for this UE and send a Downlink Data Notification message to the MME to re-establish the user plane path without deleting the PDN connection (the complete behaviour is specified in clause 22). Then the SGW starts buffering downlink packets received for this UE.\n-\tIf the SGW receives a GTP error indication from S4-SGSN for a Bearer Context other than the default bearer when S4-U is used, the SGW may delete its Bearer context and may notify the Operation and Maintenance network element, or as an alternative, the SGW may send Downlink Data Notification message to the S4-SGSN to re-establish the user plane path without deleting the bearer context.\n-\tIf the SGW receives a GTP error indication from S4-SGSN for the default bearer when S4-U is used, the SGW may delete all the Bearer contexts associated with the PDN connection (identified by the default bearer) and may notify the Operation and Maintenance network element, or as an alternative, the SGW may send Downlink Data Notification message to the S4-SGSN to re-establish the user plane path without deleting the PDN connection.\n-\tIf the SGW receives a GTP error indication from a PGW for the bearer other than the default bearer, the SGW shall delete its Bearer context and may notify the Operation and Maintenance network element.\n-\tIf the SGW receives a GTP error indication from a PGW for the default bearer, the SGW shall delete all the Bearer contexts associated with the PDN connection (identified by the default bearer) and may notify the Operation and Maintenance network element. The SGW may send the Delete Bearer Request for the default bearer to the MME/S4 SGSN to delete the associated PDN connection.\nPMIP error indication message shall be handled as follows:\n-\tIf the SGW receives an ICMP message from a PGW that indicates the UE specific error indication, as specified in the 3GPP TS 29.275 [16], the SGW may delete the associated PDN connection (identified by the GRE key included in the ICMP message) and may notify the Operation and Maintenance network element. In this case, the SGW may also:\n-\tsend the Delete Bearer Request for the default bearer to the MME/S4 SGSN to delete the associated PDN connection, and/or,\n-\tperform other implementation specific actions, such as: sending messages to release other external resources (e.g. PCC messages).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.8\tPGW",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tIf the PGW receives a GTP error indication from a SGW/a TWAN /an ePDG for the bearer other than the default bearer, the PGW shall delete its Bearer context and may notify the Operation and Maintenance network element.\n-\tIf the PGW receives a GTP error indication from a SGW/a TWAN /an ePDG for the default bearer, the PGW shall delete all the Bearer contexts associated with the PDN connection (identified by the default bearer) and may notify the Operation and Maintenance network element.\nPMIP error indication message shall be handled as follows:\n-\tIf the PGW receives an ICMP message from an SGW/an ePDG/a Trusted Non-3GPP IP access node that indicates the UE specific error indication as specified in the 3GPP TS 29.275 [16], the PGW may delete the associated PDN connection (identified by the GRE key included in the ICMP message) and may notify the Operation and Maintenance network element.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.9\tMBMS GW",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP Error Indication message shall be handled as follows:\n-\tIf the MBMS GW receives a GTP Error Indication from a SGSN, the MBMS GW shall delete its Bearer context and may notify the Operation and Maintenance network element.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.10\tePDG",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tIf the ePDG receives a GTP error indication from a PGW for the bearer other than the default bearer, the ePDG shall delete its Bearer context and may notify the Operation and Maintenance network element.\n-\tIf the ePDG receives a GTP error indication from a PGW for the default bearer, the ePDG shall delete all the Bearer contexts associated with the PDN connection (identified by the default bearer) and initiate the release of the corresponding SWu instance (i.e. IKEv2 tunnel). The ePDG may notify the Operation and Maintenance network element.\nPMIP error indication message shall be handled as follows:\n-\tIf the ePDG receives an ICMP message from a PGW that indicates the UE specific error indication as specified in the 3GPP TS 29.275 [16], the ePDG may delete the associated PDN connection (identified by the GRE key included in the ICMP message) and initiate the release of the corresponding SWu instance (i.e. IKEv2 tunnel) . The ePDG may notify the Operation and Maintenance network element.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.11\tTWAN",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tIf the TWAN receives a GTP error indication from a PGW for the bearer other than the default bearer, the TWAN shall delete its Bearer context and may notify the Operation and Maintenance network element.\n-\tIf the TWAN receives a GTP error indication from a PGW for the default bearer, the TWAN shall delete all the Bearer contexts associated with the PDN connection (identified by the default bearer) and may initiate the release of the corresponding WLAN specific resource. The TWAN may notify the Operation and Maintenance network element.\nPMIP error indication message shall be handled as follows:\n-\tIf the TWAN receives an ICMP message from a PGW that indicates the UE specific error indication as specified in the 3GPP TS 29.275 [16], the TWAN may delete the associated PDN connection (identified by the GRE key included in the ICMP message) and may initiate the release of the corresponding WLAN specific resource. The TWAN may notify the Operation and Maintenance network element.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "21.12\tMME",
                    "description": "",
                    "summary": "",
                    "text_content": "GTP error indication message shall be handled as follows:\n-\tIf the MME receives a GTP error indication from an SGW, the MME shall delete its Bearer context and may notify the Operation and Maintenance network element. Additionally the MME shall deactivate the corresponding PDN connection towards the UE with the cause \"re-activation required\", or initiate an explicit detach with reattached required procedure, as appropriate, see 3GPP TS 24.301 [19].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "22\tDownlink Data Notification Handling at MME/S4 SGSN",
            "description": "If the MME/S4 SGSN receives a Downlink Data Notification message from the SGW as a result of the SGW having received an Error Indication message from the eNodeB/RNC or S4-SGSN over S4 User Plane, the MME/S4 SGSN should perform the following:\n-\tIf the UE is in IDLE state, upon receipt of the Downlink Data Notification message, the MME/S4 SGSN shall perform the Network Triggered Service Request procedure as specified in 3GPP TS 23.060 [5] and 3GPP TS 23.401 [15].\n-\tIf the UE is in CONNECTED state, upon receipt of the Downlink Data Notification message, the MME shall perform S1 Release procedure and perform Network Triggered Service Request procedure as specified in 3GPP TS 23.401 [15].\n-\tIf the UE is in CONNECTED state, upon receipt of the Downlink Data Notification message and Direct Tunnel is used, the S4-SGSN shall perform Iu Release procedure and perform Network Triggered Service Request procedure as specified in 3GPP TS 23.060 [5] if the cause value included in Downlink Data Notification is \"Error Indication received from RNC/eNodeB/S4-SGSN\",\n-\tIf the UE is in CONNECTED state, upon receipt of the Downlink Data Notification message and Direct Tunnel is not used, the S4-SGSN should re-establish all of the S4-U bearers of this UE if the cause value included in Downlink Data Notification is \"Error Indication received from RNC/eNodeB/S4-SGSN\".\nUpon receipt of a Downlink Data Notification message from the SGW, caused by an Error Indication message received from the MME over the S11 User Plane, the MME should perform the following if the UE is known by the MME:\n-\tIf the UE is in IDLE state, the MME shall perform the Network Triggered Service Request procedure as specified in 3GPP TS 23.401 [15].\n-\tIf the UE is in CONNECTED state, the MME may perform an S1 Release procedure and a Network Triggered Service Request procedure as specified in 3GPP TS 23.401 [15], or as an alternative, the MME may keep the existing S1 signalling connection and just send a Modify Bearer Request message to the SGW to re-establish the S11-U tunnel.\nIf the MME receives a Downlink Data Notification message from the SGW as a result of the SGW having detected a S1-U path failure, and if the MME supports S1-U path failure notification feature, the MME shall behave as specified in clause 20.3.6.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "23\tGeneral partial failure handling procedures",
            "description": "The partial failure handling is an optional feature for MME, SGW, ePDG, TWAN and PGW. Partial failure handling is an optional feature between SGW-C, PGW-C, SGW-U and PGW-U for split SGW and PGW (see 3GPP TS 23.214 [42]).\nFor split SGW and PGW, the description in this clause related to SGW applies to SGW-C and PGW applies to PGW-C as well.\nA partial failure handling feature may be used when a hardware or software failure affects a significant number of PDN connections while a significant number of PDN connections are unaffected. This feature may also be used for the degenerate case of a full/complete failure of a remote node (MME or PGW) in order to cleanup hanging PDN connections associated with the failed node. When it is impossible to recover the affected PDN connections (for example, using implementation-specific session redundancy procedures), it is useful to inform the peer nodes about the affected PDN connections for recovery on the peer nodes. Such a notification could be performed using an identifier that represents a large set of PDN connections rather than on individual PDN connection basis.\nNOTE 1:\tIf a hardware or software failure happens to impact only an insignificant number of PDN connections the node experiencing the fault need not treat the failure as a partial fault but may tear down connections one by one.\nFor the purposes of partial fault handling the term \"node\" refers to an entity that takes the role of an MME, PGW, ePDG, TWAN or SGW as defined in an SAE network.\nA PDN Connection Set Identifier (CSID) shall identify a set of PDN connections within a node that may belong to an arbitrary number of UEs. A CSID is an opaque parameter local to a node. Each node that supports the feature maintains a local mapping of CSID to its internal resources. When one or more of those resources fail, the corresponding one or more fully qualified CSIDs are signalled to the peer nodes.\nThe fully qualified CSID (FQ-CSID) is the combination of the node identity and the CSID assigned by the node which together globally identifies a set of PDN connections.\nNOTE 2:\tThe node identifier in the FQ-CSID is required since two different nodes may use the same CSID value. A partial fault in one node should not cause completely unrelated PDN connections to be removed accidentally.\nThe node identifier shall be globally unique across all 3GPP EPS networks. Its format is defined in 3GPP TS 29.274 [13]\nFor the purposes of partial fault handling the term peer is used as follows: For a particular PDN connection two nodes are peers if both nodes are used for that PDN connection. For a PDN Connection Set the nodes are peers if they have at least one PDN connection in the PDN Connection Set where both nodes are used for that PDN connection. In particular PGW and MME are generally peers for the purposes of partial fault handling.\nAn FQ-CSID is established in a node and stored in peer nodes in the PDN connection at the time of PDN connection establishment, or during a node relocation, and used later during partial failure handling in messages defined in 3GPP TS 29.274 [13] and 3GPP TS 29.275 [16]. Each node that support the feature, including the MME, SGW, ePDG, TWAN and the PGW, shall maintain the FQ-CSID provided by every other peer node for a PDN connection. The FQ-CSIDs stored by PDN connection are later used to find the matching PDN connections when a FQ-CSID is received from a node reporting a partial fault for that FQ-CSID.\nWith the exception of the GTPv2 Delete PDN Connection Set Request and PMIPv6 Binding Revocation Indication BRI messages, each feature supporting MME, SGW, ePDG, TWAN or PGW shall assign only one FQ-CSID for itself in messages and each FQ-CSID shall have exactly one CSID within the FQ-CSID.\nFollowing rules shall apply for all the nodes:\n1)\tIf a node (MME, SGW, ePDG, TWAN or PGW) supports the partial failure handling feature, it shall generate and include its own FQ-CSID during the PDN connection establishment, node relocation procedures. Explicit list of the relevant GTPv2 messages is given in the respective clauses (14.3 \"Partial Failure Handling at MME\", 16.2 \"Partial Failure Handling at SGW\", 17B.2 \"Partial Failure Handling at ePDG\", 17C.2 \"Partial Failure Handling at TWAN\" and 17.2 \"Partial Failure Handling at PGW\"). A node that supports partial failure handling feature shall also store peers' FQ-CSIDs.\n2)\tAdditionally, if an SGW supports partial failure handling feature, it shall forward the peer node's (of an MME or of a PGW, depending on the direction) FQ-CSID and also Delete Connection Set Request/Response messages. Also, if the SGW detects the full/complete failure of an MME or PGW, e.g., through the Echo Request/Echo Response procedure, it may send a Delete PDN Connection Set Request (or PMIPv6 Binding Revocation Indication with G bit set) message containing all of the FQ-CSIDs of the associated hanging PDN connections of the failed node to the corresponding remote node (MME or PGW) .\n3)\tIf a node that supports partial failure handling feature receives peer node's FQ-CSID during the procedures, which are specified in Rule 1, it shall conclude that the peer node supports the feature. Subsequently, the node shall store the peer node's FQ-CSID and shall send appropriate partial failure handling messages to the peer.\n4)\tIf a node that supports partial failure handling feature does not receive the peer's FQ-CSID during the procedures, which are specified in Rule 1, it shall conclude that the peer node does not support the feature.\n5)\tA node that supports partial failure handling feature shall not send any FQ-CSID IE or any partial failure handling specific messages to the peer node if the sender is aware (see Rule 4) that the receiver does not support the feature.\n6)\tIf a node does not support the partial failure handling feature, it shall ignore any received FQ-CSID IE or any partial failure handling specific message.\n7)\tDuring session management procedures as specified in 3GPP TS 23.401 [15] and 3GPP TS 23.402 [18] (such as a dedicated bearer activation/deactivation/update), a node supporting the partial failure handling feature may update its FQ-CSID to the supporting peer node(s) in the Create Bearer Request/Response, Delete Bearer Request/Response or Update Bearer Request/Response.\nNOTE 3:\tFQ-CSID handling for the Initial Attach and various handover cases are addressed in clauses 14, 16 and 17.\nIn addition to the above requirements, for split SGW and PGW, the following applies:\n1)\tIf a node (SGW-C, SGW-U, PGW-C or PGW-U) supports the partial failure handling feature, it shall generate and include its own FQ-CSID during the Sx Session Establishment procedure.\n2)\tThe SGW-C shall initiate Sx Session Modification procedure to update the SGW-U with the MME FQ-CSID, PGW-C FQ-CSID if changed;\n3)\tThe PGW-C shall initiate Sx Session Modification procedure to update the PGW-U with the MME FQ-CSID, SGW-C FQ-CSID, TWAN FQ-CSID, or ePDG FQ-CSID if changed;\n4)\tThe SGW-C and the PGW-C may change its FQ-CSID during a Sx Session Modification procedure if its SEID is changed;\n5)\tWhen the node (SGW-C, SGW-U, PGW-C or PGW-U) detects that it has undergone a partial failure, it shall send a Sx Session Set Deletion Request message containing all the its CSIDs of the component(s) failing to its peer node;\n6)\tFor a SGW-C or a PGW-C, it shall also send Sx Session Set Deletion Request to the SGW-U or PGW-U respectively containing MME FQ-CSID, ePDG FQ-CSID, TWAN FQ-CSID, PGW-C FQ-CSID or SGW-C FQ-CSID if it receives the corresponding GTPv2 message Delete PDN Connection Set Request message containing those FQ-CSID.\n7)\tThe SGW-C and the PGW-C shall initiate the restoration procedure to restore the Sx Sessions affected by the partial failure in the SGW-U or the PGW-U in the same way as specified in the clause 16.1A.3 for the SGW-U failure and 17.1A.3 for the PGW-U failure respectively, when receiving an Sx Session Set Deletion Request message including a SGW-U or a PGW-U FQ-CSID(s) which is associated with the partial failure from the SGW-U or the PGW-U.\nFigure 23-1 illustrates FQ-CSID establishment during the Attach or PDN connection establishment procedures for 3GPP E-UTRAN access as specified in the above rules.\nFigure 23-1 illustrates the process of FQ-CSID establishment during the Attach or PDN establishment procedure for 3GPP E-UTRAN access. The figure depicts the interaction between the eNB, serving eNodeB, and the UE, with the FQ-CSID being established to ensure efficient resource allocation and seamless connectivity. The figure highlights the role of the Serving Gateway (SGW) and the Home Gateway (HGW) in managing the session and providing a stable connection for the UE. The process is crucial for maintaining high-quality communication and ensuring a smooth user experience in the E-UTRAN network.\nFigure 23-1: FQ-CSID establishment during the Attach or PDN establishment procedure for 3GPP E-UTRAN access\n1.\tIf an MME supports partial failure handling, the MME shall send own FQ-CSID to SGW with a Create Session Request message across S11 interface.\n\nThe MME's FQ-CSID indicates to the SGW that MME supports partial failure handling. If the SGW does not receive MME's FQ-CSID, then the SGW shall never send partial failure handling related messages or IEs to the MME.\n\nIf the SGW does not support partial failure handling, then the SGW shall silently discard MME's FQ-CSID.\n\nIf the SGW does support partial fault handling it shall store the MME's FQ-CSID in it's PDN connection table.\n2.\tIf the SGW supports partial failure handling, the SGW shall forward MME's FQ-CSID to PGW with a Create Session Request message or a Proxy Binding Update message across S5/S8 interface. The SGW shall also include own FQ-CSID into the message.\nThe SGW's FQ-CSID indicates to the PGW that the SGW supports partial failure handling.\n\nIf the PGW does not support partial failure handling, then the PGW shall silently discard both FQ-CSIDs.\n3.\tIf the SGW has indicated the support for partial failure handling to PGW, then the PGW, which supports the feature shall send own FQ-CSID back to the SGW with a Create Session Response message or a Proxy Binding Acknowledgement message across S5/S8 interface. PGW's FQ-CSIDs in the S5/S8 Create Session Response or a Proxy Binding Acknowledgement message indicates to the SGW that PGW supports partial failure handling.\n\nIf the SGW has not indicated support for partial failure handling, then PGW shall never send partial failure handling related messages or IEs to the SGW.\n4.\tIf the MME has indicated the support for partial failure handling to SGW, then the SGW, which supports the feature, shall forward PGW's FQ-CSID to MME with a Create Session Response message across S11 interface. The SGW shall also include own FQ-CSID into the message.\nFigure 23-2 illustrates FQ-CSID establishment during the Attach or PDN connection establishment procedures for untrusted non-3GPP access as specified in the above rules.\nFigure 23-2 illustrates the process of FQ-CSID establishment during the Attach or PDN establishment procedure for non-3GPP access. The figure depicts the interaction between the eNodeB, PDN Gateway, and the FQ-CSID server. The eNodeB initiates the procedure by sending a PDN Attach request to the PDN Gateway, which then communicates with the FQ-CSID server to allocate a unique identifier for the session. This identifier is then returned to the eNodeB, which uses it to establish the FQ-CSID. The figure highlights the importance of this process in ensuring secure and efficient communication between the eNodeB and the PDN Gateway.\nFigure 23-2: FQ-CSID establishment during the Attach or PDN establishment procedure for non-3GPP access\n1.\tIf an ePDG/TWAN supports partial failure handling, the ePDG/TWAN shall send own FQ-CSID to PGW with a Create Session Request message across GTPv2 based S2b/S2a interface or a Proxy Binding Update message across PMIPv6 based S2b/S2a interface.\n\nThe ePDG's/TWAN's FQ-CSID indicates to the PGW that ePDG/TWAN supports partial failure handling. If the PGW does not receive ePDG's/TWAN's FQ-CSID, then the PGW shall never send partial failure handling related messages or IEs to the ePDG/TWAN.\n2.\tIf the PGW supports partial failure handling, it shall store the ePDG's/TWAN's FQ-CSID in its PDN connection table and it shall send own FQ-CSID back to the ePDG/TWAN with a Create Session Response message across GTPv2 based S2b/S2a interface or a Proxy Binding Acknowledgement message across PMIPv6 based S2b/S2a interface. PGW's FQ-CSIDs in the Create Session Response or Proxy Binding Acknowledgement indicates to the ePDG/TWAN that PGW supports partial failure handling. The ePDG/TWAN shall then store the PGW's FQ-CSID in its PDN connection table.\n\nIf the PGW does not support partial failure handling, then the PGW shall silently discard ePDG's/TWAN's FQ-CSID.\nFigure 23-3 illustrates FQ-CSID establishment during the Sx Session Establishment procedure for 3GPP access, with a split SGW, as specified in the above rules.\nFigure 23-3 illustrates the process of FQ-CSID establishment during the Session Establishment Procedure. The figure depicts the interaction between the client, server, and FQ-CSID server, highlighting the exchange of messages and the establishment of a FQ-CSID. Key components include the client, server, FQ-CSID server, and the signaling messages involved in the process. The figure emphasizes the importance of secure communication and efficient session management in modern communication systems.\nFigure 23-3: FQ-CSID establishment during the Sx Session Establishment procedure\n1.\tIf an SGW-C supports partial failure handling, the SGW-C shall send its own FQ-CSID and MME FQ-CSID to the SGW-U in the Sx Session Establishment Request.\n2.\tIf the SGW-U supports partial failure handling, it shall store the SGW-C FQ-CSID and MME FQ-CSID for the related Sx Session  and it shall send its own FQ-CSID back to the SGW-C in the Sx Session Establishment Response message. The SGW-U's FQ-CSID in the Create Session Establishment Response implicitly indicates to the SGW-C that SGW-U supports partial failure handling. The SGW-C shall then store the SGW-U's FQ-CSID for the related Sx Session. If the SGW-C does not receive an SGW-U FQ-CSID from the SGW-U, then the SGW-C shall not further send partial failure handling related messages or IEs to the SGW-U.\n\nIf the SGW-U does not support partial failure handling, then the SGW-U shall silently discard the SGW-C's FQ-CSID and MME FQ-CSID.\nFigure 23-4 illustrates FQ-CSID establishment during the Sx session Establishment procedure with a split PGW as specified in the above rules.\nFigure 23-4 illustrates the process of FQ-CSID establishment during the Sx session establishment procedure. The figure depicts the interaction between the FQ-CSID manager and the Sx session manager, highlighting the exchange of information and the establishment of FQ-CSID. The figure showcases the synchronization between the two entities, ensuring the successful creation of FQ-CSID for efficient session management.\nFigure 23-4: FQ-CSID establishment during the Sx session establishment procedure\n1.\tIf a PGW-C supports partial failure handling, the PGW-C shall send its own FQ-CSID, SGW-C FQ-CSID, TWAN FQ-CSID, ePDG FQ-CSID and MME FQ-CSID to PGW-U in the Sx Session Establishment Request.\n2.\tIf the PGW-U supports partial failure handling, it shall store the PGW-C FQ-CSID, SGW-C FQ-CSID, TWAN FQ-CSID, ePDG FQ-CSID and MME FQ-CSID for the related Sx Session and it shall send its own FQ-CSID back to the PGW-C in the Sx Session Establishment Response message. The PGW-U's FQ-CSIDs in the Sx Session Establishment Response implicitly indicates to the PGW-C that PGW-U supports partial failure handling. The PGW-C shall then store the PGW-U's FQ-CSID for the related Sx Session. If the PGW-C does not receive a PGW-U FQ-CSID from the PGW-U, then the PGW-C shall not further send partial failure handling related messages or IEs to the PGW-U.\n\nIf the PGW-U does not support partial failure handling, then the PGW-U shall silently discard PGW-C's FQ-CSID.\nFigure 23-5 illustrates FQ-CSID establishment during the Sx Session Establishment procedures to provide the PGW-C FQ-CSID to the SGW-U after receiving a PGW-C FQ-CSID in Create Session Response from PGW-C on the S5/S8 interface.\nFigure 23-5 illustrates the process of FQ-CSID establishment to provide a PGW-C FQ-CSID to the PGW-U, which is crucial for establishing a Quality of Service (QoS) connection. The figure depicts the interaction between the PGW-C, PGW-U, and the FQ-CSID, highlighting the steps involved in creating a secure and efficient connection. The diagram showcases the importance of this process in maintaining a reliable and high-quality communication channel between the PGW-C and PGW-U.\nFigure 23-5: FQ-CSID establishment to provide a PGW-C FQ-CSID to the PGW-U\n1.\tIf an SGW-C supports partial failure handling and the SGW-U has indicated its support of partial failure in the Sx Session Establishment Response, the SGW-C shall send PGW-C FQ-CSID received on S5/S8 interface to the SGW-U in an Sx Session Modification Request.\n2.\tIf the SGW-U supports partial failure handling, it shall store the PGW-C FQ-CSID for the related Sx Session and send a reply to the SGW-C.\n\nIf the SGW-U does not support partial failure handling, then the SGW-U shall silently discard the PGW-C's FQ-CSID.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "24\tRestoration of data in the PCRF",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "24.1\tRestart of the PCRF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "24.1.0\tPCRF Restart",
                            "text_content": "PCRF storage of PCC contexts is volatile. When a PCRF fails, the PCC contexts and Diameter sessions affected by the failure are lost in the PCRF.\nWhen a PCRF receives a non-initial message for which no Diameter session exists, it shall discard the message and return a Diameter error indication to the originating PCRF client.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "25\tNetwork triggered service restoration procedure",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "25.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The network triggered service restoration procedure is an optional feature for the MME, S4-SGSN and SGW. A node that supports this feature shall support the network triggered service restoration procedure without ISR as specified in clause 25.2 and the network triggered service restoration procedure with ISR as specified in clause 25.3 if it supports Idle mode Signalling Reduction (ISR) (see 3GPP TS 23.401 [15] and 3GPP TS 23.060 [5]).\nThe network triggered restoration procedure without ISR shall apply to UEs for which ISR is not active at the time the ISR associated node fails. The network triggered restoration procedure with ISR shall apply to UEs for which ISR is active at the time the ISR associated node fails. Both procedures may run in parallel if there is a mix of UEs with ISR and without ISR at the time the ISR associated node fails.\nFor the PMIP based S5/S8 case, the terminology \"S5/S8 bearer\" used through clause 25 shall be read as \"S5/S8 IP traffic flow\" within the GRE tunnel. The detailed concepts of the \"IP traffic flow\" are specified in 3GPP TS 23.402 [18].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "25.2\tNetwork triggered service restoration procedure without ISR",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "25.2.1\tGeneral",
                            "text_content": "The following requirements shall apply if the MME or S4-SGSN and the SGW support this feature.\nIf an SGW detects that an MME or S4-SGSN has restarted (see clause 18 \"GTP-C based restart procedures\"), instead of removing all the resources associated with the peer node, the SGW shall maintain the PDN connection table data and MM bearer contexts for some specific S5/S8 bearer contexts eligible for network initiated service restoration, and initiate the deletion of the resources associated with all the other S5/S8 bearers.\nNOTE 1:\tThis enables the SGW to still receive downlink user plane or control plane data from the PGW or from a PCRF (PMIP based S5/S8) for the maintained S5/S8 bearers.\nThe S5/S8 bearers eligible for network initiated service restoration are determined based on operator's policy, e.g. based on the QCI and/or ARP and/or APN, and such operator's policy shall be applicable for both the SGW and the MME/SGSN. The Delay Tolerant Connection Indication (DTCI), if set, may also be used to determine that the S5/S8 bearer is not eligible for network initiated service restoration, based on operator's policy when using QCI and/or ARP and/or APN is not sufficient, e.g. for Home routed roaming scenario.\nEmergency PDN connections for users without authenticated IMSI do not need to be maintained by the SGW and cannot be restored at the initiative of the network.\nNOTE 2:\tUsers with an emergency call in progress can re-attach and re-establish the emergency PDN connection after detecting the loss of the signalling connection with the RAN. IMS Emergency PSAP callback is not supported for unauthenticated users with an emergency registration but without an emergency call in progress.\nIf at least one S5/S8 bearer needs to be maintained, the SGW shall also start a timer controlling the maximum duration during which those bearers shall be maintained. There is one operator configurable timer per SGW. The timer value may be equal to the periodic tracking area update timer (timer T3412) as specified in 3GPP TS 24.301 [19] or the periodic routing area update timer (timer T3312) as specified in 3GPP TS 24.008 [20]. This timer ensures that the S5/S8 bearers eligible for network initiated service restoration are maintained until the corresponding UE reattaches to the network. If the timer expires, the maintained resources shall be locally deleted assuming that the corresponding UE might have reattached to the network via a different SGW.\nThe SGW shall not release the default bearer of a PDN connection for which one or more dedicated bearers are maintained. Any downlink user plane or control plane packet received on a default bearer which is not eligible for network initiated service restoration but which is maintained for dedicated bearer(s) eligible for such procedure shall be silently discarded by the SGW.\nWhen releasing the maintained S5/S8 bearers, the SGW may optionally perform other implementation specific actions such as messages to clear other external resources (e.g. PCC messages to clear the resources in the PCRF or GTP/PMIP messages to release the corresponding PDN connection in the PGW).\nIf the SGW receives a Create Session Request message for a UE for which some S5/S8 bearers are maintained, the SGW shall delete all the bearers for this UE and proceed with the Create Session Request message handling as specified in 3GPP TS 29.274 [13].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "25.2.2\tSGW procedure",
                            "text_content": "Upon receipt of the first downlink user plane or control plane packet on a maintained S5/S8 bearer or PCC signalling from PCRF, the SGW shall immediately send a Downlink Data Notification message including the IMSI to the respective MME or S4-SGSN. In addition, depending on the received downlink packet type the SGW shall proceed as follows:\n-\tif the received downlink packet contains user plane data, the SGW shall silently discard it but the SGW shall continue maintaining the corresponding bearers. If the SGW receives another downlink user plane packet for an ARP value other than the ARP included in the Downlink Data Notification sent before, it shall proceed as specified in clause 5.3.4.3 \"Network Triggered Service Request\" of 3GPP TS 23.401 [15] with the exception that the packet shall be discarded by the SGW.\n-\tFor the S5/S8 GTP case:\n-\tif the received downlink packet contains a control plane message other than a Delete Bearer Request message then the SGW may reject the message and shall continue maintaining the corresponding bearers. If the SGW receives another control plane message for an ARP value other than the ARP included in the Downlink Data Notification sent before, it shall proceed as specified in clause 5.3.4.3 \"Network Triggered Service Request\" of 3GPP TS 23.401 [15] with the exception that the message may be rejected by the SGW.\n-\tif the received downlink packet contains the Delete Bearer Request message, the SGW shall accept the message, and shall release the corresponding S5/S8 bearer(s) immediately.\n-\tFor the S5/S8 PMIP case:\n-\tif the received packet contains a control plane message other than the message of the Gateway Control and QoS Rules Provision procedure as specified in 3GPP TS 29.213 [21] clause 4.4.3 which results in the SGW to decide to deactivate an existing dedicated bearer, then the SGW may reject the message and shall continue maintaining the corresponding bearers. If the SGW receives another control plane message for an ARP value other than the ARP included in the Downlink Data Notification sent before, it shall proceed as specified in clause 5.3.4.3 \"Network Triggered Service Request\" of 3GPP TS 23.401 [15] with the exception that the message may be rejected by the SGW.\n-\tif the received downlink packet contains the message of the Gateway Control and QoS Rules Provision procedure as specified in 3GPP TS 29.213 [21] clause 4.4.3 which results in the SGW to decide to deactivate an existing dedicated bearer, the SGW shall accept the message, and shall release the corresponding S5/S8 bearer(s) immediately.\nThe SGW may send the Downlink Data Notification message including the IMSI to the respective MME or S4-SGSN, if there is some DL data buffered for a UE when detecting the MME or S4-SGSN restart.\nNOTE:\tFor a UE using a power saving feature, DL data can be buffered for an extended duration in the SGW. The above requirement can allow the MME or S4-SGSN to restore the service to such a UE at the next occasion the UE becomes reachable. The SGW needs to pace the sending of Downlink Data Notification to the MME or S4-SGSN to avoid signalling storms over S11 and S4.\nThe SGW may send the Downlink Data Notification message to another MME or S4-SGSN (the same type of mobility node as the failed one) located in the same pool as the failed node if the SGW cannot send it to the failed MME or S4-SGSN (e.g. because it did not restart). It is an implementation/deployment matter how an SGW becomes aware that an MME/S4-SGSN has failed and has not restarted.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "25.2.3\tMME/SGSN procedure",
                            "text_content": "Upon receipt of a Downlink Data Notification message including the IMSI, the MME or S4-SGSN shall respond to the SGW with a Downlink Data Notification Acknowledge message and should page and force the UE to re-attach to the network. The paging area and subscriber's identity i.e. IMSI or S-TMSI/P-TMSI used during the paging procedure is implementation dependent. The MME or S4-SGSN may support and apply this procedure to a UE using extended idle mode DRX, and if so, they shall page the UE with the S-TMSI/P-TMSI.\nNOTE 1:\tUpon receiving a page message with \n- the IMSI, the UE starts the reattach procedure as specified in clause 5.6.2.2.2 of 3GPP TS 24.301 [19] and clause 4.7.9.1.2 of 3GPP TS 24.008 [20];  \n- the S-TMSI, the UE starts the service request procedure which is rejected by the MME with Cause #10 – Implicitly detached; the UE then re-attaches to the network as specified in clause 5.6.2.2.1 of 3GPP TS 24.301 [19]; \n- the P-TMSI, in case of Iu mode, the UE starts the service request procedure which is rejected by the S4-SGSN with Cause #10 – Implicitly detached; the UE then re-attaches as specified in clauses 4.7.9.1.1 and 4.7.13 of 3GPP TS 24.008 [20];\n- the P-TMSI, in case of A/Gb mode, the UE sends any LLC frame and subsequently re-attaches to the network as specified in clause 8.1.4 of 3GPP TS 23.060 [5].\nNOTE 2:\tPaging in the MME or S4-SGSN serving area will cause excessive use of radio resources. How to reduce the paging area is implementation dependent.\nNOTE 3:\tIt is the responsibility of the MME/S4 SGSN to avoid unnecessary IMSI Paging.\nNOTE 4:\tHow the restarted or alternative MME/S4-SGSN knows the UE's DRX parameter or the extended DRX parameters to page the UE is implementation dependent.\nNOTE 5:\tA restarted MME will not receive S1AP UE Context Active message as part of UE initiated Connection Resume procedure, since the eNB would have deleted the AS context for all UEs associated with this MME after detecting the MME restart.\nThe MME or S4-SGSN may request the SGW to immediately release the maintained S5/S8 bearers by sending the \"Downlink Data Notification Acknowledge\" message or a \"Downlink Data Notification Failure Indication\" message with the specific cause \"UE already re-attached\", e.g. if the UE has already re-attached to the network. The Downlink Data Notification Acknowledge and Downlink Data Notification Failure Indication shall include the IMSI to identify the UE context in the SGW.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "25.3\tNetwork triggered service restoration procedure with ISR",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "25.3.1\tGeneral",
                            "text_content": "The following requirements shall apply if the involved MME, S4-SGSN and SGW support the ISR feature and the network triggered service restoration feature.\nNOTE:\tThe procedure in this clause does not consider the case where one of ISR associated nodes, i.e. the MME or the S4-SGSN, does not support the network triggered service restoration procedure.\nIn the rest of this clause, the term \"non-failed\" node refers to the CN node (MME or S4-SGSN) that remains in normal operation during this procedure, as opposed to the \"restarted\" node which refers to the CN node (MME or S4-SGSN) that has failed and restarted.\nThe procedure in the SGW towards the restarted node differs from the procedure towards the non-failed ISR associated node (see clause 25.3.2).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "25.3.2\tSGW procedure",
                            "text_content": "If an SGW detects that an ISR associated CN node (i.e. MME or S4-SGSN) has restarted (see clause 18), the SGW shall maintain all the PDN connection table data and MM bearer contexts associated with the non-failed and the restarted ISR associated nodes, and start a timer controlling the maximum duration during which the SGW shall consider that ISR is still active. There is one operator configurable timer per SGW. The timer value may be set to a value that is the greater value of the periodic tracking area update timer (timer T3412) as specified in 3GPP TS 24.301 [19] and the periodic routing area update timer (timer T3312) as specified in 3GPP TS 24.008 [20]. This timer ensures that the SGW can still send Downlink Data Notification messages to the restarted MME or S4-SGSN until the corresponding UE learns that ISR is deactivated. If the timer expires, the SGW shall deactivate ISR by locally releasing the resources for the maintained restarted CN node (i.e. restarted CN node control plane F-TEID).\nUpon receipt of the downlink user plane or control plane packet on a maintained S5/S8 bearer for a UE in idle mode or in connected state with the failed CN node, the SGW shall initiate the network triggered service request procedure towards the non-failed CN node as specified in 3GPP TS 23.401 [15] clause 5.3.4.3. In addition, if the S5/S8 bearer is eligible for network initiated service restoration, the SGW shall also immediately send a Downlink Data Notification message including the IMSI towards the restarted CN node as specified in clause 25.2.2. The SGW shall continue to forward downlink user plane or control plane packet for a UE in connected state in the non-failed ISR associated node.\nThe S5/S8 bearers eligible for network initiated service restoration are determined by the SGW based on operator's policy e.g. based on the QCI and/or ARP and/or APN.\nEmergency PDN connections for users without authenticated IMSI do not need to be maintained by the SGW and cannot be restored at the initiative of the network.\nNOTE 0:\tUsers with an emergency call in progress can re-attach and re-establish the emergency PDN connection after detecting the loss of the signalling connection with the RAN. IMS Emergency PSAP callback is not supported for unauthenticated users with an emergency registration but without an emergency call in progress.\nThe SGW may send the Downlink Data Notification message with the IMSI to another MME or S4-SGSN (the same type of mobility node as the failed one) in the same MME or S4-SGSN pool if the SGW cannot send it to the failed MME or S4-SGSN (e.g. because it did not restart). It is an implementation/deployment matter how an SGW becomes aware that an MME/S4-SGSN has failed and has not restarted.\nUpon receipt of a Downlink Data Notification message including the IMSI, the restarted CN node shall respond to the SGW with a Downlink Data Notification Acknowledge message and should page the UE and force it to re-attach to the network as specified in clause 25.2.\nNOTE 1:\tIf the UE camps under the service area of the restarted CN node, then the UE re-attaches to the network (see NOTE 1 in clause 25.2.3).\nIf the paging is successful (i.e. Modify Bearer Request is received) for the non-failed ISR associated CN node, the SGW may send a Stop Paging Indication message including the IMSI to the restarted CN node (or the alternative node in the same pool to which the Downlink Data Notification message with the IMSI has been sent before) to stop the paging procedure.\nIf the SGW receives a Create Session Request message as part of Initial Attach procedure for a UE for which the PDN connections, MM bearer context and ISR state have been maintained, the SGW shall stop the timer, deactivate ISR, and delete the maintained resources associated to the restarted CN node (i.e. CN node control plane F-TEID). The SGW may additionally send a Stop Paging Indication message to the non-failed ISR associated CN node to stop the paging procedure.\nNOTE 2:\tThe SGW may have already deleted the restarted CN node resources since Delete Session Request from non-failed ISR associated CN node may arrive earlier than the Create Session Request message.\nIf the non-failed ISR associated CN node received a Cancel Location message from HSS/HLR with \"Initial Attach procedure\" Cancellation Type, the non-failed CN node shall delete all the bearer contexts and send Delete Session Request message(s) to SGW. The SGW shall then release all the resources for this UE and sends one of the following messages to PGWs involved to release all the resources maintained in the PGWs as specified in 3GPP TS 23.401 [15] and 3GPP TS 23.402[18].\n-\tFor the GTP based S5/S8 case, Delete Session Request message(s)\n-\tFor the PMIP based S5/S8 case, PBU message(s) with Lifetime set to \"0\"\nThe SGW shall stop the timer and delete the resources for the maintained restarted CN node (i.e. restarted CN node control plane F-TEID) if it receives one of the following messages while the timer is running:\n-\ta Modify Bearer Request message indicating that ISR is not active, e.g. from the non-failed CN node during a TAU/RAU procedure; or\n-\ta Modify Bearer Request message indicating that ISR is active from another mobility management node with the same type as the restarted node.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "25.3.3\tMME/S4-SGSN procedure",
                            "text_content": "If an MME/S4-SGSN detects a restart of an ISR associated counterpart (see clause 18), the MME/S4-SGSN shall wait for the next RAU/TAU procedure to deactivate ISR.\nNOTE:\tAs an implementation option, an MME/S4-SGSN may internally mark the ISR as not active, but this should not be visible in messages sent to the SGW.\nThe non-failed CN node may initiate the GUTI Relocation or P-TMSI Relocation Procedure with a non-broadcast TAI or RAI to force the UE to perform the TAU/RAU procedure for ISR deactivation, e.g. if a signalling connection is established with the UE following receipt of a Downlink Data Notification message.\nIf afterwards the non-failed MME/S4-SGSN receives TAU/RAU Request, then the MME/S4-SGSN shall inform the UE in the TAU/RAU Accept message to disable ISR as specified in 3GPP TS 23.401[15] and 3GPP TS 23.060 [5]. The non-failed CN node shall send a Modify Bearer Request message to the SGW, even if the MME/S4-SGSN did not change during the TAU/RAU, to request the SGW to disable ISR and to update the SGW with the latest RAT Type and Serving Network values. Upon receipt of that message, the SGW shall disable ISR and shall stop sending Downlink Data Notification message with IMSI to the restarted CN node.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "26\tMobile terminated CS service delivery via an alternative MME in MME pool",
            "description": "This procedure is an optional feature for VLR and MME. It enables the network to continue delivering mobile terminated CS services to UEs via an alternative MME in the MME pool where the UE is located when the MME to which the UE was registered fails without restart or fails for a long duration.\nNOTE 1:\tUEs in idle mode are not aware of an MME failure until they need to send some uplink data or signalling (e.g. a periodic Tracking Area Update) or until they are forced to re-attach e.g. via the network trigerred service restoration procedure. Without support of the procedure defined in this clause, UEs that remain under LTE may not be able to receive mobile terminated CS services for a long duration after an MME failure without restart or a long MME failure.\nThe following requirements shall apply if the VLR and MME support this feature.\nWhen the VLR has to page the UE for a mobile terminated CS service (e.g. upon receipt of an incoming CS call), if the VLR detects that the MME serving the UE is no longer in service, the VLR should send an SGs paging request with a CS restoration indicator to one alternative MME in the same MME pool. The VLR should load-balance the paging requests among the available MMEs in the pool during the restoration procedure.\nThe VLR may know the set of MMEs pertaining to the same MME pool by local configuration or by checking the MME Group ID within the MME name that MMEs signal to the VLR in the SGsAP-LOCATION-UDATE-REQUEST, SGsAP-RESET-INDICATION or SGsAP-RESET-ACK messages. The MME should send an SGsAP-RESET-INDICATION message to the VLR after restart.\nThe VLR may detect that an MME is no longer in service if there are no more SCTP associations in service with that MME.\nNOTE 2:\tSemi-permanent SCTP associations are established between the MME and VLR, i.e. the SCTP associations remain up under normal circumstances.\nThe VLR should adjust its paging retransmission delay to avoid requesting again the UE to re-attach before the restoration procedure completes.\nThe MME shall behave as specified in clause 14.1.3 upon receipt of an SGs paging request not including the CS restoration indicator.\nThe MME shall accept the SGs paging request and proceed as follows upon receipt of an SGs paging request including the CS restoration indicator:\n-\tif the IMSI is unknown by the MME, or if the IMSI is known and the UE is marked as EMM-DEREGISTERED, the MME shall send the paging request with the location information provided by the VLR, regardless of the value of the \"MME-Reset\" indicator. If no such location information is provided, the MME may either page the UE in all the tracking areas corresponding to that MME or in the tracking areas served by the MME and by the VLR, or reject the paging request per operator policy. The paging request shall include the IMSI and the CN domain indicator set to \"PS\" to request the UE to re-attach;\n-\tif the IMSI is known by the MME and the UE is considered to be attached to both EPS and non-EPS services or for SMS only (for an SGs paging request with an 'SMS indicator'), the MME shall page the UE based on the location information stored in the MME.\nThe MME may support and apply this procedure to a UE using extended idle mode DRX for MT-SMS service, and if so, the MME shall page the UE with the S-TMSI.\nNOTE 3:\tHow the alternative MME knows the UE's DRX parameter or the extended DRX parameters to page the UE is implementation dependent.\nUpon receipt of a paging request including the IMSI and the CN domain indicator set to \"PS\", or upon receipt of a Service Reject with Cause #10 – Implicitly detached (when using S-TMSI paging), the UE re-attaches to one MME of the pool (that may not be necessarily the MME that initiated the paging procedure towards the UE) and a new SGs association is established with the VLR. This may be a different VLR than the VLR that initiated the SGs paging procedure, e.g. if Intra Domain Connection of RAN Nodes to Multiple CN Nodes is deployed for GERAN or UTRAN (see 3GPP TS 23.236 [24]).\nNOTE 4:\tThe UE can receive a Service Reject with Cause #10 – \"Implicitly detached\" upon being paged by an alternative MME with the S-TMSI assigned by the MME that has failed. The UE then re-attaches to the network as specified in clause 5.6.2.2.1 of 3GPP TS 24.301 [19].\nIf the new SGs association is established towards the same VLR, the VLR should repeat the SGs paging request after the UE has re-attached to non-EPS services. The MT CS service or SMS is then delivered according to  normal procedures.\n\nIf the new SGs association is established towards a different VLR, the MT CS service may be delivered via the new VLR using Mobile Terminating Roaming Retry or Mobile Terminating Roaming Forwarding (see 3GPP TS 23.018 [23]); the on-going MT SMS is retransmitted by the SMS-SC using the existing SMS procedures (SMS alert).\nSubsequent MT CS services are delivered as per normal procedures.\nNOTE 5:\tA UE with ISR active before the MME failure and using GERAN or UTRAN radio access will not receive the paging request sent by the alternative MME. The VLR can deliver the MT CS service by paging the UE on the A/Iu interface as per existing principles of 3GPP TS 29.118 [14] when the UE does not respond to a first paging on the SGs interface. Paging the UE on the A interface fails if the network operates in NMO I and the UE is in PS connected mode in GERAN.\nSee 3GPP TS 29.118 [14] for a comprehensive description.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "27\tRestoration of PDN connections after an SGW failure",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "27.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures specified in this clause enable to restore in the EPC the PDN connections affected by an SGW failure with or without restart, and thus to resume delivery of downlink data towards the UE with minimum service interruption and with minimal signalling in the network.\nAll the procedures specified in this clause are optional to support.\nThe procedures specified in clause 27.2 apply to UEs for which ISR is not active when the SGW fails. The procedures specified in clause 27.3 apply to UEs for which ISR is active when SGW fails. The procedures specified in these clauses only apply to PDN connections established between MME/S4-SGSN and PGW pertaining to the same operator, i.e. for non-roaming and roaming scenarios with local breakout. The MME/S4-SGSN and the PGW shall behave as per the restoration requirements specified in clauses 14.1A.1 and 17.1A.1 for PDN connections established between nodes pertaining to different operators, i.e. as if the remote peer node does not support these SGW restoration procedures.\nThe procedures specified for an SGW in clauses 27.2 and 27.3 apply as well to an SGW-C. An SGW-C shall always apply in addition the related PFCP procedures towards the SGW-U.\nNOTE 1:\tThe applicability of these procedures is restricted to PDN connections established between MME/S4-SGSN and PGW pertaining to the same operator to ensure, simply by local configuration, that MME/S4-SGSN and PGWs apply the same logic i.e. same operator's policies when determining whether and which PDN connections should be restored. This enables to restore in particular IMS PDN connections (even in roaming scenarios, for which local break out is used).\nNOTE 2:\tThe use of these SGW restoration procedures may be extended by Service Level Agreements to PDN connections established between MME/S4-SGSN and PGW pertaining to different operators, i.e. for roaming scenarios with home routed traffic, but this is not further considered in 3GPP specifications.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "27.2\tRestoration of PDN connections after an SGW failure for UEs without ISR",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "27.2.1\tGeneral",
                            "text_content": "The PGW triggered SGW restoration procedure is an optional add-on feature for the MME/S4-SGSN, SGW and PGW on top of the MME/S4-SGSN triggered SGW restoration procedure as specified in clause 27.2.2. A node that supports the PGW triggered SGW restoration procedure shall support the requirements specified in clause 27.2.2 and in clause 27.2.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "27.2.2\tMME/S4-SGSN triggered SGW restoration",
                            "text_content": "The following requirements shall apply if the MME/S4-SGSN, the SGW, the PGW, and the PCRF support this feature.\nThe MME/S4-SGSN, PGW, and PCRF for PMIP based S5, shall know by local configuration whether this MME/S4-SGSN triggered SGW restoration procedure is supported in the PLMN, i.e. by peer PGWs, PCRFs and MME/S4-SGSNs. The PGW shall assume that either all or none of the MMEs/S4-SGSNs in the PLMN support this procedure.Upon detecting an SGW failure with or without restart (relying on restart counter as specified in clause 18 \"GTP-C based restart procedures\" and clause 19 \"PMIP based restart procedures\", or implementation e.g. preconfigured path failure timer), the MME/S4-SGSN and PGW shall maintain the bearers and MM contexts of the PDN connections affected by the SGW failure and eligible for restoration, instead of removing associated resources as per procedures specified in clauses 14.1A.1 and 17.1A.1.\nFor PMIP based S5, when the PCRF detects an SGW failure or restart, the PCRF shall maintain the IP-CAN sessions and delete locally the Gxc sessions affected by the SGW failure.\nNOTE 1:\tThe PGW notifies the PCRF about the termination of IP-CAN sessions associated to PDN connections that are not restored by the MME/S4-SGSN within an operator configurable period.\nThe PDN connections eligible for restoration are determined by the MME/S4-SGSN and PGW based on same operator's policies, e.g. based on QCI, ARP and/or APN.\nNOTE 2:\tThe PCRF is not aware of which PDN connections are eligible for restoration. When the PGW detects an SGW failure, the PGW requests the PCRF to terminate IP-CAN sessions associated to  PDN connections affected by the SGW failure and not eligible for restoration.\nMaintaining the PDN connections affected by the SGW failure enables the MME/S4-SGSN to restore the corresponding bearers of the UE by selecting a new SGW or the restarted SGW. These PDN connections are maintained for an operator configurable period (T-Release-PDN timer), which is locally provisioned on MME/S4-SGSN and PGW, that by default should cover the periodic tracking area update timer (timer T3412) as specified in 3GPP TS 24.301 [19] or the periodic routing area update timer (timer T3312) as specified in 3GPP TS 24.008 [20]. After the expiry of the T-Release-PDN timer the MME/S4-SGSN and the PGW should delete any EPS bearer contexts that have not been restored via a new or the restarted SGW.\nNOTE 3:\tThe PGW's capability of supporting this SGW restoration procedure is stored per PDN and per UE by the serving MME/S4-SGSN. For a UE with multiple active PDN connections, some PGWs may support the SGW restoration procedure while others do not support the same. E.g. SGW restoration procedure may be supported for a PDN connection with local breakout while not supported for another PDN connection with home routed traffic. The restoration procedures upon SGW failure specified in clauses 14.1A.1 and 17.1A.1 apply to the PDN connections for which the SGW restoration procedure is not supported or not applicable.\nAfter detecting an SGW failure, the MME/S4-SGSN should attempt to restore the PDN connections eligible for restoration for all the UEs affected by the SGW failure, i.e. including UEs in ECM_IDLE / PMM-IDLE / GPRS STANDBY not engaged in any Service Request, or Connection Resume procedure or other mobility procedure. The MME/S4-SGSN shall control the pace of the SGW relocations to avoid core network node overload. The MME/S4-SGSN should prioritize the SGW relocation for UEs engaged in a Service Request, or a Connection Resume, or RAU/TAU procedures or having GBR bearers over UEs which are not engaged in any mobility procedure and that do not have a signalling connection to the MME/S4-SGSN nor GBR bearers. The MME/S4-SGSN should also prioritize the SGW relocation for UEs with an emergency PDN connection.\nThe MME/S4-SGSN may further prioritize the PDN connections to restore, e.g. for UEs ECM_IDLE / PMM-IDLE / GPRS STANDBY not engaged in any Service Request or Connection Resume procedure, based on operator's policy e.g. based on the QCI and/or APN. Besides, the MME/SGSN may use the subscribed Restoration Priority per APN, if received from the HSS, and if permitted per service level agreements for in-bound roamers, to determine the relative restoration priority among PDN connections to the same APN. The MME/SGSN may use a locally configured value as default restoration priority if the restoration priority for a user's PDN connection is not received from the HSS or not permitted by service level agreement for in-bound roamers.\nNOTE 1:\tThis is to allow all the affected UEs to be reconnected to the network in a relatively short time (that is function of the speed of the SGW relocations that the MME/S4-SGSN performs, based on implementation and the network load) so that downlink packets may be delivered to the UEs with minimum service interruption.\nNOTE 2:\tPrioritizing the restoration of emergency PDN connections can enable to preserve emergency calls in progress for authenticated and unauthenticated users, and enable PSAP to call back authenticated users with an emergency registration but without an emergency call in progress.\nNOTE 3:\tThe Restoration Priority can e.g. allow to restore with a higher priority users with an IMS voice subscription over IMS users without an IMS voice subscription.\nTo restore the PDN connection(s) of a UE, the MME/S4-SGSN shall perform an SGW relocation procedure by sending a Create Session Request message (per PDN connection to restore) to the new or restarted SGW as per the steps 8-11 of a Tracking Area Update procedure with Serving GW change in clause 5.3.3.1 in 3GPP TS 23.401[15]. For PDN connections with GBR bearers existing before the SGW failure, the MME/S4-SGSN may either request to restore or remove the GBR bearers in the Create Session Request (e.g. depending on how quickly the PDN connection is restored).   The MME/S4-SGSN shall restore the PDN connections of the affected UEs after the SGW failure as follows:\n1)\tfor UEs in ECM_IDLE/PMM-IDLE/GPRS STANDBY state:\n-\tthe MME/S4-SGSN shall select a new SGW or the restarted SGW based on the last visited TAI/RAI. When Dedicated Core Networks are deployed, the UE Usage Type shall also be used for the SGW selection as specified in 3GPP TS 29.303 [37];\n-\tthe MME/S4-SGSN shall then perform an SGW relocation procedure as specified above.\n2)\tfor UEs in ECM_CONNECTED/PMM-CONNECTED/GPRS READY state not engaged in any mobility procedure (TAU/RAU, Handover):\n-\tthe MME/S4-SGSN shall release the S1/Iu/radio resources; if the eNodeB/RNC detects the SGW failure, the eNodeB/RNC may request the MME/S4-SGSN to release the S1/Iu resources;\n-\tthe MME/S4-SGSN shall then handle these UEs as specified for UEs in ECM_IDLE/PMM-IDLE/GPRS STANDBY state, or for UEs performing a mobility procedure if the UE performs subsequently such a mobility procedure (e.g. a Service Request to re-establish the S1/Iu/radio bearers);\n-\tas an exception to these rules, for UTRAN without direct tunnel and GERAN, the S4-SGSN may perform SGW relocation while keeping the UEs in PMM-CONNECTED/GPRS READY state (i.e. without tearing down the Iu/radio resources) because S4 user plane is used and the SGW failure remains not visible to the radio network.\nNOTE 4:\tAn SGW failure with restart may be visible to the radio network and cause bearers to be released for bearers with on-going uplink traffic if an Error Indication is received from the SGW before the S4-SGSN detects the SGW restart.\n3)\tfor UEs in ECM-IDLE/PMM-IDLE/GPRS STANDBY state initiating a Service Request procedure or a Connection Resume procedure:\n-\tthe MME/S4-SGSN shall first perform the SGW relocation procedure as specified above and then continue with the Service Request or the Connection Resume procedure since the MME/S4-SGSN has no valid SGW F-TEID to send in the S1-AP Initial Context Setup Request towards the eNodeB or in the Iu RAB Assignment Request message towards the RNC if Direct Tunnel is used.\n4)\tfor UEs initiating an intra-MME or intra-S4-SGSN TAU/RAU procedure:\n-\tthe MME/S4-SGSN shall perform the SGW relocation procedure as specified above before the TAU/RAU procedure;\n5)\tfor UEs initiating an inter-MME/SGSN TAU/RAU procedure:\n-\tIf both the source and target MME/S4-SGSNs support this SGW restoration procedure, the source MME/S4-SGSN should indicate to the target MME/S4-SGSN in the GTPv2 Context Response message that an SGW relocation procedure is needed due to an earlier SGW failure. Upon reception of such indication, the target MME/S4-SGSN shall perform the SGW relocation procedure as specified above and then proceed with the TAU/RAU procedure. The source MME/S4-SGSN may perform the SGW relocation procedure as specified above before responding to the GTPv2 Context Request message if the target MME/S4-SGSN does not support the SGW restoration procedure, e.g. during inter-PLMN RAU/TAU procedures when the target PLMN does not support the SGW restoration procedure.\n6)\tfor UEs in ECM-CONNECTED/PMM-CONNECTED/GPRS READY state for which a handover procedure is initiated:\n-\tThe source MME/S4-SGSN should reject the Handover Required / Relocation Required message received from the RAN (for UEs with PDN connection(s) affected by an earlier SGW failure that have not been restored yet); the MME/S4-SGSN should then release the S1/Iu/radio resources of these UEs to force them to enter idle mode. The MME/S4-SGSN shall then proceed with the procedures specified above for UEs in ECM_IDLE/PMM-IDLE/GPRS STANDBY state, or for UEs performing a mobility procedure if the UE performs subsequently such a mobility procedure (e.g. a Service Request to re-establish the S1/Iu/radio bearers).\nNOTE 5:\tS1/Iu/radio resources of UEs in ECM-CONNECTED/PMM-CONNECTED/GPRS READY state affected by an SGW failure are released very shortly after the SGW failure. Therefore only very few UEs affected an SGW failure and with PDN connections not restored yet may be subject to a handover, e.g. handovers taking place just after the SGW failure before the eNodeB/RNC or the MME/S4-SGSN release the S1/Iu/radio resources. This is why it is not necessary to support SGW relocation during Intra/Inter-CN handover procedures.\nAfter detecting a combined SGW/PGW failure, the MME/S4-SGSN behavior shall be same as in the case when an MME/S4-SGSN receives the optional PGW Restart Notification message. Either of the following shall apply:\n-\tMME/S4-SGSN behavior is determined by clause 16.1A.2 \"PGW Failure\";\n-\tPDN connections can be restored by the MME (this does not apply to S4-SGSN), as specified in clause 31.3 \"MME triggered PDN connection restoration\".\nThe PGW shall maintain the PDN connections affected by the SGW failure and eligible for restoration for an operator configurable period (T-Release-PDN timer), as specified in clause 27.2.2.1.\nThe PGW should maintain the GBR bearers of the PDN connections eligible for restoration for an operator configurable period (T-Release-GBR), which should be much shorter than the T-Release-PDN timer. Upon expiry of the T-Release-GBR timer, the PGW shall release GBR bearers that have not been restored yet and inform the PCRF about the corresponding PCC rule inactivation, with a cause as specified in 3GPP TS 29.212 [25].\nNOTE:\tThis is a safeguard mechanism to avoid e.g. overcharging the user in IMS for sessions not already terminated by IMS (e.g. by the far end user of a VoIP call).\nThe PGW shall discard downlink packets received for a PDN connection maintained after an SGW failure that has not been restored yet.\nThe PGW shall stop charging for PDN connections maintained after an SGW failure which have not been restored yet.\nIf the IP-CAN Session Modification Request is received for a PDN connection maintained after an SGW failure but not restored yet, the PGW shall reject the request if the request contains the installation/modification of PCC rules and other policy decisions (e.g. change of APN-AMBR), however the P-GW shall accept to remove the PCC rule if the removal of PCC rules is included in the request. The PGW shall accept an IP-CAN Session Modification Request if it only includes the removal of PCC rules. Refer to 3GPP TS 29.212 [25] clause B.3.14 for the detail. For these IP-CAN sessions for which an IP-CAN session modification has been rejected, the PGW shall subsequently inform the PCRF when the PDN connection is restored as specified in clause B.3.14 of 3GPP TS 29.212 [25]. This would enable the PCRF to update the PCC rules in the PGW if necessary. After the PDN connection is restored, the PGW shall initiate the bearer modification/deactivation procedure if necessary to modify or remove the resources associated with the PCC rules that were removed during the SGW failure.\nThe PGW shall accept an IP-CAN Session Termination Request received for a PDN connection maintained after an SGW failure but not restored yet, with an acceptance cause as specified in 3GPP TS 29.212 [25] and release the affected PDN connection locally. If subsequently the MME/S4-SGSN attempts to restore the PDN connection, the PGW shall reject the Modify Bearer Request (for GTP based S5) or the Proxy Binding Update (for PMIP based S5) with the cause \"Context Not Found\" as specified in 3GPP TS 29.274 [13] and 3GPP TS 29.275 [16] after the corresponding PDN connection has been released locally.\nIf the PGW rejects an IP-CAN session modification procedure with the rejection cause as specified in clause 27.2.2.3, the PCRF should maintain the corresponding IP-CAN session and refrain from sending any further IP-CAN session modification request to the PGW until being notified by the PGW that the PDN connection is restored.\nFor PMIP based S5, the PCRF cannot send any message to the SGW once the Gxc session in the PCRF is removed. The PCRF may however behave as for GTP based S5, e.g. send signalling to the PGW via the Gx interface. The Gxc session is restored when the PCRF receives Gateway Control Session Establishment from the SGW as specified in 3GPP TS 29.212 [25].\nAfter the SGW restarts, the SGW shall not send Error indication message for a configurable period when the SGW receives a GTP-U PDU for which no Bearer context exists.\nNOTE:\tThe period needs to be longer than the time required for the peer node to detect the restart of the SGW, e.g. the interval between two echo request messages. This ensures that the MME/SGSN or PGW does not deactivate the bearers before it detects the SGW failure and triggers the restoration procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "27.2.3\tPGW triggered SGW restoration",
                            "text_content": "The following requirements shall apply if the MME/S4-SGSN, the SGW and the PGW support this feature.\nNOTE:\tThe PGW triggered SGW restoration procedure does not require any further requirements from the PCRF than those already specified for the MME/S4-SGSN triggered SGW restoration procedure in clause 27.2.2.1.\nThe PGW shall know by local configuration whether this PGW triggered SGW restoration procedure is supported in the PLMN. The MME/S4-SGSN/SGW may know the same by local configuration. When supported in the PLMN, the PGW supporting this procedure should be configured with the address of alternative(s) SGW(s) also supporting this procedure. The PGW shall assume that either all or none of the MMEs/S4-SGSNs in the PLMN support the procedure. All MMEs/S4-SGSNs in an MME/S4-SGSN pool should support this procedure when it is deployed.\nThe PGW triggered SGW restoration procedure does not apply to emergency PDN connections for users without authenticated IMSI.\nNOTE:\tThe MME/S4-SGSN can prioritize the restoration of emergency PDN connections (see clause 27.2.2.2). IMS Emergency PSAP callback is not supported for unauthenticated users with an emergency registration but without an emergency call in progress.\nDuring normal mode of operation (i.e. before SGW failure with/without restart):\nThe MME/S4-SGSN supporting the PGW triggered SGW restoration procedure shall include the MME/S4-SGSN identifier IE in existing signalling over the S11/S4 interface, i.e. in\n-\tCreate Session Request messages during an E-UTRAN Initial Attach, a UE requested PDN connectivity, and a PDP Context Activation procedure;\n-\tCreate Session Request message during TAU/RAU procedures with a SGW change;\n-\tCreate Session Request message during X2 based handover/Enhanced SRNS Relocation procedure with a SGW change;\n-\tModify Bearer Request message during Inter-RAT Handover procedures with/without a SGW change;\n-\tModify Bearer Request message during Intra-RAT handover procedure with a SGW change;\n-\tModify Bearer Request message during Inter-RAT TAU/RAU procedures without a SGW change;\n-\tModify Bearer Request message over S11/S4 if the message is deemed to be sent to the PGW due to other reasons, e.g. reporting ULI, time zone.\nDuring SGW restoration procedure:\nUpon receipt of a PGW Downlink Triggering Notification message for which it cannot find a UE context corresponding to the received IMSI, the MME/S4-SGSN shall send a PGW Downlink Triggering Acknowledge message with the rejection cause code \"Context Not Found\" to the SGW to inform the SGW that the PGW Downlink Triggering Notification message has been received by the MME/S4-SGSN. If the PGW Downlink Triggering Notification message contains an MME/S4-SGSN identifier, the MME/S4-SGSN shall also include the IMSI and the MME/S4-SGSN identifier in the PGW Downlink Triggering Acknowledge message.\nUpon receipt of a PGW Downlink Triggering Notification message for which it can find a UE context corresponding to the received IMSI, the MME/S4-SGSN shall send a PGW Downlink Triggering Acknowledge message back to the SGW with an acceptance cause code, and perform S-TMSI/P-TMSI paging as part of Network Initiated Service Request procedure as specified in clause 5.3.4.3 of 3GPP TS 23.401 [15] and in clause 6.12.1A of 3GPP TS 23.060 [5]. When receiving a Service Request message from the UE, the MME/S4-SGSN shall perform the SGW restoration procedure as specified in the clause 27.2.2 with the addition that the MME/S4-SGSN shall include the MME/S4-SGSN identifier IE in the create session request message.\nDuring normal mode of operation (i.e. before SGW failure with/without restart):\nThe SGW shall forward the MME/S4-SGSN identifier IE to the PGW in existing signalling over the S5 interface if it is received over S11/S4 interface.\nDuring SGW restoration procedure:\nUpon receipt of a PGW Downlink Triggering Notification message (or a PMIP Update Notification message with the Notification Reason set to \"PGW Downlink Trigger Notification\") from a PGW, the SGW shall send the PGW Downlink Triggering Notification message to the MME/S4-SGSN identified by the MME/S4-SGSN identifier if present in the message. If no MME/S4-SGSN identifier is received from the PGW, the SGW shall send the PGW Downlink Triggering Notification message to all the MME/S4-SGSN within the MME/S4-SGSN pool as known by local configuration. The SGW shall then send a PGW Downlink Triggering Acknowledge message (or a PMIP Update Notification Acknowledgement message) back to the PGW with an acceptance cause code.\nIf the SGW receives a PGW Downlink Triggering Acknowledge message from an MME/S4-SGSN with the rejection cause code \"Context Not Found\" and with an IMSI and an MME/S4-SGSN identifier, the SGW shall then send a PGW Downlink Triggering Notification message, including the IMSI (as received in the PGW Downlink Triggering Acknowledge message), to all the MME/S4-SGSN within the MME/S4-SGSN pool as known by local configuration, except to the MME/S4-SGSN identified by the MME/S4-SGSN identifier received in the Downlink Triggering Acknowledge message.\nThe MME/S4-SGSN may have more than one IP address on the S11/S4 interface configured, but the PGW Downlink Triggering Notification should be sent only once per MME/S4-SGSN per local configuration in the SGW.\nDuring normal mode of operation (i.e. before SGW failure with/without restart):\nThe PGW shall store the MME/S4-SGSN identifier received in the last Create Session Request or Modify Bearer Request message (for GTP based S5) or Proxy Binding Update (for PMIP based S5) per PDN connection. If the PGW receives a Modify Bearer Request without MME/SGSN identifier, it shall delete the stored MME/S4-SGSN identifier.\nNOTE 1:\tThis allows the PGW to have the serving MME/S4-SGSN address whenever there is S5 signalling message. However this cannot ensure that the PGW is always aware of the current serving MME/S4-SGSN address. E.g. during an inter-MME HO without SGW change, the current serving MME/S4-SGSN address will not be propagated to the PGW if there is no S5 signalling.\nDuring SGW restoration procedure:\nWhen downlink data packets or signalling other than an IP-CAN Session Termination Request arrives at the PGW, for a PDN connection associated with a failed SGW and that has not been restored yet (as specified in clause 27.2.2), and the PDN connection is eligible for PGW initiated Downlink triggering based on operator's policies, e.g. for IMS PDN connection, the PGW shall proceed as follows:\n-\tthe PGW shall select a SGW (i.e. the restarted or an alternative SGW) which supports the PGW triggered SGW restoration procedure, based on local configuration;\n-\tfor GTP-based S5, the PGW shall then send a PGW Downlink Triggering Notification message including the IMSI and the MME/S4-SGSN identifier if available;\n-\tfor PMIP-based S5, the PGW shall then send an PMIP Update Notification message as specified in IETF RFC 7077 [26] to indicate it is a PGW initiated downlink triggering notification, including the IMSI and the MME/S4-SGSN Identifier when it is available;\n-\tthe PGW should not send a new PGW Downlink Triggering Notification message (for GTP-based S5) or Update Notification message (for PMIP-based S5) in very short time if it continues to receive subsequent downlink data or signalling for the same PDN connection. It is an implementation option how many times/how frequently the PGW should send subsequent PGW Downlink Triggering Notification message (for GTP-based S5) or Update Notification message (for PMIP-based S5) before discarding the downlink packets or rejecting signalling.\n-\tthe PGW shall handle an IP-CAN Session Modification Request received from the PCRF  as specified in clause B.3.14 of 3GPP TS 29.212 [25] as if the PDN connection had not been affected by the SGW failure i.e. was in a normal state . After accepting an IP-CAN session modification request, if the MME/S4-SGSN does not restore the PDN connection shortly after the PGW initiated triggering, the PGW shall report the modification failure to the PCRF with a cause as specified in clause B.3.14 of 3GPP TS 29.212 [25].\nThe PGW shall behave as specified in clause 27.2.2.3 if the PGW receives an IP-CAN Session Termination Request for a PDN connection associated with a failed SGW and that has not been restored yet.\nNOTE 2:\tTo ensure the delivery of downlink data, it is implementation specific whether the PGW buffers or not the downlink data until the PDN connection is restored. The application functions e.g. P-CSCF for IMS, may also retransmit the data packets.\nNOTE 3:\tThe operator policies for PDN connections eligible for restoration (i.e. to be maintained upon SGW failure as per clause 27.2.2) and PDN connections eligible for PGW initiated downlink triggering may differ, i.e. the PDN connections eligible for PGW initiated downlink triggering may be a subset of the PDN connections eligible for restoration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "27.3\tRestoration of PDN connections after an SGW failure for UEs with ISR",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "27.3.1\tMME/S4-SGSN triggered SGW restoration for UEs with ISR",
                            "text_content": "The requirement specified in clause 27.3.1.2 shall apply on top of the MME/S4-SGSN triggered SGW restoration procedure specified in clause 27.2.2 and the involved MME and S4-SGSN additionally support the ISR feature.\nNOTE:\tThe procedure in this clause does not consider the case where one of ISR associated nodes, i.e. the MME or the S4-SGSN, does not support the MME/S4-SGSN triggered SGW restoration procedure.\nThe MME/S4-SGSN shall restore the PDN connections of the affected UEs after the SGW failure as follows:\n1)\tfor UEs initiating an intra MME/S4-SGSN TAU/RAU procedure:\n-\tthe MME/S4 SGSN shall perform the SGW relocation procedure as specified in clause 27.2.2, and inform the UE in the related TAU/RAU Accept message to disable ISR as specified in 3GPP TS 23.401[15] and 3GPP TS 23.060 [5].\n2)\tfor UEs in ECM-IDLE/PMM-IDLE/GPRS STANDBY state initiating a Service Request procedure:\n-\tthe MME/S4 SGSN shall perform the SGW relocation procedure as specified in clause 27.2.2 and initiate the GUTI Relocation or P-TMSI Relocation procedure with a non-broadcast TAI or RAI to force the UE to perform the TAU/RAU procedure for ISR deactivation.\n3)\tfor UEs in ECM-CONNECTED/PMM-CONNECTED/GPRS READY state engaged in any handover or inter MME/S4-SGSN TAU/RAU procedure:\n-\tit shall be handled as specified in clause 27.2.2.\n4)\tfor UEs in ECM-IDLE/PMM-IDLE/GPRS STANDBY state which are not engaged in any Service Request or other mobility procedure:\n-\tIn networks supporting PGW triggered SGW restoration proactive paging of UEs in ECM-IDLE/PMM-IDLE/GPRS STANDBY state shall not be initiated.\nThe MME/S4-SGSN shall page the UE to bring the UE to ECM-CONNECTED/PMM-CONNECTED. If the paging is successful and the UE initiates the Service Request procedure, the MME/S4-SGSN shall perform the SGW relocation procedure as specified in clause 27.2.2 and initiate the GUTI Relocation or P-TMSI Relocation Procedure with a non-broadcast TAI or RAI to force the UE to perform the TAU/RAU procedure for ISR deactivation as specified in clause 5.3.4.3 of 3GPP TS 23.401[15]. If paging the UE fails, the MME or S4-SGSN should adjust its paging retransmission strategy (e.g. limit the number of short spaced retransmissions) to take into account the fact that the UE might be in GERAN/UTRAN or E-UTRAN coverage. If the associated MME/S4-SGSN receives ISR Status Indication with \"deactivation Indication\" from S4-SGSN/MME, the MME/S4-SGSN shall release the UE session locally. Otherwise after retrying the paging procedure, the MME/S4-SGSN may release locally the PDN connection context and UE MM context assuming the UE is in GERAN/UTRAN or E-UTRAN coverage area.\nMME/S4-SGSN should handle UEs in ECM-CONNECTED/PMM-CONNECTED and involved in any handover or inter MME/S4-SGSN TAU/RAU procedure first before paging of UEs in ECM-IDLE/PMM-IDLE/GPRS STANDBY to minimise paging of UEs. Furthermore the sequence on how UEs in ECM-IDLE/PMM-IDLE/GPRS STANDBY can be paged to avoid overload are implementation dependent.\nThe MME/S4-SGSN which initiates the SGW restoration procedure should send ISR Status Indication with \"ISR deactivation Indication\" to the ISR associated S4-SGSN/MME to release the PDN connection context and UE MM context.\nNOTE 1:\tThe PDN connection context and UE MM context can be released after the timer (T-Release-PDN timer), which is used for maintaining the context, expires, as specified in clause 27.2.2.1.\nNOTE 2:\tThe MME will only perform the SGW reselection for the UEs camping on the LTE, ISR activated UEs can camp in the GERAN/UTRAN, so paging is needed.\nThe S4-SGSN will only perform the SGW reselection for the UEs camping on the GERAN/UTRAN, ISR activated UEs can camp in the LTE, so paging is needed.\nNOTE 3:\tIt is the responsibility of the MME/S4-SGSN to avoid Paging Overload.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "27.3.2\tPGW triggered SGW restoration for UEs with ISR",
                            "text_content": "The requirement specified in clause 27.3.2.2 shall apply on top of the PGW triggered SGW restoration procedure specified in clause 27.2.3 and the involved MME and S4-SGSN additionally support the ISR feature.\nNOTE:\tThe procedure in this clause does not consider the case where one of ISR associated nodes, i.e. the MME or the S4-SGSN, does not support the PGW triggered SGW restoration procedure.\nIf the MME/S4-SGSN receives a PGW Downlink Triggering Notification message containing MME/S4-SGSN Identifier from the SGW for those UEs affected by the failed SGW, the MME/S4-SGSN shall behave as specified in clause 27.2.3.2 and additionally send ISR Status Indication message with \"Paging Indication\" over the S3 interface to the ISR associated S4-SGSN/MME over the existing GTP-C tunnel between the S4-SGSN and the MME.\nThe ISR associated S4-SGSN/MME, which receives ISR Status Indication message with \"Paging Indication\", shall perform P-TMSI/S-TMSI paging as part of the Network Initiated Service Request procedure as specified in clause 27.3.1.2.\nAfter the MME/S4-SGSN receiving NAS message Service Request, the MME/S4-SGSN shall behave as specified in the clause 27.3.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "28\tRestoration of data in the CSS",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "28.1\tRestart of the CSS",
                    "description": "",
                    "summary": "",
                    "text_content": "The periodic backup of CSS data to non-volatile storage is mandatory.\nWhen a CSS restarts after failure it shall perform the following actions for the subscriber data records that have been affected by the CSS fault:\n-\treload all data from the non-volatile back-up;\n-\tsend a \"Reset\" message to each VLR where one or more of its MSs may be registered to the CSS. This causes each VLR concerned to mark each relevant roaming user record \"Location Information Not Confirmed by CSS\", and\n-\tsend a \"Reset\" message to each SGSN where one or more of its MSs may be registered to the CSS. This causes each SGSN to mark each relevant MM context \"Location Information Not Confirmed by CSS\".\n-\tsend a \"Reset\" message to each MME where one or more of its UEs may be registered to the CSS.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "29\tMBMS Heartbeat procedure",
            "description": "The BM-SC, MBMS GW and GCS AS may support the MBMS Heartbeat procedure over the SGmb or MB2-C reference point to probe the liveliness and detect the restart of a peer MBMS node.\nThis procedure is optional to support and use for MBMS deployments without an intermediate Diameter Agent between the BM-SC and the MBMS GW or GCS AS. A BM-SC, MBMS GW or GCS AS which support the MBMS restoration procedures as specified in this specification shall support and use the MBMS Heartbeat procedure for MBMS deployments with an intermediate Diameter Agent between the BM-SC and MBMS GW or GCS AS.\nThe restart of a peer MBMS node is detected using a Restart-Counter AVP. The Restart-Counter AVP contains a value that is incremented monotonically whenever the MBMS node restarts with loss of previous states.\nThe MBMS Heartbeat Request and Answer messages shall contain the Restart-Counter AVP set to the local restart counter of the sending node. Other MBMS messages sent over the SGmb or MB2-C reference point may also contain the Restart-Counter AVP if contacting the peer node for the first time or if the local restart counter has been incremented.\nUpon receipt of a Restart-Counter AVP in a MBMS Heartbeat Request or Answer or in any other SGmb or MB2-C signalling message, the receiving node shall compare the value of the received Restart-Counter AVP with the previous Restart counter value stored for this peer entity and\n-\tif no previous value was stored, the Restart counter value received in the SGmb or MB2-C signalling message shall be stored for the peer;\n-\tif the value of the received Restart-Counter AVP is greater than the Restart-Counter previously received from the same MBMS node, the receiver shall consider that the peer MBMS node has restarted.\nAn intermediate Diameter Agent shall not modify the Restart-Counter AVP when proxying SGmb or MB2-C signalling between the BM-SC and MBMS GW or GCS  AS.\nThe BM-SC, MBMS GW and GCS AS shall support the detection of an SGmb or MB2-C path failure by sending an MBMS Heartbeat Request message periodically when no other signalling is exchanged over those interfaces between those nodes. The MBMS Heartbeat Request message shall be repeated one or more times if no MBMS Heartbeat Answer is received. The SGmb or MB2-C path shall be considered to be down if the peer MBMS node does not respond to a configured number of consecutive MBMS Heartbeart Requests. MBMS Heartbeat Requests shall only be sent on a per node basis (i.e. not on a per MBMS session basis).\nSee 3GPP TS 29.061 [31] and 3GPP TS 29.468 [35] for further details.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "30\tRestoration of the SCEF",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "30.1\tRestart of the SCEF",
                    "description": "",
                    "summary": "",
                    "text_content": "When an SCEF restarts after failure and has lost all or parts of his data, it shall reply to a report from MME, SGSN or HSS containing a SCEF reference ID for which it has no data with an error cause \"SCEF_REFERENCE_ID_UNKNOWN\" in the reply indicating that the SCEF reference ID provided in the message does not exist in the SCEF.\nIf an HSS receives a reply message with error cause set to \"SCEF_REFERENCE_ID_UNKNOWN\", it shall stop reporting and delete the event localy.\nIf an MME/SGSN receives reply message with error cause set to \"SCEF_REFERENCE_ID_UNKNOWN\", it shall stop reporting, initiate a notification to the HSS with cause \"SCEF_REFERENCE_ID_UNKNOWN\" and delete the event.\nAn HSS receiving a notification with cause \"SCEF_REFERENCE_ID_UNKNOWN\", it shall delete the event localy.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "30.1.1\tMobile Originated NIDD procedure",
                            "text_content": "During the Mobile Originated NIDD procedure, if the MME receives a MO-Data-Answer from the SCEF with a failure cause that UE cannot be found, the MME shall deactivate the corresponding PDN connection towards the UE with the cause \"re-activation required\", or initiate an explicit detach procedure with reattached required procedure, as appropriate, see 3GPP TS 24.301 [19].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "31\tRestoration of PDN connections after a PGW-C/SMF change",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "31.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedure specified in this clause enables to restore in the EPC the PDN connections affected by an PGW-C/SMF failure with or without restart or scale-in operation, and thus to maintain the UE connectivity to the PDN and corresponding services with minimum service interruption and minimal signalling in the network (e.g. no signalling wih the UE).\nThe procedure specified in this clause is optional to support for the MME, ePDG supporting S2b over GTPv2, SGW and PGW-C/SMF.\nThis procedure applies for combo PGW-C/SMF that are deployed in an PGW-C/SMF set (i.e. a set of PGW-C/SMF instances that are functionally equivalent and inter-changeable and that share the same contexts, see clause 5.21.3 of 3GPP TS 23.501 [45]).\nIn scenarios where a PGW-C/SMF becomes no longer available (e.g. PGW-C/SMF failure without restart, scale-in operation causing a PGW-C/SMF to be de-instantiated from the PGW-C/SMF set) or that require to change the PGW-C/SMF of a PDN connection, other PGW-C/SMFs from the same PGW-C/SMF set may take over the control of the PDN connections that were served by the PGW-C/SMF that is no longer available. When a PGW-C/SMF fails with restart, the restarted PGW-C/SMF should continue supporting the same PDN connections, if possible. When a PGW-C/SMF of a PGW-C/SMF set fails with or without restart, the Recovery (Restart Counter) shall not be incremented over S5/S8 (assuming the PDN connection context is still available in the PGW-C/SMF set).\nThe restoration of a PDN connection may be triggered by the MME (e.g. when the SGW detects and reports to the MME that the PGW-C has failed) or by the ePDG supporting S2b over GTPv2, or by the PGW-C/SMF (e.g. scale-in operation or PGW-C/SMF reselection by another network function such as PCF).\nThe procedure supports the restoration of Home Routed PDN connections, if the VPLMN and HPLMN support this procedure. If the VPLMN or HPLMN does not support this procedure, the existing behaviour applies, e.g. the MME and SGW clears all PDN connections of the PGW-C/SMF when detecting the failure or restart of the PGW-C/SMF and the MME may request UEs to release and reactivate some PDN connections (e.g. IMS PDN connections).\nClause 31.6 defines procedures to enable to restore a set of PDN connections affected by a PGW-C/SMF failure with or without restart, or scale-in operation, associated with specific FQ-CSIDs, Group IDs or PGW-C/SMF IP addresses.\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "31.2\tPDN connection establishment or mobility to EPC",
                    "description": "",
                    "summary": "",
                    "text_content": "The PDN connection shall be established as defined in 3GPP TS 23.401 [15] with the following additions.\nFigure 31.2-1 illustrates the process of establishing a Point-to-Point (P2P) connection over a Passive Optical Network (PDN). The figure depicts the connection setup between two network nodes, with the use of a passive optical line. The process begins with the initiation of a P2P connection request by one of the nodes, which is then acknowledged by the other node. The figure shows the establishment of a point-to-point link over the passive optical line, with the use of a wavelength division multiplexer (WDM) to enable simultaneous transmission of multiple wavelengths. The figure also shows the use of a passive optical line amplifier (OLA) to increase the signal strength and improve the overall performance of the connection. Overall, the figure provides a clear and concise representation of the process of establishing a P2P connection over a PDN.\nFigure 31.2-1: PDN connection establishment\n1.\tDuring the PDN connection establishment or when a PDU session is moved from 5GS to EPS without the N26 interface or from EPC/ePDG to EPS, the MME may signal in the Create Session Request that it supports this procedure by settingthe Restoration of PDN connections after an PGW-C/SMF Change Support Indication in the Indication Flags IE. If the SGW also supports this feature, it shall relay this indication towards the PGW.\n2.\tIf the Create Session Request indicates support of this procedure and the PGW supports the Restoration of PDN connections after a PGW-C/SMF change procedure specified in clause 31, the PGW-C/SMF shall return a PGW Change Info IE in the Create Session Response, that the SGW shall relay transparently towards the MME. The PGW Change Info IE shall contain the PGW Set FQDN or Alternative PGW-C/SMF FQDN or IP Addresses of PGW/SMFs in the set. Receipt of this information indicates to the MME that this procedure is supported by the SGW and PGW-C/SMF for the PDN connection and that alternative PGW-C/SMF instances may be found using the PGW Set FQDN or the Alternative PGW FQDN or IP addresses, if the PGW-C/SMF becomes no longer reachable.\nLikewise, a PDU session shall be moved from 5GS to EPS with the N26 interface as defined in clause 4.11 of 3GPP TS 23.502 [46] with the following additions:\n-\tthe MME may signal that it supports this procedure by setting the Restoration of PDN connections after an PGW-C/SMF Change Support Indication in the Indication Flags IE in:\n-\tthe Create Session Request during 5GS to EPS Idle mode mobility using N26 interface (see clause 4.11.1.3.2 of 3GPP TS 23.502 [46]); and\n-\tin the Modify Bearer Request during an 5GS to EPS handover using N26 interface (see clause 4.11.1.2.1 of 3GPP TS 23.502 [46]);\n-\tIf the SGW also supports this feature, it shall relay this indication in the Modify Bearer Request towards the PGW;\n-\tIf the Modify Bearer Request received by the PGW-C/SMF indicates support of this procedure and the PGW supports the Restoration of PDN connections after a PGW-C/SMF change procedure specified in clause 31, the PGW-C/SMF shall return a PGW Change Info IE (with the same content as described above) in the Modify Bearer Response, that the SGW shall relay transparently towards the MME. This provides the same indication as described above to the MME.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "31.2A\tPDN connection establishment or mobility to EPC/ePDG",
                    "description": "",
                    "summary": "",
                    "text_content": "The PDN connection shall be established as defined in clause 7.2.4 of 3GPP TS 23.402 [18] with the following additions.\nFigure 31.2A-1 illustrates the process of PDN connection establishment, which involves the establishment of a Point-to-Point (P2P) connection between two network elements. The figure depicts the initial stages of connection setup, where a request is sent from the client device to the Access Gateway (AGW). The AGW then forwards the request to the Access Network Controller (ANC), which is responsible for managing the connection. The ANC evaluates the request and, if approved, initiates the connection process. This includes the establishment of a virtual tunnel interface (VTI) and the allocation of a unique identifier for the connection. Once the connection is established, the client device can communicate with the remote network element securely and efficiently. The figure highlights the importance of a well-structured and secure connection setup in modern network infrastructure.\nFigure 31.2A-1: PDN connection establishment\n1.\tDuring the PDN connection establishment or when a PDU session is moved from 5GS or EPS to EPC/ePDG, the ePDG may signal in the Create Session Request that it supports this procedure by setting the Restoration of PDN connections after an PGW-C/SMF Change Support Indication in the Indication Flags IE.\n2.\tIf the Create Session Request indicates support of this procedure and the PGW supports the Restoration of PDN connections after a PGW-C/SMF change procedure specified in clause 31, the PGW-C/SMF shall return a PGW Change Info IE in the Create Session Response. The PGW Change Info IE shall contain the PGW Set FQDN or Alternative PGW-C/SMF FQDN or IP Addresses of PGW/SMFs in the set. Receipt of this information indicates to the ePDG that this procedure is supported by PGW-C/SMF for the PDN connection and that alternative PGW-C/SMF instances may be found using the PGW Set FQDN or the Alternative PGW FQDN or IP addresses, if the PGW-C/SMF becomes no longer reachable.\nLikewise, a PDU session shall be moved from 5GS to EPC/ePDG as defined in clause 4.11.4 of 3GPP TS 23.502 [46] with the following additions:\n-\tthe ePDG may signal that it supports this procedure by setting the Restoration of PDN connections after an PGW-C/SMF Change Support Indication in the Indication Flags IE in the Create Session Request during handover from 5GS to EPC/ePDG (see clause 4.11.4.2 of 3GPP TS 23.502 [46]); and\n-\tIf the Create Session Request received by the PGW-C/SMF indicates support of this procedure and the PGW supports the Restoration of PDN connections after a PGW-C/SMF change procedure specified in clause 31, the PGW-C/SMF shall return a PGW Change Info IE (with the same content as described above) in the Create Session Response to provides the same indication as described above to the ePDG.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "31.3\tMME triggered PDN connection restoration",
                    "description": "",
                    "summary": "",
                    "text_content": "The MME may trigger a PDN connection restoration to move the PDN connection to a different PGW-C/SMF in the same PGW-C/SMF Set, e.g. when detecting that the PGW-C/SMF currently serving the PDN connection is not reachable, as defined in this clause.\nThe MME may trigger this procedure for a specific PDN connection, e.g. upon receiving a Modify Bearer Response message for this PDN connection with the cause code set to \"Remote peer not responding\", or for all PDN connections served by a PGW-C/SMF, e.g. when receiving a PGW Restart Notification from the SGW with the cause \"PGW not responding\" or when the MME determines that the PGW-C/SMF has failed.\nFigure 31.3-1 illustrates the process of Mobile Switching Center (MSC) triggering a Packet Data Network (PDN) connection restoration in a mobile communication system. The figure depicts the interaction between the Mobile Equipment (ME) and the Mobile Network Operator (MNO) through the Mobile Switching Center (MSC). The MME, which is responsible for managing the PDN connection, initiates the restoration process when a service interruption occurs. The figure shows the various signaling messages exchanged between the MME and the PDN Gateway (PGW) to ensure a seamless and efficient restoration of the connection. The diagram highlights the importance of real-time communication and coordination between the MME and the MNO in maintaining a reliable and uninterrupted mobile communication experience for the user.\nFigure 31.3-1: MME triggered PDN connection restoration\n1.\tThe PGW-C/SMF fails without restart from the PGW-C/SMF set.\n2a-2b.\tThe MME sends a Modify Bearer Request message to the SGW, e.g., to report a User Location Information change, the SGW shall respond with the Modify Bearer Response message with the cause code set to \"Remote peer not responding\" when the SGW detects that the PGW-C/SMF is not responding.\n2c.\tWhen detecting that the PGW-C/SMF has failed, the SGW-C shall send a PGW Restart Notification to the MME as specified in clause 16.1A.2.\n\nWhen detecting that a PGW-C/SMF has failed, the SGW-C and MME shall maintain the contexts of the PDN connections served by that PGW-C/SMF for which this procedure is supported.\n3.\tThe MME should select an alternative PGW-C/SMF using the PGW Change Info received earlier from the PGW-C/SMF for the PDN connection (for the scenario described as step 2a-2b) or for all PDN connections associated with the failed PGW (for the scenario described as step 2c).\n4.\tThe MME shall send a Create Session Request including a PGW Change Indication and without setting the Operation Indication to \"1\" towards the newly selected PGW-C/SMF, via the same or a different SGW. The MME may defer doing so until it needs to send signalling to the SGW or PGW-C. The MME should reuse the same SGW if possible, since the PDN connection restoration remains then transparent to the eNodeB. The PGW Change Indication tells the SGW and PGW-C/SMF that this is a request to move an existing PDN connection to the new PGW-C/SMF.\n5.\tThe new PGW-C/SMF shall identify the PDN connection context using the UE's identity (i.e. IMSI or IMEI) and the Linked EPS Bearer Identity received in the Create Session Request. If it can take over the PDN connection, it shall return a Create Session Response towards the SGW and MME (including, among others, the new S5/S8 PGW F-TEID for control plane, its PGW node name and S5/S8 PGW F-TEIDs). The PGW-C/SMF shall not change the UE's IP address.\nThe SGW and MME shall update their PDN connection context with the information received from the PGW-C/SMF. Any subsequent control plane procedure between the MME, SGW and PGW shall take place as defined in existing procedures.\n\nIf the MME reselected a different SGW, the MME shall update the eNB with the new SGW's S1-U F-TEID using the MME triggered Serving GW relocation procedure (see clause 5.10.4 of 3GPP TS 23.401 [15]).\n6.\tThe MME shall update the PGW identity in the HSS. Upon detecting that the association between APN and PGW-C/SMF FQDN is changed, if an active subscription from the UDM exists for the UE to be notified on the change of the data, the HSS shall notify the UDM as specified in Figure 5.3.4-5 of clause 5.3.4 of 3GPP TS 23.632 [47].\nNOTE 1:\tAn active subscription from the UDM can exist e.g. to notify the AMF registered for the UE for non-3GPP access.\nNOTE 2:\tThe PDN connection restoration procedure specified in this clause does not require any specific handling from the HSS and UDM.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "31.3A\tePDG triggered PDN connection restoration",
                    "description": "",
                    "summary": "",
                    "text_content": "The ePDG supporting S2b over GTPv2 may trigger a PDN connection restoration to move the PDN connection to a different PGW-C/SMF in the same PGW-C/SMF Set, e.g. when detecting that the PGW-C/SMF currently serving the PDN connection is not reachable, as defined in this clause.\nThe ePDG may trigger this procedure for a specific PDN connection, e.g. upon receiving no response to a request message for this PDN connection, or for all PDN connections served by a PGW-C/SMF, e.g. when the ePDG determines that the PGW-C/SMF has failed.\nFigure 31.3A-1 illustrates the process of ePDG (Enhanced Packet Data Gateway) triggered PDN (Packet Data Network) connection restoration. The figure depicts the various steps involved in the restoration process, starting with the initial loss of connectivity. The ePDG then takes action to restore the connection, utilizing techniques such as rerouting and load balancing to ensure optimal performance. The figure also shows the role of the network elements involved, including the ePDG, PDN, and other relevant components. The diagram provides a clear overview of the complex process involved in restoring connectivity in a network environment.\nFigure 31.3A-1: ePDG triggered PDN connection restoration\n1.\tThe PGW-C/SMF fails without restart from the PGW-C/SMF set.\n2.\tThe ePDG detects that the PGW-C/SMF has failed as specified in clause 20.1.\n\nWhen detecting that a PGW-C/SMF has failed, the ePDG shall maintain the contexts of the PDN connections served by that PGW-C/SMF for which this procedure is supported.\n3.\tThe ePDG should select an alternative PGW-C/SMF using the PGW Change Info received earlier from the PGW-C/SMF.\n4.\tThe ePDG shall send a Create Session Request including a PGW Change Indication towards the newly selected PGW-C/SMF. The ePDG may defer doing so until it needs to send signalling to the PGW-C. The PGW Change Indication tells the PGW-C/SMF that this is a request to move an existing PDN connection to the new PGW-C/SMF.\n5.\tThe new PGW-C/SMF shall identify the PDN connection context using the UE's identity (i.e. IMSI or IMEI) and the Linked EPS Bearer Identity received in the Create Session Request. If it can take over the PDN connection, it shall return a Create Session Response towards the ePDG (including, among others, the new S5/S8 PGW F-TEID for control plane, its PGW node name and S2b PGW F-TEIDs). The PGW-C/SMF shall not change the UE's IP address.\nThe ePDG shall update their PDN connection context with the information received from the PGW-C/SMF. Any subsequent control plane procedure between the ePDG and PGW shall take place as defined in existing procedures.\n6.\tThe new PGW-C/SMF shall update the PGW identity in the 3GPP AAA Server, and the 3GPP AAA server will further populate the PGW identity to the HSS as specified in clause 12.1.4 of 3GPP TS 23.402 [18]. The new PGW-C/SMF shall update the PGW identity to the UDM as specified in clause 4.11.4.3.6 of 3GPP TS 23.502 [46] if S6b is not deployed between SMF+PGW-C and 3GPP AAA Server.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "31.4\tPGW triggered PDN connection restoration",
                    "description": "",
                    "summary": "",
                    "text_content": "The PGW-C/SMF currently supporting a PDN connection, or a new PGW-C/SMF from the same PGW-C/SMF set, may trigger a PDN connection restoration to move the PDN connection to a different PGW-C/SMF as defined in this clause.\nThis may happen e.g. when a PGW-C/SMF is de-instantiated (scale-in operation), or when a new PGW-C/SMF from the same PGW-C/SMF set is reselected for the PDN connection upon a request from the PCF or the PGW-U/UPF and, more generally, when the PGW-C/SMF supporting a PDN connection is no longer available and a new PGW-C/SMF of the same PGW-C/SMF set needs to send signalling to the SGW or MME, before the MME has triggered a PDN connection restoration.\nFigure 31.4-1 illustrates the process of PGW (Policy and Charging Gateway) triggered PDN (Packet Data Network) connection restoration. The figure depicts the various steps involved in the restoration process, starting with the triggering event that leads to the restoration. The PGW plays a crucial role in this process, as it is responsible for managing and controlling the restoration process. The figure also shows the interaction between the PGW and the various components of the network, including the PDN, the service provider network, and the customer premises equipment. The figure provides a clear and concise overview of the process, highlighting the key components and their interactions, and serves as a useful reference for understanding the process of PDN connection restoration.\nFigure 31.4-1: PGW triggered PDN connection restoration\n1.\tThe PGW-C/SMF currently supporting the PDN connection or another PGW-C/SMF from the same PGW-C/SMF set determines that the PDN connection needs to be moved to a different PGW-C/SMF, e.g. during a PGW-C/SMF set scale-in operation, or e.g. due to PCF or PGW-U/UPF reselecting an alternative PGW-C/SMF from the same PGW-C/SMF set due to the PGW-C/SMF serving the PDN connection being unavailable and this triggers bearer signalling towards the MME.\n2 or 3.\tThe PGW-C/SMF currently supporting the PDN connection or the new PGW-C/SMF taking over the PDN connection may send an Update Bearer Request for the default bearer towards the SGW immediately or send Create Bearer Request (or a Update Bearer Request or a Delete Bearer Request) when the PGW-C/SMF needs to send this signalling towards the SGW and MME, including the PGW Change Info IE. The SGW shall relay transparently the PGW Change Info IE towards the MME. The PGW Change Info IE shall contain the new S5/S8 PGW IP address for control plane. The PGW-C/SMF may also include the Sender F-TEID for Control Plane IE containing a new S5/S8 PGW F-TEID for control plane. The Create/Update/Delete Bearer Response message shall be sent over S5/S8 using the S5/S8 PGW TEID for control plane received in the Sender F-TEID for Control Plane IE, if any, otherwise using the S5/S8 PGW TEID for control plane earlier assigned to the PDN connection.\nNOTE 1:\tThe MME and SGW need not know whether the Create/Update/Delete Bearer Request is originated by the same (step 2a) or a new (step 2b) PGW-C/SMF from the PGW-C/SMF Set.\nNOTE 2:\tWhen establishing a PDN connection with a PGW-C/SMF of a PGW-C/SMF set, the PGW S5/S8 TEID for control plane that the PGW-C/SMF assigns in the PGW S5/S8 F-TEID for control plane needs not be unique within the PGW-C/SMF set. When the Create/Update/Delete Bearer Request is originated by the new PGW-C/SMF (step 2b), the new PGW-C/SMF can provide a new S5/S8 PGW F-TEID for control plane in the Sender F-TEID for Control Plane IE including the TEID with which it expects to receive the Create/Update/Delete Bearer Response. This new S5/S8 PGW F-TEID for control plane can be a same or different F-TEID than the S5/S8 PGW F-TEID for control plane assigned in the subsequent Create Session Response in step 5.\n4.\tSame as step 4 of Figure 31.3-1, with the MME including in the Create Session Request the new S5/S8 PGW-C/SMF IP address received in the PGW Change Info.\n5.\tSame as step 5 of Figure 31.3-1.\n6.\tSame as step 6 of Figure 31.3-1.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "31.4A\tCombined SGW-C/PGW-C/SMF triggered PDN connection restoration",
                    "description": "",
                    "summary": "",
                    "text_content": "A combined SGW-C/PGW-C/SMF currently supporting a PDN connection, or a new SGW-C/PGW-C/SMF from the same SGW-C/PGW-C/SMF set, may trigger a PDN connection restoration to move the PDN connection to a different SGW-C/PGW-C/SMF as defined in clause 31.4 with the following addition:\n-\tIn step 2, the (new) SGW-C/PGW-C/SMF may include a New S11 SGW-C IP Address IE in the PGW Change Info IE to request the MME to send a Create Session Request message towards the new S11 SGW-C IP address, so to enable to reuse the existing PFCP session and avoid extra signalling towards RAN to update uplink TEID at the user plane function. The (new) SGW-C/PGW-C/SMF may also include the Sender F-TEID for Control Plane IE containing a new S11 SGW-C F-TEID for control plane.\n-\tIn steps 3a and 3b, the Create/Update/Delete Bearer Response message shall be sent over S11 using the new S11 SGW-C TEID for control plane received in the Sender F-TEID for Control Plane IE, if any, otherwise using the S11 SGW-C TEID for control plane earlier assigned to the UE context.-\tIn step 4, the MME should send the Create Session Request message towards the SGW as indicated in the New S11 SGW-C IP Address IE in the PGW Change Info IE.\nNOTE:\tThe MME can still select a new SGW other than as indicated by the New SGW-C IP Address IE when the MME determines that that SGW is more suitable for the UE e.g. based on the local policies and UE location.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "31.4B\tPGW triggered PDN connection restoration towards ePDG",
                    "description": "",
                    "summary": "",
                    "text_content": "The PGW-C/SMF currently supporting a PDN connection, or a new PGW-C/SMF from the same PGW-C/SMF set, may trigger a PDN connection restoration to move the PDN connection to a different PGW-C/SMF as defined in this clause.\nThis may happen e.g. when a PGW-C/SMF is de-instantiated (scale-in operation), or when a new PGW-C/SMF from the same PGW-C/SMF set is reselected for the PDN connection upon a request from the PCF or the PGW-U/UPF and, more generally, when the PGW-C/SMF supporting a PDN connection is no longer available and a new PGW-C/SMF of the same PGW-C/SMF set needs to send signalling to the ePDG, before the ePDG has triggered a PDN connection restoration.\nFigure 31.4B-1 illustrates the process of a Public Gateway (PGW) triggering a Policy-Based Network (PBN) connection restoration towards an ePDG (Edge Policy Decision Gateway). The figure depicts the interaction between the PGW, ePDG, and various network elements such as the Policy Decision Point (PDP), Policy and Charging Rules Function (PCRF), and the Packet Data Network (PDN). The PGW initiates the connection restoration process, which involves checking the PDN connection status, policy evaluation, and the establishment of a new connection towards the ePDG. The figure highlights the importance of these network elements in ensuring efficient and secure connectivity, as well as the role of policy-based management in managing and maintaining network resources.\nFigure 31.4B-1: PGW triggered PDN connection restoration towards ePDG\n1.\tThe PGW-C/SMF currently supporting the PDN connection or another PGW-C/SMF from the same PGW-C/SMF set determines that the PDN connection needs to be moved to a different PGW-C/SMF, e.g. during a PGW-C/SMF set scale-in operation, or e.g. due to PCF or PGW-U/UPF reselecting an alternative PGW-C/SMF from the same PGW-C/SMF set due to the PGW-C/SMF serving the PDN connection being unavailable and this triggers bearer signalling towards the ePDG.\n2 or 3.\tThe PGW-C/SMF currently supporting the PDN connection or the new PGW-C/SMF taking over the PDN connection may send an Update Bearer Request for the default bearer towards the ePDG immediately or send Create Bearer Request (or a Update Bearer Request or a Delete Bearer Request) when the PGW-C/SMF needs to send this signalling towards the ePDG, including the PGW Change Info IE. The PGW Change Info IE shall contain the new S2b PGW IP address for control plane. The PGW-C/SMF may also include the Sender F-TEID for Control Plane IE containing a new S2b PGW F-TEID for control plane. The Create/Update/Delete Bearer Response message shall be sent over S2b using the new S2b PGW TEID for control plane received in the Sender F-TEID for Control Plane IE, if any, otherwise using the S2b PGW TEID for control plane earlier assigned to the PDN connection.\nNOTE 1:\tThe ePDG needs not know whether the Create/Update/Delete Bearer Request is originated by the same (step 2a) or a new (step 2b) PGW-C/SMF from the PGW-C/SMF Set.\nNOTE 2:\tWhen establishing a PDN connection with a PGW-C/SMF of a PGW-C/SMF set, the PGW S2b TEID for control plane that the PGW-C/SMF assigns in the PGW S2b F-TEID for control plane needs not be unique within the PGW-C/SMF set. When the Create/Update/Delete Bearer Request is originated by the new PGW-C/SMF (step 2b), the new PGW-C/SMF can provide a new S2b PGW F-TEID for control plane in the Sender F-TEID for Control Plane IE including the TEID with which it expects to receive the Create/Update/Delete Bearer Response. This new S2b PGW F-TEID for control plane can be a same or different F-TEID than the S2b PGW F-TEID for control plane assigned in the subsequent Create Session Response in step 5.\n4.\tSame as step 4 of Figure 31.3A-1, with the ePDG including in the Create Session Request the new S5/S8 PGW-C/SMF IP address received in the PGW Change Info.\n5.\tSame as step 5 of Figure 31.3A-1.\n6.\tSame as step 6 of Figure 31.3A-1.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "31.5\tInter-MME or AMF-MME mobility",
                    "description": "",
                    "summary": "",
                    "text_content": "During inter-MME mobility, the source MME shall transfer the PGW Change Info to the target MME, if available.\nDuring a 5GS to EPS mobility procedure (See also clauses 4.11.1.2.1 and 4.11.1.3.2 of 3GPP TS 23.502 [46]), the PGW Change Info shall be populated as part of the MME/SGSN/AMF UE EPS PDN Connections IE from the source AMF to the target MME, if available. For a Home-routed PDU session or a PDU session with an I-SMF, the (H-)SMF may pass the PGW Change Info in the EpsPdnCnxInfo to the V/I-SMF prior to the 5GS to EPS mobility procedure, to enable the V/I-SMF to include the PGW Change Info in the EpsPdnCnxContainer as part of the SmContextRetrievedData. For a non-roaming PDU session without I-SMF, the PGW-C/SMF may include the PGW Change Info directly in the EpsPdnCnxContainer.\nNOTE:\tPassing the PGW Change Info from the SMF/AMF to the MME during an 5GS to EPS mobility enables the target MME to reselect an alternative PGW-C/SMF if the anchor PGW-C/SMF handling the PDU session fails before or during the handover. Requirements specified in clause 31.2 allow the target MME to reselect an alternative PGW-C/SMF if the anchor PGW-C/SMF handling the PDU session fails after the handover execution.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "31.6\tRestoration of PDN connections and PFCP sessions associated with a specific FQ-CSID, Group ID or PGW-C/SMF IP Address",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "31.6.1\tGeneral",
                            "text_content": "To reduce signalling latency and achieve a better load balancing among PGW-C/SMFs in a Set, an PGW-C/SMF, MME, ePDG supporting S2b over GTPv2 and UPF may support the procedures specified in this clause. These procedures enable an SMF/PGW-C to request MME/ePDG supporting S2b over GTPv2/UPF to move PDN connections and PFCP sessions associated with certain FQ-CSIDs (when partial failure handling is supported), Group IDs or PGW-C/SMF IP Addresses, to (another) PGW-C/SMF(s) in the set, without causing massing signalling.\nNOTE:\tThe FQ-CSID can only be used in the procedure specified in this clause when the partial failure feature (using FQ-CSID) is deployed and used (not to force the NF to use a Group ID). For a network where the partial failure feature is not deployed, a Group ID or a PGW-C/SMF IP address needs to be used.\nThe requirements specified in this clause shall apply in addition to the previous requirements specified in clause 31.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "31.6.2\tAllocation of Group Id or FQ-CSID to a PDN connection or a PFCP session",
                            "text_content": "To optimize the resource utilization for PDN connection(s) and/or PFCP session(s), e.g. to meet different traffic requirements for different APNs/DNNs and/or DCNs/Network Slices, and also to facilitate moving a (sub)set of PDN connections/PFCP sessions among a PGW-C/SMF set, e.g. for a partial or complete PGW-C/SMF failure or a scale-in operation, a PGW-C/SMF in a PGW-C/SMF Set may:\n-\tallocate a globally unique Group Id in the PGW Change Info IE in the Create Session Response message for a PDN connection during a PDN connection creation procedure and mobility procedure moved from 5GC without N26, or in the Modify Bearer Response for a PDN connection moved from 5GC with N26, and update the Group Id associated to the PDN connection, if necessary, in subsequent Create/Update/Delete Bearer Request messages (see also 3GPP TS 29.274 [13]);\n-\tallocate a globally unique Group Id in the PFCP Session Establishment Request message for a PFCP session during a PFCP session establishment procedure and update the Group Id, if necessary, in subsequent PFCP Session Modification Request messages (see also clause 5.22.X of 3GPP TS 29.244 [43]).\nAlternatively, if partial failure handling is supported and deployed, the PGW-C/SMF may assign an FQ-CSID to a PDN connection and/or a PFCP session as specified in clause 23.\nSubsequently, e.g. when a partial or a complete failure takes place affecting all PDN connections and PFCP sessions which are sharing either the same FQ-CSID or the same Group ID (see clause 31.6.1), a PGW-C/SMF in a PGW-C/SMF Set may trigger the restoration procedure for those affected PDN connections/PFCP sessions as specified in clauses 31.6.3 and 31.6.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "31.6.3\tRestoration of PDN connections associated with an FQ-CSID, Group ID or PGW-C/SMF IP Address",
                            "text_content": "When there is a need to change the PGW-C/SMF controlling certain PDN connections, e.g. when a partial or complete PGW-C/SMF failure takes place, in order to trigger the MME(s) to re-establish the PDN connections that need to be taken over by a different PGW-C/SMF (e.g. PDN connections affected by the partial or complete failure), a PGW-C/SMF (either the one which experienced the partial failure or is shutting down, or another one in the same set) may trigger the PGW triggered PDN connection restoration procedure specified in clause 31.4 towards the MME or in clause 31.4a towards the ePDG, with the following additional requirements:\n-\tin steps 2a or 2b, the PGW Change Info IE shall additionally include one or more PGW-C/SMF FQ-CSID(s) or one or more Group ID(s) or one or more PGW-C Control Plane IP Address(es), to request the MME/ePDG to re-establish all the PDN connections associated with the PGW-C/SMF FQ-CSID(s) or Group ID(s), or having their PGW S5/S8/ S2a/S2b F-TEID containing one of the PGW-C Control Plane IP Address(es), towards the new S5/S8/S2b PGW IP address for control plane. The PGW-C/SMF may instruct the MME/ePDG to move sessions associated with different PGW-C/SMF FQ-CSIDs, Group Ids or PGW-C/SMF Control Plane IP addresses to different PGW-C/SMF addresses.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "31.6.3A\tRestoration of PDN connections associated with an FQ-CSID, Group ID or PGW-C/SMF IP Address for a combined SGW/PGW/SMF Set",
                            "text_content": "When there is a need to change the combined SGW/PGW-C/SMF controlling certain PDN connections, e.g. when a partial or complete SGW/PGW-C/SMF failure takes place, in order to trigger the MME(s) to re-establish the PDN connections that need to be taken over by a different combined SGW/PGW-C/SMF (e.g. PDN connections affected by the partial or complete failure), a combined SGW/PGW-C/SMF (either the one which experienced the partial failure or is shutting down, or another one in the same set) may trigger the Combined SGW-C/PGW-C/SMF triggered PDN connection restoration procedure specified in clause 31.4a, with the following additional requirements:\n-\tin steps 2a or 2b, the PGW Change Info IE shall additionally include one or more PGW-C/SMF FQ-CSID(s) or one or more Group ID(s) or one or more PGW-C Control Plane IP Address(es), to request the MME to re-establish all the PDN connections associated with the PGW-C/SMF FQ-CSID(s) or Group ID(s), or having their PGW S5/S8/ S2a/S2b F-TEID containing one of the PGW-C Control Plane IP Address(es), towards the new S5/S8 PGW IP address and the new S11 SGW-C IP Address IE for control plane. The combined SGW/PGW-C/SMF may instruct the MME to move sessions associated with different PGW-C/SMF FQ-CSIDs, Group Ids or PGW-C/SMF Control Plane IP addresses to different PGW-C/SMF addresses.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "31.6.4\tRestoration of PFCP sessions associated with an FQ-CSID, Group ID or PGW-C/SMF IP Address",
                            "text_content": "When there is a need to change the PGW-C/SMF controlling certain PFCP sessions, e.g. when a partial or complete failure takes place, the PGW-C/SMF (either the PGW-C/SMF serving the PFCP sessions or another PGW-C/SMF in the same Set taking over the control of the PFCP sessions) may send a PFCP Session Set Modification Request message to the PGW-U/UPF(s) to request the PGW-U/UPF(s) to send subsequent PFCP Session Report Request messages to the alternative PGW-C/SMF (as indicated in the Alternative SMF IP Address IE) for the PFCP sessions which are associated with the FQ-CSID(s) or Group ID(s), or which have their CP F-SEID containing one of the PGW-C/SMF IP Address(es) as shown in Figure 31.6.4-1.\nThe PGW-C/SMF may instruct the UP function to move sessions associated with different PGW-C/SMF FQ-CSID(s), Group Ids or PGW-C/SMF IP addresses, to different PGW-C/SMF addresses.\nFigure 31.6.4 - 1 depicts the procedure for modifying a PGW-C/SMF initiated PFCP Session Set. The figure illustrates the process flow, starting with the Session Set Creation and ending with the Session Set Modification. The figure highlights the key steps involved, including the Session Set Creation, Session Set Modification Request, Session Set Modification Response, and Session Set Deletion. The figure also shows the interaction between the PGW-C/SMF and the SMF devices, including the PGW-C/SMF, the SMF devices, and the PFCP Session Set. The figure provides a clear and concise overview of the procedure for modifying a PFCP Session Set in a PGW-C/SMF environment.\nFigure 31.6.4-1: PGW-C/SMF initiated PFCP Session Set Modification procedure\nNOTE:\tThis procedure enables a PGW-C/SMF from the same set to take the control of multiple PFCP sessions proactively, without causing massing signalling (per PFCP session) towards the PGW-U/UPF. The use of this procecure can reduce signalling latency and achieve a better load balancing among PGW-C/SMFs.\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}