{
    "document_name": "29273-i30.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, modal verbs have the following meanings:\nshall\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions, and do not appear in Technical Reports.\nThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible, and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\tindicates permission to do something\nneed not\tindicates permission not to do something\nThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\tindicates that something is possible\ncannot\tindicates that something is impossible\nThe constructions \"can\" and \"cannot\" are not substitutes for \"may\" and \"need not\".\nwill\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "Introduction",
            "description": "The present specification details the stage 3 work related to all 3GPP AAA reference points used by the different non-3GPP accesses included in EPS. It also details the stage 3 work related to the SWa reference point used for Non-seamless WLAN offload (NSWO) in 5GS.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document defines the stage-3 protocol description for several reference points for the non-3GPP access in EPS:\n-\tThe SWa reference point between an un-trusted non-3GPP IP access and the 3GPP AAA Server/Proxy.\n-\tThe STa reference point between a trusted non-3GPP IP access and the 3GPP AAA Server/Proxy.\n-\tThe SWd reference point between the 3GPP AAA Proxy and 3GPP AAA Server.\n-\tThe SWx reference point between the 3GPP AAA Server and the HSS.\n-\tThe S6b reference point between the 3GPP AAA Server/Proxy and the PDN GW.\n-\tThe SWm reference point between the 3GPP AAA Server/Proxy and the ePDG.\n-\tThe reference point between the 3GPP AAA Server/Proxy and the EIR.\nThe present document also defines the stage 3 protocol description for the following reference points defined for Non-seamless WLAN offload in 5GS:\n-\tthe SWa' reference point between a non-3GPP WLAN access, possibly via a 3GPP AAA Proxy, and the NSWO NF; and\n-\tthe SWd' reference point between the 3GPP AAA Proxy, possibly via an intermediate 3GPP AAA Proxy, and the NSWO NF.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\tIETF RFC 5779: \"Diameter Proxy Mobile IPv6: Mobility Access Gateway and Local Mobility Anchor Interaction with Diameter Server \".\n[3]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[4]\tIETF RFC 4005: \"Diameter Network Access Server Application\"\n[5]\tIETF RFC 4072: \"Diameter Extensible Authentication Protocol (EAP) Application\"\n[6]\tIETF RFC 5447 \"Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction\".\n[7]\tVoid.\n[8]\tIETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".\n[9]\tIETF RFC 5777: \"Traffic Classification and Quality of Service (QoS) Attributes for Diameter\".\n[10]\tVoid\n[11]\tIETF RFC 5778: \"Diameter Mobile IPv6: Support for Home Agent to Diameter Server Interaction\".\n[12]\tVoid\n[13]\t3GPP TS 24.303: \"Mobility management based on Dual-Stack Mobile IPv6; Stage 3\".\n[14]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[15]\tIETF RFC 4282: \"The Network Access Identifier\".\n[16]\t3GPP TS 33.203: \"3G security; Access security for IP-based services\".\n[17]\t3GPP TS 29.230: \"Diameter applications; 3GPP specific codes and identifiers\".\n[18]\tIETF RFC 4004: \"Diameter Mobile IPv4 Application\".\n[19]\t3GPP TS 33.402: \"3GPP System Architecture Evolution (SAE); Security aspects of non-3GPP accesses\".\n[20]\tIETF RFC 4006: \"Diameter Credit-Control Application\".\n[21]\tVoid.\n[22]\t3GPP TS 29.228: \"IP multimedia (IM) Subsystem Cx and Dx Interfaces; Signalling flows and Message Elements\".\n[23]\t3GPP TS 29.212: \"Policy and Charging Control (PCC); Reference points\".\n[24]\t3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter protocol; Protocol details\".\n[25]\t3GPP2 X. S0057-B: \"EUTRAN – eHRPD Connectivity and Interworking: Core Network Aspects\".\n[26]\t3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via non-3GPP access networks\".\n[27]\tIETF RFC 5448: \"Improved Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA')\".\n[28]\tIETF RFC 6611: \"Mobile IPv6 (MIPv6) Bootstrapping for the Integrated Scenario\".\n[29]\t3GPP TS 29.272: \"Evolved Packet System; MME and SGSN Related Interfaces Based on Diameter Protocol\".\n[30]\t3GPP TS 32.299: \"Charging management; Diameter charging applications\".\n[31]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting packet based services and Packet Data Networks (PDN)\".\n[32]\t3GPP TS 32.422: \"Telecommunication management; Subscriber and equipment trace; Trace control and configuration management\".\n[33]\tVoid.\n[34]\t3GPP TS 29.303: \"Domain Name System Procedures; Stage 3\".\n[35]\tIETF RFC 1035: \"Domain Names - Implementation and Specification\".\n[36]\tVoid.\n[37]\tIETF RFC 5729: \"Clarifications on the Routing of Diameter Requests Based on the Username and the Realm\".\n[38]\t3GPP TS 29.274: \"3GPP Evolved Packet System (EPS); Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3\".\n[39]\t3GPP TS 23.139: \"3GPP System-Fixed Broadband Access Network Interworking; Stage 2\".\n[40]\tIEEE Std 802.11-2012: \"IEEE Standard for Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Specific requirements - Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".\n[41]\tVoid.\n[42]\tVoid.\n[43]\t3GPP TS 24.139: \"3GPP system - fixed broadband access network interworking\".\n[44]\tIETF RFC 4187: \"Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA)\".\n[45]\t3GPP TS 23.203: \"Policy and Charging Control Architecture\".\n[46]\tIETF RFC 5580: \"Carrying Location Objects in RADIUS and Diameter\".\n[47]\tIETF RFC 7683: \"Diameter Overload Indication Conveyance\".\n[48]\tETSI TS 283 034: \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); Network Attachment Sub-System (NASS); e4 interface based on the DIAMETER protocol\".\n[49]\t3GPP TS 23.008: \"Organization of subscriber data\".\n[50]\tVoid\n[51]\tVoid\n[52]\t3GPP TS 23.380: \"IMS Restoration Procedures\".\n[53]\tIETF RFC 7944: \"Diameter Routing Message Priority\".\n[54]\tIETF RFC 8583: \"Diameter Load Information Conveyance\".\n[55]\tIETF RFC 6696: \"EAP Extensions for the EAP Re-authentication Protocol (ERP)\".\n[56]\tIETF RFC 6734: \"Diameter Attribute-Value Pairs for Cryptographic Key Transport\".\n[57]\tIETF RFC 6942: \"Diameter Support for the EAP Re-authentication Protocol (ERP)\".\n[58]\tIETF RFC 6733: \"Diameter Base Protocol\".\n[59]\t3GPP TS 23.501: \"System Architecture for the 5G System\".\n[60]\t3GPP TS 33.501: \"Security architecture and procedures for 5G system\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "3.1.1\tGeneral",
                            "text_content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\nMulti-connection mode (MCM): see definition in clause 3.1 of 3GPP TS 23.402 [3].\nNon-Seamless WLAN offload (NSWO): Non-Seamless Non-3GPP offload when the access network is WLAN.\nSingle-connection mode (SCM): see definition in clause 3.1 of 3GPP TS 23.402 [3].\nTransparent single-connection mode (TSCM): see definition in clause 3.1 of 3GPP TS 23.402 [3].\nTrusted WLAN Identifier (TWID): Identifier of a given Trusted WLAN, a combination of, e.g., an SSID and/or an HESSID as defined in IEEE Std 802.11-2012 [40].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "3.1.2\tHandling of Information Elements",
                            "text_content": "In the tables that describe the Information Elements transported by each Diameter command, each Information Element is marked as (M) Mandatory, (C) Conditional or (O) Optional in the Category \"Cat.\" column. For the correct handling of the Information Elements and their precedence to any included ABNF definition of the command as defined according to their category types, see the description detailed in clause 6 of the 3GPP TS 29.228 [22].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\nAE\tAuthentication Extension\nDRMP\tDiameter Routing Message Priority\nDSCP\tDifferentiated Services Code Point\nEIR\tEquipment Identity Register\nEPC\tEvolved Packet Core\nER\tEAP Re-authentication\nERP\tEAP Re-Authentication Protocol\nePDG\tEvolved Packet Data Gateway\neHRPD\tevolved High Rate Packet Data\nFA\tForeign Agent\nFACoA\tFA Care-of-Address\nHA\tHome Agent\nHBM\tHost Based Mobility\nHESSID\tHomogenous Extended Service Set Identifier\nHSGW\teHRPD Serving Gateway\nLMA\tLocal Mobility Anchor\nMAG\tMobile Access Gateway\nMIPv4\tMobile IP version 4\nMN\tMobile Node\nNBM\tNetwork Based Mobility\nNAS\tNetwork Access Server\nNSWO\tNon-Seamless WLAN offload\nNSWOF\tNon-Seamless WLAN offload Function\nPBU\tProxy Binding Update\nPDN GW\tPDN Gateway\nPGW\tPDN Gateway, the abbreviation of PDN GW\nPMIP/PMIPv6\tProxy Mobile IP version 6\nRRP\tMIPv4 Registration Reply\nRRQ\tMIPv4 Registration Request\nSA\tSecurity Association\nSGW\tServing Gateway\nSIPTO\tSelected IP Traffic Offload\nSSID\tService Set Identifier\nTWAN\tTrusted WLAN Access Network\nWLCP\tWireless LAN Control Plane Protocol\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tSWa and SWa' Description",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tFunctionality",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.1.1\tGeneral",
                            "text_content": "The SWa reference point is defined between the untrusted non-3GPP IP access and the 3GPP AAA Server or Proxy in EPS. The definition of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nThe SWa reference point is optionally used to authenticate and authorize the UE for the access to the EPS. It is up to the non-3GPP operator's policy whether this interface and the procedures defined in this clause are used.\nNOTE:\tFrom the EPS operator's view, the tunnel authentication and authorization procedures described in clause 7 (SWm description) and clause 9 are required to ensure the user's authentication and authorization when the UE is attached to an untrusted non-3GPP IP access.\nThe same procedures as defined for STa reference points are used also in the SWa, but with reduced message content. As an exception, the service authorization information update procedure is not applicable for the SWa reference point.\nThe SWa' reference point is defined between the non-3GPP WLAN access, possibly via a 3GPP AAA Proxy, and the NSWOF in 5GS. The definition of the reference point and its functionality is given in clause 4.2.15 of 3GPP TS 23.501 [59] and Annex S of 3GPP TS 33.501 [60]. It reuses the same stage 3 protocol definition as defined for SWa in EPC, with specific requirements for NSWO in 5GS specified in clause 4.1.2.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.2\tProcedure Descriptions",
                            "text_content": "This procedure follows the STa Authentication and Authorization procedure, with the following differences:\n-\tInformation elements that would reflect information about the user's service request and about the access network are not included or are optional in the authentication and authorization request.\n-\tThe information elements that describe the user's subscription profile are not downloaded to the non-3GPP access network.\nNOTE:\tThe information elements related to the IP Mobility Mode Selection function are not supported over this interface.\nTable 4.1.2.1/1: SWa Authentication and Authorization Request\n\nTable 4.1.2.1/2: SWa Authentication and Authorization Answer\n\nThe detailed behaviour of the 3GPP AAA Server follows the behaviour defined for the STa Authentication and Authorization procedure (refer to clause 5.1.2.1.2), with the following deviations:\n-\tThe 3GPP AAA Server shall handle the non-3GPP access network as untrusted.\n-\tThe 3GPP AAA Server marks the trust relationship as \"untrusted\" with the User Identity.\n-\tThe authentication method shall be selected based on the presence of the Access Network Identity as specified in 3GPP TS 33.402 [19]: if this information element is present, the EAP-AKA' method as specified in IETF RFC 5448 [27] is used; otherwise, the EAP-AKA method as specified in IETF RFC 4187 [44] is used.\nWhen a WLAN Access Network provides WLAN Location Information to the 3GPP AAA Server that it considers as network provided location, the 3GPP AAA Server should store this information for the duration of the WLAN session of the UE, along with the WLAN Location Timestamp if received from the WLAN Access Network, or with the timestamp at which the WLAN Location Information is received from the WLAN Access Network, and provide it to the ePDG during a subsequent Authentication and Authorization procedure or Authorization procedure over the SWm reference point (see clauses 7.1.2.1.2 and 7.1.2.2.2).\nThe 3GPP AAA Server shall delete any stored WLAN Location Information and WLAN Location Timestamp associated with the UE when a WLAN Access Network provides WLAN Location Information to the 3GPP AAA Server that it does not consider as network provided location.\nNOTE:\tIt is up to local 3GPP AAA Server policies to decide whether the location information received from the WLAN access network can be considered as network provided location.\nBased on operator policy, the 3GPP AAA Server shall include the MPS-Priority AVP with the MPS-EPS-Priority bit set in the SWa Authentication and Authorization Answer message if the 3GPP AAA Server has received an MPS-Priority AVP with the MPS-EPS-Priority bit set from the HSS. The 3GPP AAA Server shall treat the message and all subsequent messages (if authentication is successful) for the UE with priority as specified in Annex C and Annex D. The 3GPP AAA Server shall discontinue priority treatment for the UE if the 3GPP AAA Server receives a Non-3GPP-User-Data AVP without an MPS-Priority AVP with the MPS-EPS-Priority bit set and the DER request received from the ePDG did not contain a High-Priority-Access-Info AVP with the HPA_Configured bit set.\nThe detailed behaviour of the 3GPP AAA Proxy follows the behaviour defined for the STa Authentication and Authorization procedure (refer to clause 5.1.2.1.3), with the following exception:\n-\tThe 3GPP AAA Proxy shall insert or overwrite Visited-Network-Identifier AVP before forwarding the request to the 3GPP AAA Server.\nNOTE:\tIf the untrusted WLAN is operated by the VPLMN's equivalent PLMN, the 3GPP AAA proxy can receive the Visited-Network-Identifier AVP from the Authentication and Authorization Request message.\n-\tThe 3GPP AAA Proxy shall handle the non-3GPP access network as untrusted and marks the trust relationship as \"untrusted\".\nOn receipt of the authentication and authorization answer that completes a successful authentication, the 3GPP AAA Proxy shall record the authentication state of the user.\nThis procedure equals with the STa HSS/AAA Initiated Detach procedure, refer to clause 5.1.2.2.\nThe 3GPP AAA Server shall delete any stored WLAN Location Information and WLAN Location Timestamp associated with the UE when it becomes aware that the WLAN session of the UE is terminated.\nThis procedure equals with the STa Non-3GPP Access Network Initiated Detach procedure, refer to clause 5.1.2.4.\nThe 3GPP AAA Server shall delete any stored WLAN Location Information and WLAN Location Timestamp associated with the UE when it becomes aware that the WLAN session of the UE is terminated.\nThis procedure is optional and it may be invoked by the 3GPP AAA Server, if the operator policies require that the re-authentication of the user for the SWa is to be renewed and the untrusted non-3GPP access network supports the re-authentication.\nThis procedure shall be performed in two steps:\n-\tThe 3GPP AAA server shall issue an unsolicited re-auth request towards the untrusted non-3GPP access, indicating that both re-authentication and re-authorization of the user is needed. Upon receipt of such a request, the untrusted non-3GPP access shall respond to the request and shall indicate the disposition of the request. This procedure is mapped to the Diameter command codes Re-Auth-Request and Re-Auth-Answer specified in IETF RFC 6733 [58]. Information element contents for these messages shall be as shown in tables 4.1.2.4.1/1 and 4.1.2.4.1/2.\n-\tUpon receiving the re-auth request, the untrusted non-3GPP access shall immediately invoke the SWa authentication and authorization procedure requesting the identity of the user via EAP and using DER/DEA commands, with the same session-ID but the content adapted to the needs of a re-authentication. Information element contents for these messages shall be as shown in tables 4.1.2.4.1/3 and 4.1.2.4.1/4.\nIf the re-authentication of the user is not successful, the untrusted non-3GPP access shall detach the user.\nTable 4.1.2.4.1/1: SWa Re-auth request\n\nTable 4.1.2.4.1/2: SWa Re-auth response\n\nTable 4.1.2.4.1/3: SWa Authentication and Authorization Request\n\nTable 4.1.2.4.1/4: SWa Authentication and Authorization Answer\n\nThe 3GPP AAA Server shall trigger this procedure according to the local policies configured by the operator.\nThe 3GPP AAA Server shall use the same authentication method that was used during the full authentication executed at the UE's attach. If EAP-AKA' is used, the 3GPP AAA Server shall use the ANID parameter received during the authentication and authorization executed at the UE attach (refer to clause 4.1.2.1.1).\nThe detailed behaviour of the 3GPP AAA Proxy follows the behaviour defined for the STa Re-Authorization and Re-Authentication Procedures (refer to clause 5.1.2.3.3), with the following addition:\n-\tWhen forwarding the authorization answer or the authentication and authorization answer, the 3GPP AAA Proxy shall record the authentication state of the user.\nThe SWa' interface between the non-3GPP WLAN access, possibly via a 3GPP AAA Proxy, and the NSWOF shall use the same stage 3 protocol definition as for the SWa interface in EPS, with the following modifications:\n-\tSWa' Authentication and Authorization procedure:\n-\tThe User Identity IE in the SWa' Authentication and Authorization Request and in the SWa' Authentication and Authorization Response shall contain the SUCI in NAI form as defined in clause 28.7.3 of 3GPP TS 23.003 [14]. In NSWO roaming scenario with a 3GPP AAA Proxy in the VPLMN (see clause 4.2.15 of 3GPP TS 23.501 [59]), the SUCI in NAI form shall be decorated as defined in clause 28.7.9 of 3GPP TS 23.003 [14] to enable the routing of SWa' signalling towards the 3GPP AAA Proxy in the VPLMN selected by the UE.\nNOTE 1:\tThis IE does not contain any leading digit to differentiate between authentication schemes.\nNOTE 2:\tThe realm in the SUCI in NAI form (starting by the first label \"5gc-nswo\") enables to route the signaling towards an NSWOF, as opposed to sending it to a 3GPP AAA Server, if the non-3GPP WLAN access also supports SWa signaling with a 3GPP AAA Server e.g. for a 4G subscriber.\n-\tEAP-AKA' as specified in RFC 5448 [27] shall be used as the authentication method.\n-\tThe NSWOF shall behave as specified in Annex S of 3GPP TS 33.501 [60]. The NSWOF shall send the MSK received from the AUSF in the Pairwise Master Key IE in the SWa' Authentication and Authorization Answer.\n-\tThe SWa HSS/AAA Initiated Detach, SWa Non-3GPP Access Network Initiated Detach and SWa Re-authentication and Re-Authorization are not supported.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.1.2.1/1: SWa Authentication and Authorization Request",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.1.2.1/2: SWa Authentication and Authorization Answer",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.1.2.4.1/1: SWa Re-auth request",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.1.2.4.1/2: SWa Re-auth response",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.1.2.4.1/3: SWa Authentication and Authorization Request",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 4.1.2.4.1/4: SWa Authentication and Authorization Answer",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "4.2\tProtocol Specification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2.1\tGeneral",
                            "text_content": "The SWa reference point shall use the same Diameter application as the STa reference point. The first authentication command exchange (DER/DEA) is common between the SWa and STa reference points. During this initial exchange, the 3GPP AAA Server determines the HPLMN's trust relationship with the non-3GPP access network and communicates it to the non-3GPP access network and the UE as described in clause 5.1.2.1.2. The contents of the subsequent commands are dependent on this trust relationship determination and are specific to the SWa or STa reference points.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.2\tCommands",
                            "text_content": "The Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the 'R' bit set in the Command Flags field, is sent from a trusted non-3GPP access network to a 3GPP AAA Server.\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n{ EAP-Payload }\n[ User-Name ]\n[ Calling-Station-Id ]\n[ RAT-Type ]\n…\n[ ANID ]\n[ Full-Network-Name ]\n[ Short-Network-Name ]\n*[ Supported-Features ]\n[ AAA-Failure-Indication ]\n[ Transport-Access-Type ]\n[ OC-Supported-Features ]\n[ Access-Network-Info ]\n[ User-Location-Info-Time ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]\n\nThe Diameter-EAP-Answer (DEA) command, indicated by the Command-Code field set to 268 and the 'R' bit cleared in the Command Flags field, is sent from a 3GPP AAA Server to a trusted non-3GPP access network NAS.\n< Diameter-EAP-Answer > ::=\t< Diameter Header: 268, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Result-Code }\n[ Experimental-Result ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Auth-Request-Type }\n[ EAP-Payload ]\n[ User-Name ]\n[ Session-Timeout ]\n[ Accounting-Interim-Interval ]\n[ EAP-Master-Session-Key ]\n*[ Redirect-Host ]\n[ AN-Trusted ]\n*[ Supported-Features ]\n[Mobile-Node-Identifier]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n[ MPS-Priority ]\n…\n*[ AVP ]\n\nRefer to clause 5.2.2.2.\nRefer to clause 5.2.2.4.\nThe Diameter Re-Auth-Request (RAR) command, indicated by the Command-Code field set to 258 and the \"R\" bit set in the Command Flags field, shall be sent from a 3GPP AAA server to an untrusted non-3GPP access network NAS. ABNF for the RAR command shall be as follows:\n\n< Re-Auth-Request >  ::=\t< Diameter Header: 258, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n{ Re-Auth-Request-Type }\n[ User-Name ]\n…\n*[ AVP ]\nThe Diameter Re-Auth-Answer (RAA) command, indicated by the Command-Code field set to 258 and the \"R\" bit cleared in the Command Flags field, shall be sent from an untrusted non-3GPP access network NAS to a 3GPP AAA server. ABNF for the RAA command shall be as follows:\n\n< Re-Auth-Answer >  ::=\t< Diameter Header: 258, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]\nRefer to clause 4.2.2.1.1.\nRefer to clause 4.2.2.1.2\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.3\tInformation Elements",
                            "text_content": "The information elements of SWa are the same as the IEs defined for the STa interface described in the clause 5.2.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.4\tSession Handling",
                            "text_content": "The session handling for the SWa interface is the same as the STa session handling described in the clause 5.2.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "5\tSTa Description",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tFunctionality",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.1.1\tGeneral",
                            "text_content": "The STa reference point is defined between a non-3GPP access network and the 3GPP AAA Server or between a non-3GPP access network and the 3GPP AAA Proxy. The definition of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nWhether a Non-3GPP access network is Trusted or Untrusted is not a characteristic of the access network; this decision shall be made during the access authentication and authorization procedure executed between the non-3GPP access network and the 3GPP AAA Server. This is implemented by the STa and SWa reference points sharing the same Diameter application and partly sharing the same authentication and authorization procedure. The STa and SWa reference points are clearly distinguished after the exchange of the first authentication and authorization messages, during which trusted/untrusted decision is made by the 3GPP AAA server and this decision is communicated to the non-3GPP access network. The other procedures are specific to the STa and SWa reference points.\nThe STa reference point shall be used to authenticate and authorize the UE.\nThe STa reference point may also be used to transport PMIPv6, GTPv2, or MIPv4 FA-CoA mode related mobility parameters in a case the UE attaches to the EPC using the S2a reference point. The procedures specified for EPC access via GTP based S2a are only applicable to trusted WLAN access networks (see clause 16 of 3GPP TS 23.402 [3]).\nAdditionally the STa reference point may also be used to transport DSMIPv6 related mobility parameters in case the UE attaches to the EPC using the S2c reference point. In particular, in this case the STa reference point may be used for conveying the Home Agent IP address or FQDN from the AAA server to the gateway of the trusted non-3GPP access for Home Agent discovery based on DHCPv6 (see TS 24.303 [13]).\nThis reference point shall be also used to transport charging-related information and optionally information about IP Mobility Mode Selection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2\tProcedures Description",
                            "text_content": "These procedures are transported over Diameter, the Access (Re-)Authentication and Authorization between the trusted non-3GPP access network and the 3GPP AAA Proxy or Server. The STa interface and Diameter application shall be used for authenticating and authorizing the UE for EPC access in PMIPv6, GTPv2, MIPv4 FA-CoA mode or for TWAN access without EPC S2a access (i.e. non-seamless WLAN offload) via trusted non-3GPP accesses and non-3GPP accesses that are decided to be untrusted during the authentication and authorization procedure.\nWhen EAP-AKA' is used in the STa access authentication and either EPC access in NBM (PMIPv6 or GTPv2) or TWAN access without EPC S2a access (i.e. non-seamless WLAN offload) is used, the trusted non-3GPP access network shall support also the role of the NAS. Specifically, in the case where PMIPv6 is used, the network element of the non-3GPP access network acting as a MAG shall have also the role of the NAS. During the STa access authentication the NAS shall serve as pass-through EAP authenticator.\nDiameter usage over the STa interface:\n-\tWhen EAP is used, the trusted non-3GPP access authentication and authorization procedure shall be mapped to the Diameter-EAP-Request and Diameter-EAP-Answer command codes specified in IETF RFC 4072 [5].\n-\tFor (re)authentication procedures, the messaging described below shall be reused.\nDuring the STa Access Authentication and Authorization procedure the non-3GPP access network may provide information on its PMIPv6 or GTPv2 capabilities to the 3GPP AAA Server.\nDuring the STa Access Authentication and Authorization procedure the trusted non-3GPP access network shall provide information on the Access Network Identity (ANID) to the 3GPP AAA Server. Specifically, the TWAN shall set the Access Network Identity as specified in clause 8.1.1.2 of 3GPP TS 24.302 [26] for a WLAN access network.\nFor a trusted non-3GPP access, the 3GPP AAA Server may perform IP mobility mode selection between NBM and HBM. The 3GPP AAA Server may provide to the trusted non-3GPP access network an indication if either NBM or local IP address assignment (for HBM) shall be used.\nFor a trusted WLAN access,\n-\tthe TWAN should send information on whether it supports TSCM, SCM or MCM or any combination of them to the 3GPP AAA Server as specified in 3GPP TS 23.402 [63]. If it indicates support of the MCM, the TWAN shall also provide the 3GPP AAA Server with the TWAG's control plane IPv4 address, or IPv6 address or both (if it supports both IPv4 and IPv6), to be sent to the UE and used for WLCP if the MCM is selected.\n-\tif the user is successfully authenticated and authorized for this access, the 3GPP AAA Server:\n-\tshall select either TSCM, SCM or MCM and indicate to the TWAN the selected mode of operation. If the 3GPP AAA Server does not provide such an indication, the TSCM shall be used;\n-\tmay either only authorize the user to access to EPC via S2a (i.e. EPC-routed service only), or only authorize the user to access the TWAN without granting access to EPC via S2a (i.e. non-seamless WLAN offload service only), or authorize both EPC-routed and non-seamless WLAN offload services. If the SCM is selected, the 3GPP AAA Server shall indicate to the TWAN its decision to either authorize access to EPC via S2a or only authorize the user to access the TWAN without granting access to EPC via S2a, i.e. not both;\n-\twhen authorizing the SCM to be used for EPC access, the 3GPP AAA server shall forward the PDN connectivity parameters received from the UE to the TWAN, i.e. the UE requested PDN type (IPv4, IPv6 or IPv4v6), the attach type (initial attach or handover), optionally the requested APN (if received from the UE) and optionally the Protocol Configuration Options (if received from the UE));\n-\twhen authorizing the MCM for EPC access, the 3GPP AAA server shall derive the WLCP key as defined in 3GPP TS 33.402 [19] and shall provide the WLCP key to the TWAN to protect the WLCP signalling.\nif the user is successfully authenticated and authorized for this access, the TWAN:\n-\tshall decide the S protocol variant to use if access to EPC is authorized and the TWAN decides to establish S2a.\n-\tif the SCM has been authorized to be used for EPC access, the TWAN shall return an indication to the 3GPP AAA Server on whether the requested connectivity has been granted and, if so, also pass on to the 3GPP AAA Server the connectivity parameters to be provided to the UE, i.e. the selected APN, the selected PDN type (IPv4, IPv6 or IPv4v6), the IPv4 address (for PDN type IPv4 or IPv4v6), the IPv6 interface identifier (for PDN type IPv6 or IPv4v6), optionally the Protocol Configuration Options received from the PDN GW once S2a has been established, and the TWAG user plane MAC address. If the requested connectivity has not been granted, the TWAN should provide the 3GPP AAA Server with a cause indicating why the requested connectivity could not be granted; the TWAN may also provide a Session Management back-off timer to be sent to the UE to instruct the UE to not request new PDN connectivity to the same APN for the indicated time.\nWhen authorizing NBM to be used, the 3GPP AAA server shall return NBM related information back to the trusted non-3GPP access network.\nDuring the STa Access Authentication and Authorization procedure, when DSMIPv6 is used, the 3GPP AAA Server may provide a Home Agent IPv6 address (and optionally IPv4 address) or FQDN to the trusted non-3GPP access network. This is needed if the DHCPv6 option for Home Agent address discovery is chosen (see TS 24.303 [13] and IETF RFC 6611 [28]). If the Home Agent IPv6 address or FQDN is not included in the final Authentication and Authorization Answer by the 3GPP AAA server, the trusted non-3GPP access network shall not assign the Home Agent via DHCPv6.\nDuring the STa Access Authentication and Authorization procedure for MIPv4 FA-CoA mode using trusted non-3GPP access, the 3GPP AAA Server may provide the mobility security parameters FA-RK and FA-RK-SPI to the trusted non-3GPP access network.\nThe User-Name AVP may contain a decorated NAI (as defined in clause 19.3.3 of 3GPP TS 23.003 [14]). In this case the 3GPP AAA Proxy shall process the decorated NAI and support routing of the Diameter request messages based on the decorated NAI as described in IETF RFC 5729 [37].\nBased on local policies, EPC access for emergency services over a trusted non-3GPP access is supported as specified in clause 4.5.7.2.1 of 3GPP TS 23.402 [3] for:\n-\tUEs with a valid EPC subscription that are authenticated and authorized for EPC services;\n-\tUEs that are authenticated only;\n-\tUEs with an unauthenticated IMSI; and/or\n-\tUICC-less UEs.\nFor PMIPv6, GTPv2 and MIPv4 FA-CoA mode trusted non-3GPP accesses, upon mobility between 3GPP and non-3GPP accesses, for the PDNs the UE is already connected, the PDN GW identity for each of the already allocated PDN GW(s) with the corresponding PDN information is provided to the trusted non-3GPP system. The PDN GW identity is a FQDN and/or IP address of the PDN GW. The non-3GPP access network shall use the received PDN GW identity for mobility with IP address preservation or in case of static PDN GW assignment. If a FQDN is provided, the trusted non-3GPP system shall then derive it to IP address according to the selected mobility management protocol.\nNOTE:\tMobility with IP address preservation is not supported between TWAN and 3GPP access in TSCM.\nDuring the STa Access Authentication and Authorization procedure, the bootstrapping of an ER server in the TWAN with a given root key may be performed, as described in IETF RFC 6696 [55] and 3GPP TS 33.402 [19]. This procedure is used to provide an ER server with the keying material that will be used for further EAP re-authentication procedures using ERP.\nTable 5.1.2.1/1: STa Access Authentication and Authorization Request\n\nTable 5.1.2.1/2: Trusted non-3GPP Access Authentication and Authorization Answer\n\nOn receipt of the first DER message, the 3GPP AAA Server shall check the validity of the ANID AVP and whether the non-3GPP access network is entitled to use the included value. The correct syntax of the ANID is checked as follows:\n-\tIn a non-roaming case, i.e. when the 3GPP AAA Server receives the request directly and not via the 3GPP AAA Proxy, checking ANID is mandatory;\n-\tIn a roaming case when the request is received via an 3GPP AAA proxy, checking ANID is optional. The 3GPP AAA Server may decide to check ANID based on local configuration, e.g. depending on the received visited network identifier.\n-\tIf the checking result shows that the included ANID value is not valid (not defined by 3GPP) or that the requesting entity is not entitled to use the received ANID value, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nThe 3GPP AAA Server shall check if user data exists in the 3GPP AAA Server (containing valid authentication information for the current access network identity). If not, the 3GPP AAA Server shall use the procedures defined in SWx interface to obtain access authentication and authorization data.\nIf IMEI check is required by operator policy and the TWAN is in the HPLMN, the 3GPP AAA Server shall:\n-\tretrieve the IMEI(SV) from the UE as specified in 3GPP TS 23.402 [26];\n-\tif the IMEI(SV) is available, check the Mobile Equipment's identity status towards the EIR, using the ME Identity Check procedure (see clause 11);\n-\tupon getting the IMEI check result from the EIR, determine whether to continue or stop the authentication and authorization procedure;\n-\tif the IMEI(SV) is not available, determine whether to continue or stop the authentication and authorization procedure based on operator policy;\n-\tif the 3GPP AAA Server determines that the authentication and authorization procedure shall be stopped, it shall:\n-\tnotify the UE that the Mobile Equipment used is not acceptable to the network (e.g. the Mobile Equipment is on the prohibited list of the EIR), as specified in 3GPP TS 24.302 [26];\n-\trespond to the TWAN with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\nSpecific operator policies may be configured for emergency services, regarding whether to check the IMEI and, if the IMEI needs to be checked, whether to continue or stop the authentication and authorization procedure upon getting the IMEI check result or when the IMEI(SV) is not available.\nIf the IMEI-Check-Required-In-VPLMN bit is set in the DER-Flags AVP of the first Authentication and Authorization Request message and the TWAN is in the VPLMN, the 3GPP AAA Server shall:\n-\tretrieve the IMEI(SV) from the UE as specified in 3GPP TS 23.402 [26];\n-\trequest the VPLMN to check the IMEI, by setting the IMEI-Check-Request-In-VPLMN bit in the DEA-Flags AVP and including the IMEI(SV) if available in the DEA message;\n-\tupon getting the IMEI-Check-In-VPLMN-Result AVP in the subsequent DER message, if the IMEI check failed in the VPLMN:\n-\tnotify the UE that the Mobile Equipment used is not acceptable to the network (e.g. the Mobile Equipment is on the prohibited list of the EIR), as specified in 3GPP TS 24.302 [26];\n-\trespond to the TWAN with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\nSee Annex A.2.3 and A.3.2.\nIf the 3GPP AAA Server receives a request message not related to any existing session and is able to recognize that the non-3GPP access network included the AAA-Failure-Indication AVP in the request, the 3GPP AAA Server shall also include the AAA-Failure-Indication AVP over the SWx interface, while retrieving the access authentication and authorization data from the HSS.\nIf SWx authentication response indicates that:\n-\tThe user does not exist, then the 3GPP AAA Server shall respond the non-3GPP access network with Experimental-Result-Code DIAMETER_ERROR_USER_UNKNOWN.\n-\tThe user does not have non-3GPP access subscription, then 3GPP AAA Server shall respond the non-3GPP access network with Experimental-Result-Code DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION.\n-\tThe user is not allowed to roam in the visited network, then 3GPP AAA Server shall respond the non-3GPP access network with Experimental-Result-Code DIAMETER_ERROR_ROAMING_NOT_ALLOWED.\n-\tThe user is currently being served by a different 3GPP AAA Server, then the 3GPP AAA Server shall respond to the non-3GPP access network with the Result-Code set to DIAMETER_REDIRECT_INDICATION and the Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\n-\tThe user is not allowed to use the current access type, then the 3GPP AAA Server shall respond to the non-3GPP access network with Experimental-Result-Code DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED.\n-\tAny other error occurred, then the error code DIAMETER_UNABLE_TO_COMPLY shall be returned to the non-3GPP access network.\nWhen SWx authentication response includes the requested authentication information, the 3GPP AAA Server shall proceed with the authentication and authorization procedure. The 3GPP AAA Server shall use the procedures defined in SWx interface to obtain the user's subscription profile from HSS.\nBefore sending out the authentication challenge, the 3GPP AAA Server shall decide, whether the access network is handled as Trusted or Untrusted. The 3GPP AAA Server shall make the decision based on the Access Network Identifier and Visited Network Identity information elements, according to its local policies. The local policies of the 3GPP AAA Server shall be based on the security criteria described in 3GPP TS 33.402 [19].\nNOTE 1:\tThe network operator can configure this e.g. according to the roaming agreements with the non-3GPP AN operator or with VPLMN operator.\nIn a roaming case, if the 3GPP AAA Server has received the trust relationship indicator from the VPLMN (AN-Trusted AVP), the 3GPP AAA Server may use this information as input parameter to the trusted/untrusted evaluation.\nThe VPLMN trust relationship indicator may be utilized only if the appropriate trust relationship exists between the HPLMN and VPLMN operators.\nBased on the trusted/untrusted decision, the 3GPP AAA Server may send a trust relationship indication to the UE, as described in 3GPP TS 24.302 [26].\nThe 3GPP AAA Server shall indicate the trust relationship assessment of the non-3GPP access network to the UE in the AT_TRUST_IND attribute (in the EAP-Request/AKA'-Challenge) as defined in 3GPP TS 24.302 [26]. The 3GPP AAA Server shall also indicate the trust relationship assessment to the non-3GPP access network using AN-Trusted AVP in the DEA command.\nIf the decision is \"Trusted\", the STa authentication and authorization procedure is executed as described here, in clause 5.1.2.1 and it clauses. Otherwise, the SWa authentication and authorization procedure is executed as described in clause 4.1.2.1.\nThe 3GPP AAA Server marks the trust relationship as \"trusted\" with the User Identity. If the 3GPP AAA Server detects that an S6b session already exists for the corresponding UE and the S6b session was established as a result of an authentication request for DSMIPv6, the 3GPP AAA Server shall send the trust relationship to the PDN GW as specified in clause 9.1.2.5.\nThe 3GPP AAA Server shall run EAP-AKA' authentication as specified in 3GPP TS 33.402 [19]. Exceptions shall be treated as error situations and the result code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nOnce authentication is successfully completed, the 3GPP AAA Server shall perform the following authorization checking (if there is an error in any of the steps, the 3GPP AAA Server shall stop processing and return the corresponding error):\n1)\tCheck if the user is barred to use the non 3GPP Access. If it is so, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED\n2)\tCheck the access type. If the received access type is listed in the user's disallowed RAT-Types,\nthis shall be treated as error and the Experimental-Result-Code DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED shall be returned.\nThe following steps are only executed if the non-3GPP access network was decided to be Trusted.\n3)\tIf the APN Id IE is present in the request, check if the user has a subscription for the requested APN or for the wildcard APN. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_NO_APN_SUBSCRIPTION\n4)\tfor a trusted WLAN access (i.e. ANID in the request indicates WLAN, see clause 8.1.1.2 of 3GPP TS 24.302 [26]), check if the user is authorized to access to EPC via S2a and/or non-seamless WLAN offload via the selected WLAN:\n-\tif no TWAN-Access-Info AVP was received from the HSS in the user's subscription, the 3GPP AAA Server shall consider that access to EPC and non-seamless WLAN Offload is authorized;\n-\tif one or more TWAN-Access-Info AVP(s) was received from the HSS in the user's subscription:\n-\tif the TWAN has signalled the selected Trusted WLAN in the request and the selected Trusted WLAN identifier contains only the SSID of the selected WLAN, the 3GPP AAA Server shall authorize the access methods allowed by the TWAN-Access-Info AVP explicitly matching the selected trusted WLAN (i.e. including a WLAN-Identifier AVP with the same SSID and without HESSID information) if any;\nNOTE 2:\tWhen the TWAN does not include the HESSID in the request, the authorization information in the 3GPP AAA Server containing both SSID and HESSID is not applicable; therefore, in order to get specific authorization of the UE in this case, the operator needs to define authorization information for the SSID in question (without HESSID), or to rely on the \"wildcard\" authorization (i.e., a TWAN-Access-Info AVP not including a WLAN-Identifier AVP).\n-\tif the TWAN has signalled the selected Trusted WLAN in the request and the selected Trusted WLAN identifier contains both the SSID and the HESSID of the selected WLAN, the 3GPP AAA Server shall authorize the access methods allowed by the TWAN-Access-Info AVP explicitly matching the selected trusted WLAN (i.e. including a WLAN-Identifier AVP with the same SSID and same HESSID);\nElse, if no match is found, the 3GPP AAA Server shall authorize the access methods allowed by the TWAN-Access-Info AVP explicitly matching the HESSID of the selected Trusted WLAN identifier (i.e. TWAN-Access-Info including a WLAN-Identifier AVP with the same HESSID and without SSID information);\nElse, if no match is found, the 3GPP AAA Server shall authorize the access methods allowed by the TWAN-Access-Info AVP explicitly matching the SSID of the selected Trusted WLAN identifier (i.e. TWAN-Access-Info including a WLAN-Identifier AVP with the same SSID and without HESSID information) ;\n-\totherwise, if the selected Trusted WLAN does not match explicitly any of the TWAN-Access-Info or if TWAN has not signalled the selected Trusted WLAN Identifier, the 3GPP AAA Server shall apply the access methods allowed by the \"wildcard\" TWAN-Access-Info AVP (i.e. TWAN-Access-Info AVP not including a WLAN-Identifier AVP) if any;\n-\totherwise, if the \"wildcard\" TWAN-Access-Info is not present, the 3GPP AAA Server shall consider that access to EPC and non-seamless WLAN Offload is not authorized.\n5)\tCheck if the user is not authorized to perform non-seamless WLAN Offload and, if the user is also barred from using the subscribed APNs, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED.\n6)\tIf present, check the flags of the received MIP6-Feature-Vector AVP:\n-\tIf the MIP6_INTEGRATED flag is set and the 3GPP AAA Server has authorized DHCP Home Agent assignment, the 3GPP AAA Server shall include the Home Agent addresses in the APN-Configuration AVP in the response and the MIP6-Feature-Vector AVP with the MIP6_INTEGRATED flag set. If the HA assignment via DHCPv6 is not used, the MIP6-Feature-Vector AVP with the MIP6_INTEGRATED flag not set shall be sent.\n-\tThe PMIP6_SUPPORTED and/or GTPv2 SUPPORTED flag indicates to the 3GPP AAA Server whether the trusted non-3GPP access network supports NBM or not. \n\nAs specified in 3GPP TS 23.402 [3], based on the information it has regarding the UE (see 3GPP TS 24.302 [26]), local/home network capabilities and local/home network policies, the 3GPP AAA Server may perform mobility mode selection between NBM and HBM. \nFor a trusted WLAN access, if the user is successfully authenticated and authorized for this access, the 3GPP AAA Server may either only authorize the user to access to EPC via S2a (i.e. EPC-routed service only), or only authorize the user to access the TWAN without granting access to EPC via S2a (i.e. non-seamless WLAN offload service only), or authorize both EPC-routed and non-seamless WLAN offload services, taking also into account the subscriber profile, access network, the selected WLAN identifier if present, and the TWAN's non-seamless WLAN offload capability if present, and the authorized mode of operation (TSCM, SCM or MCM). The 3GPP AAA Server may authorize both EPC-routed and non-seamless WLAN offload services only if the MCM is selected, or in non-roaming scenarios if the TSCM is selected; the 3GPP AAA Server shall not authorize both EPC-routed and non-seamless WLAN offload services if the SCM is selected or in roaming scenarios if the TSCM is selected. \n\nIf the 3GPP AAA Server decides that access to EPC is authorized and NBM should be used for such access, the PMIP6_SUPPORTED and GTPv2_SUPPORTED flags shall be set in the response to indicate that NBM is authorized for use for the UE by the trusted non 3GPP access network. If only the PMIPv6_SUPPORTED or the GTPv2_SUPPORTED flag is present in the response, the trusted non-3GPP access network shall assume that this also indicates that NBM is authorized for use. In addition, for a trusted WLAN access, the Non-seamless WLAN offload Authorization flag shall be set in the DEA-Flags AVP in the response if the non-seamless WLAN offload is authorized.\n\nIf the 3GPP AAA Server decides to only authorize the user to access the TWAN without granting access to EPC S2a (i.e. non-seamless WLAN offload service only), none of the flags (PMIP6_SUPPORTED, GTPv2_SUPPORTED, MIP4_SUPPORTED, MIP6_INTEGRATED, ASSIGN_LOCAL_IP) shall be set in the response, i.e. the Mobility Capabilities IE is not sent in the response, and the Non-seamless WLAN offload Authorization flag shall be set in the DEA-Flags AVP in the response.\nIf the 3GPP AAA Server decides that a local IP address should be assigned for HBM, the ASSIGN_LOCAL_IP flag shall be set in the response to indicate to the trusted non 3GPP access network that a local IP address (for HBM) should be assigned. \n\nThe 3GPP AAA Server shall not set the PMIP6_SUPPORTED/GTPv2_SUPPORTED and ASSIGN_LOCAL_IP flags both at the same time in the response.\n-\tThe MIP4_SUPPORTED flag indicates to the 3GPP AAA Server whether the trusted non-3GPP access network supports MIPv4 FA-CoA mode or not. As specified in 3GPP TS 23.402 [3], based on the information it has regarding the UE (see 3GPP TS 24.302 [26]), local/home network capabilities and local/home network policies, the 3GPP AAA Server may perform mobility mode selection. If the 3GPP AAA Server decides that MIPv4 FA-CoA mode should be used, the MIP4_SUPPORTED flag shall be set in the response.\nNOTE 3:\tWhen selecting DSMIPv6 the AAA server assumes that the trusted non 3GPP access gateway has the capability to assign a local IP address to the UE.\nFor Trusted WLAN access, the 3GPP AAA Server shall select the TWAN connection mode, i.e. either TSCM, SCM or MCM, taking into account the modes supported by the TWAN (as reported in the first DER message), those supported by the UE (as reported in the EAP payload, see 3GPP TS 24.302 [26]) and operator policy. The 3GPP AAA Server shall then indicate to the TWAN the TWAN connection mode it has selected, either explicitly using the Selected TWAN Connection Mode IE if it has selected SCM or MCM, or implicitly by not including the Selected TWAN Connection Mode IE if it has selected TSCM.\nFor Trusted WLAN access, if the 3GPP AAA Server has determined that the EAP-AKA' authentication is correct (i.e., the UE has sent a valid EAP-AKA' challenge response) and if the 3GPP AAA Server authorizes the SCM to be used for EPC access, the 3GPP AAA Server shall reply to the first DER message it receives with a result code set to DIAMETER_MULTI_ROUND_AUTH, leave the EAP-Payload AVP absent in the reply, and set the TWAN-S2a-Connectivity-Indicator bit to 1 in the DEA-Flags AVP; it shall also include in the response command all subscription-related parameters for the user, so the TWAN is able to proceed with the setup of the required S2a network connectivity (e.g., establishment of the GTP tunnel). After receiving a subsequent DER command from the TWAN, the 3GPP AAA Server shall check if the TWAN-S2a-Connectivity-Indicator is set, and if so, it may disregard the received EAP-Payload, since the EAP-AKA' challenge response has been already successfully checked. If the TWAN could not provide the requested S2a network connectivity and included a Session Management back-off timer in the DER command, the 3GPP AAA Server shall instruct the UE to not request new PDN connectivity to the same APN for the indicated time as specified in 3GPP TS 24.302 [26]. See Annex A.\nOnce the Authentication and Authorization procedure successfully finishes, the 3GPP AAA Server shall download, the authentication data, the list of authorized APN's if the UE did not indicate an Emergency Attach in EAP-AKA' signalling (see 3GPP TS 24.302 [26]), and the authorized mobility protocols in the authentication and authorization response from the HSS (see SWx procedure in Clause 8.1.2.1). If the Access Network Identity received in the Authentication and Authorization Request indicates WLAN (see clause 8.1.1.2 of 3GPP TS 24.302 [26]) and if the TSCM is selected, the 3GPP AAA Server shall set the Default APN in the Authentication and Authorization Answer to the Default APN for Trusted WLAN if received from the HSS, otherwise to the subscriber's Default APN for 3GPP and other non-3GPP accesses.\nFor a trusted WLAN access, if the user is authorized to access to EPC via S2a, and/or non-seamless WLAN offload via the selected WLAN, the 3GPP AAA Server shall send the user's Mobile Equipment Identity to the TWAN, if this information is available.\nOnce the Authentication and Authorization procedures successfully finish and if MIPv4 FACoA mode is used the 3GPP AAA Server shall calculate the MIPv4 FACoA mobility security parameters as defined in 3GPP TS 33.402 [19] and include these in the authentication and authorization response to the trusted non 3GPP access network.\nExceptions to the cases specified here shall be treated by 3GPP AAA Server as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authorization information shall be returned.\nFor Fixed Broadband access network, the 3GPP AAA Server shall determine if the UE is connected via a BBF-defined WLAN access according to the Transport-Access-type AVP. If the UE is connected via a BBF-defined WLAN access, the 3GPP AAA Server shall perform the enabling of the UE reflective QoS function as specified in 3GPP TS 24.139 [43].\nNOTE 4:\tThis behaviour is applicable for both fixed broadband access interworking and the fixed broadband access convergence. The architecture of fixed broadband access interworking is specified in 3GPP TS 23.139 [39]. The architecture of the fixed broadband access convergence is specified in 3GPP TS 23.203 [45].\nIf the 3GPP AAA Server supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]), the 3GPP AAA Server shall proceed as specified above, but with the following modifications, for an Emergency Attach:\n1)\tThe 3GPP AAA Server shall reject the Authentication and Authorization Request and set the result code to DIAMETER_UNABLE_TO_COMPLY if the TWAN does not indicate support of IMS Emergency sessions in the DER-Flags AVP in the request.\n2)\tIf the UE does not have an IMSI:\n-\tif local policies allow emergency sessions for all UEs, the 3GPP AAA Server shall skip the procedures defined for the SWx interface to obtain access authentication and authorization data, shall skip the authorization checkings and shall authorize the UE to access to EPC for emergency services. The Permanent User Identity IE in the answer shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set to DIAMETER_ERROR_USER_UNKNOWN.\n3)\tIf the UE has an IMSI but the IMSI is not authenticated:\n-\tif local policies allow emergency sessions for unauthenticated UEs with an IMSI, the 3GPP AAA Server shall skip the procedures defined for the SWx interface to obtain access authorization data, shall skip the authorization checkings, shall request the UE to provide its IMEI as specified in clause 13.4 of 3GPP TS 33.402 [19] and shall authorize the UE to access to EPC for emergency services. The Permanent User Identity IE in the answer shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set as specified for authentication failures in this clause.\n4)\tIf the UE has an authenticated IMSI but the UE is not authorized to access the EPC:\n-\tif local policies allow emergency sessions for any authenticated UE, the 3GPP AAA Server shall authorize the UE to access to EPC for emergency services;\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set as specified for authorization failures in this clause.\n5)\tWhen authorizing a UE to access to EPC for emergency services, the 3GPP AAA Server:\n-\tshall set the Emergency-Indication bit of the Emergency-Services IE in the answer;\n-\tshall not allow the use of non-seamless WLAN offload services.\nIn addition, if the 3GPP AAA Server supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]), the 3GPP AAA Server shall also include the Emergency Info IE in the Authentication and Authorization Answer, for emergency and non-emergency Attach, if this information was received from the HSS, the user is not roaming, the TWAN indicated support of IMS Emergency sessions and the Result-Code AVP is set to either:\n-\tDIAMETER_SUCCESS or\n-\tDIAMETER_MULTI_ROUND_AUTH and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\nOnce the Authentication and Authorization procedures successfully finish, if a domain-specific re-authentication key was requested and the use of ERP is authorized for this user based on subscription parameter, the 3GPP AAA Server which support ERP shall derive the DSRK from the EMSK and the domain name received in the request as specified in IETF RFC 6696[55] and shall include the DSRK, the EMSKname, and optionally the DSRK lifetime in the authentication and authorization response to the non-3GPP access network.\nOtherwise, when the 3GPP AAA Server does not support ERP, the domain-specific re-authentication key request is ignored if present in the authentication and authorization request.\nBased on operator policy, if the 3GPP AAA Server receives a DER command with a High-Priority-Access-Info AVP with the HPA_Configured bit set from the TWAN, the 3GPP AAA server shall treat the message with priority as specified in Annex C and Annex D.\nNOTE 5:\tAlternatively, the 3GPP AAA Server can give priority to this UE after the network has successfully authenticated the UE as described in clause 8.1.2.3.3, at which time the 3GPP AAA Server handles all subsequent messages with priority.\nBased on operator policy, the 3GPP AAA Server may include within the DEA command the MPS-Priority AVP with the MPS-EPS-Priority bit set to the TWAN if the 3GPP AAA Server has received an MPS-Priority AVP with the MPS-EPS-Priority bit set from the HSS. The 3GPP AAA Server shall treat the message and all subsequent messages (if authentication is successful) for the UE with priority as specified in Annex C and Annex D. The 3GPP AAA Server shall discontinue priority treatment for the UE if the 3GPP AAA Server receives a Non-3GPP-User-Data AVP from the HSS without the MPS-Priority AVP with the MPS-EPS-Priority bit set and the last DER command received by the 3GPP AAA Server from the TWAN did not contain a High-Priority-Access-Info AVP with the HPA_Configured bit set.\nNOTE 6:\tThe 3GPP AAA Server treats the UE with priority if either the DER command from the TWAN indicates high priority access or the HSS has indicated an MPS subscription for the UE.\nThe 3GPP AAA Proxy is required to handle roaming cases in which the non-3GPP access network is connected to a VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy, with the following additions.\nIf IMEI check is required by operator policy and the TWAN is in the VPLMN, the 3GPP AAA Proxy shall:\n-\tset the IMEI-Check-Required-In-VPLMN bit in the first Authentication and Authorization Request message sent to the 3GPP AAA Server;\n-\tupon receipt of a subsequent DER message with the IMEI-Check-Request-in-VPLMN bit set to 1 in the DER-Flags AVP,\n-\tif the IMEI(SV) is available, check the Mobile Equipment's identity status towards the EIR, using the ME Identity Check procedure (see clause 11);\n-\tupon getting the IMEI check result from the EIR, determine whether to continue or stop the authentication and authorization procedure;\n-\tif the IMEI(SV) is not available, determine whether to continue or stop the authentication and authorization procedure based on operator policy;\n-\tsend the result of the IMEI check to the 3GPP Server in the IMEI-Check-In- VPLMN-Result AVP.\nSpecific operator policies may be configured for emergency services, regarding whether to check the IMEI and, if the IMEI needs to be checked, whether to continue or stop the authentication and authorization procedure upon getting the IMEI check result or when the IMEI(SV) is not available.\nSee Annex A.2.3 and A.3.2.\nOn receipt of an authentication and authorization request, the 3GPP AAA Proxy\n-\tshall check the Visited-Network-Identifier AVP,\n-\tIf the AVP is not present, the 3GPP AAA Proxy shall insert it before forwarding the request to the 3GPP AAA Server.\n-\tIf the AVP is present, the 3GPP AAA Proxy may check and overwrite its value, depending on its local policy, e.g. the trusted non-3GPP access network is being operated by the VPLMN operator or by a third party.\n-\tshall check the ANID AVP. If the result of the checking shows that the included ANID value is not valid (not defined by 3GPP) or that the requesting entity is not entitled to use the received value, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and the authentication response shall be sent to the trusted non-3GPP access network.\n-\tmay take a decision about the trustworthiness of the non-3GPP access from VPLMN's point of view. If such decision is taken, it shall be based on the Access Network Identifier and optionally, on further information about the non-3GPP access network, according to the 3GPP AAA Proxy's local policies. These local policies shall reflect the security criteria described in 3GPP TS 33.402 [19], with the assumption that the PDN GW will be allocated in the VPLMN.\nNOTE 1:\tFor example, if hop-by-hop security relationship exists between the NAS and the 3GPP AAA Proxy, the 3GPP AAA Proxy may use the Origin-Host AVP to uniquely identify the NAS and the access network.\nThe decision about the trustworthiness of the non-3GPP access network is encoded to the VPLMN trust relationship indicator that is inserted to the authentication and authorization request.\nOn receipt of the first authentication and authorization request, the 3GPP AAA Proxy shall check locally configured information whether users from the HPLMN are allowed to activate a PDN connection from the non-3GPP access network via this (V)PLMN. If not, the Experimental-Result-Code shall be set to DIAMETER_ERROR_ROAMING_NOT_ALLOWED and the authentication and authorization response shall be sent to the non-3GPP access network.\nNOTE 2:\tIt is assumed that there is a roaming agreement between the non-3GPP access network and the VPLMN.\nOn receipt of the first authentication and authorization request, a 3GPP AAA Proxy which supports ERP may check whether ERP is supported by the non-3GPP access network. If the non-3GPP access network supports ERP and there is an ER server requesting a domain-specific re-authentication key in the authentication and authorization request, the 3GPP AAA Proxy may not authorize it based on locally configured information, remove the domain-specific key request before forwarding the request. If the non-3GPP access network supports ERP and there is no ER server in the non-3GPP access network or if the ER server in the non-3GPP access network was not authorized based on locally configured information, the 3GPP AAA Proxy may act as ER server and include the domain-specific re-authentication key request into the first authentication and authorization request forwarded to the 3GPP AAA server.\nOn receipt of the authentication and authorization answer that completes a successful authentication, the 3GPP AAA Proxy\n-\tmay check locally configured information about using the chained S8-S2a option towards the given HPLMN. If chaining is required, the 3GPP AAA Proxy shall select a Serving GW from its network configuration database and shall include the Serving GW address in the answer.\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authentication and Authorization Successful).\n-\tmay check if ERP keying material is provided in the answer in response to the domain-specific re-authentication key requested by the 3GPP AAA Proxy acting as an ER server. If it is, the 3GPP AAA Proxy shall remove the ERP keying material from the answer forwarded to the non-3GPP access network and store the DSRK, the EMSKname and the DSRK lifetime. If there is no ERP keying material and the DEA-Flag does not indicate that ERP is supported by the 3GPP AAA Server, the 3GPP AAA Proxy shall not forward any ERP related messages to the 3GPP AAA Server.\n-\tshall forward the ERP keying material to the TWAN if received from the 3GPP AAA Server and the ER server is located in the TWAN.\nThe trusted non-3GPP access network shall initiate the Trusted non-3GPP Access Authentication and Authorization procedure when the user attaches to the access network. During the authentication, it shall act as a pass-through EAP authenticator.\nIf the IMEI-Check-Request-In-VPLMN bit is set in the DEA-Flags AVP of the DEA message, the TWAN shall request the 3GPP AAA Proxy to check the IMEI, by setting the IMEI-Check-Request-In-VPLMN bit in the DER-Flags AVP and including the IMEI(SV) in the DER message. See Annex A.2.3 and A.3.2.\nIf PMIPv6, GTPv2 or MIPv4 FACoA is used, at successful completion of the procedure, the trusted non-3GPP access network shall store the non-3GPP user data received from the 3GPP AAA Server. The trusted non-3GPP access network shall utilize these data\n-\tTo authorize the APNs received in PDN connection creation request from the UE;\n-\tTo authorize the requested home address types: IPv4 home address and/or IPv6 home network prefix;\n-\tTo check if the UE requested APN is authorized as such or based on the wildcard APN.\nNOTE 1:\tThe user will be allowed to create PDN connections only to the subscribed APNs and use the address types that are allowed by the subscribed PDN types.\nIf DSMIPv6 is used and if the trusted non-3GPP access network has received the PGW identity in form of the FQDN from the 3GPP AAA Server, then the trusted non-3GPP access network may obtain the IP address of the Home Agent functionality of that PGW as described in 3GPP TS 29.303 [34].\nIf MIPv4 FACoA is used and if the non-3GPP access network has received FA-RK-SPI and FA-RK from the 3GPP AAA Server , the trusted non-3GPPaccess network will use FA-RK key and FA-RK-SPI to further derive MN-FA shared key and MN-FA-SPI, as defined in 3GPP TS 33.402 [19]. These are used to process the MN-FA Authentication Extension in the RRQ/RRP messages if the extension is present.\nIf the subscriber is not roaming and the SIPTO-Permission information for an APN is present, the HSGW shall allow SIPTO for that APN only if the SIPTO-Permission information indicates so. If the subscriber is not roaming and the SIPTO-Permission information for an APN is not present, the HSGW may allow SIPTO for that APN. If the subscriber is roaming and the SIPTO-Permission information for an APN is present, the HSGW shall allow SIPTO for that APN only if the SIPTO-Permission information indicates so and the VPLMN Dynamic Address is allowed and the HSGW selects a PDN GW in the VPLMN. For the requested APN allowed for SIPTO, the trusted non-3GPP access network may use the 3GPP DNS mechanism to select a PGW which is close to the HSGW. Detailed behaviour is specified in 3GPP2 X.S0057 [25], 3GPP TS 23.402 [3] and 3GPP TS 29.303 [34].\nFor optimized handover of an emergency session from E-UTRAN to an S2a based cdma2000® HRPD access network, if the trusted non-3GPP access network supports Emergency services for users in limited service state, then the trusted non-3GPP access network shall skip the authentication procedure (for users without an IMSI or with an IMSI marked as unauthenticated); or if the trusted non-3GPP access network accepts that the authentication may fail (for users with an IMSI), it shall continue with the procedure. For these cases, the trusted non-3GPP access network shall release any non-emergency PDN connections.\nThe TWAN decides the S protocol variant to use if access to EPC is authorized and the TWAN decides to establish S2a. The TWAN may be configured with the S2a protocol variant(s) on a per PLMN granularity, or may retrieve information regarding the S2a protocol variants supported by the PDN GW (PMIPv6 or/and GTPv2) from the Domain Name Service Function as described in 3GPP TS 29.303[34]. For static PDN GW assignment, in order to determine the PLMN of the PDN GW, the TWAN may use the Visited Network Identifier, if received from the 3GPP AAA Server, or the FQDN of the PDN GW, if included in the MIP6-Agent-Info AVP of the APN in use; if none of them are available, it may use the PLMN where the 3GPP AAA Server is located. If the TWAN supports Dedicated Core Networks and receives the UE-Usage-Type from the 3GPP AAA Server, the TWAN shall select the PGW as specified in clause 5.8 of 3GPP TS 29.303 [34].\nFor Trusted WLAN access, the TWAN should attempt the establishment of the S2a connectivity if the 3GPP AAA Server authorizes the SCM to be used for EPC access and the 3GPP AAA Server answers the authentication request with a result code of DIAMETER_MULTI_ROUND_AUTH and with the TWAN-S2a-Connectivity-Indicator bit set to 1 in the DEA-Flags AVP. After completing the S2a network connectivity actions, the TWAN shall re-issue a new DER command including the last EAP-Payload sent in a former request, and setting the TWAN-S2a-Connectivity-Indicator bit to 1 in the DER-Flags AVP. If the requested connectivity has been granted, the TWAN shall also provide the 3GPP AAA Server with the connectivity parameters provided to the UE; otherwise, the TWAN should also provide a cause indicating why the requested connectivity could not be granted and may provide a Session Management back-off timer to be sent to the UE to instruct the UE to not request new PDN connectivity to the same APN for the indicated time.\nIf GTPv2 is used on S and if the Trace-Info AVP including Trace-Data has been received in the authorization response, the trusted non-3GPP access network shall send a GTPv2 Trace Session Activation message (see 3GPP TS 29.274 [38]) to the PGW to start a trace session for the user.\nIf the trusted non-3GPP access networkdetermines that a previously assigned 3GPP AAA Sever is unavailable, it may attempt to send a new authentication and authorization request to an alternate 3GPP AAA Server. If the trusted non-3GPP access network receives from this new server a redirect indication towards the former server (due to the HSS having stored the former 3GPP AAA Server identity), it shall terminate all previously existing sessions and PDN connections for that user, and it shall re-send again the request towards the new server, but it shall include the AAA-Failure-Indication AVP in the new request.\nIf the TWAN supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]), the TWAN shall:\n-\tset the Emergency-Capability-Indication bit in the DER-Flags AVP to indicate support of IMS emergency sessions to the 3GPP AAA Server (to be forwarded to the UE via EAP-AKA' signalling).\n-\tinterpret the receipt of an Emergency NAI for Limited Service State or an IMSI-based Emergency NAI from the UE, or the Emergency-Services AVP from the 3GPP AAA Server, with the Emergency-Indication bit set, as an indication that the UE requests to access the EPC for emergency services;\n-\tgive preferential treatment to UEs which access the EPC for emergency services, e.g. in scenarios including network overload;\n-\tuse its Emergency Configuration Data to determine the APN to be associated with the emergency PDN connection and possibly the PGW to use;\n-\tuse the PGW identified in the Emergency PGW Identity IE, during a handover of an emergency PDN connection to a trusted WLAN access, if this information is received from the 3GPP AAA Server, the user is a non-roaming authenticated user and the TWAN is configured to use a dynamic PGW for emergency services for such users;\n-\tproceed during an Emergency Attach for a UE without a UICC or with an authenticated IMSI as specified above with the following modifications, if local policies (related with local regulations) in the TWAN allows unauthenticated emergency sessions:\n-\tif the UE is UICC-less, the User Identity IE in the Authentication and Authorization Request shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\tif the Permanent User Identity IE in the answer contains an IMEI based NAI but the User Identity IE in the request did not contain an IMEI based NAI, the TWAN shall determine that the IMSI was not authenticated and proceed accordingly with the setup of the Emergency PDN connection over S2b (see 3GPP TS 29.274 [38]).\nBased on operator policy, when sending a DER command, the TWAN shall add a High-Priority-Access-Info AVP with the HPA_Configured bit set if the TWAN had received an indication from the UE that the UE has access priority in an EAP Response/ Identity message as described in 3GPP TS 24.302 [26]. The TWAN shall treat the message and all subsequent messages (if authentication is successful) for the UE with priority as specified in Annex C and Annex D.\nNOTE 2:\tAlternatively, the TWAN can give priority to this UE after the network has successfully authenticated the UE as described in clause 8.1.2.3.3, at which time the TWAN handles all subsequent messages with priority.\nBased on operator policy, upon receiving a DEA command marked with a success code and with the MPS-Priority AVP with the MPS-EPS-Priority bit set, the TWAN shall treat the UE with priority, e.g., as defined in Annex B, Annex C and Annex D. The TWAN shall discontinue priority treatment for the UE if the TWAN receives a Non-3GPP-User-Data AVP without an MPS-Priority AVP with the MPS-EPS-Priority bit set and the last DER command received by the TWAN did not contain an indication from the UE that the UE has access priority in an EAP Response/Identity message as described in 3GPP TS 24.302 [26].\nNOTE 3:\tThe TWAN treats the UE with priority if either the indication that the UE has access priority in an EAP Response/Identity message or the HSS has indicated an MPS subscription for the UE.\nThis procedure is used between the 3GPP AAA/HSS and the trusted non-3GPP access network to instruct the non-3GPP access network to detach a specific user from the access network. The procedure is based on Diameter session abort messages.\nDiameter usage over the STa interface:\n-\tThis procedure is mapped to the Diameter command codes Diameter-Abort-Session-Request (ASR), Diameter-Abort-Session-Answer (ASA), Diameter-Session-Termination-Request (STR) and Diameter-Session-Termination-Answer (STA) specified in IETF RFC 6733 [58]. Information element contents for these messages are shown in tables 5.1.2.2.1/1 and 5.1.2.2.1/2.\n-\tThe STa application id value of 16777250 shall be used as the Application Id in ASR/ASA/STR/STA commands.\nTable 5.1.2.2.1/1: Information Elements passed in ASR message\n\nTable 5.1.2.2.1/2: Information Elements passed in ASA message\n\nTable 5.1.2.2.1/3: Information Elements passed in STR message\n\nTable 5.1.2.2.1/4: Information Elements passed in STA message\n\nThe 3GPP AAA Server shall make use of this procedure to instruct the Non-3GPP access network to detach a specific user from the access network.\nIn the DSMIPv6 case, the 3GPP AAA Server shall initiate first the detach procedure over the S6b reference point towards the PDN GW. When this process has finalized, the 3GPP AAA Server can initiate the detach procedure of the UE from the non-3GPP access network.\nThe 3GPP AAA Server shall include the Auth-Session-State AVP in the ASR command with a value of NO_STATE_MAINTAINED if it does not require a STR from the Non-3GPP access network. If it does require a STR from the Non-3GPP access network, the 3GPP AAA Server shall either omit the Auth-Session-State AVP from the ASR command or include the Auth-Session-State AVP in the ASR command with a value of STATE_MAINTAINED.\nOn receipt of the ASR command, the Non-3GPP access network shall check if the user is known in the Non-3GPP access network. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\nIf the user is known, the Non-3GPP access network shall perform the disconnection of all the PDN connections active for this user and remove any stored user information, except for emergency PDN connections which shall remain active, if the trusted Non-3GPP access supports Emergency services for users in limited service state.\nThe Non-3GPP access network shall set the Result-Code to DIAMETER_SUCCESS and send back the ASA command to the 3GPP AAA Server, which shall update the status of the subscriber on the detached access network.\nIf required by the 3GPP AAA Server, the Non-3GPP access network shall send an STR with the Termination-Cause set to DIAMETER_ADMINISTRATIVE. The 3GPP AAA Server shall set the Result-Code to DIAMETER_SUCCESS and return the STA command to the Non-3GPP access network.\nWhen the 3GPP AAA Proxy receives the ASR from the 3GPP AAA Server it shall route the request to the non-3GPP access network.\nIf the 3GPP AAA Proxy requires an STR but the 3GPP AAA Server does not, the 3GPP AAA Proxy may override the value of the Auth-Session-State AVP in the ASR and set it to STATE_MAINTAINED. In this case, the 3GPP AAA Proxy shall not forward the STR received from the non-3GPP access network onto the 3GPP AAA Server and shall return an STA command to the non-3GPP access network with the Result-Code set to DIAMETER_SUCCESS. The 3GPP AAA Proxy shall not override the value of the Auth-Session-State AVP under any other circumstances.\nOn receipt of the ASA message with Diameter Result Code set to DIAMETER_SUCCESS, the 3GPP AAA Proxy shall route the successful response to the 3GPP AAA Server and shall release the resources associated with the session.\nWhen the 3GPP AAA Proxy receives the STR from the Non-3GPP access network, it shall route the request to the 3GPP AAA Server. On receipt of the STA message, the 3GPP AAA Proxy shall route the response to the Non-3GPP access network.\nThe STa Re-Authorization procedure shall be used between the 3GPP AAA Server and the trusted non-3GPP access network for enabling:\n-\tthe 3GPP AAA Server to modify the previously provided authorization parameters. This may happen due to a modification of the subscriber profile in the HSS (for example, removal of a specific APN associated with the subscriber, or change of the identity of a dynamically allocated PDN GW, or change of the identity of a dynamically allocated PDN GW for emergency services, see clause 8.1.2.3). In this case, this procedure is performed in two steps:\n-\tThe 3GPP AAA server shall issue an STa Re-Auth request towards the trusted non-3GPP access network. Upon receipt of such a request, the trusted non-3GPP access network shall respond to the request and shall indicate the disposition of the request. This procedure is mapped to the Diameter command Re-Auth-Request and Re-Auth-Answer specified in IETF RFC 6733 [58]. Information element contents for these messages are shown in tables 5.1.2.3.1/1 and 5.1.2.3.1/2.\n-\tUpon receiving the STa Re-Auth request, the non-3GPP access network shall immediately invoke the STa access authorization procedure, based on the reuse of the Diameter command codes AA-Request and AA-Answer commands specified in IETF RFC 4005 [4]. Information element contents for these messages are shown in tables 5.1.2.3.1/3 and 5.1.2.3.1/4.\n-\tthe trusted non-3GPP access network to retrieve the subscriber profile from the HSS. This procedure may be initiated at any time by the Trusted non-3GPP access network for check if there is any modification in the user authorization parameters previously provided by the 3GPP AAA Server. In this one-step procedure, the trusted non-3GPP access network shall invoke the STa access authorization procedure, based on the reuse of the Diameter commands AA-Request and AA-Answer commands IETF RFC 4005 [4]. Information element contents for these messages are shown in tables 5.1.2.3.1/3 and 5.1.2.3.1/4.\nAfter receiving the authorization answer, the trusted non-3GPP access network will release the active PDN connections, for which the authorization has been revoked. If the authorization was rejected by the 3GPP AAA server (e.g. because the user's subscription for non-3GPP accesses has been terminated), the non-3GPP access network shall detach the user from the non-3GPP access network and release all resources. If an emergency PDN connection is active and the trusted non-3GPP access supports emergency services for users in limited service state, the non-3GPP access network shall keep the user attached in the non-3GPP access and the emergency PDN connection active. The non-emergency resources shall be released.\nThe STa Re-Authentication procedure shall be used between the 3GPP AAA Server and the trusted non-3GPP access network for re-authenticating the user. This procedure may be initiated at any time by the 3GPP AAA Server based on HPLMN operator policies configured in the 3GPP AAA server. This procedure is performed in two steps:\n-\tThe 3GPP AAA server issues an STa Re-Auth request towards the trusted non-3GPP access. Upon receipt of such a request, the trusted non-3GPP access network shall respond to the request and indicate the disposition of the request. This procedure is mapped to the Diameter command Re-Auth-Request and Re-Auth-Answer specified in IETF RFC 6733 [58]. Information element contents for these messages are shown in tables 5.1.2.3.1/1 and 5.1.2.3.1/2.\n-\tUpon receiving the STa Re-Auth request, the trusted non-3GPP access network shall immediately invoke the STa Access Authentication and Authorization procedure, based on the Re-Auth Request Type provided by the 3GPP AAA server. This procedure is mapped to the Diameter command codes based on the reuse of the Diameter commands Diameter-EAP-Request and Diameter-EAP-Answer specified in IETF RFC 4072 [5]. Information element contents for these messages are shown in tables 5.1.2.3.1/5 and 5.1.2.3.1/6.\nIf the re-authentication of the user is not successful, the trusted non-3GPP access network will release all the active PDN connections of the user, except for emergency PDN connections which shall remain active if the trusted non-3GPP access network supports Emergency services for users in limited service state. After a successful authentication and authorization procedure, the trusted non-3GPP access network shall release the active PDN connections for which the authorization has been revoked.\nTable 5.1.2.3.1/1: STa Re-Auth request\n\nTable 5.1.2.3.1/2: STa Re-Auth response\n\nTable 5.1.2.3.1/3: STa Authorization Request\n\nTable 5.1.2.3.1/4: STa Authorization response\n\nTable 5.1.2.3.1/5: STa Access Authentication and Authorization Request\n\nTable 5.1.2.3.1/6: Trusted non-3GPP Access Authentication and Authorization Answer\n\nHandling of Re-Auth Request:\nThe 3GPP AAA Server shall make use of this procedure to indicate the following:\n-\tIf the relevant service authorization information shall be updated in the Trusted non-3GPP access network, the Re-Auth-Request-Type shall be set to AUTHORIZE_ONLY. This procedure may be triggered by the HSS sending a subscription data update (refer to clause 8.1.2.3) or by local policies, e.g. periodic re-authorization configured by the operator. As for the STa reference point, only a single Diameter authorization session is used for a user, this procedure is initiated for all the PDN connections of this user, i.e. a single instance of Re-authorization Request shall be used per user.\n-\tIf the re-authentication and re-authorization of the user shall be executed, the Re-Auth-Request-Type shall be set to AUTHORIZE_AUTHENTICATE. This procedure may be triggered e.g. by the expiration of a timer started at the successful completion of the last (re-)authentication of the user, depending on the local policies configured in the 3GPP AAA Server.\nHandling of Authorization Request:\nThe 3GPP AAA Server shall check that the user exists in the 3GPP AAA Server. The check shall be based on Diameter Session-Id. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN. If the user exists, the 3GPP AAA Server shall perform the authorization checking described in clause 5.1.2.1.2.\nIf the Authorization request contained the MIP6-Feature-Vector with the OPTIMIZED_IDLE_MODE_MOBILITY flag set, the 3GPP AAA server shall request the user data from the HSS, in order to retrieve up-to-date PDN GW information.\nHandling of Authentication and Authorization Requests:\nThe 3GPP AAA Server shall execute the re-authentication of the user, using a full authentication or fast re-authentication, as described in 3GPP TS 33.402 [19], clause 6.2 and 6.3. If full authentication is executed and there are no valid authentication vectors for the given non-3GPP access network available in the 3GPP AAA Server, it shall fetch authentication vectors from the HSS. A combined authentication and authorization shall be executed, with reduced message content described in Tables 5.1.2.3.1/5 and 5.1.2.3.1/6. The QoS-Capability, Access Network Identity, Access Type, Visited Network Identifier, Terminal Information elements received during the initial authentication and authorization procedure as well as the trustworthiness of the non-3GPP AN and the IP mobility mode selected during that procedure shall be considered as valid. If re-authentication of the user is successful and MIPv4 FACoA mode is used the 3GPP AAA Server shall create the MIPv4 FACoA security parameters as defined in 3GPP TS 33.402 [19].\nIf the re-authentication of the user is unsuccessful, the 3GPP AAA Server shall:\n-\tTerminate all S6b authorization sessions connected to the user, as described in clause 9.1.2.4\n-\tRemove all APN-PDN GW bindings from the HSS, as described in clauses 8.1.2.2.2.1 and 8.1.2.2.2.2.\n-\tDe-register the user from the HSS, as described in clauses 8.1.2.2.2.1 and 8.1.2.2.2.2. Depending on the cause of the re-authentication being unsuccessful, the Server Assignment Type shall be set to AUTHENTICATION_FAILURE or AUTHENTICATION_TIMEOUT.\n-\tRelease all resources connected to the user.\nThe 3GPP AAA Proxy is required to handle roaming cases in which the Non-3GPP access network is in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy, with the following additions.\nWhen forwarding the authorization answer or the authentication and authorization answer, the 3GPP AAA Proxy\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authentication and Authorization Successful).\nUpon receiving the re-auth request, the Trusted non-3GPP access network shall perform the following checks and if an error is detected, the non-3GPP access network shall stop processing the request and return the corresponding error code.\nCheck the Re-Auth–Request-Type AVP:\n1)\tIf it indicates AUTHENTICATE_ONLY, Result-Code shall be set to DIAMETER_INVALID_AVP_VALUE.\n2)\tIf it indicates AUTHORIZE_AUTHENTICATE, the authentication and authorization of the user is initiated, as defined in 3GPP TS 33.402, with the Diameter message contents described by Tables 5.1.2.3.1/5 and 5.1.2.3.1/6.\n3)\tIf it indicates AUTHORIZE_ONLY, the non-3GPP access network shall just perform an authorization procedure as described by Tables 5.1.2.3.1/3 and 5.1.2.3.1/4.\nAfter successful authorization or authentication and authorization procedure, the trusted non-3GPP access network shall overwrite, for the subscriber identity indicated in the request and the received session, the current authorization information with the information received from the 3GPP AAA Server.\nFor the TWAN access, if the TWAN receives the PDN GW Identity from 3GPP AAA Server which is different from the currently selected PDN GW for the same APN, the TWAN shall not tear down the existing PDN connection.\nIf the TWAN supports Dedicated Core Networks and receives the UE-Usage-Type from the 3GPP AAA Server, the TWAN shall select the PGW as specified in clause 5.8 of 3GPP TS 29.303 [34] for new PDN connections.\nThe release of a PDN connection shall be initiated if the user's subscription for the APN belonging to an active PDN connection has been terminated.\nIf the authorization or authentication and authorization procedure was unsuccessful, the non-3GPP access network shall detach the user from the non-3GPP access and release all resources. If the trusted non-3GPP access supports emergency services for users in limited service state, and there is an emergency PDN connection active for such user, the non-3GPP access network shall keep the user attached in the non-3GPP access and the emergency PDN connection active. The non-emergency resources shall be released.\nThe Trusted Non-3GPP access network shall initiate the re-authorization of the user in a one-step procedure (i.e. without receiving a re-authorization request from the AAA Server) if the PDN GW information needs to be updated for optimized idle mode mobility from E-UTRAN to HRPD access.\nIf GTPv2 is used on S2a and if the Trace-Info AVP including Trace-Data has been received in the authorization response, the trusted non-3GPP access network shall send a GTPv2 Trace Session Activation message (see 3GPP TS 29.274 [38]) to the PGW to start a trace session for the user. If the Trace-Info AVP including Trace-Reference (directly under the Trace-Info) has been received in the authorization response, the trusted non-3GPP access network shall send a GTPv2 Trace Session Deactivation message to the PGW to stop the ongoing trace session, identified by the Trace-Reference. For details, see 3GPP TS 32.422 [32].\nFor the TWAN access, the TWAN shall send the identification, location information of the Access Point where the UE is attached, and the local time zone of the UE, in the authorization request towards the 3GPP AAA Server that follows a re-authorization request issued by the 3GPP AAA Server to the TWAN.\nThe STa reference point allows the non-3GPP access network to inform the 3GPP AAA server that the session resources of the non-3GPP access network assigned to a given user are being released.\nThe procedure shall be initiated by the non-3GPP access network and removes non-3GPP access information from the 3GPP AAA Server. These procedures are based on the reuse of Diameter STR and STA commands as specified in IETF RFC 6733 [58].\nTable 5.1.2.4.1/1: STa Session Termination Request\n\nTable 5.1.2.4.1/2: STa Session Termination Answer\n\nUpon reception of the Session Termination Request message from the non-3GPP access network, the 3GPP AAA Server shall check that there is an ongoing session associated to the two parameters received (Session-Id and User-Name).\nIf an active session is found and it belongs to the user identified by the User-Name parameter, the 3GPP AAA Server shall deregister itself as the managing 3GPP AAA Server for the subscriber following the procedures listed in 8.1.2.2.2. In case of a deregistration success, the 3GPP AAA Server shall release the session resources associated to the specified session and a Session Termination Response shall be sent to the non-3GPP access network, indicating DIAMETER_SUCCESS. If deregistration from the HSS fails, the 3GPP AAA Server shall return a Session-Termination Response with the Diameter Error DIAMETER_UNABLE_TO_COMPLY.\nOtherwise, the 3GPP AAA Server returns a Session Termination Response with the Diameter Error DIAMETER_UNKNOWN_SESSION_ID\nThe 3GPP AAA Proxy is required to handle roaming cases in which the non-3GPP access network is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the Session Termination Request message from the non-3GPP access network, the 3GPP AAA Proxy shall route the message to the 3GPP AAA Server.\nOn receipt of the Session Termination Answer message from the 3GPP AAA Server, the 3GPP AAA Proxy shall route the message to the non-3GPP access network and it shall release any local resources associated to the specified session only if the result code is set to DIAMETER_SUCCESS.\nThe STa reference point allows the non-3GPP access network to perform re-authentication using ERP.\nERP allows the UE and the ER server to mutually verify proof of possession of key material derived from a previous successful EAP authentication and to establish a security association between the UE and the non-3GPP access network.\nWhen this procedure is used, the ER server is collocated either with a TWAP or the 3GPP AAA Proxy or the 3GPP AAA Server. When the ER is located in the TWAP, ERP re-authentication procedures are out of the scope of this specification.\nWhen ERP is used, the ERP re-authentication procedure shall be mapped to the Diameter-EAP-Request and Diameter-EAP-Answer command codes specified in IETF RFC 4072 [5].\nTable 5.1.2.5.1/1: STa ERP Re-authentication Request\n\nTable 5.1.2.5.1/2: STa ERP Re-authentication Answer\n\nUpon reception of the ERP re-authentication request from the non-3GPP access network, the 3GPP AAA Proxy or the 3GPP AAA Server acting as ER server shall search in its local database for a valid, unexpired root key matching the keyName part of the KeyName-NAI.\nIf the root key is not found, the 3GPP AAA Proxy or 3GPP AAA Server shall set the Result-Code to DIAMETER_UNABLE_TO_COMPLY and the answer shall include an EAP-Payload AVP encapsulating an EAP Failure indicating that the ERP re-authentication has failed.\nIf such root key is found, the 3GPP AAA Server shall generate the ERP keying material as described in IETF RFC 6696 [55], shall include the requested ERP keying material in the answer and the result code shall be set to DIAMETER_SUCCESS.\nNOTE:\tOnly the ERP Implicit Bootstrapping mode defined in IETF RFC 6696 [55] is supported in this release.\nUpon reception of the ERP authentication request from the non-3GPP access network, the 3GPP AAA Proxy shall check if the realm part of the KeyName-NAI is its own domain name. If not, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nIf the keyName part of the KeyName-NAI is its own domain name, the 3GPP AAA Proxy shall behave as described in clause 5.1.2.5.2.\nNOTE:\tIn roaming case, the location of the ER server in the home 3GPP AAA Server is not supported in this release.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.1.2.1/1: STa Access Authentication and Authorization Request",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.1/2: Trusted non-3GPP Access Authentication and Authorization Answer",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.2.1/1: Information Elements passed in ASR message",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.2.1/2: Information Elements passed in ASA message",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.2.1/3: Information Elements passed in STR message",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.2.1/4: Information Elements passed in STA message",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.3.1/1: STa Re-Auth request",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.3.1/2: STa Re-Auth response",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.3.1/3: STa Authorization Request",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.3.1/4: STa Authorization response",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.3.1/5: STa Access Authentication and Authorization Request",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.3.1/6: Trusted non-3GPP Access Authentication and Authorization Answer",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.4.1/1: STa Session Termination Request",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.4.1/2: STa Session Termination Answer",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.5.1/1: STa ERP Re-authentication Request",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.1.2.5.1/2: STa ERP Re-authentication Answer",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "5.2\tProtocol Specification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tGeneral",
                            "text_content": "The STa reference point shall be based on Diameter, as defined in IETF RFC 6733 [58], and contain the following additions and extensions:\n-\tIETF RFC 4005 [4], which defines a Diameter protocol application used for Authentication, Authorization and Accounting (AAA) services in the Network Access Server (NAS) environment.\n-\tIETF RFC 4072 [5], which provides a Diameter application to support the transport of EAP (IETF RFC 3748 [8]) frames over Diameter.\n-\tIETF RFC 5779 [2], which defines a Diameter extensions and application for PMIPv6 MAG to AAA and LMA to AAA interfaces.\n-\tIETF RFC 5447 [6], which defines Diameter extensions for Mobile IPv6 NAS to AAA interface.\nIn the case of a trusted non-3GPP IP access where PMIPv6 is used as mobility protocol, the MAG to 3GPP AAA server or the MAG to 3GPP AAA proxy communication shall use the MAG to AAA interface functionality defined in IETF RFC 5779 [2] and the NAS to AAA interface functionality defined in IETF RFC 5447 [6].\nThe trusted non-3GPP access network to AAA interface functionality over the STa reference defines a new Application Id:\n-\t\"STa\" with value 16777250.\nThe STa application reuses existing EAP (IETF RFC 4072 [5]) application commands, command ABNFs, and application logic and procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tCommands",
                            "text_content": "The Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit set in the Command Flags field, is sent from a non-3GPP access network NAS to a 3GPP AAA server. The ABNF is re-used from the IETF RFC 5779 [2].\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Request-Type }\n{ EAP-Payload }\n[ User-Name ]\n[ Calling-Station-Id ]\n…\n[ RAT-Type ]\n[ ANID ]\n[ Full-Network-Name ]\n[ Short-Network-Name ]\n[ QoS-Capability ]\n[ MIP6-Feature-Vector ]\n[ Visited-Network-Identifier ]\n[ Service-Selection ]\n[ Terminal-Information ]\n[ OC-Supported-Features ]\n*[ Supported-Features ]\n[ AAA-Failure-Indication ]\n[ WLAN-Identifier ]\n[ DER-Flags ]\n[ TWAN-Connection-Mode ]\n[ TWAN-Connectivity-Parameters ]\n* 2 [ TWAG-CP-Address ]\n[ ERP-RK-Request ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]\n\nThe Diameter-EAP-Answer (DEA) command, indicated by the Command-Code field set to 268 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server to a non-3GPP access network NAS. The ABNF is re-used from the IETF RFC 5779 [2]. The ABNF also contains AVPs that are reused from IETF RFC 4072 [5].\n< Diameter-EAP-Answer > ::=\t< Diameter Header: 268, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Result-Code }\n[ Experimental-Result ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Auth-Request-Type }\n[ EAP-Payload ]\n[ User-Name ]\n[ Session-Timeout ]\n[ Accounting-Interim-Interval ]\n[ EAP-Master-Session-Key ]\n[ Context-Identifier ]\n[ APN-OI-Replacement ]\n*[ APN-Configuration ]\n[MIP6-Agent-Info ]\n[ MIP6-Feature-Vector ]\n[ Mobile-Node-Identifier ]\n[ 3GPP-Charging-Characteristics ]\n[ AMBR ]\n*[ Redirect-Host ]\n[ AN-Trusted ]\n[ Trace-Info ]\n[ Subscription-ID ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ Supported-Features ]\n[ MIP-FA-RK ]\n[ MIP-FA-RK-SPI ]\n[ NSWO-Authorization ]\n[ DEA-Flags ]\n[ TWAN-Connection-Mode ]\n[ TWAN-Connectivity-Parameters ]\n[ WLCP-Key ]\n[ Terminal-Information ]\n[ UE-Usage-Type ]\n[ Emergency-Services ]\n[ Emergency-Info ]\n[ Key ]\n[ ERP-Realm ]\n[ MPS-Priority ]\n…\n*[ AVP ]\n\nThe Abort-Session-Request (ASR) command, indicated by the Command-Code field set to 274 and the \"R\" bit set in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a non-3GPP access network NAS. ABNF for the ASR commands is as follows:\n< Abort-Session-Request >  ::=\t< Diameter Header: 274, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n[ User-Name ]\n[ Auth-Session-State ]\n…\n*[ AVP ]\n\nThe Abort-Session-Answer (ASA) command, indicated by the Command-Code field set to 274 and the \"R\" bit cleared in the Command Flags field, is sent from a non-3GPP access network NAS to a 3GPP AAA Server/Proxy. ABNF for the ASA commands is as follows:\n\n< Abort-Session-Answer >  ::=\t< Diameter Header: 274, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]\nThe Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from a trusted non-3GPP access network to a 3GPP AAA Server/Proxy. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58], Session-Termination-Request command.\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]\nThe Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a trusted non-3GPP access network. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58], Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]\nThe Diameter Re-Auth-Request (RAR) command, indicated by the Command-Code field set to 258 and the \"R\" bit set in the Command Flags field, is sent from a 3GPP AAA Server to a Trusted Non-3GPP access network. ABNF for the RAR command is as follows:\n\n< Re-Auth-Request >  ::=\t< Diameter Header: 258, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n{ Re-Auth-Request-Type }\n[ User-Name ]\n…\n*[ AVP ]\nThe Diameter Re-Auth-Answer (ASA) command, indicated by the Command-Code field set to 258 and the \"R\" bit cleared in the Command Flags field, is sent from a Trusted Non-3GPP access network to a 3GPP AAA Server/Proxy. ABNF for the RAA commands is as follows:\n\n< Re-Auth-Answer >  ::=\t< Diameter Header: 258, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]\nThe AA-Request (AAR) command, indicated by the Command-Code field set to 265 and the \"R\" bit set in the Command Flags field, is sent from a Trusted Non-3GPP access network to a 3GPP AAA Server/Proxy. The ABNF is re-used from IETF RFC 4005 [4], adding AVPs from IETF RFC 5779 [2].\n\n< AA-Request >  ::=\t< Diameter Header: 265, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n[ Destination-Host ]\n[ User-Name ]\n[ MIP6-Feature-Vector ]\n[ Access-Network-Info ]\n[ Local-Time-Zone ]\n\n[ OC-Supported-Features ]\n…\n*[ AVP ]\n\nThe AA-Answer (AAA) command, indicated by the Command-Code field set to 265 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a Trusted Non-3GPP access network. The ABNF is re-used from IETF RFC 4005 [4], adding AVPs from IETF RFC 5779 [2].\n< AA-Answer > ::=\t< Diameter Header: 265, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n[ Experimental-Result ]\n{ Origin-Host }\n{ Origin-Realm }\n[ Session-Timeout ]\n[ Accounting-Interim-Interval ]\n[ Context-Identifier ]\n[ APN-OI-Replacement ]\n*[ APN-Configuration ]\n[ 3GPP-Charging-Characteristics ]\n[ Trace-Info ]\n[ Subscription-ID ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n[ UE-Usage-Type ]\n[ Emergency-Info]\n*[ Load ]\n…\n*[ AVP ]\nRefer to clause 5.2.2.1.1\nRefer to clause 5.2.2.1.2\nThe Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from a non-3GPP access network to a 3GPP AAA server. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58], Session-Termination-Request command.\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]\nThe Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA server to a non-3GPP access network. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58], Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3\tInformation Elements",
                            "text_content": "The following table describes the Diameter AVPs defined for the STa interface protocol in NBM mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.\nTable 5.2.3.1/1: Diameter STa AVPs\n\nThe following table describes the Diameter AVPs re-used by the STa interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within STa. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol defined in IETF RFC 6733 [58], do not need to be supported.\nTable 5.2.3.1/2: STa re-used Diameter AVPs\n\nOnly those AVP initially defined in this reference point or AVP with values initially defined in this reference point and for this procedure are described in the following clause.\nThe Mobile-Node-Identifier AVP (AVP Code 506) is of type UTF8String.\nThe Mobile-Node-Identifier AVP is returned in an answer message that ends a successful authentication (and possibly an authorization) exchange between the AAA client and the AAA server. The returned Mobile Node Identifier may be used as the PMIPv6 MN-ID or as the MIPv4 MN-NAI or to derive the IMSI to be sent in GTPv2 signalling.\nThe Mobile-Node-Identifier is defined on IETF RFC 5779 [2].\nThe MIP6-Feature-Vector AVP (AVP Code 124) is of type Unsigned64 and contains a 64 bit flags field of supported mobile IP capabilities of the non-3GPP access network (when this AVP is used in the request commands) and the mobile IP capabilities the 3GPP AAA Server has authorized (when this AVP is used in the response commands).\nThe following capabilities are defined for STa interface:\n-\tMIP6_INTEGRATED (0x0000000000000001)\nThis flag is set by the non-3GPP access network and the 3GPP AAA Server. It means that the Mobile IPv6 integrated scenario bootstrapping functionality is supported.\n-\tPMIP6_SUPPORTED (0x0000010000000000)\nWhen this flag is set by the non-3GPP access network it indicates to the 3GPP AAA Server that it supports PMIPv6.\nWhen this flag is set by the 3GPP AAA Server it indicates to the non-3GPP access network that NBM shall be used.\n-\tASSIGN_LOCAL_IP (0x0000080000000000)\nThis flag is set by the 3GPP AAA Server.\nWhen this flag is set by the 3GPP AAA Server it indicates to the non-3GPP access network that the non-3GPP access network shall assign to the user a local IP address (for HBM).\n-\tMIP4_SUPPORTED (0x0000100000000000)\nThis flag is set by the non-3GPP access network, the PDN GW and the 3GPP AAA Server. When this flag is set by the non-3GPP access network it indicates to the 3GPP AAA Server that it supports MIPv4 FA-CoA mode. When this flag is set by the 3GPP AAA Server it indicates to the non-3GPP access network that MIPv4 FA-CoA mode shall be used. When this flag is set by the PDN GW and 3GPP AAA Server over the S6b interface, it shows that MIPv4 mobility protocol is used on the S2a interface.\n-\tOPTIMIZED_IDLE_MODE_MOBILITY (0x0000200000000000)\nThis flag is set by the Trusted Non-3GPP access network if the PDN GW information needs to be updated for the case of idle mode mobility from E-UTRAN to HRPD access.\n-\tGTPv2_SUPPORTED (0x0000400000000000)\nWhen this flag is set by the non-3GPP access network it indicates to the 3GPP AAA Server that it supports GTPv2.\nWhen this flag is set by the 3GPP AAA Server it indicates to the non-3GPP access network that NBM shall be used.\nThis AVP is FFS\nThe Service-Selection AVP is of type of UTF8String. This AVP contains an APN Network Identifier (i.e., an APN without the Operator Identifier), and it shall consist of one or more labels according to DNS naming conventions (IETF RFC 1035 [35]) describing the access point to the packet data network.\nThe contents of the Service-Selection AVP shall be formatted as a character string composed of one or more labels separated by dots (\".\").\nThe Service-Selection AVP is defined in IETF RFC 5778 [11].\nThe RAT-Type AVP (AVP code 1032) is of type Enumerated and is used to identify the radio access technology that is serving the UE. It follows the specification described in TS 29.212 [23].\nThe ANID AVP is of type UTF8String; this AVP contains the Access Network Identity; see 3GPP TS 24.302 [26] for defined values.\nPlease refer to 3GPP TS 29.272 [29] for the encoding of this AVP.\nThe AN-Trusted AVP (AVP Code 1503) is of type Enumerated.\nThe AN-Trusted AVP sent from the 3GPP AAA Server to the Non-3GPP access network conveys the decision about the access network being trusted or untrusted by the HPLMN.\nThe following values are defined:\nTRUSTED (0)\nThis value is used when the non-3GPP access network is to be handled as trusted.\nUNTRUSTED (1)\nThis value is used when the non-3GPP access network is to be handled as untrusted.\nThe syntax of this AVP is defined in 3GPP TS 29.229 [24]. For this release, the Feature-List-ID AVP value shall be set to 1 for the STa/SWa application.\nThe syntax of this AVP is defined in 3GPP TS 29.229 [24]. A null value indicates that there is no feature used by the STa/SWa application.\nNOTE:\tThere are no STa/SWa features defined for this release.\nThe MIP-FA-RK AVP is of type OctetString; this AVP contains the FA-RK used to calculate the security parameters needed for the MN-FA authentication extension as defined by 3GPP TS 33.402 [19].\nThe MIP-FA-RK-SPI AVP is of type Unsigned32; this AVP contains the security index used in identifying the security context for the FA-RK as defined by 3GPP TS 33.402 [19].\nThe Full-Network-Name AVP is of type OctetString; this AVP shall contain the Full Network Name and be encoded as the Full name value field of the AT_FULL_NAME_FOR_NETWORK attribute specified in clause 8.2.5.1 of 3GPP TS 24.302 [26].\nThe Short-Network-Name AVP is of type OctetString; this AVP shall contain the Short Network Name and be encoded as the Short name value field of the AT_SHORT_NAME_FOR_NETWORK attribute specified in clause 8.2.5.2 of 3GPP TS 24.302 [26].\nThe WLAN-Identifier AVP is of type Grouped. It contains the type and value of an IEEE 802.11 identifier of a Trusted WLAN.\nAVP Format:\nWLAN-Identifier ::=\t< AVP Header: 1509 10415 >\n[SSID ]\n[HESSID ]\n*[ AVP ]\nThe Transport-Acess-Type AVP (AVP code 1519) is of type Enumerated and is used to identify the transport access technology that is serving the UE.\nThe following values are defined:\nBBF (0)\nThis value shall be used to indicate a BBF transport access network.\nThe DER-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 5.2.3.20/1:\nTable 5.2.3.20/1: DER-Flags\n\nThe DEA-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 5.2.3.21/1:\nTable 5.2.3.21/1: DEA-Flags\n\nThe SSID AVP is of type UTF8String and it shall contain the Service Set Identifier which identifies a specific 802.11 extended service set (see IEEE Std 802.11-2012 [40]). It shall contain a string of 1 to 32 octets.\nThe HESSID AVP is of type UTF8String and it shall contain a 6-octet MAC address that identifies the Homogenous Extended Service Set (see IEEE Std 802.11-2012 [40]). It shall be encoded in upper-case ASCII characters with the octet values separated by dash characters. It shall contain a string of 17 octets. Example: \"00-10-A4-23-19-C0\".\nThe Access-Network-Info AVP is of type Grouped.\nFor a Trusted WLAN, it shall contain the SSID of the WLAN and, unless otherwise determined by the TWAN operator's policies, it shall contain at least one of the following elements:\n-\tthe BSSID,\n-\tthe civic address of the access point to which the UE is attached,\n-\tthe Logical Access ID (see ETSI ES 283 034 [48]) associated to the access point to which the UE is attached.\nIt may also contain the name of the TWAN operator (either a PLMN-ID or an operator name in realm format).\nFor an untrusted WLAN, it shall contain the same information as specified above for a trusted WLAN, where the operator name indicates the WLAN operator name.\nAVP Format:\nAccess-Network-Info ::=\t< AVP Header: 1526 10415 >\n[ SSID ]\n[ BSSID ]\n[ Location-Information ]\n[ Location-Data ]\n[ Operator-Name ]\n[ Logical-Access-ID ]\n*[ AVP ]\n\nThe Location-Data and Location-Information AVPs are defined in IETF RFC 5580 [46]; the content of Location-Information shall indicate that the encoding follows a civic location profile, by setting the \"Code\" field to 0.\nThe Operator-Name AVP is defined in IETF RFC 5580 [46]; the first 8 bits contain the Namespace ID field, whose values are managed by IANA, and are encoded as a single ASCII character. Only values \"1\" (Realm) and \"2\" (E212, containing MCC and MNC values) shall be used in this specification.\nThe TWAN-Connection-Mode AVP (AVP Code 1527) is of type Unsigned32 and it shall contain a 32 bit flags field which is used to indicate the connection modes supported by the TWAN (when this AVP is used in the request commands) and the selected TWAN connection mode the 3GPP AAA Server has authorized (when this AVP is used in the response commands).\nTable 5.2.3.25/1: TWAN-Connection-Mode\n\nThe TWAN-Connectivity-Parameters AVP is of type Grouped.\nAVP Format:\nTWAN-Connectivity-Parameters ::=\t< AVP Header: 1528 10415 >\n[ Connectivity-Flags ]\n[ Service-Selection ]\n[ PDN-Type ]\n* 2 [ Served-Party-IP-Address ]\n[ TWAN-PCO ]\n[ TWAG-UP-Address ]\n[ TWAN-S2a-Failure-Cause ]\n[ SM-Back-Off-Timer ]\n*[ AVP ]\n\nThe Service-Selection AVP indicates the APN requested by the UE (requested connectivity parameters) or the APN selected by the TWAN (provided connectivity parameters). It shall contain both the network identifier part and the operator identifier part of the Access Point Name.\nThe PDN-Type AVP indicates the PDN type requested by the UE (requested connectivity parameters) or the PDN type allocated by the network (provided connectivity parameter). It may be set to IPv4, IPv6 or IPv4v6.\nThe UE's Served-Party-IP-Address AVP may be present 0, 1 or 2 times. These AVPs shall be present if the S2a connection was successfully established, and they shall contain either of:\n-\tan IPv4 address, or\n-\tan IPv6 interface identifier, or\n-\tboth, an IPv4 address and an IPv6 interface identifier.\nFor the IPv6 interface identifier, the higher 64 bits of the address shall be set to zero.\nThe TWAN-S2a-Failure-Cause AVP may be present to indicate the cause of S2a connectivity establishment failure.\nThe SM-Back-Off-Timer AVP may be present to provide a Session Management back-off timer to be sent to the UE. The exact value of the SM-Back-Off-Timer is operator dependant.\nThe Connectivity-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 5.2.3.26/1:\nTable 5.2.3.26/1: Connectivity-Flags\n\nThe TWAN-PCO AVP is of type OctetString and shall contain the Protocol Configuration Options for the UE.\nThe TWAG-CP-Address AVP is of type Address and shall contain the TWAG control-plane IPv4 and/or IPv6 address that the TWAG supports, to be used for WLCP by the UE if MCM is selected.\nThe TWAG-UP-Address AVP is of type UTF8String and shall contain a 6-octet MAC address that identifies the TWAG user-plane MAC address to be used for encapsulating user plane packets between the UE and the TWAN, when SCM is used.\nIt shall be encoded in upper-case ASCII characters with the octet values separated by dash characters. It shall contain a string of 17 octets. Example: \"00-10-A4-23-19-C0\".\nThe TWAN-S2a-Failure-Cause AVP (AVP Code 1533) is of type Unsigned32 and it shall contain a 32 bit cause value field which is used to indicate the cause of S2a connectivity establishment failure to the 3GPP AAA Server by the TWAN. The description of the TWAN-S2a-Failure-Cause value is specified as in Table 5.2.3.30/1:\n\nTable 5.2.3.30/1: TWAN-S2a-Failure-Cause value description\n\nThe SM-Back-Off-Timer AVP is of type Unsigned32 and it shall contain the session management back-off timer value in seconds. The session management back-off timer is provided to the UE as specified in clause 8.1.4.16 of 3GPP TS 24.302 [26].\nThe WLCP-Key AVP (AVP Code 1535) is of type OctetString and it shall contain the WLCP Key used for protecting the WLCP signalling between the UE and the TWAN, as specified in 3GPP TS 33.402 [19].\nThe IMEI-Check-In-VPLMN-Result AVP (AVP Code 1540) is of type Unsigned32 and it shall contain a 32 bit cause value field which is used to indicate the result of the IMEI check performed in the VPLMN. The description of the IMEI-Check-In-VPLMN-Result value is specified as in Table 5.2.3.35/1:\nTable 5.2.3.35/1: IMEI-Check-In-VPLMN-Result value description\n\nThe High-Priority-Access-Info AVP (AVP code 1541) is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 5.2.3.36/1:\nTable 5.2.3.36/1: High-Priority-Access-Info\n\nNOTE:\tThe TWAN sets the HPA_Configured bit if the TWAN had received an indication from the UE that the UE has access priority in an EAP Response/Identity message as described in 3GPP TS 24.302 [26].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.2.3.1/1: Diameter STa AVPs",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.1/2: STa re-used Diameter AVPs",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.20/1: DER-Flags",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.21/1: DEA-Flags",
                                    "table number": 28,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.25/1: TWAN-Connection-Mode",
                                    "table number": 29,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.26/1: Connectivity-Flags",
                                    "table number": 30,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.30/1: TWAN-S2a-Failure-Cause value description",
                                    "table number": 31,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.35/1: IMEI-Check-In-VPLMN-Result value description",
                                    "table number": 32,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.36/1: High-Priority-Access-Info",
                                    "table number": 33,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.2.4\tSession Handling",
                            "text_content": "The Diameter protocol between the non-3GPP access network and the 3GPP AAA Server or 3GPP AAA Proxy, shall always keep the session state, and use the same Session-Id parameter for the lifetime of each Diameter session.\nA Diameter session shall identify a given user. In order to indicate that the session state is to be maintained, the Diameter client and server shall not include the Auth-Session-State AVP, either in the request or in the response messages (see IETF RFC 6733 [58]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tSWd and SWd' Description",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tFunctionality",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tGeneral",
                            "text_content": "The SWd reference point connects the 3GPP AAA Proxy and the 3GPP AAA Server in EPS. The functionality of the SWd reference point is to transport authentication, authorization and related information in AAA messages including:\n-\tCarrying data for authentication signalling between 3GPP AAA Proxy and 3GPP AAA Server;\n-\tCarrying data for authorization signalling between 3GPP AAA Proxy and 3GPP AAA Server\n-\tCarrying charging signalling per user;\n-\tCarrying keying data for the purpose of radio interface integrity protection and encryption;\n-\tCarrying authentication data for the purpose of tunnel establishment, tunnel data authentication and encryption, for the case in which the ePDG is in the VPLMN;\n-\tCarrying mapping of a user identifier and a tunnel identifier sent from the ePDG to the 3GPP AAA Proxy through the 3GPP AAA Server;\n-\tUsed for purging a user from the access network for immediate service termination;\n-\tEnabling the identification of the operator networks amongst which the roaming occurs;\n-\tIf QoS mechanisms are applied: carrying data for AN QoS capabilities/policies (e.g. the supported 3GPP QoS profiles) within authentication request from 3GPP AAA Proxy to 3GPP AAA Server.\n-\tCarrying the IP Mobility Capabilities between 3GPP AAA Proxy and 3GPP AAA Server.\nThe SWd' reference point is defined between the 3GPP AAA Proxy, possibly via an intermediate 3GPP AAA Proxy, and the NSWOF in 5GS. The definition of the reference point and its functionality is given in clause 4.2.15 of 3GPP TS 23.501 [59] and Annex S of 3GPP TS 33.501 [60]. It reuses the same stage 3 protocol definition as defined for SWd in EPC, with specific requirements for NSWO in 5GS specified in clause 6.1.2.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.2\tProcedures Description",
                            "text_content": "When used in connection with the STa interface, the SWd interface shall support the trusted non-3GPP access authentication and authorization procedure defined in clause 5.1.2.1. For this procedure, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the trusted non-3GPP access network as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication and authorization request, if roaming is not allowed for the users of the given HPLMN.\n-\tWhen forwarding an authentication and authorization request, the 3GPP AAA Proxy shall check the presence and value of the visited network identifier. If the AVP was missing, it shall insert it, if the AVP was present, it may overwrite the AVP value before forwarding the request.\n-\tThe 3GPP AAA Proxy may modify the service authorization information in the authentication and authorization answer that it forwards to the trusted non-3GPP access network, in order to enforce the QoS limitations according to the local policies and the roaming agreement with the home operator.\n-\tThe 3GPP AAA Proxy may decide about the trustworthiness of the non-3GPP access from the VPLMN point of view and insert a trust relationship indicator to the authentication and authorization request.\n-\tIf it supports the ER server functionality, the 3GPP AAA Proxy may decide about the use of ERP for re-authentication and indicate its willingness to act as the ER server for this session into the first authentication and authorization request forwarded to the 3GPP AAA server.\nThe 3GPP AAA Proxy shall decide about using the S2a-PMIP based S8 chaining and in case it has selected that option, it shall select the Serving GW to be invoked and it shall add the Serving GW address to the authentication and authorization answer that is sent upon successful completion of the authentication.\nTable 6.1.2.1.1/1 describes the trusted non-3GPP access authentication and authorization request forwarded on the SWd interface.\nTable 6.1.2.1.1-1: Trusted non-3GPP Access Authentication and Authorization Request on SWd\n\nNOTE:\tFor more details on the 3GPP AAA Proxy behaviour, refer to clause 5.1.2.1.3.\nWhen used in connection with the STa interface, the SWd interface shall support the HSS initiated detach procedure defined in clause 5.1.2.2.\nFor this procedure, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the access network GW as a stateful Diameter proxy.\nWhen used in connection with the STa interface, the SWd interface shall support the trusted non-3GPP access and service authorization information update procedure defined in clause 5.1.2.3. For this procedure, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the trusted non-3GPP access network as a stateful Diameter proxy, with the following exceptions:\n-\tWhen forwarding an authentication and authorization request, the 3GPP AAA Proxy shall check the presence and value of the visited network identifier. If the AVP was missing, it shall insert it, if the AVP was present, it may overwrite the AVP value before forwarding the request.\n-\tThe 3GPP AAA Proxy may modify the service authorization information in the authentication and authorization answer that it forwards to the trusted non-3GPP access network, in order to enforce the QoS limitations according to the local policies and the roaming agreement with the home operator.\nTable 6.1.2.1.3/1 describes the trusted non-3GPP access authorization request forwarded on the SWd interface. As the content is very similar to that of the request received on the STa interface, only those AVPs are listed that are handled differently on the two interfaces.\nTable 6.1.2.1.3/1: Trusted Non-3GPP Access Authorization Request on SWd interface\n\nNOTE:\tFor more details on the 3GPP AAA Proxy behaviour, refer to clause 5.1.2.3.3.\nWhen used in connection with the STa reference point, the SWd reference point shall support the access network initiated session termination procedures as defined in clause 5.1.2.4\nFor this procedure, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the access network gateway as a stateful Diameter proxy.\nWhen used in connection with the SWm reference point, the SWd reference point shall support the following procedures:\n-\tAuthentication procedures as defined in clause 7.1.2.1\n-\tAuthorization procedures as defined in clause 7.1.2.2\n-\tAccess network/ePDG initiated session termination procedures as defined in clause 7.1.2.3\n-\tHSS/AAA initiated detach procedures as defined in clause 7.1.2.4\n-\tService authorization information update procedures as defined in clause 7.1.2.5\nFor all these procedures, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the ePDG as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication or an authorization request, if roaming is not allowed for the users of the given HPLMN.\n-\tThe 3GPP AAA Proxy may modify the service authorization information in the authorization answer that it forwards to the ePDG, in order to enforce the QoS limitations according to the local policies and the roaming agreement with the home operator.\n-\tThe 3GPP AAA Proxy shall decide about using the S8-S2b chaining and in case it has selected that option, it shall select the Serving GW to be invoked and it shall add the Serving GW address to the authentication answer that is sent upon successful completion of the authentication.\nNOTE:\tFor more detailed behavior of the 3GPP AAA Proxy, refer to clauses 7.1.2.1.3 and 7.1.2.2.3 respectively.\nWhen used in connection with the SWa interface point, the SWd reference point shall support the following procedures:\n-\tAuthentication and authorization procedure as defined in clause 4.1.2.1\n-\tHSS/AAA initiated detach procedures as defined in clause 4.1.2.2\n-\tUntrusted non-3GPP access network initiated detach procedures as defined in clause 4.1.2.3\n-\tRe-Authentication and Re-Authorization Procedure as defined in clause 4.1.2.4\nFor all these procedures, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the untrusted non-3GPP access network as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication and authorization request, if roaming is not allowed for the users of the given HPLMN.\n-\tWhen forwarding an authentication and authorization request, the 3GPP AAA Proxy shall insert the visited network identifier.\nWhen used in connection with the S6b reference point, the SWd reference point shall support the following procedures:\n-\tAuthentication and authorization procedures when using DSMIP as defined in clause 9.1.2.1\n-\tAuthorization procedures when using NBM as defined in clause 9.1.2.2\n-\tPDN GW initiated session termination procedures as defined in clause 9.1.2.3\n-\tHSS/AAA initiated detach procedures as defined in clause 9.1.2.4\n-\tService authorization information update procedures as defined in clause 9.1.2.5\nFor all these procedures, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the PDN GW as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication or authorization request, if roaming is not allowed for the users of the given HPLMN\n-\tThe 3GPP AAA Proxy may modify the service authorization information in the authorization answers that it forwards to the PDN GW, in order to enforce the QoS limitations according to the local policies and the roaming agreement with the home operator.\nNOTE:\tFor more detailed behavior of the 3GPP AAA Proxy, refer to clauses 9.1.2.1.4, 9.1.2.2.4, 9.1.2.3.4, and 9.1.2.4.4, respectively.\nThe SWd' interface between the 3GPP AAA Proxy, possibly via an intermediate 3GPP AAA Proxy, and the NSWOF shall support the same procedures as defined for SWa' in clause 4.1.2.5.\nFor these procedures, the 3GPP AAA Proxy shall forward the Diameter commands received from the NSWOF and the untrusted non-3GPP access network as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication and authorization request, if roaming is not allowed for the users of the given HPLMN.\n-\tWhen forwarding an authentication and authorization request, the 3GPP AAA Proxy shall insert the visited network identifier.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.2.1.1-1: Trusted non-3GPP Access Authentication and Authorization Request on SWd",
                                    "table number": 34,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.2.1.3/1: Trusted Non-3GPP Access Authorization Request on SWd interface",
                                    "table number": 35,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "6.2\tProtocol Specification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tGeneral",
                            "text_content": "The SWd reference point shall be based on Diameter, as defined in IETF RFC 6733 [58] and contain the following additions and extensions:\n-\tIETF RFC 4005 [4], which defines a Diameter protocol application used for Authentication, Authorization and Accounting (AAA) services in the Network Access Server (NAS) environment.\n-\tIETF RFC 4072 [5], which provides a Diameter application to support the transport of EAP (IETF RFC 3748 [8]) frames over Diameter.\n-\tIETF RFC 5779 [2], which defines Diameter extensions and application for PMIPv6 MAG to AAA and LMA to AAA interfaces.\n-\tIETF RFC 5447 [6], which defines Diameter extensions for Mobile IPv6 NAS to AAA interface.\nThere is no separate application ID defined for the SWd interface. The application ID used by the 3GPP AAA Proxy depends on the command sent over SWd.\nNOTE:\tEven though the 3GPP AAA Proxy may add new AVPs to the Diameter commands forwarded to/from the 3GPP AAA Server, there is no AVP present in the SWd reference point that would not be present in the interface that is used in connection with it. Therefore, the same Application ID can be used.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2\tCommands",
                            "text_content": "\n6.2.2.1.1.1\tDiameter-EAP-Request (DER) Command\nThe Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit set in the Command Flags field, is sent from a trusted non-3GPP access network NAS to a 3GPP AAA server. The ABNF is re-used from the IETF RFC 5779 [2].\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Request-Type }\n{ EAP-Payload }\n[ User-Name ]\n[ Calling-Station-Id ]\n…\n[ RAT-Type ]\n[ ANID ]\n[ QoS-Capability ]\n[ MIP6-Feature-Vector ]\n[ Visited-Network-Identifier ]\n[ Service-Selection ]\n[ Terminal-Information ]\n[ AN-Trusted ]\n[ Full-Network-Name ]\n[ Short-Network-Name ]\n*[ Supported-Features ]\n[ WLAN-Identifier ]\n[ DER-Flags ]\n[ TWAN-Connection-Mode ]\n[ TWAN-Connectivity-Parameters ]\n* 2 [ TWAG-CP-Address ]\n[TWAN-S2a-Failure-Cause]\n[ ERP-RK-Request ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]\n\n6.2.2.1.1.2\tDiameter-EAP-Answer (DEA) Command\nThe Diameter-EAP-Answer (DEA) command, indicated by the Command-Code field set to 268 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA server to a 3GPP AAA Proxy. The ABNF is re-used from the IETF RFC 5779 [2]. The ABNF also contains AVPs that are reused from IETF RFC 4072 [5].\n< Diameter-EAP-Answer > ::=\t< Diameter Header: 268, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Result-Code }\n[ Experimental-Result ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Auth-Request-Type }\n[ EAP-Payload ]\n[ User-Name ]\n[ Session-Timeout ]\n[ Accounting-Interim-Interval ]\n[ EAP-Master-Session-Key ]\n[ Context-Identifier ]\n[ APN-OI-Replacement ]\n*[ APN-Configuration ]\n[ MIP6-Feature-Vector ]\n[ Mobile-Node-Identifier ]\n*[ Redirect-Host ] ]\n[ Trace-Info ]\n[ Subscription-ID ]\n*[ Supported-Features ]\n[ DEA-Flags ]\n[ TWAN-Connection-Mode ]\n[ TWAN-Connectivity-Parameters ]\n[ Terminal-Information ]\n[ Key ]\n[ ERP-Realm ]\n[ MPS-Priority ]\n…\n*[ AVP ]\n\nThe ABNFs defined for the STa interface in clause 5.2.2.2 and in its clauses apply.\nThe ABNFs defined for the STa interface in clause 5.2.2.3 and in its clauses apply.\nThe ABNFs defined for the STa interface in clause 5.2.2.4 and in its clauses apply.\nThe ABNFs defined for the SWm interface in clause 7.2.2 and in its clauses apply.\nThe ABNFs defined for the S6b interface in clause 9.2.2 and in its clauses apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3\tInformation Elements",
                            "text_content": "The following table describes the Diameter AVPs defined for the SWd interface protocol in NBM mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.\nTable 6.2.3.1/1: Diameter SWd AVPs\n\nThe following table describes the Diameter AVPs re-used by the SWd interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within SWd. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol defined in IETF RFC 6733 [58], do not need to be supported.\nTable 6.2.3.1/2: SWd re-used Diameter AVPs\n\nOnly those AVP initially defined in this reference point and for this procedure are described in the following clauses.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.2.3.1/1: Diameter SWd AVPs",
                                    "table number": 36,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.3.1/2: SWd re-used Diameter AVPs",
                                    "table number": 37,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tSWm Description",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tFunctionality",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.1.1\tGeneral",
                            "text_content": "The SWm reference point is defined between the ePDG and the 3GPP AAA Server or between the ePDG and the 3GPP AAA Proxy. The definition of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nThe SWm reference point shall be used to authenticate and authorize the UE.\nThe SWm reference point is also used to transport NBM related mobility parameters in a case the UE attaches to the EPC via the S2b (based on PMIPv6 or GTPv2) and SWn reference points (i.e. IP Mobility Mode Selection information).\nAdditionally the SWm reference point may also be used to transport DSMIPv6 related mobility parameters in case the UE attaches to the EPC using the S2c reference point. In particular, in this case the SWm reference point may be used for conveying the Home Agent IP address or FQDN from the AAA server to the ePDG for Home Agent discovery based on IKEv2 (see TS 24.303 [13]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.1.2\tProcedures Description",
                            "text_content": "The authentication and authorization procedure shall be used between the ePDG and 3GPP AAA Server/Proxy. When a PDN connection is activated by the UE an IKEv2 exchange shall be initiated. It shall be invoked by the ePDG, on receipt from the UE of a \"tunnel establishment request\" message. This shall take the form of forwarding an IKEv2 exchange with the purpose of authenticating in order to set up an IKE Security Association (SA) between the UE and the ePDG.\nDuring the Access Authentication and Authorization procedure the ePDG may provide information on its PMIPv6 or GTPv2 capabilities to the 3GPP AAA Server. The 3GPP AAA Server may perform IP mobility mode selection between NBM or HBM as specified in clause 4.1.3.2 of 3GPP TS 23.402 [3]. The 3GPP AAA Server may provide to the ePDG an indication if either NBM or local IP address assignment shall be used. If NBM shall be used, the ePDG then decides the S2b protocol variant to use.\nThe User-Name AVP may contain a decorated NAI (as defined in clause 19.3.3 of 3GPP TS 23.003 [14]). In this case the 3GPP AAA Proxy shall process the decorated NAI and support routing of the Diameter request messages based on the decorated NAI as described in IETF RFC 5729 [37].\nUpon a successful authorization, when NBM is used, the 3GPP AAA server shall return NBM related information back to the ePDG. This information may include the assigned PDN GW, UE IPv6 HNP and/or UE IPv4-HoA.\nUpon a successful authorization, when DSMIPv6 is used, to enable HA address discovery based on IKEv2 (see TS 24.303 [13]), the 3GPP AAA server may also download PDN GW identity to the ePDG.\nThe PDN GW identity is a FQDN and/or IP address of the PDN GW. If a FQDN is provided, the ePDG shall derive it to IP address according to the selected mobility management protocol.\nIf DSMIPv6 is used, a single IKE SA is used for all PDN connections of the user. If PMIPv6 or GTPv2 is used, a separate IKE SA is created for each PDN connection of the user (refer to 3GPP TS 24.302 [26]).\nEach new additional IKE SA shall be handled in a different Diameter session. In such cases, the IP mobility mode selected during the first authentication and authorization procedure is valid for all PDN connections of the user, therefore, dynamic IP mobility mode selection is not executed during the further procedures. The ePDG may select the same or different S2b protocol variant(s) towards different PDN GWs when NBM has been selected.\nBased on local policies, EPC access for emergency services over an untrusted WLAN access is supported as specified in clause 4.5.7.2.1 of 3GPP TS 23.402 [3] for:\n-\tUEs with a valid EPC subscription that are authenticated and authorized for EPC services;\n-\tUEs that are authenticated only;\n-\tUEs with an unauthenticated IMSI; and/or\n-\tUICC-less UEs.\nThe SWm reference point shall perform authentication and authorization based on the reuse of the DER/DEA command set defined in Diameter EAP application, IETF RFC 4072 [5].\nTable 7.1.2.1.1/1: Authentication and Authorization Request\n\nTable 7.1.2.1.1/2: Authentication and Authorization Answer\n\nOn receipt of the DER message, the 3GPP AAA Server shall check that the user data exists in the 3GPP AAA Server. If not, the 3GPP AAA Server shall use the procedures defined for the SWx interface to obtain access authentication and authorization data.\nIf the HSS returns DIAMETER_ERROR_USER_UNKWNOWN, the 3GPP AAA Server shall return the same error to the ePDG.\nIf the HSS indicates that the user is currently being served by a different 3GPP AAA Server, the 3GPP AAA Server shall respond to the ePDG with the Result-Code set to DIAMETER_REDIRECT_INDICATION and Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\nOtherwise, the 3GPP AAA Server shall proceed with the authentication and authorization procedure. The 3GPP AAA Server shall use the procedures defined in SWx interface to obtain authorization data from HSS.\nIf IMEI check is required by operator policy and the ePDG is in the HPLMN, the 3GPP AAA Server shall:\n-\tif the IMEI(SV) is available, check the Mobile Equipment's identity status with the EIR, using the ME Identity Check procedure (see clause 11);\n-\tupon getting the IMEI check result from the EIR, determine whether to continue or stop the authentication and authorization procedure;\n-\tif the IMEI(SV) is not available, determine whether to continue or stop the authentication and authorization procedure based on operator policy;\n-\tif the 3GPP AAA Server determines that the authentication and authorization procedure shall be stopped, it shall respond to the ePDG with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\nSpecific operator policies may be configured for emergency services, regarding whether to check the IMEI and, if the IMEI needs to be checked, whether to continue or stop the authentication and authorization procedure upon getting the IMEI check result or when the IMEI(SV) is not available.\nIf the 3GPP AAA Server receives a request message not related to any existing session and is able to recognize that the ePDG included the AAA-Failure-Indication AVP in the request, the 3GPP AAA Server shall also include the AAA-Failure-Indication AVP over the SWx interface, while retrieving the access authentication and authorization data from the HSS.\nIf the user does not have non-3GPP access subscription, then 3GPP AAA Server shall respond to the ePDG with Experimental-Result-Code DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION.\nIf a Visited- Network-Identifier is present in the request and if the user is not allowed to roam in the visited network, then the 3GPP AAA Server shall return Experimental-Result-Code set to DIAMETER_ERROR_ROAMING_NOT_ALLOWED.\nIf the user is not allowed to use the current access type, then the 3GPP AAA Server shall return Experimental-Result-Code set to DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED.\nOtherwise the 3GPP AAA Server shall run EAP-AKA as specified in 3GPP TS 33.402 [19]. Exceptions to the cases specified here shall be treated by 3GPP AAA Server as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authentication information shall be returned.\nUpon receiving the authentication and authorization request from the ePDG, the 3GPP AAA Server marks the trust relationship as \"untrusted\" with the User Identity. If the 3GPP AAA Server detects that an S6b session already exists for this UE and the S6b session was established as a result of an authentication request for DSMIPv6, the 3GPP AAA Server shall send the trust relationship to the PDN GW as specified in clause 9.1.2.5.\nOnce authentication is successfully completed, the 3GPP AAA Server shall perform the following authorization checking (if there is an error in any of the steps, the 3GPP AAA Server shall stop processing and return the corresponding error code):\n1)\tCheck if the user is barred to use the non 3GPP Access. If it is so, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED\n2)\tCheck whether the user is barred to use the subscribed APNs. If it is so, Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED.\n3)\tif the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authentication and Authorization Request, check if there was request for an APN received. If not, the default APN of the user is selected to be used during the actual authentication and authorization procedure.\n4)\tif the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authentication and Authorization Request, check if user has a subscription for the requested APN or for the wildcard APN. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_NO_APN_SUBSCRIPTION\n5)\tIf present, check the flags of the received MIP6-Feature-Vector AVP: The evaluation of the flags is executed only in the first authentication and authorization procedure for the user after an initial attach or handover, in all the subsequent procedures, the AAA Server shall insert the same values.\n-\tIf the MIP6_INTEGRATED flag is set and the 3GPP AAA server has authorized IKEv2 Home Agent assignment, the 3GPP AAA server shall include the Home Agent addresses in the APN-Configuration AVP in the response and the MIP6-Feature-Vector AVP with the MIP6_INTEGRATED flag set. In this case, the 3GPP AAA Sever may select the Home Agent based on the identity of the ePDG as included in the Origin-Host AVP in the authentication and authorization request if no static PDN GW identity is received from the HSS. If the HA assignment via IKEv2 is not used, the MIP6-Feature-Vector AVP with the MIP6_INTEGRATED flag not set shall be sent.\n-\tThe PMIP6_SUPPORTED and/or GTPv2_SUPPORTED flag indicates to the 3GPP AAA server whether the ePDG supports NBM or not. As specified in 3GPP TS 23.402 [3], based on the information it has regarding the UE (see 3GPP TS 24.302 [26]), local/home network capabilities and local/home network policies, the 3GPP AAA server may perform mobility mode selection. If the 3GPP AAA server decides that NBM should be used, the PMIP6_SUPPORTED and GTPv2_SUPPORTED flags shall be set in the response to indicate the NBM support of the UE to the ePDG. If only the PMIP6_SUPPORTED or the GTPv2_SUPPORTED flag is present in the response, the ePDG shall assume that this also indicates the NBM support of the UE to the ePDG and the ePDG may select any S2b protocol variant (PMIPv6 or GTPv2). If the 3GPP AAA server decides that a local IP address should be assigned, the ASSIGN_LOCAL_IP flag shall be set in the response to indicate to the ePDG that a local IP address should be assigned.\nNOTE 1:\tWhen selecting DSMIPv6, the AAA server assumes that the ePDG has the capability to assign a local IP address to the UE.\n-\tThe 3GPP AAA server shall not set the PMIP6_SUPPORTED/GTPv2_SUPPORTED and ASSIGN_LOCAL_IP flags both at the same time in the response.\nUpon successful authentication and authorization, the Result-Code shall be set to DIAMETER_SUCCESS and:\n-\tif the Emergency-Indication bit of the Emergency-Services AVP was not set in the Authentication and Authorization Request, the 3GPP AAA Server shall return user data relevant to the APN as received from the HSS. If the requested APN received from UE is authorized by the wildcard APN, the 3GPP AAA Server shall include the wildcard APN in the Service-Selection AVP of the APN-Configuration AVP;\n-\tif the Emergency-Services AVP was present, with the Emergency-Indication bit set, in the Authentication and Authorization Request, the 3GPP AAA Server shall include the Emergency Info IE if this information was received from the HSS and the user is not roaming.\nExceptions to the cases specified here shall be treated by 3GPP AAA Server as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authorization information shall be returned.\nFor Fixed Broadband access network interworking as specified in 3GPP TS 23.139 [39], the 3GPP AAA server shall determine if the UE is connected via a BBF-defined WLAN access according to the UE local IP address in UE-Local-IP-Address AVP from the ePDG. If the UE is connected via a BBF-defined WLAN access, the 3GPP AAA server shall perform the enabling UE reflective QoS function as specified in 3GPP TS 24.139 [43].\nThe 3GPP AAA Server shall interpret the receipt of the Emergency-Services AVP, with the Emergency-Indication bit set, as an indication that the UE requests to access the EPC for emergency services.\nThe 3GPP AAA Server shall give preferential treatment to UEs which access the EPC for emergency services, e.g. in scenarios including network overload.\nIf the 3GPP AAA Server has WLAN Location Information about the UE, the 3GPP AAA Server shall provide it to the ePDG, along with the WLAN Location Timestamp if available (see clause 4.1.2.1.2).\nIf the 3GPP AAA Server supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]), the 3GPP AAA Server shall proceed as specified above, but with the following modifications, for an Emergency Attach:\n1)\tif the UE does not have an IMSI:\n-\tif local policies allow emergency sessions for all UEs, the 3GPP AAA Server shall skip the procedures defined for the SWx interface to obtain access authentication and authorization data, skip the authorization checkings and authorize the UE to access to EPC for emergency services. The Permanent User Identity IE in the answer shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set to DIAMETER_ERROR_USER_UNKNOWN.\n2)\tif the UE has an IMSI but the IMSI is not authenticated:\n-\tif local policies allow emergency sessions for unauthenticated UEs with an IMSI, the 3GPP AAA Server shall skip the procedures defined for the SWx interface to obtain access authorization data, shall skip the authorization checkings and shall return an answer with the DIAMETER_ERROR_USER_UNKWNOWN Result-Code to the ePDG to request the UE to provide its IMEI as specified in clause 13.3 of 3GPP TS 33.402 [19].\nNOTE 2:\tAccording to the procedure specified in clause 7.4.4 of 3GPP TS 24.302 [26], this results in an ePDG, that is configured to support unauthenticated emergency session over WLAN and Mobile Equipment Identity signalling over untrusted WLAN, to query the UE's IMSI and to initiate a new Authentication and Authorization procedure with the same parameters as provided in the first Authentication and Authorization Request but with the addition of the UE's IMEI in the Terminal-Information AVP.\nIf the Authentication and Authorization Request also included the UE's IMEI (i.e. new authentication and authorization procedure after the ePDG queried the UE), the 3GPP AAA Server shall authorize the UE to access to EPC for emergency services. The Permanent User Identity IE in the answer shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set as specified for authentication failures in this clause.\n3)\tif the UE has an authenticated IMSI but the UE is not authorized to access the EPC:\n-\tif local policies allow emergency sessions for any authenticated UE, the 3GPP AAA Server shall authorize the UE to access to EPC for emergency services;\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set as specified for authorization failures in this clause.\nIf 3GPP AAA Server receives a DER command from the ePDG containing a High-Priority-Access-Info AVP with the HPA_Configured bit set, if allowed by operator policy, the 3GPP AAA Server shall treat the message and all subsequent messages (if authentication is successful) for the UE with priority as specified in Annex C and Annex D.\nNOTE 3:\tAlternatively, the 3GPP AAA Server can give priority to this UE after the 3GPP AAA Server has successfully authenticated the UE as described in clause 8.1.2.3.3, at which time the 3GPP AAA Server handles all subsequent messages with priority.\nNOTE 4:\tThe 3GPP AAA Server treats the UE with priority if either the DER command from the ePDG indicates high priority access or the HSS has indicated an MPS subscription for the UE.\nBased on operator policy, the 3GPP AAA Server shall include the MPS-Priority AVP with the MPS-EPS-Priority bit set with the DEA command if the HSS has indicated an MPS subscription for the UE.\nThe 3GPP AAA Proxy shall be required to handle roaming cases in which the ePDG is in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy with the following additions.\nIf IMEI check is required by operator policy and the ePDG is in the VPLMN, the 3GPP AAA Proxy shall:\n-\tif the IMEI(SV) is available, check the Mobile Equipment's identity status with the EIR, using the ME Identity Check procedure (see clause 11);\n-\tupon getting the IMEI check result from the EIR, determine whether to continue or stop the authentication and authorization procedure;\n-\tif the IMEI(SV) is not available, determine whether to continue or stop the authentication and authorization procedure based on operator policy;\n-\tif the 3GPP AAA Proxy determines that the authentication and authorization procedure shall be stopped, it shall:\n-\trespond to the ePDG with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT, and\n-\tsend a SWm Session Termination Request towards the 3GPP AAA Server (see clause 7.1.2.3).\nSpecific operator policies may be configured for emergency services, regarding whether to check the IMEI and, if the IMEI needs to be checked, whether to continue or stop the authentication and authorization procedure upon getting the IMEI check result or when the IMEI(SV) is not available.\nOn receipt of the first authentication and authorization request, the 3GPP AAA Proxy shall check locally configured information whether users from the HPLMN are allowed to activate a PDN connection from the non-3GPP access network via this (V)PLMN. If not, the Experimental-Result-Code shall be set to DIAMETER_ERROR_ROAMING_NOT_ALLOWED and the authentication response shall be sent to the ePDG.\nOn receipt of the authentication and authorization answer that completes a successful authentication, the 3GPP AAA Proxy\n-\tmay check locally configured information about using the chained S8-S2b option towards the given HPLMN. If chaining is required, the 3GPP AAA Proxy shall select a Serving GW from its network configuration database and shall include the Serving GW address in the response.\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authorization Successful).\n-\tmay select the Home Agent based on the identity of the ePDG as included in the Origin-Host AVP in the authentication and authorization request if IKEv2 based Home Agent discovery is used and VPLMN Dynamic Address Allowed AVP is received. In this case, the 3GPP AAA proxy shall include the Home Agent addresses in the APN-Configuration AVP in the response and the MIP6-Feature-Vector AVP with the MIP6-INTEGRATED flag set if no static PDN GW identity is received from the 3GPP AAA Server.\nThe ePDG shall initiate a new authentication and authorization procedure for each new IKE_SA. Each IKE_SA shall be handled in a different session.\nThe ePDG shall set flags signalling its capabilities to the same value in all authentication and authorization procedure for the same user (include the same MIP6-Feature-Vector). During the second and further authentication and authorization procedures, the ePDG shall discard the flag values received from the AAA Server and reuse the values received during the first procedure executed for the user.\nAn ePDG which supports emergency services shall include the Emergency-Services AVP, with the Emergency-Indication bit set, if the UE indicated the establishment of an emergency session during the IKEv2 tunnel establishment (see clause 7.2.5 of 3GPP TS 24.302 [26]).\nFor PMIPv6/GTPv2 based S2b, when receiving a Serving GW address in an authentication response, the ePDG shall check, whether it has already a Serving GW address stored for the user.\n-\tIf it has no Serving GW address available, it shall store the received value and use it as LMA address when creating PMIP bindings.\n-\tIf it has already a stored Serving GW address value, it shall ignore the received SGW-Address AVP.\nNOTE 1:\tIn case of untrusted access, there is an authentication session started for all PDN connection setup requests of a user. These sessions may invoke different 3GPP AAA Proxies, which in turn may assign different Serving GWs to the user. The ePDG behaviour ensures that in spite of this possibility, the same Serving GW is used for all PDN connections of the user.\nNOTE 2:\tThe ePDG knows if NBM is used or if a local IP address is assigned based on the flags in the MIP6-Feature-Vector or based on preconfigured information. If the PMIP6_SUPPORTED and/or the GTPv2_SUPPORTED flag is set in the MIP6-Feature-Vector received from the 3GPP AAA Server, the ePDG knows that NBM is used.\nFor PMIPv6/GTPv2 based S2b and a PDN connection other than for emergency services, the ePDG shall utilize the downloaded APN configuration data to authorize the UE requested home address types: IPv4 home address and/or IPv6 home network prefix.\nFor GTPv2 based S2b and a PDN connection for emergency services, the ePDG shall ignore APN configuration data received from the 3GPP AAA Server and shall use its Emergency Configuration Data to determine the APN to be associated with the emergency PDN connection and possibly the PGW to use (see clause 4.5.7.2 of 3GPP TS 23.402 [3]). During a handover of an emergency PDN connection to an untrusted WLAN access, the ePDG shall use the PGW identified in the Emergency Info IE if this information is received from the 3GPP AAA Server, the user is a non-roaming authenticated user and the ePDG is configured to use a dynamic PGW for emergency services for such users.\nThe ePDG may use the Visited_Network_Identifier to determine the S2b protocol type (PMIPv6 or GTPv2). The ePDG may be configured with the S2b protocol variant(s) on a per HPLMN granularity, or may retrieve information regarding the S2b protocol variants supported by the PDN GW (PMIPv6 or/and GTPv2) from the Domain Name Service Function as described in 3GPP TS 29.303[34]. If the ePDG supports Dedicated Core Networks and received the UE-Usage-Type from the 3GPP AAA Server, the ePDG shall select the PGW as specified in clause 5.8 of 3GPP TS 29.303 [34].\nThe ePDG shall select a SMF+PGW-C for PDN connections that may be subject to mobility to 5GS, e.g. for UEs supporting N1 mode (see 3GPP TS 24.302 [26]) and not restricted to interworking with 5GS by user subscription (see \"5GC\" bit within Core-Network-Restrictions AVP and Interworking-5GS-Indicator AVP specified) as specified in clause 5.12.3 of 3GPP TS 29.303 [34].\nIf GTPv2 is used on S2b and if the Trace-Info AVP including Trace-Data has been received in the authorization response, the ePDG shall send a GTPv2 Trace Session Activation message (see 3GPP TS 29.274 [38]) to the PGW to start a trace session for the user.\nIf DSMIPv6 is used and if ePDG has received the PGW identity in form of the FQDN from the 3GPP AAA server, then the ePDG may obtain the IP address of the Home Agent functionality of that PGW as described in 3GPP TS 29.303 [34].\nIf the ePDG determines that a previously assigned 3GPP AAA Sever is unavailable, it may attempt to send a new authentication and authorization request to an alternate 3GPP AAA Server. If the ePDG receives from this new server a redirect indication towards the former server (due to the HSS having stored the former 3GPP AAA Server identity), it shall terminate all previously existing sessions and PDN connections for that user, and it shall re-send again the request towards the new server, but it shall include the AAA-Failure-Indication AVP in the new request.\nThe ePDG shall give preferential treatment to UEs which access the EPC for emergency services, e.g. in scenarios including network overload.\nThe ePDG shall store the WLAN Location Information associated with the UE when it receives such information from the 3GPP AAA Server.\nIf IMEI check is required by operator policy, the ePDG shall be configured to retrieve the IMEI(SV) from the UE (as specified in 3GPP TS 23.402 [26]) during the authentication and authorization procedure.\nIf the ePDG supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]) and if local policies in the ePDG allows unauthenticated emergency sessions, the ePDG shall proceed during an Emergency Attach for a UE without a UICC or with an unauthenticated IMSI as specified above with the following modifications:\n1)\tIf the UE is UICC-less, the User Identity IE in the Authentication and Authorization Request shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14].\n2)\tIf the User Identity IE does not contain an IMEI (i.e. the UE has an IMSI), the ePDG shall request the IMEI from the UE as specified in clause 13.3 of 3GPP TS 33.402 [19] and clause 7.4.4 of 3GPP TS 24.302 [26] and include the IMEI in the Terminal-Information AVP in the next Authentication and Authorization Request message.\n\nThe Authentication and Authorization Request in step 8 of clause 13.3 of 3GPP TS 33.402 [19] (i.e. after querying the UE's IMSI) shall contain the same parameters as provided in the first Authentication and Authorization Request (step 3) but with the addition of the IMEI in the Terminal-Information AVP.\nNOTE 3:\tThe IMEI cannot be signalled to the 3GPP AAA Server in the first Authentication and Authorization Request sent to the 3GPP AAA Server, since the ePDG requests the IMEI to the UE in the first IKE_AUTH_Response message after getting the first Authentication and Authorization Answer from the 3GPP AAA Server.\nNOTE 4:\tThe Authentication and Authorization Requests in steps 3 and 8 of clause 13.3 of 3GPP TS 33.402 [19] are handled independently from each other by the 3GPP AAA Server.\n3)\tIf the Permanent User Identity IE in the answer contains an IMEI based NAI but the User Identity IE in the request did not contain an IMEI based NAI, the ePDG shall derive that the IMSI was not authenticated and proceed accordingly with the setup of the Emergency PDN connection over S2b (see 3GPP TS 29.274 [38]).\nWhen sending a DER command to the 3GPP AAA Server, if the ePDG had received an indication that the UE has access priority in an IKE_AUTH request message as described in 3GPP TS 24.302 [26] and if allowed by operator policy, the ePDG shall add a High-Priority-Access-Info AVP with the HPA_Configured bit set, to the DER command.\nIf the ePDG receives a DEA command with the MPS-Priority AVP with the MPS-EPS-Priority bit set, the ePDG shall treat the message and all subsequent messages (if authentication is successful) for the UE with priority as specified in Annex C and Annex D. The ePDG shall discontinue priority treatment for the UE if the ePDG receives a Non-3GPP-User-Data AVP without an MPS-Priority AVP with the MPS-EPS-Priority bit set and ePDG has not received an indication that the UE has access priority from the UE in an IKE_AUTH message as described in 3GPP TS 24.302 [26].\nNOTE 5:\tThe ePDG treats the UE with priority if either the indication that the UE has access priority in an IKE_AUTH request message or the HSS has indicated an MPS subscription for the UE.\nThis procedure shall be used between the ePDG and 3GPP AAA Server and Proxy. It shall be invoked by the ePDG, upon receipt of a valid Re-Authorization Request message from the 3GPP AAA Server (see clause 7.1.2.5). It may also be initiated by the ePDG, when the ePDG detects a change of the outer IP address of the UE, to:\n-\tupdate the 3GPP AAA Server with the new UE local IP address; and\n-\tretrieve the most up to date WLAN Location Information stored at the 3GPP AAA Server, when the 3GPP AAA server has sent WLAN Location Information during the initial Authentication and Authorization procedure (see clause 4.5.7.2.8 of 3GPP TS 23.402 [3]).\nThis procedure shall be used by the ePDG to update the previously provided authorization parameters. This may happen due to a modification of the subscriber profile in the HSS (for example, removal of a specific APN associated with the subscriber, or change of the identity of a dynamically allocated PDN GW, see clause 8.1.2.3).\nThis procedure is mapped to the Diameter command codes AA-Request (AAR) and AA-Answer (AAA) specified in RFC 4005 [4]. Information element contents for these messages are shown in tables 7.1.2.2.1/1 and 7.1.2.2.1/2.\nTable 7.1.2.2.1/1: SWm Authorization Request\n\nTable 7.1.2.2.1/2: SWm Authorization Answer\n\nThe 3GPP AAA Server shall process the steps in the following order (if there is an error in any of the steps, the 3GPP AAA Server shall stop processing and return the corresponding error code):\n1)\tCheck that the user exists in the 3GPP AAA Server. The check shall be based on Diameter Session-id and User Name. If the Session-Id included in the request does not correspond with any active session, or if an active session is found but it does not belong to the user identified by the User Name parameter, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2)\tIf the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Request, check whether the user is allowed to access the APN. If not, Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED.\n3)\tThe Result-Code shall be set to DIAMETER_SUCCESS and, if the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Request, the 3GPP AAA Server shall return user data relevant to the APN as received from the HSS.\n4)\tIf the WLAN-Location-Info-Request bit is set to 1 in the AAR-Flags AVP and if the 3GPP AAA Server knows the WLAN Location Information of the UE, the 3GPP AAA Server shall provide it to the ePDG, along with the WLAN Location Timestamp if available (see clause 4.1.2.1.2).\nIf the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Request, once the Authentication and Authorization procedure successfully finishes, the 3GPP AAA Server shall download, together with authentication data, the list of authorized APNs and the authorized mobility protocols in the authentication and authorization response from the HSS (see SWx procedure in Clause 8.1.2.1).\nExceptions to the cases specified here shall be treated by 3GPP AAA Server as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authorization information shall be returned.\nIf the 3GPP AAA Server answers with DIAMETER_AUTHORIZATION_REJECTED, it shall terminate locally the associated SWm Diameter session.\nThe 3GPP AAA Proxy shall be required to handle roaming cases in which the ePDG is in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy, with the following extensions.\nOn receipt of the authorization answer, the 3GPP AAA Proxy:\n-\tShall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tShall record the state of the connection (i.e. Authorization Successful).\nIf the 3GPP AAA Proxy receives a DIAMETER_AUTHORIZATION_REJECTED response from the 3GPP AAA Server, it shall forward it to the ePDG, and terminate locally the associated SWm Diameter session.\nUpon receipt of a valid Re-Authorization Request message from the 3GPP AAA Server, the ePDG shall initiate the authorization procedure after successfully completing the authentication of the user. The ePDG shall initiate a separate authorization session for each IKE_SA of the user. When initiated by the ePDG to retrieve the most up to date WLAN Location Information stored at the 3GPP AAA Server, the ePDG shall initiate the authorization procedure for one IKE_SA of the user.\nIf NBM is used, at successful completion of the procedure, the ePDG shall store the APN configuration data received from the 3GPP AAA Server. The ePDG shall utilize these data to authorize the requested home address types: IPv4 home address and/or IPv6 home network prefix.\nNOTE:\tThe user will be allowed to create PDN connections only to the subscribed APNs and use the address types that are allowed by the subscribed PDN types.\nUpon receiving the authorization response:\n-\tIf NBM is used and if any other Result-Code than DIAMETER_SUCCESS was received in the response, the ePDG shall release the corresponding PDN connection (PMIPv6 binding or GTPv2 tunnel) and IKE_SA of the user, and terminate locally the associated SWm Diameter session.\n-\tIf DSMIPv6 is used,\n-\tIf any other Result-Code than DIAMETER_SUCCESS was received, the ePDG shall release the corresponding IKE_SA of the user, and terminate locally the associated SWm Diameter session.\n-\tIf the Result-Code DIAMETER_SUCCESS was received in the response, the ePDG shall update the previously provided authorization parameters.\nNOTE:\tThe ePDG knows if NBM is used or if a local IP address is assigned based on the flags in the MIP6-Feature-Vector received during the initial authentication and authorization procedure or based on preconfigured information. If the PMIP6_SUPPORTED and/or the GTPv2_SUPPORTED flag are set in the MIP6-Feature-Vector received from the 3GPP AAA Server, the ePDG knows that NBM is used.\nIf GTPv2 is used on S2b and if the Trace-Info AVP including Trace-Data has been received in the authorization response, the ePDG shall send a GTPv2 Trace Session Activation message (see 3GPP TS 29.274 [38]) to the PGW to start a trace session for the user. If the Trace-Info AVP including Trace-Reference (directly under the Trace-Info) has been received in the authorization response, the ePDG shall send a GTPv2 Trace Session Deactivation message to the PGW to stop the ongoing trace session, identified by the Trace-Reference. For details, see 3GPP TS 32.422 [32].\nIf DSMIPv6 is used and if ePDG has received the PGW identity in form of the FQDN from the 3GPP AAA server, then the ePDG may obtain the IP address of the Home Agent functionality of that PGW as described in 3GPP TS 29.303 [34].\nThe ePDG shall store the WLAN Location Information associated with the UE when it receives such information from the 3GPP AAA Server. The ePDG shall delete any stored WLAN Location Information associated with the UE when it receives from the 3GPP AAA Server an Authorization Answer not including any WLAN Location Information and the WLAN-Location-Info-Request bit was set to 1 in the AAR-Flags AVP.\nThe ePDG shall select a SMF+PGW-C for PDN connections that may be subject to mobility to 5GS, e.g. for UEs supporting N1 mode (see 3GPP TS 24.302 [26]) and not restricted to interworking with 5GS by user subscription (see \"5GC\" bit within Core-Network-Restrictions AVP and Interworking-5GS-Indicator AVP specified) as specified in clause 5.12.3 of 3GPP TS 29.303 [34].\nThe ePDG may trigger the Detach Procedure (see 3GPP TS 23.402 [3]), if the Core-Network-Restrictions AVP is changed to restrict to connect to current network due to the non-3GPP subscriber profile is changed.\nThe SWm reference point allows the ePDG to inform the 3GPP AAA Server/Proxy about the termination of an IKE_SA between UE and ePDG, and that therefore the mobility session established on the ePDG for all associated PDN connections are to be removed.\nThe SWm Session Termination Request procedure shall be initiated by the ePDG to the 3GPP AAA Server which shall remove associated non-3GPP Access information. The AAA Server shall then return the SWm Session Termination Answer containing the result of the operation. These procedures are based on the reuse of Diameter STR and STA commands as specified in IETF RFC 6733 [58].\nTable 7.1.2.3.1/1: SWm Session Termination Request\n\nTable 7.1.2.3.1/2: SWm Session Termination Answer\n\nUpon reception of the Session Termination Request message from the ePDG, the 3GPP AAA Server shall check that there is an ongoing session associated to the two parameters received (Session-Id and User-Name).\nIf an active session is found and it belongs to the user identified by the User-Name parameter, the 3GPP AAA Server shall release the session resources associated to the specified session and a Session Termination Response shall be sent to the ePDG, indicating DIAMETER_SUCCESS.\nOtherwise, the 3GPP AAA Server returns a Session Termination Response with the Diameter Error DIAMETER_UNKNOWN_SESSION_ID.\nThe 3GPP AAA Proxy is required to handle roaming cases in which the ePDG is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the Session Termination Request message from the ePDG, the 3GPP AAA Proxy shall route the message to the 3GPP AAA Server.\nOn receipt of the Session Termination Answer message from the 3GPP AAA Server, the 3GPP AAA Proxy shall route the message to the ePDG, and it shall release any local resources associated to the specified session only if the result code is set to DIAMETER_SUCCESS.\nThe SWm reference point shall allow the 3GPP AAA Server to request the termination of an IKE_SA between UE and ePDG, and therefore the termination of all mobility session established for all associated PDN connections.\nIf the user has several accesses (IKE_SA) active at an ePDG, a separate Session Termination procedure shall be initiated for each of them.\nThe procedure shall be initiated by the 3GPP AAA Server. This procedure is based on the reuse of NASREQ IETF RFC 4005 [4] ASR, ASA, STR and STA commands.\nTable 7.1.2.4.1/1: SWm Abort Session Request\n\nTable 7.1.2.4.1/2: SWm Abort Session Answer\n\nTable 7.1.2.4.1/3: SWm Session Termination Request\n\nTable 7.1.2.4.1/4: SWm Session Termination Answer\n\nThe 3GPP AAA Server shall make use of this procedure to instruct the ePDG to terminate the IKE_SA between UE and ePDG.\nIn the DSMIPv6 case, the 3GPP AAA Server shall initiate first the detach procedure over the S6b reference point towards the PDN GW. When this process has finalized, the 3GPP AAA Server can initiate the termination of the IKE_SA towards the ePDG.\nThe 3GPP AAA Server shall include the Auth-Session-State AVP in the ASR command with a value of NO_STATE_MAINTAINED if it does not require a STR from the ePDG. If it does require a STR from the ePDG, the 3GPP AAA Server shall either omit the Auth-Session-State AVP from the ASR command or include the Auth-Session-State AVP in the ASR command with a value of STATE_MAINTAINED.\nOn receipt of the ASR command, the ePDG shall check if there is an ongoing session associated with the received Session-Id. If an active session is found and it belongs to the user identified by the User-Name parameter, the ePDG shall terminate the associated IKE_SA between UE and ePDG and return an ASA to the 3GPP AAA Server with the Result-Code to DIAMETER_SUCCESS. Otherwise, the ePDG shall return an ASA to the 3GPP AAA Server with the Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.\nOn receipt of the ASA with a Result-Code of DIAMETER_SUCCESS, the 3GPP AAA Server shall release any local resources associated with the specified session.\nIf required by the 3GPP AAA Server, the ePDG shall send an STR with the Termination-Cause set to DIAMETER_ADMINISTRATIVE. The 3GPP AAA Server shall set the Result-Code to DIAMETER_SUCCESS and return the STA command to the ePDG.\nWhen the 3GPP AAA Proxy receives the ASR from the 3GPP AAA Server it shall route the request to the ePDG.\nIf the 3GPP AAA Proxy requires an STR but the 3GPP AAA Server does not, the 3GPP AAA Proxy may override the value of the Auth-Session-State in the ASR and set it to STATE_MAINTAINED. In this case, the 3GPP AAA Proxy shall not forward the STR received from the ePDG onto the 3GPP AAA Server and shall return an STA command to the ePDG with the Result-Code set to DIAMETER_SUCCESS. The 3GPP AAA Proxy shall not override the value of the Auth-Session-State AVP under any other circumstances.\nOn receipt of the ASA message with Diameter Result Code set to DIAMETER_SUCCESS, the 3GPP AAA Proxy shall route the successful response to the 3GPP AAA Server and shall release any local resources associated with the session.\nWhen the 3GPP AAA Proxy receives the STR from ePDG, it shall route the request to the 3GPP AAA Server. On receipt of the STA message, the 3GPP AAA Proxy shall route the response to the ePDG.\nThis procedure shall be used between the 3GPP AAA Server and the ePDG for the purpose of modifying the previously provided authorization parameters. This may happen due to a modification of the subscriber profile in the HSS (for example change of the identity of a dynamically allocated PDN GW, see clause 8.1.2.3).\nThis procedure shall be performed in two steps:\n-\tThe 3GPP AAA Server shall issue an unsolicited re-authorization request towards the ePDG. Upon receipt of such a request, the ePDG shall respond to the request and indicate the disposition of the request. This procedure is based on the Diameter commands Re-Auth-Request and Re-Auth-Answer specified in IETF RFC 6733 [58]. Information element contents for these messages shall be as shown in tables 7.1.2.5.1/1 and 7.1.2.5.1/2.\n-\tUpon receiving the re-authorization request, the ePDG shall immediately invoke the authorization procedure specified in 7.1.2.2 for the session indicated in the request. This procedure is based on the Diameter commands AA-Request (AAR) and AA-Answer (AAA) specified in IETF RFC 4005 [4]. Information element contents for these messages are shown in tables 7.1.2.2.1/1 and 7.1.2.2.1/2.\nTable 7.1.2.5.1/1: SWm Authorization Information Update Request\n\nTable 7.1.2.5.1/2: SWm Authorization Information Update Answer\n\nThe 3GPP AAA server shall make use of the re-authorization procedure defined in the Diameter base protocol, IETF RFC 6733 [58] to indicate that relevant service authorization information shall be updated in the ePDG.\nUpon receipt of the Re-authorization Request message from the 3GPP AAA Server or the 3GPP AAA Proxy, the ePDG shall check that there is an ongoing session associated to any of the parameters received in the message (identified by the Session-Id AVP and the User-Name AVP).\nIf an active session is found, the ePDG shall initiate an authorization procedure for the session identified by the Session-Id AVP and the User-Name AVP and a Re-authorization Answer message shall be sent to the 3GPP AAA Server or the 3GPP AAA Proxy with the Result-Code indicating DIAMETER_SUCCESS. This new authorization procedure shall be performed as described in clause 7.1.2.2.\nIf the Session-Id included in the request does not correspond with any active session, or if an active session is found but it does not belong to the user identified by the User Name parameter, then an Re-authorization Answer message shall be sent to the 3GPP AAA Server or the 3GPP AAA Proxy with the Result-Code indicating DIAMETER_UNKNOWN_SESSION_ID.\nExceptions to the cases specified here shall be treated by ePDG as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authorization procedure shall be initiated.\nTable 7.1.2.5.3/1 details the valid result codes that the ePDG can return in the response.\nTable 7.1.2.5.3/1: Re-authorization Answer valid result codes\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.1.2.1.1/1: Authentication and Authorization Request",
                                    "table number": 38,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.1.1/2: Authentication and Authorization Answer",
                                    "table number": 39,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.2.1/1: SWm Authorization Request",
                                    "table number": 40,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.2.1/2: SWm Authorization Answer",
                                    "table number": 41,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.3.1/1: SWm Session Termination Request",
                                    "table number": 42,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.3.1/2: SWm Session Termination Answer",
                                    "table number": 43,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.4.1/1: SWm Abort Session Request",
                                    "table number": 44,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.4.1/2: SWm Abort Session Answer",
                                    "table number": 45,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.4.1/3: SWm Session Termination Request",
                                    "table number": 46,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.4.1/4: SWm Session Termination Answer",
                                    "table number": 47,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.5.1/1: SWm Authorization Information Update Request",
                                    "table number": 48,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.5.1/2: SWm Authorization Information Update Answer",
                                    "table number": 49,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.1.2.5.3/1: Re-authorization Answer valid result codes",
                                    "table number": 50,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "7.2\tProtocol Specification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.2.1\tGeneral",
                            "text_content": "The SWm reference point shall be based on Diameter, as defined in IETF RFC 6733 [58] and contain the following additions and extensions:\n-\tIETF RFC 4005 [4], which defines a Diameter protocol application used for Authentication, Authorization and Accounting (AAA) services in the Network Access Server (NAS) environment.\n-\tIETF RFC 4072 [5], which provides a Diameter application to support the transport of EAP (IETF RFC 3748 [8]) frames over Diameter.\n-\tIETF RFC 5779 [2], which defines a Diameter extensions and application for PMIPv6 MAG to AAA and LMA to AAA interfaces.\n-\tIETF RFC 5447 [6], which defines Diameter extensions for Mobile IPv6 NAS to AAA interface.\nIn the case of an untrusted non-3GPP IP access, the MAG to 3GPP AAA server or the MAG to 3GPP AAA proxy communication shall use the MAG to AAA interface functionality defined in IETF RFC 5779 [2] and the NAS to AAA interface functionality defined in IETF RFC 5447 [6].\nThe Diameter application for the SWm reference point shall use the Diameter Application Id with value 16777264.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.2\tCommands",
                            "text_content": "The Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit set in the Command Flags field, is sent from a ePDG to a 3GPP AAA Server/Proxy. The ABNF is based on the one in IETF RFC 5779 [2].\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Request-Type }\n{ EAP-Payload }\n[ User-Name ]\n[ RAT-Type ]\n[ Service-Selection ]\n[ MIP6-Feature-Vector ]\n[ QoS-Capability ]\n[ Visited-Network-Identifier ]\n[ AAA-Failure-Indication ]\n*[ Supported-Features ]\n[ UE-Local-IP-Address ]\n[ OC-Supported-Features ]\n[ Terminal-Information ]\n[ Emergency- Services ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]\nThe Diameter-EAP-Answer (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to the ePDG. The ABNF is based on the one in IETF RFC 5779 [2].\n< Diameter-EAP-Answer > ::=\t< Diameter Header: 268, PXY, 16777264>\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ EAP-Payload ]\n[ User-Name ]\n[ EAP-Master-Session-Key ]\n[ APN-OI-Replacement ]\n[ APN-Configuration ]\n[ MIP6-Feature-Vector ]\n[ Mobile-Node-Identifier ]\n[ Trace-Info ]\n[ Subscription-ID ]\n[ Session-Timeout ]\n[ MIP6-Agent-Info ]\n[ 3GPP-Charging-Characteristics ]\n*[ Redirect-Host ]\n*[ Supported-Features ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n[ Access-Network-Info ]\n[ User-Location-Info-Time ]\n[ UE-Usage-Type ][ Emergency-Info ]\n[ Core-Network-Restrictions ]\n[ MPS-Priority ]\n…\n*[ AVP ]\nThe AA-Request (AAR) command, indicated by the Command-Code field set to 265 and the \"R\" bit set in the Command Flags field, is sent from a ePDG to a 3GPP AAA Server/Proxy.\n\n<AA-Request> ::=\t< Diameter Header: 265, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Request-Type }\n[ User-Name ]\n[ OC-Supported-Features ]\n[ AAR-Flags ]\n[ UE-Local-IP-Address ]\n…\n*[ AVP ]\nThe AA-Answer (AAA) command, indicated by the Command-Code field set to 265 and the \"R\" bit cleared in the Command Flags field, is sent from 3GPP AAA Server/Proxy to a ePDG.\n\n<AA-Answer> ::=\t< Diameter Header: 265, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n[ APN-OI-Replacement ]\n[ APN-Configuration ]\n[ Trace-Info ]\n[ Subscription-ID ]\n[ 3GPP-Charging-Characteristics ]\n[ Session-Timeout ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n[ Access-Network-Info ]\n[ User-Location-Info-Time ]\n[ Core-Network-Restrictions ]\n…\n*[ AVP ]\nThe Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from a ePDG to a 3GPP AAA Server/Proxy. The ABNF is based on the one in IETF RFC 6733 [58], and is defined as follows:\n< Session-Termination-Request > ::=\t< Diameter Header: 275, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]\nThe Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit clear in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a ePDG. The ABNF is based on the one in IETF RFC 6733 [58], and is defined as follows:\n< Session-Termination-Answer > ::=\t< Diameter Header: 275, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n…\n*[ AVP ]\nThe Abort-Session-Request (ASR) command shall be indicated by the Command-Code field set to 274 and the \"R\" bit set in the Command Flags field, and shall be sent from a 3GPP AAA Server/Proxy to an ePDG. The ABNF is based on that in IETF RFC 4005 [4].\n< Abort-Session-Request > ::=\t< Diameter Header: 274, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n[ User-Name ]\n[ Auth-Session-State ]\n…\n*[ AVP ]\nThe Abort-Session-Answer (ASA) command shall be indicated by the Command-Code field set to 274 and the \"R\" bit cleared in the Command Flags field, and shall be sent from a ePDG to a 3GPP AAA Server/Proxy. The ABNF is based on that in IETF RFC 4005 [4].\n< Abort-Session-Answer > ::=\t< Diameter Header: 274, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]\nThe Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from an ePDG to a 3GPP AAA Server/Proxy. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Request command.\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]\n\nThe Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to an ePDG. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]\nThe Re-Auth-Request (RAR) command shall be indicated by the Command-Code field set to 258 and the \"R\" bit set in the Command Flags field, and shall be sent from a 3GPP AAA Server/Proxy to a ePDG. The ABNF is based on the one in IETF RFC 4005 [4] and is defined as follows.\n< Re-Auth-Request > ::=\t< Diameter Header: 258, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n{ Re-Auth-Request-Type }\n[ User-Name ]\n…\n*[ AVP ]\nThe Re-Auth-Answer (RAA) command shall be indicated by the Command-Code field set to 258 and the \"R\" bit cleared in the Command Flags field, and shall be sent from a ePDG to a 3GPP AAA Server/Proxy. The ABNF is based on the one in IETF RFC 4005 [4] and is defined as follows.\n< Re-Auth-Answer > ::=\t< Diameter Header: 258, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n…\n*[ AVP ]\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.3\tInformation Elements",
                            "text_content": "The following table describes the Diameter AVPs defined for the SWm interface protocol for untrusted non-3GPP access, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.\nTable 7.2.3.1/1: Diameter SWm AVPs\n\nThe following table describes the Diameter AVPs re-used by the SWm interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within SWm. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol defined in IETF RFC 6733 [58], do not need to be supported.\nTable 7.2.3.1/2: SWm re-used Diameter AVPs\n\nOnly those AVP initially defined in this reference point and for this procedure are described in the following clauses.\nThe syntax of this AVP is defined in 3GPP TS 29.229 [24]. For this release, the Feature-List-ID AVP value shall be set to 1 for the SWm application.\nThe syntax of this AVP is defined in 3GPP TS 29.229 [24]. A null value indicates that there is no feature used by the SWm application.\nNOTE:\tThere are no SWm features defined for this release.\nThe Emergency-Services AVP is of type Unsigned32 and it shall contain a bitmask. The meaning of the bits is defined in table 7.2.3.4/1:\nTable 7.2.3.4/1: Emergency-Services\n\nThe AAR-Flags AVP is of type Unsigned32 and it shall contain a bitmask. The meaning of the bits is defined in table 7.2.3.5/1:\nTable 7.2.3.5/1: AAR-Flags\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.3.1/1: Diameter SWm AVPs",
                                    "table number": 51,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.2.3.1/2: SWm re-used Diameter AVPs",
                                    "table number": 52,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.2.3.4/1: Emergency-Services",
                                    "table number": 53,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 7.2.3.5/1: AAR-Flags",
                                    "table number": 54,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.4\tSession Handling",
                            "text_content": "The Diameter protocol between the ePDG and the 3GPP AAA Server or the 3GPP AAA Proxy shall always keep the session state, and use the same Session-Id parameter for the lifetime of each Diameter session.\nA Diameter session shall identify\n-\ta PDN Connection of a given user, if NBM is used\n-\ta user, if DSMIPv6 is used.\nIn order to indicate that the session state is to be maintained, the Diameter client and server shall not include the Auth-Session-State AVP, either in the request or in the response messages (see IETF RFC 6733 [58]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "8\tSWx Description",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tFunctionality",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.1.1\tGeneral",
                            "text_content": "The SWx reference point is defined between the 3GPP AAA Server and the HSS. The description of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nThe SWx reference point is used to authorize the UE and to transport NBM related mobility parameters when NBM is used to establish connectivity to the EPC.\nThe SWx is used to authenticate and authorize the UE when the S2a, S2b or S2c reference points are used to connect to EPC. This reference point is also used to update the HSS with the PDN-GW address information. Additionally, this reference point may be used to retrieve and update other mobility related parameters including static QoS profiles for non-3GPP accesses.\nAdditional requirements for the SWx interface can be found in clause 12 of 3GPP TS 23.402 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.1.2\tProcedures Description",
                            "text_content": "This procedure is used between the 3GPP AAA Server and the HSS. The procedure is invoked by the 3GPP AAA Server when a new set of authentication information for a given subscriber is to be retrieved from an HSS. This can happen for example, when a new trusted or untrusted non 3GPP/IP access subscriber has accessed the 3GPP AAA Server for authentication or when a new set of authentication information is required for one of the subscribers already registered in the 3GPP AAA server. The procedure shall be invoked by 3GPP AAA Server when it detects that the VPLMN or access network has changed.\nTable 8.1.2.1.1/1: Authentication request\n\nTable 8.1.2.1.1/2: Authentication Data content - request\n\nTable 8.1.2.1.1/3: Authentication Data content - request, synchronization failure\n\nTable 8.1.2.1.1/4: Authentication answer\n\nTable 8.1.2.1.1/5: Authentication Data content - response\n\nThe HSS shall, in the following order (if there is an error in any of the steps, the HSS shall stop processing and return the corresponding error code):\n1.\tCheck that the user exists in the HSS. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2.\tCheck that the user has non-3GPP subscription and that the user is allowed in the EPC. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTON.\n3.\tIf a Visited-Network-Identifier is present, check that the user is allowed to roam in the visited network. If the user is not allowed to roam in the visited network, Experimental-Result-Code shall be set to DIAMETER_ERROR _ROAMING_NOT_ALLOWED.\n4.\tCheck the access type. If the access type indicates any value that is restricted for the user, then the Experimental-Result-Code shall be set to DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED.\n5.\tBased on operator's policy, if the Trust Relationship Indicator is present and indicates any value that is restricted for the user, then the Experimental-Result-Code shall be set to DIAMETER_ERROR_TRUSTED_NON_3GPP_ACCESS_NOT_ALLOWED or DIAMETER_ERROR_UNTRUSTED_NON_3GPP_ACCESS_NOT_ALLOWED.\n6.\tThe HSS shall check if there is an existing 3GPP AAA Server already assisting the user\n-\tIf there is a 3GPP AAA Server already serving the user, the HSS shall compare the 3GPP AAA server name received in the request to the 3GPP AAA Server name stored in the HSS.\n-\tIf they are not identical and the received message contains the AAA-Failure-Indication AVP, the HSS shall remove the old 3GPP AAA Server name previously assigned for this subscriber, and store the name of the new 3GPP AAA Server that sent the request containing the AAA-Failure-Indication AVP, and continue from step 6. The HSS should attempt to notify the old 3GPP AAA Server about the new server assignment, by means of the network initiated de-registration procedure (see clause 8.1.2.2.3) indicating as reason code \"NEW_SERVER_ASSIGNED\".\n-\tIf they are not identical the HSS shall return the old 3GPP AAA Server to the requester 3GPP AAA Server and return an error by setting the Experimental-Result-Code to DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.\n-\tThe requester 3GPP AAA Server, upon detection of a 3GPP AAA Server name in the response assumes that the user already has a 3GPP AAA Server assigned, so makes use of Diameter redirect function to indicate the 3GPP AAA Server name where to address the authentication request.\n7.\tThe HSS shall check the request type.\n-\tIf the request indicates there is a synchronization failure, the HSS shall process AUTS as described in 3GPP TS 33.203 [16] and return the requested authentication information. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf the request indicates authentication, the HSS shall generate the authentication vectors for the requested authentication method, EAP-AKA or EAP-AKA', as described in 3GPP TS 33.402 [19]. The HSS shall download Authentication-Data-Item up to a maximum specified in SIP-Number-Auth-Items received in the command Multimedia-Auth-Request. The result code shall be set to DIAMETER_SUCCESS.\n-\tIf there is no 3GPP AAA Server already serving the user, the HSS shall store the received 3GPP AAA Server name.\nExceptions to the cases specified here shall be treated by HSS as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY. No authentication information shall be returned.\nOrigin-Host AVP shall contain the 3GPP AAA Server identity.\nAccording to the requirements described in 3GPP TS 23.402 [3], SWx reference point shall enable:\n-\tRegistration of the 3GPP AAA Server serving an authorized trusted or untrusted non-3GPP access user in the HSS.\n-\tRetrieval of charging-related information from HSS.\n-\tDeregistration procedure between the 3GPP AAA Server and the HSS.\n-\tRetrieval of subscriber profile from HSS.\n8.1.2.2.2.1\tGeneral\nThis procedure is used between the 3GPP AAA Server and the HSS.\n-\tTo register the current 3GPP AAA Server address in the HSS for a given non-3GPP user. This procedure is invoked by the 3GPP AAA Server after a new subscriber has been authenticated by the 3GPP AAA Server.\n-\tTo de-register the current 3GPP AAA Server address in the HSS for a given non-3GPP user. This procedure is invoked when the 3GPP AAA Server removes the access information for a non-3GPP user after all sessions for the user (i.e. the STa, SWm, S6b sessions) have been terminated.\n-\tTo download the subscriber profile to the 3GPP AAA Server on demand. This procedure is invoked when for some reason the subscription profile of a subscriber is lost.\n-\tTo update the HSS with the identity and the PLMN ID of a dynamically allocated PDN GW as a result of the first PDN connection establishment associated to an APN.\n-\tTo update the HSS with the identity of the dynamically allocated PDN GW selected for the establishment of an emergency PDN connection.\nTable 8.1.2.2.2.1/1: Non-3GPP IP Access Registration request\n\nTable 8.1.2.2.2.1/2: Non-3GPP IP Access Registration response\n\n8.1.2.2.2.2\tDetailed behaviour\nWhen a new trusted or untrusted non-3GPP IP access subscriber has been authenticated by the 3GPP AAA Server, the 3GPP AAA Server initiates the registration towards the HSS. The HSS shall, in the event of an error in any of the steps, stop processing and return the corresponding error code.\nAt reception of the Non-3GPP IP Access Registration, the HSS shall perform (in the following order):\n1.\tCheck that the user is known. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2.\tThe HSS shall check if there is an existing 3GPP AAA Server already assisting the user\n-\tIf there is a 3GPP AAA Server already serving the user, the HSS shall compare the 3GPP AAA Server name received in the request to the 3GPP AAA Server name stored in the HSS.\n-\tIf they are not identical the HSS shall return the old 3GPP AAA Server to the requester 3GPP AAA Server and return an error by setting the Experimental-Result-Code to DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.\n\nThe requester 3GPP AAA Server, upon detection of a 3GPP AAA Server name in the response assumes that the user already has a 3GPP AAA Server assigned, so makes use of Diameter redirect function to indicate the 3GPP AAA Server name where to address the Non-3GPP IP Access Registration request.\n-\tIf they are identical but there is no APN configuration information in HSS for the user, the HSS shall return the Experimental Result Code DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION and it shall remove the 3GPP AAA Server name previously assigned for this subscriber.\n-\tIf there is not a 3GPP AAA Server already serving the user, the HSS shall return an error, setting the Result-Code to DIAMETER_UNABLE_TO_COMPLY in the Response command.\n3.\tAfter the HSS has determined that the requesting 3GPP AAA server is identical to the registered 3GPP AAA server, the HSS shall check the Server Assignment Type value received in the request:\n-\tIf it indicates REGISTRATION, the HSS shall set the subscribers User Status to REGISTERED for the authenticated and authorized trusted or untrusted non-3GPP IP access subscriber, download the relevant user profile information and set the Result-Code AVP to DIAMETER_SUCCESS in the Server-Assignment-Response command. For those APNs that have been authorized as a consequence of having the Wildcard APN in the user subscription, the HSS shall include the specific APN name and associated PDN-GW identity inside the Specific-APN-Info AVP of the Wildcard APN.\n-\tIf it indicates USER_DEREGISTRATION / ADMINISTRATIVE_DEREGISTRATION / AUTHENTICATION_FAILURE / AUTHENTICATION_TIMEOUT, the HSS shall remove the 3GPP AAA Server name previously assigned for the subscriber, set the User Status for the subscriber to NOT_REGISTERED and set the Result-Code AVP to DIAMETER_SUCCESS in the Server-Assignment-Response command. The HSS shall not remove the stored dynamic PGW-ID and APN information for the subscriber.\n-\tIf it indicates AAA_USER_DATA_REQUEST, the HSS shall download the relevant user profile information to the requester 3GPP AAA Server and set the Result-Code AVP to DIAMETER_SUCCESS in the Response command.\n-\tIf it indicates PGW_UPDATE, the HSS shall check if the subscriber is registered.\nIf the subscriber is registered and the Emergency-Services AVP is present in the request, with the Emergency-Indication bit set, the HSS shall store the PDN GW Identity as the PDN GW used to establish emergency PDN connections by the non-3GPP access network, and update the MME with this information as specified in 3GPP TS 29.272 [29].\nIf the subscriber is registered and the Emergency-Indication bit of the Emergency-Services AVP is not set in the request, and there is not a static PDN GW subscribed, the HSS shall store the PGW identity and PLMN (if it is received in the command) for the non-3GPP user and the APN identified by the APN Id or by the Context Identifier if present in the request; otherwise, the HSS shall not update or delete the stored PDN GW and, for this case, shall set the result code to DIAMETER_UNABLE_TO_COMPLY.\nIf the APN corresponding to the PGW identity is not present in the subscription but the wild card APN is present in the subscription, the HSS shall store the new PDN GW identity and PLMN for an APN if present in the request. The HSS shall set the Result-Code AVP to DIAMETER_SUCCESS in the Server-Assignment-Response command. If the Context Identifier is included in the request, the HSS may use it to locate the APN Configuration.\nIf the APN corresponding to the PGW identity is not present in the subscription and the wild card APN is not present in the subscription, the HSS shall reject the request and set the Result-Code AVP to DIAMETER_UNABLE_TO_COMPLY.\nIf the subscriber is not registered, the HSS shall reject the request and set the Experimental-Result-Code AVP to DIAMETER_ERROR_IDENTITY_NOT_REGISTERED.\n-\tIf it indicates any other value, the Result-Code shall be set to DIAMETER_UNABLE_TO COMPLY, and no registration/de-registration or profile download procedure shall be performed.\nOrigin-Host AVP shall contain the 3GPP AAA Server identity.\nIf the subscription data received for a certain APN indicates that the APN was authorized as a consequence of having the Wildcard APN in the user subscription in HSS, then the 3GPP AAA Server shall not store this APN data beyond the lifetime of the UE sessions related to the specific APN and the 3GPP AAA Server shall delete them upon disconnection of the UE. If the PGW Identity contains an FQDN of the PDN GW, the 3GPP AAA Server shall retrieve the PGW PLMN ID from the MIP-Home-Agent-Host AVP within the MIP6-Agent-Info AVP which contains the PGW Identity.\nFor trusted WLAN access, if the transparent single-connection mode is used as specified in 3GPP TS 24.302 [26], the 3GPP AAA Server may be configured by local policy to not update the HSS with the PGW Identity used over TWAN for the default APN of the user (i.e. to skip the Non-3GPP IP Access Registration request with Server-Assignment-Type set to \"PGW_UPDATE\").\nNOTE:\tThis 3GPP AAA Server option can be used when the same APN is configured for TWAN and other access technologies in which case the network can select different PDN GWs for PDN connections to this APN. Updating the HSS with the selected PDN GW identity for Trusted WLAN access could affect PDN connections over other access technologies.\n8.1.2.2.3.1\tGeneral\nThis procedure is used between the 3GPP AAA Server and the HSS to remove a previous registration and all associated state. When the de-registration procedure is initiated by HSS, indicating that a subscription has to be removed, the 3GPP AAA Server subsequently triggers the detach procedure via the appropriate interface.\nTable 8.3.2.3: Network Initiated Deregistration by HSS request\n\nTable 8.3.2.4: Network Initiated Deregistration by HSS response\n\n8.1.2.2.3.2\tDetailed behaviour\nThe HSS shall de-register the affected identity and invoke this procedure to inform the 3GPP AAA server to remove the subscribed user from the 3GPP AAA Server.\nThe HSS shall send in the Deregistration-Reason AVP the reason for the de-registration, composed by a textual message (if available) aimed for the user and a reason code that determines the action the 3GPP AAA server has to perform. The possible reason codes are:\n-\tPERMANENT_TERMINATION: The non-3gpp subscription or service profile(s) has been permanently terminated or the Core Network Restrictions do not allow access to EPC anymore. The HSS shall clear the user's 3GPP AAA Server name and set the User Status to NOT_REGISTERED. The 3GPP AAA Server should start the network initiated de-registration towards the user.\n-\tNEW_SERVER_ASSIGNED: The HSS indicates to the 3GPP AAA Server that a new 3GPP AAA Server has been allocated to the user (e.g. because the previous assigned 3GPP AAA Server was found unavailable at a certain point). The 3GPP AAA Server shall remove all user data and session information for the user indicated in the de-registration request. The 3GPP AAA Server shall not start the network initiated de-registration towards the user.\nAccording to the requirements described in 3GPP TS 23.402 [3], 3GPP TS 32.422 [32] and 3GPP TS 23.380 [52], SWx reference point shall enable:\n-\tIndication to 3GPP AAA Server of change of non-3GPP subscriber profile within HSS;\n-\tActivation and deactivation of the subscriber and equipment trace in the PDN GW.\n-\tRequest of identity and location information of the access network and/or UE local time zone.\n-\tIndication to the 3GPP AAA Server that the HSS-based P-CSCF restoration procedure for WLAN, shall be executed as described in 3GPP TS 23.380 [52] clause 5.6.\nThis procedure is used between the 3GPP AAA Server and the HSS. The procedure is invoked by the HSS when the subscriber profile has been modified and needs to be sent to the 3GPP AAA Server. This may happen due to a modification in the HSS.\nThe procedure is also invoked by the HSS to update the 3GPP AAA Server with\n-\tthe identity of a dynamically allocated PDN GW which is included in the APN-Configuration AVP in the User Profile as a result of the first PDN connection establishment associated with an APN over 3GPP access; or\n-\tthe identity of a dynamically allocated PGN GW for emergency services as a result of the establishment of an emergency PDN connection in E-UTRAN.\nThis procedure is mapped to the Diameter command codes Push-Profile-Request (PPR) and Push-Profile-Answer (PPA) specified in the 3GPP TS 29.229 [24]. Information element contents for these messages are shown in tables 8.1.2.3.1/1 and 8.1.2.3.1/2.\nTable 8.1.2.3.1/1: User Profile Update request\n\nTable 8.1.2.3.1/2: User Profile Update response\n\nThe HSS shall make use of this procedure to update the relevant user profile in the 3GPP AAA server (e.g. change of subscription data or change of the identity of a dynamically allocated PDN GW associated with an APN), or activate / deactivate subscriber and equipment trace in the PDN GW.\nThe HSS shall make use of this procedure to request the identity, location information and UE local time zone of the access network where the UE is currently attached. In this case, the HSS shall set the Access-Network-Info-Request and/or the UE-Local-Time-Zone-Request bits in the PPR-Flags AVP; if the HSS sends this command for the only purpose of requesting access network information or the local time zone of the UE (i.e., the user profile is not actually modified), the Non-3GPP-User-Data shall be included in the command as an empty AVP. The HSS shall only invoke this procedure if the 3GPP AAA Server has indicated support for the corresponding feature (see clause 8.2.3.16).\nThe HSS shall make use of this procedure to request to the 3GPP AAA Server the execution of the HSS-based P-CSCF restoration procedure, as described in 3GPP TS 23.380 [52] clause 5.4 if the 3GPP AAA Server indicated the support of this procedure in an earlier command to the HSS. In this case, the HSS shall set the \"P-CSCF Restoration Request\" bit in the PPR Flags and the procedure shall only be used for the purpose of the P-CSCF restoration for WLAN; then, the Non-3GPP-User-Data AVP shall be included as an empty AVP. .\nThe HSS shall make use of this procedure to update the identity of a dynamically allocated PDN GW for emergency services in the 3GPP AAA server, if the 3GPP AAA Server indicated the support of the Emergency Services Continuity feature in an earlier command to the HSS.\nWhen the HSS-initiated user profile update procedure is successful, the 3GPP AAA Server shall overwrite entirely, for the subscriber identity indicated in the request, the currently stored user profile data with the information received from the HSS, if at least one APN-Configuration AVP is included in the Non-3GPP-User-Data AVP received from HSS. If no APN-Configurations are included in the Non-3GPP-User-Data AVP, the 3GPP AAA Server shall only update the currently stored user profile data with the new received data from the HSS.\nIf the HSS-initiated user profile update procedure is not successful, the 3GPP AAA Server shall not modify the stored user profile.\nAfter a successful user profile download, the 3GPP AAA Server shall initiate re-authentication procedure as described in clause 7.2.2.4 if the subscriber has previously been authenticated and authorized to untrusted non-3GPP access. If the subscriber has previously been authenticated and authorized to trusted non-3GPP IP Access then the 3GPP AAA Server shall initiate a re-authorization procedure as described in clause 5.1.2.3.\nAs multiple authorization sessions may exist for the user (see clause 7.1.2.1), the 3GPP AAA Server shall examine the need to execute re-authorization for each of these sessions, and may execute the multiple re-authorization procedures in parallel. In case the user's non-3GPP subscription has been deleted or the user's APN has been barred, the re-authorization shall be executed in all ongoing user related authorization sessions. Otherwise, the re-authorization procedure shall be invoked for the authorization sessions for which at least one of the following conditions is fulfilled:\n-\tThe user's subscribed APN has been deleted from the HSS.\n-\tThe APN configuration data has been previously downloaded to the ePDG and the new version of APN configuration received from HSS reflects a modification in these data.\nFollowing a successful download of subscription and equipment trace data, the 3GPP AAA Server shall forward the trace data by initiating reauthorization towards all PDN GWs that have an active authorization session.\nWhen the UE is attached to a Trusted WLAN, if the HSS has invoked the User Profile Update procedure by setting the Access-Network-Info-Request and/or UE-Local-Time-Zone-Request bits in the PPR-Flags, the 3GPP AAA Server shall initiate a re-authorization procedure towards the TWAN by setting the Re-Auth–Request-Type to AUTHORIZE_ONLY; the TWAN shall send the identification, location information of the Access Point where the UE is attached and the local time zone of the UE, in the subsequent authorization request (AAR command) that follows the re-authorization request/answer exchange (RAR/RAA). If the 3GPP AAA Server determines that the UE is not currently attached to a Trusted WLAN, it shall not initiate any re-authorization procedure towards the access network, and it shall not include any network access information or UE local time zone in the response to the HSS.\nNOTE:\tThe 3GPP AAA Server cannot answer the Push Profile Request received from the HSS until the AAR command has ben received from the TWAN, since it needs to receive the information from the access network, before sending back the Push Profile Answer to the HSS.\nIf the 3GPP AAA Server receives the Push-Profile-Request command with an empty Non-3GPP-User-Data AVP, but some other action is indicated by setting any of the bits in the PPR-Flags AVP, the 3GPP AAA Server shall ignore the Non-3GPP-User-Data AVP, i.e., it shall not apply any changes to the stored user profile.\nWhen the PPR Flags are received with the \"P-CSCF Restoration Request\" bit set, if an IMS PDN connection is established via a trusted or untrusted WLAN access for which the PGW has indicated the support of the P-CSCF restoration feature in an earlier command, the 3GPP AAA Server shall execute the HSS-based P-CSCF restoration for WLAN procedure, as described in 3GPP TS 23.380 [52] clause 5.6. Otherwise, the 3GPP AAA Server does not execute the HSS-based P-CSCF restoration for WLAN procedure.\nTable 8.1.2.3.3/1 details the valid result codes that the 3GPP AAA Server can return in the response.\nTable 8.1.2.3.3/1: User profile response valid result codes\n\nBased on operator policy, if the 3GPP AAA Server receives from the HSS a non-3GPP-User-Data AVP with an MPS-Priority AVP with the MPS-EPS-Priority bit set, the 3GPP AAA Server shall treat commands for the UE with priority as specified in Annex C and Annex D. If the 3GPP AAA Server receives a Non-3GPP-User-Data AVP without an MPS-Priority AVP with the MPS-EPS-Priority bit set and if the last DER command received by the 3GPP AAA Server from the ePDG or the TWAN did not contain a High-Priority-Access-Info AVP with the HPA_Configured bit set, the 3GPP AAA Server shall discontinue priority treatment of commands for the UE.\nNOTE 2:\tThe 3GPP AAA Server treats the UE with priority if either the DER command from the ePDG indicates high priority access or the HSS has indicated an MPS subscription for the UE.\n8.1.2.4.1.1\tGeneral\nThis procedure is used by the HSS to indicate to the 3GPP AAA Server that it has restarted, and the registration data and the dynamic data stored for a set of users may have been lost.\nThis procedure is mapped to the Diameter command codes Push-Profile-Request (PPR) and Push-Profile-Answer (PPA) specified in the 3GPP TS 29.229 [24]. Information Element contents for these messages are shown in tables 8.1.2.4.1.1/1 and 8.1.2.4.1.1/2.\nTable 8.1.2.4.1.1/1: HSS Reset Indication Request\n\nTable 8.1.2.4.1.1/2: HSS Reset Indication Response\n\n8.1.2.4.1.2\tHSS Detailed behaviour\nThe HSS shall use this procedure to indicate to the 3GPP AAA Server about a restart event, affecting a set of users, for whom their registration data and dynamic data may have been lost. The HSS shall only send this command if the 3GPP AAA Server has indicated support for the \"HSS Restoration\" feature. In this case, the HSS shall set the Reset-Indication bit in the PPR-Flags AVP in the PPR command.\nNOTE:\tIf there are multiple 3GPP AAA Servers deployed in the HPLMN, and the HSS is configured (in an implementation-specific manner) in such a way that it can determine that a certain 3GPP AAA Server does not contain any of the users affected by the restart, it can skip sending the PPR command to that specific 3GPP AAA Server.\n8.1.2.4.1.3\t3GPP AAA Server Detailed behaviour\nIf the 3GPP AAA Server supports the \"HSS Restoration\" feature, it shall answer with a successful result to the PPR command, and it shall mark those users affected by the HSS restart as \"pending to be restored in HSS\".\nThe 3GPP AAA Server shall use the HSS Identity received in the Origin-Host AVP (by comparing it with the value stored after a successful MAA command) and may make use of the received \"User List\" Information Element in order to determine which subscriber records are impacted, if any. If the 3GPP AAA Server determines that there are no subscribers affected by the HSS restart, it shall answer with a successful result to the HSS.\n8.1.2.4.2.1\tGeneral\nThis procedure is used by the 3GPP AAA Server to restore in the HSS the registration data and the dynamic data for a certain user. The 3GPP AAA Sever shall use this procedure only after having received a previous indication from HSS of a restart event affecting that user.\nThis procedure is mapped to the Diameter command codes Server-Assignment-Request (SAR) and Server-Assignment-Answer (SAA) specified in the 3GPP TS 29.229 [24]. Information element contents for these messages are shown in tables 8.1.2.4.2.1/1 and 8.1.2.4.2.1/2.\nTable 8.1.2.4.2.1/1: HSS Restoration Request\n\nTable 8.1.2.4.2.1/2: HSS Restoration Response\n\n8.1.2.4.2.2\tHSS Detailed behaviour\nUpon receipt of the SAR command, if the HSS supports the \"HSS Restoration\" feature, and the user's IMSI is known, the HSS shall update the registration data (from the Origin-Host AVP received in the 3GPP AAA Server command) and dynamic data of the user (included in the \"Active APN\" Information Element), and answer with a successful result.\n8.1.2.4.2.3\t3GPP AAA Server Detailed behaviour\nThe 3GPP AAA Server shall use this command to update the HSS with the registration data and dynamic data it has for a user affected by the HSS restart, identified by the \"User List\" IE received previously in the PPR command, and marked in the 3GPP AAA Server as \"pending to be restored in HSS\". The 3GPP AAA Server shall only make use of this procedure in the HSS has indicated support for the \"HSS Restoration\" feature.\nThe 3GPP AAA Server shall invoke the SAR command towards the HSS, after having received further interactions over other reference points (S6b, STa, SWm …) for a user marked as \"pending to be restored in HSS\".\nOnce the 3GPP AAA Server receives confirmation from HSS, in the SAA command, that the user has been successfully restored in the HSS, via the \"HSS Restoration Response\" command, it shall clear the \"pending to be restored in HSS\" flag for that user.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.1.2.1.1/1: Authentication request",
                                    "table number": 55,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.1.1/2: Authentication Data content - request",
                                    "table number": 56,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.1.1/3: Authentication Data content - request, synchronization failure",
                                    "table number": 57,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.1.1/4: Authentication answer",
                                    "table number": 58,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.1.1/5: Authentication Data content - response",
                                    "table number": 59,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.2.2.1/1: Non-3GPP IP Access Registration request",
                                    "table number": 60,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.2.2.1/2: Non-3GPP IP Access Registration response",
                                    "table number": 61,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.3.2.3: Network Initiated Deregistration by HSS request",
                                    "table number": 62,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.3.2.4: Network Initiated Deregistration by HSS response",
                                    "table number": 63,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.3.1/1: User Profile Update request",
                                    "table number": 64,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.3.1/2: User Profile Update response",
                                    "table number": 65,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.3.3/1: User profile response valid result codes",
                                    "table number": 66,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.4.1.1/1: HSS Reset Indication Request",
                                    "table number": 67,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.4.1.1/2: HSS Reset Indication Response",
                                    "table number": 68,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.4.2.1/1: HSS Restoration Request",
                                    "table number": 69,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.1.2.4.2.1/2: HSS Restoration Response",
                                    "table number": 70,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "8.2\tProtocol Specification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.2.1\tGeneral",
                            "text_content": "The SWx reference point shall be Diameter based. This is defined as an IETF vendor specific Diameter application, where the Vendor ID is 3GPP. The Application Id used shall be 16777265.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.2\tCommands",
                            "text_content": "The Multimedia-Authentication-Request (MAR) command, indicated by the Command-Code field set to 303 and the 'R' bit set in the Command Flags field, is sent by the 3GPP AAA Server to the HSS in order to request security information. This corresponds to clause 8.1.2.1.\nMessage Format\n< Multimedia-Auth-Request > ::=  < Diameter Header: 303, REQ, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ User-Name }\n[ RAT-Type ]\n[ AN-Trusted ]\n[ ANID ]\n[ Visited-Network-Identifier]\n[ Terminal-Information ]\n{ SIP-Auth-Data-Item }\n{ SIP-Number-Auth-Items }\n[AAA-Failure-Indication ]\n[ OC-Supported-Features ]\n*[ Supported-Features ]\n…\n*[ AVP ]\n\n\nThe Multimedia-Authentication-Answer (MAA) command, indicated by the Command-Code field set to 303 and the 'R' bit cleared in the Command Flags field, is sent by a server in response to the Multimedia-Authentication-Request command. The Result-Code or Experimental-Result AVP may contain one of the values defined in clause 6.2 of 3GPP TS 29.229 [24] in addition to the values defined in IETF RFC 6733 [58].\nMessage Format\n< Multimedia-Auth-Answer > ::=  < Diameter Header: 303, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n[ Result-Code ]\n[ Experimental-Result ]\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ User-Name}\n[ SIP-Number-Auth-Items ]\n*[ SIP-Auth-Data-Item ]\n[ 3GPP-AAA-Server-Name ]\n[ OC-Supported-Features ]\n[ OC-OLR ] ]\n*[ Load ]\n*[ Supported-Features ]\n…\n*[ AVP ]\n\nNOTE:\tAs the Diameter commands described in this specification have been defined based on the former specification of the Diameter base protocol, the Vendor-Specific-Application-Id AVP is still listed as a required AVP (an AVP indicated as {AVP}) in the command code format specifications defined in this specification to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter base protocol (IETF RFC 6733 [58]).\nThe Push-Profile-Request (PPR) command, indicated by the Command-Code field set to 305 and the 'R' bit set in the Command Flags field, is sent by the HSS to the 3GPP AAA Server in order to update the subscription data whenever a modification has occurred in the subscription data; this corresponds to clause 8.1.2.3. This command is also sent by HSS to indicate a restart event to the 3GPP AAA Server, so the registration data and the dynamic data previously stored in HSS can be restored; this corresponds to clause 8.1.2.4.1.\nMessage Format\n< Push-Profile-Request > ::=\t< Diameter Header: 305, REQ, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Host }\n{ Destination-Realm }\n{ User-Name }\n[ Non-3GPP-User-Data ]\n[ PPR-Flags ]\n*[ Supported-Features ]\n…\n*[ AVP ]\n\nThe Push-Profile-Answer (PPA) command, indicated by the Command-Code field set to 305 and the 'R' bit cleared in the Command Flags field, is sent by the HSS in response to the Push-Profile-Request command. The Result-Code or Experimental-Result AVP may contain one of the values defined in clause 6.2 of 3GPP TS 29.229 [24] in addition to the values defined in IETF RFC 6733 [58].\nMessage Format\n< Push-Profile-Answer > ::=\t< Diameter Header: 305, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n[ Result-Code ]\n[ Experimental-Result ]\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n[ Access-Network-Info ]\n[ Local-Time-Zone ]\n*[ Supported-Features ]\n…\n*[ AVP ]\n\nNOTE:\tAs the Diameter commands described in this specification have been defined based on the former specification of the Diameter base protocol, the Vendor-Specific-Application-Id AVP is still listed as a required AVP (an AVP indicated as {AVP}) in the command code format specifications defined in this specification to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter base protocol (IETF RFC 6733 [58]).\nThe Server-Assignment-Request (SAR) command, indicated by the Command-Code field set to 301 and the 'R' bit set in the Command Flags field, is sent by the 3GPP AAA Server to the HSS; this corresponds to clause 8.1.2.2.2. This command is also sent by the 3GPP AAA Server to restore the registration data and the dynamic data previously stored in HSS, which may have been lost after a restart; this corresponds to clause 8.1.2.4.2.\nMessage Format\n\n< Server-Assignment-Request > ::=\t< Diameter Header: 301, REQ, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n[ Destination-Host ]\n{ Destination-Realm }\n[ Service-Selection ]\n[ Context-Identifier ]\n[ MIP6-Agent-Info ]\n[ Visited-Network-Identifier ]\n{ User-Name}\n{ Server-Assignment-Type }\n*[ Active-APN ]\n[ OC-Supported-Features ]\n*[ Supported-Features ]\n[ Terminal-Information ]\n[ Emergency-Services ]\n…\n*[ AVP ]\n\nThe Server-Assignment-Answer (SAA) command, indicated by the Command-Code field set to 301 and the 'R' bit cleared in the Command Flags field, is sent by the HSS to the 3GPP AAA Server to confirm the registration, de-registration, user profile download or restoration procedure. The Result-Code or Experimental-Result AVP may contain one of the values defined in clause 6.2 of 3GPP TS 29.229 [24] in addition to the values defined in IETF RFC 6733 [58].\nMessage Format\n< Server-Assignment-Answer > ::=\t< Diameter Header: 301, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n[ Result-Code ]\n[ Experimental-Result ]\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ User-Name}\n[ Non-3GPP-User-Data ]\n[ 3GPP-AAA-Server-Name ]\n[ OC-Supported-Features ]\n[ OC-OLR ] ]\n*[ Load ]\n*[ Supported-Features ]\n…\n*[ AVP ]\nNOTE:\tAs the Diameter commands described in this specification have been defined based on the former specification of the Diameter base protocol, the Vendor-Specific-Application-Id AVP is still listed as a required AVP (an AVP indicated as {AVP}) in the command code format specifications defined in this specification to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter base protocol (IETF RFC 6733 [58]).\nThe Registration-Termination-Request (RTR) command, indicated by the Command-Code field set to 304 and the \"R\" bit set in the Command Flags field, is sent by a Diameter Multimedia server to a Diameter Multimedia client in order to request the de-registration of a user. This corresponds to clause 8.1.2.2.3.\nMessage Format\n<Registration-Termination-Request> ::=\t< Diameter Header: 304, REQ, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Host }\n{ Destination-Realm }\n{ User-Name }\n{ Deregistration-Reason }\n*[ Supported-Features ]\n…\n*[ AVP ]\n\nThe Registration-Termination-Answer (RTA) command, indicated by the Command-Code field set to 304 and the \"R\" bit cleared in the Command Flags field, is sent by a client in response to the Registration-Termination-Request command. The Result-Code or Experimental-Result AVP may contain one of the values defined in clause 6.2 of 3GPP TS 29.229 [24] in addition to the values defined in IETF RFC 6733 [58].\nMessage Format\n<Registration-Termination-Answer> ::=\t< Diameter Header: 304, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n[ Result-Code ]\n[ Experimental-Result ]\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n*[ Supported-Features ]\n…\n*[ AVP ]\n\nNOTE:\tAs the Diameter commands described in this specification have been defined based on the former specification of the Diameter base protocol, the Vendor-Specific-Application-Id AVP is still listed as a required AVP (an AVP indicated as {AVP}) in the command code format specifications defined in this specification to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter base protocol (IETF RFC 6733 [58]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.3\tInformation Elements",
                            "text_content": "The following table describes the Diameter AVPs defined for the SWx interface protocol, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.\nTable 8.2.3.0/1: Diameter SWx AVPs\n\nThe following table describes the Diameter AVPs re-used by the SWx interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within SWx. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol (see IETF RFC 6733 [58]), do not need to be supported.\nTable 8.2.3.0/2: SWx re-used Diameter AVPs\n\nOnly those AVP initially defined in this reference point or AVP with values initially defined in this reference point and for this procedure are described in the following clauses.\nThe Non-3GPP-User-Data AVP is of type Grouped. It contains the information related to the user profile relevant for EPS.\nAVP format:\nNon-3GPP-User-Data ::=\t< AVP Header: 1500 10415 >\n[ Subscription-ID ]\n[ Non-3GPP-IP-Access ]\n[ Non-3GPP-IP-Access-APN ]\n*[ RAT-Type ]\n[ Session-Timeout ]\n[ MIP6-Feature-Vector ]\n[ AMBR ]\n[ 3GPP-Charging-Characteristics ]\n[ Context-Identifier ]\n[ APN-OI-Replacement ]\n*[ APN-Configuration ]\n[ Trace-Info ]\n[ TWAN-Default-APN-Context-Id ]\n*[ TWAN-Access-Info]\n[ UE-Usage-Type ]\n[ Emergency-Info ]\n[ ERP-Authorization ]\n[ Core-Network-Restrictions ]\n[ MPS-Priority ]\n*[ AVP ]\n\nThe Subscription-ID, if present in this grouped AVP, shall contain either an MSISDN (if this identity is present in the subscription), or an External Identifier (if the subscriber does not have an MSISDN identity but has an External Identifier in the subscription).\nThe AMBR included in this grouped AVP shall include the AMBR associated to the user's subscription (UE-AMBR).\nThe APN-OI-Replacement included in this grouped AVP shall include the UE level APN-OI-Replacement associated to the user's subscription. This APN-OI-Replacement has lower priority than APN level APN-OI-Replacement that is included in the APN-Configuration AVP.\nThe Non-3GPP-User-Data AVP shall only contain APN-Configuration AVP(s) configured in the user subscription with an IP PDN type.\nThe Context-Identifier in this grouped AVP shall identify the user's default APN configuration. The TWAN-Default-APN-Context-Id AVP identifies the default APN configuration for EPC access over Trusted WLAN. This AVP shall be present if the default APN configuration for EPC access over Trusted WLAN differs from the default APN configuration for 3GPP access and other non-3GPP accesses. This AVP may be present otherwise.\nThe RAT-Type AVP(s) shall include the access technology type(s) not allowed for the user as specified in clause 2.13.126 of 3GPP TS 23.008 [49].\nThe Emergency-Info AVP shall contain the identity of the PDN-GW used for the establishment of emergency PDN connections.\nThe MIP6-Feature-Vector may provide HSM and/or NBM authorization information (see clause 8.2.3.28).\nFor the conditions specified in clause 8.1.2.3.2, the Non-3GPP-User-Data AVP shall be empty, i.e. not include any AVP.\nIf the Non-3GPP-User-Data AVP is not empty, the Non-3GPP-IP-Acess AVP, the Non-3GPP-IP-Access-APN AVP, the Context-Identifier AVP and at least one item of the APN-Configuration AVP shall always be included, except when the Non-3GPP-User-Data AVP is used for downloading trace activation or deactivation information on the SWx interface, for an already registered user, or when the Non-3GPP-User-Data is used for downloading the Emergency-Info. In those specific cases, the Trace-Info AVP, or respectively the Emergency-Info AVP, shall be included and the presence of any further AVPs is optional.\nThe MPS-Priority AVP shall be present if an MPS subscription exists in the HSS for the UE.\nThe Subscription-ID AVP is of type Grouped and indicates the user identity to be used for charging purposes. It is defined in the IETF RFC 4006 [20]. EPC shall make use only of the MSISDN and External Identifier values.\nWhen the identity to be conveyed is an MSISDN, the AVP Subscription-Id-Type shall be set to value \"END_USER_E164\".\nWhen the identity to be conveyed is an External Identifier, the AVP Subscription-Id-Type shall be set to value \"END_USER_NAI\".\nThen AVP Subscription-Id-Data, with type UTF8String, shall contain the identity of the user.\nAVP format:\nSubscription-Id ::=\t< AVP Header: 443 >\n[ Subscription-Id-Type ]\n[ Subscription-Id-Data ]\nThe Non-3GPP-IP-Access AVP (AVP code 1501) is of type Enumerated, and allows operators to determine if the subscriber is barred from using the non-3GPP access network. The following values are defined:\nNON_3GPP_SUBSCRIPTION_ALLOWED (0)\nThe subscriber has non-3GPP subscription and is authorized to use the non-3GPP access network.\nNON_3GPP_SUBSCRIPTION_BARRED (1)\nThe subscriber is barred from using the non-3GPP access network.\nThe Non-3GPP-IP-Access-APN AVP (AVP code 1502) is of type Enumerated, and allows operator to disable all APNs for a subscriber at one time. The following values are defined:\nNon_3GPP_APNS_ENABLE (0)\nEnable all APNs for a subscriber.\nNon_3GPP_APNS_DISABLE (1)\nDisable all APNs for a subscriber\nThe RAT-Type AVP (AVP code 1032) is of type Enumerated. The encoding of the AVP is specified in 3GPP TS 29.212 [23].\nThe Session-Timeout AVP is of type Unsigned32. It is defined in IETF RFC 6733 [58] and indicates the maximum period for a session measured in seconds. This AVP is used for re-authentication purposes. If this field is not used, the non-3GPP Access Node will apply default time intervals.\nThe APN-Configuration AVP is of type Grouped AVP and is defined in 3GPP TS 29.272 [29].\nThe following AVPs defined in the APN-Configuration AVP in 3GPP TS 29.272 [29] are not applicable to Non-3GPP accesses and therefore need not be included in the APN-Configuration AVP over the SWx, SWd, SWm, STa and S6b reference points:\n-\tLIPA-Permission AVP\n-\tRestoration-Priority AVP\n-\tSIPTO-Local-Network-Permission AVP\n-\tWLAN-offloadability AVP\n-\tNon-IP-PDN-Type-Indicator AVP\n-\tNon-IP-Data-Delivery-Mechanism AVP\n-\tSCEF-ID AVP\n-\tSCEF-Realm AVP\n-\tPreferred-Data-Mode AVP\nThe ANID AVP is defined in clause 5.2.3.7.\nThe SIP-Auth-Data-Item AVP is defined in 3GPP TS 29.229 [24]. The optional AVPs that are needed in SWx reference point are included in the ABNF representation below.\nAVP format:\nSIP-Auth-Data-Item ::=\t< AVP Header: 612 10415 >\n[ SIP-Item-Number ]\n[ SIP-Authentication-Scheme ]\n[ SIP-Authenticate ]\n[ SIP-Authorization ]\n[ Confidentiality-Key ]\n[ Integrity-Key ]\n*[ AVP ]\nThe Confidentiality-Key AVP is defined in 3GPP TS 29.229 [24]. It is of type OctetString, and contains the Confidentiality Key (CK') or, after key derivation using the Access Network Identifier, the Confidentiality Key (CK'). For the 3GPP AAA server it is transparent whether the value received corresponds to CK or CK'.\nThe Integrity-Key AVP is defined in 3GPP TS 29.229 [24]. It is of type OctetString, and contains the Integrity Key (IK) or, after key derivation using the Access Network Identifier, the Integrity Key (IK'). For the 3GPP AAA server it is transparent whether the value received corresponds to IK or IK'.\nThe Server-Assignment-Type AVP is defined in 3GPP TS 29.229 [24] and it is of type Enumerated, and indicates the type of server update being performed in a Server-Assignment-Request operation. As part of the SWx protocol specification, the following values are additionally defined:\nAAA_USER_DATA_REQUEST (12)\nThis value is used to request the non-3GPP user profile data from the 3GPP AAA Server to the HSS.\nPGW_UPDATE (13)\nThis value is used to store, update or delete the PDN-GW Identity in the HSS, as requested from the 3GPP AAA Server.\nRESTORATION (14)\nThis value is used to store in the HSS registration data and dynamic data that may have been potentially lost after a restart event.\n\nThe Trace-Info AVP is of type Grouped. This AVP shall contain the information related to subscriber and equipment trace function and the required action, i.e. activation of deactivation\nAVP format\nTrace-Info ::= < AVP header: 1505 10415>\n[Trace-Data]\n[Trace-Reference]\n*[AVP]\nEither the Trace-Data or the Trace-Reference AVP shall be included. When trace activation is needed, Trace-Data AVP shall be included, while the trace deactivation request shall be signalled by including the Trace-Reference directly under the Trace-Info. The Trace-Reference AVP is of type OctetString. The Diameter AVP is defined in 3GPP TS 29.272 [29].\nThe Trace-Data AVP is of type Grouped. The Diameter AVP is defined in 3GPP TS 29.272 [29].\nThe syntax of this AVP is defined in 3GPP TS 29.229 [24]. For this release, the Feature-List-ID AVP value shall be set to 1 for the SWx application.\nThe syntax of this AVP is defined in 3GPP TS 29.229 [24]. A null value indicates that there is no feature used by the SWx application. The meaning of the bits shall be as defined in table 8.2.3.16/1.\nTable 8.2.3.16/1: Features of Feature-List-ID 1 used in SWx\n\nFeatures that are not indicated in the Supported-Features AVPs within a given application message shall not be used to construct that message.\nThe PPR-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 8.2.3.17/1:\nTable 8.2.3.17/1: PPR-Flags\n\nThe TWAN-Default-APN-Context-Id AVP is of the type Unsigned32 and shall identify the context identifier of the subscriber's default APN to be used for Trusted WLAN access to EPC over S2a.\nNote: The default APN for Trusted WLAN access to EPC over S2a can differ from the default APN for 3GPP and other non-3GPP accesses.\nThe TWAN-Access-Info AVP is of type Grouped.\nIf no WLAN-Identifier AVP is included in the TWAN-Access-Info AVP, the allowed access methods shall apply to any arbitrary Trusted WLAN. See clause 5.1.2.1.2.\nIf the Access-Authorization-Flags AVP is not present in the TWAN-Access-Info AVP, EPC access and Non-Seamless WLAN Offload shall be considered to be not allowed.\nA specific Trusted-WLAN shall appear in at most one TWAN-Access-Info AVP.\nThere shall be at most one TWAN-Access-Info AVP not including any WLAN-Identifier.\nAVP Format:\nTWAN-Access-Info::=\t< AVP Header: 1510 10415 >\n[ Access-Authorization-Flags ]\n[ WLAN-Identifier ]\n*[ AVP ]\n\nThe Access-Authorization-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 8.2.3.20/1:\nTable 8.2.3.20/1: Access-Authorization-Flags\n\nNOTE:\tUE is allowed to access the EPC when connected via Trusted WLAN access only if the Non-3GPP-IP-Access-APN AVP does not disable all APNs and the EPC-Access-Authorization bit is set.\nThe AAA-Failure-Indication AVP is of type Unsigned32 and it shall contain a bitmask. The meaning of the bits is defined in table 8.2.3.21/1:\nTable 8.2.3.21/1: AAA-Failure-Indication\n\nThe OC-Supported-Features AVP is of type Grouped and it is defined in IETF RFC 7683 [47]. This AVP is used to support Diameter overload control mechanism, see Annex B for more information.\nThe OC-OLR AVP is of type Grouped and it is defined in IETF RFC 7683 [47]. This AVP is used to support Diameter overload control mechanism, see Annex B for more information.\nThe 3GPP-AAA-Server-Name AVP is of type DiameterIdentity, and defines the Diameter address of the 3GPP AAA Server node.\nThe DRMP AVP is of type Enumerated and is defined in IETF RFC 7944 [53]. This AVP allows the 3GPP functional entities to indicate the relative priority of Diameter messages. The DRMP AVP may be used to set the DSCP marking for transport of the associated Diameter message.\nThe Load AVP is of type Grouped and it is defined in IETF RFC 8583 [54]. This AVP is used to support Diameter load control mechanism, see Annex E for more information.\nThe ERP-Authorization AVP is of type Unsigned32 and it indicates whether the subscriber is authorized, or not, to make use of the EAP Reauthentication Protocol. The following values are defined:\nERP_NOT_AUTHORIZED (0)\nERP_AUTHORIZED (1)\nThe MIP6-Feature-Vector AVP (AVP Code 124) is of type Unsigned64 and contains a 64 bit flags field of the mobile IP capabilities authorized by the HSS.\nThe following capabilities are defined for the SWx interface:\n-\tMIP6_INTEGRATED (0x0000000000000001)\nThis flag means that DSMIPv6 is authorized.\n-\tPMIP6_SUPPORTED (0x0000010000000000)\nThis flag means that NBM is authorized.\n-\tMIP4_SUPPORTED (0x0000100000000000)\nThis flag means that MIPv4 is authorized.\n-\tGTPv2_SUPPORTED (0x0000400000000000)\nThis flag means that NBM is authorized.\nNBM shall be considered as authorized if at least one of the PMIP6_SUPPORTED and GTPv2_SUPPORTED flag is set.\nNOTE:\tThe selection of the protocol variant (GTPv2 or PMIPv6) on S2a/S2b is determined solely by the TWAN/ePDG. It does not matter whether the HSS sets the PMIP6_SUPPORTED and/or GTPv2_SUPPORTED flags to authorize NBM.\nBased on operator policy, the 3GPP AAA Server may also authorize the use of NBM, irrespective of the presence or content of the MIP6-Feature-Vector AVP in the Non-3GPP User Data.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 8.2.3.0/1: Diameter SWx AVPs",
                                    "table number": 71,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.2.3.0/2: SWx re-used Diameter AVPs",
                                    "table number": 72,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.2.3.16/1: Features of Feature-List-ID 1 used in SWx",
                                    "table number": 73,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.2.3.17/1: PPR-Flags",
                                    "table number": 74,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.2.3.20/1: Access-Authorization-Flags",
                                    "table number": 75,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 8.2.3.21/1: AAA-Failure-Indication",
                                    "table number": 76,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "8.2.4\tSession Handling",
                            "text_content": "The Diameter protocol between the 3GPP AAA Server and the HSS shall not keep the session state and each Diameter request/response interaction shall be transported over a different diameter session which is implicitly terminated.\nIn order to indicate that session state shall not be maintained, the diameter client and server shall include the Auth-Session-State AVP set to the value NO_STATE_MAINTAINED (1), as described in IETF RFC 6733 [58]. As a consequence, the server shall not maintain any state information about this session and the client shall not send any session termination request. Neither the Authorization-Lifetime AVP nor the Session-Timeout AVP shall be present in requests or responses.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "8.3\tUser identity to HSS resolution",
                    "description": "",
                    "summary": "",
                    "text_content": "The User identity to HSS resolution mechanism enables the 3GPP AAA server to find the identity of the HSS that holds the subscriber data for a given user identity when multiple and separately addressable HSSs have been deployed by the network operator. The resolution mechanism is not required in networks that utilise a single HSS or when a 3GPP AAA server is configured to use pre-defined HSS address/identity.\nThis User identity to HSS resolution mechanism may rely on routing capabilitites provided by Diameter and be implemented in the home operator network within dedicated Diameter Agents (Redirect Agents or Proxy Agents) responsible for determining the HSS identity based on the provided user identity. If this Diameter based implementation is selected by the Home network operator, the principles described below shall apply.\nIn networks where more than one independently addressable HSS are utilized by a network operator, and the 3GPP AAA server is not configured to use pre-defined HSS address/identity, each 3GPP AAA server shall be configured with the address/identity of the Diameter Agent (Redirect Agent or Proxy Agent) implementing this resolution mechanism.\nTo get the HSS identity that holds the subscriber data for a given user identity, the 3GPP AAA server shall send the Diameter request normally destined to the HSS to a pre-configured address/identity of a Diameter agent supporting the User identity to HSS resolution mechanism.\n-\tIf this Diameter request is received by a Diameter Redirect Agent, the Diameter Redirect Agent shall determine the HSS identity based on the provided user identity and sends to the 3GPP AAA server a notification of redirection towards the HSS identity, in response to the Diameter request. Multiple HSS identities may be included in the response from the Diameter Redirect Agent, as specified in IETF RFC 6733 [58]. In such a case, the 3GPP AAA server shall send the Diameter request to the first HSS identity in the ordered list received in the Diameter response from the Diameter Redirect Agent. If no successful response to the Diameter request is received, the 3GPP AAA server shall send a Diameter request to the next HSS identity in the ordered list. This procedure shall be repeated until a successful response from an HSS is received.\n-\tIf this Diameter request is received by a Diameter Proxy Agent, the Diameter Proxy Agent shall determine the HSS identity based on the provided user identity and - if the Diameter load control mechanism is supported (see IETF RFC 8583 [54]) - optionally also based on previously received load values from Load AVPs of type HOST. The Diameter Proxy Agent shall then forward the Diameter request directly to the determined HSS. The 3GPP AAA server shall determine the HSS identity from the response to the Diameter request received from the HSS.\nAfter the User identity to HSS resolution, the 3GPP AAA server shall store the HSS identity/name/Realm and shall use it in further Diameter requests associated to the same user dentity.\nNOTE:\tAlternatives to the user identity to HSS resolution Diameter based implementation are outside the scope of this specification.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "9\tS6b Description",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "9.1\tFunctionality",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.1.1\tGeneral",
                            "text_content": "The S6b reference point is defined between the 3GPP AAA Server and the PDN-GW. The definition of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nWhen the UE attaches to the EPC using the S2c reference point, the S6b reference point is used to authenticate and authorize the UE, and update the PDN-GW address to the 3GPP AAA server and HSS.\nWhen the UE attaches to the EPC using the S2a/S2b reference point in the PMIPv6 or GTPv2 mode, the S6b reference point is used to update the 3GPP AAA server or the 3GPP AAA proxy with the PDN-GW address information and with the selected S2a/S2b protocol variant. Furthermore, this reference point may be used to retrieve and update other mobility related parameters including static QoS profiles for non-3GPP accesses.\nThe S6b reference point is also used to authenticate and authorize the incoming MIPv4 Registration Request in the case the UE attaches to the EPC over the S2a reference point using MIPv4 FACoA procedures.\nThe S6b reference point is used by the 3GPP AAA Server in the case the UE attaches to the EPC using the S2c reference point to indicate to the PDN GW that a PDN GW reallocation shall be performed. This indication triggers the actual Home Agent reallocation procedure as specified in 3GPP TS 24.303 [13].\nThe S6b reference point is also used to download subscriber and equipment trace information to the PDN GW.\nThe S6b reference point is also used by the 3GPP AAA Server to indicate to the PDN GW that the HSS-based P-CSCF restoration procedure for WLAN shall be executed as described in 3GPP TS 23.380 [52] clause 5.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.1.2\tProcedures Description",
                            "text_content": "The S6b interface shall enable the authentication and authorization between the UE and the 3GPP AAA Server/Proxy for DSMIPv6.\nWhen an UE performs the DSMIPv6 initial attach, it runs an IKEv2 exchange with the PDN GW as specified in 3GPP TS 24.303 [13]. In this exchange EAP AKA is used for UE authentication over IKEv2. The PDN GW acts as an IKEv2 responder and an EAP pass-through authenticator for this authentication.\nThe S6b authentication and authorization procedure is invoked by the PDN GW after receiving an IKE_SA_AUTH message from the UE. The S6b reference point performs authentication based on reuse of the DER/DEA command set defined in Diameter EAP. The exact procedure follows the steps specified in IETF RFC 5778 [11].\nNOTE:\tThis procedure is only used with DSMIPv6-capable UEs; therefore, only PDNs with PDN Types IPv6 or IPv4v6 are accessible in this case.\nTable 9.1.2.1/1: Authentication and Authorization Request\n\nTable 9.1.2.1/2: Authentication and Authorization Answer\n\nAfter completing the IKE_SA_INIT exchange, upon receipt of an IKE_AUTH message, including the IDi payload but not the AUTH payload, the PDN GW shall send an Diameter-EAP-Request (DER) message towards the 3GPP AAA Server / Proxy. The EAP Payload AVP shall contain an EAP-Response/Identity with the identity extracted from the IDi field.\nUpon receipt of an IKE_AUTH message with an EAP payload from the UE, the PDN GW shall send an Diameter-EAP-Request (DER) with the EAP Payload AVP containing the according EAP-Response to the 3GPP AAA Server / Proxy.\nUpon receipt of a Diameter-EAP-Answer (DEA) message from the 3GPP AAA Server / Proxy, the PDN GW shall then send an IKE_AUTH message containing the according EAP Payload to the UE.\nUpon receipt of an IKE_AUTH message with the AUTH payload after the EAP authentication was successful, the PDN_GW shall proceed as specified in 3GPP TS 24.303 [13].\nIf the handover indication to the PGW is missing, i.e. IPv6 Home Network Prefix assigned to the UE is not included in IKE_AUTH request message as specified in 3GPP TS 24.303 [13], the PGW shall notify 3GPP AAA Server that the UE performs initial attach by setting Initial-Attach-Indicator in the DER-S6b-flags AVP.\nThe PDN GW shall utilize the downloaded APN configuration data, among others, to decide whether the user's request for an IPv4 home address and/or IPv6 home address prefix shall be accepted or rejected.\nIf the Result-Code AVP is set to DIAMETER_SUCCESS_RELOCATE_HA and if the PGW has received a PGW identity in form of the FQDN from the 3GPP AAA server, then the PGW may obtain the IP address of the Home Agent functionality of that PGW as described in 3GPP TS 29.303 [34].\nIf Trace-Info AVP has been received in the authentication and authorization response, the PDN GW shall start a trace session for the user. For details, see 3GPP TS 32.422 [32].\nIf the PDN-GW determines that a previously assigned 3GPP AAA Sever is unavailable, it may attempt to send a new authentication and authorization request to an alternate 3GPP AAA Server. If the PDN-GW receives from this new server a redirect indication towards the former server (due to the HSS having stored the former 3GPP AAA Server identity), it shall terminate all previously existing sessions and PDN connections for that user, and it shall re-send again the request towards the new server, but it shall include the AAA-Failure-Indication AVP in the new request.\nFor S6b, on receipt of the DER message, the 3GPP AAA Server shall process the DER message according to 3GPP TS 33.402 [19].\nUpon successful completion, a DIAMETER_SUCCESS shall be returned to indicate successful authentication procedure and authentication information shall be returned. If the APN requested by the PDN GW is authorized by the wildcard APN, the 3GPP AAA Server shall include the wildcard APN in the Service-Selection AVP of the APN-Configuration AVP. The AAA server shall also include, among others, the MIP6-Feature-Vector AVP, including the subscriber profile of the UE in terms of DSMIPv6 feature the UE is authorized to use.\nIf the HSS indicates that the user is currently being served by a different PDN GW, the 3GPP AAA Server shall respond to to the PDN GW with the Result-Code set to DIAMETER_SUCCESS_RELOCATE_HA and include the new assigned PDN GW identity in the MIP6-Agent-Info AVP.\nIf receiving the UE Care of Address from the PDN GW and Initial-Attach-Indicator set by the PGW in DER-S6b-flags, the 3GPP AAA Server may select a different PDN GW which is closer to the UE than the currently serving PDN GW as specified in 3GPP TS 23.402 [3] based on the received UE Care of Address. In this case, the 3GPP AAA Server shall respond to the PDN GW with the Result-Code set to DIAMETER_SUCCESS_RELOCATE_HA and include the selected PDN GW identity in the MIP6-Agent-Info AVP.\nIf the HSS indicates that the user is currently being served by a different 3GPP AAA Server, the 3GPP AAA Server shall respond to the PDG-GW with the Result-Code set to DIAMETER_REDIRECT_INDICATION and Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\nIf the 3GPP AAA Server receives a request message not related to any existing session and is able to recognize that the PDN-GW included the AAA-Failure-Indication AVP in the request, the 3GPP AAA Server shall also include the AAA-Failure-Indication AVP over the SWx interface, while retrieving the access authentication and authorization data from the HSS.\nThe 3GPP AAA Server shall run EAP-AKA as specified in 3GPP TS 33.402 [19]. Exceptions shall be treated as error situations and the result code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nBefore sending out the AKA challenge, the 3GPP AAA Server shall decide whether the access network is handled as Trusted or Untrusted and set the value of the AN-Trusted AVP correspondingly in the answer message to indicate the trust relationship of the access network to the PDN GW. The 3GPP AAA Server shall make the decision based on the UE Identity and the trust relationship information marked during the authentication and authorization procedure over STa, SWa or SWm. If the 3GPP AAA server is unable to determine the trust relationship of the access network, it shall not include the AN-Trusted AVP in the answer message to the PDN GW.\nFor Fixed Broadband access network interworking as specified in 3GPP TS 23.139 [39],\n-\tFor trusted access, the 3GPP AAA server shall determine if the UE is connected via a BBF-defined WLAN access according to the UE local IP address in UE-Local-IP-Address AVP from the PDN GW. If the UE is connected via a BBF-defined WLAN access, the 3GPP AAA server shall perform the enabling UE reflective QoS function as specified in 3GPP TS 24.139 [43].\n-\tFor untrusted access, the UE local IP address is assigned by the ePDG and not by the non-3GPP access network. Hence, in this case the 3GPP AAA Server shall ignore the UE local IP address in UE-Local-IP-Address AVP from the PDN GW.\nThe 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the authentication answer that completes a successful authentication, the 3GPP AAA Proxy shall record the state of the connection (i.e. Authentication Successful).\nIf receiving the UE Care of Address from the PDN GW which is in the VPLMN, the 3GPP AAA Proxy may select a different PDN GW which is closer to the UE than the currently serving PDN GW as specified in 3GPP TS 23.402 [3] based on the received UE Care of Address. In this case, the 3GPP AAA Proxy shall respond to the PDN GW with the Result-Code set to DIAMETER_SUCCESS_RELOCATE_HA and include the selected PDN GW identity in the MIP6-Agent-Info AVP.\nThe following authorization procedures take place upon a reception of a PBU at the PDN GW from the MAG or upon a reception of a Create Session Request at the PDN GW from the trusted non-3GPP access network or from the ePDG.\nThe PDN GW shall update its identity to the 3GPP AAA Server and HSS. Static QoS profile information may also be downloaded at the same time. If the PDN GW reports to the 3GPP AAA server that GTPv2 is used over the S2a or S2b interface, the 3GPP AAA Server may decide not to download parameters to the PDN GW on the S6b interface which are already provided to the PGW via the trusted non-3GPP access network through the STa and GTPv2 based S2a interfaces or via the ePDG through the SWm and the GTPv2 based S2b interfaces (e.g, static QoS profile, Trace Information, APN-AMBR).\nThe procedures are based on the reuse of NASREQ IETF RFC 4005 [4] AAR and AAA commands and the Diameter extensions defined for PMIP in IETF RFC 5779 [2].\nTable 9.1.2.2.1/1: Authorization request\n\nTable 9.1.2.2.1/2: Authorization answer\n\nUpon receipt of a PBU message from the MAG or upon receipt of a Create Session Request from the trusted non-3GPP access network or the ePDG which requires the establishment of a new PDN connection via the non-3GPP access, the PDN GW shall initiate an authorization procedure, by sending an Authorization Request message to the 3GPP AAA server or to the 3GPP AAA Proxy, with the Auth-Request-Type set to AUTHORIZE_ONLY, in order to update the PGW Address for the APN and the selected S or S2b protocol variant, as well as to optionally download any UE specific APN profile information such as IP address allocation information, QoS Information, Session timeouts, Session Idle timeouts etc.\nThe Create Session Request received from the trusted non-3GPP access network or the ePDG may include the identities of the 3GPP AAA server assigned to the UE i.e. the Origin-Host and Origin-Realm of the 3GPP AAA server included in the DEA message received by the ePDG/TWAN over SWm or STa interface. If supported, the PDN GW shall use these identities to address the Authorization Request message to the selected 3GPP AAA server.\nThe PDN GW shall include in the request the APN where the user shall be connected to. The PGW shall additionally include the Emergency-Services AVP, with the Emergency-Indication bit set, during the establishment of an emergency PDN connection.\nThe PDN GW Identity and PLMN shall only be included in the initial request to the 3GPP AAA server; subsequent authorization messages (due to a handover to a different MAG, for instance) shall not include it again.\nAfter reception of the Authorization Response message, the PDN GW shall check that the Result-Code is set to DIAMETER_SUCCESS and, if so, it shall proceed to connect the user to the specified APN.\nFor PMIPv6 based S or S2b, if Trace-Info AVP including Trace-Data has been received in the authorization response, the PDN GW shall start a trace session for the user. If Trace-Info including Trace-Reference (directly under the Trace-Info) has been received in the authorization response, the PDN GW shall stop the ongoing trace session, identified by the Trace-Reference. For details, see 3GPP TS 32.422 [32].\nFor GTPv2 based S or S2b, the PDN GW shall ignore the Trace-Info AVP if received in the authorization response.\nNOTE:\tFor GTPv2 based S2a or S2b, trace is activated and deactivated via the STa and S2a interfaces or via the SWm and S2b interfaces.\n\nUpon receipt of the Authorization Request message from the PDN GW, the 3GPP AAA Server shall check whether the user's profile is available.\nIf the user's data exist in the 3GPP AAA Server, it shall check, whether it also has an active access authorization session for the user.\n-\tIf not, the 3GPP AAA Server shall reject the authorization request, including the Result-Code DIAMETER_AUTHORIZATION_REJECTED.\n-\tIf the 3GPP AAA Server has an existing authorization session,\n-\tIf the APN requested by the PDN GW is included in the list of authorized APNs of the user or if the Emergency-Indication bit of the Emergency-Services AVP is set in the Authorization Request, then the 3GPP AAA Server shall:\n-\tset the Result-Code to DIAMETER_SUCCESS;\n-\tinclude the APN-Configuration AVP in the authorization answer if PMIP is used over S2a or S2b; the APN-Configuration AVP may also be included if GTPv2 is used over S2a or S2b. When the APN-Configuration AVP is included in the authorization answer, the Service-Selection AVP within the APN-Configuration AVP shall contain the wildcard APN if the APN requested by the PDN GW is authorized by the wildcard APN;\n-\tupdate the PDN GW information for the APN for the UE on the HSS as specified in clause 8.1.2.2.2, if the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authorization Request; and\n-\tupdate on the HSS the PDN GW Identity used for the establishment of emergency PDN connections for the UE, as specified in clause 8.1.2.2.2, based on operator policy (e.g. on whether the operator uses a static PDN GW or not for emergency services), if the Emergency-Services AVP is present, with the Emergency-Indication bit set, in the Authorization Request and the user is non-roaming and authenticated.\n-\tIf the APN requested by the PDN GW is not included in the list of authorized APNs and the Emergency-Indication AVP is not present in the Authorization Request, then the status code DIAMETER_AUTHORIZATION_REJECTED shall be returned to the PDN GW to indicate an unsuccessful authorization.\nIf the user's profile does not exist in the 3GPP AAA Server, it shall retrieve the Diameter identity of the 3GPP AAA Server currently serving the user from the HSS following the procedures for subscriber profile download as specified in clause 8.1.2.2.2. Depending on the HSS response,\n-\tIf the HSS indicates that the user is currently being served by a different 3GPP AAA Server, the 3GPP AAA Server shall respond to the PDN-GW with the Result-Code set to DIAMETER_REDIRECT_INDICATION and Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\n-\tIf the HSS returns DIAMETER_ERROR_USER_UNKNOWN, the 3GPP AAA Server shall return the same error to the PDN GW.\n-\tIf the HSS sends the user's profile to the 3GPP AAA Server, the authorization shall be rejected by setting the Result-Code to DIAMETER_AUTHORIZATION_REJECTED. The 3GPP AAA Server shall delete the downloaded user profile.\nNOTE 1:\tThe last outcome corresponds to the case that the user has no active access authorization procedure. This is considered as an error situation, e.g. the Trusted Non-3GPP access network may have sent PBU without authorizing the user.\nNOTE 2:\tAfter the 3GPP AAA Server has accepted a new S6b session from a particular PGW, the 3GPP AAA server can consider that any existing S6b session(s) for the same UE – APN combination supported via a different PGW (i.e. with a different Origin-Host AVP) is obsolete and can send ASR command(s) to initiate the termination of the hanging session(s) in that PGW.\nIf the 3GPP AAA Server supports the detection and handling of late arriving requests as specified in clause 13.2 of 3GPP TS 29.274 [38], upon receipt of an Authorization Request which collides with an existing session context, for the same UE and APN but a different PGW (i.e. different Origin-Host AVP), the 3GPP AAA Server shall accept the new Authorization Request only if it contains a more recent Origination Time Stamp than the Origination Time Stamp stored for the existing S6b session. An incoming Authorization Request shall be considered as more recent than an existing session and be accepted if no Origination Time Stamp information was provided for at least one of the two sessions. The 3GPP AAA Server shall reject an incoming Authorization Request whose Origination Time Stamp is less recent than the Origination Time Stamp of the existing session by setting the Experimental-Result-Code to DIAMETER_ERROR_LATE_OVERLAPPING_REQUEST.\nIf the 3GPP AAA Server supports the detection and handling of late arriving requests as specified in clause 13.3 of 3GPP TS 29.274 [38], upon receipt of an Authorization Request which contains the Origination Time Stamp and the Maximum Wait Time parameters, the 3GPP AAA Server should check that the request has not already timed out at the originating entity. The 3GPP AAA Server may perform additional similar checks before sending the answer, e.g. upon receipt of a response from the HSS. The 3GPP-AAA Server should reject an Authorization Request that is known to have timed out by setting the Experimental-Result-Code to DIAMETER_ERROR_TIMED_OUT_REQUEST.\nThe 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the authorization answer, the 3GPP AAA Proxy\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authorization Successful).\nThe S6b reference point allows the PDN GW to inform the 3GPP AAA server that the UE disconnected a PDN connection associated to an APN, or that the PDN connection was handed over to the 3GPP access, and therefore the mobility session established for this PDN connection is to be removed.\nThe procedure shall be initiated by the PDN GW. These procedures are based on the reuse of Diameter STR and STA commands as specified in IETF RFC 6733 [58].\nEach PDN connection shall be identified by the Diameter Session-Id parameter.\nTable 9.1.2.3.1/1: S6b Session Termination Request\n\nTable 9.1.2.3.1/2: S6b Session Termination Answer\n\nThe PDN GW shall make use of this procedure when the PDN Connection associated to the diameter session is, either disconnected, or handed over to the 3GPP access.\nUpon receipt of the Session Termination Answer message from the 3GPP AAA Server or from the 3GPP AAA Proxy, the PDN GW shall check the Result Code AVP, and in case of a DIAMETER_SUCCESS code, it shall release the context associated to the active session identified by the Session-Id parameter used in the initial authorization exchange.\nUpon receipt of the Session Termination Request message from the PDN GW or from the 3GPP AAA Proxy, the 3GPP AAA Server shall check that there is an ongoing session associated to any of the parameters received in the message (Session-Id and User Name).\nIf an active session is found, the 3GPP AAA Server shall release the session context associated to the specified session, and a Session Termination Answer message shall be sent to the PDN GW or 3GPP AAA Proxy, indicating DIAMETER_SUCCESS.\nIf the Session-Id included in the request does not correspond with any active session, or if an active session is found but it does not belong to the user identified by the User Name parameter, then a Session Termination Answer message shall be sent to the PDN GW or 3GPP AAA Proxy, indicating DIAMETER_UNKNOWN_SESSION_ID.\nThe 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the Session Termination Request message from the PDN GW, the 3GPP AAA Proxy shall route the message to the 3GPP AAA Server.\nOn receipt of the Session Termination Answer message from the 3GPP AAA Server, the 3GPP AAA Proxy shall route the message to the PDN GW, and it shall release any local resources associated to the specified sessions only if the result code is set to DIAMETER_SUCCESS.\nThe S6b reference point allows the 3GPP AAA server to order a PDN GW to remove a PDN connection previously activated by the UE.\nThis procedure shall be initiated by the 3GPP AAA server. This indicates to the PDN GW to remove the corresponding PDN connection (identified by Session-ID AVP and User-Name AVP). This procedure is based on the reuse of NASREQ IETF RFC 4005 [4] ASR, ASA, STR and STA commands.\nThe 3GPP AAA Server shall include the Auth-Session-State AVP in the ASR command with a value of NO_STATE_MAINTAINED if it does not require a STR from the PDN GW. If it does require a STR from the PDN GW, the 3GPP AAA Server shall either omit the Auth-Session-State AVP from the ASR command or include the Auth-Session-State AVP in the ASR command with a value of STATE_MAINTAINED.\nTable 9.1.2.4.1/1: S6b Abort Session Request\n\nTable 9.1.2.4.1/2: S6b Abort Session Answer\n\nTable 9.1.2.4.1/3: S6b Session Termination Request\n\nTable 9.1.2.4.1/4: S6b Session Termination Answer\n\nUpon receipt of the Abort Session Request message from the 3GPP AAA Server or from the 3GPP AAA Proxy, the PDN GW shall check that there is an ongoing session with the received session-ID.\nIf an active session is found:\n-\tIn the PMIPv6 or GTPv2 or MIPv4 cases, the PDN GW shall release any resources associated with the identified diameter session, but it shall not terminate any associated PDN connection.\n-\tIn the DSMIPv6 case, the PDN GW shall initiate a termination procedure for the associated PDN connection, and shall release any resources associated with the identified diameter session.\nIf the termination procedure is successful for the identified session, an Abort Session Answer message shall be sent to the 3GPP AAA Server or 3GPP AAA Proxy, indicating DIAMETER_SUCCESS.\nIf the Session-Id included in the request does not correspond with any active session, or if an active session is found but it does not belong to the user identified by the User Name parameter, then an Abort Session Answer message shall be sent to the 3GPP AAA Server or 3GPP AAA Proxy, indicating DIAMETER_UNKNOWN_SESSION_ID.\nIf the termination procedure for the identified session cannot be completed successfully, an Abort Session Answer message shall be sent to the 3GPP AAA Server or 3GPP AAA Proxy, indicating DIAMETER_UNABLE_TO_COMPLY.\nIf the termination procedure was successful for the identified session and the STR is required by the 3GPP AAA Server, the PDN GW shall send an STR to the 3GPP AAA Server with the Termination-Cause set to DIAMETER_ADMINISTRATIVE.\nThe 3GPP AAA Server shall intiate a separate procedure for each active PDN connection of the user, even if the user has several PDN connections via the same PDN GW.\nUpon receipt of the Abort Session Answer message from the PDN GW or from the 3GPP AAA Proxy, the 3GPP AAA Server shall check the Result Code AVP, and in case of a DIAMETER_SUCCESS code, it shall release the context associated to the active session identified by the Session-Id parameter.\nIf the error code DIAMETER_UNABLE_TO_COMPLY is received in the Result Code AVP, the 3GPP AAA Server shall not release the context for the identified session.\nIf the error code DIAMETER_UNKNOWN_SESSION_ID is received in the Result Code AVP, the 3GPP AAA Server shall release the context for the identified session.\nOn receipt of the STR from PDN GW, the 3GPP AAA Server shall return an STA command with the Result-Code set to DIAMETER_SUCCESS.\nThe 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the Abort Session Request message from the 3GPP AAA Server, the 3GPP AAA Proxy shall route the message to the PDN GW.\nIf the 3GPP AAA Proxy requires an STR but the 3GPP AAA Server does not, the 3GPP AAA Proxy may override the value of the Auth-Session-State in the ASR and set it to STATE_MAINTAINED. In this case, the 3GPP AAA Proxy shall not forward the STR received from the PDN GW onto the 3GPP AAA Server and shall return an STA command to the PDN GW with the Result-Code set to DIAMETER_SUCCESS. The 3GPP AAA Proxy shall not override the value of the Auth-Session-State AVP under any other circumstances.\nOn receipt of the Abort Session Answer message from the PDN GW, the 3GPP AAA Proxy shall route the message to the 3GPP AAA Server, and it shall release any local resources associated to the specified session only if the result code is set to DIAMETER_SUCCESS.\nWhen the 3GPP AAA Proxy receives the STR from PDN GW, it shall route the request to the 3GPP AAA Server. On receipt of the STA message, the 3GPP AAA Proxy shall route the response to the PDN GW.\nThe S6b reference point allows the 3GPP AAA server to modify the authorization information previously provided to the PDN GW, i.e. during Service Authentication and Authorization when using DSMIPv6, or Service Authorization using PMIPv6 or GTPv2 or MIPv4, or the service authorization information provided during a previous Service Authorization update. This procedure is triggered by the modification of the non-3GPP profile of the UE or by activating or deactivating subscriber and equipment trace in the HSS or by the request of a P-CSCF restoration for WLAN. This procedure is also triggered by the authentication and authorization via STa or SWm, when the 3GPP AAA Server detects that an S6b session already exists for the UE, as specified in clause 5.1.2.1.2 and 7.1.2.1.2. In this case, the 3GPP AAA Server shall use this procedure to send the trust relationship to the PDN GW.\nThe Service Authorization Information Update procedure is performed in two steps:\n1.\tThe 3GPP AAA server issues an unsolicited re-authentication and/or re-authorization request towards the PDN GW. Upon receipt of this request, the PDN GW responds to the request and indicates the disposition of the request. If the re-authorization request is used for the purpose of the P-CSCF restoration for WLAN, only the P-CSCF Restoration Request bit shall be set in the RAR Flags. This procedure is based on the reuse of Diameter RAR and RAA commands as specified in IETF RFC 6733 [58]. The information element content for these messages is shown in tables 9.1.2.5.1/1 and 9.1.2.5.1/2.\n2.\tAfter receiving the re-authorization request, the PDN GW invokes the authorization procedure for the APN identified by the session ID included in the former re-authorization request message. The authorization procedure for PMIPv6 or GTPv2 is described in the clause 9.1.2.2. Tables 9.1.2.5.1/3 and 9.1.2.5.1/4 describe the message contents in case of DSMIPv6.\nTable 9.1.2.5.1/1: S6b Re-authorization request\n\nTable 9.1.2.5.1/2: S6b Re-authorization response\n\nTable 9.1.2.5.1/3: Authorization Request when using DSMIPv6\n\nTable 9.1.2.5.1/4: Authorization Answer when using DSMIPv6\n\nThe 3GPP AAA server shall make use of this procedure in two steps to indicate and update relevant service authorization information in the PDN GW.\nThe 3GPP AAA server shall send a re-authorization request for all authorization sessions that are active for the user except for the request of a P-CSCF restoration for WLAN which only applies to the session related to the IMS APN.\nEach PDN GW, upon reception of an unsolicited re-authentication and/or re-authorization request shall perform the following check and if there is an error detected, the PDN GW shall stop processing and return the corresponding error code.\nCheck the Re-Auth-Request-Type AVP:\n1.\tIf it indicates AUTHENTICATE_ONLY, Result-Code shall be set to DIAMETER_INVALID_AVP_VALUE.\n2.\tIf it indicates AUTHORIZE_ONLY, then, depending on the used IP mobility protocol:\n-\tIn case of PMIPv6 or GTPv2, the PDN GW shall perform an authorization procedure as described in clause 9.1.2.2. If the P-CSCF Restoration Request bit in the RAR Flags is set:\n-\tfor the case where the PDN GW triggers the extended P-CSCF restoration mechanism, the PDN GW may send the authorisation request with only mandatory AVPs.\n-\tfor the case where the PDN GW triggers the basic P-CSCF restoration mechanism, the PDN GW shall send a Session Termination Request to the 3GPP AAA Server.\n-\tIn case of DSMIPv6, the PDN GW shall perform an authorization procedure, sending an authorization request described in Tables 9.1.5.1/3 and 9.1.5.1/4. If the Trust-Relationship-Update flag is set in the RAR Flags present in the request, the PDN GW may send an authorization request with only mandatory AVPs.\n3.\tIf it indicates AUTHORIZE_AUTHENTICATE, Result-Code shall be set to DIAMETER_INVALID_AVP_VALUE.\nWhen receiving the authorization request, if the authorization procedure is triggered by the 3GPP AAA Server to send the trust relationship to the PDN GW, the 3GPP AAA Server shall send the trust relationship of the access network for the subscriber to the PDN GW with Result-Code DIAMETER_SUCCESS. If the received AA-Request is triggered by the P-CSCF Restoration Request bit set in the RAR Flags sent to the PDN GW, the 3GPP AAA Server may send an authorization answer to the PDN GW with Result-Code DIAMETER_SUCCESS with only the mandatory AVPs described in Table 9.1.2.2.1/2. Otherwise, the 3GPP AAA Server shall check, whether\n-\tthe subscriber still has non-3GPP subscription to access EPC network\n-\tthe non-3GPP APNs are enabled for the user, and\n-\tthe updated user profile contains the APN, for which the given authorization session was created.\nIf any of the checked conditions are not met, the 3GPP AAA Server shall set the Result-Code to DIAMETER_AUTHORIZATION_REJECTED. Otherwise, it shall respond with Result-Code DIAMETER_SUCCESS.\nAfter successful service authorization information update procedure, the PDN GW shall overwrite the stored user and APN data, for the subscriber identity indicated in the request, with the information received from the 3GPP AAA server. A session termination shall be initiated if the subscriber is no longer authorized to use the activated APN. If only trust relationship of the access network is received, the PDN GW shall keep all stored user and APN data for the subscriber identity as indicated in the request.\nIf the P-CSCF-Restoration-Request bit in the RAR Flags is set, the PDN GW shall keep all stored user data and APN data for the subscriber identity indicated in the request unless this data is present in the authorisation answer and proceed with the P-CSCF restoration for WLAN as specified in 3GPP TS 23.380 [52].\nFor PMIPv6 based S or S2b, if Trace-Info AVP including Trace-Data has been received in the authorization response, the PDN GW shall start a trace session for the user. If Trace-Info including Trace-Reference (directly under the Trace-Info) has been received in the authorization response, the PDN GW shall stop the ongoing trace session, identified by the Trace-Reference. For details, see 3GPP TS 32.422 [32].\nFor GTPv2 based S or S2b, the PDN GW shall ignore the Trace-Info AVP if received in the authorization response.\nNOTE:\tFor GTPv2 based S or S2b, trace is activated and deactivated via the STa and S2a interfaces or via the SWm and S2b interfaces.\nThe following authorization procedures take place upon a reception of a RRQ at the PDN GW from the FA.\nThe PDN GW shall update its identity to the 3GPP AAA Server and HSS. Static QoS profile information may also be downloaded at the same time.\nMIPv4 security parameters shall be exchanged between the PDN GW and the 3GPP AAA Server.\nThe procedures are based on the reuse of NASREQ IETF RFC 4005 [4] AAR and AAA commands.\nTable 9.1.2.6.1/1: Authorization request\n\nTable 9.1.2.6.1/2: Authorization answer\n\nUpon receipt of a RRQ message from the FA, the PDN GW shall initiate an authorization procedure, by sending an Authorization Request message to the 3GPP AAA Server or to the 3GPP AAA Proxy, with the Auth-Request-Type set to AUTHORIZE_ONLY, in order to update the PGW Address for the APN, as well as to download any UE specific APN profile information such as IP address allocation information, QoS Information, Session timeouts, Session Idle timeouts, MIPv4 security parameters etc.\nIf the APN was included in the RRQ message, the PDN GW shall include in the request the APN where the user shall be connected.\nThe PDN GW Identity shall only be included in the initial request to the 3GPP AAA Server; subsequent authorization messages (due to a handover to a different FA, for instance) shall not include it again.\nIf the PDN GW does not have a MN-HA shared key associated with the SPI received in the RRQ MN-HA-AE, the PDN GW shall include the SPI in the Authorization Request to the 3GPP AAA Server.\nAfter successful reception of the Authorization Request message, the PDN GW shall check that the Result-Code is set to DIAMETER_SUCCESS and, if so, it shall use the MN-HA key to verify the MN-HA AE of the RRQ received from the FA.\nIf the PDN-GW successfully verifies the MN-HA-AE it shall proceed to connect the user to the specified APN, and will send the RRP message to the FA.\nUpon receipt of the Authorization Request message from the PDN GW, the 3GPP AAA Server shall update the PDN GW information for the APN for the UE on the HSS. If the APN was not received from the PDN GW the 3GPP AAA Server shall assign the received PDN-GW identity to the default APN .\nThe 3GPP AAA Server must check that the user exists. If the user's data exists in the 3GPP AAA Server, it shall check, whether it also has an active access authorization session for the user.\n-\tIf not, the 3GPP AAA Server shall reject the authorization request, including the Result-Code DIAMETER_AUTHORIZATION_REJECTED.\n-\tIf the 3GPP AAA Server has an existing authorization session,\n-\tIf the APN requested by the PDN GW is included in the list of authorized APNs of the user, then the 3GPP AAA Server shall include the Service-Selection AVP in the authorization answer. If no APN was requested the Service-Selection AVP shall contain the default APN.\n-\tIf the MN-HA-SPI was included in the request and it matches the SPI belonging to a SA of the user then\tthe 3GPP AAA Server shall include the MIP-Session-Key of the SA in the authorization answer and set\tthe Result-Code to DIAMETER_SUCCESS.\n-\tIf the MN-HA-SPI was included in the request and there is no match with a SPI belonging to a SA of the user then the status code DIAMETER_AUTHORIZATION_REJECTED shall be returned to the PDN GW to indicate an unsuccessful authorization.\n-\tIf the APN requested by the PDN GW is not included in the list of authorized APNs, then the status code DIAMETER_AUTHORIZATION_REJECTED shall be returned to the PDN GW to indicate an unsuccessful authorization.\nIf the user's profile does not exist in the 3GPP AAA Server, it shall retrieve the Diameter identity of the 3GPP AAA Server currently serving the user from the HSS following the procedures for subscriber profile download as specified in clause 8.1.2.2.2. Depending on the HSS response,\n-\tIf the HSS indicates that the user is currently being served by a different 3GPP AAA Server, the 3GPP AAA Server shall respond to the PDG-GW with the Result-Code set to DIAMETER_REDIRECT_INDICATION and Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\n-\tIf the HSS returns DIAMETER_ERROR_USER_UNKNOWN, the 3GPP AAA Server shall return the same error to the PDN GW.\n-\tIf the HSS sends the user's profile to the 3GPP AAA Server, the authorization shall be rejected by setting the Result-Code to DIAMETER_AUTHORIZATION_REJECTED. The 3GPP AAA Server shall delete the downloaded user profile.\nNOTE:\tThe last outcome corresponds to the case that the user has no active access authorization procedure. This is considered as an error situation, e.g. the Trusted Non-3GPP access network may have sent RRQ without authorizing the user.\nThe 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the authorization answer, the 3GPP AAA Proxy\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authorization Successful).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 9.1.2.1/1: Authentication and Authorization Request",
                                    "table number": 77,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.1/2: Authentication and Authorization Answer",
                                    "table number": 78,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.2.1/1: Authorization request",
                                    "table number": 79,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.2.1/2: Authorization answer",
                                    "table number": 80,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.3.1/1: S6b Session Termination Request",
                                    "table number": 81,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.3.1/2: S6b Session Termination Answer",
                                    "table number": 82,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.4.1/1: S6b Abort Session Request",
                                    "table number": 83,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.4.1/2: S6b Abort Session Answer",
                                    "table number": 84,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.4.1/3: S6b Session Termination Request",
                                    "table number": 85,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.4.1/4: S6b Session Termination Answer",
                                    "table number": 86,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.5.1/1: S6b Re-authorization request",
                                    "table number": 87,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.5.1/2: S6b Re-authorization response",
                                    "table number": 88,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.5.1/3: Authorization Request when using DSMIPv6",
                                    "table number": 89,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.5.1/4: Authorization Answer when using DSMIPv6",
                                    "table number": 90,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.6.1/1: Authorization request",
                                    "table number": 91,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.1.2.6.1/2: Authorization answer",
                                    "table number": 92,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "9.2\tProtocol Specification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.2.1\tGeneral",
                            "text_content": "The S6b reference point shall be based on Diameter, as defined in IETF RFC 6733 [58], and contain the following additions and extensions:\n-\tIETF RFC 4005 [4], which defines a Diameter protocol application used for Authentication, Authorization and Accounting (AAA) services in the Network Access Server (NAS) environment.\n-\tIETF RFC 5779 [2], which defines a Diameter extensions and application for PMIPv6 MAG to AAA and LMA to AAA interfaces.\n-\tIETF RFC 5777 [9], which defines attribute value pairs to convey QoS information between Diameter peers.\nThe PDN GW to 3GPP AAA server or the PDN GW to 3GPP AAA proxy communication shall use the LMA to AAA interface functionality defined in IETF RFC 5779 [2] to update the 3GPP AAA server with PDN GW identity, indicate the protocol selected on S2a or S2b and optionally retrieve mobility related parameters and static QoS profiles, when PMIPv6 or GTPv2 based S or S2b is used.\nThe PDN-GW acts as a LMA when the UE attaches to the EPC using the S2a or S2b reference points and PMIPv6 is used. The PDN GW also follows the LMA to AAA interface functionality defined in IETF RFC 5779 [2] when UE attaches to the EPC using S or S2b reference point and GTPv2 is used. The PDN GW acts as HA when the UE attaches to the EPC using the S2a reference point and MIPv4 is used.\nIn the case the UE attached to the EPC using the S2c reference point, then the communication between the PDN GW and HA, IETF RFC 5778 [11] shall be used. The Application Id to be advertised over the S6b reference point corresponds to the DSMIPv6 \"Diameter Mobile IPv6 IKE (MIP6I)\" Application Id as defined in IETF RFC 5778 [11].\nIKEv2 EAP-based initiator authentication is used for authenticating and authorizing the UE and updating the PDN-GW identity. In this case, the PDN GW shall behave as described in 3GPP TS 33.402 [19].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.2.2\tCommands",
                            "text_content": "The Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit set in the Command Flags field, is sent from a PGW to a 3GPP AAA server. The Command Code value and the ABNF are re-used from the IETF RFC 5778 [11].\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n[ RAT-Type ]\n[ User-Name ]\n[ Service-Selection ]\n{ EAP-Payload }\n[ MIP6-Feature-Vector ]\n[ MIP6-Agent-Info ]\n[ QoS-Capability ]\n[ Visited-Network-Identifier ]\n[ MIP-Careof-Address ]\n[ AAA-Failure-Indication ]\n*[ Supported-Features ]\n[DER-S6b-Flags]\n[ UE-Local-IP-Address]\n...\n*[ AVP ]\n\nThe Diameter-EAP-Answer (DEA) command, indicated by the Command-Code field set to 268 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA server to a PGW. The Command Code value and the ABNF are re-used from the IETF RFC 5778 [11].\n<Diameter-EAP-Answer> ::= < Diameter Header: 268, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n[ EAP-Payload ]\n[ EAP-Master-Session-Key ]\n[ Mobile-Node-Identifier ]\n[ APN-Configuration ]\n[ MIP6-Agent-Info ]\n[ MIP6-Feature-Vector ]\n[ 3GPP-Charging-Characteristics ]\n*[ QoS-Resources ]\n*[ Redirect-Host ]\n[ Trace-Info ]\n*[ Supported-Features ]\n...\n*[ AVP ]\n\nThe AA-Request (AAR) command, indicated by the Command-Code field set to 265 and the \"R\" bit set in the Command Flags field, is sent from the PDN GW to the 3GPP AAA Server. The Command Code value and ABNF are re-used from the IETF RFC 4005 [4] AA-Request command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\nNOTE:\tThis command is used for the S6b Authorization Procedure for PMIPv6 or GTPv2, and also for the S6b Service Authorization Information Update procedure for PMIPv6, GTPv2 or DSMIPv6 following a previous RAR/RAA command exchange initiated by the 3GPP AAA Server.\n\n<AA-Request> ::=\t< Diameter Header: 265, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n[ User-Name ]\n[ MIP6-Agent-Info ]\n[ MIP6-Feature-Vector ]\n[ Visited-Network-Identifier ]\n[ QoS-Capability ]\n[ Service-Selection ]\n[ OC-Supported-Features ]\n[ Origination-Time-Stamp ]\n[ Maximum-Wait-Time ]\n*[ Supported-Features ]\n[ Emergency- Services ]\n...\n*[ AVP ]\nThe AA-Answer (AAA) command, indicated by the Command-Code field set to 265 and the \"R\" bit cleared in the Command Flags field, is sent from the 3GPP AAA Server to the PDN GW. The Command Code value and ABNF are re-used from the IETF RFC 4005 [4] AA-Answer command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\nNOTE:\tThis command is used for the S6b Authorization Procedure for PMIPv6 or GTPv2, and also for the S6b Service Authorization Information Update procedure for PMIPv6, GTPv2 or DSMIPv6 following a previous RAR/RAA command exchange initiated by the 3GPP AAA Server.\n<AA-Answer> ::=\t< Diameter Header: 265, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n...\n[ MIP6-Feature-Vector ]\n[ Session-Timeout ]\n[ APN-Configuration ]\n[ QoS-Resources ]\n[ AN-Trusted ]\n*[ Redirect-Host ]\n[ Trace-Info ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ Supported-Features ]\n...\n*[ AVP ]\nThe Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from a PDN GW to a 3GPP AAA server. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Request command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]\nThe Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA server to a PDN GW. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]\nThe Abort-Session-Request (ASR) command, indicated by the Command-Code field set to 274 and the \"R\" bit set in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a PDN GW. The ABNF is based on the one in IETF RFC 4005 [4].\n< Abort-Session-Request > ::=\t< Diameter Header: 274, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n[ User-Name ]\n[ Auth-Session-State ]\n…\n*[ AVP ]\nThe Abort-Session-Answer (ASA) command, indicated by the Command-Code field set to 274 and the \"R\" bit cleared in the Command Flags field, is sent from a PDN GW to a 3GPP AAA Server/Proxy. The ABNF is based on the one in IETF RFC 4005 [4].\n< Abort-Session-Answer > ::=\t< Diameter Header: 274, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]\nThe Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from an PDN GW to a 3GPP AAA Server/Proxy. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Request command.\n\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]\nThe Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to an PDN GW. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]\nThe AA-Request (AAR) command, indicated by the Command-Code field set to 265 and the \"R\" bit set in the Command Flags field, is sent from a PDN GW to a 3GPP AAA Server. The Command Code value and ABNF are re-used from the IETF RFC 4005 [4] AA-Request command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\n\n<AA-Request> ::=\t< Diameter Header: 265, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n[ User-Name ]\n[ MIP6-Agent-Info ]\n[ MIP6-Feature-Vector ]\n[ Visited-Network-Identifier ]\n[ QoS-Capability ]\n[ Service-Selection ]\n*[ Supported-Features ]\n[MIP-MN-HA-SPI]\n[ OC-Supported-Features ]\n...\n*[ AVP ]\nThe AA-Answer (AAA) command, indicated by the Command-Code field set to 265 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server to a PDN GW. The Command Code value and ABNF are re-used from the IETF RFC 4005 [4] AA-Answer command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\n<AA-Answer> ::=\t< Diameter Header: 265, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n...\n[ MIP6-Feature-Vector ]\n[ Session-Timeout ]\n[ APN-Configuration ]\n[ QoS-Resources ]\n*[ Redirect-Host ]\n*[ Supported-Features ]\n[MIP-Session-Key]\n...\n*[ AVP ]\n\nThe Diameter Re-Auth-Request (RAR) command shall be indicated by the Command-Code field set to 258 and the \"R\" bit set in the Command Flags field and is sent from a 3GPP AAA Server or 3GPP AAA Proxy to a PDN-GW. The ABNF for the RAR command shall be as follows:\n\n< Re-Auth-Request >  ::=\t< Diameter Header: 258, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n{ Re-Auth-Request-Type }\n[ User-Name ]\n[RAR-Flags ]\n...\n*[ AVP ]\nThe Diameter Re-Auth-Answer (ASA) command shall be indicated by the Command-Code field set to 258 and the \"R\" bit cleared in the Command Flags field and is sent from a PDN-GW to a 3GPP AAA Server or 3GPP AAA Proxy. The ABNF for the RAA commands shall be as follows:\n\n< Re-Auth-Answer >  ::=\t< Diameter Header: 258, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n...\n*[ AVP ]\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.2.3\tInformation Elements",
                            "text_content": "The following clauses describes the Diameter AVPs defined for the S6b interface protocol in the different modes of operation (DSMIPv6, PMIPv6/GTPv2, MIPv4…).\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.\nThe following table describes the Diameter AVPs defined for the S6b interface protocol in DSMIPv6 mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nTable 9.2.3.1.1/1: Diameter S6b AVPs for DSMIPv6\n\nThe Visited-Network-Identifier AVP contains an identifier that helps the home network to identify the visited network (e.g. the visited network domain name). The Vendor-Id shall be set to 10415 (3GPP).\nThe AVP shall be encoded as:\nmnc<MNC>.mcc<MCC>.3gppnetwork.org\nIf MNC consists of only 2 digits, a leading digit \"0\" shall be added to the MNC value (e.g., if MNC=15 and MCC=234, the value of Visited-Network-Identifier shall be \"mnc015.mcc234.3gppnetwork.org\").\nThe RAR-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 9.2.3.1.5/1:\nTable 9.2.3.1.5/1: RAR-Flags\n\nThe following table describes the Diameter AVPs defined for the S6b interface protocol in PMIPv6 or GTPv2 mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nTable 9.2.3.2.1/1: Diameter S6b AVPs for PMIPv6 or GTPv2\n\nThe MIP6-Agent-Info AVP contains the PDN GW identity or (for the chained S2 - PMIP based S8 case) the Serving GW address information. This AVP is defined in IETF RFC 5447 [6]. The identity of PDN GW is either an IP address transported in MIP-Home-Agent-Address or an FQDN transported in MIP-Home-Agent-Host. The PDN GW may use its IP address if a single IP address can be used for all Access Networks and protocols towards the PDN GW. In all other cases the PDN GW shall use its FQDN. MAG/AAA/HSS shall use FQDN if known. The grouped AVP has the following grammar:\nMIP6-Agent-Info ::=\t< AVP Header: 486 >\n*2[ MIP-Home-Agent-Address ]\n[ MIP-Home-Agent-Host ]\n[ MIP6-Home-Link-Prefix ]\n*[ AVP ]\nNOTE:\tThe AVP MIP6-Home-Link-Prefix is not used in S6b, but it is included here to reflect the complete IETF definition of the grouped AVP.\nThe MIP6-Feature-Vector AVP contains a 64 bit flags field of supported mobility capabilities of the NAS. This AVP is defined in IETF RFC 5447 [6]. The NAS may include this AVP in a request message to indicate the mobility capabilities of the NAS to the 3GPP AAA server. Similarly, the Diameter server may include this AVP in an answer message to inform the NAS about which of the NAS indicated capabilities are supported or authorized by the 3GPP AAA Server.\nFollowing capabilities are supported on S6b reference point in PMIPv6 or GTPv2 mode:\n-\tPMIP6_SUPPORTED\n-\tIP4_HOA_SUPPORTED\n-\tGTPv2_SUPPORTED\nThe QoS-Capability AVP contains a list of supported Quality of Service profile templates (and therefore the support of the respective parameter AVPs). This AVP is defined in IETF RFC 5777 [9].\nThe QoS-Resources AVP includes a description of the Quality of Service resources for policing traffic flows. This AVP is defined in IETF RFC 5777 [9].\nThe Origination-Time-Stamp is of type Unsigned64. It indicates the UTC time when the originating entity initiated the request. It shall contain the number of milliseconds since 00:00:00 on 1 January 1900 UTC.\nNOTE:\tThis AVP contains the same numeric value, in milliseconds, as received over the GTPv2 protocol from the originating entity (see 3GPP TS 29.274 [38], clause 8.119).\nThe Maximum-Wait-Time is of type Unsigned32. It indicates the number of milliseconds since the Origination-Time-Stamp during which the originator of a request waits for a response. See 3GPP TS 29.274 [38].\nTable 9.2.3.3/1: S6b re-used Diameter AVPs\n\nThe syntax of this AVP is defined in 3GPP TS 29.229 [24]. For this release, the Feature-List-ID AVP value shall be set to 1 for the S6b application.\nThe syntax of this AVP is defined in 3GPP TS 29.229 [24]. A null value indicates that there is no feature used by the S6b application. The meaning of the bits shall be as defined in table 9.2.3.5/1.\nTable 9.2.3.5/1: Features of Feature-List-ID 1 used in S6b\n\nFeatures that are not indicated in the Supported-Features AVPs within a given application message shall not be used to construct that message.\nThe following table describes the Diameter AVPs defined for the S6b interface protocol in MIPv4 mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nTable 9.2.3.6.1/1: Diameter S6b AVPs for MIPv4 FACoA\n\nThe MIP6-Agent-Info AVP contains the PDN GW identity. This AVP is defined in IETF RFC 5447 [6]. The identity of PDN GW is either an IP address transported in MIP-Home-Agent-Address or an FQDN transported in MIP-Home-Agent-Host. The PDN GW may use its IP address if a single IP address can be used for all Access Networks and protocols towards the PDN GW. In all other cases the PDN GW shall use its FQDN. The FA/3GPP AAA Server/HSS shall use FQDN if known. The grouped AVP has the following grammar:\nMIP6-Agent-Info ::=\t< AVP Header: 486 >\n*2[ MIP-Home-Agent-Address ]\n[ MIP-Home-Agent-Host ]\n[ MIP6-Home-Link-Prefix ]\n*[ AVP ]\nNOTE:\tThe AVP MIP6-Home-Link-Prefix is not used in S6b, but it is included here to reflect the complete IETF definition of the grouped AVP.\nThe MIP6-Feature-Vector AVP contains a 64 bit flags field of supported mobility capabilities of the NAS. This AVP is defined in IETF RFC 5447 [6]. The NAS may include this AVP in a request message to indicate the mobility capabilities of the NAS to the 3GPP AAA Server. Similarly, the Diameter server may include this AVP in an answer message to inform the NAS about which of the NAS indicated capabilities are supported or authorized by the 3GPP AAA Server.\nFollowing capabilities are supported on S6b reference point in MIPv4 FACoA mode:\n-\tMIP4_SUPPORTED\nThe QoS-Capability AVP contains a list of supported Quality of Service profile templates (and therefore the support of the respective parameter AVPs). This AVP is defined in IETF RFC 5777 [9].\nThe QoS-Resources AVP includes a description of the Quality of Service resources for policing traffic flows. This AVP is defined in IETF RFC 5777 [9].\nThe MIP-MN-HA-SPI AVP contains the index of the security association between the Mobile Node and the HA. This AVP is defined in IETF RFC 5778 [11].\nThe MIP-Session-Key AVP contains the MN-HA shared key. This AVP is defined in IETF RFC 4004 [18].\nThe DER-S6b-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be asdefined in table 9.2.3.7/1:\nTable 9.2.3.7/1: DER-S6b-Flags\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 9.2.3.1.1/1: Diameter S6b AVPs for DSMIPv6",
                                    "table number": 93,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.3.1.5/1: RAR-Flags",
                                    "table number": 94,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.3.2.1/1: Diameter S6b AVPs for PMIPv6 or GTPv2",
                                    "table number": 95,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.3.3/1: S6b re-used Diameter AVPs",
                                    "table number": 96,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.3.5/1: Features of Feature-List-ID 1 used in S6b",
                                    "table number": 97,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.3.6.1/1: Diameter S6b AVPs for MIPv4 FACoA",
                                    "table number": 98,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 9.2.3.7/1: DER-S6b-Flags",
                                    "table number": 99,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.2.4\tSession Handling",
                            "text_content": "The Diameter protocol between the PDN-GW and the 3GPP AAA Server or the 3GPP AAA Proxy shall always keep session state, and use the same Session-Id parameter for the lifetime of each Diameter session.\nA Diameter session shall identify a PDN Connection for a given user and an APN, while the PDN Connection is kept alive in the non-3GPP access. When the PDN Connection is either disconnected on the non-3GPP access, or handed over to the 3GPP access, the diameter session shall be terminated. In order to indicate that the session state is to be maintained, the Diameter client and server shall not include the Auth-Session-State AVP, either in the request or in the response messages (see IETF RFC 6733 [58]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "10\tResult-Code and Experimental-Result Values",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "10.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines result code values that shall be supported by all Diameter implementations that conform to this specification.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.2\tSuccess",
                    "description": "",
                    "summary": "",
                    "text_content": "Result codes that fall within the Success category shall be used to inform a peer that a request has been successfully completed. The Result-Code AVP values defined in Diameter base protocol (IETF RFC 6733 [58]) shall be applied.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.3\tPermanent Failures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.3.1\tGeneral",
                            "text_content": "Errors that fall within the Permanent Failures category shall be used to inform the peer that the request has failed, and should not be attempted again. The Result-Code AVP values defined in Diameter base protocol (IETF RFC 6733 [58]) shall be applied. When one of the result codes defined here is included in a response, it shall be inside an Experimental-Result AVP and the Result-Code AVP shall be absent.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.2\tDIAMETER_ERROR_USER_UNKNOWN (5001)",
                            "text_content": "This result code shall be sent by the HSS to indicate that the user identified by the IMSI is unknown (see 3GPP TS 29.229 [24]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.3\tDIAMETER_ERROR_IDENTITY_NOT_REGISTERED (5003)",
                            "text_content": "This result code shall be sent by the HSS to indicate that there is currently no 3GPP AAA Server registered for the user (see 3GPP TS 29.229 [24]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.4\tDIAMETER_ERROR_ROAMING_NOT_ALLOWED (5004)",
                            "text_content": "This result code shall be sent by the HSS to indicate that the subscriber is not allowed to roam in a certain non-3GPP V-PLMN (see 3GPP TS 29.229 [24]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.5\tDIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED (5005)",
                            "text_content": "This result code shall be sent by the HSS to indicate that the node identity trying to be registered by a 3GPP AAA Server is already registered for a specific user (see 3GPP TS 29.229 [24]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.6\tDIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION (5450)",
                            "text_content": "This result code shall be sent by the HSS to indicate that no non-3GPP subscription is associated with the IMSI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.7\tDIAMETER_ERROR_USER_NO_APN_SUBSCRIPTION (5451)",
                            "text_content": "This result code shall be sent by the 3GPP AAA Server to indicate that the requested APN is not included in the user's profile, and therefore is not authorized for that user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.8\tDIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED (5452)",
                            "text_content": "This result code shall be sent by the HSS to indicate the RAT type the UE is using is not allowed for the IMSI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.9\tDIAMETER_ERROR_LATE_OVERLAPPING_REQUEST (5453)",
                            "text_content": "This result code shall be sent by the 3GPP AAA Server to indicate that the incoming request collides with an existing session which has a more recent time stamp than the time stamp of the new request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.10\tDIAMETER_ERROR_TIMED_OUT_REQUEST (5454)",
                            "text_content": "This result code shall be sent by the 3GPP AAA Server to indicate that the incoming request is known to have already timed out at the originating entity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.11\tDIAMETER_ERROR_ILLEGAL_EQUIPMENT (5554)",
                            "text_content": "This result code shall be sent by the 3GPP AAA Server or 3GPP AAA Proxy to indicate that the Mobile Equipment used is not acceptable to the network (e.g. the Mobile Equipment is on the prohibited list of the EIR).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.12\tDIAMETER_ERROR_TRUSTED_NON_3GPP_ACCESS_NOT_ALLOWED (5455)",
                            "text_content": "This result code shall be sent by the HSS to indicate that trusted non-3GPP access is not authorized for the user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.13\tDIAMETER_ERROR_UNTRUSTED_NON_3GPP_ACCESS_NOT_ALLOWED (5456)",
                            "text_content": "This result code shall be sent by the HSS to indicate that untrusted non-3GPP access is not authorized for the user.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.4\tTransient Failures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.4.1\tGeneral",
                            "text_content": "Result codes that fall within the transient failures category shall be used to inform a peer that the request could not be satisfied at the time it was received, but may be able to satisfy the request in the future. The Result-Code AVP values defined in Diameter base protocol ( IETF RFC 6733 [58]) shall be applied. When one of the result codes defined here is included in a response, it shall be inside an Experimental-Result AVP and the Result-Code AVP shall be absent.\nThere are no Transient Error codes defined in this specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "11\t3GPP AAA Server/Proxy – EIR",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "11.1\tFunctionality",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.1.1\tGeneral",
                            "text_content": "The definition of the reference point between the 3GPP AAA Server or 3GPP AAA Proxy and the EIR and its functionality is specified in clauses 7.2 and 16.2 in 3GPP TS 23.402 [3].\nThe 3GPP AAA Server/Proxy – EIR reference point is used to check the Mobile Equipment's identity status (e.g. to check that it has not been stolen, or, to verify that it does not have faults).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.2\tProcedures Description",
                            "text_content": "The Mobile Equipment Identity Check Procedure shall be used between the 3GPP AAA Server and the EIR if the TWAN or ePDG is in the HPLMN, or between the 3GPP AAA Proxy and the EIR if the TWAN or ePDG is in the VPLMN, to check the Mobile Equipment's identity status (e.g. to check that it has not been stolen, or, to verify that it does not have faults).\nThe Diameter Identity of the EIR is locally configured in the 3GPP AAA Server and 3GPP AAA Proxy.\nThis procedure is mapped to the commands ME-Identity-Check-Request/Answer (ECR/ECA) in the Diameter application specified in clause 7 of 3GPP TS 29.272 [29].\nTable 11.1.2.1.1/1 specifies the involved information elements for the request.\nTable 11.1.2.1.1/2 specifies the involved information elements for the answer.\nTable 11.1.2.1.1/1: ME Identity Check Request\n\nTable 11.1.2.1.1/2: ME Identity Check Answer\n\nThe 3GPP AAA Server shall make use of this procedure to check the ME identity, if the 3GPP AAA Server is configured to check the IMEI with the EIR and if the ePDG or TWAN is in the HPLMN.\nTerminal-Information, when sent by the 3GPP AAA Server to the EIR, shall contain the IMEI AVP, and it may contain also the Software-Version AVP.\nIMSI may be sent together with Terminal Information to the EIR for operator-determined purposes.\nWhen receiving the ME Identity Check answer from the EIR, the 3GPP AAA Server shall check the result code and the equipment status. Dependent upon the result, the 3GPP AAA Server shall determine whether to continue or stop the authentication and authorization procedure, see clause 5.1.2.1 and 7.1.2.1.\nThe 3GPP AAA Proxy shall make use of this procedure to check the ME identity, if the 3GPP AAA Proxy is configured to check the IMEI with the EIR and if the ePDG or TWAN is in the VPLMN.\nTerminal-Information, when sent by the 3GPP AAA Proxy to the EIR, shall contain the IMEI AVP, and it may contain also the Software-Version AVP.\nIMSI may be sent together with Terminal Information to the EIR for operator-determined purposes.\nWhen receiving the ME Identity Check answer from the EIR, the 3GPP AAA Proxy shall check the result code and the equipment status. Dependent upon the result, the 3GPP AAA Server shall determine whether to continue or stop the authentication and authorization procedure, see clause 5.1.2.1 and 7.1.2.1.\nSee clause 6.2.1.3 of 3GPP TS 29.272 [29].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.1.2.1.1/1: ME Identity Check Request",
                                    "table number": 100,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 11.1.2.1.1/2: ME Identity Check Answer",
                                    "table number": 101,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "11.2\tProtocol Specification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.2.1\tGeneral",
                            "text_content": "The 3GPP AAA Server/Proxy – EIR reference point shall be based on Diameter, as defined in IETF RFC 6733 [58]. It shall be defined as an IETF vendor specific Diameter application, where the vendor is 3GPP. The vendor identifier assigned by IANA to 3GPP (http://www.iana.org/assignments/enterprise-numbers) is 10415.\nThe Diameter application used over the 3GPP AAA Server/Proxy – EIR reference point is the S13/S13' Diameter application, and the application identifier is 16777252 (allocated by IANA).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.2\tCommands",
                            "text_content": "See clause 7.2.19 of 3GPP TS 29.272 [29].\nSee clause 7.2.20 of 3GPP TS 29.272 [29].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.3\tInformation Elements",
                            "text_content": "The following table specifies the Diameter AVPs re-used by the 3GPP AAA Server/Proxy - EIR interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use for the 3GPP AAA Server/Proxy – EIR interface.\nAny other AVPs from existing Diameter Applications, except for the AVPs from Diameter Base Protocol, do not need to be supported. The AVPs from Diameter base protocol specified in IETF RFC 6733 [58] are not included in table 11.2.3.1/1, but they may be re-used for the 3GPP AAA Server/Proxy - EIR protocol.\nTable 11.2.3.1/1: Diameter AVPs re-used for the 3GPP AAA Server/Proxy – EIR interface\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 11.2.3.1/1: Diameter AVPs re-used for the 3GPP AAA Server/Proxy – EIR interface",
                                    "table number": 102,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "11.2.4\tSession Handling",
                            "text_content": "The Diameter sessions between the 3GPP AAA Server and the EIR, and between the 3GPP AAA Proxy and the EIR, shall be handled as specified for the Diameter sessions between the MME and the EIR in clause 7.1.4 of 3GPP TS 29.272 [29].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "A.1\tGeneral",
            "description": "This clause provides example call flows for the Trusted WLAN authentication and authorization procedure.\nCall flows for TSCM or SCM for Non-seamless WLAN Offload are not represented as they can be easily derived from the normative part of this specification.\nThis Annex is informative and the normative descriptions in this specification and in 3GPP TS 33.402 [19] prevail over the descriptions in this Annex if there is any difference.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.2\tCall Flow for SCM and EPC-routed access",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.2.1\tSuccessful call flow",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure Annex A.2-1 describes a successful call flow for SCM and EPC-routed access, i.e. with S2a connectivity being granted to the UE.\nThe figure depicts the TWAN authentication and authorization procedure for SCM and EPC routed access, illustrating the successful case. It shows the authentication and authorization process for SCM and EPC, with successful authentication and authorization for SCM and EPC routed access.\nFigure Annex A.2-1: TWAN Authentication and Authorization Procedure for SCM and EPC routed access – successful case\n1.\tA connection is established between the UE and the TWAN, using a specific procedure based on IEEE 802.11 [40].\n2.\tThe TWAN sends an EAP Request/Identity to the UE.\n3.\tThe UE sends an EAP Response/Identity message to the TWAN.\n4.\tThe TWAN forwards the EAP payload received from the UE to the 3GPP AAA Server and also indicates the supported TWAN connection modes in the DER message. The routing path may include one or several 3GPP AAA proxies for roaming case.\n5.\tThe 3GPP AAA Server retrieves authentication vectors for the UE from the HSS.\n6.\tThe 3GPP AAA Server sends an EAP Request/AKA'-Challenge in which it also indicates to the UE the TWAN connection modes supported by the network (e.g. TSCM, SCM and MCM) and in which it also requests the UE to provide its Mobile Equipment Identity. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n7.\tThe TWAN forwards the EAP payload to the UE.\n8.\tThe UE sends the EAP Response/AKA'-Challenge in which it also indicates the requested connection mode. If the UE requests SCM and an EPC-routed access, the UE also indicates the requested APN, PDN type, Initial Attach/Handover indication and/or PCO. The user's Mobile Equipment Identity is also included, if available and if requested by the 3GPP AAA Server.\n9.\tThe TWAN forwards the EAP payload to 3GPP AAA Server.\n10.\tIf the 3GPP AAA Server successfully authentifies the UE, the 3GPP AAA Server downloads the user's subscription information from the HSS.\n11.\tIf the 3GPP AAA Server authorizes the SCM for EPC access for the UE, the 3GPP AAA Server includes the UE requested APN, PDN type, Initial Attach/Handover indication and/or PCO in the DEA message with the Result-Code AVP set to DIAMETER_MULTI_ROUND_AUTH. The 3GPP AAA Server also sets the TWAN-S2a-Connectivity Indicator in the DEA-Flags AVP to request the TWAN to proceed with the establishment of the S2a connectivity. The 3GPP AAA Server also includes the user's Mobile Equipment Identity, if available.\n12.\tThe TWAN sends a Create Session Request/PBU message to the PDN GW to initiate the S2a tunnel establishment.\n13.\tThe PDN GW informs the 3GPP AAA Server/HSS of its PDN GW identity and the APN corresponding to the UE's PDN Connection.\n14.\tThe PDN GW returns a Create Session Response/PBA message to the TWAN, including the IP address(es) allocated for the UE.\n15.\tThe TWAN includes the provided Connectivity Parameters received from the PDN GW and sets the TWAN-S2a-Connectivity Indicator in the DER-Flags AVP in the DER message to the 3GPP AAA Server. The 3GPP AAA Server ignores the EAP payload included in the DER message.\n16.\tThe 3GPP AAA Server includes the PDN connectivity parameters in the AKA'-Notification and sends the DEA message to the TWAN. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n17.\tThe TWAN forwards the EAP payload to the UE.\n18-19. The UE responds with an EAP-RSP/AKA'-Notification message that the TWAN forwardsto the 3GPP AAA Server.\n20-21. The 3GPP AAA Server sends an EAP Success message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_SUCESS. The subscription information need not to be included in the DEA message (if not changed).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.2.2\tUnsuccessful call flow",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure Annex A.2-2 describes an unsuccessful call flow for SCM and EPC-routed access, where S2a connectivity can not been granted to the UE due to an overload condition in the network for the APN requested by the UE.\nThe figure depicts the TWAN authentication and authorization procedure for SCM and EPC routed access, with UE requests rejected due to a Session Management back-off timer.\nFigure Annex A.2-2: TWAN Authentication and Authorization Procedure for SCM and EPC routed access – UE request rejected with a Session Management back-off timer.\n1. to 11.\tSame as Figure Annex A.2-1.\n12.\tThe TWAN sends a Create Session Request/PBU message to the PDN GW to initiate the S2a tunnel establishment, or skips this step and goes directly to step 14 if it is already aware of an overload condition for the requested APN and the UE request cannot be served by another PGW and if it decides to reject this UE request.\n13.\tThe PDN GW rejects the UE request, possibly including overload control information.\n14.\tThe TWAN rejects the request due to an overload condition for the APN requested by the UE. The TWAN returns the cause \"insufficient resources\" and provides a Session Management back-off timer to be sent to the UE. The TWAN also sets the TWAN-S2a-Connectivity Indicator in the DER-Flags AVP in the DER message to the 3GPP AAA Server. The 3GPP AAA Server ignores the EAP payload included in the DER message.\n15.\tThe 3GPP AAA Server forwards the Session Management back-off timer received from the TWAN encapsulated in the AKA'-Notification and sends the DEA message to the TWAN. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n16.\tThe TWAN forwards the EAP payload to the UE.\n17-18. The UE responds with an EAP-RSP/AKA'-Notification message that the TWAN forwards to the 3GPP AAA Server.\n19-20. The 3GPP AAA Server sends an EAP Failure message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_UNABLE_TO_COMPLY.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.2.3\tCall flow with IMEI check in VPLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure Annex A.2-3 describes a roaming call flow for SCM and EPC-routed access, with IMEI check performed in the VPLMN.\nThe figure depicts the TWAN authentication and authorization procedure for SCM and EPC routed access, with IMEI checks performed in the VPLMN. It illustrates the steps involved in verifying the identity of the user and ensuring secure communication.\nFigure Annex A.2-3: TWAN Authentication and Authorization Procedure for SCM and EPC routed access, with IMEI check performed in the VPLMN\n\n1. to 3. Same as Figure A.2-1.\n4.\tIf IMEI check is required by operator policy, the 3GPP AAA Proxy sets the IMEI-Check-Required-In-VPLMN bit in the DER-Flags AVP.\n5. to 9. Same as Figure A.2-1.\n9A. The 3GPP AAA Server requests the VPLMN to perform the IMEI check by setting the IMEI-Check-Request-In-VPLMN bit in the DEA-Flags AVP and including the Terminal-Information AVP in the DEA message.\n9B. The TWAN returns the IMEI-Check-Request-In-VPLMN flag in the DER-Flags AVP and the Terminal-Information AVP to the 3GPP AAA Proxy.\n9C. The 3GPP AAA Proxy performs the IMEI check in the VPLMN and forwards the DER to the 3GPP AAA Server, replacing the IMEI-Check-Request-In-VPLMN bit in the DER-Flags AVP by the IMEI-Check-In-VPLMN-Result AVP.\n10. to 21. Same as Figure A.2-1 if the IMEI check in VPLMN was successful.\n\nOtherwise the 3GPP AAA Server sends an EAP Failure message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.3\tCall Flow for MCM for EPC-routed access and/or NSWO",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.3.1\tSuccessful call flow",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure Annex A.3-1 describes a successful call flow for MCM, for EPC-routed access and/or Non-seamless WLAN offload.\nThe figure depicts the TWAN Authentication and Authorization Procedure for MC M, which is a successful case. It illustrates the authentication and authorization process for a user's identity, ensuring secure communication.\nFigure Annex A.3-1: TWAN Authentication and Authorization Procedure for MCM – successful case\n1.\tA connection is established between the UE and the TWAN, using a specific procedure based on IEEE 802.11 [40].\n2.\tThe TWAN sends an EAP Request/Identity to the UE.\n3.\tThe UE sends an EAP Response/Identity message to the TWAN.\n4.\tThe TWAN forwards the EAP payload received from the UE to the 3GPP AAA Server and also indicates the supported TWAN connection modes in the DER message. For MCM, the TWAN also provides the TWAG's control plane IPv4 and/or IPv6 addresses to be used by the UE for WLCP if the MCM is selected. The routing path may include one or several 3GPP AAA proxies for roaming case.\n5.\tThe 3GPP AAA Server retrieves authentication vectors for the UE from the HSS.\n6.\tThe 3GPP AAA Server sends an EAP Request/AKA'-Challenge in which it also indicates to the UE the TWAN connection modes supported by the network (e.g. TSCM, SCM and MCM) and, for MCM, the WLCP transport(s) supported by the TWAN (i.e. IPv4 and/or IPv6), and in which it also requests the UE to provide its Mobile Equipment Identity. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n7.\tThe TWAN forwards the EAP payload to the UE.\n8.\tThe UE sends the EAP Response/AKA'-Challenge in which it also indicates the requested connection mode. In this example, the UE requests the MCM. The user's Mobile Equipment Identity is also included, if available and if requested by the 3GPP AAA Server.\n9.\tThe TWAN forwards the EAP payload to the 3GPP AAA Server.\n10.\tIf the 3GPP AAA Server successfully authentifies the UE, the 3GPP AAA Server downloads the user's subscription information from the HSS.\n11.\tThe 3GPP AAA Server includes the information required for the MCM in the AKA'-Notification as specified in 3GPP TS 24.302[26] (e.g. NSWO authorization, TWAG control plane address) and sends the DEA message to the TWAN. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n12.\tThe TWAN forwards the EAP payload to the UE.\n13-14. The UE responds with an EAP-RSP/AKA'-Notification message that the TWAN forwardsto the 3GPP AAA Server.\n15-16. The 3GPP AAA Server sends an EAP Success message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_SUCCESS. The DEA message also indicates to the TWAN the selected connected mode (MCM), the user's subscription information, whether the user is authorized for EPC and/or non-seamless WLAN offload, the WLCP key for WLCP signalling protection, and the user's Mobile Equipment Identity if it is available.\n\nDependent on the authorizations received from the 3GPP AAA server, the UE may subsequently initiate the establishement of PDN connections to access the EPC and/or proceeed with non-seamless WLAN offload.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.3.2\tCall flow with IMEI check in VPLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure Annex A.3-x describes a roaming call flow for MCM, for EPC-routed access and/or Non-seamless WLAN offload, with IMEI check performed in the VPLMN.\nThe figure depicts the TWAN authentication and authorization procedure for MC M, with an IMEI check in the VPLMN. It illustrates the authentication and authorization process, including the use of IMEI checks to ensure the authenticity of the device.\nFigure Annex A.3-x: TWAN Authentication and Authorization Procedure for MCM, with an IMEI check in the VPLMN\n1. to 3. Same as Figure A.3-1.\n4.\tIf IMEI check is required by operator policy, the 3GPP AAA Proxy sets the IMEI-Check-Required-In-VPLMN bit in the DER-Flags AVP.\n5. to 9. Same as Figure A.3-1.\n9A. The 3GPP AAA Server requests the VPLMN to perform the IMEI check by setting the IMEI-Check-Request-In-VPLMN bit in the DEA-Flags AVP and including the Terminal-Information AVP in the DEA message.\n9B. The TWAN returns the IMEI-Check-Request-In-VPLMN flag in the DER-Flags AVP and the Terminal-Information AVP to the 3GPP AAA Proxy.\n9C. The 3GPP AAA Proxy performs the IMEI check in the VPLMN and forwards the DER to the 3GPP AAA Server, replacing the IMEI-Check-Request-In-VPLMN bit in the DER-Flags AVP by the IMEI-Check-In-VPLMN-Result AVP.\n10. to 16. Same as Figure A.3-1 if the IMEI check in VPLMN was successful.\n\nOtherwise the 3GPP AAA Server sends an EAP Failure message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.4\tCall Flow for TSCM and EPC-routed access",
            "description": "Figure Annex A.4-1 describes a successful call flow for TSCM for EPC-routed access, i.e with S2a connectivity being granted to the UE.\nThe figure depicts the TWAN Authentication and Authorization Procedure for TSC M, which is a successful case. It illustrates the authentication and authorization process for TSC M, a wireless network technology. The figure shows the steps involved in the authentication and authorization process, including the use of TSC M, the authentication method, and the authorization process. The figure is a visual representation of the technical details and processes involved in the authentication and authorization of TSC M.\nFigure Annex A.4-1: TWAN Authentication and Authorization Procedure for TSCM – successful case\n1.\tA connection is established between the UE and the TWAN, using a specific procedure based on IEEE 802.11 [40].\n2.\tThe TWAN sends an EAP Request/Identity to the UE.\n3.\tThe UE sends an EAP Response/Identity message to the TWAN.\n4.\tThe TWAN forwards the EAP payload received from the UE to the 3GPP AAA Server and also indicates the supported TWAN connection modes in the DER message. The routing path may include one or several 3GPP AAA proxies for roaming case.\n5.\tThe 3GPP AAA Server retrieves authentication vectors for the UE from the HSS.\n6.\tThe 3GPP AAA Server sends an EAP Request/AKA'-Challenge in which it also indicates to the UE the TWAN connection modes supported by the network (e.g. TSCM, SCM and MCM). The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n7.\tThe TWAN forwards the EAP payload to the UE.\n8.\tThe UE sends the EAP Response/AKA'-Challenge. In this example, the UE does not signal any requested connection mode in that message, which indicates a request for TSCM.\n9.\tThe TWAN forwards the EAP payload to the 3GPP AAA Server.\n10.\tIf the 3GPP AAA Server successfully authentifies the UE, the 3GPP AAA Server downloads the user's subscription information from the HSS.\n11. The 3GPP AAA Server sends an EAP Success message that the TWAN forwards to the UE in step 12 or 16. The Result-Code AVP in the DEA message is set to DIAMETER_SUCCESS. The DEA message also contains the user's subscription information, whether the user is authorized for EPC and/or non-seamless WLAN offload. The 3GPP AAA Server does not signal any selected TWAN connection mode in the DEA message, which indicates to the TWAN that TSCM is selected.\n12.\tThe TWAN forwards the EAP Success message to the UE, when using layer 3 attach trigger.\n13.\tThe TWAN sends a Create Session Request/PBU message to the PDN GW to initiate the S2a tunnel establishment (assuming EPC access has been authorized).\n14.\tThe PDN GW informs the 3GPP AAA Server/HSS of its PDN GW identity and the APN corresponding to the UE's PDN Connection.\n15.\tThe PDN GW returns a Create Session Response/PBA message to the TWAN, including the IP address(es) allocated for the UE.\n16.\tThe TWAN forwards the EAP Success message to the UE, when using layer 2 attach trigger.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.1\tGeneral",
            "description": "IETF RFC 7683 [47] specifies a Diameter overload control mechanism which includes the definition and the transfer of related AVPs between Diameter nodes.\nDepending on regional/national requirements and network operator policy, priority traffic (e.g., MPS) shall be the last to be throttled and shall be exempted from throttling due to Diameter overload control up to the point where requested traffic reduction cannot be achieved without throttling the priority traffic.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.2\tSWx interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter overload control mechanism is an optional feature over the SWx interface.\nIt is recommended to make use of IETF RFC 7683 [47] on the SWx interface where, when applied, the 3GPP AAA server shall behave as a reacting node and the HSS as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2.2\tHSS behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The HSS requests traffic reduction from the 3GPP AAA server when it is in an overload situation, by including OC-OLR AVP in answer commands as described in IETF RFC 7683 [47].\nThe HSS identifies that it is in an overload situation by implementation specific means. For example, the HSS may take into account the traffic over the SWx interfaces or other interfaces, the level of usage of internal resources (CPU, memory), the access to external resources etc.\nThe HSS determines the specific contents of the OC-OLR AVP in overload reports and the HSS decides when to send OC-OLR AVPs by implementation specific means.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2.3\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP AAA server applies required traffic reduction received in answer commands to subsequent applicable requests, as per IETF RFC 7683 [47].\nRequested traffic reduction is achieved by the 3GPP AAA server by implementation specific means. For example, it may implement message throttling with prioritization.\nThe 3GPP AAA server, when requested to apply traffic reduction over the SWx interface, may request traffic reduction over the interfaces (e.g STa, SWm, S6b) towards the access nodes if the Diameter overload control mechanism is supported on these interfaces.\nAnnex C gives guidance on message prioritisation over the SWx interface.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.3\tSTa interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.3.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter overload control mechanism is an optional feature over the STa interface.\nIt is recommended to make use of the IETF RFC 7683 [47] over the STa interface where, when applied, the trusted non 3GPP access network shall behave as a reacting node and the 3GPP AAA server as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.3.2\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP AAA server requests traffic reduction from the trusted non 3GPP access network when it is in an overload situation, by including OC-OLR AVP in answer commands as described in IETF RFC 7683 [47].\nThe 3GPP AAA server identifies that it is in an overload situation by implementation specific means. For example, the 3GPP AAA server may take into account the traffic over the STa interfaces or other interfaces, the level of usage of internal resources (CPU, memory), the access to external resources etc.\nThe 3GPP AAA server determines the specific contents of the OC-OLR AVP in overload reports and the 3GPP AAA server decides when to send OC-OLR AVPs by implementation specific means.\nThe 3GPP AAA server, when requested to apply traffic reduction over the SWx interface, may also request traffic reduction over the STa interfaces towards the trusted access networks nodes.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.3.3\tTrusted non 3GPP access network behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The trusted non 3GPP access network applies required traffic reduction received in answer commands to subsequent applicable requests, as per IETF RFC 7683 [47].\nRequested traffic reduction is achieved by the trusted non 3GPP access network by implementation specific means. For example, it may implement message throttling with prioritization.\nAnnex C gives guidance on message prioritisation over the STa interface.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.4\tS6b interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.4.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter overload control mechanism is an optional feature over the S6b interface.\nIt is recommended to make use of the IETF RFC 7683 [47] over the S6b interface where, when applied, the PDN-GW shall behave as a reacting node and the 3GPP AAA server as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.4.2\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP AAA server requests traffic reduction from the PDN-GW when it is in an overload situation, by including OC-OLR AVP in answer commands, as described in IETF RFC 7683 [47].\nThe 3GPP AAA server identifies that it is in an overload situation by implementation specific means. For example, the 3GPP AAA server may take into account the traffic over the S6b interfaces and other interfaces, the level of usage of internal resources (CPU, memory), the access to external resources etc.\nThe 3GPP AAA server determines the specific contents of the OC-OLR AVP in overload reports and when the 3GPP AAA server decides when to send OC-OLR AVPs by implementation specific means.\nThe 3GPP AAA server, when requested to apply traffic reduction over the SWx interface, may also request traffic reduction over the S6b interfaces towards the PDN-GWs.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.4.3\tPDN-GW behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The PDN-GW applies required traffic reduction received in answer commands to subsequent applicable requests, as per IETF RFC 7683 [47].Requested traffic reduction is achieved by the PDN-GW by implementation specific means. For example, it may implement message throttling with prioritization.\nAnnex C gives guidance on message prioritisation over the S6b interface.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.5\tSWa Interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.5.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter overload control mechanism is an optional feature over the SWa interface.\nIt is recommended to make use of the IETF RFC 7683 [47] over the SWa interface where, when applied, the untrusted non-3GPP access network shall behave as a reacting node and the 3GPP AAA server as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.5.2\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP AAA server behaviour is the same as described in clause B.3.2 for STa by replacing:\n-\ttrusted non 3GPP access network by untrusted non 3GPP access network;\n-\tSTa by SWa.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.5.3\tuntrusted non-3GPP access network behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The untrusted non-3GPP access network behaviour is the same as described in clause B.3.3 for STa by replacing:\n-\ttrusted non 3GPP access network by untrusted non 3GPP access network;\n-\tSTa by SWa.\nAnnex C gives guidance on message prioritisation over the SWa interface.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.6\tSWm Interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.6.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter overload control mechanism is an optional feature over the SWm interface.\nIt is recommended to make use of the IETF RFC 7683 [47] over the SWm interface where, when applied, the ePDG shall behave as a reacting node and the 3GPP AAA server as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.6.2\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP AAA server behaviour is the same as described in clause B.3.2 for STa by replacing\n-\ttrusted non 3GPP access network by ePDG;\n-\tSTa by SWm.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.6.3\tePDG behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The ePDG behaviour is the same as described in clause B.3.3 for STa by replacing:\n-\ttrusted non 3GPP access network by ePDG;\n-\tSTa by SWm.\nAnnex C gives guidance on message prioritisation over the SWm interface.\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "C.1\tIntroduction",
            "description": "Annex C gives guidance on the Diameter overload control node behaviours regarding message prioritisation over non 3GPP access interfaces.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.2\tMessage prioritization over SWx",
            "description": "This clause gives an analysis of possible behaviours of the 3GPP AAA server regarding message prioritisation as guidance and for an informative purpose.\nWhen the HSS is overloaded, the 3GPP AAA server will receive overload reports from the HSS requesting a reduction of the requests sent by the 3GPP AAA server. This will apply to MAR and SAR requests.\nThe 3GPP AAA server can consider some messages with a lower or a higher priority; lower priority messages will be candidates for throttling before higher priority messages.\nThe 3GPP AAA server can take into account if it has already registered the user:\n-\tDiameter requests related to PDN connections for emergency services have the highest priority. Depending on regional/national requirements and network operator policy, these Diameter requests are the last to be throttled, when the 3GPP AAA Server has to apply traffic reduction;\n-\tif the user is not already registered in the 3GPP AAA server and the user is not establishing a PDN connection for emergency services, the 3GPP AAA server gives a lower priority to the MAR command to be sent to the HSS. This will correspond to the following cases:\n-\tthe user is not registered for non 3GPP access in the HSS and is doing an attach on a non 3GPP access;\n-\tthe user is not registered for non 3GPP access in the HSS and is doing an handover from a 3GPP access; if the MAR command is throttled, the PDN connection will be then maintained in the 3GPP access;\n-\tthe user is registered in the HSS but with another 3GPP AAA server, apart a restoration case (see further), this relates to a new session. There is nevertheless a limitation for an inter RAT mobility between non 3GPP accesses when such a MAR is throttled, this is considered as acceptable;\n-\tafter a not throttled and successful MAR, the subsequent requests (SARs) have a higher priority, otherwise it would mean that the initial MAR command processed by the (overloaded) HSS has been useless. An example is the call flow described in Annex C;\n-\tif the user is registered in the 3GPP AAA server, the 3GPP AAA server gives a higher priority to the MAR or SAR commands to be sent to the HSS as to maintain the service to the user;\tnevertheless, if a SAR indicates a PGW_UPDATE and is related to an additional Diameter session over S6b for the user, so to establish an additional PDN connection, a lower priority may be given to this SAR;\n-\tin a restoration procedure due to the failure of the old 3GPP AAA server, the new 3GPP AAA server is informed of such a restoration procedure by the presence of the AAA-Failure-Indication AVP in the request received from the access. As restoration procedures may be a source of a high signalling traffic and contribute to a HSS overload, the new 3GPP AAA server may give a lower priority to such MAR messages;\n-\tthe deregistration of the user by the 3GPP AAA server has a higher priority as releasing resources in the HSS.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.3\tMessage prioritisation over STa, SWm and SWa",
            "description": "This clause gives an analysis of possible behaviours of the trusted non 3GPP access network over STa, of the untrusted non 3GPP access network over SWa and of the ePDG over SWm regarding message prioritisation as guidance and for an informative purpose.\nIn the rest of the clause, a reacting node identifies:\n-\ta trusted non 3GPP access network over STa;\n-\tan untrusted non 3GPP access network over SWa;\n-\tan ePDG over SWm.\nAs applying Diameter overload control over SWm and SWa may overlap, this is an operator policy to apply Diameter overload control either on SWm or on SWa or on both.\nWhen the 3GPP AAA server is overloaded, the reacting node will receive overload reports from the 3GPP AAA server requesting a reduction of requests sent by the reacting node. This will apply to DER, STR (and also AAR for STa and SWm) commands.\nThe reacting node can consider some messages with a lower or a higher priority; lower priority messages will be candidates for throttling before higher priority messages. The reacting node can take into account the following considerations:\n-\tDiameter requests related to PDN connections for emergency services have the highest priority. Depending on regional/national requirements and network operator policy, these Diameter requests are the last to be throttled, when the reacting node has to apply traffic reduction;\n-\tif the user has no existing context in the reacting node and the user is not establishing a PDN connection for emergency services, the reacting node gives a lower priority to authentication and authorisation procedures, so to DER commands. This avoids adding new users on the 3GPP AAA server. There is nevertheless a consequence in limiting an inter RAT mobility between non 3GPP accesses when such a DER is throttled, this is considered as acceptable;\n-\tif the initial request was not throttled, the subsequent requests have a higher priority, otherwise it would mean that the initial request processed by the (overloaded) 3GPP AAA server has been useless. An example is the call flow described in Annex A.2 for STa;\n-\tIf the user has an existing context in the reacting node, new requests have a higher priority so to maintain the service to the user;\n-\tDER Requests (and also AAR for STa) resulting from the reception of a re-authentication re-authorisation procedure (or also re-authorisation procedure over STa) from the 3GPP AAA server have a higher priority, so to maintain the service to the user;\n-\tThe trusted non 3GPP access network has the possibility (see 5.1.2.3.1clause), at any time, to send a AAR command for check if there is any modification in the user authorization parameters previously provided by the 3GPP AAA Server. The trusted non 3GPP access network may defer such AAR requests to diminish the traffic without impacting the service to the user;\n-\tSession termination procedures initiated by the reacting node may have a higher priority as releasing resources in the 3GPP AAA server.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.4\tMessage prioritization over S6b",
            "description": "This clause gives an analysis of possible behaviours of the PDN-GW regarding message prioritisation as guidance and for an informative purpose.\nWhen the 3GPP AAA server is overloaded, the PDN-GW will receive overload reports from the 3GPP AAA server requesting a reduction of requests sent by the PDN-GW. This will apply to AAR and STR commands.\nThe PDN-GW can consider some messages with a lower or a higher priority; lower priority messages will be candidates for throttling before higher priority messages.\nFollowing considerations can be taken into account:\n-\tAn important point to consider is that UEs accessing the PDN-GW via S2a or S2b have already been previously authorized to use the non 3GPP access (i.e. via STa or SWm or SWa). The AAR command over S6b following this initial authorisation has a higher priority, otherwise, if the AAR is throttled, it would mean that the initial authorisation procedure (and its process by the 3GPP AAA server) has been useless;\n-\tAn exception is in the Multi Connection Mode (MCM) (described in 3GPP TS 23.402 [3]), where after a first PDN connection being established, the UE requests the establishment of additional PDN connections. As the priority, when overload in the 3GPP AAA server, is to maintain the existing service in preference to setting up new services for the user, such AAR commands over S6b may have a lower priority;\n-\tTraffic reduction over the STa or SWm or SWa interfaces with the throttling of new authentication authorisation procedures, results in diminishing requests for new PDN connections to the PDN-GW and diminishing the traffic over S6b;\n-\tregarding the 3GGP AAA Server behaviour, it is better to request traffic reduction over the STa or SWm or SWa interfaces than over the S6b interface, so following the principle to request the traffic reduction as early and as close as possible to the traffic source (i.e. the UE);\n-\tAAR Requests resulting from the reception of a re-authorisation procedure from the 3GPP AAA server have a higher priority, so to maintain the service to the user;\n-\tthe session termination procedures over S6b initiated by the PDN-GW resulting from a UE request may have a higher priority as releasing resources in the 3GPP AAA server.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.1\tGeneral",
            "description": "IETF RFC 7944 [53] specifies a Diameter routing message priority mechanism that allows Diameter nodes to indicate the relative priority of Diameter messages. With this information, other Diameter nodes may leverage the relative priority of Diameter messages into routing, resource allocation, set the DSCP marking for transport of the associated Diameter message, and also abatement decisions when overload control is applied.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.2\tSWa, STa, SWd, SWm, SWx, S6b interfaces",
            "description": "The Diameter message priority mechanism is an optional feature which may apply on one or several of the SWa, STa, SWd, SWm, SWx, S6b interfaces.\nIt is recommended to make use of IETF RFC 7944 [53] over the SWa, STa, SWd, SWm, SWx, S6b interfaces of an operator network when the overload control defined in Annex C is applied on these interfaces.\nA 3GPP functional entity supporting the Diameter message priority mechanism over an interface listed above shall comply with IETF RFC 7944 [53].\nA 3GPP functional entity sending a request shall determine the required priority according to its policies. When priority is required, it shall include the DRMP AVP indicating the required priority level in the request it sends, and shall prioritise the request according to the required priority level.\nWhen the 3GPP functional element receives the corresponding response, it shall prioritise the received response according to the priority level received within the DRMP AVP if present in the response, otherwise according to the priority level of the corresponding request.\nWhen a 3GPP functional entity receives a request, it shall handle the request according to the received DRMP AVP priority level. For the response, it may modify the priority level received in the DRMP AVP according to its policies and shall handle the response according to the required priority level. If the required priority level is different from the priority level received in the request, it shall include the DRMP AVP in the response.\nIf:\n-\ta 3GPP functional entity supports using the Diameter message priority mechanism for DSCP marking purposes,\n-\tthe transport network utilizes DSCP marking, and\n-\tmessage-dependant DSCP marking is possible for the protocol stack transporting Diameter,\nthen the 3GPP functional entity shall set the DSCP marking for transport of the request or response according to the required priority level.\nDiameter requests related to high priority traffic (e.g, MPS, emergency) shall contain a DRMP AVP with a high priority of which the level value is operator dependent.\nWhen not-explicitly requested, the inclusion and priority value of the DRMP AVP in Diameter messages are implementation specific.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.1\tGeneral",
            "description": "This clause provides example call flows for the Untrusted WLAN authentication and authorization procedure.\nThis Annex is informative and the normative descriptions in this specification and in 3GPP TS 33.402 [19] prevail over the descriptions in this Annex if there is any difference.\nSee clause 8.2.2 of 3GPP TS 33.402 [19] for details on the IKEv2 and EAP-AKA procedures. This clause focuses on the SWm, S6b and SWx signalling interactions.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.2\tSuccessful call flow",
            "description": "Figure Annex E.2-1 describes a successful Untrusted WLAN authentication and authorization call flow.\nThe figure depicts a successful case of untrusted WLAN authentication and authorization procedure, showing a user attempting to log in to an untrusted WLAN network. The figure includes a user interface (UI) with a username and password field, a \"Log in\" button, and a \"Log out\" button. The UI also includes a \"Remember me\" checkbox and a \"Forgot password\" link. The figure includes a \"Login\" button, a \"Forgot password\" link, and a \"Forgot username\" link. The figure also includes a \"Log out\" button. The figure includes a \"Login\" button, a \"Forgot password\" link, and a \"Forgot username\" link. The figure includes a \"Login\" button, a \"Forgot password\" link, and a \"Forgot username\" link. The figure includes a \"Login\" button, a \"Forgot password\" link, and a \"Forgot username\" link. The figure includes a \"Login\" button, a \"Forgot password\" link, and a \"Forgot username\" link. The figure includes a \"Login\" button, a \"Forgot password\" link, and a \"Forgot username\" link. The figure includes a \"Login\" button, a\nFigure Annex E.2-1: Untrusted WLAN Authentication and Authorization Procedure – successful case\n3.\tThe ePDG sends the EAP-RSP/Identity payload to the 3GPP AAA Server and also indicates the user identity and requested APN, if received from the UE.\n4.\tThe 3GPP AAA Server retrieves authentication vectors for the UE from the HSS.\n5.\tThe 3GPP AAA Server sends an EAP Request/AKA-Challenge.\n6.\tThe ePDG forwards the EAP payload to the UE and also requests the UE to provide its Mobile Equipment Identity if required.\n8.\tThe ePDG forwards the EAP payload to the 3GPP AAA Server. The user's Mobile Equipment Identity is also included, if available.\n9.\tIf dynamic IP mobility selection is executed, the selected mobility mode is sent to the UE in an AKA-Notification request.\n10.\tIf the 3GPP AAA Server successfully authentifies the UE, the 3GPP AAA Server downloads the user's subscription information from the HSS.\n11.\tIf the 3GPP AAA Server authorizes the access for the UE, the 3GPP AAA Server sends an EAP Success message that the ePDG forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_SUCESS. The subscription information, keying material and permanent user identity are also provided to the ePDG.\n14.\tThe ePDG sends a Create Session Request/PBU message to the PDN GW to initiate the S2b tunnel establishment.\n15.\tThe PDN GW informs the 3GPP AAA Server/HSS of its PDN GW identity and the APN corresponding to the UE's PDN Connection.\n16.\tThe PDN GW returns a Create Session Response/PBA message to the ePDG, including the IP address(es) allocated for the UE.\n17.\tThe IKEv2 negotiation completes. The ePDG provides the UE IP address to the UE.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.3\tCall flow with IMEI check in VPLMN",
            "description": "Figure Annex E.3-1 describes a roaming call flow, with IMEI check performed in the VPLMN.\nThe figure depicts a WLAN authentication and authorization procedure, with an IMEI check performed in the VPLMN. The procedure includes the use of a trusted third-party service (TTS) to authenticate the user's identity, and the use of a trusted service provider (TSP) to authorize the user's access. The procedure is designed to ensure the security and privacy of the user's data, and to comply with relevant regulations and standards.\nFigure Annex E.3-1: Untrusted WLAN Authentication and Authorization Procedure, with IMEI check performed in the VPLMN\n1. to 5. Same as Figure E.2-1.\n6.\tIf IMEI check is required by operator policy, the ePDG requests the UE to provide its Mobile Equipment Identity.\n7.\tSame as Figure E.2-1.\n8.\tThe ePDG includes the Terminal-Information AVP in the DER command. If IMEI check is required by operator policy, the 3GPP AAA Proxy performs the IMEI check in the VPLMN. If the IMEI check allows to continue the authentication and authorization procedure, the 3GPP AAA Proxy forwards the DER to the 3GPP AAA Server (as shown in this figure). Otherwise the 3GPP AAA Proxy responds to the ePDG with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT and sends a SWm Session Termination Request towards the 3GPP AAA Server.\n9 to 17. Same as Figure E.2-1 if the IMEI check in VPLMN was successful.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.1\tGeneral",
            "description": "IETF RFC 8583 [54] specifies a Diameter overload control mechanism which includes the definition and the transfer of related AVPs between Diameter nodes.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.2\tSWx interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter load control mechanism is an optional feature over the SWx interface.\nIt is recommended to make use of IETF RFC 8583 [54] on the SWx interface where, when applied, the 3GPP AAA server shall behave as a reacting node and the HSS as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.2.2\tHSS behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The HSS may report its current load by including a Load AVP of type HOST in answer commands as described in IETF RFC 8583 [54].\nThe HSS calculates its current load by implementation specific means. For example, the HSS may take into account the traffic over the SWx interface or other interfaces, the level of usage of internal resources (e.g. CPU, memory), the access to external resources, etc.\nThe HSS determines when to send Load AVPs of type HOST by implementation specific means.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.2.3\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "When performing next hop Diameter Agent selection for requests that are routed based on realm, the 3GPP AAA server may take into account load values from Load AVPs of type PEER received from candidate next hop Diameter nodes, as per IETF RFC 8583 [54].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.3\tSTa interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.3.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter load control mechanism is an optional feature over the STa interface.\nIt is recommended to make use of the IETF RFC 8583 [54] over the STa interface where, when applied, the trusted non 3GPP access network shall behave as a reacting node and the 3GPP AAA server as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.3.2\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP AAA server may report its current load by including a Load AVP of type HOST in answer commands as described in IETF RFC 8583 [54].\nThe 3GPP AAA server calculates its current load by implementation specific means. For example, the 3GPP AAA server may take into account the traffic over the STa interface or other interfaces, the level of usage of internal resources (e.g. CPU, memory), the access to external resources, etc.\nThe 3GPP AAA server determines when to send Load AVPs of type HOST by implementation specific means.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.3.3\tTrusted non 3GPP access network behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "When performing next hop Diameter Agent selection for requests that are routed based on realm, the Trusted non 3GPP access network may take into account load values from Load AVPs of type PEER received from candidate next hop Diameter nodes, as per IETF RFC 8583 [54].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.4\tS6b interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.4.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter load control mechanism is an optional feature over the S6b interface.\nIt is recommended to make use of the IETF RFC 8583 [54] over the S6b interface where, when applied, the PDN-GW shall behave as a reacting node and the 3GPP AAA server as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.4.2\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP AAA server may report its current load by including a Load AVP of type HOST in answer commands as described in IETF RFC 8583 [54].\nThe 3GPP AAA server calculates its current load by implementation specific means. For example, the 3GPP AAA server may take into account the traffic over the S6b interface or other interfaces, the level of usage of internal resources (e.g. CPU, memory), the access to external resources, etc.\nThe 3GPP AAA server determines when to send Load AVPs of type HOST by implementation specific means.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.4.3\tPDN-GW behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "When performing next hop Diameter Agent selection for requests that are routed based on realm, the PDN-GW may take into account load values from Load AVPs of type PEER received from candidate next hop Diameter nodes, as per IETF RFC 8583 [54].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.5\tSWa Interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.5.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter load control mechanism is an optional feature over the SWa interface.\nIt is recommended to make use of the IETF RFC 8583 [54] over the SWa interface where, when applied, the untrusted non-3GPP access network shall behave as a reacting node and the 3GPP AAA server as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.5.2\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP AAA server behaviour is the same as described in clause F.3.2 for STa by replacing:\n-\ttrusted non 3GPP access network by untrusted non 3GPP access network;\n-\tSTa by SWa.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.5.3\tuntrusted non-3GPP access network behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The untrusted non-3GPP access network behaviour is the same as described in clause F.3.3 for STa by replacing:\n-\ttrusted non 3GPP access network by untrusted non 3GPP access network;\n-\tSTa by SWa.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.6\tSWm Interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.6.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter load control mechanism is an optional feature over the SWm interface.\nIt is recommended to make use of the IETF RFC 8583 [54] over the SWm interface where, when applied, the ePDG shall behave as a reacting node and the 3GPP AAA server as a reporting node.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.6.2\t3GPP AAA server behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The 3GPP AAA server behaviour is the same as described in clause F.3.2 for STa by replacing\n-\ttrusted non 3GPP access network by ePDG;\n-\tSTa by SWm.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.6.3\tePDG behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "The ePDG behaviour is the same as described in clause F.3.3 for STa by replacing:\n-\ttrusted non 3GPP access network by ePDG;\n-\tSTa by SWm.\n\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 103,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}