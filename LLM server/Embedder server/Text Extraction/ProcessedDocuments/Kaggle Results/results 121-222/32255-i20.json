{
    "document_name": "32255-i20.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document is part of a series of documents that specify charging functionality and charging management in 3GPP networks. The 3GPP core network charging architecture and principles are specified in TS 32.240 [1], which provides an umbrella for other charging management TSs that specify:\n-\tthe content of the CDRs per domain / subsystem / service (offline charging);\n-\tthe content of real-time charging messages per domain / subsystem / service (online charging);\n-\tthe functionality of online and offline charging for those domains / subsystems / services;\n-\tthe interfaces that are used in the charging framework to transfer the charging information (i.e. CDRs or charging events).\nThe complete document structure for these TSs is defined in TS 32.240 [1].\nThe present document specifies the converged offline and online charging description for the 5G Data Connectivity domain based on the functional stage 2 description in TS 23.501 [200], TS 23.502 [201] and TS 23.503 [202].\nThis charging description includes the converged offline and online charging architecture and scenarios specific to the 5G Data Connectivity domain, as well as the mapping of the common 3GPP charging architecture specified in TS 32.240 [1] onto the 5G Data Connectivity domain.\nIt further specifies the structure and content of the CDRs for offline charging, and the charging events for converged online and offline charging. The present document is related to other 3GPP charging TSs as follows:\n-\tThe common 3GPP charging architecture is specified in TS 32.240 [1].\n-\tThe parameters, abstract syntax and encoding rules for the CDRs are specified in TS 32.298 [51].\n-\tA transaction based mechanism for the transfer of CDRs within the network is specified in TS 32.295 [54].\n-\tThe file based mechanism used to transfer the CDRs from the network to the operator's billing domain (e.g. the billing system or a mediation device) is specified in TS 32.297 [52].\n-\tThe services, operations and procedures of charging, using Service Based Interface are specified in TS 32.290 [57].\n-\tThe charging service of 5G system is specified in TS 32.291 [58].\nAll references, abbreviations, definitions, descriptions, principles and requirements, used in the present document, that are common across 3GPP TSs, are defined in TR 21.905 [100]. Those that are common across charging management in 3GPP networks/domains, services or subsystems are provided in the umbrella TS 32.240 [1] and are copied into clause 3 of the present document for ease of reading. Finally, those items that are specific to the present document are defined exclusively in the present document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TS 32.240: \"Telecommunication management; Charging management; Charging architecture and principles\".\n[2] - [50]\tVoid.\n[51]\t3GPP TS 32.298: \"Telecommunication management; Charging management; Charging Data Record (CDR) parameter description\".\n[52]\t3GPP TS 32.297: \"Telecommunication management; Charging management; Charging Data Record (CDR) file format and transfer\".\n[53] \tVoid.\n[54]\t3GPP TS 32.295: \"Telecommunication management; Charging management; Charging Data Record (CDR) transfer\".\n[55-56] \tVoid.\n[57]\t3GPP TS 32.290: \"Telecommunication management; Charging management; 5G system; Services, operations and procedures of charging using Service Based Interface (SBI)\".\n[58]\t3GPP TS 32.291: \" Telecommunication management; Charging management; 5G system; Charging service, stage 3\".\n[59] - [69]\tVoid.\n[70]\t3GPP TS 28.202: \" Telecommunication management; Charging management; Network slice management charging in the 5G System (5GS); Stage 2\".\n[71] - [99]\tVoid.\n[100]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[101]\t3GPP TS 22.115: \"Service aspects; Charging and billing\".\n[102]\t3GPP TS 22.261: \"Service requirements for next generation new services and markets\".\n[103] - [199]\tVoid\n[200]\t3GPP TS 23.501:\"System Architecture for the 5G System\".\n[201]\t3GPP TS 23.502:\"Procedures for the 5G System\".\n[202]\t3GPP TS 23.503:\"Policy and Charging Control Framework for the 5G System; Stage 2\".\n[203]\t3GPP TS 23.316: \"Wireless and wireline convergence access support for the 5G System (5GS)\".\n[204]\t3GPP TS 23.247: \"Architectural enhancements for 5G multicast-broadcast services; Stage 2\".\n[205] - [299]\tVoid\n[300] - [399]\tVoid.\n[400] - [499]\tVoid.\n[500] - [599]\tVoid.\n[600]\t3GPP TS 23.228:\"IP Multimedia Subsystem (IMS); Stage 2\".\n[601]\t3GPP TS 29.512:\" 5G System; Session Management Policy Control Service; Stage 3\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [100] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [100].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tSymbols",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following symbols apply:\nBd\tReference point for the CDR file transfer from the 5G Data connectivity CGF to the BD.\nGa\tReference point for CDR transfer between a CDF and the CGF.\nNchf\tService based interface exhibited by CHF.\nN40\tReference point between SMF and the CHF.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.3\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [100] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [100].\n5GC\t5G Core Network\n5GS\t5G System\nABMF\tAccount Balance Management Function\nAF\tApplication Function\nAMF\tAccess and Mobility Management Function\nATSSS\tAccess Traffic Steering, Switching, Splitting\nAUSF\tAuthentication Server Function\nBD\tBilling Domain\nCAG\tClosed Access Group\nCCS\tConverged Charging System\nCDF\tCharging Data Function\nCGF\tCharging Gateway Function\nCHF\tCharging Function\nCIoT\tCellular Internet of Things\nCP\tControl Plane\nCTF\tCharging Trigger Function\nDNN\tData Network Name\nFBC\tFlow Based Charging\nIoT\tInternet of Things\nGPSI\tGeneric Public Subscription Identifier\nGUAMI\tGlobally Unique AMF Identifier\nMA\tMulti-Access\nMBS\tMulticast/Broadcast Service\nMB-SMF\tMulticast/Broadcast Session Management Function.\nMB-UPF\tMulticast/Broadcast User Plane Function\nMPTCP\tMulti-Path TCP Protocol\nMTC\tMachine-Type Communications\nN3IWF\tNon-3GPP InterWorking Function\nNE\tNetwork Element\nNEF\tNetwork Exposure Function\nNF\tNetwork Function\nNPN\tNon-Public Network\nNRF\tNetwork Repository Function\nNSSF\tNetwork Slice Selection Function\nOCF\tOnline Charging Function\nOCS\tOnline Charging System\nPCC\tPolicy and Charging Control\nPCF\tPolicy Control Function\nPEI\tPermanent Equipment Identifier\nPNI-NPN\tPublic Network Integrated Non-Public Network\nQBC\tQoS flow Based Charging\nQFI\tQoS Flow Identifier\nSCP\tService Communication Proxy\nSCC\tSatellite Communication Customer\nSDF\tService Data Flow\nSMF\tSession Management Function\nSMNO\tSatellite Mobile network Operator\nSNPN\tStand-alone Non-Public Network\nSSC\tSession and Service Continuity\nSSP\tSatellite Service Provider\nSUPI\tSubscription Permanent Identifier\nTNAN\tTrusted Non-3GPP Access Network\nTNAP\tTrusted Non-3GPP Access Point\nUDM\tUnified Data Management\nUDR\tUnified Data Repository\nUPF\tUser Plane Function\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tArchitecture considerations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tHigh-level 5G System architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.1.1\tNon-roaming reference architecture",
                            "text_content": "Figure 4.1.1.1 shows the 5G System high level architecture as defined in TS 23.501 [200] for 5G data connectivity, in the service-based representation for Control Plane (CP) Network Functions.\nThe figure depicts the 5G system architecture, illustrating the various components and their interconnections. It highlights the use of core switches, optical line terminals (OLTs), and distributed nodes to ensure redundancy and failover reliability. The layered design aligns with SDN principles, emphasizing the importance of network virtualization and automation.\nFigure 4.1.1.1: 5G System architecture\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.2\tRoaming Home Routed reference architecture",
                            "text_content": "Figure 4.1.2.1 shows the 5G System high level Roaming Home Routed architecture as defined in TS 23.501 [200] for 5G data connectivity, in the service-based representation for Control Plane (CP) Network Functions.\nThe figure depicts a 5G roaming system architecture, specifically focusing on the home-roaming scenario within the service-based interface representation. It illustrates the various components and their interconnections, including base stations (BSs), mobile edge computing (MEC), and home routers. The figure highlights the importance of network slicing and network slicing policy in managing network resources and ensuring efficient use of network resources.\nFigure 4.1.2.1: Roaming 5G System architecture - home routed scenario in service-based interface representation\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.3\tInterworking with EPC architecture",
                            "text_content": "Figure 4.1.3.1 shows the non-roaming architecture for interworking between 5GS and EPC/E-UTRAN as defined in TS 23.501 [200] for 5G data connectivity.\nThe figure depicts a non-roaming architecture for interworking between 5G and EPC/E-UTRAN networks. It illustrates the non-repeater architecture, which allows for seamless communication between the two networks. The figure shows the non-repeater network, which consists of a single base station (gNB) and multiple distributed nodes (D-nodes). The D-nodes are responsible for the interworking between the 5G and EPC/E-UTRAN networks. The figure also includes a non-repeater network diagram, which shows the non-repeater network layout and the interworking between the 5G and EPC/E-UTRAN networks.\nFigure 4.1.3.1: Non-roaming architecture for interworking between 5GS and EPC/E-UTRAN\nNOTE:\tN26 interface is an inter-CN interface between the MME and 5GS AMF in order to enable interworking between EPC and the NG core. Support of N26 interface in the network is optional for interworking.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.4\tArchitecture reference for Non-3GPP Accesses",
                            "text_content": "Figure 4.1.4.1 shows the non-roaming architecture for Non-3GPP Accesses as defined in TS 23.501 [200] for 5G data connectivity.\nThe reference architecture supports service-based interfaces for AMF, SMF, and other NF types not depicted in the figure. It features a layered design with redundancy paths, ensuring failover reliability.Figure 4.1.4.1: Non-roaming architecture for Untrusted Non-3GPP Accesses\nThis reference architecture supports service based interfaces for AMF, SMF and other NFs not represented in the figure.\nFigure 4.1.4.2 shows the non-roaming architecture for 5G Core Network with trusted non-3GPP access as defined in TS 23.501 [200] for 5G data connectivity.\nThe figure depicts a non-roaming architecture for the 5G Core Network, highlighting the use of non-3GPP access for trusted non-roaming services. The architecture includes non-roaming core switches, optical line terminals (OLTs), and distributed nodes, with redundancy paths to ensure failover reliability. The layered design aligns with SDN principles.\nFigure 4.1.4.2: Non-roaming architecture for 5G Core Network with trusted non-3GPP access\nThe UE is connected to the 5G Core Network over non-3GPP access. This reference architecture supports service based interfaces for AMF, SMF and other NFs not represented in the figure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.5\tArchitecture for deployments topologies with specific SMF Service Areas",
                            "text_content": "Figure 4.1.5.1 shows the 5G System high level non-roaming architecture, as defined in TS 23.501 [200], with an I-SMF insertion to the PDU Session without UL-CL/BP, using reference point representation.\nThe figure depicts a non-roaming architecture with I-SMF insertion to the PDU Session in reference point representation, illustrating the non-repeating path (NRP) and the use of I-SMF (Inter-Switch Multiplexer) to ensure reliable communication.\nFigure 4.1.5.1: Non-roaming architecture with I-SMF insertion to the PDU Session in reference point representation, with no UL-CL/BP\nFigure 4.1.5.2 shows the 5G System high level non-roaming architecture, as defined in TS 23.501 [200], for an I-SMF insertion to the PDU Session with UL-CL/BP, using reference point representation.\nThe figure depicts a non-roaming architecture with I-SMF insertion to the PDU Session in reference point representation, illustrating the use of UL-CL/BP for non-roaming signaling.\nFigure 4.1.5.2: Non-roaming architecture with I-SMF insertion to the PDU Session in reference point representation, with UL-CL/BP\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.6\tArchitecture reference for ATSSS support",
                            "text_content": "The 5G System Architecture references for the support of ATSSS in 5G data connectivity charging are specified in TS 23.501 [200]:\n-\tNon-roaming: Figure 4.2.10-1.\n-\tRoaming with Home-routed architecture - UE registered to the same VPLMN: Figure 4.2.10-2.\n-\tRoaming with Home-routed architecture - UE registered to different PLMNs: Figure 4.2.10-3.\nThe Hybrid Access architecture of 5G-RG for the support of ATSSS in 5G data connectivity charging is defined in clause 4.1.7.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.7\tArchitecture reference for Wireline Access network",
                            "text_content": "Figure 4.1.7.1 shows the non- roaming architecture for 5G Core Network for 5G-RG with Wireline 5G Access network and NG RAN as defined in TS 23.501 [200] for 5G data connectivity.\nThe figure depicts a non-roaming architecture for a 5G Core Network in a 5G-RG with a Wireline 5G Access network and a Non-Line-of-Sight (NLOS) Radio Access Network (RAN). The architecture is designed to ensure reliability and failover capabilities, with redundant paths and layered design principles.\nFigure 4.1.7.1: Non- roaming architecture for 5G Core Network for 5G-RG with Wireline 5G Access network and NG RAN\nThe 5G-RG can be connected to 5GC via W-5GAN, NG RAN or via both accesses. The reference architecture in Figure 4.1.7.1 shows service based interfaces for AMF, SMF and other NFs are not represented in this figure.\nNon- roaming architecture for 5G Core Network for FN-RG with Wireline 5G Access network is specified in TS 23.501 [200].\nA 5G-RG connecting via W-5GAN or NG-RAN access towards 5GC can provide connectivity for a UE behind the 5G-RG to access an N3IWF or TNGF.\nNon-roaming architecture for UE behind 5G-RG using trusted N3GPP access is specified in Figure 4.10-1 of TS 23.316 [203].\nArchitecture for UE behind 5G-RG using untrusted N3GPP access is specified in Figure 4.10-2 of TS 23.316 [203].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.8\tRoaming Local Breakout reference architecture",
                            "text_content": "Figure 4.1.8.1 shows the 5G System high level Roaming Local Breakout architecture as defined in TS 23.501 [200] for 5G data connectivity, in the service-based representation for Control Plane (CP) Network Functions.\nThe figure depicts a 5G roaming system architecture, specifically highlighting the local breakout scenario in the service-based interface representation. It illustrates the various components and their interconnections, such as base stations (BSs), mobile stations (MSs), and network elements (NEs). The figure also highlights the use of service-based interfaces to facilitate seamless roaming between BSs and MSs, ensuring reliable and efficient communication.\nFigure 4.1.8.1: Roaming 5G System architecture- local breakout scenario in service-based interface representation\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.9\tArchitecture reference for 5MBS",
                            "text_content": "Figure 4.1.9.1 shows the non-roaming architecture for 5G Multicast and Broadcast Service as defined in TS 23.247 [204] for 5G data connectivity.\nThe figure depicts a non-roaming architecture for 5G Multicast and Broadcast Service in reference point representation, illustrating the various components and their interconnections.\nFigure 4.1.9.1: Non-roaming architecture for 5G Multicast and Broadcast Service in reference point representation\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.10\tArchitecture reference for TSN support",
                            "text_content": "The 5G System Architecture references for the support of time sensitive communication in 5G data connectivity charging are specified in TS 23.501 [200].\n-\tSystem architecture view with 5GS appearing as TSN bridge: Figure 4.4.8.2-1.\n-\tArchitecture to enable Time Sensitive Communication and Time Synchronization services: Figure 4.4.8.3-1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.11\tArchitecture reference for NPN support",
                            "text_content": "The 5G System Architecture references for the support of SNPN in 5G data connectivity charging are specified:\n-\tThe architecture for UE direct access to SNPN is specified in Clause 4.2.3 in TS 23.501 [200];\n-\tThe architecture for 5GC with untrusted non-3GPP access for access to SNPN services via a PLMN (and vice versa) or for direct access to SNPN via non-3GPP access (as in Figure 4.2.8.2.1-1 in TS 23.501 [200]).\nThe 5G System Architecture references for the support of NPN in 5G data connectivity charging are specified:\n-\tThe architecture for UE access to PNI-NPN services via PLMN (as in Figure 4.2.3-1 in TS 23.501 [200]).\nPublic Network Integrated NPNs are NPNs made available via PLMNs e.g. by means of dedicated DNNs, or by one (or more) Network Slice instances allocated for the NPN.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.2\t5G data connectivity domain converged charging architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "The SMF embedding the CTF, generates charging events towards the CHF for data connectivity converged charging or offline only charging.\nAs described in TS 32.240 [1], the CTF generates charging events towards to the CHF for converged online and offline charging processing. The CDRs generation is performed by the CHF acting as a CDF, which transfers them to the CGF. \nFinally, the CGF creates CDR files and forwards them to the BD.\nIf the CGF is external, the CHF acting as a CDF, forwards the CDRs to the CGF across the Ga interface. \nIf the CGF is integrated, there is only one internal interface between the CHF and the CGF. In this case, the relationship between CHF and CGF is 1:1. An integrated CGF may support the Ga interface from other CDFs.\nWhen an external CGF is used, this CGF may also be used by other, i.e. non-5GCS, network elements, according to network design and operator decision. It should be noted that the CGF may also be an integrated component of the BD – in this case, the Bd interface does not exist and is replaced by a proprietary solution internal to the BD.\nFigure 4.2.1 depicts the architectural options for converged charging in service-based representation for CHF.\nThe figure depicts a converged charging architecture for 5G data connectivity, showcasing a simplified design with a focus on efficient power distribution and management. The architecture includes a combination of wired and wireless charging solutions, with the wireless charging system being highlighted as a key component. The figure illustrates the integration of various components, such as power distribution units (PDUs), charging stations, and charging infrastructure, to ensure a seamless and reliable charging experience for 5G devices.\nFigure 4.2.1: 5G data connectivity converged charging architecture\nArchitectural options of figure 4.2.1 apply to any 5G data connectivity converged charging architectures in the present clause.\nGa is described in clause 5.2.4 and Bd in clause 5.2.5. of the present document and Nchf is described in TS 32.290 [57]..\nFigure 4.2.2 depicts the 5G data connectivity converged charging architecture in reference point representation for non-roaming:\nThe figure depicts a converged charging architecture for 5G non-roaming data connectivity, with a reference point representation. It illustrates the various components and their interconnections, including the 5G network, charging infrastructure, and the reference point.\nFigure 4.2.2: 5G data connectivity converged charging architecture non-roaming reference point representation\nFigure 4.2.3 depicts the 5G data connectivity converged charging architecture service-based representation for roaming Home Routed:\nThe figure depicts a converged charging architecture for 5G Home Routed service, showcasing a simplified representation of the charging process. It includes a Home Routed service, a Home Gateway, and a Home Router, all interconnected through a converged charging architecture. The Home Gateway is responsible for managing the charging process, while the Home Router is responsible for routing the data to the appropriate charging stations. The Home Routed service is the primary service, and the Home Gateway and Home Router are the key components of the converged charging architecture.\nFigure 4.2.3: 5G data connectivity converged charging architecture roaming Home Routed service based representation\nFigure 4.2.4 depicts the 5G data connectivity converged charging architecture for roaming Home Routed in reference point representation:\nThe figure depicts a converged charging architecture in roaming Home Routed reference point representation, showcasing the 5G data connectivity in a converged charging system.\nFigure 4.2.4: 5G data connectivity converged charging architecture in roaming Home  Routed reference point representation\nThe N40 reference point is defined for the interactions between H-SMF and H-CHF and between V-SMF and V-CHF in the reference point representation.\nFigure 4.2.5 depicts the 5G data connectivity converged charging architecture service-based representation for roaming Local Breakout:\nThe figure depicts a converged charging architecture for 5G data connectivity, showcasing a local backhaul scenario with roaming and backup service. It illustrates the service-based representation of the charging architecture, highlighting the various components such as local backhaul, roaming, and backup services.\nFigure 4.2.5: 5G data connectivity converged charging architecture roaming Local Breakout scenario service based representation\nFigure 4.2.6 depicts the 5G data connectivity converged charging architecture for roaming local breakout with V-SMF to H-CHF in reference point representation:\nThe figure depicts a converged charging architecture for 5G data connectivity in Local Breakout V-SMF to H-CHF scenarios, illustrating the various components and their interconnections.\nFigure 4.2.6: 5G data connectivity converged charging architecture in Local Breakout V-SMF to H-CHF scenario reference point representation\nThe N40 reference point is defined for the interactions between V-SMF and V-CHF, the N47 reference point is defined for the interactions between V-SMF and H-CHF.\nFor scenarios with MVNO (owning a CHF referred to as A-CHF) non-roaming, the N40 reference point is defined for the interactions between SMF and CHF owned by MNO, the N47 reference point is used for the interactions between SMF owned by the MNO and A-CHF owned by the MVNO.\nN47 used by A-CHF owned by an additional actor (i.e. MVNO) to perform retail charging for its own subscribers is operator specific.\nOne or both of the architectures in Figure 4.2.6 and Figure 4.2.6a may be supported for local breakout roaming.\nIn case both architectures in Figure 4.2.6 and Figure 4.2.6a are supported for local breakout roaming, SMF and V-CHF determines which architecture should be selected for a roaming UE based on operator agreement.\nFigure 4.2.6a, is an alternative to Figure 4.2.6, and depicts the 5G data connectivity converged charging architecture for roaming local breakout with V-CHF to H-CHF in reference point representation:\nThe figure depicts a 5G data connectivity converged charging architecture in a Local Breakout V-CHF to H-CHF scenario, illustrating the various components and their interconnections. The architecture includes a converged charging point (CHF) and a charging point (CHF) in the Local Breakout V-CHF scenario, which is a reference point for the H-CHF scenario. The figure also shows the interconnection between the CHF and the H-CHF scenario, highlighting the importance of network connectivity in 5G data connectivity.\nFigure 4.2.6a: 5G data connectivity converged charging architecture in Local Breakout V-CHF to H-CHF scenario reference point representation\nThe N40 reference point is defined for the interactions between V-SMF and V-CHF, the N107 reference point is defined for the interactions between V-CHF and H-CHF.\nFor scenarios with MVNO (owning a CHF referred to as A-CHF) non-roaming, the N40 reference point is defined for the interactions between SMF and CHF owned by MNO, the N107 reference point is used for the interactions between CHF owned by the MNO and A-CHF owned by the MVNO.\nIn the TSN charging scenario, the interaction between SMF and TSN CHF via UE CHF is supported. Nchf interface is used for interaction between UE CHF and TSN CHF, which is defined in TS 32.290 [57].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.3\t5G data connectivity converged charging Consumer CHF to Business CHF architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure 4.3-1 depicts the 5G data connectivity converged charging Consumer CHF to Business CHF architecture in reference point representation:\n\n\nThe 3-1 converged charging architecture in 5G data connectivity, depicted in Figure 4, showcases the convergence of consumer and business charging points in a reference point representation. This architecture is designed to facilitate efficient charging for both consumer and business devices, ensuring seamless connectivity and user experience.\nFigure 4.3-1: 5G data connectivity converged charging architecture Consumer CHF to Business CHF architecture in reference point representation\nThe N40 reference point is as per Figure 4.2.2 of this document.\nThe N108 reference point is defined for the interactions between C-CHF and B-CHF.\nThis architecture is used for Network slice converged charging based on 5G data connectivity: the B-CHF handles the Tenant the Network Slice is assigned to.\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "5\t5G data connectivity charging principles and scenarios",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\t5G data connectivity charging principles",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.1.1\tGeneral",
                            "text_content": "The charging functions specified for the 5G data connectivity charging:\n-\tPDU session in SMF, refer to TS 23.501 [200];\n-\tservice data flows, within PDU session, refer to TS 23.503 [202].\n-\tQoS flows within PDU session refer to TS 23.501 [200] and TS 23.503 [202].\n-\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2\tRequirements",
                            "text_content": "The following are high-level charging requirements specific to the packet domain, derived from the requirements in TS 22.115 [101], TS 22.261 [102], TS 23.501 [200], TS 23.502 [201], TS 23.503 [202] and TS 23.247 [204].\n-\tThe SMF shall support converged online and offline charging.\n-\tThe SMF may support offline only charging.\n-\tThe SMF shall support PDU session charging using service based interface.\n-\tThe SMF shall support network slice instance charging.\n-\tThe SMF shall collect charging information per PDU session for UEs served under 3GPP access and non-3GPP access (untrusted non-3GPP access, trusted non-3GPP access and wireline).\n-\tEvery PDU session shall be assigned a unique identity number for billing purposes per PLMN. (i.e. the Charging Id).\n-\tData volumes on both the uplink and downlink directions shall be counted separately. The data volumes shall reflect the data as delivered to and forwarded from the user.\n-\tThe charging mechanisms shall provide the date and time information when the PDU session starts.\n-\tThe SMF shall be capable of handling the Charging Characteristics. Charging Characteristics can be specific to a subscription or subscribed DNN.\n-\tThe SMF may be capable of identifying data volumes, elapsed time or events for individual service data flows (flow based charging). One PCC rule identifies one service data flow.\n-\tSMF shall allow reporting of the service or the detected application usage per rating group or per combination of the rating group and service id. This reporting level can be activated per PCC rule.\n-\tThe quota management shall be per rating group per PDU session.\n-\tIf there are multiple UPFs for one PDU session, the quota management may be one for all UPFs or separate per UPF and the usage and charging information reporting per UPF.\n-\tThe SMF shall support charging for PDU Session types of IP, Ethernet and Unstructured.\n-\tIn Home Routed scenario, the SMF shall collect charging information per PDU session and, based on Home Operator policy and agreement between Home and Visit Operators, shall be able to collect charging information per Qos Flow for in-bound and out-bound roamers in Home Routed scenario.\n-\tIn Local breakout scenarios, the SMF in VPLMN shall collect charging information per QoS flow and, based on Visited Operator policy and agreement between Home and Visit Operator, may be able to collect charging information per service data flow for roamers in the LBO scenario.\n-\tFor interworking between 5GS and EPC, the dedicated PGW-C + SMF shall collect charging information using the same mechanisms as the SMF.\n-\tThe SMF shall support PDU session charging when the PDU session is served by both I-SMF and SMF.\n-\tThe SMF shall support charging for MA PDU Connectivity Service over 3GPP access and non-3GPP access.\n-\tThe SMF in VPLMN and in HPLMN shall support charging for MA PDU Connectivity Service in roaming Home Routed scenario with UE registered to the same VPLMN for 3GPP access and non-3GPP access.\n-\tThe SMF in HPLMN shall support charging for MA PDU Connectivity Service in roaming Home Routed scenario with UE registered in different PLMNs.\n-\tThe SMF shall support the charging of redundant transmission for high reliability communication.\n-\tThe SMF shall support the charging of 5G LAN VN group communication.\n-\tThe SMF shall support the charging of 5GS CIoT.\n-\tThe SMF may support the charging of time sensitive communication traffic.\n-\tThe SMF may support the IMS data channel volume-based charging.\n-\n-\tThe SMF may support PDU session charging of 5G multicast services.\n-\tThe SMF may support the charging of 5GS satellite backhaul.\n-\tThe SMF may support the converged charging for NPN. -\n-\tThe SMF may support the charging of 5GS satellite access.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.3\tCharging information",
                            "text_content": "Charging information in the 5GC domain network is collected for each UE by the SMFs. PDU session charging allows the SMF to collect and categorize per UE per UPF per PDU session, charging information related to data volumes.\nThe SMF shall collect the following charging information for converged online and offline charging:\n-\tusage of the access and core network resources: the charging information shall describe the amount of data delivered to and forwarded from the UE;\n-\tusage duration: duration of PDU session is counted as the time interval from PDU session establishment to PDU session release;\n-\tuser: the charging information shall provide the actual UE addresses used by the user for the PDU session;\n-\tdata network: the charging information shall describe the data network addresses with a level of accuracy as determined by the DNN;\n-\tusage of the external data networks: the charging information shall describe the amount of data sent and received to and from the external data network. External networks can be identified by the DNN;\n-\tstart time: identifying the time when the PDU session was started;\n-\tuser location: HPLMN, VPLMN, inside/outside presence reporting area, plus optional higher-accuracy location information.\nThe service data flows categorization is achieved by rating group or combination of the rating group and service id: i.e. based on the level of reporting defined per PCC rule, counting per rating group or combination of the rating group and service id. According to TS 23.503 [202], flow based charging shall support different charging models per PCC rule. These charging models may be based on volume, time and/or on number of events matching a specific service data flow template in PCC rule.\nFor service data flows defined for FBC, the SMF shall collect the following charging information:\n-\tthe information described above for PDU session;\n-\tthe amount of data transmitted in uplink and downlink directions categorized by rating group or combination of the rating group and service id when volume based charging applies;\n-\tthe duration of service data flows is counted and categorized by rating group or combination of the rating group and service id when time based charging applies;\n-\tthe number of events and corresponding time stamps categorized by rating group or combination of the rating group and service id when event based charging applies.\nWithin the PDU session the SMF shall collect the charging information for service data flows per UPF, categorized by rating group or combination of the rating group and service id.\nWithin the PDU session for local traffic offload scenarios with I-SMF insertion, the SMF shall collect the charging information for service data flows per I-SMF and categorized by rating group or combination of the rating group and service id.\nEditor's note:\tTo have I-UPF as well as PSA2 UPF for the I-SMF controlled UPF is FFS.\nThe user can be identified by a Generic Public Subscription Identifier (GPSI) and/or a 5G Subscription Permanent Identifier (SUPI). For wireline access, SUPI may be used to identify subscriber via wireline network as specified in clause 5.9.2 of TS 23.501 [200].\nFor the multicast communication, the SMF may collect following charging information.\n-\tThe duration of time from UE joining to UE leaving multicast MBS session;\n-\tThe duration of time using 5GC shared MBS traffic delivery method, and/or the duration of time using 5GC individual MBS traffic delivery method;\n-\tThe amount of multicast data transferred to UE via per-UE PDU sessions using 5GC individual MBS traffic delivery method. The SMF shall include the information of usage of per-UE PDU session for a 5GC individual MBS traffic delivery in charging information towards CHF.\nSMF may report above charging information to CHF for the following cases.\n-\tUE joining multicast MBS session.\n-\tUE leaving multicast MBS session.\nFor the interaction between CHFs (UE CHF and Tenant CHF), the SMF may support to collect and report the charging information per UE per PDU session based on S-NSSAI and DNN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.4\tCharging Identifier",
                            "text_content": "Charging identifier is created to allow correlation of charging information.\nFor the SMF the charging identifier is assigned per PDU session including the case of I-SMF insertion. At each PDU session establishment, i.e. , assignment of a new PDU session id, a new PDU session specific Charging Identifier is generated at the first SMF that processes the PDU session initiating request. The Charging Identifier shall be unique within the SMF (that means that the charging identifier is unique within the SMF set if SMF set is used) which assigned it and is then used in all subsequent messages for that PDU session. The Charging Identifier shall be used throughout the PDU session’s lifetime once assigned. In case of inter-system changes or handovers of PDU session, the Charging Identifier is preserved while the PDU session Identifier is preserved.\nFor EPS handover 5GS in Home routed scenario, the Charging Identifier for the EPS PDN connection will be generated by PGW-C+SMF in HPLMN and transferred to the SMF in VPLMN, if the V-SMF has already generated the Charging Identifier, the value shall be replaced by a home provided Charging Identifier generated by H-SMF.\nFor 5GS interworking with EPS, an EPS bearer Charging Identifier is assigned by the PGW-C+SMF to each dedicated EPS bearer The EPS default bearer Charging Identifier is the Charging Identifier  assigned to the default bearer of PDU connection.\nFor mobility from HPLMN with I-SMF to VPLMN in Home routed scenario, the charging identifier for the PDU session will be generated by SMF in HPLMN and transferred to the SMF in VPLMN, if the V-SMF has already generated a Charging Identifier, the value shall be replaced by a home provided Charging Identifier generated by H-SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.5\tPCC rules and charging",
                            "text_content": "PCC rules can be activated, deactivated and modified at any time during the PDU session lifetime. The following attribute can be modified by the PCF in a dynamic PCC rule active in the SMF: Charging key, Service identifier, Sponsor Identifier, Application Service Provider Identifier, Measurement method and reporting level. The QoS Flow binding mechanism employed by the SMF upon operations on PCC rules, may result in QoS Flows establishment, modification, or release. This is specified in TS 23.503 [202].\nActivities on PCC rules  are not chargeable events. However, change of charging rule in PCC rules will lead to chargeable events \"start of service data flow\" and when this is the last service data flow for the original PCC rule, \"termination of service data flow\".\nThe charging key (i.e. Rating group) is a piece of information used to request online charging quotas as defined in TS 23.503 [202].\nThe capability of SMF to support Application Based Charging is achieved with appropriate PCC rules activation in the SMF. Such PCC Rule shall be defined with service data flow template including an Application Identifier for the application which needs to be detected, enforced and charged. Application detection mechanism in SMF is defined in TS 23.503 [202].\nAs specified with PCC Rule definition in clause 6.3.1 TS 23.503 [202], during MA PDU session handling by the SMF, PCC Rules can be activated with a MA PDU session control information attribute including an optional rating group for Non-3GPP access, in addition to the rating group included in the PCC rule description.\nWhen the MA PDU session control information in a PCC Rule includes a separate rating group for Non-3GPP access, it shall be used by the SMF for the SDF traffic carried via non-3GPP access. The PCC Rule rating group shall be used for the SDF traffic carried via 3GPP access, and all other charging related attributes in the PCC rule shall be the used for both accesses.\nWhen the MA PDU session control information in a PCC Rule does not include any  rating group for Non-3GPP access, the PCC Rule rating group shall be used by the SMF for the SDF traffic carried via both accesses (i.e. 3GPP access and non-3GPP access).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.6\tSession and Service Continuity modes",
                            "text_content": "For any scenario of SSC modes specified in TS 23.501 [200], one Charging Identifier shall correspond to a single PDU session ID.\nAs a  result, from such SSC mode, a new Charging Identifier is generated by the SMF for the new PDU session Id, and the charging session associated to the old PDU session Id is released.\nThis behaviour applies to the following scenario:\n-\t PDU session anchor UPF relocation, in SSC mode 2;\n-\t PDU session anchor UPF relocation in SSC mode 3 with multiple PDU Sessions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.7\tUE Presence in Presence Reporting Area (PRA)",
                            "text_content": "During charging session lifetime, the CHF may provide the Presence Reporting Area identifier to be activated for Core Network pre-configured Presence Reporting Area(s) and additionally all of PRA Identifier(s) and list(s) of its elements for UE-dedicated Presence Reporting Area(s) and provision the \"Change of UE presence in Presence Reporting Area(s)\" trigger to the SMF to request the reporting of Change of UE presence in Presence Reporting Area. After such trigger is enabled, SMF shall close the current count, open a new count with the initial status of UE presence in the PRA(s). In case of quota management is required, a Charging Data Response [Update] including the initial status is sent. UE presence status in the PRA(s) describes whether the UE is entering or leaving Presence Reporting Area (s) and if the corresponding Presence Reporting Area(s) is set to inactive by the serving node.\nThe CHF may modify the list of PRA Identifier(s) by providing the new Presence Reporting Area(s) or by removing existing Presence Reporting Area(s) or modify the list(s) of Presence Reporting Area elements by providing the updated Presence Reporting Area.\nThe CHF may remove the trigger of change of UE presence in Presence Reporting Area as defined in subclause 5.2.1.2, if previously activated.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.8\tCHF selection",
                            "text_content": "The CHF selection by the SMF is done at the PDU session establishment, this selection shall be based on the following and with this priority order (highest to lowest):\n-\tCHF address(es) with possible associated CHF instance ID(s) and/or CHF set ID(s) provided by the PCF for the PDU session.\n-\tUDM provided charging characteristics.\n-\tNRF based discovery.\n-\tSMF locally provisioned charging characteristics.\nThis means that if there are PCF provided CHF address(es) with possible associated CHF instance ID(s) and/or CHF set ID(s) these shall be used, otherwise if the UDM provides charging characteristics these shall be used. If neither of these results in CHF address(es) the NRF can be used to discover CHF instance(s) possibly within a CHF set, and as a last resource the SMF locally provisioned charging characteristics shall be used.\nWhen NRF is used for the CHF selection, and the PDU session charging method indicates \"offline only\" for the PDU session, CHF instance(s) supporting CHF \"offline only\" service instances may be selected.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.9\tRoaming",
                            "text_content": "In home routed scenario, based on roaming agreements between the V-PLMN and the H-PLMN, for each UE roaming in VPLMN:\n-\tThe SMF in VPLMN (V-SMF) shall be able to collect charging information per QoS Flow within a PDU session when UE is determined as an in-bound roamer, for CDR generation in VPLMN.\n-\tThe SMF in HPLMN (H-SMF) shall be able to collect charging information per QoS Flow within a PDU session when UE is determined as an out-bound roamer, for CDR generation in HPLMN.\nIn home routed scenario, this charging information collection mechanism is achieved under Roaming QoS flow Based Charging (QBC) performed by each PLMN, based on a set of charging parameters exchanged between the V-SMF and the H-SMF on a per PDU session basis.\nIn home routed scenario, the main parameters exchanged at PDU session establishment are:\n-\tThe Charging Identifier assigned by the V-SMF and transferred to the H-SMF in the HPLMN.\n-\tOptionally, for QBC, the \"Roaming Charging Profile\" negotiated between the VPLMN and the HPLMN.\nIn home routed scenario, the parameters exchanged during the PDU session handover from EPS to 5GS:\n-\tThe home provided Charging Identifier which includes the Charging Identifier assigned by the H-SMF to the original PDU session over EPS and transferred by the H-SMF to the V-SMF. This home provided Charging Identifier shall be used by the V-SMF to replace the existing Charging Identifier previously generated by V-SMF.\n-\tOptionally, for QBC, the \"Roaming Charging Profile\" negotiated between the VPLMN and the HPLMN on 5GS side.\nIn roaming home routed PDU session, upon V-SMF change:\n-\tintra-PLMN V-SMF change: Charging Identifier, \"Roaming Charging Profile\" and optionally CHF address are transferred from the old V-SMF to the new V-SMF.\nNOTE: How the new V-SMF selects the V-CHF is operator specific.\n-\tinter-PLMN V-SMF change: Charging Identifier is transferred from the old V-SMF to the new V-SMF.\n-\tThe \"Roaming Charging Profile\" is optionally exchanged between the new V-SMF and the H-SMF as for a PDU session establishment.\nIn roaming home routed PDU session, when a UE moves from HPLMN with I-SMF insertion to a VPLMN:\n-\tThe home provided Charging Identifier assigned by the H-SMF to the original PDU session and transferred by the H-SMF to the V-SMF. This home provided Charging Identifier shall be used by the V-SMF to replace the existing Charging Identifier previously generated by V-SMF.\n-\tOptionally, for QBC, the \"Roaming Charging Profile\" negotiated between the VPLMN and the HPLMN.\nIn local breakout scenario, based on roaming agreements between the V-PLMN and the H-PLMN, for each UE roaming in VPLMN:\n-\tThe SMF in VPLMN (V-SMF) shall be able to collect charging information within a PDU session when UE is determined as a roamer:\n-\tper QoS flow for CDR generation by V-CHF in VPLMN and CDR generation by H-CHF in HPLMN;\n-\tper service data flow for converged charging, based on PCC rules from V-PCF which uses locally configured policies according to the roaming agreement with the HPLMN operator, when applicable:\n-\twith or without quota management to H-CHF in HPLMN;\n-\twithout quota management to V-CHF in VPLMN.\n-\tThe SMF in VPLMN (V-SMF) shall be able to determine applicable combinations based on operator policy.\nIn local breakout scenario, the main parameters exchanged at PDU session establishment are:\n-\tThe Charging Identifier assigned by the V-SMF and reported to the V-CHF and H-CHF.\n-\tOptionally, for QBC, the \"Roaming Charging Profile\" is used for the set of triggers, associated category, and trigger thresholds and negotiated between the VPLMN and the HPLMN\nV-CHF selection by the V-SMF, home routed and local breakout scenario at PDU session establishment or inter-PLMN V-SMF change, is based on the following and with this priority order (highest to lowest):\n-\tNRF based discovery, can be based on that the UE is an inbound roamer i.e., HPLMN of the UE.\n-\tV-SMF locally provisioned charging characteristics.\nV-CHF selection by the V-SMF, home routed and local breakout scenario at intra-PLMN V-SMF change, is based on the following and with this priority order (highest to lowest):\n-\told V-SMF supplied V-CHF address\nH-CHF selection by the H-SMF, home routed scenario, follows the CHF selection in clause 5.1.8.\nH-CHF selection by the V-SMF, local breakout scenario, is based on the following and with this priority order (highest to lowest):\n-\tNRF based discovery, can be based on HPLMN of the UE.\n-\tV-SMF locally provisioned charging characteristics.\n\nIn local breakout scenario with architecture in Figure 4.2.x, the V-CHF may select H-CHF based on the following and with this priority order (highest to lowest):\n-\tNRF based discovery.\n-\tV-CHF locally provisioned address(es).\nThe interaction between two CHFs in LBO roaming, e.g. V-CHF and H-CHF, H-CHF and A-CHF, is via the Nchf_ConvergedCharging service API.\nThe charging session between V-CHF and H-CHF is per PDU session, the charging sessions between V-SMF and V-CHF are synchronized with the V-CHF and H-CHF.\nV-CHF generate the charging information to H-CHF based on the charging information received from V-SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.10\tData Volume Reporting for Secondary RAT usage",
                            "text_content": "Volume reporting for Secondary RAT usage is an optional capability in the SMF that provides usage reporting functionality when a Secondary RAT is used by NG-RAN. Use of Secondary RAT refers to options supported by NG-RAN with dual radio accesses, per NG-RAN definition in TS 23.501 [200]. This is valid for both HPLMN and VPLMN.\nThe following principles are used:\n-\tThe reporting of Secondary RAT Data Volume is controlled by the NG-RAN.\n-\tThe uplink and downlink data volumes for the Secondary RAT are reported (from NG-RAN to 5G Core) on a per QoS Flow basis and per time interval (controlled by NG-RAN). The report contains Secondary RAT (e.g. E-UTRA) resources used for transport of user data and indicated separately for uplink and downlink per QoS Flow and per time interval. The time interval used for the measurements reported (from NG-RAN) may be partitioned to indicate usage that occurred before respectively after an absolute time (that occurs while measurement for secondary RAT usage report is ongoing).\n-\tThe reporting (performed by NG-RAN) in association with UE-related control signaling and via standalone reporting is internally triggered by NG-RAN.\nNOTE: Volumes for the secondary RAT are reported to the CHF in addition to, and uncorrelated from volumes of reported usage, which are undifferentiated between primary and secondary RAT. Considering both volumes would imply the same traffic to be counted twice.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.11\tCharging method and Charging service selection",
                            "text_content": "A PDU session charging method indicating \"offline only\", can be assigned to a PDU session, to indicate a charging method applicable at PDU session level.\nWhen there is no PDU session charging method indicating \"offline only\" associated to a PDU session, for each PCC Rule:\n-\tif indicated for this PCC Rule, the required charging method applies;\n-\totherwise (i.e. no required charging method is indicated for this PCC Rule), the default charging method applies.\nIn this case, the converged charging service will be invoked by the SMF at the PDU session establishment.\nWhen a PDU session charging method indicates \"offline only\" for a PDU session, offline charging method applies to all the PCC Rules activated during the PDU session. In this case, at the PDU session establishment, the SMF can select between the converged charging service or the offline only charging service based on Operator policy.\nThis PDU session charging method can be received from PCF by the SMF or configured in the SMF charging characteristics.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.12\tEmergency PDU session handling",
                            "text_content": "Volume reporting for Emergency PDU Sessions is a capability in the SMF that provides usage reporting functionality when a session is setup to provide emergency services.\nThe following principles are used:\n-\tThe reporting of Emergency PDU sessions is controlled by the SMF.\n-\tThe uplink and downlink data volumes for Emergency PDU Session are reported.\n-\tIt includes either or both of an unauthenticated SUPI and a PEI (especially applicable in the case where there is a UE without a UICC).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.13\tSupport of deployments topologies with specific SMF Service Areas",
                            "text_content": "Depending on scenario, a PDU Session in non-roaming case is either served by a single SMF or served by an SMF and an I-SMF, specified in the clause 5.34 of TS 23.501 [200].When a PDU Session is served by both an SMF and an I-SMF, the SMF is the NF Consumer that has the interfaces towards CHF for I-SMF for the case of an I-SMF insertion, relocation or removal.\nFor the following case with the I-SMF involved, the SMF shall collect the charging information and report to CHF:\n-\tPDU session establishment, modification and release;\n-\tPDU Session message flows for N2 based handover procedure, with I-SMF insertion/change/removal;\n-\tPDU Session message flows for Xn based handover procedure, with I-SMF insertion/change/removal;\n-\tPDU Session message flows for Service Request, with I-SMF insertion/change/removal\n-\tbranching point or UL CL controlled by I-SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.14\tUltra Reliable Low Latency Communication",
                            "text_content": "The enhancement of the 5GS to support Ultra Reliable Low Latency Communication (URLLC) is specified in the clause 5.33 of TS 23.501 [200]. For the redundant transmission for high reliability communication, the SMF shall collect the charging information for redundant transmission and report to CHF for the following cases.\n-\tDual Connectivity based end to end Redundant User Plane Paths;\n-\tRedundant transmission on N3/N9 interfaces;\n-\tRedundant transmission at transport layer.\nThe SMF reports the redundant transmission type to the CHF to indicate which redundant transmission type is used for the PDU session or service data flow.\nFor dual connectivity based end to end Redundant User Plane Paths, the charging information is collected independently per each redundant PDU session. The quota is granted for each redundant PDU session independently. The SMF reports the usage per redundant PDU session.\n\nFor the QoS Monitoring to Assist URLLC Service, the SMF may report the packet delay measurement per QoS Flow per UE to CHF.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.15\t5G LAN-type Service Communication",
                            "text_content": "The SMF may support PDU Sessions for a 5G VN group which offers a virtual data network capable of supporting 5G LAN-type service over the 5G system, which specified in the TS 23.501[200].\nThe SMF embedding the CTF generates 5G VN group communication charging information towards the CHF based on the user plane architecture with the additional following options decribed in the clause 4.4.6 of TS 23.501[200] to support 5G LAN-type service.\n-\tFigure 4.4.6.1-1 depicts the non-roaming user plane architecture to support 5G LAN-type service using local switch.\n-\tFigure 4.4.6.1-2 depicts the non-roaming user plane architecture to support 5G LAN-type service using N19 tunnel.\n-\tFigure 4.1.1 depicts the non-roaming user plane architecture to support 5G LAN-type service using N6 tunnel.\nIn order to support the 5G VN group communication, the following principles are used:\n-\tIn includes the internal group identifier of 5G VN group, which is used to indicate the 5G VN group and associate charging information for 5G VN group communication.\n-\tThe uplink and downlink data volumes of 5G VN group communiucation traffic usage are reported separately.\n-\tThe 5G VN group communication using N19 tunnel is measured based on the PDU session charging.\n-\tSMF may report the traffic forwarding way information corresponding to the 5G VN group communication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.16\tSupport of Cellular IoT",
                            "text_content": "The 5GS support for Cellular IoT (CIoT) is specified in TS 23.501 [200], this includes EPC interworking and home-routed roaming. In legacy networks Cellular IoT may be referred to as Machine Type Communications (MTC).\nDuring the PDU session establishment (initial charging request) the SMF may provide the following charging information related to 5GS CIoT:\n-\tThe indication of Control Plane 5GS CIoT optimization.\n-\tSmall data rate control indication.\n-\tThe RAT types (NB-IoT or LTE-M).\n-\tThe control plane only indication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.17\tApplication based charging",
                            "text_content": "If reporting on applications (e.g., edge application) is required, it’s recommended to assign each application with its own service id and it also may provide the Application ID.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.18\tIMS data channel volume-based charging",
                            "text_content": "IMS architecture enhancements to support data channel services are described in annex AC of TS 23.228 [600]. In order to support IMS data channel, data volume of data channel services need to be identified for charging purposes. SMF may collect the charging information and report to CHF:\n-\tRelevant charging information of IMS data channel services, e.g. QoS support, identifier of caller and callee, supported via N7 interface.\nNOTE:\tCaller and the callee information is already supported via N7 interface in clause 5.6.2 of TS 29.512 [601].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.19\tNPN Data Connectivity Charging",
                            "text_content": "A Non-Public Network (NPN) is a 5GS deployed for non-public use, see TS 22.261 [102], which is either:\n-\ta Stand-alone Non-Public Network (SNPN), i.e. operated by an NPN operator and not relying on network functions provided by a PLMN, as specified in the TS 23.501 [200] clause 5.30.2; or\n-\ta Public Network Integrated NPN (PNI-NPN), i.e. a non-public network deployed with the support of a PLMN. as specified in the TS 23.501 [200] clause 5.30.3.\nIn order to support the SNPN data connectivity charging, the following charging principles are used.\nFor UE accessing network belong to SNPN operator, SMF in the SNPN reports the charging information contains SNPN ID (PLMN ID and NID identifying an SNPN) to the CHF in the SNPN.\nFor UE accessing the SNPN service via PLMN,\n-\tSMF in SNPN reports the charging information per UE, which contains access type (\"Non-3GPP access\") to the CHF belongs to the same SNPN, using PLMN ID and NID to identify the SNPN.\n-\tSMF in PLMN reports the charging information per SNPN.\nFor UE accessing the PLMN service via SNPN,\n-\tSMF in the PLMN reports the charging information per UE.\n-\tSMF in the SNPN reports the charging information per PLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.20\tSupport of Satellite Backhaul charging",
                            "text_content": "The 5GS support for Satellite Backhaul is specified in TS 23.501 [200].\nThe SMF embedding the CTF generates the following charging information related to the satellite backhaul towards the CHF:\n-\tSatellite Backhaul Information\n-\tSatellite Backhaul Category\nFor the Edge Computing and SCC-to-SCC communications via satellite backhaul with UPF deployed on the satellite, the SMF may collect the following charging information and report to CHF:\n-\tSatellite Backhaul Information\n-\tGEO Satellite Backhaul Category\n-\tGEO Satellite ID.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.2\t5G data connectivity converged online and offline charging scenarios",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tBasic principles",
                            "text_content": "Converged charging may be performed by the SMF interacting with CHF using Nchf specified in TS 32.290 [57] and TS 32.291 [58]. In order to provide the data required for the management activities outlined in TS 32.240 [1] (Credit-Control, accounting, billing, statistics etc.), the SMF shall be able to perform converged charging for each of the following:\n-\tCharging data related to PDU session;\n-\tCharging data related to service data flows within the PDU session.\nConverged charging includes quota management and usage reporting.\nThe SMF shall be able to report charging events to CDF for CDR generation.\nThe SMF shall be able to perform convergent charging by interacting with CHF, for charging data related to PDU sessions. The Charging Data Request and Charging Data Response are exchanged between the SMF and the CHF, based on SCUR scenarios specified in TS 32.290 [57]. The Charging Data Request is issued by the SMF towards the CHF when certain conditions (chargeable events) are met.\nThe quota management is always per rating group, reporting level can be either per rating group or per combination of the rating group and service id, which is defined per PCC rule.\nConverged charging uses centralized or decentralized unit determination and centralized rating scenarios for session based convergent charging specified in TS 32.290 [57].\nThe charging information collected per PDU session includes the network slice instance the PDU session belongs to.\nThe contents and purpose of each charging event that triggers interaction with CHF, as well as the chargeable events that trigger them, are described in the following sub-clauses.\nThe SMF initiates a charging session with Charging Data Request/Response [Initial], updates the charging session with Charging Data Request/Response [Update], and terminates the charging session with Charging Data Request/Response [Termination].\nA detailed formal description of the converged charging parameters defined in the present document is to be found in TS 32.291 [58].\nA detailed formal description of the CDR parameters defined in the present document is to be found in TS 32.298 [51].\nIn order to avoid a charging session remaining inactive for a long period of time, upon expiry of the Unit Count Inactivity Timer, the charging session may be terminated by the SMF sending Charging Data Request [Termination], indicating the PDU session shall continue and the CHF can expect a later Charging Data Request [Initial] request for the same PDU session with the original Charging Identifier and new session identifier. The SMF may send its locally configured value of the Unit Count Inactivity Timer to the CHF. The CHF may respond with a new Unit Count Inactivity Timer for use in the SMF. Whether the CHF may respond with a value of the Unit Count Inactivity Timer, independent of if the CHF has received one previously from the SMF, is vendor specific\nWhen a charging event is issued towards the CHF, it includes details such as Subscriber identifier (e.g. SUPI), Charging-id, etc. and also containers identifying the volume count (separated for uplink and downlink traffic), with charging condition change information.\nEach trigger condition (i.e. chargeable event) defined for the 5G data connectivity converged charging functionality with the associated behaviours when metis specified in this document  and the basic trigger mechanism is specified in the TS 32.290[57].\nTwo categories of chargeable events are identified:\n-\timmediate report: chargeable events for which, when occurring, the current counts are closed and sent together with the charging data generated by the SMF towards the CHF in a Charging Data Request. New counts are started by the SMF.\n-\tdeferred report: chargeable events for which, when occurring, the current counts are closed and stored together with the charging data generated by the SMF. The stored counts will be sent to the CHF in next a Charging Data Request. New counts are started by the SMF.\nWhen more than one trigger condition to be met at same time (i.e. time stamp of triggers is the same) for the same count in the SMF, the SMF reports the used unit container with these triggers.\nWhen a PDU session starts, and the converged charging is activated, the SMF invokes a Charging Data Request [Initial] towards the CHF to get authorization to start based on the default triggers. The SMF is optionally provided in a Charging Data Response [Initial] to override the default triggers, with a set of chargeable event triggers to be enabled, and the associated category (i.e. immediate or deferred report).\nThe triggers remain active until they are updated or disabled by subsequent Charging Data Response [Update] from the CHF or the PDU session is terminated.\nA set of chargeable events are based on trigger thresholds and default ones can be configured in Charging Characteristics which are described in Annex A.\nThe SMF is optionally provided in the Charging Data Response [Initial], with trigger thresholds which override the default ones configured in the Charging Characteristics selected by the SMF for the PDU session. They remain active until they are updated by subsequent Charging Data Response [Update] from the CHF or the PDU session is terminated.\nWhen a trigger is enabled, the SMF needs to ensure that monitoring in UPF and subscription from RAN are setup so that SMF can report the charging information to the CHF if the chargeable event occurs.\nThe set of chargeable events and associated category, which shall be supported by the SMF as the default, is specified in the sub-clause 5.2.1.4 for Flow Based Charging.\nTwo level of triggers can be supplied by the CHF:\n-\tTriggers associated to the PDU session.\n-\tTriggers associated to a rating group within the PDU session.\nThe set of triggers along with their category (i.e. immediate or deferred report) and level (i.e. per PDU session or per rating group), which can be supplied by the CHF to the SMF for 5G data connectivity converged charging or offline only charging are detailed in the sub-clause 5.2.1.4 for Flow Based Charging.\nThe set of chargeable events and associated category, which shall be supported by the SMF as the default for QoS flow Based Charging, when applicable, is specified in the sub-clause 5.2.1.6.\nTwo level of triggers can be supplied by the CHF:\n-\tTriggers associated to the PDU session.\n-\tTriggers associated to a QoS Flow within the PDU session.\nThe set of triggers along with their category (i.e. immediate or deferred report) and level (i.e. per PDU session or per QoS Flow), which can be supplied by the CHF to the SMF for 5G data connectivity converged charging are detailed in clause 5.2.1.6 for QBC. QBC triggers is common for all QFIs in the PDU session, and applies individually for each QFI.\nWhen QBC is used in the context of roaming, the set of triggers, their associated category, and trigger thresholds, compose the \"Roaming Charging Profile\", which governs the SMF charging data generation, synchronously between the VPLMN and the HPLMN when shared. A default Roaming QoS flow Based charging (QBC) triggers may be configured in the V-SMF.\nThe \"Roaming Charging Profile\" is specified in the clause 5.2.1.7.\nIn local breakout scenario, the default \"Roaming charging profile\" for the V-SMF is based on the “Charging characteristics”, and may be set, changed, applied, and transferred in the following order:\n1.\tDefault set by V-SMF and transferred to V-CHF\n2.\tChanged by V-CHF and transferred to V-SMF\n3. \tTransferred from V-SMF to H-CHF\n4.\tChanged by H-CHF and transferred to V-SMF\n5.\tApplied in V-SMF and transferred to V-CHF\nIn local breakout scenario, the default \"Roaming charging profile\" for the V-SMF connected to V-CHF and V-CHF connected to H-CHF, is based on the “Charging characteristics”, and may be set, changed, applied, and transferred in the following order:\n1.\tDefault set by V-SMF and transferred to V-CHF\n2.\tChanged by V-CHF and transferred to H-CHF\n3.\tChanged by H-CHF and transferred to V-CHF\n4. \tValidated by V-CHF and transferred to V-SMF\n5.\tApplied in V-SMF\n\nConverged charging allows the SMF to collect charging information related to data volumes sent to and received by the UE/MS per user per PDU session. The user can be identified by SUPI.\nIf PDU session specific converged charging is supported, this is achieved by FBC charging, with specific rating group/service identifier, see clause 5.2.1.4.\nFor FBC charging, the SMF categorizes the service data flows within PDU session data traffic by rating group and / or combination of the rating group and service id. The level of the reporting and charging method is defined per PCC rule. Details of this functionality are specified in TS 23.503 [202] and TS 32.240 [1].\nThe SMF can include the QoS Information per rating group or per combination of rating group/service id. If the QoS Information cannot be unambiguously determined per rating group or per combination of rating group/service id, it should be omitted.\nNOTE:\tThe SMF can only include one QoS Information occurrence per combination of rating group/service id. This implies if an operator wishes to be able to separate usage according to 5QI and ARP for the same charging method, they will need to ensure that service data flows having different 5QI and ARP do not have the same:\n-\trating group in cases where rating reporting is used;\n-\trating group/service id where rating group/service id reporting is used.\nWhen a service data flow is governed by a PCC Rule indicated with \"Online\" charging method, quota management is required for the service data flow. It may also indicate if authorization for the service data flow is needed or not before service delivery, i.e. blocking or non-blocking mode.\nWhen a service data flow is governed by a PCC Rule indicated with \"Offline\" charging method, quota management is not required for this service data flow. Usage reporting is required for this service data flow without affecting the delivery.\nAccording to TS 23.503 [202], FBC shall support different charging models per PCC rule. These charging models may be based on volume and/or time and on number of events matching a specific service data flow template in PCC rule. When a chargeable event occurs for which quota needs to be requested by the SMF to the CHF, the type of requested quota may depend on measurement method configured for the PCC rule.\nIn general, the charging of a service data flow shall be linked to the PDU session under which the service data flow has been activated.\nThe amount of data counted shall be the user plane payload at the UPF separated between UL and DL.\nFor PDU session specific charging, time metering shall start when PDU session is activated.\nTable 5.2.1.4.1 summarizes the set of default trigger conditions and their category which shall be supported by the SMF. For \"immediate report\" category, the table also provides the corresponding Charging Data Request [Initial, Update, Termination] message sent from SMF towards the CHF.\nTable 5.2.1.4.1: Default Trigger conditions in SMF\n\nThe default \"Limit\" trigger conditions are trigger thresholds configured in the Charging Characteristics applied to the PDU session. It shall be possible for the CHF to override these default triggers when providing Charging Data Response [Initial], either to disable the triggers, or to enable triggers new thresholds value.\nWhen the traffic is counted in more than one UPF, the CHF overrides these default triggers of volume limit for the all UPFs.\nFor converged charging, the following details of chargeable events and corresponding actions in the SMF are defined in Table 5.2.1.4.2:\nTable 5.2.1.4.2: Chargeable events and their related actions in SMF\n\nWhen event based charging applies, the first occurrence of an event matching a service data flow template in PCC rule shall be considered as the start of a service.\nHow the termination of service data flows is detected, is specified in TS 23.503 [202]. Termination of the service data flow itself does not trigger Charging Data Request [Update].\nThe CDR generation mechanism processed by the CHF upon receiving Charging Data Request [Initial, Update, Termination] issued by the SMF for these chargeable events, is specified in clause 5.2.3.\n\nThere are two cases related to quota management when the granted quota is volume for multiple UPFs and per Operator's policy, the traffic is counted in more than one UPF:\n-\tQuota shared by UPFs means that SMF manages the shared quota consumption per RG for multiple UPFs and reports the total quota consumed to CHF;\n-\tQuota granted for each UPF means that the CHF manages the quota granted for each UPF and SMF manages and reports the quota consumption per UPF.\nFor configurations involving multiple UPFs and Operator's policy is to count the traffic in a single UPF (e.g. BP), the quota is granted to the SMF for this single UPF per RG for the whole traffic.\nThe following scenarios describe configurations in which the traffic is counted in more than one UPF:\nIn case of SSC mode 3 PDU Session Anchor with IPv6 Multi-homed PDU Session,\n-\tThe addition of UPF2 and BP (Change the part of traffic from UPF1 to UPF2):\n-\tif quota granted for each UPF, SMF triggers the chargeable event of Start of SDF for UPF2 to request the quota;\n-\tif quota shared by UPFs, SMF requests UPF1 report usage of quota, caches the usage from UPF1 and re-allocates the remaining quota to UPF2 and UPF1(if needed). When the granted quota from CHF is used up, the SMF reports total usage of quota to CHF.\n-\tThe removal of UPF1and BP:\n-\tIn case the quota management and quota granted for each UPF, UPF1 reports final counts to SMF, SMF triggers the chargeable event of Remove the UPF to report final counts from UPF1;\n-\tIn case the quota management and quota shared by UPFs, UPF1 report final counts to SMF, SMF caches the final count from UPF1. SMF sends counts from UPF1 and UPF2 to the CHF together in next Charging Data Request.\n-\tIn case without the quota management or offline only charging, UPF1 report final count to SMF, SMF caches the final count from UPF1 and sends counts from UPF1 and UPF2 to the CHF together in next a Charging Data Request. In case of Addition of additional PDU Session Anchor and Branching Point or UL CL.\n-\tThe addition of UPF2 and BP (Change the part of traffic from UPF1 to UPF2):\n-\tif quota granted for each UPF, SMF triggers the chargeable event of Start of SDF for UPF2 to request the quota for Rating group;\n-\tif quota shared by UPFs, SMF indicates UPF1 report usage of quota, caches the usage from UPF1 and re-allocates the remain quota to UPF2 and UPF1(if needed). When the granted quota from CHF is used up, the SMF reports total usage of quota to CHF.\nIn case of Removal of additional PDU Session Anchor and Branching Point or UL CL:\n-\tThe removal of UPF1 and BP (Change traffic from UPF1 to UPF2):\n-\tIn case the quota management and quota granted for each UPF, UPF1 report final counts to SMF, SMF triggers chargeable event of Remove the UPF to report final counts from UPF1.\n-\tIn case the quota management and quota shared by UPFs, UPF1 report final counts to SMF, SMF caches the final count from UPF1 and re-allocates the remain quota to UPF2. SMF sends counts from UPF1 and UPF2 to the CHF together in next a Charging Data Request.\n-\tIn case without the quota management or offline only charging, UPF1 report final count to SMF, SMF caches the final count from UPF1 and sends counts from UPF1 and UPF2 to the CHF together in next a Charging Data Request. In case of Change of additional PDU Session Anchor for IPv6 multi-homing or UL CL and Simultaneous change of Branching Point or UL CL and additional PSA for a PDU Session.\n-\tThe additional of UPF2 (Change the part of traffic from UPF1 to UPF2):\n-\tif quota granted for each UPF, SMF triggers the chargeable event of Start of SDF for UPF2 to request the quota for Rating group;\n-\tif quota shared by UPFs, SMF indicates UPF1 report usage of quota, caches the usage from UPF1 and re-allocates the remain quota to UPF2 and UPF1(if needed). When the granted quota from CHF is used up, the SMF reports total usage of quota to CHF.\n-\tThe removal of UPF1:\n-\tIn case the quota management and quota granted for each UPF, UPF1 report final counts to SMF, SMF triggers chargeable event of Remove the UPF to report final counts from UPF1.\n-\tIn case the quota management and quota shared by UPFs, UPF1 report final counts to SMF, SMF caches the final count from UPF1 and re-allocates the remain quota to UPF2. SMF sends counts from UPF1 and UPF2 to the CHF together in next Charging Data Request.\n-\tIn case without the quota management or offline only charging, UPF1 report final count to SMF, SMF caches the final count from UPF1 and sends counts from UPF1 and UPF2 to the CHF together in next a Charging Data Request.\nQoS flow Based Charging allows the SMF to collect charging information related to data volumes per PDU session, categorized per QoS Flow. QBC doesn't support quota management.\nThe user can be identified by SUPI.\nFor a given PDU session, QBC shall be performed by the SMF within the same charging session used for Flow Based Charging. For the case where QBC is performed from SMF in VPLMN, Flow Based Charging is not applicable and there is no possibility to have quota management for the PDU Session. For the case where QBC is performed from SMF in HPLMN, FBC can be performed or not performed at the same time according to operator's policy.\nThe SMF categorizes the volume within PDU session by QoS Flow identified by QoS Flow Identifier (QFI).\nThe amount of data counted for the QoS Flow shall be the user plane payload at the UPF.\nTable 5.2.1.6.1 summarizes the set of default trigger conditions and their category which shall be supported by the SMF in QBC. For \"immediate report\" category, the table also provides the corresponding Charging Data Request [Initial, Update, Termination] message sent from SMF towards the CHF.\nTable 5.2.1.6.1: Default Chargeable events in SMF for QBC\n\nThe default \"Limit\" trigger conditions, are trigger thresholds configured in the Charging Characteristics applied to the PDU session for QBC. It shall be possible for the CHF to override these default triggers when providing Charging Data Response [Initial], either to disable the triggers, or to enable triggers new thresholds value.\nThe \"Limit\" trigger conditions applied to the QoS Flow level of QBC is common for all QFIs, and applies the limit for each QFI in the PDU session.\nFor QBC the following details of chargeable events and corresponding actions in the SMF are defined in Table 5.2.1.6.2:\nTable 5.2.1.6.2: Chargeable events and their related actions in SMF for QBC\n\nThe CDR generation mechanism processed by the CHF upon receiving Charging Data Request [Initial, Update, Termination] issued by the SMF for these chargeable events in QBC, is specified in clause 5.2.3.\nWhen QoS flow Based Charging specified in 5.2.1.6 is used in a context of roaming, a \"Roaming Charging Profile\" is defined to allow, when shared, QBC synchronized between both PLMNs and includes:\n-\tThe set of chargeable events as per Table 5.2.1.6.1 and associated category.\n-\tThe set of thresholds for chargeable events based on trigger thresholds.\n-\tAn indication on whether the \"Default partial record\" or the \"Individual partial record\" mechanism per clause 5.2.3, is used by CHF.\nA default \"Roaming Charging Profile\" is specified for the SMF and comprises:\n-\tThe set of chargeable events and associated category specified as the default per Table 5.2.1.6.1.\n-\tThe default set of thresholds configured in the Charging Characteristics for QBC.\n-\tThe \"Default partial record\" mechanism indicated as the one used by CHF.\nIn home routed scenario, during the PDU session establishment, the default \"Roaming charging profile\" for the V-SMF is based on the configuration and may be set, changed, applied, and transferred in the following order:\n1.\tDefault set by V-SMF and transferred to V-CHF\n2.\tChanged by V-CHF and transferred to V-SMF\n3. \tTransferred from V-SMF to H-SMF\n4. \tTransferred from H-SMF to H-CHF\n4.\tChanged by H-CHF and transferred to H-SMF\n5.\tTransferred from H-SMF to V-SMF\n6.\tApplied in V-SMF and transferred to V-CHF\nIn local breakout scenario, during the PDU session establishment, the default \"Roaming charging profile\" for the V-SMF is based on the configuration, and may be set, changed, applied, and transferred in the following order:\n1.\tDefault set by V-SMF and transferred to V-CHF\n2.\tChanged by V-CHF and transferred to V-SMF\n3. \tTransferred from V-SMF to H-CHF\n4.\tChanged by H-CHF and transferred to V-SMF\n5.\tApplied in V-SMF and transferred to V-CHF\nIn the VPLMN, at PDU session establishment or PDU session transfer from a different VPLMN, the default \"Roaming Charging Profile\" in the new V-SMF may optionally be overridden by a new \"Roaming Charging Profile\" supplied by the CHF in the Charging Data Response [Initial] with:\n-\tupdated set of chargeable events and associated category.\n-\tupdated thresholds for chargeable events based on trigger thresholds.\n-\tthe selected partial record mechanism (\"Default partial record\" or \"Individual partial record\").\nThis updated \"Roaming Charging Profile\" is transferred from the new V-SMF to the H-SMF and may be acknowledged or replaced by the HPLMN selected \"Roaming Charging Profile\" to be used by the new V-SMF.\nIn the HPLMN, at PDU session establishment or V-SMF change for a PDU session, the \"Roaming Charging Profile\", when received by the H-SMF from the new V-SMF, may be updated by the CHF in the HPLMN in the Charging Data Response [Initial] to H-SMF. This HPLMN CHF selected \"Roaming Charging Profile\" is used by the H-SMF and transferred towards the VPLMN.\nThe \"Roaming Charging Profile\" resulting from the exchange between the VPLMN and HPLMN at PDU session establishment may remain unchanged during the PDU session lifetime, unless there is a V-SMF change.\nAt each V-SMF change in Home routed scenario, the \"Roaming Charging Profile\" may be renegotiated between the VPLMN and HPLMN and  may remain unchanged during the PDU session lifetime with the actual V-SMF.\nRoaming charging profile may be changed during the PDU session lifetime if V-SMF includes the Roaming charging profile in the Charging Data Request. The updated Roaming Charging profile is valid until the next change.\nThe capability specified in clause 5.2.1.2.1 for the CHF to be able to update the triggers after the PDU session is established for a given VPLMN shall not be applicable for Roaming QBC.\nThe termination action applies only in case of online charging, i.e. quota management is active. It indicates the action, which the UPF should perform when no quota is granted. A packet for a specific rating group is subject to a termination action in the following cases:\n-\tZero units have been granted;\n-\tThe final granted units have been used;\n-\tQuota limit reached;\n-\tEnd user service rejected;\n-\tEnd user service denied;\n-\tRating failed.\nThe defined termination actions include:\n-\tAllowing the packets to pass through;\n-\tDropping the packets;\n-\tThe SMF Default Termination Action;\n-\tThe re-direction of packets to an application server (e.g. defined in the termination action).\nNOTE\tSuch a re-direction may trigger a new charging session to be initiated.\nA Default Termination Action for all rating groups, for which no quota is granted and there is no specific termination action, shall be pre-configured in the SMF according to operator's policy. For instance, the default behaviour may consist of allowing packets of any terminated service to pass through the UPF.\nWhen final units are granted for a given rating group, the CHF shall provide a termination action using finalUnitAction for this rating group. For the rating group, the CHF provided termination action shall be used instead of SMF pre-configured termination action for “The final granted units have been used” case.\nThe Sponsor Identifier and Application Service Provider Identifier are provided for sponsored data connectivity to the PCF from the AF, according to TS 23.503 [215].\nThe Sponsor Identifier and Application Service Provider Identity may be included in PCC rules with \"offline\" charging method for non-roaming or home routed roaming scenarios from the PCF to the SMF. In this case, charging information collected by the SMF includes the Sponsor Identity and the Application Service Provider Identity. Correlation of charging information from multiple users per sponsor and/or application service provider can then be based on Sponsor Identity and Application Service Provider Identity.\nThe interaction between I-SMF and SMF for the support of traffic offload by UPF controlled by the I-SMF is specified in the clause 5.34.6 TS 23.501[200].\nThere are two cases related to quota management when the granted quota is volume for multiple UPFs and per Operator's policy for the scenarios, i.e.Addition, Removal and Change of PDU Session Anchor (PSA2), Branching Point or UL CL controlled by I-SMF, the traffic is counted in more than one UPF:\n-\tQuota shared by UPFs (PSA)\n-\tQuota granted for each UPF (PSA)\nIn the scenario UL CL/BP controlled by I-SMF, the I-SMF forwards traffic usage information of UPF (PSA2) to the SMF as specified clause 5.34.4 and clause 5.34.5 in TS 23.501 [200].\nQuota management process is initiated by NF consumer, e.g. SMF, for service data flows handled with the online charging method for a given Rating Group. For the provision of the service to the end user, NF consumer requests quota from CHF via Charging Data Request messages [Initial / Update]. CHF-Controlled Quota Management in this context allows CHF to suspend/resume the quota management process for that Rating Group within a PDU session.\nWhen an NF consumer issues a Charging Data Request [Initial / Update] CHF may decide to authorize the service and suspend the quota management for that Rating Group. This means that: the service is authorized without granted units and that all quota management triggers for that Rating Group within a PDU session are ignored by the NF consumer. \nUsage will continue to be reported via the remaining default active triggers. It is the sole responsibility of CHF to activate other applicable triggers if additional reporting is needed.\nWhen an NF consumer issues a Charging Data Request [Update] in which a given Rating Group has quota management previously suspended, CHF may decide to resume quota management for that Rating Group. This means that all previously set quota management triggers for that Rating Group are considered by the NF consumer and granted units are reconfigured by the CHF.\nCHF may want to resume quota management at any time, for this Re-authorization mechanisms can be used to trigger NF consumer to subsequently issue a Charging Data Request [Update].Procedures enabling CHF-Controlled Quota Management to suspend/resume the quota management are described in TS 32.290 [57].\nThe CHF can be aware of redundant transmission type (i.e.dual connectivity, redundant transmission on N3/N9 and redundant transmission at transport layer) and provide the quota allocation based on the redundant transmission type:\n-\tFor dual connectivity based end to end redundant user plane paths, the granted quotas is allocated for each PDU session.\n-\tFor the redundant transmission on N3/N9 interfaces, the CHF grants the quota regardless if packets were duplicated or not.\n-\tFor the redundant transmission at transport layer, the CHF grants the quota regardless if packets were duplicated or not.\nFor dual connectivity based end to end Redundant User Plane Paths, SMF shall collect and report the usage for each redundant PDU session.\nFor redundant transmission at N3/N9 interface, the SMF shall collect and report the usage not counting redundant packets.\nDuring the PDU session life, the SMF may decide to active or deactive the redundant transmission and reports the usage based on the redundant transmission change trigger.\nFor redundant Transmission at transport layer, the SMF shall collect and report the usage not counting redundant packets.\nThe SMF provides for NR RedCap UE using NR the RAT Type NR_REDCAP, according to clause 5.41 of TS 23.501 [200].\nThe SMF provides charging information collection and reporting per PDU session for 5G non-roaming Mobile Virtual Network Operators (MVNOs) charging, according to clause 5.5.3.10 of TS 32.240 [1].\nThe charging principle for local breakout roaming scenario is applied to MVNOs (with an A-CHF) charging, with the following differences on the SMF interactions with the CHF in the MNO and A-CHF in the MVNO:\n-\tV-SMF in V-PLMN is replaced by the SMF in MNO;\n-\tV-CHF in V-PLMN is replaced by the CHF in MNO;\n-\tH-CHF in H-PLMN is replaced by the A-CHF in MVNO.\nNOTE:\tCHF selection as well as trigger handling and negotiation, are not specified and may be deployment dependent.\nIn order to support the charging of data connectivity via satellite access, SMF obtains the RAT type for NR satellite access, i.e. NR(LEO), NR(MEO), NR(GEO) and NR(OTHERSAT), according to clause 5.4.11 of TS 23.501 [200].\nThe SMF provides Satellite backhaul category and GEO satellite ID for Satellite backhaul charging, according to clause 5.43 of TS 23.501 [200].\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.2.1.4.1: Default Trigger conditions in SMF",
                                    "table number": 1,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.1.4.2: Chargeable events and their related actions in SMF",
                                    "table number": 2,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.1.6.1: Default Chargeable events in SMF for QBC",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.1.6.2: Chargeable events and their related actions in SMF for QBC",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.2.2\tMessage flows",
                            "text_content": "The flows in the present document specify the interaction between the SMF and the CHF for 5G data connectivity converged charging functionality, in different scenarios, based on TS 23.501 [200] and TS 23.502 [201] procedures and flows.\nThis interaction is based on Charging Data Request /Response specified in TS 32.290 [57], exchanged between the SMF embedding the CTF and the CHF.\nAs a general principle, the steps in the figures for the message flows below correspond to the steps of figures in TS 23.502 [201], which is the reference. This document specifies the charging specific extension part.\nThe subclause below describes PDU session charging in non-roaming scenarios.\nThe following figure 5.2.2.2.2-1 describes a PDU session establishment charging, based on figure 4.3.2.2.1.1 TS 23.502 [202] description:\n\nThe figure depicts a PDU (Power Distribution Unit) session establishment in a 5G network, illustrating the process of establishing a power distribution unit connection. The diagram shows the various components involved, such as the PDU, the network switch, and the power line. The figure highlights the importance of proper network design and configuration to ensure reliable and efficient power distribution.\nFigure 5.2.2.2.2-1: PDU session establishment\n8. The SMF selects an SSC mode for the PDU Session and also selects one or more UPFs.\n9. The SMF may perform a Session Management Policy Modification procedure to report some event to the PCF that has previously subscribed.\n9ch-a.The SMF creates a Charging Identifier for the PDU session, and sends Charging Data Request[initial] to CHF for authorization for the subscriber to start the PDU session which is triggered by start of PDU session charging event (The SMF may include 5GS CIoT optimizations information, see TS 23.502 [201]).\n9ch-b. The CHF opens CDR for this PDU session.\n9ch-c. The CHF acknowledges by sending Charging Data Response[Initial] to the SMF.\n15.\tAMF to SMF: SM Request (N2 SM information).\n[16a-b]. N4 session Modification.\n16ch-a. This step may occur in case \"start of service data flow\" needs quota from CHF, for the SMF to request quota.\n16ch-b. The CHF updates CDR for this PDU session.\n16ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\nNOTE 1: The steps from 16ch-a to 16ch-c for quota request from CHF are not applicable for offline only charging.\n17.\tSM Request with PDU session Update Response to AMF.\n18. SMF sends SM Context Status Notify to AMF.\n19.\tIn case of PDU Type IPv6, IPv6 Address Configuration.\nThe following figure 5.2.2.2.3-1 describes the PDU session modification charging, based on figure 4.3.3.2-1 TS 23.502 [202] description:\nThe figure depicts a PDU (Physical Device Unit) Session Modification process in a 5G network. It illustrates the steps involved in modifying a PDU session, including the selection of a new PDU, the modification of the session parameters, and the transmission of the modified session. The figure is crucial for understanding the complex process of session modification in 5G networks and its impact on network performance.\nFigure 5.2.2.2.3-1: PDU Session Modification\n2ch-a. \tThe SMF sends Charging Data Request [Update] to the CHF for reporting the charging information when the corresponding trigger is armed.\n2ch-b. The CHF update the CDR for the PDU session.\n2ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the SMF.\nThe following figure 5.2.2.2.4-1 describes the PDU session release charging, based on figure 4.3.4.2-1 TS 23.502 [202] description:\nThe figure depicts a PDU Session Release, which is a crucial step in the data transmission process. It shows the release of a session from the PDU (Physical Data Unit) to the PDU (Physical Data Unit) in the network. This process is essential for ensuring data integrity and reliability. The figure also includes a PDU (Physical Data Unit) and a PDU (Physical Data Unit), which are the units responsible for transmitting and receiving data, respectively. The release of the session from the PDU to the PDU is a critical step in ensuring data integrity and reliability.\nFigure 5.2.2.2.4-1: PDU Session Release\n2ch-a. The SMF sends Charging Data Request [Termination] to the CHF for terminating the charging associated with PDU sessions, with the trigger \"End of PDU session\".\n2ch-b. The CHF closes the CDR for the PDU session.\n2ch-c. The CHF acknowledges by sending Charging Data Response [Termination] to the SMF.\n\nThe subclause below describes PDU session SSC mode 1 charging in non-roaming scenarios.\nThe following figure 5.2.2.3.2.1 describes a PDU session SSC mode 1 charging, based on clause 5.6.9.2.1 TS 23.501 [201] description:\n\nThe figure depicts a relocation plan for a Power Distribution Unit (PDU) session in a Switching and Synchronous Coupling (SSC) mode 1. The relocation is necessary due to the presence of a new PDU in the network. The figure shows the new PDU's location relative to the existing PDU, as well as the new PDU's connection to the network. The relocation plan includes the new PDU's connection to the network, as well as the new PDU's connection to the existing PDU. The figure also includes the new PDU's connection to the network, as well as the new PDU's connection to the existing PDU. The figure also includes the new PDU's connection to the network, as well as the new PDU's connection to the existing PDU. The figure also includes the new PDU's connection to the network, as well as the new PDU's connection to the existing PDU. The figure also includes the new PDU's connection to the network, as well as the new PDU's connection to the existing PDU. The figure also includes the new PDU's connection to the network, as well as the new P\nFigure 5.2.2.3.2.1: (R)AN relocation for PDU session in SSC mode 1\nOngoing charging interaction associated with the established PDU session (UPF).\n1.\tA (R)AN relocation is performed.\n2. The SMF determines that the serving UPF needs to be maintained and interacts with the UPF for the path switch to the new (R)AN access.\n3. the SMF acknowledges the path switch to the new (R)AN.\n3ch-a. The SMF sends Charging Data Request[Update] to the CHF for reporting the charging information User location information/ Access Technology Type Information.\n3ch-b. The CHF updates the CDR.\n3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\nThe subclause below describes PDU session charging for change the PDU Session Anchor serving a PDU Session of SSC mode 2\nThe following figure 5.2.2.4.2.1 describes a PDU session anchor relocation in SSC mode 2 charging, based on figure 4.3.5.1.1 TS 23.502 [201] description:\n\nThe figure depicts a PDU session anchor relocation in a Single Session Control (SSC) mode 2 with a single PDU session anchor. The relocation is performed in a 4x2 matrix, with the PDU session anchor being relocated to the 2nd column. This is done to ensure that the PDU session anchor is always in the same column as the session anchor, which is a key requirement for the system to function correctly.\nFigure 5.2.2.4.2.1: PDU session anchor relocation in SSC mode 2 with single PDU session anchor\nOngoing charging session associated with the established PDU session (UPF1)\n2.\tPDU session release procedure (UPF1).\n2ch-a. The SMF1 sends Charging Data Request[Termination] to the CHF for terminating the charging associated with old PDU session in UPF1.\n2ch-b. The CHF closes the CDR for old PDU session in UPF1.\n2ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to the SMF1.\n3.\tPDU session establishment procedure (UPF2).\n3ch-a. The SMF2 creates a Charging Identifier for new PDU session ID in UPF2 and sends Charging Data Request[initial] to CHF for authorization for the subscriber to start the new PDU session which is triggered by start of PDU session charging event.\n3ch-b. The CHF opens CDR for new PDU session in UPF2.\n3ch-c. The CHF acknowledges by sending Charging Data Response[initial] to the SMF2.\nNOTE: If the same SMF1 is re-selected is step 3, the same steps 3ch-a to b apply to SMF1\n\nThe subclause below describes PDU session charging for change the PDU Session Anchor serving a PDU Session of SSC mode 3.\nThe following figure 5.2.2.5.2.1 describes a PDU session anchor relocation in SSC with mode 3 multiple PDU sessions and SMF reallocation, based on figure 4.3.5.2.1 TS 23.502 [201] description:\n\nThe figure depicts a 5G network scenario where session anchor relocation is performed in a Software-Defined Networking (SDN) mode 3 with multiple PDU sessions. The figure shows the PDU session anchor relocation process, including SMF reallocation, in a 5G network with multiple PDU sessions.\nFigure 5.2.2.5.2.1: PDU session anchor relocation in SSC mode 3 with multiple PDU sessions – SMF reallocation\nOngoing charging interaction associated with the established PDU session (with UPF1).\n4. UE initiates PDU session establishment procedure with  UPF2.\n4ch-a. The SMF2 creates a Charging Identifier for new PDU session ID with UPF2 and sends Charging Data Request[initial] to CHF for authorization for the subscriber to start the new PDU session (with UPF2) which is triggered by start of PDU session charging event.\n4ch-b. The CHF opens CDR for new PDU session in UPF2.\n4ch-c. The CHF acknowledges by sending Charging Data Response[initial] to the SMF2.\n6. Old PDU session for UPF1 release.\n6ch-a. The SMF1 sends Charging Data Request[Termination] to the CHF for terminating the charging associated with old PDU session in UPF1.\n6ch-b. The CHF closes the CDR for old PDU session in UPF1.\n6ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to the SMF1.\nThe subclause below describes PDU session charging for service continuity with SSC mode 3 using the multi-homed PDU Session.\nThe following figure 5.2.2.6.2.1 describes a PDU session anchor relocation in SSC mode 3 with IPv6 Multi homed PDU Session charging, based on figure 4.3.5.3.1 TS 23.502 [201] description:\n\n\nThe figure depicts a PDU session anchor relocation in a 6-2-1 mode with IPv6 Multi-homed PDU Session, illustrating the process of relocating the session anchor in a 6-2-1 mode with IPv6 Multi-homed PDU Session.\nFigure 5.2.2.6.2.1: PDU session anchor relocation in SSC mode 3 with IPv6 Multi homed PDU Session\nOngoing charging interaction associated with the established PDU session (UPF1).\nTraffic starts at UPF2.\n11ch-a. The SMF sends Charging Data Request[Update] to the CHF for request quota for UPF2 which is triggered by start of service data flow charging event, if quota management per UPF.\n11ch-b. The CHF updates CDR for this PDU session\n11ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\n[12a-b to 13a-b]\tThe SMF releases the UE's old IPv6 prefix (IP@1), and releases the path between BP UPF and UPF1.\n13ch-a. The SMF sends Charging Data Request[Update] to the CHF for usage reporting for UPF1 which is triggered by termination of service data flow charging event, if quota management per UPF.\n13ch-b. The CHF updates CDR for this PDU session.\n13ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\n\nIn this scenario, the PDU session Id is maintained during the whole procedure.\nThe following figure 5.2.2.7.1 describes the charging procedure to add a PDU Session Anchor and a Branching Point or UL CL for an established PDU Session, based on figure 4.3.5.4.1 TS 23.502[201].\nThe figure depicts a 7-port PDU (Power Distribution Unit) with an additional PDU Session Anchor and Branching Point or UL CL (Unified Loop Control). This configuration allows for the addition of a new PDU Session Anchor and Branching Point or UL CL, enhancing the network's flexibility and scalability.\nFigure 5.2.2.7.1: Addition of additional PDU Session Anchor and Branching Point or UL CL\n\nOngoing charging interaction associated with the established PDU session (UPF).\n3.\tThe SMF establishes the Branching Point (in case of IPv6 multi-homing) or a UL CL for the PDU Session.\n3ch-a. The SMF sends Charging Data Request[Update] to the CHF for the additional of UPF (PSA 2) if quota management is granted per UPF by trigger \"Addition of UPF\".\n3ch-b. The CHF updates the CDR for the charging information of UPF (PSA 2).\n3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\nThe following figure 5.2.2.8.1 describes charging procedure to remove a PDU Session Anchor and (optionally) remove Branching Point or UL CL for an established PDU Session, based on figure 4.3.5.5.1 TS 23.502[201].\nThe figure depicts a 5G network scenario with a focus on signal propagation and network architecture. It shows the signal path in a 5G network, highlighting the role of base stations (gNB), user equipment (UE), and scatterers. The diagram illustrates the use of beamforming techniques to mitigate interference, and it highlights the importance of redundancy paths to ensure failover reliability. The figure also shows the layered design of the optical backbone, aligning with SDN principles.\nFigure 5.2.2.8.1: Removal of additional PDU Session Anchor and Branching Point or UL CL\nOngoing charging interaction associated with the established PDU session (UPF).\n5.\tThe SMF releases via N4 the PSA1.\n5ch-a. The SMF sends Charging Data Request[Update] to the CHF for the removal of UPF (PSA 1) if quota management is granted per UPF by trigger \"Removal of UPF\".\n5ch-b. The CHF updates the CDR for the charging information of UPF (PSA 1).\n5ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\n6.\tIf steps 4 and 5 were executed, the SMF releases the Branching Point / UL CL.\nThe following figure 5.2.2.9.1 charging procedure to establish a new additional PDU Session Anchor (i.e., PSA2) and conditionally releases the existing additional PDU Session Anchor (i.e. PSA1), while modifying IPv6 multi-homing or UL CL rule in the same Branching Point or UL CL under controlled by the same SMF abased on figure 4.3.5.6.1 TS 23.502[201].\nThe figure depicts a change in the additional PSA (Session Information Protocol) for a PDU (Physical Data Unit) in IPv6 multi-homing or UL CL (Uniformity Level Clustering) case. The figure shows the different scenarios and their corresponding changes in the PSA, including the addition of a new PDU session, the change of the PDU's IP address, and the addition of a new PDU session.\nFigure 5.2.2.9.1: Change of additional PSA for a PDU Session in IPv6 multi-homing or UL CL case\nOngoing charging interaction associated with the established PDU session (UPF).\n3a-b.\tThe SMF exchange the N4 message toBranching Point or UL CL .\n3ch-a. The SMF sends Charging Data Request[Update] to the CHF for the additional of UPF (PSA 2) if quota management is granted per UPF by trigger \"Addition of UPF\".\n3ch-b. The CHF updates the CDR for the charging information of UPF (PSA 2).\n3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\n\n6a-b.\tStep 6 occurs only if the Branching Point or UL CL does not have any traffic filter on the PDU Session which forwards a traffic flow to PSA1.\n6ch-a. The SMF sends Charging Data Request[Update] to the CHF for the removal of UPF (PSA 1) if quota management is granted per UPF by trigger \"Removal of UPF\".\n6ch-b. The CHF updates the CDR for the charging information of UPF (PSA 1).\n6ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\nThe following figure 5.2.2.10.1 describe the charging procedure to change the Branching Point or the UL CL and additional PSA serving a PDU Session for a UE triggered by SMF ((just an example call flow triggered by Xn based handover) based on figure 4.3.5.7.1 TS 23.502[201].\nThe figure depicts a complex network scenario where simultaneous changes in Branching Point (BPS) or UL CL (Unified Layer Control) and additional PSA (Physical Session Association) are required for a PDU (Physical Data Unit) session. This is a crucial aspect of network management, ensuring that the correct signaling is applied to the correct device. The figure illustrates the intricate process of managing these changes, with the use of different symbols and colors to represent different states of the network.\nFigure 5.2.2.10.1: Simultaneous change of Branching Point or UL CL and additional PSA for a PDU Session\n\nOngoing charging interaction associated with the established PDU session (UPF).\n\n3ch-a. The SMF sends Charging Data Request[Update] to the CHF for the additional of Target UPF if quota management is granted per UPF by trigger \"Addition of UPF\".\n3ch-b. The CHF updates the CDR for the charging information of Target UPF.\n3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\n9.\tThe SMF releases PSA2.\n9ch-a. The SMF sends Charging Data Request[Update] to the CHF for the removal of Source UPF if quota management is granted per UPF by trigger \"Removal of UPF\".\n9ch-b. The CHF updates the CDR for the charging information of Source UPF.\n9ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the SMF.\n\nIn order to interwork with EPC, the N26 interface is introduced as an inter-CN interface between the MME in EPC and 5GS AMF in order to enable provide seamless session continuity for single registration mode UE for inter-system change in the clause 5.17.2.2 TS 23.501[201].\nPCF + PCRF, PGW-C + SMF and UPF + PGW-U are dedicated for interworking between 5GS and EPC, which are optional and are based on UE MM Core Network Capability and UE subscription in the clause 4.3 TS 23.501 [201]. The procedures for interworking with EPS based on N26 interface are specified in clause 4.11.1 TS 23.502 [201].\nWhen 5GS and EPC interworking, interaction between the PGW-C + SMF and CHF is using the same interface as for interaction between SMF and CHF.\nWhen a UE establishes a PDN connection/PDU session with PGW-C+SMF in EPS or 5GS, a charging session is established for the PDU session and PDN connection to support 5GS and EPS interworking as follows:\n-\tWhen a UE is served by EPC, a charging session is established between the PGW-C+SMF and CHF via Nchf interface for EPC online charging and offline charging if 5GS interworking indication from SGW indicates that the UE supports 5G and the PDN connection is not restricted to interworking with 5GS by user subscription.\n-\tWhen a UE is served by 5GS, a charging session is established between the PGW-C+SMF and CHF via Nchf interface for 5GS converged online and offline charging.\n-\tWhen a UE is served by EPC, the PGW-C+SMF acts as the  PGW, and a charging session is established via Gy interface for EPC online charging and Gz interface for offline charging if 5GS interworking is not supported.\nThe chargeable events for 5GS and EPC interworking are handover cancel, handover start and handover complete.\nThe triggers for 5GS and EPC interworking may be enabled or disabled, the PGW-C+SMF will interact with charging system as the following:\n-\tIf the trigger for interworking is enabled and the category is set to \"immediate reporting\", the PGW-C+SMF will report usage in source network and/or request quota for target network.\n-\tIf the trigger for interworking is enabled and the category is set to \"deferred reporting\", the PGW-C+SMF will close the count in source network and start a new count in target network and continue to consume the quota in target network. The source access specific triggers will no more be applicable in the PGW-C+SMF, the target access specific triggers will apply instead.\n-\tIf the trigger for interworking is disabled, the PGW-C+SMF will record usage for both source and target network accesses into common count and consumes the same quota in source and target network. The source access specific triggers will no more be applicable in the PGW-C+SMF, the target access specific triggers will apply instead.\nFor Charging Identifier handling see clause 5.1.4.\nThe following figure 5.2.2.11.2.1 describes the handover from 5GS to EPS when N26 is supported, based on figure 4.11.1.2.1.1 TS 23.502 [201] description:\n\nFigure 5.2.2.11.2.1: 5GS to EPS handover using N26\n0.\tA PDU session is established in 5GS with multiple QoS Flows. A Charging Identifier  was assigned to the PDU session.\n0ch. A charging session between the PGW-C+SMF and CHF exists for this PDU session.\n10c. PDU session update response to AMF.\n10ch-a. This step occurs if steps 10a-c occurred. All counts are closed and a Charging Data Request [Update] is sent to CHF, if required by \"Handover start\" trigger. New counts and time stamps for all active service data flows are started in the PGW-C+SMF.\n10ch-b. The CHF updates CDR for this PDU session.\n10ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\n16.\tUser Plane path switch for the default bearer and the dedicated GBR bearers between the UE and PGW-U+UPF via SGW. The Charging Identifier  assigned to the PDN connection is supplied as the Charging Identifier  for the default bearer. The EPS bearer Charging Identifier assigned to the dedicated EPS bearer(s), is supplied as the Charging Identifier  for that dedicated EPS bearer.\n16ch-a. All counts are closed and a Charging Data Request [Update] is sent to CHF, if required by \"RAT type change\" trigger. New counts and time stamps for all active service data flows are started in the PGW-C+SMF (The PGW-C+SMF may include APN Rate Control Change, see TS 23.502 [201]).\n16ch-b. The CHF updates CDR.\n16ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\n19.\t Dedicated bearer activation procedure for non-GBR QoS flows initiated by PGW-C+SMF.\n19ch. Needed counts are started on start of service data flows of corresponding non-GBR QoS Flows.\nThe following figures 5.2.2.11.3.1 and 5.2.2.11.3.2 describe the handover from EPS to 5GS when N26 is supported, based on figures 4.11.1.2.2.2.1 and 4.11.1.2.2.3.1 TS 23.502 [201] description:\nThe figure depicts a handover process from 11.3.1 EPS to 5GS using N26, highlighting the preparation steps involved.\nFigure 5.2.2.11.3.1: EPS to 5GS handover using N26 - preparation\n0.\tIf the UE supports 5G and the PDN connection is not restricted to interworking with 5GS by user subscription, the PGW-C+SMF is aware that 5GS interworking is supported. A PDN connection is established in EPC with default bearer and dedicated bearers. Association between the EPS bearer and the corresponding 5G QoS Rules is stored by the PGW-C+SMF.\n0ch. A charging session between the PGW-C+SMF and CHF exists for this PDN connection with associated to the default bearer and dedicated bearers. The default bearer is assigned with the Charging Identifier  of the PDN connection. The dedicated bearers are assigned with the EPS bearer Charging Identifier.\nAs described in clause 4.11.1.2.2 of TS 23.502 [201] the PGW-C+SMF may receive APN Rate Control Status enabled during interworking with EPC for this PDN connection, the PGW-C+SMF interacts with CHF as following:\n13ch-a. All counts are closed and a Charging Data Request [Update] is sent to CHF, if required by \"RAT type change\" trigger. The APN Rate Control Change may be provided by PGW-C+SMF in charging information if received.\n13ch-b. The CHF updates CDR for this PDN connection.\n13ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\nThe figure depicts a handover process from 11 to 5GS using the N26 protocol, illustrating the steps and steps involved in the handover process.\nFigure 5.2.2.11.3.2: EPS to 5GS handover using N26 - execution\n10ch-a. All counts are closed and a Charging Data Request [Update] is sent to CHF, if required by \"RAT type change\" trigger. New counts and time stamps for all active service data flows are started in the PGW-C+SMF.\n10ch-b. The CHF updates CDR for this PDU session.\n10ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\nThe following figures 5.2.2.11.4.1 describe the handover cancel, based on clause 4.11.1.2.3 TS 23.502 [201] description:\nThe figure depicts a handover cancel scenario in a 4G network, illustrating the process of a mobile device transitioning from one network to another. The figure shows the handover process, including the handover request, the network's response, and the handover completion. The figure is labeled with the figure name \"Figure 5.2.2. 11 . 4 .1: Handover Cancel,\" which provides context for the content.\nFigure 5.2.2.11.4.1: Handover Cancel\n4.\tBased on the Relocation Cancel Indication, the target CN node (MME or AMF) deletes the session resources established during handover preparation phase in SGW (SGW-C and SGW-U)/ (SMF and UPF).\n4ch-a. All counts are closed and a Charging Data Request [Update] is sent to CHF which triggered by \"Handover cancel\", New counts and time stamps for all active service data flows are started in the PGW-C+SMF.\n4ch-b. The CHF updates CDR for this PDU session.\n4ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\n7.\tIf indirect forwarding tunnel is setup during handover preparation phase then cancellation of handover triggers the source CN node to release the temporary resources used for indirect forwarding.\n8.\tIf indirect forwarding tunnel is setup during handover preparation phase then cancellation of handover triggers the target CN node to release the temporary resources used for indirect forwarding.\nThe following figures 5.2.2.11.5.1 describe the handover from EPS to 5GS without N26 support, based on clause 4.11.2.3 TS 23.502 [201] description:\nThe figure depicts a simplified representation of an EPS (Enhanced Passive System) to 5GS (5G Small Cell) mobility without N26 (Non-26 GHz band). It illustrates the concept of using an EPS to extend the coverage of a 5G network, allowing for higher data rates and improved network performance. The figure shows the EPS as a simplified structure, with the 5GS network represented as a separate entity, highlighting the potential for seamless integration between the two.\nFigure 5.2.2.11.5.1: EPS to 5GS mobility without N26\n0.\tThe UE is attached in EPC.\n1-8.\tUE initiate registration procedure to the 5GS and indicates that it is moving from EPC.\n9.\tUE requested PDU Session Establishment.\n9ch-a. a Charging Data Request [Update] is sent to CHF which is trigged by Handover start charging event, New counts and time stamps for all active service data flows are started in the PGW-C+SMF.\n9ch-b. The CHF updates CDR for this PDU session.\n9ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\n10.\tThe PGW-C+SMF performs release of the resources in EPC for the PDN connections(s) transferred to 5GS by performing the PDN GW initiated bearer deactivation procedure.\n10ch-a. All counts are closed and a Charging Data Request [Update] is sent to CHF which is trigged by Handover complete charging event.\n10ch-b. The CHF updates CDR.\n10ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\nThe following figures 5.2.2.11.6.1 describe the handover from 5GS to EPS without N26 support, based on clause 4.11.2.2 TS 23.502 [201] description:\n\nThe figure depicts a simplified representation of a 5G network, showing the mobility of a 5G signal without the need for N26. It illustrates the use of 5G technology to enable seamless connectivity, even in areas with limited infrastructure.\nFigure 5.2.2.11.6.1: 5GS to EPS mobility without N26\n0.\tUE is registered in 5GS.\n1-6. TAU procedure is triggered to start for E-UTRAN initial attach.\n7.\tUE initiate E-UTRAN Initial Attach procedure to the EPS and indicates that it is moving from 5GS.\n7ch-a. a Charging Data Request [Update] is sent to CHF which is triggered by Handover start charging event. New counts and time stamps for all active service data flows are started in the PGW-C+SMF.\n7ch-b. The CHF updates CDR for this PDU session.\n7ch-c.The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\n10.\tIf the UE has remaining PDU Sessions in 5GS which it wants to transfer to EPS and maintain the same IP address/prefix, the UE performs the UE requested PDN Connectivity Procedure.\n14. The PGW-C+SMF initiates release of the PDU Session(s) in 5GS transferred to EPS.\n14ch-a. All counts are closed and a Charging Data Request [Update] is sent to CHF which is triggered by Handover complete charging event.\n14ch-b. The CHF updates CDR for this PDU session.\n14ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\nThe following figure 5.2.2.11.7.1 describes the handover from EPS to 5GS for roaming in home routed scenario, focusing on the Charging Identifier generation mechanism.\nThe figure depicts a simplified representation of an EPS (Enhanced Packet Service) to 5GS (5G Service) mobility without N26 in Home-Routed Roaming, illustrating the concept of a simplified network architecture.\nFigure 5.2.2.11.7.1: EPS to 5GS mobility without N26 in Home-Routed Roaming\n1.\tThe UE is attached in EPC and initiates a new PDU connection (IP-CAN session).\n1ch-a. A Charging Data Request [Initial] is sent to CHF via PGW-C+SMF in HPLMN, triggered by \"Start of PDU Session\". The Charging Identifier included is generated by PGW-C +SMF in HPLMN.\n1ch-b. The H-CHF opens a CDR 1ch-c. The H-CHF acknowledges by sending Charging Data Response [Initial] to the PGW-C+SMF.\n2. UE initiates registration procedure to the 5GS and indicates that it is moving from EPC. UE requests PDU Session Establishment.\n2ch-a. SMF in VPLMN creates a Charging Identifier (VPLMN  created Charging Identifier) for the PDU session and sends the Charging Data Request [Initial] to CHF in VPLMN triggered by \"Start of PDU Session\"\n2ch-b. The CHF in VPLMN opens a CDR.\n2ch-c. The CHF in VPLMN acknowledges by sending Charging Data Response [Initial] to the SMF and optionally supplies a VPLMN selected “Roaming Charging Profile” to the V-SMF which override the default one.\n3. UPF selection and V-SMF sends the PDU session establishment request to H-SMF.\n3ch-a. A Charging Data Request [Update] is sent to CHF in HPLMN triggered by \"Handover start\", indicating the \"Roaming Charging Profile\" received from the VPLMN. The same Charging Identifier  (home provided Charging Identifier)in step 1ch-a will be the only one Charging Identifier used for any subsequent charging data request sent from H-SMF to CHF i.e. , the Charging Identifier generated in PGW-C +SMF in HPLMN.\n3ch-b. The CHF in HPLMN updates the CDR.\n3ch-c. The CHF in HPLMN acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF and supplies the HPLMN selected \"Roaming Charging Profile\" to the PGW-C+SMF.\n4. H-SMF sends the PDU session establishment response with Charging Identifier (home provided Charging Identifier).\n4ch-a. A Charging Data Request [Update] is sent to CHF in VPLMN triggered by \"Handover complete\", with the \"Roaming Charging Profile\", Charging Identifier (visited created Charging Identifier), and Home Provided Charging Identifier.\n4ch-b. The CHF updates the CDR.\n4ch-c. The CHF acknowledges by sending Charging Data Response [Update].\nIn subsequent charging data request sent from V-SMF to V-CHF, the Charging Identifier has the value of home provided Charging Identifier, and the home provided Charging Identifier is not provided.\nThe following figure 5.2.2.11.11.1 describes the handover from EPC/ePDG to 5GS for non-roaming scenario based on clause 4.11.4.1 Handover from EPC/ePDG to 5GS of TS 23.502 [201].\nThe figure depicts a detailed schematic of the communication path from H andover to 5GS, illustrating the various components and their interconnections.\nFigure 5.2.2.11.11.1: Handover from EPC/ePDG to 5GS\n0. One or more PDN Connections have been established.\n1. UE register to 5GC via NG RAN.\n2. The UE initiates a UE requested PDU Session Establishment via 3GPP Access and includes the \"Existing PDU Session\" indication or \"Existing Emergency PDU Session\" and the PDU Session ID.\n2ch-a. PGW-C+SMF sends Charging Data Request [Update] to CHF if required by \"RAT type change\" trigger.\n2ch-b. The CHF updates for this PDU session\n2ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\n3. Step 10-14, in procedure of UE requested PDU Session Establishment.\n4. The combined PGW+SMF/UPF initiates a PDN GW initiated Resource Allocation Deactivation to release the EPC and ePDG resources.\nThe following figure 5.2.2.11.9.1 describes the handover from 5GS to EPC/ePDG based on clause 4.11.4.2 Handover from 5GS to EPC/ePDG in TS 23.502 [201].\nThe figure depicts a detailed schematic of a 5G signal path, illustrating the various components involved in signal propagation, such as base stations (gNB), user equipment (UE), and scatterers. The diagram highlights the use of beamforming techniques to mitigate interference, and the presence of redundant paths ensures failover reliability. The layered design of the optical backbone aligns with SDN principles, providing a robust and efficient network architecture.\nFigure 5.2.2.11.9.1: Handover from 5GS to EPC/ePDG\n0)\tOne or more PDU Sessions have been established between the UE and the SMF/UPF via NG-RAN.\n1)\tUE selects an ePDG.\n2)\tStep A1 in procedure of the UE initiates a Handover Attach procedure.\n2ch-a. PGW-C+SMF sends Charging Data Request [Update] to CHF if required by \"RAT type change\" trigger.\n2ch-b. The CHF updates for this PDU session.\n2ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\n3)\tStep C1, in procedure of the UE initiates a Handover Attach procedure to the release of resources.\n4)\tThe combined PGW+SMF/UPF initiates a network requested PDU Session Release via 3GPP access.\n\nThe subclauses below describe PDU session charging for roaming in Home routed scenario focusing on roaming QBC procedures between SMF and a CHF in respective PLMNs.\nIn H-PLMN, PDU session charging for FBC between H-SMF and a H-CHF occurring within the same charging session is not reflected.\nThe following figure 5.2.2.12.2.1 describes a PDU session charging establishment in roaming Home routed scenario based on figure 4.3.2.2.2.1 TS 23.502 [201] description:\nFigure 5.2.2.12.2.1: PDU session charging: establishment roaming Home Routed\n1-3a.\tUE initiates a new PDU session. V-SMF and H-SMF selection by the AMF.\n3ch-a. The UE is identified as a roamer (PLMN ID of the received SUPI is different from VPLMN PLMN ID), the CHF is selected accordingly (the V-SMF may include 5GS CIoT related information).\n3ch-b. A Charging Data Request [Initial] is sent to CHF, indicating \"in-bound roamer\", triggered by \"Start of PDU Session\".\n3ch-c. The CHF opens a CDR (indicating \"in-bound roamer\")\n3ch-d. The CHF acknowledges by sending Charging Data Response [Initial] to the SMF and optionally supplies a \"Roaming Charging Profile\" to the V-SMF which overrides the default one.\n10. UPF selection.\n11.\tIf dynamic PCC is deployed, SM policy association modification.\n11ch-a. Based on UE is identified as roaming in a different PLMN, the CHF is selected accordingly.\n11ch-b. A Charging Data Request [Initial] is sent to CHF, triggered by \"Start of PDU Session\", indicating \"out-bound roamer\", with the \"Roaming Charging Profile\" received from the VPLMN (the H-SMF may include 5GS CIoT related information).\n11ch-c. The CHF opens a CDR (indicating \"out-bound roamer\").\n11ch-d. The CHF acknowledges by sending Charging Data Response [Initial] to the H-SMF and supplies the HPLMN selected \"Roaming Charging Profile\" (either the same as the one received from VPLMN, either its own selected) to the H-SMF.\n[12a-b]. The SMF initiates an N4 Session Establishment procedure with the selected UPF.\n12ch. Counts per QFI are started.\n13.\tNsmf_PDUSession_Create Response from H-SMF to V-SMF with \"Roaming Charging Profile\" (as described in step 11ch-d) from H-SMF to V-SMF. The \"Roaming Charging Profile\" may be reported to the V-CHF in the follow-up Charging Data Request [Update].\n13ch-a. ACharging Data Request [Update] is sent to CHF with charging information received from H-SMF, when enabler trigger is armed, which includes the HPLMN selected \"Roaming Charging Profile\" and counts per QFI are started.\n13ch-b. The CHF updates the CDR.\n13ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\n\n19a-b.\t N4 session modification.\n19ch-a. Counts per rejected QFI(s) are closed. A Charging Data Request [Update] is sent to CHF to report if needed.\n19ch-b. The CHF updates the CDR.\n19ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\n23. Nsmf_PDUSession_UpdateRequest from V-SMF to H-SMF. The rejected QFI(s) are notified to H-SMF.\n23ch-a. Counts per rejected QFI(s) are closed. A Charging Data Request [Update] is sent to CHF to report if needed.\n23ch-b. The CHF updates the CDR.\n23ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the H-SMF.\nThe following figure 5.2.2.12.3.1 describes a PDU Session Modification procedure, home-routed roaming scenario based on figure 4.3.3.3.1 TS 23.502 [201] description:\nThe figure depicts a 12-bit 3-1 PDU Session Modification request from a home-routed roaming UE, indicating the need for network-to-user (N-to-U) session modification for roaming purposes.\nFigure 5.2.2.12.3.1: UE or network requested PDU Session Modification (for home-routed roaming scenario)\n\n9ch-a. A Charging Data Request [Update] is sent to V-CHF with charging information received from V-SMF, if needed and new counts per QFI are started.\n9ch-b. The CHF updates the CDR.\n9ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the V-SMF.\n16ch-a. A Charging Data Request [Update] is sent to H-CHF with charging information received from H-SMF, if needed, and new counts per QFI are started.\n16ch-b. The CHF updates the CDR.\n16ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the H-SMF.\nThe following figure 5.2.2.8.4.1 describes a PDU session charging release in roaming home routed scenario based on figure 4.3.4.3.1 TS 23.502 [201] description:\nThe figure depicts a PDU session charging release roaming home route, with a release roaming home route. The release roaming home route is shown in red, indicating that it is the active route. The PDU session charging is shown in blue, indicating that it is the active session. The release roaming home route is shown in green, indicating that it is the active route. The release roaming home route is shown in yellow, indicating that it is the active route. The release roaming home route is shown in orange, indicating that it is the active route. The release roaming home route is shown in purple, indicating that it is the active route. The release roaming home route is shown in blue, indicating that it is the active route. The release roaming home route is shown in green, indicating that it is the active route. The release roaming home route is shown in yellow, indicating that it is the active route. The release roaming home route is shown in orange, indicating that it is the active route. The release roaming home route is shown in purple, indicating that it is the active route. The release roaming home route is shown in blue, indicating that it is the active route. The release roaming home route is shown in green, indicating that it is the active route. The release\nFigure 5.2.2.12.4.1: PDU session charging: release roaming home Routed\n\n2a-2b.\t(UE, (R)AN or serving network initiated) N4 session release between H-SMF and H-UPF.\n2ch_a. A Charging Data Request [Termination] is sent to CHF with the set of QFI(s) counts.\n2ch-b. The CHF closes the CDR\n2ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to the H-SMF.\n\n4a-4b.\tN4 session release between V-SMF and V-UPF.\n4ch-a. A Charging Data Request [Termination] is sent to CHF with the set of QFI(s) counts.\n4ch-b. The CHF closes the CDR\n4ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to the V-SMF.\n15b-15c.\t(HPLMN initiated release) N4 session release between H-SMF and H-UPF.\n15ch_a. A Charging Data Request [Termination] is sent to CHF with the set of QFI(s) counts.\n15ch-b. The CHF closes the CDR\n15ch-c. The CHF acknowledges by sending Charging Data Response [Termination] to the H-SMF.\nNOTE: Either 2ch or 15ch is done depending on if the release is UE, (R)AN, serving network, or HPLMN initiated.\nThe following figure 5.2.2.12.5.1 describes the Home Routed PDU Session case in which the UE moves out of H-SMF service area in the HPLMN to a new PLMN V-SMF service area for the service request procedure  based on figure 4.23.4.3-1 of TS 23.502 [201], with I-SMF replaced by V-SMF in I-SMF insertion scenario (the CHF interaction is similar for N2 and Xn based handover procedures):\nThe figure depicts a routing home routed PDU session inter-PLMN V-SMF change, showing the various steps involved in the process. The diagram illustrates the steps from the source network to the destination network, including the routing table, V-SMF, and the change in the routing table. The figure is used to understand the flow of data and the steps involved in routing home-routed PDU sessions between different network segments.\nFigure 5.2.2.12.5.1: Roaming Home routed PDU session inter-PLMN V-SMF change\n0ch-a: Ongoing charging session for HPLMN for UE served by H-SMF, using \"Charging Identifier 1\".\n1-2.\tUE moves into a different PLMN, and the new AMF determines the V-SMF based on service area.\n3- 4b.\tSM Context retrieval by V-SMF from the H-SMF. The \"Charging Identifier 1\" is conveyed to the V-SMF.\n4ch-a. The UE is identified as a roamer, the V-CHF is selected accordingly.\n4ch-b. A Charging Data Request [Initial] is sent to the V-CHF, indicating \"in-bound roamer\" and \"Charging Identifier 1\" received on step 4b.\n4ch-c. The V-CHF opens a CDR (indicating \"in-bound roamer\").\n4ch-d. The V-CHF acknowledges by sending Charging Data Response [Initial] to the V-SMF and optionally supplies a \"Roaming charging profile\" to the V-SMF which overrides the default one.\n5-7c.\tRefer steps 5 to 7c in Figure 4.23.4.3-1 of TS 23.502 [201].\n8a.\tNsmf_PDUSession_Update Request from the V-SMF towards the H-SMF and optionally \"Roaming Charging Profile\".\n8ach-a. A Charging Data Request [Update] is sent to H-CHF in HPLMN (e.g. based on PLMN change trigger), indicating the PLMN change and \"Roaming charging profile\" if received from the VPLMN. This step occurs before SMF interacts with the UPF.\n8ach-b. The H-CHF in HPLMN updates the CDR.\n8ach-c. The H-CHF in HPLMN acknowledges by sending Charging Data Response [Update] to the H-SMF and optionally the HPLMN selected \"Roaming Charging Profile\" for this VPLMN.\n8c.\tNsmf_PDUSession_Update Response from the H-SMF to the V-SMF with the \"Roaming charging profile\".\n8cch-a. A Charging Data Request [Update] is sent to the V-CHF with charging information received from H-SMF, which includes the HPLMN selected \"Roaming charging profile\", if received from HPLMN.\n8cch-b. The V-CHF updates the CDR.\n8cch-c. The V-CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\n9, 17-21. Refer steps 9 and 17 to 21 in Figure 4.23.4.3-1 of TS 23.502 [201].\nThe following figure 5.2.2.12.6.1 describes the Home Routed PDU Session case in which the UE moves out of V-SMF service area in the serving PLMN to a new PLMN V-SMF service area for the service request procedure based on figure 4.23.4.3-1 of TS 23.502 [201], with I-SMF replaced by V-SMF in I-SMF change scenario (the CHF interaction is similar for N2 and Xn based handover procedures):\nThe figure depicts a routing home routed PDU session inter-PLMN V-SMF change, showing the various steps involved in the process. The diagram illustrates the steps from the source network to the destination network, including the routing decision, the change in V-SMF, and the associated changes in the routing table. This process is crucial for ensuring efficient and reliable network communication.\nFigure 5.2.2.12.6.1: Roaming Home routed PDU session inter-PLMN V-SMF change\n0ch-a: Ongoing charging session in the old VPLMN for UE served by the old V-SMF, using \" Charging Identifier 1\".\n0ch-b: Ongoing charging session for HPLMN for UE served by the old V-SMF, using \" Charging Identifier 1\".\n1-2.\tUE moves into a different PLMN, and the new AMF determines the new V-SMF based on service area.\n3- 4b.\tSM Context retrieval by the new V-SMF from the old V-SMF. The \" Charging Identifier 1\" is conveyed to the new V-SMF.\n4ch-a. The UE is identified as a roamer, the CHF is selected accordingly.\n4ch-b. A Charging Data Request [Initial] is sent to the new V-CHF, indicating \" in-bound roamer\" and \"Charging Identifier 1\" received on step 4b.\n4ch-c. The new V-CHF opens a CDR (indicating \" in-bound roamer\").\n4ch-d. The new V-CHF acknowledges by sending Charging Data Response [Initial] to new V-SMF and optionally supplies a “Roaming charging profile” to new V-SMF which overrides the default one.\n5-7c.\tRefer steps 5 to 7c in Figure 4.23.4.3-1 of TS 23.502 [201].\n7ch-a. A Charging Data Request [Termination] is sent to old V-CHF, with \" Charging Identifier 1\".\n7ch-c. The old V-CHF closes the CDR.\n7ch-d. The old V-CHF acknowledges by sending Charging Data Response [Initial] to old V-SMF.\n8a.\tNsmf_PDUSession_Update Request from new V-SMF towards the H-SMF with the \" Roaming Charging Profile\".\n8ach-a. A Charging Data Request [Update] is sent to H-CHF in HPLMN, e.g. trigged by \"Serving Node change\",  indicating the V-SMF change and \" Roaming charging profile\" if received from the VPLMN. This step occurs before SMF interacts with the UPF.\n8ach-b. The H-CHF in HPLMN updates the CDR.\n8ach-c. The H-CHF in HPLMN acknowledges by sending Charging Data Response [Update] to the H-SMF and optionally supplies the HPLMN selected \" Roaming Charging Profile\" for this VPLMN.\n8c.\tNsmf_PDUSession_Update Response from H-SMF to new V-SMF with the \" Roaming charging profile\".\n8cch-a. A Charging Data Request [Update] is sent to V-CHF with charging information received from H-SMF, when enabled trigger is armed, which includes the HPLMN selected \" Roaming charging profile\" if received.\n8cch-b. The V-CHF updates the CDR.\n8cch-c. The V-CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\n9, 17-21. Refer steps 9 and 17 to 21 in Figure 4.23.4.3-1 of TS 23.502 [201].\nThe following figure 5.2.2.12.7.1 describes the Home Routed PDU Session case in which the UE moves out of V-SMF service area in the serving PLMN to a new V-SMF service area in the serving PLMN, based on figure 4.23.4.3-1 of TS 23.502 [201], with I-SMF replaced by V-SMF in I-SMF change scenario:\nThe figure depicts a routing home routed PDU session intra-PLMN V-SMF change, showing the various routing paths and the associated changes in the routing table.\nFigure 5.2.2.12.7.1: Roaming Home routed PDU session intra-PLMN V-SMF change\n0ch-a and 0ch-b: same as in Figure 5.2.2.12.6.1.\n1-2.\tUE moves out of the old V-SMF service area, and the new AMF determines the new V-SMF service area in the same VPLMN.\n3- 4b.\tSM Context retrieval by new V-SMF from the old V-SMF. The \"Charging Identifier 1\", the \"Home roaming charging profile\", and the V-CHF address, are conveyed to the new V-SMF.\n4ch-a. A Charging Data Request [Initial] is sent to V-CHF, indicating \"in-bound roamer\" and \"Charging Identifier 1\" received on step 4b, with a trigger indicating V-SMF change.\nNOTE: Since the same V-CHF is used, the \"Home roaming charging profile\" to be used is already known by the V-CHF\n4ch-b. The V-CHF opens a CDR (indicating “in-bound roamer”).\n4ch-c. The V-CHF acknowledges by sending Charging Data Response [Initial] to new V-SMF.\n4ch-d. A Charging Data Request [Termination] is sent to V-CHF, with “Charging Identifier 1” , with a trigger indicating V-SMF change.\n4ch-e. The V-CHF closes the CDR.\n4ch-f. The V-CHF acknowledges by sending Charging Data Response [Termination] to old V-SMF.\n5-21.\tSame steps as in Figure 5.2.2.12.6.1, except the \"Roaming charging profile\" is not renegotiated, i.e., not contained in steps 8a, 8ach-a, 8ach-c, 8c and 8cch-a.\nThe flow is the same as in clause 5.2.2.12.5, with the difference in steps:\n3- 4b.\tSM Context retrieval by V-SMF from the H-SMF. The \"Charging Identifier 1\" is converted from a string to an integer and conveyed to the V-SMF. The conversion needs to be done so that the new Charging Identifier is unique within the V-SMF.\n4ch-b. A Charging Data Request [Initial] is sent to the V-CHF, indicating \"in-bound roamer\" and \"Charging Identifier 1\" as integer received on step 4b.\n8ach-a. A Charging Data Request [Update] is sent to H-CHF in HPLMN (e.g. based on PLMN change trigger), indicating the PLMN change, \"Charging Identifier 1\" as integer or string, and \"Roaming charging profile\" if received from the VPLMN.\nThe following figure 5.2.2.12.9.1 describes the Home Routed PDU Session case in which the UE moves out of V-SMF service area in the VPLMN back to the home PLMN and H-SMF service area for the registration procedure based on clause 4.23.3 of TS 23.502 [201], with I-SMF replaced by V-SMF in I-SMF removal scenario (the CHF interaction is similar for N2 (clause 4.23.7.3 of TS 23.502 [201]) and Xn based handover (clause 4.23.11.4 of TS 23.502 [201]) procedures):\nThe figure depicts a routing home routed PDU session inter-PLMN V-SMF removal, illustrating the process of removing V-SMF from the routing table. This is crucial for ensuring efficient network routing and reducing the risk of network congestion.\nFigure 5.2.2.12.x.1: Roaming Home routed PDU session inter-PLMN V-SMF removal\n0ch-a: Ongoing charging session for HPLMN for UE served by H-SMF, using \"Charging Identifier 1\".\n1.\tUE moves back to the HPLMN, and the new AMF selects the H-SMF based context information provided by the old-AMF. This corresponds to steps 1-16 as specified in clause 4.23.3 of TS 23.502[201].\n2.\tNsmf_PDUSession_CreatePDUSessionContext_Request is sent from the new-AMF to the H-SMF as specified in Step 17 of clause 4.23.3 of TS 23.502[201].\n3. \tThe H-SMF determines that the UE has returned to HPLMN and that the V-SMF is no longer required\n3ch-a. \tA Charging Data Request [Update, Roaming Charging Profile] is sent to the H-CHF, with trigger indicating removal of I-SMF.\n3ch-b. Based on the trigger, the H-CHF closes the QBC CDRs\n3ch-c,\tThe H-CHF acknowledges by sending Charging Data Response [Update] to the H-SMF.\n4. \tNsmf_PDUSession_CreatePDUSessionContext_Response is sent from the H-SMF to the new AMF.\n5. \tRegistration Procedure continues as captured in clause 4.23.3 of TS 23.502 [201].\n6. \tAfter timer expires in the Old AMF, the Old AMF deletes the context in the V-SMF by sending a Nsmf_PDUSession_ReleasePDUSessionContext_Request message.\n7. \tNsmf_PDUSession_ReleasePDUSessionContext_Response is sent from the V-SMF to the old AMF7ch-a. A Charging Data Request [Terminate] is sent to the V-CHF, with trigger indicating removal of I-SMF.\n7ch-b. Based on the I-SMF removal trigger, the V-CHF closes the V-SMF CDRs\n7ch-c.\tThe V-CHF acknowledges by sending Charging Data Response [Terminate] to the V-SMF.\nAfter UE registration to 5GC via an  non-3GPP access network, a PDU session can be established via this non-3GPP access. For following scenarios, the PDU session establishment via untrusted non-3GPP access network is specified in clause 4.12 of TS 23.502 [201] and the PDU session establishment via trusted non-3GPP access network is specified in clause 4.12a of TS 23.502 [201]:\n-\tUE initiated PDU session establishment;\n-\tHandover of a PDU Session from 3GPP access to untrusted non-3GPP access;\n-\tService Request procedures via Untrusted non-3GPP Access specified in clause 4.12.4.5 of TS 23.502 [201];\n-\tService Request procedures via Trusted non-3GPP Access specified in clause 4.12.4a.5 of TS 23.502 [201].\nHandover procedure of a PDU Session between 3GPP access and non-3GPP access is achieved by PDU Session Establishment over source access followed by PDU Session Release over the target access for respective N2 Resources Release. The PDU Session ID, IP address/prefix, and SSC mode are maintained during the move.\nPDU session over Untrusted non-3GPP Access release and Trusted non-3GPP Access release are specified in clause 4.12.7 and clause 4.12a.7 of TS 23.502 [201].\n5.2.2.13.2.1\tPDU session establishment via an untrusted non-3GPP access network\nThe following figure 5.2.2.13.2.1 describes a PDU session charging establishment via an untrusted non-3GPP access network scenario based on figure 4.12. 5.1 in TS 23.502 [201] description:\n\nFigure 5.2.2.13.2.1: PDU Session establishment via untrusted non-3GPP access\n[2ch-a to 2ch-c]. Two cases:\n-\tIn case of \"Initial request\" the same steps as steps 7ch-a to 7ch-c in figure 5.2.2.2.1 apply, for initial SMF interaction with CHF, with Charging Data Request [Initial].\n-\tIn case of \"Existing PDU Session\" the \"radio access type change\" trigger may apply for SMF interaction with CHF, with Charging Data Request [Update].\n5.2.2.13.2.2\tPDU session establishment via Trusted Non-3GPP access network\nAfter the UE registers to 5GC via trusted non-3GPP access network, the UE may request a PDU Session establishment by using the same procedure as the one specified in clause 5.2.2.13.2.1 for untrusted non-3GPP access, with the following modifications:\n-\tThe N3IWF in Figure 5.2.2.13.2.1 should be substituted with a TNGF and the Untrusted non-3GPP access should be substituted with a Trusted non-3GPP Access Point (TNAP).\n-\tCharging Data Request [Initial/Update] contains RAT type and user location specifics to trusted non-3GPP.\n-\tThe TNGF may send a TNGF Identities parameter to AMF inside an N2 Uplink NAS Transport message. The TNGF Identities parameter contains a list of identifiers (i.e. FQDNs or IP addresses) of N3 terminations supported by the TNGF. If received by the AMF, it shall forward it to the SMF, which may use it as input to UPF selection.\n5.2.2.13.3.1\tPDU session modification via an untrusted non-3GPP access network\nThe following figure 5.2.2.13.3.1 describes a PDU session charging modification via an untrusted non-3GPP access network scenario based on figure 4.12.16.1 in TS 23.502 [201] description:\n\nThe figure depicts a PDU Session modification via untrusted non-3GPP access, illustrating the process of modifying a PDU session without the necessary 3GPP access. The figure shows the PDU Session modification process, including the steps of modifying the PDU, the modification of the session, and the modification of the session's attributes. The figure also includes a visual representation of the PDU Session modification process, with arrows indicating the flow of data and the steps involved.\nFigure 5.2.2.13.3.1: PDU Session modification via untrusted non-3GPP access\n\n[2ch-a to 2ch-c]: Interaction between SMF and CHF triggered by the modification applied to the PDU session (e.g. QoS handling).\n5.2.2.13.3.2\tPDU session modification via Trusted Non-3GPP access network\nThe UE or network requested PDU Session Modification procedure via trusted non-3GPP access network is the same procedure as the one specified in clause 5.2.2.13.3.1 for untrusted non-3GPP access, with the following modifications:\n-\tThe N3IWF in Figure 5.2.2.13.3.1 should be substituted with a TNGF and the Untrusted non-3GPP access should be substituted with a Trusted non-3GPP Access Point (TNAP).\n-\tInteraction between SMF and CHF triggered by the modification contains RAT type and user location specifics to trusted non-3GPP.\n5.2.2.13.4.1\tPDU session release via an untrusted non-3GPP access network\nThe following figure 5.2.2.13.4.1 describes a PDU session charging release via an untrusted non-3GPP access network scenario based on figure 4.12.17.1 in TS 23.502 [201] description:\n\nFigure 5.2.2.13.4.1: PDU Session release via untrusted non-3GPP access\n[3cha-3chb]. Two cases:\n-\tIn case the PDU session needs to be released, SMF interaction with CHF for release, with Charging Data Request [Termination].\n-\tIn case of handover from non-3GPP access to 3GPP access, SMF may interacts with CHF, with Charging Data Request [Update].\nNOTE:\tthe \"radio access type change\" trigger, if enabled, applied during the PDU session establishment over the 3GPP access which was performed prior to this PDU session release over non-3GPP access.\n5.2.2.13.4.2\tPDU session release via Trusted Non-3GPP access network\nThe UE or the network can release a PDU Session via a trusted non-3GPP access network as specified in clause 5.2.2.13.4.1 for the untrusted non-3GPP access with the following modifications:\n-\tThe untrusted non-3GPP access is substituted by a trusted non-3GPP access point (TNAP).\n-\tThe N3IWF is substituted by the TNGF.\nWhen the I-SMF is inserted, re-allocated, or removed in a PDU Session as specified in TS 23.501 [200], the SMF may report the charging information to the CHF.\nWhen the I-SMF with UL CL/BP is inserted based on information received from SMF, the I-SMF forwards traffic usage information to the SMF as specified in TS 23.501 [200].\n\nThe following figure 5.2.2.14.2.1 describes a PDU session establishment charging, for the case where the service area of the selected SMF does not include the location where the UE camps, based on TS 23.502 [201] figure 4.3.2.2.2, where the V-SMF and V-UPF are replaced by I-SMF and I-UPF, and H-SMF and H-UPF are replaced by SMF and UPF (PSA) respectively:\n\nThe figure depicts a UE-requested PDU Session Establishment with I-SMF insertion, illustrating the process of establishing a point-to-point communication session between an UE and a base station (gNB). The figure shows the UE's request for a PDU session, the I-SMF insertion, and the subsequent communication session setup.\nFigure 5.2.2.14.2.1: UE-requested PDU Session Establishment with I-SMF insertion\n2. The AMF selects SMF and I-SMF upon SMF serving area cannot cover UE location.\n5a. I-SMF selects one or more UPFs.\n11. The SMF may perform a Session Management Policy Modification procedure to report some event to the PCF that has previously subscribed.\n11ch-a. The SMF creates a Charging Identifier for the PDU session and sends Charging Data Request [Initial] including I-SMF information to CHF for authorization for the subscriber to start the PDU session which is triggered by start of PDU session charging event.\n11ch-b. The CHF opens CDR for this PDU session.\n11ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the SMF.\n14.\tAMF to SMF: SM Request (N2 SM information).\n[19a-b]. N4 session Modification.\n19c, I-SMF notify SMF on N4 information with Traffic usage reporting.\n19ch-a. This step may occur in case \"start of service data flow\" needs quota from CHF, for the SMF to request quota for both own and I-SMF usage.\n19ch-b. The CHF updates CDR for this PDU session.\n19ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the SMF.\nNOTE 1: The steps from 19ch-a to 19ch-c for quota request from CHF are not applicable for offline only charging.\n20.\tSM Request with PDU session Update Response to AMF.\n21. SMF sends SM Context Status Notify to AMF.\n22.\tIn case of PDU Type IPv6, IPv6 Address Configuration.\nNOTE 2:\tI-SMF controlling both I-UPF and PSA2 UPF upon local traffic offload scenarios, can enforce usage report and/or quota management for PSA2 UPF.\nThe following figure 5.2.2.14.3-1 describes a PDU Session modification charging message flow, for the case where the service area of the selected SMF does not include the location where the UE camps, with simplified I-SMF with UE and Serving Network message flows , based on TS 23.502 [201] figure 4.3.3.3-1, where the V-SMF and V-UPF are replaced by I-SMF and I-UPF, and H-SMF and H-UPF are replaced by SMF and UPF (PSA) respectively:\nThe figure depicts a network scenario where a UE (User Equipment) is requesting a PDU Session Modification charging with I-SMF (Inter-SMF) involved. The network is equipped with I-SMF, which is a feature that allows for the efficient charging of PDU sessions. The figure illustrates the process of charging the PDU session, with the UE and network involved in the interaction.\nFigure 5.2.2.14.3-1: UE or network requested PDU Session Modification charging with I-SMF involved\nPDU Session served by both I-SMF and SMF has been established, with the ongoing Charging session.\n1a.\tUE or serving network AMF requested PDU Session Modification Request to I-SMF, I-SMF invokes a Nsmf_PDUSession_Update Request message to SMF, including User Location Information, QoS information and I-SMF information. SMF accept with Nsmf_PDUSession_Update_Response message to I-SMF.\n1a.ch-a. All counts are closed in SMF and a Charging Data Request [Update] message with PDU Session related triggers including I-SMF information is sent to CHF, if required by immediate report category trigger. New counts and time stamps for all active service data flows are started in the SMF.\n1a.ch-b. The CHF updates CDR for this PDU session.\n1a.ch-c. The CHF acknowledges by sending Charging Data Response [Update] message to the SMF.\n1b~1d.\tWith PCF initiated SM Policy Association Modification or UDM updated the subscription data or SMF decided to modify PDU Session triggers, SMF starts SMF requested PDU Session Modification procedures.\n1e. (R)AN initiated PDU Session Modification Request to I-SMF, I-SMF invokes a Nsmf_PDUSession_Update Request message to SMF, including User Location Information, QoS information with indication of QoS flow released and I-SMF information. SMF accept with Nsmf_PDUSession_Update_Response message to I-SMF.\n1b~1e.ch-a. All counts are closed in SMF and a Charging Data Request [Update] message with PDU Session related triggers including I-SMF information is sent to CHF, if required by immediate report category trigger. New counts and time stamps for all active service data flows are started in the SMF.\n1b~1e.ch-b. The CHF updates CDR for this PDU session.\n1b~1e.ch-c. The CHF acknowledges by sending Charging Data Response [Update] message to the SMF.\n3.\tWith SMF initiated QoS flows modification procedure, SMF invokes a Nsmf_PDUSession_Update Request message to I-SMF.\n4~14. I-SMF interacting with UE and Serving Network message flows, including the QoS rule(s) and QoS Flow level QoS parameters operations.\n15.  I-SMF invokes a Nsmf_PDUSession_Update Response message to SMF, including User Location Information, QoS flow information and I-SMF information.\n15.ch-a. All counts are closed in SMF and a Charging Data Request [Update] message with PDU Session related triggers including I-SMF information is sent to CHF, if required by immediate report category trigger. New counts and time stamps for all active service data flows are started in the SMF.\n15.ch-b. The CHF updates CDR for this PDU session.\n15.ch-c. The CHF acknowledges by sending Charging Data Response [Update] message to the SMF.\nThe following figure 5.2.2.14.4-1 describes a PDU session release charging message flow, for the case where the service area of the selected SMF does not include the location where the UE camps, with simplified I-SMF with UE and Serving Network message flows , based on TS 23.502 [201] figure 4.3.4.3-1, where the V-SMF and V-UPF are replaced by I-SMF and I-UPF, and H-SMF and H-UPF are replaced by SMF and UPF (PSA) respectively.\nThe figure depicts a network scenario where a UE (User Equipment) is requesting a PDU Session release charging with I-SMF (Inter-SMF). The figure shows the involved steps, including the release of the PDU Session, the release of the charging request, and the release of the I-SMF.\nFigure 5.2.2.14.4-1: UE or network requested PDU Session release charging with I-SMF involved\nPDU Session served by both I-SMF and SMF has been established, with the ongoing Charging session.\n1a-14. UE initiates PDU session release procedure, finally with Nsmf_PDUSession_Update Response message sent from SMF to the inserted I-SMF.\n14.ch-a. All counts are closed in SMF and a Charging Data Request [Release] message including I-SMF information is sent to CHF, with usage reporting.\n14.ch-b. The CHF close CDR for this PDU session.\n14.ch-c. The CHF acknowledges by sending Charging Data Response [Release] message to the SMF.\nPDU Session procedures with I-SMF insertion/change/removal, including below three figures described procedures covering Service Request, N2 based handover and Xn based handover.\nThe following figure 5.2.2.14.5-1 describes PDU session charging message flows, for the Service Request cases where\n-\tthe UE moves from SMF service area to new I-SMF service area, a new I-SMF is inserted (i.e. I-SMF insertion); or\n-\tthe UE moves from old I-SMF service area to new I-SMF service area, the I-SMF is changed (i.e. I-SMF change); or\n-\tthe UE moves from I-SMF service area back to SMF service area, the I-SMF is removed (i.e. I-SMF removal).\nwith simplified UE with 5GS message flows, based on TS 23.502 [201] figure 4.23.4.3-1, for I-SMF insertion, change, removal respectively, and specifies the corresponding charging message flow between SMF and CHF.\nFigure 5.2.2.14.5-1: PDU Session charging message flows for UE Triggered Service Request procedure with I-SMF insertion/change/removal\nPDU Session served by both I-SMF and SMF has been established, with the ongoing Charging session.\nPDU Session message flows for UE Triggered Service Request procedure, with I-SMF insertion/change/removal triggers charging message flows as below:\n-\tI-SMF insertion message flows, upon UE moves from SMF service area to I-SMF service area, before the SMF updates the UPF and also before Nsmf_PDUSession_Create Response message is sent from SMF to the inserted I-SMF (Detail message flows refer to TS 23.502,4.23.4.3-1 step 3 to 8a), or before the SMF updates the UPF and also before Nsmf_PDUSession_Update Response message is sent from SMF to the inserted I-SMF (Detail message flows refer to TS 23.502 [201],4.23.4.3-1 step 18 to 20a).\n-\tI-SMF change message flows, upon UE moves from old SMF service area to new I-SMF service area, before the SMF updates the UPF and also before Nsmf_PDUSession_Update Response message is sent from SMF to the inserted new I-SMF (Detail message flows refer to TS 23.502 [201],4.23.4.3-1 step 3 to 8a, or step 18 to 20a).\n-\tI-SMF removal message flows, upon UE moves from I-SMF service area back to SMF service area, finally SMF send Nsmf_PDUSession_CreateSMContext Response message to AMF (Detail message flows refer to TS 23.502,4.23.4.3-1 step 10 to 16), or SMF send Nsmf_PDUSession_UpdateSMContext Response message to AMF (Detail message flows refer to TS 23.502 [201], 4.23.4.3-1 step 22 to 25)\nx.ch-a. All counts are closed in SMF, and a Charging Data Request [Update] message including I-SMF information and “insertion/change/removal of I-SMF” trigger is sent to CHF, if required by immediate report category trigger. New counts and time stamps for all active service data flows are started in the SMF.\nx.ch-b. The CHF updates CDR for this PDU session.\nx.ch-c. The CHF acknowledges by sending Charging Data Response [Update] message to the SMF.\nNOTE 1:\tx in figure 5.2.2.14.5-1, refer to the last step number in the detail message flows. For I-SMF insertion or I-SMF change, x refers to 8a or20a. For I-SMF removal, x refers to 16 or 25.\nThe following figure 5.2.2.14.5-2 describes PDU session charging message flows, for N2 based handover, with I-SMF insertion, change, removal.\nThe figure depicts a detailed flow of charging message flows for a 5G Inter-Node Radio Access Network (NG-RAN) node N2, including the handover, execution phase, and insertion/removal of I-SMF (Inter-Switch Multiplexer) insertion/change/removal. The flow is shown in a step-by-step manner, with each step clearly labeled, allowing for easy understanding of the process.\nFigure 5.2.2.14.5-2: PDU Session charging message flows for Inter NG-RAN node N2 based handover, execution phase, with I-SMF insertion/change/removal\nPDU Session served by both I-SMF and SMF has been established, with the ongoing Charging session between SMF and CHF.\nPDU Session message flows for Inter NG-RAN node N2 based handover procedure, with I-SMF insertion/change/removal triggers charging message flows as below:\n-\tI-SMF insertion message flows, for N2 based handover, refer to TS 23.502 [201], 4.23.7.3.3-1 step 2 to 6.\n-\tI-SMF Change message flows, for N2 based handover, refer to TS 23.502 [201], 4.23.7.3.3-1 step 2 to 6,\n-\tI-SMF Removal message flows, for N2 based handover, refer to TS 23.502 [201], 4.23.7.3.3-1 step 10 to 14.\nx.ch-a. All counts are closed in SMF with the I-SMF, and a Charging Data Request [Update] message including I-SMF information and “insertion/change/removal of I-SMF” trigger is sent to CHF, if required by immediate report category trigger. New counts and time stamps for all active service data flows are started in the SMF.\nx.ch-b. The CHF updates CDR for this PDU session.\nx.ch-c. The CHF acknowledges by sending Charging Data Response [Update] message to the SMF.\nNOTE 2:\tx in figure 5.2.2.14.5-2, refer to the last step number in the detail message flows. For I-SMF insertion or I-SMF change, x refers to 6. For I-SMF removal, x refers to 14.\nThe following figure 5.2.2.14.5-3 describes PDU session charging message flows, for Xn based handover, with I-SMF insertion, change, removal.\nThe figure depicts a flow diagram for a PDU session charging message flow in a 5G network, illustrating the various stages of the charging process, including the initiation of the session, execution phase, and the insertion or removal of the I-SMF (Inter-SMF) insertion/change/removal. The diagram highlights the importance of proper handover and execution phases in ensuring reliable communication.\nFigure 5.2.2.14.5-3: PDU Session charging message flows for Xn based handover, execution phase, with I-SMFinsertion/change/removal\nPDU Session served by both I-SMF and SMF has been established, with the ongoing Charging session between SMF and CHF.\nPDU Session message flows for Xn based handover procedure, with I-SMF insertion/change/removal triggers charging message flows as below:\n-\tI-SMF insertion message flows, for Xn based handover, refer to TS 23.502 [201], 4.23.11.2-1 step 1 to 6.\n-\tI-SMF Change message flows, for Xn based handover, refer to TS 23.502 [201], 4.23.11.3-1 step 1 to 6,\n-\tI-SMF Removal message flows, for Xn based handover, refer to TS 23.502 [201], 4.23.11.4-1 step 1 to 8.\nx.ch-a. All counts are closed in SMF with the I-SMF, and a Charging Data Request [Update] message including I-SMF information and “insertion/change/removal of I-SMF” trigger is sent to CHF, if required by immediate report category trigger. New counts and time stamps for all active service data flows are started in the SMF.\nx.ch-b. The CHF updates CDR for this PDU session.\nx.ch-c. The CHF acknowledges by sending Charging Data Response [Update] message to the SMF.\nNOTE 3:\tx in figure 5.2.2.13.5-3, refer to the last step number in the detail message flows. For I-SMF insertion or I-SMF change, x refers to 6. For I-SMF removal, x refers to 8.\nWhen 5GS to EPS handover using N26 interface in idle mode, procedure in TS 23.502 [201] clause 4.23.12.2 is applicable.\nWhen 5GS to EPS handover using N26 interface in active mode, procedure in TS 23.502 [201] clause 4.23.12.6 is applicable.\nUpon UE moves from I-SMF service area to EPS service area, with both RAT Type change and I-SMF removal triggered, PGW-C+SMF and CHF will conduct below charging procedures:\nx.ch-a. All counts are closed in PGW-C+SMF with a Charging Data Request [Update] message including I-SMF information and both “RAT Type change” and “removal of I-SMF” triggers are sent to CHF, if required by immediate report category trigger. New counts and time stamps for all active service data flows are started in the PGW-C+SMF.\nx.ch-b. The CHF updates CDR for this PDU session.\nx.ch-c. The CHF acknowledges by sending Charging Data Response [Update] message to the PGW-C+SMF.\nNOTE 1:\tx refers to the last message step number with I-SMF removal in the detail message flows in TS 23.502 [201] clause 4.23.12.2 or clause 4.23.12.6.\nWhen EPS to 5GS handover using N26 interface in idle mode, procedure in TS 23.502 [201] clause 4.23.12.3 is applicable.\nWhen EPS to 5GS handover using N26 interface in active mode, procedure in TS 23.502 [201] clause 4.23.12.7 is applicable.\nUpon UE moves from EPS service area to I-SMF service area, with both RAT Type change and I-SMF insertion triggered, PGW-C+SMF and CHF conduct below charging procedures:\nx.ch-a. All counts are closed in PGW-C+SMF with a Charging Data Request [Update] message including I-SMF information and both “RAT Type change” and “insertion of I-SMF” triggers are sent to CHF, if required by immediate report category trigger. New counts and time stamps for all active service data flows are started in the PGW-C+SMF.\nx.ch-b. The CHF updates CDR for this PDU session.\nx.ch-c. The CHF acknowledges by sending Charging Data Response [Update] message to the PGW-C+SMF.\nNOTE 1:\tx refers to the last message step number with I-SMF insertion in the detail message flows in TS 23.502 [201] clause 4.23.12.3 or clause 4.23.12.7.\nThis clause is based on TS 23.502 clause 4.23.9.1, 4.23.9.2 and 4.23.9.3 procedures, describes simplified procedures of addition/removal/change of PSA and UL CL or BP controlled by I-SMF, adding with charging message flow:\nThe figure depicts a schematic representation of a 5G network, illustrating the signal propagation in a 5G network. It shows how signals reflect off buildings (NLOS) and combine at the receiver. Key components include the base station (gNB), user equipment (UE), and scatterers. The diagram highlights beamforming techniques to mitigate interference.\nFigure 5.2.2.14.8-1: Addition/removal/change of PSA and UL CL or BP controlled by I-SMF\nPDU Session served by both I-SMF and SMF has been established, with the ongoing Charging session.\nPDU Session message flows with addition/removal/change of I-SMF controlled addition/removal/change of PSA and UL CL/BP with charging message flows as below:\n-\tAddition of PDU Session Anchor (PSA2) for UL CL/BP controlled by I-SMF message flows, refer step 2 to step 4 described in figure 4.23.9.1-1 of TS 23.502[201].\n-\tRemoval of PDU Session Anchor (PSA2) for UL CL/BP controlled by I-SMF message flows, refer step 2 to step 9 described in figure 4.23.9.2-1 of TS 23.502[201].\n-\tChange of PDU Session Anchor (PSA0 to PSA2) for UL CL/BP controlled by I-SMF message flows, refer step 2 to step 3 and step 4 to step 10 described in figure 4.23.9.3-1 of TS 23.502[201].\nx.ch-a. All counts are closed in SMF for I-SMF controlled local PSA traffic, and a Charging Data Request [Update] message including I-SMF information and “addition/removal of UPF” trigger is sent to CHF, if required by immediate report category trigger. New counts and time stamps for all addition of PSA active service data flows are started in the SMF.\nx.ch-b The CHF updates the CDR for this PDU Session.\nx.ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the SMF.\nNOTE 1:\tx in figure 5.2.2.14.8-1, refer to the last step number in the detail message flows. For addition of PDU Session Anchor (PSA2), x refers to 4. For removal of PDU Session Anchor (PSA2), x refers to 9. For addition of PDU Session Anchor (PSA2) during change of PSA2, x refers to 3.\nRemoval of PDU Session Anchor (PSA0) for UL CL/BP controlled by I-SMF message flows, refer step 4 to step 10 described in figure 4.23.9.3-1 of TS 23.502[201].\n10.ch-a. All counts are closed in SMF for I-SMF controlled the PSA0 traffic, and a Charging Data Request [Update] message including I-SMF information and “removal of UPF” trigger is sent to CHF, if required by immediate report category trigger.\n10.ch-b The CHF updates the CDR for this PDU Session.\n10.ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the SMF.\nNOTE 2:\tsteps 10.ch-a to 10.ch-c are only applied in Change of PDU Session Anchor (PSA0 to PSA2) procedure.\nThis clause specifies PDU session charging for a MA PDU session as defined in TS 23.501 [200].\nThe flows are based on message flows specified in clause 4.22 TS 23.502 [201],\nThe following figure 5.2.2.15.2.1 describes charging procedure for MA PDU Session establishment requested by UE, based on figure 5.2.2.2.2.1 description with the following differences identified in clause 4.22.2.1 TS 23.502 [202]:\nThe figure depicts a 5G network scenario where a UE (User Equipment) is requesting a session establishment for a Multiprotocol Access (MPA) PDU. The figure illustrates the process of establishing a session, including the request, response, and possible error scenarios.\nFigure 5.2.2.15.2.1: UE Requested MA PDU session establishment\n-\tThe UE is registered in both 3GPP access and non-3GPP access, and UE PDU Session Establishment Request message is sent over the 3GPP access.\n1.\tPDU Session Establishment Request is indicated with \"MA PDU Request\" and ATSSS Capability (e.g. an \"MPTCP Capability\" and/or an \"ATSSS-LL Capability\").\n2-3.\tThe AMF informs the SMF that the request is for a MA PDU Session and indicates the UE is registered over both accesses.\n7a-b.\tPCC Rules supplied by PCF contain ATSSS policy control information, optionally with a dedicated non-3GPP access rating group. From these PCC Rules, the SMF derives ATSSS rules for uplink and N4 rules for downlink for controlling the traffic steering, switching and splitting.\n9ch-a.\tThe SMF sends Charging Data Request [initial] indicating \"MA PDU session requested by UE\" to CHF for authorization for the subscriber to start the MA PDU session.\n9ch-b.\tThe CHF opens CDR for this MA PDU session.\n9ch-c.\tThe CHF acknowledges by sending Charging Data Response [Initial] to the SMF.\n10-13.\tProcedure based on ATSSS policy and SMF derived both N4 Rules and ATSSS rules to UE.\n16ch-a.\tThis step may occur in case \"start of service data flow\" over 3GPP needs quota from CHF for appropriate rating group, the SMF sends Charging Data Request [Update] for requesting quota.\n16ch-b.\tThe CHF updates CDR for this MA PDU session.\n16ch-c.\tThe CHF acknowledges by sending Charging Data Response [Update] to the SMF.\nAfter step 18 in figure 5.2.2.2.2.1, if the SMF was informed in step 2 that the UE is registered over both accesses, the SMF initiates the establishment of user-plane resources over non-3GPP access via AMF. After the user plane is established with the non-3GPP access:\nXch-a.\tThe SMF sends Charging Data Request [Update]. This step may occur in case following chargeable events need quota from CHF for appropriate rating group, or if required by \"immediate reporting\" category:\n-\t\"start of SDF additional access\" over non-3GPP.\n-\t\"start of service data flow\" over non-3GPP or 3GPP.\nXch-b.\tThe CHF updates CDR for this MA PDU session.\nXch-c.\tThe CHF acknowledges by sending Charging Data Response [Update] to the SMF.\nIn the scenario where the PDU Session Establishment Request message for the MA PDU session is sent over the non-3GPP access, and the user plane over the non-3GPP access is established before the user plane over 3GPP:\n16ch-a.\tThis step may occur in case \"start of service data flow\" over non-3GPP needs quota from CHF for appropriate rating group, or if required by \"immediate reporting\" category\nXch-a.\tThis step may occur in case following chargeable events need quota from CHF for appropriate rating group, or if required by \"immediate reporting\" category:\n-\t\"start of SDF additional access\" over 3GPP.\n-\t\"start of service data flow\" over non-3GPP or 3GPP.\nThe following flow describes the charging procedure for a single access PDU session establishment by ATSSS-capable UE and the 5GC network decides to convert to a Multi-Access PDU (MA PDU) Session, based on figure 5.2.2.2.2.1 description with the following differences identified in clause 4.22.3 TS 23.502 [202]:\n-\tThe UE is registered in both 3GPP access and non-3GPP access and sends a PDU Session Establishment Request message over the 3GPP access.\n1.\tPDU Session Establishment Request may include \"MA PDU Network-Upgrade Allowed\" indication and its ATSSS Capability.7.\tThe single-access PDU Session requested by the UE is converted into a MA PDU Session by SMF based on \"MA PDU Network-Upgrade Allowed\" indication, and PCC Rules are supplied by PCF containing ATSSS policy control information optionally with a dedicated non-3GPP access rating group.\n9ch-a. The SMF sends Charging Data Request [initial] indicating \"MA PDU session requested by Network modification\" to CHF.\n9ch-b. The CHF opens CDR for this MA PDU session.\n9ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the SMF.\nSteps after step 10 in clause 5.2.2.15.2 apply.\nThe charging procedure for single access PDU session establishment requested by ATSSS-capable UE and converted to a Multi-Access PDU (MA PDU) Session by the 5GC network in roaming Home routed scenario, is based on figures in clause 5.2.2.15.X. and description in clause 4.22.3 TS 23.502 [202].\nThe charging procedure for UE registered to the same VPLMN over 3GPP access and non-3GPP access is based on figure 5.2.2.15.X.1.1 with differences identified in clause 4.22.3 TS 23.502 [202]:\n-\tThe UE is registered to the same VPLMN over 3GPP access and non-3GPP access, and UE PDU Session Establishment Request message is sent over the 3GPP access.\n1-3a.\tUE PDU Session Establishment Request may include \"MA PDU Network-Upgrade Allowed\" indication and its ATSSS Capability. This indication may be conveyed by AMF to V-SMF.\n6. The V-SMF provides the \"MA PDU Network-Upgrade Allowed\" indication to H-SMF, if received from AMF together with an indication whether the UE is registered over both accesses.\n9a-b.  The single-access PDU Session received by H-SMF with \"MA PDU Network-Upgrade Allowed\" indication is converted into a MA PDU Session. PCC Rules are supplied by PCF containing ATSSS policy control information optionally with a non-3GPP access dedicated rating group.\n11ch-a to c.\tSame steps as in figure 5.2.2.12.2.1 with Charging Data Request [Initial] indicating \"MA PDU session requested by the Network\".\nThe charging procedure for MA PDU Session establishment requested by UE in roaming Home routed scenario is based on figure 5.2.2.12.2.1 and description in clause 4.22.2.2 TS 23.502 [202].\nThe following figure 5.2.2.15.5.2.1 describes charging procedure for MA PDU session charging establishment requested by UE in roaming Home routed scenario for UE registered to the same VPLMN over 3GPP access and non-3GPP access:\n\nThe figure depicts a typical session setup in a 5G network, where an UE (User Equipment) requests a MA (Multiplex Access) PDU session. The session is routed through a Home Routed path, which is the same VPLMN (Virtual Private LAN) as the UE's VPLMN. This setup ensures efficient network traffic management and supports the use of multiple paths for data transmission.\nFigure 5.2.2.15.5.2.1: UE requested MA PDU session - Roaming Home Routed - same VPLMN\n-\tThe UE is registered to the same VPLMN over 3GPP access and non-3GPP access, and UE PDU Session Establishment Request message is sent over the 3GPP access.\n1-3a.\tUE initiates a new PDU session indicated with \"MA PDU Request\" and ATSSS Capability. Selection by the AMF of V-SMF which supports MA PDU sessions. The AMF indicates to V-SMF that the UE is registered over both accesses\n3ch-a to 3ch-d. Same steps as in figure 5.2.2.12.2.1.\n6. The V-SMF informs the H-SMF that the request is for a MA PDU Session and the UE is registered over both accesses.\n9a-b.  PCC rules are supplied by H-PCF containing MA PDU session control information based on currently used list of Access Type(s) and RAT Type(s). The H-SMF initiates the establishment of user-plane resources over non-3GPP access and derives the ATSSS rules for the UE and the N4 rules for the H-UPF.\n11ch-a to c.\tSame steps as in figure 5.2.2.12.2.1 with Charging Data Request [Initial] indicating \"MA PDU session requested by UE\".\n12ch. Counts per QFI are started for both 3GPP and non-3GPP accesses.\n13.\tNsmf_PDUSession_Create Response from H-SMF to V-SMF with \"MA PDU session Accepted\" indication.\n13ch-a to c.\tSame steps as in figure 5.2.2.12.2.1. Counts per QFI are started for both 3GPP and non-3GPP accesses.\n14-19b.\tProcedure in the VPLMN for 3GPP access and based on H-SMF derived ATSSS rules to UE for the MA PDU session.\nXch-a. The H-SMF sends Charging Data Request [Update]. This step may occur in case \"start of service data flow\" chargeable event over 3GPP, when required by \"immediate reporting\" category.\nXch-b.\tThe H-CHF updates CDR for this MA PDU session.\nXch-c.\tThe H-CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\nAfter the user plane resources are established over non-3GPP access in VPLMN, and traffic goes through between VPLMN and HPLMN over non-3GPP access:\nYch-a.\tThe H-SMF sends Charging Data Request [Update] to H-CHF. This step may occur in case \"start of service data flow \" chargeable event over non-3GPP, when required by \"immediate reporting\" category.\nYch-b.\tThe H-CHF updates CDR for this MA PDU session.\nYch-c.\tThe H-CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\nThe charging procedure for MA PDU Session 5GS to EPS handover using N26 interface scenario is based on figure 5.2.2.11.2.1 description with the differences identified in clause 4.22.6.2.1 TS 23.502 [202]:\n0ch. A charging session between the PGW-C+SMF and CHF exists for the MA PDU Session with multiple QoS Flows over 3GPP access and non-3GPP access.\n16ch-a. MA PDU session moved to EPS: All counts affected by the MA PDU session move to EPS are closed and a Charging Data Request [Update] is sent to CHF, if required by \"RAT type change\" trigger. New counts and time stamps for all active service data flows are started in the PGW-C+SMF.\nMA PDU Session Release procedure over non-3GPP access triggered by PGW-C+SMF:  All counts affected by the release of non-3GPP access are closed by \"Termination of service data flow\" trigger.\nThe charging procedure for MA PDU Session 5GS to EPS mobility without using N26 interface scenario is based on figure 5.2.2.11.6.1 description with the differences identified in clause 4.22.6.2.5 TS 23.502 [202]:\n0. UE is registered in 5GS and MA PDU Session is over both 3GPP and non-3GPP accesses.\n10.\tE-UTRAN Initial attach procedure:\n10ch-a. MA PDU Session is moved to EPS: All counts affected by the MA PDU session move to EPS are closed and a Charging Data Request [Update] is sent to CHF, if required by \"Handover start\" trigger. New counts and time stamps for all active service data flows are started in the PGW-C+SMF\n10ch-b. The CHF updates CDR for this PDU session.\n10ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+SMF.\nThe PGW-C + SMF triggers the MA PDU Session Release procedure over non-3GPP access: All counts affected by the release of non-3GPP access are closed by \"Termination of service data flow\" trigger.\n14. The PGW-C+SMF initiates release of the 5GS MA PDU Session(s) transferred to EPS.\nThe following flow describes the charging procedure for MA PDU Session establishment over NG-RAN and W-5GAN requested by 5G-RG, based on figure 5.2.2.15.2.1 description with the following differences identified in clause 4.12.2 TS 23.316 [203]:\n-\tThe UE is replaced by 5G-RG.\n-\tNon-3GPP access(es) is specifically referred to wireline access.\nWhen PDU Session Establishment Request message is sent over the 3GPP access (i.e. NG-RAN), or sent over the non-3GPP access (i.e. W-5GAN):\n9ch-a.\tThe SMF sends Charging Data Request [initial] to CHF for authorization for the 5G-RG to start the MA PDU session.\n9ch-b.\tThe CHF opens CDR for this MA PDU session.\n9ch-c.\tThe CHF acknowledges by sending Charging Data Response [Initial] to the SMF.\nThe following flow describes the charging procedure for MA PDU Session establishment over E-UTRAN/EPC and W-5GAN requested by 5G-RG using EPC interworking procedures, based on clause 4.12.3 TS 23.316 [203]:\nThe figure depicts a 5G-RG session establishment request by an EPC (Enhanced Packet Classification) to the 5G-PDU (Packet Data Unit) for a 5.8 GHz 100 Mbps session. The figure shows the various components involved in the session establishment process, including the EPC, 5G-PDU, and the 5.8 GHz frequency band. The figure also highlights the importance of proper network management and coordination to ensure efficient and reliable communication.\nFigure 5.2.2.15.8.1: MA PDU session establishment requested by 5G-RG via EPC\n-\tThe 5G-RG is registered in EPC.\n1.\t5G-RG initiates PDN Connection establishment via E-UTRAN, indicating the PDN Connection is requested to be associated with a MA PDU Session and its \"ATSSS-LL Capability\".\n2. Create session request in EPC to the selected PGW-C+SMF with the indication the PDN Connection is requested to be associated with a MA PDU Session.\n2ch-a.\tThe PGW-C+ SMF sends Charging Data Request [initial] indicating \"MA PDU session requested\" to CHF for authorization for the 5G-RG to use the PDN connection for a MA PDU session.\n2ch-b.\tThe CHF opens CDR for this PDN connection.\n2ch-c.\tThe CHF acknowledges by sending Charging Data Response [Initial] to the PGW-C+ SMF.\n3. Create session response indicating the request for using the PDN Connection for MA-PDU Session is accepted.\n4-5. User Plane resources establishment for E-UTRAN\n5ch-a.\tThis step may occur in case \"start of service data flow\" over 3GPP needs quota from CHF for appropriate rating group, the PGW-C+ SMF sends Charging Data Request [Update] for requesting quota.\n5ch-b.\tThe CHF updates CDR for this PDN connection.\n5ch-c.\tThe CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+ SMF.\n6. PDN connection establishment continuation\n7.  5G-RG sends a PDU Session Establishment Request indicating \"MA PDU Request\" to establish W-5GAN user-plane resources.\nWhen the user plane is established with W-5GAN (X corresponds to step 16a-b of figure 5.2.2.2.2.1 for the W-5GAN):\nXch-a.\tThe PGW-C+ SMF sends Charging Data Request [Update]. This step may occur if required by \"addition of access\" trigger.\nXch-b.\tThe CHF updates CDR for this MA PDU session.\nXch-c.\tThe CHF acknowledges by sending Charging Data Response [Update] to the SMF.\nAfter the user plane is established:\nYch-a.\tThe PGW-C+ SMF sends Charging Data Request [Update]. This step may occur in case \"start of service data flow\" chargeable event needs quota from CHF for appropriate rating group, or if required by \"immediate reporting\" category.\nYch-b.\tThe CHF updates CDR for this MA PDU session.\nYch-c.\tThe CHF acknowledges by sending Charging Data Response [Update] to the PGW-C+ SMF.\nIn the scenario where the MA PDU Session is requested via 5GC/W-5GAN, the 5G-RG is registered to EPC and user-plane resources are added on 3GPP access over EPC, the following applies:\nMA PDU session establishment via 5GC/W-5GAN per figure 5.2.2.15.2.1 until step 18 with PDU Session Establishment Request message for the MA PDU session sent over W-5GAN (i.e. non-3GPP access).\nAfter step 18 of figure 5.2.2.2.2.1, the 5G-RG sends a PDN Connection Establishment Request via E-UTRAN, indicating \"handover\" and \"MA PDU Request\".\nWhen the user plane is established with E-UTRAN over EPC:\nXch-a.\tThe PGW-C+ SMF sends Charging Data Request [Update]. This step may occur if required by \"addition of access\" trigger.\nAfter the user plane is established with E-UTRAN over EPC:\nYch-a.\tThis step may occur in case \"start of service data flow\" chargeable event needs quota from CHF for appropriate rating group, or if required by \"immediate reporting\" category.\n\nAfter registration management procedures to 5GC via wireline access network, a PDU session can be established via this wireline access, as specified in TS 23.316 [203] for different scenarios:\n-\t5G-RG connected via NR-RAN and W-5GAN;\n-\tFN-RG connected via W-5GAN.\nNOTE:\tThe charging procedures related to UE behind the 5G-RG and FN-RG are covered in clause 5.2.2.13.\nThe following figure 5.2.2.16.2.1 describes charging when 5G-RG requests a PDU session establishment via W-AGF.\n1)\tThe 5G-RG connects to a W-5GAN and the W-AGF sends an EAP-Request/5G-Start packet over the W-CP connection as described in clause 7.3.1.1 in TS 23.316 [203].\n2)\tThe steps are specified as step 2-7 in clause 4.3.2.1 of TS 23.502 [202].\n3ch-a. The SMF creates a Charging Identifier for the PDU session and sends Charging Data Request [Initial] to CHF for authorization for the subscriber information via wireline network to start the PDU session which is triggered by start of PDU session charging event.\n3ch-b. The CHF opens CDR for this PDU session.\n3ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the SMF.\n4)\tThe steps of PDU session establishment are specified in clause 7.3.1.1 of TS 23.316 [203].\nThe following figure 5.2.2.16.3.1 describes charging when FN-RG requests a PDU session establishment via W-AGF. As described in clause 7.3.4 in TS 23.316 [203], after the registration procedure is completed, the W-AGF may establish PDU session(s) on behalf of the FN-RG.\n\nFigure 5.2.2.16.3.1: charging when FN-RG requests a PDU session establishment via W-AGF\n1)\tAfter the registration procedure is completed, the W-AGF may establish PDU session(s) on behalf of the FN-RG as described in clause 7.3.4 in TS 23.316 [203].\n2)\tThe steps are specified as step 2-9 in clause 4.3.2.2.1 of TS 23.502 [202].\n3ch-a. The SMF creates a Charging Identifier for the PDU session and sends Charging Data Request [Initial] to CHF for authorization for the subscriber identified under wireline network to start the PDU session which is triggered by start of PDU session charging event.\n3ch-b. The CHF opens CDR for this PDU session.\n3ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the SMF.\n4)\tThe steps of PDU session establishment are specified in clause 7.3.4 of TS 23.316 [203].\nFollowing figure 5.2.2.16.4.1.1 describes charging when 5G-RG handover of a PDU Session procedure from W-5GAN access to 3GPP access.\nThe figure depicts a handover of a PDU session from a W-5 GAN access to a 3GPP access, illustrating the transition from one network to another.\nFigure 5.2.2.16.4.1.1: Handover of PDU session from W-5GAN access to 3GPP access\nAs described in clause 7.6.2.1 in TS 23.316 [203], the handover of a PDU session from W-5GAN access to 3GPP access is as following.\n1-2)\tThe steps are described in clause 7.6.2.1 in TS 23.316 [203], 5G-RG peforms registeration via 3GPP access and PDU session establishmeng procedure.\n2ch-a-c. SMF may interact with CHF with Charging Data Request [Update].This step occurs in case \"RAT type change\" triggers, if required by \"immediate reporting\" category. The RAT type change trigger, if enabled, applied during the PDU session establishment via the 3GPP access network before SMF executes the release of W-5GAN access resource. Which RAT type used is described in clause 5.3.2.3 of TS 23.501 [200].\nNOTE: Void\n3. The step that the SMF executes the release of resources in W-5GAN access is same as step 3 as described in clause 7.6.3.1 of TS 23.316 [203].\nFollowing figure 5.2.2.16.4.2.1 describes charging when 5G-RG handover of a PDU Session procedure from 3GPP to W-5GAN access.\nThe figure depicts a handover procedure for a PDU session from 3GPP to W-5GAN access in the 4.2.1 section of the 3GPP standard. The figure illustrates the steps involved in the handover process, including the handover request, handover request response, and the handover process itself. The figure also includes a visual representation of the handover process, such as the handover request, handover response, and the handover process itself.\nFigure 5.2.2.16.4.2.1: Handover of a PDU Session procedure from 3GPP to W-5GAN access\nAs described in clause 7.6.3.2 in TS 23.316 [203], the handover of a PDU session from 3GPP access to W-5GAN access is as following.\n1)\tThe 5G-RG initiates Reigistration procedure via W-5GAN as defined in clause 7.2.1.1 of TS 23.316 [203].\n2)\tThe 5G-RG performs PDU Session Establishment procedure via W-5GAN access as described in 7.6.3.2 of TS 23.316 [203].\n2ch-a-c. SMF may interact with CHF with Charging Data Request [Update]. This step occurs in case \"RAT type change\" triggers, if required by \"immediate reporting\" category The RAT type change trigger, if enabled, applied during the PDU session establishment via the W-5GAN before SMF performs the release of 3GPP access resource. Which RAT type used is described in clause 5.3.2.3 of TS 23.501 [200].\nNOTE: Void\n3)\tThe step that the SMF executes the release of resource via 3GPP access is same as step 3 as described in clause 7.6.3.2 of TS 23.316 [203].\nSupport highly reliable URLLC services is specified in TS 23.501 [200] clause 5.33 procedures and TS 23.502 [201] message flows for different scenarios:\n-\tDual Connectivity based end to end Redundant User Plane Paths.\n-\tSupport of redundant transmission on N3/N9 interfaces.\n-\tSupport for redundant transmission at transport layer.\n-\tDual Connectivity based end to end Redundant User Plane Paths\nThe charging message flow of PDU session establishment for supporting Dual Connectivity based end to end Redundant User Plane Paths, is based on Figure 5.2.2.2.2-1 description with the differences identified in clause 4.3.2.2.1.1 TS 23.502 [202].\nIn the Step 9ch-a, if the PDU Session requires redundancy, SMF sends the Charging Data Request [Initial] with the redundant transmission information.\nIf the PDU session establishment without redundancy handling based on local policy, SMF sends the Charging Data Request [Initial] as descriped in Figure 5.2.2.2.2-1. CHF considers the PDU session is used for the non-redundant transmission.\n-\tRedundant transmission on N3/N9 interfaces\nThe charging message flow of PDU session establishment for supporting redundant transmission on N3/N9 interfaces, is based on Figure 5.2.2.2.2-1 description with the differences identified in clause 4.3.2.2.1.1 TS 23.502 [202].\nAs described in clause 5.33.1.2 of TS 23.501 [201], SMF decides to perform redundant transmission for one or more QoS Flows at the step 10.\nIn the Step 16ch-a，the SMF sends the Charging Data Request [Update] with the redundant transmission information.\n-\tRedundant transmission at transport layer\nThe charging message flow of PDU session establishment for supporting redundant transmission at transport layer, is based on Figure 5.2.2.2.2-1 description with the differences identified in clause 4.3.2.2.1.1 TS 23.502 [202].\nAs per the clause 5.33.2.3 TS 23.501[201], the knowledge of supporting redundant transmission at transport layer can be configured in the SMF, or be configured in UPF and then obtained by the SMF via N4 capability negotiation during N4 Association setup procedure.\nIn the Step 16ch-a, SMF sends the Charging Data Request [Update] with the redundant transmission information.\nFor redundant transmission on N3/N9 interfaces, the charging message flow of PDU session modification is based on Figure 5.2.2.2.3-1 description with the differences identified in clause 4.3.3.2 TS 23.502 [202].\n2ch-a. \tIf redundant transmission has not been activated to the PDU session and the SMF performs redundant transmission for the QoS Flow in step 2a, the SMF sends Charging Data Request [Update] to the CHF for the PDU session, with the trigger \"Redundant transmission change\".\nIf redundant transmission has been activated on the PDU Session, and the SMF stops redundant transmission in step 2a, the SMF sends Charging Data Request [Update] to the CHF for the PDU session, with the trigger \"Redundant transmission change\".\n2ch-b. The CHF update the CDR for the URLLC.\n2ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the SMF.\nFor redundant transmission on N3/N9 interfaces, the charging message flow of PDU session release is based on Figure 5.2.2.2.4-1 description with the differences identified in clause 4.3.4.2 TS 23.502 [202].\n2ch-a. The SMF sends Charging Data Request [Termination] to the CHF for terminating the charging associated with PDU session in each UPF, with the trigger \"End of PDU session\".\n2ch-b. The CHF closes the CDR for the URLLC.\n2ch-c. The CHF acknowledges by sending Charging Data Response [Termination] to the SMF.\nThe clause below describes PDU session charging in roaming with local breakout scenarios.\nThe following figure 5.2.2.18.2-1 describes a PDU session establishment charging, based on figure 4.3.2.2.1-1 UE-requested PDU Session Establishment for non-roaming and roaming with local breakout TS 23.502 [201], where the V-SMF interacts with H-CHF and V-CHF.\nThe figure depicts a PDU session establishment process in a 5G network, with the PDU (Physical to Logical) session established between the Service Modes (SM) and the H-CHF (Hierarchical Channel Handover Function) and V-CHF (Virtual Channel Handover Function) interfaces. The process involves the use of a Service M (SM) to establish a PDU session with the H-CHF and V-CHF interfaces, ensuring efficient communication and data transfer.\nFigure 5.2.2.18.2-1: PDU session establishment, SMF to H-CHF and V-CHF\n9ch-a. The UE is identified as a roamer (e.g., PLMN ID of the received SUPI is different from VPLMN PLMN ID), the V-CHF and optionally H-CHF are selected accordingly.\n9ch-b1. The Charging Data Request [Initial] is sent to V-CHF, for the subscriber triggered by start of PDU session charging event.\n9ch-c1. The V-CHF opens a CDR.\n9ch-d1. The V-CHF acknowledges by sending Charging Data Response [Initial] to the V-SMF and optionally supplies a \"Roaming charging profile\" to the V-SMF (which overrides the default one).\n9ch-b2. If a H-CHF was selected a Charging Data Request [Initial] is sent to H-CHF, triggered by, e.g. \"start of PDU session\",with Charging Identifier, and with or without quota management and optionally including the \"Roaming charging profile\".\n9ch-c2. The H-CHF opens a CDR.\n9ch-d2. The H-CHF acknowledges by sending Charging Data Response [Initial] to the V-SMF and optionally supplies a \"Roaming charging profile\" to the V-SMF.\n10ch-a1. The Charging Data Request [Update] is sent to V-CHF with QBC and/or FBC information, when enabled triggers are met, optionally including the  \"Roaming charging profile\".\n10ch-b1. The V-CHF update the CDR.\n10ch-c1. The V-CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\n10ch-a2. If a H-CHF was selected a Charging Data Request [Update] is sent to H-CHF with QBC and/or FBC information, when enabled triggers are met, for FBC it may include a request for quota.\n10ch-b2. The H-CHF update the CDR.\n10ch-c2. The H-CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\nThe following figure 5.2.2.18.3-1 describes the PDU session modification charging, based on figure 4.3.3.2-1 UE or network requested PDU Session Modification (for non-roaming and roaming with local breakout) TS 23.502 [201], where the V-SMF interacts with H-CHF and V-CHF.\nThe figure depicts a PDU Session Modification (SMF) process in a 1800 MHz 3-1 system, with a focus on the 3-1 interface. The SMF involves the modification of the PDU Session Identifier (PSID) to the H-CHF and V-CHF interfaces. This process is crucial for ensuring efficient communication between the PDU and the H-CHF and V-CHF interfaces, as well as for managing the PDU Session Identifier (PSID) in the 3-1 system.\nFigure 5.2.2.18.3-1: PDU Session Modification, SMF to H-CHF and V-CHF\n2ch-a1. The Charging Data Request [Update] is sent to V-CHF for reporting the QBC and/or  FBC information when enabled triggers are met.\n2ch-b1. The V-CHF update the CDR.\n2ch-c1. The V-CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\n2ch-a2. If a H-CHF was selected a Charging Data Request [Update] is sent to H-CHF with QBC and/or FBC information, when the enabled triggers are met, and for FBC it may include a request for quota.\n2ch-b2. The H-CHF update a CDR.\n2ch-c2. The H-CHF acknowledges by sending Charging Data Response [Update] to the V-SMF.\nThe following figure 5.2.2.18.4-1 describes the PDU session release charging, based on figure 4.3.4.2-1 UE or network requested PDU Session Release for non-roaming and roaming with local breakout TS 23.502 [201], where the V-SMF interacts with H-CHF and V-CHF.\nThe figure depicts a PDU session release, SMF to H-CHF and V-CHF, which is a crucial step in the data transmission process in a telecommunications network.\nFigure 5.2.2.18.4-1: PDU Session Release, SMF to H-CHF and V-CHF\n2ch-a1. The Charging Data Request [Termination] is sent to V-CHF.\n2ch-b1. The V-CHF close the CDR.\n2ch-c1. The V-CHF acknowledges by sending Charging Data Response [Termination] to the V-SMF.\n2ch-a2. If a H-CHF was selected a Charging Data Request [Termination] is sent to H-CHF.\n2ch-b2. The H-CHF close the CDR.\n2ch-c2. The H-CHF acknowledges by sending Charging Data Response [Termination] to the V-SMF.\nThe following figure 5.2.2.18.5-1 describes a PDU session establishment charging, based on figure 4.3.2.2.1-1 UE-requested PDU Session Establishment for non-roaming and roaming with local breakout TS 23.502 [201], where the V-SMF interacts with V-CHF and V-CHF interacts with H-CHF.\nThe figure depicts a PDU session establishment process in a V-SMF to V-CHF network, illustrating the steps involved in establishing a session between two devices. The diagram shows the flow of data between the two devices, with the PDU (Physical Device Unit) acting as the central point of communication. The V-SMF (Virtual Server Manager) and V-CHF (Virtual Client Handler) are the two endpoints of the session, with the PDU acting as the intermediary between them. The figure provides a visual representation of the complex network architecture, highlighting the importance of proper network design and management.\nFigure 5.2.2.18.5-1: PDU session establishment, V-SMF to V-CHF\n9ch-a.\tThe UE is identified as a roamer (e.g., PLMN ID of the received SUPI is different from VPLMN PLMN ID), the V-CHF is selected.\n9ch-b.\tThe Charging Data Request [Initial] is sent to V-CHF, for the subscriber triggered by start of PDU session charging event, with or without quota management, and optionally including the \"Roaming charging profile\".\n9ch-c.\tThe V-CHF opens a CDR, and optionally H-CHF is selected.\n9ch-d. If a H-CHF was selected a Charging Data Request [Initial] is sent to H-CHF, with or without quota management, and optionally including the \"Roaming charging profile\".\n9ch-e.\tThe H-CHF opens a CDR.\n9ch-f. The H-CHF acknowledges by sending Charging Data Response [Initial] to the V-CHF and optionally includes a \"Roaming charging profile\".\n9ch-f.\tThe V-CHF forwards the acknowledgement by sending Charging Data Response [Initial] to the V-SMF and optionally includes a \"Roaming charging profile\" (which overrides the default one).\n10ch-a.\tThe Charging Data Request [Update] is sent to V-CHF with QBC and/or FBC information, when enabled triggers are met, optionally including the new \"Roaming charging profile\", and for FBC it may include a request for quota.\n10ch-b.\tThe V-CHF update the CDR.\n10ch-c. If a H-CHF was selected a Charging Data Request [Update] is sent to H-CHF with QBC and/or FBC information, when enabled triggers are met, for FBC it may include a request for quota.\n10ch-d. The H-CHF update the CDR.\n10ch-e. The H-CHF acknowledges by sending Charging Data Response [Update] to the V-CHF.\n10ch-f. The V-CHF forwards the acknowledgement by sending Charging Data Response [Update] to the V-SMF.\nThe following figure 5.2.2.18.6-1 describes the PDU session modification charging, based on figure 4.3.3.2-1 UE or network requested PDU Session Modification (for non-roaming and roaming with local breakout), where the V-SMF interacts with V-CHF and V-CHF interacts with H-CHF.\n\n\nFigure 5.2.2.18.6-1: PDU Session Modification, SMF to V-CHF\n2ch-a.\tThe Charging Data Request [Update] is sent to V-CHF for reporting the QBC and/or FBC information when enabled triggers are met, and for FBC it may include a request for quota.\n2ch-b.\tThe V-CHF update the CDR.\n2ch-c.\tIf a H-CHF was selected a Charging Data Request [Update] is sent to H-CHF with QBC and/or FBC information, when the enabled triggers are met, and for FBC it may include a request for quota.\n2ch-d.\tThe H-CHF update a CDR.\n2ch-e.\tThe H-CHF acknowledges by sending Charging Data Response [Update] to the V-CHF.\n2ch-f.\tThe V-CHF forwards the acknowledgement by sending Charging Data Response [Update] to the V-SMF.\nThe following figure 5.2.2.18.7-1 describes the PDU session release charging, based on figure 4.3.4.2-1 UE or network requested PDU Session Release for non-roaming and roaming with local breakout TS 23.502 [201] , where the V-SMF interacts with V-CHF and V-CHF interacts with H-CHF.\nThe figure depicts a PDU Session Release event in a 5G network, where a session is released from the source to the destination. The SMF (Session Management Function) is connected to the V-CHF (Virtual Channel Handover Function) to facilitate the session release. This event is crucial for ensuring the smooth operation of 5G networks, as it allows for the release of sessions between different network segments.\nFigure 5.2.2.18.7-1: PDU Session Release, SMF to V-CHF\n2ch-a.\tThe Charging Data Request [Termination] is sent to V-CHF.\n2ch-b.\tThe V-CHF close the CDR.\n2ch-c.\tIf a H-CHF was selected a Charging Data Request [Termination] is sent to H-CHF.\n2ch-d.\tThe H-CHF close the CDR.\n2ch-e.\tThe H-CHF acknowledges by sending Charging Data Response [Termination] to the V-CHF.\n2ch-f.\tThe V-CHF forwards the acknowledgement by sending Charging Data Response [Termination] to the V-SMF.\nThe clause below describes PDU session charging for additional actor (MVNO) which is only applicable for non-roaming case.\nThe clause contains the description for the scenario of MVNO as additional actor with A-CHF.\nFor non-roaming scenarios, the message flows for the PDU session establishment, PDU session Modification and PDU session Release for LBO charging specified in clause 5.2.2.18 could be applicable depending on the deployment scenarios for additional actor (MVNO), with the following differences:\n-\tV-SMF in V-PLMN is replaced by the SMF in MNO;\n-\t V-CHF in V-PLMN is replaced by the CHF in MNO;\n-\t H-CHF in H-PLMN is replaced by the A-CHF in MVNO.\nThe support of satellite backhaul is specified in TS 23.501 [200] and TS 23.502 [201], message flows for different scenarios:\n-\tSatellite backhaul charging.\n-\tEdge Computing charging with satellite backhaul.\n-\tSCC-to-SCC communications charging via satellite backhaul.\nThe charging message flow of PDU session establishment for supporting Satellite backhaul, is based on Figure 5.2.2.2.2-1 description with the differences identified in clause 4.3.2.2.1.1 TS 23.502 [202].\n9ch-a,\tif SMF received the satellite backhaul category in step1 in clause 4.3.2.2.1.1 TS 23.502 [202], SMF sends the Charging Data Request [Initial] including satellite backhaul category and satellite backhaul usage report to CHF for the satellite backhaul charging.\n16ch-a,\tThe SMF sends Charging Data Request[Update] including the satellite backhaul usage report and the corresponding current satellite backhaul category to the CHF. The update of Charging Data Request may also be triggered by satellite backhaul category changes. If the dynamic satellite backhaul is obtained by the SMF, Charging Data Request needs to include the Satellite Backhaul QoS(e.g. throughput, latency, error rate).\nThe charging message flow of PDU session Release for supporting Satellite backhaul, is based on Figure 5.2.2.2.4-1 description:\n2ch-a, \tThe SMF sends Charging Data Request [Termination] to CHF including the satellite backhaul traffic usage report and the corresponding current satellite backhaul category.\nThe message flow is based on the charging principles for 5GS usage for Edge Computing specified in clause 5.1.2 of the TS 32.257 [14] with the enhancement of the satellite backhaul information for the PDU session charging information.\nThe message flow is similar as the message flows for PDU session establishment, modification and release in clause 5.2.2.2 in TS 32.255 [10] with the enhancement of the satellite backhaul information for the PDU session charging information.\nThe clause below describes PDU session charging for Network slice charging.\nThe clause describes the high level charging procedure for Network slice converged charging using the UE CHF and Tenant CHF communication architecture specified in the clause 4.2.\nThe figure depicts a network slice converged charging scenario, illustrating the various components and their interconnections. The network slice is a virtual network element that allows for the efficient management of charging infrastructure. The converged charging scenario ensures that all charging stations are connected and synchronized, providing a seamless user experience.\nFigure 5.2.2.21.2-1: Network slice converged charging\n1.\tNetwork slice charging for network slice subscriber per S-NSSAI is configured in UE CHF and Tenant CHF, which may include S-NSSAI, Subscriber identifier and Tenant ID, specified in the TS 28.202[70], etc.\n2.\tAccording to clause 5.2.2.2.2 PDU Session charging from SMF about PDU session establishment for individual UE charging.\n2ch-a.\tThe SMF creates a Charging Identifier for the PDU session, and sends Charging Data Request [Initial], triggered by \"Start of PDU session\" to UE CHF.\n2ch-b.\tThe CHF opens CDR for this PDU session per UE.\n2ch-c. UE CHF sends the Charging Data Request [Initial] to Tenant CHF which may include Tenant ID and UE PDU session charging information based on S-NSSAI and DNN received from SMF for Network Slice Charging. Account, Rating and reservation control for the Tenant.\n2ch-d.\t The CHF opens CDR for this PDU session per S-NSSAI.\n2ch-e.\t Tenant CHF provides appropriate Charging Data Response [Initial] for Tenant.\n2ch-f.\tCHF (UE CCS) provides appropriate Charging Data Response [Initial] for the individual UE.\n3.\tDuring the PDU session, when enable triggers is armed, the Charging Data Request/Response [Update] is send between SMF and UE CHF for individual UE, between UE CHF and Tenant CHF for network slice tenant.\n4.\tAccording to clause 5.2.2.2.2 PDU Session charging about PDU session release from SMF for individual UE charging.\n4ch-a.\tThe SMF sends Charging Data Request [Termination], triggered by \"End of PDU session\" to UE CHF.\n4ch-b.\tThe CHF close CDR for this PDU session per UE.\n4ch-c. UE CHF sends the Charging Data Request [Termination] to Tenant CHF with S-NSSAI, Tenant ID (optional) and UE PDU session charging information for Network Slice Charging.\n4ch-d.\t The CHF close CDR for this PDU session per S-NSSAI.\n4ch-e.\t Tenant CHF provides appropriate Charging Data Response [Termination] for Tenant.\n4ch-f.\tCHF (UE CCS) provides appropriate Charging Data Response [Termination] for the individual UE.\nEditor’s note: flow description is ffs.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3\tCDR generation",
                            "text_content": "The CHF CDRs for PDU session charging and roaming QBC are generated by the CHF to collect charging information that they subsequently transfer to the Charging Gateway Function (CGF).\nThe following clauses describe in detail the conditions for opening, adding information to, and closing the CHF CDR.\n\nA PDU session charging CHF CDR is used to collect charging information related to the PDU session data information for a UE in Flow Based Charging. Multiple service data flow containers per PDU session can be added in the CHF CDR by the CHF, upon receiving a Charging Data Request including new counts as defined in subclause 5.2.1.1.\nA  CHF CDR shall be opened when the CHF receives Charging Data Request[Initial].\nAs an alternative to the default CHF behaviour, the \"Individual Partial record\" mechanism can be used based on Operator's policy configured in the CHF. In this case a new CDR shall be opened for each Charging Data Request[Initial, Update, Termination], charging information shall be added and the CDR shall then be closed. The Sequence Number will be incremented for each Charging Data Request[Initial, Update, Termination] received by the CHF.\nWhen the CHF receives Charging Data Request[Update], with the change conditions identified in Table 5.2.3.2.2.1 the charging information shall be added in the PDU session charging CHF CDR, and the CDR shall remain open, as the default supported mechanism.\nTable 5.2.3.2.2.1: Triggers for CHF CDR charging information addition\n\n\nIn case the \"Individual Partial record\" mechanism is enabled, the Table 5.2.3.2.2.1 is not applicable. The charging information consists of a set of containers, which are added as \"List of Multiple Unit Usage\" parameter of the CHF CDR. Each container identifies the configured counts (volume separated for uplink and downlink, elapsed time or number of events) per rating group or combination of the rating group and service id, associated with the changed charging conditions.\nWhen the CHF receives Charging Data Request [Update], with the change conditions identified in Table 5.2.3.2.3.1, the charging information shall be added in the PDU session charging CHF CDR, before the CDR is closed and a subsequent CHF CDR shall be opened with an incremented Sequence Number, as the default supported mechanism.\n.\nTable 5.2.3.2.3.1: Triggers for CHF CDR partial record closure\n\nIn case the \"Individual Partial record\" mechanism is enabled, the Table 5.2.3.2.3.1 is not applicable.\nWhen the CHF receives Charging Data Request[Termination], the charging information shall be added in the PDU session charging CHF CDR and the CDR shall be closed.\nA Roaming QBC CHF CDR is used to collect charging information related to Roaming QBC in V-SMF, and the PDU session charging CHF CDR is used to collect charging information related to Roaming QBC in H-SMF. QoS flow containers per PDU session can be added in the CHF CDRs by the CHF, upon receiving a Charging Data Request.\nThe charging information received from the CHF consists of a set of containers, which are added as \"List Multiple QFI container\" parameter of the CHF CDRs. Each container identifies the configured counts (volume separated for uplink and downlink, elapsed time) per QoS Flow, associated with the changed charging conditions.\nA roaming CHF CDR shall be opened when the CHF receives Charging Data Request[Initial] indicating \"in-bound roamer\".\nWhen the CHF receives Charging Data Request[Update], with the change conditions identified in Table 5.2.3.3.2.1 the charging information shall be added in the CHFCDR, and the CDR shall remain open, as the default supported mechanism.\nTable 5.2.3.3.2.1: Triggers for CHF CDR charging information addition for roaming QBC\n\nIn case the \"Individual partial record\" mechanism is enabled, this sub-clause is not applicable.\nWhen the CHF receives Charging Data Request [Update] with the change conditions identified in Table 5.2.3.3.3.1, the charging information shall be added in the  CHF CDR, before the CDR is closed and a subsequent CHF CDR shall be opened with an incremented Sequence Number, as the default supported mechanism.\nTable 5.2.3.3.3.1: Triggers for CHF CDR partial record closure for roaming QBC\n\nIn case the \"Individual partial record\" mechanism is enabled, the Table 5.2.3.3.3.1 is not relevant: instead, the charging information shall be added in the CHF CDR, before the CDR is closed and a subsequent CHF CDR shall be opened with an incremented Sequence Number for each Charging Data Request [Update] received by the CHF.\nWhen the CHF receives Charging Data Request[Termination], the charging information shall be added in the roaming QBC CHF CDR and the CDR shall be closed.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.2.3.2.2.1: Triggers for CHF CDR charging information addition",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.2.3.1: Triggers for CHF CDR partial record closure",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.3.2.1: Triggers for CHF CDR charging information addition for roaming QBC",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.2.3.3.3.1: Triggers for CHF CDR partial record closure for roaming QBC",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.2.4\tGa record transfer flows",
                            "text_content": "In 5G, both fully qualified partial CDRs (FQPC) and reduced partial CDRs (RPC), as specified in TS 32.240 [1] may be supported on the Ga interface. In line with TS 32.240 [13], the support of FQPCs is mandatory, the support of RPCs is optional. For further details on the Ga protocol application refer to TS 32.295 [54].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.5\tBd CDR file transfer",
                            "text_content": "In 5G, both fully qualified partial CDRs (FQPC) and reduced partial CDRs (RPC), as specified in TS 32.240 [1] may be supported on the Bd interface. In line with TS 32.240 [13], the support of FQPCs is mandatory, the support of RPCs is optional. For further details on the Bd protocol application refer to TS 32.297 [52].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6.\tDefinition of charging information",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tData description for 5G data connectivity charging",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tMessage contents",
                            "text_content": "The Charging Data Request and Charging Data Response are specified in TS 32.290 [57] and include charging information. The Charging Data Request can be of type [Initial, Update, Termination].\nTable 6.1.1.1.1 describes the use of these messages for converged charging.\nTable 6.1.1.1.1: Converged charging messages reference table\n\nThe following clauses describe the different fields used in the Charging Data messages and the category in the tables is used according to the charging data configuration defined in clause 5.4 of TS 32.240 [1].\nTable 6.1.1.2.1 illustrates the basic structure of a Charging Data Request message from the SMF as used for 5G data connectivity converged charging.\nTable 6.1.1.2.1: Charging Data Request message contents\n\nTable 6.1.1.3.1 illustrates the basic structure of a Charging Data Response message from the CHF as used for 5G data connectivity converged charging.\nTable 6.1.1.3.1: Charging Data Response message contents\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.1.1.1: Converged charging messages reference table",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.1.2.1: Charging Data Request message contents",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.1.3.1: Charging Data Response message contents",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.1.2\tGa message contents",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.3\tCDR description on the Bd interface",
                            "text_content": "This clause describes the CDR content and format generated for 5G data connectivity - PDU session charging.\nThe following tables provide a brief description of each CDR parameter. The category in the tables is used according to the charging data configuration defined in clause 5.4 of TS 32.240 [1]. Full definitions of the CDR parameters, sorted by the name in alphabetical order, are provided in TS 32.298 [51].\nIf enabled, CHF CDRs for PDU session charging shall be produced for each PDU session. In roaming Home routed scenario, the PDU session charging CHF CDR shall cover both Flow based Charging and Qos flow Based Charging (QBC) from H-SMF.\nThe fields of PDU session charging CHF CDR are specified in table 6.1.3.2.1.\nTable 6.1.3.2.1: PDU session charging CHF record data\n\nIf enabled, CHF CDRs for Roaming QBC shall be produced in VPLMN for each PDU session established for an in-bound roamer. The fields of Roaming QBC CHF CDR are specified in table 6.1.3.3.1.\nTable 6.1.3.3.1: Roaming QBC CHF record data\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.3.2.1: PDU session charging CHF record data",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.3.1: Roaming QBC CHF record data",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "6.2\t5G data connectivity charging specific parameters",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tDefinition of 5G data connectivity charging information",
                            "text_content": "The Charging Information parameter used for 5G data connectivity charging is provided in the following sub-clauses.\nPDU session specific charging information used for 5G data connectivity charging is provided within the PDU session charging Information.\nThe detailed structure of the PDU Session Charging Information can be found in table 6.2.1.2.1.\nTable 6.2.1.2.1: Structure of PDU Session Charging Information\n\nUsed Unit Container, described in table 6.1.1.2.1, specific charging information used for 5G data connectivity charging is provided within the PDU Container Information described in table 6.2.1.3.1.\nTable 6.2.1.3.1: Structure of PDU Container Information\n\nRoaming QBC specific charging information used for 5G data connectivity charging is provided within the Roaming QBC Information.\nThe detailed structure of the Roaming QBC Information can be found in table 6.2.1.4.1.\nTable 6.2.1.4.1: Structure of Roaming QBC Information\nQFI Container information, defined in table 6.2.1.4.1, specific charging information used for 5G data connectivity QBC charging is provided within the QFI Container Information described in table 6.2.1.5.1.\nTable 6.2.1.5.1: Structure of QFI Container Information\n\nSpecific charging information used for information when the V-CHF have a connection to the H-CHF.\nThe detailed structure of the Inter-CHF Information can be found in table 6.2.1.6.1.\nTable 6.2.1.4.1: Structure of Inter-CHF Information\n\nEditor’s note: The complete structure of inter-CHF Information is FFS.\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.2.1.2.1: Structure of PDU Session Charging Information",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1.3.1: Structure of PDU Container Information",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1.4.1: Structure of Roaming QBC Information",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1.5.1: Structure of QFI Container Information",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.1.4.1: Structure of Inter-CHF Information",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.2.2\tDetailed message format for converged charging",
                            "text_content": "The following clause specifies per Operation Type the charging data that are sent by SMF for 5G data connectivity converged charging or offline only charging.\nThe Operation Types are listed in the following order: I (Initial)/U (Update)/T (Termination)/E (Event). Therefore, when all Operation Types are possible it is marked as IUTE. If only some Operation Types are allowed for a node, only the appropriate letters are used (i.e. IUT or E) as indicated in the table heading. The omission of an Operation Type for a particular field is marked with \"-\" (i.e. IU-E). Also, when an entire field is not allowed in a node the entire cell is marked as \"-\".\nTable 6.2.2.1 defines the basic structure of the supported fields in the Charging Data Request message for 5G data connectivity converged charging or offline only charging.\nTable 6.2.2.1: Supported fields in Charging Data Request message\n\nTable 6.2.2.2 defines the basic structure of the supported fields in the Charging Data Response message for 5G data connectivity converged charging or offline only charging.\nTable 6.2.2.2: Supported fields in Charging Data Response message\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.2.2.1: Supported fields in Charging Data Request message",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.2.2.2: Supported fields in Charging Data Response message",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.2.3\tFormal 5G data connectivity charging parameter description",
                            "text_content": "The detailed definitions, abstract syntax and encoding of the PDU session charging and Roaming QBC CHF CDRs parameters are specified in TS 32.298 [51].\nThe detailed definitions of resources attributes used for 5G data connectivity charging are specified in TS 32.291 [58].\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "A.1\tGeneral",
            "description": "A subscriber may have Charging Characteristics assigned to his subscription and/or his subscribed DNNs. Default Charging Characteristics may also be pre-provisioned on the SMF.\nDuring UE PDU session establishment, when the SMF retrieves subscription data from the UDM, if a subscribed Charging Characteristics for the requested DNN is identified, it may override the SMF pre-provisioned Charging Characteristics.\nThe Charging Characteristics parameter consists of a string of 16 bits designated as Behaviours (B), freely defined by Operators, as shown in TS 32.298 [51]. Each bit corresponds to a specific charging behaviour which is configured on a per operator basis, and pointed when bit is set to \"1\" value.\nA charging behaviour is defined as an association to a specific usage design:\nOne usage may consist of a set of trigger profiles associated to the PDU session in converged charging as described in the Table A.1 example:\nTable A.1: Example of Charging Characteristics behaviours for SMF\n\n\nAssociated to the behaviour, the following may also be configured:\n-\tthe CHF addresses to be used by the SMF, optionaly with associated CHF instance ID(s) and/or CHF set ID(s);\n-\tthe \"Default charging method\" (online or offline) to be used as the default one for every PCC rules of the PDU Session;\n-\tthe PDU session charging method indicating whether the charging method for the PDU session is \"offline only\".\n-\tcharging service.\nThe \"Default charging method\",PDU session charging method and CHF addresses with possible associated CHF instance ID(s) and/or CHF set ID(s) configured in the applicable Charging Characteristics behaviour, are superseded by \"Default charging method\", PDU session charging method and CHF addresses with possible associated CHF instance ID(s) and/or CHF set ID(s) supplied by the PCF if any, during SMF interaction with the PCF at PDU session establishment, as described in TS 23.503 [202].\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "",
                    "table number": 21,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.1\tGeneral",
            "description": "This clause specifies the EPS and 5GS interworking.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.2\tDefinition of charging information for interworking",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2.1\tData description for interworking with EPC",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "B.2.1.1\tMessage contents",
                            "text_content": "The Charging message as described in clause 6.1.1 shall apply to the PGW-C+SMF for interworking with EPC scenario.\nWhen UE is connected to PGW-C+SMF via EPC and interworking with 5GS is supported, the information and mechanism included in clause 6.1.1 and TS 32.290[57] is supported.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.1.2\tGa message contents",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.1.3\tCDR description on the Bd interface",
                            "text_content": "The CDR description defined in clause 6.1.3.2 with Roaming QBC information per clause B.2.2.1.1 is used for interworking with EPC scenario.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "B.2.2\tInterworking charging specific parameters",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "B.2.2.1\tDefinition of Interworking charging information",
                            "text_content": "The charging information defined in clause 6.2.1 is used for interworking with EPC scenario.\nThe specific information used for PS charging when UE is connected to P-GW+SMF via EPC is provided within the Charging Data Request message, as defined in clause 6.1.1.2, with the following difference:\nTable B.2.2.1.1-1: Charging Data Request message contents\n\nRoaming QBC information specific to 5GC interworking with EPC when UE is connected to P-GW+SMF via EPC is defined in table B.2.2.1.2-1:\n\nTable B.2.2.1.2-1:  Roaming QBC information\n\nQFI Container Information specific to 5GC interworking with EPC when UE is connected to P-GW+SMF via EPC is defined in table B.2.2.1.3-1:\nTable B.2.2.1.3-1:  QFI Container Information\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table B.2.2.1.1-1: Charging Data Request message contents",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table B.2.2.1.2-1:  Roaming QBC information",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table B.2.2.1.3-1:  QFI Container Information",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "B.2.2.2\tDetailed message format for Interworking charging",
                            "text_content": "The message format defined in clause 6.2.2 is used for interworking with EPC scenario.\nThe supported fields in table 6.2.2.1 for the converged charging message shall apply to the P-GW+SMF for the applicable fields, with the difference that SMF is replaced by P-GW+SMF.\nThe table B.2.2.2-1 describes the mapping between the Multiple QFI Container Information Elements defined for interworking and Traffic data volumes CDR parameters defined in 32.298 [51] for EPC.\nTable B.2.2.2-1: MultipleQFI Container for Interworking mapping to EPC Traffic data volumes\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table B.2.2.2-1: MultipleQFI Container for Interworking mapping to EPC Traffic data volumes",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "B.2.2.3\tFormal Interworking charging parameter description",
                            "text_content": "The CHF CDR parameters and resources attributes defined in clause 6.2.3 is used for interworking with EPC scenario.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "C.1\tGeneral",
            "description": "This Annex specifies Nchf from SMF+PGW-C enhanced to support UE accessing the network via GERAN/UTRAN.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.2\t5G data connectivity charging principles and scenarios",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "C.2.1\t5G data connectivity charging principles",
                    "description": "",
                    "summary": "",
                    "text_content": "The 5G data connectivity charging principles as described in clause 5.1 shall apply with the differences that SMF is replaced by SMF+PGW-C supporting GERAN/UTRAN access, and only following clauses are applicable:\n-\tClauses 5.1.1 to 5.1.9 except 5.1.6 and 5.1.5.3;\n-\tClauses 5.1.11 to 5.1.12.\nFor GERAN/UTRAN access, the Charging Identifier of the PDU session will be generated by SMF+PGW-C for the PDP Context.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "C.2.2\t5G data connectivity converged online and offline charging scenarios",
                    "description": "",
                    "summary": "",
                    "text_content": "The 5G data connectivity converged online and offline charging scenarios as described in clause 5.2 shall apply with the differences that SMF is replaced by SMF+PGW-C supporting GERAN/UTRAN access, and only following clauses are applicable:\n-\tClauses 5.2.1.1 to 5.2.1.9 except 5.2.1.5;\n-\tClauses 5.2.2.1 to 5.2.2.2.\nIn Table 5.2.1.4.1 and Table 5.2.1.6.1, only trigger conditions related to GERAN/UTRAN access scenarios are applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "C.2.3\tCDR generation and transfer",
                    "description": "",
                    "summary": "",
                    "text_content": "Clause 5.2.3 shall apply, with the difference in trigger tables where only triggers related to GERAN/UTRAN access scenarios are applicable.\nClauses 5.2.4 and 5.2.5 are applicable.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "C.3\tData description for 5G data connectivity charging",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "C.3.1\tData description for support of GERAN/UTRAN access",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "C.3.1.1\tMessage contents",
                            "text_content": "The charging message as described in clause 6.1.1 shall apply to the SMF+PGW-C to support GERAN/UTRAN access. The differences of charging message in clause 6.1.1 used for the SMF+PGW-C to support GERAN/UTRAN access are described as following.\n- UPF ID is not applicable;\n- Multi-homed PDU address is not applicable;\n- PDU Session Charging Information is described in C.3.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "C.3.1.2\tGa message contents",
                            "text_content": "The Ga message transfer as described in clause 5.2.4 shall apply to the SMF+PGW-C to support GERAN/UTRAN access.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "C.3.1.3\tCDR description on the Bd interface",
                            "text_content": "The CDR description defined in clause 6.1.3 shall apply with the differences that SMF is replaced by SMF+PGW-C supporting GERAN/UTRAN access, and the following fields in table 6.1.3.2.1 are not applicable:\n- UPF ID;\n- Multi-homed PDU address.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "C.3.2\t5G data connectivity charging specific parameters",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "C.3.2.1\tDefinition of 5G data connectivity charging information",
                            "text_content": "The charging information defined in clause 6.2.1 is used for the SMF+PGW-C to support GERAN/UTRAN access.\nThe specific PDU session charging information when UE is connected to SMF+P-GW-C via GERAN/UTRAN is provided as defined in table 6.2.1.2.1, with the differences that PDU session is replaced by PDP context in fields description and other differences described under following table C.3.2.1-1:\nTable C.3.2.1-1: Structure of PDU Session Charging Information\n\nThe specific PDU Container Information when UE is connected to SMF+P-GW-C via GERAN/UTRAN is provided as defined in table 6.2.1.3.1, with the differences described under following table C.3.2.1-2:\nTable C.3.2.1-2: Structure of PDU Container Information\nThe specific Roaming QBC information is described in table B.2.2.1.2-1 and QFI Container Information is described in table B.2.2.1.3-1 for when UE is connected to SMF+P-GW via GERAN/UTRAN, with the differences that PDU session is replaced by PDP context in fields description.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table C.3.2.1-1: Structure of PDU Session Charging Information",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table C.3.2.1-2: Structure of PDU Container Information",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "C.3.2.2\tDetailed message format for converged charging",
                            "text_content": "The basic structure of supported fields in Charging Data Request/Response message defined in clause 6.2.2 shall apply for fields applicable when SMF+PGW-C supports GERAN/UTRAN access.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "C.3.2.3\tFormal 5G data connectivity charging parameter description",
                            "text_content": "TheCHF CDR parameters and resources attributes defined in clause 6.2.3 shall apply for fields applicable when SMF+PGW-C supports GERAN/UTRAN access.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "D.1\tGeneral",
            "description": "This clause describes how to realise Network Slice usage charging, when the Network Slice is identified by an S-NSSAI (Single Network Slice Selection Assistance Information), and the Network Slice usage is considered under 5G data connectivity by individual UEs.\nThe existing Nchf capabilities exposed by CHF to SMF for individual UE 5G data connectivity charging can be used for this purpose when the Mobile Network Operator (MNO) serving the UE is also acting as the Network Slice (NS) Tenant(s).\nA given S-NSSAI can be Tenant specific or shared between multiple Tenants.\nThe MNO Converged Charging system encompasses both individual UEs and NS Tenants(s).\nRoaming scenarios are out of scope of this Annex, therefore unless otherwise stated, references to clauses in this document refer to description applicable for non-roaming scenarios only.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.2\tArchitecture",
            "description": "The 5G data connectivity domain converged charging architectures in clause 4.2 of this document apply, with the CHF hosted by Converged Charging system (CCS) extended for Network Slice (NS) Tenant. The interconnection between CHFs architecture is specified in the clause 4.x and Annex X in TS 32.240 [1].\nThe single CCS or multiple CCSs may be used to support converged charging for tenant and UEs belonging to the tenant at same time, which is implementation specific, the interaction of CCS(s) are out of scope.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.3\tNetwork slice charging based on 5G data connectivity principles",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "D.3.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The MNO as the Netwok Slice (NS) Tenant, is assigned with one or more S-NSSAI(s), each S-NSSAI identifying a Network Slice.\nThe 5G charging supports converged charging per PDU session based on assigned group of S-NSSAI(s).\nConverged Charging systems are deployed and configured by the MNO in order to achieve Network slice charging per S-NSSAI. A given Converged charging system can be configured to handle one or more S-NSSAI(s).\nIndividual UE, when subscribed to the MNO's particular S-NSSAI, is served by the Converged Charging system allocated to this S-NSSAI, when this UE establishes a PDU session under this S-NSSAI.\n5G data connectivity charging performed for individual UE over Nchf exposed by the CHF is used to perform Network Slice charging for the NS Tenant for a particular S-NSSAI.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "D.4\tNetwork slice charging based on 5G data connectivity scenarios",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "D.4.1\tBasic principles",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "D.4.1.1\tCHF selection",
                            "text_content": "The CHF selection mechanism at PDU session establishment defined in clause 5.1.8 of this specification, allows the SMF to reach the CHF hosted by the Converged Charging system serving the UE belongs to the particular S-NSSAI and Tenant.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "D.4.2\tMessage flows",
                    "description": "",
                    "summary": "",
                    "text_content": "The message flows in clause 5.2.2 apply. The following figure provides a simplified decription focusing on Network slice usage charging for a S-NSSAI.\nThe figure depicts a network slice charging based on 5G data connectivity, illustrating the charging process for various network slices. The network slice is a fundamental component of 5G networks, allowing for the efficient distribution of data across different network slices. The charging process is depicted in a simplified manner, with the network slice being charged based on the data connectivity of the 5G network. This figure provides a visual representation of the charging process and its importance in the 5G network.\nFigure D.4.2-1: Network slice charging based on 5G data connectivity\n1.\tThe SMF collects the charging information for PDU session.\n2.\tThe SMF reports the PDU session information with S-NSSAI.\n3.\tCHF includes S-NSSAI in the CDR for the PDU session.\n4.  CHF sends the charging data response.\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "D.5\tDefinition of charging information",
            "description": "The definition of charging information in clause 6 is applicable for the purpose of Network Slice charging based on 5G data connectivity.\nThe \"Network Slice Instance Identifier\" Information Element in subclause 6.2.1.2 Table 6.2.1.2.1: Structure of PDU Session Charging Information is the key identifier S-NSSAI conveyed over Nchf and in CDRs on the Bd interface.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.1\tGeneral",
            "description": "This Annex specifies the support of satellite charging.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.2\tBusiness roles",
            "description": "In order to support the integration of satellite into 5GS, there are following business roles:\n-\tSatellite Mobile network Operator (SMNO): an operator who can provide satellite communication services for satellite communication customer or an operator who rent the satellite, e.g. 5G MNO.\n-\tSatellite Service Provider (SSP): a Provider who can provide satellite services for SMNO, e.g. satellite companies.\n- \tSatellite Communication Customer (SCC): a Communication Service Customer (CSC) who is able to consume satellite communication network, e.g. UE, IoT devices, broadband vehicular or fixed terminals.\nDepending on the scenarios an organisation can play one or several roles simultaneously, and apply business roles based on corresponding business relationships, e.g.:\n- \tBusiness roles for SMNO to charge SCC for using satellite communication services.\n-\tBusiness roles for SSP to charge SMNO for using their satellites.\n- \tWhen SMNO and SSP role are provided by the same enterprise, to charge SCC role for using their networks and satellite communication services.\nIn deployments, there could be business scenarios where one or more components are supported by a single enterprise.\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "",
                    "table number": 28,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        }
    ]
}