{
    "document_name": "33737-i10.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Report has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, modal verbs have the following meanings:\nshall\t\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions, and do not appear in Technical Reports.\nThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible, and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\t\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\t\tindicates permission to do something\nneed not\tindicates permission not to do something\nThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\t\tindicates that something is possible\ncannot\t\tindicates that something is impossible\nThe constructions \"can\" and \"cannot\" are not substitutes for \"may\" and \"need not\".\nwill\t\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\t\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document studies key issues and potential solutions to support roaming aspects and the Authentication Proxy in AKMA, which is specified in TS 33.535 [2]. Specifically, the present document:\n-\tInvestigates AKMA roaming architecture and requirements by taking regulatory compliance into account;\n-\tStudies the architecture impact and procedures of introducing the Authentication Proxy (similar as the AP specified in GBA) into AKMA.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TR 33.535: \" Authentication and key management for applications based on 3GPP credential in 5G （AKMA）\".\n[3]\t3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA) \".\n[4]\t3GPP TS 33.501: \"Security architecture and procedures for 5G system\".\n[5]\t3GPP TS 33.210: \"Network Domain Security (NDS); IP network layer security \".\n[6]\t3GPP TS 23.501: \"System architecture for the 5G System (5GS)\".\n[7]\t3GPP TS 23.501: \"5G System; Unified Data Management Services; Stage 3\".\n[8]\t3GPP TS 33.126: \"Lawful interception requirements\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions of terms, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tTerms",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tSymbols",
                    "description": "",
                    "summary": "",
                    "text_content": "Void\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.3\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tArchitectural assumptions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The present document is based on the AKMA architecture and procedures specified in TS 33.535 [2]. This clause captures the architectural assumptions for the non-roaming and roaming models. These architectural models do not include the AKMA functions which enable LI in the VPLMN as these functions are the objects of the study.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tAKMA Non-Roaming network model",
                    "description": "",
                    "summary": "",
                    "text_content": "The following figure shows the fundamental non-roaming network model of AKMA, as well as the interfaces between them. Details of the AKMA requirements and procedures are documented in TS 33.535 [2].\nThe figure depicts a fundamental non-roaming network model for AKMA, which stands for Advanced Key Management Architecture. It illustrates the network architecture, including the core switches, optical line terminals (OLTs), and distributed nodes. The layered design aligns with SDN principles, emphasizing redundancy and failover reliability.\nFigure 4.2-1: Fundamental Non-Roaming Network Model for AKMA\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.3\tAKMA Roaming network model",
                    "description": "",
                    "summary": "",
                    "text_content": "When the UE is roaming there are a few cases to consider for the AF, whether the AF is internal to the HPLMN, internal to VPLMN or external in a DN e.g. hosted on the Internet.\nFigure 4.3-1 shows the fundamental roaming network model for the case that the UE is roaming in the VPLMN and accesses an AF internal to the HPLMN. This network model is a simplified version of the Roaming 5G System architecture - home routed scenario from TS 23.501 [6] since the UE accesses an AF internal to the HPLMN. It is therefore assumed that the UE is configured to setup a home routed PDU session for the Ua* protocol between itself and the AF. The HPLMN AF accesses the AAnF following the internal AF model from TS 33.535 [2].\nThe figure depicts a fundamental roaming network model for AKMA (Access and Mobility Management) when the AF (Access Facilitation) is internal to the HPLMN (High-Performance Local Network). The model illustrates the various components and their interactions, including the HPLMN, the AF, and the roaming users. The figure provides a clear understanding of the network architecture and its components, allowing for better planning and management of roaming services.\nFigure 4.3-1: Fundamental Roaming Network Model for AKMA when the AF is internal to the HPLMN\nFigure 4.3-2 shows the fundamental roaming network model for the case that the UE is roaming in the VPLMN and accesses an AF internal to the VPLMN or external in the DN. This network model is a combination and simplification of the Roaming 5G System architecture - local breakout and home-routed scenarios from TS 23.501 [6]. In the case that the UE accesses an internal AF to the VPLMN a local-breakout scenario is used between the UE and AF. In the case that a UE accesses an external AF which is in the DN, it does not matter if the UE uses the local breakout or the home-routed scenario. A VPLMN AF and an external AF accesses the AAnF via the HPLMN NEF following the external AF model from TS 33.535 [2]. In other words, the N32 interface is not used in the case of the AF internal to the VPLMN.\nThe figure depicts a fundamental roaming network model for AKMA (Access and Mobility Management) when the AF (Access Facilitator) is internal to the VPLMN (Virtual Private LAN) or when the AF is external to the VPLMN. The model includes three main components: the Access Facilitator (AF), the Access Point (AP), and the Access Point (AP). The figure illustrates the network architecture, including the core switches, optical line terminals (OLTs), and distributed nodes. The layered design aligns with SDN principles, allowing for efficient network management and failover.\nFigure 4.3-2: Fundamental Roaming Network Model for AKMA when the AF is internal to the VPLMN or AF is external\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "5\tKey issues",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tKey Issue #1: Support for AKMA roaming scenario",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.1.1\tIssue details",
                            "text_content": "AKMA roaming scenarios depend on UE and AF locations. There are different scenarios for AKMA roaming that need to be addressed:\nCase 1: UE is in VPLMN and accessing an internal HPLMN AF\nCase 2: UE is in VPLMN and accessing an internal VPLMN AF\nCase 3: UE is in VPLMN and accessing an external AF in the Data Network (Internet)\nThe AKMA roaming solutions should comply with LI requirements. It is required either decrypted traffic or the means (e.g. providing keys) for VPLMN or law enforcement to decrypt the traffic should be provided to VPLMN. The LI requirements for access to keys are only for encryption, and in the AKMA case applies when the Ua* protocol is encrypted. Regarding the means (e.g. providing keys) for VPLMN or law enforcement to decrypt the traffic, for Case 1, the encryption key (not necessarily the KAF unless KAF is used directly as the encryption key) and related information to decrypt the user traffic need to be provided from the AF to the VPLMN. For Case 3, only the keys and corresponding information which are known to HPLMN and used to establish the encryption key need be provided to VPLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2\tSecurity Threats",
                            "text_content": "N/A\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.3\tPotential security requirements",
                            "text_content": "The AKMA architecture shall support the above mentioned AKMA roaming cases.\nAKMA service shall be made to comply with the LI requirements.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.2\tKey Issue #2: Introducing the Authentication proxy into AKMA",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tKey issue details",
                            "text_content": "TS 33.222 specifies the use of Authentication Proxy in GBA [2], where an Authentication Proxy (AP) is a proxy resides between the UE and ASs. It helps to reduce the consumption of authentication vectors and/or to minimize SQN synchronization failures, and relieves the AS of security tasks. Similarly, introducing such an authentication proxy in AKMA is beneficial where different application servers (or Application Functions in AKMA) reside in the same trust domain or in the same edge node. With the AP, these application servers can rely on the AP to execute AKMA procedures, which is more cost efficient than the case where each application servers execute AKMA procedures separately. AKMA is a potential solution in MEC, and it is possible that different application servers reside in the same edge cloud or belong to the same service vendor, it is beneficial to consider the feasibility of introducing a similar proxy in AKMA.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tSecurity threats",
                            "text_content": "Different Application servers reside in the same trust domain may execute AKMA procedures separately, leading to consumptions of AAnF generating AKMA keys and signalling resources.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3\tPotential architectural and security requirements",
                            "text_content": "The AKMA architecture may support an authentication proxy to perform the AF functionality residing between UE and AS(s), in order to save the consumption of signalling resources and AAnF computing resources.\nThe connection between AP and AS(s) should be secured.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tPotential solutions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tSolution #1: AKMA roaming solution for Ua* encryption key",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tIntroduction",
                            "text_content": "AKMA roaming scenarios depend on UE and AF locations. Therefore, there are different scenarios for AKMA roaming that need to be addressed:\nCase 1: UE is in VPLMN and accessing an internal HPLMN AF.\nCase 2: UE is in VPLMN and accessing an VPLMN AF (same VPLMN).\nCase 3: UE is in VPLMN and accessing an external AF in the Data Network (Internet).\nThe LI requirements for access to keys are only for the encryption, and in the AKMA case applies when the UA* protocol is encrypted. The encryption keys could be derived from KAF (Example TLS profile defined in 33.535) or could be KAF itself. The encryption key could also be a completely different key, derived according to an application layer protocol, not defined by 3GPP. So LI should be compliant by an internal AF in all cases.\nTherefore, 3GPP should facilitate internal AF so that internal AF should be able to determine the UE roaming status and, accordingly, the AF can:\n-\tprovide the encryption key to VPLMN and/or\n-\tstop the encryption and still provide the service to UE and may continue with only integrity protection and/or\n-\tstop providing service to UE\nFor external AF, 5GC cannot force external AF to provide the keys to VPLMN. Therefore, AAnF can provide whatever accurate information AAnF has to VPLMN. i.e., KAF and indication providing information either the KAF is used for encryption or KAF derived keys are used for encryption.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.2\tSolution details",
                            "text_content": "The figure depicts a 1.2.1 roaming solution for Ua* encryption key, illustrating the key distribution and management process. Key elements include the encryption key distribution network (EKDN), encryption key distribution network (EKDN), and encryption key distribution network (EKDN). Key distribution is managed through a centralized system, ensuring efficient and secure key management.\nFigure 6.1.2.1: Roaming solution for Ua* encryption key\nSteps 1-3 is the same as defined in TS 33.501[4] clause 6.1.3 and TS 33.535 [2] Clause 6.1.\n4.\t The AUSF  sends the Naanf_AKMA_AnchorKey_Register Request with SUPI, A-KID, KAKMA, and Registered SN ID to the home AAnF. The AKMA context is updated with this received Registered SN ID.\nNote 1:\tAUSF will get the SN-name from the request of 'Nausf_UEAuthentication_Authenticate' from AMF.\n5a.\t The UE requests an application session establishment request with A-KID towards the AF. The AF discovers the hAAnF and shall send the Naanf_AKMA_ApplicationKey_Get request with A-KID and AF_ID to the hAAnF.\nNote 2: \tIf AF is not in the operator domain, then AF requests the AAnF via NEF. If AF is the HPLMN, then the AF request directly land at HPLMN AAnF.\n5b.\tThe home PLMN AAnF responds with Naanf_AKMA_ApplicationKey_Get response containing Registered SN ID.\n6.\t As the Registered SN ID is different from the PLMN in which the AF is located/connected, the AF decides:\n-\tsupporting pushing encryption keys to VPLMN#1, therefore AF shall discover the VPLMN#1 AAnF or a new NF, (enable the LI) via Registered SN-ID and provides the encryption keys material to VPLMN#1. VPLMN#1 AAnF stores the encryption keys related to UE which may be used by LI if required (step 6a1 and step 6a2). If AKMA is not supported in the VPLMN, then AAnF discovery in the VPLMN will fail or AF cannot push encryption keys to VPLMN.\nNOTE 3: If VPLMN support AKMA, the vAAnF stores key materials. If VPLMN does not support AKMA, then a new NF stores the key material. The VPLMN AKMA capabilities and policies may be configured in the hAAnF and may be based on SLA. Based on the AKMA support in the VPLMN policies or SLAs, the hAAnF selects either the new NF storing the LI context in the VPLMN or the vAAnF.\n-\tnot to enable the encryption and may continue with the UE session with only integrity protection (step 6b).\n-\tnot to provide the service to UE attached to other PLMN and to reject the request (step 6c).\nNOTE 4: The LI interception point could be any NF in VPLMN (e.g. UPF) that can retrieve the keys from the AAnF in the same VPLMN to perform encryptions.\nNOTE 5: vAAnF supports a new service or an existing service will be enhanced to allow hAAnF or AF to register the key materials.\nFor external AF, 5GC cannot force external AF to provide the keys to VPLMN to fulfill the LI requirement. However, when the external AF retrieves the keys from AAnF via NEF, the external AF provides the indication that 'KAF is used for encryption' or 'KAF-derived keys are used for encryption' or 'keys independent of KAF are used for encryption'. When the indication value is 'KAF is used for encryption' or 'KAF-derived keys are used for encryption', the hAAnF provides KAF along with the same indication to VPLMN (new AF or vAAnF).\nIf the indication value received at hAAnF is 'keys independent of KAF are used for encryption', the hAAnF provides only the indication to VPLMN without any keys.\nNOTE 1: \tDepending on agreement between HPLMN and AF, indications could be extended to provide more complete information on security parameters used by AF.\nThe figure depicts a network topology with various components, including a base station (BTS), a user equipment (UE), and a set of distributed nodes. The network is designed to support high-speed data transmission and is equipped with redundancy paths to ensure reliability. The layered design of the network aligns with the principles of Software-Defined Networking (SDN).\nFigure 6.1.2.2-1\nNOTE 2: \tvAAnF supports a new service or an existing service will be enhanced to allow hAAnF or AF to register the key materials\nSolution is similar to clause 6.1.2.1 where interna AF in VPLMN can get the keys from hAAnF. The home PLMN AAnF shall respond with Naanf_AKMA_ApplicationKey_Get response containing Registered SN ID which is the same PLMN where AF is located. Based on the SN ID, the AF shall decide:\n-\tsupporting pushing encryption keys to vAAnF or new NF (enable for LI).\n-\tnot to enable the encryption and may continue with the UE session with only integrity protection.\n-\tnot to provide the service to UE attached to other PLMN and rejects the request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.3\tEvaluation",
                            "text_content": "The solution fulfils the requirements and all 3 use-cases defined in key issue#1.\n\nThis solution brings following changes on the node/NFs:\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The solution fulfils the requirements and all 3 use-cases defined in key issue#1.",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "6.2\tSolution #2: New solution for AKMA roaming when both UE and AF are in VPLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tIntroduction",
                            "text_content": "This solution addresses the requirement in KI#1 about the AKMA roaming. This solution is designed to case 2 and case 3.\nThis solution provides a method that when both UE and the AF in the same visited network. When the AF is inside 5GC, it can communicate with the UE's AAnF in HPLMN directly. Otherwise, when AF is outside 5GC, it first connects to the NEF in HPLMN, and then the NEF will receive and send the message for the UE and the AAnF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2\tSolution details",
                            "text_content": "The figure depicts a reference model for a 5G network, showing the relationship between the User Equipment (UE) and the Access Facing Node (AF) within the Virtual Private LAN-Wide (VPLMN). The model includes various elements such as base stations (gNB), user equipment (UE), and scatterers, highlighting the importance of beamforming techniques to mitigate interference.\nFigure 6.2.2.1-1: Reference Model when UE and the AF are in the VPLMN\nThe Figure 6.2.2.1-1 shows an architecture model when UE and the AF are in the VPLMN.\nThe AF can be an internal AF in VPLMN or an AF in the data network.\nAs described in clause 6.3 in TS 33.535 [2] applies with additional descriptions:\n- replace the NEF with the NEF in home network.\n- replace the AF with the AF in visited network.\n- replace the UE with the UE in visited network.\nNOTE 1:\tThe visited AF is an external AF to UE's HPLMN.\nNOTE 2: \tFor an AF in the data network the AF may not be allowed to use SBA to access internal VPLMN NFs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3\tEvaluation",
                            "text_content": "This solution addresses the requirement of KI#1 when the AF is in the visited network, in particular, it addresses case 2 and case 3.\nThis solution reuses the existing mechanisms and hence has no standard impact.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.3\tSolution #3: Roaming AKMA architecture of the AF in the HPLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3.1\tIntroduction",
                            "text_content": "This solution addresses KI#1(case 1). This solution is proposed for the cases of function that enables LI deployment when AF located in the HPLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.2\tSolution details",
                            "text_content": "Figure 6.3.2.1-1 shows the SBA architecture that UE is roaming in a VPLMN and accesses the application deployed in the HPLMN.\nThe SBA architecture, which stands for Service-Based Architecture, is a key component of the 5G network. It enables seamless roaming between different network operators, enabling seamless access to applications deployed in different network operators. The figure depicts the SBA architecture, showing how UE (User Equipment) is roaming in a VPLMN (Virtual Private LAN) and accesses the application deployed in the HPLMN (Hybrid Public-Private Network). This architecture is crucial for enabling seamless communication and data transfer between different operators, ensuring a reliable and efficient 5G network.\nFigure 6.3.2.1-1: The SBA architecture that UE is roaming in a VPLMN and accesses the application deployed in the HPLMN\nFigure 6.3.2.1-2 shows the architecture that UE is roaming in a VPLMN and accesses the application deployed in the HPLMN. The UE accesses the home network deployment application. Like the third party deployment service, if the data between the UE and application had not been encrypted, the VPLMN can detect the unencrypted data flow through UPF in the VPLMN. If the data between the UE and application have been encrypted by using an encrypted Ua* protocol, the AMF in the VPLMN has to obtain related decryption keys from the AF in the HPLMN based on the agreements between the HPLMN and the VPLMN. In this case, the function that enables LI could be AMF in the VPLMN.\nThe architecture depicted in Figure 6 illustrates the various layers and components involved in a virtual private LAN (VPLMN) and how an end-user (UE) interacts with the application deployed in the public line network (HPLMN). The figure shows the UE roaming in a VPLMN, accessing the application deployed in the HPLMN through a function that enables LI (Local Interference Reduction). This architecture is designed to ensure reliable communication and minimize the impact of interference, which is crucial for the smooth operation of 5G networks.\nFigure 6.3.2.1-2: The architecture that UE is roaming in a VPLMN and accesses the application deployed in the HPLMN (*function that enables LI)\nFigure 6.3.2.2-1 shows the procedure that the VPLMN NF obtains the encrypt key from AF in HPLMN. Because only the AF knows the encryption/decryption key used between the UE and the AF, the AF can send the corresponding encryption/decryption key to the VPLMN. The AF obtains the VPLMN NF (e.g. AMF) id that can store the key from the UDM based on the UE ID. An indication is needed to indicate whether the key sent by the AF is KAF or the encryption key derived from KAF.\nThe figure depicts a VPLMN NF (Virtual Private LAN) network, which is a key component of the 5G network. It illustrates the process of obtaining the encrypt key from the Access Facilitator (AF) in the HPLMN (Hybrid Physical-Logical Network). The VPLMN NF is a key element in the 5G network architecture, enabling secure communication between different network segments.\nFigure 6.3.2.2-1: VPLMN NF obtains the encrypt key from AF in the HPLMN\nSteps 1-4, and 9 are same as the steps 1-4, and 5 in clause 6.2.1 in TS 33.535 [2]. The differences to the normal procedures of TS 33.535 [2] are described below.\nStep 5, the AF sends the Nudm_Get_Roaming_NFid Request message to the UDM with the UE ID. The UE ID can be the SUPI of the UE or another user identifier, e.g. GPSI.\nStep 6, the UDM sends the Nudm_Get_Roaming_NFid Response message to the AF with the VPLMN NF id(s). The VPLMN NF can be the AMF which the UE is currently attached to in VPLMN network.\nStep 7, based on the agreements between HPLMN and VPLMN, the AF sends the Push application Key Request message to the VPLMN NF(s), where the message carries the KAF, or the encryption key derived from the KAF that is used to encrypt the data flow between the UE and the AF, an indication and the UE ID. The indication indicates that the carried key is the KAF or the encryption key, and may further indicate whether the carried key is used as the data flow encryption/decryption key between the UE and the AF or not. The UE ID can be the SUPI of the UE or another user identifier, e.g. GPSI.\nStep 8, if the VPLMN NF supports AKMA roaming, the VPLMN NF stores the key and the indication, and sends the Push application Key Response message to the AF. If not, the VPLMN NF ignores the Push application Key Request message.\nService operation name: Nudm_Get_Roaming_NFid.\nDescription: The NF consumer requests VPLMN NF id from the UDM.\nInput, Required: SUPI or GPSI.\nInput, Optional: None.\nOutput, Required: VPLMN NF id(s).\nOutput, Optional: None.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.3\tEvaluation",
                            "text_content": "This solution addresses key issue#1 (case 1) and fulfils the requirements in case that the AF is located in the HPLMN.\nThe solution proposes to obtain related decryption keys from the AF in the HPLMN based on the agreements between the HPLMN and the VPLMN when the data between the UE and application have been encrypted.\nThe solution proposes that the AF obtains the VPLMN NF id(s) that can store the keys from the UDM based on the UE ID.\nThe solution proposes that the AF pushes the encryption key to the VPLMN NF(s).\nThe solution needs one VPLMN NF (e.g. AMF) to store the key.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.4\tSolution #4: Roaming AKMA architecture of the AF in the VPLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.4.1\tIntroduction",
                            "text_content": "This solution addresses KI#1(case 2). This solution is proposed for the cases of regulatory control point deployment when AF located in the VPLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.2\tSolution details",
                            "text_content": "Figure 6.4.1-1 shows the SBA architecture that UE is roaming in a VPLMN and accesses the application deployed in the VPLMN. The home network (HPLMN) needs an agreement with the service network (VPLMN) to use the AKMA service deployed in the home network. In this scenario, the AF in the service network can sense the AKMA service used by the UE. For this scenario, AF is located inside the VPLMN and needs to find the AAnF of the home network through the NEF of the home network.\nThe SBA architecture, which stands for Service-Based Architecture, is a key component of the 4.2 VPLMN (Virtual Private LAN) in the 6.2 SBA (Service-Based Architecture) architecture. This architecture enables the seamless roaming of the UE (User Equipment) in a VPLMN (Virtual Private LAN) and accesses the application deployed in the VPLMN. The SBA architecture is designed to provide a flexible and scalable solution for mobile network operators, enabling them to offer a wide range of services to their customers.\nFigure 6.4.2-1: The SBA architecture that UE is roaming in a VPLMN and accesses the application deployed in the VPLMN\nFigure 6.4.1-2 shows the architecture that UE is roaming in a VPLMN and accesses the application deployed in the VPLMN. As described in clause 6.3 of the TS 33.535 [2], the AF needs to obtain the KAF from the AAnF through the NEF. Therefore, the function that enables LI in Figure 6.4.1-2 can be AF in the VPLMN and the AF knows the encryption key between the UE and the AF.\nThe architecture depicted in Figure 6 illustrates the VPLMN (Virtual Private LAN Service) and the application deployed within it. UE (User Equipment) is roaming within the VPLMN, accessing the application through the application deployed in the VPLMN. The architecture is designed to enable LI (Local Interference Reduction) by utilizing the VPLMN's infrastructure and resources.\nFigure 6.4.2-2: The architecture that UE is roaming in a VPLMN and accesses the application deployed in the VPLMN (*function that enables LI)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.4.3\tEvaluation",
                            "text_content": "This solution addresses key issue#1 (case 2) and fulfils the requirements in case that the AF is located in the VPLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.5\tSolution #5: AKMA anchor key registration to the AAnF in VPLMN after primary authentication",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.5.1\tIntroduction",
                            "text_content": "This solution addresses the KI #1. The proposed solution supports registration of AKMA anchor key (KAKMA) and A-KID to the AAnF in VPLMN after primary authentication for UE in the same manner of KAKMA and A-KID registration to the AAnF in HPLMN. Once the KAKMA and the A-KID are registered in the AAnFs in VPLMN and HPLMN, the UE in VPLMN is able to access to both VPLMN AF and HPLMN AF. Moreover, even if KAUSF which is a root key of the KAKMA is changed by new primary authentication, there is no need additional key update procedure for the VPLMN AAnF since the new KAKMA and A-KID will replace the old keys whenever primary authentication is performed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.2\tSolution details",
                            "text_content": "The figure depicts the process of anchor key registration to the AANF in a VPLMN after primary authentication, highlighting the importance of key management in network security.\nFigure 6.5.2.1-1: AKMA anchor key registration to the AAnF in VPLMN after primary authentication\n1. The AUSF requests authentication information to the UDM to acquire subscription information and authentication method in primary authentication procedure.\n2. The UDM responses with the Authentication Vector. The AKMA indication and the RID may be included in the response if the UE needs AKMA anchor key generation.\n3. If the AUSF receives the AKMA indication from the UDM, the AUSF stores SN-name, KAUSF and generate AKMA Anchor Key (KAKMA) and the A-KID. The UE generates the KAKMA and the A-KID if the primary authentication procedure is completed.\n4. If the keys generation is completed, the AUSF requesst to the HPLMN AAnF to register A-KID and KAKMA. The selection of the AAnF is described in TS 33.535 clause 6.7 [2].\n5. The AAnF in HPLMN responses to the AUSF after key registration completed.\n6. If the AUSF recognizes the UE is roaming based on SN-name which is received previously in the primary authentication procedure, the AUSF requests to the VPLMN AAnF to register A-KID and KAKMA.\nTo select the AAnF in VPLMN to register KAKMA and A-KID, local configuration or NRF can be utilized. When NRF is used to discover and select the AAnF in VPLMN, serving PLMN ID is used in the discovery and selection by NRF in different PLMNs.\n7. The AAnF in VPLMN responses to the AUSF after key registration completed.\nThe figure depicts the application session establishment between a roaming UE and an Access Point (AP) in a Virtual Private LAN-Wide Area Network (VPN-VPLMN). The figure shows the steps involved in establishing a session, including the UE's request for a session, the AP's response, and the subsequent establishment of the session. The figure also includes the network topology, including the AP, the UE, and the VPN-VPLMN.\nFigure 6.5.2.2-1: Application session establishment between roaming UE and AF in VPLMN\n0. The UE is roaming in VPLMN and AKMA anchor key is registered in the AAnF in VPLMN after the procedure in clause 6.5.2.1.\n1. When the UE initiates communication with the AF in VPLMN, it includes the derived A-KID in the Application Session Establishment Request message.\n2. The AF in VPLMN identifies based on the realm part from the received A-KID whether the UE is from another serving network. If the AF decides to support the UE from other serving network, the AF requests application key to the AAnF in VPLMN.\nTo selects the AAnF in VPLMN for the AF to provide the KAF, local configuration or NRF can be utilized. When NRF is used to discover and select the AAnF in VPLMN, both RID and home network identifier from the received A-KID are used to select the AAnF.\n3. The AAnF in VPLMN derives the KAF from KAKMA if it does not already have KAF.\n4. The AAnF in VPLMN sends Naanf_AKMA_ApplicationKey_Get response to the AF in VPLMN with SUPI, KAF and the KAF expiration time.\n5. The AF in VPLMN sends the Application Session Establishment Response to the UE.\nNOTE: \tNFs in VPLMN could provide LI context (A-KID, KAKMA, KAF, etc.) when LI enabled.\nThe figure depicts the application session establishment between a roaming UE and an Access Point (AP) in a High-Performance Local Area Network (HPLMN). The figure shows the steps involved in establishing a session, including the UE's request for a session, the AP's response, and the UE's subsequent actions. The figure illustrates the use of the Session Description Protocol (SDP) to establish the session, and the use of the Session Initiation Protocol (SIP) to establish the connection. The figure also shows the use of the Quality of Service (QoS) parameters to ensure the quality of the session.\nFigure 6.5.2.3-1: Application session establishment between roaming UE and AF in HPLMN\n0. The UE is roaming in VPLMN and AKMA anchor key is registered in the AAnF in HPLMN after the procedure in clause 6.5.2.1.\n1. When the UE initiates communication with the AF in HPLMN, it includes the derived A-KID in the Application Session Establishment Request message.\n2. The AF in HPLMN requests application key to the AAnF in HPLMN.\n3. The AAnF in HPLMN derives the KAF from KAKMA if it does not already have KAF.\n4. The AAnF in HPLMN identifies based on the realm part from the received A-KID whether the UE is from another serving network. If the AAnF in HPLMN decides to support the UE from another serving network, the AAnF in HPLMN provides AKMA context to the AAnF in VPLMN to support LI.\nTo select the AAnF in VPLMN for the AF to provide the KAF, local configuration or NRF can be utilized. When NRF is used to discover and select the AAnF in VPLMN, both RID and home network identifier from the received A-KID are used to select the AAnF.\n5. The AAnF in VPLMN stores the delivered AKMA related information from HPLMN to support LI.\n6. The AAnF in VPLMN responses to the AAnF in HPLMN.\n7. The AAnF in HPLMN sends Naanf_AKMA_ApplicationKey_Get response to the AF in VPLMN with SUPI, KAF and the KAF expiration time.\n8. The AF in HPLMN sends the Application Session Establishment Response to the UE.\nNOTE: \tNFs in VPLMN could provide LI context (A-KID, KAKMA, KAF, etc.) when LI enabled.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.5.3\tEvaluation",
                            "text_content": "This solution addresses case 1 and case 2 of key issue#1 and fulfils the requirements in the case that the AF is located in the HPLMN and VPLMN.\nThe solution fulfils LI requirement that LI contexts (e.g. encrypted traffic data and keys related to AKMA) are ready before the application session established.\nWhen the KAKMA is changed due to new primary authentication, there is no need additional key update procedure for the VPLMN AAnF. The new KAKMA and A-KID will replace the old keys whenever primary authentication is performed.\nKAKMA in HPLMN is shared to VPLMN, and same KAKMA will be AKMA anchor key in HPLMN and VPLMN.\nNOTE 1: \tThe present document does not address how to make different the KAF in VPLMN and HPLMN when same KAKMA is shared to VPLMN and HPLMN .\nNOTE 2: \tHow the AUSF discovers the AAnF in the VPLMN is not addressed in the present document.\nNOTE 3: \tHow the solution is aligned with clause 4 is not addressed in the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.6\tSolution #6: AKMA roaming with VAAnF for LI",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.6.1\tIntroduction",
                            "text_content": "This solution is addressing Key Issue #1: Support for AKMA roaming scenario, especially the scenario when the UE is in VPLMN and trying to access the HPLMN AF.\nThe issue of LI for AKMA roaming was described as follows: if the UE is roaming in a VPLMN, then the UE builds up a secure tunnel to an AF in the HPLMN and since the credentials used for the encryption are based on the 3GPP derived keys, the VPLMN needs to be able to perform LI. This is not possible compared to GBA, where the NAF and tunnel endpoint is located in the VPLMN.\nFurther it cannot be implied that the AF is always in the VPLMN for roaming scenarios, for typical deployments it can be a 3rd party AF in a data network.\nIf the VPLMN needs to perform LI, then the VPLMN needs to be enhanced to store the SUPI and the encryption key e.g. with a local AAnF. It is recommended to provide the KAF further also only to the VPLMN for the service the UE is currently requesting from the AF. In case the VPLMN is not enhanced but has a strong LI requirement for AKMA, the AF should not get the KAF and should get an indication that NULL encryption has to be used.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.2\tSolution details",
                            "text_content": "The solution proposes to introduce a VAAnF in the VPLMN in order to store the connection details of the UE roaming in that VPLMN to the AF outside that VPLMN. The differences to the normal procedures of TS 33.535 are described below.\nThe figure depicts a process for deriving the KAKMA (Key Authentication Key Management Algorithm) after primary authentication. The process involves using a key management algorithm to generate a unique key for each user, ensuring secure communication.\nFigure 6.6.2-1: Deriving KAKMA after primary authentication\nAdditionally to the other AKMA related parameters, the AUSF also provides the SN name to the AAnF in the HPLMN in step 4. The SN name is later used to determine whether the Ue is roaming and to select an appropriate AAnF in the VPLMN (VAAnF) for storing the AKMA connection details.\n\nFigure 6.6.2-2: KAF generation from KAKMA and provisioning to VPLMN\nIn step 3, the HAAnF derives the AKMA Application Key (KAF) from KAKMA if it does not already have KAF.\nIn step 4, the HAAnF provides the KAF and the KAF expiration time together with the SUPI of the UE to AF according to the AKMA procedure.\nIn step 5, the AF sends an Application Session Establishment Response to the UE according to the AKMA procedure.\nIn step 6, the UE and the AF may perform an additional key derivation from KAF in order to generate a session key KSession which is used to protect the application session between UE and AF. The key derivation is depending on the protocol used on the Ua* interface between UE and AF.\nIn step 7, after the session establishment, the AF provides the KSession key to the HAAnF in an Naanf_AKMA_SessionKey_Push_Request. This request may be sent with each refresh of the KAF or KSession of the Ua* protocol.\nIn step 8, the HAAnF acknowledges the request with an Naanf_AKMA_SessionKey_Push_Response.\nIn step 9, the HAAnF detects based on the SN name that the UE is roaming and if the VPLMN has AKMA LI enhancements. The VPLMN AKMA capabilities and policies may be configured in the HAAnF and may be based on SLAs. Based on the AKMA support in the VPLMN, policies or SLAs, the HAAnF selects either the NF which enables LI in the VPLMN (continues with step 10a) or the VAAnF (continues with step 10b).\nVPLMN does not support AKMA:\nIn step 10a, The HAAnF sends a Nnf_AKMA_ApplicationKey_Provisioning_Request to the NF which enables LI in the VPLMN. The request contains the full security context for LI of the UE for this AKMA session, i.e. A-KID, AF_ID, SUPI, KAF, KAF expiration time, KSession.\nIn step 11a, the NF which enables LI acknowledges the request with a Nnf_AKMA_ApplicationKey_Provisioning_Response.\nIn step 12a, the NF stores the LI security context for potential LI request in the VPLMN. The NF may delete the LI security context after expiration of KAF. In case of KAF or KSession key refresh, the NF needs to be informed about the new key with the same procedure.\nVPLMN supports AKMA:\nIn step 10b, the HAAnF provides the KAF and the KAF expiration time together with the SUPI of the UE and the session key KSession to the VAAnF in the VPLMN for storing the AKMA LI context. The VAAnF acknowledges the request in step 11b.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.3\tEvaluation",
                            "text_content": "The HAAnF retrieves the serving name of the UE and can check whether the UE is roaming in a VPLMN or not. If the AF further derives a session key from KAF, then this is also provided to the HAAnF. The HAAnF needs to be enhanced with SLAs, operator policies or corresponding contact NF (NEF or VAAnF) in the VPLMNs. Depending on the AKMA support in the VPLMN, the HAAnF provides the AKMA security context to the corresponding contact NF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.7\tSolution #7: Introducing AP into AKMA",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.7.1\tIntroduction",
                            "text_content": "TS 33.222 specifies the use of Authentication Proxy in GBA [3], where an Authentication Proxy (AP) is a proxy resides between the UE and ASs. It helps to reduce the consumption of authentication vectors and/or to minimize SQN synchronization failures, and relieves the AS of security tasks. Similarly, introducing such an authentication proxy in AKMA is beneficial where different application servers reside in the same trust domain or in the same edge node. With the AP, these application servers can rely on the AP to execute AKMA procedures, which is more cost efficient than the case where each application servers execute AKMA procedures separately. AKMA is a potential solution in MEC, and it is possible that different application servers reside in the same edge cloud or belong to the same service vendor, it is beneficial to consider the feasibility of introducing a similar proxy in AKMA.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.7.2\tSolution details",
                            "text_content": "An Authentication Proxy (AP) is a proxy which takes the role of an AF and delegates a group of ASs. It may reside between the UE and the AS as depicted in the figures below. The AP helps the ASs behind the AP to execute AKMA procedures to save the consumption of signalling resources and AAnF computing resources. It may also relieve the AS of security tasks. The use of an AP is fully compatible with the architecture specified in TS 33.535 [2].\nThe AP can assure the ASs that the request is coming from an authorized subscriber of the MNO.\nThe figure depicts a network scenario where an AP (Access Point) is internal to the network, which is a common practice in enterprise networks. The figure shows the use of APs when they are internal, highlighting the importance of having a dedicated network infrastructure for these devices. The use of APs in internal networks can provide better security, reliability, and performance compared to external APs.\nFigure 6.7.2.1-1: Use of AP when AP is internal\nThe figure depicts a scenario where an AP (Access Point) is external, which is a common practice in wireless networks. It illustrates the use of APs when they are not connected to the main network, allowing for better coverage and flexibility in network planning.\nFigure 6.7.2.2-1: Use of AP when AP is external\nIf the Ua* is HTTP based, the UE is configured with the FQDN of AS, and the AP is a reverse proxy to handle the communication between the UE and the AS. The AP takes the role of an AF. The AKMA Application Key (i.e. KAF), which is utilized between the UE and the AP, is derived based on the FQDN of the AS.\nIf the Ua* is not HTTP based, it is left to implementation, e.g., how the AP identifies the traffic towards corresponding AS may be pre-configured in the AP by the operator who deploys the AP.\nThe HTTP protocol is run over the AP-AS reference point. Confidentiality and integrity protection can be provided for the reference point between the AP and the AS using NDS/IP mechanisms as specified in TS 33.210 [5]. For traffic between different security domains, the Za reference point is operated. For traffic inside a security domain, it is up to the operator to decide whether to deploy the Zb reference point.\nWhen the TLS based protocol is used as Ua* profile, the AP can be used to handle the TLS security relation with the UE and relieves the application server (AS) of this task. When an HTTPS request is destined towards an application server (AS) behind an AP, the AP terminates the TLS tunnel and performs UE authentication. The AP proxies the HTTP requests received from UE to one or many application servers. The AP may add an assertion of identity of the subscriber for use by the AS, when the AP forwards the request from the UE to the AS.\nThe figure depicts a network setup where an AP (Access Point) is used to establish a TLS (Transport Layer Security) tunnel between two internal networks. This is a common practice in enterprise networks to provide secure communication between different departments or locations. The use of an AP ensures that the tunnel is encrypted and protected, making it difficult for unauthorized parties to intercept or tamper with the data.\nFigure 6.7.2.3-1: Use of AP for TLS tunnels when AP is internal\nThe figure depicts a network setup where an AP (Access Point) is used to establish a TLS (Transport Layer Security) tunnel between two devices. This tunnel is used to establish a secure communication channel, ensuring the confidentiality and integrity of the data being transmitted. The use of an AP for TLS tunnels is a common practice in network security, as it provides a secure and reliable communication path for sensitive data.\nFigure 6.7.2.3-2: Use of AP for TLS tunnels when AP is external\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.7.3\tEvaluation",
                            "text_content": "The solution fulfils the requirements in key issue#2. The solution enables the application servers relying on the authentication proxy to execute AKMA procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.8\tSolution#8: AAnF discovery and selection for internal AF in AKMA roaming",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.8.1\tIntroduction",
                            "text_content": "This solution specified the AAnF discovery and selection for internal AF which supports case 1 and case 2 in KI#1 of TR 33.737 [1] in AKMA roaming scenario.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.8.2\tSolution details",
                            "text_content": "The figure depicts an 8-2-1 internal AF discovery and selection process for an AKMA roaming network. It illustrates the steps taken to identify and select the appropriate internal AF for the network. The figure includes various components such as the network architecture, network elements, and the process flow.\nFigure 6.8.2.1-1: AAnF discovery and selection for internal AF in AKMA roaming\nPre-requisite: The AKMA security context ((including the AKMA anchor key, A-KID, and SUPI) has been provided to the VPLMN before, e.g., the AUSF has registered the AKMA security context to the vAAnF after KAKMA derivation.\n1. When the internal AF is about to request AKMA Application Key for the UE from the AAnF, e.g. when UE initiates application session establishment request as in clause 6.2.1 of TS 33.535 [2]. The internal AF preforms the AAnF selection, discovers an AAnF utilizing the NRF.\n-\tIf the internal AF resides in the HPLMN, the AAnF discovery and selection is performed as specified in the clause 6.7 of TS 33.535 [2].\n-\tIf the internal AF resides in the VPLMN, the AF invokes the Nnrf_NFDiscovery_Request service from the vNRF to find the vAAnF, the input includes AF_LOCATION_IND which identifies the network where the AF resides, A-KID, and another parameter as specified in clause 5.2.7.3.2 of TS 23.502 [3].\n2. NRF performs the following operation:\n-\tIf the internal AF resides in the HPLMN, the AAnF discovery and selection is performed as specified in the clause 6.7 of TS 33.535 [2].\n-\tOr if the internal AF resides in the VPLMN, the vNRF provides the IP address or FQDN of the vAAnF instance or another parameter as specified in clause 5.2.7.3.2 of TS 23.502 [3].\n3. Then the internal AF sends a Naanf_AKMA_ApplicationKey_Get request to hAAnF/vAAnF with the A-KID to request the KAF for the UE. The internal AF also includes its identity (AF_ID) in the request.\n4. The hAAnF/vAAnF generates the KAF as specified in clause 6.2.1 of TS 33.535 [2]\n5. The hAAnF/vAAnF sends the response to the AF with the KAF, the KAF expiration time (KAF exptime), SUPI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.8.3\tEvaluation",
                            "text_content": "TBD.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.9\tSolution #9: Roaming AKMA architecture of the AF in Data Network (Internet)",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.9.1\tIntroduction",
                            "text_content": "This solution addresses KI#1 (Case 3). This solution is proposed for the cases of function that enables LI deployment when AF located in Data Network (Internet).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.9.2\tSolution details",
                            "text_content": "Figure 6.9.2.1-1 shows the architecture that UE is roaming in a VPLMN and accesses the application deployed in Data Network(internet). The UE accesses the third party deployment application. If the data between the UE and application had not been encrypted, the VPLMN can detect the unencrypted data flow through UPF in the VPLMN. If the data between the UE and application had been encrypted by using an encrypted Ua* protocol, the AMF in the VPLMN has to obtain related the KAF from the AAnF in the HPLMN based on the agreements between the HPLMN and the VPLMN. When UE is roaming to a target AMF, the target AMF can obtain related the KAF from the old AMF with the UE context. In this case, the function that enables LI could be AMF in the VPLMN.\nThe architecture depicted in Figure 6 illustrates the various components and layers involved in a virtual private LAN and mobile network (VPN) setup. UE is roaming within a Virtual Private LAN (VPLMN) and accessing the application deployed on the Data Network (* function that enables LI). The architecture is designed to ensure reliable and efficient communication, with redundancy paths and failover mechanisms to ensure uninterrupted service.\nFigure 6.9.2.1-1: The architecture that UE is roaming in a VPLMN and accesses the application deployed Data Network (*function that enables LI)\nFigure 6.9.2.2-1 shows the procedure that the VPLMN NF obtains the KAF from AF in Data Network (Internet). Because the AAnF knows KAF but does not know the exact encryption/decryption key used between the UE and the AF, the AAnF can only send the KAF to the VPLMN. The AAnF obtains the VPLMN NF (e.g. AMF) id that can store the key from the UDM based on the UE ID. An indication is needed to indicate whether the KAF is sent by the AAnF, and may further indicate that the AAnF does not know whether the KAF is used as the encryption/decryption key between the UE and the AF.\nFigure 6.9.2.2-1: VPLMN NF obtains the KAF from AF in Data Network (Internet)\nSteps 1-3, 8 and 9 are same as the steps 1-3, 4 and 5 in clause 6.3 in TS 33.535 [2]. The differences to the normal procedures of TS 33.535 [2] are described below.\nStep 4, the AAnF sends the Nudm_Get_Roaming_NFid Request message to the UDM with the UE ID. The UE ID is the SUPI of the UE.\nStep 5, the UDM sends the Nudm_Get_Roaming_NFid Response message to the AAnF with the VPLMN NF id(s). The VPLMN NF can be the AMF which the UE is currently attached to in VPLMN network.\nStep 6, based on the agreements between HPLMN and VPLMN, the AAnF sends the Push application Key Request message to the VPLMN NF(s), where the message carries a KAF, an indication, and a UE ID. The indication indicates that the carried key is the KAF, and may further indicate that the HPLMN does not know whether the KAF is used as the data flow encryption/decryption key between the UE and the AF. The UE ID is the SUPI of the UE.\nStep 7, if the VPLMN NF supports AKMA roaming, the VPLMN NF stores the key and the indication, and sends the Push application Key Response message to the AAnF. If not, the VPLMN NF ignores the Push application Key Request message.\nService operation name: Nudm_Get_Roaming_NFid.\nDescription: The NF consumer requests VPLMN NF id(s) from the UDM.\nInput, Required: SUPI.\nInput, Optional: None.\nOutput, Required: VPLMN NF id(s).\nOutput, Optional: None.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.9.3\tEvaluation",
                            "text_content": "This solution addresses key issue#1 (case 3) and fulfils the requirements in case that the AF is located in Data Network (Internet).\nThe solution proposes to obtain KAF from the AAnF in the HPLMN based on the agreements between the HPLMN and the VPLMN when the data between the UE and application have been encrypted.\nThe solution proposes that the AAnF obtains the VPLMN NF id(s) that can store the key from the UDM based on the UE ID.\nThe solution proposes that the AAnF pushes the encryption key to the VPLMN NF(s).\nThe solution needs one VPLMN NF (e.g. AMF) to store the key.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.10\tSolution #10: Support of AKMA roaming with K_SEAF",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.10.1\tIntroduction",
                            "text_content": "This solution addresses the KI #1.\nThe proposed solution supports AKMA roaming by using K_SEAF to derive K_AKMA when the UE connects through the VPLMN. By doing this, the VPLMN does not require any further interactions with the HPLMN to provide AKMA services when the AF is in or connects to the VPLMN. Similarly, the HPLMN can also generate the same AKMA keys derived from K_SEAF since the AUSF has K_AUSF.\nThe proposed solution facilitates LI when UE is in the VPLMN since the VPLMN has all required AKMA keys independently of the location of the AF. In case that the AF is in/connects to the HPLMN and the Ua* protocol involves additional keys, this solution includes interactions to let the VPLMN request / HPLMN deliver those additional keys.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.10.2\tSolution details",
                            "text_content": "The figure depicts a 10.2.1 -1 roaming solution for mobile network operators (MNOs) in the Asia-Pacific region. It illustrates the various components and technologies involved in the roaming process, such as the mobile network (MNO), mobile network operator (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (MNO), mobile network (M\nFigure 6.10.2.1-1: AKMA Roaming solution\nStep 1 is as defined in TS 33.501 [4] clause 6.1.3 and TS 33.535 [2] Clause 6.1.\nStep 2 is as defined in TS 33.535 [2] Clause 6.1 with the exceptions that the UE roaming in the VPLMN computes:\n-\tKvAKMA as in TS 33.535 [2] Annex A.2 using KSEAF instead of KAUSF.\n-\tA-vKID is as A-KID in TS 33.535 [2] Clause 6.1 with the exception that the realm part of the A-vKID includes Serving Network Identifier and A-vTID is used.\n-\tA-vTID is as the A-TID in TS 33.535 [2] Clause 6.1 with the exception that it is derived as specified in Annex A.3 using KSEAF instead of KAUSF.\nStep 3 is as defined in TS 33.535 [2] Clause 6.1 having the SEAF in the VPLMN to compute KvAKMA, A-vKID, and A-vTID with the same exceptions as in Step 2 and providing parameters to the vAAnF.\nStep 4 is as defined in TS 33.535 [2] Clause 6.1 having the AUSF in the HPLMN to compute KvAKMA, A-vKID, and A-vTID with the same exceptions as in Step 2 and providing parameters to the hAAnF.\nIn Step 5 the UE requests an application session establishment request with A-vKID towards the vAF.\nIn Step 6 the vAF discovers the vAAnF and sends the Naanf_AKMA_ApplicationKey_Get response with A-vKID and AF_ID to the vAAnF. The vAAnF derives then the AF key from K_vAKMA.\nIn Step 7 the vAAnF responds with Naanf_AKMA_ApplicationKey_Get response containing Registered SN ID.\nNOTE 1: \tThe VPLMN has all AKMA keys to support LI when the AF is in the VPLMN.\nSteps 9-12 are as Steps 5-8, with the difference that the AF is in the hPLMN.\nNOTE 2: \tThe VPLMN has all AKMA keys to support LI when the AF is in the HPLMN.\nIn Steps 13 and 14, the AMF/SEAF in the VPLMN might – if required – request other security information for LI purposes to the vAF and/or hAF, e.g., Ua* protocol, security algorithms, etc. This request might be done to a local vAF or to the hAF.\nIn Steps 15 and 16, the vAF and/or hAF deliver any additional security information for LI purposes when available or requested.\nNOTE 3: \tAs HPLMN provides K_SEAF to VPLMN after primary authentication, it may also provide AKMA related parameters e.g., AKMA indication to check whether UE supports AKMA services, and if so, how to handle them. The HPLMN can provide the AKMA indication to the VPLMN (SEAF/AMF) as part of the subscription data. The routing indicator might be communicated or the VPLMN may use a default value so that the AAnF NF consumer can select any AAnF instance within the VPLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.10.3\tEvaluation",
                            "text_content": "This solution addresses KI#1.\nThe main benefit of this solution is that the VPLMN has direct access to AKMA keys as soon as the UE has finished the primary authentication procedure since AKMA keys are derived from K_SEAF. This approach removes the need of interacting between VPLMN and HPLMN to retrieve those keys. This approach facilitates LI during roaming since AKMA keys are directly available in the VPLMN.\nThese benefits are achieved by changing the way K_AKMA is derived when the UE is in the VPLMN, and this can lead to two issues:\na)\tR17 UEs cannot access AKMA services when roaming. This can be addressed by (1) having a different solution for R17 UEs in roaming; or (2) upgrading the way R17 UEs act in roaming as in this solution; or (3) not supporting AKMA roaming with R17 UEs. If this is not done, this solution has backwards compatibility issues due to the changes in the UE behaviour.\nb)\tThe proposed architecture in this solution deviates from the architectural assumptions in Clause 4 since, e.g., a VPLMN AF is served by the AAnF of the VPLMN and not the AAnF of the HPMLN through the hSEPP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.11\tSolution #11: AKMA Authentication in roaming scenario",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.11.1\tIntroduction",
                            "text_content": "This solution addresses the key issue #1: Support for AKMA roaming scenario.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.11.2\tSolution details",
                            "text_content": "In this solution, it is assumed the VPLMN deployed AAnF (shown as VAAnF). There are 2 options for VAAnF to request KAF.\nOption#1: VAAnF fetch KAF from HAAnF.\nOption#2: VAAnF fetch KAKMA from HAUSF, and VAAnF generates KAF based on KAKMA.\nThe figure depicts a scenario of roaming authentication in a 5G network, showing the authentication process for a user in a roaming scenario. The figure includes various elements such as the user's device, the network, and the authentication method. The authentication process involves the user's device sending a request to the network, which then sends a response back to the user's device. The figure also includes a visual representation of the network's architecture, showing the various components such as the base station (gNB), user equipment (UE), and scatterers. The figure highlights the importance of authentication in ensuring secure communication in a roaming scenario.\nFigure 6.11.2.1-1: Authentication in roaming scenario – Option#1\nStep 0: UE performs primary authentication with the network. Then KAUSF is shared between UE and AUSF in Home network.\nStep 1.1: UE generates KAKMA and A-KID following AKMA procedure in TS 33.535 and stores them securely.\nStep 1.2: AAnF generates KAKMA and A-KID following AKMA procedure in TS 33.535 and stores them securely.\nStep 2: UE derives KAF following AKMA procedure in TS 33.535.\nStep 3: AUSF selects the AAnF as defined in clause 6.7 in TS 33.535 and send the generated A-KID and KAKMA to the AAnF together with the SUPI of the UE using the Naanf_AKMA_KeyRegistration Request service operation.\nStep 4: UE send Application session establishment request (A-KID) to AF.\nStep 5: AF determines on whether to communicate with VAAnF or HAAnF.\nNOTE 1: \tAF could contact HAAnF for fetch KAF, which is exactly the AKMA feature defined in R17 in TS 33.535. no need to repeat here. But AF may have local policy to decide which AAnF should it contact.\nNOTE 2: \tHow the AF selects the HAAnF when the UE is roaming is not addressed in the present document.\nStep 6: AF sends Naanf_AKMA_ApplicationKey_Get request(A-KID, AF_ID) to VAAnF\nStep 7: Based on the information provided in A-KID, VAAnF checked this is a roaming UE, so VAAnF sent Naanf_AKMA_ApplicationKey_Get request (A-KID) to HAAnF.\nStep 8: HAAnF derives KAF from KAKMA following TS 33.535.\nStep 9: HAAnF sent Naanf_AKMA_ApplicationKey_Get response (KAF , KAF expTime, SUPI) to VAAnF.\nStep 10: VAAnF send Naanf_AKMA_ApplicationKey_Get response (KAF , KAF expTime, SUPI) to AF.\nThe figure depicts a scenario of authentication in a roaming scenario, specifically focusing on Option#2. It illustrates the process of authentication in a roaming scenario, with a focus on the use of a mobile device. The figure shows the authentication process, including the use of a mobile device, the network, and the authentication process.\nFigure 6.11.2.2-1 Authentication in roaming scenario – Option#2\nStep 0: UE performs primary authentication with the network. Then KAUSF is shared between UE and AUSF in Home network.\nStep 1.1: UE generates KAKMA and A-KID following AKMA procedure in TS 33.535 and stores them securely.\nStep 1.2: AAnF generates KAKMA and A-KID following AKMA procedure in TS 33.535 and stores them securely.\nStep 2: UE derives KAF following AKMA procedure in TS 33.535.\nStep 3: AUSF selects the AAnF as defined in clause 6.7 in TS 33.535 and send the generated A-KID and KAKMA to the AAnF together with the SUPI of the UE using the Naanf_AKMA_KeyRegistration Request service operation.\nStep 4: UE send Application session establishment request (A-KID) to AF.\nStep 5: AF determines on whether to communicate with VAAnF or HAAnF.\nNOTE 1:\t AF could contact HAAnF for fetch KAF, which is exactly the AKMA feature defined in R17 in TS 33.535, thus no need to repeat here. But AF may have local policy to decide which AAnF should it contact.\nNOTE 2:\tHow the AF selects the HAAnF or VAAnF when the UE is roaming is not addressed in the present document.\nStep 6: if AF determines to contact VAAnF in step 5, AF sends Naanf_AKMA_ApplicationKey_Get request(A-KID, AF_ID) to VAAnF\nStep 7: Based on the information provided in A-KID, VAAnF checked this is a roaming UE, so VAAnF sent Nausf_AKMA_Key_Get request (A-KID) to AUSF in HPLMN.\nNOTE 3:\tHow the VAAnF finds the AUSF registered by UEs through the A-KID is not addressed in the present document.\nStep 8: AUSF response with Nausf_AKMA_Key_Get response (KAKMA) to VAAnF.\nStep 9: VAAnF derives KAF , KAF expTime based on KAKMA and AF_ID following the key derivation function defined in clause A.4 in TS 33.535.\nStep 10: VAAnF send Naanf_AKMA_ApplicationKey_Get response (KAF , KAF expTime, SUPI) to AF.\nService operation name: Nausf_AKMA_Key_Get.\nDescription: The NF consumer requests AKMA Application Key and UE ID from the AUSF.\nInput, Required: A-KID, AF_ID\nInput, Optional: None.\nOutput, Required: KAKMA\nOutput, Optional: None.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.11.3\tEvaluation",
                            "text_content": "None.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.12\tSolution #12: AKMA anchor key forwarding to the VPLMN during primary authentication procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.12.1\tIntroduction",
                            "text_content": "This solution addresses the KI #1. The proposed solution supports registration of AKMA anchor key (KAKMA) and A-KID to the AAnF in VPLMN after primary authentication for UE in the same manner of KAKMA and A-KID registration to the AAnF in HPLMN. The KAKMA and A-KID are forwarded to the VPLMN during primary authentication procedure. After the primary authentication procedure, the AMF in VPLMN registers the AKMA keys to the AAnF in VPLMN.\nOnce the KAKMA and the A-KID are registered in AAnFs in VPLMN and HPLMN, the UE in VPLMN is able to access to both VPLMN AF and HPLMN AF. Moreover, even if KAUSF which is a root key of the KAKMA is changed by new primary authentication, there is no need additional key update procedure for the VPLMN AAnF since the new KAKMA and A-KID will replace the old keys whenever primary authentication is performed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.12.2\tSolution details",
                            "text_content": "The figure depicts a key registration process in the 12.2.1-1 protocol, which is a key management protocol used in VPLMN (Virtual Private LAN) networks. The process involves the AKMA anchor key registration to the AAnF in the AANF (Access-Assigned Network Function) in the VPLMN. This is an important step in ensuring secure key management and authentication in VPLMN networks.\nFigure 6.12.2.1-1: AKMA anchor key registration to the AAnF in VPLMN after primary authentication\n1-5. Step 1 to step 5 are defined in clause 6.1 of TS 33.535 [2].\n6. Rest of primary authentication procedure is performed as defined in clause 6.1.3 of TS 33.501 [4].\n7. During the primary authentication, the AUSF responds to the AMF in VPLMN with information of authentication result via Nausf_UE Authentication_Authentication Response. If the UE is from other serving network based on SN name, the AUSF includes A-KID and KAKMA to the AMF in VPLMN in the response.\n8. The AUSF requests to the HPLMN AAnF to register the A-KID and the KAKMA. The selection of the AAnF is described in clause 6.7 of TS 33.535 [2].\n9. The AAnF in HPLMN responses to the AUSF after key registration completed.\n10. If the A-KID and the KAKMA is forwarded to the AMF in VPLMN, the AMF registers the A-KID and the KAKMA to the AAnF in VPLMN.\n11. The AAnF in VPLMN responses to the AMF after key registration completion.\nThe figure depicts the application session establishment between a roaming UE and an Access Point (AP) in a Virtual Private LAN-Wide Area Network (VPN-VPLMN). The figure shows the network topology, including the AP, the roaming UE, and the VPN-VPLMN. The session establishment process involves the UE initiating a connection to the AP, which is then established and maintained by the VPN-VPLMN. The figure provides a visual representation of the network's architecture and the steps involved in establishing a session between the UE and the AP.\nFigure 6.12.2.2-1: Application session establishment between roaming UE and AF in VPLMN\n0. The UE is roaming in VPLMN and AKMA anchor key is registered in the AAnF in VPLMN after the procedure in clause 6.12.2.1.1. When the UE initiates communication with the AF in VPLMN, it includes the derived A-KID in the Application Session Establishment Request message.\n2. The AF in VPLMN identifies based on the realm part from the received A-KID whether the UE is from another serving network. If the AF decides to support the UE from other serving network, the AF requests application key to the AAnF in VPLMN.\nTo selects the AAnF in VPLMN for the AF to provide the KAF, local configuration or NRF can be utilized. When NRF is used to discover and select the AAnF in VPLMN, both RID and home network identifier from the received A-KID are used to select the AAnF.\n3. The AAnF in VPLMN derives the KAF from KAKMA if it does not already have KAF.\n4. The AAnF in VPLMN sends Naanf_AKMA_ApplicationKey_Get response to the AF with SUPI, KAF and the KAF expiration time.\n5. The AF in VPLMNsends the Application Session Establishment Response to the UE.\nNOTE: \tNFs in VPLMN could provide LI context (A-KID, KAKMA, KAF, etc.) when LI enabled.\nThe figure depicts the application session establishment between a roaming UE and an Access Point (AP) in a High-Performance Local Area Network (HPLMN). The figure shows the steps involved in establishing a session, including the UE's request for a session, the AP's response, and the UE's subsequent actions. The figure illustrates the importance of session establishment in ensuring reliable communication and data transfer between the UE and the AP.\nFigure 6.12.2.3-1: Application session establishment between roaming UE and AF in HPLMN\n0. The UE is roaming in VPLMN and AKMA anchor key is registered in the AAnF in HPLMN after the procedure in clause 6.12.2.1.\n1. When the UE initiates communication with the AF in HPLMN, it includes the derived A-KID in the Application Session Establishment Request message.\n2. The AF in HPLMN requests application key to the AAnF in HPLMN.\n3. The AAnF in HPLMN derives the KAF from KAKMA if it does not already have KAF.\n4. The AAnF in HPLMN identifies based on the realm part from the received A-KID whether the UE is from another serving network. If the AAnF in HPLMN decides to support the UE from another serving network, the AAnF in HPLMN provides AKMA context to the AAnF in VPLMN to support LI.\nTo selects the AAnF in VPLMN for the AF to provide the KAF, local configuration or NRF can be utilized. When NRF is used to discover and select the AAnF in VPLMN, both RID and home network identifier from the received A-KID are used to select the AAnF.\n5. The AAnF in VPLMN stores delivered AKMA related information as LI context.\n6. The AAnF in VPLMN responses to the AAnF in HPLMN.\n7. The AAnF in HPLMN sends Naanf_AKMA_ApplicationKey_Get response to the AF in VPLMN with SUPI, KAF and the KAF expiration time.\n8. The AF in HPLMN sends the Application Session Establishment Response to the UE.\nNOTE: \tNFs in VPLMN could provide LI context (A-KID, KAKMA, KAF, etc.) when LI enabled.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.12.3\tEvaluation",
                            "text_content": "This solution addresses case 1 and case 2 of key issue#1 and fulfils the requirements in the case that the AF is located in the HPLMN and VPLMN.\nThe solution fulfils LI requirement that LI contexts (e.g. encrypted traffic data and keys related to AKMA) are ready before the application session established.\nWhen the KAKMA is changed due to new primary authentication, there is no need additional key update procedure for the VPLMN AAnF. The new KAKMA and A-KID will replace the old keys whenever primary authentication is performed.KAKMA in HPLMN is shared to VPLMN, and same KAKMA will be AKMA anchor key in HPLMN and VPLMN.\nNOTE 1: \tThe present document does not address how to make different the KAF in VPLMN and HPLMN when same KAKMA is shared to VPLMN and HPLMN .\nNOTE 2: \tHow the AUSF discovers the AAnF in the VPLMN is not addressed in the present document.\nNOTE 3: \tHow the solution is aligned with clause 4 is not addressed in the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.13\tSolution #13: AKMA support in roaming",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.13.1\tIntroduction",
                            "text_content": "This solution addresses KI#1. This solution is proposed for the case in which the VPLMN supports AKMA. The proposed solution includes vAAnF as a new functional entity which is the AKMA Anchor Function in the VPLMN. The vAAnF relays the Naanf_AKMA_ApplicationKey_Get request and response between the AF in the visited network and the AAnF in the UE's home network. vAAnF functionality includes:\n-\tvAAnF functions as a proxy between the visited AF and the AAnF in the home network of the UE.\n-\tvAAnF locates the AAnF in the home network of the UE and communicate with it over secure channel.\n-\tvAAnF validates that the visited AF is authorized to participate in AKMA.\nN64 (AKMA reference point):\n-\tReference point between the home AAnF and the visited AAnF.\n\nThe figure depicts a simplified representation of the AKMA (Adaptive Key Management Architecture) architecture, which is a key component in the 5G network. It illustrates the various types of access points (AFs) and their connections to the network, including internal AFs (via vAAnF) and external AFs (via vAAnF). The figure is used to understand the network's architecture and its components, which are crucial for the efficient operation of the 5G network.The figure depicts a simplified representation of the AKMA (Adaptive Key Management Architecture) architecture, which is a key component in the 5G network. It illustrates the various types of access points (AFs) and their connections to the network, including internal AFs (via vAAnF) and external AFs (via vAAnF). The figure is used to understand the network's architecture and its components, which are crucial for the efficient operation of the 5G network.\nFigure 6.13.1-1: AKMA Architecture in reference point representation for (a) internal AFs, (b) external AFs, (c) internal AFs (via vAAnF) and (d) external AFs (via vAAnF)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.13.2\tSolution details",
                            "text_content": "The figure depicts a 13.2-1 AKMA application key retrieval process in a visited network, with the AAnF (Application Anomaly Focal Point) in the home network. The process involves the AAnF identifying anomalies in the visited network, which are then sent to the AAnF in the home network for further analysis. The figure illustrates the process in a flowchart format, with arrows indicating the flow of information between the two networks.\nFigure 6.13.2-1: AKMA Application Key retrieval by AAnF in visited network, from the AAnF in home network\n1.\tUE registers to the network and performs the primary authentication as specified in TS 33.501 [4]. The UDM determines the support of AKMA in VPLMN based on the configuration or based on the subscription data. During primary authentication, the UDM provides the AUSF with “[AKMA Ind]” specifying whether AKMA Keys need to be generated for the UE as defined in TS 33.535 [2]. UDM also provides the AUSF with, AKMA Roaming Indication specifying whether the generated AKMA Keys can be propagated to the VPLMN, depending on operator agreements and/or AKMA support in VPLMN.\n2.\tAUSF generates KAKMA and A-KID. Correspondingly, KAKMA and A-KID are generated at the UE. AUSF selects an AAnF instance to serve the UE, and registers SUPI, KAKMA and A-KID in the hAAnF. AUSF provides the hAAnF with AKMA Roaming Indication. AUSF can decide this based on indication from the UDM in Step (1) and/or local policy. AUSF also provides Visited-Network information to the hAAnF.\n3a-3b.\tUE triggers communication over Ua* interface with the AF based on its application needs. UE can optionally provide visited-network information (e.g. Serving PLMN ID) to the AF along with A-KID. Based on local configuration, and/or presence of visited-network information in the UE request, AF sends a request to the vAAnF (directly or via NEF) to provide KAF, if there is no secure interface with the hAAnF. The request contains AF-Identity (e.g. FQDN) and A-KID.\nThe AF can determine the PLMN in which the UE is currently roaming using the SN ID provided in the session establishment request.\n4.\tBased on information contained in A-KID (Routing ID, Home Network Information), vAAnF discovers the hAAnF by querying the NRF.\n5.\tvAAnF requests the hAAnF to provide application key. The request can be sent utilizing a new or existing service exposed by the hAAnF, and discovered by the vAAnF via the NRF. The request contains following information:\n- A-KID of the UE as provided by the AF\n- AF-Identity (e.g. FQDN) is provided by the AF\n6.\tBased on the received request or local policy or the UDM provided AKMA Roaming Indication, hAAnF generates KAF from KAKMA and provides KAF and Key lifetime to the vAAnF.\n7.\tBased on the received information, if vAAnF receives KAF and Key lifetime, it provides the same to AF.\nNOTE: \tThe LI aspects on providing the encryption keys to the VPLMN is not considered as part of this solution and solution#5 can be reused to address LI.\nNOTE 2: \tHow the solution is aligned with the architectural assumption in clause 4 is not addressed in the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.13.3\tEvaluation",
                            "text_content": "This solution partially addresses key issue#5.1 (Support for AKMA roaming scenario) and fulfils the first requirement on the support of AKMA in roaming.\nImpacts to UE:\n- \tUE needs to send the SN ID in the session establishment request to the AF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.14\tSolution #14: AKMA roaming with AF outside VPLMN",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.14.1\tIntroduction",
                            "text_content": "This solution addresses Key Issue #1 \"Support for AKMA roaming scenario\", especially the scenario when the UE is roaming in VPLMN and trying to access AF located outside VPLMN, i.e. this AF could be an internal HPLMN AF or external AF in Data Network.\nThe solution proposes to introduce an AAnF in the VPLMN, named vAAnF, to enable the VPLMN to decrypt user traffic encrypted between the roaming UE and AF thanks to AKMA-related credentials. The vAAnF receives from the HPLMN AKMA Application key KAF and associated parameters enabling the VPLMN to decrypt the user content exchanged between the roaming UE and AF located outside the VPLM. The solution also ensures that the AKMA Application Key KAF provided by the HPLMN to VPLMN is correct.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.14.2\tSolution details",
                            "text_content": "The solution addresses the scenario where AF is an internal HPLMN AF.\nThe figure depicts the key K AKMA establishment between the UE and hAAnF, which is crucial for establishing the AKMA key (K AKMA) and ensuring reliable communication. The AUSF provides the SN name to the AAnF in the HPLMN (hAAnF) to determine whether the UE is roaming and to select appropriate AAnF in VPLMN (vAAnF) to store AKMA details. Figure 6.14.2-1: Sending of AKMA credentials to VPLMN\nPre-requisite: there is establishment of the key KAKMA between the UE and hAAnF. And, during the establishment of the AKMA key (KAKMA), the AUSF also provides the SN name to the AAnF in the HPLMN (hAAnF). The SN name is used later to determine whether the UE is roaming and to select appropriate AAnF in VPLMN (vAAnF) in order to store AKMA details.\nNOTE 1: \tThis solution assumes that there is only one vAAnF per VPLMN.\nSteps 1, 2, 3 take place as specified in TS 33.535 [2].\n4. The hAAnF determine whether the UE is roaming. If the UE is roaming then the hAAnF provides the AKMA Application key KAF and associated parameters A-KID, AF_ID, SUPI, and KAF expiration time to the vAAnF.\nNOTE 2:\tSame mechanism applies in case that the encryption key provided by the AAnF in the HPLMN (hAAnF) is not the AKMA Application key KAF. The key KAF would be replaced by the encryption key provided by hAAnF in all the steps describing the use of the key KAF.\n5. The vAAnF stores the key KAF and associated parameters received from the hAAnF and sends back response to the hAAnF.\nSteps 6 and 7 take place as specified in TS 33.535 [2].\n8. The UE sends a message to the AMF in order to check that the vAAnF stores the correct AKMA Application Key KAF to address LI requirement. This message contains the current GUTI value encrypted by the UE with KAF, and associated A-KID and AF-ID. The GUTI value encrypted with KAF is named GUTIe.\nNOTE 32:\tGUTIe could also be Message Authentication Code.\n9. The AMF sends to the vAANF: GUTIe, A-KID, AF-ID received from the UE in step 8, and GUTI value in clear text.\n10. The vAANF retrieves the AKMA Application Key KAF thanks to A-KID, AF-ID and decrypts the GUTIe with KAF. Then, the vAAnF verifies that the decrypted GUTI is the same than the GUTI in clear text sent by the AMF.\n11. The vAANF sends to the AMF the result of the KAF check.\n12. The AMF forwards the result of the KAF check to the UE.\n13. The UE can use KAF if the KAF check was successful.\nThe steps 8 and 12 correspond to new NAS messages.\nNOTE 4:\tTo avoid race conditions, i.e. that the AF might start an encrypted Ua* session with the UE before the LI provisioning has been completed in the VPLMN, it is important that message ordering as proposed is strictly followed. That is, AKMA keys are not available to the AF, until the response message 5 has been received/verified. This solution also covers the scenario where AF is an external AF in Data Network. The same steps apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.14.3\tEvaluation",
                            "text_content": "This solution addresses the Key Issue # (cases 1 and 3) and fulfils the security requirements in case that the UE is roaming in VPLMN and accesses an AF outside this VPLMN.\nThe solution addresses the scenarios where the encryption key provided by the AAnF in the HPLMN (hAAnF) to AAnF of VPLMN (vAAnF) could be the AKMA Application key KAF, or any other key.\nAdditionally, this solution ensures that the encryption key provided by the HPLMN to VPLMN is valid to decrypt the traffic. The mechanism to ensure that the encryption key provided by the HPLMN is valid relies on steps 8 to 13.\nThe solution impacts the serving network and the ME.\nThe steps 8 to 13 to ensure that the encryption key provided to VPLMN is valid to decrypt the traffic could apply to any solution addressing Key Issue#1 where a UE is roaming in VPLMN and accesses an AF outside this VPLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.15\tSolution #15: AKMA roaming for external AF in Data Network",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.15.1\tIntroduction",
                            "text_content": "This solution addresses the KI #1.\nThis solution considers external AF in a data network in roaming scenarios. Specifically, AKMA architecture in clause 6.3 TS 33.535 [1] is reused to support the AKMA roaming which involves external AF in a data network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.15.2\tSolution details",
                            "text_content": "To support AKMA roaming which involves external AF in a data network, this solution reuses clause 6.3 TS 33.535 with the following modifications.\n- \tIn step 3, the NEF checks whether the connected AF is an external AF in the data network based on the local policies. If the AF is an external AF in the data network, the NEF sends an AF indicator to the AAnF in the home network of UE. The AF indicator indicates that the AF is an external AF in a data network.\n-\tIf the AAnF receives the AF indicator and the UE is roaming, the AAnF in the home network sends SUPI of the UE, AF_ID, KAF, the KAF expiration time (KAF exptime) to the visited network (e.g., UPF in the visited network) of the UE. The hAAnF may obtain the visited network name of the UE from the AUSF/UDM.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.15.3\tSolution Evaluation",
                            "text_content": "This solution address part of case 2(UE in VPLMN accessing an internal AF of the VPLMN) and case 3 (UE is in VPLMN and accessing an external AF in the Data Network).\nThis solution has impact to both hAAnF and NEF. In specific, NEF needs to send an AF indicator to the AAnF in the home network of UE based on local policies. The AF indicator indicates that the AF is an external AF in a data network.\nThe advantages of this solution is given as follows.\nIn specific, this solution enables hAAnF to differ the VPLMN AF and the external AF.\nFor external AF, hAAnF needs to send AKMA related information (e.g., KAF) to the VPLMN.\nFor VPLMN AF, hAAnF does not need to send AKMA related information (e.g., SUPI of the UE, AF_ID, KAF, the KAF expiration time) to the VPLMN.\nThe disadvantages of this solution is given as follows.\nThis solution has impacts to both AAnF and NEF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.16\tSolution #16: AKMA roaming with VPLMN AKMA Support NF for inbound roamers",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.16.1\tIntroduction",
                            "text_content": "The solution addresses case #1 (UE roaming and accessing internal HPLMN AF) and case #3 (UE roaming and accessing an external AF in the Data Network of KI#1.\nIt uses the principle that the UDM knows the VPLMN(s) that the UE is roaming after the AMF which handles the UE registers to the UDM.\nIf the UE has registered to multiple PLMNs the UDM has this knowledge and provide this to the AKMA AF or AAnF. The AF and AAnF may decide to send one or multiple VPLMNs the AKMA related keys and parameter to enable LI in the VPLMNs.\nThis solution proposes that the AMF is configured with or dynamically discovers the AKMA Support NF (ASNF) in the VPLMN which enables LI, and sends this information to the UDM when it registers the UE to the UDM. Any other NF in the HPLMN can discover the UE VPLMN information as well as the address of the AKMA Support NF enabling LI in the VPLMN (if any).\nThis solution also proposes that the AAnF could be used as the proxy in the HPLMN to push any AKMA related keys from itself or the AF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.16.2\tSolution details",
                            "text_content": "NOTE 1: \tWhether the address of the ASNF or an indication that the VPLMN supports AKMAis sent to the HPLMN is not addressed in the present document.\nFigure 6.16.2-1 provides the sequence diagram of the solution. The ASNF is the AKMA Support Network Function in the VPLMN. The ASNF represents an AKMA NF enabling LI which stores AKMA related key material and parameters. The ASNF can be any existing NF (AMF, AAnF, UPF) or part of an existing NF or a new NF.\nFigure 6.16.2-1: Solution sequence diagram\n0.\tThe UE registers to the network. If a primary authentication procedure is required, steps 0a - 1 are executed. The AKMA Anchor Key (KAKMA) is generated as defined in TS 33.535 [2].\n1.\tThe AAnF optionally sends a request to the UDM to obtain the UE roaming information. The message contains the SUPI of UE, possibly with an indication to retrieve the AKMA ASNF information. The AAnF subscribes to the UDM on updates of UE roaming information.\nThe UDM optionally sends the UE roaming information to AAnF. The message contains the UE SUPI, the UE roaming information e.g., PLMN ID of visited network, ASNF address (if available). If the UE is not registered in UDM yet or registered over more than one visiting PLMNs, there could be zero or multiple sets of such information in the response message.\nNOTE 2:\tAccording to TS 23.501 [7], 4.2.8.2.2, the UE can be registered in two VPLMNs.\n2.\tIn the general case (of the ANSF being a standalone NF or integrated to other NFs) the AMF obtains the address of ASNF via the NRF or local configuration. The AMF sends Nudm_UECM_Registration to UDM for the UE. The message contains the UE SUPI, serving PLMN ID, and ASNF address. The UE registration information is updated and stored in the UDM.\n3.\tThe UDM optionally sends the UE roaming information Update to the AAnF. The message contains the UE SUPI, PLMN ID(s) of visited network(s) and ASNF address(s).\n4a.\tThe UE initiates communication with the AF via the Application Session Establishment Request message.\n4b.\tThe AF requests the AF key (KAF) from the AAnF, possibly via NEF.\n4c.\tThe AAnF generates AF key (KAF) and returns the key to the AF as specified in TS 33.535 [2].\nThe AAnF now have AKMA related key material and parameters KAF and the information used for key derivation thereof.\n4d.\tIn the AF key response message, the AAnF may include possibly with an indication to request the AF to report any AF key material and parameters.\nNOTE 3:\tIf the AF is in the Data Network (Internet), whether the AF can process this request for key material or whether the AF will provide the key material to the AAnF depends upon the HPLMN and AF provider agreements.\n5. \tThe AKMA application session between UE and AF is established and protected. The communication could be protected by the KAF or key material derived from the KAF or other key material derived in the AF.\nThe AF has now KAF, any security material derived from KAF or other key material derived in the AF, the information used for keys derivation thereof including selected encryption algorithms, cipher suites, input for ciphering: key(s), nonce(s), counter(s) etc.\n5b.\tThe AAnF optionally requests from the latest roaming information (if any) from the UDM and subscribes to these changes as Step 1.\nNOTE 4:\tStep 1 is optional, and it shows the proactive aspect of the solution i.e. every time there is change of information in the UDM the AAnF is notified. However, the roaming information in the AAnF for a specific UE will not be needed if UE does not setup any AKMA session. Therefore, it could be better for the AAnF to request roaming information and changes after the AKMA session establishment response as it is performed in this step.\n6.\tThe AAnF obtains the ASNF address for the UE (e.g. received from step 1 and/or step 3) and sends a message e.g. AKMA Cryptographic Information Report to the ASNF(s). The message contains the UE ID (e.g. SUPI), and cryptographic information such as KAF, derived keys from KAF or any other keys and parameters used to protect the communication between the UE and the AF.\n7. \tThe AF sends a message to the AAnF potentially via NEF, e.g. AF Cryptographic Information Report, to provide or update the keys and parameters to the AAnF. The message contains for example the UE ID, keys and parameters used to derive AKMA application session keys.\nNOTE 5:\tStep 7 can take place before or after step 5 and it can happen in parallel or after step 6\n8.\tIf any cryptographic information (used for the protection of the AKMA session between the UE and AF) is updated in AAnF, the AAnF sends a message e.g., AKMA Cryptographic Information Update to ASNF(s). The message contains UE ID (e.g., SUPI), and cryptographic information such as selected encryption algorithms, cipher suites, input for ciphering: key(s), nonce(s), counter(s) etc.\nNow the ASNF(s) has/have the AKMA cryptographic information for the UE and perform(s) necessary regulatory actions accordingly.\nNOTE 6: \tHow the selection of the ASNF is performed if the there are multiple ASNF(s) in the network is not addressed in the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.16.2\tEvaluation",
                            "text_content": "The solution addresses Key Issue #1: Support for AKMA roaming scenario, case #1 (UE roaming and accessing internal HPLMN AF) and case #3 (UE roaming and accessing an external AF in the Data Network.\nThe solution proposes that the AMF discovers the AKMA related function in the VPLMN which enables LI (AKMA Support Network Function, ASNF) and provides the address of such function to the UDM in the HPLMN. The AAnF subscribes to the UDM for the address of the ASNF in the VPLMN. Whenever the UE changes VPLMN the UDM gets this information from the AMF via Nudm_UECM_Registration. The AF provides keys and related parameters for the protection of the AKMA session between a UE and AF to the AAnF and the AAnF forwards this information to the ASNF in the VPLMN. For the case of multiple registrations, the AAnF has the information from the UDM and provides the related key material and parameters to all the VPLMN(s).\nThe ASNF can be any existing NF (AMF, AAnF, UPF) or part of an existing NF or a new NF.\nThe solution has impact on the AMF in the VPLMN, the UDM, the AAnF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tConclusions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tConclusion to Key Issue#1",
                    "description": "",
                    "summary": "",
                    "text_content": "Regarding AKMA roaming architecture, AKMA architecture defined in TS 33.535 [2] can be reused.\nFor case 2 (UE in VPLMN accessing an internal AF of the VPLMN), since the AF knows the encryption key used between the UE and the AF, the LI requirements can be fulfilled by the AF, thus no normative work is needed.\nFor cases 1 and 3, it is agreed that the HPLMN is responsible to control whether its subscriber is authorized to use the AKMA services in the VPLMN. In particular, where applicable, the HPLMN is responsible for providing whatever necessary for the VPLMN to fulfill its legal obligations as described in TS 33.126 [8].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2\tConclusion to Key Issue#2",
                    "description": "",
                    "summary": "",
                    "text_content": "It is proposed that solution #7 is used for normative work.\n\n\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 5,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}