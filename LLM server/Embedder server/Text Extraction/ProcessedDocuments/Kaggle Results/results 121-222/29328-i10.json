{
    "document_name": "29328-i10.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\nIn the present document, modal verbs have the following meanings:\nshall\tindicates a mandatory requirement to do something\nshall not\tindicates an interdiction (prohibition) to do something\nThe constructions \"shall\" and \"shall not\" are confined to the context of normative provisions, and do not appear in Technical Reports.\nThe constructions \"must\" and \"must not\" are not used as substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as possible, and they are not used in a normative context except in a direct citation from an external, referenced, non-3GPP document, or so as to maintain continuity of style when extending or modifying the provisions of such a referenced document.\nshould\tindicates a recommendation to do something\nshould not\tindicates a recommendation not to do something\nmay\tindicates permission to do something\nneed not\tindicates permission not to do something\nThe construction \"may not\" is ambiguous and is not used in normative elements. The unambiguous constructions \"might not\" or \"shall not\" are used instead, depending upon the meaning intended.\ncan\tindicates that something is possible\ncannot\tindicates that something is impossible\nThe constructions \"can\" and \"cannot\" are not substitutes for \"may\" and \"need not\".\nwill\tindicates that something is certain or expected to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nwill not\tindicates that something is certain or expected not to happen as a result of action taken by an agency the behaviour of which is outside the scope of the present document\nmight\tindicates a likelihood that something will happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nmight not\tindicates a likelihood that something will not happen as a result of action taken by some agency the behaviour of which is outside the scope of the present document\nIn addition:\nis\t(or any other verb in the indicative mood) indicates a statement of fact\nis not\t(or any other negative verb in the indicative mood) indicates a statement of fact\nThe constructions \"is\" and \"is not\" do not indicate requirements.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "This 3GPP Technical Specification (TS) specifies:\n1.\tThe interactions between the HSS (Home Subscriber Server) and the SIP AS (Application Server) and between the HSS and the OSA SCS (Service Capability Server). This interface is referred to as the Sh reference point.\n2.\tThe interactions between the SIP AS and the SLF (Subscription Locator Function) and between the OSA SCS and the SLF. This interface is referred to as the Dh reference point.\nThe IP Multimedia (IM) Core Network Subsystem stage 2 is specified in 3GPP TS 23.228 [1] and the signalling flows for the IP multimedia call control based on SIP and SDP are specified in 3GPP TS 24.228 [2].\nThe IP Multimedia (IM) Session Handling with the IP Multimedia (IM) call model is specified in 3GPP TS 23.218 [4].\nThis document addresses the signalling flows and message contents for the protocol at the Sh and Dh interface.\nThis document also addresses how the functionality of Ph interface is accomplished.\nThe Presence Service Stage 2 description (architecture and functional solution) is specified in 3GPP TS 23.141 [18].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "[1]\t3GPP TS 23.228: \"IP Multimedia (IM) Subsystem – Stage 2\".\n[2]\t3GPP TS 24.228: \"Signalling flows for the IP multimedia call control based on SIP and SDP (Release 5)\".\n[3]\t3GPP TS 23.002: \"Network architecture\".\n[4]\t3GPP TS 23.218: \"IP Multimedia (IM) Session Handling; IP Multimedia (IM) call model\".\n[5]\t3GPP TS 29.329: \"Sh Interface based on Diameter – Protocol details\".\n[6]\t3GPP TS 29.228: \"IP multimedia (IM) Subsystem Cx Interface; Signalling flows and Message Elements\".\n[7]\t3GPP TS 29.229: \"Cx and Dx Interfaces based on the Diameter protocol ; Protocol details\".\n[8]\tVoid.\n[9]\tITU-T recommendation Q.763: \"Signalling System No. 7 - ISDN User Part formats and codes\".\n[10]\t3GPP TS 23.018: \"Basic Call Handling; Technical realization\".\n[11]\t3GPP TS 23.003: \"Numbering, Addressing and Identification\".\n[12]\t3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".\n[13]\t3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".\n[14]\t3GPP TS 23.078: \"Customised Applications for Mobile network Enhanced Logic (CAMEL) Phase 3 - Stage 2\".\n[15]\tIETF RFC 2045: \"Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies\".\n[16]\tIETF RFC 3261: \"SIP: Session Initiation Protocol\".\n[17]\tIETF RFC 3966: \"The tel URI for Telephone Numbers\".\n[18]\t3GPP TS 23.141: \"Presence Service; Architecture and Functional Description\".\n[19]\t3GPP TS 23.012: \"Location Management Procedures\".\n[20]\tANSI X3.4: \"Coded Character Set - 7-bit American Standard Code for Information Interchange\"\n[21]\tVoid\n[22]\t3GPP TS 33.203: \"Access Security for IP-based services\".\n[23]\tIETF RFC 791: \"Internet Protocol\".\n[24]\tIETF RFC 4291: \"IP Version 6 Addressing Architecture\".\n[25]\tIETF RFC 4412: \"Communications Resource Priority for the Session Initiation Protocol (SIP)\".\n[26]\t3GPP TS 29.272: \"MME and SGSN Related Interfaces Based on Diameter Protocol \".\n[27]\t3GPP TS 23.008: \"Organization of subscriber data\".\n[28]\t3GPP TS 29.212: \"Policy and Charging Control (PCC); Reference points\".\n[29]\t3GPP TS 23.060: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; General Packet Radio Service (GPRS); Service description; Stage 2\".\n[30]\t3GPP TS 29.118: \"SGs interface specification\".\n[31]\t3GPP TS 29.272: \"Evolved Packet System; MME and SGSN Related Interfaces Based on Diameter Protocol\".\n[32]\t3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage 2\".\n[33]\t3GPP TS 23.292: \"IP Multimedia Subsystem (IMS) centralized services; Stage 2\".\n[34]\t3GPP TS 29.273: \"3GPP EPS AAA interfaces\".\n[35]\tIETF RFC 4776: \"Dynamic Host Configuration Protocol (DHCPv4 and DHCPv6) Option for Civic Addresses Configuration Information\".\n[36]\tIETF RFC 7683: \"Diameter Overload Indication Conveyance\".\n[37]\tETSI ES 283 034: \"e4 interface based on the DIAMETER protocol\".\n[38]\t3GPP TS 22.153: \"Multimedia Priority Service\".\n[39]\t3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on SIP and SDP\" – stage 3.\n[40]\t3GPP TS 29.364: \"IP Multimedia Subsystem (IMS) Application Server (AS) service data description for AS interoperability\".\n[41]\tIETF RFC 5952: \"A Recommendation for IPv6 Address Text Representation\".\n[42]\tIETF RFC 7944: \"Diameter Routing Message Priority\".\n[43]\tIETF RFC 8583: \"Diameter Load Information Conveyance\".\n[44]\tIETF RFC 6733: \"Diameter Base Protocol\".\n[45]\t3GPP TS 24.323: \"3GPP IP Multimedia Subsystem (IMS) service level tracing management object (MO)\".\n[46]\t3GPP TS 29.571: \"5G System; Common Data Types for Service Based Interfaces; Stage 3\".\n[47]\t3GPP TS 29.518: \"5G System; Access and Mobility Management Services; Stage 3\".\n[48]\t3GPP TS 23.632: \"User data interworking, coexistence and migration; Stage 2\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following terms and definitions apply.\nIP Multimedia session: IP Multimedia session and IP Multimedia call are treated as equivalent in this specification.\nTransparent data: Data that is understood syntactically but not semantically by the HSS. It is data that an AS may store in the HSS to support its service logic. One example is data that an AS stores in the HSS, using it as a repository.\nNon-transparent data: Data that is understood both syntactically and semantically by the HSS.\nAS (Application Server): a term used to denote either of a SIP Application Server or an OSA Service Capability Server.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the following abbreviations apply:\nAS\tApplication Server\nC\tConditional\nCSCF\tCall Session Control Function\nCSG\tClosed Subscriber Group\nDRMP\tDiameter Routing Message Priority\nDSCP\tDifferentiated Services Code Point\nGIBA\tGPRS-IMS-Bundled-Authentication\nHSS\tHome Subscriber Server\nIE\tInformation Element\nIP\tInternet Protocol\nIM\tIP Multimedia\nIMS\tIP Multimedia Subsystem\nM\tMandatory\nO\tOptional\nSIP\tSession Initiation Protocol\nSLF\tSubscription Locator Function\nS-CSCF\tServing CSCF\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tMain Concept",
            "description": "This document presents the Sh interface related functional requirements of the communicating entities.\nIt gives a functional classification of the procedures and describes the procedures and message parameters.\nError handling flows, protocol version identification, etc. procedures are also included.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "5\tGeneral Architecture",
            "description": "This clause further specifies the architectural assumptions associated with the Sh reference point, building on 3GPP TS 23.228 [1], 3GPP TS 23.218 [4] and also the Ph reference point building upon 3GPP TS 23.141 [18].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tFunctional requirements of network entities",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.1.1\tFunctional Requirements of the Application Server",
                            "text_content": "The Application Server may communicate with the HSS over the Sh interface.\nFor functionality of the Application Server refer to 3GPP TS 23.002 [3], 3GPP TS 23.228 [1] and 3GPP TS 23.218 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.2\tFunctional requirements of HSS",
                            "text_content": "The HSS may communicate with the Application Server over the Sh interface and with the Presence Network Agent over the Ph interface. The functionality of the Ph interface shall be the same as the functionality of the Sh interface.\nFor functionality of the HSS refer to 3GPP TS 23.002 [3], 3GPP TS 23.228 [1] and 3GPP TS 23.218 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.1.3\tFunctional Requirements of the Presence Network Agent",
                            "text_content": "The Presence Network Agent may communicate with the HSS over the Ph interface. In this case, all references to an Application Server in this specification apply also to a Presence Network Agent.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.2\tFunctional classification of Sh interface procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "Operations on the Sh interface are classified in functional groups:\n1.\tData handling procedures\n-\tThe download of data from the HSS to an AS.\n-\tThe update of data in the HSS.\n2.\tSubscription/notification procedures\n-\tAn AS can subscribe to receive notifications from the HSS of changes in data.\n-\tThe HSS can notify an AS of changes in data for which the AS previously had subscribed.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "6\tProcedure Descriptions",
            "description": "In the tables that describe the Information Elements transported by each command, each Information Element is marked as (M) Mandatory, (C) Conditional or (O) Optional.\n-\tA mandatory Information Element (marked as (M) in the table) shall always be present in the command. If this Information Element is absent, an application error occurs at the receiver and an answer message shall be sent back to the originator of the request with the Result-Code set to DIAMETER_MISSING_AVP. This message shall also include a Failed-AVP AVP containing the missing Information Element i.e. the corresponding Diameter AVP defined by the AVP Code and the other fields set as expected for this Information Element.\n-\tA conditional Information Element (marked as (C) in the table) shall be present in the command if certain conditions are fulfilled.\n-\tIf the receiver detects that those conditions are fulfilled and the Information Element is absent, an application error occurs and an answer message shall be sent back to the originator of the request with the Result-Code set to DIAMETER_MISSING_AVP. This message shall also include a Failed-AVP AVP containing the missing Information Element i.e. the corresponding Diameter AVP defined by the AVP Code and the other fields set as expected for this Information Element.\n-\tIf those conditions are not fulfilled, the Information Element shall be absent. If however this Information Element appears in the message, it shall not cause an application error and it may be ignored by the receiver if this is not explicitly defined as an error case. Otherwise, an application error occurs at the receiver and an answer message with the Result-Code set to DIAMETER_AVP_NOT_ALLOWED shall be sent back to the originator of the request. A Failed-AVP AVP containing a copy of the corresponding Diameter AVP shall be included in this message.\n-\tAn optional Information Element (marked as (O) in the table) may be present or absent in the command, at the discretion of the application at the sending entity. Absence or presence of this Information Element shall not cause an application error and may be ignored by the receiver.\nWhen a procedure is required to determine the Public Identity used for an identity lookup in HSS and SLF, the HSS and SLF shall derive the Public Identity from the SIP URI or Tel URI contained in the Public-Identity AVP, if not already in canonical form as per 3GPP TS 23.003 [11], as described below:\n-\tIf the Public-Identity AVP contains a SIP URI, the HSS and SLF shall follow rules for conversion of SIP URI into canonical form as specified in IETF RFC 3261 [16] clause 10.3.\n-\tIf the Public-Identity AVP contains a Tel URI in E.164 format, the HSS and SLF shall remove visual separators and remove all URI parameters.\nWhen a command contains a ServiceData XML element with or without content (i.e. <ServiceData></ ServiceData>), the Service Data element is defined as present in the clauses 6.1 to 6.4.\nUnknown permanent failure error codes shall be treated in the same way as DIAMETER_UNABLE_TO_COMPLY. For unknown transient failure error codes the request may be repeated, or handled in the same way as DIAMETER_UNABLE_TO_COMPLY.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tUser data handling procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tData read (Sh-Pull)",
                            "text_content": "This procedure is used between the AS and the HSS. The procedure is invoked by the AS and is used:\n-\tTo read transparent and/or non-transparent data for a specified user from the HSS.\nThis procedure is mapped to the commands User-Data-Request/Answer in the Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.1.1 and 6.1.1.2 detail the involved information elements.\nTable 6.1.1.1: Sh-Pull\n\nTable 6.1.1.2: Sh-Pull Resp\n\nThe HSS may prioritise the received request message according to priority level received within the Session-Priority AVP.\nNOTE 1:\tRefer to Annex I for HSS procedures associated with the handling of both the Session-Priority AVP and DRMP AVP received in the request message.\nThe conditions for the inclusion of Requested-Domain and Requested-Node as an additional key to the requested data are described in table 7.6.1. If repository data is requested, Service-Indication shall be present in the request. If initial filter criteria are requested, the Server-Name AVP shall contain the SIP URL of the AS that initiates the request; requests for initial filter criteria are limited to those initial filter criteria which are relevant to the requesting AS. If DSAI information is requested, the DSAI-Tag AVP shall be present.\nUpon reception of the Sh-Pull request, the HSS shall, in the following order:\n1.\tIn the AS permission list (see clause 6.2) check that the requested user data is allowed to be read (Sh-Pull) by this AS by checking the combination of the identity of the AS sending the request (identified by the Origin-Host AVP) and the supplied Data-Reference.\nIf one or more Data References in the request are not allowed to be read, Experimental-Result shall be set to DIAMETER_ERROR_USER_DATA_CANNOT_BE_READ in the Sh-Pull Response.\n2.\tCheck that the User Identity for whom data is asked exists in HSS. If not, Experimental-Result shall be set to DIAMETER_ERROR_USER_UNKNOWN in the Sh-Pull Response.\n2a.\tCheck if the Private Identity (if received) corresponds to IMPU/MSISDN/External Identifier received in User-Identity. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.\n3.\tIf the type of the User Identity (i.e. IMS Public User Identity or Public Service Identity, MSISDN or External Identifier) does not apply according to Table 7.6.1 as access key for the Data-Reference (if Notif-Eff is in use: for all the Data-References) indicated in the request, Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Pull Response.\n3a. If data-reference is IPAddressSecureBindingInformation (22) and the User Identity is an IMS Public User Identity that is shared between multiple Private User Identities, Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Pull Response.\n4.\tCheck whether or not the data that is requested to be downloaded by the AS is currently being updated by another entity. If there is an update of the data in progress, the HSS may delay the Sh-Pull-Resp message until the update has been completed. The HSS shall ensure that the data returned is not corrupted by this conflict. If HSS is not able to delay the Sh-Pull-Resp message e.g. due to timeout the Experimental-Result-Code shall be set to DIAMETER_USER_DATA_NOT_AVAILABLE.\n4a.\tIf T-ADS Information is requested, the HSS/UDM shall take into account information possibly received from MME ,SGSN, and/or AMF during the registration, location update or notification procedure, in order to decide whether MME, SGSN and/or AMF need to be contacted before a response is sent to the AS.\n-\tThe HSS/UDM shall provide the most recent IMS Voice over PS Sessions support indication as indicated by the serving nodes. The HSS/UDM shall provide the Access Type and RAT type, if available. The HSS/UDM may also provide the last UE activity time, if available which should include a specific timezone. See Annex E.\nNOTE 2:\tThe last UE activity time without a specific timezone can result in IMS receiving unexpected time if timezone is not included, especially for roaming to PLMN with different timezone.\n-\tIf all serving nodes need to be contacted, and if at least one serving node does not support T-ADS Data Retrieval or did not successfully answer to the T-ADS request from the HSS, the HSS shall indicate that IMS Voice over PS Sessions support is unknown, i.e., the HSS shall not indicate support, or non-support, of IMS Voice over PS Sessions unless all registered serving nodes have provided indication of their support, non-support, or detached status.\n-\tIf the HSS/UDM knows that one of the registered serving nodes is a Gn/Gp-SGSN, the HSS/UDM shall not contact the MME for T-ADS Data Retrieval, and shall provide the most recent IMS Voice over PS Sessions support indication as indicated by the Gn/Gp-SGSN and/or the AMF. If the Gn/Gp-SGSN needs to be contacted and it does not support T-ADS Data Retrieval, the HSS shall indicate IMS Voice over PS Sessions support is unknown.\nNOTE 3:\tIf the UE is registered with both MME and SGSN, and the HSS knows that the SGSN is a Gn/Gp-SGSN, the HSS does not need to know if the MME supports IMS Voice over PS Sessions or not. The HSS can determine that the SGSN registered is a Gn/Gp-SGSN by different ways, e.g. by configuration, or according to the information (e.g. EPS Subscription Data Not Needed Indicator) received in MAP_UpdateGPRSLocation request.\nNOTE 4:\tIf the UE is registered with both MME and SGSN, and the HSS is unable to know that the SGSN is a Gn/Gp-SGSN, the HSS will indicate IMS Voice over PS Sessions support as unknown if the MME does not support T-ADS Data Retrieval or did not successfully answer to the T-ADS request from the HSS, even if the Gn/Gp-SGSN indicated IMS Voice over PS Sessions is supported.\n-\tIf the serving node answers successfully to the T-ADS data request, but it does not include any of the T-ADS Information Elements (IMS Voice over PS Sessions Supported, Access Type, RAT Type and Last UE Activity Time), the HSS shall indicate IMS Voice over PS Sessions support is not supported, unless the subscriber is attached in another node that indicates support (if applicable).\n-\tIf at least one serving node provided T-ADS data to the HSS, the HSS may also provide the received last UE activity time which should include a specific timezone, Access Type and RAT type. If all serving nodes successfully answer to the T-ADS request from the HSS, the HSS shall provide the most recent IMS Voice over PS Sessions support indication as indicated by the serving nodes.\nNOTE 5:\tThe last UE activity time without a specific timezone can result in IMS receiving unexpected time if timezone is not included, especially for roaming to PLMN with different timezone.\n4b.\tIf CSRN is requested but roaming number retrieval from the MSC/VLR fails, the HSS shall include an empty CSRN element in the xml document returned to the AS. In addition, if MTRR is applicable (see 3GPP TS 23.018 [10]), the HSS shall set an MTRR-Indication in the xml document. See 3GPP TS 23.292 [33].\n5.\tThe HSS shall include the data pertinent to the requested Data Reference in the User-Data AVP. The HSS shall set the Result-Code to DIAMETER_SUCCESS. This includes cases where the data is not available to the HSS. The pertinent data included shall refer to the received IMPU/MSISDN/External Identifier and Private Identity (if present).\nNOTE 6:\tData referred to a Private Identity (e.g. IMS Private User Identity) implies that only the data (e.g. Location Information) specific for that Private Identity is included, regardless of the type of User Identity received (e.g. IMS Public User Identity shared by multiple IMS Private User Identities).\nIf both the AS and the HSS have determined via mutual feature evaluation to not support the Notif-Eff feature and in the case that requested data is not available to the HSS, the HSS shall not include the User-Data AVP in the Sh-Pull Response.\nIf both the AS and the HSS support the Notif-Eff feature, the HSS shall include the data pertinent to all the requested Data References, Service Indications and Identity Sets in the User-Data AVP. The following applies:\n-\tIf none of the requested data is available to the HSS, the HSS shall not include the User-Data AVP in the Sh-Pull Response.\n-\tIf some of the requested data is not available to the HSS, it shall be indicated as follows:\n-\tEmpty repository data shall be indicated with the RepositoryData element that contains a Service Indication and a Sequence Number but does not contain a ServiceData element (i.e. ServiceData is not present).\n-\tUnavailable Public Identifiers shall be indicated with an empty PublicIdentifiers element.\n-\tUnavailable location information shall be indicated by an empty CSLocationInformation and/or an empty PSLocationInformation element and/or an empty EPSLocationInformation element and/or an empty TWANLocationInformation and/or and empty Sh-5GSLocationInformation.\n-\tUnavailable CS-UserState shall be indicated by a missing CSUserState element.\n-\tUnavailable PS-UserState shall be indicated by a missing PSUserState element.\n-\tUnavailable EPS-UserState shall be indicated by a missing EPSUserState element.\n-\tUnavailable elements of Sh IMS Data shall be indicated as follows:\n-\tAn unavailable S-CSCF name shall be indicated with empty SCSCFName element.\n-\tAn unavailable IP Address Secure Binding Information shall be indicated with empty IPv4address element or empty IPv6prefix element.\n-\tIf all iFCs for the user that are relevant for the AS are unavailable it shall be indicated with empty IFCs element.\n-\tNot available UE SRVCC capability shall be indicated with missing UE-SRVCC-Capability element.\n-\tNot available UE 5G SRVCC capability shall be indicated with missing UE-5G-SRVCC-Capability element.\n-\tNot available STN-SR shall be indicated with empty STN-SR element.\nNOTE 7:\tIf the HSS supports interworking with UDM, the HSS can also take into account the availability of the STN-SR from the UDM as described in 3GPP TS 23.632 [48].\n-\tNot available CSRN shall be indicated with empty CSRN element.\n-\tNot available IMSI shall be indicated with empty IMSI element.\nNOTE 8:\tIf there is no available STN-SR in the HSS, it indicates that the user is not SRVCC subscribed and if there is no available STN-SR from the UDM, it indicates that the user is not 5G-SRVCC subscribed, as described in 3GPP TS 23.008 [27] and 3GPP TS 23.632 [48].\nIf there is an error in any of the above steps, then the HSS shall stop processing and shall return the error code specified in the respective step (see 3GPP TS 29.329 [5] and 3GPP TS 29.229 [7] for an explanation of the error codes).\nIf the HSS cannot fulfil the received request for reasons not stated in the above steps, e.g. due to a database error or empty mandatory data elements, it shall stop processing the request and set Result-Code to DIAMETER_UNABLE_TO_COMPLY.\nOtherwise, the requested operation shall take place and the HSS shall return the Result-Code AVP set to DIAMETER_SUCCESS. Result-Code DIAMETER_SUCCESS is used also if the requested data does not exist in the HSS i.e. when the HSS is indicating valid empty data elements.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.1.1: Sh-Pull",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.1.2: Sh-Pull Resp",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.1.2\tData Update (Sh-Update)",
                            "text_content": "This procedure is used between the AS and the HSS. The procedure is invoked by the AS and is used:\n-\tTo allow the AS to update the transparent (repository) data stored at the HSS for each IMS Public User Identity (for Public User Identities matching a Wildcarded Public User Identity, the transparent data shall be stored per Wildcarded Public User Identity, and not for each specific Public User Identity matching that Wildcarded Public User Identity) or Public Service Identity (for Public Service Identities matching a Wildcarded PSI, the transparent data shall be stored per Wildcarded PSI, and not for each specific Public Service Identity matching that Wildcarded PSI).\n-\tTo allow the AS to update the PSI Activation State of a distinct Public Service Identity in the HSS.\n-\tTo allow the AS to update the Dynamic Service Activation Info stored at the HSS.\n-\tTo allow the AS to update the Short Message Service Registration Info stored at the HSS.\n-\tTo allow the AS to update the STN-SR stored at the HSS and/or the STN-SR stored at the UDM.\nNOTE:\tIn accordance with 3GPP TS 23.632 [48], if there is only an STN-SR available in the UDM, the STN-SR in the UDM is updated. If there is only an STN-SR available in the HSS, the STN-SR in the HSS is updated. If there is an STN-SR available in the UDM and in the HSS, the STN-SR in the UDM and the HSS are updated.\nThis procedure is mapped to the commands Profile-Update-Request/Answer in the Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.2.1 and 6.1.2.2 detail the involved information elements.\nTable 6.1.2.1: Sh-Update\n\nTable 6.1.2.2: Sh-Update Resp\n\nWithin the Sh-Update Request, the keys to determine the updated data are part of the information element Data (See 7.6). When data in the repository is updated (i.e. added, modified or removed) Service-Indication and Sequence-Number are also sent as part of the information element Data.\nNewly added transparent data shall be associated with a Sequence Number of 0 in the Sh-Update Request. Sequence Number value 0 is reserved exclusively for indication of newly added transparent data.\nModified and removed transparent data shall be associated within the Sh-Update Request with a Sequence Number of n+1 where n is the original Sequence Number associated with the transparent data before modification or removal. If n equals 65535, then the next modification or deletion of that transparent data shall be associated with a Sequence Number of 1.\nUpon reception of the Sh-Update request, the HSS shall, in the following order:\n1.\tIn the AS permission list (see clause 6.2) check that the data that is requested to be updated (Sh-Update) by this AS, is allowed to be updated by checking the combination of the identity of the AS sending the request (identified by the Origin-Host AVP) and the supplied Data-Reference.\n-\tIf the data is not allowed to be updated, Experimental-Result shall be set to DIAMETER_ERROR_USER_DATA_CANNOT_BE_MODIFIED in the Sh-Update Response.\n2.\tCheck that the User Identity in the request exists in the HSS. If not, Experimental-Result shall be set to DIAMETER_ERROR_USER_UNKNOWN in the Sh-Update Response.\n2a.\tCheck if the Private User Identity (if received) corresponds to the IMPU/MSISDN/External Identifier received in User-Identity. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.\n3.\tIf the type of the User Identity (i.e. IMS Public User Identity or Public Service Identity or MSISDN or External Identifier) does not apply according to Table 7.6.1 as access key for the Data-Reference (if Update-Eff-Enhance is in use: for all the Data-References) indicated in the request, Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Update Response.\n4.\tIf Data-Reference is PSIActivation (18), then the HSS shall check that the User Identity contains a distinct Public Service Identity. If it does, then the HSS shall update the corresponding PSI Activation State and return the Result-Code AVP set to DIAMETER_SUCCESS. If it does not, then the Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Update Response.\nThe change of a Public Service Identity from ACTIVE to INACTIVE shall trigger the network initiated deregistration of the Public Service Identity in the HSS.\n4a.\tIf Data-Reference is DSAI (19), check whether or not, for the Public Identity, there is an instance of DSAI matching the DSAI-Tag contained in the Sh-Update command. If so, then the HSS shall update the DSAI value and return the Result-Code AVP set to DIAMETER_SUCCESS. If not, Experimental-Result shall be set to DIAMETER_ERROR_DSAI_NOT_AVAILABLE.\nThe changes of DSAI value shall trigger the procedures described in clause 7.14 in order to determine which initial filter criteria should be masked or unmasked. If these procedures change the set of unmasked initial filter criteria, the HSS should behave as if the initial filter criteria had been administratively changed, which implies e.g. sending Sh-Notif or Cx-Update_Subscr_Data messages (see 3GPP TS 29.228 [6]).\n4b.\tIf Data-Reference is SMSRegistrationInfo (24), check whether or not, for the IMS Public User Identity or MSISDN or External Identifier, IP-SM-GW number element contained in the Sh-Update command is empty. If it is empty, then the HSS shall delete the stored registered IP-SM-GW number (if any) and the stored registered IP-SM-GW Diameter Identity (if any), and return the Result-Code AVP set to DIAMETER_SUCCESS. A preconfigured IP-SM-GW number and preconfigured IP-SM-GW Diameter Identity shall not be deleted.\nIf it is not empty, the HSS shall store/update the registered IP-SM-GW number and, if S6c is supported, the IP-SM-GW Diameter Identity as received within the Origin-Host and Origin-Realm AVPs, and return the Result-Code AVP set to DIAMETER_SUCCESS. A preconfigured IP-SM-GW number and preconfigured IP-SM-GW Diameter Identity shall not be overwritten.\nThe Service Centre Address in the HSS shall not be updated by this operation.\nNOTE 1:\tThe address of the Short Message Service Centre as defined in 7.6.16 is only applicable to Sh-Pull operation.\n4c.\tIf the Data-Reference indicates that repository data is present, and if the HSS and the AS supports the Update-Eff feature, check whether there are multiple repository data instances. If so, then repeat the steps 5 and 6 below for each instance of repository data ensuring that no repository data is changed until the checks done in the steps 5 and 6 have been successful for all the repository data instances.\n4d.\tIf the Data-Reference is STN-SR (27) and if the STN-SR is different from the one previously stored or provisioned in the HSS, the HSS shall overwrite the STN-SR. If the Data-Reference is STN-SR (27), the HSS supports interworking with the UDM (see in 3GPP TS 23.632 [48]), and if the STN-SR is different from the one previously stored or provisioned in the UDM, the UDM shall overwrite the STN-SR. If the Data-Reference is STN-SR (27), and if there is no stored STN-SR in the HSS and there is no stored STN-SR in the UDM, Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Update Response.\nNOTE 2:\tIf there is no stored STN-SR in the HSS, it indicates that the user is not SRVCC subscribed and if there is no stored STN-SR in the UDM, it indicates that the user is not 5G-SRVCC subscribed, as described in 3GPP TS 23.008 [27].\n5.\tCheck whether or not the data that is requested to be updated by the AS, as identified by the Service-Indication, is currently being updated by another entity. If there is an update of the data in progress, Experimental-Result shall be set to DIAMETER_PRIOR_UPDATE_IN_PROGRESS in the Sh-Update Response.\n6.\tCheck whether or not there is any repository data stored at the HSS already for the specified Service-Indication and the associated IMS Public User Identity (or group if the IMS Public User Identity is alias) or Public Service Identity.\n-\tIf repository data identified by the Service-Indication is stored at the HSS for the specified IMS Public User Identity, IMS Public User Identity group or Public Service Identity, check the following premises:\n1.\tSequence_Number_in_Sh_Update is not equal to 0\n2.\t(Sequence_Number_in_Sh_Update - 1) is equal to (Sequence_Number_In_HSS modulo 65535)\n-\tIf either of the above premises is false then Experimental-Result shall be set to DIAMETER_ERROR_TRANSPARENT_DATA_OUT_OF_SYNC in the Sh-Update Response.\n-\tIf both of the above premises are true, then check whether or not Service Data is received within the Sh-Update Req.\n-\tIf Service Data element is present in the Sh-Update Req, check whether or not the size of the data is greater than that which the HSS is prepared to accept.\n-\tIf there is more data than the HSS is prepared to accept then Experimental-Result shall be set to DIAMETER_ERROR_TOO_MUCH_DATA and the new data shall be discarded.\n-\tIf the HSS is prepared to accept the data, then the repository data stored at the HSS shall be updated with the repository data sent in the Sh-Update Req and the Sequence Number associated with that repository data shall be updated with that sent in the Sh-Update Req. This triggers the sending of Sh-Notif messages to any other ASs that are subscribed to Notifications for updates to the service data for that IMS Public User Identity or Public Service Identity. This also triggers the sending of Sh-Notif messages for an alias of that IMS Public User Identity to any AS that is subscribed to Notifications for updates to the service data for that alias of the received IMS Public User Identity (see clause 6.1.4).\n-\tIf Service Data element is not present in the Sh-Update Req, the data stored in the repository at the HSS shall be removed, and as a consequence the Service Indication and the Sequence Number associated with the removed data shall also be removed. This triggers the sending of Sh-Notif messages with that Service Indication and Sequence Number to be deleted but with an absent Service Data element, to any other ASs that are subscribed to Notifications for updates to the service data for that IMS Public User Identity or Public Service identity (see 6.1.4). After sending Sh-Notif messages, the subscriptions to Notifications for the removed Repository Data shall be deleted.\n-\tIf repository data identified by the Service-Indication is not stored for the IMS Public User Identity, IMS Public User Identity group or Public Service Identity i.e. the Sh-Update Req intends to create a new repository data, check whether or not the Sequence Number in the Sh-Update Req is 0.\n-\tIf the sequence number is not set to 0, Experimental-Result shall be set to DIAMETER_ERROR_TRANSPARENT_DATA_OUT_OF_SYNC\n-\tIf the sequence number is set to 0 check whether Service Data is included within the Sh-Update Req.\n-\tIf Service Data is not present in the Sh-Update Req, then Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED and the operation shall be ignored by the HSS.\n-\tIf Service Data element is present in the Sh-Update Req, check whether or not the size of the data is greater than that which the HSS is prepared to accept.\n-\tIf there is more data than the HSS is prepared to accept then Experimental-Result shall be set to DIAMETER_ERROR_TOO_MUCH_DATA and the new data shall be discarded.\n-\tIf the HSS is prepared to accept the data included in the Sh-Update Req, then the data shall be stored in the data repository in the HSS.\nIf the HSS receives a request to update data other than Repository Data while a previous update request of the same data for the same user identity is still in progress, the HSS should stop processing the later request and set the Experimental-Result-Code to DIAMETER_PRIOR_UPDATE_IN_PROGRESS.\nNOTE 3:\tIf the HSS receives a request to update data other than Repository Data while a previous update request of the same data for the same user identity is still in progress, it identifies either an AS or network misbehavior. If the HSS processed those requests it could cause a network unexpected behaviour.\nIf there is an error in any of the above steps then the HSS shall stop processing and shall return the error code specified in the respective step (see 3GPP TS 29.329 [5] and 3GPP TS 29.229 [7] for an explanation of the error codes).\nIf the HSS cannot fulfil the received request for reasons not stated in the above steps, e.g. due to database error, it shall stop processing the request and set Result-Code to DIAMETER_UNABLE_TO_COMPLY.\nIf the HSS and the AS support the Update-Eff feature, the Sh Update is successful only if it is successful for the update of all the repository data instances in the request. Otherwise the HSS shall keep or restore all the stored repository data as they were before receiving the Sh Update request. If the error occurs during the steps 5 or 6 and if there were several repository data instances in the request, the Sh Update response shall contain a Repository Data ID indicating the service indication and the sequence number of (one of) the repository data instance(s) for which an error occurred.\nIf the HSS and the AS support the Update-Eff-Enhance feature, the Sh Update is successful only if it is successful for the update of all the data instances in the request. Otherwise the HSS shall keep or restore all the stored data as they were before receiving the Sh Update request. If an error occurs during the steps 5 or 6 with any of the data instance in the request, the Sh Update response shall contain the corresponding Data Reference indicating the first data instance for which an error occurred. If there were several repository data instances in the request, the HSS shall behave the same as specified for Update-Eff feature.\nOtherwise, the requested operation shall take place and the HSS shall return the Result-Code AVP set to DIAMETER_SUCCESS.\nNOTE 4:\tWhen an AS receives DIAMETER_ERROR_TRANSPARENT_DATA_OUT_OF_SYNC the AS may attempt to resolve the inconsistency between the version of the repository data that it holds and that stored at the HSS. It may execute a Sh-Pull to retrieve the current version of the data from the HSS or it may wait to receive a subsequent Sh-Notif message from the HSS for the affected repository data.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.2.1: Sh-Update",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.2.2: Sh-Update Resp",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.1.3\tSubscription to notifications (Sh-Subs-Notif)",
                            "text_content": "This procedure is used between the AS and the HSS. The procedure is invoked by the AS and is used:\n-\tTo subscribe to Notifications for when particular transparent and/or non-transparent data for a specified IMS Public User Identity or Public Service Identity is updated, from the HSS.\n-\tOptionally to request the user data from the HSS in the same operation.\nThis procedure is mapped to the commands Subscribe-Notifications-Request/Answer in the Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.3.1 and 6.1.3.2 detail the information elements involved.\nTable 6.1.3.1: Sh-Subs-Notif\n\nTable 6.1.3.2: Sh-Subs-Notif Resp\n\nThe HSS shall take note of the subscription request on the data identified by User Identity and Data-Reference. If notifications on changes of repository data are requested, Service-Indication shall be present in the request. If notifications on changes of filter criteria are requested, the Server-Name AVP shall be used as key to the filter criteria. If the request contains a specific Public Service Identity matching a Wildcarded PSI, the HSS shall interpret that the subscription refers to the information associated to the Wildcarded PSI. The Server-Name AVP shall contain the SIP URL of the AS sending the request. If notifications on changes of DSAI are requested, the DSAI-Tag AVP shall be used as key of the DSAI whose changes are to be monitored.\nUpon reception of the Sh-Subs-Notif request, the HSS shall, in the following order (if there is an error in any of the following steps the HSS shall stop processing and return the corresponding error code, see 3GPP TS 29.329 [5] and 3GPP TS 29.229 [7]), process the hereafter steps that, unless otherwise stated, apply both for the Subscription request type information element indicating the request is to subscribe or to unsubscribe:\n1.\tIn the AS permission list (see clause 6.2) the HSS shall check that the AS is allowed to subscribe to notifications (Sh-Subs-Notif) for the requested data by checking the combination of the identity of the AS sending the request (identified by the Origin-Host AVP) and the supplied Data-Reference.\n-\tIf this AS does not have Sh-Subs-Notif permission for the data referenced, Experimental-Result shall be set to DIAMETER_ERROR_USER_DATA_CANNOT_BE_NOTIFIED in the Sh-Subs-Notif Response.\n2.\tThe HSS shall check that the User Identity in the request exists in HSS. If not, Experimental-Result shall be set to DIAMETER_ERROR_USER_UNKNOWN in the Sh-Subs-Notif Response.\n2a.\tCheck if the Private Identity (if received) corresponds to IMPU/MSISDN/External Identifier received in User-Identity. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.\n3.\tIf the type of the User Identity (i.e. IMS Public User Identity or Public Service Identity or MSISDN or External Identifier) does not apply according to Table 7.6.1 as access key for the Data-Reference (if Notif-Eff is in use: for all the Data-References) indicated in the request, Experimental-Result shall be set to DIAMETER_ERROR_OPERATION_NOT_ALLOWED in the Sh-Subs-Notif Response.\n3a.\tIf Data-Reference is DSAI (19), check whether or not, for the Public Identity, there is an instance of DSAI matching the DSAI-Tag contained in the Sh-Subs-Notif command. If not, Experimental-Result shall be set to DIAMETER_ERROR_DSAI_NOT_AVAILABLE.\n4.\tIf the Sh-Subs-Notif Request contains an Expiry Time, the HSS should also include in the Sh-Subs-Notif Response an Expiry Time IE with the absolute time at which the subscription expires in the case of a successful subscription. This time may be earlier than the requested expiry time. If the HSS includes this IE, then no notification shall be sent to the AS after the expiration time. If the HSS receives a Sh-Subs-Notif Request without the Expiry Time IE, the HSS should treat it as a request for an unlimited subscription.\nIf the HSS does not include this IE in the response, that indicates an unlimited subscription.\nIf a subsequent request is received by the HSS where the Expiry Time IE is present but different from what the HSS has previously stored, the HSS should replace the stored expiration time with what was received in the request.\n5.\tIf Data-Reference is RepositoryData(0) and the transparent data associated with the Service Indication does not exist in the HSS (i.e. Service Data is not present), then Experimental-Result shall be set to DIAMETER_ERROR_SUBS_DATA_ABSENT.\n6.\tIf the Subscription request type information element indicates that this is a request to subscribe, the HSS shall associate the Application Server Identity with the list of entities that need to be notified when the data identified by the request is modified and set the Result-Code to DIAMETER_SUCCESS in the Sh-Subs-Notify response. If the Subscription request type information element indicates that this is a request to unsubscribe, the HSS shall remove the association of the Application Server Identity with the same list. In this last case, the Result-Code shall be set to DIAMETER_SUCCESS if the operation is successful or if the Application Server Identity was not present in the list.\n7.\tIf the HSS and AS supports the Notif-Eff feature and if multiple Data-Reference AVPs occur in the Sh-Subs-Notif Request, each Data-Reference shall be treated as a request to establish a separate notification request. When multiple notification requests are requested, and all of them succeed, the HSS shall set the Result-Code to DIAMETER_SUCCESS in the Sh-Subs-Notify response. If one of them is unsuccessful, the HSS shall return the Result code with the relevant Diameter error indication and come back to the situation regarding to subscriptions as before the reception of the Sh-Subs-Notif Request.\n8.\tIf the HSS and the AS supports the Notif-Eff feature and if multiple Service-Indication AVPs occur in the Sh-Subs-Notif Request, each Service-Indication shall be treated as a request to establish a separate notification request for change of Transparent data. When multiple notification requests are requested, and all of them are successful, the HSS shall return the Result-Code set to DIAMETER_SUCCESS in the Sh-Subs-Notify response. If one of them is unsuccessful, the HSS shall return the Result code with the relevant Diameter error value and come back to the situation regarding to subscriptions as before the reception of the Sh-Subs-Notif Request.\n8a.\tIf the HSS and the AS supports the Notif-Eff feature and if different Identity-Set AVPs occur in the Sh-Subs-Notif Request, each Identity-Set shall be treated as a request to establish a separate notification request. When multiple notification requests are requested, and all of them are successful, the HSS shall return the Result-Code set to DIAMETER_SUCCESS in the Sh-Subs-Notify response. If one of them is unsuccessful, the HSS shall return the Result code with the relevant Diameter error value and come back to the situation regarding to subscriptions as before the reception of the Sh-Subs-Notif Request.\n9.\tIf the Send Data Indication information element is present in the request and the HSS supports the return of the User-Data in this request, check whether or not the data that is requested to be downloaded by the AS is currently being updated by another entity. If there is an update of the data in progress, the HSS may delay the response until the update has been completed. The HSS shall ensure that the data returned is not corrupted by this conflict.\n10.\tIf the Send Data Indication information element is present in the request, the HSS should include the data pertinent to the requested Data Reference in the User-Data AVP and if the HSS supports the Notif-Eff feature, the HSS should include the data pertinent to all the requested Data References in the User-Data AVP. The HSS shall set the Result-Code to DIAMETER_SUCCESS. This includes cases where the data is not available to the HSS and an empty tag is included as follows.\n-\tUnavailable elements of Sh IMS Data shall be indicated as follows.\n-\tAn unavailable S-CSCF name shall be indicated with empty SCSCFName element.\n-\tIf all iFCs for the user that are relevant for the AS are unavailable it shall be indicated with empty IFCs element.\n-\tSimilarly for PSI activation information.\nIf the HSS cannot fulfil the received request for reasons not stated in the above steps, e.g. due to database error, it shall stop processing the request and set Result-Code to DIAMETER_UNABLE_TO_COMPLY.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.3.1: Sh-Subs-Notif",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.3.2: Sh-Subs-Notif Resp",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.1.4\tNotifications (Sh-Notif)",
                            "text_content": "This procedure is used between the HSS and the AS. The procedure is invoked by the HSS and is used:\n-\tTo inform the AS of changes in transparent and/or non-transparent data to which the AS has previously subscribed to receive Notifications for, using Sh-Subs-Notif (see 6.1.3).\nThis procedure is mapped to the commands Push-Notification-Request/Answer in the Diameter application specified in 3GPP TS 29.329 [5]. Tables 6.1.4.1 and 6.1.4.2 detail the involved information elements.\nTable 6.1.4.1: Sh-Notif\n\nTable 6.1.4.2: Sh-Notif Resp\n\nThe keys to the updated data are part of the information element User-Data AVP. When data repository is updated Service-Indication and Sequence Number shall also be part of the information element User-Data.\nSince authentication pending is a transient state of normally very short duration, notification of an IMS user's state change, to and from the authentication pending state shall not be sent to Application Servers, when the previous state before authentication pending and next state after authentication pending are the same. If the states are different before the authentication pending state is entered and after the authentication pending state is left then notification is sent to the AS of this new state.\nIf the HSS and AS supports the Notif-Eff feature and if multiple subscriptions to notifications are associated with a Public User Identity, the HSS may combine the notifications for multiple Data References and Service Indications into a single notification message.\nIf the HSS supports the Update-Eff and Notif-Eff features, the HSS may generate only one notification message to be sent to the AS(s) supporting the Notif-eff feature, grouping the data changes notifications according to the subscribed notifications and the resulting successful achievement of a Sh-Update procedure with multiple repository data instances, from an AS that supports the Update-Eff feature. This notification message may also include other notifications as described with the Notif-Eff feature.\nRemoval of the subscribed data is indicated with the content of User-Data AVP. The content shall be compliant with the XML-schema defined in Annex D. Removed repository data shall be indicated with RepositoryData element that does not contain ServiceData element. Removed S-CSCF name shall be indicated with empty SCSCFName element. Removed IP Address Secure Binding Information shall be indicated with empty IPv4Addres, or IPv6Prefix and/ or IPv6 interface element respectively. If all iFCs for the user that are relevant for the AS have been removed it shall be indicated with empty IFCs element.\nRemoval of Public Identity for which the AS has any active subscription shall be indicated in the DeletedIdentities element.\nIf One-Time-Notification AVP was included by the AS in Sh-Subs-Notif, the HSS shall remove the related subscription information after sending Sh-Notif, i.e. no subsequent notifications shall be sent to AS.\nNotifications shall include the data updated for the received IMPU/MSISDN/External Identifier and Private Identity (if present).\nNOTE:\tData referred to a Private Identity (e.g. IMS Private User Identity) implies that only the data (e.g. UE reachability) specific for that Private Identity is included, regardless of the type of User Identity received (e.g. IMS Public User Identity shared by multiple IMS Private User Identities).\nTable 6.1.4.1 details the valid result codes that the AS can return in the response.\nTable 6.1.4.1.1: Sh-Notif response valid result codes\n\nIf DIAMETER_ERROR_USER_UNKNOWN is received in the Sh-Notif response, the HSS shall remove all of the subscription to notification information subscribed by the AS related to the specific User Identity.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.1.4.1: Sh-Notif",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.4.2: Sh-Notif Resp",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 6.1.4.1.1: Sh-Notif response valid result codes",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "6.2\tAS permissions list",
                    "description": "",
                    "summary": "",
                    "text_content": "In table 7.6.1, the contents of the Data-AVP are described. Some of the individual elements carried within Data-AVP may be requested by the AS from the HSS using the Sh-Pull command (see clause 6.1.1) or may be updated at the HSS by the AS using the Sh-Update command (see clause 6.1.2). The AS may also request that the HSS notifies the AS of changes to specific elements within the Data-AVP using the Sh-Subs-Notif command (see clause 6.1.3). The HSS will only allow these operations to take place if the element of the Data-AVP is permitted to be included in the specific command requested by the AS, as indicated in table 7.6.1.\nTo manage whether an AS may request each element of Data-AVP with a specific command, the HSS shall maintain a list of AS permissions (the 'AS Permissions List'). AS permissions are identified by AS identity and Data Reference with the possible permissions associated with each Data Reference being Sh-Pull, Sh-Update, Sh-Subs-Notif or any combination of these permissions (see table 7.6.1 for details of which permissions are allowed for each Data Reference). The permissions apply to all users served by the HSS, they are not user specific. When an AS requests Sh-Pull, Sh-Update or Sh-Subs-Notif the HSS shall check permissions and return an error result if the AS does not have the required permission. If the AS permissions change in a later stage, i.e. the AS does not longer have the required permission, the HSS shall remove all the subscription to notifications for the AS for which required permissions have been prohibited.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.3\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.4\tVoid",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.5\tUser identity to HSS resolution",
                    "description": "",
                    "summary": "",
                    "text_content": "The User identity to HSS resolution mechanism enables the AS to find the identity of the HSS that holds the subscriber data for a given IMS Public User Identity or Public Service Identity when multiple and separately addressable HSSs have been deployed by the network operator. The resolution mechanism is not required in networks that utilise a single HSS or when an AS is configured to use pre-defined HSS.\nThe resolution mechanism described in 3GPP TS 23.228 [1] shall use a Subscription Locator Function (SLF) or a Diameter Proxy Agent.\nThe AS accesses the SLF via the Dh interface. The Dh interface shall always be used in conjunction with the Sh interface. The Dh interface shall be based on the Diameter base protocol as specified in IETF RFC 6733 [44]. The SLF functionality shall use the routing mechanism provided by an enhanced Diameter redirect agent.\nThe SLF or the Diameter Proxy Agent shall be to determine the HSS identity.\nTo get the HSS identity the AS shall send the Sh request normally destined to the HSS to a pre-configured Diameter address/name.\n-\tIf this Sh Request is received by an SLF (acting as a Diameter redirect agent), the SLF shall determine the HSS address and shall send to the AS a notification of redirection towards the HSS identity, in response to the Sh request. Multiple HSS identities may be included in the response, as specified in IETF RFC 6733 [44]. In such a case, the AS shall send the Sh Request to the first HSS identity in the ordered list received in the Sh Response from the SLF. If the AS does not receive a successful response to the Sh Request, the AS shall send a Sh Request to the next HSS identity in the ordered list. This procedure shall be repeated until a successful response from an HSS is received.\n-\tIf this Sh Request is received by the Diameter Proxy Agent, the Diameter Proxy Agent shall determine the HSS identity based on the provided user identity and - if the Diameter load control mechanism is supported (see IETF RFC 8583 [43]) - optionally also based on previously received load values from Load AVPs of type HOST. The Diameter Proxy Agent shall then forward the Sh request directly to the determined HSS. The AS shall determine the HSS identity from the response to the Sh request received from the HSS.\nThe AS should store the HSS identity/name/Realm and shall use it in further Sh requests associated to the same IMS Public Identity.\nIn networks where the use of the user identity to HSS resolution mechanism is required and the AS is not configured to use a predefined HSS, each AS shall be configured with the pre-configured address/name of the SLF or the Diameter Proxy Agent to enable use of these resolution mechanisms.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "7\tInformation element contents",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tUser Identity",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element contains an IMS Public User Identity, Public Service Identity, MSISDN or External Identifier according to the conditions described in table 7.1.1.\nTable 7.1.1: User Identity content\n\n",
                    "tables": [
                        {
                            "description": "Table 7.1.1: User Identity content",
                            "table number": 12,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.1.1\tIMS Public User Identity / Public Service Identity",
                            "text_content": "This information element contains an IMS Public User Identity / Public Service Identity (either SIP URI or tel URI). See 3GPP 23.003 [11].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.1.2\tMSISDN",
                            "text_content": "This information element contains the MSISDN, or the Basic MSISDN if multinumbering is used (see 3GPP TS 23.012 [19]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.1.3\tExternal Identifier",
                            "text_content": "This information element contains the External Identifier (see 3GPP TS 23.003 [11]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.1A\tWildcarded PSI",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element contains a Wildcarded PSI that is hosted by an application server. For definition of a Wildcarded PSI, see 3GPP TS 23.003 [11].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.1B\tWildcarded Public User Identity",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element contains a Wildcarded Public User Identity that is stored in the HSS. For definition of a Wildcarded Public User Identity, see 3GPP TS 23.003 [11].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2\tRequested Domain",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element details the access domains for which certain data (e.g. user state, location information) are requested. See 3GPP TS 29.329 [5] for the list of possible values.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2A\tRequested Nodes",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element details the access node types for which certain data (e.g. user state, location information) are requested. See 3GPP TS 29.329 [5] for the list of possible values.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2B\tServing Node Indication",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates that the sender does not require any location information other than the serving node address/identity (i.e. MME name and/or SGSN number and/or AMF address, or VLR number) for the requested domain and the requested nodes (if included). Other location information (e.g. Global Cell ID, Tracking Area ID) may be absent.\nThis information element is only applicable to Location Information.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.3\tRequested Data",
                    "description": "",
                    "summary": "",
                    "text_content": "-\tReference to the data that an AS is requesting from the HSS.\n-\tReference to the data which, an AS wants to be notified of, when changed.\n-\tReference to data for which subscription to notification of change is rejected.\n-\tReference to data for which updates are required.\n-\tReference to data for which update fails.\nSee clause 7.6.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.4\tService Indication",
                    "description": "",
                    "summary": "",
                    "text_content": "Identifier of one set of service related transparent data, which is stored in an HSS in an operator network per Public Identity. The HSS shall allocate memory space to implement a data repository to store transparent data per IMS Public User Identity or Public Service Identity and value of Service Indication with a Sequence Number for verification. For Public Service Identities matching a Wildcarded Public Service Identity, the repository data shall be stored per Wildcarded Public Service Identity and not for each specific Public Service Identity.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.5\tResult",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element contains the result code of the operation. See 3GPP TS 29.329 [5] for the list of possible values.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.6\tData",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element contains an XML document conformant to the XML schema defined in Annex D.\nAnnex C specifies the UML logical model of the data downloaded via the Sh interface.\nTable 7.6.1 defines the data reference values and tags, access key and recommended AS permissions (as described in clause 6.2) for the operation(s) on data accessible via the Sh interface, i.e. the listed operation(s) in the Operations column are the only ones allowed to be used with this Data Ref value. It is a matter of operator policy to further restrict the AS permission rights defined in table 7.6.1.\nAn access key between square brackets is considered as optional, while when more than one access key is separated by logical OR and included between brackets, it means that one (and only one) of these access keys is mandatory.\nTable 7.6.1: Data accessible via Sh interface\n\n",
                    "tables": [
                        {
                            "description": "Table 7.6.1: Data accessible via Sh interface",
                            "table number": 13,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.6.1\tRepository Data",
                            "text_content": "This information element contains transparent data. A data repository may be shared by more than one AS implementing the same service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.2\tIMSPublicIdentity",
                            "text_content": "This data contents included in the Sh-Pull Resp, Sh-Subs-Notif Resp or Sh-Notif depends on whether Requested Identity Set information element was included in the Sh-Pull or Sh-Subs-Notif, as follows:\n-\tWhen this information element takes the value IMPLICIT_IDENTITIES, the HSS shall provide all non-barred IMS Public Identities that belong to the same implicit registration set as the IMS Public Identity included in the message in the User-Identity AVP. The MSISDN and External Identifier within the User-Identity AVP are not applicable for this value. If the User Identity is a Public Service Identity, the HSS shall return only the User Identity received in the request.\n-\tWhen this information element takes the value ALIAS_IDENTITIES, the HSS shall provide all non-barred IMS Public User Identities that are in the same Alias Public User Identity Set as the IMS Public User Identity included in the message in the User-Identity AVP (see 3GPP TS 23.008 [27] for the definition of Alias Public User Identity Set). The MSISDN, the Public Service Identity and the External Identifier within the User-Identity AVP are not applicable for this value.\n-\tWhen this information element takes the value REGISTERED_IDENTITIES, the HSS shall provide all non-barred IMS Public Identities whose state is registered, belonging to all Private Identities that the IMS Public Identity or MSISDN or External Identifier in the User-Identity AVP is associated with. If the User Identity is a Public Service Identity, the HSS shall return no identities in the response.\n-\tWhen this information element takes the value ALL_IDENTITIES, the HSS shall provide all non-barred IMS Public Identities, belonging to all Private Identities that the User Identity is associated with.\n-\tWhen this information element is not included, the HSS shall download the set of IMS Public Identities that would be downloaded if the value of this information element had been ALL_IDENTITIES.\nAn IMS Public Identity would be either:\n-\tassociated with the same Private User Identity or Private Service Identity as the User Identity included in the request or\n-\tassociated with the MSISDN present in the request or\n-\tassociated with an External Identifier present in the request.\nMultiple instances of this information element may be included in the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.3\tIMS User State",
                            "text_content": "This information element contains the IMS User State of the public identifier referenced. Its possible values are:\n-\tREGISTERED,\n-\tNOT_REGISTERED,\n-\tAUTHENTICATION_PENDING,\n-\tREGISTERED_UNREG_SERVICES.\nIf the IMS Public User Identity is shared between multiple Private User Identities, HSS shall indicate the most registered state of the shared IMS Public User Identity to an AS. The most registered state of a shared IMS Public User Identity is defined as follows:\n-\tIf the shared IMS Public User Identity is registered with any of the Private User Identities, the most registered state of the shared IMS Public User Identity is REGISTERED.\n-\tIf the shared IMS Public User Identity is not currently registered with any of the Private User Identities, but it is in state REGISTERED_UNREG_SERVICES, then the most registered state of the shared IMS Public User Identity is REGISTERED_UNREG_SERVICES.\n-\tIf the shared IMS Public User Identity is not currently registered with any of the Private User Identities, and it is not in state REGISTERED_UNREG_SERVICES, but it is in the process of being authenticated with any of the Private User Identities, then the most registered state of the shared IMS Public User Identity is AUTHENTICATION_PENDING.\n-\tIf the shared IMS Public User Identity is not currently registered with any of the Private User Identities, and it is not in state REGISTERED_UNREG_SERVICES, and it is not in the process of being authenticated with any of the Private User Identities, then the most registered state of the shared IMS Public User Identity is NOT_REGISTERED.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.4\tS-CSCF Name",
                            "text_content": "This information element contains the name of the S-CSCF assigned to the IMS Subscription.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.5\tInitial Filter Criteria",
                            "text_content": "This information element contains the triggering information for a service.\nFor a more detailed description, refer to 3GPP TS 23.218 [4] and 3GPP TS 29.228 [6].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.6\tLocation Information",
                            "text_content": "This information element contains either:\n-\tthe location of the served subscriber in the MSC/VLR if the requested domain is CS, or\n-\tthe location of the served subscriber in the SGSN if the requested domain is PS and either the requested node is solely SGSN or the requested node is not present, or\n-\tthe location of the served subscriber in the MME if the requested domain is PS and the requested nodes is solely MME, or\n-\tthe locations of the served subscriber in the 3GPP AAA Server for TWAN if the requested domain is PS and the requested nodes is solely 3GPP AAA SERVER for TWAN, or\n-\tthe location of the served subscriber in the AMF (for 3GPP access) if the requested domain is PS and the requested nodes is solely AMF.\n-\tthe locations of the served subscriber in the MME and the SGSN and 3GPP AAA Server for TWAN and AMF if the requested domain is PS and the requested nodes are all of MME and SGSN and 3GPP AAA SERVER for TWAN and AMF, or\n-\tthe locations of the served subscriber in any of the two or three serving nodes among the MME, the SGSN, the 3GPP AAA Server for TWAN and the AMF if the requested domain is PS and the requested nodes indicates the corresponding nodes for which the location are to be requested.\nIf the HSS has to communicate with the MSC/VLR or SGSN and/or MME and/or 3GPP AAA Server and/or AMF (via UDM) to retrieve location information, it shall make use of the service MAP-PROVIDE-SUBSCRIBER-INFO or S/S6d-IDR or SWx-PPR or make use (via UDM) of the Namf Service-Based Interface services. This information element shall contain the location information as received from the access nodes.\nIf the HSS or HSS/UDM cannot communicate with the VLR or SGSN or MME or AMF (e.g., because the UE is purged), or if the HSS or HSS/UDM cannot retrieve the location information from the serving nodes because they do not support such feature, the HSS shall provide locally stored location information if available (e.g., serving node name, Visited PLMN ID) received in a previous Update Location message, and the last known UE's location if available e.g. as received in the Purge message from VLR or SGSN or MME or AMF.\nIf the Serving Node Indication was present in the request, the location information shall contain the serving node address(es) as stored in the HSS, according to the requested domain and the requested nodes (if received). Other location information may be absent, in order to eliminate unnecessary communication with the MSC/VLR or SGSN and/or MME and/or 3GPP AAA Server and/or AMF when the AS does not require these information elements.\nFor both Location Information for CS and Location Information for GPRS, the considerations described in 3GPP TS 23.078 [14] apply.\nThis information element consists of the following subordinate information elements:\n-\tLocation number: defined in ITU-T Recommendation Q.763 [9]. Considerations described in 3GPP TS 23.018\tapply [10].\n-\tService area ID: defined in 3GPP TS 23.003 [11].\n-\tCell Global ID: defined in 3GPP TS 23.003 [11].\n-\tLocation area ID: defined in 3GPP TS 23.003 [11].\n-\tGeographical Information: defined in 3GPP TS 23.032 [12]. Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.\n-\tGeodetic Information: defined in ITU-T Recommendation Q.763 [9]. Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.\n-\tVLR Number: defined in 3GPP TS 23.003 [11].\n-\tMSC Number: defined in 3GPP TS 23.003 [11].\n-\tAge of location information: defined in 3GPP TS 23.018 [10].\n-\tCurrent Location Retrieved: shall be present when location information was obtained after a successful paging procedure for Active Location Retrieval if the MS is in idle state or when the location was provided if the MS is in active state.\n-\tUser CSG information: defined in 3GPP TS 23.060 [29].\n-\tE-UTRAN Cell Global ID: defined in 3GPP TS 23.003 [11].\n-\tTracking Area ID: defined in 3GPP TS 23.003 [11].\n-\tLocal Time Zone: the Local Time Zone information (Time Zone and Daylight Saving Time) of the location in the visited network where the UE is attached, as defined in 3GPP TS 29.272 [26].\nNOTE:\tWhen the MSC receives the location information via SGs interface as specified in 3GPP TS 29.118 [30], the E-UTRAN Cell Global ID and Tracking Area ID are included, rather than Location number, Service area ID, Cell Global ID and Location area ID.\nThis information element consists of the following subordinate information elements:\n-\tService area ID: defined in 3GPP TS 23.003 [11].\n-\tCell Global ID: defined in 3GPP TS 23.003 [11].\n-\tLocation area ID: defined in 3GPP TS 23.003 [11].\n-\tGeographical Information: defined in 3GPP TS 23.032 [12]. Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.\n-\tGeodetic Information: defined in ITU-T Recommendation Q.763 [9]. Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.\n-\tSGSN Number: defined in 3GPP TS 23.003 [11].\n-\tRouting Area ID: defined in 3GPP TS 23.003 [11].\n-\tCurrent Location Retrieved: shall be present when location information was obtained after a successful paging procedure for Active Location Retrieval if the UE is in idle mode or when the location was provided if the UE is in connected mode.\n-\tAge of location information: defined in 3GPP TS 23.018 [10].\n-\tUser CSG information: defined in 3GPP TS 23.060 [29].\n-\tVisited PLMN ID: defined in 3GPP TS 23.003 [11].\n-\tLocal Time Zone: the Local Time Zone information (Time Zone and Daylight Saving Time) of the location in the visited network where the UE is attached, as defined in 3GPP TS 29.272 [26].\n-\tRAT type: the possible values of RAT type are specified in 3GPP TS 29.212 [28], clause 5.3.31.\nThis information element consists of the following subordinate information elements:\n-\tE-UTRAN Cell Global ID: defined in 3GPP TS 23.003 [11].\n-\tGeographical Information: defined in 3GPP TS 23.032 [12]. Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.\n-\tGeodetic Information: defined in ITU-T Recommendation Q.763 [9]. Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.\n-\tMME Name: Diameter Identity of the MME as received by the HSS within the S6a ULR Origin-Host AVP; see 3GPP TS 29.272 [31].\n-\tTracking Area ID: defined in 3GPP TS 23.003 [11].\n-\tCurrent Location Retrieved: shall be present when location information was obtained after a successful paging procedure for Active Location Retrieval if the UE is in idle mode or when the location was provided if the UE is in connected mode.\n-\tAge of location information: defined in 3GPP TS 23.018 [10].\n-\tVisited PLMN ID: defined in 3GPP TS 23.003 [11].\n-\tUser CSG information: defined in 3GPP TS 23.060 [29].\n-\tLocal Time Zone: the Local Time Zone information (Time Zone and Daylight Saving Time) of the location in the visited network where the UE is attached, as defined in 3GPP TS 29.272 [26]. .\n-\tRAT type: the possible values of RAT type are specified in 3GPP TS 29.212 [28], clause 5.3.31.\nThis information element consists of the following subordinate information elements:\n-\tTWAN SSID: defined in 3GPP TS 29.273 [34].\n-\tTWAN BSSID: defined in 3GPP TS 29.273 [34].\n-\tTWAN PLMN ID: defined in clause 12.1 of 3GPP TS 23.003 [11] for PLMN Identifer.\n-\tCivic Address: defined in clause 3.1 of IETF RFC 4776 [35] excluding the first 3 octets.\n-\tTWAN Operator Name: defined in clause 19.8 of 3GPP TS 23.003 [11].\n-\tLocal Time Zone: the Local Time Zone information (Time Zone and Daylight Saving Time) of the location in the visited network where the UE is attached, as defined in 3GPP TS 29.272 [26].\n-\tLogical Access ID defined in ETSI ES 283 034 [37].\nNOTE: The location information defined for EPS in clause 7.6.6.3 is not relevant to the TWAN location information.\nThis information element consists of the following subordinate information elements:\n-\tNR Cell Global ID: defined in 3GPP TS 23.003 [11].\n-\tE-UTRAN Cell Global ID: defined in 3GPP TS 23.003 [11].\n-\tGeographical Information: defined in 3GPP TS 23.032 [12]. Considerations described in 3GPP TS 23.018 [10] and 3GPP TS 29.002 [13] apply.\n-\tAMF Address: Identity of the serving AMF (for 3GPP access).\n-\tSMSF Address: Identity of the serving SMSF (for 3GPP access).\n-\tTracking Area ID: defined in 3GPP TS 23.003 [11] clauses 19.4.2.3 and 28.6.\n-\tCurrent Location Retrieved: shall be present when location information was obtained after a successful paging procedure for Active Location Retrieval if the UE is in idle mode or when the location was provided if the UE is in connected mode.\n-\tAge of location information: defined in 3GPP TS 23.018 [10].\n-\tVisited PLMN ID: defined in 3GPP TS 23.003 [11].\n-\tLocal Time Zone: Time zone information (Time Zone and Daylight Saving Time) of the location in the visited network where the UE is attached, as defined in 3GPP TS 29.272 [26].\n-\tRAT type: the possible values of RAT type are specified in 3GPP TS 29.212 [28], clause 5.3.31.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.7\tUser state",
                            "text_content": "This information element indicates the state of the User Identity in the domain/node indicated by the Requested-Domain/Requested-Node (see 7.2), with the values specified in 3GPP TS 23.078 [14] for Subscriber State and PS Domain Subscriber State, and with the values specified in 3GPP TS 29.272 [31] for EPS User State and 3GPP TS 29.518 [47] for the 5GS User State.\n-\tThe HSS shall make use of the operation MAP-PROVIDE-SUBSCRIBER-INFO towards the MSC/VLR to obtain this information if the requested domain is CS.\n-\tThe HSS shall make use of the operation S6a-IDR towards the MME to obtain this information if the requested domain is PS and the requested node is MME.\n-\tThe HSS shall make use of the operation MAP-PROVIDE-SUBSCRIBER-INFO or S6d-IDR towards the SGSN to obtain this information if the requested domain is PS and either the requested node is SGSN or the requested node is not present.\n-\tThe HSS shall make use of the operation S6a-IDR towards the MME and MAP-PROVIDE-SUBSCRIBER-INFO or S6d-IDR towards the SGSN to obtain this information if the requested domain is PS and the Requested Nodes is MME and SGSN.\n-\tThe UDM+HSS shall make use of the Namf_EventExposure Subscribe Service Operation towards the AMF to obtain this information if the requested domain is PS and the requested node is AMF.\nThis information element shall contain the information as received from the access nodes.The UDM+HSS may retrieve the User States from the MME, SGSN or AMF within one procedure.\nThe UDM+HSS shall include the value \"NotProvidedFromSGSN or MME or AMF\" in the \"EPSUserState\" / \"PSUserState\" / \" Sh-5GSUserState\" fields, if the MME, SGSN or AMF does not support the retrieval of User State over S6a/S6d-IDR/ Namf_EventExposure Service, or it did not provide any information on subscriber state even though it was requested by UDM+HSS.\nThe UDM+HSS shall include the value \"Detached\" in the \"EPSUserState\" / \"PSUserState\" / \" Sh-5GSUserState\" fields, if the MME, SGSN or AMF is marked as purged in the UDM+HSS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.8\tCharging information",
                            "text_content": "This information element contains the addresses of the charging functions: primary Online Charging Function (PrimaryEventChargingFunctionName), secondary Online Charging Function (SecondaryEventChargingFunctionName), primary Charging Data Function (PrimaryChargingCollectionFunctionName), and secondary Charging Data Function (SecondaryChargingCollectionFunctionName). When a clash occurs between the charging function address(es) received over the ISC interface and those received over the Sh interface, the address(es) received over the ISC interface should take precedence.\nNOTE:\tThe use of the Sh interface to retrieve charging function addresses is not intended as a general-purpose alternative to receiving charging function addresses from the ISC interfaces. Rather, it is meant to address a special case where the AS needs to interact with the charging system before initiating a request to a user when the AS has not received the third party REGISTER for that user.\nThe AS shall extract the FQDN of the DiameterURI in these information elements and may use it as content of the Destination-Host AVP for the Diameter accounting requests. The parent domain of the FQDN in the DiameterURI shall be used as Destination-Realm. The number of labels used for the Destination-Realm shall be determined before the Charging Information is provisioned and may be a configuration option.\nNOTE:\tA FQDN is an absolute domain name including a subdomain and its parent domain. The subdomain and the parent domain contain one or more labels separated by dots.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.9\tMSISDN",
                            "text_content": "This information element contains the MSISDN, or the Basic MSISDN if multinumbering is used, that is associated with the User Identity present in the request. See 3GPP TS 23.012 [19] for Basic MSISDN definition.\nMultiple instances of this information element shall only occur if the Public User Identity is shared and no Private Identity was included in the request, otherwise only one instance shall be included in the message.\nIf Additional-MSISDN feature is supported by the HSS but the AS has indicated that it does not support it, it is up to operator policy to decide what information is returned by the HSS, either what is provisioned in MSISDN or in Additional MSISDN (A-MSISDN).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.9A\tExtended MSISDN",
                            "text_content": "This information element is returned in addition to MSISDN if Additional-MSISDN feature is supported by the HSS, the AS has indicated as well its support and an Additional MSISDN (A-MSISDN) is provisioned..\nIt contains the Additional-MSISDN that is associated with the User Identity present in the request.\nAll valid instances of this information element shall be included in the message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.10\tPSIActivation",
                            "text_content": "This information element contains the activation state of the Public Service Identity present in the request. Its possible values are:\n-\tACTIVE,\n-\tINACTIVE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.11\tDSAI",
                            "text_content": "When a service is provisioned but not active, an Application Server is typically involved through the ISC interface in sessions where the Application Server is not supposed to perform any task but to proxy incoming transactions.\nIn order to avoid this disoptimization, a mechanism is provided for the Application Server to signal the HSS that a set of initial filter criteria should be \"masked\" for a specific Public User Identity or Public Service Identity. This is, from the Application Server's perspective, just an indication, and an Application Server must be prepared to be involved in sessions even if the trigger that caused its involvement has been masked by that Application Server.\nThis information element contains the activation state of a Service (identified by its DSAI-tag, see clause 7.14, for a specific user identified by a Public User Identity or of a Service identified by its PSI). Its possible values are:\n-\tACTIVE,\n-\tINACTIVE.\nIn the HSS the DSAI can also be associated to a wildcarded PSI. In that case, there is a set of identities matching a specific wildcarded PSI and all the identities in the set share the same DSAIs. Any change in these DSAIs masked from a single identity of the set will apply to all the identities associated to that wildcarded PSI.\nEach DSAI is implicitly bound to a list of (at least one) initial filter criteria. The binding is not exclusive, i.e. one instance of initial filter criteria may be bound to zero or more DSAIs, however all the iFCs bound to a given DSAI should trigger to the same AS (i.e. they should share the same ServerName), which is the only one allowed to update it.\nAn instance of initial filter criteria shall be included into the Service-Profile sent through the Cx Interface according to the operations described in 3GPP TS 29.228 [6] if at least one of the following conditions applies:\n-\tNo DSAI is bound to those initial filter criteria;\n-\tAt least one of the DSAIs bound to those initial filter criteria is set to ACTIVE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.12\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.13\tService Level Trace Information",
                            "text_content": "This information element contains the Service Level Tracing Information (see 3GPP TS 24.323 [45]) that is related to a specific Public Identifier. If the ServiceLevelTraceInfo is present, service level tracing shall be enabled in the Application Server for the related Public Identifier according to the configuration data received. If the ServiceLevelTraceInfo is not present, service level tracing is disabled in the Application Server for the related Public Identifier.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.14\tIP address secure binding information",
                            "text_content": "This information element contains the IP address (or the prefix in the case of IPv6 stateless autoconfiguration) at any given time.See 3GPP TS 33.203 [22], Annex T.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.15\tService Priority Level",
                            "text_content": "This information element contains the Priority Level allowed for Priority Service. If the ServicePriority Level is present, priority services are allowed. See IETF RFC 4412 [25].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.15A\tExtended Priority",
                            "text_content": "This information element contains the following information elements:\n-\tThe PriorityNamespace information element provides the namespace as specified in IETF RFC 4412 [25] and to which the Extended Priority refers.\n-\tThe PriorityLevel information element provides the Priority Level allowed for a given PriorityNamespace.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.16\tSMSRegistrationInfo",
                            "text_content": "This information element contains an IP-SM-GW number and the address of a Short Message Service Centre. For the definition of an IP-SM-GW number and Service Centre Address, see 3GPP TS 23.008[27].\nIf the IP-SM-GW supports SBI-based MT SM transmit, the \"SBI support indication\" of the IP-SM-GW should be included in the SMSRegistrationInfo.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.17\tUE reachability for IP",
                            "text_content": "This information element reflects the change of URRP-MME and/or URRP-SGSN parameters and indicates whether the UE has become reachable, i.e. when the URRP-MME and/or URRP-SGSN parameters was set and has been cleared due to UE activity notification from the MME and/or the SGSN, see 3GPP TS 29.272 [26].\nThis information element also indicates whether the UE has become reachable at the AMF for 3GPP access and/or at the AMF for non 3GPP access.\nIt consists of the following subordinate information elements:\n-\tUE-IP-REACHABILITY-MME. Its possible values are:\n-\tREACHABLE (0)\n-\tUE-IP-REACHABILITY-SGSN. Its possible values are:\n-\tREACHABLE (0)\n-\tUE-IP-REACHABILITY-AMF-3GPP. Its possible values are:\n-\tREACHABLE (0)\n-\tUE-IP-REACHABILITY-AMF-NON-3GPP. Its possible values are:\n-\tREACHABLE (0)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.18\tT-ADS Information",
                            "text_content": "This information element indicates the RAT type that is serving the UE and whether or not IMS voice over PS Session is supported at the current Routing Area/Tracking Area.\nThe HSS shall make use of the appropriate S6a operation towards the MME and/or S6d/MAP operation towards the SGSN to retrieve the T-ADS information. The UDM/HSS shall make use of appropriate Namf service operation towards the AMF to retrieve the T-ADS information.\nThe possible values for IMS voice over PS Session support are:\n-\tIMS-VOICE-OVER-PS-NOT-SUPPORTED (0)\n-\tIMS-VOICE-OVER-PS-SUPPORTED (1)\n-\tIMS-VOICE-OVER-PS-SUPPORT-UNKNOWN (2)\nThe possibles values of RAT type are specified in 3GPP TS 29.212 [28], clause 5.3.31.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.19\tPrivate Identity",
                            "text_content": "This information element contains the IMS Private User Identity or the IMSI. See 3GPP TS 23.003 [17]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.20\tSTN-SR",
                            "text_content": "This information element indicates the Session Transfer Number for SRVCC or 5G-SRVCC (see 3GPP TS 23.003 [11]).\nWhen STN-SR is updated, the HSS shall make use of the service S6a/S6d-IDR to update the STN-SR in the MME/SGSN and, if the HSS supports interworking with the UDM (see in 3GPP TS 23.632 [48]), the UDM shall make use of the Nudm_MT_Update operation to update the STN-SR in the AMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.21\tUE SRVCC Capability",
                            "text_content": "This information element indicates the SRVCC capability of the UE.\nThe possible values for the UE-SRVCC capability are:\n-\tUE-SRVCC-CAPABILITY-NOT-SUPPORTED (0)\n-\tUE-SRVCC-CAPABILITY-SUPPORTED (1)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.21A\tUE 5G SRVCC Capability",
                            "text_content": "This information element indicates the 5G SRVCC capability of the UE.\nThe possible values for the UE-5G-SRVCC capability are:\n-\tUE-5G-SRVCC-CAPABILITY-NOT-SUPPORTED (0)\n-\tUE-5G-SRVCC-CAPABILITY-SUPPORTED (1)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.22\tCSRN",
                            "text_content": "This information element contains a CS Domain Routeing Number (see 3GPP TS 23.003) associated to the user identity of the request.\nThe HSS shall make use of the operation MAP-PROVIDE-ROAMING-NUMBER towards the MSC/VLR to obtain this information and shall indicate the Suppression of Announcement to the MSC/VLR.\nThis information element is requested by AS when all terminating services have been already executed, then HSS is only interested in the CSRN received from MSC/VLR.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.23\tReference Location Information",
                            "text_content": "This information element contains the reference location of the user, e.g. the physical location of the fixed line in the case of a fixed line access, that is associated with the User Identity and Private Identity (if present) in the request. See 3GPP TS 23.008 [27].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.24\tIMSI",
                            "text_content": "This information element contains the IMSI that is associated with the IMS Public User Identity present in the request. See 3GPP TS 23.003 [11] for IMSI definition.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.25\tIMSPrivateUserIdentity",
                            "text_content": "This information element contains all IMS Private User Identities associated with the IMS Public User Identity present in the request. See 3GPP TS 23.003 [11] for Private User Identity definition.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.6.26\tIMEISV",
                            "text_content": "This information element contains the IMEI or IMEISV (see 3GPP TS 23.003 [11]) of the UE employed by the user identity of the request, during the attach to the access network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.7\tSubscription request type",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates the action requested for subscription to notifications. See 3GPP TS 29.329 [5] for the list of valid values.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.8\tCurrent Location",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates whether an active location retrieval has to be initiated or not when an AS requested location information. See 3GPP TS 29.329 [5] for the list of possible values.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.9\tApplication Server Identity",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element contains the identity of the Application Server. It is used for the AS permission check (see 6.2).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.10\tApplication Server Name",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates application server's SIP URI. See 3GPP TS 29.229 [7] for the detailed definition of the AVP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.11\tRequested Identity Set",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates the set of IMS Public Identities that the AS wishes to download. See 3GPP TS 29.329 [5] for the detailed definition of the AVP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.12\tExpiry Time",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates the expiry time of the subscription to notifications in the HSS. See 3GPP TS 29.329 [5] for the detailed definition of this AVP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.13\tSend Data Indication",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates the request that the User Data is sent in the response. See 3GPP TS 29.329 [5] for the detailed definition of this AVP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.14\tDSAI Tag",
                    "description": "",
                    "summary": "",
                    "text_content": "An instance of Dynamic Service Activation Info is uniquely identified by the Public User/Service Identity and a DSAI tag. The same DSAI tag may be used for all the user profiles when indicating the same type of information, but not all the user profiles may contain the same set of tags.\nApplication Servers shall signal that they are not interested in being involved in new sessions by manipulating Dynamic Service Activation Info (DSAI) inside of dynamic service information data, see clause 7.6.11.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.15\tSession-Priority",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates the session's priority level to the HSS. See 3GPP TS 29.229 [7].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.16\tOne Time Notification",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates that the sender requests to be notified only one time. After the notification, the HSS shall remove the subscription. See 3GPP TS 29.329 [5] for the list of possible values.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.17\tRepository Data ID",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element includes the service indication and the sequence number of a repository data. See 3GPP TS 29.329 [5] for the detailed definition of this AVP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.18\tPre-paging Supported",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates whether Pre-paging is supported by the AS. See 3GPP TS 29.329 [5] for the detailed definition of this AVP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.19\tLocal Time Zone Indication",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element indicates that the Local Time Zone information (Time Zone and Daylight Saving Time) of the location in the visited network where the UE is attached for the requested domain and the requested nodes (if included) is requested and indicates whether only the Local Time Zone is required or the Local Time Zone is required together with other location data. If only the Local Time Zone is required, other location information (e.g. Global Cell ID, Tracking Area ID) may be absent.\nThis information element is only applicable to Location Information.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.20\tUDR Flags",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element carries the following indications (see 3GPP 29.329 [5] for coding details):\nTable 7.20/1: UDR Flags\n\n",
                    "tables": [
                        {
                            "description": "Table 7.20/1: UDR Flags",
                            "table number": 14,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.21\tCall Reference Info",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element contains information used for MTRR (see 3GPP TS 23.018 [10]):\n-\tCall Reference Number (see 7.22)\n-\tAS-Number (see 7.23)\nThe HSS uses this information to populate the parameters callReferenceNumber and gmsc-Address within MAP-Provide-Roaming-Number.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.22\tCall Reference Number",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element contains a temporary reference number identifying the call in progress (see 3GPP TS 23.018 [10]).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.23\tAS-Number",
                    "description": "",
                    "summary": "",
                    "text_content": "This information element contains the Application Server's E.164 Number.\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "8\tProtocol version identification",
            "description": "See 3GPP TS 29.329 [5].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "9\tOperational Aspects",
            "description": "See 3GPP TS 29.329 [5].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.1\tIntroduction",
            "description": "This appendix gives mappings from Sh to Diameter protocol elements. Diameter protocol elements are defined in 3GPP TS 29.329 [5].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.2\tSh message to Diameter command mapping",
            "description": "The following table defines the mapping between stage 2 operations and Diameter commands:\nTable A.2.1: Sh message to Diameter command mapping\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table A.2.1: Sh message to Diameter command mapping",
                    "table number": 15,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.3\tVoid",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.1\tMessage flows",
            "description": "The following message flows give examples regarding which Diameter messages shall be sent in scenarios described in 3GPP TS 23.218 [4].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.1.1\tData Update, Registration, Notification Subscription.",
                    "description": "",
                    "summary": "",
                    "text_content": "The figure depicts a simplified representation of the data update, registration, and notification subscription process in a network. It illustrates the flow of data from the source to the destination, highlighting the steps involved in ensuring data integrity and ensuring that notifications are sent to the correct recipients.\nFigure B.1.1: Data Update, Registration, Notification Subscription\n1.\tA user subscribes to a new service. The operator provisions the service in an AS. The AS stores some service data for a user in the HSS, Sh-Update (user identity, updated data) e.g. repository data.\n2.\tHSS confirms the data is updated\n3.\tSome time later, user registers with the network\n4.\tS-CSCF downloads the data from the HSS (during the procedure S-CSCF Registration Notification on Cx interface). Filter criteria specify that the AS wants to be notified that the end user is registered.\n5.\t200 OK\n6.\tS-CSCF sends third party registration message to the application server to notify that user is registered.\n7.\t200 OK\n8.\tThe AS subscribes to notifications and downloads data needed for providing service from HSS, by means of Sh-Subs-Notif (user identity, requested data, service information and send data indication).\n9.\tHSS confirms the subscription request and sends data to AS\n10.\tAt some moment, the AS decides to update user's service data e.g. repository data in the HSS, by means of Sh-Update (user identity, updated data).\n11.\tThe HSS confirms the service data is updated.\n12.\tAt some moment, user data is updated in the HSS. As the AS subscribed to notifications (step 8), the HSS sends to the AS the requested updates, by means of Sh-Notif (user identity, updated data).\n13.\tThe AS acknowledges the notification.\nThe purpose of this UML model is to define in an abstract level the structure of the data downloaded over the Sh interface and describe the purpose of the different information classes included in it.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "C.1\tGeneral description",
            "description": "The following picture gives an outline of the UML model of the user profile, which is exchanged between the HSS and an AS:\nThe figure depicts a simplified representation of a Sh-Data transmission, illustrating the key components and their interactions. The figure shows a single-path transmission, with the transmitter (Tx) and receiver (Rx) located at the center of the figure. The Tx sends a signal to the Rx, which then decodes the data. The figure highlights the importance of proper signal propagation and the use of beamforming techniques to mitigate interference.\nFigure C.1.1: Sh-Data\nClass Sh-Data contains the following attributes:\n-\tAn optional instance of CSUserState attribute.\n-\tAn optional instance of PSUserState attribute.\n-\tAn optional instance of IMSI attribute.\n-\tZero or more instances of IMSPrivateUserIdentity attribute.\n-\tAn optional instance of IMEISV attribute.\nClass Sh-Data contains the following classes:\n-\tAn optional instance of the class PublicIdentifiers.\n-\tZero or moreinstances of the class RepositoryData.\n-\tAn optional instance of the class Sh-IMS-Data.\n-\tAn optional instance of the class CSLocationInformation.\n-\tAn optional instance of the class PSLocationInformation.\n-\tAn optional instance of the class RegisteredIdentities.\n-\tAn optional instance of the class ImplicitIdentities.\n-\tAn optional instance of the class AllIdentities.\n-\tAn optional instance of the class AliasIdentities.\n-\tAn optional instance of the class DeletedIdentities.\nIf the AS and the HSS both support the Notif-Eff feature and the AS requires to read more than one Identity Sets of a Public Identity, or regardless whether or not the Notif-Eff feature is supported, the AS has subscribed to be notifed of changes to IMSPublicIdentity for more than one Identity Sets (see table 7.6.1), the class PublicIdentifiers shall not be used to convey IMS Public Identities (it shall however still be used to convey the MSISDNs if so requested). Instead the classes RegisteredIdentities, ImplicitIdentities, AllIdentities and AliasIdentities shall be used and they contain the REGISTERED_IDENTITIES, IMPLICIT_IDENTITIES, ALL_IDENTITIES and ALIAS_IDENTITIES associated with the IMS Public Identity included in the request respectively. See clause 7.6.2 for the detailed information. The class PublicIdentifiers or the one among the four which may be used to contain the corresponding identity set can both be used to convey IMS Public Identities when AS requires only one identity set of a public identity.\nIf Public Identity(ies) are deleted and the AS has any subscription active for the deleted identity(ies), the HSS shall notify the AS of the deletion of the identity(ies) using the class DeletedIdentities.\nClass RepositoryData contains repository data (transparent data) for a given service that are associated to a Public user Identity or a group of alias Public User Identities. It has attributes ServiceIndication, SequenceNumber and ServiceData.\nClass CSUserState contains the state of a user in the CS domain. Its only attribute, State, is an enumeration whose possible values are defined in clause 7.6.7.\nClass PSUserState contains the state of a user in the PS domain (SGSN). Its only attribute, State, is an enumeration whose possible values are defined in clause 7.6.7.\nNOTE: the fact that attribute State is an enumeration is a difference from what can be carried in the MAP protocol.\nClass EPSUserState contains the state of a user in the PS domain (MME). Its only attribute, State, is an enumeration whose possible values are defined in clause 7.6.7. .\nClass Sh-5GSUserState contains the state of a user in the PS domain (AMF). Its only attribute, State, is an enumeration whose possible values are defined in clause 7.6.7.\nClass CSLocationInformation has the attributes LocationNumber, ServiceAreaID, CellGlobalId, LocationAreaId, GeographicalInformation, GeodeticInformation, VLRNumber, MSCNumber, AgeOfLocationInformation, CurrentLocationRetrieved, UserCSGInformation, TrackingAreaId, E-UTRANCellGlobalId and LocalTimeZone. They are defined in 7.6.\nClass PSLocationInformation has the attributes ServiceAreaId, CellGlobalId, LocationAreaID, RoutingAreaID, GeographicalInformation, GeodeticInformation, SGSNNumber, AgeOfLocationInformation, CurrentLocationRetrieved, UserCSGInformation, VisitedPLMNID, LocalTimeZone and RATtype. They are defined in 7.6.\nClass EPSLocationInformation has the attributes E-UTRANCellGlobalId, TrackingAreaID, GeographicalInformation, GeodeticInformation, MMEName, AgeOfLocationInformation, CurrentLocationRetrieved, UserCSGInformation, VisitedPLMNID, LocalTimeZone and RATtype. They are defined in 7.6.\nClass TWANLocationInformation has the attributes TWAN-SSID, TWAN-BSSID, TWAN-PLMNID, CivicAddress, TWANOperatorName, LocalTimeZone and LogicalAccessID. They are defined in 7.6.\nClass Sh-5GSLocationInformation has the attributes NRCellGlobalId, E-UTRANCellGlobalId, TrackingAreaID, GeographicalInformation, AMFAddress, SMSFAddress, AgeOfLocationInformation, CurrentLocationRetrieved, VisitedPLMNID, LocalTimeZone and RATtype. They are defined in 7.6.\nClass DeletedIdentities contains Public Identities (IMS Public User Identities or Public Service Identities) removed from the HSS.\nClass UEReachabilityForIP contains the UE reachability for IP. Its attributes, UEIPReachabilityMME, UEIPReachabilitySGSN, UEIPReachabilityAMF3GPP and UEIPReachabilityAMFnon3GPP are enumerations whose possible values are defined in clause 7.6.17.\nClass IMSVoiceOverPSSessionsSupport contains the support of IMS voice over PS at the current access. Its only attribute, SupportIndication, is an enumeration whose possible values are defined in clause 7.6.18.\nClass IMSI contains the UE's IMSI. See clause 7.6.24.\nClass IMSPrivateUserIdentity contains an IMS Private Identity associated with the IMS Public Identity included in the request.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.2\tPublicIdentifiers",
            "description": "The following picture details the UML model of the class PublicIdentifiers:\nThe figure depicts a UML class diagram for the class PublicIdentifiers, which represents a set of identifiers that are publicly available. The diagram shows the inheritance relationships between the classes and the relationships between the identifiers and their corresponding classes. The diagram is used to illustrate the structure and relationships of the class PublicIdentifiers, which is a part of the larger system.\nFigure C.2.1: The UML model of the class PublicIdentifiers\nClass PublicIdentifiers contains the following attributes:\n-\tZero or more instances of IMSPublicIdentity attribute. Each instance is a Public Identity. See clause 7.6.2 for information about contents.\n-\tAn optional instance of IdentityType attribute. If only one instance of IMSPublicIdentity attribute is included, then this attribute identifies the identity type in the IMSPublicIdentity attribute, it could be either:\n-\tA distinct Public User Identity\n-\tA distinct Public Service Identity\nIf more than one instance of IMSPublicIdentity attribute is included, this attribute is assumed to apply to all of them.\nIf IdentityType attribute is not present, it is assumed to be a distinct Public User Identity.\nIf more than one instance of IMSPublicIdentity shall be returned, if the identities are of different types the EnhancedIMSPublicIdentifiers class should be used instead.\n-\tAn optional instance of WilcardedPSI attribute, if the Public Service Identity in the request matches a Wildcarded PSI.\nNOTE:\tThis attribute can be omitted if this information is conveyed including Wildcarded PSI information element in the response. See clause 6.1.1 and 6.1.3.\n-\tAn optional instance of WilcardedIMPU attribute, if the Public User Identity in the request matches a Wildcarded IMPU.\nNOTE:\tThis attribute can be omitted if this information is conveyed including Wildcarded Public User Identity information element in the response. See clause 6.1.1 and 6.1.3.\n-\tZero or more instances of MSISDN attribute, that contains an MSISDN.\nClass PublicIdentifiers contains the following classes:\n-\tZero to more instances of EnhancedIMSPublicIdentifiers. This class is required when more than one instance of IMSPublicIdentity shall be returned and the identities are of different types. See clause 7.6.2 for more information about contents. It includes the following attributes:\n-\tOne instance of IMSPublicIdentity attribute that contains a Public Identity.\n-\tOne instance of the IdentityType attribute that identifies the identity type in the IMSPublicIdentity attribute, it could be either:\n-\tA distinct Public User Identity\n-\tA distinct Public Service Identity\n-\tA Wildcarded Public Service Identity\n-\tA Wildcarded Public User Identity\n-\tZero or more instances of ExtendedMSISDN, only when Additional-MSISDN feature is enabled. It includes the following attributes:\n-\tOne instance of MSISDN attribute that contains an MSISDN.\n-\tOne instance of MSISDNType attribute that indicates the MSISDN Type.\n\nFigure C.2.2: Void\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.3\tSh-IMS-Data",
            "description": "The following picture details the UML model of the class Sh-IMS-Data.\n\nThe figure C.3.1 depicts the Sh-IMS-Data communication protocol, illustrating the data flow between the Sh-IMS (Serving Information Management System) and the IMS (Information Management System). The diagram shows the data flow from the Sh-IMS to the IMS, with the data being transmitted over a network of optical fibers. The figure also includes key components such as the Sh-IMS, IMS, and the network infrastructure, highlighting the importance of network redundancy and failover mechanisms.\nFigure C.3.1: Sh-IMS-Data\nEach instance of the class Sh-IMS-Data contains 0 or 1 instance of the class S-CSCFName, 0 to 1 instance of the class IFCs, 0 or 1 instance of the class IMSUserState, 0 or 1 instance of the class ChargingInformation, 0 or 1 instance of the class PSIActivation, 0 to n instances of the class DSAI, 0 or 1 instance of the class ServiceLevelTraceInfo, 0 or 1 instance of the class IPAddressSecureBindingInformation, and 0 or 1 instance of the class ReferenceLocationInformation.\nClass S-CSCFName contains a SIP URI. See clause 7.6.4 for further details.\nClass IFCs contains 0 to n instances of the initial filter criteria of the multimedia public identity that the AS included in the request. The initial filter criteria is defined in 3GPP TS 29.228 [6].\nClass IMSUserState contains the registration state of the identity given by the attribute of class Sh-IMS-Data. See clause 7.6 for possible values.\nClass Charging Information contains the online and offline charging function addresses. See clause 7.6 for possible values.\nClass PSIActivation contains the activation state of the Public Service Identity given by the attribute of class Sh-IMS-Data. See clause 7.6 for possible values.\nClass DSAI contains the DSAI Tag and a DSAI Value (reflecting the activation state) for services the user is subscribed to. See clause 7.14 for contents and usage.\nClass ServiceLevelTraceInfo contains the Service Level Trace configuration information to enable the Application Server to perform service level tracing related to a specific Public Identifier. See clause 7.6.13 for contents and usage.\nClass IPAddressSecureBindingInformation contains either 0 or one IPv4 address, either 0 or one IPv6 prefix and/or IPv6 interface identifier. See clause 7.6.14 for contents and usage.\nClass ServicePriorityLevel contains the Service Priority Level allowed for the Public Identity to be used for priority services. See clause 7.6.15 for contents and usage.\nClass SMSRegistrationInfo contains the IP-SM-GW-Number and the Service Centre Address. See clause 7.6.16 for further details.\nClass Enhanced SRVCC contains the Session Transfer Number (see 3GPP TS 23.003 [11]) and the SRVCC Capability of the UE (see 3GPP TS 23.237 [32]). See clauses 7.6.20 and 7.6.21 respectively for further details.\nClass 5G SRVCC contains the 5G SRVCC Capability of the UE (see 3GPP TS 23.237 [32]). See clause 7.6.21A for further details.\nClass ExtendedPriority contains the PriorityNamespace and the PriorityLevel information elements. See Clause 7.6.15A for further details.\nClass Reference Location Information contains zero or one attribute AccessType, zero or one attribute AccessInfo, and zero or one attribute AccessValue, see 3GPP TS 29.228 [6].\nThe file ShDataType_Rel15.xsd, attached to this specification, contains the XML schema for the user profile that is sent over the Sh interface. The user profile XML schema defines the data types that are used in the user profile XML.\nThe data that is allowed to be sent in the user profile may vary depending on the features supported by the Diameter end points, see 3GPP TS 29.329 [5]. The user profile XML schema file is intended to be used by an XML parser.\nThe version of the Sh application sending the user profile XML shall be the same as the version of the sent user profile XML and thus it implies the version of the user profile XML schema to be used to validate it.\nTables D.1 and D.2 describe the data types and the dependencies among them that configure the user profile XML schema.\nTable D.1: XML schema for the Sh user profile interface: simple data types\n\nTable D.2: XML schema for the Sh user profile interface: complex data types\n\nE.1\tT-ADS request handling in the HSSThe following figure shows a possible detailed handling of T-ADS Information request in the HSS:\n\n\n\n\n\n\n\n\n\n\n\nWhen receiving a T-ADS request from an Application Server, the HSS checks whether serving nodes (i.e. SGSN and/or MME) are registered (i.e. GPRS services and/or EPS services are actually subscribed, serving node addresses are stored and not marked as purged).\nIf neither MME nor SGSN is registered, a response indicating that IMS voice over PS sessions is not supported is returned to the Application Server. UE Activity Time and the Last RAT Type are not reported.\nIf both MME and SGSN are registered but the registered SGSN is a Gn/Gp-SGSN, the HSS treats the MME as not registered in the following T-ADS request handling.\nOtherwise,\nif in the previous ULR(s) the AVP Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions was received from all the registered serving nodes with the same value (either with SUPPORTED or NOT_SUPPORTED), a response with the received value is returned to the Application Server. UE Activity Time and the Last RAT Type are not reported.\nif in previous ULRs the AVP Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions was received from all the registered serving nodes but with different values, the HSS continues processing as follows:\nif MME or SGSN (or both) did not indicated support of T-ADS Data Retrieval within the previous ULR, a response indicating IMS-VOICE-OVER-PS-SUPPORT-UNKNOWN is returned to the Application Server. UE Activity Time and the Last RAT Type are not reported.\notherwise the HSS retrieves T-ADS Data from MME and from SGSN. After retrieval, the HSS returns a response to the Application Server indicating the response from MME or SGSN whichever reported the most recent UE Activity Time. UE Activity Time and the Last RAT Type are also reported.\nif in the previous ULR(s) the AVP Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions was not received from at least one of the registered serving nodes, the HSS continues processing as follows:\nif at least one of the registered serving nodes that did not send an Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions AVP within the previous ULR did not indicate support of T-ADS Data Retrieval within the previous ULR, a response indicating IMS-VOICE-OVER-PS-SUPPORT-UNKNOWN is returned to the Application Server. UE Activity Time and the Last RAT Type are not reported.\notherwise the HSS retrieves T-ADS Data from all the registered serving nodes that did not send an Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions AVP within the previous ULR. When all responses are received the HSS continues processing as follows:\nif two T-ADS Data responses were receive (one from MME and one from SGSN), the HSS returns a response to the Application Server indicating the response from MME or SGSN whichever reported the most recent UE Activity Time. UE Activity Time and the Last RAT Type are also reported.\nif one T-ADS Data response was received (from MME or SGSN) and the other serving node (SGSN or MME) was not registered, the HSS returns a response to the Application Server indicating the response from responding serving node. UE Activity Time and the Last RAT Type are also reported.\nif one T-ADS Data response was received (from MME or SGSN) and the other serving node (SGSN or MME) has sent an Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions AVP within the previous ULR, the HSS continues processing as follows:\nif information about support / non-support of IMS voice over PS sessions from both serving nodes are identical, the HSS returns this information to the Application Server. UE Activity Time and the Last RAT Type are not reported.\nif information about support / non-support of IMS voice over PS sessions from both serving nodes are not identical, the HSS continues processing as follows:\nif the serving node that sent an Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions AVP within the previous ULR did not indicate support of T-ADS Data Retrieval within the previous ULR, a response indicating IMS-VOICE-OVER-PS-SUPPORT-UNKNOWN is returned to the Application Server. UE Activity Time and the Last RAT Type are not reported.\notherwise the HSS retrieves T-ADS Data from the serving node that sent an Homogeneous-Support-of-IMS-Voice-Over-PS-Sessions AVP within the previous ULR. When the response is received, the HSS returns a response to the Application Server indicating the response from MME or SGSN whichever reported the most recent UE Activity Time. UE Activity Time and the Last RAT Type are also reported.\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table D.1: XML schema for the Sh user profile interface: simple data types",
                    "table number": 16,
                    "summary": "",
                    "name": ""
                },
                {
                    "description": "Table D.2: XML schema for the Sh user profile interface: complex data types",
                    "table number": 17,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.1\tGeneral",
            "description": "Diameter overload control mechanism is an optional feature.\nIETF RFC 7683 [36] specifies a Diameter overload control mechanism which includes the definition and the transfer of related AVPs between Diameter nodes.\nIt is recommended to make use of IETF RFC 7683 [36] on the Sh interface where, when applied, the AS shall behave as a reacting node and the HSS as a reporting node.\nDepending on regional/national requirements and network operator policy, priority traffic (e.g. MPS as described in 3GPP TS 22.153 [38]) shall be exempted from throttling due to Diameter overload control up to the point where requested traffic reduction cannot be achieved without throttling the priority traffic.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.2\tHSS behaviour",
            "description": "The HSS requests traffic reduction from the AS when the HSS is in an overload situation, including OC-OLR AVP in answer commands as described in IETF RFC 7683 [36].\nThe HSS identifies that it is in an overload situation by implementation specific means. For example, the HSS may take into account the traffic over the Sh interfaces or other interfaces, the level of usage of internal resources (CPU, memory), the access to external resources, etc.\nThe HSS determines the specific contents of OC-OLR AVP in overload reports and the HSS decides when to send OC-OLR AVPs by implementation specific means.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.3\tAS behaviour",
            "description": "The AS applies required traffic reduction received in answer commands to subsequent applicable requests, as per IETF RFC 7683 [36].\nThe AS achieves requested traffic reduction by implementation specific means. For example, the AS may implement message throttling with prioritization or a message retaining mechanism for operations that can be postponed.\nDiameter requests related to priority traffic (e.g. MPS) and emergency, detected via the presence of priority information (e.g., Resource-Priority header field for MPS) in SIP messages as described in 3GPP TS 24.229 [39], have the highest priority. Depending on regional/national regulatory and operator policies, these Diameter requests shall be the last to be throttled, when the AS has to apply traffic reduction. Relative priority amongst various priority traffic (e.g. MPS) and emergency traffic is subject to regional/national regulatory and operator policies.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.1\tMessage prioritization",
            "description": "This clause describes possible behaviours of the AS regarding message prioritization in an informative purpose.\nThe AS may take the following into account when making throttling decisions:\n-\tIdentification of the procedures that can be deferred (e.g. Subscription to notification of Data Update), so to avoid to drop non deferrable procedures;\n-\tPrioritization of certain types of request (e.g. between PUR and SNR) according to the context of their use, in particular:\n-\tHigher prioritization of commands for AS that are related to a registered user for a service, so to avoid the interruption of the registered service for the user.\n-\tLower prioritization of commands for AS that are related to massive subscription data update due to provisioning.\n-\tPriority level of a priority user (e.g., MPS user).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.1\tGeneral",
            "description": "This clause applies only to Repository Data.\nAs defined by this specification, Repository Data is updated using a Sh-Update procedure per subscriber and Service Indication. This means that when Repository Data needs to be modified, it requires an update operation per subscriber, even if the same Repository Data is also part of other subscribers' data set.\nIf Repository Data for a specific Service Indication is shared by a large amount of subscribers, it implies a large amount of update operations, which may trigger a large amount of notifications if any AS subscribed to changes for these corresponding subscribers.\nSee 3GPP TS 29.364 [40] for a description of a solution to avoid this massive amount of update operations. However, it is important to remark that there may be other implementation specific solutions that handle data sharing among multiple individual subscribers.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.1\tGeneral",
            "description": "IETF draft-ietf-drmp-02 [42] specifies a Diameter message priority mechanism that allows Diameter nodes to indicate the relative priority of Diameter messages. With this information, other Diameter nodes may leverage the relative priority of Diameter messages into routing, resource allocation, set the DSCP marking for transport of the associated Diameter message, and also abatement decisions when overload control is applied.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.2\tSh/Dh interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "I.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The Diameter message priority mechanism is an optional feature.\nIt is recommended to make use of IETF draft-ietf-drmp-02 [42] over the Sh/Dh interface of an operator network when the overload control defined in Annex F is applied on this Sh/Dh interface.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "I.2.2\tAS/OSA SCS behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "When the AS/OSA SCS supports the Diameter message priority mechanism, the AS/OSA SCS shall comply with IETF RFC 7944 [42].\nThe AS/OSA SCS sending a request shall determine the required priority according to its policies. When priority is required, the AS/OSA SCS shall include the DRMP AVP indicating the required priority level in the request it sends, and shall prioritise the request according to priority level received.\nWhen the AS/OSA SCS receives the corresponding response, it shall prioritise the received response according to the priority level received within the DRMP AVP if present in the response, otherwise according to the priority level of the corresponding request.\nWhen the AS/OSA SCS receives a request, it shall handle the request according to the received DRMP AVP priority level. For the response, it may modify the priority level received in the DRMP AVP according to its policies and shall handle the response according to the required priority level. If the required priority level is different from the priority level received in the request, it shall include the DRMP AVP in the response.\nIf:\n-\tthe AS/OSA SCS supports using the Diameter message priority mechanism for DSCP marking purposes,\n-\tthe transport network utilizes DSCP marking, and\n-\tmessage-dependant DSCP marking is possible for the protocol stack transporting Diameter,\nthen the AS/OSA SCS shall set the DSCP marking for transport of the request or response according to the required priority level.\nDiameter requests related to priority traffic (e.g. MPS as identified by the AS through SIP procedures, emergency) shall contain a DRMP AVP with a high priority of which the level value is operator dependent.\nWhen not-explicitly requested, the inclusion and priority value of the DRMP AVP in Diameter messages are implementation specific.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "I.2.3\tHSS/SLF behaviour",
                    "description": "",
                    "summary": "",
                    "text_content": "When the HSS/SLF supports the Diameter message priority mechanism, the HSS/SLF shall comply with IETF RFC 7944 [42].\nThe HSS/SLF sending a request shall determine the required priority according to its policies. When priority is required, the HSS/SLF shall include the DRMP AVP indicating the required priority level in the request it sends, and shall prioritise the request according to the required priority level.\nWhen the HSS/SLF receives the corresponding response, it shall prioritise the received response according to the priority level received within the DRMP AVP if present in the response, otherwise according to the priority level of the corresponding request.\nWhen the HSS/SLF receives a request, it shall handle the request according to the received DRMP AVP priority level. For the response, it may modify the priority level received in the DRMP AVP according to its policies and shall handle the response according to the required priority level. If the required priority level is different from the priority level received in the request, it shall include the DRMP AVP in the response.\nIf:\n-\tthe HSS/SLF supports using the Diameter message priority mechanism for DSCP marking purposes,\n-\tthe transport network utilizes DSCP marking, and\n-\tmessage-dependant DSCP marking is possible for the protocol stack transporting Diameter,\nthen the HSS/SLF shall set the DSCP marking for transport of the request or response according to the required priority level.\nWhen not-explicitly requested, the inclusion and priority value of the DRMP AVP in Diameter messages are implementation specific.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "I.2.4\tInteractions",
                    "description": "",
                    "summary": "",
                    "text_content": "If the HSS/SLF supporting the Diameter message priority mechanism receives the request message containing both the Session-Priority AVP and DRMP AVP, the HSS/SLF shall prioritize the request according to priority level received within the DRMP AVP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "J.1\tGeneral",
            "description": "Diameter load control mechanism is an optional feature.\nIt is recommended to make use of IETF RFC 8583 [43] on the Sh interface where, when applied, the AS shall behave as reacting nodes and the HSS as a reporting node.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "J.2\tHSS behaviour",
            "description": "The HSS may report its current load by including a Load AVP of type HOST in answer commands as described in IETF RFC 8583 [43].\nThe HSS calculates its current load by implementation specific means. For example, the HSS may take into account the traffic over the Sh interface or other interfaces, the level of usage of internal resources (e.g. CPU, memory), the access to external resources, etc.\nThe HSS determines when to send Load AVPs of type HOST by implementation specific means.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "J.3\tAS behaviour",
            "description": "When performing next hop Diameter Agent selection for requests that are routed based on realm, the AS may take into account load values from Load AVPs of type PEER received from candidate next hop Diameter nodes, as per IETF RFC 8583 [43].\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "",
                    "table number": 18,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        }
    ]
}